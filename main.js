/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Gf=Object.defineProperty;var kP=Object.getOwnPropertyDescriptor;var NP=Object.getOwnPropertyNames;var FP=Object.prototype.hasOwnProperty;var LP=(i,e,t)=>e in i?Gf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var OP=(i,e)=>{for(var t in e)Gf(i,t,{get:e[t],enumerable:!0})},UP=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of NP(e))!FP.call(i,s)&&s!==t&&Gf(i,s,{get:()=>e[s],enumerable:!(n=kP(e,s))||n.enumerable});return i};var HP=i=>UP(Gf({},"__esModule",{value:!0}),i);var Y=(i,e,t)=>(LP(i,typeof e!="symbol"?e+"":e,t),t),ub=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var u=(i,e,t)=>(ub(i,e,"read from private field"),t?t.call(i):e.get(i)),b=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},w=(i,e,t,n)=>(ub(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t);var vt=(i,e,t,n)=>({set _(s){w(i,e,s,t)},get _(){return u(i,e,n)}}),A=(i,e,t)=>(ub(i,e,"access private method"),t);var h$={};OP(h$,{default:()=>cb});module.exports=HP(h$);var M=require("obsidian");var A_={geminiApiKey:"",inboxFolder:"00 _Inbox",projectsFolder:"01 Projects",libraryFolder:"02 Library",archivesFolder:"03 Archives",zettelFolder:"10 Zettelkasten",autoWatch:!0,triggerTag:"#\uC644\uB8CC",language:"ko",ocrEnabled:!0,ocrAutoProcess:!1,ocrMoveOriginal:!0,ocrOriginalFolder:"03 Archives/OCR_\uC6D0\uBCF8",ocrMinTextThreshold:50,ocrMaxPages:20,ocrMaxFileSizeMB:10,ocrDailyLimit:50,zkIdType:"date-sequence",zkMergeThreshold:.8,timezone:"auto",dateFormat:"local",scheduleDetectionEnabled:!0,dailyNotesFolder:"00 _Inbox",googleCalendarEnabled:!1,useOwnApiKey:!1,googleClientId:"",googleClientSecret:"",googleAccessToken:"",googleRefreshToken:"",googleTokenExpiry:0,calendarEnabled:!0,calendarDefaultView:"month",calendarFirstDayOfWeek:0,showMiniCalendar:!0,embeddingEnabled:!1,embeddingSimilarityThreshold:.7,ragEnabled:!0,ragTopK:5,ragMaxContextLength:4e3,onboardingCompleted:!1,preset:"custom",lastNotifiedVersion:void 0},hb={version:1,feedback:{referenceLocation:{toLibrary:0,toProject:0,preference:"neutral"},scheduleDetection:{accepted:0,rejected:0,falsePositivePatterns:[]},projectClassification:{corrections:[]}},restructure:{accepted:0,rejected:0,preferredFormats:[],preference:"neutral"},embedding:{acceptedPairs:[],rejectedPairs:[],similarityThresholdAdjustment:0},rag:{frequentQuestions:[],preferredNotes:[],feedbackOnAnswers:{helpful:0,notHelpful:0}}},Vf={version:1,entries:[],preferences:hb,lastUpdated:new Date().toISOString()};var z=require("obsidian");var T_=[{value:"auto",label:"\uC790\uB3D9 \uAC10\uC9C0"},{value:"Asia/Seoul",label:"\uD55C\uAD6D (KST, UTC+9)"},{value:"Asia/Tokyo",label:"\uC77C\uBCF8 (JST, UTC+9)"},{value:"Asia/Shanghai",label:"\uC911\uAD6D (CST, UTC+8)"},{value:"America/New_York",label:"\uBBF8\uAD6D \uB3D9\uBD80 (EST/EDT)"},{value:"America/Los_Angeles",label:"\uBBF8\uAD6D \uC11C\uBD80 (PST/PDT)"},{value:"Europe/London",label:"\uC601\uAD6D (GMT/BST)"},{value:"UTC",label:"UTC"}],x_=[{value:"iso",label:"ISO \uD615\uC2DD (2026-01-05T16:24:45+09:00)"},{value:"local",label:"\uB85C\uCEEC \uD615\uC2DD (2026-01-05 16:24:45)"},{value:"friendly",label:"\uCE5C\uADFC\uD55C \uD615\uC2DD (2026\uB144 1\uC6D4 5\uC77C 16:24)"}];function $f(i){return i==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:i}function fb(i,e,t){let n=$f(e);switch(t){case"iso":return BP(i,n);case"local":return C_(i,n);case"friendly":return GP(i,n);default:return C_(i,n)}}function BP(i,e){let t={timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",t).formatToParts(i),s=p=>{var m;return((m=n.find(y=>y.type===p))==null?void 0:m.value)||""},r=s("year"),o=s("month"),a=s("day"),l=s("hour"),c=s("minute"),d=s("second"),h=VP(i,e);return`${r}-${o}-${a}T${l}:${c}:${d}${h}`}function C_(i,e){let t={timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",t).formatToParts(i),s=h=>{var p;return((p=n.find(m=>m.type===h))==null?void 0:p.value)||""},r=s("year"),o=s("month"),a=s("day"),l=s("hour"),c=s("minute"),d=s("second");return`${r}-${o}-${a} ${l}:${c}:${d}`}function GP(i,e){let t={timeZone:e,year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};return new Intl.DateTimeFormat("ko-KR",t).format(i)}function VP(i,e){let t=new Date(i.toLocaleString("en-US",{timeZone:"UTC"})),s=(new Date(i.toLocaleString("en-US",{timeZone:e})).getTime()-t.getTime())/(1e3*60);if(s===0)return"Z";let r=s>=0?"+":"-",o=Math.abs(s),a=Math.floor(o/60),l=o%60;return`${r}${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}`}function Le(i,e){let n={timeZone:$f(e),year:"numeric",month:"2-digit",day:"2-digit"},s=new Intl.DateTimeFormat("en-CA",n).formatToParts(i),r=o=>{var a;return((a=s.find(l=>l.type===o))==null?void 0:a.value)||""};return`${r("year")}-${r("month")}-${r("day")}`}function Oe(i,e){return fb(new Date,i,e)}function Jn(i){return Le(new Date,i)}function Vc(i,e){let t=$f(e),n=new Date;switch(i){case"today":return __(n,t);case"week":return $P(n,t);case"month":return zP(n,t);default:return __(n,t)}}function __(i,e){let t=pb(i,e),n=gb(i,e);return{start:t,end:n,label:"\uC624\uB298"}}function $P(i,e){let t=i.getDay(),n=t===0?6:t-1,s=new Date(i);s.setDate(s.getDate()-n);let r=new Date(s);return r.setDate(r.getDate()+6),{start:pb(s,e),end:gb(r,e),label:"\uC774\uBC88 \uC8FC"}}function zP(i,e){let t=new Date(i.getFullYear(),i.getMonth(),1),n=new Date(i.getFullYear(),i.getMonth()+1,0);return{start:pb(t,e),end:gb(n,e),label:"\uC774\uBC88 \uB2EC"}}function pb(i,e){let t=new Date(i);return t.setHours(0,0,0,0),t}function gb(i,e){let t=new Date(i);return t.setHours(23,59,59,999),t}function R_(i,e){return i>=e.start&&i<=e.end}function mb(i){let e=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);let n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e.getTime()-n.getTime())/864e5+1)/7)}function I_(i,e,t){let n=$f(t);switch(i){case"today":return`${Le(e,n)} \uC77C\uC77C \uD68C\uACE0.md`;case"week":let s=mb(e);return`${e.getFullYear()}-W${String(s).padStart(2,"0")} \uC8FC\uAC04 \uD68C\uACE0.md`;case"month":return`${Le(e,n).substring(0,7)} \uC6D4\uAC04 \uD68C\uACE0.md`;default:return`${Le(e,n)} \uD68C\uACE0.md`}}function D_(i){let t=new Date().getTime()-i.getTime(),n=Math.floor(t/(1e3*60)),s=Math.floor(t/(1e3*60*60)),r=Math.floor(t/(1e3*60*60*24));return n<1?"\uBC29\uAE08 \uC804":n<60?`${n}\uBD84 \uC804`:s<24?`${s}\uC2DC\uAC04 \uC804`:r===1?"\uC5B4\uC81C":r<7?`${r}\uC77C \uC804`:r<30?`${Math.floor(r/7)}\uC8FC \uC804`:`${Math.floor(r/30)}\uAC1C\uC6D4 \uC804`}var yb=4,P_="https://aistudio.google.com/app/apikey",zf={basic:{autoWatch:!1,ocrEnabled:!0,embeddingEnabled:!1,ragEnabled:!1,calendarEnabled:!1,scheduleDetectionEnabled:!1,googleCalendarEnabled:!1,showMiniCalendar:!1},power:{autoWatch:!0,ocrEnabled:!0,embeddingEnabled:!0,ragEnabled:!0,calendarEnabled:!0,scheduleDetectionEnabled:!0,googleCalendarEnabled:!1,showMiniCalendar:!0},experimental:{autoWatch:!0,ocrEnabled:!0,embeddingEnabled:!0,ragEnabled:!0,calendarEnabled:!0,scheduleDetectionEnabled:!0,googleCalendarEnabled:!1,showMiniCalendar:!0},custom:{}},_t={basic:{icon:"\u{1F680}",label:"\uAE30\uBCF8 \uBAA8\uB4DC",shortDesc:"\uBD84\uB958 + URL \uC694\uC57D",longDesc:`\uB178\uD2B8 \uBD84\uB958 + URL \uC694\uC57D
\uAC00\uBCCD\uAC8C \uC2DC\uC791\uD558\uAE30 \uC88B\uC544\uC694`},power:{icon:"\u{1F4AA}",label:"\uD30C\uC6CC \uBAA8\uB4DC (\uAD8C\uC7A5)",shortDesc:"\uC804\uCCB4 \uAE30\uB2A5",longDesc:`\uC804\uCCB4 \uAE30\uB2A5 \uD65C\uC131\uD654
Embedding, RAG \uCC57\uBD07, \uCE98\uB9B0\uB354`},experimental:{icon:"\u{1F9EA}",label:"\uC2E4\uD5D8 \uBAA8\uB4DC",shortDesc:"Beta \uD3EC\uD568",longDesc:`Beta \uAE30\uB2A5 \uD3EC\uD568
\uC0C8\uB85C\uC6B4 \uAE30\uB2A5\uC744 \uBA3C\uC800 \uCCB4\uD5D8`},custom:{icon:"\u2699\uFE0F",label:"\uC0AC\uC6A9\uC790 \uC815\uC758",shortDesc:"\uC9C1\uC811 \uC124\uC815",longDesc:"\uAC1C\uBCC4 \uC124\uC815\uC744 \uC9C1\uC811 \uC870\uC815\uD569\uB2C8\uB2E4"}},qf=["geminiApiKey","googleAccessToken","googleRefreshToken","googleClientId","googleClientSecret","googleTokenExpiry","inboxFolder","projectsFolder","libraryFolder","archivesFolder","zettelFolder","dailyNotesFolder","ocrOriginalFolder","timezone","dateFormat","zkIdType","onboardingCompleted","lastNotifiedVersion","language"];var Wf=class extends z.PluginSettingTab{constructor(t,n){super(t,n);this.showAdvancedSettings=!1;this.plugin=n}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Zero Friction Brain \uC124\uC815"}),t.createEl("h3",{text:"\uBE60\uB978 \uC2DC\uC791"});let n=this.plugin.settings.preset||"custom";new z.Setting(t).setName("\uC124\uC815 \uD504\uB9AC\uC14B").setDesc("\uC0AC\uC6A9 \uD328\uD134\uC5D0 \uB9DE\uB294 \uD504\uB9AC\uC14B\uC744 \uC120\uD0DD\uD558\uC138\uC694").addDropdown(o=>o.addOption("basic",`${_t.basic.icon} ${_t.basic.label}`).addOption("power",`${_t.power.icon} ${_t.power.label}`).addOption("experimental",`${_t.experimental.icon} ${_t.experimental.label}`).addOption("custom",`${_t.custom.icon} ${_t.custom.label}`).setValue(n).onChange(async a=>{let l=a;l!=="custom"?(this.applyPreset(l),new z.Notice(`${_t[l].icon} ${_t[l].label} \uC801\uC6A9\uB428`)):(this.plugin.settings.preset="custom",await this.plugin.saveSettings()),this.display()}));let s=t.createDiv({cls:"zfb-preset-description"});if(this.renderPresetDescription(s,n),n!=="custom"&&(new z.Setting(t).setName("\uACE0\uAE09 \uC124\uC815 \uD45C\uC2DC").setDesc("\uC138\uBD80 \uC124\uC815\uC744 \uC9C1\uC811 \uC870\uC815\uD569\uB2C8\uB2E4").addToggle(o=>o.setValue(this.showAdvancedSettings).onChange(a=>{this.showAdvancedSettings=a,this.display()})),!this.showAdvancedSettings))return;if(t.createEl("hr"),t.createEl("h3",{text:"API \uC124\uC815"}),new z.Setting(t).setName("Gemini API \uD0A4").setDesc(createFragment(o=>{o.appendText("Gemini API \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694. "),o.createEl("a",{text:"API \uD0A4 \uBC1C\uAE09\uBC1B\uAE30",href:"https://aistudio.google.com/apikey"})})).addText(o=>o.setPlaceholder("AIzaSy...").setValue(this.plugin.settings.geminiApiKey).onChange(async a=>{this.plugin.settings.geminiApiKey=a,await this.plugin.saveSettings()})),t.createEl("h3",{text:"\uD3F4\uB354 \uC124\uC815"}),new z.Setting(t).setName("Inbox \uD3F4\uB354").setDesc("\uC0C8 \uB178\uD2B8\uAC00 \uC800\uC7A5\uB418\uB294 \uD3F4\uB354").addText(o=>o.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.inboxFolder).onChange(async a=>{this.plugin.settings.inboxFolder=a,await this.plugin.saveSettings()})),new z.Setting(t).setName("Projects \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uBCC4 \uD558\uC704 \uD3F4\uB354\uAC00 \uC0DD\uC131\uB429\uB2C8\uB2E4").addText(o=>o.setPlaceholder("01 Projects").setValue(this.plugin.settings.projectsFolder).onChange(async a=>{this.plugin.settings.projectsFolder=a,await this.plugin.saveSettings()})),new z.Setting(t).setName("Library \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uC5D0 \uC18D\uD558\uC9C0 \uC54A\uB294 \uCC38\uACE0 \uC790\uB8CC").addText(o=>o.setPlaceholder("02 Library").setValue(this.plugin.settings.libraryFolder).onChange(async a=>{this.plugin.settings.libraryFolder=a,await this.plugin.saveSettings()})),new z.Setting(t).setName("Archives \uD3F4\uB354").setDesc("\uC644\uB8CC\uB41C \uD504\uB85C\uC81D\uD2B8 (\uD1B5\uC9F8\uB85C \uC774\uB3D9)").addText(o=>o.setPlaceholder("03 Archives").setValue(this.plugin.settings.archivesFolder).onChange(async a=>{this.plugin.settings.archivesFolder=a,await this.plugin.saveSettings()})),new z.Setting(t).setName("Zettelkasten \uD3F4\uB354").setDesc("ZK \uC601\uAD6C \uB178\uD2B8 \uC800\uC7A5 \uC704\uCE58").addText(o=>o.setPlaceholder("10 Zettelkasten").setValue(this.plugin.settings.zettelFolder).onChange(async a=>{this.plugin.settings.zettelFolder=a,await this.plugin.saveSettings()})),new z.Setting(t).setName("\uD3F4\uB354 \uAD6C\uC870 \uC0DD\uC131").setDesc("\uC704\uC5D0 \uC124\uC815\uB41C \uD3F4\uB354\uB4E4\uC744 \uC790\uB3D9\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4").addButton(o=>o.setButtonText("\uD3F4\uB354 \uC0DD\uC131").setCta().onClick(async()=>{await this.createFolderStructure()})),t.createEl("h3",{text:"\uC635\uC158"}),new z.Setting(t).setName("Inbox \uC790\uB3D9 \uAC10\uC2DC").setDesc("Inbox \uD3F4\uB354\uC758 \uD30C\uC77C\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC2DC\uD558\uC5EC \uBD84\uB958").addToggle(o=>o.setValue(this.plugin.settings.autoWatch).onChange(async a=>{this.plugin.settings.autoWatch=a,await this.plugin.saveSettings(),a?this.plugin.startWatcher():this.plugin.stopWatcher()})),new z.Setting(t).setName("\uD2B8\uB9AC\uAC70 \uD0DC\uADF8").setDesc("\uC774 \uD0DC\uADF8\uAC00 \uC788\uB294 \uB178\uD2B8\uB9CC \uC790\uB3D9 \uBD84\uB958 (\uC608: #\uC644\uB8CC)").addText(o=>o.setPlaceholder("#\uC644\uB8CC").setValue(this.plugin.settings.triggerTag).onChange(async a=>{this.plugin.settings.triggerTag=a,await this.plugin.saveSettings()})),t.createEl("h3",{text:"OCR \uC124\uC815"}),new z.Setting(t).setName("OCR \uAE30\uB2A5 \uD65C\uC131\uD654").setDesc("\uC774\uBBF8\uC9C0 \uBC0F PDF\uC5D0\uC11C \uD14D\uC2A4\uD2B8 \uCD94\uCD9C").addToggle(o=>o.setValue(this.plugin.settings.ocrEnabled).onChange(async a=>{this.plugin.settings.ocrEnabled=a,await this.plugin.saveSettings()})),new z.Setting(t).setName("OCR \uD6C4 \uC6D0\uBCF8 \uC774\uB3D9").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC744 \uC9C0\uC815 \uD3F4\uB354\uB85C \uC774\uB3D9").addToggle(o=>o.setValue(this.plugin.settings.ocrMoveOriginal).onChange(async a=>{this.plugin.settings.ocrMoveOriginal=a,await this.plugin.saveSettings()})),new z.Setting(t).setName("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uD3F4\uB354").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC774 \uC774\uB3D9\uB420 \uD3F4\uB354").addText(o=>o.setPlaceholder("03 Archives/OCR_\uC6D0\uBCF8").setValue(this.plugin.settings.ocrOriginalFolder).onChange(async a=>{this.plugin.settings.ocrOriginalFolder=a,await this.plugin.saveSettings()})),t.createEl("h3",{text:"OCR \uC81C\uD55C (API \uC694\uAE08 \uBCF4\uD638)"}),new z.Setting(t).setName("\uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").setDesc("\uD55C \uBC88\uC5D0 \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 PDF \uD398\uC774\uC9C0 \uC218").addSlider(o=>o.setLimits(1,100,1).setValue(this.plugin.settings.ocrMaxPages).setDynamicTooltip().onChange(async a=>{this.plugin.settings.ocrMaxPages=a,await this.plugin.saveSettings()})).addExtraButton(o=>o.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (20)").onClick(async()=>{this.plugin.settings.ocrMaxPages=20,await this.plugin.saveSettings(),this.display()})),new z.Setting(t).setName("\uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30 (MB)").setDesc("\uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30").addSlider(o=>o.setLimits(1,50,1).setValue(this.plugin.settings.ocrMaxFileSizeMB).setDynamicTooltip().onChange(async a=>{this.plugin.settings.ocrMaxFileSizeMB=a,await this.plugin.saveSettings()})).addExtraButton(o=>o.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (10)").onClick(async()=>{this.plugin.settings.ocrMaxFileSizeMB=10,await this.plugin.saveSettings(),this.display()})),new z.Setting(t).setName("\uC77C\uC77C \uCC98\uB9AC \uD55C\uB3C4 (\uD398\uC774\uC9C0)").setDesc("\uD558\uB8E8\uC5D0 OCR \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").addSlider(o=>o.setLimits(10,500,10).setValue(this.plugin.settings.ocrDailyLimit).setDynamicTooltip().onChange(async a=>{this.plugin.settings.ocrDailyLimit=a,await this.plugin.saveSettings()})).addExtraButton(o=>o.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (50)").onClick(async()=>{this.plugin.settings.ocrDailyLimit=50,await this.plugin.saveSettings(),this.display()})),t.createDiv({cls:"ocr-usage-info"}).createEl("p",{text:`\uC624\uB298 \uC0AC\uC6A9\uB7C9: ${this.plugin.getOCRDailyUsage().pagesProcessed}/${this.plugin.settings.ocrDailyLimit} \uD398\uC774\uC9C0`,cls:"setting-item-description"}),t.createEl("h3",{text:"Zettelkasten \uC124\uC815"}),new z.Setting(t).setName("ZK \uB178\uD2B8 ID \uD615\uC2DD").setDesc("ZK \uB178\uD2B8 \uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uD560 ID \uD615\uC2DD").addDropdown(o=>o.addOption("timestamp","\uD0C0\uC784\uC2A4\uD0EC\uD504 (1735789200000)").addOption("date-sequence","\uB0A0\uC9DC+\uC21C\uBC88 (20260102-001)").addOption("luhmann","\uB8E8\uB9CC \uC2A4\uD0C0\uC77C (1a1b)").setValue(this.plugin.settings.zkIdType).onChange(async a=>{this.plugin.settings.zkIdType=a,await this.plugin.saveSettings()})),new z.Setting(t).setName("\uC720\uC0AC \uB178\uD2B8 \uBCD1\uD569 \uC784\uACC4\uAC12").setDesc("\uC774 \uAC12 \uC774\uC0C1\uC758 \uC720\uC0AC\uB3C4\uB97C \uAC00\uC9C4 \uB178\uD2B8\uAC00 \uC788\uC73C\uBA74 \uBCD1\uD569 \uC81C\uC548 (0.5~1.0)").addSlider(o=>o.setLimits(.5,1,.05).setValue(this.plugin.settings.zkMergeThreshold).setDynamicTooltip().onChange(async a=>{this.plugin.settings.zkMergeThreshold=a,await this.plugin.saveSettings()})).addExtraButton(o=>o.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (0.8)").onClick(async()=>{this.plugin.settings.zkMergeThreshold=.8,await this.plugin.saveSettings(),this.display()})),t.createEl("h3",{text:"\uC2DC\uAC04\uB300 \uBC0F \uB0A0\uC9DC \uD615\uC2DD"}),new z.Setting(t).setName("\uC2DC\uAC04\uB300").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504\uC5D0 \uC0AC\uC6A9\uD560 \uC2DC\uAC04\uB300").addDropdown(o=>{T_.forEach(a=>{o.addOption(a.value,a.label)}),o.setValue(this.plugin.settings.timezone).onChange(async a=>{this.plugin.settings.timezone=a,await this.plugin.saveSettings()})}),new z.Setting(t).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504 \uD45C\uC2DC \uD615\uC2DD").addDropdown(o=>{x_.forEach(a=>{o.addOption(a.value,a.label)}),o.setValue(this.plugin.settings.dateFormat).onChange(async a=>{this.plugin.settings.dateFormat=a,await this.plugin.saveSettings()})}),t.createEl("h3",{text:"\uC77C\uC815 \uAC10\uC9C0"}),new z.Setting(t).setName("\uC77C\uC815 \uC790\uB3D9 \uAC10\uC9C0").setDesc("\uB178\uD2B8 \uBD84\uB958 \uC2DC \uC77C\uC815/\uD560\uC77C/\uC57D\uC18D\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC9C0").addToggle(o=>o.setValue(this.plugin.settings.scheduleDetectionEnabled).onChange(async a=>{this.plugin.settings.scheduleDetectionEnabled=a,await this.plugin.saveSettings()})),new z.Setting(t).setName("Daily Notes \uD3F4\uB354").setDesc("\uC77C\uC815\uC774 \uC800\uC7A5\uB420 Daily Notes \uD3F4\uB354").addText(o=>o.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.dailyNotesFolder).onChange(async a=>{this.plugin.settings.dailyNotesFolder=a,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Google Calendar \uC5F0\uB3D9"}),new z.Setting(t).setName("Google Calendar \uD65C\uC131\uD654").setDesc("\uC77C\uC815\uC744 Google Calendar\uC5D0\uB3C4 \uC800\uC7A5\uD569\uB2C8\uB2E4").addToggle(o=>o.setValue(this.plugin.settings.googleCalendarEnabled).onChange(async a=>{this.plugin.settings.googleCalendarEnabled=a,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.googleCalendarEnabled){let o=!!this.plugin.settings.googleRefreshToken,a=o?"\uC5F0\uACB0\uB428 \u2713":"\uC5F0\uACB0 \uC548\uB428";if(new z.Setting(t).setName("Google \uACC4\uC815").setDesc(a).addButton(l=>l.setButtonText(o?"\uC7AC\uC5F0\uACB0":"\uC5F0\uACB0\uD558\uAE30").setCta().onClick(async()=>{await this.plugin.connectGoogleCalendar()})).addButton(l=>(o&&l.setButtonText("\uC5F0\uACB0 \uD574\uC81C").onClick(async()=>{await this.plugin.disconnectGoogleCalendar(),this.display()}),l)),new z.Setting(t).setName("\uC790\uCCB4 API \uD0A4 \uC0AC\uC6A9 (Advanced)").setDesc("\uC9C1\uC811 Google Cloud Console\uC5D0\uC11C \uC0DD\uC131\uD55C Client ID\uB97C \uC0AC\uC6A9\uD569\uB2C8\uB2E4").addToggle(l=>l.setValue(this.plugin.settings.useOwnApiKey).onChange(async c=>{this.plugin.settings.useOwnApiKey=c,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.useOwnApiKey){new z.Setting(t).setName("Google Client ID").setDesc("Google Cloud Console\uC5D0\uC11C \uC0DD\uC131\uD55C OAuth 2.0 Client ID").addText(c=>c.setPlaceholder("xxxxx.apps.googleusercontent.com").setValue(this.plugin.settings.googleClientId).onChange(async d=>{this.plugin.settings.googleClientId=d,await this.plugin.saveSettings()})),new z.Setting(t).setName("Google Client Secret").setDesc("OAuth 2.0 Client Secret").addText(c=>c.setPlaceholder("GOCSPX-...").setValue(this.plugin.settings.googleClientSecret).onChange(async d=>{this.plugin.settings.googleClientSecret=d,await this.plugin.saveSettings()}));let l=t.createDiv({cls:"setting-item-description"});l.createEl("p",{text:"Google Cloud Console\uC5D0\uC11C OAuth 2.0 \uD074\uB77C\uC774\uC5B8\uD2B8 ID\uB97C \uC0DD\uC131\uD558\uC138\uC694:"}),l.createEl("a",{text:"Google Cloud Console \uC5F4\uAE30",href:"https://console.cloud.google.com/apis/credentials"}),l.createEl("p",{text:"\uB9AC\uB514\uB809\uC158 URI: http://127.0.0.1:42813/callback",cls:"setting-item-description"}).style.fontFamily="monospace"}}if(t.createEl("h3",{text:"\uCE98\uB9B0\uB354 \uBDF0"}),new z.Setting(t).setName("\uCE98\uB9B0\uB354 \uBDF0 \uD65C\uC131\uD654").setDesc("\uB178\uD2B8, \uC77C\uC815, \uD68C\uC758\uB85D\uC744 \uCE98\uB9B0\uB354\uB85C \uD655\uC778\uD569\uB2C8\uB2E4").addToggle(o=>o.setValue(this.plugin.settings.calendarEnabled).onChange(async a=>{this.plugin.settings.calendarEnabled=a,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.calendarEnabled&&(new z.Setting(t).setName("\uAE30\uBCF8 \uBDF0").setDesc("\uCE98\uB9B0\uB354\uB97C \uC5F4 \uB54C \uAE30\uBCF8\uC73C\uB85C \uD45C\uC2DC\uD560 \uBDF0").addDropdown(o=>o.addOption("month","\uC6D4\uAC04").addOption("week","\uC8FC\uAC04").addOption("day","\uC77C\uAC04").addOption("list","\uBAA9\uB85D").setValue(this.plugin.settings.calendarDefaultView).onChange(async a=>{this.plugin.settings.calendarDefaultView=a,await this.plugin.saveSettings()})),new z.Setting(t).setName("\uC8FC \uC2DC\uC791\uC77C").setDesc("\uCE98\uB9B0\uB354\uC758 \uCCAB \uBC88\uC9F8 \uC694\uC77C").addDropdown(o=>o.addOption("0","\uC77C\uC694\uC77C").addOption("1","\uC6D4\uC694\uC77C").setValue(String(this.plugin.settings.calendarFirstDayOfWeek)).onChange(async a=>{this.plugin.settings.calendarFirstDayOfWeek=parseInt(a),await this.plugin.saveSettings()})),new z.Setting(t).setName("\uC0AC\uC774\uB4DC\uBC14 \uBBF8\uB2C8 \uCE98\uB9B0\uB354").setDesc("\uC624\uB978\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uBBF8\uB2C8 \uCE98\uB9B0\uB354\uB97C \uD45C\uC2DC\uD569\uB2C8\uB2E4").addToggle(o=>o.setValue(this.plugin.settings.showMiniCalendar).onChange(async a=>{this.plugin.settings.showMiniCalendar=a,await this.plugin.saveSettings(),a&&await this.plugin.toggleMiniCalendar()})),new z.Setting(t).setName("\uCE98\uB9B0\uB354 \uC5F4\uAE30").setDesc("Ctrl+Shift+C \uB610\uB294 \uB9AC\uBCF8 \uC544\uC774\uCF58\uC73C\uB85C\uB3C4 \uC5F4 \uC218 \uC788\uC2B5\uB2C8\uB2E4").addButton(o=>o.setButtonText("\uCE98\uB9B0\uB354 \uC5F4\uAE30").setCta().onClick(async()=>{await this.plugin.openCalendarView()}))),t.createEl("h3",{text:"Embedding \uAE30\uBC18 \uAC80\uC0C9 (Beta)"}),new z.Setting(t).setName("Embedding \uD65C\uC131\uD654").setDesc(createFragment(o=>{o.appendText("\uD0A4\uC6CC\uB4DC \uB300\uC2E0 \uC758\uBBF8 \uAE30\uBC18 \uC720\uC0AC\uB3C4\uB85C \uAD00\uB828 \uB178\uD2B8\uB97C \uCC3E\uC2B5\uB2C8\uB2E4. "),o.createEl("br"),o.appendText("\uD65C\uC131\uD654 \uC2DC \uBAA8\uB4E0 \uB178\uD2B8\uC758 \uC784\uBCA0\uB529\uC744 \uC0DD\uC131\uD569\uB2C8\uB2E4 (\uC2DC\uAC04\uC774 \uAC78\uB9B4 \uC218 \uC788\uC74C).")})).addToggle(o=>o.setValue(this.plugin.settings.embeddingEnabled).onChange(async a=>{this.plugin.settings.embeddingEnabled=a,await this.plugin.saveSettings(),this.display(),a&&(new z.Notice("Embedding \uC778\uB371\uC2A4 \uAD6C\uCD95\uC744 \uC2DC\uC791\uD569\uB2C8\uB2E4..."),this.plugin.embeddingManager&&(await this.plugin.embeddingManager.buildFullIndex((l,c,d)=>{(l%10===0||l===c)&&new z.Notice(`Embedding: ${l}/${c}`)}),new z.Notice("Embedding \uC778\uB371\uC2A4 \uAD6C\uCD95 \uC644\uB8CC!")))})),this.plugin.settings.embeddingEnabled){if(new z.Setting(t).setName("\uC720\uC0AC\uB3C4 \uC784\uACC4\uAC12").setDesc("\uC774 \uAC12 \uC774\uC0C1\uC758 \uC720\uC0AC\uB3C4\uB97C \uAC00\uC9C4 \uB178\uD2B8\uB9CC \uCD94\uCC9C\uD569\uB2C8\uB2E4 (0.5~0.95)").addSlider(o=>o.setLimits(.5,.95,.05).setValue(this.plugin.settings.embeddingSimilarityThreshold).setDynamicTooltip().onChange(async a=>{this.plugin.settings.embeddingSimilarityThreshold=a,await this.plugin.saveSettings()})).addExtraButton(o=>o.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (0.7)").onClick(async()=>{this.plugin.settings.embeddingSimilarityThreshold=.7,await this.plugin.saveSettings(),this.display()})),this.plugin.embeddingManager){let o=this.plugin.embeddingManager.getStats(),a=t.createDiv({cls:"embedding-stats-info"});a.createEl("p",{text:`\uC778\uB371\uC2F1\uB41C \uB178\uD2B8: ${o.totalNotes}\uAC1C`,cls:"setting-item-description"}),o.lastFullScan&&a.createEl("p",{text:`\uB9C8\uC9C0\uB9C9 \uC804\uCCB4 \uC2A4\uCE94: ${new Date(o.lastFullScan).toLocaleString()}`,cls:"setting-item-description"})}new z.Setting(t).setName("\uC778\uB371\uC2A4 \uC7AC\uAD6C\uCD95").setDesc("\uBAA8\uB4E0 \uB178\uD2B8\uC758 \uC784\uBCA0\uB529\uC744 \uB2E4\uC2DC \uC0DD\uC131\uD569\uB2C8\uB2E4 (\uC2DC\uAC04\uC774 \uAC78\uB9B4 \uC218 \uC788\uC74C)").addButton(o=>o.setButtonText("\uC7AC\uAD6C\uCD95").onClick(async()=>{if(this.plugin.embeddingManager){new z.Notice("Embedding \uC778\uB371\uC2A4 \uC7AC\uAD6C\uCD95 \uC2DC\uC791..."),await this.plugin.embeddingManager.clearIndex();let a=await this.plugin.embeddingManager.buildFullIndex((l,c)=>{(l%10===0||l===c)&&new z.Notice(`Embedding: ${l}/${c}`)});new z.Notice(`\uC7AC\uAD6C\uCD95 \uC644\uB8CC! \uC131\uACF5: ${a.success}, \uC2A4\uD0B5: ${a.skipped}, \uC2E4\uD328: ${a.failed}`),this.display()}})),new z.Setting(t).setName("\uC0AD\uC81C\uB41C \uD30C\uC77C \uC784\uBCA0\uB529 \uC815\uB9AC").setDesc("\uC0AD\uC81C\uB41C \uB178\uD2B8\uC758 \uC784\uBCA0\uB529\uC744 \uC815\uB9AC\uD569\uB2C8\uB2E4").addButton(o=>o.setButtonText("\uC815\uB9AC").onClick(async()=>{if(this.plugin.embeddingManager){let a=await this.plugin.embeddingManager.cleanupOrphanedEmbeddings();new z.Notice(`${a}\uAC1C\uC758 \uBBF8\uC0AC\uC6A9 \uC784\uBCA0\uB529\uC774 \uC815\uB9AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4`),this.display()}}))}t.createEl("h3",{text:"RAG \uCC57\uBD07"}),new z.Setting(t).setName("RAG \uCC57\uBD07 \uD65C\uC131\uD654").setDesc(createFragment(o=>{o.appendText("\uB178\uD2B8 \uAE30\uBC18 Q&A \uCC57\uBD07\uC744 \uD65C\uC131\uD654\uD569\uB2C8\uB2E4. "),o.createEl("br"),o.appendText("Embedding\uC774 \uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC5B4\uC57C \uD569\uB2C8\uB2E4.")})).addToggle(o=>o.setValue(this.plugin.settings.ragEnabled).setDisabled(!this.plugin.settings.embeddingEnabled).onChange(async a=>{this.plugin.settings.ragEnabled=a,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.embeddingEnabled||t.createDiv({cls:"setting-item-description"}).createEl("p",{text:"\u26A0\uFE0F RAG \uCC57\uBD07\uC744 \uC0AC\uC6A9\uD558\uB824\uBA74 \uBA3C\uC800 Embedding\uC744 \uD65C\uC131\uD654\uD558\uC138\uC694.",cls:"mod-warning"}),this.plugin.settings.ragEnabled&&this.plugin.settings.embeddingEnabled&&(new z.Setting(t).setName("\uAC80\uC0C9\uD560 \uB178\uD2B8 \uC218 (Top-K)").setDesc("\uC9C8\uBB38\uACFC \uAD00\uB828\uB41C \uB178\uD2B8\uB97C \uBA87 \uAC1C\uAE4C\uC9C0 \uAC80\uC0C9\uD560\uC9C0 \uC124\uC815\uD569\uB2C8\uB2E4").addSlider(o=>o.setLimits(1,10,1).setValue(this.plugin.settings.ragTopK).setDynamicTooltip().onChange(async a=>{this.plugin.settings.ragTopK=a,await this.plugin.saveSettings()})).addExtraButton(o=>o.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (5)").onClick(async()=>{this.plugin.settings.ragTopK=5,await this.plugin.saveSettings(),this.display()})),new z.Setting(t).setName("\uCEE8\uD14D\uC2A4\uD2B8 \uCD5C\uB300 \uAE38\uC774").setDesc("AI\uC5D0\uAC8C \uC804\uB2EC\uD560 \uB178\uD2B8 \uB0B4\uC6A9\uC758 \uCD5C\uB300 \uAE00\uC790 \uC218 (1000~10000)").addSlider(o=>o.setLimits(1e3,1e4,500).setValue(this.plugin.settings.ragMaxContextLength).setDynamicTooltip().onChange(async a=>{this.plugin.settings.ragMaxContextLength=a,await this.plugin.saveSettings()})).addExtraButton(o=>o.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (4000)").onClick(async()=>{this.plugin.settings.ragMaxContextLength=4e3,await this.plugin.saveSettings(),this.display()})),new z.Setting(t).setName("\uCC57\uBD07 \uC5F4\uAE30").setDesc("Ctrl+Shift+' \uB610\uB294 \uB9AC\uBCF8 \uC544\uC774\uCF58\uC73C\uB85C\uB3C4 \uC5F4 \uC218 \uC788\uC2B5\uB2C8\uB2E4").addButton(o=>o.setButtonText("\uCC57\uBD07 \uC5F4\uAE30").setCta().onClick(async()=>{await this.plugin.toggleChatbot()})))}async createFolderStructure(){let t=[this.plugin.settings.inboxFolder,this.plugin.settings.projectsFolder,this.plugin.settings.libraryFolder,this.plugin.settings.archivesFolder,this.plugin.settings.zettelFolder],n=0,s=0;for(let r of t){if(!r)continue;if(this.app.vault.getAbstractFileByPath(r))s++;else try{await this.app.vault.createFolder(r),n++}catch(a){console.error(`\uD3F4\uB354 \uC0DD\uC131 \uC2E4\uD328: ${r}`,a)}}n>0?new z.Notice(`${n}\uAC1C \uD3F4\uB354 \uC0DD\uC131\uB428, ${s}\uAC1C \uC774\uBBF8 \uC874\uC7AC`):new z.Notice(`\uBAA8\uB4E0 \uD3F4\uB354\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4 (${s}\uAC1C)`)}renderPresetDescription(t,n){t.empty();let s=_t[n],r=t.createDiv({cls:"preset-desc-content"});r.createEl("strong",{text:`${s.icon} ${s.label}`});let o=r.createDiv({cls:"preset-details"});switch(n){case"basic":o.innerHTML=`
					<p>\uD575\uC2EC \uAE30\uB2A5\uB9CC \uD65C\uC131\uD654\uD558\uC5EC \uAC00\uBCCD\uAC8C \uC2DC\uC791\uD569\uB2C8\uB2E4.</p>
					<ul>
						<li>\u2705 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 (Ctrl+Shift+G)</li>
						<li>\u2705 URL \uC694\uC57D (Ctrl+Shift+U)</li>
						<li>\u2705 OCR \uCD94\uCD9C (Ctrl+Shift+O)</li>
						<li>\u274C Embedding/RAG \uCC57\uBD07</li>
						<li>\u274C \uCE98\uB9B0\uB354/\uC77C\uC815 \uAC10\uC9C0</li>
					</ul>
				`;break;case"power":o.innerHTML=`
					<p>\uC804\uCCB4 \uAE30\uB2A5\uC744 \uD65C\uC131\uD654\uD569\uB2C8\uB2E4. (\uAD8C\uC7A5)</p>
					<ul>
						<li>\u2705 \uBAA8\uB4E0 \uAE30\uBCF8 \uAE30\uB2A5</li>
						<li>\u2705 Embedding \uAE30\uBC18 \uAC80\uC0C9</li>
						<li>\u2705 RAG \uCC57\uBD07</li>
						<li>\u2705 \uCE98\uB9B0\uB354 \uBDF0</li>
						<li>\u2705 \uC77C\uC815 \uC790\uB3D9 \uAC10\uC9C0</li>
					</ul>
				`;break;case"experimental":o.innerHTML=`
					<p>Beta \uAE30\uB2A5\uC744 \uD3EC\uD568\uD55C \uC804\uCCB4 \uAE30\uB2A5\uC744 \uD65C\uC131\uD654\uD569\uB2C8\uB2E4.</p>
					<ul>
						<li>\u2705 \uBAA8\uB4E0 \uD30C\uC6CC \uBAA8\uB4DC \uAE30\uB2A5</li>
						<li>\u{1F9EA} \uC0C8\uB85C\uC6B4 \uC2E4\uD5D8 \uAE30\uB2A5</li>
					</ul>
				`;break;default:o.innerHTML="<p>\uAC1C\uBCC4 \uC124\uC815\uC744 \uC9C1\uC811 \uC870\uC815\uD569\uB2C8\uB2E4.</p>"}}async applyPreset(t){this.plugin.settings.preset=t;let n=zf[t];for(let[s,r]of Object.entries(n))qf.includes(s)||(this.plugin.settings[s]=r);await this.plugin.saveSettings()}};var qP,WP;function YP(){return{geminiUrl:qP,vertexUrl:WP}}function KP(i,e,t,n){var s,r;if(!(i!=null&&i.baseUrl)){let o=YP();return e?(s=o.vertexUrl)!==null&&s!==void 0?s:t:(r=o.geminiUrl)!==null&&r!==void 0?r:n}return i.baseUrl}var _n=class{};function O(i,e){let t=/\{([^}]+)\}/g;return i.replace(t,(n,s)=>{if(Object.prototype.hasOwnProperty.call(e,s)){let r=e[s];return r!=null?String(r):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function g(i,e,t){for(let r=0;r<e.length-1;r++){let o=e[r];if(o.endsWith("[]")){let a=o.slice(0,-2);if(!(a in i))if(Array.isArray(t))i[a]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(i[a])){let l=i[a];if(Array.isArray(t))for(let c=0;c<l.length;c++){let d=l[c];g(d,e.slice(r+1),t[c])}else for(let c of l)g(c,e.slice(r+1),t)}return}else if(o.endsWith("[0]")){let a=o.slice(0,-3);a in i||(i[a]=[{}]);let l=i[a];g(l[0],e.slice(r+1),t);return}(!i[o]||typeof i[o]!="object")&&(i[o]={}),i=i[o]}let n=e[e.length-1],s=i[n];if(s!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===s)return;if(typeof s=="object"&&typeof t=="object"&&s!==null&&t!==null)Object.assign(s,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(i,t):i[n]=t}function f(i,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return i;for(let n=0;n<e.length;n++){if(typeof i!="object"||i===null)return t;let s=e[n];if(s.endsWith("[]")){let r=s.slice(0,-2);if(r in i){let o=i[r];return Array.isArray(o)?o.map(a=>f(a,e.slice(n+1),t)):t}else return t}else i=i[s]}return i}catch(n){if(n instanceof TypeError)return t;throw n}}function JP(i,e){for(let[t,n]of Object.entries(e)){let s=t.split("."),r=n.split("."),o=new Set,a=-1;for(let l=0;l<s.length;l++)if(s[l]==="*"){a=l;break}if(a!==-1&&r.length>a)for(let l=a;l<r.length;l++){let c=r[l];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&o.add(c)}Eb(i,s,r,0,o)}}function Eb(i,e,t,n,s){if(n>=e.length||typeof i!="object"||i===null)return;let r=e[n];if(r.endsWith("[]")){let o=r.slice(0,-2),a=i;if(o in a&&Array.isArray(a[o]))for(let l of a[o])Eb(l,e,t,n+1,s)}else if(r==="*"){if(typeof i=="object"&&i!==null&&!Array.isArray(i)){let o=i,a=Object.keys(o).filter(c=>!c.startsWith("_")&&!s.has(c)),l={};for(let c of a)l[c]=o[c];for(let[c,d]of Object.entries(l)){let h=[];for(let p of t.slice(n))p==="*"?h.push(c):h.push(p);g(o,h,d)}for(let c of a)delete o[c]}}else{let o=i;r in o&&Eb(o[r],e,t,n+1,s)}}function vE(i){if(typeof i!="string")throw new Error("fromImageBytes must be a string");return i}function XP(i){let e={},t=f(i,["operationName"]);t!=null&&g(e,["operationName"],t);let n=f(i,["resourceName"]);return n!=null&&g(e,["_url","resourceName"],n),e}function ZP(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response","generateVideoResponse"]);return o!=null&&g(e,["response"],QP(o)),e}function jP(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],eM(o)),e}function QP(i){let e={},t=f(i,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>tM(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function eM(i){let e={},t=f(i,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>nM(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function tM(i){let e={},t=f(i,["video"]);return t!=null&&g(e,["video"],lM(t)),e}function nM(i){let e={},t=f(i,["_self"]);return t!=null&&g(e,["video"],cM(t)),e}function iM(i){let e={},t=f(i,["operationName"]);return t!=null&&g(e,["_url","operationName"],t),e}function sM(i){let e={},t=f(i,["operationName"]);return t!=null&&g(e,["_url","operationName"],t),e}function rM(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],oM(o)),e}function oM(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["parent"]);n!=null&&g(e,["parent"],n);let s=f(i,["documentName"]);return s!=null&&g(e,["documentName"],s),e}function t0(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],aM(o)),e}function aM(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["parent"]);n!=null&&g(e,["parent"],n);let s=f(i,["documentName"]);return s!=null&&g(e,["documentName"],s),e}function lM(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["uri"],t);let n=f(i,["encodedVideo"]);n!=null&&g(e,["videoBytes"],vE(n));let s=f(i,["encoding"]);return s!=null&&g(e,["mimeType"],s),e}function cM(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["uri"],t);let n=f(i,["bytesBase64Encoded"]);n!=null&&g(e,["videoBytes"],vE(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}var M_;(function(i){i.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",i.OUTCOME_OK="OUTCOME_OK",i.OUTCOME_FAILED="OUTCOME_FAILED",i.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(M_||(M_={}));var k_;(function(i){i.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",i.PYTHON="PYTHON"})(k_||(k_={}));var N_;(function(i){i.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",i.SILENT="SILENT",i.WHEN_IDLE="WHEN_IDLE",i.INTERRUPT="INTERRUPT"})(N_||(N_={}));var bs;(function(i){i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.STRING="STRING",i.NUMBER="NUMBER",i.INTEGER="INTEGER",i.BOOLEAN="BOOLEAN",i.ARRAY="ARRAY",i.OBJECT="OBJECT",i.NULL="NULL"})(bs||(bs={}));var F_;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(F_||(F_={}));var L_;(function(i){i.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",i.SIMPLE_SEARCH="SIMPLE_SEARCH",i.ELASTIC_SEARCH="ELASTIC_SEARCH"})(L_||(L_={}));var O_;(function(i){i.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",i.NO_AUTH="NO_AUTH",i.API_KEY_AUTH="API_KEY_AUTH",i.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",i.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",i.OAUTH="OAUTH",i.OIDC_AUTH="OIDC_AUTH"})(O_||(O_={}));var U_;(function(i){i.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",i.HTTP_IN_QUERY="HTTP_IN_QUERY",i.HTTP_IN_HEADER="HTTP_IN_HEADER",i.HTTP_IN_PATH="HTTP_IN_PATH",i.HTTP_IN_BODY="HTTP_IN_BODY",i.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(U_||(U_={}));var H_;(function(i){i.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",i.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",i.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",i.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(H_||(H_={}));var B_;(function(i){i.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH",i.MINIMAL="MINIMAL"})(B_||(B_={}));var G_;(function(i){i.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",i.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",i.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",i.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",i.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",i.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",i.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",i.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",i.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(G_||(G_={}));var V_;(function(i){i.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",i.SEVERITY="SEVERITY",i.PROBABILITY="PROBABILITY"})(V_||(V_={}));var $_;(function(i){i.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",i.OFF="OFF"})($_||($_={}));var z_;(function(i){i.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",i.STOP="STOP",i.MAX_TOKENS="MAX_TOKENS",i.SAFETY="SAFETY",i.RECITATION="RECITATION",i.LANGUAGE="LANGUAGE",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.SPII="SPII",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.IMAGE_SAFETY="IMAGE_SAFETY",i.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",i.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",i.NO_IMAGE="NO_IMAGE",i.IMAGE_RECITATION="IMAGE_RECITATION",i.IMAGE_OTHER="IMAGE_OTHER"})(z_||(z_={}));var q_;(function(i){i.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH"})(q_||(q_={}));var W_;(function(i){i.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",i.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",i.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",i.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",i.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(W_||(W_={}));var Y_;(function(i){i.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",i.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",i.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",i.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",i.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Y_||(Y_={}));var K_;(function(i){i.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",i.SAFETY="SAFETY",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.IMAGE_SAFETY="IMAGE_SAFETY",i.MODEL_ARMOR="MODEL_ARMOR",i.JAILBREAK="JAILBREAK"})(K_||(K_={}));var J_;(function(i){i.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",i.ON_DEMAND="ON_DEMAND",i.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(J_||(J_={}));var ep;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.AUDIO="AUDIO"})(ep||(ep={}));var X_;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(X_||(X_={}));var Z_;(function(i){i.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",i.TUNING_MODE_FULL="TUNING_MODE_FULL",i.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Z_||(Z_={}));var j_;(function(i){i.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",i.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",i.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",i.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",i.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",i.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",i.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(j_||(j_={}));var wb;(function(i){i.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",i.JOB_STATE_QUEUED="JOB_STATE_QUEUED",i.JOB_STATE_PENDING="JOB_STATE_PENDING",i.JOB_STATE_RUNNING="JOB_STATE_RUNNING",i.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",i.JOB_STATE_FAILED="JOB_STATE_FAILED",i.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",i.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",i.JOB_STATE_PAUSED="JOB_STATE_PAUSED",i.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",i.JOB_STATE_UPDATING="JOB_STATE_UPDATING",i.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(wb||(wb={}));var Q_;(function(i){i.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",i.TUNING_TASK_I2V="TUNING_TASK_I2V",i.TUNING_TASK_T2V="TUNING_TASK_T2V",i.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Q_||(Q_={}));var eT;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",i.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(eT||(eT={}));var tT;(function(i){i.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",i.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",i.BALANCED="BALANCED",i.PRIORITIZE_COST="PRIORITIZE_COST"})(tT||(tT={}));var nT;(function(i){i.UNSPECIFIED="UNSPECIFIED",i.BLOCKING="BLOCKING",i.NON_BLOCKING="NON_BLOCKING"})(nT||(nT={}));var iT;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(iT||(iT={}));var sT;(function(i){i.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",i.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(sT||(sT={}));var rT;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.AUTO="AUTO",i.ANY="ANY",i.NONE="NONE",i.VALIDATED="VALIDATED"})(rT||(rT={}));var oT;(function(i){i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE"})(oT||(oT={}));var aT;(function(i){i.DONT_ALLOW="DONT_ALLOW",i.ALLOW_ADULT="ALLOW_ADULT",i.ALLOW_ALL="ALLOW_ALL"})(aT||(aT={}));var lT;(function(i){i.auto="auto",i.en="en",i.ja="ja",i.ko="ko",i.hi="hi",i.zh="zh",i.pt="pt",i.es="es"})(lT||(lT={}));var cT;(function(i){i.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",i.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",i.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",i.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",i.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(cT||(cT={}));var dT;(function(i){i.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",i.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",i.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",i.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(dT||(dT={}));var uT;(function(i){i.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",i.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",i.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",i.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(uT||(uT={}));var hT;(function(i){i.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",i.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",i.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",i.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",i.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",i.EDIT_MODE_STYLE="EDIT_MODE_STYLE",i.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",i.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(hT||(hT={}));var fT;(function(i){i.FOREGROUND="FOREGROUND",i.BACKGROUND="BACKGROUND",i.PROMPT="PROMPT",i.SEMANTIC="SEMANTIC",i.INTERACTIVE="INTERACTIVE"})(fT||(fT={}));var pT;(function(i){i.ASSET="ASSET",i.STYLE="STYLE"})(pT||(pT={}));var gT;(function(i){i.INSERT="INSERT",i.REMOVE="REMOVE",i.REMOVE_STATIC="REMOVE_STATIC",i.OUTPAINT="OUTPAINT"})(gT||(gT={}));var mT;(function(i){i.OPTIMIZED="OPTIMIZED",i.LOSSLESS="LOSSLESS"})(mT||(mT={}));var yT;(function(i){i.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",i.PREFERENCE_TUNING="PREFERENCE_TUNING"})(yT||(yT={}));var vT;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.STATE_PENDING="STATE_PENDING",i.STATE_ACTIVE="STATE_ACTIVE",i.STATE_FAILED="STATE_FAILED"})(vT||(vT={}));var bT;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.PROCESSING="PROCESSING",i.ACTIVE="ACTIVE",i.FAILED="FAILED"})(bT||(bT={}));var ET;(function(i){i.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",i.UPLOADED="UPLOADED",i.GENERATED="GENERATED"})(ET||(ET={}));var wT;(function(i){i.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.RESPONSE_REJECTED="RESPONSE_REJECTED",i.NEED_MORE_INPUT="NEED_MORE_INPUT"})(wT||(wT={}));var ST;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.VIDEO="VIDEO",i.AUDIO="AUDIO",i.DOCUMENT="DOCUMENT"})(ST||(ST={}));var AT;(function(i){i.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",i.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",i.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(AT||(AT={}));var CT;(function(i){i.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",i.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",i.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(CT||(CT={}));var _T;(function(i){i.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",i.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",i.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(_T||(_T={}));var TT;(function(i){i.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",i.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",i.NO_INTERRUPTION="NO_INTERRUPTION"})(TT||(TT={}));var xT;(function(i){i.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",i.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",i.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(xT||(xT={}));var RT;(function(i){i.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",i.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",i.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",i.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",i.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",i.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",i.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",i.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",i.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",i.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",i.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",i.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",i.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(RT||(RT={}));var IT;(function(i){i.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",i.QUALITY="QUALITY",i.DIVERSITY="DIVERSITY",i.VOCALIZATION="VOCALIZATION"})(IT||(IT={}));var Sa;(function(i){i.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",i.PLAY="PLAY",i.PAUSE="PAUSE",i.STOP="STOP",i.RESET_CONTEXT="RESET_CONTEXT"})(Sa||(Sa={}));var qc=class{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var Cr=class{get text(){var e,t,n,s,r,o,a,l;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",d=!1,h=[];for(let p of(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[m,y]of Object.entries(p))m!=="text"&&m!=="thought"&&m!=="thoughtSignature"&&(y!==null||y!==void 0)&&h.push(m);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;d=!0,c+=p.text}}return h.length>0&&console.warn(`there are non-text parts ${h} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?c:void 0}get data(){var e,t,n,s,r,o,a,l;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="",d=[];for(let h of(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[p,m]of Object.entries(h))p!=="inlineData"&&(m!==null||m!==void 0)&&d.push(p);h.inlineData&&typeof h.inlineData.data=="string"&&(c+=atob(h.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,t,n,s,r,o,a,l;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let c=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,t,n,s,r,o,a,l,c;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let d=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(h=>h.executableCode).map(h=>h.executableCode).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,t,n,s,r,o,a,l,c;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let d=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(h=>h.codeExecutionResult).map(h=>h.codeExecutionResult).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.output}},tp=class{},np=class{},Sb=class{},Ab=class{},Cb=class{},_b=class{},ip=class{},sp=class{},rp=class{},Tb=class{};var op=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,s,r=e;return t?s=jP(r):s=ZP(r),Object.assign(n,s),n}},ap=class{},lp=class{},cp=class{},dp=class{},xb=class{},Rb=class{},Ib=class{};var Db=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,r=rM(e);return Object.assign(n,r),n}},Pb=class{},Mb=class{},kb=class{};var up=class{};var Nb=class{get text(){var e,t,n;let s="",r=!1,o=[];for(let a of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[l,c]of Object.entries(a))l!=="text"&&l!=="thought"&&c!==null&&o.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;r=!0,s+=a.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?s:void 0}get data(){var e,t,n;let s="",r=[];for(let o of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[a,l]of Object.entries(o))a!=="inlineData"&&l!==null&&r.push(a);o.inlineData&&typeof o.inlineData.data=="string"&&(s+=atob(o.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}};var Fb=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var Lb=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,r=t0(e);return Object.assign(n,r),n}};function ce(i,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(i.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function n0(i,e){let t=ce(i,e);return t?t.startsWith("publishers/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}`:t.startsWith("models/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/publishers/google/${t}`:t:""}function i0(i){return Array.isArray(i)?i.map(e=>hp(e)):[hp(i)]}function hp(i){if(typeof i=="object"&&i!==null)return i;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof i}`)}function s0(i){let e=hp(i);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function r0(i){let e=hp(i);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function DT(i){if(i==null)throw new Error("PartUnion is required");if(typeof i=="object")return i;if(typeof i=="string")return{text:i};throw new Error(`Unsupported part type: ${typeof i}`)}function o0(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("PartListUnion is required");return Array.isArray(i)?i.map(e=>DT(e)):[DT(i)]}function Ob(i){return i!=null&&typeof i=="object"&&"parts"in i&&Array.isArray(i.parts)}function PT(i){return i!=null&&typeof i=="object"&&"functionCall"in i}function MT(i){return i!=null&&typeof i=="object"&&"functionResponse"in i}function at(i){if(i==null)throw new Error("ContentUnion is required");return Ob(i)?i:{role:"user",parts:o0(i)}}function bE(i,e){if(!e)return[];if(i.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let n=at(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(i.isVertexAI()){let t=at(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>at(t)):[at(e)]}function ln(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("contents are required");if(!Array.isArray(i)){if(PT(i)||MT(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[at(i)]}let e=[],t=[],n=Ob(i[0]);for(let s of i){let r=Ob(s);if(r!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(s);else{if(PT(s)||MT(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(s)}}return n||e.push({role:"user",parts:o0(t)}),e}function dM(i,e){i.includes("null")&&(e.nullable=!0);let t=i.filter(n=>n!=="null");if(t.length===1)e.type=Object.values(bs).includes(t[0].toUpperCase())?t[0].toUpperCase():bs.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let n of t)e.anyOf.push({type:Object.values(bs).includes(n.toUpperCase())?n.toUpperCase():bs.TYPE_UNSPECIFIED})}}function Aa(i){let e={},t=["items"],n=["anyOf"],s=["properties"];if(i.type&&i.anyOf)throw new Error("type and anyOf cannot be both populated.");let r=i.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,i=r[1]):r[1].type==="null"&&(e.nullable=!0,i=r[0])),i.type instanceof Array&&dM(i.type,e);for(let[o,a]of Object.entries(i))if(a!=null)if(o=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(bs).includes(a.toUpperCase())?a.toUpperCase():bs.TYPE_UNSPECIFIED}else if(t.includes(o))e[o]=Aa(a);else if(n.includes(o)){let l=[];for(let c of a){if(c.type=="null"){e.nullable=!0;continue}l.push(Aa(c))}e[o]=l}else if(s.includes(o)){let l={};for(let[c,d]of Object.entries(a))l[c]=Aa(d);e[o]=l}else{if(o==="additionalProperties")continue;e[o]=a}return e}function EE(i){return Aa(i)}function wE(i){if(typeof i=="object")return i;if(typeof i=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:i}}};throw new Error(`Unsupported speechConfig type: ${typeof i}`)}function SE(i){if("multiSpeakerVoiceConfig"in i)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return i}function xa(i){if(i.functionDeclarations)for(let e of i.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Aa(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Aa(e.response));return i}function Ra(i){if(i==null)throw new Error("tools is required");if(!Array.isArray(i))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of i)e.push(t);return e}function uM(i,e,t,n=1){let s=!e.startsWith(`${t}/`)&&e.split("/").length===n;return i.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${i.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}`:s?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}/${e}`:e:s?`${t}/${e}`:e}function Pi(i,e){if(typeof e!="string")throw new Error("name must be a string");return uM(i,e,"cachedContents")}function a0(i){switch(i){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return i}}function Es(i){return vE(i)}function hM(i){return i!=null&&typeof i=="object"&&"name"in i}function fM(i){return i!=null&&typeof i=="object"&&"video"in i}function pM(i){return i!=null&&typeof i=="object"&&"uri"in i}function l0(i){var e;let t;if(hM(i)&&(t=i.name),!(pM(i)&&(t=i.uri,t===void 0))&&!(fM(i)&&(t=(e=i.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof i=="string"&&(t=i),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let s=t.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${t}`);t=s[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function c0(i,e){let t;return i.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function d0(i){for(let e of["models","tunedModels","publisherModels"])if(gM(i,e))return i[e];return[]}function gM(i,e){return i!==null&&typeof i=="object"&&e in i}function mM(i,e={}){let t=i,n={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(n.responseJsonSchema=t.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function yM(i,e={}){let t=[],n=new Set;for(let s of i){let r=s.name;if(n.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);n.add(r);let o=mM(s,e);o.functionDeclarations&&t.push(...o.functionDeclarations)}return{functionDeclarations:t}}function u0(i,e){let t;if(typeof e=="string")if(i.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(i.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let n=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,s=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(i.isVertexAI()){if(s>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||s!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function vM(i){if(typeof i!="string")return i;let e=i;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function h0(i){if(typeof i!="object"||i===null)return{};let e=i,t=e.inlinedResponses;if(typeof t!="object"||t===null)return i;let s=t.inlinedResponses;if(!Array.isArray(s)||s.length===0)return i;let r=!1;for(let o of s){if(typeof o!="object"||o===null)continue;let l=o.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),i}function Ia(i,e){let t=e;if(!i.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function f0(i){let e=i;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function bM(i){let e={},t=f(i,["responsesFile"]);t!=null&&g(e,["fileName"],t);let n=f(i,["inlinedResponses","inlinedResponses"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>QM(o))),g(e,["inlinedResponses"],r)}let s=f(i,["inlinedEmbedContentResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["inlinedEmbedContentResponses"],r)}return e}function EM(i){let e={},t=f(i,["predictionsFormat"]);t!=null&&g(e,["format"],t);let n=f(i,["gcsDestination","outputUriPrefix"]);n!=null&&g(e,["gcsUri"],n);let s=f(i,["bigqueryDestination","outputUri"]);return s!=null&&g(e,["bigqueryUri"],s),e}function wM(i){let e={},t=f(i,["format"]);t!=null&&g(e,["predictionsFormat"],t);let n=f(i,["gcsUri"]);n!=null&&g(e,["gcsDestination","outputUriPrefix"],n);let s=f(i,["bigqueryUri"]);if(s!=null&&g(e,["bigqueryDestination","outputUri"],s),f(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(i,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(f(i,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function jf(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata","displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["metadata","state"]);s!=null&&g(e,["state"],f0(s));let r=f(i,["metadata","createTime"]);r!=null&&g(e,["createTime"],r);let o=f(i,["metadata","endTime"]);o!=null&&g(e,["endTime"],o);let a=f(i,["metadata","updateTime"]);a!=null&&g(e,["updateTime"],a);let l=f(i,["metadata","model"]);l!=null&&g(e,["model"],l);let c=f(i,["metadata","output"]);return c!=null&&g(e,["dest"],bM(h0(c))),e}function Ub(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["state"]);s!=null&&g(e,["state"],f0(s));let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["createTime"]);o!=null&&g(e,["createTime"],o);let a=f(i,["startTime"]);a!=null&&g(e,["startTime"],a);let l=f(i,["endTime"]);l!=null&&g(e,["endTime"],l);let c=f(i,["updateTime"]);c!=null&&g(e,["updateTime"],c);let d=f(i,["model"]);d!=null&&g(e,["model"],d);let h=f(i,["inputConfig"]);h!=null&&g(e,["src"],SM(h));let p=f(i,["outputConfig"]);p!=null&&g(e,["dest"],EM(h0(p)));let m=f(i,["completionStats"]);return m!=null&&g(e,["completionStats"],m),e}function SM(i){let e={},t=f(i,["instancesFormat"]);t!=null&&g(e,["format"],t);let n=f(i,["gcsSource","uris"]);n!=null&&g(e,["gcsUri"],n);let s=f(i,["bigquerySource","inputUri"]);return s!=null&&g(e,["bigqueryUri"],s),e}function AM(i,e){let t={};if(f(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(f(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let n=f(e,["fileName"]);n!=null&&g(t,["fileName"],n);let s=f(e,["inlinedRequests"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>jM(i,o))),g(t,["requests","requests"],r)}return t}function CM(i){let e={},t=f(i,["format"]);t!=null&&g(e,["instancesFormat"],t);let n=f(i,["gcsUri"]);n!=null&&g(e,["gcsSource","uris"],n);let s=f(i,["bigqueryUri"]);if(s!=null&&g(e,["bigquerySource","inputUri"],s),f(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(i,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function _M(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function TM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ia(i,n)),t}function xM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ia(i,n)),t}function RM(i){let e={},t=f(i,["content"]);t!=null&&g(e,["content"],t);let n=f(i,["citationMetadata"]);n!=null&&g(e,["citationMetadata"],IM(n));let s=f(i,["tokenCount"]);s!=null&&g(e,["tokenCount"],s);let r=f(i,["finishReason"]);r!=null&&g(e,["finishReason"],r);let o=f(i,["avgLogprobs"]);o!=null&&g(e,["avgLogprobs"],o);let a=f(i,["groundingMetadata"]);a!=null&&g(e,["groundingMetadata"],a);let l=f(i,["index"]);l!=null&&g(e,["index"],l);let c=f(i,["logprobsResult"]);c!=null&&g(e,["logprobsResult"],c);let d=f(i,["safetyRatings"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>m)),g(e,["safetyRatings"],p)}let h=f(i,["urlContextMetadata"]);return h!=null&&g(e,["urlContextMetadata"],h),e}function IM(i){let e={},t=f(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),g(e,["citations"],n)}return e}function p0(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>ok(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function DM(i,e){let t={},n=f(i,["displayName"]);if(e!==void 0&&n!=null&&g(e,["batch","displayName"],n),f(i,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function PM(i,e){let t={},n=f(i,["displayName"]);e!==void 0&&n!=null&&g(e,["displayName"],n);let s=f(i,["dest"]);return e!==void 0&&s!=null&&g(e,["outputConfig"],wM(vM(s))),t}function kT(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["src"]);s!=null&&g(t,["batch","inputConfig"],AM(i,u0(i,s)));let r=f(e,["config"]);return r!=null&&DM(r,t),t}function MM(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["model"],ce(i,n));let s=f(e,["src"]);s!=null&&g(t,["inputConfig"],CM(u0(i,s)));let r=f(e,["config"]);return r!=null&&PM(r,t),t}function kM(i,e){let t={},n=f(i,["displayName"]);return e!==void 0&&n!=null&&g(e,["batch","displayName"],n),t}function NM(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["src"]);s!=null&&g(t,["batch","inputConfig"],GM(i,s));let r=f(e,["config"]);return r!=null&&kM(r,t),t}function FM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ia(i,n)),t}function LM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ia(i,n)),t}function OM(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);return r!=null&&g(e,["error"],r),e}function UM(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);return r!=null&&g(e,["error"],r),e}function HM(i,e){let t={},n=f(e,["contents"]);if(n!=null){let r=bE(i,n);Array.isArray(r)&&(r=r.map(o=>o)),g(t,["requests[]","request","content"],r)}let s=f(e,["config"]);return s!=null&&(g(t,["_self"],BM(s,t)),JP(t,{"requests[].*":"requests[].request.*"})),t}function BM(i,e){let t={},n=f(i,["taskType"]);e!==void 0&&n!=null&&g(e,["requests[]","taskType"],n);let s=f(i,["title"]);e!==void 0&&s!=null&&g(e,["requests[]","title"],s);let r=f(i,["outputDimensionality"]);if(e!==void 0&&r!=null&&g(e,["requests[]","outputDimensionality"],r),f(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function GM(i,e){let t={},n=f(e,["fileName"]);n!=null&&g(t,["file_name"],n);let s=f(e,["inlinedRequests"]);return s!=null&&g(t,["requests"],HM(i,s)),t}function VM(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function $M(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function zM(i){let e={},t=f(i,["mode"]);t!=null&&g(e,["mode"],t);let n=f(i,["allowedFunctionNames"]);if(n!=null&&g(e,["allowedFunctionNames"],n),f(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function qM(i,e,t){let n={},s=f(e,["systemInstruction"]);t!==void 0&&s!=null&&g(t,["systemInstruction"],p0(at(s)));let r=f(e,["temperature"]);r!=null&&g(n,["temperature"],r);let o=f(e,["topP"]);o!=null&&g(n,["topP"],o);let a=f(e,["topK"]);a!=null&&g(n,["topK"],a);let l=f(e,["candidateCount"]);l!=null&&g(n,["candidateCount"],l);let c=f(e,["maxOutputTokens"]);c!=null&&g(n,["maxOutputTokens"],c);let d=f(e,["stopSequences"]);d!=null&&g(n,["stopSequences"],d);let h=f(e,["responseLogprobs"]);h!=null&&g(n,["responseLogprobs"],h);let p=f(e,["logprobs"]);p!=null&&g(n,["logprobs"],p);let m=f(e,["presencePenalty"]);m!=null&&g(n,["presencePenalty"],m);let y=f(e,["frequencyPenalty"]);y!=null&&g(n,["frequencyPenalty"],y);let v=f(e,["seed"]);v!=null&&g(n,["seed"],v);let E=f(e,["responseMimeType"]);E!=null&&g(n,["responseMimeType"],E);let S=f(e,["responseSchema"]);S!=null&&g(n,["responseSchema"],EE(S));let C=f(e,["responseJsonSchema"]);if(C!=null&&g(n,["responseJsonSchema"],C),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let _=f(e,["safetySettings"]);if(t!==void 0&&_!=null){let X=_;Array.isArray(X)&&(X=X.map(Z=>ak(Z))),g(t,["safetySettings"],X)}let T=f(e,["tools"]);if(t!==void 0&&T!=null){let X=Ra(T);Array.isArray(X)&&(X=X.map(Z=>ck(xa(Z)))),g(t,["tools"],X)}let R=f(e,["toolConfig"]);if(t!==void 0&&R!=null&&g(t,["toolConfig"],lk(R)),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let I=f(e,["cachedContent"]);t!==void 0&&I!=null&&g(t,["cachedContent"],Pi(i,I));let D=f(e,["responseModalities"]);D!=null&&g(n,["responseModalities"],D);let k=f(e,["mediaResolution"]);k!=null&&g(n,["mediaResolution"],k);let N=f(e,["speechConfig"]);if(N!=null&&g(n,["speechConfig"],wE(N)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=f(e,["thinkingConfig"]);F!=null&&g(n,["thinkingConfig"],F);let U=f(e,["imageConfig"]);U!=null&&g(n,["imageConfig"],ZM(U));let re=f(e,["enableEnhancedCivicAnswers"]);return re!=null&&g(n,["enableEnhancedCivicAnswers"],re),n}function WM(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>RM(c))),g(e,["candidates"],l)}let s=f(i,["modelVersion"]);s!=null&&g(e,["modelVersion"],s);let r=f(i,["promptFeedback"]);r!=null&&g(e,["promptFeedback"],r);let o=f(i,["responseId"]);o!=null&&g(e,["responseId"],o);let a=f(i,["usageMetadata"]);return a!=null&&g(e,["usageMetadata"],a),e}function YM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ia(i,n)),t}function KM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ia(i,n)),t}function JM(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function XM(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function ZM(i){let e={},t=f(i,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);let n=f(i,["imageSize"]);if(n!=null&&g(e,["imageSize"],n),f(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function jM(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["request","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let a=ln(s);Array.isArray(a)&&(a=a.map(l=>p0(l))),g(t,["request","contents"],a)}let r=f(e,["metadata"]);r!=null&&g(t,["metadata"],r);let o=f(e,["config"]);return o!=null&&g(t,["request","generationConfig"],qM(i,o,f(t,["request"],{}))),t}function QM(i){let e={},t=f(i,["response"]);t!=null&&g(e,["response"],WM(t));let n=f(i,["error"]);return n!=null&&g(e,["error"],n),e}function ek(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);if(e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),f(i,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function tk(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);e!==void 0&&s!=null&&g(e,["_query","pageToken"],s);let r=f(i,["filter"]);return e!==void 0&&r!=null&&g(e,["_query","filter"],r),t}function nk(i){let e={},t=f(i,["config"]);return t!=null&&ek(t,e),e}function ik(i){let e={},t=f(i,["config"]);return t!=null&&tk(t,e),e}function sk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["operations"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>jf(o))),g(e,["batchJobs"],r)}return e}function rk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["batchPredictionJobs"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>Ub(o))),g(e,["batchJobs"],r)}return e}function ok(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],VM(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],$M(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],_M(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function ak(i){let e={},t=f(i,["category"]);if(t!=null&&g(e,["category"],t),f(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=f(i,["threshold"]);return n!=null&&g(e,["threshold"],n),e}function lk(i){let e={},t=f(i,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],zM(t));let n=f(i,["retrievalConfig"]);return n!=null&&g(e,["retrievalConfig"],n),e}function ck(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],JM(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],XM(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}var Ii;(function(i){i.PAGED_ITEM_BATCH_JOBS="batchJobs",i.PAGED_ITEM_MODELS="models",i.PAGED_ITEM_TUNING_JOBS="tuningJobs",i.PAGED_ITEM_FILES="files",i.PAGED_ITEM_CACHED_CONTENTS="cachedContents",i.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",i.PAGED_ITEM_DOCUMENTS="documents"})(Ii||(Ii={}));var Di=class{constructor(e,t,n,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,s)}init(e,t,n){var s,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};!n||Object.keys(n).length===0?o={config:{}}:typeof n=="object"?o=Object.assign({},n):o=n,o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(r=(s=o.config)===null||s===void 0?void 0:s.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var Hb=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Di(Ii.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){let t=kT(this.apiClient,e),n=t._url,s=O("{model}:batchGenerateContent",n),a=t.batch.inputConfig.requests,l=a.requests,c=[];for(let d of l){let h=Object.assign({},d);if(h.systemInstruction){let p=h.systemInstruction;delete h.systemInstruction;let m=h.request;m.systemInstruction=p,h.request=m}c.push(h)}return a.requests=c,delete t.config,delete t._url,delete t._query,{path:s,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},s=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${s}`),n.dest===void 0){let r=this.getGcsUri(e),o=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?n.dest=`${r.slice(0,-6)}/dest`:n.dest=`${r}_dest_${s}`;else if(o)n.dest=`${o}_dest_${s}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=MM(this.apiClient,e);return a=O("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>Ub(d))}else{let c=kT(this.apiClient,e);return a=O("{model}:batchGenerateContent",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>jf(d))}}async createEmbeddingsInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=NM(this.apiClient,e);return r=O("{model}:asyncBatchEmbedContent",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>jf(l))}}async get(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=KM(this.apiClient,e);return a=O("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>Ub(d))}else{let c=YM(this.apiClient,e);return a=O("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>jf(d))}}async cancel(e){var t,n,s,r;let o="",a={};if(this.apiClient.isVertexAI()){let l=xM(this.apiClient,e);o=O("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{let l=TM(this.apiClient,e);o=O("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=ik(e);return a=O("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=rk(d),p=new up;return Object.assign(p,h),p})}else{let c=nk(e);return a=O("batches",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=sk(d),p=new up;return Object.assign(p,h),p})}}async delete(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=LM(this.apiClient,e);return a=O("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>UM(d))}else{let c=FM(this.apiClient,e);return a=O("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>OM(d))}}};function dk(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function NT(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>kk(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function uk(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);e!==void 0&&s!=null&&g(e,["expireTime"],s);let r=f(i,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);let o=f(i,["contents"]);if(e!==void 0&&o!=null){let d=ln(o);Array.isArray(d)&&(d=d.map(h=>NT(h))),g(e,["contents"],d)}let a=f(i,["systemInstruction"]);e!==void 0&&a!=null&&g(e,["systemInstruction"],NT(at(a)));let l=f(i,["tools"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(h=>Fk(h))),g(e,["tools"],d)}let c=f(i,["toolConfig"]);if(e!==void 0&&c!=null&&g(e,["toolConfig"],Nk(c)),f(i,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function hk(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);e!==void 0&&s!=null&&g(e,["expireTime"],s);let r=f(i,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);let o=f(i,["contents"]);if(e!==void 0&&o!=null){let h=ln(o);Array.isArray(h)&&(h=h.map(p=>p)),g(e,["contents"],h)}let a=f(i,["systemInstruction"]);e!==void 0&&a!=null&&g(e,["systemInstruction"],at(a));let l=f(i,["tools"]);if(e!==void 0&&l!=null){let h=l;Array.isArray(h)&&(h=h.map(p=>Lk(p))),g(e,["tools"],h)}let c=f(i,["toolConfig"]);e!==void 0&&c!=null&&g(e,["toolConfig"],c);let d=f(i,["kmsKeyName"]);return e!==void 0&&d!=null&&g(e,["encryption_spec","kmsKeyName"],d),t}function fk(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["model"],n0(i,n));let s=f(e,["config"]);return s!=null&&uk(s,t),t}function pk(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["model"],n0(i,n));let s=f(e,["config"]);return s!=null&&hk(s,t),t}function gk(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Pi(i,n)),t}function mk(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Pi(i,n)),t}function yk(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function vk(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function bk(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function Ek(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function wk(i){let e={},t=f(i,["mode"]);t!=null&&g(e,["mode"],t);let n=f(i,["allowedFunctionNames"]);if(n!=null&&g(e,["allowedFunctionNames"],n),f(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Sk(i){let e={};if(f(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=f(i,["description"]);t!=null&&g(e,["description"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["parameters"]);s!=null&&g(e,["parameters"],s);let r=f(i,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);let o=f(i,["response"]);o!=null&&g(e,["response"],o);let a=f(i,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function Ak(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Pi(i,n)),t}function Ck(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Pi(i,n)),t}function _k(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function Tk(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function xk(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function Rk(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function Ik(i){let e={},t=f(i,["config"]);return t!=null&&xk(t,e),e}function Dk(i){let e={},t=f(i,["config"]);return t!=null&&Rk(t,e),e}function Pk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["cachedContents"],r)}return e}function Mk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["cachedContents"],r)}return e}function kk(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],bk(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],Ek(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],dk(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function Nk(i){let e={},t=f(i,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],wk(t));let n=f(i,["retrievalConfig"]);return n!=null&&g(e,["retrievalConfig"],n),e}function Fk(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],_k(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],Tk(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function Lk(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(p=>Sk(p))),g(e,["functionDeclarations"],h)}let n=f(i,["retrieval"]);n!=null&&g(e,["retrieval"],n);let s=f(i,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);let r=f(i,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=f(i,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);let a=f(i,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);let l=f(i,["googleMaps"]);l!=null&&g(e,["googleMaps"],l);let c=f(i,["googleSearch"]);c!=null&&g(e,["googleSearch"],c);let d=f(i,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function Ok(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);return e!==void 0&&s!=null&&g(e,["expireTime"],s),t}function Uk(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);return e!==void 0&&s!=null&&g(e,["expireTime"],s),t}function Hk(i,e){let t={},n=f(e,["name"]);n!=null&&g(t,["_url","name"],Pi(i,n));let s=f(e,["config"]);return s!=null&&Ok(s,t),t}function Bk(i,e){let t={},n=f(e,["name"]);n!=null&&g(t,["_url","name"],Pi(i,n));let s=f(e,["config"]);return s!=null&&Uk(s,t),t}var Bb=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Di(Ii.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=pk(this.apiClient,e);return a=O("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let c=fk(this.apiClient,e);return a=O("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async get(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=Ck(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let c=Ak(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async delete(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=mk(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=vk(d),p=new cp;return Object.assign(p,h),p})}else{let c=gk(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=yk(d),p=new cp;return Object.assign(p,h),p})}}async update(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=Bk(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let c=Hk(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=Dk(e);return a=O("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=Mk(d),p=new dp;return Object.assign(p,h),p})}else{let c=Ik(e);return a=O("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=Pk(d),p=new dp;return Object.assign(p,h),p})}}};function fp(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t}function FT(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function J(i){return this instanceof J?(this.v=i,this):new J(i)}function An(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),s,r=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(m){return function(y){return Promise.resolve(y).then(m,h)}}function a(m,y){n[m]&&(s[m]=function(v){return new Promise(function(E,S){r.push([m,v,E,S])>1||l(m,v)})},y&&(s[m]=y(s[m])))}function l(m,y){try{c(n[m](y))}catch(v){p(r[0][3],v)}}function c(m){m.value instanceof J?Promise.resolve(m.value.v).then(d,h):p(r[0][2],m)}function d(m){l("next",m)}function h(m){l("throw",m)}function p(m,y){m(y),r.shift(),r.length&&l(r[0][0],r[0][1])}}function Cn(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof FT=="function"?FT(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=i[r]&&function(o){return new Promise(function(a,l){o=i[r](o),s(a,l,o.done,o.value)})}}function s(r,o,a,l){Promise.resolve(l).then(function(c){r({value:c,done:a})},o)}}function Gk(i){var e;if(i.candidates==null||i.candidates.length===0)return!1;let t=(e=i.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:g0(t)}function g0(i){if(i.parts===void 0||i.parts.length===0)return!1;for(let e of i.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function Vk(i){if(i.length!==0){for(let e of i)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function LT(i){if(i===void 0||i.length===0)return[];let e=[],t=i.length,n=0;for(;n<t;)if(i[n].role==="user")e.push(i[n]),n++;else{let s=[],r=!0;for(;n<t&&i[n].role==="model";)s.push(i[n]),r&&!g0(i[n])&&(r=!1),n++;r?e.push(...s):e.pop()}return e}var Gb=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Vb(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},Vb=class{constructor(e,t,n,s={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=s,this.history=r,this.sendPromise=Promise.resolve(),Vk(r)}async sendMessage(e){var t;await this.sendPromise;let n=at(e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,o,a;let l=await s,c=(o=(r=l.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content,d=l.automaticFunctionCallingHistory,h=this.getHistory(!0).length,p=[];d!=null&&(p=(a=d.slice(h))!==null&&a!==void 0?a:[]);let m=c?[c]:[];this.recordHistory(n,m,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(e){var t;await this.sendPromise;let n=at(e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});let r=await s;return this.processStreamResponse(r,n)}getHistory(e=!1){let t=e?LT(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return An(this,arguments,function*(){var s,r,o,a,l,c;let d=[];try{for(var h=!0,p=Cn(e),m;m=yield J(p.next()),s=m.done,!s;h=!0){a=m.value,h=!1;let y=a;if(Gk(y)){let v=(c=(l=y.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content;v!==void 0&&d.push(v)}yield yield J(y)}}catch(y){r={error:y}}finally{try{!h&&!s&&(o=p.return)&&(yield J(o.call(p)))}finally{if(r)throw r.error}}this.recordHistory(t,d)})}recordHistory(e,t,n){let s=[];t.length>0&&t.every(r=>r.role!==void 0)?s=t:s.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...LT(n)):this.history.push(e),this.history.push(...s)}};var pp=class i extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,i.prototype)}};function $k(i){let e={},t=f(i,["file"]);return t!=null&&g(e,["file"],t),e}function zk(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function qk(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","file"],l0(t)),e}function Wk(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function Yk(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","file"],l0(t)),e}function Kk(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function Jk(i){let e={},t=f(i,["config"]);return t!=null&&Kk(t,e),e}function Xk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["files"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["files"],r)}return e}var $b=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Di(Ii.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Jk(e);return r=O("files",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=Xk(l),d=new Pb;return Object.assign(d,c),d})}}async createInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=$k(e);return r=O("upload/v1beta/files",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=zk(l),d=new Mb;return Object.assign(d,c),d})}}async get(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Yk(e);return r=O("files/{file}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=qk(e);return r=O("files/{file}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=Wk(l),d=new kb;return Object.assign(d,c),d})}}};function Qf(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function Zk(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>fN(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function jk(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function Qk(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function eN(i){let e={};if(f(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=f(i,["description"]);t!=null&&g(e,["description"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["parameters"]);s!=null&&g(e,["parameters"],s);let r=f(i,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);let o=f(i,["response"]);o!=null&&g(e,["response"],o);let a=f(i,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function tN(i){let e={},t=f(i,["modelSelectionConfig"]);t!=null&&g(e,["modelConfig"],t);let n=f(i,["responseJsonSchema"]);n!=null&&g(e,["responseJsonSchema"],n);let s=f(i,["audioTimestamp"]);s!=null&&g(e,["audioTimestamp"],s);let r=f(i,["candidateCount"]);r!=null&&g(e,["candidateCount"],r);let o=f(i,["enableAffectiveDialog"]);o!=null&&g(e,["enableAffectiveDialog"],o);let a=f(i,["frequencyPenalty"]);a!=null&&g(e,["frequencyPenalty"],a);let l=f(i,["logprobs"]);l!=null&&g(e,["logprobs"],l);let c=f(i,["maxOutputTokens"]);c!=null&&g(e,["maxOutputTokens"],c);let d=f(i,["mediaResolution"]);d!=null&&g(e,["mediaResolution"],d);let h=f(i,["presencePenalty"]);h!=null&&g(e,["presencePenalty"],h);let p=f(i,["responseLogprobs"]);p!=null&&g(e,["responseLogprobs"],p);let m=f(i,["responseMimeType"]);m!=null&&g(e,["responseMimeType"],m);let y=f(i,["responseModalities"]);y!=null&&g(e,["responseModalities"],y);let v=f(i,["responseSchema"]);v!=null&&g(e,["responseSchema"],v);let E=f(i,["routingConfig"]);E!=null&&g(e,["routingConfig"],E);let S=f(i,["seed"]);S!=null&&g(e,["seed"],S);let C=f(i,["speechConfig"]);C!=null&&g(e,["speechConfig"],C);let _=f(i,["stopSequences"]);_!=null&&g(e,["stopSequences"],_);let T=f(i,["temperature"]);T!=null&&g(e,["temperature"],T);let R=f(i,["thinkingConfig"]);R!=null&&g(e,["thinkingConfig"],R);let I=f(i,["topK"]);I!=null&&g(e,["topK"],I);let D=f(i,["topP"]);if(D!=null&&g(e,["topP"],D),f(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function nN(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function iN(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function sN(i,e){let t={},n=f(i,["generationConfig"]);e!==void 0&&n!=null&&g(e,["setup","generationConfig"],n);let s=f(i,["responseModalities"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig","responseModalities"],s);let r=f(i,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);let o=f(i,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);let a=f(i,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);let l=f(i,["maxOutputTokens"]);e!==void 0&&l!=null&&g(e,["setup","generationConfig","maxOutputTokens"],l);let c=f(i,["mediaResolution"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","mediaResolution"],c);let d=f(i,["seed"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","seed"],d);let h=f(i,["speechConfig"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","speechConfig"],SE(h));let p=f(i,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);let m=f(i,["enableAffectiveDialog"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=f(i,["systemInstruction"]);e!==void 0&&y!=null&&g(e,["setup","systemInstruction"],Zk(at(y)));let v=f(i,["tools"]);if(e!==void 0&&v!=null){let I=Ra(v);Array.isArray(I)&&(I=I.map(D=>gN(xa(D)))),g(e,["setup","tools"],I)}let E=f(i,["sessionResumption"]);e!==void 0&&E!=null&&g(e,["setup","sessionResumption"],pN(E));let S=f(i,["inputAudioTranscription"]);e!==void 0&&S!=null&&g(e,["setup","inputAudioTranscription"],S);let C=f(i,["outputAudioTranscription"]);e!==void 0&&C!=null&&g(e,["setup","outputAudioTranscription"],C);let _=f(i,["realtimeInputConfig"]);e!==void 0&&_!=null&&g(e,["setup","realtimeInputConfig"],_);let T=f(i,["contextWindowCompression"]);e!==void 0&&T!=null&&g(e,["setup","contextWindowCompression"],T);let R=f(i,["proactivity"]);if(e!==void 0&&R!=null&&g(e,["setup","proactivity"],R),f(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function rN(i,e){let t={},n=f(i,["generationConfig"]);e!==void 0&&n!=null&&g(e,["setup","generationConfig"],tN(n));let s=f(i,["responseModalities"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig","responseModalities"],s);let r=f(i,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);let o=f(i,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);let a=f(i,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);let l=f(i,["maxOutputTokens"]);e!==void 0&&l!=null&&g(e,["setup","generationConfig","maxOutputTokens"],l);let c=f(i,["mediaResolution"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","mediaResolution"],c);let d=f(i,["seed"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","seed"],d);let h=f(i,["speechConfig"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","speechConfig"],SE(h));let p=f(i,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);let m=f(i,["enableAffectiveDialog"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=f(i,["systemInstruction"]);e!==void 0&&y!=null&&g(e,["setup","systemInstruction"],at(y));let v=f(i,["tools"]);if(e!==void 0&&v!=null){let D=Ra(v);Array.isArray(D)&&(D=D.map(k=>mN(xa(k)))),g(e,["setup","tools"],D)}let E=f(i,["sessionResumption"]);e!==void 0&&E!=null&&g(e,["setup","sessionResumption"],E);let S=f(i,["inputAudioTranscription"]);e!==void 0&&S!=null&&g(e,["setup","inputAudioTranscription"],S);let C=f(i,["outputAudioTranscription"]);e!==void 0&&C!=null&&g(e,["setup","outputAudioTranscription"],C);let _=f(i,["realtimeInputConfig"]);e!==void 0&&_!=null&&g(e,["setup","realtimeInputConfig"],_);let T=f(i,["contextWindowCompression"]);e!==void 0&&T!=null&&g(e,["setup","contextWindowCompression"],T);let R=f(i,["proactivity"]);e!==void 0&&R!=null&&g(e,["setup","proactivity"],R);let I=f(i,["explicitVadSignal"]);return e!==void 0&&I!=null&&g(e,["setup","explicitVadSignal"],I),t}function oN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["setup","model"],ce(i,n));let s=f(e,["config"]);return s!=null&&g(t,["config"],sN(s,t)),t}function aN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["setup","model"],ce(i,n));let s=f(e,["config"]);return s!=null&&g(t,["config"],rN(s,t)),t}function lN(i){let e={},t=f(i,["musicGenerationConfig"]);return t!=null&&g(e,["musicGenerationConfig"],t),e}function cN(i){let e={},t=f(i,["weightedPrompts"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),g(e,["weightedPrompts"],n)}return e}function dN(i){let e={},t=f(i,["media"]);if(t!=null){let c=i0(t);Array.isArray(c)&&(c=c.map(d=>Qf(d))),g(e,["mediaChunks"],c)}let n=f(i,["audio"]);n!=null&&g(e,["audio"],Qf(r0(n)));let s=f(i,["audioStreamEnd"]);s!=null&&g(e,["audioStreamEnd"],s);let r=f(i,["video"]);r!=null&&g(e,["video"],Qf(s0(r)));let o=f(i,["text"]);o!=null&&g(e,["text"],o);let a=f(i,["activityStart"]);a!=null&&g(e,["activityStart"],a);let l=f(i,["activityEnd"]);return l!=null&&g(e,["activityEnd"],l),e}function uN(i){let e={},t=f(i,["media"]);if(t!=null){let c=i0(t);Array.isArray(c)&&(c=c.map(d=>d)),g(e,["mediaChunks"],c)}let n=f(i,["audio"]);n!=null&&g(e,["audio"],r0(n));let s=f(i,["audioStreamEnd"]);s!=null&&g(e,["audioStreamEnd"],s);let r=f(i,["video"]);r!=null&&g(e,["video"],s0(r));let o=f(i,["text"]);o!=null&&g(e,["text"],o);let a=f(i,["activityStart"]);a!=null&&g(e,["activityStart"],a);let l=f(i,["activityEnd"]);return l!=null&&g(e,["activityEnd"],l),e}function hN(i){let e={},t=f(i,["setupComplete"]);t!=null&&g(e,["setupComplete"],t);let n=f(i,["serverContent"]);n!=null&&g(e,["serverContent"],n);let s=f(i,["toolCall"]);s!=null&&g(e,["toolCall"],s);let r=f(i,["toolCallCancellation"]);r!=null&&g(e,["toolCallCancellation"],r);let o=f(i,["usageMetadata"]);o!=null&&g(e,["usageMetadata"],yN(o));let a=f(i,["goAway"]);a!=null&&g(e,["goAway"],a);let l=f(i,["sessionResumptionUpdate"]);l!=null&&g(e,["sessionResumptionUpdate"],l);let c=f(i,["voiceActivityDetectionSignal"]);return c!=null&&g(e,["voiceActivityDetectionSignal"],c),e}function fN(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],jk(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],Qk(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],Qf(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function pN(i){let e={},t=f(i,["handle"]);if(t!=null&&g(e,["handle"],t),f(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function gN(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],nN(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],iN(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function mN(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(p=>eN(p))),g(e,["functionDeclarations"],h)}let n=f(i,["retrieval"]);n!=null&&g(e,["retrieval"],n);let s=f(i,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);let r=f(i,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=f(i,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);let a=f(i,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);let l=f(i,["googleMaps"]);l!=null&&g(e,["googleMaps"],l);let c=f(i,["googleSearch"]);c!=null&&g(e,["googleSearch"],c);let d=f(i,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function yN(i){let e={},t=f(i,["promptTokenCount"]);t!=null&&g(e,["promptTokenCount"],t);let n=f(i,["cachedContentTokenCount"]);n!=null&&g(e,["cachedContentTokenCount"],n);let s=f(i,["candidatesTokenCount"]);s!=null&&g(e,["responseTokenCount"],s);let r=f(i,["toolUsePromptTokenCount"]);r!=null&&g(e,["toolUsePromptTokenCount"],r);let o=f(i,["thoughtsTokenCount"]);o!=null&&g(e,["thoughtsTokenCount"],o);let a=f(i,["totalTokenCount"]);a!=null&&g(e,["totalTokenCount"],a);let l=f(i,["promptTokensDetails"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["promptTokensDetails"],m)}let c=f(i,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["cacheTokensDetails"],m)}let d=f(i,["candidatesTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["responseTokensDetails"],m)}let h=f(i,["toolUsePromptTokensDetails"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["toolUsePromptTokensDetails"],m)}let p=f(i,["trafficType"]);return p!=null&&g(e,["trafficType"],p),e}function vN(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function bN(i){let e={},t=f(i,["content"]);t!=null&&g(e,["content"],t);let n=f(i,["citationMetadata"]);n!=null&&g(e,["citationMetadata"],EN(n));let s=f(i,["tokenCount"]);s!=null&&g(e,["tokenCount"],s);let r=f(i,["finishReason"]);r!=null&&g(e,["finishReason"],r);let o=f(i,["avgLogprobs"]);o!=null&&g(e,["avgLogprobs"],o);let a=f(i,["groundingMetadata"]);a!=null&&g(e,["groundingMetadata"],a);let l=f(i,["index"]);l!=null&&g(e,["index"],l);let c=f(i,["logprobsResult"]);c!=null&&g(e,["logprobsResult"],c);let d=f(i,["safetyRatings"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>m)),g(e,["safetyRatings"],p)}let h=f(i,["urlContextMetadata"]);return h!=null&&g(e,["urlContextMetadata"],h),e}function EN(i){let e={},t=f(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),g(e,["citations"],n)}return e}function wN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let r=ln(s);Array.isArray(r)&&(r=r.map(o=>o)),g(t,["contents"],r)}return t}function SN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["tokensInfo"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),g(e,["tokensInfo"],s)}return e}function AN(i){let e={},t=f(i,["values"]);t!=null&&g(e,["values"],t);let n=f(i,["statistics"]);return n!=null&&g(e,["statistics"],CN(n)),e}function CN(i){let e={},t=f(i,["truncated"]);t!=null&&g(e,["truncated"],t);let n=f(i,["token_count"]);return n!=null&&g(e,["tokenCount"],n),e}function Pp(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>kF(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function _N(i){let e={},t=f(i,["controlType"]);t!=null&&g(e,["controlType"],t);let n=f(i,["enableControlImageComputation"]);return n!=null&&g(e,["computeControl"],n),e}function TN(i){let e={};if(f(i,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(f(i,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(f(i,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function xN(i,e){let t={},n=f(i,["systemInstruction"]);e!==void 0&&n!=null&&g(e,["systemInstruction"],at(n));let s=f(i,["tools"]);if(e!==void 0&&s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>b0(a))),g(e,["tools"],o)}let r=f(i,["generationConfig"]);return e!==void 0&&r!=null&&g(e,["generationConfig"],vF(r)),t}function RN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=ln(s);Array.isArray(o)&&(o=o.map(a=>Pp(a))),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&TN(r),t}function IN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=ln(s);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&xN(r,t),t}function DN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["totalTokens"]);n!=null&&g(e,["totalTokens"],n);let s=f(i,["cachedContentTokenCount"]);return s!=null&&g(e,["cachedContentTokenCount"],s),e}function PN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["totalTokens"]);return n!=null&&g(e,["totalTokens"],n),e}function MN(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],ce(i,n)),t}function kN(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],ce(i,n)),t}function NN(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function FN(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function LN(i,e){let t={},n=f(i,["outputGcsUri"]);e!==void 0&&n!=null&&g(e,["parameters","storageUri"],n);let s=f(i,["negativePrompt"]);e!==void 0&&s!=null&&g(e,["parameters","negativePrompt"],s);let r=f(i,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);let o=f(i,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);let a=f(i,["guidanceScale"]);e!==void 0&&a!=null&&g(e,["parameters","guidanceScale"],a);let l=f(i,["seed"]);e!==void 0&&l!=null&&g(e,["parameters","seed"],l);let c=f(i,["safetyFilterLevel"]);e!==void 0&&c!=null&&g(e,["parameters","safetySetting"],c);let d=f(i,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);let h=f(i,["includeSafetyAttributes"]);e!==void 0&&h!=null&&g(e,["parameters","includeSafetyAttributes"],h);let p=f(i,["includeRaiReason"]);e!==void 0&&p!=null&&g(e,["parameters","includeRaiReason"],p);let m=f(i,["language"]);e!==void 0&&m!=null&&g(e,["parameters","language"],m);let y=f(i,["outputMimeType"]);e!==void 0&&y!=null&&g(e,["parameters","outputOptions","mimeType"],y);let v=f(i,["outputCompressionQuality"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","compressionQuality"],v);let E=f(i,["addWatermark"]);e!==void 0&&E!=null&&g(e,["parameters","addWatermark"],E);let S=f(i,["labels"]);e!==void 0&&S!=null&&g(e,["labels"],S);let C=f(i,["editMode"]);e!==void 0&&C!=null&&g(e,["parameters","editMode"],C);let _=f(i,["baseSteps"]);return e!==void 0&&_!=null&&g(e,["parameters","editConfig","baseSteps"],_),t}function ON(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["referenceImages"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>HF(l))),g(t,["instances[0]","referenceImages"],a)}let o=f(e,["config"]);return o!=null&&LN(o,t),t}function UN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>Mp(r))),g(e,["generatedImages"],s)}return e}function HN(i,e){let t={},n=f(i,["taskType"]);e!==void 0&&n!=null&&g(e,["requests[]","taskType"],n);let s=f(i,["title"]);e!==void 0&&s!=null&&g(e,["requests[]","title"],s);let r=f(i,["outputDimensionality"]);if(e!==void 0&&r!=null&&g(e,["requests[]","outputDimensionality"],r),f(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function BN(i,e){let t={},n=f(i,["taskType"]);e!==void 0&&n!=null&&g(e,["instances[]","task_type"],n);let s=f(i,["title"]);e!==void 0&&s!=null&&g(e,["instances[]","title"],s);let r=f(i,["outputDimensionality"]);e!==void 0&&r!=null&&g(e,["parameters","outputDimensionality"],r);let o=f(i,["mimeType"]);e!==void 0&&o!=null&&g(e,["instances[]","mimeType"],o);let a=f(i,["autoTruncate"]);return e!==void 0&&a!=null&&g(e,["parameters","autoTruncate"],a),t}function GN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let a=bE(i,s);Array.isArray(a)&&(a=a.map(l=>l)),g(t,["requests[]","content"],a)}let r=f(e,["config"]);r!=null&&HN(r,t);let o=f(e,["model"]);return o!==void 0&&g(t,["requests[]","model"],ce(i,o)),t}function VN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=bE(i,s);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["instances[]","content"],o)}let r=f(e,["config"]);return r!=null&&BN(r,t),t}function $N(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["embeddings"],r)}let s=f(i,["metadata"]);return s!=null&&g(e,["metadata"],s),e}function zN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions[]","embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>AN(o))),g(e,["embeddings"],r)}let s=f(i,["metadata"]);return s!=null&&g(e,["metadata"],s),e}function qN(i){let e={},t=f(i,["endpoint"]);t!=null&&g(e,["name"],t);let n=f(i,["deployedModelId"]);return n!=null&&g(e,["deployedModelId"],n),e}function WN(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function YN(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function KN(i){let e={},t=f(i,["mode"]);t!=null&&g(e,["mode"],t);let n=f(i,["allowedFunctionNames"]);if(n!=null&&g(e,["allowedFunctionNames"],n),f(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function JN(i){let e={};if(f(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=f(i,["description"]);t!=null&&g(e,["description"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["parameters"]);s!=null&&g(e,["parameters"],s);let r=f(i,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);let o=f(i,["response"]);o!=null&&g(e,["response"],o);let a=f(i,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function XN(i,e,t){let n={},s=f(e,["systemInstruction"]);t!==void 0&&s!=null&&g(t,["systemInstruction"],Pp(at(s)));let r=f(e,["temperature"]);r!=null&&g(n,["temperature"],r);let o=f(e,["topP"]);o!=null&&g(n,["topP"],o);let a=f(e,["topK"]);a!=null&&g(n,["topK"],a);let l=f(e,["candidateCount"]);l!=null&&g(n,["candidateCount"],l);let c=f(e,["maxOutputTokens"]);c!=null&&g(n,["maxOutputTokens"],c);let d=f(e,["stopSequences"]);d!=null&&g(n,["stopSequences"],d);let h=f(e,["responseLogprobs"]);h!=null&&g(n,["responseLogprobs"],h);let p=f(e,["logprobs"]);p!=null&&g(n,["logprobs"],p);let m=f(e,["presencePenalty"]);m!=null&&g(n,["presencePenalty"],m);let y=f(e,["frequencyPenalty"]);y!=null&&g(n,["frequencyPenalty"],y);let v=f(e,["seed"]);v!=null&&g(n,["seed"],v);let E=f(e,["responseMimeType"]);E!=null&&g(n,["responseMimeType"],E);let S=f(e,["responseSchema"]);S!=null&&g(n,["responseSchema"],EE(S));let C=f(e,["responseJsonSchema"]);if(C!=null&&g(n,["responseJsonSchema"],C),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let _=f(e,["safetySettings"]);if(t!==void 0&&_!=null){let X=_;Array.isArray(X)&&(X=X.map(Z=>BF(Z))),g(t,["safetySettings"],X)}let T=f(e,["tools"]);if(t!==void 0&&T!=null){let X=Ra(T);Array.isArray(X)&&(X=X.map(Z=>YF(xa(Z)))),g(t,["tools"],X)}let R=f(e,["toolConfig"]);if(t!==void 0&&R!=null&&g(t,["toolConfig"],WF(R)),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let I=f(e,["cachedContent"]);t!==void 0&&I!=null&&g(t,["cachedContent"],Pi(i,I));let D=f(e,["responseModalities"]);D!=null&&g(n,["responseModalities"],D);let k=f(e,["mediaResolution"]);k!=null&&g(n,["mediaResolution"],k);let N=f(e,["speechConfig"]);if(N!=null&&g(n,["speechConfig"],wE(N)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=f(e,["thinkingConfig"]);F!=null&&g(n,["thinkingConfig"],F);let U=f(e,["imageConfig"]);U!=null&&g(n,["imageConfig"],AF(U));let re=f(e,["enableEnhancedCivicAnswers"]);return re!=null&&g(n,["enableEnhancedCivicAnswers"],re),n}function ZN(i,e,t){let n={},s=f(e,["systemInstruction"]);t!==void 0&&s!=null&&g(t,["systemInstruction"],at(s));let r=f(e,["temperature"]);r!=null&&g(n,["temperature"],r);let o=f(e,["topP"]);o!=null&&g(n,["topP"],o);let a=f(e,["topK"]);a!=null&&g(n,["topK"],a);let l=f(e,["candidateCount"]);l!=null&&g(n,["candidateCount"],l);let c=f(e,["maxOutputTokens"]);c!=null&&g(n,["maxOutputTokens"],c);let d=f(e,["stopSequences"]);d!=null&&g(n,["stopSequences"],d);let h=f(e,["responseLogprobs"]);h!=null&&g(n,["responseLogprobs"],h);let p=f(e,["logprobs"]);p!=null&&g(n,["logprobs"],p);let m=f(e,["presencePenalty"]);m!=null&&g(n,["presencePenalty"],m);let y=f(e,["frequencyPenalty"]);y!=null&&g(n,["frequencyPenalty"],y);let v=f(e,["seed"]);v!=null&&g(n,["seed"],v);let E=f(e,["responseMimeType"]);E!=null&&g(n,["responseMimeType"],E);let S=f(e,["responseSchema"]);S!=null&&g(n,["responseSchema"],EE(S));let C=f(e,["responseJsonSchema"]);C!=null&&g(n,["responseJsonSchema"],C);let _=f(e,["routingConfig"]);_!=null&&g(n,["routingConfig"],_);let T=f(e,["modelSelectionConfig"]);T!=null&&g(n,["modelConfig"],T);let R=f(e,["safetySettings"]);if(t!==void 0&&R!=null){let L=R;Array.isArray(L)&&(L=L.map(W=>W)),g(t,["safetySettings"],L)}let I=f(e,["tools"]);if(t!==void 0&&I!=null){let L=Ra(I);Array.isArray(L)&&(L=L.map(W=>b0(xa(W)))),g(t,["tools"],L)}let D=f(e,["toolConfig"]);t!==void 0&&D!=null&&g(t,["toolConfig"],D);let k=f(e,["labels"]);t!==void 0&&k!=null&&g(t,["labels"],k);let N=f(e,["cachedContent"]);t!==void 0&&N!=null&&g(t,["cachedContent"],Pi(i,N));let F=f(e,["responseModalities"]);F!=null&&g(n,["responseModalities"],F);let U=f(e,["mediaResolution"]);U!=null&&g(n,["mediaResolution"],U);let re=f(e,["speechConfig"]);re!=null&&g(n,["speechConfig"],wE(re));let X=f(e,["audioTimestamp"]);X!=null&&g(n,["audioTimestamp"],X);let Z=f(e,["thinkingConfig"]);Z!=null&&g(n,["thinkingConfig"],Z);let Ve=f(e,["imageConfig"]);if(Ve!=null&&g(n,["imageConfig"],CF(Ve)),f(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function OT(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=ln(s);Array.isArray(o)&&(o=o.map(a=>Pp(a))),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&g(t,["generationConfig"],XN(i,r,t)),t}function UT(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=ln(s);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&g(t,["generationConfig"],ZN(i,r,t)),t}function HT(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>bN(c))),g(e,["candidates"],l)}let s=f(i,["modelVersion"]);s!=null&&g(e,["modelVersion"],s);let r=f(i,["promptFeedback"]);r!=null&&g(e,["promptFeedback"],r);let o=f(i,["responseId"]);o!=null&&g(e,["responseId"],o);let a=f(i,["usageMetadata"]);return a!=null&&g(e,["usageMetadata"],a),e}function BT(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>d)),g(e,["candidates"],c)}let s=f(i,["createTime"]);s!=null&&g(e,["createTime"],s);let r=f(i,["modelVersion"]);r!=null&&g(e,["modelVersion"],r);let o=f(i,["promptFeedback"]);o!=null&&g(e,["promptFeedback"],o);let a=f(i,["responseId"]);a!=null&&g(e,["responseId"],a);let l=f(i,["usageMetadata"]);return l!=null&&g(e,["usageMetadata"],l),e}function jN(i,e){let t={};if(f(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(i,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let n=f(i,["numberOfImages"]);e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n);let s=f(i,["aspectRatio"]);e!==void 0&&s!=null&&g(e,["parameters","aspectRatio"],s);let r=f(i,["guidanceScale"]);if(e!==void 0&&r!=null&&g(e,["parameters","guidanceScale"],r),f(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=f(i,["safetyFilterLevel"]);e!==void 0&&o!=null&&g(e,["parameters","safetySetting"],o);let a=f(i,["personGeneration"]);e!==void 0&&a!=null&&g(e,["parameters","personGeneration"],a);let l=f(i,["includeSafetyAttributes"]);e!==void 0&&l!=null&&g(e,["parameters","includeSafetyAttributes"],l);let c=f(i,["includeRaiReason"]);e!==void 0&&c!=null&&g(e,["parameters","includeRaiReason"],c);let d=f(i,["language"]);e!==void 0&&d!=null&&g(e,["parameters","language"],d);let h=f(i,["outputMimeType"]);e!==void 0&&h!=null&&g(e,["parameters","outputOptions","mimeType"],h);let p=f(i,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&g(e,["parameters","outputOptions","compressionQuality"],p),f(i,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(f(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let m=f(i,["imageSize"]);if(e!==void 0&&m!=null&&g(e,["parameters","sampleImageSize"],m),f(i,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function QN(i,e){let t={},n=f(i,["outputGcsUri"]);e!==void 0&&n!=null&&g(e,["parameters","storageUri"],n);let s=f(i,["negativePrompt"]);e!==void 0&&s!=null&&g(e,["parameters","negativePrompt"],s);let r=f(i,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);let o=f(i,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);let a=f(i,["guidanceScale"]);e!==void 0&&a!=null&&g(e,["parameters","guidanceScale"],a);let l=f(i,["seed"]);e!==void 0&&l!=null&&g(e,["parameters","seed"],l);let c=f(i,["safetyFilterLevel"]);e!==void 0&&c!=null&&g(e,["parameters","safetySetting"],c);let d=f(i,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);let h=f(i,["includeSafetyAttributes"]);e!==void 0&&h!=null&&g(e,["parameters","includeSafetyAttributes"],h);let p=f(i,["includeRaiReason"]);e!==void 0&&p!=null&&g(e,["parameters","includeRaiReason"],p);let m=f(i,["language"]);e!==void 0&&m!=null&&g(e,["parameters","language"],m);let y=f(i,["outputMimeType"]);e!==void 0&&y!=null&&g(e,["parameters","outputOptions","mimeType"],y);let v=f(i,["outputCompressionQuality"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","compressionQuality"],v);let E=f(i,["addWatermark"]);e!==void 0&&E!=null&&g(e,["parameters","addWatermark"],E);let S=f(i,["labels"]);e!==void 0&&S!=null&&g(e,["labels"],S);let C=f(i,["imageSize"]);e!==void 0&&C!=null&&g(e,["parameters","sampleImageSize"],C);let _=f(i,["enhancePrompt"]);return e!==void 0&&_!=null&&g(e,["parameters","enhancePrompt"],_),t}function eF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["config"]);return r!=null&&jN(r,t),t}function tF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["config"]);return r!=null&&QN(r,t),t}function nF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>pF(o))),g(e,["generatedImages"],r)}let s=f(i,["positivePromptSafetyAttributes"]);return s!=null&&g(e,["positivePromptSafetyAttributes"],y0(s)),e}function iF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Mp(o))),g(e,["generatedImages"],r)}let s=f(i,["positivePromptSafetyAttributes"]);return s!=null&&g(e,["positivePromptSafetyAttributes"],v0(s)),e}function sF(i,e){let t={},n=f(i,["numberOfVideos"]);if(e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n),f(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(i,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let s=f(i,["durationSeconds"]);if(e!==void 0&&s!=null&&g(e,["parameters","durationSeconds"],s),f(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let r=f(i,["aspectRatio"]);e!==void 0&&r!=null&&g(e,["parameters","aspectRatio"],r);let o=f(i,["resolution"]);e!==void 0&&o!=null&&g(e,["parameters","resolution"],o);let a=f(i,["personGeneration"]);if(e!==void 0&&a!=null&&g(e,["parameters","personGeneration"],a),f(i,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let l=f(i,["negativePrompt"]);e!==void 0&&l!=null&&g(e,["parameters","negativePrompt"],l);let c=f(i,["enhancePrompt"]);if(e!==void 0&&c!=null&&g(e,["parameters","enhancePrompt"],c),f(i,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let d=f(i,["lastFrame"]);e!==void 0&&d!=null&&g(e,["instances[0]","lastFrame"],kp(d));let h=f(i,["referenceImages"]);if(e!==void 0&&h!=null){let p=h;Array.isArray(p)&&(p=p.map(m=>oL(m))),g(e,["instances[0]","referenceImages"],p)}if(f(i,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(f(i,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function rF(i,e){let t={},n=f(i,["numberOfVideos"]);e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n);let s=f(i,["outputGcsUri"]);e!==void 0&&s!=null&&g(e,["parameters","storageUri"],s);let r=f(i,["fps"]);e!==void 0&&r!=null&&g(e,["parameters","fps"],r);let o=f(i,["durationSeconds"]);e!==void 0&&o!=null&&g(e,["parameters","durationSeconds"],o);let a=f(i,["seed"]);e!==void 0&&a!=null&&g(e,["parameters","seed"],a);let l=f(i,["aspectRatio"]);e!==void 0&&l!=null&&g(e,["parameters","aspectRatio"],l);let c=f(i,["resolution"]);e!==void 0&&c!=null&&g(e,["parameters","resolution"],c);let d=f(i,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);let h=f(i,["pubsubTopic"]);e!==void 0&&h!=null&&g(e,["parameters","pubsubTopic"],h);let p=f(i,["negativePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","negativePrompt"],p);let m=f(i,["enhancePrompt"]);e!==void 0&&m!=null&&g(e,["parameters","enhancePrompt"],m);let y=f(i,["generateAudio"]);e!==void 0&&y!=null&&g(e,["parameters","generateAudio"],y);let v=f(i,["lastFrame"]);e!==void 0&&v!=null&&g(e,["instances[0]","lastFrame"],Tn(v));let E=f(i,["referenceImages"]);if(e!==void 0&&E!=null){let _=E;Array.isArray(_)&&(_=_.map(T=>aL(T))),g(e,["instances[0]","referenceImages"],_)}let S=f(i,["mask"]);e!==void 0&&S!=null&&g(e,["instances[0]","mask"],rL(S));let C=f(i,["compressionQuality"]);return e!==void 0&&C!=null&&g(e,["parameters","compressionQuality"],C),t}function oF(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response","generateVideoResponse"]);return o!=null&&g(e,["response"],dF(o)),e}function aF(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],uF(o)),e}function lF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["image"]);r!=null&&g(t,["instances[0]","image"],kp(r));let o=f(e,["video"]);o!=null&&g(t,["instances[0]","video"],E0(o));let a=f(e,["source"]);a!=null&&hF(a,t);let l=f(e,["config"]);return l!=null&&sF(l,t),t}function cF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["image"]);r!=null&&g(t,["instances[0]","image"],Tn(r));let o=f(e,["video"]);o!=null&&g(t,["instances[0]","video"],w0(o));let a=f(e,["source"]);a!=null&&fF(a,t);let l=f(e,["config"]);return l!=null&&rF(l,t),t}function dF(i){let e={},t=f(i,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>mF(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function uF(i){let e={},t=f(i,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>yF(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function hF(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["image"]);e!==void 0&&s!=null&&g(e,["instances[0]","image"],kp(s));let r=f(i,["video"]);return e!==void 0&&r!=null&&g(e,["instances[0]","video"],E0(r)),t}function fF(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["image"]);e!==void 0&&s!=null&&g(e,["instances[0]","image"],Tn(s));let r=f(i,["video"]);return e!==void 0&&r!=null&&g(e,["instances[0]","video"],w0(r)),t}function pF(i){let e={},t=f(i,["_self"]);t!=null&&g(e,["image"],_F(t));let n=f(i,["raiFilteredReason"]);n!=null&&g(e,["raiFilteredReason"],n);let s=f(i,["_self"]);return s!=null&&g(e,["safetyAttributes"],y0(s)),e}function Mp(i){let e={},t=f(i,["_self"]);t!=null&&g(e,["image"],m0(t));let n=f(i,["raiFilteredReason"]);n!=null&&g(e,["raiFilteredReason"],n);let s=f(i,["_self"]);s!=null&&g(e,["safetyAttributes"],v0(s));let r=f(i,["prompt"]);return r!=null&&g(e,["enhancedPrompt"],r),e}function gF(i){let e={},t=f(i,["_self"]);t!=null&&g(e,["mask"],m0(t));let n=f(i,["labels"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),g(e,["labels"],s)}return e}function mF(i){let e={},t=f(i,["video"]);return t!=null&&g(e,["video"],iL(t)),e}function yF(i){let e={},t=f(i,["_self"]);return t!=null&&g(e,["video"],sL(t)),e}function vF(i){let e={},t=f(i,["modelSelectionConfig"]);t!=null&&g(e,["modelConfig"],t);let n=f(i,["responseJsonSchema"]);n!=null&&g(e,["responseJsonSchema"],n);let s=f(i,["audioTimestamp"]);s!=null&&g(e,["audioTimestamp"],s);let r=f(i,["candidateCount"]);r!=null&&g(e,["candidateCount"],r);let o=f(i,["enableAffectiveDialog"]);o!=null&&g(e,["enableAffectiveDialog"],o);let a=f(i,["frequencyPenalty"]);a!=null&&g(e,["frequencyPenalty"],a);let l=f(i,["logprobs"]);l!=null&&g(e,["logprobs"],l);let c=f(i,["maxOutputTokens"]);c!=null&&g(e,["maxOutputTokens"],c);let d=f(i,["mediaResolution"]);d!=null&&g(e,["mediaResolution"],d);let h=f(i,["presencePenalty"]);h!=null&&g(e,["presencePenalty"],h);let p=f(i,["responseLogprobs"]);p!=null&&g(e,["responseLogprobs"],p);let m=f(i,["responseMimeType"]);m!=null&&g(e,["responseMimeType"],m);let y=f(i,["responseModalities"]);y!=null&&g(e,["responseModalities"],y);let v=f(i,["responseSchema"]);v!=null&&g(e,["responseSchema"],v);let E=f(i,["routingConfig"]);E!=null&&g(e,["routingConfig"],E);let S=f(i,["seed"]);S!=null&&g(e,["seed"],S);let C=f(i,["speechConfig"]);C!=null&&g(e,["speechConfig"],C);let _=f(i,["stopSequences"]);_!=null&&g(e,["stopSequences"],_);let T=f(i,["temperature"]);T!=null&&g(e,["temperature"],T);let R=f(i,["thinkingConfig"]);R!=null&&g(e,["thinkingConfig"],R);let I=f(i,["topK"]);I!=null&&g(e,["topK"],I);let D=f(i,["topP"]);if(D!=null&&g(e,["topP"],D),f(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function bF(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],ce(i,n)),t}function EF(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],ce(i,n)),t}function wF(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function SF(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function AF(i){let e={},t=f(i,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);let n=f(i,["imageSize"]);if(n!=null&&g(e,["imageSize"],n),f(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function CF(i){let e={},t=f(i,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);let n=f(i,["imageSize"]);n!=null&&g(e,["imageSize"],n);let s=f(i,["outputMimeType"]);s!=null&&g(e,["imageOutputOptions","mimeType"],s);let r=f(i,["outputCompressionQuality"]);return r!=null&&g(e,["imageOutputOptions","compressionQuality"],r),e}function _F(i){let e={},t=f(i,["bytesBase64Encoded"]);t!=null&&g(e,["imageBytes"],Es(t));let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function m0(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["gcsUri"],t);let n=f(i,["bytesBase64Encoded"]);n!=null&&g(e,["imageBytes"],Es(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function kp(i){let e={};if(f(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=f(i,["imageBytes"]);t!=null&&g(e,["bytesBase64Encoded"],Es(t));let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function Tn(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["gcsUri"],t);let n=f(i,["imageBytes"]);n!=null&&g(e,["bytesBase64Encoded"],Es(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function TF(i,e,t){let n={},s=f(e,["pageSize"]);t!==void 0&&s!=null&&g(t,["_query","pageSize"],s);let r=f(e,["pageToken"]);t!==void 0&&r!=null&&g(t,["_query","pageToken"],r);let o=f(e,["filter"]);t!==void 0&&o!=null&&g(t,["_query","filter"],o);let a=f(e,["queryBase"]);return t!==void 0&&a!=null&&g(t,["_url","models_url"],c0(i,a)),n}function xF(i,e,t){let n={},s=f(e,["pageSize"]);t!==void 0&&s!=null&&g(t,["_query","pageSize"],s);let r=f(e,["pageToken"]);t!==void 0&&r!=null&&g(t,["_query","pageToken"],r);let o=f(e,["filter"]);t!==void 0&&o!=null&&g(t,["_query","filter"],o);let a=f(e,["queryBase"]);return t!==void 0&&a!=null&&g(t,["_url","models_url"],c0(i,a)),n}function RF(i,e){let t={},n=f(e,["config"]);return n!=null&&TF(i,n,t),t}function IF(i,e){let t={},n=f(e,["config"]);return n!=null&&xF(i,n,t),t}function DF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["_self"]);if(s!=null){let r=d0(s);Array.isArray(r)&&(r=r.map(o=>zb(o))),g(e,["models"],r)}return e}function PF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["_self"]);if(s!=null){let r=d0(s);Array.isArray(r)&&(r=r.map(o=>qb(o))),g(e,["models"],r)}return e}function MF(i){let e={},t=f(i,["maskMode"]);t!=null&&g(e,["maskMode"],t);let n=f(i,["segmentationClasses"]);n!=null&&g(e,["maskClasses"],n);let s=f(i,["maskDilation"]);return s!=null&&g(e,["dilation"],s),e}function zb(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);s!=null&&g(e,["description"],s);let r=f(i,["version"]);r!=null&&g(e,["version"],r);let o=f(i,["_self"]);o!=null&&g(e,["tunedModelInfo"],KF(o));let a=f(i,["inputTokenLimit"]);a!=null&&g(e,["inputTokenLimit"],a);let l=f(i,["outputTokenLimit"]);l!=null&&g(e,["outputTokenLimit"],l);let c=f(i,["supportedGenerationMethods"]);c!=null&&g(e,["supportedActions"],c);let d=f(i,["temperature"]);d!=null&&g(e,["temperature"],d);let h=f(i,["maxTemperature"]);h!=null&&g(e,["maxTemperature"],h);let p=f(i,["topP"]);p!=null&&g(e,["topP"],p);let m=f(i,["topK"]);m!=null&&g(e,["topK"],m);let y=f(i,["thinking"]);return y!=null&&g(e,["thinking"],y),e}function qb(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);s!=null&&g(e,["description"],s);let r=f(i,["versionId"]);r!=null&&g(e,["version"],r);let o=f(i,["deployedModels"]);if(o!=null){let h=o;Array.isArray(h)&&(h=h.map(p=>qN(p))),g(e,["endpoints"],h)}let a=f(i,["labels"]);a!=null&&g(e,["labels"],a);let l=f(i,["_self"]);l!=null&&g(e,["tunedModelInfo"],JF(l));let c=f(i,["defaultCheckpointId"]);c!=null&&g(e,["defaultCheckpointId"],c);let d=f(i,["checkpoints"]);if(d!=null){let h=d;Array.isArray(h)&&(h=h.map(p=>p)),g(e,["checkpoints"],h)}return e}function kF(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],WN(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],YN(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],vN(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function NF(i){let e={},t=f(i,["productImage"]);return t!=null&&g(e,["image"],Tn(t)),e}function FF(i,e){let t={},n=f(i,["numberOfImages"]);e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n);let s=f(i,["baseSteps"]);e!==void 0&&s!=null&&g(e,["parameters","baseSteps"],s);let r=f(i,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);let o=f(i,["seed"]);e!==void 0&&o!=null&&g(e,["parameters","seed"],o);let a=f(i,["safetyFilterLevel"]);e!==void 0&&a!=null&&g(e,["parameters","safetySetting"],a);let l=f(i,["personGeneration"]);e!==void 0&&l!=null&&g(e,["parameters","personGeneration"],l);let c=f(i,["addWatermark"]);e!==void 0&&c!=null&&g(e,["parameters","addWatermark"],c);let d=f(i,["outputMimeType"]);e!==void 0&&d!=null&&g(e,["parameters","outputOptions","mimeType"],d);let h=f(i,["outputCompressionQuality"]);e!==void 0&&h!=null&&g(e,["parameters","outputOptions","compressionQuality"],h);let p=f(i,["enhancePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","enhancePrompt"],p);let m=f(i,["labels"]);return e!==void 0&&m!=null&&g(e,["labels"],m),t}function LF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["source"]);s!=null&&UF(s,t);let r=f(e,["config"]);return r!=null&&FF(r,t),t}function OF(i){let e={},t=f(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>Mp(s))),g(e,["generatedImages"],n)}return e}function UF(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["personImage"]);e!==void 0&&s!=null&&g(e,["instances[0]","personImage","image"],Tn(s));let r=f(i,["productImages"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>NF(a))),g(e,["instances[0]","productImages"],o)}return t}function HF(i){let e={},t=f(i,["referenceImage"]);t!=null&&g(e,["referenceImage"],Tn(t));let n=f(i,["referenceId"]);n!=null&&g(e,["referenceId"],n);let s=f(i,["referenceType"]);s!=null&&g(e,["referenceType"],s);let r=f(i,["maskImageConfig"]);r!=null&&g(e,["maskImageConfig"],MF(r));let o=f(i,["controlImageConfig"]);o!=null&&g(e,["controlImageConfig"],_N(o));let a=f(i,["styleImageConfig"]);a!=null&&g(e,["styleImageConfig"],a);let l=f(i,["subjectImageConfig"]);return l!=null&&g(e,["subjectImageConfig"],l),e}function y0(i){let e={},t=f(i,["safetyAttributes","categories"]);t!=null&&g(e,["categories"],t);let n=f(i,["safetyAttributes","scores"]);n!=null&&g(e,["scores"],n);let s=f(i,["contentType"]);return s!=null&&g(e,["contentType"],s),e}function v0(i){let e={},t=f(i,["safetyAttributes","categories"]);t!=null&&g(e,["categories"],t);let n=f(i,["safetyAttributes","scores"]);n!=null&&g(e,["scores"],n);let s=f(i,["contentType"]);return s!=null&&g(e,["contentType"],s),e}function BF(i){let e={},t=f(i,["category"]);if(t!=null&&g(e,["category"],t),f(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=f(i,["threshold"]);return n!=null&&g(e,["threshold"],n),e}function GF(i){let e={},t=f(i,["image"]);return t!=null&&g(e,["image"],Tn(t)),e}function VF(i,e){let t={},n=f(i,["mode"]);e!==void 0&&n!=null&&g(e,["parameters","mode"],n);let s=f(i,["maxPredictions"]);e!==void 0&&s!=null&&g(e,["parameters","maxPredictions"],s);let r=f(i,["confidenceThreshold"]);e!==void 0&&r!=null&&g(e,["parameters","confidenceThreshold"],r);let o=f(i,["maskDilation"]);e!==void 0&&o!=null&&g(e,["parameters","maskDilation"],o);let a=f(i,["binaryColorThreshold"]);e!==void 0&&a!=null&&g(e,["parameters","binaryColorThreshold"],a);let l=f(i,["labels"]);return e!==void 0&&l!=null&&g(e,["labels"],l),t}function $F(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["source"]);s!=null&&qF(s,t);let r=f(e,["config"]);return r!=null&&VF(r,t),t}function zF(i){let e={},t=f(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>gF(s))),g(e,["generatedMasks"],n)}return e}function qF(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["image"]);e!==void 0&&s!=null&&g(e,["instances[0]","image"],Tn(s));let r=f(i,["scribbleImage"]);return e!==void 0&&r!=null&&g(e,["instances[0]","scribble"],GF(r)),t}function WF(i){let e={},t=f(i,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],KN(t));let n=f(i,["retrievalConfig"]);return n!=null&&g(e,["retrievalConfig"],n),e}function YF(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],wF(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],SF(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function b0(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(p=>JN(p))),g(e,["functionDeclarations"],h)}let n=f(i,["retrieval"]);n!=null&&g(e,["retrieval"],n);let s=f(i,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);let r=f(i,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=f(i,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);let a=f(i,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);let l=f(i,["googleMaps"]);l!=null&&g(e,["googleMaps"],l);let c=f(i,["googleSearch"]);c!=null&&g(e,["googleSearch"],c);let d=f(i,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function KF(i){let e={},t=f(i,["baseModel"]);t!=null&&g(e,["baseModel"],t);let n=f(i,["createTime"]);n!=null&&g(e,["createTime"],n);let s=f(i,["updateTime"]);return s!=null&&g(e,["updateTime"],s),e}function JF(i){let e={},t=f(i,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&g(e,["baseModel"],t);let n=f(i,["createTime"]);n!=null&&g(e,["createTime"],n);let s=f(i,["updateTime"]);return s!=null&&g(e,["updateTime"],s),e}function XF(i,e){let t={},n=f(i,["displayName"]);e!==void 0&&n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);e!==void 0&&s!=null&&g(e,["description"],s);let r=f(i,["defaultCheckpointId"]);return e!==void 0&&r!=null&&g(e,["defaultCheckpointId"],r),t}function ZF(i,e){let t={},n=f(i,["displayName"]);e!==void 0&&n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);e!==void 0&&s!=null&&g(e,["description"],s);let r=f(i,["defaultCheckpointId"]);return e!==void 0&&r!=null&&g(e,["defaultCheckpointId"],r),t}function jF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","name"],ce(i,n));let s=f(e,["config"]);return s!=null&&XF(s,t),t}function QF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["config"]);return s!=null&&ZF(s,t),t}function eL(i,e){let t={},n=f(i,["outputGcsUri"]);e!==void 0&&n!=null&&g(e,["parameters","storageUri"],n);let s=f(i,["safetyFilterLevel"]);e!==void 0&&s!=null&&g(e,["parameters","safetySetting"],s);let r=f(i,["personGeneration"]);e!==void 0&&r!=null&&g(e,["parameters","personGeneration"],r);let o=f(i,["includeRaiReason"]);e!==void 0&&o!=null&&g(e,["parameters","includeRaiReason"],o);let a=f(i,["outputMimeType"]);e!==void 0&&a!=null&&g(e,["parameters","outputOptions","mimeType"],a);let l=f(i,["outputCompressionQuality"]);e!==void 0&&l!=null&&g(e,["parameters","outputOptions","compressionQuality"],l);let c=f(i,["enhanceInputImage"]);e!==void 0&&c!=null&&g(e,["parameters","upscaleConfig","enhanceInputImage"],c);let d=f(i,["imagePreservationFactor"]);e!==void 0&&d!=null&&g(e,["parameters","upscaleConfig","imagePreservationFactor"],d);let h=f(i,["labels"]);e!==void 0&&h!=null&&g(e,["labels"],h);let p=f(i,["numberOfImages"]);e!==void 0&&p!=null&&g(e,["parameters","sampleCount"],p);let m=f(i,["mode"]);return e!==void 0&&m!=null&&g(e,["parameters","mode"],m),t}function tL(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["image"]);s!=null&&g(t,["instances[0]","image"],Tn(s));let r=f(e,["upscaleFactor"]);r!=null&&g(t,["parameters","upscaleConfig","upscaleFactor"],r);let o=f(e,["config"]);return o!=null&&eL(o,t),t}function nL(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>Mp(r))),g(e,["generatedImages"],s)}return e}function iL(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["uri"],t);let n=f(i,["encodedVideo"]);n!=null&&g(e,["videoBytes"],Es(n));let s=f(i,["encoding"]);return s!=null&&g(e,["mimeType"],s),e}function sL(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["uri"],t);let n=f(i,["bytesBase64Encoded"]);n!=null&&g(e,["videoBytes"],Es(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function rL(i){let e={},t=f(i,["image"]);t!=null&&g(e,["_self"],Tn(t));let n=f(i,["maskMode"]);return n!=null&&g(e,["maskMode"],n),e}function oL(i){let e={},t=f(i,["image"]);t!=null&&g(e,["image"],kp(t));let n=f(i,["referenceType"]);return n!=null&&g(e,["referenceType"],n),e}function aL(i){let e={},t=f(i,["image"]);t!=null&&g(e,["image"],Tn(t));let n=f(i,["referenceType"]);return n!=null&&g(e,["referenceType"],n),e}function E0(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["uri"],t);let n=f(i,["videoBytes"]);n!=null&&g(e,["encodedVideo"],Es(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["encoding"],s),e}function w0(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["gcsUri"],t);let n=f(i,["videoBytes"]);n!=null&&g(e,["bytesBase64Encoded"],Es(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function lL(i,e){let t={},n=f(i,["displayName"]);return e!==void 0&&n!=null&&g(e,["displayName"],n),t}function cL(i){let e={},t=f(i,["config"]);return t!=null&&lL(t,e),e}function dL(i,e){let t={},n=f(i,["force"]);return e!==void 0&&n!=null&&g(e,["_query","force"],n),t}function uL(i){let e={},t=f(i,["name"]);t!=null&&g(e,["_url","name"],t);let n=f(i,["config"]);return n!=null&&dL(n,e),e}function hL(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","name"],t),e}function fL(i,e){let t={},n=f(i,["customMetadata"]);if(e!==void 0&&n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["customMetadata"],r)}let s=f(i,["chunkingConfig"]);return e!==void 0&&s!=null&&g(e,["chunkingConfig"],s),t}function pL(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],mL(o)),e}function gL(i){let e={},t=f(i,["fileSearchStoreName"]);t!=null&&g(e,["_url","file_search_store_name"],t);let n=f(i,["fileName"]);n!=null&&g(e,["fileName"],n);let s=f(i,["config"]);return s!=null&&fL(s,e),e}function mL(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["parent"]);n!=null&&g(e,["parent"],n);let s=f(i,["documentName"]);return s!=null&&g(e,["documentName"],s),e}function yL(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function vL(i){let e={},t=f(i,["config"]);return t!=null&&yL(t,e),e}function bL(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["fileSearchStores"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["fileSearchStores"],r)}return e}function S0(i,e){let t={},n=f(i,["mimeType"]);e!==void 0&&n!=null&&g(e,["mimeType"],n);let s=f(i,["displayName"]);e!==void 0&&s!=null&&g(e,["displayName"],s);let r=f(i,["customMetadata"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>l)),g(e,["customMetadata"],a)}let o=f(i,["chunkingConfig"]);return e!==void 0&&o!=null&&g(e,["chunkingConfig"],o),t}function EL(i){let e={},t=f(i,["fileSearchStoreName"]);t!=null&&g(e,["_url","file_search_store_name"],t);let n=f(i,["config"]);return n!=null&&S0(n,e),e}function wL(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}var SL="Content-Type",AL="X-Server-Timeout",CL="User-Agent",Wb="x-goog-api-client",_L="1.34.0",TL=`google-genai-sdk/${_L}`,xL="v1beta1",RL="v1beta",Yb=class{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let s={};this.clientOptions.vertexai?(s.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:xL,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:RL,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let s=[this.getRequestUrlInternal(t)];return n&&s.push(this.getBaseResourcePath()),e!==""&&s.push(e),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[o,a]of Object.entries(e.queryParams))s.searchParams.append(o,String(a));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.unaryApiCall(s,r,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[s,r]of Object.entries(t))typeof r=="object"?n[s]=Object.assign(Object.assign({},n[s]),r):r!==void 0&&(n[s]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.streamApiCall(s,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,s){if(t&&t.timeout||s){let r=new AbortController,o=r.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){let a=setTimeout(()=>r.abort(),t.timeout);a&&typeof a.unref=="function"&&a.unref()}s&&s.addEventListener("abort",()=>{r.abort()}),e.signal=o}return t&&t.extraBody!==null&&IL(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await GT(s),new qc(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await GT(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(e){return An(this,arguments,function*(){var n;let s=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let o="",a="data:",l=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:c,value:d}=yield J(s.read());if(c){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let h=r.decode(d,{stream:!0});try{let y=JSON.parse(h);if("error"in y){let v=JSON.parse(JSON.stringify(y.error)),E=v.status,S=v.code,C=`got status: ${E}. ${JSON.stringify(y)}`;if(S>=400&&S<600)throw new pp({message:C,status:S})}}catch(y){if(y.name==="ApiError")throw y}o+=h;let p=-1,m=0;for(;;){p=-1,m=0;for(let E of l){let S=o.indexOf(E);S!==-1&&(p===-1||S<p)&&(p=S,m=E.length)}if(p===-1)break;let y=o.substring(0,p);o=o.substring(p+m);let v=y.trim();if(v.startsWith(a)){let E=v.substring(a.length).trim();try{let S=new Response(E,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield J(new qc(S))}catch(S){throw new Error(`exception parsing stream chunk ${E}. ${S}`)}}}}}finally{s.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){let e={},t=TL+" "+this.clientOptions.userAgentExtra;return e[CL]=t,e[Wb]=t,e[SL]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[s,r]of Object.entries(e.headers))n.append(s,r);e.timeout&&e.timeout>0&&n.append(AL,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(t=n.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),n}async uploadFile(e,t){var n;let s={};t!=null&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);let r=this.clientOptions.uploader,o=await r.stat(e);s.sizeBytes=String(o.size);let a=(n=t==null?void 0:t.mimeType)!==null&&n!==void 0?n:o.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=a;let l={file:s},c=this.getFileName(e),d=O("upload/v1beta/files",l._url),h=await this.fetchUploadUrl(d,s.sizeBytes,s.mimeType,c,l,t==null?void 0:t.httpOptions);return r.upload(e,h,this)}async uploadFileToFileSearchStore(e,t,n){var s;let r=this.clientOptions.uploader,o=await r.stat(t),a=String(o.size),l=(s=n==null?void 0:n.mimeType)!==null&&s!==void 0?s:o.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let c=`upload/v1beta/${e}:uploadToFileSearchStore`,d=this.getFileName(t),h={};n!=null&&S0(n,h);let p=await this.fetchUploadUrl(c,a,l,d,h,n==null?void 0:n.httpOptions);return r.uploadToFileSearchStore(t,p,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,s,r,o){var a;let l={};o?l=o:l={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},s?{"X-Goog-Upload-File-Name":s}:{})};let c=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:l});if(!c||!(c!=null&&c.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let d=(a=c==null?void 0:c.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(d===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return d}};async function GT(i){var e;if(i===void 0)throw new Error("response is undefined");if(!i.ok){let t=i.status,n;!((e=i.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await i.json():n={error:{message:await i.text(),code:i.status,status:i.statusText}};let s=JSON.stringify(n);throw t>=400&&t<600?new pp({message:s,status:t}):new Error(s)}}function IL(i,e){if(!e||Object.keys(e).length===0)return;if(i.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof i.body=="string"&&i.body.length>0)try{let r=JSON.parse(i.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))t=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch(r){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(r,o){let a=Object.assign({},r);for(let l in o)if(Object.prototype.hasOwnProperty.call(o,l)){let c=o[l],d=a[l];c&&typeof c=="object"&&!Array.isArray(c)&&d&&typeof d=="object"&&!Array.isArray(d)?a[l]=n(d,c):(d&&c&&typeof d!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof d}, New type: ${typeof c}. Overwriting.`),a[l]=c)}return a}let s=n(t,e);i.body=JSON.stringify(s)}var DL="mcp_used/unknown",PL=!1;function A0(i){for(let e of i)if(ML(e)||typeof e=="object"&&"inputSchema"in e)return!0;return PL}function C0(i){var e;let t=(e=i[Wb])!==null&&e!==void 0?e:"";i[Wb]=(t+` ${DL}`).trimStart()}function ML(i){return i!==null&&typeof i=="object"&&i instanceof Kb}function kL(i){return An(this,arguments,function*(t,n=100){let s,r=0;for(;r<n;){let o=yield J(t.listTools({cursor:s}));for(let a of o.tools)yield yield J(a),r++;if(!o.nextCursor)break;s=o.nextCursor}})}var Kb=class i{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new i(e,t)}async initialize(){var e,t,n,s;if(this.mcpTools.length>0)return;let r={},o=[];for(let d of this.mcpClients)try{for(var a=!0,l=(t=void 0,Cn(kL(d))),c;c=await l.next(),e=c.done,!e;a=!0){s=c.value,a=!1;let h=s;o.push(h);let p=h.name;if(r[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);r[p]=d}}catch(h){t={error:h}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),yM(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let s=this.functionNameToMcpClient[n.name],r;this.config.timeout&&(r={timeout:this.config.timeout});let o=await s.callTool({name:n.name,arguments:n.args},void 0,r);t.push({functionResponse:{name:n.name,response:o.isError?{error:o}:o}})}return t}};async function NL(i,e,t){let n=new Fb,s;t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data),Object.assign(n,s),e(n)}var Jb=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let s=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),o=LL(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${s}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${a}`,c=()=>{},d=new Promise(_=>{c=_}),h=e.callbacks,p=function(){c({})},m=this.apiClient,y={onopen:p,onmessage:_=>{NL(m,h.onmessage,_)},onerror:(t=h==null?void 0:h.onerror)!==null&&t!==void 0?t:function(_){},onclose:(n=h==null?void 0:h.onclose)!==null&&n!==void 0?n:function(_){}},v=this.webSocketFactory.create(l,FL(o),y);v.connect(),await d;let C={setup:{model:ce(this.apiClient,e.model)}};return v.send(JSON.stringify(C)),new Xb(v,this.apiClient)}},Xb=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=cN(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=lN(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Sa.PLAY)}pause(){this.sendPlaybackControl(Sa.PAUSE)}stop(){this.sendPlaybackControl(Sa.STOP)}resetContext(){this.sendPlaybackControl(Sa.RESET_CONTEXT)}close(){this.conn.close()}};function FL(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function LL(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var OL="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function UL(i,e,t){let n=new Nb,s;t.data instanceof Blob?s=await t.data.text():t.data instanceof ArrayBuffer?s=new TextDecoder().decode(t.data):s=t.data;let r=JSON.parse(s);if(i.isVertexAI()){let o=hN(r);Object.assign(n,o)}else Object.assign(n,r);e(n)}var Zb=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new Jb(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,s,r,o,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),d,h=this.apiClient.getHeaders();e.config&&e.config.tools&&A0(e.config.tools)&&C0(h);let p=GL(h);if(this.apiClient.isVertexAI())d=`${l}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p,d);else{let N=this.apiClient.getApiKey(),F="BidiGenerateContent",U="key";N!=null&&N.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),F="BidiGenerateContentConstrained",U="access_token"),d=`${l}/ws/google.ai.generativelanguage.${c}.GenerativeService.${F}?${U}=${N}`}let m=()=>{},y=new Promise(N=>{m=N}),v=e.callbacks,E=function(){var N;(N=v==null?void 0:v.onopen)===null||N===void 0||N.call(v),m({})},S=this.apiClient,C={onopen:E,onmessage:N=>{UL(S,v.onmessage,N)},onerror:(t=v==null?void 0:v.onerror)!==null&&t!==void 0?t:function(N){},onclose:(n=v==null?void 0:v.onclose)!==null&&n!==void 0?n:function(N){}},_=this.webSocketFactory.create(d,BL(p),C);_.connect(),await y;let T=ce(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&T.startsWith("publishers/")){let N=this.apiClient.getProject(),F=this.apiClient.getLocation();T=`projects/${N}/locations/${F}/`+T}let R={};this.apiClient.isVertexAI()&&((s=e.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[ep.AUDIO]}:e.config.responseModalities=[ep.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let I=(a=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[],D=[];for(let N of I)if(this.isCallableTool(N)){let F=N;D.push(await F.tool())}else D.push(N);D.length>0&&(e.config.tools=D);let k={model:T,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?R=aN(this.apiClient,k):R=oN(this.apiClient,k),delete R.config,_.send(JSON.stringify(R)),new jb(_,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},HL={turnComplete:!0},jb=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=ln(t.turns),e.isVertexAI()||(n=n.map(s=>Pp(s)))}catch(s){throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(let r of n){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(OL)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},HL),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:uN(e)}:t={realtimeInput:dN(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function BL(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function GL(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var VT=10;function $T(i){var e,t,n;if(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let s=!1;for(let o of(t=i==null?void 0:i.tools)!==null&&t!==void 0?t:[])if(Ca(o)){s=!0;break}if(!s)return!0;let r=(n=i==null?void 0:i.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function Ca(i){return"callTool"in i&&typeof i.callTool=="function"}function VL(i){var e,t,n;return(n=(t=(e=i.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>Ca(s)))!==null&&n!==void 0?n:!1}function zT(i){var e;let t=[];return!((e=i==null?void 0:i.config)===null||e===void 0)&&e.tools&&i.config.tools.forEach((n,s)=>{if(Ca(n))return;let r=n;r.functionDeclarations&&r.functionDeclarations.length>0&&t.push(s)}),t}function qT(i){var e;return!(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var Qb=class extends _n{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,s,r,o,a;let l=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!VL(t)||$T(t.config))return await this.generateContentInternal(l);let c=zT(t);if(c.length>0){let v=c.map(E=>`tools[${E}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${v}.`)}let d,h,p=ln(l.contents),m=(r=(s=(n=l.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&r!==void 0?r:VT,y=0;for(;y<m&&(d=await this.generateContentInternal(l),!(!d.functionCalls||d.functionCalls.length===0));){let v=d.candidates[0].content,E=[];for(let S of(a=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[])if(Ca(S)){let _=await S.callTool(d.functionCalls);E.push(..._)}y++,h={role:"user",parts:E},l.contents=ln(l.contents),l.contents.push(v),l.contents.push(h),qT(l.config)&&(p.push(v),p.push(h))}return qT(l.config)&&(d.automaticFunctionCallingHistory=p),d},this.generateContentStream=async t=>{var n,s,r,o,a;if(this.maybeMoveToResponseJsonSchem(t),$T(t.config)){let h=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(h)}let l=zT(t);if(l.length>0){let h=l.map(p=>`tools[${p}]`).join(", ");throw new Error(`Incompatible tools found at ${h}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let c=(r=(s=(n=t==null?void 0:t.config)===null||n===void 0?void 0:n.toolConfig)===null||s===void 0?void 0:s.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,d=(a=(o=t==null?void 0:t.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(c&&!d)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var s;let r,o=[];if(n!=null&&n.generatedImages)for(let l of n.generatedImages)l&&(l!=null&&l.safetyAttributes)&&((s=l==null?void 0:l.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?r=l==null?void 0:l.safetyAttributes:o.push(l);let a;return r?a={generatedImages:o,positivePromptSafetyAttributes:r,sdkHttpResponse:n.sdkHttpResponse}:a={generatedImages:o,sdkHttpResponse:n.sdkHttpResponse},a}),this.list=async t=>{var n;let o={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((n=o.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new Di(Ii.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(o),o)},this.editImage=async t=>{let n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));let s={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(s)},this.generateVideos=async t=>{var n,s,r,o,a,l;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=t.video)===null||n===void 0)&&n.uri&&(!((s=t.video)===null||s===void 0)&&s.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((o=(r=t.source)===null||r===void 0?void 0:r.video)===null||o===void 0)&&o.uri&&(!((l=(a=t.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,s;let r=(t=e.config)===null||t===void 0?void 0:t.tools;if(!r)return e;let o=await Promise.all(r.map(async l=>Ca(l)?await l.tool():l)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(a.config.tools=o,e.config&&e.config.tools&&A0(e.config.tools)){let l=(s=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&s!==void 0?s:{},c=Object.assign({},l);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),C0(c),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return a}async initAfcToolsMap(e){var t,n,s;let r=new Map;for(let o of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(Ca(o)){let a=o,l=await a.tool();for(let c of(s=l.functionDeclarations)!==null&&s!==void 0?s:[]){if(!c.name)throw new Error("Function declaration name is required.");if(r.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);r.set(c.name,a)}}return r}async processAfcStream(e){var t,n,s;let r=(s=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&s!==void 0?s:VT,o=!1,a=0,l=await this.initAfcToolsMap(e);return function(c,d,h){return An(this,arguments,function*(){for(var p,m,y,v,E,S;a<r;){o&&(a++,o=!1);let R=yield J(c.processParamsMaybeAddMcpUsage(h)),I=yield J(c.generateContentStreamInternal(R)),D=[],k=[];try{for(var C=!0,_=(m=void 0,Cn(I)),T;T=yield J(_.next()),p=T.done,!p;C=!0){v=T.value,C=!1;let N=v;if(yield yield J(N),N.candidates&&(!((E=N.candidates[0])===null||E===void 0)&&E.content)){k.push(N.candidates[0].content);for(let F of(S=N.candidates[0].content.parts)!==null&&S!==void 0?S:[])if(a<r&&F.functionCall){if(!F.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(F.functionCall.name)){let U=yield J(d.get(F.functionCall.name).callTool([F.functionCall]));D.push(...U)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${F.functionCall.name}`)}}}}catch(N){m={error:N}}finally{try{!C&&!p&&(y=_.return)&&(yield J(y.call(_)))}finally{if(m)throw m.error}}if(D.length>0){o=!0;let N=new Cr;N.candidates=[{content:{role:"user",parts:D}}],yield yield J(N);let F=[];F.push(...k),F.push({role:"user",parts:D});let U=ln(h.contents).concat(F);h.contents=U}else break}})}(this,l,e)}async generateContentInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=UT(this.apiClient,e);return a=O("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=BT(d),p=new Cr;return Object.assign(p,h),p})}else{let c=OT(this.apiClient,e);return a=O("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=HT(d),p=new Cr;return Object.assign(p,h),p})}}async generateContentStreamInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=UT(this.apiClient,e);return a=O("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),o.then(function(h){return An(this,arguments,function*(){var p,m,y,v;try{for(var E=!0,S=Cn(h),C;C=yield J(S.next()),p=C.done,!p;E=!0){v=C.value,E=!1;let _=v,T=BT(yield J(_.json()));T.sdkHttpResponse={headers:_.headers};let R=new Cr;Object.assign(R,T),yield yield J(R)}}catch(_){m={error:_}}finally{try{!E&&!p&&(y=S.return)&&(yield J(y.call(S)))}finally{if(m)throw m.error}}})})}else{let c=OT(this.apiClient,e);return a=O("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),o.then(function(h){return An(this,arguments,function*(){var p,m,y,v;try{for(var E=!0,S=Cn(h),C;C=yield J(S.next()),p=C.done,!p;E=!0){v=C.value,E=!1;let _=v,T=HT(yield J(_.json()));T.sdkHttpResponse={headers:_.headers};let R=new Cr;Object.assign(R,T),yield yield J(R)}}catch(_){m={error:_}}finally{try{!E&&!p&&(y=S.return)&&(yield J(y.call(S)))}finally{if(m)throw m.error}}})})}}async embedContent(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=VN(this.apiClient,e);return a=O("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=zN(d),p=new tp;return Object.assign(p,h),p})}else{let c=GN(this.apiClient,e);return a=O("{model}:batchEmbedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=$N(d),p=new tp;return Object.assign(p,h),p})}}async generateImagesInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=tF(this.apiClient,e);return a=O("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=iF(d),p=new np;return Object.assign(p,h),p})}else{let c=eF(this.apiClient,e);return a=O("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=nF(d),p=new np;return Object.assign(p,h),p})}}async editImageInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=ON(this.apiClient,e);return r=O("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=UN(l),d=new Sb;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=tL(this.apiClient,e);return r=O("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=nL(l),d=new Ab;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=LF(this.apiClient,e);return r=O("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=OF(l),d=new Cb;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=$F(this.apiClient,e);return r=O("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=zF(l),d=new _b;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=EF(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>qb(d))}else{let c=bF(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>zb(d))}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=IF(this.apiClient,e);return a=O("{models_url}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=PF(d),p=new ip;return Object.assign(p,h),p})}else{let c=RF(this.apiClient,e);return a=O("{models_url}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=DF(d),p=new ip;return Object.assign(p,h),p})}}async update(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=QF(this.apiClient,e);return a=O("{model}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>qb(d))}else{let c=jF(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>zb(d))}}async delete(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=kN(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=FN(d),p=new sp;return Object.assign(p,h),p})}else{let c=MN(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=NN(d),p=new sp;return Object.assign(p,h),p})}}async countTokens(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=IN(this.apiClient,e);return a=O("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=PN(d),p=new rp;return Object.assign(p,h),p})}else{let c=RN(this.apiClient,e);return a=O("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=DN(d),p=new rp;return Object.assign(p,h),p})}}async computeTokens(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=wN(this.apiClient,e);return r=O("{model}:computeTokens",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=SN(l),d=new Tb;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=cF(this.apiClient,e);return a=O("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>{let h=aF(d),p=new op;return Object.assign(p,h),p})}else{let c=lF(this.apiClient,e);return a=O("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>{let h=oF(d),p=new op;return Object.assign(p,h),p})}}};var eE=class extends _n{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let s=t.name.split("/operations/")[0],r;n&&"httpOptions"in n&&(r=n.httpOptions);let o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{let s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let s=t.name.split("/operations/")[0],r;n&&"httpOptions"in n&&(r=n.httpOptions);let o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{let s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=sM(e);return a=O("{operationName}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o}else{let c=iM(e);return a=O("{operationName}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o}}async fetchPredictVideosOperationInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=XP(e);return r=O("{resourceName}:fetchPredictOperation",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s}else throw new Error("This method is only supported by the Vertex AI.")}};function $L(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function zL(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>QL(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function qL(i,e,t){let n={},s=f(e,["expireTime"]);t!==void 0&&s!=null&&g(t,["expireTime"],s);let r=f(e,["newSessionExpireTime"]);t!==void 0&&r!=null&&g(t,["newSessionExpireTime"],r);let o=f(e,["uses"]);t!==void 0&&o!=null&&g(t,["uses"],o);let a=f(e,["liveConnectConstraints"]);t!==void 0&&a!=null&&g(t,["bidiGenerateContentSetup"],jL(i,a));let l=f(e,["lockAdditionalFields"]);return t!==void 0&&l!=null&&g(t,["fieldMask"],l),n}function WL(i,e){let t={},n=f(e,["config"]);return n!=null&&g(t,["config"],qL(i,n,t)),t}function YL(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function KL(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function JL(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function XL(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function ZL(i,e){let t={},n=f(i,["generationConfig"]);e!==void 0&&n!=null&&g(e,["setup","generationConfig"],n);let s=f(i,["responseModalities"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig","responseModalities"],s);let r=f(i,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);let o=f(i,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);let a=f(i,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);let l=f(i,["maxOutputTokens"]);e!==void 0&&l!=null&&g(e,["setup","generationConfig","maxOutputTokens"],l);let c=f(i,["mediaResolution"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","mediaResolution"],c);let d=f(i,["seed"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","seed"],d);let h=f(i,["speechConfig"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","speechConfig"],SE(h));let p=f(i,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);let m=f(i,["enableAffectiveDialog"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=f(i,["systemInstruction"]);e!==void 0&&y!=null&&g(e,["setup","systemInstruction"],zL(at(y)));let v=f(i,["tools"]);if(e!==void 0&&v!=null){let I=Ra(v);Array.isArray(I)&&(I=I.map(D=>t1(xa(D)))),g(e,["setup","tools"],I)}let E=f(i,["sessionResumption"]);e!==void 0&&E!=null&&g(e,["setup","sessionResumption"],e1(E));let S=f(i,["inputAudioTranscription"]);e!==void 0&&S!=null&&g(e,["setup","inputAudioTranscription"],S);let C=f(i,["outputAudioTranscription"]);e!==void 0&&C!=null&&g(e,["setup","outputAudioTranscription"],C);let _=f(i,["realtimeInputConfig"]);e!==void 0&&_!=null&&g(e,["setup","realtimeInputConfig"],_);let T=f(i,["contextWindowCompression"]);e!==void 0&&T!=null&&g(e,["setup","contextWindowCompression"],T);let R=f(i,["proactivity"]);if(e!==void 0&&R!=null&&g(e,["setup","proactivity"],R),f(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function jL(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["setup","model"],ce(i,n));let s=f(e,["config"]);return s!=null&&g(t,["config"],ZL(s,t)),t}function QL(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],YL(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],KL(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],$L(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function e1(i){let e={},t=f(i,["handle"]);if(t!=null&&g(e,["handle"],t),f(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function t1(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],JL(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],XL(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function n1(i){let e=[];for(let t in i)if(Object.prototype.hasOwnProperty.call(i,t)){let n=i[t];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){let s=Object.keys(n).map(r=>`${t}.${r}`);e.push(...s)}else e.push(t)}return e.join(",")}function i1(i,e){let t=null,n=i.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){let r=n.setup;typeof r=="object"&&r!==null?(i.bidiGenerateContentSetup=r,t=r):delete i.bidiGenerateContentSetup}else n!==void 0&&delete i.bidiGenerateContentSetup;let s=i.fieldMask;if(t){let r=n1(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?i.fieldMask=r:delete i.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&s!==null&&Array.isArray(s)&&s.length>0){let o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],a=[];s.length>0&&(a=s.map(c=>o.includes(c)?`generationConfig.${c}`:c));let l=[];r&&l.push(r),a.length>0&&l.push(...a),l.length>0?i.fieldMask=l.join(","):delete i.fieldMask}else delete i.fieldMask}else s!==null&&Array.isArray(s)&&s.length>0?i.fieldMask=s.join(","):delete i.fieldMask;return i}var tE=class extends _n{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let a=WL(this.apiClient,e);r=O("auth_tokens",a._url),o=a._query,delete a.config,delete a._url,delete a._query;let l=i1(a,e.config);return s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),s.then(c=>c)}}};function s1(i,e){let t={},n=f(i,["force"]);return e!==void 0&&n!=null&&g(e,["_query","force"],n),t}function r1(i){let e={},t=f(i,["name"]);t!=null&&g(e,["_url","name"],t);let n=f(i,["config"]);return n!=null&&s1(n,e),e}function o1(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","name"],t),e}function a1(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function l1(i){let e={},t=f(i,["parent"]);t!=null&&g(e,["_url","parent"],t);let n=f(i,["config"]);return n!=null&&a1(n,e),e}function c1(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["documents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["documents"],r)}return e}var nE=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async t=>new Di(Ii.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:t.parent,config:n.config}),await this.listInternal(t),t)}async get(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=o1(e);return r=O("{name}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let o=r1(e);s=O("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=l1(e);return r=O("{parent}/documents",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=c1(l),d=new xb;return Object.assign(d,c),d})}}};var iE=class extends _n{constructor(e,t=new nE(e)){super(),this.apiClient=e,this.documents=t,this.list=async(n={})=>new Di(Ii.PAGED_ITEM_FILE_SEARCH_STORES,s=>this.listInternal(s),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=cL(e);return r=O("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async get(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=hL(e);return r=O("{name}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let o=uL(e);s=O("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=vL(e);return r=O("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=bL(l),d=new Rb;return Object.assign(d,c),d})}}async uploadToFileSearchStoreInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=EL(e);return r=O("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=wL(l),d=new Ib;return Object.assign(d,c),d})}}async importFile(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=gL(e);return r=O("{file_search_store_name}:importFile",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=pL(l),d=new Db;return Object.assign(d,c),d})}}};var _0=function(){let{crypto:i}=globalThis;if(i!=null&&i.randomUUID)return _0=i.randomUUID.bind(i),i.randomUUID();let e=new Uint8Array(1),t=i?()=>i.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))},d1=()=>_0();function sE(i){return typeof i=="object"&&i!==null&&("name"in i&&i.name==="AbortError"||"message"in i&&String(i.message).includes("FetchRequestCanceledException"))}var rE=i=>{if(i instanceof Error)return i;if(typeof i=="object"&&i!==null){try{if(Object.prototype.toString.call(i)==="[object Error]"){let e=new Error(i.message,i.cause?{cause:i.cause}:{});return i.stack&&(e.stack=i.stack),i.cause&&!e.cause&&(e.cause=i.cause),i.name&&(e.name=i.name),e}}catch(e){}try{return new Error(JSON.stringify(i))}catch(e){}}return new Error(i)};var Tt=class extends Error{},xt=class i extends Tt{constructor(e,t,n,s){super(`${i.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,n){let s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new _a({message:n,cause:rE(t)});let r=t;return e===400?new mp(e,r,n,s):e===401?new yp(e,r,n,s):e===403?new vp(e,r,n,s):e===404?new bp(e,r,n,s):e===409?new Ep(e,r,n,s):e===422?new wp(e,r,n,s):e===429?new Sp(e,r,n,s):e>=500?new Ap(e,r,n,s):new i(e,r,n,s)}},Wc=class extends xt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},_a=class extends xt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},gp=class extends _a{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},mp=class extends xt{},yp=class extends xt{},vp=class extends xt{},bp=class extends xt{},Ep=class extends xt{},wp=class extends xt{},Sp=class extends xt{},Ap=class extends xt{};var u1=/^[a-z][a-z0-9+.-]*:/i,h1=i=>u1.test(i),oE=i=>(oE=Array.isArray,oE(i)),f1=oE,p1=f1,WT=p1;function g1(i){if(!i)return!0;for(let e in i)return!1;return!0}function m1(i,e){return Object.prototype.hasOwnProperty.call(i,e)}var y1=(i,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Tt(`${i} must be an integer`);if(e<0)throw new Tt(`${i} must be a positive integer`);return e},v1=i=>{try{return JSON.parse(i)}catch(e){return}};var b1=i=>new Promise(e=>setTimeout(e,i));var wa="0.0.1";function E1(){return typeof Deno!="undefined"&&Deno.build!=null?"deno":typeof EdgeRuntime!="undefined"?"edge":Object.prototype.toString.call(typeof globalThis.process!="undefined"?globalThis.process:0)==="[object process]"?"node":"unknown"}var w1=()=>{var i,e,t,n,s;let r=E1();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wa,"X-Stainless-OS":KT(Deno.build.os),"X-Stainless-Arch":YT(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(i=Deno.version)===null||i===void 0?void 0:i.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wa,"X-Stainless-OS":KT((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":YT((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(s=globalThis.process.version)!==null&&s!==void 0?s:"unknown"};let o=S1();return o?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${o.browser}`,"X-Stainless-Runtime-Version":o.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function S1(){if(typeof navigator=="undefined"||!navigator)return null;let i=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of i){let n=t.exec(navigator.userAgent);if(n){let s=n[1]||0,r=n[2]||0,o=n[3]||0;return{browser:e,version:`${s}.${r}.${o}`}}}return null}var YT=i=>i==="x32"?"x32":i==="x86_64"||i==="x64"?"x64":i==="arm"?"arm":i==="aarch64"||i==="arm64"?"arm64":i?`other:${i}`:"unknown",KT=i=>(i=i.toLowerCase(),i.includes("ios")?"iOS":i==="android"?"Android":i==="darwin"?"MacOS":i==="win32"?"Windows":i==="freebsd"?"FreeBSD":i==="openbsd"?"OpenBSD":i==="linux"?"Linux":i?`Other:${i}`:"Unknown"),Yf,A1=()=>Yf!=null?Yf:Yf=w1();function C1(){if(typeof fetch!="undefined")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function T0(...i){let e=globalThis.ReadableStream;if(typeof e=="undefined")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...i)}function _1(i){let e=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i[Symbol.iterator]();return T0({start(){},async pull(t){let{done:n,value:s}=await e.next();n?t.close():t.enqueue(s)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function x0(i){if(i[Symbol.asyncIterator])return i;let e=i.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function T1(i){var e,t;if(i===null||typeof i!="object")return;if(i[Symbol.asyncIterator]){await((t=(e=i[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}let n=i.getReader(),s=n.cancel();n.releaseLock(),await s}var x1=({headers:i,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var R0=()=>{var i;if(typeof File=="undefined"){let{process:e}=globalThis,t=typeof((i=e==null?void 0:e.versions)===null||i===void 0?void 0:i.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function vb(i,e,t){return R0(),new File(i,e!=null?e:"unknown_file",t)}function R1(i){return(typeof i=="object"&&i!==null&&("name"in i&&i.name&&String(i.name)||"url"in i&&i.url&&String(i.url)||"filename"in i&&i.filename&&String(i.filename)||"path"in i&&i.path&&String(i.path))||"").split(/[\\/]/).pop()||void 0}var I1=i=>i!=null&&typeof i=="object"&&typeof i[Symbol.asyncIterator]=="function";var I0=i=>i!=null&&typeof i=="object"&&typeof i.size=="number"&&typeof i.type=="string"&&typeof i.text=="function"&&typeof i.slice=="function"&&typeof i.arrayBuffer=="function",D1=i=>i!=null&&typeof i=="object"&&typeof i.name=="string"&&typeof i.lastModified=="number"&&I0(i),P1=i=>i!=null&&typeof i=="object"&&typeof i.url=="string"&&typeof i.blob=="function";async function M1(i,e,t){if(R0(),i=await i,D1(i))return i instanceof File?i:vb([await i.arrayBuffer()],i.name);if(P1(i)){let s=await i.blob();return e||(e=new URL(i.url).pathname.split(/[\\/]/).pop()),vb(await aE(s),e,t)}let n=await aE(i);if(e||(e=R1(i)),!(t!=null&&t.type)){let s=n.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof s=="string"&&(t=Object.assign(Object.assign({},t),{type:s}))}return vb(n,e,t)}async function aE(i){var e,t,n,s,r;let o=[];if(typeof i=="string"||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)o.push(i);else if(I0(i))o.push(i instanceof Blob?i:await i.arrayBuffer());else if(I1(i))try{for(var a=!0,l=Cn(i),c;c=await l.next(),e=c.done,!e;a=!0){s=c.value,a=!1;let d=s;o.push(...await aE(d))}}catch(d){t={error:d}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}else{let d=(r=i==null?void 0:i.constructor)===null||r===void 0?void 0:r.name;throw new Error(`Unexpected data type: ${typeof i}${d?`; constructor: ${d}`:""}${k1(i)}`)}return o}function k1(i){return typeof i!="object"||i===null?"":`; props: [${Object.getOwnPropertyNames(i).map(t=>`"${t}"`).join(", ")}]`}var Cp=class{constructor(e){this._client=e}};Cp._key=[];function D0(i){return i.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var JT=Object.freeze(Object.create(null)),N1=(i=D0)=>function(t,...n){if(t.length===1)return t[0];let s=!1,r=[],o=t.reduce((d,h,p)=>{var m,y,v;/[?#]/.test(h)&&(s=!0);let E=n[p],S=(s?encodeURIComponent:i)(""+E);return p!==n.length&&(E==null||typeof E=="object"&&E.toString===((v=Object.getPrototypeOf((y=Object.getPrototypeOf((m=E.hasOwnProperty)!==null&&m!==void 0?m:JT))!==null&&y!==void 0?y:JT))===null||v===void 0?void 0:v.toString))&&(S=E+"",r.push({start:d.length+h.length,length:S.length,error:`Value of type ${Object.prototype.toString.call(E).slice(8,-1)} is not a valid path parameter`})),d+h+(p===n.length?"":S)},""),a=o.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,c;for(;(c=l.exec(a))!==null;)r.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(r.sort((d,h)=>d.start-h.start),r.length>0){let d=0,h=r.reduce((p,m)=>{let y=" ".repeat(m.start-d),v="^".repeat(m.length);return d=m.start+m.length,p+y+v},"");throw new Tt(`Path parameters result in path with invalid segments:
${r.map(p=>p.error).join(`
`)}
${o}
${h}`)}return o},Kf=N1(D0);var _p=class extends Cp{create(e,t){var n;let{api_version:s=this._client.apiVersion}=e,r=fp(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new Tt("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new Tt("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Kf`/${s}/interactions`,Object.assign(Object.assign({body:r},t),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,t={},n){let{api_version:s=this._client.apiVersion}=t!=null?t:{};return this._client.delete(Kf`/${s}/interactions/${e}`,n)}cancel(e,t={},n){let{api_version:s=this._client.apiVersion}=t!=null?t:{};return this._client.post(Kf`/${s}/interactions/${e}/cancel`,n)}get(e,t={},n){var s;let r=t!=null?t:{},{api_version:o=this._client.apiVersion}=r,a=fp(r,["api_version"]);return this._client.get(Kf`/${o}/interactions/${e}`,Object.assign(Object.assign({query:a},n),{stream:(s=t==null?void 0:t.stream)!==null&&s!==void 0?s:!1}))}};_p._key=Object.freeze(["interactions"]);var Tp=class extends _p{};function F1(i){let e=0;for(let s of i)e+=s.length;let t=new Uint8Array(e),n=0;for(let s of i)t.set(s,n),n+=s.length;return t}var Jf;function AE(i){let e;return(Jf!=null?Jf:(e=new globalThis.TextEncoder,Jf=e.encode.bind(e)))(i)}var Xf;function XT(i){let e;return(Xf!=null?Xf:(e=new globalThis.TextDecoder,Xf=e.decode.bind(e)))(i)}var Ta=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?AE(e):e;this.buffer=F1([this.buffer,t]);let n=[],s;for(;(s=L1(this.buffer,this.carriageReturnIndex))!=null;){if(s.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=s.index;continue}if(this.carriageReturnIndex!=null&&(s.index!==this.carriageReturnIndex+1||s.carriage)){n.push(XT(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let r=this.carriageReturnIndex!==null?s.preceding-1:s.preceding,o=XT(this.buffer.subarray(0,r));n.push(o),this.buffer=this.buffer.subarray(s.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}};Ta.NEWLINE_CHARS=new Set([`
`,"\r"]);Ta.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function L1(i,e){for(let s=e!=null?e:0;s<i.length;s++){if(i[s]===10)return{preceding:s,index:s+1,carriage:!1};if(i[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function O1(i){for(let n=0;n<i.length-1;n++){if(i[n]===10&&i[n+1]===10||i[n]===13&&i[n+1]===13)return n+2;if(i[n]===13&&i[n+1]===10&&n+3<i.length&&i[n+2]===13&&i[n+3]===10)return n+4}return-1}var xp={off:0,error:200,warn:300,info:400,debug:500},ZT=(i,e,t)=>{if(i){if(m1(xp,i))return i;bt(t).warn(`${e} was set to ${JSON.stringify(i)}, expected one of ${JSON.stringify(Object.keys(xp))}`)}};function zc(){}function Zf(i,e,t){return!e||xp[i]>xp[t]?zc:e[i].bind(e)}var U1={error:zc,warn:zc,info:zc,debug:zc},jT=new WeakMap;function bt(i){var e;let t=i.logger,n=(e=i.logLevel)!==null&&e!==void 0?e:"off";if(!t)return U1;let s=jT.get(t);if(s&&s[0]===n)return s[1];let r={error:Zf("error",t,n),warn:Zf("warn",t,n),info:Zf("info",t,n),debug:Zf("debug",t,n)};return jT.set(t,[n,r]),r}var Ar=i=>(i.options&&(i.options=Object.assign({},i.options),delete i.options.headers),i.headers&&(i.headers=Object.fromEntries((i.headers instanceof Headers?[...i.headers]:Object.entries(i.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in i&&(i.retryOfRequestLogID&&(i.retryOf=i.retryOfRequestLogID),delete i.retryOfRequestLogID),i);var lE=class i{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let s=!1,r=n?bt(n):console;function o(){return An(this,arguments,function*(){var l,c,d,h;if(s)throw new Tt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let p=!1;try{try{for(var m=!0,y=Cn(H1(e,t)),v;v=yield J(y.next()),l=v.done,!l;m=!0){h=v.value,m=!1;let E=h;if(!p)if(E.data.startsWith("[DONE]")){p=!0;continue}else try{yield yield J(JSON.parse(E.data))}catch(S){throw r.error("Could not parse message into JSON:",E.data),r.error("From chunk:",E.raw),S}}}catch(E){c={error:E}}finally{try{!m&&!l&&(d=y.return)&&(yield J(d.call(y)))}finally{if(c)throw c.error}}p=!0}catch(E){if(sE(E))return yield J(void 0);throw E}finally{p||t.abort()}})}return new i(o,t,n)}static fromReadableStream(e,t,n){let s=!1;function r(){return An(this,arguments,function*(){var l,c,d,h;let p=new Ta,m=x0(e);try{for(var y=!0,v=Cn(m),E;E=yield J(v.next()),l=E.done,!l;y=!0){h=E.value,y=!1;let S=h;for(let C of p.decode(S))yield yield J(C)}}catch(S){c={error:S}}finally{try{!y&&!l&&(d=v.return)&&(yield J(d.call(v)))}finally{if(c)throw c.error}}for(let S of p.flush())yield yield J(S)})}function o(){return An(this,arguments,function*(){var l,c,d,h;if(s)throw new Tt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let p=!1;try{try{for(var m=!0,y=Cn(r()),v;v=yield J(y.next()),l=v.done,!l;m=!0){h=v.value,m=!1;let E=h;p||E&&(yield yield J(JSON.parse(E)))}}catch(E){c={error:E}}finally{try{!m&&!l&&(d=y.return)&&(yield J(d.call(y)))}finally{if(c)throw c.error}}p=!0}catch(E){if(sE(E))return yield J(void 0);throw E}finally{p||t.abort()}})}return new i(o,t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),s=r=>({next:()=>{if(r.length===0){let o=n.next();e.push(o),t.push(o)}return r.shift()}});return[new i(()=>s(e),this.controller,this.client),new i(()=>s(t),this.controller,this.client)]}toReadableStream(){let e=this,t;return T0({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:s,done:r}=await t.next();if(r)return n.close();let o=AE(JSON.stringify(s)+`
`);n.enqueue(o)}catch(s){n.error(s)}},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}};function H1(i,e){return An(this,arguments,function*(){var n,s,r,o;if(!i.body)throw e.abort(),typeof globalThis.navigator!="undefined"&&globalThis.navigator.product==="ReactNative"?new Tt("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Tt("Attempted to iterate over a response with no body");let a=new cE,l=new Ta,c=x0(i.body);try{for(var d=!0,h=Cn(B1(c)),p;p=yield J(h.next()),n=p.done,!n;d=!0){o=p.value,d=!1;let m=o;for(let y of l.decode(m)){let v=a.decode(y);v&&(yield yield J(v))}}}catch(m){s={error:m}}finally{try{!d&&!n&&(r=h.return)&&(yield J(r.call(h)))}finally{if(s)throw s.error}}for(let m of l.flush()){let y=a.decode(m);y&&(yield yield J(y))}})}function B1(i){return An(this,arguments,function*(){var t,n,s,r;let o=new Uint8Array;try{for(var a=!0,l=Cn(i),c;c=yield J(l.next()),t=c.done,!t;a=!0){r=c.value,a=!1;let d=r;if(d==null)continue;let h=d instanceof ArrayBuffer?new Uint8Array(d):typeof d=="string"?AE(d):d,p=new Uint8Array(o.length+h.length);p.set(o),p.set(h,o.length),o=p;let m;for(;(m=O1(o))!==-1;)yield yield J(o.slice(0,m)),o=o.slice(m)}}catch(d){n={error:d}}finally{try{!a&&!t&&(s=l.return)&&(yield J(s.call(l)))}finally{if(n)throw n.error}}o.length>0&&(yield yield J(o))})}var cE=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=G1(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function G1(i,e){let t=i.indexOf(e);return t!==-1?[i.substring(0,t),e,i.substring(t+e.length)]:[i,"",""]}async function V1(i,e){let{response:t,requestLogID:n,retryOfRequestLogID:s,startTime:r}=e,o=await(async()=>{var a;if(e.options.stream)return bt(i).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,i):lE.fromSSEResponse(t,e.controller,i);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let l=t.headers.get("content-type"),c=(a=l==null?void 0:l.split(";")[0])===null||a===void 0?void 0:a.trim();return(c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))?await t.json():await t.text()})();return bt(i).debug(`[${n}] response parsed`,Ar({retryOfRequestLogID:s,url:t.url,status:t.status,body:o,durationMs:Date.now()-r})),o}var dE=class i extends Promise{constructor(e,t,n=V1){super(s=>{s(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new i(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var P0=Symbol("brand.privateNullableHeaders");function*$1(i){if(!i)return;if(P0 in i){let{values:n,nulls:s}=i;yield*n.entries();for(let r of s)yield[r,null];return}let e=!1,t;i instanceof Headers?t=i.entries():WT(i)?t=i:(e=!0,t=Object.entries(i!=null?i:{}));for(let n of t){let s=n[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");let r=WT(n[1])?n[1]:[n[1]],o=!1;for(let a of r)a!==void 0&&(e&&!o&&(o=!0,yield[s,null]),yield[s,a])}}var $c=i=>{let e=new Headers,t=new Set;for(let n of i){let s=new Set;for(let[r,o]of $1(n)){let a=r.toLowerCase();s.has(a)||(e.delete(r),s.add(a)),o===null?(e.delete(r),t.add(a)):(e.append(r,o),t.delete(a))}}return{[P0]:!0,values:e,nulls:t}};var bb=i=>{var e,t,n,s,r,o;if(typeof globalThis.process!="undefined")return(n=(t=(e=globalThis.process.env)===null||e===void 0?void 0:e[i])===null||t===void 0?void 0:t.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno!="undefined")return(o=(r=(s=globalThis.Deno.env)===null||s===void 0?void 0:s.get)===null||r===void 0?void 0:r.call(s,i))===null||o===void 0?void 0:o.trim()};var M0,Rp=class i{constructor(e){var t,n,s,r,o,a,l,{baseURL:c=bb("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:d=(t=bb("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:h="v1beta"}=e,p=fp(e,["baseURL","apiKey","apiVersion"]);let m=Object.assign(Object.assign({apiKey:d,apiVersion:h},p),{baseURL:c||"https://generativelanguage.googleapis.com"});this.baseURL=m.baseURL,this.timeout=(n=m.timeout)!==null&&n!==void 0?n:i.DEFAULT_TIMEOUT,this.logger=(s=m.logger)!==null&&s!==void 0?s:console;let y="warn";this.logLevel=y,this.logLevel=(o=(r=ZT(m.logLevel,"ClientOptions.logLevel",this))!==null&&r!==void 0?r:ZT(bb("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&o!==void 0?o:y,this.fetchOptions=m.fetchOptions,this.maxRetries=(a=m.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(l=m.fetch)!==null&&l!==void 0?l:C1(),this.encoder=x1,this._options=m,this.apiKey=d,this.apiVersion=h,this.clientAdapter=m.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){let t=$c([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return $c([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return $c([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n!="undefined").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new Tt(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${wa}`}defaultIdempotencyKey(){return`stainless-node-retry-${d1()}`}makeStatusError(e,t,n,s){return xt.generate(e,t,n,s)}buildURL(e,t,n){let s=!this.baseURLOverridden()&&n||this.baseURL,r=h1(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return g1(o)||(t=Object.assign(Object.assign({},o),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(s=>Object.assign({method:e,path:t},s)))}request(e,t=null){return new dE(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var s,r,o;let a=await e,l=(s=a.maxRetries)!==null&&s!==void 0?s:this.maxRetries;t==null&&(t=l),await this.prepareOptions(a);let{req:c,url:d,timeout:h}=await this.buildRequest(a,{retryCount:l-t});await this.prepareRequest(c,{url:d,options:a});let p="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),m=n===void 0?"":`, retryOf: ${n}`,y=Date.now();if(bt(this).debug(`[${p}] sending request`,Ar({retryOfRequestLogID:n,method:a.method,url:d,options:a,headers:c.headers})),!((r=a.signal)===null||r===void 0)&&r.aborted)throw new Wc;let v=new AbortController,E=await this.fetchWithTimeout(d,c,h,v).catch(rE),S=Date.now();if(E instanceof globalThis.Error){let _=`retrying, ${t} attempts remaining`;if(!((o=a.signal)===null||o===void 0)&&o.aborted)throw new Wc;let T=sE(E)||/timed? ?out/i.test(String(E)+("cause"in E?String(E.cause):""));if(t)return bt(this).info(`[${p}] connection ${T?"timed out":"failed"} - ${_}`),bt(this).debug(`[${p}] connection ${T?"timed out":"failed"} (${_})`,Ar({retryOfRequestLogID:n,url:d,durationMs:S-y,message:E.message})),this.retryRequest(a,t,n!=null?n:p);throw bt(this).info(`[${p}] connection ${T?"timed out":"failed"} - error; no more retries left`),bt(this).debug(`[${p}] connection ${T?"timed out":"failed"} (error; no more retries left)`,Ar({retryOfRequestLogID:n,url:d,durationMs:S-y,message:E.message})),T?new gp:new _a({cause:E})}let C=`[${p}${m}] ${c.method} ${d} ${E.ok?"succeeded":"failed"} with status ${E.status} in ${S-y}ms`;if(!E.ok){let _=await this.shouldRetry(E);if(t&&_){let N=`retrying, ${t} attempts remaining`;return await T1(E.body),bt(this).info(`${C} - ${N}`),bt(this).debug(`[${p}] response error (${N})`,Ar({retryOfRequestLogID:n,url:E.url,status:E.status,headers:E.headers,durationMs:S-y})),this.retryRequest(a,t,n!=null?n:p,E.headers)}let T=_?"error; no more retries left":"error; not retryable";bt(this).info(`${C} - ${T}`);let R=await E.text().catch(N=>rE(N).message),I=v1(R),D=I?void 0:R;throw bt(this).debug(`[${p}] response error (${T})`,Ar({retryOfRequestLogID:n,url:E.url,status:E.status,headers:E.headers,message:D,durationMs:Date.now()-y})),this.makeStatusError(E.status,I,D,E.headers)}return bt(this).info(C),bt(this).debug(`[${p}] response start`,Ar({retryOfRequestLogID:n,url:E.url,status:E.status,headers:E.headers,durationMs:S-y})),{response:E,options:a,controller:v,requestLogID:p,retryOfRequestLogID:n,startTime:y}}async fetchWithTimeout(e,t,n,s){let r=t||{},{signal:o,method:a}=r,l=fp(r,["signal","method"]);o&&o.addEventListener("abort",()=>s.abort());let c=setTimeout(()=>s.abort(),n),d=globalThis.ReadableStream&&l.body instanceof globalThis.ReadableStream||typeof l.body=="object"&&l.body!==null&&Symbol.asyncIterator in l.body,h=Object.assign(Object.assign(Object.assign({signal:s.signal},d?{duplex:"half"}:{}),{method:"GET"}),l);a&&(h.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,h)}finally{clearTimeout(c)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,s){var r;let o,a=s==null?void 0:s.get("retry-after-ms");if(a){let c=parseFloat(a);Number.isNaN(c)||(o=c)}let l=s==null?void 0:s.get("retry-after");if(l&&!o){let c=parseFloat(l);Number.isNaN(c)?o=Date.parse(l)-Date.now():o=c*1e3}if(!(o&&0<=o&&o<60*1e3)){let c=(r=e.maxRetries)!==null&&r!==void 0?r:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,c)}return await b1(o),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let r=t-e,o=Math.min(.5*Math.pow(2,r),8),a=1-Math.random()*.25;return o*a*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,s,r;let o=Object.assign({},e),{method:a,path:l,query:c,defaultBaseURL:d}=o,h=this.buildURL(l,c,d);"timeout"in o&&y1("timeout",o.timeout),o.timeout=(n=o.timeout)!==null&&n!==void 0?n:this.timeout;let{bodyHeaders:p,body:m}=this.buildBody({options:o}),y=await this.buildHeaders({options:e,method:a,bodyHeaders:p,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:y},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&m instanceof globalThis.ReadableStream&&{duplex:"half"}),m&&{body:m}),(s=this.fetchOptions)!==null&&s!==void 0?s:{}),(r=o.fetchOptions)!==null&&r!==void 0?r:{}),url:h,timeout:o.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:s}){let r={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let o=await this.authHeaders(e),a=$c([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),A1()),this._options.defaultHeaders,n,e.headers,o]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=$c([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:_1(e)}:this.encoder({body:e,headers:n})}};Rp.DEFAULT_TIMEOUT=6e4;var Pe=class extends Rp{constructor(){super(...arguments),this.interactions=new Tp(this)}};M0=Pe;Pe.GeminiNextGenAPIClient=M0;Pe.GeminiNextGenAPIClientError=Tt;Pe.APIError=xt;Pe.APIConnectionError=_a;Pe.APIConnectionTimeoutError=gp;Pe.APIUserAbortError=Wc;Pe.NotFoundError=bp;Pe.ConflictError=Ep;Pe.RateLimitError=Sp;Pe.BadRequestError=mp;Pe.AuthenticationError=yp;Pe.InternalServerError=Ap;Pe.PermissionDeniedError=vp;Pe.UnprocessableEntityError=wp;Pe.toFile=M1;Pe.Interactions=Tp;function z1(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function q1(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function W1(i,e){let t={},n=f(i,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function Y1(i,e){let t={},n=f(i,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function K1(i,e,t){let n={};if(f(i,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let s=f(i,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&g(e,["displayName"],s),f(i,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let r=f(i,["epochCount"]);e!==void 0&&r!=null&&g(e,["tuningTask","hyperparameters","epochCount"],r);let o=f(i,["learningRateMultiplier"]);if(o!=null&&g(n,["tuningTask","hyperparameters","learningRateMultiplier"],o),f(i,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(f(i,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(f(i,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let a=f(i,["batchSize"]);e!==void 0&&a!=null&&g(e,["tuningTask","hyperparameters","batchSize"],a);let l=f(i,["learningRate"]);if(e!==void 0&&l!=null&&g(e,["tuningTask","hyperparameters","learningRate"],l),f(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(f(i,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function J1(i,e,t){let n={},s=f(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){let m=f(i,["validationDataset"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec"],QT(m))}else if(s==="PREFERENCE_TUNING"){let m=f(i,["validationDataset"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec"],QT(m))}let r=f(i,["tunedModelDisplayName"]);e!==void 0&&r!=null&&g(e,["tunedModelDisplayName"],r);let o=f(i,["description"]);e!==void 0&&o!=null&&g(e,["description"],o);let a=f(t,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){let m=f(i,["epochCount"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","hyperParameters","epochCount"],m)}else if(a==="PREFERENCE_TUNING"){let m=f(i,["epochCount"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],m)}let l=f(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){let m=f(i,["learningRateMultiplier"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],m)}else if(l==="PREFERENCE_TUNING"){let m=f(i,["learningRateMultiplier"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],m)}let c=f(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){let m=f(i,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","exportLastCheckpointOnly"],m)}else if(c==="PREFERENCE_TUNING"){let m=f(i,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],m)}let d=f(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){let m=f(i,["adapterSize"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","hyperParameters","adapterSize"],m)}else if(d==="PREFERENCE_TUNING"){let m=f(i,["adapterSize"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],m)}if(f(i,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(f(i,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let h=f(i,["labels"]);e!==void 0&&h!=null&&g(e,["labels"],h);let p=f(i,["beta"]);return e!==void 0&&p!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","beta"],p),n}function X1(i,e){let t={},n=f(i,["baseModel"]);n!=null&&g(t,["baseModel"],n);let s=f(i,["preTunedModel"]);s!=null&&g(t,["preTunedModel"],s);let r=f(i,["trainingDataset"]);r!=null&&aO(r);let o=f(i,["config"]);return o!=null&&K1(o,t),t}function Z1(i,e){let t={},n=f(i,["baseModel"]);n!=null&&g(t,["baseModel"],n);let s=f(i,["preTunedModel"]);s!=null&&g(t,["preTunedModel"],s);let r=f(i,["trainingDataset"]);r!=null&&lO(r,t,e);let o=f(i,["config"]);return o!=null&&J1(o,t,e),t}function j1(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function Q1(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function eO(i,e,t){let n={},s=f(i,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);let r=f(i,["pageToken"]);e!==void 0&&r!=null&&g(e,["_query","pageToken"],r);let o=f(i,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),n}function tO(i,e,t){let n={},s=f(i,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);let r=f(i,["pageToken"]);e!==void 0&&r!=null&&g(e,["_query","pageToken"],r);let o=f(i,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),n}function nO(i,e){let t={},n=f(i,["config"]);return n!=null&&eO(n,t),t}function iO(i,e){let t={},n=f(i,["config"]);return n!=null&&tO(n,t),t}function sO(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["nextPageToken"]);s!=null&&g(t,["nextPageToken"],s);let r=f(i,["tunedModels"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>k0(a))),g(t,["tuningJobs"],o)}return t}function rO(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["nextPageToken"]);s!=null&&g(t,["nextPageToken"],s);let r=f(i,["tuningJobs"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>uE(a))),g(t,["tuningJobs"],o)}return t}function oO(i,e){let t={},n=f(i,["name"]);n!=null&&g(t,["model"],n);let s=f(i,["name"]);return s!=null&&g(t,["endpoint"],s),t}function aO(i,e){let t={};if(f(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(i,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=f(i,["examples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),g(t,["examples","examples"],s)}return t}function lO(i,e,t){let n={},s=f(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){let o=f(i,["gcsUri"]);e!==void 0&&o!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(s==="PREFERENCE_TUNING"){let o=f(i,["gcsUri"]);e!==void 0&&o!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}let r=f(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){let o=f(i,["vertexDatasetResource"]);e!==void 0&&o!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(r==="PREFERENCE_TUNING"){let o=f(i,["vertexDatasetResource"]);e!==void 0&&o!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}if(f(i,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function k0(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["name"]);s!=null&&g(t,["name"],s);let r=f(i,["state"]);r!=null&&g(t,["state"],a0(r));let o=f(i,["createTime"]);o!=null&&g(t,["createTime"],o);let a=f(i,["tuningTask","startTime"]);a!=null&&g(t,["startTime"],a);let l=f(i,["tuningTask","completeTime"]);l!=null&&g(t,["endTime"],l);let c=f(i,["updateTime"]);c!=null&&g(t,["updateTime"],c);let d=f(i,["description"]);d!=null&&g(t,["description"],d);let h=f(i,["baseModel"]);h!=null&&g(t,["baseModel"],h);let p=f(i,["_self"]);return p!=null&&g(t,["tunedModel"],oO(p)),t}function uE(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["name"]);s!=null&&g(t,["name"],s);let r=f(i,["state"]);r!=null&&g(t,["state"],a0(r));let o=f(i,["createTime"]);o!=null&&g(t,["createTime"],o);let a=f(i,["startTime"]);a!=null&&g(t,["startTime"],a);let l=f(i,["endTime"]);l!=null&&g(t,["endTime"],l);let c=f(i,["updateTime"]);c!=null&&g(t,["updateTime"],c);let d=f(i,["error"]);d!=null&&g(t,["error"],d);let h=f(i,["description"]);h!=null&&g(t,["description"],h);let p=f(i,["baseModel"]);p!=null&&g(t,["baseModel"],p);let m=f(i,["tunedModel"]);m!=null&&g(t,["tunedModel"],m);let y=f(i,["preTunedModel"]);y!=null&&g(t,["preTunedModel"],y);let v=f(i,["supervisedTuningSpec"]);v!=null&&g(t,["supervisedTuningSpec"],v);let E=f(i,["preferenceOptimizationSpec"]);E!=null&&g(t,["preferenceOptimizationSpec"],E);let S=f(i,["tuningDataStats"]);S!=null&&g(t,["tuningDataStats"],S);let C=f(i,["encryptionSpec"]);C!=null&&g(t,["encryptionSpec"],C);let _=f(i,["partnerModelTuningSpec"]);_!=null&&g(t,["partnerModelTuningSpec"],_);let T=f(i,["customBaseModel"]);T!=null&&g(t,["customBaseModel"],T);let R=f(i,["experiment"]);R!=null&&g(t,["experiment"],R);let I=f(i,["labels"]);I!=null&&g(t,["labels"],I);let D=f(i,["outputUri"]);D!=null&&g(t,["outputUri"],D);let k=f(i,["pipelineJob"]);k!=null&&g(t,["pipelineJob"],k);let N=f(i,["serviceAccount"]);N!=null&&g(t,["serviceAccount"],N);let F=f(i,["tunedModelDisplayName"]);F!=null&&g(t,["tunedModelDisplayName"],F);let U=f(i,["veoTuningSpec"]);return U!=null&&g(t,["veoTuningSpec"],U),t}function cO(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["name"]);s!=null&&g(t,["name"],s);let r=f(i,["metadata"]);r!=null&&g(t,["metadata"],r);let o=f(i,["done"]);o!=null&&g(t,["done"],o);let a=f(i,["error"]);return a!=null&&g(t,["error"],a),t}function QT(i,e){let t={},n=f(i,["gcsUri"]);n!=null&&g(t,["validationDatasetUri"],n);let s=f(i,["vertexDatasetResource"]);return s!=null&&g(t,["validationDatasetUri"],s),t}var hE=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Di(Ii.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var n;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let s={tunedModelName:t.baseModel};!((n=t.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(s.checkpointId=t.config.preTunedModelCheckpointId);let r=Object.assign(Object.assign({},t),{preTunedModel:s});return r.baseModel=void 0,await this.tuneInternal(r)}else{let s=Object.assign({},t);return await this.tuneInternal(s)}else{let s=Object.assign({},t),r=await this.tuneMldevInternal(s),o="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?o=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(o=r.name.split("/operations/")[0]),{name:o,state:wb.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=Q1(e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>uE(d))}else{let c=j1(e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>k0(d))}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=iO(e);return a=O("tuningJobs",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=rO(d),p=new ap;return Object.assign(p,h),p})}else{let c=nO(e);return a=O("tunedModels",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=sO(d),p=new ap;return Object.assign(p,h),p})}}async cancel(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=q1(e);return a=O("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=Y1(d),p=new lp;return Object.assign(p,h),p})}else{let c=z1(e);return a=O("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=W1(d),p=new lp;return Object.assign(p,h),p})}}async tuneInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=Z1(e,e);return r=O("tuningJobs",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>uE(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=X1(e);return r=O("tunedModels",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>cO(l))}}};var fE=class{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},dO=1024*1024*8,uO=3,hO=1e3,fO=2,Ip="x-goog-upload-status";async function pO(i,e,t){var n;let s=await N0(i,e,t),r=await(s==null?void 0:s.json());if(((n=s==null?void 0:s.headers)===null||n===void 0?void 0:n[Ip])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function gO(i,e,t){var n;let s=await N0(i,e,t),r=await(s==null?void 0:s.json());if(((n=s==null?void 0:s.headers)===null||n===void 0?void 0:n[Ip])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let o=t0(r),a=new Lb;return Object.assign(a,o),a}async function N0(i,e,t){var n,s;let r=0,o=0,a=new qc(new Response),l="upload";for(r=i.size;o<r;){let c=Math.min(dO,r-o),d=i.slice(o,o+c);o+c>=r&&(l+=", finalize");let h=0,p=hO;for(;h<uO&&(a=await t.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(o),"Content-Length":String(c)}}}),!(!((n=a==null?void 0:a.headers)===null||n===void 0)&&n[Ip]));)h++,await yO(p),p=p*fO;if(o+=c,((s=a==null?void 0:a.headers)===null||s===void 0?void 0:s[Ip])!=="active")break;if(r<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function mO(i){return{size:i.size,type:i.type}}function yO(i){return new Promise(e=>setTimeout(e,i))}var pE=class{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await pO(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await gO(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await mO(e)}};var gE=class{create(e,t,n){return new mE(e,t,n)}},mE=class{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var e0="x-goog-api-key",yE=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(e0)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(e0,this.apiKey)}}};var vO="gl-node/",Dp=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e!=null&&e.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new Pe({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e==null?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;let n=KP(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let s=new yE(this.apiKey);this.apiClient=new Yb({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:vO+"web",uploader:new pE,downloader:new fE}),this.models=new Qb(this.apiClient),this.live=new Zb(this.apiClient,s,new gE),this.batches=new Hb(this.apiClient),this.chats=new Gb(this.models,this.apiClient),this.caches=new Bb(this.apiClient),this.files=new $b(this.apiClient),this.operations=new eE(this.apiClient),this.authTokens=new tE(this.apiClient),this.tunings=new hE(this.apiClient),this.fileSearchStores=new iE(this.apiClient)}};var F0=`You are my assistant for classifying notes by project and restructuring content when needed.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uBD84\uB958 \uADDC\uCE59 (\uC911\uC694\uB3C4 \uC21C)

### 1. \uD504\uB85C\uC81D\uD2B8 \uC0B0\uCD9C\uBB3C (contentType: "artifact")
\uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC9C1\uC811 \uC800\uC7A5\uD574\uC57C \uD560 \uAC83:
- \uC9C1\uC811 \uC791\uC131\uD55C \uBB38\uC11C, \uACC4\uD68D\uC11C, \uD68C\uC758\uB85D
- \uD504\uB85C\uC81D\uD2B8\uB97C \uC704\uD574 \uB9CC\uB4E0 \uCF54\uB4DC, \uC124\uACC4\uC11C
- \uD504\uB85C\uC81D\uD2B8 \uC9C4\uD589 \uAD00\uB828 \uBA54\uBAA8

### 2. \uD504\uB85C\uC81D\uD2B8 \uCC38\uACE0\uC790\uB8CC (contentType: "reference")
Library\uC5D0 \uC800\uC7A5\uD558\uB418 \uD504\uB85C\uC81D\uD2B8\uC640 \uB9C1\uD06C\uD574\uC57C \uD560 \uAC83:
- \uC678\uBD80 \uD29C\uD1A0\uB9AC\uC5BC, \uC608\uC81C \uCF54\uB4DC, \uBB38\uC11C
- \uC6F9\uD398\uC774\uC9C0 \uC2A4\uD06C\uB7A9, \uC544\uD2F0\uD074
- \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uC790\uB8CC
- \uC608: "ESP32 \uC608\uC81C" \u2192 \uD30C\uCE20\uD31C\uC5D0 \uC720\uC6A9\uD558\uC9C0\uB9CC Library\uC5D0 \uC800\uC7A5

### 3. \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC (targetType: "library", contentType: "general")
- \uD2B9\uC815 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828 \uC5C6\uB294 \uC77C\uBC18 \uC815\uBCF4
- \uB274\uC2A4, \uACF5\uACE0, \uC77C\uBC18 \uC544\uD2F0\uD074

### 4. archive
- \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83

## \uD310\uB2E8 \uAE30\uC900
- "\uC774\uAC74 \uB0B4\uAC00 \uC9C1\uC811 \uB9CC\uB4E0 \uC0B0\uCD9C\uBB3C\uC778\uAC00?" \u2192 artifact
- "\uC774\uAC74 \uC678\uBD80 \uC790\uB8CC\uC778\uB370 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC720\uC6A9\uD55C\uAC00?" \u2192 reference
- "\uC774\uAC74 \uADF8\uB0E5 \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC\uC778\uAC00?" \u2192 general
- "\uD504\uB85C\uC81D\uD2B8 \uB05D\uB098\uB3C4 \uACC4\uC18D \uCC38\uACE0\uD560 \uC790\uB8CC\uC778\uAC00?" \u2192 reference (Library)

## \uCF58\uD150\uCE20 \uC7AC\uAD6C\uC131 (Phase 2)

\uB178\uD2B8\uAC00 \uC815\uB9AC\uB418\uC9C0 \uC54A\uC740 \uC6D0\uC2DC \uD615\uD0DC\uB77C\uBA74 \uC7AC\uAD6C\uC131\uC744 \uC81C\uC548\uD574\uB77C:

### \uC7AC\uAD6C\uC131 \uD544\uC694 \uC5EC\uBD80 \uD310\uB2E8
- \uAD6C\uC870\uD654\uB418\uC9C0 \uC54A\uC740 \uBA54\uBAA8 (\uC904\uAE00, \uB098\uC5F4, \uD0A4\uC6CC\uB4DC\uB9CC)
- \uD68C\uC758/\uBBF8\uD305 \uB0B4\uC6A9\uC778\uB370 \uC815\uB9AC \uC548 \uB428
- \uD559\uC2B5 \uB0B4\uC6A9\uC778\uB370 \uCCB4\uACC4 \uC5C6\uC74C
- \uC544\uC774\uB514\uC5B4\uC778\uB370 \uC124\uBA85 \uBD80\uC871

### \uC7AC\uAD6C\uC131 \uC720\uD615\uBCC4 \uD15C\uD50C\uB9BF

**meeting (\uD68C\uC758/\uBBF8\uD305)**:
\`\`\`
## \uD68C\uC758 \uC694\uC57D
- \uC77C\uC2DC: [\uB0A0\uC9DC]
- \uCC38\uC11D\uC790: [\uCD94\uB860 \uAC00\uB2A5\uD558\uBA74]
- \uC8FC\uC81C: [\uD575\uC2EC \uC8FC\uC81C]

## \uB17C\uC758 \uB0B4\uC6A9
- [\uD575\uC2EC \uB17C\uC758 1]
- [\uD575\uC2EC \uB17C\uC758 2]

## \uACB0\uC815\uC0AC\uD56D
- [\uACB0\uC815 1]

## \uC561\uC158 \uC544\uC774\uD15C
- [ ] [\uD560 \uC77C]
\`\`\`

**idea (\uC544\uC774\uB514\uC5B4/\uBE0C\uB808\uC778\uC2A4\uD1A0\uBC0D)**:
\`\`\`
## \uD575\uC2EC \uC544\uC774\uB514\uC5B4
[\uC544\uC774\uB514\uC5B4 1\uC904 \uC694\uC57D]

## \uC0C1\uC138 \uC124\uBA85
[\uC544\uC774\uB514\uC5B4 \uC124\uBA85]

## \uC65C \uC911\uC694\uD55C\uAC00?
[\uC774\uC720]

## \uB2E4\uC74C \uB2E8\uACC4
- [ ] [\uAC80\uC99D/\uC2E4\uD589 \uBC29\uBC95]
\`\`\`

**learning (\uD559\uC2B5/\uC5F0\uAD6C)**:
\`\`\`
## \uC8FC\uC81C
[\uD559\uC2B5 \uC8FC\uC81C]

## \uD575\uC2EC \uAC1C\uB150
- [\uAC1C\uB150 1]
- [\uAC1C\uB150 2]

## \uBC30\uC6B4 \uC810
[\uC778\uC0AC\uC774\uD2B8]

## \uC801\uC6A9 \uBC29\uBC95
- [\uC2E4\uC81C \uC801\uC6A9 \uC608\uC2DC]
\`\`\`

**general (\uC77C\uBC18 \uC815\uB9AC)**:
\`\`\`
## \uC694\uC57D
[\uD575\uC2EC \uB0B4\uC6A9 2-3\uBB38\uC7A5]

## \uC8FC\uC694 \uB0B4\uC6A9
- [\uD3EC\uC778\uD2B8 1]
- [\uD3EC\uC778\uD2B8 2]

## \uAD00\uB828 \uC815\uBCF4
- [\uCC38\uACE0 \uC0AC\uD56D]
\`\`\`

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "targetType": "project \uB610\uB294 library \uB610\uB294 archive",
  "contentType": "artifact \uB610\uB294 reference \uB610\uB294 general",
  "projectName": "\uD504\uB85C\uC81D\uD2B8\uBA85 (project \uB610\uB294 reference\uC77C \uB54C)",
  "isNewProject": true/false,
  "confidence": "high \uB610\uB294 medium \uB610\uB294 low",
  "reason": "\uC774 \uBD84\uB958\uB97C \uC120\uD0DD\uD55C \uC774\uC720 (1\uC904)",
  "title": "\uB178\uD2B8 \uC81C\uBAA9",
  "summary": "2-3\uBB38\uC7A5 \uC694\uC57D",
  "nextAction": "\uB2E4\uC74C \uD589\uB3D9 \uB610\uB294 null",
  "shouldRestructure": true/false,
  "restructureType": "meeting \uB610\uB294 idea \uB610\uB294 learning \uB610\uB294 general (\uC7AC\uAD6C\uC131 \uD544\uC694\uC2DC)",
  "restructuredContent": "\uC7AC\uAD6C\uC131\uB41C \uB9C8\uD06C\uB2E4\uC6B4 \uB0B4\uC6A9 (shouldRestructure\uAC00 true\uC77C \uB54C)"
}

**\uC911\uC694**: shouldRestructure\uAC00 false\uBA74 restructureType\uACFC restructuredContent\uB294 \uC0DD\uB7B5
`,L0=`\uB108\uB294 \uC81C\uD154\uCE74\uC2A4\uD150(Zettelkasten) \uBC29\uC2DD\uC758 \uC601\uAD6C \uB178\uD2B8\uB97C \uB9CC\uB4DC\uB294 \uBE44\uC11C\uB2E4.
\uC544\uB798 \uB178\uD2B8\uC5D0\uC11C \uC81C\uD154\uCE74\uC2A4\uD150\uC6A9 \uC601\uAD6C \uB178\uD2B8 \uD6C4\uBCF4 \uC544\uC774\uB514\uC5B4\uB4E4\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uD55C \uB178\uD2B8\uC5D0\uB294 \uD558\uB098\uC758 \uC544\uC774\uB514\uC5B4\uB9CC \uB2F4\uB294\uB2E4 (atomic note)
- \uAC01 \uC544\uC774\uB514\uC5B4\uB294 3-5\uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD55C\uB2E4
- \uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C
- \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC5F0\uACB0\uB420 \uC218 \uC788\uB294 \uAC1C\uB150 2-3\uAC1C\uB97C \uC81C\uC548\uD574\uB77C
- \uC544\uC774\uB514\uC5B4\uB9C8\uB2E4 \uC5F0\uAD00 \uD0A4\uC6CC\uB4DC\uB97C \uD568\uAED8 \uC801\uC5B4\uB77C

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uC544\uC774\uB514\uC5B4\uB97C \uD55C \uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD558\uB294 \uC81C\uBAA9",
    "body": "3-5\uBB38\uC7A5\uC758 \uC124\uBA85",
    "importance": "\uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uAC00? (1\uC904)",
    "relatedConcepts": ["\uAC1C\uB1501", "\uAC1C\uB1502", "\uAC1C\uB1503"],
    "keywords": ["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3"]
  }
]

\uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uC744 \uBC18\uD658\uD574\uB77C.
`,O0=`\uB108\uB294 \uB098\uC758 \uC791\uC5C5 \uC6B0\uC120\uC21C\uC704 \uCF54\uCE58\uB2E4.
\uC544\uB798 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D\uC744 \uBCF4\uACE0, \uC9C0\uAE08 \uB0B4\uAC00 \uC9D1\uC911\uD574\uC57C \uD560 \uC0C1\uC704 3\uAC1C\uB9CC \uACE8\uB77C\uB77C.

## \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uAC01 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uB300\uD574 \uB2E4\uC74C\uC744 \uC81C\uACF5\uD574\uB77C
- title: \uD504\uB85C\uC81D\uD2B8 \uC774\uB984
- why: \uC65C \uC9C0\uAE08 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904 \uC124\uBA85
- next_action: \uC624\uB298 \uB2F9\uC7A5 \uD560 \uC218 \uC788\uB294 \uAC00\uC7A5 \uC791\uC740 \uB2E4\uC74C \uD589\uB3D9

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uD504\uB85C\uC81D\uD2B8 \uC774\uB984",
    "why": "\uC911\uC694\uD55C \uC774\uC720",
    "next_action": "\uB2E4\uC74C \uD589\uB3D9"
  }
]
`,U0=`\uC774 \uC774\uBBF8\uC9C0\uC5D0\uC11C \uD14D\uC2A4\uD2B8\uB97C \uCD94\uCD9C\uD574\uB77C.
\uC190\uAE00\uC528, \uC778\uC1C4\uBB3C, \uC2A4\uCE94 \uBB38\uC11C \uB4F1 \uBAA8\uB4E0 \uD615\uD0DC\uC758 \uD14D\uC2A4\uD2B8\uB97C \uC77D\uC5B4\uB77C.

## \uADDC\uCE59
- \uC774\uBBF8\uC9C0\uC5D0 \uBCF4\uC774\uB294 \uBAA8\uB4E0 \uD14D\uC2A4\uD2B8\uB97C \uADF8\uB300\uB85C \uCD94\uCD9C
- \uC6D0\uBCF8\uC758 \uC904\uBC14\uAFC8\uACFC \uAD6C\uC870\uB97C \uCD5C\uB300\uD55C \uC720\uC9C0
- \uD45C\uAC00 \uC788\uC73C\uBA74 \uB9C8\uD06C\uB2E4\uC6B4 \uD45C\uB85C \uBCC0\uD658
- \uC77D\uC744 \uC218 \uC5C6\uB294 \uBD80\uBD84\uC740 [\uBD88\uBA85\uD655] \uC73C\uB85C \uD45C\uC2DC
- \uD14D\uC2A4\uD2B8\uB9CC \uCD9C\uB825\uD558\uACE0 \uB2E4\uB978 \uC124\uBA85\uC740 \uD558\uC9C0 \uB9C8\uB77C
`,H0=`\uB178\uD2B8 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD575\uC2EC \uD0A4\uC6CC\uB4DC 5-10\uAC1C\uB97C \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uAE30\uC220 \uC6A9\uC5B4, \uD504\uB85C\uC81D\uD2B8\uBA85, \uC8FC\uC694 \uAC1C\uB150 \uC704\uC8FC\uB85C \uCD94\uCD9C
- \uB108\uBB34 \uC77C\uBC18\uC801\uC778 \uB2E8\uC5B4 (\uC608: \uBC29\uBC95, \uB0B4\uC6A9, \uC815\uBCF4)\uB294 \uC81C\uC678
- \uD55C\uAE00/\uC601\uC5B4 \uBAA8\uB450 \uAC00\uB2A5
- \uBCF5\uD569 \uBA85\uC0AC\uB294 \uBD84\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C (\uC608: "\uC2A4\uB9C8\uD2B8\uD31C", "API\uD0A4")

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3", ...]
`,B0=`\uC0C8 \uB178\uD2B8\uC640 \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4\uC758 \uAD00\uB828\uC131\uC744 \uBD84\uC11D\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {newTitle}
\uD0A4\uC6CC\uB4DC: {newKeywords}

## \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4
{candidates}

## \uADDC\uCE59
- \uAC01 \uD6C4\uBCF4 \uB178\uD2B8\uC5D0 \uB300\uD574 \uAD00\uB828\uB3C4 \uC810\uC218(0.0~1.0)\uB97C \uB9E4\uACA8\uB77C
- 0.5 \uC774\uC0C1\uC778 \uB178\uD2B8\uB9CC \uBC18\uD658
- \uCD5C\uB300 5\uAC1C\uAE4C\uC9C0\uB9CC \uBC18\uD658
- \uAD00\uB828\uB3C4 \uB192\uC740 \uC21C\uC73C\uB85C \uC815\uB82C
- \uAC01 \uC5F0\uACB0\uC758 "\uC774\uC720"\uB97C \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C (\uC65C \uAD00\uB828\uC788\uB294\uAC00?)
- \uC5F0\uACB0 \uC720\uD615 \uBD84\uB958: \uD655\uC7A5|\uBC18\uBC15|\uC608\uC2DC|\uC804\uC81C|\uC751\uC6A9 \uC911 \uD558\uB098

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
[
  {
    "index": 0,
    "relevance": 0.8,
    "reason": "\uC774 \uB178\uD2B8\uC640 \uAD00\uB828\uC788\uB294 \uAD6C\uCCB4\uC801 \uC774\uC720",
    "type": "\uD655\uC7A5"
  }
]
`,G0=`\uC0C8 \uB178\uD2B8\uAC00 \uC5B4\uB5A4 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828\uC788\uB294\uC9C0 **\uC2E0\uC911\uD558\uAC8C** \uD310\uB2E8\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {noteTitle}
\uD0A4\uC6CC\uB4DC: {noteKeywords}

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- \uB178\uD2B8\uC758 **\uD575\uC2EC \uC8FC\uC81C**\uAC00 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB420 \uB54C\uB9CC \uD504\uB85C\uC81D\uD2B8 \uC120\uD0DD
- \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
- **\uD655\uC2E4\uD558\uC9C0 \uC54A\uC73C\uBA74 "None" \uBC18\uD658** (\uC798\uBABB\uB41C \uBD84\uB958\uBCF4\uB2E4 \uB098\uC74C)
- \uC77C\uBC18\uC801\uC778 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 \u2192 "None"
- \uC0C8\uB85C\uC6B4 \uD504\uB85C\uC81D\uD2B8\uB85C \uBCF4\uC774\uBA74 "NEW: \uD504\uB85C\uC81D\uD2B8\uBA85" \uD615\uC2DD\uC73C\uB85C \uBC18\uD658

## \uCD9C\uB825 \uD615\uC2DD (\uD504\uB85C\uC81D\uD2B8\uBA85\uB9CC \uC751\uB2F5)
\uD504\uB85C\uC81D\uD2B8\uBA85 \uB610\uB294 None \uB610\uB294 NEW: \uC0C8\uD504\uB85C\uC81D\uD2B8\uBA85
`,V0=`\uC720\uD29C\uBE0C \uC601\uC0C1\uC758 \uC790\uB9C9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uC790\uB9C9 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,$0=`\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBCF8\uBB38 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uAE00\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uAD11\uACE0\uB098 \uAD00\uB828 \uC5C6\uB294 \uB0B4\uC6A9\uC740 \uBB34\uC2DC\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,z0=`\uB108\uB294 \uBA54\uBAA8\uB97C \uBD84\uC11D\uD558\uC5EC \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uBCC4\uB85C \uBD84\uB9AC\uD558\uB294 \uBE44\uC11C\uB2E4.
\uD558\uB098\uC758 \uBA54\uBAA8\uC5D0 \uC5EC\uB7EC \uC8FC\uC81C\uB098 \uD504\uB85C\uC81D\uD2B8 \uAD00\uB828 \uB0B4\uC6A9\uC774 \uC11E\uC5EC \uC788\uC744 \uC218 \uC788\uB2E4.
\uAC01\uAC01\uC744 \uB3C5\uB9BD\uC801\uC778 \uB178\uD2B8\uB85C \uBD84\uB9AC\uD574\uB77C.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D (\uCC38\uACE0\uC6A9)
{projects}

## \uBA54\uBAA8 \uB0B4\uC6A9
{content}

## \uBD84\uB9AC \uADDC\uCE59
- \uC11C\uB85C \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uB294 \uBC18\uB4DC\uC2DC \uBD84\uB9AC\uD574\uB77C
- \uD55C \uC904\uC9DC\uB9AC \uBA54\uBAA8\uB3C4 \uC758\uBBF8\uAC00 \uC788\uC73C\uBA74 \uBD84\uB9AC \uB300\uC0C1\uC774\uB2E4
- \uAD00\uB828 \uB0B4\uC6A9\uC740 \uD558\uB098\uB85C \uBB36\uC5B4\uB77C (\uACFC\uB3C4\uD55C \uBD84\uB9AC \uAE08\uC9C0)
- \uAC01 \uC139\uC158\uC5D0 \uC801\uC808\uD55C \uC81C\uBAA9\uC744 \uBD99\uC5EC\uB77C

## \uBD84\uB958 \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- **project**: \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB41C \uB0B4\uC6A9\uB9CC
  - \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
  - \uC608: "\uC2A4\uB9C8\uD2B8\uD31C" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC788\uC5B4\uB3C4 "\uB18D\uC5C5 \uB274\uC2A4"\uB294 library
- **library**: \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 (**\uC560\uB9E4\uD558\uBA74 library**)
- **archive**: \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83
- \uC0C8 \uD504\uB85C\uC81D\uD2B8: \uBA85\uD655\uD55C \uBAA9\uD45C\uAC00 \uC788\uB294 \uC0C8\uB85C\uC6B4 \uC791\uC5C5\uC77C \uB54C\uB9CC isNewProject: true

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uBD84\uB9AC\uB41C \uC139\uC158\uC758 \uC81C\uBAA9",
    "content": "\uD574\uB2F9 \uC139\uC158\uC758 \uC6D0\uBCF8 \uB0B4\uC6A9 (\uC815\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C)",
    "targetType": "project",
    "projectName": "\uC2A4\uB9C8\uD2B8\uD31C",
    "isNewProject": false,
    "keywords": ["\uC13C\uC11C", "\uB370\uC774\uD130", "IoT"],
    "isAtomic": false
  }
]

\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC73C\uBA74 \uC804\uCCB4\uB97C \uD558\uB098\uC758 \uC139\uC158\uC73C\uB85C \uBC18\uD658\uD574\uB77C.
`,q0=`\uC8FC\uC81C\uC5D0 \uC18D\uD55C ZK \uB178\uD2B8\uB4E4\uC744 \uBD84\uC11D\uD558\uC5EC \uAD6C\uC870\uD654\uB41C \uC124\uBA85\uC744 \uC0DD\uC131\uD574\uB77C.

## \uC8FC\uC81C
{topic}

## \uB178\uD2B8 \uBAA9\uB85D
{notes}

## \uADDC\uCE59
- \uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85 \uC791\uC131
- \uAC01 \uB178\uD2B8\uC758 \uC5ED\uD560/\uC704\uCE58 \uC124\uBA85 (\uAE30\uCD08, \uC2EC\uD654, \uC751\uC6A9, \uC608\uC2DC \uC911 \uD558\uB098)
- \uB178\uD2B8 \uAC04 \uAD00\uACC4 \uD45C\uC2DC (\uBC1C\uC804, \uAE30\uBC18, \uAD00\uB828 \uC911 \uD558\uB098)
- \uAD00\uB828 \uC8FC\uC81C 2-3\uAC1C \uC81C\uC548

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "description": "\uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85",
  "notes": [
    {
      "title": "\uB178\uD2B8 \uC81C\uBAA9",
      "role": "\uAE30\uCD08",
      "relations": [{"target": "\uB2E4\uB978\uB178\uD2B8\uC81C\uBAA9", "type": "\uBC1C\uC804"}]
    }
  ],
  "relatedTopics": ["\uAD00\uB828\uC8FC\uC81C1", "\uAD00\uB828\uC8FC\uC81C2"]
}
`,W0=`PDF/\uC774\uBBF8\uC9C0 \uBB38\uC11C \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBB38\uC11C \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uBB38\uC11C\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD398\uC774\uC9C0 \uAD6C\uBD84\uC740 \uBB34\uC2DC\uD558\uACE0 \uC804\uCCB4 \uB0B4\uC6A9\uC744 \uD1B5\uD569\uD574\uC11C \uBD84\uC11D\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uBB38\uC11C \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,Y0=`\uD68C\uC758 \uB179\uC74C\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uC758\uB85D\uC744 \uC791\uC131\uD574\uB77C.

## \uADDC\uCE59
1. **\uC804\uC0AC(Transcription)**: \uC74C\uC131\uC744 \uD14D\uC2A4\uD2B8\uB85C \uBCC0\uD658. \uD654\uC790 \uAD6C\uBD84\uC774 \uAC00\uB2A5\uD558\uBA74 "\uD654\uC7901:", "\uD654\uC7902:" \uD615\uC2DD\uC73C\uB85C \uD45C\uC2DC
2. **\uC694\uC57D**: \uD68C\uC758 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
3. **\uC561\uC158 \uC544\uC774\uD15C**: \uB204\uAC00 \uBB34\uC5C7\uC744 \uC5B8\uC81C\uAE4C\uC9C0 \uD560\uC9C0 \uCD94\uCD9C. \uBA85\uC2DC\uB418\uC9C0 \uC54A\uC740 \uD56D\uBAA9\uC740 null
4. **\uACB0\uC815\uC0AC\uD56D**: \uD68C\uC758\uC5D0\uC11C \uACB0\uC815\uB41C \uC0AC\uD56D\uB4E4
5. **\uB2E4\uC74C \uD68C\uC758 \uC548\uAC74**: \uD6C4\uC18D \uB17C\uC758\uAC00 \uD544\uC694\uD55C \uC8FC\uC81C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD68C\uC758 \uC81C\uBAA9 (\uC8FC\uC81C \uAE30\uBC18\uC73C\uB85C \uC0DD\uC131)",
  "transcription": "\uC804\uCCB4 \uB300\uD654 \uB0B4\uC6A9 (\uD654\uC790 \uAD6C\uBD84 \uD3EC\uD568)",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "actionItems": [
    {"task": "\uD560 \uC77C", "assignee": "\uB2F4\uB2F9\uC790 \uB610\uB294 null", "deadline": "\uAE30\uD55C \uB610\uB294 null"}
  ],
  "decisions": ["\uACB0\uC815\uC0AC\uD56D1", "\uACB0\uC815\uC0AC\uD56D2"],
  "nextAgenda": ["\uB2E4\uC74C \uC548\uAC741", "\uB2E4\uC74C \uC548\uAC742"]
}

\uC561\uC158 \uC544\uC774\uD15C, \uACB0\uC815\uC0AC\uD56D, \uB2E4\uC74C \uC548\uAC74\uC774 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uB85C \uBC18\uD658\uD574\uB77C.
`,K0=`\uB108\uB294 \uB098\uC758 \uC0DD\uC0B0\uC131 \uCF54\uCE58\uB2E4.
\uC8FC\uC5B4\uC9C4 \uAE30\uAC04 \uB3D9\uC548\uC758 \uC791\uC5C5 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uACE0 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uB77C.

## \uAE30\uAC04
{period} ({dateRange})

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5 \uB0B4\uC6A9
{projectData}

## \uBD84\uC11D \uADDC\uCE59
1. \uC804\uCCB4 \uC694\uC57D: \uC774 \uAE30\uAC04\uC758 \uC791\uC5C5\uC744 2-3\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
2. \uC8FC\uC694 \uC8FC\uC81C: \uB2E4\uB8EC \uD575\uC2EC \uC8FC\uC81C 3-5\uAC1C \uCD94\uCD9C
3. \uC778\uC0AC\uC774\uD2B8: \uBC1C\uACAC\uD55C \uC810, \uBC30\uC6B4 \uC810, \uD328\uD134 3-5\uAC1C
4. \uB2E4\uC74C \uC561\uC158: \uD6C4\uC18D\uC73C\uB85C \uD574\uC57C \uD560 \uAD6C\uCCB4\uC801\uC778 \uD589\uB3D9 3-5\uAC1C
5. \uC791\uC5C5 \uD328\uD134: \uC791\uC5C5 \uBC29\uC2DD\uC5D0\uC11C \uBC1C\uACAC\uB41C \uD328\uD134 (\uC120\uD0DD)

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "summary": "\uC804\uCCB4 \uC694\uC57D (2-3\uBB38\uC7A5)",
  "mainTopics": ["\uC8FC\uC81C1", "\uC8FC\uC81C2", "\uC8FC\uC81C3"],
  "insights": ["\uC778\uC0AC\uC774\uD2B81", "\uC778\uC0AC\uC774\uD2B82", "\uC778\uC0AC\uC774\uD2B83"],
  "nextActions": ["\uC561\uC1581", "\uC561\uC1582", "\uC561\uC1583"],
  "patterns": "\uC791\uC5C5 \uD328\uD134 \uBD84\uC11D (\uC120\uD0DD, \uC5C6\uC73C\uBA74 null)"
}
`,J0=`\uB178\uD2B8 \uB0B4\uC6A9\uC5D0\uC11C \uC77C\uC815/\uD560\uC77C/\uC57D\uC18D\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uC624\uB298 \uB0A0\uC9DC
{today}

## \uCD94\uCD9C \uADDC\uCE59
- \uB0A0\uC9DC/\uC2DC\uAC04\uC774 \uC5B8\uAE09\uB41C \uBAA8\uB4E0 \uC77C\uC815 \uCD94\uCD9C
- \uC0C1\uB300\uC801 \uB0A0\uC9DC\uB97C \uC808\uB300 \uB0A0\uC9DC\uB85C \uBCC0\uD658:
  - "\uB0B4\uC77C" \u2192 \uC624\uB298 + 1\uC77C
  - "\uBAA8\uB808" \u2192 \uC624\uB298 + 2\uC77C
  - "\uB2E4\uC74C \uC8FC \uC6D4\uC694\uC77C" \u2192 \uB2E4\uC74C \uC8FC \uC6D4\uC694\uC77C \uB0A0\uC9DC
  - "\uC774\uBC88 \uC8FC \uAE08\uC694\uC77C" \u2192 \uC774\uBC88 \uC8FC \uAE08\uC694\uC77C \uB0A0\uC9DC
  - "\uB2E4\uC74C \uB2EC" \u2192 \uB2E4\uC74C \uB2EC 1\uC77C
- \uC2DC\uAC04\uC774 \uC5C6\uC73C\uBA74 time\uC744 null\uB85C
- type \uAD6C\uBD84:
  - "event": \uC57D\uC18D, \uBBF8\uD305, \uD68C\uC758, \uBC1C\uD45C, \uBC29\uBB38 \uB4F1 \uD2B9\uC815 \uC2DC\uC810\uC758 \uD65C\uB3D9
  - "task": \uB9C8\uAC10\uC77C, \uC81C\uCD9C, \uC644\uB8CC\uD574\uC57C \uD560 \uC77C

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4)
[
  {
    "title": "\uC77C\uC815 \uC81C\uBAA9",
    "date": "2026-01-15",
    "time": "14:00",
    "type": "event"
  },
  {
    "title": "\uBCF4\uACE0\uC11C \uC81C\uCD9C",
    "date": "2026-01-17",
    "time": null,
    "type": "task"
  }
]

\uC77C\uC815\uC774 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 [] \uBC18\uD658.
`;var bO=1e3,EO=3,wO=2e3,Xe="gemini-3-flash-preview",Np=class{constructor(e){this.lastRequestTime=0;this.minDelayMs=bO;this.ai=new Dp({apiKey:e})}async waitForRateLimit(){let t=Date.now()-this.lastRequestTime;if(t<this.minDelayMs){let n=this.minDelayMs-t;await this.delay(n)}this.lastRequestTime=Date.now()}delay(e){return new Promise(t=>setTimeout(t,e))}async callWithRetry(e,t=EO){await this.waitForRateLimit();for(let n=0;n<=t;n++)try{return await e()}catch(s){if(s instanceof Error&&(s.message.includes("429")||s.message.includes("RESOURCE_EXHAUSTED")||s.message.includes("quota"))&&n<t){let o=wO*Math.pow(2,n);console.log(`Rate limit hit, retrying in ${o/1e3}s... (attempt ${n+1}/${t})`),await this.delay(o),this.minDelayMs=Math.min(this.minDelayMs*1.5,5e3)}else throw s}throw new Error("Max retries exceeded")}async classifyProject(e,t,n){var l;let s=t.length>0?t.map((c,d)=>`${d+1}. ${c}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",r=F0.replace("{projects}",s).replace("{content}",e);n&&(r=r.replace("## \uCD9C\uB825 \uD615\uC2DD",`${n}

## \uCD9C\uB825 \uD615\uC2DD`));let a=(l=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:r}))).text)!=null?l:"";return this.parseProjectResponse(a)}async extractZK(e){var r;let t=L0.replace("{content}",e),s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:t}))).text)!=null?r:"";return this.parseZKResponse(s)}async getFocus(e){var r;let t=O0.replace("{projects}",e),s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:t}))).text)!=null?r:"";return this.parseFocusResponse(s)}parseProjectResponse(e){var n;let t=e.match(/\{[\s\S]*\}/);if(!t)throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: JSON \uC5C6\uC74C");try{let s=JSON.parse(t[0]);return{targetType:this.validateTargetType(s.targetType),projectName:s.projectName||void 0,isNewProject:(n=s.isNewProject)!=null?n:!1,title:s.title||"Untitled",summary:s.summary||"",nextAction:s.nextAction||null}}catch(s){throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: "+e)}}parseZKResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{return JSON.parse(t[0]).map(s=>({title:s.title,body:s.body,keywords:s.keywords||[],importance:s.importance||"",relatedConcepts:s.relatedConcepts||[]}))}catch(n){return console.error("ZK \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}parseFocusResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{return JSON.parse(t[0]).map(s=>({title:s.title,why:s.why,nextAction:s.next_action}))}catch(n){return console.error("Focus \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async extractTextFromImage(e,t){var s;return(s=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:[{role:"user",parts:[{text:U0},{inlineData:{mimeType:t,data:e}}]}]}))).text)!=null?s:""}async extractTextFromImages(e,t){let n=[];for(let s=0;s<e.length;s++){let r=e[s];t&&t(s+1,e.length);let o=await this.extractTextFromImage(r.base64,r.mimeType);n.push(o),s<e.length-1&&await this.delay(500)}return n}async extractKeywords(e){var r;let t=H0.replace("{content}",e),s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:t}))).text)!=null?r:"";return this.parseKeywordsResponse(s)}async findRelatedNotes(e,t,n){var a;let s=B0.replace("{newTitle}",e).replace("{newKeywords}",t.join(", ")).replace("{candidates}",n),o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:s}))).text)!=null?a:"";return this.parseRelatedNotesResponse(o)}async detectProject(e,t,n){var l;if(n.length===0)return null;let s=G0.replace("{noteTitle}",e).replace("{noteKeywords}",t.join(", ")).replace("{projects}",n.map((c,d)=>`${d+1}. ${c}`).join(`
`)),o=((l=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:s}))).text)!=null?l:"").trim();return o.toLowerCase()==="none"||o===""?null:o.startsWith("NEW:")?o:n.find(c=>o.toLowerCase().includes(c.toLowerCase()))||null}async summarizeContent(e,t){var a;let s=(t==="youtube"?V0:$0).replace("{content}",e),o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:s}))).text)!=null?a:"";return this.parseSummaryResponse(o)}async summarizePDF(e){var r;let t=W0.replace("{content}",e),s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:t}))).text)!=null?r:"";return this.parseSummaryResponse(s)}async analyzeYouTube(e){var r;let t=`\uC774 YouTube \uC601\uC0C1\uC744 \uBD84\uC11D\uD574\uC8FC\uC138\uC694.

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD654\uBA74\uC5D0 \uBCF4\uC774\uB294 \uD14D\uC2A4\uD2B8, \uC2AC\uB77C\uC774\uB4DC, \uCF54\uB4DC \uB4F1\uB3C4 \uCC38\uACE0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:[{role:"user",parts:[{fileData:{mimeType:"video/mp4",fileUri:e}},{text:t}]}]}))).text)!=null?r:"";return this.parseSummaryResponse(s)}async analyzeWebpage(e){var r;let t=`\uB2E4\uC74C \uC6F9\uD398\uC774\uC9C0\uB97C \uBD84\uC11D\uD574\uC8FC\uC138\uC694: ${e}

## \uADDC\uCE59
- \uD398\uC774\uC9C0\uC758 \uD575\uC2EC \uB0B4\uC6A9\uC744 \uC815\uD655\uD788 \uD30C\uC545\uD574\uB77C
- \uACF5\uACE0/\uBAA8\uC9D1\uC774\uBA74: \uB300\uC0C1, \uC870\uAC74, \uAE30\uAC04, \uD61C\uD0DD\uC744 \uAD6C\uCCB4\uC801\uC73C\uB85C
- \uB274\uC2A4/\uAE30\uC0AC\uBA74: \uD575\uC2EC \uC0AC\uC2E4, \uBC30\uACBD, \uC758\uBBF8\uB97C
- \uC81C\uD488/\uC11C\uBE44\uC2A4\uBA74: \uC8FC\uC694 \uAE30\uB2A5, \uAC00\uACA9, \uD2B9\uC9D5\uC744
- \uC77C\uBC18 \uC815\uBCF4\uBA74: \uD575\uC2EC \uBA54\uC2DC\uC9C0\uC640 \uC911\uC694 \uC138\uBD80\uC0AC\uD56D\uC744
- \uC804\uBB38 \uC6A9\uC5B4, \uACE0\uC720\uBA85\uC0AC, \uC22B\uC790\uB294 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD398\uC774\uC9C0 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D (\uAD6C\uCCB4\uC801\uC778 \uC815\uBCF4 \uD3EC\uD568)",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:t,config:{tools:[{urlContext:{}}]}}))).text)!=null?r:"";return this.parseSummaryResponse(s)}parseSummaryResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{title:"Untitled",summary:e.trim(),keyPoints:[]};try{let n=JSON.parse(t[0]);return{title:n.title||"Untitled",summary:n.summary||"",keyPoints:Array.isArray(n.keyPoints)?n.keyPoints:[]}}catch(n){return console.error("\uC694\uC57D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{title:"Untitled",summary:e.trim(),keyPoints:[]}}}parseKeywordsResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(s=>typeof s=="string"):[]}catch(n){return console.error("\uD0A4\uC6CC\uB4DC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}parseRelatedNotesResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(s=>typeof s=="object"&&typeof s.index=="number"&&typeof s.relevance=="number").filter(s=>s.relevance>=.5).sort((s,r)=>r.relevance-s.relevance).slice(0,5).map(s=>({index:s.index,relevance:s.relevance,reason:s.reason||"",type:s.type||""})):[]}catch(n){return console.error("\uAD00\uB828 \uB178\uD2B8 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async generateTopicStructure(e,t){var o;let n=q0.replace("{topic}",e).replace("{notes}",t),r=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:n}))).text)!=null?o:"";return this.parseTopicStructureResponse(r)}parseTopicStructureResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{description:"",notes:[],relatedTopics:[]};try{let n=JSON.parse(t[0]);return{description:n.description||"",notes:Array.isArray(n.notes)?n.notes:[],relatedTopics:Array.isArray(n.relatedTopics)?n.relatedTopics:[]}}catch(n){return console.error("\uC8FC\uC81C \uAD6C\uC870 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{description:"",notes:[],relatedTopics:[]}}}async splitContent(e,t){var a;let n=t.length>0?t.map((l,c)=>`${c+1}. ${l}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",s=z0.replace("{projects}",n).replace("{content}",e),o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:s}))).text)!=null?a:"";return this.parseSplitResponse(o)}parseSplitResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.map(s=>{var r,o;return{title:s.title||"Untitled",content:s.content||"",targetType:this.validateTargetType(s.targetType),project:s.projectName||void 0,isNewProject:(r=s.isNewProject)!=null?r:!1,keywords:Array.isArray(s.keywords)?s.keywords:[],isAtomic:(o=s.isAtomic)!=null?o:!1}}):[]}catch(n){return console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}validateTargetType(e){return["project","library","archive"].includes(e)?e:"library"}async analyzeReview(e,t,n){var h;let r={today:"\uC624\uB298",week:"\uC774\uBC88 \uC8FC",month:"\uC774\uBC88 \uB2EC",custom:"\uC0AC\uC6A9\uC790 \uC9C0\uC815 \uAE30\uAC04"}[e]||"\uAE30\uAC04",o=`${Le(t.start,"auto")} ~ ${Le(t.end,"auto")}`,a=n.map(p=>{let m=p.notes.map(y=>`  - ${y.title}${y.summary?`: ${y.summary}`:""}`).join(`
`);return`### ${p.projectName} (${p.noteCount}\uAC1C)
${m}`}).join(`

`),l=K0.replace("{period}",r).replace("{dateRange}",o).replace("{projectData}",a),d=(h=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:l}))).text)!=null?h:"";return this.parseReviewAnalysisResponse(d)}parseReviewAnalysisResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]};try{let n=JSON.parse(t[0]);return{summary:n.summary||"",mainTopics:Array.isArray(n.mainTopics)?n.mainTopics:[],insights:Array.isArray(n.insights)?n.insights:[],nextActions:Array.isArray(n.nextActions)?n.nextActions:[],patterns:n.patterns||void 0}}catch(n){return console.error("\uD68C\uACE0 \uBD84\uC11D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]}}}async analyzeMeeting(e,t,n){var a;console.log("\uD68C\uC758 \uB179\uC74C \uC5C5\uB85C\uB4DC \uC911...",n);let s=await this.ai.files.upload({file:e,config:{mimeType:t}});console.log("\uC5C5\uB85C\uB4DC \uC644\uB8CC:",s.uri);let o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:[{role:"user",parts:[{fileData:{fileUri:s.uri,mimeType:s.mimeType}},{text:Y0}]}]}))).text)!=null?a:"";return this.parseMeetingResponse(o,n)}parseMeetingResponse(e,t){let n=e.match(/\{[\s\S]*\}/);if(!n)return{title:"\uD68C\uC758\uB85D",transcription:e.trim(),summary:"",actionItems:[],decisions:[],nextAgenda:[],sourceFile:t};try{let s=JSON.parse(n[0]);return{title:s.title||"\uD68C\uC758\uB85D",transcription:s.transcription||"",summary:s.summary||"",actionItems:Array.isArray(s.actionItems)?s.actionItems.map(r=>({task:r.task||"",assignee:r.assignee||null,deadline:r.deadline||null})):[],decisions:Array.isArray(s.decisions)?s.decisions:[],nextAgenda:Array.isArray(s.nextAgenda)?s.nextAgenda:[],sourceFile:t}}catch(s){return console.error("\uD68C\uC758\uB85D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{title:"\uD68C\uC758\uB85D",transcription:e.trim(),summary:"",actionItems:[],decisions:[],nextAgenda:[],sourceFile:t}}}async detectSchedules(e,t){var o;let n=J0.replace("{content}",e).replace("{today}",t),r=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:n}))).text)!=null?o:"";return this.parseSchedulesResponse(r)}parseSchedulesResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(s=>typeof s=="object"&&typeof s.title=="string"&&typeof s.date=="string"&&(s.type==="event"||s.type==="task")).map(s=>({title:s.title,date:s.date,time:s.time||null,type:s.type})):[]}catch(n){return console.error("\uC77C\uC815 \uAC10\uC9C0 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async generateContent(e){var s;let n=(s=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Xe,contents:e}))).text)!=null?s:"";if(!n)throw new Error("\uC751\uB2F5 \uC0DD\uC131 \uC2E4\uD328");return n.trim()}async generateEmbedding(e){if(!e||e.trim().length===0)return[];let t=e.length>8e3?e.substring(0,8e3):e,n=await this.callWithRetry(async()=>await this.ai.models.embedContent({model:"text-embedding-004",contents:[{parts:[{text:t}]}],config:{outputDimensionality:768}}));return n.embeddings&&n.embeddings.length>0?n.embeddings[0].values||[]:[]}async batchGenerateEmbeddings(e,t){let n=[];for(let s=0;s<e.length;s++){t&&t(s+1,e.length);let r=await this.generateEmbedding(e[s]);n.push(r),s<e.length-1&&await this.delay(300)}return n}};var eA=require("obsidian");var yU={};var hd={};hd.d=(i,e)=>{for(var t in e)hd.o(e,t)&&!hd.o(i,t)&&Object.defineProperty(i,t,{enumerable:!0,get:e[t]})};hd.o=(i,e)=>Object.prototype.hasOwnProperty.call(i,e);var K=globalThis.pdfjsLib={};hd.d(K,{AbortException:()=>yi,AnnotationEditorLayer:()=>US,AnnotationEditorParamsType:()=>oe,AnnotationEditorType:()=>j,AnnotationEditorUIManager:()=>jo,AnnotationLayer:()=>gS,AnnotationMode:()=>Ss,ColorPicker:()=>$g,DOMSVGFactory:()=>Cd,DrawLayer:()=>GS,FeatureTest:()=>it,GlobalWorkerOptions:()=>$n,ImageKind:()=>Bp,InvalidPDFException:()=>md,MissingPDFException:()=>Jo,OPS:()=>Rn,OutputScale:()=>bd,PDFDataRangeTransport:()=>Pg,PDFDateString:()=>pd,PDFWorker:()=>Ba,PasswordResponses:()=>TO,PermissionFlag:()=>_O,PixelsPerInch:()=>or,RenderingCancelledException:()=>vd,TextLayer:()=>Sd,TouchManager:()=>Eg,UnexpectedResponseException:()=>yc,Util:()=>G,VerbosityLevel:()=>Dy,XfaLayer:()=>Ng,build:()=>pU,createValidAbsoluteUrl:()=>DO,fetchData:()=>Ny,getDocument:()=>dU,getFilenameFromUrl:()=>UO,getPdfFilenameFromUrl:()=>HO,getXfaPageViewport:()=>BO,isDataScheme:()=>Fy,isPdfFile:()=>WS,noContextMenu:()=>zn,normalizeUnicode:()=>FO,setLayerDimensions:()=>Xo,shadow:()=>se,stopEvent:()=>en,version:()=>fU});var mt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),ux=[1,0,0,1,0,0],IE=[.001,0,0,.001,0,0],SO=1e7,Hp=1.35,AO=.35,I$=AO/Hp,Qt={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ss={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},CO="pdfjs_internal_editor_",j={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},oe={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},_O={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},lt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Bp={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ue={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var Yc={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var Dy={ERRORS:0,WARNINGS:1,INFOS:5},Rn={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},TO={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},Py=Dy.WARNINGS;function xO(i){Number.isInteger(i)&&(Py=i)}function RO(){return Py}function My(i){Py>=Dy.INFOS&&console.log(`Info: ${i}`)}function Q(i){Py>=Dy.WARNINGS&&console.log(`Warning: ${i}`)}function ge(i){throw new Error(i)}function ke(i,e){i||ge(e)}function IO(i){switch(i==null?void 0:i.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function DO(i,e=null,t=null){if(!i)return null;try{if(t&&typeof i=="string"){if(t.addDefaultProtocol&&i.startsWith("www.")){let s=i.match(/\./g);(s==null?void 0:s.length)>=2&&(i=`http://${i}`)}if(t.tryConvertEncoding)try{i=NO(i)}catch(s){}}let n=e?new URL(i,e):new URL(i);if(IO(n))return n}catch(n){}return null}function se(i,e,t,n=!1){return Object.defineProperty(i,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}var ar=function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}(),mg=class extends ar{constructor(e,t){super(e,"PasswordException"),this.code=t}},fd=class extends ar{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},md=class extends ar{constructor(e){super(e,"InvalidPDFException")}},Jo=class extends ar{constructor(e){super(e,"MissingPDFException")}},yc=class extends ar{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},DE=class extends ar{constructor(e){super(e,"FormatError")}},yi=class extends ar{constructor(e){super(e,"AbortException")}};function hx(i){(typeof i!="object"||(i==null?void 0:i.length)===void 0)&&ge("Invalid argument for bytesToString");let e=i.length,t=8192;if(e<t)return String.fromCharCode.apply(null,i);let n=[];for(let s=0;s<e;s+=t){let r=Math.min(s+t,e),o=i.subarray(s,r);n.push(String.fromCharCode.apply(null,o))}return n.join("")}function ky(i){typeof i!="string"&&ge("Invalid argument for stringToBytes");let e=i.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=i.charCodeAt(n)&255;return t}function PO(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255)}function zS(i){let e=Object.create(null);for(let[t,n]of i)e[t]=n;return e}function MO(){let i=new Uint8Array(4);return i[0]=1,new Uint32Array(i.buffer,0,1)[0]===1}function kO(){try{return new Function(""),!0}catch(i){return!1}}var it=class{static get isLittleEndian(){return se(this,"isLittleEndian",MO())}static get isEvalSupported(){return se(this,"isEvalSupported",kO())}static get isOffscreenCanvasSupported(){return se(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas!="undefined")}static get isImageDecoderSupported(){return se(this,"isImageDecoderSupported",typeof ImageDecoder!="undefined")}static get platform(){return typeof navigator!="undefined"&&typeof(navigator==null?void 0:navigator.platform)=="string"?se(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):se(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return se(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}},CE=Array.from(Array(256).keys(),i=>i.toString(16).padStart(2,"0")),Ga,Gp,Id,PE,G=class{static makeHexColor(e,t,n){return`#${CE[e]}${CE[t]}${CE[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){let n=e[0]*t[0]+e[1]*t[2]+t[4],s=e[0]*t[1]+e[1]*t[3]+t[5];return[n,s]}static applyInverseTransform(e,t){let n=t[0]*t[3]-t[1]*t[2],s=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[s,r]}static getAxialAlignedBoundingBox(e,t){let n=this.applyTransform(e,t),s=this.applyTransform(e.slice(2,4),t),r=this.applyTransform([e[0],e[3]],t),o=this.applyTransform([e[2],e[1]],t);return[Math.min(n[0],s[0],r[0],o[0]),Math.min(n[1],s[1],r[1],o[1]),Math.max(n[0],s[0],r[0],o[0]),Math.max(n[1],s[1],r[1],o[1])]}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){let t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],s=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],a=(n+o)/2,l=Math.sqrt((n+o)**2-4*(n*o-r*s))/2,c=a+l||1,d=a-l||1;return[Math.sqrt(c),Math.sqrt(d)]}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>s)return null;let r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[n,r,s,o]}static bezierBoundingBox(e,t,n,s,r,o,a,l,c){return c?(c[0]=Math.min(c[0],e,a),c[1]=Math.min(c[1],t,l),c[2]=Math.max(c[2],e,a),c[3]=Math.max(c[3],t,l)):c=[Math.min(e,a),Math.min(t,l),Math.max(e,a),Math.max(t,l)],A(this,Id,PE).call(this,e,n,r,a,t,s,o,l,3*(-e+3*(n-r)+a),6*(e-2*n+r),3*(n-e),c),A(this,Id,PE).call(this,e,n,r,a,t,s,o,l,3*(-t+3*(s-o)+l),6*(t-2*s+o),3*(s-t),c),c}};Ga=new WeakSet,Gp=function(e,t,n,s,r,o,a,l,c,d){if(c<=0||c>=1)return;let h=1-c,p=c*c,m=p*c,y=h*(h*(h*e+3*c*t)+3*p*n)+m*s,v=h*(h*(h*r+3*c*o)+3*p*a)+m*l;d[0]=Math.min(d[0],y),d[1]=Math.min(d[1],v),d[2]=Math.max(d[2],y),d[3]=Math.max(d[3],v)},Id=new WeakSet,PE=function(e,t,n,s,r,o,a,l,c,d,h,p){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&A(this,Ga,Gp).call(this,e,t,n,s,r,o,a,l,-h/d,p);return}let m=d**2-4*h*c;if(m<0)return;let y=Math.sqrt(m),v=2*c;A(this,Ga,Gp).call(this,e,t,n,s,r,o,a,l,(-d+y)/v,p),A(this,Ga,Gp).call(this,e,t,n,s,r,o,a,l,(-d-y)/v,p)},b(G,Ga),b(G,Id);function NO(i){return decodeURIComponent(escape(i))}var _E=null,X0=null;function FO(i){return _E||(_E=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,X0=new Map([["\uFB05","\u017Ft"]])),i.replaceAll(_E,(e,t,n)=>t?t.normalize("NFKC"):X0.get(n))}function LO(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let i=new Uint8Array(32);return crypto.getRandomValues(i),hx(i)}var qS="pdfjs_internal_id_";function OO(i){return Uint8Array.prototype.toBase64?i.toBase64():btoa(hx(i))}typeof Promise.try!="function"&&(Promise.try=function(i,...e){return new Promise(t=>{t(i(...e))})});var Mi="http://www.w3.org/2000/svg",Rr=class Rr{};Y(Rr,"CSS",96),Y(Rr,"PDF",72),Y(Rr,"PDF_TO_CSS_UNITS",Rr.CSS/Rr.PDF);var or=Rr;async function Ny(i,e="text"){if(Zc(i,document.baseURI)){let t=await fetch(i);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{let s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}n(new Error(s.statusText))}},s.send(null)})}var yd=class i{constructor({viewBox:e,userUnit:t,scale:n,rotation:s,offsetX:r=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=s,this.offsetX=r,this.offsetY=o,n*=t;let l=(e[2]+e[0])/2,c=(e[3]+e[1])/2,d,h,p,m;switch(s%=360,s<0&&(s+=360),s){case 180:d=-1,h=0,p=0,m=1;break;case 90:d=0,h=1,p=1,m=0;break;case 270:d=0,h=-1,p=-1,m=0;break;case 0:d=1,h=0,p=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(p=-p,m=-m);let y,v,E,S;d===0?(y=Math.abs(c-e[1])*n+r,v=Math.abs(l-e[0])*n+o,E=(e[3]-e[1])*n,S=(e[2]-e[0])*n):(y=Math.abs(l-e[0])*n+r,v=Math.abs(c-e[1])*n+o,E=(e[2]-e[0])*n,S=(e[3]-e[1])*n),this.transform=[d*n,h*n,p*n,m*n,y-d*n*l-p*n*c,v-h*n*l-m*n*c],this.width=E,this.height=S}get rawDims(){let{userUnit:e,viewBox:t}=this,n=t.map(s=>s*e);return se(this,"rawDims",{pageWidth:n[2]-n[0],pageHeight:n[3]-n[1],pageX:n[0],pageY:n[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:r=!1}={}){return new i({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}convertToViewportPoint(e,t){return G.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){let t=G.applyTransform([e[0],e[1]],this.transform),n=G.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return G.applyInverseTransform([e,t],this.transform)}},vd=class extends ar{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}};function Fy(i){let e=i.length,t=0;for(;t<e&&i[t].trim()==="";)t++;return i.substring(t,t+5).toLowerCase()==="data:"}function WS(i){return typeof i=="string"&&/\.pdf$/i.test(i)}function UO(i){return[i]=i.split(/[#?]/,1),i.substring(i.lastIndexOf("/")+1)}function HO(i,e="document.pdf"){if(typeof i!="string")return e;if(Fy(i))return Q('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;let t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=t.exec(i),r=n.exec(s[1])||n.exec(s[2])||n.exec(s[3]);if(r&&(r=r[0],r.includes("%")))try{r=n.exec(decodeURIComponent(r))[0]}catch(o){}return r||e}var yg=class{constructor(){Y(this,"started",Object.create(null));Y(this,"times",[])}time(e){e in this.started&&Q(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Q(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:n}of this.times)t=Math.max(n.length,t);for(let{name:n,start:s,end:r}of this.times)e.push(`${n.padEnd(t)} ${r-s}ms
`);return e.join("")}};function Zc(i,e){try{let{protocol:t}=e?new URL(i,e):new URL(i);return t==="http:"||t==="https:"}catch(t){return!1}}function zn(i){i.preventDefault()}function en(i){i.preventDefault(),i.stopPropagation()}var Dd,pd=class{static toDateObject(e){if(!e||typeof e!="string")return null;u(this,Dd)||w(this,Dd,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let t=u(this,Dd).exec(e);if(!t)return null;let n=parseInt(t[1],10),s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;let c=t[7]||"Z",d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,c==="-"?(o+=d,a+=h):c==="+"&&(o-=d,a-=h),new Date(Date.UTC(n,s,r,o,a,l))}};Dd=new WeakMap,b(pd,Dd,void 0);function BO(i,{scale:e=1,rotation:t=0}){let{width:n,height:s}=i.attributes.style,r=[0,0,parseInt(n),parseInt(s)];return new yd({viewBox:r,userUnit:1,scale:e,rotation:t})}function YS(i){if(i.startsWith("#")){let e=parseInt(i.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return i.startsWith("rgb(")?i.slice(4,-1).split(",").map(e=>parseInt(e)):i.startsWith("rgba(")?i.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Q(`Not a valid color format: "${i}"`),[0,0,0])}function GO(i){let e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(let t of i.keys()){e.style.color=t;let n=window.getComputedStyle(e).color;i.set(t,YS(n))}e.remove()}function be(i){let{a:e,b:t,c:n,d:s,e:r,f:o}=i.getTransform();return[e,t,n,s,r,o]}function Xn(i){let{a:e,b:t,c:n,d:s,e:r,f:o}=i.getTransform().invertSelf();return[e,t,n,s,r,o]}function Xo(i,e,t=!1,n=!0){if(e instanceof yd){let{pageWidth:s,pageHeight:r}=e.rawDims,{style:o}=i,a=it.isCSSRoundSupported,l=`var(--scale-factor) * ${s}px`,c=`var(--scale-factor) * ${r}px`,d=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,h=a?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!t||e.rotation%180===0?(o.width=d,o.height=h):(o.width=h,o.height=d)}n&&i.setAttribute("data-main-rotation",e.rotation)}var bd=class{constructor(){let e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},As,Pr,In,Mr,Pd,Md,Wg,fx,Yg,px,Kg,gx,Va,Vp,Jg,mx,kd,kE,Fi=class Fi{constructor(e){b(this,Yg);b(this,Kg);b(this,Va);b(this,Jg);b(this,kd);b(this,As,null);b(this,Pr,null);b(this,In,void 0);b(this,Mr,null);b(this,Pd,null);w(this,In,e),u(Fi,Md)||w(Fi,Md,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){let e=w(this,As,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");let t=u(this,In)._uiManager._signal;e.addEventListener("contextmenu",zn,{signal:t}),e.addEventListener("pointerdown",A(Fi,Wg,fx),{signal:t});let n=w(this,Mr,document.createElement("div"));n.className="buttons",e.append(n);let s=u(this,In).toolbarPosition;if(s){let{style:r}=e,o=u(this,In)._uiManager.direction==="ltr"?1-s[0]:s[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return A(this,Jg,mx).call(this),e}get div(){return u(this,As)}hide(){var e;u(this,As).classList.add("hidden"),(e=u(this,Pr))==null||e.hideDropdown()}show(){var e;u(this,As).classList.remove("hidden"),(e=u(this,Pd))==null||e.shown()}async addAltText(e){let t=await e.render();A(this,Va,Vp).call(this,t),u(this,Mr).prepend(t,u(this,kd,kE)),w(this,Pd,e)}addColorPicker(e){w(this,Pr,e);let t=e.renderButton();A(this,Va,Vp).call(this,t),u(this,Mr).prepend(t,u(this,kd,kE))}remove(){var e;u(this,As).remove(),(e=u(this,Pr))==null||e.destroy(),w(this,Pr,null)}};As=new WeakMap,Pr=new WeakMap,In=new WeakMap,Mr=new WeakMap,Pd=new WeakMap,Md=new WeakMap,Wg=new WeakSet,fx=function(e){e.stopPropagation()},Yg=new WeakSet,px=function(e){u(this,In)._focusEventsAllowed=!1,en(e)},Kg=new WeakSet,gx=function(e){u(this,In)._focusEventsAllowed=!0,en(e)},Va=new WeakSet,Vp=function(e){let t=u(this,In)._uiManager._signal;e.addEventListener("focusin",A(this,Yg,px).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",A(this,Kg,gx).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",zn,{signal:t})},Jg=new WeakSet,mx=function(){let{editorType:e,_uiManager:t}=u(this,In),n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",u(Fi,Md)[e]),A(this,Va,Vp).call(this,n),n.addEventListener("click",s=>{t.delete()},{signal:t._signal}),u(this,Mr).append(n)},kd=new WeakSet,kE=function(){let e=document.createElement("div");return e.className="divider",e},b(Fi,Wg),b(Fi,Md,null);var ME=Fi,Nd,kr,Nr,Xg,yx,Zg,vx,jg,bx,NE=class{constructor(e){b(this,Xg);b(this,Zg);b(this,jg);b(this,Nd,null);b(this,kr,null);b(this,Nr,void 0);w(this,Nr,e)}show(e,t,n){let[s,r]=A(this,Zg,vx).call(this,t,n),{style:o}=u(this,kr)||w(this,kr,A(this,Xg,yx).call(this));e.append(u(this,kr)),o.insetInlineEnd=`${100*s}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){u(this,kr).remove()}};Nd=new WeakMap,kr=new WeakMap,Nr=new WeakMap,Xg=new WeakSet,yx=function(){let e=w(this,kr,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",zn,{signal:u(this,Nr)._signal});let t=w(this,Nd,document.createElement("div"));return t.className="buttons",e.append(t),A(this,jg,bx).call(this),e},Zg=new WeakSet,vx=function(e,t){let n=0,s=0;for(let r of e){let o=r.y+r.height;if(o<n)continue;let a=r.x+(t?r.width:0);if(o>n){s=a,n=o;continue}t?a>s&&(s=a):a<s&&(s=a)}return[t?1-s:s,n]},jg=new WeakSet,bx=function(){let e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let n=u(this,Nr)._signal;e.addEventListener("contextmenu",zn,{signal:n}),e.addEventListener("click",()=>{u(this,Nr).highlightSelection("floating_button")},{signal:n}),u(this,Nd).append(e)};function vg(i,e,t){for(let n of t)e.addEventListener(n,i[n].bind(i))}var Qg,FE=class{constructor(){b(this,Qg,0)}get id(){return`${CO}${vt(this,Qg)._++}`}};Qg=new WeakMap;var $a,Fd,ut,za,$p,KS=class KS{constructor(){b(this,za);b(this,$a,LO());b(this,Fd,0);b(this,ut,null)}static get _isSVGFittingCanvas(){let e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;let r=s.decode().then(()=>(n.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return se(this,"_isSVGFittingCanvas",r)}async getFromFile(e){let{lastModified:t,name:n,size:s,type:r}=e;return A(this,za,$p).call(this,`${t}_${n}_${s}_${r}`,e)}async getFromUrl(e){return A(this,za,$p).call(this,e,e)}async getFromBlob(e,t){let n=await t;return A(this,za,$p).call(this,e,n)}async getFromId(e){u(this,ut)||w(this,ut,new Map);let t=u(this,ut).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){let{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){u(this,ut)||w(this,ut,new Map);let n=u(this,ut).get(e);if(n!=null&&n.bitmap)return n.refCounter+=1,n;let s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),n={bitmap:s.transferToImageBitmap(),id:`image_${u(this,$a)}_${vt(this,Fd)._++}`,refCounter:1,isSvg:!1},u(this,ut).set(e,n),u(this,ut).set(n.id,n),n}getSvgUrl(e){let t=u(this,ut).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var s;u(this,ut)||w(this,ut,new Map);let t=u(this,ut).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;let{bitmap:n}=t;if(!t.url&&!t.file){let r=new OffscreenCanvas(n.width,n.height);r.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=r.convertToBlob()}(s=n.close)==null||s.call(n),t.bitmap=null}isValidId(e){return e.startsWith(`image_${u(this,$a)}_`)}};$a=new WeakMap,Fd=new WeakMap,ut=new WeakMap,za=new WeakSet,$p=async function(e,t){u(this,ut)||w(this,ut,new Map);let n=u(this,ut).get(e);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${u(this,$a)}_${vt(this,Fd)._++}`,refCounter:0,isSvg:!1});let s;if(typeof t=="string"?(n.url=t,s=await Ny(t,"blob")):t instanceof File?s=n.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){let r=KS._isSVGFittingCanvas,o=new FileReader,a=new Image,l=new Promise((c,d)=>{a.onload=()=>{n.bitmap=a,n.isSvg=!0,c()},o.onload=async()=>{let h=n.svgUrl=o.result;a.src=await r?`${h}#svgView(preserveAspectRatio(none))`:h},a.onerror=o.onerror=d});o.readAsDataURL(s),await l}else n.bitmap=await createImageBitmap(s);n.refCounter=1}catch(s){Q(s),n=null}return u(this,ut).set(e,n),n&&u(this,ut).set(n.id,n),n};var LE=KS,Re,Cs,Ld,Se,OE=class{constructor(e=128){b(this,Re,[]);b(this,Cs,!1);b(this,Ld,void 0);b(this,Se,-1);w(this,Ld,e)}add({cmd:e,undo:t,post:n,mustExec:s,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(s&&e(),u(this,Cs))return;let l={cmd:e,undo:t,post:n,type:r};if(u(this,Se)===-1){u(this,Re).length>0&&(u(this,Re).length=0),w(this,Se,0),u(this,Re).push(l);return}if(o&&u(this,Re)[u(this,Se)].type===r){a&&(l.undo=u(this,Re)[u(this,Se)].undo),u(this,Re)[u(this,Se)]=l;return}let c=u(this,Se)+1;c===u(this,Ld)?u(this,Re).splice(0,1):(w(this,Se,c),c<u(this,Re).length&&u(this,Re).splice(c)),u(this,Re).push(l)}undo(){if(u(this,Se)===-1)return;w(this,Cs,!0);let{undo:e,post:t}=u(this,Re)[u(this,Se)];e(),t==null||t(),w(this,Cs,!1),w(this,Se,u(this,Se)-1)}redo(){if(u(this,Se)<u(this,Re).length-1){w(this,Se,u(this,Se)+1),w(this,Cs,!0);let{cmd:e,post:t}=u(this,Re)[u(this,Se)];e(),t==null||t(),w(this,Cs,!1)}}hasSomethingToUndo(){return u(this,Se)!==-1}hasSomethingToRedo(){return u(this,Se)<u(this,Re).length-1}cleanType(e){if(u(this,Se)!==-1){for(let t=u(this,Se);t>=0;t--)if(u(this,Re)[t].type!==e){u(this,Re).splice(t+1,u(this,Se)-t),w(this,Se,t);return}u(this,Re).length=0,w(this,Se,-1)}}destroy(){w(this,Re,null)}};Re=new WeakMap,Cs=new WeakMap,Ld=new WeakMap,Se=new WeakMap;var em,Ex,Zo=class{constructor(e){b(this,em);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=it.platform;for(let[n,s,r={}]of e)for(let o of n){let a=o.startsWith("mac+");t&&a?(this.callbacks.set(o.slice(4),{callback:s,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!a&&(this.callbacks.set(o,{callback:s,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;let n=this.callbacks.get(A(this,em,Ex).call(this,t));if(!n)return;let{callback:s,options:{bubbles:r=!1,args:o=[],checker:a=null}}=n;a&&!a(e,t)||(s.bind(e,...o,t)(),r||en(t))}};em=new WeakSet,Ex=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let t=this.buffer.join("+");return this.buffer.length=0,t};var tm=class tm{get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return GO(e),se(this,"_colors",e)}convert(e){let t=YS(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(let[n,s]of this._colors)if(s.every((r,o)=>r===t[o]))return tm._colorsMapping.get(n);return t}getHexCode(e){let t=this._colors.get(e);return t?G.makeHexColor(...t):e}};Y(tm,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var UE=tm,qa,Gt,He,Ze,Wa,Oi,Ya,dn,_s,Fr,Ka,Lr,Qn,Dn,Or,Od,Ud,Ja,Hd,ei,Ts,Xa,xs,ti,nm,Rs,Bd,Is,Ur,Gd,Vd,$e,he,Ui,Hr,$d,zd,Ds,ni,Hi,qd,un,Za,zp,Wd,HE,im,wx,sm,Sx,ja,qp,rm,Ax,om,Cx,am,_x,Yd,BE,lm,Tx,Kd,GE,Jd,VE,cm,xx,je,Et,Pn,ki,dm,Rx,um,Ix,Xd,$E,hm,Dx,Br,jc,Zd,zE,Oa=class Oa{constructor(e,t,n,s,r,o,a,l,c,d,h,p,m){b(this,Za);b(this,Wd);b(this,im);b(this,sm);b(this,ja);b(this,rm);b(this,om);b(this,am);b(this,Yd);b(this,lm);b(this,Kd);b(this,Jd);b(this,cm);b(this,je);b(this,Pn);b(this,dm);b(this,um);b(this,Xd);b(this,hm);b(this,Br);b(this,Zd);b(this,qa,new AbortController);b(this,Gt,null);b(this,He,new Map);b(this,Ze,new Map);b(this,Wa,null);b(this,Oi,null);b(this,Ya,null);b(this,dn,new OE);b(this,_s,null);b(this,Fr,null);b(this,Ka,0);b(this,Lr,new Set);b(this,Qn,null);b(this,Dn,null);b(this,Or,new Set);Y(this,"_editorUndoBar",null);b(this,Od,!1);b(this,Ud,!1);b(this,Ja,!1);b(this,Hd,null);b(this,ei,null);b(this,Ts,null);b(this,Xa,null);b(this,xs,!1);b(this,ti,null);b(this,nm,new FE);b(this,Rs,!1);b(this,Bd,!1);b(this,Is,null);b(this,Ur,null);b(this,Gd,null);b(this,Vd,null);b(this,$e,j.NONE);b(this,he,new Set);b(this,Ui,null);b(this,Hr,null);b(this,$d,null);b(this,zd,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});b(this,Ds,[0,0]);b(this,ni,null);b(this,Hi,null);b(this,qd,null);b(this,un,null);let y=this._signal=u(this,qa).signal;w(this,Hi,e),w(this,qd,t),w(this,Wa,n),this._eventBus=s,s._on("editingaction",this.onEditingAction.bind(this),{signal:y}),s._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),s._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),s._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),s._on("setpreference",this.onSetPreference.bind(this),{signal:y}),s._on("switchannotationeditorparams",v=>this.updateParams(v.type,v.value),{signal:y}),A(this,rm,Ax).call(this),A(this,cm,xx).call(this),A(this,Yd,BE).call(this),w(this,Oi,r.annotationStorage),w(this,Hd,r.filterFactory),w(this,Hr,o),w(this,Xa,a||null),w(this,Od,l),w(this,Ud,c),w(this,Ja,d),w(this,Vd,h||null),this.viewParameters={realScale:or.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=p||null,this._supportsPinchToZoom=m!==!1}static get _keyboardManager(){let e=Oa.prototype,t=o=>u(o,Hi).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),n=(o,{target:a})=>{if(a instanceof HTMLInputElement){let{type:l}=a;return l!=="text"&&l!=="number"}return!0},s=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return se(this,"_keyboardManager",new Zo([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&u(o,Hi).contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&u(o,Hi).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,n,s,r;(e=u(this,un))==null||e.resolve(),w(this,un,null),(t=u(this,qa))==null||t.abort(),w(this,qa,null),this._signal=null;for(let o of u(this,Ze).values())o.destroy();u(this,Ze).clear(),u(this,He).clear(),u(this,Or).clear(),w(this,Gt,null),u(this,he).clear(),u(this,dn).destroy(),(n=u(this,Wa))==null||n.destroy(),(s=u(this,ti))==null||s.hide(),w(this,ti,null),u(this,ei)&&(clearTimeout(u(this,ei)),w(this,ei,null)),u(this,ni)&&(clearTimeout(u(this,ni)),w(this,ni,null)),(r=this._editorUndoBar)==null||r.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return u(this,Vd)}get useNewAltTextFlow(){return u(this,Ud)}get useNewAltTextWhenAddingImage(){return u(this,Ja)}get hcmFilter(){return se(this,"hcmFilter",u(this,Hr)?u(this,Hd).addHCMFilter(u(this,Hr).foreground,u(this,Hr).background):"none")}get direction(){return se(this,"direction",getComputedStyle(u(this,Hi)).direction)}get highlightColors(){return se(this,"highlightColors",u(this,Xa)?new Map(u(this,Xa).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return se(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),w(this,Fr,e)}setMainHighlightColorPicker(e){w(this,Gd,e)}editAltText(e,t=!1){var n;(n=u(this,Wa))==null||n.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":w(this,Ja,t);break}}onPageChanging({pageNumber:e}){w(this,Ka,e-1)}focusMainContainer(){u(this,Hi).focus()}findParent(e,t){for(let n of u(this,Ze).values()){let{x:s,y:r,width:o,height:a}=n.div.getBoundingClientRect();if(e>=s&&e<=s+o&&t>=r&&t<=r+a)return n}return null}disableUserSelect(e=!1){u(this,qd).classList.toggle("noUserSelect",e)}addShouldRescale(e){u(this,Or).add(e)}removeShouldRescale(e){u(this,Or).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*or.PDF_TO_CSS_UNITS;for(let n of u(this,Or))n.onScaleChanging();(t=u(this,Fr))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){let t=document.getSelection();if(!t||t.isCollapsed)return;let{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}=t,a=t.toString(),c=A(this,Za,zp).call(this,t).closest(".textLayer"),d=this.getSelectionBoxes(c);if(!d)return;t.empty();let h=A(this,Wd,HE).call(this,c),p=u(this,$e)===j.NONE,m=()=>{h==null||h.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o,text:a}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode(j.HIGHLIGHT,m);return}m()}addToAnnotationStorage(e){!e.isEmpty()&&u(this,Oi)&&!u(this,Oi).has(e.id)&&u(this,Oi).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,u(this,xs)&&(w(this,xs,!1),A(this,ja,qp).call(this,"main_toolbar")),!this.hasSelection)return;let{activeElement:e}=document;for(let t of u(this,he))if(t.div.contains(e)){w(this,Ur,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!u(this,Ur))return;let[e,t]=u(this,Ur);w(this,Ur,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){A(this,Yd,BE).call(this),A(this,Kd,GE).call(this)}removeEditListeners(){A(this,lm,Tx).call(this),A(this,Jd,VE).call(this)}dragOver(e){for(let{type:t}of e.dataTransfer.items)for(let n of u(this,Dn))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(let t of e.dataTransfer.items)for(let n of u(this,Dn))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var n;if(e.preventDefault(),(n=u(this,Gt))==null||n.commitOrRemove(),!this.hasSelection)return;let t=[];for(let s of u(this,he)){let r=s.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();let{clipboardData:t}=e;for(let r of t.items)for(let o of u(this,Dn))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(r){Q(`paste: "${r.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();let s=this.currentLayer;try{let r=[];for(let l of n){let c=await s.deserialize(l);if(!c)return;r.push(c)}let o=()=>{for(let l of r)A(this,Xd,$E).call(this,l);A(this,Zd,zE).call(this,r)},a=()=>{for(let l of r)l.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(r){Q(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),u(this,$e)!==j.NONE&&!this.isEditorHandlingKeyboard&&Oa._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,u(this,xs)&&(w(this,xs,!1),A(this,ja,qp).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(A(this,om,Cx).call(this),A(this,Kd,GE).call(this),A(this,je,Et).call(this,{isEditing:u(this,$e)!==j.NONE,isEmpty:A(this,Br,jc).call(this),hasSomethingToUndo:u(this,dn).hasSomethingToUndo(),hasSomethingToRedo:u(this,dn).hasSomethingToRedo(),hasSelectedEditor:!1})):(A(this,am,_x).call(this),A(this,Jd,VE).call(this),A(this,je,Et).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!u(this,Dn)){w(this,Dn,e);for(let t of u(this,Dn))A(this,Pn,ki).call(this,t.defaultPropertiesToUpdate)}}getId(){return u(this,nm).id}get currentLayer(){return u(this,Ze).get(u(this,Ka))}getLayer(e){return u(this,Ze).get(e)}get currentPageIndex(){return u(this,Ka)}addLayer(e){u(this,Ze).set(e.pageIndex,e),u(this,Rs)?e.enable():e.disable()}removeLayer(e){u(this,Ze).delete(e.pageIndex)}async updateMode(e,t=null,n=!1){var s;if(u(this,$e)!==e&&!(u(this,un)&&(await u(this,un).promise,!u(this,un)))){if(w(this,un,Promise.withResolvers()),w(this,$e,e),e===j.NONE){this.setEditingState(!1),A(this,um,Ix).call(this),(s=this._editorUndoBar)==null||s.hide(),u(this,un).resolve();return}this.setEditingState(!0),await A(this,dm,Rx).call(this),this.unselectAll();for(let r of u(this,Ze).values())r.updateMode(e);if(!t){n&&this.addNewEditorFromKeyboard(),u(this,un).resolve();return}for(let r of u(this,He).values())r.annotationElementId===t?(this.setSelected(r),r.enterInEditMode()):r.unselect();u(this,un).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==u(this,$e)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var n;if(u(this,Dn)){switch(e){case oe.CREATE:this.currentLayer.addNewEditor();return;case oe.HIGHLIGHT_DEFAULT_COLOR:(n=u(this,Gd))==null||n.updateColor(t);break;case oe.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(u(this,$d)||w(this,$d,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(let s of u(this,he))s.updateParams(e,t);for(let s of u(this,Dn))s.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){var r,o;for(let a of u(this,He).values())a.editorType===e&&a.show(t);((o=(r=u(this,$d))==null?void 0:r.get(oe.HIGHLIGHT_SHOW_ALL))!=null?o:!0)!==t&&A(this,Pn,ki).call(this,[[oe.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(u(this,Bd)!==e){w(this,Bd,e);for(let t of u(this,Ze).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){let t=[];for(let n of u(this,He).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return u(this,He).get(e)}addEditor(e){u(this,He).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(u(this,ei)&&clearTimeout(u(this,ei)),w(this,ei,setTimeout(()=>{this.focusMainContainer(),w(this,ei,null)},0))),u(this,He).delete(e.id),this.unselect(e),(!e.annotationElementId||!u(this,Lr).has(e.annotationElementId))&&((t=u(this,Oi))==null||t.remove(e.id))}addDeletedAnnotationElement(e){u(this,Lr).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return u(this,Lr).has(e)}removeDeletedAnnotationElement(e){u(this,Lr).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){u(this,Gt)!==e&&(w(this,Gt,e),e&&A(this,Pn,ki).call(this,e.propertiesToUpdate))}updateUI(e){u(this,hm,Dx)===e&&A(this,Pn,ki).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){A(this,Pn,ki).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(u(this,he).has(e)){u(this,he).delete(e),e.unselect(),A(this,je,Et).call(this,{hasSelectedEditor:this.hasSelection});return}u(this,he).add(e),e.select(),A(this,Pn,ki).call(this,e.propertiesToUpdate),A(this,je,Et).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=u(this,Fr))==null||t.commitOrRemove();for(let n of u(this,he))n!==e&&n.unselect();u(this,he).clear(),u(this,he).add(e),e.select(),A(this,Pn,ki).call(this,e.propertiesToUpdate),A(this,je,Et).call(this,{hasSelectedEditor:!0})}isSelected(e){return u(this,he).has(e)}get firstSelectedEditor(){return u(this,he).values().next().value}unselect(e){e.unselect(),u(this,he).delete(e),A(this,je,Et).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return u(this,he).size!==0}get isEnterHandled(){return u(this,he).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;u(this,dn).undo(),A(this,je,Et).call(this,{hasSomethingToUndo:u(this,dn).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:A(this,Br,jc).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){u(this,dn).redo(),A(this,je,Et).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:u(this,dn).hasSomethingToRedo(),isEmpty:A(this,Br,jc).call(this)})}addCommands(e){u(this,dn).add(e),A(this,je,Et).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:A(this,Br,jc).call(this)})}cleanUndoStack(e){u(this,dn).cleanType(e)}delete(){var r;this.commitOrRemove();let e=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!e)return;let t=e?[e]:[...u(this,he)],n=()=>{var o;(o=this._editorUndoBar)==null||o.show(s,t.length===1?t[0].editorType:t.length);for(let a of t)a.remove()},s=()=>{for(let o of t)A(this,Xd,$E).call(this,o)};this.addCommands({cmd:n,undo:s,mustExec:!0})}commitOrRemove(){var e;(e=u(this,Gt))==null||e.commitOrRemove()}hasSomethingToControl(){return u(this,Gt)||this.hasSelection}selectAll(){for(let e of u(this,he))e.commit();A(this,Zd,zE).call(this,u(this,He).values())}unselectAll(){var e;if(!(u(this,Gt)&&(u(this,Gt).commitOrRemove(),u(this,$e)!==j.NONE))&&!((e=u(this,Fr))!=null&&e.commitOrRemove())&&this.hasSelection){for(let t of u(this,he))t.unselect();u(this,he).clear(),A(this,je,Et).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;u(this,Ds)[0]+=e,u(this,Ds)[1]+=t;let[s,r]=u(this,Ds),o=[...u(this,he)],a=1e3;u(this,ni)&&clearTimeout(u(this,ni)),w(this,ni,setTimeout(()=>{w(this,ni,null),u(this,Ds)[0]=u(this,Ds)[1]=0,this.addCommands({cmd:()=>{for(let l of o)u(this,He).has(l.id)&&l.translateInPage(s,r)},undo:()=>{for(let l of o)u(this,He).has(l.id)&&l.translateInPage(-s,-r)},mustExec:!1})},a));for(let l of o)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),w(this,Qn,new Map);for(let e of u(this,he))u(this,Qn).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!u(this,Qn))return!1;this.disableUserSelect(!1);let e=u(this,Qn);w(this,Qn,null);let t=!1;for(let[{x:s,y:r,pageIndex:o},a]of e)a.newX=s,a.newY=r,a.newPageIndex=o,t||(t=s!==a.savedX||r!==a.savedY||o!==a.savedPageIndex);if(!t)return!1;let n=(s,r,o,a)=>{if(u(this,He).has(s.id)){let l=u(this,Ze).get(a);l?s._setParentAndPosition(l,r,o):(s.pageIndex=a,s.x=r,s.y=o)}};return this.addCommands({cmd:()=>{for(let[s,{newX:r,newY:o,newPageIndex:a}]of e)n(s,r,o,a)},undo:()=>{for(let[s,{savedX:r,savedY:o,savedPageIndex:a}]of e)n(s,r,o,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(u(this,Qn))for(let n of u(this,Qn).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){let t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||u(this,he).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return u(this,Gt)===e}getActive(){return u(this,Gt)}getMode(){return u(this,$e)}get imageManager(){return se(this,"imageManager",new LE)}getSelectionBoxes(e){if(!e)return null;let t=document.getSelection();for(let c=0,d=t.rangeCount;c<d;c++)if(!e.contains(t.getRangeAt(c).commonAncestorContainer))return null;let{x:n,y:s,width:r,height:o}=e.getBoundingClientRect(),a;switch(e.getAttribute("data-main-rotation")){case"90":a=(c,d,h,p)=>({x:(d-s)/o,y:1-(c+h-n)/r,width:p/o,height:h/r});break;case"180":a=(c,d,h,p)=>({x:1-(c+h-n)/r,y:1-(d+p-s)/o,width:h/r,height:p/o});break;case"270":a=(c,d,h,p)=>({x:1-(d+p-s)/o,y:(c-n)/r,width:p/o,height:h/r});break;default:a=(c,d,h,p)=>({x:(c-n)/r,y:(d-s)/o,width:h/r,height:p/o});break}let l=[];for(let c=0,d=t.rangeCount;c<d;c++){let h=t.getRangeAt(c);if(!h.collapsed)for(let{x:p,y:m,width:y,height:v}of h.getClientRects())y===0||v===0||l.push(a(p,m,y,v))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(u(this,Ya)||w(this,Ya,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=u(this,Ya))==null||t.delete(e)}renderAnnotationElement(e){var s;let t=(s=u(this,Ya))==null?void 0:s.get(e.data.id);if(!t)return;let n=u(this,Oi).getRawValue(t);n&&(u(this,$e)===j.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}};qa=new WeakMap,Gt=new WeakMap,He=new WeakMap,Ze=new WeakMap,Wa=new WeakMap,Oi=new WeakMap,Ya=new WeakMap,dn=new WeakMap,_s=new WeakMap,Fr=new WeakMap,Ka=new WeakMap,Lr=new WeakMap,Qn=new WeakMap,Dn=new WeakMap,Or=new WeakMap,Od=new WeakMap,Ud=new WeakMap,Ja=new WeakMap,Hd=new WeakMap,ei=new WeakMap,Ts=new WeakMap,Xa=new WeakMap,xs=new WeakMap,ti=new WeakMap,nm=new WeakMap,Rs=new WeakMap,Bd=new WeakMap,Is=new WeakMap,Ur=new WeakMap,Gd=new WeakMap,Vd=new WeakMap,$e=new WeakMap,he=new WeakMap,Ui=new WeakMap,Hr=new WeakMap,$d=new WeakMap,zd=new WeakMap,Ds=new WeakMap,ni=new WeakMap,Hi=new WeakMap,qd=new WeakMap,un=new WeakMap,Za=new WeakSet,zp=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},Wd=new WeakSet,HE=function(e){let{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(let n of u(this,Ze).values())if(n.hasTextLayer(e))return n;return null},im=new WeakSet,wx=function(){let e=document.getSelection();if(!e||e.isCollapsed)return;let n=A(this,Za,zp).call(this,e).closest(".textLayer"),s=this.getSelectionBoxes(n);s&&(u(this,ti)||w(this,ti,new NE(this)),u(this,ti).show(n,s,this.direction==="ltr"))},sm=new WeakSet,Sx=function(){var r,o,a;let e=document.getSelection();if(!e||e.isCollapsed){u(this,Ui)&&((r=u(this,ti))==null||r.hide(),w(this,Ui,null),A(this,je,Et).call(this,{hasSelectedText:!1}));return}let{anchorNode:t}=e;if(t===u(this,Ui))return;let s=A(this,Za,zp).call(this,e).closest(".textLayer");if(!s){u(this,Ui)&&((o=u(this,ti))==null||o.hide(),w(this,Ui,null),A(this,je,Et).call(this,{hasSelectedText:!1}));return}if((a=u(this,ti))==null||a.hide(),w(this,Ui,t),A(this,je,Et).call(this,{hasSelectedText:!0}),!(u(this,$e)!==j.HIGHLIGHT&&u(this,$e)!==j.NONE)&&(u(this,$e)===j.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),w(this,xs,this.isShiftKeyDown),!this.isShiftKeyDown)){let l=u(this,$e)===j.HIGHLIGHT?A(this,Wd,HE).call(this,s):null;l==null||l.toggleDrawing();let c=new AbortController,d=this.combinedSignal(c),h=p=>{p.type==="pointerup"&&p.button!==0||(c.abort(),l==null||l.toggleDrawing(!0),p.type==="pointerup"&&A(this,ja,qp).call(this,"main_toolbar"))};window.addEventListener("pointerup",h,{signal:d}),window.addEventListener("blur",h,{signal:d})}},ja=new WeakSet,qp=function(e=""){u(this,$e)===j.HIGHLIGHT?this.highlightSelection(e):u(this,Od)&&A(this,im,wx).call(this)},rm=new WeakSet,Ax=function(){document.addEventListener("selectionchange",A(this,sm,Sx).bind(this),{signal:this._signal})},om=new WeakSet,Cx=function(){if(u(this,Ts))return;w(this,Ts,new AbortController);let e=this.combinedSignal(u(this,Ts));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},am=new WeakSet,_x=function(){var e;(e=u(this,Ts))==null||e.abort(),w(this,Ts,null)},Yd=new WeakSet,BE=function(){if(u(this,Is))return;w(this,Is,new AbortController);let e=this.combinedSignal(u(this,Is));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},lm=new WeakSet,Tx=function(){var e;(e=u(this,Is))==null||e.abort(),w(this,Is,null)},Kd=new WeakSet,GE=function(){if(u(this,_s))return;w(this,_s,new AbortController);let e=this.combinedSignal(u(this,_s));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},Jd=new WeakSet,VE=function(){var e;(e=u(this,_s))==null||e.abort(),w(this,_s,null)},cm=new WeakSet,xx=function(){let e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},je=new WeakSet,Et=function(e){Object.entries(e).some(([n,s])=>u(this,zd)[n]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(u(this,zd),e)}),u(this,$e)===j.HIGHLIGHT&&e.hasSelectedEditor===!1&&A(this,Pn,ki).call(this,[[oe.HIGHLIGHT_FREE,!0]]))},Pn=new WeakSet,ki=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},dm=new WeakSet,Rx=async function(){if(!u(this,Rs)){w(this,Rs,!0);let e=[];for(let t of u(this,Ze).values())e.push(t.enable());await Promise.all(e);for(let t of u(this,He).values())t.enable()}},um=new WeakSet,Ix=function(){if(this.unselectAll(),u(this,Rs)){w(this,Rs,!1);for(let e of u(this,Ze).values())e.disable();for(let e of u(this,He).values())e.disable()}},Xd=new WeakSet,$E=function(e){let t=u(this,Ze).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},hm=new WeakSet,Dx=function(){let e=null;for(e of u(this,he));return e},Br=new WeakSet,jc=function(){if(u(this,He).size===0)return!0;if(u(this,He).size===1)for(let e of u(this,He).values())return e.isEmpty();return!1},Zd=new WeakSet,zE=function(e){for(let t of u(this,he))t.unselect();u(this,he).clear();for(let t of e)t.isEmpty()||(u(this,he).add(t),t.select());A(this,je,Et).call(this,{hasSelectedEditor:this.hasSelection})},Y(Oa,"TRANSLATE_SMALL",1),Y(Oa,"TRANSLATE_BIG",10);var jo=Oa,ze,ii,Mn,Qa,si,Vt,el,ri,Pt,Bi,Gr,oi,Ps,Vr,Qc,tl,Wp,wt=class wt{constructor(e){b(this,Vr);b(this,tl);b(this,ze,null);b(this,ii,!1);b(this,Mn,null);b(this,Qa,null);b(this,si,null);b(this,Vt,null);b(this,el,!1);b(this,ri,null);b(this,Pt,null);b(this,Bi,null);b(this,Gr,null);b(this,oi,!1);w(this,Pt,e),w(this,oi,e._uiManager.useNewAltTextFlow),u(wt,Ps)||w(wt,Ps,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){var t;(t=wt._l10n)!=null||(wt._l10n=e)}async render(){let e=w(this,Mn,document.createElement("button"));e.className="altText",e.tabIndex="0";let t=w(this,Qa,document.createElement("span"));e.append(t),u(this,oi)?(e.classList.add("new"),e.setAttribute("data-l10n-id",u(wt,Ps).missing),t.setAttribute("data-l10n-id",u(wt,Ps)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let n=u(this,Pt)._uiManager._signal;e.addEventListener("contextmenu",zn,{signal:n}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});let s=r=>{r.preventDefault(),u(this,Pt)._uiManager.editAltText(u(this,Pt)),u(this,oi)&&u(this,Pt)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:u(this,Vr,Qc)}})};return e.addEventListener("click",s,{capture:!0,signal:n}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(w(this,el,!0),s(r))},{signal:n}),await A(this,tl,Wp).call(this),e}finish(){u(this,Mn)&&(u(this,Mn).focus({focusVisible:u(this,el)}),w(this,el,!1))}isEmpty(){return u(this,oi)?u(this,ze)===null:!u(this,ze)&&!u(this,ii)}hasData(){return u(this,oi)?u(this,ze)!==null||!!u(this,Bi):this.isEmpty()}get guessedText(){return u(this,Bi)}async setGuessedText(e){u(this,ze)===null&&(w(this,Bi,e),w(this,Gr,await wt._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),A(this,tl,Wp).call(this))}toggleAltTextBadge(e=!1){var t;if(!u(this,oi)||u(this,ze)){(t=u(this,ri))==null||t.remove(),w(this,ri,null);return}if(!u(this,ri)){let n=w(this,ri,document.createElement("div"));n.className="noAltTextBadge",u(this,Pt).div.append(n)}u(this,ri).classList.toggle("hidden",!e)}serialize(e){let t=u(this,ze);return!e&&u(this,Bi)===t&&(t=u(this,Gr)),{altText:t,decorative:u(this,ii),guessedText:u(this,Bi),textWithDisclaimer:u(this,Gr)}}get data(){return{altText:u(this,ze),decorative:u(this,ii)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:s,cancel:r=!1}){n&&(w(this,Bi,n),w(this,Gr,s)),!(u(this,ze)===e&&u(this,ii)===t)&&(r||(w(this,ze,e),w(this,ii,t)),A(this,tl,Wp).call(this))}toggle(e=!1){u(this,Mn)&&(!e&&u(this,Vt)&&(clearTimeout(u(this,Vt)),w(this,Vt,null)),u(this,Mn).disabled=!e)}shown(){u(this,Pt)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:u(this,Vr,Qc)}})}destroy(){var e,t;(e=u(this,Mn))==null||e.remove(),w(this,Mn,null),w(this,Qa,null),w(this,si,null),(t=u(this,ri))==null||t.remove(),w(this,ri,null)}};ze=new WeakMap,ii=new WeakMap,Mn=new WeakMap,Qa=new WeakMap,si=new WeakMap,Vt=new WeakMap,el=new WeakMap,ri=new WeakMap,Pt=new WeakMap,Bi=new WeakMap,Gr=new WeakMap,oi=new WeakMap,Ps=new WeakMap,Vr=new WeakSet,Qc=function(){return u(this,ze)&&"added"||u(this,ze)===null&&this.guessedText&&"review"||"missing"},tl=new WeakSet,Wp=async function(){var s,r,o;let e=u(this,Mn);if(!e)return;if(u(this,oi)){if(e.classList.toggle("done",!!u(this,ze)),e.setAttribute("data-l10n-id",u(wt,Ps)[u(this,Vr,Qc)]),(s=u(this,Qa))==null||s.setAttribute("data-l10n-id",u(wt,Ps)[`${u(this,Vr,Qc)}-label`]),!u(this,ze)){(r=u(this,si))==null||r.remove();return}}else{if(!u(this,ze)&&!u(this,ii)){e.classList.remove("done"),(o=u(this,si))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=u(this,si);if(!t){w(this,si,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${u(this,Pt).id}`;let a=100,l=u(this,Pt)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(u(this,Vt)),w(this,Vt,null)},{once:!0}),e.addEventListener("mouseenter",()=>{w(this,Vt,setTimeout(()=>{w(this,Vt,null),u(this,si).classList.add("show"),u(this,Pt)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:l}),e.addEventListener("mouseleave",()=>{var c;u(this,Vt)&&(clearTimeout(u(this,Vt)),w(this,Vt,null)),(c=u(this,si))==null||c.classList.remove("show")},{signal:l})}u(this,ii)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=u(this,ze)),t.parentNode||e.append(t);let n=u(this,Pt).getImageForAltText();n==null||n.setAttribute("aria-describedby",t.id)},b(wt,Ps,null),Y(wt,"_l10n",null);var bg=wt,jd,$r,Qd,eu,tu,nu,iu,nl,Gi,zr,Ms,fm,Px,pm,Mx,su,qE,JS=class JS{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:s=null,onPinching:r=null,onPinchEnd:o=null,signal:a}){b(this,fm);b(this,pm);b(this,su);b(this,jd,void 0);b(this,$r,!1);b(this,Qd,null);b(this,eu,void 0);b(this,tu,void 0);b(this,nu,void 0);b(this,iu,void 0);b(this,nl,void 0);b(this,Gi,null);b(this,zr,void 0);b(this,Ms,null);w(this,jd,e),w(this,Qd,n),w(this,eu,t),w(this,tu,s),w(this,nu,r),w(this,iu,o),w(this,zr,new AbortController),w(this,nl,AbortSignal.any([a,u(this,zr).signal])),e.addEventListener("touchstart",A(this,fm,Px).bind(this),{passive:!1,signal:u(this,nl)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return se(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=u(this,zr))==null||e.abort(),w(this,zr,null)}};jd=new WeakMap,$r=new WeakMap,Qd=new WeakMap,eu=new WeakMap,tu=new WeakMap,nu=new WeakMap,iu=new WeakMap,nl=new WeakMap,Gi=new WeakMap,zr=new WeakMap,Ms=new WeakMap,fm=new WeakSet,Px=function(e){var s,r,o;if((s=u(this,eu))!=null&&s.call(this)||e.touches.length<2)return;if(!u(this,Ms)){w(this,Ms,new AbortController);let a=AbortSignal.any([u(this,nl),u(this,Ms).signal]),l=u(this,jd),c={signal:a,passive:!1};l.addEventListener("touchmove",A(this,pm,Mx).bind(this),c),l.addEventListener("touchend",A(this,su,qE).bind(this),c),l.addEventListener("touchcancel",A(this,su,qE).bind(this),c),(r=u(this,tu))==null||r.call(this)}if(en(e),e.touches.length!==2||(o=u(this,Qd))!=null&&o.call(this)){w(this,Gi,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),w(this,Gi,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},pm=new WeakSet,Mx=function(e){var T;if(!u(this,Gi)||e.touches.length!==2)return;let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);let{screenX:s,screenY:r}=t,{screenX:o,screenY:a}=n,l=u(this,Gi),{touch0X:c,touch0Y:d,touch1X:h,touch1Y:p}=l,m=h-c,y=p-d,v=o-s,E=a-r,S=Math.hypot(v,E)||1,C=Math.hypot(m,y)||1;if(!u(this,$r)&&Math.abs(C-S)<=JS.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=s,l.touch0Y=r,l.touch1X=o,l.touch1Y=a,e.preventDefault(),!u(this,$r)){w(this,$r,!0);return}let _=[(s+o)/2,(r+a)/2];(T=u(this,nu))==null||T.call(this,_,C,S)},su=new WeakSet,qE=function(e){var t;u(this,Ms).abort(),w(this,Ms,null),(t=u(this,iu))==null||t.call(this),u(this,Gi)&&(e.preventDefault(),w(this,Gi,null),w(this,$r,!1))};var Eg=JS,qr,kn,ye,il,ks,ru,Wr,Qe,Yr,Vi,Ns,ou,Kr,$t,au,Jr,$i,ai,sl,rl,hn,Xr,lu,gm,cu,WE,du,YE,ol,Yp,mm,kx,ym,Nx,uu,KE,al,Kp,hu,JE,vm,Fx,bm,Lx,Em,Ox,fu,XE,wm,Ux,pu,ZE,Sm,Hx,Am,Bx,Cm,Gx,gu,jE,Zr,ed,ee=class ee{constructor(e){b(this,cu);b(this,ol);b(this,mm);b(this,ym);b(this,uu);b(this,al);b(this,hu);b(this,vm);b(this,bm);b(this,Em);b(this,fu);b(this,wm);b(this,pu);b(this,Sm);b(this,Am);b(this,Cm);b(this,gu);b(this,Zr);b(this,qr,null);b(this,kn,null);b(this,ye,null);b(this,il,!1);b(this,ks,null);b(this,ru,"");b(this,Wr,!1);b(this,Qe,null);b(this,Yr,null);b(this,Vi,null);b(this,Ns,null);b(this,ou,"");b(this,Kr,!1);b(this,$t,null);b(this,au,!1);b(this,Jr,!1);b(this,$i,!1);b(this,ai,null);b(this,sl,0);b(this,rl,0);b(this,hn,null);b(this,Xr,null);Y(this,"_editToolbar",null);Y(this,"_initialOptions",Object.create(null));Y(this,"_initialData",null);Y(this,"_isVisible",!0);Y(this,"_uiManager",null);Y(this,"_focusEventsAllowed",!0);b(this,lu,!1);b(this,gm,ee._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;let{rotation:t,rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,s],this.pageTranslation=[r,o];let[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){let e=ee.prototype._resizeWithKeyboard,t=jo.TRANSLATE_SMALL,n=jo.TRANSLATE_BIG;return se(this,"_resizerKeyboardManager",new Zo([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],ee.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return se(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let t=new QE({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){var s;if((s=ee._l10n)!=null||(ee._l10n=e),ee._l10nResizer||(ee._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),ee._borderLineWidth!==-1)return;let n=getComputedStyle(document.documentElement);ee._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){ge("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return u(this,lu)}set _isDraggable(e){var t;w(this,lu,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){let[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=u(this,gm)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):A(this,Zr,ed).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(u(this,Kr)?w(this,Kr,!1):this.parent.setSelected(this))}focusout(e){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;let t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,s){let[r,o]=this.parentDimensions;[n,s]=this.screenToPageTranslation(n,s),this.x=(e+n)/r,this.y=(t+s)/o,this.fixAndSetPosition()}translate(e,t){A(this,cu,WE).call(this,this.parentDimensions,e,t)}translateInPage(e,t){u(this,$t)||w(this,$t,[this.x,this.y,this.width,this.height]),A(this,cu,WE).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){u(this,$t)||w(this,$t,[this.x,this.y,this.width,this.height]);let{div:n,parentDimensions:[s,r]}=this;if(this.x+=e/s,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:h,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this,[l,c]=this.getBaseTranslation();o+=l,a+=c;let{style:d}=n;d.left=`${(100*o).toFixed(2)}%`,d.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!u(this,$t)&&(u(this,$t)[0]!==this.x||u(this,$t)[1]!==this.y)}get _hasBeenResized(){return!!u(this,$t)&&(u(this,$t)[2]!==this.width||u(this,$t)[3]!==this.height)}getBaseTranslation(){let[e,t]=this.parentDimensions,{_borderLineWidth:n}=ee,s=n/e,r=n/t;switch(this.rotation){case 90:return[-s,r];case 180:return[s,r];case 270:return[s,-r];default:return[-s,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){let{div:{style:t},pageDimensions:[n,s]}=this,{x:r,y:o,width:a,height:l}=this;if(a*=n,l*=s,r*=n,o*=s,this._mustFixPosition)switch(e){case 0:r=Math.max(0,Math.min(n-a,r)),o=Math.max(0,Math.min(s-l,o));break;case 90:r=Math.max(0,Math.min(n-l,r)),o=Math.min(s,Math.max(a,o));break;case 180:r=Math.min(n,Math.max(a,r)),o=Math.min(s,Math.max(l,o));break;case 270:r=Math.min(n,Math.max(l,r)),o=Math.max(0,Math.min(s-a,o));break}this.x=r/=n,this.y=o/=s;let[c,d]=this.getBaseTranslation();r+=c,o+=d,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return A(n=ee,du,YE).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return A(n=ee,du,YE).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(e,t){let[n,s]=this.parentDimensions,{style:r}=this.div;r.width=`${(100*e/n).toFixed(2)}%`,u(this,Wr)||(r.height=`${(100*t/s).toFixed(2)}%`)}fixDims(){let{style:e}=this.div,{height:t,width:n}=e,s=n.endsWith("%"),r=!u(this,Wr)&&t.endsWith("%");if(s&&r)return;let[o,a]=this.parentDimensions;s||(e.width=`${(100*parseFloat(n)/o).toFixed(2)}%`),!u(this,Wr)&&!r&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=u(this,ye))==null||e.finish()}async addEditToolbar(){return this._editToolbar||u(this,Jr)?this._editToolbar:(this._editToolbar=new ME(this),this.div.append(this._editToolbar.render()),u(this,ye)&&await this._editToolbar.addAltText(u(this,ye)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=u(this,ye))==null||e.destroy())}addContainer(e){var n;let t=(n=this._editToolbar)==null?void 0:n.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){u(this,ye)||(bg.initialize(ee._l10n),w(this,ye,new bg(this)),u(this,qr)&&(u(this,ye).data=u(this,qr),w(this,qr,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=u(this,ye))==null?void 0:e.data}set altTextData(e){u(this,ye)&&(u(this,ye).data=e)}get guessedAltText(){var e;return(e=u(this,ye))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=u(this,ye))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=u(this,ye))==null?void 0:t.serialize(e)}hasAltText(){return!!u(this,ye)&&!u(this,ye).isEmpty()}hasAltTextData(){var e,t;return(t=(e=u(this,ye))==null?void 0:e.hasData())!=null?t:!1}render(){var r;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=u(this,il)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),A(this,pu,ZE).call(this);let[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);let[n,s]=this.getInitialTranslation();return this.translate(n,s),vg(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(u(this,Xr)||w(this,Xr,new Eg({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:A(this,vm,Fx).bind(this),onPinching:A(this,bm,Lx).bind(this),onPinchEnd:A(this,Em,Ox).bind(this),signal:this._uiManager._signal}))),(r=this._uiManager._editorUndoBar)==null||r.hide(),this.div}pointerdown(e){let{isMac:t}=it.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(w(this,Kr,!0),this._isDraggable){A(this,wm,Ux).call(this,e);return}A(this,fu,XE).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){u(this,ai)&&clearTimeout(u(this,ai)),w(this,ai,setTimeout(()=>{var e;w(this,ai,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){let s=this.parentScale,[r,o]=this.pageDimensions,[a,l]=this.pageTranslation,c=e/s,d=t/s,h=this.x*r,p=this.y*o,m=this.width*r,y=this.height*o;switch(n){case 0:return[h+c+a,o-p-d-y+l,h+c+m+a,o-p-d+l];case 90:return[h+d+a,o-p+c+l,h+d+y+a,o-p+c+m+l];case 180:return[h-c-m+a,o-p+d+l,h-c+a,o-p+d+y+l];case 270:return[h-d-y+a,o-p-c-m+l,h-d+a,o-p-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){let[n,s,r,o]=e,a=r-n,l=o-s;switch(this.rotation){case 0:return[n,t-o,a,l];case 90:return[n,t-s,l,a];case 180:return[r,t-s,a,l];case 270:return[r,t-o,l,a];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){w(this,Jr,!0)}disableEditMode(){w(this,Jr,!1)}isInEditMode(){return u(this,Jr)}shouldGetKeyboardEvents(){return u(this,$i)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:e,left:t,bottom:n,right:s}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&s>0&&e<r&&n>0}rebuild(){A(this,pu,ZE).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){ge("An editor must be serializable")}static async deserialize(e,t,n){let s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n});s.rotation=e.rotation,w(s,qr,e.accessibilityData);let[r,o]=s.pageDimensions,[a,l,c,d]=s.getRectInCurrentCoords(e.rect,o);return s.x=a/r,s.y=l/o,s.width=c/r,s.height=d/o,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=u(this,Ns))==null||e.abort(),w(this,Ns,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),u(this,ai)&&(clearTimeout(u(this,ai)),w(this,ai,null)),A(this,Zr,ed).call(this),this.removeEditToolbar(),u(this,hn)){for(let n of u(this,hn).values())clearTimeout(n);w(this,hn,null)}this.parent=null,(t=u(this,Xr))==null||t.destroy(),w(this,Xr,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(A(this,mm,kx).call(this),u(this,Qe).classList.remove("hidden"),vg(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),w(this,Vi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let t=u(this,Qe).children;if(!u(this,kn)){w(this,kn,Array.from(t));let o=A(this,Sm,Hx).bind(this),a=A(this,Am,Bx).bind(this),l=this._uiManager._signal;for(let c of u(this,kn)){let d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",o,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",A(this,Cm,Gx).bind(this,d),{signal:l}),c.setAttribute("data-l10n-id",ee._l10nResizer[d])}}let n=u(this,kn)[0],s=0;for(let o of t){if(o===n)break;s++}let r=(360-this.rotation+this.parentRotation)%360/90*(u(this,kn).length/4);if(r!==s){if(r<s)for(let a=0;a<s-r;a++)u(this,Qe).append(u(this,Qe).firstChild);else if(r>s)for(let a=0;a<r-s;a++)u(this,Qe).firstChild.before(u(this,Qe).lastChild);let o=0;for(let a of t){let c=u(this,kn)[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",ee._l10nResizer[c])}}A(this,gu,jE).call(this,0),w(this,$i,!0),u(this,Qe).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){u(this,$i)&&A(this,hu,JE).call(this,u(this,ou),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){A(this,Zr,ed).call(this),this.div.focus()}select(){var e,t,n;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var s,r;(s=this.div)!=null&&s.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(n=u(this,ye))==null||n.toggleAltTextBadge(!1)}unselect(){var e,t,n,s,r;(e=u(this,Qe))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(s=this._editToolbar)==null||s.hide(),(r=u(this,ye))==null||r.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return u(this,au)}set isEditing(e){w(this,au,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){w(this,Wr,!0);let n=e/t,{style:s}=this.div;s.aspectRatio=n,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){u(this,hn)||w(this,hn,new Map);let{action:n}=e,s=u(this,hn).get(n);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),u(this,hn).delete(n),u(this,hn).size===0&&w(this,hn,null)},ee._telemetryTimeout),u(this,hn).set(n,s);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),w(this,il,!1)}disable(){this.div&&(this.div.tabIndex=-1),w(this,il,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){let n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){let{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};qr=new WeakMap,kn=new WeakMap,ye=new WeakMap,il=new WeakMap,ks=new WeakMap,ru=new WeakMap,Wr=new WeakMap,Qe=new WeakMap,Yr=new WeakMap,Vi=new WeakMap,Ns=new WeakMap,ou=new WeakMap,Kr=new WeakMap,$t=new WeakMap,au=new WeakMap,Jr=new WeakMap,$i=new WeakMap,ai=new WeakMap,sl=new WeakMap,rl=new WeakMap,hn=new WeakMap,Xr=new WeakMap,lu=new WeakMap,gm=new WeakMap,cu=new WeakSet,WE=function([e,t],n,s){[n,s]=this.screenToPageTranslation(n,s),this.x+=n/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},du=new WeakSet,YE=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},ol=new WeakSet,Yp=function(e){switch(e){case 90:{let[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{let[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},mm=new WeakSet,kx=function(){if(u(this,Qe))return;w(this,Qe,document.createElement("div")),u(this,Qe).classList.add("resizers");let e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(let n of e){let s=document.createElement("div");u(this,Qe).append(s),s.classList.add("resizer",n),s.setAttribute("data-resizer-name",n),s.addEventListener("pointerdown",A(this,ym,Nx).bind(this,n),{signal:t}),s.addEventListener("contextmenu",zn,{signal:t}),s.tabIndex=-1}this.div.prepend(u(this,Qe))},ym=new WeakSet,Nx=function(e,t){var d;t.preventDefault();let{isMac:n}=it.platform;if(t.button!==0||t.ctrlKey&&n)return;(d=u(this,ye))==null||d.toggle(!1);let s=this._isDraggable;this._isDraggable=!1,w(this,Yr,[t.screenX,t.screenY]);let r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",A(this,hu,JE).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",en,{passive:!1,signal:o}),window.addEventListener("contextmenu",zn,{signal:o}),w(this,Vi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;let c=()=>{var h;r.abort(),this.parent.togglePointerEvents(!0),(h=u(this,ye))==null||h.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=a,this.div.style.cursor=l,A(this,al,Kp).call(this)};window.addEventListener("pointerup",c,{signal:o}),window.addEventListener("blur",c,{signal:o})},uu=new WeakSet,KE=function(e,t,n,s){this.width=n,this.height=s,this.x=e,this.y=t;let[r,o]=this.parentDimensions;this.setDims(r*n,o*s),this.fixAndSetPosition(),this._onResized()},al=new WeakSet,Kp=function(){if(!u(this,Vi))return;let{savedX:e,savedY:t,savedWidth:n,savedHeight:s}=u(this,Vi);w(this,Vi,null);let r=this.x,o=this.y,a=this.width,l=this.height;r===e&&o===t&&a===n&&l===s||this.addCommands({cmd:A(this,uu,KE).bind(this,r,o,a,l),undo:A(this,uu,KE).bind(this,e,t,n,s),mustExec:!0})},hu=new WeakSet,JE=function(e,t){let[n,s]=this.parentDimensions,r=this.x,o=this.y,a=this.width,l=this.height,c=ee.MIN_SIZE/n,d=ee.MIN_SIZE/s,h=A(this,ol,Yp).call(this,this.rotation),p=(L,W)=>[h[0]*L+h[2]*W,h[1]*L+h[3]*W],m=A(this,ol,Yp).call(this,360-this.rotation),y=(L,W)=>[m[0]*L+m[2]*W,m[1]*L+m[3]*W],v,E,S=!1,C=!1;switch(e){case"topLeft":S=!0,v=(L,W)=>[0,0],E=(L,W)=>[L,W];break;case"topMiddle":v=(L,W)=>[L/2,0],E=(L,W)=>[L/2,W];break;case"topRight":S=!0,v=(L,W)=>[L,0],E=(L,W)=>[0,W];break;case"middleRight":C=!0,v=(L,W)=>[L,W/2],E=(L,W)=>[0,W/2];break;case"bottomRight":S=!0,v=(L,W)=>[L,W],E=(L,W)=>[0,0];break;case"bottomMiddle":v=(L,W)=>[L/2,W],E=(L,W)=>[L/2,0];break;case"bottomLeft":S=!0,v=(L,W)=>[0,W],E=(L,W)=>[L,0];break;case"middleLeft":C=!0,v=(L,W)=>[0,W/2],E=(L,W)=>[L,W/2];break}let _=v(a,l),T=E(a,l),R=p(...T),I=ee._round(r+R[0]),D=ee._round(o+R[1]),k=1,N=1,F,U;if(t.fromKeyboard)({deltaX:F,deltaY:U}=t);else{let{screenX:L,screenY:W}=t,[Bt,Kn]=u(this,Yr);[F,U]=this.screenToPageTranslation(L-Bt,W-Kn),u(this,Yr)[0]=L,u(this,Yr)[1]=W}if([F,U]=y(F/n,U/s),S){let L=Math.hypot(a,l);k=N=Math.max(Math.min(Math.hypot(T[0]-_[0]-F,T[1]-_[1]-U)/L,1/a,1/l),c/a,d/l)}else C?k=Math.max(c,Math.min(1,Math.abs(T[0]-_[0]-F)))/a:N=Math.max(d,Math.min(1,Math.abs(T[1]-_[1]-U)))/l;let re=ee._round(a*k),X=ee._round(l*N);R=p(...E(re,X));let Z=I-R[0],Ve=D-R[1];u(this,$t)||w(this,$t,[this.x,this.y,this.width,this.height]),this.width=re,this.height=X,this.x=Z,this.y=Ve,this.setDims(n*re,s*X),this.fixAndSetPosition(),this._onResizing()},vm=new WeakSet,Fx=function(){var e;w(this,Vi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=u(this,ye))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},bm=new WeakSet,Lx=function(e,t,n){let r=.7*(n/t)+1-.7;if(r===1)return;let o=A(this,ol,Yp).call(this,this.rotation),a=(I,D)=>[o[0]*I+o[2]*D,o[1]*I+o[3]*D],[l,c]=this.parentDimensions,d=this.x,h=this.y,p=this.width,m=this.height,y=ee.MIN_SIZE/l,v=ee.MIN_SIZE/c;r=Math.max(Math.min(r,1/p,1/m),y/p,v/m);let E=ee._round(p*r),S=ee._round(m*r);if(E===p&&S===m)return;u(this,$t)||w(this,$t,[d,h,p,m]);let C=a(p/2,m/2),_=ee._round(d+C[0]),T=ee._round(h+C[1]),R=a(E/2,S/2);this.x=_-R[0],this.y=T-R[1],this.width=E,this.height=S,this.setDims(l*E,c*S),this.fixAndSetPosition(),this._onResizing()},Em=new WeakSet,Ox=function(){var e;(e=u(this,ye))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),A(this,al,Kp).call(this)},fu=new WeakSet,XE=function(e){let{isMac:t}=it.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},wm=new WeakSet,Ux=function(e){let{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1,s=new AbortController,r=this._uiManager.combinedSignal(s),o={capture:!0,passive:!1,signal:r},a=c=>{s.abort(),w(this,ks,null),w(this,Kr,!1),this._uiManager.endDragSession()||A(this,fu,XE).call(this,c),n&&this._onStopDragging()};t&&(w(this,sl,e.clientX),w(this,rl,e.clientY),w(this,ks,e.pointerId),w(this,ru,e.pointerType),window.addEventListener("pointermove",c=>{n||(n=!0,this._onStartDragging());let{clientX:d,clientY:h,pointerId:p}=c;if(p!==u(this,ks)){en(c);return}let[m,y]=this.screenToPageTranslation(d-u(this,sl),h-u(this,rl));w(this,sl,d),w(this,rl,h),this._uiManager.dragSelectedEditors(m,y)},o),window.addEventListener("touchmove",en,o),window.addEventListener("pointerdown",c=>{c.pointerType===u(this,ru)&&(u(this,Xr)||c.isPrimary)&&a(c),en(c)},o));let l=c=>{if(!u(this,ks)||u(this,ks)===c.pointerId){a(c);return}en(c)};window.addEventListener("pointerup",l,{signal:r}),window.addEventListener("blur",l,{signal:r})},pu=new WeakSet,ZE=function(){if(u(this,Ns)||!this.div)return;w(this,Ns,new AbortController);let e=this._uiManager.combinedSignal(u(this,Ns));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},Sm=new WeakSet,Hx=function(e){ee._resizerKeyboardManager.exec(this,e)},Am=new WeakSet,Bx=function(e){var t;u(this,$i)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==u(this,Qe)&&A(this,Zr,ed).call(this)},Cm=new WeakSet,Gx=function(e){w(this,ou,u(this,$i)?e:"")},gu=new WeakSet,jE=function(e){if(u(this,kn))for(let t of u(this,kn))t.tabIndex=e},Zr=new WeakSet,ed=function(){w(this,$i,!1),A(this,gu,jE).call(this,-1),A(this,al,Kp).call(this)},b(ee,du),Y(ee,"_l10n",null),Y(ee,"_l10nResizer",null),Y(ee,"_borderLineWidth",-1),Y(ee,"_colorManager",new UE),Y(ee,"_zIndex",1),Y(ee,"_telemetryTimeout",1e3);var Ce=ee,QE=class extends Ce{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},Z0=3285377520,cn=4294901760,Zn=65535,wg=class{constructor(e){this.h1=e?e&4294967295:Z0,this.h2=e?e&4294967295:Z0}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let v=0,E=e.length;v<E;v++){let S=e.charCodeAt(v);S<=255?t[n++]=S:(t[n++]=S>>>8,t[n++]=S&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let s=n>>2,r=n-s*4,o=new Uint32Array(t.buffer,0,s),a=0,l=0,c=this.h1,d=this.h2,h=3432918353,p=461845907,m=h&Zn,y=p&Zn;for(let v=0;v<s;v++)v&1?(a=o[v],a=a*h&cn|a*m&Zn,a=a<<15|a>>>17,a=a*p&cn|a*y&Zn,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=o[v],l=l*h&cn|l*m&Zn,l=l<<15|l>>>17,l=l*p&cn|l*y&Zn,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(a=0,r){case 3:a^=t[s*4+2]<<16;case 2:a^=t[s*4+1]<<8;case 1:a^=t[s*4],a=a*h&cn|a*m&Zn,a=a<<15|a>>>17,a=a*p&cn|a*y&Zn,s&1?c^=a:d^=a}this.h1=c,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&cn|e*36045&Zn,t=t*4283543511&cn|((t<<16|e>>>16)*2950163797&cn)>>>16,e^=t>>>1,e=e*444984403&cn|e*60499&Zn,t=t*3301882366&cn|((t<<16|e>>>16)*3120437893&cn)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}},ew=Object.freeze({map:null,hash:"",transfer:void 0}),jr,Qr,qe,_m,Vx,Ed=class{constructor(){b(this,_m);b(this,jr,!1);b(this,Qr,null);b(this,qe,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let n=u(this,qe).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return u(this,qe).get(e)}remove(e){if(u(this,qe).delete(e),u(this,qe).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let t of u(this,qe).values())if(t instanceof Ce)return;this.onAnnotationEditor(null)}}setValue(e,t){let n=u(this,qe).get(e),s=!1;if(n!==void 0)for(let[r,o]of Object.entries(t))n[r]!==o&&(s=!0,n[r]=o);else s=!0,u(this,qe).set(e,t);s&&A(this,_m,Vx).call(this),t instanceof Ce&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return u(this,qe).has(e)}getAll(){return u(this,qe).size>0?zS(u(this,qe)):null}setAll(e){for(let[t,n]of Object.entries(e))this.setValue(t,n)}get size(){return u(this,qe).size}resetModified(){u(this,jr)&&(w(this,jr,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Sg(this)}get serializable(){if(u(this,qe).size===0)return ew;let e=new Map,t=new wg,n=[],s=Object.create(null),r=!1;for(let[o,a]of u(this,qe)){let l=a instanceof Ce?a.serialize(!1,s):a;l&&(e.set(o,l),t.update(`${o}:${JSON.stringify(l)}`),r||(r=!!l.bitmap))}if(r)for(let o of e.values())o.bitmap&&n.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:ew}get editorStats(){var n;let e=null,t=new Map;for(let s of u(this,qe).values()){if(!(s instanceof Ce))continue;let r=s.telemetryFinalData;if(!r)continue;let{type:o}=r;t.has(o)||t.set(o,Object.getPrototypeOf(s).constructor),e||(e=Object.create(null));let a=e[o]||(e[o]=new Map);for(let[l,c]of Object.entries(r)){if(l==="type")continue;let d=a.get(l);d||(d=new Map,a.set(l,d));let h=(n=d.get(c))!=null?n:0;d.set(c,h+1)}}for(let[s,r]of t)e[s]=r.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){w(this,Qr,null)}get modifiedIds(){if(u(this,Qr))return u(this,Qr);let e=[];for(let t of u(this,qe).values())!(t instanceof Ce)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return w(this,Qr,{ids:new Set(e),hash:e.join(",")})}};jr=new WeakMap,Qr=new WeakMap,qe=new WeakMap,_m=new WeakSet,Vx=function(){u(this,jr)||(w(this,jr,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var mu,Sg=class extends Ed{constructor(t){super();b(this,mu,void 0);let{map:n,hash:s,transfer:r}=t.serializable,o=structuredClone(n,r?{transfer:r}:null);w(this,mu,{map:o,hash:s,transfer:r})}get print(){ge("Should not call PrintAnnotationStorage.print")}get serializable(){return u(this,mu)}get modifiedIds(){return se(this,"modifiedIds",{ids:new Set,hash:""})}};mu=new WeakMap;var ll,tw=class{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){b(this,ll,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),u(this,ll).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||u(this,ll).has(e.loadedName))){if(ke(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:n,src:s,style:r}=e,o=new FontFace(n,s,r);this.addNativeFontFace(o);try{await o.load(),u(this,ll).add(n),t==null||t(e)}catch(a){Q(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}ge("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){let n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(s){throw Q(`Failed to load font '${n.family}': '${s}'.`),e.disableFontFace=!0,s}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{let s=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,s)})}}get isFontLoadingAPISupported(){var t;let e=!!((t=this._document)!=null&&t.fonts);return se(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(mt||typeof navigator!="undefined"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),se(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(ke(!s.done,"completeRequest() cannot be called twice."),s.done=!0;n.length>0&&n[0].done;){let r=n.shift();setTimeout(r.callback,0)}}let{loadingRequests:n}=this,s={done:!1,complete:t,callback:e};return n.push(s),s}get _loadTestFont(){let e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return se(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(T,R){return T.charCodeAt(R)<<24|T.charCodeAt(R+1)<<16|T.charCodeAt(R+2)<<8|T.charCodeAt(R+3)&255}function s(T,R,I,D){let k=T.substring(0,R),N=T.substring(R+I);return k+D+N}let r,o,a=this._document.createElement("canvas");a.width=1,a.height=1;let l=a.getContext("2d"),c=0;function d(T,R){if(++c>30){Q("Load test font never loaded."),R();return}if(l.font="30px "+T,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){R();return}setTimeout(d.bind(null,T,R))}let h=`lt${Date.now()}${this.loadTestFontId++}`,p=this._loadTestFont;p=s(p,976,h.length,h);let y=16,v=1482184792,E=n(p,y);for(r=0,o=h.length-3;r<o;r+=4)E=E-v+n(h,r)|0;r<h.length&&(E=E-v+n(h+"XXX",r)|0),p=s(p,y,4,PO(E));let S=`url(data:font/opentype;base64,${btoa(p)});`,C=`@font-face {font-family:"${h}";src:${S}}`;this.insertRule(C);let _=this._document.createElement("div");_.style.visibility="hidden",_.style.width=_.style.height="10px",_.style.position="absolute",_.style.top=_.style.left="0px";for(let T of[e.loadedName,h]){let R=this._document.createElement("span");R.textContent="Hi",R.style.fontFamily=T,_.append(R)}this._document.body.append(_),d(h,()=>{_.remove(),t.complete()})}};ll=new WeakMap;var nw=class{constructor(e,{disableFontFace:t=!1,fontExtraProperties:n=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(let r in e)this[r]=e[r];this.disableFontFace=t===!0,this.fontExtraProperties=n===!0,this._inspectFont=s}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{let n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;let e=`url(data:${this.mimetype};base64,${OO(this.data)});`,t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${e}}`}return(n=this._inspectFont)==null||n.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let n=this.loadedName+"_path_"+t,s;try{s=e.get(n)}catch(o){Q(`getPathGenerator - ignoring character: "${o}".`)}let r=new Path2D(s||"");return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=r}},Fp={DATA:1,ERROR:2},Me={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function j0(){}function It(i){if(i instanceof yi||i instanceof md||i instanceof Jo||i instanceof mg||i instanceof yc||i instanceof fd)return i;switch(i instanceof Error||typeof i=="object"&&i!==null||ge('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),i.name){case"AbortException":return new yi(i.message);case"InvalidPDFException":return new md(i.message);case"MissingPDFException":return new Jo(i.message);case"PasswordException":return new mg(i.message,i.code);case"UnexpectedResponseException":return new yc(i.message,i.status);case"UnknownErrorException":return new fd(i.message,i.details)}return new fd(i.message,i.toString())}var cl,Tm,$x,xm,zx,Rm,qx,dl,Jp,Dr=class{constructor(e,t,n){b(this,Tm);b(this,xm);b(this,Rm);b(this,dl);b(this,cl,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",A(this,Tm,$x).bind(this),{signal:u(this,cl).signal})}on(e,t){let n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){let s=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[s]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},n)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,n,s){let r=this.streamId++,o=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{let d=Promise.withResolvers();return this.streamControllers[r]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:o,targetName:a,action:e,streamId:r,data:t,desiredSize:c.desiredSize},s),d.promise},pull:c=>{let d=Promise.withResolvers();return this.streamControllers[r].pullCall=d,l.postMessage({sourceName:o,targetName:a,stream:Me.PULL,streamId:r,desiredSize:c.desiredSize}),d.promise},cancel:c=>{ke(c instanceof Error,"cancel must have a valid reason");let d=Promise.withResolvers();return this.streamControllers[r].cancelCall=d,this.streamControllers[r].isClosed=!0,l.postMessage({sourceName:o,targetName:a,stream:Me.CANCEL,streamId:r,reason:It(c)}),d.promise}},n)}destroy(){var e;(e=u(this,cl))==null||e.abort(),w(this,cl,null)}};cl=new WeakMap,Tm=new WeakSet,$x=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){A(this,Rm,qx).call(this,e);return}if(e.callback){let n=e.callbackId,s=this.callbackCapabilities[n];if(!s)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===Fp.DATA)s.resolve(e.data);else if(e.callback===Fp.ERROR)s.reject(It(e.reason));else throw new Error("Unexpected callback case");return}let t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){let n=this.sourceName,s=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:n,targetName:s,callback:Fp.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:n,targetName:s,callback:Fp.ERROR,callbackId:e.callbackId,reason:It(o)})});return}if(e.streamId){A(this,xm,zx).call(this,e);return}t(e.data)},xm=new WeakSet,zx=function(e){let t=e.streamId,n=this.sourceName,s=e.sourceName,r=this.comObj,o=this,a=this.actionHandler[e.action],l={enqueue(c,d=1,h){if(this.isCancelled)return;let p=this.desiredSize;this.desiredSize-=d,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:n,targetName:s,stream:Me.ENQUEUE,streamId:t,chunk:c},h)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:Me.CLOSE,streamId:t}),delete o.streamSinks[t])},error(c){ke(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:Me.ERROR,streamId:t,reason:It(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){r.postMessage({sourceName:n,targetName:s,stream:Me.START_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:n,targetName:s,stream:Me.START_COMPLETE,streamId:t,reason:It(c)})})},Rm=new WeakSet,qx=function(e){let t=e.streamId,n=this.sourceName,s=e.sourceName,r=this.comObj,o=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case Me.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(It(e.reason));break;case Me.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(It(e.reason));break;case Me.PULL:if(!a){r.postMessage({sourceName:n,targetName:s,stream:Me.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||j0).then(function(){r.postMessage({sourceName:n,targetName:s,stream:Me.PULL_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:n,targetName:s,stream:Me.PULL_COMPLETE,streamId:t,reason:It(c)})});break;case Me.ENQUEUE:if(ke(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case Me.CLOSE:if(ke(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),A(this,dl,Jp).call(this,o,t);break;case Me.ERROR:ke(o,"error should have stream controller"),o.controller.error(It(e.reason)),A(this,dl,Jp).call(this,o,t);break;case Me.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(It(e.reason)),A(this,dl,Jp).call(this,o,t);break;case Me.CANCEL:if(!a)break;let l=It(e.reason);Promise.try(a.onCancel||j0,l).then(function(){r.postMessage({sourceName:n,targetName:s,stream:Me.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:n,targetName:s,stream:Me.CANCEL_COMPLETE,streamId:t,reason:It(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},dl=new WeakSet,Jp=async function(e,t){var n,s,r;await Promise.allSettled([(n=e.startCall)==null?void 0:n.promise,(s=e.pullCall)==null?void 0:s.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]};var yu,Ag=class{constructor({enableHWA:e=!1}){b(this,yu,!1);w(this,yu,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");let n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!u(this,yu)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){ge("Abstract method `_createCanvas` called.")}};yu=new WeakMap;var iw=class extends Ag{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){let n=this._document.createElement("canvas");return n.width=e,n.height=t,n}},Cg=class{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");let t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){ge("Abstract method `_fetch` called.")}},_g=class extends Cg{async _fetch(e){let t=await Ny(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):ky(t)}},Tg=class{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,s,r){return"none"}destroy(e=!1){}},eo,ul,zi,qi,ht,to,no,We,ct,io,td,Fs,Da,hl,Xp,Ls,Pa,Im,Wx,vu,rw,Os,Ma,so,nd,ro,id,bu,ow,oo,sd,sw=class extends Tg{constructor({docId:t,ownerDocument:n=globalThis.document}){super();b(this,We);b(this,io);b(this,Fs);b(this,hl);b(this,Ls);b(this,Im);b(this,vu);b(this,Os);b(this,so);b(this,ro);b(this,bu);b(this,oo);b(this,eo,void 0);b(this,ul,void 0);b(this,zi,void 0);b(this,qi,void 0);b(this,ht,void 0);b(this,to,void 0);b(this,no,0);w(this,qi,t),w(this,ht,n)}addFilter(t){if(!t)return"none";let n=u(this,We,ct).get(t);if(n)return n;let[s,r,o]=A(this,hl,Xp).call(this,t),a=t.length===1?s:`${s}${r}${o}`;if(n=u(this,We,ct).get(a),n)return u(this,We,ct).set(t,n),n;let l=`g_${u(this,qi)}_transfer_map_${vt(this,no)._++}`,c=A(this,Ls,Pa).call(this,l);u(this,We,ct).set(t,c),u(this,We,ct).set(a,c);let d=A(this,Os,Ma).call(this,l);return A(this,ro,id).call(this,s,r,o,d),c}addHCMFilter(t,n){var y;let s=`${t}-${n}`,r="base",o=u(this,io,td).get(r);if((o==null?void 0:o.key)===s||(o?((y=o.filter)==null||y.remove(),o.key=s,o.url="none",o.filter=null):(o={key:s,url:"none",filter:null},u(this,io,td).set(r,o)),!t||!n))return o.url;let a=A(this,oo,sd).call(this,t);t=G.makeHexColor(...a);let l=A(this,oo,sd).call(this,n);if(n=G.makeHexColor(...l),u(this,Fs,Da).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return o.url;let c=new Array(256);for(let v=0;v<=255;v++){let E=v/255;c[v]=E<=.03928?E/12.92:((E+.055)/1.055)**2.4}let d=c.join(","),h=`g_${u(this,qi)}_hcm_filter`,p=o.filter=A(this,Os,Ma).call(this,h);A(this,ro,id).call(this,d,d,d,p),A(this,vu,rw).call(this,p);let m=(v,E)=>{let S=a[v]/255,C=l[v]/255,_=new Array(E+1);for(let T=0;T<=E;T++)_[T]=S+T/E*(C-S);return _.join(",")};return A(this,ro,id).call(this,m(0,5),m(1,5),m(2,5),p),o.url=A(this,Ls,Pa).call(this,h),o.url}addAlphaFilter(t){let n=u(this,We,ct).get(t);if(n)return n;let[s]=A(this,hl,Xp).call(this,[t]),r=`alpha_${s}`;if(n=u(this,We,ct).get(r),n)return u(this,We,ct).set(t,n),n;let o=`g_${u(this,qi)}_alpha_map_${vt(this,no)._++}`,a=A(this,Ls,Pa).call(this,o);u(this,We,ct).set(t,a),u(this,We,ct).set(r,a);let l=A(this,Os,Ma).call(this,o);return A(this,bu,ow).call(this,s,l),a}addLuminosityFilter(t){let n=u(this,We,ct).get(t||"luminosity");if(n)return n;let s,r;if(t?([s]=A(this,hl,Xp).call(this,[t]),r=`luminosity_${s}`):r="luminosity",n=u(this,We,ct).get(r),n)return u(this,We,ct).set(t,n),n;let o=`g_${u(this,qi)}_luminosity_map_${vt(this,no)._++}`,a=A(this,Ls,Pa).call(this,o);u(this,We,ct).set(t,a),u(this,We,ct).set(r,a);let l=A(this,Os,Ma).call(this,o);return A(this,Im,Wx).call(this,l),t&&A(this,bu,ow).call(this,s,l),a}addHighlightHCMFilter(t,n,s,r,o){var C;let a=`${n}-${s}-${r}-${o}`,l=u(this,io,td).get(t);if((l==null?void 0:l.key)===a||(l?((C=l.filter)==null||C.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},u(this,io,td).set(t,l)),!n||!s))return l.url;let[c,d]=[n,s].map(A(this,oo,sd).bind(this)),h=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),p=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[m,y]=[r,o].map(A(this,oo,sd).bind(this));p<h&&([h,p,m,y]=[p,h,y,m]),u(this,Fs,Da).style.color="";let v=(_,T,R)=>{let I=new Array(256),D=(p-h)/R,k=_/255,N=(T-_)/(255*R),F=0;for(let U=0;U<=R;U++){let re=Math.round(h+U*D),X=k+U*N;for(let Z=F;Z<=re;Z++)I[Z]=X;F=re+1}for(let U=F;U<256;U++)I[U]=I[F-1];return I.join(",")},E=`g_${u(this,qi)}_hcm_${t}_filter`,S=l.filter=A(this,Os,Ma).call(this,E);return A(this,vu,rw).call(this,S),A(this,ro,id).call(this,v(m[0],y[0],5),v(m[1],y[1],5),v(m[2],y[2],5),S),l.url=A(this,Ls,Pa).call(this,E),l.url}destroy(t=!1){var n,s,r,o;t&&((n=u(this,to))!=null&&n.size)||((s=u(this,zi))==null||s.parentNode.parentNode.remove(),w(this,zi,null),(r=u(this,ul))==null||r.clear(),w(this,ul,null),(o=u(this,to))==null||o.clear(),w(this,to,null),w(this,no,0))}};eo=new WeakMap,ul=new WeakMap,zi=new WeakMap,qi=new WeakMap,ht=new WeakMap,to=new WeakMap,no=new WeakMap,We=new WeakSet,ct=function(){return u(this,ul)||w(this,ul,new Map)},io=new WeakSet,td=function(){return u(this,to)||w(this,to,new Map)},Fs=new WeakSet,Da=function(){if(!u(this,zi)){let t=u(this,ht).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;let s=u(this,ht).createElementNS(Mi,"svg");s.setAttribute("width",0),s.setAttribute("height",0),w(this,zi,u(this,ht).createElementNS(Mi,"defs")),t.append(s),s.append(u(this,zi)),u(this,ht).body.append(t)}return u(this,zi)},hl=new WeakSet,Xp=function(t){if(t.length===1){let c=t[0],d=new Array(256);for(let p=0;p<256;p++)d[p]=c[p]/255;let h=d.join(",");return[h,h,h]}let[n,s,r]=t,o=new Array(256),a=new Array(256),l=new Array(256);for(let c=0;c<256;c++)o[c]=n[c]/255,a[c]=s[c]/255,l[c]=r[c]/255;return[o.join(","),a.join(","),l.join(",")]},Ls=new WeakSet,Pa=function(t){if(u(this,eo)===void 0){w(this,eo,"");let n=u(this,ht).URL;n!==u(this,ht).baseURI&&(Fy(n)?Q('#createUrl: ignore "data:"-URL for performance reasons.'):w(this,eo,n.split("#",1)[0]))}return`url(${u(this,eo)}#${t})`},Im=new WeakSet,Wx=function(t){let n=u(this,ht).createElementNS(Mi,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},vu=new WeakSet,rw=function(t){let n=u(this,ht).createElementNS(Mi,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},Os=new WeakSet,Ma=function(t){let n=u(this,ht).createElementNS(Mi,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),u(this,Fs,Da).append(n),n},so=new WeakSet,nd=function(t,n,s){let r=u(this,ht).createElementNS(Mi,n);r.setAttribute("type","discrete"),r.setAttribute("tableValues",s),t.append(r)},ro=new WeakSet,id=function(t,n,s,r){let o=u(this,ht).createElementNS(Mi,"feComponentTransfer");r.append(o),A(this,so,nd).call(this,o,"feFuncR",t),A(this,so,nd).call(this,o,"feFuncG",n),A(this,so,nd).call(this,o,"feFuncB",s)},bu=new WeakSet,ow=function(t,n){let s=u(this,ht).createElementNS(Mi,"feComponentTransfer");n.append(s),A(this,so,nd).call(this,s,"feFuncA",t)},oo=new WeakSet,sd=function(t){return u(this,Fs,Da).style.color=t,YS(getComputedStyle(u(this,Fs,Da)).getPropertyValue("color"))};var xg=class{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");let t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){ge("Abstract method `_fetch` called.")}},Rg=class extends xg{async _fetch(e){let t=await Ny(e,"arraybuffer");return new Uint8Array(t)}};mt&&Q("Please use the `legacy` build in Node.js environments.");async function Yx(i){let t=await process.getBuiltinModule("fs").promises.readFile(i);return new Uint8Array(t)}var aw=class extends Tg{},lw=class extends Ag{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(yU.url)("@napi-rs/canvas").createCanvas(e,t)}},cw=class extends Cg{async _fetch(e){return Yx(e)}},dw=class extends xg{async _fetch(e){return Yx(e)}},gt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function uw(i,e){if(!e)return;let t=e[2]-e[0],n=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,n),i.clip(s)}var wd=class{getPattern(){ge("Abstract method `getPattern` called.")}},hw=class extends wd{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,s){let r;if(s===gt.STROKE||s===gt.FILL){let o=t.current.getClippedPathBoundingBox(s,be(e))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,l=Math.ceil(o[3]-o[1])||1,c=t.cachedCanvases.getCanvas("pattern",a,l),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-o[0],-o[1]),n=G.transform(n,[1,0,0,1,o[0],o[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),uw(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),r=e.createPattern(c.canvas,"no-repeat");let h=new DOMMatrix(n);r.setTransform(h)}else uw(e,this._bbox),r=this._createGradient(e);return r}};function TE(i,e,t,n,s,r,o,a){let l=e.coords,c=e.colors,d=i.data,h=i.width*4,p;l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=r,r=o,o=p),l[n+1]>l[s+1]&&(p=n,n=s,s=p,p=o,o=a,a=p),l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=r,r=o,o=p);let m=(l[t]+e.offsetX)*e.scaleX,y=(l[t+1]+e.offsetY)*e.scaleY,v=(l[n]+e.offsetX)*e.scaleX,E=(l[n+1]+e.offsetY)*e.scaleY,S=(l[s]+e.offsetX)*e.scaleX,C=(l[s+1]+e.offsetY)*e.scaleY;if(y>=C)return;let _=c[r],T=c[r+1],R=c[r+2],I=c[o],D=c[o+1],k=c[o+2],N=c[a],F=c[a+1],U=c[a+2],re=Math.round(y),X=Math.round(C),Z,Ve,L,W,Bt,Kn,Ri,an;for(let ot=re;ot<=X;ot++){if(ot<E){let we=ot<y?0:(y-ot)/(y-E);Z=m-(m-v)*we,Ve=_-(_-I)*we,L=T-(T-D)*we,W=R-(R-k)*we}else{let we;ot>C?we=1:E===C?we=0:we=(E-ot)/(E-C),Z=v-(v-S)*we,Ve=I-(I-N)*we,L=D-(D-F)*we,W=k-(k-U)*we}let Fe;ot<y?Fe=0:ot>C?Fe=1:Fe=(y-ot)/(y-C),Bt=m-(m-S)*Fe,Kn=_-(_-N)*Fe,Ri=T-(T-F)*Fe,an=R-(R-U)*Fe;let ba=Math.round(Math.min(Z,Bt)),Bc=Math.round(Math.max(Z,Bt)),Sn=h*ot+ba*4;for(let we=ba;we<=Bc;we++)Fe=(Z-we)/(Z-Bt),Fe<0?Fe=0:Fe>1&&(Fe=1),d[Sn++]=Ve-(Ve-Kn)*Fe|0,d[Sn++]=L-(L-Ri)*Fe|0,d[Sn++]=W-(W-an)*Fe|0,d[Sn++]=255}}function VO(i,e,t){let n=e.coords,s=e.colors,r,o;switch(e.type){case"lattice":let a=e.verticesPerRow,l=Math.floor(n.length/a)-1,c=a-1;for(r=0;r<l;r++){let d=r*a;for(let h=0;h<c;h++,d++)TE(i,t,n[d],n[d+1],n[d+a],s[d],s[d+1],s[d+a]),TE(i,t,n[d+a+1],n[d+1],n[d+a],s[d+a+1],s[d+1],s[d+a])}break;case"triangles":for(r=0,o=n.length;r<o;r+=3)TE(i,t,n[r],n[r+1],n[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}var fw=class extends wd{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){let a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,d=Math.ceil(this._bounds[3])-l,h=Math.min(Math.ceil(Math.abs(c*e[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),m=c/h,y=d/p,v={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/m,scaleY:1/y},E=h+2*2,S=p+2*2,C=n.getCanvas("mesh",E,S),_=C.context,T=_.createImageData(h,p);if(t){let I=T.data;for(let D=0,k=I.length;D<k;D+=4)I[D]=t[0],I[D+1]=t[1],I[D+2]=t[2],I[D+3]=255}for(let I of this._figures)VO(T,I,v);return _.putImageData(T,2,2),{canvas:C.canvas,offsetX:a-2*m,offsetY:l-2*y,scaleX:m,scaleY:y}}getPattern(e,t,n,s){uw(e,this._bbox);let r;if(s===gt.SHADING)r=G.singularValueDecompose2dScale(be(e));else if(r=G.singularValueDecompose2dScale(t.baseTransform),this.matrix){let a=G.singularValueDecompose2dScale(this.matrix);r=[r[0]*a[0],r[1]*a[1]]}let o=this._createMeshCanvas(r,s===gt.SHADING?null:this._background,t.cachedCanvases);return s!==gt.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}},pw=class extends wd{getPattern(){return"hotpink"}};function $O(i){switch(i[0]){case"RadialAxial":return new hw(i);case"Mesh":return new fw(i);case"Dummy":return new pw}throw new Error(`Unknown IR type: ${i[0]}`)}var Q0={COLORED:1,UNCOLORED:2},Dm=class Dm{constructor(e,t,n,s,r){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=s,this.baseTransform=r}createPatternCanvas(e){let{bbox:t,operatorList:n,paintType:s,tilingType:r,color:o,canvasGraphicsFactory:a}=this,{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),My("TilingType: "+r);let d=t[0],h=t[1],p=t[2],m=t[3],y=p-d,v=m-h,E=G.singularValueDecompose2dScale(this.matrix),S=G.singularValueDecompose2dScale(this.baseTransform),C=E[0]*S[0],_=E[1]*S[1],T=y,R=v,I=!1,D=!1,k=Math.ceil(l*C),N=Math.ceil(c*_),F=Math.ceil(y*C),U=Math.ceil(v*_);k>=F?T=l:I=!0,N>=U?R=c:D=!0;let re=this.getSizeAndScale(T,this.ctx.canvas.width,C),X=this.getSizeAndScale(R,this.ctx.canvas.height,_),Z=e.cachedCanvases.getCanvas("pattern",re.size,X.size),Ve=Z.context,L=a.createCanvasGraphics(Ve);if(L.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(L,s,o),Ve.translate(-re.scale*d,-X.scale*h),L.transform(re.scale,0,0,X.scale,0,0),Ve.save(),this.clipBbox(L,d,h,p,m),L.baseTransform=be(L.ctx),L.executeOperatorList(n),L.endDrawing(),Ve.restore(),I||D){let W=Z.canvas;I&&(T=l),D&&(R=c);let Bt=this.getSizeAndScale(T,this.ctx.canvas.width,C),Kn=this.getSizeAndScale(R,this.ctx.canvas.height,_),Ri=Bt.size,an=Kn.size,ot=e.cachedCanvases.getCanvas("pattern-workaround",Ri,an),Fe=ot.context,ba=I?Math.floor(y/l):0,Bc=D?Math.floor(v/c):0;for(let Sn=0;Sn<=ba;Sn++)for(let we=0;we<=Bc;we++)Fe.drawImage(W,Ri*Sn,an*we,Ri,an,0,0,Ri,an);return{canvas:ot.canvas,scaleX:Bt.scale,scaleY:Kn.scale,offsetX:d,offsetY:h}}return{canvas:Z.canvas,scaleX:re.scale,scaleY:X.scale,offsetX:d,offsetY:h}}getSizeAndScale(e,t,n){let s=Math.max(Dm.MAX_PATTERN_SIZE,t),r=Math.ceil(e*n);return r>=s?r=s:n=r/e,{scale:n,size:r}}clipBbox(e,t,n,s,r){let o=s-t,a=r-n;e.ctx.rect(t,n,o,a),e.current.updateRectMinMax(be(e.ctx),[t,n,s,r]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){let s=e.ctx,r=e.current;switch(t){case Q0.COLORED:let o=this.ctx;s.fillStyle=o.fillStyle,s.strokeStyle=o.strokeStyle,r.fillColor=o.fillStyle,r.strokeColor=o.strokeStyle;break;case Q0.UNCOLORED:let a=G.makeHexColor(n[0],n[1],n[2]);s.fillStyle=a,s.strokeStyle=a,r.fillColor=a,r.strokeColor=a;break;default:throw new DE(`Unsupported paint type: ${t}`)}}getPattern(e,t,n,s){let r=n;s!==gt.SHADING&&(r=G.transform(r,t.baseTransform),this.matrix&&(r=G.transform(r,this.matrix)));let o=this.createPatternCanvas(t),a=new DOMMatrix(r);a=a.translate(o.offsetX,o.offsetY),a=a.scale(1/o.scaleX,1/o.scaleY);let l=e.createPattern(o.canvas,"repeat");return l.setTransform(a),l}};Y(Dm,"MAX_PATTERN_SIZE",3e3);var gw=Dm;function zO({src:i,srcPos:e=0,dest:t,width:n,height:s,nonBlackColor:r=4294967295,inverseDecode:o=!1}){let a=it.isLittleEndian?4278190080:255,[l,c]=o?[r,a]:[a,r],d=n>>3,h=n&7,p=i.length;t=new Uint32Array(t.buffer);let m=0;for(let y=0;y<s;y++){for(let E=e+d;e<E;e++){let S=e<p?i[e]:255;t[m++]=S&128?c:l,t[m++]=S&64?c:l,t[m++]=S&32?c:l,t[m++]=S&16?c:l,t[m++]=S&8?c:l,t[m++]=S&4?c:l,t[m++]=S&2?c:l,t[m++]=S&1?c:l}if(h===0)continue;let v=e<p?i[e++]:255;for(let E=0;E<h;E++)t[m++]=v&1<<7-E?c:l}return{srcPos:e,destPos:m}}var ex=16,tx=100,qO=15,nx=10,ix=1e3,Nt=16;function WO(i,e){if(i._removeMirroring)throw new Error("Context is already forwarding operations.");i.__originalSave=i.save,i.__originalRestore=i.restore,i.__originalRotate=i.rotate,i.__originalScale=i.scale,i.__originalTranslate=i.translate,i.__originalTransform=i.transform,i.__originalSetTransform=i.setTransform,i.__originalResetTransform=i.resetTransform,i.__originalClip=i.clip,i.__originalMoveTo=i.moveTo,i.__originalLineTo=i.lineTo,i.__originalBezierCurveTo=i.bezierCurveTo,i.__originalRect=i.rect,i.__originalClosePath=i.closePath,i.__originalBeginPath=i.beginPath,i._removeMirroring=()=>{i.save=i.__originalSave,i.restore=i.__originalRestore,i.rotate=i.__originalRotate,i.scale=i.__originalScale,i.translate=i.__originalTranslate,i.transform=i.__originalTransform,i.setTransform=i.__originalSetTransform,i.resetTransform=i.__originalResetTransform,i.clip=i.__originalClip,i.moveTo=i.__originalMoveTo,i.lineTo=i.__originalLineTo,i.bezierCurveTo=i.__originalBezierCurveTo,i.rect=i.__originalRect,i.closePath=i.__originalClosePath,i.beginPath=i.__originalBeginPath,delete i._removeMirroring},i.save=function(){e.save(),this.__originalSave()},i.restore=function(){e.restore(),this.__originalRestore()},i.translate=function(n,s){e.translate(n,s),this.__originalTranslate(n,s)},i.scale=function(n,s){e.scale(n,s),this.__originalScale(n,s)},i.transform=function(n,s,r,o,a,l){e.transform(n,s,r,o,a,l),this.__originalTransform(n,s,r,o,a,l)},i.setTransform=function(n,s,r,o,a,l){e.setTransform(n,s,r,o,a,l),this.__originalSetTransform(n,s,r,o,a,l)},i.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},i.rotate=function(n){e.rotate(n),this.__originalRotate(n)},i.clip=function(n){e.clip(n),this.__originalClip(n)},i.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},i.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},i.bezierCurveTo=function(t,n,s,r,o,a){e.bezierCurveTo(t,n,s,r,o,a),this.__originalBezierCurveTo(t,n,s,r,o,a)},i.rect=function(t,n,s,r){e.rect(t,n,s,r),this.__originalRect(t,n,s,r)},i.closePath=function(){e.closePath(),this.__originalClosePath()},i.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}var mw=class{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,n)):(s=this.canvasFactory.create(t,n),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}};function Lp(i,e,t,n,s,r,o,a,l,c){let[d,h,p,m,y,v]=be(i);if(h===0&&p===0){let C=o*d+y,_=Math.round(C),T=a*m+v,R=Math.round(T),I=(o+l)*d+y,D=Math.abs(Math.round(I)-_)||1,k=(a+c)*m+v,N=Math.abs(Math.round(k)-R)||1;return i.setTransform(Math.sign(d),0,0,Math.sign(m),_,R),i.drawImage(e,t,n,s,r,0,0,D,N),i.setTransform(d,h,p,m,y,v),[D,N]}if(d===0&&m===0){let C=a*p+y,_=Math.round(C),T=o*h+v,R=Math.round(T),I=(a+c)*p+y,D=Math.abs(Math.round(I)-_)||1,k=(o+l)*h+v,N=Math.abs(Math.round(k)-R)||1;return i.setTransform(0,Math.sign(h),Math.sign(p),0,_,R),i.drawImage(e,t,n,s,r,0,0,N,D),i.setTransform(d,h,p,m,y,v),[N,D]}i.drawImage(e,t,n,s,r,o,a,l,c);let E=Math.hypot(d,h),S=Math.hypot(p,m);return[E*l,S*c]}function YO(i){let{width:e,height:t}=i;if(e>ix||t>ix)return null;let n=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=e+1,o=new Uint8Array(r*(t+1)),a,l,c,d=e+7&-8,h=new Uint8Array(d*t),p=0;for(let S of i.data){let C=128;for(;C>0;)h[p++]=S&C?0:255,C>>=1}let m=0;for(p=0,h[p]!==0&&(o[0]=1,++m),l=1;l<e;l++)h[p]!==h[p+1]&&(o[l]=h[p]?2:1,++m),p++;for(h[p]!==0&&(o[l]=2,++m),a=1;a<t;a++){p=a*d,c=a*r,h[p-d]!==h[p]&&(o[c]=h[p]?1:8,++m);let S=(h[p]?4:0)+(h[p-d]?8:0);for(l=1;l<e;l++)S=(S>>2)+(h[p+1]?4:0)+(h[p-d+1]?8:0),s[S]&&(o[c+l]=s[S],++m),p++;if(h[p-d]!==h[p]&&(o[c+l]=h[p]?2:4,++m),m>n)return null}for(p=d*(t-1),c=a*r,h[p]!==0&&(o[c]=8,++m),l=1;l<e;l++)h[p]!==h[p+1]&&(o[c+l]=h[p]?4:8,++m),p++;if(h[p]!==0&&(o[c+l]=4,++m),m>n)return null;let y=new Int32Array([0,r,-1,0,-r,0,0,0,1]),v=new Path2D;for(a=0;m&&a<=t;a++){let S=a*r,C=S+e;for(;S<C&&!o[S];)S++;if(S===C)continue;v.moveTo(S%r,a);let _=S,T=o[S];do{let R=y[T];do S+=R;while(!o[S]);let I=o[S];I!==5&&I!==10?(T=I,o[S]=0):(T=I&51*T>>4,o[S]&=T>>2|T<<2),v.lineTo(S%r,S/r|0),o[S]||--m}while(_!==S);--a}return h=null,o=null,function(S){S.save(),S.scale(1/e,-1/t),S.translate(0,-t),S.fill(v),S.beginPath(),S.restore()}}var Ig=class{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=ux,this.textMatrixScale=1,this.fontMatrix=IE,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=lt.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=G.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(e,t){let n=G.applyTransform(t,e),s=G.applyTransform(t.slice(2),e),r=G.applyTransform([t[0],t[3]],e),o=G.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,n[0],s[0],r[0],o[0]),this.minY=Math.min(this.minY,n[1],s[1],r[1],o[1]),this.maxX=Math.max(this.maxX,n[0],s[0],r[0],o[0]),this.maxY=Math.max(this.maxY,n[1],s[1],r[1],o[1])}updateScalingPathMinMax(e,t){G.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,s,r,o,a,l,c,d){let h=G.bezierBoundingBox(t,n,s,r,o,a,l,c,d);d||this.updateRectMinMax(e,h)}getPathBoundingBox(e=gt.FILL,t=null){let n=[this.minX,this.minY,this.maxX,this.maxY];if(e===gt.STROKE){t||ge("Stroke bounding box must include transform.");let s=G.singularValueDecompose2dScale(t),r=s[0]*this.lineWidth/2,o=s[1]*this.lineWidth/2;n[0]-=r,n[1]-=o,n[2]+=r,n[3]+=o}return n}updateClipFromPath(){let e=G.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=gt.FILL,t=null){return G.intersect(this.clipBox,this.getPathBoundingBox(e,t))}};function sx(i,e){if(e instanceof ImageData){i.putImageData(e,0,0);return}let t=e.height,n=e.width,s=t%Nt,r=(t-s)/Nt,o=s===0?r:r+1,a=i.createImageData(n,Nt),l=0,c,d=e.data,h=a.data,p,m,y,v;if(e.kind===Bp.GRAYSCALE_1BPP){let E=d.byteLength,S=new Uint32Array(h.buffer,0,h.byteLength>>2),C=S.length,_=n+7>>3,T=4294967295,R=it.isLittleEndian?4278190080:255;for(p=0;p<o;p++){for(y=p<r?Nt:s,c=0,m=0;m<y;m++){let I=E-l,D=0,k=I>_?n:I*8-7,N=k&-8,F=0,U=0;for(;D<N;D+=8)U=d[l++],S[c++]=U&128?T:R,S[c++]=U&64?T:R,S[c++]=U&32?T:R,S[c++]=U&16?T:R,S[c++]=U&8?T:R,S[c++]=U&4?T:R,S[c++]=U&2?T:R,S[c++]=U&1?T:R;for(;D<k;D++)F===0&&(U=d[l++],F=128),S[c++]=U&F?T:R,F>>=1}for(;c<C;)S[c++]=0;i.putImageData(a,0,p*Nt)}}else if(e.kind===Bp.RGBA_32BPP){for(m=0,v=n*Nt*4,p=0;p<r;p++)h.set(d.subarray(l,l+v)),l+=v,i.putImageData(a,0,m),m+=Nt;p<o&&(v=n*s*4,h.set(d.subarray(l,l+v)),i.putImageData(a,0,m))}else if(e.kind===Bp.RGB_24BPP)for(y=Nt,v=n*y,p=0;p<o;p++){for(p>=r&&(y=s,v=n*y),c=0,m=v;m--;)h[c++]=d[l++],h[c++]=d[l++],h[c++]=d[l++],h[c++]=255;i.putImageData(a,0,p*Nt)}else throw new Error(`bad image kind: ${e.kind}`)}function rx(i,e){if(e.bitmap){i.drawImage(e.bitmap,0,0);return}let t=e.height,n=e.width,s=t%Nt,r=(t-s)/Nt,o=s===0?r:r+1,a=i.createImageData(n,Nt),l=0,c=e.data,d=a.data;for(let h=0;h<o;h++){let p=h<r?Nt:s;({srcPos:l}=zO({src:c,srcPos:l,dest:d,width:n,height:p,nonBlackColor:0})),i.putImageData(a,0,h*Nt)}}function Kc(i,e){let t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let n of t)i[n]!==void 0&&(e[n]=i[n]);i.setLineDash!==void 0&&(e.setLineDash(i.getLineDash()),e.lineDashOffset=i.lineDashOffset)}function Op(i){if(i.strokeStyle=i.fillStyle="#000000",i.fillRule="nonzero",i.globalAlpha=1,i.lineWidth=1,i.lineCap="butt",i.lineJoin="miter",i.miterLimit=10,i.globalCompositeOperation="source-over",i.font="10px sans-serif",i.setLineDash!==void 0&&(i.setLineDash([]),i.lineDashOffset=0),!mt){let{filter:e}=i;e!=="none"&&e!==""&&(i.filter="none")}}function ox(i,e){if(e)return!0;let t=G.singularValueDecompose2dScale(i);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);let n=Math.fround((globalThis.devicePixelRatio||1)*or.PDF_TO_CSS_UNITS);return t[0]<=n&&t[1]<=n}var KO=["butt","round","square"],JO=["miter","round","bevel"],XO={},ax={},Eu,yw,wu,vw,Su,bw,XS=class XS{constructor(e,t,n,s,r,{optionalContentConfig:o,markedContentStack:a=null},l,c){b(this,Eu);b(this,wu);b(this,Su);this.ctx=e,this.current=new Ig(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=s,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new mw(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:s=null}){let r=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=a,n){let l=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...be(this.compositeCtx))}this.ctx.save(),Op(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=be(this.ctx)}executeOperatorList(e,t,n,s){let r=e.argsArray,o=e.fnArray,a=t||0,l=r.length;if(l===a)return a;let c=l-a>nx&&typeof n=="function",d=c?Date.now()+qO:0,h=0,p=this.commonObjs,m=this.objs,y;for(;;){if(s!==void 0&&a===s.nextBreakPoint)return s.breakIt(a,n),a;if(y=o[a],y!==Rn.dependency)this[y].apply(this,r[a]);else for(let v of r[a]){let E=v.startsWith("g_")?p:m;if(!E.has(v))return E.get(v,n),a}if(a++,a===l)return a;if(c&&++h>nx){if(Date.now()>d)return n(),a;h=0}}}endDrawing(){A(this,Eu,yw).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())typeof HTMLCanvasElement!="undefined"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),A(this,wu,vw).call(this)}_scaleImage(e,t){var p,m;let n=(p=e.width)!=null?p:e.displayWidth,s=(m=e.height)!=null?m:e.displayHeight,r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),a=n,l=s,c="prescale1",d,h;for(;r>2&&a>1||o>2&&l>1;){let y=a,v=l;r>2&&a>1&&(y=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),r/=a/y),o>2&&l>1&&(v=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,o/=l/v),d=this.cachedCanvases.getCanvas(c,y,v),h=d.context,h.clearRect(0,0,y,v),h.drawImage(e,0,0,a,l,0,0,y,v),e=d.canvas,a=y,l=v,c=c==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e){let t=this.ctx,{width:n,height:s}=e,r=this.current.fillColor,o=this.current.patternFill,a=be(t),l,c,d,h;if((e.bitmap||e.data)&&e.count>1){let k=e.bitmap||e.data.buffer;c=JSON.stringify(o?a:[a.slice(0,4),r]),l=this._cachedBitmapsMap.get(k),l||(l=new Map,this._cachedBitmapsMap.set(k,l));let N=l.get(c);if(N&&!o){let F=Math.round(Math.min(a[0],a[2])+a[4]),U=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:N,offsetX:F,offsetY:U}}d=N}d||(h=this.cachedCanvases.getCanvas("maskCanvas",n,s),rx(h.context,e));let p=G.transform(a,[1/n,0,0,-1/s,0,0]);p=G.transform(p,[1,0,0,1,0,-s]);let[m,y,v,E]=G.getAxialAlignedBoundingBox([0,0,n,s],p),S=Math.round(v-m)||1,C=Math.round(E-y)||1,_=this.cachedCanvases.getCanvas("fillCanvas",S,C),T=_.context,R=m,I=y;T.translate(-R,-I),T.transform(...p),d||(d=this._scaleImage(h.canvas,Xn(T)),d=d.img,l&&o&&l.set(c,d)),T.imageSmoothingEnabled=ox(be(T),e.interpolate),Lp(T,d,0,0,d.width,d.height,0,0,n,s),T.globalCompositeOperation="source-in";let D=G.transform(Xn(T),[1,0,0,1,-R,-I]);return T.fillStyle=o?r.getPattern(t,this,D,gt.FILL):r,T.fillRect(0,0,n,s),l&&!o&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,_.canvas)),{canvas:_.canvas,offsetX:Math.round(R),offsetY:Math.round(I)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=KO[e]}setLineJoin(e){this.ctx.lineJoin=JO[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){let n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx,this.ctx=s.context;let r=this.ctx;r.setTransform(...be(this.suspendedCtx)),Kc(this.suspendedCtx,r),WO(r,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Kc(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,s){let r=s[0],o=s[1],a=s[2]-r,l=s[3]-o;a===0||l===0||(this.genericComposeSMask(t.context,n,a,l,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,s,r,o,a,l,c,d,h){let p=e.canvas,m=l-d,y=c-h;if(o){let E=G.makeHexColor(...o);if(m<0||y<0||m+n>p.width||y+s>p.height){let S=this.cachedCanvases.getCanvas("maskExtension",n,s),C=S.context;C.drawImage(p,-m,-y),C.globalCompositeOperation="destination-atop",C.fillStyle=E,C.fillRect(0,0,n,s),C.globalCompositeOperation="source-over",p=S.canvas,m=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);let S=new Path2D;S.rect(m,y,n,s),e.clip(S),e.globalCompositeOperation="destination-atop",e.fillStyle=E,e.fillRect(m,y,n,s),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));let v=new Path2D;v.rect(l,c,n,s),t.clip(v),t.globalCompositeOperation="destination-in",t.drawImage(p,m,y,n,s,l,c,n,s),t.restore()}save(){this.inSMaskMode?(Kc(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Kc(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,s,r,o){this.ctx.transform(e,t,n,s,r,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){let s=this.ctx,r=this.current,o=r.x,a=r.y,l,c,d=be(s),h=d[0]===0&&d[3]===0||d[1]===0&&d[2]===0,p=h?n.slice(0):null;for(let m=0,y=0,v=e.length;m<v;m++)switch(e[m]|0){case Rn.rectangle:o=t[y++],a=t[y++];let E=t[y++],S=t[y++],C=o+E,_=a+S;s.moveTo(o,a),E===0||S===0?s.lineTo(C,_):(s.lineTo(C,a),s.lineTo(C,_),s.lineTo(o,_)),h||r.updateRectMinMax(d,[o,a,C,_]),s.closePath();break;case Rn.moveTo:o=t[y++],a=t[y++],s.moveTo(o,a),h||r.updatePathMinMax(d,o,a);break;case Rn.lineTo:o=t[y++],a=t[y++],s.lineTo(o,a),h||r.updatePathMinMax(d,o,a);break;case Rn.curveTo:l=o,c=a,o=t[y+4],a=t[y+5],s.bezierCurveTo(t[y],t[y+1],t[y+2],t[y+3],o,a),r.updateCurvePathMinMax(d,l,c,t[y],t[y+1],t[y+2],t[y+3],o,a,p),y+=6;break;case Rn.curveTo2:l=o,c=a,s.bezierCurveTo(o,a,t[y],t[y+1],t[y+2],t[y+3]),r.updateCurvePathMinMax(d,l,c,o,a,t[y],t[y+1],t[y+2],t[y+3],p),o=t[y+2],a=t[y+3],y+=4;break;case Rn.curveTo3:l=o,c=a,o=t[y+2],a=t[y+3],s.bezierCurveTo(t[y],t[y+1],o,a,o,a),r.updateCurvePathMinMax(d,l,c,t[y],t[y+1],o,a,o,a,p),y+=4;break;case Rn.closePath:s.closePath();break}h&&r.updateScalingPathMinMax(d,p),r.setCurrentPoint(o,a)}closePath(){this.ctx.closePath()}stroke(e=!0){let t=this.ctx,n=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof n=="object"&&(n!=null&&n.getPattern)?(t.save(),t.strokeStyle=n.getPattern(t,this,Xn(t),gt.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){let t=this.ctx,n=this.current.fillColor,s=this.current.patternFill,r=!1;s&&(t.save(),t.fillStyle=n.getPattern(t,this,Xn(t),gt.FILL),r=!0);let o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),r&&t.restore(),e&&this.consumePath(o)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=XO}eoClip(){this.pendingClip=ax}beginText(){this.current.textMatrix=ux,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}let n=new Path2D,s=t.getTransform().invertSelf();for(let{transform:r,x:o,y:a,fontSize:l,path:c}of e)n.addPath(c,new DOMMatrix(r).preMultiplySelf(s).translate(o,a).scale(l,-l));t.clip(n),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var d;let n=this.commonObjs.get(e),s=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=n.fontMatrix||IE,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&Q("Invalid font matrix for font "+e),t<0?(t=-t,s.fontDirection=-1):s.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;let r=n.loadedName||"sans-serif",o=((d=n.systemFontInfo)==null?void 0:d.css)||`"${r}", ${n.fallbackName}`,a="normal";n.black?a="900":n.bold&&(a="bold");let l=n.italic?"italic":"normal",c=t;t<ex?c=ex:t>tx&&(c=tx),this.current.fontSizeScale=t/c,this.ctx.font=`${l} ${a} ${c}px ${o}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,s,r,o){this.current.textMatrix=[e,t,n,s,r,o],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,s,r){let o=this.ctx,a=this.current,l=a.font,c=a.textRenderingMode,d=a.fontSize/a.fontSizeScale,h=c&lt.FILL_STROKE_MASK,p=!!(c&lt.ADD_TO_PATH_FLAG),m=a.patternFill&&!l.missingFile,y=a.patternStroke&&!l.missingFile,v;if((l.disableFontFace||p||m||y)&&(v=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||m||y){if(o.save(),o.translate(t,n),o.scale(d,-d),h===lt.FILL||h===lt.FILL_STROKE)if(s){let E=o.getTransform();o.setTransform(...s),o.fill(A(this,Su,bw).call(this,v,E,s))}else o.fill(v);if(h===lt.STROKE||h===lt.FILL_STROKE)if(r){let E=o.getTransform();o.setTransform(...r),o.stroke(A(this,Su,bw).call(this,v,E,r))}else o.lineWidth/=d,o.stroke(v);o.restore()}else(h===lt.FILL||h===lt.FILL_STROKE)&&o.fillText(e,t,n),(h===lt.STROKE||h===lt.FILL_STROKE)&&o.strokeText(e,t,n);p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:be(o),x:t,y:n,fontSize:d,path:v})}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let t=e.getImageData(0,0,10,10).data,n=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){n=!0;break}return se(this,"isFontSubpixelAAEnabled",n)}showText(e){let t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);let s=t.fontSize;if(s===0)return;let r=this.ctx,o=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,c=t.fontDirection,d=t.textHScale*c,h=e.length,p=n.vertical,m=p?1:-1,y=n.defaultVMetrics,v=s*t.fontMatrix[0],E=t.textRenderingMode===lt.FILL&&!n.disableFontFace&&!t.patternFill;r.save(),r.transform(...t.textMatrix),r.translate(t.x,t.y+t.textRise),c>0?r.scale(d,-1):r.scale(d,1);let S,C;if(t.patternFill){r.save();let D=t.fillColor.getPattern(r,this,Xn(r),gt.FILL);S=be(r),r.restore(),r.fillStyle=D}if(t.patternStroke){r.save();let D=t.strokeColor.getPattern(r,this,Xn(r),gt.STROKE);C=be(r),r.restore(),r.strokeStyle=D}let _=t.lineWidth,T=t.textMatrixScale;if(T===0||_===0){let D=t.textRenderingMode&lt.FILL_STROKE_MASK;(D===lt.STROKE||D===lt.FILL_STROKE)&&(_=this.getSinglePixelWidth())}else _/=T;if(o!==1&&(r.scale(o,o),_/=o),r.lineWidth=_,n.isInvalidPDFjsFont){let D=[],k=0;for(let N of e)D.push(N.unicode),k+=N.width;r.fillText(D.join(""),0,0),t.x+=k*v*d,r.restore(),this.compose();return}let R=0,I;for(I=0;I<h;++I){let D=e[I];if(typeof D=="number"){R+=m*D*s/1e3;continue}let k=!1,N=(D.isSpace?l:0)+a,F=D.fontChar,U=D.accent,re,X,Z=D.width;if(p){let L=D.vmetric||y,W=-(D.vmetric?L[1]:Z*.5)*v,Bt=L[2]*v;Z=L?-L[0]:Z,re=W/o,X=(R+Bt)/o}else re=R/o,X=0;if(n.remeasure&&Z>0){let L=r.measureText(F).width*1e3/s*o;if(Z<L&&this.isFontSubpixelAAEnabled){let W=Z/L;k=!0,r.save(),r.scale(W,1),re/=W}else Z!==L&&(re+=(Z-L)/2e3*s/o)}if(this.contentVisible&&(D.isInFont||n.missingFile)){if(E&&!U)r.fillText(F,re,X);else if(this.paintChar(F,re,X,S,C),U){let L=re+s*U.offset.x/o,W=X-s*U.offset.y/o;this.paintChar(U.fontChar,L,W,S,C)}}let Ve=p?Z*v-N*c:Z*v+N*c;R+=Ve,k&&r.restore()}p?t.y-=R:t.x+=R*d,r.restore(),this.compose()}showType3Text(e){let t=this.ctx,n=this.current,s=n.font,r=n.fontSize,o=n.fontDirection,a=s.vertical?1:-1,l=n.charSpacing,c=n.wordSpacing,d=n.textHScale*o,h=n.fontMatrix||IE,p=e.length,m=n.textRenderingMode===lt.INVISIBLE,y,v,E,S;if(!(m||r===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...n.textMatrix),t.translate(n.x,n.y),t.scale(d,o),y=0;y<p;++y){if(v=e[y],typeof v=="number"){S=a*v*r/1e3,this.ctx.translate(S,0),n.x+=S*d;continue}let C=(v.isSpace?c:0)+l,_=s.charProcOperatorList[v.operatorListId];if(!_){Q(`Type3 character "${v.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=v,this.save(),t.scale(r,r),t.transform(...h),this.executeOperatorList(_),this.restore()),E=G.applyTransform([v.width,0],h)[0]*r+C,t.translate(E,0),n.x+=E*d}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,s,r,o){this.ctx.rect(n,s,r-n,o-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){let n=e[1],s=this.baseTransform||be(this.ctx),r={createCanvasGraphics:o=>new XS(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new gw(e,n,this.ctx,r,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){this.ctx.strokeStyle=this.current.strokeColor=G.makeHexColor(e,t,n),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,n){this.ctx.fillStyle=this.current.fillColor=G.makeHexColor(e,t,n),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=$O(this.getObject(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;let t=this.ctx;this.save();let n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,Xn(t),gt.SHADING);let s=Xn(t);if(s){let{width:r,height:o}=t.canvas,[a,l,c,d]=G.getAxialAlignedBoundingBox([0,0,r,o],s);this.ctx.fillRect(a,l,c-a,d-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){ge("Should not call beginInlineImage")}beginImageData(){ge("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=be(this.ctx),t)){let n=t[2]-t[0],s=t[3]-t[1];this.ctx.rect(t[0],t[1],n,s),this.current.updateRectMinMax(be(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let t=this.ctx;e.isolated||My("TODO: Support non-isolated groups."),e.knockout&&Q("Knockout groups not supported.");let n=be(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=G.getAxialAlignedBoundingBox(e.bbox,be(t)),r=[0,0,t.canvas.width,t.canvas.height];s=G.intersect(s,r)||[0,0,0,0];let o=Math.floor(s[0]),a=Math.floor(s[1]),l=Math.max(Math.ceil(s[2])-o,1),c=Math.max(Math.ceil(s[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,c]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);let h=this.cachedCanvases.getCanvas(d,l,c),p=h.context;p.translate(-o,-a),p.transform(...n),e.smask?this.smaskStack.push({canvas:h.canvas,context:p,offsetX:o,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,a),t.save()),Kc(t,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;let t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let s=be(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);let r=G.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],s);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(e,t,n,s,r){if(A(this,Eu,yw).call(this),Op(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){let o=t[2]-t[0],a=t[3]-t[1];if(r&&this.annotationCanvasMap){n=n.slice(),n[4]-=t[0],n[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=o,t[3]=a;let[l,c]=G.singularValueDecompose2dScale(be(this.ctx)),{viewportScale:d}=this,h=Math.ceil(o*this.outputScaleX*d),p=Math.ceil(a*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(h,p);let{canvas:m,context:y}=this.annotationCanvas;this.annotationCanvasMap.set(e,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=y,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,a*c),Op(this.ctx)}else Op(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],o,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new Ig(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),A(this,wu,vw).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;let t=e.count;e=this.getObject(e.data,e),e.count=t;let n=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=YO(e)),s.compiled)){s.compiled(n);return}let r=this._createMaskCanvas(e),o=r.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(o,r.offsetX,r.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,s=0,r,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);let a=this.ctx;a.save();let l=be(a);a.transform(t,n,s,r,0,0);let c=this._createMaskCanvas(e);a.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let d=0,h=o.length;d<h;d+=2){let p=G.transform(l,[t,n,s,r,o[d],o[d+1]]),[m,y]=G.applyTransform([0,0],p);a.drawImage(c.canvas,m,y)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;let t=this.ctx,n=this.current.fillColor,s=this.current.patternFill;for(let r of e){let{data:o,width:a,height:l,transform:c}=r,d=this.cachedCanvases.getCanvas("maskCanvas",a,l),h=d.context;h.save();let p=this.getObject(o,r);rx(h,p),h.globalCompositeOperation="source-in",h.fillStyle=s?n.getPattern(h,this,Xn(t),gt.FILL):n,h.fillRect(0,0,a,l),h.restore(),t.save(),t.transform(...c),t.scale(1,-1),Lp(t,d.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);if(!t){Q("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,n,s){if(!this.contentVisible)return;let r=this.getObject(e);if(!r){Q("Dependent image isn't ready yet");return}let o=r.width,a=r.height,l=[];for(let c=0,d=s.length;c<d;c+=2)l.push({transform:[t,0,0,n,s[c],s[c+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(r,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;let{bitmap:t,width:n,height:s}=e,r=this.cachedCanvases.getCanvas("inlineImage",n,s),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;let t=e.width,n=e.height,s=this.ctx;if(this.save(),!mt){let{filter:a}=s;a!=="none"&&a!==""&&(s.filter="none")}s.scale(1/t,-1/n);let r;if(e.bitmap)r=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)r=e;else{let l=this.cachedCanvases.getCanvas("inlineImage",t,n).context;sx(l,e),r=this.applyTransferMapsToCanvas(l)}let o=this._scaleImage(r,Xn(s));s.imageSmoothingEnabled=ox(be(s),e.interpolate),Lp(s,o.img,0,0,o.paintWidth,o.paintHeight,0,-n,t,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;let n=this.ctx,s;if(e.bitmap)s=e.bitmap;else{let r=e.width,o=e.height,l=this.cachedCanvases.getCanvas("inlineImage",r,o).context;sx(l,e),s=this.applyTransferMapsToCanvas(l)}for(let r of t)n.save(),n.transform(...r.transform),n.scale(1,-1),Lp(n,s,r.x,r.y,r.w,r.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);let n=this.ctx;this.pendingClip&&(t||(this.pendingClip===ax?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=be(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:e}=this.current,{a:t,b:n,c:s,d:r}=this.ctx.getTransform(),o,a;if(n===0&&s===0){let l=Math.abs(t),c=Math.abs(r);if(l===c)if(e===0)o=a=1/l;else{let d=l*e;o=a=d<1?1/d:1}else if(e===0)o=1/l,a=1/c;else{let d=l*e,h=c*e;o=d<1?1/d:1,a=h<1?1/h:1}}else{let l=Math.abs(t*r-n*s),c=Math.hypot(t,n),d=Math.hypot(s,r);if(e===0)o=d/l,a=c/l;else{let h=e*l;o=d>h?d/h:1,a=c>h?c/h:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){let{ctx:t}=this,{lineWidth:n}=this.current,[s,r]=this.getScaleForStroking();if(t.lineWidth=n||1,s===1&&r===1){t.stroke();return}let o=t.getLineDash();if(e&&t.save(),t.scale(s,r),o.length>0){let a=Math.max(s,r);t.setLineDash(o.map(l=>l/a)),t.lineDashOffset/=a}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Eu=new WeakSet,yw=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},wu=new WeakSet,vw=function(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Su=new WeakSet,bw=function(e,t,n){let s=new Path2D;return s.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),s};var Ha=XS;for(let i in Rn)Ha.prototype[i]!==void 0&&(Ha.prototype[Rn[i]]=Ha.prototype[i]);var Au,Cu,$n=class{static get workerPort(){return u(this,Au)}static set workerPort(e){if(!(typeof Worker!="undefined"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");w(this,Au,e)}static get workerSrc(){return u(this,Cu)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");w(this,Cu,e)}};Au=new WeakMap,Cu=new WeakMap,b($n,Au,null),b($n,Cu,"");var ao,_u,Ew=class{constructor({parsedData:e,rawData:t}){b(this,ao,void 0);b(this,_u,void 0);w(this,ao,e),w(this,_u,t)}getRaw(){return u(this,_u)}get(e){var t;return(t=u(this,ao).get(e))!=null?t:null}getAll(){return zS(u(this,ao))}has(e){return u(this,ao).has(e)}};ao=new WeakMap,_u=new WeakMap;var ka=Symbol("INTERNAL"),Tu,xu,Ru,fl,ww=class{constructor(e,{name:t,intent:n,usage:s,rbGroups:r}){b(this,Tu,!1);b(this,xu,!1);b(this,Ru,!1);b(this,fl,!0);w(this,Tu,!!(e&Qt.DISPLAY)),w(this,xu,!!(e&Qt.PRINT)),this.name=t,this.intent=n,this.usage=s,this.rbGroups=r}get visible(){if(u(this,Ru))return u(this,fl);if(!u(this,fl))return!1;let{print:e,view:t}=this.usage;return u(this,Tu)?(t==null?void 0:t.viewState)!=="OFF":u(this,xu)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,n=!1){e!==ka&&ge("Internal method `_setVisible` called."),w(this,Ru,n),w(this,fl,t)}};Tu=new WeakMap,xu=new WeakMap,Ru=new WeakMap,fl=new WeakMap;var Us,fe,pl,gl,Iu,Aw,Sw=class{constructor(e,t=Qt.DISPLAY){b(this,Iu);b(this,Us,null);b(this,fe,new Map);b(this,pl,null);b(this,gl,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,w(this,gl,e.order);for(let n of e.groups)u(this,fe).set(n.id,new ww(t,n));if(e.baseState==="OFF")for(let n of u(this,fe).values())n._setVisible(ka,!1);for(let n of e.on)u(this,fe).get(n)._setVisible(ka,!0);for(let n of e.off)u(this,fe).get(n)._setVisible(ka,!1);w(this,pl,this.getHash())}}isVisible(e){if(u(this,fe).size===0)return!0;if(!e)return My("Optional content group not defined."),!0;if(e.type==="OCG")return u(this,fe).has(e.id)?u(this,fe).get(e.id).visible:(Q(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return A(this,Iu,Aw).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(let t of e.ids){if(!u(this,fe).has(t))return Q(`Optional content group not found: ${t}`),!0;if(u(this,fe).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(let t of e.ids){if(!u(this,fe).has(t))return Q(`Optional content group not found: ${t}`),!0;if(!u(this,fe).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(let t of e.ids){if(!u(this,fe).has(t))return Q(`Optional content group not found: ${t}`),!0;if(!u(this,fe).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(let t of e.ids){if(!u(this,fe).has(t))return Q(`Optional content group not found: ${t}`),!0;if(u(this,fe).get(t).visible)return!1}return!0}return Q(`Unknown optional content policy ${e.policy}.`),!0}return Q(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){var r;let s=u(this,fe).get(e);if(!s){Q(`Optional content group not found: ${e}`);return}if(n&&t&&s.rbGroups.length)for(let o of s.rbGroups)for(let a of o)a!==e&&((r=u(this,fe).get(a))==null||r._setVisible(ka,!1,!0));s._setVisible(ka,!!t,!0),w(this,Us,null)}setOCGState({state:e,preserveRB:t}){let n;for(let s of e){switch(s){case"ON":case"OFF":case"Toggle":n=s;continue}let r=u(this,fe).get(s);if(r)switch(n){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!r.visible,t);break}}w(this,Us,null)}get hasInitialVisibility(){return u(this,pl)===null||this.getHash()===u(this,pl)}getOrder(){return u(this,fe).size?u(this,gl)?u(this,gl).slice():[...u(this,fe).keys()]:null}getGroups(){return u(this,fe).size>0?zS(u(this,fe)):null}getGroup(e){return u(this,fe).get(e)||null}getHash(){if(u(this,Us)!==null)return u(this,Us);let e=new wg;for(let[t,n]of u(this,fe))e.update(`${t}:${n.visible}`);return w(this,Us,e.hexdigest())}};Us=new WeakMap,fe=new WeakMap,pl=new WeakMap,gl=new WeakMap,Iu=new WeakSet,Aw=function(e){let t=e.length;if(t<2)return!0;let n=e[0];for(let s=1;s<t;s++){let r=e[s],o;if(Array.isArray(r))o=A(this,Iu,Aw).call(this,r);else if(u(this,fe).has(r))o=u(this,fe).get(r).visible;else return Q(`Optional content group not found: ${r}`),!0;switch(n){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return n==="And"};var Cw=class{constructor(e,{disableRange:t=!1,disableStream:n=!1}){ke(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:s,initialData:r,progressiveDone:o,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,(r==null?void 0:r.length)>0){let l=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),e.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){let n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{let s=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(n),!0)});ke(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e,t;return(t=(e=this._fullRequestReader)==null?void 0:e._loaded)!=null?t:0}_onProgress(e){var t,n,s,r;e.total===void 0?(n=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||n.call(t,{loaded:e.loaded}):(r=(s=this._fullRequestReader)==null?void 0:s.onProgress)==null||r.call(s,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ke(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new _w(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new Tw(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}},_w=class{constructor(e,t,n=!1,s=null){this._stream=e,this._done=n||!1,this._filename=WS(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(let r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},Tw=class{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function ZO(i){let e=!0,t=n("filename\\*","i").exec(i);if(t){t=t[1];let d=a(t);return d=unescape(d),d=l(d),d=c(d),r(d)}if(t=o(i),t){let d=c(t);return r(d)}if(t=n("filename","i").exec(i),t){t=t[1];let d=a(t);return d=c(d),r(d)}function n(d,h){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function s(d,h){if(d){if(!/^[\x00-\xFF]+$/.test(h))return h;try{let p=new TextDecoder(d,{fatal:!0}),m=ky(h);h=p.decode(m),e=!1}catch(p){}}return h}function r(d){return e&&/[\x80-\xff]/.test(d)&&(d=s("utf-8",d),e&&(d=s("iso-8859-1",d))),d}function o(d){let h=[],p,m=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=m.exec(d))!==null;){let[,v,E,S]=p;if(v=parseInt(v,10),v in h){if(v===0)break;continue}h[v]=[E,S]}let y=[];for(let v=0;v<h.length&&v in h;++v){let[E,S]=h[v];S=a(S),E&&(S=unescape(S),v===0&&(S=l(S))),y.push(S)}return y.join("")}function a(d){if(d.startsWith('"')){let h=d.slice(1).split('\\"');for(let p=0;p<h.length;++p){let m=h[p].indexOf('"');m!==-1&&(h[p]=h[p].slice(0,m),h.length=p+1),h[p]=h[p].replaceAll(/\\(.)/g,"$1")}d=h.join('"')}return d}function l(d){let h=d.indexOf("'");if(h===-1)return d;let p=d.slice(0,h),y=d.slice(h+1).replace(/^[^']*'/,"");return s(p,y)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,p,m,y){if(m==="q"||m==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(v,E){return String.fromCharCode(parseInt(E,16))}),s(p,y);try{y=atob(y)}catch(v){}return s(p,y)})}return""}function Kx(i,e){let t=new Headers;if(!i||!e||typeof e!="object")return t;for(let n in e){let s=e[n];s!==void 0&&t.append(n,s)}return t}function Ly(i){try{return new URL(i).origin}catch(e){}return null}function Jx({responseHeaders:i,isHttp:e,rangeChunkSize:t,disableRange:n}){let s={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(i.get("Content-Length"),10);return!Number.isInteger(r)||(s.suggestedLength=r,r<=2*t)||n||!e||i.get("Accept-Ranges")!=="bytes"||(i.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function Xx(i){let e=i.get("Content-Disposition");if(e){let t=ZO(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch(n){}if(WS(t))return t}return null}function Oy(i,e){return i===404||i===0&&e.startsWith("file:")?new Jo('Missing PDF "'+e+'".'):new yc(`Unexpected server response (${i}) while retrieving PDF "${e}".`,i)}function Zx(i){return i===200||i===206}function jx(i,e,t){return{method:"GET",headers:i,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function Qx(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:(Q(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}var Dg=class{constructor(e){Y(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=Kx(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return(t=(e=this._fullRequestReader)==null?void 0:e._loaded)!=null?t:0}getFullReader(){return ke(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new xw(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new Rw(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeRequestReaders.slice(0))n.cancel(e)}},xw=class{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;let n=new Headers(e.headers),s=t.url;fetch(s,jx(n,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=Ly(r.url),!Zx(r.status))throw Oy(r.status,s);this._reader=r.body.getReader(),this._headersCapability.resolve();let o=r.headers,{allowRangeRequests:a,suggestedLength:l}=Jx({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=Xx(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new yi("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:Qx(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}},Rw=class{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;let s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;let r=new Headers(e.headers);r.append("Range",`bytes=${t}-${n-1}`);let o=s.url;fetch(o,jx(r,this._withCredentials,this._abortController)).then(a=>{let l=Ly(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!Zx(a.status))throw Oy(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:Qx(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}},xE=200,RE=206;function jO(i){let e=i.response;return typeof e!="string"?e:ky(e).buffer}var Iw=class{constructor({url:e,httpHeaders:t,withCredentials:n}){Y(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=Kx(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){let t=new XMLHttpRequest,n=this.currXhrId++,s=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(let[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=RE):s.expectedStatus=xE,t.responseType="arraybuffer",ke(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var s;let n=this.pendingRequests[e];n&&((s=n.onProgress)==null||s.call(n,t))}onStateChange(e,t){let n=this.pendingRequests[e];if(!n)return;let s=n.xhr;if(s.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){n.onError(s.status);return}let r=s.status||xE;if(!(r===xE&&n.expectedStatus===RE)&&r!==n.expectedStatus){n.onError(s.status);return}let a=jO(s);if(r===RE){let l=s.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?n.onDone({begin:parseInt(c[1],10),chunk:a}):(Q('Missing or invalid "Content-Range" header.'),n.onError(0))}else a?n.onDone({begin:0,chunk:a}):n.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}},Dw=class{constructor(e){this._source=e,this._manager=new Iw(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ke(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Pw(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let n=new Mw(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeRequestReaders.slice(0))n.cancel(e)}},Pw=class{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Ly(t.responseURL);let n=t.getAllResponseHeaders(),s=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{let[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=Jx({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=Xx(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Oy(e,this._url),this._headersCapability.reject(this._storedError);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},Mw=class{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;let e=Ly((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){var t;(t=this._storedError)!=null||(this._storedError=Oy(e,this._url));for(let n of this._requests)n.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},QO=/^[a-z][a-z0-9\-+.]+:/i;function eU(i){if(QO.test(i))return new URL(i);let e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(i))}var kw=class{constructor(e){this.source=e,this.url=eU(e.url),ke(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return(t=(e=this._fullRequestReader)==null?void 0:e._loaded)!=null?t:0}getFullReader(){return ke(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Nw(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new Fw(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeRequestReaders.slice(0))n.cancel(e)}},Nw=class{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new Jo(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new yi("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},Fw=class{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let s=e.source;this._isStreamingSupported=!s.disableStream;let r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}},tU=1e5,Rt=30,nU=.8,dx,Hs,Mt,Du,Pu,lo,Wi,Mu,ku,co,ml,yl,Bs,vl,Nu,bl,uo,Fu,Lu,ho,fo,Ou,Gs,El,Pm,eR,Mm,tR,Uu,Lw,wl,Zp,Hu,Ow,km,nR,Nm,iR,_e=class _e{constructor({textContentSource:e,container:t,viewport:n}){b(this,Pm);b(this,Mm);b(this,Uu);b(this,Hs,Promise.withResolvers());b(this,Mt,null);b(this,Du,!1);b(this,Pu,!!((dx=globalThis.FontInspector)!=null&&dx.enabled));b(this,lo,null);b(this,Wi,null);b(this,Mu,0);b(this,ku,0);b(this,co,null);b(this,ml,null);b(this,yl,0);b(this,Bs,0);b(this,vl,Object.create(null));b(this,Nu,[]);b(this,bl,null);b(this,uo,[]);b(this,Fu,new WeakMap);b(this,Lu,null);var l;if(e instanceof ReadableStream)w(this,bl,e);else if(typeof e=="object")w(this,bl,new ReadableStream({start(c){c.enqueue(e),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');w(this,Mt,w(this,ml,t)),w(this,Bs,n.scale*(globalThis.devicePixelRatio||1)),w(this,yl,n.rotation),w(this,Wi,{div:null,properties:null,ctx:null});let{pageWidth:s,pageHeight:r,pageX:o,pageY:a}=n.rawDims;w(this,Lu,[1,0,0,-1,-o,a+r]),w(this,ku,s),w(this,Mu,r),A(l=_e,km,nR).call(l),Xo(t,n),u(this,Hs).promise.finally(()=>{u(_e,El).delete(this),w(this,Wi,null),w(this,vl,null)}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:e,isFirefox:t}=it.platform;return se(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){let e=()=>{u(this,co).read().then(({value:t,done:n})=>{var s;if(n){u(this,Hs).resolve();return}(s=u(this,lo))!=null||w(this,lo,t.lang),Object.assign(u(this,vl),t.styles),A(this,Pm,eR).call(this,t.items),e()},u(this,Hs).reject)};return w(this,co,u(this,bl).getReader()),u(_e,El).add(this),e(),u(this,Hs).promise}update({viewport:e,onBefore:t=null}){var r;let n=e.scale*(globalThis.devicePixelRatio||1),s=e.rotation;if(s!==u(this,yl)&&(t==null||t(),w(this,yl,s),Xo(u(this,ml),{rotation:s})),n!==u(this,Bs)){t==null||t(),w(this,Bs,n);let o={div:null,properties:null,ctx:A(r=_e,wl,Zp).call(r,u(this,lo))};for(let a of u(this,uo))o.properties=u(this,Fu).get(a),o.div=a,A(this,Uu,Lw).call(this,o)}}cancel(){var t;let e=new yi("TextLayer task cancelled.");(t=u(this,co))==null||t.cancel(e).catch(()=>{}),w(this,co,null),u(this,Hs).reject(e)}get textDivs(){return u(this,uo)}get textContentItemsStr(){return u(this,Nu)}static cleanup(){if(!(u(this,El).size>0)){u(this,ho).clear();for(let{canvas:e}of u(this,fo).values())e.remove();u(this,fo).clear()}}};Hs=new WeakMap,Mt=new WeakMap,Du=new WeakMap,Pu=new WeakMap,lo=new WeakMap,Wi=new WeakMap,Mu=new WeakMap,ku=new WeakMap,co=new WeakMap,ml=new WeakMap,yl=new WeakMap,Bs=new WeakMap,vl=new WeakMap,Nu=new WeakMap,bl=new WeakMap,uo=new WeakMap,Fu=new WeakMap,Lu=new WeakMap,ho=new WeakMap,fo=new WeakMap,Ou=new WeakMap,Gs=new WeakMap,El=new WeakMap,Pm=new WeakSet,eR=function(e){var s,r,o;if(u(this,Du))return;(o=(r=u(this,Wi)).ctx)!=null||(r.ctx=A(s=_e,wl,Zp).call(s,u(this,lo)));let t=u(this,uo),n=u(this,Nu);for(let a of e){if(t.length>tU){Q("Ignoring additional textDivs for performance reasons."),w(this,Du,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){let l=u(this,Mt);w(this,Mt,document.createElement("span")),u(this,Mt).classList.add("markedContent"),a.id!==null&&u(this,Mt).setAttribute("id",`${a.id}`),l.append(u(this,Mt))}else a.type==="endMarkedContent"&&w(this,Mt,u(this,Mt).parentNode);continue}n.push(a.str),A(this,Mm,tR).call(this,a)}},Mm=new WeakSet,tR=function(e){var v;let t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};u(this,uo).push(t);let s=G.transform(u(this,Lu),e.transform),r=Math.atan2(s[1],s[0]),o=u(this,vl)[e.fontName];o.vertical&&(r+=Math.PI/2);let a=u(this,Pu)&&o.fontSubstitution||o.fontFamily;a=_e.fontFamilyMap.get(a)||a;let l=Math.hypot(s[2],s[3]),c=l*A(v=_e,Nm,iR).call(v,a,u(this,lo)),d,h;r===0?(d=s[4],h=s[5]-c):(d=s[4]+c*Math.sin(r),h=s[5]-c*Math.cos(r));let p="calc(var(--scale-factor)*",m=t.style;u(this,Mt)===u(this,ml)?(m.left=`${(100*d/u(this,ku)).toFixed(2)}%`,m.top=`${(100*h/u(this,Mu)).toFixed(2)}%`):(m.left=`${p}${d.toFixed(2)}px)`,m.top=`${p}${h.toFixed(2)}px)`),m.fontSize=`${p}${(u(_e,Gs)*l).toFixed(2)}px)`,m.fontFamily=a,n.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,u(this,Pu)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(n.angle=r*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){let E=Math.abs(e.transform[0]),S=Math.abs(e.transform[3]);E!==S&&Math.max(E,S)/Math.min(E,S)>1.5&&(y=!0)}if(y&&(n.canvasWidth=o.vertical?e.height:e.width),u(this,Fu).set(t,n),u(this,Wi).div=t,u(this,Wi).properties=n,A(this,Uu,Lw).call(this,u(this,Wi)),n.hasText&&u(this,Mt).append(t),n.hasEOL){let E=document.createElement("br");E.setAttribute("role","presentation"),u(this,Mt).append(E)}},Uu=new WeakSet,Lw=function(e){var a;let{div:t,properties:n,ctx:s}=e,{style:r}=t,o="";if(u(_e,Gs)>1&&(o=`scale(${1/u(_e,Gs)})`),n.canvasWidth!==0&&n.hasText){let{fontFamily:l}=r,{canvasWidth:c,fontSize:d}=n;A(a=_e,Hu,Ow).call(a,s,d*u(this,Bs),l);let{width:h}=s.measureText(t.textContent);h>0&&(o=`scaleX(${c*u(this,Bs)/h}) ${o}`)}n.angle!==0&&(o=`rotate(${n.angle}deg) ${o}`),o.length>0&&(r.transform=o)},wl=new WeakSet,Zp=function(e=null){let t=u(this,fo).get(e||(e=""));if(!t){let n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),u(this,fo).set(e,t),u(this,Ou).set(t,{size:0,family:""})}return t},Hu=new WeakSet,Ow=function(e,t,n){let s=u(this,Ou).get(e);t===s.size&&n===s.family||(e.font=`${t}px ${n}`,s.size=t,s.family=n)},km=new WeakSet,nR=function(){if(u(this,Gs)!==null)return;let e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),w(this,Gs,e.getBoundingClientRect().height),e.remove()},Nm=new WeakSet,iR=function(e,t){let n=u(this,ho).get(e);if(n)return n;let s=A(this,wl,Zp).call(this,t);s.canvas.width=s.canvas.height=Rt,A(this,Hu,Ow).call(this,s,Rt,e);let r=s.measureText(""),o=r.fontBoundingBoxAscent,a=Math.abs(r.fontBoundingBoxDescent);if(o){let d=o/(o+a);return u(this,ho).set(e,d),s.canvas.width=s.canvas.height=0,d}s.strokeStyle="red",s.clearRect(0,0,Rt,Rt),s.strokeText("g",0,0);let l=s.getImageData(0,0,Rt,Rt).data;a=0;for(let d=l.length-1-3;d>=0;d-=4)if(l[d]>0){a=Math.ceil(d/4/Rt);break}s.clearRect(0,0,Rt,Rt),s.strokeText("A",0,Rt),l=s.getImageData(0,0,Rt,Rt).data,o=0;for(let d=0,h=l.length;d<h;d+=4)if(l[d]>0){o=Rt-Math.floor(d/4/Rt);break}s.canvas.width=s.canvas.height=0;let c=o?o/(o+a):nU;return u(this,ho).set(e,c),c},b(_e,wl),b(_e,Hu),b(_e,km),b(_e,Nm),b(_e,ho,new Map),b(_e,fo,new Map),b(_e,Ou,new WeakMap),b(_e,Gs,null),b(_e,El,new Set);var Sd=_e,Ad=class i{static textContent(e){let t=[],n={items:t,styles:Object.create(null)};function s(r){var l;if(!r)return;let o=null,a=r.name;if(a==="#text")o=r.value;else if(i.shouldBuildText(a))(l=r==null?void 0:r.attributes)!=null&&l.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(let c of r.children)s(c)}return s(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}},iU=65536,sU=100,rU=5e3,oU=mt?lw:iw,aU=mt?cw:_g,lU=mt?aw:sw,cU=mt?dw:Rg;function dU(i={}){var Sn,we;typeof i=="string"||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});let e=new Uw,{docId:t}=e,n=i.url?uU(i.url):null,s=i.data?hU(i.data):null,r=i.httpHeaders||null,o=i.withCredentials===!0,a=(Sn=i.password)!=null?Sn:null,l=i.range instanceof Pg?i.range:null,c=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:iU,d=i.worker instanceof Ba?i.worker:null,h=i.verbosity,p=typeof i.docBaseUrl=="string"&&!Fy(i.docBaseUrl)?i.docBaseUrl:null,m=typeof i.cMapUrl=="string"?i.cMapUrl:null,y=i.cMapPacked!==!1,v=i.CMapReaderFactory||aU,E=typeof i.standardFontDataUrl=="string"?i.standardFontDataUrl:null,S=i.StandardFontDataFactory||cU,C=i.stopAtErrors!==!0,_=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,T=i.isEvalSupported!==!1,R=typeof i.isOffscreenCanvasSupported=="boolean"?i.isOffscreenCanvasSupported:!mt,I=typeof i.isImageDecoderSupported=="boolean"?i.isImageDecoderSupported:!mt&&(it.platform.isFirefox||!globalThis.chrome),D=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,k=typeof i.disableFontFace=="boolean"?i.disableFontFace:mt,N=i.fontExtraProperties===!0,F=i.enableXfa===!0,U=i.ownerDocument||globalThis.document,re=i.disableRange===!0,X=i.disableStream===!0,Z=i.disableAutoFetch===!0,Ve=i.pdfBug===!0,L=i.CanvasFactory||oU,W=i.FilterFactory||lU,Bt=i.enableHWA===!0,Kn=l?l.length:(we=i.length)!=null?we:NaN,Ri=typeof i.useSystemFonts=="boolean"?i.useSystemFonts:!mt&&!k,an=typeof i.useWorkerFetch=="boolean"?i.useWorkerFetch:v===_g&&S===Rg&&m&&E&&Zc(m,document.baseURI)&&Zc(E,document.baseURI),ot=null;xO(h);let Fe={canvasFactory:new L({ownerDocument:U,enableHWA:Bt}),filterFactory:new W({docId:t,ownerDocument:U}),cMapReaderFactory:an?null:new v({baseUrl:m,isCompressed:y}),standardFontDataFactory:an?null:new S({baseUrl:E})};if(!d){let Gc={verbosity:h,port:$n.workerPort};d=Gc.port?Ba.fromPort(Gc):new Ba(Gc),e._worker=d}let ba={docId:t,apiVersion:"4.10.38",data:s,password:a,disableAutoFetch:Z,rangeChunkSize:c,length:Kn,docBaseUrl:p,enableXfa:F,evaluatorOptions:{maxImageSize:_,disableFontFace:k,ignoreErrors:C,isEvalSupported:T,isOffscreenCanvasSupported:R,isImageDecoderSupported:I,canvasMaxAreaInBytes:D,fontExtraProperties:N,useSystemFonts:Ri,cMapUrl:an?m:null,standardFontDataUrl:an?E:null}},Bc={disableFontFace:k,fontExtraProperties:N,ownerDocument:U,pdfBug:Ve,styleElement:ot,loadingParams:{disableAutoFetch:Z,enableXfa:F}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let Gc=d.messageHandler.sendWithPromise("GetDocRequest",ba,s?[s.buffer]:null),db;if(l)db=new Cw(l,{disableRange:re,disableStream:X});else if(!s){if(!n)throw new Error("getDocument - no `url` parameter provided.");let Ea;if(mt)if(Zc(n)){if(typeof fetch=="undefined"||typeof Response=="undefined"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");Ea=Dg}else Ea=kw;else Ea=Zc(n)?Dg:Dw;db=new Ea({url:n,length:Kn,httpHeaders:r,withCredentials:o,rangeChunkSize:c,disableRange:re,disableStream:X})}return Gc.then(Ea=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let S_=new Dr(t,Ea,d.port),MP=new Vw(S_,e,db,Bc,Fe);e._transport=MP,S_.send("Ready",null)})}).catch(e._capability.reject),e}function uU(i){if(i instanceof URL)return i.href;try{return new URL(i,window.location).href}catch(e){if(mt&&typeof i=="string")return i}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function hU(i){if(mt&&typeof Buffer!="undefined"&&i instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength)return i;if(typeof i=="string")return ky(i);if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)||typeof i=="object"&&!isNaN(i==null?void 0:i.length))return new Uint8Array(i);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function lx(i){return typeof i=="object"&&Number.isInteger(i==null?void 0:i.num)&&i.num>=0&&Number.isInteger(i==null?void 0:i.gen)&&i.gen>=0}var Fm,Lm=class Lm{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${vt(Lm,Fm)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,n,s;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(r){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,r}this._transport=null,(s=this._worker)==null||s.destroy(),this._worker=null}};Fm=new WeakMap,b(Lm,Fm,0);var Uw=Lm,Pg=class{constructor(e,t,n=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let n of this._progressListeners)n(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){ge("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},Hw=class{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return se(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},Vs,Yi,$s,Na,Sl,jp,Bw=class{constructor(e,t,n,s=!1){b(this,$s);b(this,Sl);b(this,Vs,null);b(this,Yi,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=s?new yg:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new Mg,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:s=0,dontFlip:r=!1}={}){return new yd({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}getAnnotations({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return se(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:s=Ss.ENABLE,transform:r=null,background:o=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:h=!1}){var T,R;(T=this._stats)==null||T.time("Overall");let p=this._transport.getRenderingIntent(n,s,d,h),{renderingIntent:m,cacheKey:y}=p;w(this,Yi,!1),A(this,Sl,jp).call(this),a||(a=this._transport.getOptionalContentConfig(m));let v=this._intentStates.get(y);v||(v=Object.create(null),this._intentStates.set(y,v)),v.streamReaderCancelTimeout&&(clearTimeout(v.streamReaderCancelTimeout),v.streamReaderCancelTimeout=null);let E=!!(m&Qt.PRINT);v.displayReadyCapability||(v.displayReadyCapability=Promise.withResolvers(),v.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(R=this._stats)==null||R.time("Page Request"),this._pumpOperatorList(p));let S=I=>{var D;v.renderTasks.delete(C),(this._maybeCleanupAfterRender||E)&&w(this,Yi,!0),A(this,$s,Na).call(this,!E),I?(C.capability.reject(I),this._abortOperatorList({intentState:v,reason:I instanceof Error?I:new Error(I)})):C.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(D=globalThis.Stats)!=null&&D.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},C=new qw({callback:S,params:{canvasContext:e,viewport:t,transform:r,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:v.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!E,pdfBug:this._pdfBug,pageColors:c});(v.renderTasks||(v.renderTasks=new Set)).add(C);let _=C.task;return Promise.all([v.displayReadyCapability.promise,a]).then(([I,D])=>{var k;if(this.destroyed){S();return}if((k=this._stats)==null||k.time("Rendering"),!(D.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");C.initializeGraphics({transparency:I,optionalContentConfig:D}),C.operatorListChanged()}).catch(S),_}getOperatorList({intent:e="display",annotationMode:t=Ss.ENABLE,printAnnotationStorage:n=null,isEditing:s=!1}={}){var c;function r(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}let o=this._transport.getRenderingIntent(e,t,n,s,!0),a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=r,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>Ad.textContent(n));let t=this.streamTextContent(e);return new Promise(function(n,s){function r(){o.read().then(function({value:l,done:c}){var d;if(c){n(a);return}(d=a.lang)!=null||(a.lang=l.lang),Object.assign(a.styles,l.styles),a.items.push(...l.items),r()},s)}let o=t.getReader(),a={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),w(this,Yi,!1),A(this,Sl,jp).call(this),Promise.all(e)}cleanup(e=!1){w(this,Yi,!0);let t=A(this,$s,Na).call(this,!1);return e&&t&&this._stats&&(this._stats=new yg),t}_startRenderPage(e,t){var s,r;let n=this._intentStates.get(t);n&&((s=this._stats)==null||s.timeEnd("Page Request"),(r=n.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let n=0,s=e.length;n<s;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let n of t.renderTasks)n.operatorListChanged();e.lastChunk&&A(this,$s,Na).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:s}){let{map:r,transfer:o}=n,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:s},o).getReader(),c=this._intentStates.get(t);c.streamReader=l;let d=()=>{l.read().then(({value:h,done:p})=>{if(p){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,c),d())},h=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(let p of c.renderTasks)p.operatorListChanged();A(this,$s,Na).call(this,!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(h);else if(c.opListReadCapability)c.opListReadCapability.reject(h);else throw h}})};d()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof vd){let s=sU;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new yi(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[s,r]of this._intentStates)if(r===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}};Vs=new WeakMap,Yi=new WeakMap,$s=new WeakSet,Na=function(e=!1){if(A(this,Sl,jp).call(this),!u(this,Yi)||this.destroyed)return!1;if(e)return w(this,Vs,setTimeout(()=>{w(this,Vs,null),A(this,$s,Na).call(this,!1)},rU)),!1;for(let{renderTasks:t,operatorList:n}of this._intentStates.values())if(t.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),w(this,Yi,!1),!0},Sl=new WeakSet,jp=function(){u(this,Vs)&&(clearTimeout(u(this,Vs)),w(this,Vs,null))};var Ki,Om,Gw=class{constructor(){b(this,Ki,new Map);b(this,Om,Promise.resolve())}postMessage(e,t){let n={data:structuredClone(e,t?{transfer:t}:null)};u(this,Om).then(()=>{for(let[s]of u(this,Ki))s.call(this,n)})}addEventListener(e,t,n=null){let s=null;if((n==null?void 0:n.signal)instanceof AbortSignal){let{signal:r}=n;if(r.aborted){Q("LoopbackPort - cannot use an `aborted` signal.");return}let o=()=>this.removeEventListener(e,t);s=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}u(this,Ki).set(t,s)}removeEventListener(e,t){let n=u(this,Ki).get(t);n==null||n(),u(this,Ki).delete(t)}terminate(){for(let[,e]of u(this,Ki))e==null||e();u(this,Ki).clear()}};Ki=new WeakMap,Om=new WeakMap;var Um,po,go,Al,Qp,Cl,eg,ve=class ve{constructor({name:e=null,port:t=null,verbosity:n=RO()}={}){b(this,Al);var s;if(this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((s=u(ve,go))!=null&&s.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(u(ve,go)||w(ve,go,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new Dr("main","worker",e),this._messageHandler.on("ready",function(){}),A(this,Al,Qp).call(this)}_initialize(){if(u(ve,po)||u(ve,Cl,eg)){this._setupFakeWorker();return}let{workerSrc:e}=ve;try{ve._isSameOrigin(window.location.href,e)||(e=ve._createCDNWrapper(new URL(e,window.location).href));let t=new Worker(e,{type:"module"}),n=new Dr("main","worker",t),s=()=>{r.abort(),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=new AbortController;t.addEventListener("error",()=>{this._webWorker||s()},{signal:r.signal}),n.on("test",a=>{if(r.abort(),this.destroyed||!a){s();return}this._messageHandler=n,this._port=t,this._webWorker=t,A(this,Al,Qp).call(this)}),n.on("ready",a=>{if(r.abort(),this.destroyed){s();return}try{o()}catch(l){this._setupFakeWorker()}});let o=()=>{let a=new Uint8Array;n.send("test",a,[a.buffer])};o();return}catch(t){My("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){u(ve,po)||(Q("Setting up fake worker."),w(ve,po,!0)),ve._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let t=new Gw;this._port=t;let n=`fake${vt(ve,Um)._++}`,s=new Dr(n+"_worker",n,t);e.setup(s,t),this._messageHandler=new Dr(n,n+"_worker",t),A(this,Al,Qp).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,n;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=u(ve,go))==null||t.delete(this._port),this._port=null,(n=this._messageHandler)==null||n.destroy(),this._messageHandler=null}static fromPort(e){var n;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");let t=(n=u(this,go))==null?void 0:n.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new ve(e)}static get workerSrc(){if($n.workerSrc)return $n.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return se(this,"_setupFakeWorkerGlobal",(async()=>u(this,Cl,eg)?u(this,Cl,eg):(await import(this.workerSrc)).WorkerMessageHandler)())}};Um=new WeakMap,po=new WeakMap,go=new WeakMap,Al=new WeakSet,Qp=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Cl=new WeakSet,eg=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch(t){return null}},b(ve,Cl),b(ve,Um,0),b(ve,po,!1),b(ve,go,void 0),mt&&(w(ve,po,!0),$n.workerSrc||($n.workerSrc="./pdf.worker.mjs")),ve._isSameOrigin=(e,t)=>{let n;try{if(n=new URL(e),!n.origin||n.origin==="null")return!1}catch(r){return!1}let s=new URL(t,n);return n.origin===s.origin},ve._createCDNWrapper=e=>{let t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};var Ba=ve,Ji,li,_l,Tl,Xi,mo,rd,Vw=class{constructor(e,t,n,s,r){b(this,mo);b(this,Ji,new Map);b(this,li,new Map);b(this,_l,new Map);b(this,Tl,new Map);b(this,Xi,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Mg,this.fontLoader=new tw({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return se(this,"annotationStorage",new Ed)}getRenderingIntent(e,t=Ss.ENABLE,n=null,s=!1,r=!1){let o=Qt.DISPLAY,a=ew;switch(e){case"any":o=Qt.ANY;break;case"display":break;case"print":o=Qt.PRINT;break;default:Q(`getRenderingIntent - invalid intent: ${e}`)}let l=o&Qt.PRINT&&n instanceof Sg?n:this.annotationStorage;switch(t){case Ss.DISABLE:o+=Qt.ANNOTATIONS_DISABLE;break;case Ss.ENABLE:break;case Ss.ENABLE_FORMS:o+=Qt.ANNOTATIONS_FORMS;break;case Ss.ENABLE_STORAGE:o+=Qt.ANNOTATIONS_STORAGE,a=l.serializable;break;default:Q(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(o+=Qt.IS_EDITING),r&&(o+=Qt.OPLIST);let{ids:c,hash:d}=l.modifiedIds,h=[o,a.hash,d];return{renderingIntent:o,cacheKey:h.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=u(this,Xi))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let s of u(this,li).values())e.push(s._destroy());u(this,li).clear(),u(this,_l).clear(),u(this,Tl).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var s,r;this.commonObjs.clear(),this.fontLoader.clear(),u(this,Ji).clear(),this.filterFactory.destroy(),Sd.cleanup(),(s=this._networkStream)==null||s.cancelAllRequests(new yi("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,s)=>{ke(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},s.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){s.close();return}ke(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{this._fullReader.cancel(r),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async n=>{var a;await this._fullReader.headersReady;let{isStreamingSupported:s,isRangeSupported:r,contentLength:o}=this._fullReader;return(!s||!r)&&(this._lastProgress&&((a=t.onProgress)==null||a.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var c;(c=t.onProgress)==null||c.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:s,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(n,s)=>{ke(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let r=this._networkStream.getRangeReader(n.begin,n.end);if(!r){s.close();return}s.onPull=()=>{r.read().then(function({value:o,done:a}){if(a){s.close();return}ke(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{s.error(o)})},s.onCancel=o=>{r.cancel(o),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new Hw(n,this))}),e.on("DocException",n=>{t._capability.reject(It(n))}),e.on("PasswordRequest",n=>{w(this,Xi,Promise.withResolvers());try{if(!t.onPassword)throw It(n);let s=r=>{r instanceof Error?u(this,Xi).reject(r):u(this,Xi).resolve({password:r})};t.onPassword(s,n.code)}catch(s){u(this,Xi).reject(s)}return u(this,Xi).promise}),e.on("DataLoaded",n=>{var s;(s=t.onProgress)==null||s.call(t,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;u(this,li).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,s,r])=>{var o;if(this.destroyed||this.commonObjs.has(n))return null;switch(s){case"Font":let{disableFontFace:a,fontExtraProperties:l,pdfBug:c}=this._params;if("error"in r){let m=r.error;Q(`Error during font loading: ${m}`),this.commonObjs.resolve(n,m);break}let d=c&&((o=globalThis.FontInspector)!=null&&o.enabled)?(m,y)=>globalThis.FontInspector.fontAdded(m,y):null,h=new nw(r,{disableFontFace:a,fontExtraProperties:l,inspectFont:d});this.fontLoader.bind(h).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!l&&h.data&&(h.data=null),this.commonObjs.resolve(n,h)});break;case"CopyLocalImage":let{imageRef:p}=r;ke(p,"The imageRef must be defined.");for(let m of u(this,li).values())for(let[,y]of m.objs)if((y==null?void 0:y.ref)===p)return y.dataLen?(this.commonObjs.resolve(n,structuredClone(y)),y.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,r);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([n,s,r,o])=>{var l;if(this.destroyed)return;let a=u(this,li).get(s);if(!a.objs.has(n)){if(a._intentStates.size===0){(l=o==null?void 0:o.bitmap)==null||l.close();return}switch(r){case"Image":a.objs.resolve(n,o),(o==null?void 0:o.dataLen)>SO&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(n,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",n=>{var s;this.destroyed||(s=t.onProgress)==null||s.call(t,{loaded:n.loaded,total:n.total})}),e.on("FetchBuiltInCMap",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(n)}),e.on("FetchStandardFontData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n,s;this.annotationStorage.size<=0&&Q("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:(s=(n=this._fullReader)==null?void 0:n.filename)!=null?s:null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,n=u(this,_l).get(t);if(n)return n;let s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&u(this,Tl).set(r.refStr,e);let o=new Bw(t,r,this,this._params.pdfBug);return u(this,li).set(t,o),o});return u(this,_l).set(t,s),s}getPageIndex(e){return lx(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return A(this,mo,rd).call(this,"GetFieldObjects")}hasJSActions(){return A(this,mo,rd).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return A(this,mo,rd).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return A(this,mo,rd).call(this,"GetOptionalContentConfig").then(t=>new Sw(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",t=u(this,Ji).get(e);if(t)return t;let n=this.messageHandler.sendWithPromise(e,null).then(s=>{var r,o,a,l;return{info:s[0],metadata:s[1]?new Ew(s[1]):null,contentDispositionFilename:(o=(r=this._fullReader)==null?void 0:r.filename)!=null?o:null,contentLength:(l=(a=this._fullReader)==null?void 0:a.contentLength)!=null?l:null}});return u(this,Ji).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(let t of u(this,li).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),u(this,Ji).clear(),this.filterFactory.destroy(!0),Sd.cleanup()}}cachedPageNumber(e){var n;if(!lx(e))return null;let t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return(n=u(this,Tl).get(t))!=null?n:null}};Ji=new WeakMap,li=new WeakMap,_l=new WeakMap,Tl=new WeakMap,Xi=new WeakMap,mo=new WeakSet,rd=function(e,t=null){let n=u(this,Ji).get(e);if(n)return n;let s=this.messageHandler.sendWithPromise(e,t);return u(this,Ji).set(e,s),s};var Jc=Symbol("INITIAL_DATA"),zt,Bu,$w,Mg=class{constructor(){b(this,Bu);b(this,zt,Object.create(null))}get(e,t=null){if(t){let s=A(this,Bu,$w).call(this,e);return s.promise.then(()=>t(s.data)),null}let n=u(this,zt)[e];if(!n||n.data===Jc)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){let t=u(this,zt)[e];return!!t&&t.data!==Jc}delete(e){let t=u(this,zt)[e];return!t||t.data===Jc?!1:(delete u(this,zt)[e],!0)}resolve(e,t=null){let n=A(this,Bu,$w).call(this,e);n.data=t,n.resolve()}clear(){var e;for(let t in u(this,zt)){let{data:n}=u(this,zt)[t];(e=n==null?void 0:n.bitmap)==null||e.close()}w(this,zt,Object.create(null))}*[Symbol.iterator](){for(let e in u(this,zt)){let{data:t}=u(this,zt)[e];t!==Jc&&(yield[e,t])}}};zt=new WeakMap,Bu=new WeakSet,$w=function(e){var t;return(t=u(this,zt))[e]||(t[e]={...Promise.withResolvers(),data:Jc})};var zs,zw=class{constructor(e){b(this,zs,null);w(this,zs,e),this.onContinue=null}get promise(){return u(this,zs).capability.promise}cancel(e=0){u(this,zs).cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=u(this,zs).operatorList;if(!e)return!1;let{annotationCanvasMap:t}=u(this,zs);return e.form||e.canvas&&(t==null?void 0:t.size)>0}};zs=new WeakMap;var qs,yo,Ir=class Ir{constructor({callback:e,params:t,objs:n,commonObjs:s,annotationCanvasMap:r,operatorList:o,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:h=!1,pageColors:p=null}){b(this,qs,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=s,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=h,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window!="undefined",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new zw(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var a,l;if(this.cancelled)return;if(this._canvas){if(u(Ir,yo).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");u(Ir,yo).add(this._canvas)}this._pdfBug&&((a=globalThis.StepperManager)!=null&&a.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:n,viewport:s,transform:r,background:o}=this.params;this.gfx=new Ha(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:s,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var n;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),u(this,qs)&&(window.cancelAnimationFrame(u(this,qs)),w(this,qs,null)),u(Ir,yo).delete(this._canvas),this.callback(e||new vd(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?w(this,qs,window.requestAnimationFrame(()=>{w(this,qs,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),u(Ir,yo).delete(this._canvas),this.callback())))}};qs=new WeakMap,yo=new WeakMap,b(Ir,yo,new WeakSet);var qw=Ir,fU="4.10.38",pU="f9bea397f";function cx(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function Xc(i){return Math.max(0,Math.min(255,255*i))}var kg=class{static CMYK_G([e,t,n,s]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Xc(e),[e,e,e]}static G_HTML([e]){let t=cx(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(Xc)}static RGB_HTML(e){return`#${e.map(cx).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,n+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,n,s]){return[Xc(1-Math.min(1,e+s)),Xc(1-Math.min(1,n+s)),Xc(1-Math.min(1,t+s))]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){let s=1-e,r=1-t,o=1-n,a=Math.min(s,r,o);return["CMYK",s,r,o,a]}},Ww=class{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");let s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),n||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){ge("Abstract method `_createSVG` called.")}},Cd=class extends Ww{_createSVG(e){return document.createElementNS(Mi,e)}},Ng=class{static setupStorage(e,t,n,s,r){let o=s.getValue(t,{value:null});switch(n.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(o.value===n.attributes.xfaOn?e.setAttribute("checked",!0):o.value===n.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",a=>{s.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(let a of n.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{let l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;s.setValue(t,{value:c})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:s,linkService:r}){let{attributes:o}=t,a=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${s}`);for(let[l,c]of Object.entries(o))if(c!=null)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,c)}a&&r.addLinkAttributes(e,o.href,o.newWindow),n&&o.dataId&&this.setupStorage(e,o.dataId,t,n)}static render(e){var h,p;let t=e.annotationStorage,n=e.linkService,s=e.xfaHtml,r=e.intent||"display",o=document.createElement(s.name);s.attributes&&this.setAttributes({html:o,element:s,intent:r,linkService:n});let a=r!=="richText",l=e.div;if(l.append(o),e.viewport){let m=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=m}a&&l.setAttribute("class","xfaLayer xfaFont");let c=[];if(s.children.length===0){if(s.value){let m=document.createTextNode(s.value);o.append(m),a&&Ad.shouldBuildText(s.name)&&c.push(m)}return{textDivs:c}}let d=[[s,-1,o]];for(;d.length>0;){let[m,y,v]=d.at(-1);if(y+1===m.children.length){d.pop();continue}let E=m.children[++d.at(-1)[1]];if(E===null)continue;let{name:S}=E;if(S==="#text"){let _=document.createTextNode(E.value);c.push(_),v.append(_);continue}let C=(h=E==null?void 0:E.attributes)!=null&&h.xmlns?document.createElementNS(E.attributes.xmlns,S):document.createElement(S);if(v.append(C),E.attributes&&this.setAttributes({html:C,element:E,storage:t,intent:r,linkService:n}),((p=E.children)==null?void 0:p.length)>0)d.push([E,-1,C]);else if(E.value){let _=document.createTextNode(E.value);a&&Ad.shouldBuildText(S)&&c.push(_),C.append(_)}}for(let m of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){let t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}},Gh=1e3,gU=9,Qo=new WeakSet;function rr(i){return{width:i[2]-i[0],height:i[3]-i[1]}}var Yw=class{static create(e){switch(e.data.annotationType){case Ue.LINK:return new Fg(e);case Ue.TEXT:return new Jw(e);case Ue.WIDGET:switch(e.data.fieldType){case"Tx":return new Xw(e);case"Btn":return e.data.radioButton?new Lg(e):e.data.checkBox?new jw(e):new Qw(e);case"Ch":return new eS(e);case"Sig":return new Zw(e)}return new us(e);case Ue.POPUP:return new _d(e);case Ue.FREETEXT:return new Og(e);case Ue.LINE:return new sS(e);case Ue.SQUARE:return new rS(e);case Ue.CIRCLE:return new oS(e);case Ue.POLYLINE:return new Ug(e);case Ue.CARET:return new lS(e);case Ue.INK:return new Td(e);case Ue.POLYGON:return new aS(e);case Ue.HIGHLIGHT:return new Hg(e);case Ue.UNDERLINE:return new dS(e);case Ue.SQUIGGLY:return new uS(e);case Ue.STRIKEOUT:return new hS(e);case Ue.STAMP:return new Bg(e);case Ue.FILEATTACHMENT:return new fS(e);default:return new De(e)}}},vo,xl,Rl,Gu,Kw,ZS=class ZS{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:s=!1}={}){b(this,Gu);b(this,vo,null);b(this,xl,!1);b(this,Rl,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:n}){return!!(e!=null&&e.str||t!=null&&t.str||n!=null&&n.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return ZS._hasPopupData(this.data)}updateEdited(e){var n;if(!this.container)return;u(this,vo)||w(this,vo,{rect:this.data.rect.slice(0)});let{rect:t}=e;t&&A(this,Gu,Kw).call(this,t),(n=u(this,Rl))==null||n.popup.updateEdited(e)}resetEdited(){var e;u(this,vo)&&(A(this,Gu,Kw).call(this,u(this,vo).rect),(e=u(this,Rl))==null||e.popup.resetEdited(),w(this,vo,null))}_createContainer(e){let{data:t,parent:{page:n,viewport:s}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),this instanceof us||(r.tabIndex=Gh);let{style:o}=r;if(o.zIndex=this.parent.zIndex++,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof _d){let{rotation:v}=t;return!t.hasOwnCanvas&&v!==0&&this.setRotation(v,r),r}let{width:a,height:l}=rr(t.rect);if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;let v=t.borderStyle.horizontalCornerRadius,E=t.borderStyle.verticalCornerRadius;if(v>0||E>0){let C=`calc(${v}px * var(--scale-factor)) / calc(${E}px * var(--scale-factor))`;o.borderRadius=C}else if(this instanceof Lg){let C=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;o.borderRadius=C}switch(t.borderStyle.style){case Yc.SOLID:o.borderStyle="solid";break;case Yc.DASHED:o.borderStyle="dashed";break;case Yc.BEVELED:Q("Unimplemented border style: beveled");break;case Yc.INSET:Q("Unimplemented border style: inset");break;case Yc.UNDERLINE:o.borderBottomStyle="solid";break;default:break}let S=t.borderColor||null;S?(w(this,xl,!0),o.borderColor=G.makeHexColor(S[0]|0,S[1]|0,S[2]|0)):o.borderWidth=0}let c=G.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:d,pageHeight:h,pageX:p,pageY:m}=s.rawDims;o.left=`${100*(c[0]-p)/d}%`,o.top=`${100*(c[1]-m)/h}%`;let{rotation:y}=t;return t.hasOwnCanvas||y===0?(o.width=`${100*a/d}%`,o.height=`${100*l/h}%`):this.setRotation(y,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;let{pageWidth:n,pageHeight:s}=this.parent.viewport.rawDims,{width:r,height:o}=rr(this.data.rect),a,l;e%180===0?(a=100*r/n,l=100*o/s):(a=100*o/n,l=100*r/s),t.style.width=`${a}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(t,n,s)=>{let r=s.detail[t],o=r[0],a=r.slice(1);s.target.style[n]=kg[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[n]:kg[`${o}_rgb`](a)})};return se(this,"_commonActions",{display:t=>{let{display:n}=t.detail,s=n%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{let{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{let n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){let n=this._commonActions;for(let s of Object.keys(t.detail)){let r=e[s]||n[s];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let n=this._commonActions;for(let[s,r]of Object.entries(t)){let o=n[s];if(o){let a={detail:{[s]:r},target:e};o(a),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:e}=this.data;if(!e)return;let[t,n,s,r]=this.data.rect.map(v=>Math.fround(v));if(e.length===8){let[v,E,S,C]=e.subarray(2,6);if(s===v&&r===E&&t===S&&n===C)return}let{style:o}=this.container,a;if(u(this,xl)){let{borderColor:v,borderWidth:E}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${v}" stroke-width="${E}">`],this.container.classList.add("hasBorder")}let l=s-t,c=r-n,{svgFactory:d}=this,h=d.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0);let p=d.createElement("defs");h.append(p);let m=d.createElement("clipPath"),y=`clippath_${this.data.id}`;m.setAttribute("id",y),m.setAttribute("clipPathUnits","objectBoundingBox"),p.append(m);for(let v=2,E=e.length;v<E;v+=8){let S=e[v],C=e[v+1],_=e[v+2],T=e[v+3],R=d.createElement("rect"),I=(_-t)/l,D=(r-C)/c,k=(S-_)/l,N=(C-T)/c;R.setAttribute("x",I),R.setAttribute("y",D),R.setAttribute("width",k),R.setAttribute("height",N),m.append(R),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${I}" y="${D}" width="${k}" height="${N}"/>`)}u(this,xl)&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(h),this.container.style.clipPath=`url(#${y})`}_createPopup(){let{data:e}=this,t=w(this,Rl,new _d({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){ge("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let n=[];if(this._fieldObjects){let s=this._fieldObjects[e];if(s)for(let{page:r,id:o,exportValues:a}of s){if(r===-1||o===t)continue;let l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${o}"]`);if(c&&!Qo.has(c)){Q(`_getElementsByName - element not allowed: ${o}`);continue}n.push({id:o,exportValue:l,domElement:c})}return n}for(let s of document.getElementsByName(e)){let{exportValue:r}=s,o=s.getAttribute("data-element-id");o!==t&&Qo.has(s)&&n.push({id:o,exportValue:r,domElement:s})}return n}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};vo=new WeakMap,xl=new WeakMap,Rl=new WeakMap,Gu=new WeakSet,Kw=function(e){let{container:{style:t},data:{rect:n,rotation:s},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:l}}}}=this;n==null||n.splice(0,4,...e);let{width:c,height:d}=rr(e);t.left=`${100*(e[0]-a)/r}%`,t.top=`${100*(o-e[3]+l)/o}%`,s===0?(t.width=`${100*c/r}%`,t.height=`${100*d/o}%`):this.setRotation(s)};var De=ZS,Zi,_r,Hm,sR,Bm,rR,Fg=class extends De{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});b(this,Zi);b(this,Hm);b(this,Bm);this.isTooltipOnly=t.data.isTooltipOnly}render(){let{data:t,linkService:n}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let r=!1;return t.url?(n.addLinkAttributes(s,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(s,t.action),r=!0):t.attachment?(A(this,Hm,sR).call(this,s,t.attachment,t.attachmentDest),r=!0):t.setOCGState?(A(this,Bm,rR).call(this,s,t.setOCGState),r=!0):t.dest?(this._bindLink(s,t.dest),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),r=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(s,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(s),this.container}_bindLink(t,n){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&A(this,Zi,_r).call(this)}_bindNamedAction(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),A(this,Zi,_r).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");let s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let r of Object.keys(n.actions)){let o=s.get(r);o&&(t[o]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:r}}),!1})}t.onclick||(t.onclick=()=>!1),A(this,Zi,_r).call(this)}_bindResetFormAction(t,n){let s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),A(this,Zi,_r).call(this),!this._fieldObjects){Q('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{var h;s==null||s();let{fields:r,refs:o,include:a}=n,l=[];if(r.length!==0||o.length!==0){let p=new Set(o);for(let m of r){let y=this._fieldObjects[m]||[];for(let{id:v}of y)p.add(v)}for(let m of Object.values(this._fieldObjects))for(let y of m)p.has(y.id)===a&&l.push(y)}else for(let p of Object.values(this._fieldObjects))l.push(...p);let c=this.annotationStorage,d=[];for(let p of l){let{id:m}=p;switch(d.push(m),p.type){case"text":{let v=p.defaultValue||"";c.setValue(m,{value:v});break}case"checkbox":case"radiobutton":{let v=p.defaultValue===p.exportValues;c.setValue(m,{value:v});break}case"combobox":case"listbox":{let v=p.defaultValue||"";c.setValue(m,{value:v});break}default:continue}let y=document.querySelector(`[data-element-id="${m}"]`);if(y){if(!Qo.has(y)){Q(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((h=this.linkService.eventBus)==null||h.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}};Zi=new WeakSet,_r=function(){this.container.setAttribute("data-internal-link","")},Hm=new WeakSet,sR=function(t,n,s=null){t.href=this.linkService.getAnchorUrl(""),n.description&&(t.title=n.description),t.onclick=()=>{var r;return(r=this.downloadManager)==null||r.openOrDownloadData(n.content,n.filename,s),!1},A(this,Zi,_r).call(this)},Bm=new WeakSet,rR=function(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),A(this,Zi,_r).call(this)};var Jw=class extends De{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}},us=class extends De{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return it.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,s,r){n.includes("mouse")?e.addEventListener(n,o=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(n,o=>{var a;if(n==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}r&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(o)}}))})}_setEventListeners(e,t,n,s){var r,o,a;for(let[l,c]of n)(c==="Action"||(r=this.data.actions)!=null&&r[c])&&((c==="Focus"||c==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,c,s),c==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):c==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":G.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||gU,r=e.style,o,a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),d=Math.round(c/(Hp*s))||1,h=c/d;o=Math.min(s,l(h/Hp))}else{let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(s,l(c/Hp))}r.fontSize=`calc(${o}px * var(--scale-factor))`,r.color=G.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}},Xw=class extends us{constructor(e){let t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,s){let r=this.annotationStorage;for(let o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=n),r.setValue(o.id,{[s]:n})}render(){var s,r;let e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){let o=e.getValue(t,{value:this.data.fieldValue}),a=o.value||"",l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&a.length>l&&(a=a.slice(0,l));let c=o.formattedValue||((s=this.data.textContent)==null?void 0:s.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));let d={userValue:a,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=c!=null?c:a,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",c!=null?c:a),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Qo.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=Gh,this._setRequired(n,this.data.required),l&&(n.maxLength=l),n.addEventListener("input",p=>{e.setValue(t,{value:p.target.value}),this.setPropertyOnSiblings(n,"value",p.target.value,"value"),d.formattedValue=null}),n.addEventListener("resetform",p=>{var y;let m=(y=this.data.defaultFieldValue)!=null?y:"";n.value=d.userValue=m,d.formattedValue=null});let h=p=>{let{formattedValue:m}=d;m!=null&&(p.target.value=m),p.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",m=>{var v;if(d.focused)return;let{target:y}=m;d.userValue&&(y.value=d.userValue),d.lastCommittedValue=y.value,d.commitKey=1,(v=this.data.actions)!=null&&v.Focus||(d.focused=!0)}),n.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);let y={value(v){var E;d.userValue=(E=v.detail.value)!=null?E:"",e.setValue(t,{value:d.userValue.toString()}),v.target.value=d.userValue},formattedValue(v){let{formattedValue:E}=v.detail;d.formattedValue=E,E!=null&&v.target!==document.activeElement&&(v.target.value=E),e.setValue(t,{formattedValue:E})},selRange(v){v.target.setSelectionRange(...v.detail.selRange)},charLimit:v=>{var _;let{charLimit:E}=v.detail,{target:S}=v;if(E===0){S.removeAttribute("maxLength");return}S.setAttribute("maxLength",E);let C=d.userValue;!C||C.length<=E||(C=C.slice(0,E),S.value=d.userValue=C,e.setValue(t,{value:C}),(_=this.linkService.eventBus)==null||_.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:C,willCommit:!0,commitKey:1,selStart:S.selectionStart,selEnd:S.selectionEnd}}))}};this._dispatchEventFromSandbox(y,m)}),n.addEventListener("keydown",m=>{var E;d.commitKey=1;let y=-1;if(m.key==="Escape"?y=0:m.key==="Enter"&&!this.data.multiLine?y=2:m.key==="Tab"&&(d.commitKey=3),y===-1)return;let{value:v}=m.target;d.lastCommittedValue!==v&&(d.lastCommittedValue=v,d.userValue=v,(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,willCommit:!0,commitKey:y,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});let p=h;h=null,n.addEventListener("blur",m=>{var v,E;if(!d.focused||!m.relatedTarget)return;(v=this.data.actions)!=null&&v.Blur||(d.focused=!1);let{value:y}=m.target;d.userValue=y,d.lastCommittedValue!==y&&((E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:d.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}})),p(m)}),(r=this.data.actions)!=null&&r.Keystroke&&n.addEventListener("beforeinput",m=>{var R;d.lastCommittedValue=null;let{data:y,target:v}=m,{value:E,selectionStart:S,selectionEnd:C}=v,_=S,T=C;switch(m.inputType){case"deleteWordBackward":{let I=E.substring(0,S).match(/\w*[^\w]*$/);I&&(_-=I[0].length);break}case"deleteWordForward":{let I=E.substring(S).match(/^[^\w]*\w*/);I&&(T+=I[0].length);break}case"deleteContentBackward":S===C&&(_-=1);break;case"deleteContentForward":S===C&&(T+=1);break}m.preventDefault(),(R=this.linkService.eventBus)==null||R.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,change:y||"",willCommit:!1,selStart:_,selEnd:T}})}),this._setEventListeners(n,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(h&&n.addEventListener("blur",h),this.data.comb){let m=(this.data.rect[2]-this.data.rect[0])/l;n.classList.add("comb"),n.style.letterSpacing=`calc(${m}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},Zw=class extends us{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}},jw=class extends us{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,n=t.id,s=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(n,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let r=document.createElement("input");return Qo.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=Gh,r.addEventListener("change",o=>{let{name:a,checked:l}=o.target;for(let c of this._getElementsByName(a,n)){let d=l&&c.exportValue===t.exportValue;c.domElement&&(c.domElement.checked=d),e.setValue(c.id,{value:d})}e.setValue(n,{value:l})}),r.addEventListener("resetform",o=>{let a=t.defaultFieldValue||"Off";o.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{let a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(n,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},Lg=class extends us{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,t=this.data,n=t.id,s=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(n,{value:s})),s)for(let o of this._getElementsByName(t.fieldName,n))e.setValue(o.id,{value:!1});let r=document.createElement("input");if(Qo.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.tabIndex=Gh,r.addEventListener("change",o=>{let{name:a,checked:l}=o.target;for(let c of this._getElementsByName(a,n))e.setValue(c.id,{value:!1});e.setValue(n,{value:l})}),r.addEventListener("resetform",o=>{let a=t.defaultFieldValue;o.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){let o=t.buttonValue;r.addEventListener("updatefromsandbox",a=>{let l={value:c=>{let d=o===c.detail.value;for(let h of this._getElementsByName(c.target.name)){let p=d&&h.id===n;h.domElement&&(h.domElement.checked=p),e.setValue(h.id,{value:p})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},Qw=class extends Fg{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}},eS=class extends us{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");Qo.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=Gh;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",d=>{let h=this.data.defaultFieldValue;for(let p of s.options)p.selected=p.value===h});for(let d of this.data.options){let h=document.createElement("option");h.textContent=d.displayValue,h.value=d.exportValue,n.value.includes(d.exportValue)&&(h.setAttribute("selected",!0),r=!1),s.append(h)}let o=null;if(r){let d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),s.prepend(d),o=()=>{d.remove(),s.removeEventListener("input",o),o=null},s.addEventListener("input",o)}let a=d=>{let h=d?"value":"textContent",{options:p,multiple:m}=s;return m?Array.prototype.filter.call(p,y=>y.selected).map(y=>y[h]):p.selectedIndex===-1?null:p[p.selectedIndex][h]},l=a(!1),c=d=>{let h=d.target.options;return Array.prototype.map.call(h,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",d=>{let h={value(p){o==null||o();let m=p.detail.value,y=new Set(Array.isArray(m)?m:[m]);for(let v of s.options)v.selected=y.has(v.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(p){s.multiple=!0},remove(p){let m=s.options,y=p.detail.remove;m[y].selected=!1,s.remove(y),m.length>0&&Array.prototype.findIndex.call(m,E=>E.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:a(!0),items:c(p)}),l=a(!1)},clear(p){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(p){let{index:m,displayValue:y,exportValue:v}=p.detail.insert,E=s.children[m],S=document.createElement("option");S.textContent=y,S.value=v,E?E.before(S):s.append(S),e.setValue(t,{value:a(!0),items:c(p)}),l=a(!1)},items(p){let{items:m}=p.detail;for(;s.length!==0;)s.remove(0);for(let y of m){let{displayValue:v,exportValue:E}=y,S=document.createElement("option");S.textContent=v,S.value=E,s.append(S)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:a(!0),items:c(p)}),l=a(!1)},indices(p){let m=new Set(p.detail.indices);for(let y of p.target.options)y.selected=m.has(y.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(h,d)}),s.addEventListener("input",d=>{var m;let h=a(!0),p=a(!1);e.setValue(t,{value:h}),d.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:p,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):s.addEventListener("input",function(d){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}},_d=class extends De{constructor(e){let{data:t,elements:n}=e;super(e,{isRenderable:De._hasPopupData(t)}),this.elements=n,this.popup=null}render(){this.container.classList.add("popupAnnotation");let e=this.popup=new tS({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let n of this.elements)n.popup=e,n.container.ariaHasPopup="dialog",t.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(n=>`${qS}${n}`).join(",")),this.container}},Il,Gm,Vm,Dl,bo,Te,ji,Pl,Vu,$u,Ml,Qi,Nn,es,zu,ts,qu,Eo,wo,kl,tg,Wu,nS,$m,oR,zm,aR,qm,lR,Wm,cR,Nl,ng,Fl,ig,Yu,iS,tS=class{constructor({container:e,color:t,elements:n,titleObj:s,modificationDate:r,contentsObj:o,richText:a,parent:l,rect:c,parentRect:d,open:h}){b(this,kl);b(this,Wu);b(this,$m);b(this,zm);b(this,qm);b(this,Wm);b(this,Nl);b(this,Fl);b(this,Yu);b(this,Il,A(this,qm,lR).bind(this));b(this,Gm,A(this,Yu,iS).bind(this));b(this,Vm,A(this,Fl,ig).bind(this));b(this,Dl,A(this,Nl,ng).bind(this));b(this,bo,null);b(this,Te,null);b(this,ji,null);b(this,Pl,null);b(this,Vu,null);b(this,$u,null);b(this,Ml,null);b(this,Qi,!1);b(this,Nn,null);b(this,es,null);b(this,zu,null);b(this,ts,null);b(this,qu,null);b(this,Eo,null);b(this,wo,!1);var p;w(this,Te,e),w(this,qu,s),w(this,ji,o),w(this,ts,a),w(this,$u,l),w(this,bo,t),w(this,zu,c),w(this,Ml,d),w(this,Vu,n),w(this,Pl,pd.toDateObject(r)),this.trigger=n.flatMap(m=>m.getElementsToTriggerPopup());for(let m of this.trigger)m.addEventListener("click",u(this,Dl)),m.addEventListener("mouseenter",u(this,Vm)),m.addEventListener("mouseleave",u(this,Gm)),m.classList.add("popupTriggerArea");for(let m of n)(p=m.container)==null||p.addEventListener("keydown",u(this,Il));u(this,Te).hidden=!0,h&&A(this,Nl,ng).call(this)}render(){if(u(this,Nn))return;let e=w(this,Nn,document.createElement("div"));if(e.className="popup",u(this,bo)){let r=e.style.outlineColor=G.makeHexColor(...u(this,bo));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`:e.style.backgroundColor=G.makeHexColor(...u(this,bo).map(a=>Math.floor(.7*(255-a)+a)))}let t=document.createElement("span");t.className="header";let n=document.createElement("h1");if(t.append(n),{dir:n.dir,str:n.textContent}=u(this,qu),e.append(t),u(this,Pl)){let r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:u(this,Pl).valueOf()})),t.append(r)}let s=u(this,kl,tg);if(s)Ng.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{let r=this._formatContents(u(this,ji));e.append(r)}u(this,Te).append(e)}_formatContents({str:e,dir:t}){let n=document.createElement("p");n.classList.add("popupContent"),n.dir=t;let s=e.split(/(?:\r\n?|\n)/);for(let r=0,o=s.length;r<o;++r){let a=s[r];n.append(document.createTextNode(a)),r<o-1&&n.append(document.createElement("br"))}return n}updateEdited({rect:e,popupContent:t}){var n;u(this,Eo)||w(this,Eo,{contentsObj:u(this,ji),richText:u(this,ts)}),e&&w(this,es,null),t&&(w(this,ts,A(this,zm,aR).call(this,t)),w(this,ji,null)),(n=u(this,Nn))==null||n.remove(),w(this,Nn,null)}resetEdited(){var e;u(this,Eo)&&({contentsObj:vt(this,ji)._,richText:vt(this,ts)._}=u(this,Eo),w(this,Eo,null),(e=u(this,Nn))==null||e.remove(),w(this,Nn,null),w(this,es,null))}forceHide(){w(this,wo,this.isVisible),u(this,wo)&&(u(this,Te).hidden=!0)}maybeShow(){u(this,wo)&&(u(this,Nn)||A(this,Fl,ig).call(this),w(this,wo,!1),u(this,Te).hidden=!1)}get isVisible(){return u(this,Te).hidden===!1}};Il=new WeakMap,Gm=new WeakMap,Vm=new WeakMap,Dl=new WeakMap,bo=new WeakMap,Te=new WeakMap,ji=new WeakMap,Pl=new WeakMap,Vu=new WeakMap,$u=new WeakMap,Ml=new WeakMap,Qi=new WeakMap,Nn=new WeakMap,es=new WeakMap,zu=new WeakMap,ts=new WeakMap,qu=new WeakMap,Eo=new WeakMap,wo=new WeakMap,kl=new WeakSet,tg=function(){let e=u(this,ts),t=u(this,ji);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&u(this,ts).html||null},Wu=new WeakSet,nS=function(){var e,t,n;return((n=(t=(e=u(this,kl,tg))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.fontSize)||0},$m=new WeakSet,oR=function(){var e,t,n;return((n=(t=(e=u(this,kl,tg))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.color)||null},zm=new WeakSet,aR=function(e){let t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:u(this,$m,oR),fontSize:u(this,Wu,nS)?`calc(${u(this,Wu,nS)}px * var(--scale-factor))`:""}};for(let r of e.split(`
`))t.push({name:"span",value:r,attributes:s});return n},qm=new WeakSet,lR=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&u(this,Qi))&&A(this,Nl,ng).call(this)},Wm=new WeakSet,cR=function(){if(u(this,es)!==null)return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:s,pageY:r}}}=u(this,$u),o=!!u(this,Ml),a=o?u(this,Ml):u(this,zu);for(let y of u(this,Vu))if(!a||G.intersect(y.data.rect,a)!==null){a=y.data.rect,o=!0;break}let l=G.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),d=o?a[2]-a[0]+5:0,h=l[0]+d,p=l[1];w(this,es,[100*(h-s)/t,100*(p-r)/n]);let{style:m}=u(this,Te);m.left=`${u(this,es)[0]}%`,m.top=`${u(this,es)[1]}%`},Nl=new WeakSet,ng=function(){w(this,Qi,!u(this,Qi)),u(this,Qi)?(A(this,Fl,ig).call(this),u(this,Te).addEventListener("click",u(this,Dl)),u(this,Te).addEventListener("keydown",u(this,Il))):(A(this,Yu,iS).call(this),u(this,Te).removeEventListener("click",u(this,Dl)),u(this,Te).removeEventListener("keydown",u(this,Il)))},Fl=new WeakSet,ig=function(){u(this,Nn)||this.render(),this.isVisible?u(this,Qi)&&u(this,Te).classList.add("focused"):(A(this,Wm,cR).call(this),u(this,Te).hidden=!1,u(this,Te).style.zIndex=parseInt(u(this,Te).style.zIndex)+1e3)},Yu=new WeakSet,iS=function(){u(this,Te).classList.remove("focused"),!(u(this,Qi)||!this.isVisible)&&(u(this,Te).hidden=!0,u(this,Te).style.zIndex=parseInt(u(this,Te).style.zIndex)-1e3)};var Og=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=j.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(let t of this.textContent){let n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Ku,sS=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Ku,null)}render(){this.container.classList.add("lineAnnotation");let t=this.data,{width:n,height:s}=rr(t.rect),r=this.svgFactory.create(n,s,!0),o=w(this,Ku,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Ku)}addHighlightArea(){this.container.classList.add("highlightArea")}};Ku=new WeakMap;var Ju,rS=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Ju,null)}render(){this.container.classList.add("squareAnnotation");let t=this.data,{width:n,height:s}=rr(t.rect),r=this.svgFactory.create(n,s,!0),o=t.borderStyle.width,a=w(this,Ju,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",o/2),a.setAttribute("y",o/2),a.setAttribute("width",n-o),a.setAttribute("height",s-o),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Ju)}addHighlightArea(){this.container.classList.add("highlightArea")}};Ju=new WeakMap;var Xu,oS=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Xu,null)}render(){this.container.classList.add("circleAnnotation");let t=this.data,{width:n,height:s}=rr(t.rect),r=this.svgFactory.create(n,s,!0),o=t.borderStyle.width,a=w(this,Xu,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",n/2),a.setAttribute("cy",s/2),a.setAttribute("rx",n/2-o/2),a.setAttribute("ry",s/2-o/2),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Xu)}addHighlightArea(){this.container.classList.add("highlightArea")}};Xu=new WeakMap;var Zu,Ug=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Zu,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,vertices:n,borderStyle:s,popupRef:r}}=this;if(!n)return this.container;let{width:o,height:a}=rr(t),l=this.svgFactory.create(o,a,!0),c=[];for(let h=0,p=n.length;h<p;h+=2){let m=n[h]-t[0],y=t[3]-n[h+1];c.push(`${m},${y}`)}c=c.join(" ");let d=w(this,Zu,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",c),d.setAttribute("stroke-width",s.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),l.append(d),this.container.append(l),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Zu)}addHighlightArea(){this.container.classList.add("highlightArea")}};Zu=new WeakMap;var aS=class extends Ug{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},lS=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},ju,So,Qu,cS,Td=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Qu);b(this,ju,null);b(this,So,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?j.HIGHLIGHT:j.INK}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,rotation:n,inkLists:s,borderStyle:r,popupRef:o}}=this,{transform:a,width:l,height:c}=A(this,Qu,cS).call(this,n,t),d=this.svgFactory.create(l,c,!0),h=w(this,ju,this.svgFactory.createElement("svg:g"));d.append(h),h.setAttribute("stroke-width",r.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",a);for(let p=0,m=s.length;p<m;p++){let y=this.svgFactory.createElement(this.svgElementName);u(this,So).push(y),y.setAttribute("points",s[p].join(",")),h.append(y)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);let{thickness:n,points:s,rect:r}=t,o=u(this,ju);if(n>=0&&o.setAttribute("stroke-width",n||1),s)for(let a=0,l=u(this,So).length;a<l;a++)u(this,So)[a].setAttribute("points",s[a].join(","));if(r){let{transform:a,width:l,height:c}=A(this,Qu,cS).call(this,this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${l} ${c}`),o.setAttribute("transform",a)}}getElementsToTriggerPopup(){return u(this,So)}addHighlightArea(){this.container.classList.add("highlightArea")}};ju=new WeakMap,So=new WeakMap,Qu=new WeakSet,cS=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};var Hg=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=j.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},dS=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},uS=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},hS=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},Bg=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=j.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},eh,th,pS,fS=class extends De{constructor(t){var s;super(t,{isRenderable:!0});b(this,th);b(this,eh,null);let{file:n}=this.data;this.filename=n.filename,this.content=n.content,(s=this.linkService.eventBus)==null||s.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:t,data:n}=this,s;n.hasAppearance||n.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),s.addEventListener("dblclick",A(this,th,pS).bind(this)),w(this,eh,s);let{isMac:r}=it.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&A(this,th,pS).call(this)}),!n.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return u(this,eh)}addHighlightArea(){this.container.classList.add("highlightArea")}};eh=new WeakMap,th=new WeakSet,pS=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var nh,Ao,Co,ih,Ym,dR,sh,mS,gS=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:s,page:r,viewport:o,structTreeLayer:a}){b(this,Ym);b(this,sh);b(this,nh,null);b(this,Ao,null);b(this,Co,new Map);b(this,ih,null);this.div=e,w(this,nh,t),w(this,Ao,n),w(this,ih,a||null),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return u(this,Co).size>0}async render(e){var o;let{annotations:t}=e,n=this.div;Xo(n,this.viewport);let s=new Map,r={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Cd,annotationStorage:e.annotationStorage||new Ed,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let a of t){if(a.noHTML)continue;let l=a.annotationType===Ue.POPUP;if(l){let h=s.get(a.id);if(!h)continue;r.elements=h}else{let{width:h,height:p}=rr(a.rect);if(h<=0||p<=0)continue}r.data=a;let c=Yw.create(r);if(!c.isRenderable)continue;if(!l&&a.popupRef){let h=s.get(a.popupRef);h?h.push(c):s.set(a.popupRef,[c])}let d=c.render();a.hidden&&(d.style.visibility="hidden"),await A(this,Ym,dR).call(this,d,a.id),c._isEditable&&(u(this,Co).set(c.data.id,c),(o=this._annotationEditorUIManager)==null||o.renderAnnotationElement(c))}A(this,sh,mS).call(this)}update({viewport:e}){let t=this.div;this.viewport=e,Xo(t,{rotation:e.rotation}),A(this,sh,mS).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(u(this,Co).values())}getEditableAnnotation(e){return u(this,Co).get(e)}};nh=new WeakMap,Ao=new WeakMap,Co=new WeakMap,ih=new WeakMap,Ym=new WeakSet,dR=async function(e,t){var o,a;let n=e.firstChild||e,s=n.id=`${qS}${t}`,r=await((o=u(this,ih))==null?void 0:o.getAriaAttributes(s));if(r)for(let[l,c]of r)n.setAttribute(l,c);this.div.append(e),(a=u(this,nh))==null||a.moveElementInDOM(this.div,e,n,!1)},sh=new WeakSet,mS=function(){if(!u(this,Ao))return;let e=this.div;for(let[t,n]of u(this,Ao)){let s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;n.className="annotationContent";let{firstChild:r}=s;r?r.nodeName==="CANVAS"?r.replaceWith(n):r.classList.contains("annotationContent")?r.after(n):r.before(n):s.append(n)}u(this,Ao).clear()};var Up=/\r\n?|\n/g,Fn,qt,rh,_o,Wt,Km,uR,Jm,hR,Xm,fR,Ll,sg,Ol,rg,Ul,og,Zm,pR,oh,vS,jm,gR,pe=class pe extends Ce{constructor(t){super({...t,name:"freeTextEditor"});b(this,Km);b(this,Jm);b(this,Xm);b(this,Ll);b(this,Ul);b(this,Zm);b(this,jm);b(this,Fn,void 0);b(this,qt,"");b(this,rh,`${this.id}-editor`);b(this,_o,null);b(this,Wt,void 0);w(this,Fn,t.color||pe._defaultColor||Ce._defaultLineColor),w(this,Wt,t.fontSize||pe._defaultFontSize)}static get _keyboardManager(){let t=pe.prototype,n=o=>o.isEmpty(),s=jo.TRANSLATE_SMALL,r=jo.TRANSLATE_BIG;return se(this,"_keyboardManager",new Zo([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:n}]]))}static initialize(t,n){Ce.initialize(t,n);let s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case oe.FREETEXT_SIZE:pe._defaultFontSize=n;break;case oe.FREETEXT_COLOR:pe._defaultColor=n;break}}updateParams(t,n){switch(t){case oe.FREETEXT_SIZE:A(this,Km,uR).call(this,n);break;case oe.FREETEXT_COLOR:A(this,Jm,hR).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[oe.FREETEXT_SIZE,pe._defaultFontSize],[oe.FREETEXT_COLOR,pe._defaultColor||Ce._defaultLineColor]]}get propertiesToUpdate(){return[[oe.FREETEXT_SIZE,u(this,Wt)],[oe.FREETEXT_COLOR,u(this,Fn)]]}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){let t=this.parentScale;return[-pe._internalPadding*t,-(pe._internalPadding+u(this,Wt))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(j.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),w(this,_o,new AbortController);let t=this._uiManager.combinedSignal(u(this,_o));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",u(this,rh)),this._isDraggable=!0,(t=u(this,_o))==null||t.abort(),w(this,_o,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var n;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let t=u(this,qt),n=w(this,qt,A(this,Xm,fR).call(this).trimEnd());if(t===n)return;let s=r=>{if(w(this,qt,r),!r){this.remove();return}A(this,Ul,og).call(this),this._uiManager.rebuild(this),A(this,Ll,sg).call(this)};this.addCommands({cmd:()=>{s(n)},undo:()=>{s(t)},mustExec:!1}),A(this,Ll,sg).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){pe._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,n;this.width&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",u(this,rh)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:s}=this.editorDiv;if(s.fontSize=`calc(${u(this,Wt)}px * var(--scale-factor))`,s.color=u(this,Fn),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),vg(this,this.div,["dblclick","keydown"]),this.width){let[r,o]=this.parentDimensions;if(this.annotationElementId){let{position:a}=this._initialData,[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);let[d,h]=this.pageDimensions,[p,m]=this.pageTranslation,y,v;switch(this.rotation){case 0:y=t+(a[0]-p)/d,v=n+this.height-(a[1]-m)/h;break;case 90:y=t+(a[0]-p)/d,v=n-(a[1]-m)/h,[l,c]=[c,-l];break;case 180:y=t-this.width+(a[0]-p)/d,v=n-(a[1]-m)/h,[l,c]=[-l,-c];break;case 270:y=t+(a[0]-p-this.height*h)/d,v=n+(a[1]-m-this.width*d)/h,[l,c]=[-c,l];break}this.setAt(y*r,v*o,l,c)}else this.setAt(t*r,n*o,this.width*r,this.height*o);A(this,Ul,og).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var y,v,E;let n=t.clipboardData||window.clipboardData,{types:s}=n;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();let r=A(y=pe,oh,vS).call(y,n.getData("text")||"").replaceAll(Up,`
`);if(!r)return;let o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();let a=o.getRangeAt(0);if(!r.includes(`
`)){a.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}let{startContainer:l,startOffset:c}=a,d=[],h=[];if(l.nodeType===Node.TEXT_NODE){let S=l.parentElement;if(h.push(l.nodeValue.slice(c).replaceAll(Up,"")),S!==this.editorDiv){let C=d;for(let _ of this.editorDiv.childNodes){if(_===S){C=h;continue}C.push(A(v=pe,Ol,rg).call(v,_))}}d.push(l.nodeValue.slice(0,c).replaceAll(Up,""))}else if(l===this.editorDiv){let S=d,C=0;for(let _ of this.editorDiv.childNodes)C++===c&&(S=h),S.push(A(E=pe,Ol,rg).call(E,_))}w(this,qt,`${d.join(`
`)}${r}${h.join(`
`)}`),A(this,Ul,og).call(this);let p=new Range,m=d.reduce((S,C)=>S+C.length,0);for(let{firstChild:S}of this.editorDiv.childNodes)if(S.nodeType===Node.TEXT_NODE){let C=S.nodeValue.length;if(m<=C){p.setStart(S,m),p.setEnd(S,m);break}m-=C}o.removeAllRanges(),o.addRange(p)}get contentDiv(){return this.editorDiv}static async deserialize(t,n,s){var a;let r=null;if(t instanceof Og){let{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:d,rotation:h,id:p,popupRef:m},textContent:y,textPosition:v,parent:{page:{pageNumber:E}}}=t;if(!y||y.length===0)return null;r=t={annotationType:j.FREETEXT,color:Array.from(c),fontSize:l,value:y.join(`
`),position:v,pageIndex:E-1,rect:d.slice(0),rotation:h,id:p,deleted:!1,popupRef:m}}let o=await super.deserialize(t,n,s);return w(o,Wt,t.fontSize),w(o,Fn,G.makeHexColor(...t.color)),w(o,qt,A(a=pe,oh,vS).call(a,t.value)),o.annotationElementId=t.id||null,o._initialData=r,o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let n=pe._internalPadding*this.parentScale,s=this.getRect(n,n),r=Ce._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:u(this,Fn)),o={annotationType:j.FREETEXT,color:r,fontSize:u(this,Wt),value:A(this,Zm,pR).call(this),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?o:this.annotationElementId&&!A(this,jm,gR).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(t){let n=super.renderAnnotationElement(t);if(this.deleted)return n;let{style:s}=n;s.fontSize=`calc(${u(this,Wt)}px * var(--scale-factor))`,s.color=u(this,Fn),n.replaceChildren();for(let o of u(this,qt).split(`
`)){let a=document.createElement("div");a.append(o?document.createTextNode(o):document.createElement("br")),n.append(a)}let r=pe._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(r,r),popupContent:u(this,qt)}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Fn=new WeakMap,qt=new WeakMap,rh=new WeakMap,_o=new WeakMap,Wt=new WeakMap,Km=new WeakSet,uR=function(t){let n=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--scale-factor))`,this.translate(0,-(r-u(this,Wt))*this.parentScale),w(this,Wt,r),A(this,Ll,sg).call(this)},s=u(this,Wt);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:oe.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Jm=new WeakSet,hR=function(t){let n=r=>{w(this,Fn,this.editorDiv.style.color=r)},s=u(this,Fn);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:oe.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Xm=new WeakSet,fR=function(){var s;let t=[];this.editorDiv.normalize();let n=null;for(let r of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(A(s=pe,Ol,rg).call(s,r)),n=r);return t.join(`
`)},Ll=new WeakSet,sg=function(){let[t,n]=this.parentDimensions,s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{let{currentLayer:r,div:o}=this,a=o.style.display,l=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),s=o.getBoundingClientRect(),o.remove(),o.style.display=a,o.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/n):(this.width=s.height/t,this.height=s.width/n),this.fixAndSetPosition()},Ol=new WeakSet,rg=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Up,"")},Ul=new WeakSet,og=function(){if(this.editorDiv.replaceChildren(),!!u(this,qt))for(let t of u(this,qt).split(`
`)){let n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},Zm=new WeakSet,pR=function(){return u(this,qt).replaceAll("\xA0"," ")},oh=new WeakSet,vS=function(t){return t.replaceAll(" ","\xA0")},jm=new WeakSet,gR=function(t){let{value:n,fontSize:s,color:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||t.value!==n||t.fontSize!==s||t.color.some((a,l)=>a!==r[l])||t.pageIndex!==o},b(pe,Ol),b(pe,oh),Y(pe,"_freeTextDefaultContent",""),Y(pe,"_internalPadding",0),Y(pe,"_defaultColor",null),Y(pe,"_defaultFontSize",10),Y(pe,"_type","freetext"),Y(pe,"_editorType",j.FREETEXT);var yS=pe,H=class{toSVGPath(){ge("Abstract method `toSVGPath` must be implemented.")}get box(){ge("Abstract getter `box` must be implemented.")}serialize(e,t){ge("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,s,r,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a]*s,o[a+1]=n+e[a+1]*r;return o}static _rescaleAndSwap(e,t,n,s,r,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a+1]*s,o[a+1]=n+e[a]*r;return o}static _translate(e,t,n,s){s||(s=new Float32Array(e.length));for(let r=0,o=e.length;r<o;r+=2)s[r]=t+e[r],s[r+1]=n+e[r+1];return s}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,s,r){switch(r){case 90:return[1-t/n,e/s];case 180:return[1-e/n,1-t/s];case 270:return[t/n,1-e/s];default:return[e/n,t/s]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,s,r,o){return[(e+5*n)/6,(t+5*s)/6,(5*n+r)/6,(5*s+o)/6,(n+r)/2,(s+o)/2]}};Y(H,"PRECISION",1e-4);var Yt,Ln,Hl,Bl,ci,ie,To,xo,ah,lh,Gl,Vl,Ws,ch,Qm,ey,Ro,od,ty,mR,ny,yR,iy,vR,sy,bR,ry,ER,oy,wR,Li=class Li{constructor({x:e,y:t},n,s,r,o,a=0){b(this,Ro);b(this,ty);b(this,ny);b(this,iy);b(this,sy);b(this,ry);b(this,oy);b(this,Yt,void 0);b(this,Ln,[]);b(this,Hl,void 0);b(this,Bl,void 0);b(this,ci,[]);b(this,ie,new Float32Array(18));b(this,To,void 0);b(this,xo,void 0);b(this,ah,void 0);b(this,lh,void 0);b(this,Gl,void 0);b(this,Vl,void 0);b(this,Ws,[]);w(this,Yt,n),w(this,Vl,r*s),w(this,Bl,o),u(this,ie).set([NaN,NaN,NaN,NaN,e,t],6),w(this,Hl,a),w(this,lh,u(Li,ch)*s),w(this,ah,u(Li,ey)*s),w(this,Gl,s),u(this,Ws).push(e,t)}isEmpty(){return isNaN(u(this,ie)[8])}add({x:e,y:t}){var N;w(this,To,e),w(this,xo,t);let[n,s,r,o]=u(this,Yt),[a,l,c,d]=u(this,ie).subarray(8,12),h=e-c,p=t-d,m=Math.hypot(h,p);if(m<u(this,ah))return!1;let y=m-u(this,lh),v=y/m,E=v*h,S=v*p,C=a,_=l;a=c,l=d,c+=E,d+=S,(N=u(this,Ws))==null||N.push(e,t);let T=-S/y,R=E/y,I=T*u(this,Vl),D=R*u(this,Vl);return u(this,ie).set(u(this,ie).subarray(2,8),0),u(this,ie).set([c+I,d+D],4),u(this,ie).set(u(this,ie).subarray(14,18),12),u(this,ie).set([c-I,d-D],16),isNaN(u(this,ie)[6])?(u(this,ci).length===0&&(u(this,ie).set([a+I,l+D],2),u(this,ci).push(NaN,NaN,NaN,NaN,(a+I-n)/r,(l+D-s)/o),u(this,ie).set([a-I,l-D],14),u(this,Ln).push(NaN,NaN,NaN,NaN,(a-I-n)/r,(l-D-s)/o)),u(this,ie).set([C,_,a,l,c,d],6),!this.isEmpty()):(u(this,ie).set([C,_,a,l,c,d],6),Math.abs(Math.atan2(_-l,C-a)-Math.atan2(S,E))<Math.PI/2?([a,l,c,d]=u(this,ie).subarray(2,6),u(this,ci).push(NaN,NaN,NaN,NaN,((a+c)/2-n)/r,((l+d)/2-s)/o),[a,l,C,_]=u(this,ie).subarray(14,18),u(this,Ln).push(NaN,NaN,NaN,NaN,((C+a)/2-n)/r,((_+l)/2-s)/o),!0):([C,_,a,l,c,d]=u(this,ie).subarray(0,6),u(this,ci).push(((C+5*a)/6-n)/r,((_+5*l)/6-s)/o,((5*a+c)/6-n)/r,((5*l+d)/6-s)/o,((a+c)/2-n)/r,((l+d)/2-s)/o),[c,d,a,l,C,_]=u(this,ie).subarray(12,18),u(this,Ln).push(((C+5*a)/6-n)/r,((_+5*l)/6-s)/o,((5*a+c)/6-n)/r,((5*l+d)/6-s)/o,((a+c)/2-n)/r,((l+d)/2-s)/o),!0))}toSVGPath(){if(this.isEmpty())return"";let e=u(this,ci),t=u(this,Ln);if(isNaN(u(this,ie)[6])&&!this.isEmpty())return A(this,ty,mR).call(this);let n=[];n.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?n.push(`L${e[s+4]} ${e[s+5]}`):n.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);A(this,iy,vR).call(this,n);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?n.push(`L${t[s+4]} ${t[s+5]}`):n.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return A(this,ny,yR).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,s,r,o){return new Vg(e,t,n,s,r,o)}getOutlines(){var h,p;let e=u(this,ci),t=u(this,Ln),n=u(this,ie),[s,r,o,a]=u(this,Yt),l=new Float32Array(((p=(h=u(this,Ws))==null?void 0:h.length)!=null?p:0)+2);for(let m=0,y=l.length-2;m<y;m+=2)l[m]=(u(this,Ws)[m]-s)/o,l[m+1]=(u(this,Ws)[m+1]-r)/a;if(l[l.length-2]=(u(this,To)-s)/o,l[l.length-1]=(u(this,xo)-r)/a,isNaN(n[6])&&!this.isEmpty())return A(this,sy,bR).call(this,l);let c=new Float32Array(u(this,ci).length+24+u(this,Ln).length),d=e.length;for(let m=0;m<d;m+=2){if(isNaN(e[m])){c[m]=c[m+1]=NaN;continue}c[m]=e[m],c[m+1]=e[m+1]}d=A(this,oy,wR).call(this,c,d);for(let m=t.length-6;m>=6;m-=6)for(let y=0;y<6;y+=2){if(isNaN(t[m+y])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=t[m+y],c[d+1]=t[m+y+1],d+=2}return A(this,ry,ER).call(this,c,d),this.newFreeDrawOutline(c,l,u(this,Yt),u(this,Gl),u(this,Hl),u(this,Bl))}};Yt=new WeakMap,Ln=new WeakMap,Hl=new WeakMap,Bl=new WeakMap,ci=new WeakMap,ie=new WeakMap,To=new WeakMap,xo=new WeakMap,ah=new WeakMap,lh=new WeakMap,Gl=new WeakMap,Vl=new WeakMap,Ws=new WeakMap,ch=new WeakMap,Qm=new WeakMap,ey=new WeakMap,Ro=new WeakSet,od=function(){let e=u(this,ie).subarray(4,6),t=u(this,ie).subarray(16,18),[n,s,r,o]=u(this,Yt);return[(u(this,To)+(e[0]-t[0])/2-n)/r,(u(this,xo)+(e[1]-t[1])/2-s)/o,(u(this,To)+(t[0]-e[0])/2-n)/r,(u(this,xo)+(t[1]-e[1])/2-s)/o]},ty=new WeakSet,mR=function(){let[e,t,n,s]=u(this,Yt),[r,o,a,l]=A(this,Ro,od).call(this);return`M${(u(this,ie)[2]-e)/n} ${(u(this,ie)[3]-t)/s} L${(u(this,ie)[4]-e)/n} ${(u(this,ie)[5]-t)/s} L${r} ${o} L${a} ${l} L${(u(this,ie)[16]-e)/n} ${(u(this,ie)[17]-t)/s} L${(u(this,ie)[14]-e)/n} ${(u(this,ie)[15]-t)/s} Z`},ny=new WeakSet,yR=function(e){let t=u(this,Ln);e.push(`L${t[4]} ${t[5]} Z`)},iy=new WeakSet,vR=function(e){let[t,n,s,r]=u(this,Yt),o=u(this,ie).subarray(4,6),a=u(this,ie).subarray(16,18),[l,c,d,h]=A(this,Ro,od).call(this);e.push(`L${(o[0]-t)/s} ${(o[1]-n)/r} L${l} ${c} L${d} ${h} L${(a[0]-t)/s} ${(a[1]-n)/r}`)},sy=new WeakSet,bR=function(e){let t=u(this,ie),[n,s,r,o]=u(this,Yt),[a,l,c,d]=A(this,Ro,od).call(this),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-n)/r,(t[3]-s)/o,NaN,NaN,NaN,NaN,(t[4]-n)/r,(t[5]-s)/o,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(t[16]-n)/r,(t[17]-s)/o,NaN,NaN,NaN,NaN,(t[14]-n)/r,(t[15]-s)/o],0),this.newFreeDrawOutline(h,e,u(this,Yt),u(this,Gl),u(this,Hl),u(this,Bl))},ry=new WeakSet,ER=function(e,t){let n=u(this,Ln);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},oy=new WeakSet,wR=function(e,t){let n=u(this,ie).subarray(4,6),s=u(this,ie).subarray(16,18),[r,o,a,l]=u(this,Yt),[c,d,h,p]=A(this,Ro,od).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-r)/a,(n[1]-o)/l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,h,p,NaN,NaN,NaN,NaN,(s[0]-r)/a,(s[1]-o)/l],t),t+=24},b(Li,ch,8),b(Li,Qm,2),b(Li,ey,u(Li,ch)+u(Li,Qm));var Gg=Li,$l,Io,ns,dh,Kt,uh,Ie,ay,SR,Vg=class extends H{constructor(t,n,s,r,o,a){super();b(this,ay);b(this,$l,void 0);b(this,Io,new Float32Array(4));b(this,ns,void 0);b(this,dh,void 0);b(this,Kt,void 0);b(this,uh,void 0);b(this,Ie,void 0);w(this,Ie,t),w(this,Kt,n),w(this,$l,s),w(this,uh,r),w(this,ns,o),w(this,dh,a),this.lastPoint=[NaN,NaN],A(this,ay,SR).call(this,a);let[l,c,d,h]=u(this,Io);for(let p=0,m=t.length;p<m;p+=2)t[p]=(t[p]-l)/d,t[p+1]=(t[p+1]-c)/h;for(let p=0,m=n.length;p<m;p+=2)n[p]=(n[p]-l)/d,n[p+1]=(n[p+1]-c)/h}toSVGPath(){let t=[`M${u(this,Ie)[4]} ${u(this,Ie)[5]}`];for(let n=6,s=u(this,Ie).length;n<s;n+=6){if(isNaN(u(this,Ie)[n])){t.push(`L${u(this,Ie)[n+4]} ${u(this,Ie)[n+5]}`);continue}t.push(`C${u(this,Ie)[n]} ${u(this,Ie)[n+1]} ${u(this,Ie)[n+2]} ${u(this,Ie)[n+3]} ${u(this,Ie)[n+4]} ${u(this,Ie)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,s,r],o){let a=s-t,l=r-n,c,d;switch(o){case 0:c=H._rescale(u(this,Ie),t,r,a,-l),d=H._rescale(u(this,Kt),t,r,a,-l);break;case 90:c=H._rescaleAndSwap(u(this,Ie),t,n,a,l),d=H._rescaleAndSwap(u(this,Kt),t,n,a,l);break;case 180:c=H._rescale(u(this,Ie),s,n,-a,l),d=H._rescale(u(this,Kt),s,n,-a,l);break;case 270:c=H._rescaleAndSwap(u(this,Ie),s,r,-a,-l),d=H._rescaleAndSwap(u(this,Kt),s,r,-a,-l);break}return{outline:Array.from(c),points:[Array.from(d)]}}get box(){return u(this,Io)}newOutliner(t,n,s,r,o,a=0){return new Gg(t,n,s,r,o,a)}getNewOutline(t,n){let[s,r,o,a]=u(this,Io),[l,c,d,h]=u(this,$l),p=o*d,m=a*h,y=s*d+l,v=r*h+c,E=this.newOutliner({x:u(this,Kt)[0]*p+y,y:u(this,Kt)[1]*m+v},u(this,$l),u(this,uh),t,u(this,dh),n!=null?n:u(this,ns));for(let S=2;S<u(this,Kt).length;S+=2)E.add({x:u(this,Kt)[S]*p+y,y:u(this,Kt)[S+1]*m+v});return E.getOutlines()}};$l=new WeakMap,Io=new WeakMap,ns=new WeakMap,dh=new WeakMap,Kt=new WeakMap,uh=new WeakMap,Ie=new WeakMap,ay=new WeakSet,SR=function(t){let n=u(this,Ie),s=n[4],r=n[5],o=s,a=r,l=s,c=r,d=s,h=r,p=t?Math.max:Math.min;for(let y=6,v=n.length;y<v;y+=6){if(isNaN(n[y]))o=Math.min(o,n[y+4]),a=Math.min(a,n[y+5]),l=Math.max(l,n[y+4]),c=Math.max(c,n[y+5]),h<n[y+5]?(d=n[y+4],h=n[y+5]):h===n[y+5]&&(d=p(d,n[y+4]));else{let E=G.bezierBoundingBox(s,r,...n.slice(y,y+6));o=Math.min(o,E[0]),a=Math.min(a,E[1]),l=Math.max(l,E[2]),c=Math.max(c,E[3]),h<E[3]?(d=E[2],h=E[3]):h===E[3]&&(d=p(d,E[2]))}s=n[y+4],r=n[y+5]}let m=u(this,Io);m[0]=o-u(this,ns),m[1]=a-u(this,ns),m[2]=l-o+2*u(this,ns),m[3]=c-a+2*u(this,ns),this.lastPoint=[d,h]};var hh,fh,Ys,On,ly,AR,zl,ag,cy,CR,dy,_R,ph,bS,xd=class{constructor(e,t=0,n=0,s=!0){b(this,ly);b(this,zl);b(this,cy);b(this,dy);b(this,ph);b(this,hh,void 0);b(this,fh,void 0);b(this,Ys,[]);b(this,On,[]);let r=1/0,o=-1/0,a=1/0,l=-1/0,d=10**-4;for(let{x:S,y:C,width:_,height:T}of e){let R=Math.floor((S-t)/d)*d,I=Math.ceil((S+_+t)/d)*d,D=Math.floor((C-t)/d)*d,k=Math.ceil((C+T+t)/d)*d,N=[R,D,k,!0],F=[I,D,k,!1];u(this,Ys).push(N,F),r=Math.min(r,R),o=Math.max(o,I),a=Math.min(a,D),l=Math.max(l,k)}let h=o-r+2*n,p=l-a+2*n,m=r-n,y=a-n,v=u(this,Ys).at(s?-1:-2),E=[v[0],v[2]];for(let S of u(this,Ys)){let[C,_,T]=S;S[0]=(C-m)/h,S[1]=(_-y)/p,S[2]=(T-y)/p}w(this,hh,new Float32Array([m,y,h,p])),w(this,fh,E)}getOutlines(){u(this,Ys).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);let e=[];for(let t of u(this,Ys))t[3]?(e.push(...A(this,ph,bS).call(this,t)),A(this,cy,CR).call(this,t)):(A(this,dy,_R).call(this,t),e.push(...A(this,ph,bS).call(this,t)));return A(this,ly,AR).call(this,e)}};hh=new WeakMap,fh=new WeakMap,Ys=new WeakMap,On=new WeakMap,ly=new WeakSet,AR=function(e){let t=[],n=new Set;for(let o of e){let[a,l,c]=o;t.push([a,l,o],[a,c,o])}t.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=t.length;o<a;o+=2){let l=t[o][2],c=t[o+1][2];l.push(c),c.push(l),n.add(l),n.add(c)}let s=[],r;for(;n.size>0;){let o=n.values().next().value,[a,l,c,d,h]=o;n.delete(o);let p=a,m=l;for(r=[a,c],s.push(r);;){let y;if(n.has(d))y=d;else if(n.has(h))y=h;else break;n.delete(y),[a,l,c,d,h]=y,p!==a&&(r.push(p,m,a,m===l?l:c),p=a),m=m===l?c:l}r.push(p,m)}return new ES(s,u(this,hh),u(this,fh))},zl=new WeakSet,ag=function(e){let t=u(this,On),n=0,s=t.length-1;for(;n<=s;){let r=n+s>>1,o=t[r][0];if(o===e)return r;o<e?n=r+1:s=r-1}return s+1},cy=new WeakSet,CR=function([,e,t]){let n=A(this,zl,ag).call(this,e);u(this,On).splice(n,0,[e,t])},dy=new WeakSet,_R=function([,e,t]){let n=A(this,zl,ag).call(this,e);for(let s=n;s<u(this,On).length;s++){let[r,o]=u(this,On)[s];if(r!==e)break;if(r===e&&o===t){u(this,On).splice(s,1);return}}for(let s=n-1;s>=0;s--){let[r,o]=u(this,On)[s];if(r!==e)break;if(r===e&&o===t){u(this,On).splice(s,1);return}}},ph=new WeakSet,bS=function(e){let[t,n,s]=e,r=[[t,n,s]],o=A(this,zl,ag).call(this,s);for(let a=0;a<o;a++){let[l,c]=u(this,On)[a];for(let d=0,h=r.length;d<h;d++){let[,p,m]=r[d];if(!(c<=p||m<=l)){if(p>=l){if(m>c)r[d][1]=c;else{if(h===1)return[];r.splice(d,1),d--,h--}continue}r[d][2]=l,m>c&&r.push([t,c,m])}}}return r};var gh,ql,ES=class extends H{constructor(t,n,s){super();b(this,gh,void 0);b(this,ql,void 0);w(this,ql,t),w(this,gh,n),this.lastPoint=s}toSVGPath(){let t=[];for(let n of u(this,ql)){let[s,r]=n;t.push(`M${s} ${r}`);for(let o=2;o<n.length;o+=2){let a=n[o],l=n[o+1];a===s?(t.push(`V${l}`),r=l):l===r&&(t.push(`H${a}`),s=a)}t.push("Z")}return t.join(" ")}serialize([t,n,s,r],o){let a=[],l=s-t,c=r-n;for(let d of u(this,ql)){let h=new Array(d.length);for(let p=0;p<d.length;p+=2)h[p]=t+d[p]*l,h[p+1]=r-d[p+1]*c;a.push(h)}return a}get box(){return u(this,gh)}get classNamesForOutlining(){return["highlightOutline"]}};gh=new WeakMap,ql=new WeakMap;var Rd=class extends Gg{newFreeDrawOutline(e,t,n,s,r,o){return new wS(e,t,n,s,r,o)}},wS=class extends Vg{newOutliner(e,t,n,s,r,o=0){return new Rd(e,t,n,s,r,o)}},Un,Do,Wl,Be,mh,Yl,yh,vh,Ks,Hn,Kl,bh,Eh,SS,wh,AS,Sh,CS,is,Tr,uy,TR,di,ws,Dt=class Dt{constructor({editor:e=null,uiManager:t=null}){b(this,Eh);b(this,wh);b(this,Sh);b(this,is);b(this,uy);b(this,di);b(this,Un,null);b(this,Do,null);b(this,Wl,void 0);b(this,Be,null);b(this,mh,!1);b(this,Yl,!1);b(this,yh,null);b(this,vh,void 0);b(this,Ks,null);b(this,Hn,null);b(this,Kl,void 0);var n;e?(w(this,Yl,!1),w(this,Kl,oe.HIGHLIGHT_COLOR),w(this,yh,e)):(w(this,Yl,!0),w(this,Kl,oe.HIGHLIGHT_DEFAULT_COLOR)),w(this,Hn,(e==null?void 0:e._uiManager)||t),w(this,vh,u(this,Hn)._eventBus),w(this,Wl,(e==null?void 0:e.color)||((n=u(this,Hn))==null?void 0:n.highlightColors.values().next().value)||"#FFFF98"),u(Dt,bh)||w(Dt,bh,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return se(this,"_keyboardManager",new Zo([[["Escape","mac+Escape"],Dt.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Dt.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Dt.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Dt.prototype._moveToPrevious],[["Home","mac+Home"],Dt.prototype._moveToBeginning],[["End","mac+End"],Dt.prototype._moveToEnd]]))}renderButton(){let e=w(this,Un,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);let t=u(this,Hn)._signal;e.addEventListener("click",A(this,is,Tr).bind(this),{signal:t}),e.addEventListener("keydown",A(this,Sh,CS).bind(this),{signal:t});let n=w(this,Do,document.createElement("span"));return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=u(this,Wl),e.append(n),e}renderMainDropdown(){let e=w(this,Be,A(this,Eh,SS).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===u(this,Un)){A(this,is,Tr).call(this,e);return}let t=e.target.getAttribute("data-color");t&&A(this,wh,AS).call(this,t,e)}_moveToNext(e){var t,n;if(!u(this,di,ws)){A(this,is,Tr).call(this,e);return}if(e.target===u(this,Un)){(t=u(this,Be).firstChild)==null||t.focus();return}(n=e.target.nextSibling)==null||n.focus()}_moveToPrevious(e){var t,n;if(e.target===((t=u(this,Be))==null?void 0:t.firstChild)||e.target===u(this,Un)){u(this,di,ws)&&this._hideDropdownFromKeyboard();return}u(this,di,ws)||A(this,is,Tr).call(this,e),(n=e.target.previousSibling)==null||n.focus()}_moveToBeginning(e){var t;if(!u(this,di,ws)){A(this,is,Tr).call(this,e);return}(t=u(this,Be).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!u(this,di,ws)){A(this,is,Tr).call(this,e);return}(t=u(this,Be).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=u(this,Be))==null||e.classList.add("hidden"),(t=u(this,Ks))==null||t.abort(),w(this,Ks,null)}_hideDropdownFromKeyboard(){var e;if(!u(this,Yl)){if(!u(this,di,ws)){(e=u(this,yh))==null||e.unselect();return}this.hideDropdown(),u(this,Un).focus({preventScroll:!0,focusVisible:u(this,mh)})}}updateColor(e){if(u(this,Do)&&(u(this,Do).style.backgroundColor=e),!u(this,Be))return;let t=u(this,Hn).highlightColors.values();for(let n of u(this,Be).children)n.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=u(this,Un))==null||e.remove(),w(this,Un,null),w(this,Do,null),(t=u(this,Be))==null||t.remove(),w(this,Be,null)}};Un=new WeakMap,Do=new WeakMap,Wl=new WeakMap,Be=new WeakMap,mh=new WeakMap,Yl=new WeakMap,yh=new WeakMap,vh=new WeakMap,Ks=new WeakMap,Hn=new WeakMap,Kl=new WeakMap,bh=new WeakMap,Eh=new WeakSet,SS=function(){let e=document.createElement("div"),t=u(this,Hn)._signal;e.addEventListener("contextmenu",zn,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[n,s]of u(this,Hn).highlightColors){let r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",s),r.title=n,r.setAttribute("data-l10n-id",u(Dt,bh)[n]);let o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=s,r.setAttribute("aria-selected",s===u(this,Wl)),r.addEventListener("click",A(this,wh,AS).bind(this,s),{signal:t}),e.append(r)}return e.addEventListener("keydown",A(this,Sh,CS).bind(this),{signal:t}),e},wh=new WeakSet,AS=function(e,t){t.stopPropagation(),u(this,vh).dispatch("switchannotationeditorparams",{source:this,type:u(this,Kl),value:e})},Sh=new WeakSet,CS=function(e){Dt._keyboardManager.exec(this,e)},is=new WeakSet,Tr=function(e){if(u(this,di,ws)){this.hideDropdown();return}if(w(this,mh,e.detail===0),u(this,Ks)||(w(this,Ks,new AbortController),window.addEventListener("pointerdown",A(this,uy,TR).bind(this),{signal:u(this,Hn).combinedSignal(u(this,Ks))})),u(this,Be)){u(this,Be).classList.remove("hidden");return}let t=w(this,Be,A(this,Eh,SS).call(this));u(this,Un).append(t)},uy=new WeakSet,TR=function(e){var t;(t=u(this,Be))!=null&&t.contains(e.target)||this.hideDropdown()},di=new WeakSet,ws=function(){return u(this,Be)&&!u(this,Be).classList.contains("hidden")},b(Dt,bh,null);var $g=Dt,Jl,Ah,ss,Po,Xl,kt,Ch,_h,Mo,fn,Jt,et,Zl,rs,ft,jl,pn,Th,xh,_S,Ql,lg,hy,xR,fy,RR,py,IR,Rh,TS,os,xr,Js,Fa,gy,DR,ec,cg,ko,ad,my,PR,yy,MR,vy,kR,by,NR,Ey,FR,le=class le extends Ce{constructor(t){super({...t,name:"highlightEditor"});b(this,xh);b(this,Ql);b(this,hy);b(this,fy);b(this,py);b(this,Rh);b(this,os);b(this,gy);b(this,ec);b(this,ko);b(this,my);b(this,yy);b(this,Ey);b(this,Jl,null);b(this,Ah,0);b(this,ss,void 0);b(this,Po,null);b(this,Xl,null);b(this,kt,null);b(this,Ch,null);b(this,_h,0);b(this,Mo,null);b(this,fn,null);b(this,Jt,null);b(this,et,!1);b(this,Zl,null);b(this,rs,void 0);b(this,ft,null);b(this,jl,"");b(this,pn,void 0);b(this,Th,"");this.color=t.color||le._defaultColor,w(this,pn,t.thickness||le._defaultThickness),w(this,rs,t.opacity||le._defaultOpacity),w(this,ss,t.boxes||null),w(this,Th,t.methodOfCreation||""),w(this,jl,t.text||""),this._isDraggable=!1,t.highlightId>-1?(w(this,et,!0),A(this,Ql,lg).call(this,t),A(this,os,xr).call(this)):u(this,ss)&&(w(this,Jl,t.anchorNode),w(this,Ah,t.anchorOffset),w(this,Ch,t.focusNode),w(this,_h,t.focusOffset),A(this,xh,_S).call(this),A(this,os,xr).call(this),this.rotate(this.rotation))}static get _keyboardManager(){let t=le.prototype;return se(this,"_keyboardManager",new Zo([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:u(this,et)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:u(this,pn),methodOfCreation:u(this,Th)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){var s;Ce.initialize(t,n),le._defaultColor||(le._defaultColor=((s=n.highlightColors)==null?void 0:s.values().next().value)||"#fff066")}static updateDefaultParams(t,n){switch(t){case oe.HIGHLIGHT_DEFAULT_COLOR:le._defaultColor=n;break;case oe.HIGHLIGHT_THICKNESS:le._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return u(this,Zl)}updateParams(t,n){switch(t){case oe.HIGHLIGHT_COLOR:A(this,hy,xR).call(this,n);break;case oe.HIGHLIGHT_THICKNESS:A(this,fy,RR).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[oe.HIGHLIGHT_DEFAULT_COLOR,le._defaultColor],[oe.HIGHLIGHT_THICKNESS,le._defaultThickness]]}get propertiesToUpdate(){return[[oe.HIGHLIGHT_COLOR,this.color||le._defaultColor],[oe.HIGHLIGHT_THICKNESS,u(this,pn)||le._defaultThickness],[oe.HIGHLIGHT_FREE,u(this,et)]]}async addEditToolbar(){let t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(w(this,Xl,new $g({editor:this})),t.addColorPicker(u(this,Xl))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(A(this,ko,ad).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,A(this,ko,ad).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){A(this,Rh,TS).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(A(this,os,xr).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let n=!1;this.parent&&!t?A(this,Rh,TS).call(this):t&&(A(this,os,xr).call(this,t),n=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var r,o,a;let{drawLayer:n}=this.parent,s;u(this,et)?(t=(t-this.rotation+360)%360,s=A(r=le,Js,Fa).call(r,u(this,fn).box,t)):s=A(o=le,Js,Fa).call(o,[this.x,this.y,this.width,this.height],t),n.updateProperties(u(this,Jt),{bbox:s,root:{"data-main-rotation":t}}),n.updateProperties(u(this,ft),{bbox:A(a=le,Js,Fa).call(a,u(this,kt).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;let t=super.render();u(this,jl)&&(t.setAttribute("aria-label",u(this,jl)),t.setAttribute("role","mark")),u(this,et)?t.classList.add("free"):this.div.addEventListener("keydown",A(this,gy,DR).bind(this),{signal:this._uiManager._signal});let n=w(this,Mo,document.createElement("div"));t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=u(this,Po);let[s,r]=this.parentDimensions;return this.setDims(this.width*s,this.height*r),vg(this,u(this,Mo),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(u(this,ft),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(u(this,ft),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:A(this,ec,cg).call(this,!0);break;case 1:case 3:A(this,ec,cg).call(this,!1);break}}select(){var t;super.select(),u(this,ft)&&((t=this.parent)==null||t.drawLayer.updateProperties(u(this,ft),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),u(this,ft)&&((t=this.parent)==null||t.drawLayer.updateProperties(u(this,ft),{rootClass:{selected:!1}}),u(this,et)||A(this,ec,cg).call(this,!1))}get _mustFixPosition(){return!u(this,et)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(u(this,Jt),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(u(this,ft),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:s,x:r,y:o}){let{x:a,y:l,width:c,height:d}=s.getBoundingClientRect(),h=new AbortController,p=t.combinedSignal(h),m=y=>{h.abort(),A(this,by,NR).call(this,t,y)};window.addEventListener("blur",m,{signal:p}),window.addEventListener("pointerup",m,{signal:p}),window.addEventListener("pointerdown",en,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",zn,{signal:p}),s.addEventListener("pointermove",A(this,vy,kR).bind(this,t),{signal:p}),this._freeHighlight=new Rd({x:r,y:o},[a,l,c,d],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,s){var v,E,S,C;let r=null;if(t instanceof Hg){let{data:{quadPoints:_,rect:T,rotation:R,id:I,color:D,opacity:k,popupRef:N},parent:{page:{pageNumber:F}}}=t;r=t={annotationType:j.HIGHLIGHT,color:Array.from(D),opacity:k,quadPoints:_,boxes:null,pageIndex:F-1,rect:T.slice(0),rotation:R,id:I,deleted:!1,popupRef:N}}else if(t instanceof Td){let{data:{inkLists:_,rect:T,rotation:R,id:I,color:D,borderStyle:{rawWidth:k},popupRef:N},parent:{page:{pageNumber:F}}}=t;r=t={annotationType:j.HIGHLIGHT,color:Array.from(D),thickness:k,inkLists:_,boxes:null,pageIndex:F-1,rect:T.slice(0),rotation:R,id:I,deleted:!1,popupRef:N}}let{color:o,quadPoints:a,inkLists:l,opacity:c}=t,d=await super.deserialize(t,n,s);d.color=G.makeHexColor(...o),w(d,rs,c||1),l&&w(d,pn,t.thickness),d.annotationElementId=t.id||null,d._initialData=r;let[h,p]=d.pageDimensions,[m,y]=d.pageTranslation;if(a){let _=w(d,ss,[]);for(let T=0;T<a.length;T+=8)_.push({x:(a[T]-m)/h,y:1-(a[T+1]-y)/p,width:(a[T+2]-a[T])/h,height:(a[T+1]-a[T+5])/p});A(v=d,xh,_S).call(v),A(E=d,os,xr).call(E),d.rotate(d.rotation)}else if(l){w(d,et,!0);let _=l[0],T={x:_[0]-m,y:p-(_[1]-y)},R=new Rd(T,[0,0,h,p],1,u(d,pn)/2,!0,.001);for(let k=0,N=_.length;k<N;k+=2)T.x=_[k]-m,T.y=p-(_[k+1]-y),R.add(T);let{id:I,clipPathId:D}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:R.toSVGPath()}},!0,!0);A(S=d,Ql,lg).call(S,{highlightOutlines:R.getOutlines(),highlightId:I,clipPathId:D}),A(C=d,os,xr).call(C)}return d}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();let n=this.getRect(0,0),s=Ce._colorManager.convert(this.color),r={annotationType:j.HIGHLIGHT,color:s,opacity:u(this,rs),thickness:u(this,pn),quadPoints:A(this,my,PR).call(this),outlines:A(this,yy,MR).call(this,n),pageIndex:this.pageIndex,rect:n,rotation:A(this,ko,ad).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!A(this,Ey,FR).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Jl=new WeakMap,Ah=new WeakMap,ss=new WeakMap,Po=new WeakMap,Xl=new WeakMap,kt=new WeakMap,Ch=new WeakMap,_h=new WeakMap,Mo=new WeakMap,fn=new WeakMap,Jt=new WeakMap,et=new WeakMap,Zl=new WeakMap,rs=new WeakMap,ft=new WeakMap,jl=new WeakMap,pn=new WeakMap,Th=new WeakMap,xh=new WeakSet,_S=function(){let t=new xd(u(this,ss),.001);w(this,fn,t.getOutlines()),[this.x,this.y,this.width,this.height]=u(this,fn).box;let n=new xd(u(this,ss),.0025,.001,this._uiManager.direction==="ltr");w(this,kt,n.getOutlines());let{lastPoint:s}=u(this,kt);w(this,Zl,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height])},Ql=new WeakSet,lg=function({highlightOutlines:t,highlightId:n,clipPathId:s}){var h,p;if(w(this,fn,t),w(this,kt,t.getNewOutline(u(this,pn)/2+1.5,.0025)),n>=0)w(this,Jt,n),w(this,Po,s),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),w(this,ft,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:u(this,kt).box,path:{d:u(this,kt).toSVGPath()}},!0));else if(this.parent){let m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(u(this,Jt),{bbox:A(h=le,Js,Fa).call(h,u(this,fn).box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(u(this,ft),{bbox:A(p=le,Js,Fa).call(p,u(this,kt).box,m),path:{d:u(this,kt).toSVGPath()}})}let[o,a,l,c]=t.box;switch(this.rotation){case 0:this.x=o,this.y=a,this.width=l,this.height=c;break;case 90:{let[m,y]=this.parentDimensions;this.x=a,this.y=1-o,this.width=l*y/m,this.height=c*m/y;break}case 180:this.x=1-o,this.y=1-a,this.width=l,this.height=c;break;case 270:{let[m,y]=this.parentDimensions;this.x=1-a,this.y=o,this.width=l*y/m,this.height=c*m/y;break}}let{lastPoint:d}=u(this,kt);w(this,Zl,[(d[0]-o)/l,(d[1]-a)/c])},hy=new WeakSet,xR=function(t){let n=(o,a)=>{var l,c;this.color=o,w(this,rs,a),(l=this.parent)==null||l.drawLayer.updateProperties(u(this,Jt),{root:{fill:o,"fill-opacity":a}}),(c=u(this,Xl))==null||c.updateColor(o)},s=this.color,r=u(this,rs);this.addCommands({cmd:n.bind(this,t,le._defaultOpacity),undo:n.bind(this,s,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:oe.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},fy=new WeakSet,RR=function(t){let n=u(this,pn),s=r=>{w(this,pn,r),A(this,py,IR).call(this,r)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:oe.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},py=new WeakSet,IR=function(t){if(!u(this,et))return;A(this,Ql,lg).call(this,{highlightOutlines:u(this,fn).getNewOutline(t/2)}),this.fixAndSetPosition();let[n,s]=this.parentDimensions;this.setDims(this.width*n,this.height*s)},Rh=new WeakSet,TS=function(){u(this,Jt)===null||!this.parent||(this.parent.drawLayer.remove(u(this,Jt)),w(this,Jt,null),this.parent.drawLayer.remove(u(this,ft)),w(this,ft,null))},os=new WeakSet,xr=function(t=this.parent){u(this,Jt)===null&&({id:vt(this,Jt)._,clipPathId:vt(this,Po)._}=t.drawLayer.draw({bbox:u(this,fn).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":u(this,rs)},rootClass:{highlight:!0,free:u(this,et)},path:{d:u(this,fn).toSVGPath()}},!1,!0),w(this,ft,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:u(this,et)},bbox:u(this,kt).box,path:{d:u(this,kt).toSVGPath()}},u(this,et))),u(this,Mo)&&(u(this,Mo).style.clipPath=u(this,Po)))},Js=new WeakSet,Fa=function([t,n,s,r],o){switch(o){case 90:return[1-n-r,t,r,s];case 180:return[1-t-s,1-n-r,s,r];case 270:return[n,1-t-s,r,s]}return[t,n,s,r]},gy=new WeakSet,DR=function(t){le._keyboardManager.exec(this,t)},ec=new WeakSet,cg=function(t){if(!u(this,Jl))return;let n=window.getSelection();t?n.setPosition(u(this,Jl),u(this,Ah)):n.setPosition(u(this,Ch),u(this,_h))},ko=new WeakSet,ad=function(){return u(this,et)?this.rotation:0},my=new WeakSet,PR=function(){if(u(this,et))return null;let[t,n]=this.pageDimensions,[s,r]=this.pageTranslation,o=u(this,ss),a=new Float32Array(o.length*8),l=0;for(let{x:c,y:d,width:h,height:p}of o){let m=c*t+s,y=(1-d)*n+r;a[l]=a[l+4]=m,a[l+1]=a[l+3]=y,a[l+2]=a[l+6]=m+h*t,a[l+5]=a[l+7]=y-p*n,l+=8}return a},yy=new WeakSet,MR=function(t){return u(this,fn).serialize(t,A(this,ko,ad).call(this))},vy=new WeakSet,kR=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},by=new WeakSet,NR=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Ey=new WeakSet,FR=function(t){let{color:n}=this._initialData;return t.color.some((s,r)=>s!==n[r])},b(le,Js),b(le,vy),b(le,by),Y(le,"_defaultColor",null),Y(le,"_defaultOpacity",1),Y(le,"_defaultThickness",12),Y(le,"_type","highlight"),Y(le,"_editorType",j.HIGHLIGHT),Y(le,"_freeHighlightId",-1),Y(le,"_freeHighlight",null),Y(le,"_freeHighlightClipId","");var zg=le,No,xS=class{constructor(){b(this,No,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(let[t,n]of Object.entries(e))this.updateProperty(t,n)}updateSVGProperty(e,t){u(this,No)[e]=t}toSVGProperties(){let e=u(this,No);return w(this,No,Object.create(null)),{root:e}}reset(){w(this,No,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){ge("Not implemented")}};No=new WeakMap;var Xt,tc,Ye,Fo,Lo,Xs,Zs,js,Oo,Ih,IS,Dh,DS,Ph,PS,Uo,ld,wy,LR,nc,dg,Ho,cd,Qs,La,B=class B extends Ce{constructor(t){super(t);b(this,Ih);b(this,Dh);b(this,Ph);b(this,Uo);b(this,wy);b(this,nc);b(this,Ho);b(this,Qs);b(this,Xt,null);b(this,tc,void 0);Y(this,"_drawId",null);w(this,tc,t.mustBeCommitted||!1),t.drawOutlines&&(A(this,Ih,IS).call(this,t),A(this,Uo,ld).call(this))}static _mergeSVGProperties(t,n){let s=new Set(Object.keys(t));for(let[r,o]of Object.entries(n))s.has(r)?Object.assign(t[r],o):t[r]=o;return t}static getDefaultDrawingOptions(t){ge("Not implemented")}static get typesMap(){ge("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){let s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,n),this._currentParent&&(u(B,Ye).updateProperty(s,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){let s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,n)}static get defaultPropertiesToUpdate(){let t=[],n=this._defaultDrawingOptions;for(let[s,r]of this.typesMap)t.push([s,n[r]]);return t}get propertiesToUpdate(){let t=[],{_drawingOptions:n}=this;for(let[s,r]of this.constructor.typesMap)t.push([s,n[r]]);return t}_updateProperty(t,n,s){let r=this._drawingOptions,o=r[n],a=l=>{var d;r.updateProperty(n,l);let c=u(this,Xt).updateProperty(n,l);c&&A(this,Ho,cd).call(this,c),(d=this.parent)==null||d.drawLayer.updateProperties(this._drawId,r.toSVGProperties())};this.addCommands({cmd:a.bind(this,s),undo:a.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,B._mergeSVGProperties(u(this,Xt).getPathResizingSVGProperties(A(this,nc,dg).call(this)),{bbox:A(this,Qs,La).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,B._mergeSVGProperties(u(this,Xt).getPathResizedSVGProperties(A(this,nc,dg).call(this)),{bbox:A(this,Qs,La).call(this)}))}_onTranslating(t,n){var s;(s=this.parent)==null||s.drawLayer.updateProperties(this._drawId,{bbox:A(this,Qs,La).call(this,t,n)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,B._mergeSVGProperties(u(this,Xt).getPathTranslatedSVGProperties(A(this,nc,dg).call(this),this.parentDimensions),{bbox:A(this,Qs,La).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,u(this,tc)&&(w(this,tc,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){A(this,Ph,PS).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(A(this,Uo,ld).call(this),A(this,Ho,cd).call(this,u(this,Xt).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),A(this,Ph,PS).call(this)):t&&(this._uiManager.addShouldRescale(this),A(this,Uo,ld).call(this,t),n=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,B._mergeSVGProperties({bbox:A(this,Qs,La).call(this)},u(this,Xt).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&A(this,Ho,cd).call(this,u(this,Xt).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t=super.render();t.classList.add("draw");let n=document.createElement("div");t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";let[s,r]=this.parentDimensions;return this.setDims(this.width*s,this.height*r),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,n,s,r,o){ge("Not implemented")}static startDrawing(t,n,s,r){var E,S;let{target:o,offsetX:a,offsetY:l,pointerId:c,pointerType:d}=r;if(u(B,Zs)&&u(B,Zs)!==d)return;let{viewport:{rotation:h}}=t,{width:p,height:m}=o.getBoundingClientRect(),y=w(B,Fo,new AbortController),v=t.combinedSignal(y);if(u(B,Xs)||w(B,Xs,c),(E=u(B,Zs))!=null||w(B,Zs,d),window.addEventListener("pointerup",C=>{var _;u(B,Xs)===C.pointerId?this._endDraw(C):(_=u(B,js))==null||_.delete(C.pointerId)},{signal:v}),window.addEventListener("pointercancel",C=>{var _;u(B,Xs)===C.pointerId?this._currentParent.endDrawingSession():(_=u(B,js))==null||_.delete(C.pointerId)},{signal:v}),window.addEventListener("pointerdown",C=>{u(B,Zs)===C.pointerType&&((u(B,js)||w(B,js,new Set)).add(C.pointerId),u(B,Ye).isCancellable()&&(u(B,Ye).removeLastElement(),u(B,Ye).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:v}),window.addEventListener("contextmenu",zn,{signal:v}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:v}),o.addEventListener("touchmove",C=>{C.timeStamp===u(B,Oo)&&en(C)},{signal:v}),t.toggleDrawing(),(S=n._editorUndoBar)==null||S.hide(),u(B,Ye)){t.drawLayer.updateProperties(this._currentDrawId,u(B,Ye).startNew(a,l,p,m,h));return}n.updateUIForDefaultProperties(this),w(B,Ye,this.createDrawerInstance(a,l,p,m,h)),w(B,Lo,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(u(B,Lo).toSVGProperties(),u(B,Ye).defaultSVGProperties),!0,!1)}static _drawMove(t){var o;if(w(B,Oo,-1),!u(B,Ye))return;let{offsetX:n,offsetY:s,pointerId:r}=t;if(u(B,Xs)===r){if(((o=u(B,js))==null?void 0:o.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,u(B,Ye).add(n,s)),w(B,Oo,t.timeStamp),en(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,w(B,Ye,null),w(B,Lo,null),w(B,Zs,null),w(B,Oo,NaN)),u(B,Fo)&&(u(B,Fo).abort(),w(B,Fo,null),w(B,Xs,NaN),w(B,js,null))}static _endDraw(t){let n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),t&&n.drawLayer.updateProperties(this._currentDrawId,u(B,Ye).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){let s=u(B,Ye),r=this._currentDrawId,o=s.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(r,s.setLastElement(o))},undo:()=>{n.drawLayer.updateProperties(r,s.removeLastElement())},mustExec:!1,type:oe.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){let n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(oe.DRAW_STEP),!u(B,Ye).isEmpty()){let{pageDimensions:[s,r],scale:o}=n,a=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:u(B,Ye).getOutlines(s*o,r*o,o,this._INNER_MARGIN),drawingOptions:u(B,Lo),mustBeCommitted:!t});return this._cleanup(!0),a}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,s,r,o,a){ge("Not implemented")}static async deserialize(t,n,s){var h,p;let{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:l}}=n.viewport,c=this.deserializeDraw(a,l,r,o,this._INNER_MARGIN,t),d=await super.deserialize(t,n,s);return d.createDrawingOptions(t),A(h=d,Ih,IS).call(h,{drawOutlines:c}),A(p=d,Uo,ld).call(p),d.onScaleChanging(),d.rotate(),d}serializeDraw(t){let[n,s]=this.pageTranslation,[r,o]=this.pageDimensions;return u(this,Xt).serialize([n,s,r,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Xt=new WeakMap,tc=new WeakMap,Ye=new WeakMap,Fo=new WeakMap,Lo=new WeakMap,Xs=new WeakMap,Zs=new WeakMap,js=new WeakMap,Oo=new WeakMap,Ih=new WeakSet,IS=function({drawOutlines:t,drawId:n,drawingOptions:s}){w(this,Xt,t),this._drawingOptions||(this._drawingOptions=s),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=A(this,Dh,DS).call(this,t,this.parent),A(this,Ho,cd).call(this,t.box)},Dh=new WeakSet,DS=function(t,n){let{id:s}=n.drawLayer.draw(B._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s},Ph=new WeakSet,PS=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Uo=new WeakSet,ld=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=A(this,Dh,DS).call(this,u(this,Xt),t)}},wy=new WeakSet,LR=function([t,n,s,r]){let{parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[n,1-t,s*(a/o),r*(o/a)];case 180:return[1-t,1-n,s,r];case 270:return[1-n,t,s*(a/o),r*(o/a)];default:return[t,n,s,r]}},nc=new WeakSet,dg=function(){let{x:t,y:n,width:s,height:r,parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[1-n,t,s*(o/a),r*(a/o)];case 180:return[1-t,1-n,s,r];case 270:return[n,1-t,s*(o/a),r*(a/o)];default:return[t,n,s,r]}},Ho=new WeakSet,cd=function(t){if([this.x,this.y,this.width,this.height]=A(this,wy,LR).call(this,t),this.div){this.fixAndSetPosition();let[n,s]=this.parentDimensions;this.setDims(this.width*n,this.height*s)}this._onResized()},Qs=new WeakSet,La=function(){let{x:t,y:n,width:s,height:r,rotation:o,parentRotation:a,parentDimensions:[l,c]}=this;switch((o*4+a)/90){case 1:return[1-n-r,t,r,s];case 2:return[1-t-s,1-n-r,s,r];case 3:return[n,1-t-s,r,s];case 4:return[t,n-s*(l/c),r*(c/l),s*(l/c)];case 5:return[1-n,t,s*(l/c),r*(c/l)];case 6:return[1-t-r*(c/l),1-n,r*(c/l),s*(l/c)];case 7:return[n-s*(l/c),1-t-r*(c/l),s*(l/c),r*(c/l)];case 8:return[t-s,n-r,s,r];case 9:return[1-n,t-s,r,s];case 10:return[1-t,1-n,s,r];case 11:return[n-r,1-t,r,s];case 12:return[t-r*(c/l),n,r*(c/l),s*(l/c)];case 13:return[1-n-s*(l/c),t-r*(c/l),s*(l/c),r*(c/l)];case 14:return[1-t,1-n-s*(l/c),r*(c/l),s*(l/c)];case 15:return[n,1-t,s*(l/c),r*(c/l)];default:return[t,n,s,r]}},Y(B,"_currentDrawId",-1),Y(B,"_currentParent",null),b(B,Ye,null),b(B,Fo,null),b(B,Lo,null),b(B,Xs,NaN),b(B,Zs,null),b(B,js,null),b(B,Oo,NaN),Y(B,"_INNER_MARGIN",3);var RS=B,ui,Ke,Je,Bo,ic,St,tt,gn,Go,Vo,$o,sc,ug,MS=class{constructor(e,t,n,s,r,o){b(this,sc);b(this,ui,new Float64Array(6));b(this,Ke,void 0);b(this,Je,void 0);b(this,Bo,void 0);b(this,ic,void 0);b(this,St,void 0);b(this,tt,"");b(this,gn,0);b(this,Go,new qg);b(this,Vo,void 0);b(this,$o,void 0);w(this,Vo,n),w(this,$o,s),w(this,Bo,r),w(this,ic,o),[e,t]=A(this,sc,ug).call(this,e,t);let a=w(this,Ke,[NaN,NaN,NaN,NaN,e,t]);w(this,St,[e,t]),w(this,Je,[{line:a,points:u(this,St)}]),u(this,ui).set(a,0)}updateProperty(e,t){e==="stroke-width"&&w(this,ic,t)}isEmpty(){return!u(this,Je)||u(this,Je).length===0}isCancellable(){return u(this,St).length<=10}add(e,t){[e,t]=A(this,sc,ug).call(this,e,t);let[n,s,r,o]=u(this,ui).subarray(2,6),a=e-r,l=t-o;return Math.hypot(u(this,Vo)*a,u(this,$o)*l)<=2?null:(u(this,St).push(e,t),isNaN(n)?(u(this,ui).set([r,o,e,t],2),u(this,Ke).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(u(this,ui)[0])&&u(this,Ke).splice(6,6),u(this,ui).set([n,s,r,o,e,t],0),u(this,Ke).push(...H.createBezierPoints(n,s,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){let n=this.add(e,t);return n||(u(this,St).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,s,r){w(this,Vo,n),w(this,$o,s),w(this,Bo,r),[e,t]=A(this,sc,ug).call(this,e,t);let o=w(this,Ke,[NaN,NaN,NaN,NaN,e,t]);w(this,St,[e,t]);let a=u(this,Je).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),u(this,Je).push({line:o,points:u(this,St)}),u(this,ui).set(o,0),w(this,gn,0),this.toSVGPath(),null}getLastElement(){return u(this,Je).at(-1)}setLastElement(e){return u(this,Je)?(u(this,Je).push(e),w(this,Ke,e.line),w(this,St,e.points),w(this,gn,0),{path:{d:this.toSVGPath()}}):u(this,Go).setLastElement(e)}removeLastElement(){if(!u(this,Je))return u(this,Go).removeLastElement();u(this,Je).pop(),w(this,tt,"");for(let e=0,t=u(this,Je).length;e<t;e++){let{line:n,points:s}=u(this,Je)[e];w(this,Ke,n),w(this,St,s),w(this,gn,0),this.toSVGPath()}return{path:{d:u(this,tt)}}}toSVGPath(){let e=H.svgRound(u(this,Ke)[4]),t=H.svgRound(u(this,Ke)[5]);if(u(this,St).length===2)return w(this,tt,`${u(this,tt)} M ${e} ${t} Z`),u(this,tt);if(u(this,St).length<=6){let s=u(this,tt).lastIndexOf("M");w(this,tt,`${u(this,tt).slice(0,s)} M ${e} ${t}`),w(this,gn,6)}if(u(this,St).length===4){let s=H.svgRound(u(this,Ke)[10]),r=H.svgRound(u(this,Ke)[11]);return w(this,tt,`${u(this,tt)} L ${s} ${r}`),w(this,gn,12),u(this,tt)}let n=[];u(this,gn)===0&&(n.push(`M ${e} ${t}`),w(this,gn,6));for(let s=u(this,gn),r=u(this,Ke).length;s<r;s+=6){let[o,a,l,c,d,h]=u(this,Ke).slice(s,s+6).map(H.svgRound);n.push(`C${o} ${a} ${l} ${c} ${d} ${h}`)}return w(this,tt,u(this,tt)+n.join(" ")),w(this,gn,u(this,Ke).length),u(this,tt)}getOutlines(e,t,n,s){let r=u(this,Je).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),u(this,Go).build(u(this,Je),e,t,n,u(this,Bo),u(this,ic),s),w(this,ui,null),w(this,Ke,null),w(this,Je,null),w(this,tt,null),u(this,Go)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}};ui=new WeakMap,Ke=new WeakMap,Je=new WeakMap,Bo=new WeakMap,ic=new WeakMap,St=new WeakMap,tt=new WeakMap,gn=new WeakMap,Go=new WeakMap,Vo=new WeakMap,$o=new WeakMap,sc=new WeakSet,ug=function(e,t){return H._normalizePoint(e,t,u(this,Vo),u(this,$o),u(this,Bo))};var At,Mh,kh,Zt,hi,fi,rc,oc,ac,Bn,Ni,Sy,OR,Ay,UR,Cy,HR,jS=class jS extends H{constructor(){super(...arguments);b(this,Bn);b(this,Sy);b(this,Ay);b(this,Cy);b(this,At,void 0);b(this,Mh,0);b(this,kh,void 0);b(this,Zt,void 0);b(this,hi,void 0);b(this,fi,void 0);b(this,rc,void 0);b(this,oc,void 0);b(this,ac,void 0)}build(t,n,s,r,o,a,l){w(this,hi,n),w(this,fi,s),w(this,rc,r),w(this,oc,o),w(this,ac,a),w(this,kh,l!=null?l:0),w(this,Zt,t),A(this,Ay,UR).call(this)}setLastElement(t){return u(this,Zt).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return u(this,Zt).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let t=[];for(let{line:n}of u(this,Zt)){if(t.push(`M${H.svgRound(n[4])} ${H.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12){t.push(`L${H.svgRound(n[10])} ${H.svgRound(n[11])}`);continue}for(let s=6,r=n.length;s<r;s+=6){let[o,a,l,c,d,h]=n.subarray(s,s+6).map(H.svgRound);t.push(`C${o} ${a} ${l} ${c} ${d} ${h}`)}}return t.join("")}serialize([t,n,s,r],o){let a=[],l=[],[c,d,h,p]=A(this,Sy,OR).call(this),m,y,v,E,S,C,_,T,R;switch(u(this,oc)){case 0:R=H._rescale,m=t,y=n+r,v=s,E=-r,S=t+c*s,C=n+(1-d-p)*r,_=t+(c+h)*s,T=n+(1-d)*r;break;case 90:R=H._rescaleAndSwap,m=t,y=n,v=s,E=r,S=t+d*s,C=n+c*r,_=t+(d+p)*s,T=n+(c+h)*r;break;case 180:R=H._rescale,m=t+s,y=n,v=-s,E=r,S=t+(1-c-h)*s,C=n+d*r,_=t+(1-c)*s,T=n+(d+p)*r;break;case 270:R=H._rescaleAndSwap,m=t+s,y=n+r,v=-s,E=-r,S=t+(1-d-p)*s,C=n+(1-c-h)*r,_=t+(1-d)*s,T=n+(1-c)*r;break}for(let{line:I,points:D}of u(this,Zt))a.push(R(I,m,y,v,E,o?new Array(I.length):null)),l.push(R(D,m,y,v,E,o?new Array(D.length):null));return{lines:a,points:l,rect:[S,C,_,T]}}static deserialize(t,n,s,r,o,{paths:{lines:a,points:l},rotation:c,thickness:d}){let h=[],p,m,y,v,E;switch(c){case 0:E=H._rescale,p=-t/s,m=n/r+1,y=1/s,v=-1/r;break;case 90:E=H._rescaleAndSwap,p=-n/r,m=-t/s,y=1/r,v=1/s;break;case 180:E=H._rescale,p=t/s+1,m=-n/r,y=-1/s,v=1/r;break;case 270:E=H._rescaleAndSwap,p=n/r+1,m=t/s+1,y=-1/r,v=-1/s;break}if(!a){a=[];for(let C of l){let _=C.length;if(_===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1]]));continue}if(_===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1],NaN,NaN,NaN,NaN,C[2],C[3]]));continue}let T=new Float32Array(3*(_-2));a.push(T);let[R,I,D,k]=C.subarray(0,4);T.set([NaN,NaN,NaN,NaN,R,I],0);for(let N=4;N<_;N+=2){let F=C[N],U=C[N+1];T.set(H.createBezierPoints(R,I,D,k,F,U),(N-2)*3),[R,I,D,k]=[D,k,F,U]}}}for(let C=0,_=a.length;C<_;C++)h.push({line:E(a[C].map(T=>T!=null?T:NaN),p,m,y,v),points:E(l[C].map(T=>T!=null?T:NaN),p,m,y,v)});let S=new jS;return S.build(h,s,r,1,c,d,o),S}get box(){return u(this,At)}updateProperty(t,n){return t==="stroke-width"?A(this,Cy,HR).call(this,n):null}updateParentDimensions([t,n],s){let[r,o]=A(this,Bn,Ni).call(this);w(this,hi,t),w(this,fi,n),w(this,rc,s);let[a,l]=A(this,Bn,Ni).call(this),c=a-r,d=l-o,h=u(this,At);return h[0]-=c,h[1]-=d,h[2]+=2*c,h[3]+=2*d,h}updateRotation(t){return w(this,Mh,t),{path:{transform:this.rotationTransform}}}get viewBox(){return u(this,At).map(H.svgRound).join(" ")}get defaultProperties(){let[t,n]=u(this,At);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`}}}get rotationTransform(){let[,,t,n]=u(this,At),s=0,r=0,o=0,a=0,l=0,c=0;switch(u(this,Mh)){case 90:r=n/t,o=-t/n,l=t;break;case 180:s=-1,a=-1,l=t,c=n;break;case 270:r=-n/t,o=t/n,c=n;break;default:return""}return`matrix(${s} ${r} ${o} ${a} ${H.svgRound(l)} ${H.svgRound(c)})`}getPathResizingSVGProperties([t,n,s,r]){let[o,a]=A(this,Bn,Ni).call(this),[l,c,d,h]=u(this,At);if(Math.abs(d-o)<=H.PRECISION||Math.abs(h-a)<=H.PRECISION){let E=t+s/2-(l+d/2),S=n+r/2-(c+h/2);return{path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`,transform:`${this.rotationTransform} translate(${E} ${S})`}}}let p=(s-2*o)/(d-2*o),m=(r-2*a)/(h-2*a),y=d/s,v=h/r;return{path:{"transform-origin":`${H.svgRound(l)} ${H.svgRound(c)}`,transform:`${this.rotationTransform} scale(${y} ${v}) translate(${H.svgRound(o)} ${H.svgRound(a)}) scale(${p} ${m}) translate(${H.svgRound(-o)} ${H.svgRound(-a)})`}}}getPathResizedSVGProperties([t,n,s,r]){let[o,a]=A(this,Bn,Ni).call(this),l=u(this,At),[c,d,h,p]=l;if(l[0]=t,l[1]=n,l[2]=s,l[3]=r,Math.abs(h-o)<=H.PRECISION||Math.abs(p-a)<=H.PRECISION){let S=t+s/2-(c+h/2),C=n+r/2-(d+p/2);for(let{line:_,points:T}of u(this,Zt))H._translate(_,S,C,_),H._translate(T,S,C,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let m=(s-2*o)/(h-2*o),y=(r-2*a)/(p-2*a),v=-m*(c+o)+t+o,E=-y*(d+a)+n+a;if(m!==1||y!==1||v!==0||E!==0)for(let{line:S,points:C}of u(this,Zt))H._rescale(S,v,E,m,y,S),H._rescale(C,v,E,m,y,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],s){let[r,o]=s,a=u(this,At),l=t-a[0],c=n-a[1];if(u(this,hi)===r&&u(this,fi)===o)for(let{line:d,points:h}of u(this,Zt))H._translate(d,l,c,d),H._translate(h,l,c,h);else{let d=u(this,hi)/r,h=u(this,fi)/o;w(this,hi,r),w(this,fi,o);for(let{line:p,points:m}of u(this,Zt))H._rescale(p,l,c,d,h,p),H._rescale(m,l,c,d,h,m);a[2]*=d,a[3]*=h}return a[0]=t,a[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`}}}get defaultSVGProperties(){let t=u(this,At);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${H.svgRound(t[0])} ${H.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};At=new WeakMap,Mh=new WeakMap,kh=new WeakMap,Zt=new WeakMap,hi=new WeakMap,fi=new WeakMap,rc=new WeakMap,oc=new WeakMap,ac=new WeakMap,Bn=new WeakSet,Ni=function(t=u(this,ac)){let n=u(this,kh)+t/2*u(this,rc);return u(this,oc)%180===0?[n/u(this,hi),n/u(this,fi)]:[n/u(this,fi),n/u(this,hi)]},Sy=new WeakSet,OR=function(){let[t,n,s,r]=u(this,At),[o,a]=A(this,Bn,Ni).call(this,0);return[t+o,n+a,s-2*o,r-2*a]},Ay=new WeakSet,UR=function(){let t=w(this,At,new Float32Array([1/0,1/0,-1/0,-1/0]));for(let{line:r}of u(this,Zt)){if(r.length<=12){for(let l=4,c=r.length;l<c;l+=6){let[d,h]=r.subarray(l,l+2);t[0]=Math.min(t[0],d),t[1]=Math.min(t[1],h),t[2]=Math.max(t[2],d),t[3]=Math.max(t[3],h)}continue}let o=r[4],a=r[5];for(let l=6,c=r.length;l<c;l+=6){let[d,h,p,m,y,v]=r.subarray(l,l+6);G.bezierBoundingBox(o,a,d,h,p,m,y,v,t),o=y,a=v}}let[n,s]=A(this,Bn,Ni).call(this);t[0]=Math.min(1,Math.max(0,t[0]-n)),t[1]=Math.min(1,Math.max(0,t[1]-s)),t[2]=Math.min(1,Math.max(0,t[2]+n)),t[3]=Math.min(1,Math.max(0,t[3]+s)),t[2]-=t[0],t[3]-=t[1]},Cy=new WeakSet,HR=function(t){let[n,s]=A(this,Bn,Ni).call(this);w(this,ac,t);let[r,o]=A(this,Bn,Ni).call(this),[a,l]=[r-n,o-s],c=u(this,At);return c[0]-=a,c[1]-=l,c[2]+=2*a,c[3]+=2*l,c};var qg=jS,lc,QS=class QS extends xS{constructor(t){super();b(this,lc,void 0);w(this,lc,t),super.updateProperties({fill:"none",stroke:Ce._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,n){t==="stroke-width"&&(n!=null||(n=this["stroke-width"]),n*=u(this,lc).realScale),super.updateSVGProperty(t,n)}clone(){let t=new QS(u(this,lc));return t.updateAll(this),t}};lc=new WeakMap;var kS=QS,_y,BR,Ua=class Ua extends RS{constructor(t){super({...t,name:"inkEditor"});b(this,_y);this._willKeepAspectRatio=!0}static initialize(t,n){Ce.initialize(t,n),this._defaultDrawingOptions=new kS(n.viewParameters)}static getDefaultDrawingOptions(t){let n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return se(this,"typesMap",new Map([[oe.INK_THICKNESS,"stroke-width"],[oe.INK_COLOR,"stroke"],[oe.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,s,r,o){return new MS(t,n,s,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,s,r,o,a){return qg.deserialize(t,n,s,r,o,a)}static async deserialize(t,n,s){let r=null;if(t instanceof Td){let{data:{inkLists:a,rect:l,rotation:c,id:d,color:h,opacity:p,borderStyle:{rawWidth:m},popupRef:y},parent:{page:{pageNumber:v}}}=t;r=t={annotationType:j.INK,color:Array.from(h),thickness:m,opacity:p,paths:{points:a},boxes:null,pageIndex:v-1,rect:l.slice(0),rotation:c,id:d,deleted:!1,popupRef:y}}let o=await super.deserialize(t,n,s);return o.annotationElementId=t.id||null,o._initialData=r,o}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:t,_drawingOptions:n,parent:s}=this;n.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){let t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:s}){this._drawingOptions=Ua.getDefaultDrawingOptions({stroke:G.makeHexColor(...t),"stroke-width":n,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:n,points:s,rect:r}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":a,"stroke-width":l}}=this,c={annotationType:j.INK,color:Ce._colorManager.convert(o),opacity:a,thickness:l,paths:{lines:n,points:s},pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?c:this.annotationElementId&&!A(this,_y,BR).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(t){let{points:n,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:n}),null}};_y=new WeakSet,BR=function(t){let{color:n,thickness:s,opacity:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((a,l)=>a!==n[l])||t.thickness!==s||t.opacity!==r||t.pageIndex!==o},Y(Ua,"_type","ink"),Y(Ua,"_editorType",j.INK),Y(Ua,"_defaultDrawingOptions",null);var NS=Ua,Ae,nt,er,as,tr,cc,pi,gi,jt,dc,zo,dd,qo,ud,uc,hg,Nh,LS,hc,fg,Fh,OS,fc,pg,Ty,GR,gd=class gd extends Ce{constructor(t){super({...t,name:"stampEditor"});b(this,zo);b(this,qo);b(this,uc);b(this,Nh);b(this,hc);b(this,Fh);b(this,fc);b(this,Ty);b(this,Ae,null);b(this,nt,null);b(this,er,null);b(this,as,null);b(this,tr,null);b(this,cc,"");b(this,pi,null);b(this,gi,null);b(this,jt,!1);b(this,dc,!1);w(this,as,t.bitmapUrl),w(this,tr,t.bitmapFile)}static initialize(t,n){Ce.initialize(t,n)}static get supportedTypes(){return se(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(n=>`image/${n}`))}static get supportedTypesStr(){return se(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,n){n.pasteEditor(j.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){var s,r;let n=t.get("hasAltText");return{hasAltText:(s=n.get(!0))!=null?s:0,hasNoAltText:(r=n.get(!1))!=null?r:0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;let{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");let{data:r,width:o,height:a}=t||this.copyCanvas(null,null,!0).imageData,l=await s.guess({name:"altText",request:{data:r,width:o,height:a,channels:r.length/(o*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");let c=l.output;return await this.setGuessedAltText(c),n&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){var t;u(this,nt)&&(w(this,Ae,null),this._uiManager.imageManager.deleteId(u(this,nt)),(t=u(this,pi))==null||t.remove(),w(this,pi,null),u(this,gi)&&(clearTimeout(u(this,gi)),w(this,gi,null))),super.remove()}rebuild(){if(!this.parent){u(this,nt)&&A(this,uc,hg).call(this);return}super.rebuild(),this.div!==null&&(u(this,nt)&&u(this,pi)===null&&A(this,uc,hg).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(u(this,er)||u(this,Ae)||u(this,as)||u(this,tr)||u(this,nt))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;if(this.width&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),u(this,Ae)?A(this,Nh,LS).call(this):A(this,uc,hg).call(this),this.width&&!this.annotationElementId){let[s,r]=this.parentDimensions;this.setAt(t*s,n*r,this.width*s,this.height*r)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;u(this,gi)!==null&&clearTimeout(u(this,gi)),w(this,gi,setTimeout(()=>{w(this,gi,null),A(this,Fh,OS).call(this)},200))}copyCanvas(t,n,s=!1){var m;t||(t=224);let{width:r,height:o}=u(this,Ae),a=new bd,l=u(this,Ae),c=r,d=o,h=null;if(n){if(r>n||o>n){let k=Math.min(n/r,n/o);c=Math.floor(r*k),d=Math.floor(o*k)}h=document.createElement("canvas");let y=h.width=Math.ceil(c*a.sx),v=h.height=Math.ceil(d*a.sy);u(this,jt)||(l=A(this,hc,fg).call(this,y,v));let E=h.getContext("2d");E.filter=this._uiManager.hcmFilter;let S="white",C="#cfcfd8";this._uiManager.hcmFilter!=="none"?C="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(S="#8f8f9d",C="#42414d");let _=15,T=_*a.sx,R=_*a.sy,I=new OffscreenCanvas(T*2,R*2),D=I.getContext("2d");D.fillStyle=S,D.fillRect(0,0,T*2,R*2),D.fillStyle=C,D.fillRect(0,0,T,R),D.fillRect(T,R,T,R),E.fillStyle=E.createPattern(I,"repeat"),E.fillRect(0,0,y,v),E.drawImage(l,0,0,l.width,l.height,0,0,y,v)}let p=null;if(s){let y,v;if(a.symmetric&&l.width<t&&l.height<t)y=l.width,v=l.height;else if(l=u(this,Ae),r>t||o>t){let C=Math.min(t/r,t/o);y=Math.floor(r*C),v=Math.floor(o*C),u(this,jt)||(l=A(this,hc,fg).call(this,y,v))}let S=new OffscreenCanvas(y,v).getContext("2d",{willReadFrequently:!0});S.drawImage(l,0,0,l.width,l.height,0,0,y,v),p={width:y,height:v,data:S.getImageData(0,0,y,v).data}}return{canvas:h,width:c,height:d,imageData:p}}getImageForAltText(){return u(this,pi)}static async deserialize(t,n,s){var v;let r=null;if(t instanceof Bg){let{data:{rect:E,rotation:S,id:C,structParent:_,popupRef:T},container:R,parent:{page:{pageNumber:I}}}=t,D=R.querySelector("canvas"),k=s.imageManager.getFromCanvas(R.id,D);D.remove();let N=((v=await n._structTree.getAriaAttributes(`${qS}${C}`))==null?void 0:v.get("aria-label"))||"";r=t={annotationType:j.STAMP,bitmapId:k.id,bitmap:k.bitmap,pageIndex:I-1,rect:E.slice(0),rotation:S,id:C,deleted:!1,accessibilityData:{decorative:!1,altText:N},isSvg:!1,structParent:_,popupRef:T}}let o=await super.deserialize(t,n,s),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:d,isSvg:h,accessibilityData:p}=t;d&&s.imageManager.isValidId(d)?(w(o,nt,d),l&&w(o,Ae,l)):w(o,as,c),w(o,jt,h);let[m,y]=o.pageDimensions;return o.width=(a[2]-a[0])/m,o.height=(a[3]-a[1])/y,o.annotationElementId=t.id||null,p&&(o.altTextData=p),o._initialData=r,w(o,dc,!!r),o}serialize(t=!1,n=null){var l;if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let s={annotationType:j.STAMP,bitmapId:u(this,nt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:u(this,jt),structTreeParentId:this._structTreeParentId};if(t)return s.bitmapUrl=A(this,fc,pg).call(this,!0),s.accessibilityData=this.serializeAltText(!0),s;let{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(s.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){let c=A(this,Ty,GR).call(this,s);if(c.isSame)return null;c.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=(l=this._initialData.structParent)!=null?l:-1}if(s.id=this.annotationElementId,n===null)return s;n.stamps||(n.stamps=new Map);let a=u(this,jt)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!n.stamps.has(u(this,nt)))n.stamps.set(u(this,nt),{area:a,serialized:s}),s.bitmap=A(this,fc,pg).call(this,!1);else if(u(this,jt)){let c=n.stamps.get(u(this,nt));a>c.area&&(c.area=a,c.serialized.bitmap.close(),c.serialized.bitmap=A(this,fc,pg).call(this,!1))}return s}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};Ae=new WeakMap,nt=new WeakMap,er=new WeakMap,as=new WeakMap,tr=new WeakMap,cc=new WeakMap,pi=new WeakMap,gi=new WeakMap,jt=new WeakMap,dc=new WeakMap,zo=new WeakSet,dd=function(t,n=!1){if(!t){this.remove();return}w(this,Ae,t.bitmap),n||(w(this,nt,t.id),w(this,jt,t.isSvg)),t.file&&w(this,cc,t.file.name),A(this,Nh,LS).call(this)},qo=new WeakSet,ud=function(){if(w(this,er,null),this._uiManager.enableWaiting(!1),!!u(this,pi)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,Ae)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,Ae)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch(t){}}this.div.focus()}},uc=new WeakSet,hg=function(){if(u(this,nt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(u(this,nt)).then(s=>A(this,zo,dd).call(this,s,!0)).finally(()=>A(this,qo,ud).call(this));return}if(u(this,as)){let s=u(this,as);w(this,as,null),this._uiManager.enableWaiting(!0),w(this,er,this._uiManager.imageManager.getFromUrl(s).then(r=>A(this,zo,dd).call(this,r)).finally(()=>A(this,qo,ud).call(this)));return}if(u(this,tr)){let s=u(this,tr);w(this,tr,null),this._uiManager.enableWaiting(!0),w(this,er,this._uiManager.imageManager.getFromFile(s).then(r=>A(this,zo,dd).call(this,r)).finally(()=>A(this,qo,ud).call(this)));return}let t=document.createElement("input");t.type="file",t.accept=gd.supportedTypesStr;let n=this._uiManager._signal;w(this,er,new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),A(this,zo,dd).call(this,r)}s()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:n})}).finally(()=>A(this,qo,ud).call(this))),t.click()},Nh=new WeakSet,LS=function(){var h;let{div:t}=this,{width:n,height:s}=u(this,Ae),[r,o]=this.pageDimensions,a=.75;if(this.width)n=this.width*r,s=this.height*o;else if(n>a*r||s>a*o){let p=Math.min(a*r/n,a*o/s);n*=p,s*=p}let[l,c]=this.parentDimensions;this.setDims(n*l/r,s*c/o),this._uiManager.enableWaiting(!1);let d=w(this,pi,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=n/r,this.height=s/o,(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),A(this,Fh,OS).call(this),u(this,dc)||(this.parent.addUndoableEditor(this),w(this,dc,!0)),this._reportTelemetry({action:"inserted_image"}),u(this,cc)&&d.setAttribute("aria-label",u(this,cc))},hc=new WeakSet,fg=function(t,n){let{width:s,height:r}=u(this,Ae),o=s,a=r,l=u(this,Ae);for(;o>2*t||a>2*n;){let c=o,d=a;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),a>2*n&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));let h=new OffscreenCanvas(o,a);h.getContext("2d").drawImage(l,0,0,c,d,0,0,o,a),l=h.transferToImageBitmap()}return l},Fh=new WeakSet,OS=function(){let[t,n]=this.parentDimensions,{width:s,height:r}=this,o=new bd,a=Math.ceil(s*t*o.sx),l=Math.ceil(r*n*o.sy),c=u(this,pi);if(!c||c.width===a&&c.height===l)return;c.width=a,c.height=l;let d=u(this,jt)?u(this,Ae):A(this,hc,fg).call(this,a,l),h=c.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(d,0,0,d.width,d.height,0,0,a,l)},fc=new WeakSet,pg=function(t){if(t){if(u(this,jt)){let r=this._uiManager.imageManager.getSvgUrl(u(this,nt));if(r)return r}let n=document.createElement("canvas");return{width:n.width,height:n.height}=u(this,Ae),n.getContext("2d").drawImage(u(this,Ae),0,0),n.toDataURL()}if(u(this,jt)){let[n,s]=this.pageDimensions,r=Math.round(this.width*n*or.PDF_TO_CSS_UNITS),o=Math.round(this.height*s*or.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(r,o);return a.getContext("2d").drawImage(u(this,Ae),0,0,u(this,Ae).width,u(this,Ae).height,0,0,r,o),a.transferToImageBitmap()}return structuredClone(u(this,Ae))},Ty=new WeakSet,GR=function(t){var a;let{pageIndex:n,accessibilityData:{altText:s}}=this._initialData,r=t.pageIndex===n,o=(((a=t.accessibilityData)==null?void 0:a.alt)||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}},Y(gd,"_type","stamp"),Y(gd,"_editorType",j.STAMP);var FS=gd,Wo,pc,mi,nr,ls,mn,ir,gc,Yo,Gn,cs,pt,ds,V,sr,xy,VR,yn,jn,Lh,HS,Oh,BS,mc,gg,xn=class xn{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:s,accessibilityManager:r,annotationLayer:o,drawLayer:a,textLayer:l,viewport:c,l10n:d}){b(this,xy);b(this,yn);b(this,Lh);b(this,Oh);b(this,mc);b(this,Wo,void 0);b(this,pc,!1);b(this,mi,null);b(this,nr,null);b(this,ls,null);b(this,mn,new Map);b(this,ir,!1);b(this,gc,!1);b(this,Yo,!1);b(this,Gn,null);b(this,cs,null);b(this,pt,null);b(this,ds,null);b(this,V,void 0);let h=[...u(xn,sr).values()];if(!xn._initialized){xn._initialized=!0;for(let p of h)p.initialize(d,e)}e.registerEditorTypes(h),w(this,V,e),this.pageIndex=t,this.div=n,w(this,Wo,r),w(this,mi,o),this.viewport=c,w(this,pt,l),this.drawLayer=a,this._structTree=s,u(this,V).addLayer(this)}get isEmpty(){return u(this,mn).size===0}get isInvisible(){return this.isEmpty&&u(this,V).getMode()===j.NONE}updateToolbar(e){u(this,V).updateToolbar(e)}updateMode(e=u(this,V).getMode()){switch(A(this,mc,gg).call(this),e){case j.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case j.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case j.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:t}=this.div;for(let n of u(xn,sr).values())t.toggle(`${n._type}Editing`,e===n._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=u(this,pt))==null?void 0:t.div)}setEditingState(e){u(this,V).setEditingState(e)}addCommands(e){u(this,V).addCommands(e)}cleanUndoStack(e){u(this,V).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=u(this,mi))==null||t.div.classList.toggle("disabled",!e)}async enable(){w(this,Yo,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);let e=new Set;for(let n of u(this,mn).values())n.enableEditing(),n.show(!0),n.annotationElementId&&(u(this,V).removeChangedExistingAnnotation(n),e.add(n.annotationElementId));if(!u(this,mi)){w(this,Yo,!1);return}let t=u(this,mi).getEditableAnnotations();for(let n of t){if(n.hide(),u(this,V).isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;let s=await this.deserialize(n);s&&(this.addOrRebuild(s),s.enableEditing())}w(this,Yo,!1)}disable(){var s;w(this,gc,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);let e=new Map,t=new Map;for(let r of u(this,mn).values())if(r.disableEditing(),!!r.annotationElementId){if(r.serialize()!==null){e.set(r.annotationElementId,r);continue}else t.set(r.annotationElementId,r);(s=this.getEditableAnnotation(r.annotationElementId))==null||s.show(),r.remove()}if(u(this,mi)){let r=u(this,mi).getEditableAnnotations();for(let o of r){let{id:a}=o.data;if(u(this,V).isDeletedAnnotationElement(a))continue;let l=t.get(a);if(l){l.resetAnnotationElement(o),l.show(!1),o.show();continue}l=e.get(a),l&&(u(this,V).addChangedExistingAnnotation(l),l.renderAnnotationElement(o)&&l.show(!1)),o.show()}}A(this,mc,gg).call(this),this.isEmpty&&(this.div.hidden=!0);let{classList:n}=this.div;for(let r of u(xn,sr).values())n.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),w(this,gc,!1)}getEditableAnnotation(e){var t;return((t=u(this,mi))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){u(this,V).getActive()!==e&&u(this,V).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=u(this,pt))!=null&&e.div&&!u(this,ds)){w(this,ds,new AbortController);let t=u(this,V).combinedSignal(u(this,ds));u(this,pt).div.addEventListener("pointerdown",A(this,xy,VR).bind(this),{signal:t}),u(this,pt).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=u(this,pt))!=null&&e.div&&u(this,ds)&&(u(this,ds).abort(),w(this,ds,null),u(this,pt).div.classList.remove("highlighting"))}enableClick(){if(u(this,nr))return;w(this,nr,new AbortController);let e=u(this,V).combinedSignal(u(this,nr));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});let t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=u(this,nr))==null||e.abort(),w(this,nr,null)}attach(e){u(this,mn).set(e.id,e);let{annotationElementId:t}=e;t&&u(this,V).isDeletedAnnotationElement(t)&&u(this,V).removeDeletedAnnotationElement(e)}detach(e){var t;u(this,mn).delete(e.id),(t=u(this,Wo))==null||t.removePointerInTextLayer(e.contentDiv),!u(this,gc)&&e.annotationElementId&&u(this,V).addDeletedAnnotationElement(e)}remove(e){this.detach(e),u(this,V).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(u(this,V).addDeletedAnnotationElement(e.annotationElementId),Ce.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),u(this,V).addEditor(e),this.attach(e),!e.isAttachedToDOM){let t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!u(this,Yo)),u(this,V).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var n;if(!e.isAttachedToDOM)return;let{activeElement:t}=document;e.div.contains(t)&&!u(this,ls)&&(e._focusEventsAllowed=!1,w(this,ls,setTimeout(()=>{w(this,ls,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:u(this,V)._signal}),t.focus())},0))),e._structTreeParentId=(n=u(this,Wo))==null?void 0:n.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){let t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getNextId(){return u(this,V).getId()}combinedSignal(e){return u(this,V).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=u(this,yn,jn))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){u(this,V).updateToolbar(e),u(this,V).updateMode(e);let{offsetX:n,offsetY:s}=A(this,Oh,BS).call(this),r=this.getNextId(),o=A(this,Lh,HS).call(this,{parent:this,id:r,x:n,y:s,uiManager:u(this,V),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t,n;return await((n=u(xn,sr).get((t=e.annotationType)!=null?t:e.annotationEditorType))==null?void 0:n.deserialize(e,this,u(this,V)))||null}createAndAddNewEditor(e,t,n={}){let s=this.getNextId(),r=A(this,Lh,HS).call(this,{parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:u(this,V),isCentered:t,...n});return r&&this.add(r),r}addNewEditor(){this.createAndAddNewEditor(A(this,Oh,BS).call(this),!0)}setSelected(e){u(this,V).setSelected(e)}toggleSelected(e){u(this,V).toggleSelected(e)}unselect(e){u(this,V).unselect(e)}pointerup(e){var n;let{isMac:t}=it.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&u(this,ir)&&(w(this,ir,!1),!((n=u(this,yn,jn))!=null&&n.isDrawer&&u(this,yn,jn).supportMultipleDrawings))){if(!u(this,pc)){w(this,pc,!0);return}if(u(this,V).getMode()===j.STAMP){u(this,V).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var s;if(u(this,V).getMode()===j.HIGHLIGHT&&this.enableTextSelection(),u(this,ir)){w(this,ir,!1);return}let{isMac:t}=it.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(w(this,ir,!0),(s=u(this,yn,jn))!=null&&s.isDrawer){this.startDrawingSession(e);return}let n=u(this,V).getActive();w(this,pc,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus(),u(this,Gn)){u(this,yn,jn).startDrawing(this,u(this,V),!1,e);return}u(this,V).setCurrentDrawingSession(this),w(this,Gn,new AbortController);let t=u(this,V).combinedSignal(u(this,Gn));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(w(this,cs,null),this.commitOrRemove())},{signal:t}),u(this,yn,jn).startDrawing(this,u(this,V),!1,e)}pause(e){if(e){let{activeElement:t}=document;this.div.contains(t)&&w(this,cs,t);return}u(this,cs)&&setTimeout(()=>{var t;(t=u(this,cs))==null||t.focus(),w(this,cs,null)},0)}endDrawingSession(e=!1){return u(this,Gn)?(u(this,V).setCurrentDrawingSession(null),u(this,Gn).abort(),w(this,Gn,null),w(this,cs,null),u(this,yn,jn).endDrawing(e)):null}findNewParent(e,t,n){let s=u(this,V).findParent(t,n);return s===null||s===this?!1:(s.changeParent(e),!0)}commitOrRemove(){return u(this,Gn)?(this.endDrawingSession(),!0):!1}onScaleChanging(){u(this,Gn)&&u(this,yn,jn).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=u(this,V).getActive())==null?void 0:e.parent)===this&&(u(this,V).commitOrRemove(),u(this,V).setActiveEditor(null)),u(this,ls)&&(clearTimeout(u(this,ls)),w(this,ls,null));for(let n of u(this,mn).values())(t=u(this,Wo))==null||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,u(this,mn).clear(),u(this,V).removeLayer(this)}render({viewport:e}){this.viewport=e,Xo(this.div,e);for(let t of u(this,V).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){u(this,V).commitOrRemove(),A(this,mc,gg).call(this);let t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,Xo(this.div,{rotation:n}),t!==n)for(let s of u(this,mn).values())s.rotate(n)}get pageDimensions(){let{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return u(this,V).viewParameters.realScale}};Wo=new WeakMap,pc=new WeakMap,mi=new WeakMap,nr=new WeakMap,ls=new WeakMap,mn=new WeakMap,ir=new WeakMap,gc=new WeakMap,Yo=new WeakMap,Gn=new WeakMap,cs=new WeakMap,pt=new WeakMap,ds=new WeakMap,V=new WeakMap,sr=new WeakMap,xy=new WeakSet,VR=function(e){u(this,V).unselectAll();let{target:t}=e;if(t===u(this,pt).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&u(this,pt).div.contains(t)){let{isMac:n}=it.platform;if(e.button!==0||e.ctrlKey&&n)return;u(this,V).showAllEditors("highlight",!0,!0),u(this,pt).div.classList.add("free"),this.toggleDrawing(),zg.startHighlighting(this,u(this,V).direction==="ltr",{target:u(this,pt).div,x:e.x,y:e.y}),u(this,pt).div.addEventListener("pointerup",()=>{u(this,pt).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:u(this,V)._signal}),e.preventDefault()}},yn=new WeakSet,jn=function(){return u(xn,sr).get(u(this,V).getMode())},Lh=new WeakSet,HS=function(e){let t=u(this,yn,jn);return t?new t.prototype.constructor(e):null},Oh=new WeakSet,BS=function(){let{x:e,y:t,width:n,height:s}=this.div.getBoundingClientRect(),r=Math.max(0,e),o=Math.max(0,t),a=Math.min(window.innerWidth,e+n),l=Math.min(window.innerHeight,t+s),c=(r+a)/2-e,d=(o+l)/2-t,[h,p]=this.viewport.rotation%180===0?[c,d]:[d,c];return{offsetX:h,offsetY:p}},mc=new WeakSet,gg=function(){for(let e of u(this,mn).values())e.isEmpty()&&e.remove()},Y(xn,"_initialized",!1),b(xn,sr,new Map([yS,NS,FS,zg].map(e=>[e._editorType,e])));var US=xn,Vn,Uh,Ct,Ko,Ry,$R,Hh,VS,Iy,zR,Bh,$S,dt=class dt{constructor({pageIndex:e}){b(this,Hh);b(this,Iy);b(this,Bh);b(this,Vn,null);b(this,Uh,0);b(this,Ct,new Map);b(this,Ko,new Map);this.pageIndex=e}setParent(e){if(!u(this,Vn)){w(this,Vn,e);return}if(u(this,Vn)!==e){if(u(this,Ct).size>0)for(let t of u(this,Ct).values())t.remove(),e.append(t);w(this,Vn,e)}}static get _svgFactory(){return se(this,"_svgFactory",new Cd)}draw(e,t=!1,n=!1){let s=vt(this,Uh)._++,r=A(this,Hh,VS).call(this),o=dt._svgFactory.createElement("defs");r.append(o);let a=dt._svgFactory.createElement("path");o.append(a);let l=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&u(this,Ko).set(s,a);let c=n?A(this,Iy,zR).call(this,o,l):null,d=dt._svgFactory.createElement("use");return r.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(r,e),u(this,Ct).set(s,r),{id:s,clipPathId:`url(#${c})`}}drawOutline(e,t){let n=vt(this,Uh)._++,s=A(this,Hh,VS).call(this),r=dt._svgFactory.createElement("defs");s.append(r);let o=dt._svgFactory.createElement("path");r.append(o);let a=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){let h=dt._svgFactory.createElement("mask");r.append(h),l=`mask_p${this.pageIndex}_${n}`,h.setAttribute("id",l),h.setAttribute("maskUnits","objectBoundingBox");let p=dt._svgFactory.createElement("rect");h.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");let m=dt._svgFactory.createElement("use");h.append(m),m.setAttribute("href",`#${a}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}let c=dt._svgFactory.createElement("use");s.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);let d=c.cloneNode();return s.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(s,e),u(this,Ct).set(n,s),n}finalizeDraw(e,t){u(this,Ko).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;let{root:n,bbox:s,rootClass:r,path:o}=t,a=typeof e=="number"?u(this,Ct).get(e):e;if(a){if(n&&A(this,Bh,$S).call(this,a,n),s&&A(l=dt,Ry,$R).call(l,a,s),r){let{classList:c}=a;for(let[d,h]of Object.entries(r))c.toggle(d,h)}if(o){let d=a.firstChild.firstChild;A(this,Bh,$S).call(this,d,o)}}}updateParent(e,t){if(t===this)return;let n=u(this,Ct).get(e);n&&(u(t,Vn).append(n),u(this,Ct).delete(e),u(t,Ct).set(e,n))}remove(e){u(this,Ko).delete(e),u(this,Vn)!==null&&(u(this,Ct).get(e).remove(),u(this,Ct).delete(e))}destroy(){w(this,Vn,null);for(let e of u(this,Ct).values())e.remove();u(this,Ct).clear(),u(this,Ko).clear()}};Vn=new WeakMap,Uh=new WeakMap,Ct=new WeakMap,Ko=new WeakMap,Ry=new WeakSet,$R=function(e,[t,n,s,r]){let{style:o}=e;o.top=`${100*n}%`,o.left=`${100*t}%`,o.width=`${100*s}%`,o.height=`${100*r}%`},Hh=new WeakSet,VS=function(){let e=dt._svgFactory.create(1,1,!0);return u(this,Vn).append(e),e.setAttribute("aria-hidden",!0),e},Iy=new WeakSet,zR=function(e,t){let n=dt._svgFactory.createElement("clipPath");e.append(n);let s=`clip_${t}`;n.setAttribute("id",s),n.setAttribute("clipPathUnits","objectBoundingBox");let r=dt._svgFactory.createElement("use");return n.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),s},Bh=new WeakSet,$S=function(e,t){for(let[n,s]of Object.entries(t))s===null?e.removeAttribute(n):e.setAttribute(n,s)},b(dt,Ry);var GS=dt;globalThis.pdfjsTestingUtils={HighlightOutliner:xd};var D$=K.AbortException,P$=K.AnnotationEditorLayer,M$=K.AnnotationEditorParamsType,k$=K.AnnotationEditorType,N$=K.AnnotationEditorUIManager,F$=K.AnnotationLayer,L$=K.AnnotationMode,O$=K.ColorPicker,U$=K.DOMSVGFactory,H$=K.DrawLayer,B$=K.FeatureTest,qR=K.GlobalWorkerOptions,G$=K.ImageKind,V$=K.InvalidPDFException,$$=K.MissingPDFException,z$=K.OPS,q$=K.OutputScale,W$=K.PDFDataRangeTransport,Y$=K.PDFDateString,K$=K.PDFWorker,J$=K.PasswordResponses,X$=K.PermissionFlag,Z$=K.PixelsPerInch,j$=K.RenderingCancelledException,Q$=K.TextLayer,e2=K.TouchManager,t2=K.UnexpectedResponseException,n2=K.Util,i2=K.VerbosityLevel,s2=K.XfaLayer,r2=K.build,o2=K.createValidAbsoluteUrl,a2=K.fetchData,Uy=K.getDocument,l2=K.getFilenameFromUrl,c2=K.getPdfFilenameFromUrl,d2=K.getXfaPageViewport,u2=K.isDataScheme,h2=K.isPdfFile,f2=K.noContextMenu,p2=K.normalizeUnicode,g2=K.setLayerDimensions,m2=K.shadow,y2=K.stopEvent,v2=K.version;qR.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.mjs";var Hy=class{constructor(e=50){this.minTextThreshold=e}async extractText(e){let t=await Uy({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,n="";for(let o=1;o<=t.numPages;o++){let c=(await(await t.getPage(o)).getTextContent()).items.map(d=>d.str||"").join(" ");n+=`
## \uD398\uC774\uC9C0 ${o}

${c}
`}let r=n.replace(/\s/g,"").length/t.numPages<this.minTextThreshold;return{text:n,isScanned:r,numPages:t.numPages}}async renderPagesToImages(e,t){let n=await Uy({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,s=[],r=t?Math.min(n.numPages,t):n.numPages;for(let o=1;o<=r;o++){let a=await n.getPage(o),l=a.getViewport({scale:2}),c=document.createElement("canvas");c.width=l.width,c.height=l.height;let d=c.getContext("2d");await a.render({canvasContext:d,viewport:l}).promise;let h=c.toDataURL("image/png").split(",")[1];s.push({base64:h,mimeType:"image/png",pageNum:o})}return s}async getPageCount(e){return(await Uy({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise).numPages}};var By=class{constructor(e,t,n){this.gemini=e,this.settings=t,this.vault=n,this.pdfProcessor=new Hy(t.ocrMinTextThreshold),this.dailyUsage=this.loadDailyUsage()}loadDailyUsage(){return{date:Jn(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}saveDailyUsage(){}checkDailyLimit(e){let t=Jn(this.settings.timezone);this.dailyUsage.date!==t&&(this.dailyUsage={date:t,pagesProcessed:0,filesProcessed:0});let n=this.settings.ocrDailyLimit-this.dailyUsage.pagesProcessed;return{allowed:e<=n,remaining:n}}getFileSizeMB(e){return e.stat.size/(1024*1024)}async checkLimits(e){let t=this.getFileSizeMB(e);if(t>this.settings.ocrMaxFileSizeMB)return{allowed:!1,reason:`\uD30C\uC77C \uD06C\uAE30(${t.toFixed(1)}MB)\uAC00 \uC81C\uD55C(${this.settings.ocrMaxFileSizeMB}MB)\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,fileSize:t};if(e.extension==="pdf"){let s=await this.vault.readBinary(e),r=await this.pdfProcessor.getPageCount(s);if(r>this.settings.ocrMaxPages)return{allowed:!1,reason:`\uD398\uC774\uC9C0 \uC218(${r})\uAC00 \uC81C\uD55C(${this.settings.ocrMaxPages})\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,pageCount:r,fileSize:t};let o=this.checkDailyLimit(r);return o.allowed?{allowed:!0,pageCount:r,fileSize:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${o.remaining})`,pageCount:r,fileSize:t}}let n=this.checkDailyLimit(1);return n.allowed?{allowed:!0,pageCount:1,fileSize:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${n.remaining})`,pageCount:1,fileSize:t}}async processImage(e){let t=await this.vault.readBinary(e),n=this.arrayBufferToBase64(t),s=this.getMimeType(e.extension),r=await this.gemini.extractTextFromImage(n,s);return this.dailyUsage.pagesProcessed+=1,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:r,pages:1,sourceType:"image",sourceFile:e.name}}async processPDF(e,t=!1,n){let s=await this.vault.readBinary(e),r=n||this.settings.ocrMaxPages,o=await this.pdfProcessor.extractText(s);if(!o.isScanned&&!t)return{text:o.text,pages:o.numPages,sourceType:"pdf_text",sourceFile:e.name};let a=Math.min(o.numPages,r);new eA.Notice(`\uC2A4\uCE94 PDF \uAC10\uC9C0\uB428. OCR \uCC98\uB9AC \uC911... (${a}\uD398\uC774\uC9C0)`);let l=await this.pdfProcessor.renderPagesToImages(s,r),c=await this.gemini.extractTextFromImages(l,(h,p)=>{new eA.Notice(`OCR \uC9C4\uD589 \uC911: ${h}/${p} \uD398\uC774\uC9C0`,1500)}),d="";for(let h=0;h<c.length;h++)d+=`
## \uD398\uC774\uC9C0 ${h+1}

${c[h]}
`;return this.dailyUsage.pagesProcessed+=c.length,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:d,pages:c.length,sourceType:"pdf_scanned",sourceFile:e.name}}async processFile(e,t){let n=e.extension.toLowerCase();if(["png","jpg","jpeg","webp","gif"].includes(n))return this.processImage(e);if(n==="pdf")return this.processPDF(e,!1,t);throw new Error(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD: ${n}`)}generateMarkdownNote(e){let t=Oe(this.settings.timezone,this.settings.dateFormat),n={image:"\uC774\uBBF8\uC9C0",pdf_text:"PDF (\uD14D\uC2A4\uD2B8)",pdf_scanned:"PDF (\uC2A4\uCE94/OCR)"}[e.sourceType];return`---
type: ocr
source_file: "${e.sourceFile}"
source_type: ${e.sourceType}
pages: ${e.pages}
ocr_at: ${t}
---

# OCR: ${e.sourceFile.replace(/\.[^.]+$/,"")}

> \uC6D0\uBCF8: ${e.sourceFile} | \uCC98\uB9AC \uBC29\uC2DD: ${n} | ${e.pages}\uD398\uC774\uC9C0

${e.text}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}generateSummarizedNote(e,t){let n=Oe(this.settings.timezone,this.settings.dateFormat);return`---
type: ocr
source_file: "${e.sourceFile}"
source_type: ${e.sourceType}
title: "${t.title}"
pages: ${e.pages}
ocr_at: ${n}
---

# ${t.title}

## \uC694\uC57D
${t.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${t.keyPoints.map(s=>`- ${s}`).join(`
`)}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}arrayBufferToBase64(e){let t="",n=new Uint8Array(e);for(let s=0;s<n.byteLength;s++)t+=String.fromCharCode(n[s]);return btoa(t)}getMimeType(e){return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/webp",gif:"image/gif"}[e.toLowerCase()]||"image/png"}getDailyUsage(){return{...this.dailyUsage}}};var Gy=class{constructor(e,t,n){this.embeddingManager=null;this.index=new Map;this.app=e,this.gemini=t,this.settings=n}setEmbeddingManager(e){this.embeddingManager=e}updateSettings(e){this.settings=e}async buildIndex(){this.index.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e)try{let n=await this.indexNote(t);n&&this.index.set(t.path,n)}catch(n){console.error(`\uC778\uB371\uC2F1 \uC2E4\uD328: ${t.path}`,n)}console.log(`\uC778\uB371\uC2A4 \uAD6C\uCD95 \uC644\uB8CC: ${this.index.size}\uAC1C \uB178\uD2B8`)}async indexNote(e){let t=this.app.metadataCache.getFileCache(e),n=t==null?void 0:t.frontmatter,s=[];n!=null&&n.keywords&&(s=Array.isArray(n.keywords)?n.keywords:[n.keywords]);let r;if(n!=null&&n.targetType){let l=n.targetType;["project","library","archive"].includes(l)&&(r=l)}let o=(n==null?void 0:n.title)||e.basename,a=n==null?void 0:n.type;return{path:e.path,title:o,keywords:s,category:r,project:n==null?void 0:n.project,type:a}}async updateIndex(e){let t=await this.indexNote(e);t&&this.index.set(e.path,t)}removeFromIndex(e){this.index.delete(e)}async findRelated(e,t,n){if(this.settings.embeddingEnabled&&this.embeddingManager)try{let s=await this.findRelatedByEmbedding(e,t,n);if(s.length>0)return s}catch(s){console.error("Embedding \uAE30\uBC18 \uAC80\uC0C9 \uC2E4\uD328, \uD0A4\uC6CC\uB4DC \uBC29\uC2DD\uC73C\uB85C \uD3F4\uBC31:",s)}return this.findRelatedByKeywords(e,t,n)}async findRelatedByEmbedding(e,t,n){if(!this.embeddingManager)return[];let s=await this.gemini.generateEmbedding(e);if(s.length===0)return[];let r=this.embeddingManager.findSimilarNotes(s,10,n);if(r.length===0)return[];let o=[];for(let a of r){let l=this.index.get(a.path);l&&o.push({note:l,relevance:a.similarity,matchedKeywords:[],reason:`\uC758\uBBF8 \uC720\uC0AC\uB3C4: ${Math.round(a.similarity*100)}%`,connectionType:""})}return o}async findRelatedByKeywords(e,t,n){let s=await this.gemini.extractKeywords(e);if(s.length===0)return[];let r=this.filterByKeywords(s,n);if(r.length===0)return[];let o=r.map((c,d)=>`${d}. ${c.note.title} (\uD0A4\uC6CC\uB4DC: ${c.note.keywords.join(", ")})`).join(`
`),a=await this.gemini.findRelatedNotes(t,s,o),l=[];for(let c of a)if(c.index>=0&&c.index<r.length){let d=r[c.index];l.push({note:d.note,relevance:c.relevance,matchedKeywords:d.matchedKeywords,reason:c.reason||"",connectionType:c.type||""})}return l}filterByKeywords(e,t){let n=[],s=new Set(e.map(r=>r.toLowerCase()));for(let[r,o]of this.index){if(t&&r===t||o.keywords.length===0)continue;let a=[];for(let l of o.keywords){let c=l.toLowerCase();for(let d of s)if(c===d||c.includes(d)||d.includes(c)){a.push(l);break}}a.length>0&&n.push({note:o,matchedKeywords:a})}return n.sort((r,o)=>o.matchedKeywords.length-r.matchedKeywords.length),n.slice(0,10)}async saveKeywordsToNote(e,t){let n=await this.app.vault.read(e),s=this.updateFrontmatterKeywords(n,t);await this.app.vault.modify(e,s),await this.updateIndex(e)}updateFrontmatterKeywords(e,t){let n=`keywords: [${t.map(r=>`"${r}"`).join(", ")}]`,s=e.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(s){let r=s[1];if(/^keywords:/m.test(r)){let o=r.replace(/^keywords:.*$/m,n);return e.replace(/^---\r?\n[\s\S]*?\r?\n---/,`---
${o}
---`)}else return e.replace(/^---\r?\n([\s\S]*?)\r?\n---/,`---
$1
${n}
---`)}else return`---
${n}
---

${e}`}async addRelatedLinks(e,t){if(t.length===0)return;let n=await this.app.vault.read(e),s=`

---
## \uAD00\uB828 \uB178\uD2B8
${t.map(a=>{let l=a.note.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]] (\uAD00\uB828\uB3C4: ${Math.round(a.relevance*100)}%)`}).join(`
`)}
`,r=/\n---\n##  \n[\s\S]*?(?=\n---\n|$)/,o;r.test(n)?o=n.replace(r,s):o=n+s,await this.app.vault.modify(e,o)}getIndexSize(){return this.index.size}getZettelIndex(){let e=new Map;for(let[t,n]of this.index)n.type==="zettel"&&e.set(t,n);return e}getZettelCount(){return this.getZettelIndex().size}async findRelatedZettels(e,t){if(e.length===0)return[];let n=this.getZettelIndex();if(n.size===0)return[];let s=this.filterZettelsByKeywords(e,n,t);if(s.length===0)return[];let r=s.map((l,c)=>`${c}. ${l.note.title} (\uD0A4\uC6CC\uB4DC: ${l.note.keywords.join(", ")})`).join(`
`),o=await this.gemini.findRelatedNotes("\uC0C8 ZK \uB178\uD2B8",e,r),a=[];for(let l of o)if(l.index>=0&&l.index<s.length){let c=s[l.index];a.push({note:c.note,relevance:l.relevance,matchedKeywords:c.matchedKeywords,reason:l.reason||"",connectionType:l.type||""})}return a}filterZettelsByKeywords(e,t,n){let s=[],r=new Set(e.map(o=>o.toLowerCase()));for(let[o,a]of t){if(n&&o===n||a.keywords.length===0)continue;let l=[];for(let c of a.keywords){let d=c.toLowerCase();for(let h of r)if(d===h||d.includes(h)||h.includes(d)){l.push(c);break}}l.length>0&&s.push({note:a,matchedKeywords:l})}return s.sort((o,a)=>a.matchedKeywords.length-o.matchedKeywords.length),s.slice(0,10)}};var WR=require("obsidian"),Vy={version:1,model:"text-embedding-004",dimensions:768,lastFullScan:"",notes:{}},$y=class{constructor(e,t,n){this.isInitialized=!1;this.app=e,this.gemini=t,this.settings=n,this.index={...Vy},this.indexPath=".obsidian/plugins/zero-friction-brain/embeddings.json"}async loadIndex(){try{let e=this.app.vault.adapter;if(await e.exists(this.indexPath)){let t=await e.read(this.indexPath),n=JSON.parse(t);this.index={...Vy,...n}}this.isInitialized=!0}catch(e){console.error("Embedding \uC778\uB371\uC2A4 \uB85C\uB4DC \uC2E4\uD328:",e),this.index={...Vy},this.isInitialized=!0}}async saveIndex(){try{let e=this.app.vault.adapter,t=JSON.stringify(this.index,null,2);await e.write(this.indexPath,t)}catch(e){console.error("Embedding \uC778\uB371\uC2A4 \uC800\uC7A5 \uC2E4\uD328:",e)}}computeContentHash(e){let t=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);t=(t<<5)-t+s,t|=0}return t.toString(16)}async updateNoteEmbedding(e,t=!1){if(!this.settings.embeddingEnabled)return!1;try{let n=await this.app.vault.cachedRead(e),s=this.computeContentHash(n),r=this.index.notes[e.path];if(!t&&r&&r.contentHash===s)return!1;let o=await this.gemini.generateEmbedding(n);return o.length===0?(console.warn("\uC784\uBCA0\uB529 \uC0DD\uC131 \uC2E4\uD328:",e.path),!1):(this.index.notes[e.path]={embedding:o,contentHash:s,updatedAt:new Date().toISOString()},!0)}catch(n){return console.error("\uB178\uD2B8 \uC784\uBCA0\uB529 \uC5C5\uB370\uC774\uD2B8 \uC2E4\uD328:",e.path,n),!1}}removeNote(e){this.index.notes[e]&&delete this.index.notes[e]}renameNote(e,t){this.index.notes[e]&&(this.index.notes[t]=this.index.notes[e],delete this.index.notes[e])}cosineSimilarity(e,t){if(e.length!==t.length||e.length===0)return 0;let n=0,s=0,r=0;for(let a=0;a<e.length;a++)n+=e[a]*t[a],s+=e[a]*e[a],r+=t[a]*t[a];let o=Math.sqrt(s)*Math.sqrt(r);return o===0?0:n/o}findSimilarNotes(e,t=10,n,s){if(e.length===0)return[];let r=s!=null?s:this.settings.embeddingSimilarityThreshold,o=[];for(let[a,l]of Object.entries(this.index.notes)){if(a===n||!l.embedding||l.embedding.length===0)continue;let c=this.cosineSimilarity(e,l.embedding);c>=r&&o.push({path:a,similarity:c})}return o.sort((a,l)=>l.similarity-a.similarity).slice(0,t)}async findSimilarNotesByText(e,t=10,n,s){if(!this.settings.embeddingEnabled)return[];try{let r=await this.gemini.generateEmbedding(e);return this.findSimilarNotes(r,t,n,s)}catch(r){return console.error("\uD14D\uC2A4\uD2B8 \uAE30\uBC18 \uC720\uC0AC \uB178\uD2B8 \uAC80\uC0C9 \uC2E4\uD328:",r),[]}}getEmbedding(e){var t;return(t=this.index.notes[e])==null?void 0:t.embedding}hasEmbedding(e){var t;return!!((t=this.index.notes[e])!=null&&t.embedding)}getStats(){return{totalNotes:Object.keys(this.index.notes).length,lastFullScan:this.index.lastFullScan,model:this.index.model,dimensions:this.index.dimensions}}async buildFullIndex(e){if(!this.settings.embeddingEnabled)return{success:0,failed:0,skipped:0};let t=this.app.vault.getMarkdownFiles(),n=0,s=0,r=0;for(let o=0;o<t.length;o++){let a=t[o];e&&e(o+1,t.length,a.path);try{await this.updateNoteEmbedding(a,!1)?n++:r++}catch(l){s++}(o+1)%10===0&&await this.saveIndex()}return this.index.lastFullScan=new Date().toISOString(),await this.saveIndex(),{success:n,failed:s,skipped:r}}async buildFolderIndex(e,t){if(!this.settings.embeddingEnabled)return{success:0,failed:0};let n=this.app.vault.getMarkdownFiles().filter(o=>o.path.startsWith(e)),s=0,r=0;for(let o=0;o<n.length;o++){let a=n[o];t&&t(o+1,n.length);try{await this.updateNoteEmbedding(a,!0),s++}catch(l){r++}}return await this.saveIndex(),{success:s,failed:r}}mergeWithNoteIndex(e){let t=this.index.notes[e.path];return t?{...e,embedding:t.embedding,embeddingUpdatedAt:t.updatedAt,contentHash:t.contentHash}:e}async clearIndex(){this.index={...Vy},await this.saveIndex()}async cleanupOrphanedEmbeddings(){let e=[];for(let t of Object.keys(this.index.notes)){let n=this.app.vault.getAbstractFileByPath(t);(!n||!(n instanceof WR.TFile))&&e.push(t)}for(let t of e)delete this.index.notes[t];return e.length>0&&await this.saveIndex(),e.length}};var YR=require("obsidian"),vU=`\uB2F9\uC2E0\uC740 \uC0AC\uC6A9\uC790\uC758 \uAC1C\uC778 \uC9C0\uC2DD \uBCA0\uC774\uC2A4(Second Brain)\uB97C \uAE30\uBC18\uC73C\uB85C \uB300\uD654\uD558\uB294 AI \uC5B4\uC2DC\uC2A4\uD134\uD2B8\uC785\uB2C8\uB2E4.

## \uD575\uC2EC \uC6D0\uCE59
- \uC790\uC5F0\uC2A4\uB7EC\uC6B4 \uB300\uD654\uB97C \uC720\uC9C0\uD558\uC138\uC694
- \uCC38\uACE0 \uB178\uD2B8\uAC00 \uC788\uC73C\uBA74 [[\uB178\uD2B8 \uC81C\uBAA9]] \uD615\uC2DD\uC73C\uB85C \uC5B8\uAE09\uD558\uC138\uC694
- \uCC38\uACE0 \uB178\uD2B8\uAC00 \uC5C6\uAC70\uB098 \uAD00\uB828\uC131\uC774 \uB0AE\uC544\uB3C4, \uC774\uC804 \uB300\uD654 \uB9E5\uB77D\uC744 \uD65C\uC6A9\uD574 \uB2F5\uBCC0\uD558\uC138\uC694
- \uC815\uB9D0 \uBAA8\uB974\uB294 \uACBD\uC6B0\uC5D0\uB9CC "\uAD00\uB828 \uB178\uD2B8\uB97C \uCC3E\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4"\uB77C\uACE0 \uD558\uC138\uC694

## \uB2F5\uBCC0 \uBC29\uC2DD
1. \uAD00\uB828 \uB178\uD2B8\uAC00 \uC788\uC73C\uBA74: \uB178\uD2B8 \uB0B4\uC6A9\uC744 \uAE30\uBC18\uC73C\uB85C \uB2F5\uBCC0 + [[\uB178\uD2B8]] \uB9C1\uD06C
2. \uAD00\uB828 \uB178\uD2B8\uAC00 \uC5C6\uC9C0\uB9CC \uB300\uD654 \uB9E5\uB77D\uC774 \uC788\uC73C\uBA74: \uB9E5\uB77D\uC744 \uD65C\uC6A9\uD574 \uB300\uD654 \uC774\uC5B4\uAC00\uAE30
3. \uC644\uC804\uD788 \uC0C8\uB85C\uC6B4 \uC8FC\uC81C\uBA74: \uC77C\uBC18 \uC9C0\uC2DD\uC73C\uB85C \uB2F5\uBCC0\uD558\uAC70\uB098 \uAD00\uB828 \uB178\uD2B8\uAC00 \uC5C6\uB2E4\uACE0 \uC548\uB0B4

## \uC8FC\uC758\uC0AC\uD56D
- \uD55C\uAD6D\uC5B4\uB85C \uB2F5\uBCC0
- \uAC04\uACB0\uD558\uACE0 \uBA85\uD655\uD558\uAC8C
- \uC5EC\uB7EC \uB178\uD2B8 \uC815\uBCF4 \uC885\uD569 \uAC00\uB2A5`,zy=class{constructor(e,t,n,s){this.app=e,this.gemini=t,this.embeddingManager=n,this.settings=s}async chat(e,t=[]){let n=this.buildSearchQuery(e,t),s=await this.retrieveContext(n,this.settings.ragTopK),r=this.buildContext(s),o=this.buildPrompt(e,r,t),a=await this.gemini.generateContent(o),l=s.map(c=>c.path);return{answer:a,references:l}}buildSearchQuery(e,t){return e.length<20&&t.length>0?`${t.slice(-4).map(s=>s.content).join(" ")} ${e}`:e}async retrieveContext(e,t){let n=[];try{if(!this.settings.embeddingEnabled)return console.warn("RAG: Embedding\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4."),[];let s=await this.embeddingManager.findSimilarNotesByText(e,t,void 0,.5);for(let r of s){let o=this.app.vault.getAbstractFileByPath(r.path);if(!(o instanceof YR.TFile))continue;let a=await this.app.vault.cachedRead(o),l=Math.floor(this.settings.ragMaxContextLength/t),c=this.truncateContent(a,l),d=o.basename;n.push({path:r.path,title:d,content:c,similarity:r.similarity})}}catch(s){console.error("RAG \uAC80\uC0C9 \uC2E4\uD328:",s)}return n}truncateContent(e,t){let n=e.replace(/^---[\s\S]*?---\n?/,"");if(n.length<=t)return n;let s=n.substring(0,t),r=Math.max(s.lastIndexOf("\u3002"),s.lastIndexOf("."),s.lastIndexOf(`
`));return r>t*.7?s.substring(0,r+1)+"...":s+"..."}buildContext(e){if(e.length===0)return"\uCC38\uACE0\uD560 \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.";let t=[];for(let n of e){let s=Math.round(n.similarity*100);t.push(`### [[${n.title}]] (\uC720\uC0AC\uB3C4: ${s}%)
${n.content}`)}return t.join(`

`)}buildPrompt(e,t,n){let s=[vU];if(s.push(`
## \uCC38\uACE0 \uB178\uD2B8`),s.push(t),n.length>0){let r=n.slice(-6);s.push(`
## \uC774\uC804 \uB300\uD654`);for(let o of r){let a=o.role==="user"?"\uC0AC\uC6A9\uC790":"AI";s.push(`${a}: ${o.content}`)}}return s.push(`
## \uC9C8\uBB38`),s.push(e),s.join(`
`)}updateSettings(e){this.settings=e}isAvailable(){return this.settings.embeddingEnabled&&this.settings.ragEnabled}getIndexedNoteCount(){return this.embeddingManager.getStats().totalNotes}};var JR=require("obsidian");function KR(){return Date.now().toString(36)+Math.random().toString(36).substring(2,9)}var qy=class{constructor(e,t){this.sessions=[];this.isInitialized=!1;this.app=e,this.settings=t,this.storagePath=".obsidian/plugins/zero-friction-brain/chats.json"}async loadSessions(){try{let e=this.app.vault.adapter;if(await e.exists(this.storagePath)){let t=await e.read(this.storagePath),n=JSON.parse(t);this.sessions=n.sessions||[]}this.isInitialized=!0}catch(e){console.error("\uCC44\uD305 \uC800\uC7A5\uC18C \uB85C\uB4DC \uC2E4\uD328:",e),this.sessions=[],this.isInitialized=!0}}async saveSessions(){try{let e=this.app.vault.adapter,t={version:1,sessions:this.sessions},n=JSON.stringify(t,null,2);await e.write(this.storagePath,n)}catch(e){console.error("\uCC44\uD305 \uC800\uC7A5\uC18C \uC800\uC7A5 \uC2E4\uD328:",e)}}getAllSessions(){return[...this.sessions].sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime())}getSession(e){return this.sessions.find(t=>t.id===e)}createSession(e){let t=new Date().toISOString(),n={id:KR(),title:e||"\uC0C8 \uB300\uD654",messages:[],createdAt:t,updatedAt:t};return this.sessions.unshift(n),this.saveSessions(),n}deleteSession(e){let t=this.sessions.findIndex(n=>n.id===e);t!==-1&&(this.sessions.splice(t,1),this.saveSessions())}updateSessionTitle(e,t){let n=this.getSession(e);n&&(n.title=t,n.updatedAt=new Date().toISOString(),this.saveSessions())}addMessage(e,t){let n=this.getSession(e);if(!n)throw new Error(`\uC138\uC158\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4: ${e}`);let s={...t,id:KR(),timestamp:new Date().toISOString()};if(n.messages.push(s),n.updatedAt=s.timestamp,n.title==="\uC0C8 \uB300\uD654"&&t.role==="user"){let r=t.content.slice(0,30)+(t.content.length>30?"...":"");n.title=r}return this.saveSessions(),s}async exportToNote(e,t){var p;let n=this.getSession(e);if(!n||n.messages.length===0)return null;let s=new Set;n.messages.forEach(m=>{m.references&&m.references.forEach(y=>s.add(y))});let r=["---","type: chat-export",`exported: ${new Date().toISOString().split("T")[0]}`,`session_id: ${n.id}`,"---","",`# ${n.title}`,"","## \uB300\uD654 \uB0B4\uC6A9",""];for(let m of n.messages){let y=m.role==="user"?"**\uC0AC\uC6A9\uC790**":"**AI**";r.push(`${y}: ${m.content}`),r.push("")}if(s.size>0){r.push("## \uCC38\uC870\uD55C \uB178\uD2B8");for(let m of s){let y=((p=m.split("/").pop())==null?void 0:p.replace(/\.md$/,""))||m;r.push(`- [[${y}]]`)}r.push("")}let o=r.join(`
`),a=n.title.replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g," ").trim(),c=`${new Date().toISOString().slice(0,10)} ${a}.md`,d=t||this.settings.libraryFolder,h=(0,JR.normalizePath)(`${d}/${c}`);try{return await this.app.vault.create(h,o)}catch(m){return console.error("\uB178\uD2B8 \uB0B4\uBCF4\uB0B4\uAE30 \uC2E4\uD328:",m),null}}getSessionCount(){return this.sessions.length}getRecentSession(){if(this.sessions.length!==0)return this.getAllSessions()[0]}};var tn=require("obsidian"),vc="zfb-rag-chatbot",Vh=class extends tn.ItemView{constructor(t,n,s,r){super(t);this.currentSession=null;this.messagesContainer=null;this.inputEl=null;this.isProcessing=!1;this.settings=n,this.ragEngine=s,this.chatStorage=r}getViewType(){return vc}getDisplayText(){return"AI \uCC57\uBD07"}getIcon(){return"bot"}async onOpen(){await this.render()}async onClose(){this.contentEl.empty()}async render(){let t=this.contentEl;if(t.empty(),t.addClass("zfb-chatbot"),this.renderHeader(t),this.messagesContainer=t.createDiv({cls:"chat-messages"}),this.renderMessages(),this.renderInputArea(t),!this.currentSession){let n=this.chatStorage.getRecentSession();n&&(this.currentSession=n,this.renderMessages())}}renderHeader(t){var h;let n=t.createDiv({cls:"chat-header"}),r=n.createDiv({cls:"session-selector"}).createEl("select",{cls:"session-select"}),o=r.createEl("option",{text:"+ \uC0C8 \uB300\uD654",value:"__new__"}),a=this.chatStorage.getAllSessions();for(let p of a){let m=r.createEl("option",{text:p.title,value:p.id});((h=this.currentSession)==null?void 0:h.id)===p.id&&(m.selected=!0)}r.addEventListener("change",()=>{let p=r.value;if(p==="__new__")this.handleNewSession();else{let m=this.chatStorage.getSession(p);m&&(this.currentSession=m,this.renderMessages())}});let l=n.createDiv({cls:"header-buttons"}),c=l.createEl("button",{cls:"header-btn",attr:{title:"\uB178\uD2B8\uB85C \uB0B4\uBCF4\uB0B4\uAE30"}});c.innerHTML="\u{1F4E4}",c.addEventListener("click",()=>this.handleExport());let d=l.createEl("button",{cls:"header-btn",attr:{title:"\uB300\uD654 \uC0AD\uC81C"}});d.innerHTML="\u{1F5D1}\uFE0F",d.addEventListener("click",()=>this.handleDelete())}renderMessages(){if(this.messagesContainer){if(this.messagesContainer.empty(),!this.currentSession||this.currentSession.messages.length===0){let t=this.messagesContainer.createDiv({cls:"chat-empty"});t.createEl("p",{text:"\u{1F9E0} Second Brain\uC5D0 \uC9C8\uBB38\uD558\uC138\uC694"}),t.createEl("small",{text:"\uB178\uD2B8\uB97C \uAE30\uBC18\uC73C\uB85C \uB2F5\uBCC0\uD569\uB2C8\uB2E4",cls:"text-muted"});let n=this.ragEngine.getIndexedNoteCount();n===0?t.createEl("p",{text:"\u26A0\uFE0F Embedding \uC778\uB371\uC2A4\uAC00 \uBE44\uC5B4 \uC788\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C \uC778\uB371\uC2A4\uB97C \uAD6C\uCD95\uD558\uC138\uC694.",cls:"warning-text"}):t.createEl("small",{text:`\u{1F4DA} ${n}\uAC1C \uB178\uD2B8 \uC778\uB371\uC2F1\uB428`,cls:"text-muted"});return}for(let t of this.currentSession.messages)this.renderMessage(t);this.scrollToBottom()}}renderMessage(t){var l;if(!this.messagesContainer)return;let n=this.messagesContainer.createDiv({cls:`chat-message ${t.role}`}),r=n.createDiv({cls:"message-header"}).createEl("button",{cls:"message-copy-btn",attr:{title:"\uBCF5\uC0AC"}});r.innerHTML="\u{1F4CB}",r.addEventListener("click",async()=>{await navigator.clipboard.writeText(t.content),new tn.Notice("\uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4")});let o=n.createDiv({cls:"message-content"}),a=this.processLinks(t.content);if(tn.MarkdownRenderer.renderMarkdown(a,o,"",this),o.querySelectorAll("a.internal-link").forEach(c=>{c.addEventListener("click",d=>{d.preventDefault();let h=c.getAttribute("href")||c.getAttribute("data-href");h&&this.app.workspace.openLinkText(h,"")})}),t.role==="assistant"&&t.references&&t.references.length>0){let c=n.createDiv({cls:"message-refs"});c.createEl("small",{text:"\u{1F4DA} \uCC38\uC870: "});for(let d=0;d<t.references.length;d++){let h=t.references[d],p=((l=h.split("/").pop())==null?void 0:l.replace(/\.md$/,""))||h;c.createEl("a",{text:p,cls:"internal-link",attr:{href:h}}).addEventListener("click",y=>{y.preventDefault(),this.app.workspace.openLinkText(h,"")}),d<t.references.length-1&&c.createSpan({text:", "})}}}processLinks(t){return t}renderInputArea(t){let n=t.createDiv({cls:"chat-input-area"});this.inputEl=n.createEl("textarea",{cls:"chat-input",attr:{placeholder:"\uC9C8\uBB38\uC744 \uC785\uB825\uD558\uC138\uC694...",rows:"1"}}),this.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),this.handleSend())}),this.inputEl.addEventListener("input",()=>{this.inputEl&&(this.inputEl.style.height="auto",this.inputEl.style.height=Math.min(this.inputEl.scrollHeight,120)+"px")}),n.createEl("button",{cls:"chat-send-btn",text:"\uC804\uC1A1"}).addEventListener("click",()=>this.handleSend())}async handleSend(){if(!this.inputEl||this.isProcessing)return;let t=this.inputEl.value.trim();if(t){this.currentSession||(this.currentSession=this.chatStorage.createSession()),this.inputEl.value="",this.inputEl.style.height="auto",this.chatStorage.addMessage(this.currentSession.id,{role:"user",content:t}),this.renderMessages(),this.isProcessing=!0,this.showLoading();try{let n=this.currentSession.messages.slice(0,-1),{answer:s,references:r}=await this.ragEngine.chat(t,n);this.chatStorage.addMessage(this.currentSession.id,{role:"assistant",content:s,references:r}),this.currentSession=this.chatStorage.getSession(this.currentSession.id)||null}catch(n){console.error("RAG \uC624\uB958:",n),new tn.Notice("\uB2F5\uBCC0 \uC0DD\uC131 \uC2E4\uD328: "+n.message)}finally{this.isProcessing=!1,this.hideLoading(),this.renderMessages()}}}handleNewSession(){this.currentSession=this.chatStorage.createSession(),this.render()}async handleExport(){if(!this.currentSession){new tn.Notice("\uB0B4\uBCF4\uB0BC \uB300\uD654\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=await this.chatStorage.exportToNote(this.currentSession.id);t?(new tn.Notice(`\uB178\uD2B8\uB85C \uB0B4\uBCF4\uB0B4\uAE30 \uC644\uB8CC: ${t.path}`),this.app.workspace.openLinkText(t.path,"")):new tn.Notice("\uB0B4\uBCF4\uB0B4\uAE30 \uC2E4\uD328")}handleDelete(){if(!this.currentSession)return;let t=this.currentSession.id,n=this.currentSession.title;new tA(this.app,n,()=>{this.chatStorage.deleteSession(t),this.currentSession=null,this.render(),new tn.Notice("\uB300\uD654\uAC00 \uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4")}).open()}showLoading(){if(!this.messagesContainer)return;let t=this.messagesContainer.createDiv({cls:"chat-message assistant loading"});t.createDiv({cls:"loading-dots"}).innerHTML="\u23F3 \uC0DD\uAC01 \uC911..."}hideLoading(){if(!this.messagesContainer)return;let t=this.messagesContainer.querySelector(".loading");t&&t.remove()}scrollToBottom(){this.messagesContainer&&(this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight)}updateSettings(t){this.settings=t}},tA=class extends tn.Modal{constructor(e,t,n){super(e),this.title=t,this.onConfirm=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("zfb-confirm-modal"),e.createEl("h3",{text:"\uB300\uD654 \uC0AD\uC81C"}),e.createEl("p",{text:`"${this.title}" \uB300\uD654\uB97C \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?`});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"\uC0AD\uC81C",cls:"mod-warning"}).addEventListener("click",()=>{this.onConfirm(),this.close()})}onClose(){this.contentEl.empty()}};var bc=require("obsidian");function XR(i,e=100){return i.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,e)}var Wy=class{constructor(e,t,n,s){this.projectMOCs=new Map;this.app=e,this.gemini=t,this.projectsFolder=n,this.settings=s}async scanProjectMOCs(){this.projectMOCs.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e){let n=await this.parseProjectMOC(t);n&&this.projectMOCs.set(n.project,n)}console.log(`\uD504\uB85C\uC81D\uD2B8 MOC \uC2A4\uCE94 \uC644\uB8CC: ${this.projectMOCs.size}\uAC1C`)}async parseProjectMOC(e){let t=this.app.metadataCache.getFileCache(e),n=t==null?void 0:t.frontmatter;if(!n||n.type!=="project-moc")return null;let s=n.project||e.basename,r=n.title||e.basename;return{path:e.path,title:r,project:s}}getProjectList(){let e=this.app.vault.getAbstractFileByPath(this.projectsFolder);return e instanceof bc.TFolder?e.children.filter(t=>t instanceof bc.TFolder).map(t=>t.name):[]}getMOCCount(){return this.projectMOCs.size}async detectProject(e,t){let n=this.getProjectList();return n.length===0?null:await this.gemini.detectProject(e,t,n)}async addNoteToMOC(e,t,n){let s=this.projectMOCs.get(e);if(!s)return!1;let r=this.app.vault.getAbstractFileByPath(s.path);if(!(r instanceof bc.TFile))return!1;let o=await this.app.vault.read(r),a=this.app.vault.getAbstractFileByPath(n),c=`[[${a instanceof bc.TFile?a.basename:XR(t)}]]`;if(o.includes(c))return!0;let d=/^##  \s*$/m,h;return d.test(o)?h=o.replace(/^(##  \s*\n)/m,`$1- ${c}
`):h=o.trimEnd()+`

## \uAD00\uB828 \uB178\uD2B8
- ${c}
`,await this.app.vault.modify(r,h),!0}async createProjectMOC(e,t){this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);let s=XR(e),r=`${t}/${s} MOC.md`;if(this.app.vault.getAbstractFileByPath(r))return null;let a=`---
type: project-moc
project: "${e}"
title: "${e} \uD504\uB85C\uC81D\uD2B8"
created: ${Oe(this.settings.timezone,this.settings.dateFormat)}
---

# ${e} \uD504\uB85C\uC81D\uD2B8

## \uAC1C\uC694


## \uC9C4\uD589 \uC911


## \uAD00\uB828 \uB178\uD2B8

`,l=await this.app.vault.create(r,a);return this.projectMOCs.set(e,{path:l.path,title:`${e} \uD504\uB85C\uC81D\uD2B8`,project:e}),l}hasProject(e){return this.projectMOCs.has(e)}getProjectMOCPath(e){let t=this.projectMOCs.get(e);return(t==null?void 0:t.path)||null}removeFromIndex(e){for(let[t,n]of this.projectMOCs)if(n.path===e){this.projectMOCs.delete(t);break}}};var nA=require("obsidian");var Yy=class{constructor(e,t,n,s,r){this.app=e,this.relatedNoteFinder=t,this.zettelFolder=n,this.settings=s,this.gemini=r||null}get indexPath(){return`${this.zettelFolder}/ZK Index.md`}async updateIndex(e,t){let n=this.app.vault.getAbstractFileByPath(this.indexPath);n instanceof nA.TFile?await this.addNoteToIndex(n,e,t):await this.createIndex(e,t)}async createIndex(e,t){let n=Oe(this.settings.timezone,this.settings.dateFormat),s=t[0]||"\uAE30\uD0C0",r=`---
type: zk-index
updated: ${n}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
- [[${e.basename}]]

## \uC8FC\uC81C\uBCC4
### ${s}
- [[${e.basename}]]
`;await this.app.vault.create(this.indexPath,r)}async addNoteToIndex(e,t,n){let s=await this.app.vault.read(e);s=this.updateRecentSection(s,t);let r=n[0]||"\uAE30\uD0C0";s=this.updateTopicSection(s,t,r),s=this.updateTimestamp(s),await this.app.vault.modify(e,s)}updateRecentSection(e,t){let n=/(##  \n)([\s\S]*?)(\n## |\n*$)/,s=e.match(n);if(s){let r=s[2].trim().split(`
`).filter(a=>a.startsWith("- ")),o=`- [[${t.basename}]]`;return r=r.filter(a=>!a.includes(t.basename)),r.unshift(o),r=r.slice(0,10),e.replace(n,`$1${r.join(`
`)}

$3`)}return e}updateTopicSection(e,t,n){let s=`### ${n}`,r=`- [[${t.basename}]]`;if(e.includes(s)){let o=new RegExp(`(### ${this.escapeRegex(n)}
)((?:- \\[\\[.*?\\]\\]
?)*)`),a=e.match(o);if(a)return a[2].includes(t.basename)?e:e.replace(o,`$1$2${r}
`)}else{let o=/(## \n)/;if(o.test(e))return e.replace(o,`$1${s}
${r}

`)}return e}updateTimestamp(e){let t=Oe(this.settings.timezone,this.settings.dateFormat);return e.replace(/^(---\n[\s\S]*?updated: ).*?(\n[\s\S]*?---)/,`$1${t}$2`)}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}async rebuildIndex(){let e=this.relatedNoteFinder.getZettelIndex();if(e.size===0)return;let t=new Map,n=[];for(let[,a]of e){let l=a.keywords[0]||"\uAE30\uD0C0";t.has(l)||t.set(l,[]),t.get(l).push(a);let c=a.path.match(/(\d{13})/),d=a.path.match(/(\d{8})-\d{3}/),h;if(c)h=new Date(parseInt(c[1]));else if(d){let p=d[1];h=new Date(parseInt(p.slice(0,4)),parseInt(p.slice(4,6))-1,parseInt(p.slice(6,8)))}else h=new Date;n.push({note:a,created:h})}n.sort((a,l)=>l.created.getTime()-a.created.getTime());let r=`---
type: zk-index
updated: ${Oe(this.settings.timezone,this.settings.dateFormat)}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
${n.slice(0,10).map(({note:a})=>{let l=a.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]]`}).join(`
`)}

## \uC8FC\uC81C\uBCC4
`;for(let[a,l]of t){let c=null;if(this.gemini&&l.length>=2)try{let d=l.map(h=>`- ${h.title} (\uD0A4\uC6CC\uB4DC: ${h.keywords.join(", ")})`).join(`
`);c=await this.gemini.generateTopicStructure(a,d)}catch(d){console.error(`\uC8FC\uC81C \uAD6C\uC870 \uC0DD\uC131 \uC2E4\uD328: ${a}`,d)}r+=`### ${a}
`,c!=null&&c.description&&(r+=`${c.description}

`),r+=`**\uD575\uC2EC \uB178\uD2B8:**
`;for(let d of l){let h=d.path.split("/"),p=h[h.length-1].replace(/\.md$/,""),m=c==null?void 0:c.notes.find(v=>v.title===d.title),y=m!=null&&m.role?` - ${m.role}`:"";if(r+=`- [[${p}]]${y}
`,m!=null&&m.relations&&m.relations.length>0)for(let v of m.relations){let E=v.type==="\uBC1C\uC804"?"\u2192":v.type==="\uAE30\uBC18"?"\u2190":"\u2194";r+=`  ${E} ${v.target}
`}}c!=null&&c.relatedTopics&&c.relatedTopics.length>0&&(r+=`
**\uAD00\uB828 \uC8FC\uC81C:** ${c.relatedTopics.join(", ")}
`),r+=`
`}let o=this.app.vault.getAbstractFileByPath(this.indexPath);o instanceof nA.TFile&&await this.app.vault.delete(o),await this.app.vault.create(this.indexPath,r)}};var Ec=require("obsidian");var Ky=class{constructor(e,t,n){this.app=e,this.gemini=t,this.settings=n}async collectNotes(e){let t=e.customRange||Vc(e.period,this.settings.timezone),n=this.app.vault.getMarkdownFiles(),s=[];for(let r of n){if(this.shouldExclude(r,e))continue;let o=this.getProjectFromPath(r.path);if(e.projectFilter&&o!==e.projectFilter)continue;let a=await this.getNoteDate(r);if(!R_(a,t))continue;let l=await this.extractNoteInfo(r,o,a);s.push(l)}return s.sort((r,o)=>o.modified.getTime()-r.modified.getTime()),s}getBasename(e){let t=e.lastIndexOf("/");return(t>=0?e.substring(t+1):e).replace(/\.md$/,"")}shouldExclude(e,t){let n=[this.settings.archivesFolder,this.settings.zettelFolder],s=t.excludeFolders||n;for(let r of s)if(e.path.startsWith(r))return!0;return!!e.basename.includes("\uD68C\uACE0")}getProjectFromPath(e){let t=this.settings.projectsFolder+"/";if(e.startsWith(t)){let n=e.substring(t.length),s=n.indexOf("/");return s>0?n.substring(0,s):void 0}if(e.startsWith(this.settings.libraryFolder))return"Library";if(e.startsWith(this.settings.inboxFolder))return"Inbox"}async getNoteDate(e){let t=this.app.metadataCache.getFileCache(e),n=t==null?void 0:t.frontmatter;if(n!=null&&n.created){let s=new Date(n.created);if(!isNaN(s.getTime()))return s}return new Date(e.stat.mtime)}async extractNoteInfo(e,t,n){let s=this.app.metadataCache.getFileCache(e),r=s==null?void 0:s.frontmatter,o=[];return r!=null&&r.tags&&(Array.isArray(r.tags)?o.push(...r.tags):o.push(r.tags)),{path:e.path,title:(r==null?void 0:r.title)||e.basename,project:t,created:n,modified:new Date(e.stat.mtime),summary:r==null?void 0:r.summary,tags:o,type:r==null?void 0:r.type}}groupByProject(e){let t=new Map;for(let s of e){let r=s.project||"\uAE30\uD0C0";t.has(r)||t.set(r,[]),t.get(r).push(s)}let n=[];for(let[s,r]of t)n.push({projectName:s,notes:r,noteCount:r.length});return n.sort((s,r)=>r.noteCount-s.noteCount),n}async analyze(e){let t=e.customRange||Vc(e.period,this.settings.timezone),n=await this.collectNotes(e),s=this.groupByProject(n),r=n.filter(a=>a.type==="zettel").length,o=await this.gemini.analyzeReview(e.period,t,s);return{period:e.period,dateRange:t,totalNotes:n.length,newZKNotes:r,projectGroups:s,analysis:o}}async createReviewNote(e){let t=I_(e.period,new Date,this.settings.timezone),n=`${this.settings.archivesFolder}/Reviews`;await this.ensureFolder(n);let s=`${n}/${t}`,r=this.generateReviewContent(e),o=this.app.vault.getAbstractFileByPath(s);return o instanceof Ec.TFile?(await this.app.vault.modify(o,r),o):await this.app.vault.create(s,r)}async ensureFolder(e){this.app.vault.getAbstractFileByPath(e)instanceof Ec.TFolder||await this.app.vault.createFolder(e)}generateReviewContent(e){let t=new Date,n=fb(t,this.settings.timezone,this.settings.dateFormat),s=`${Le(e.dateRange.start,this.settings.timezone)} ~ ${Le(e.dateRange.end,this.settings.timezone)}`,r;switch(e.period){case"today":r=`${Le(t,this.settings.timezone)} \uC77C\uC77C \uD68C\uACE0`;break;case"week":let l=mb(t);r=`${t.getFullYear()}\uB144 ${l}\uC8FC\uCC28 \uC8FC\uAC04 \uD68C\uACE0`;break;case"month":r=`${t.getFullYear()}\uB144 ${t.getMonth()+1}\uC6D4 \uC6D4\uAC04 \uD68C\uACE0`;break;default:r=`${s} \uD68C\uACE0`}let o=e.projectGroups.map(l=>{let c=l.notes.map(d=>`- [[${this.getBasename(d.path)}]]${d.summary?` - ${d.summary}`:""}`).join(`
`);return`### ${l.projectName} (${l.noteCount}\uAC1C)
${c}`}).join(`

`),a="";if(e.analysis){let{summary:l,mainTopics:c,insights:d,nextActions:h,patterns:p}=e.analysis;a=`
## \uBD84\uC11D \uACB0\uACFC

### \uC694\uC57D
${l}

### \uC8FC\uC694 \uC8FC\uC81C
${c.map(m=>`- ${m}`).join(`
`)}

### \uC778\uC0AC\uC774\uD2B8
${d.map(m=>`- ${m}`).join(`
`)}

### \uB2E4\uC74C \uC561\uC158
${h.map(m=>`- [ ] ${m}`).join(`
`)}
${p?`
### \uC791\uC5C5 \uD328\uD134
${p}`:""}`}return`---
type: review
period: ${e.period}
date_range: ${s}
created: ${n}
tags: [review, ${e.period==="today"?"daily":e.period==="week"?"weekly":"monthly"}]
---

# ${r}

## \uD1B5\uACC4
- \uC791\uC5C5\uD55C \uB178\uD2B8: ${e.totalNotes}\uAC1C
- \uC0C8 ZK \uB178\uD2B8: ${e.newZKNotes}\uAC1C
- \uD65C\uC131 \uD504\uB85C\uC81D\uD2B8: ${e.projectGroups.filter(l=>l.projectName!=="\uAE30\uD0C0"&&l.projectName!=="Library"&&l.projectName!=="Inbox").length}\uAC1C

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5

${o}
${a}
`}getProjectList(){let e=new Set,t=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(t instanceof Ec.TFolder)for(let n of t.children)n instanceof Ec.TFolder&&e.add(n.name);return Array.from(e).sort()}};var iA=["mp3","wav","m4a","aac","ogg","flac","webm"],bU=2*1024*1024*1024,Jy=class{constructor(e,t,n){this.app=e,this.gemini=t,this.settings=n}isAudioFile(e){return iA.includes(e.extension.toLowerCase())}getMimeType(e){return{mp3:"audio/mp3",wav:"audio/wav",m4a:"audio/m4a",aac:"audio/aac",ogg:"audio/ogg",flac:"audio/flac",webm:"audio/webm"}[e.toLowerCase()]||"audio/mp3"}async fileToBlob(e,t){let n=await this.app.vault.readBinary(e);return new Blob([n],{type:t})}async processAudio(e){if(e.stat.size>bU)throw new Error("\uD30C\uC77C \uD06C\uAE30\uAC00 2GB\uB97C \uCD08\uACFC\uD569\uB2C8\uB2E4");let t=e.extension.toLowerCase(),n=this.getMimeType(t),s=await this.fileToBlob(e,n);return await this.gemini.analyzeMeeting(s,n,e.name)}generateMarkdownNote(e){let t=Oe(this.settings.timezone,this.settings.dateFormat),n=e.actionItems.length>0?e.actionItems.map(o=>{let a=`- [ ] ${o.task}`;return o.assignee&&(a+=` - @${o.assignee}`),o.deadline&&(a+=` (\uAE30\uD55C: ${o.deadline})`),a}).join(`
`):"- (\uC5C6\uC74C)",s=e.decisions.length>0?e.decisions.map(o=>`- ${o}`).join(`
`):"- (\uC5C6\uC74C)",r=e.nextAgenda.length>0?e.nextAgenda.map(o=>`- ${o}`).join(`
`):"- (\uC5C6\uC74C)";return`---
type: meeting
source_file: "${e.sourceFile}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}

## \uC694\uC57D
${e.summary}

## \uC561\uC158 \uC544\uC774\uD15C
${n}

## \uACB0\uC815\uC0AC\uD56D
${s}

## \uB2E4\uC74C \uD68C\uC758 \uC548\uAC74
${r}

---

<details>
<summary>\uC804\uCCB4 \uB179\uCDE8\uB85D</summary>

${e.transcription}

</details>

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}};var Zy=require("obsidian");var Xy=class{constructor(e,t){this.app=e,this.settings=t}async saveToDaily(e){let t=new Map;for(let s of e)t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s);let n=0;for(let[s,r]of t)await this.appendToDaily(s,r),n+=r.length;return n}async appendToDaily(e,t){let n=this.settings.dailyNotesFolder,s=`${n}/${e}.md`;await this.ensureFolder(n);let r=t.map(a=>this.formatTask(a)).join(`
`),o=this.app.vault.getAbstractFileByPath(s);if(o instanceof Zy.TFile){let a=await this.app.vault.read(o),l=this.appendSchedulesToContent(a,r);await this.app.vault.modify(o,l)}else{let a=this.createDailyNoteContent(e,r);await this.app.vault.create(s,a)}}formatTask(e){let t=e.time?`${e.time} `:"",n=e.type==="event"?"\u{1F4C5}":"\u{1F4CB}";return`- [ ] ${t}${e.title} ${n} ${e.date}`}appendSchedulesToContent(e,t){let n="## \uC77C\uC815";if(e.includes(n)){let r=e.indexOf(n),o=e.indexOf(`
## `,r+1);return o>0?e.substring(0,o)+t+`

`+e.substring(o):e+`
`+t}let s=e.indexOf("---",3);if(s>0){let r=e.indexOf(`
`,s)+1;return e.substring(0,r)+`
## \uC77C\uC815
`+t+`
`+e.substring(r)}return`## \uC77C\uC815
`+t+`

`+e}createDailyNoteContent(e,t){return`---
type: daily
date: ${e}
created: ${Jn(this.settings.timezone)}
---

# ${e}

## \uC77C\uC815
${t}

## \uBA54\uBAA8

`}async ensureFolder(e){if(!(this.app.vault.getAbstractFileByPath(e)instanceof Zy.TFolder))try{await this.app.vault.createFolder(e)}catch(n){}}getToday(){return Jn(this.settings.timezone)}};var jy=class{constructor(e,t){this.gemini=e,this.settings=t}extractVideoId(e){let t=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/|youtube\.com\/shorts\/)([a-zA-Z0-9_-]{11})/,/^([a-zA-Z0-9_-]{11})$/];for(let n of t){let s=e.match(n);if(s)return s[1]}return null}isValidYouTubeUrl(e){return this.extractVideoId(e)!==null}async processVideo(e){let t=this.extractVideoId(e);if(!t)throw new Error("\uC720\uD6A8\uD55C YouTube URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let n=`https://www.youtube.com/watch?v=${t}`;console.log("Gemini \uB124\uC774\uD2F0\uBE0C YouTube \uBD84\uC11D \uC2DC\uC791:",n);let s=await this.gemini.analyzeYouTube(n);return{videoId:t,url:n,title:s.title,summary:s.summary,keyPoints:s.keyPoints}}generateMarkdownNote(e){let t=Oe(this.settings.timezone,this.settings.dateFormat),n=`https://www.youtube.com/embed/${e.videoId}`;return`---
type: youtube
source: "${e.url}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}

<div style="resize: both; overflow: hidden; width: 100%; height: 400px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${n}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none;" allowfullscreen></iframe>
</div>

## \uC694\uC57D
${e.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${e.keyPoints.map(s=>`- ${s}`).join(`
`)}
`}};var $h=require("obsidian");var Qy=class{constructor(e,t){this.gemini=e,this.settings=t}isValidUrl(e){try{let t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch(t){return!1}}extractMetadata(e,t){let n=l=>{let c=[new RegExp(`<meta[^>]*property=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*property=["']${l}["']`,"i"),new RegExp(`<meta[^>]*name=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*name=["']${l}["']`,"i")];for(let d of c){let h=e.match(d);if(h)return h[1]}return""},s=e.match(/<title[^>]*>([^<]+)<\/title>/i),r=e.match(/<link[^>]*rel=["'](?:shortcut )?icon["'][^>]*href=["']([^"']+)["']/i),o=new URL(t),a=l=>l?l.startsWith("http")?l:l.startsWith("//")?o.protocol+l:l.startsWith("/")?o.origin+l:o.origin+"/"+l:"";return{title:n("og:title")||n("twitter:title")||(s==null?void 0:s[1])||"",description:n("og:description")||n("twitter:description")||n("description")||"",image:a(n("og:image")||n("twitter:image")||""),siteName:n("og:site_name")||o.hostname,favicon:a((r==null?void 0:r[1])||"/favicon.ico")}}extractContent(e){let t=e.match(/<title[^>]*>([^<]+)<\/title>/i),n=e.match(/<meta[^>]*property=["']og:title["'][^>]*content=["']([^"']+)["']/i),s=(n==null?void 0:n[1])||(t==null?void 0:t[1])||"Untitled",r=e.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<nav[^>]*>[\s\S]*?<\/nav>/gi,"").replace(/<header[^>]*>[\s\S]*?<\/header>/gi,"").replace(/<footer[^>]*>[\s\S]*?<\/footer>/gi,"").replace(/<aside[^>]*>[\s\S]*?<\/aside>/gi,""),o="",a=r.match(/<article[^>]*>([\s\S]*?)<\/article>/i),l=r.match(/<main[^>]*>([\s\S]*?)<\/main>/i),c=r.match(/<div[^>]*(?:class|id)=["'][^"']*content[^"']*["'][^>]*>([\s\S]*?)<\/div>/i);if(a)o=a[1];else if(l)o=l[1];else if(c)o=c[1];else{let h=r.match(/<body[^>]*>([\s\S]*?)<\/body>/i);o=(h==null?void 0:h[1])||r}return o=o.replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&[a-z]+;/gi," ").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim(),{title:s.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim(),content:o}}async fetchWithJinaReader(e){var c,d;let t=`https://r.jina.ai/${e}`,s=(await(0,$h.requestUrl)({url:t,method:"GET",headers:{Accept:"text/plain","X-Timeout":"30","X-Wait-For-Selector":"article, .post-content, .se-main-container, #postViewArea"}})).text;s.includes("Warning: This page maybe not yet fully loaded")&&console.log("Jina Reader: \uD398\uC774\uC9C0 \uB85C\uB529 \uACBD\uACE0 \uAC10\uC9C0");let r=s.split(`
`),o="Untitled",a=0;for((c=r[0])!=null&&c.startsWith("# ")?(o=r[0].substring(2).trim(),a=1):(d=r[0])!=null&&d.startsWith("Title: ")&&(o=r[0].substring(7).trim(),a=1);a<r.length;){let h=r[a];if(h!=null&&h.startsWith("URL Source:")||h!=null&&h.startsWith("http")||h!=null&&h.startsWith("Warning:")||h!=null&&h.startsWith("Markdown Content:")||(h==null?void 0:h.trim())==="")a++;else break}let l=r.slice(a).join(`
`).trim();if(l.length<100&&!l.includes(`
`))throw new Error("\uD398\uC774\uC9C0 \uCF58\uD150\uCE20\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4 (JavaScript \uB85C\uB529 \uB300\uAE30 \uC2E4\uD328)");return{title:o,content:l}}async fetchNaverBlog(e){var h;let t=e;if(e.includes("blog.naver.com")){let p=e.match(/blog\.naver\.com\/([^\/]+)\/(\d+)/);p&&(t=`https://m.blog.naver.com/${p[1]}/${p[2]}`)}let s=(await(0,$h.requestUrl)({url:t,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15",Accept:"text/html,application/xhtml+xml","Accept-Language":"ko-KR,ko;q=0.9"}})).text,r=s.match(/<title[^>]*>([^<]+)<\/title>/i),o=((h=r==null?void 0:r[1])==null?void 0:h.replace(/ :  $/,"").trim())||"Untitled",a="",l=s.match(/<div[^>]*class="[^"]*se-main-container[^"]*"[^>]*>([\s\S]*?)<\/div>\s*<\/div>\s*<\/div>/i),c=s.match(/<div[^>]*id="postViewArea"[^>]*>([\s\S]*?)<\/div>/i),d=(l==null?void 0:l[1])||(c==null?void 0:c[1])||"";return d&&(a=d.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim()),{title:o,content:a}}async processUrl(e){if(!this.isValidUrl(e))throw new Error("\uC720\uD6A8\uD55C URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let t;try{let r=(await(0,$h.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text;t=this.extractMetadata(r,e)}catch(s){console.log("\uBA54\uD0C0\uB370\uC774\uD130 \uCD94\uCD9C \uC2E4\uD328:",s)}if(e.includes("blog.naver.com"))return console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, Jina Reader \uC0AC\uC6A9"),await this.processUrlFallback(e,t);try{console.log("URL Context Tool\uB85C \uC6F9\uD398\uC774\uC9C0 \uBD84\uC11D \uC2DC\uB3C4");let s=await this.gemini.analyzeWebpage(e),r=["unable to access","cannot access","could not access","\uC811\uADFC\uD560 \uC218 \uC5C6","\uAC00\uC838\uC62C \uC218 \uC5C6"],o=s.summary.toLowerCase();return r.some(l=>o.includes(l.toLowerCase()))?(console.log("URL Context Tool \uC811\uADFC \uC2E4\uD328 \uAC10\uC9C0, \uD3F4\uBC31 \uC2DC\uB3C4"),await this.processUrlFallback(e,t)):(t&&(t.title=t.title||s.title),{url:e,title:s.title,content:"",summary:s.summary,keyPoints:s.keyPoints,metadata:t})}catch(s){console.log("URL Context Tool \uC2E4\uD328, \uD3F4\uBC31 \uC2DC\uB3C4:",s)}return await this.processUrlFallback(e,t)}async processUrlFallback(e,t){let n,s,r=null;if(!t)try{r=(await(0,$h.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text,t=this.extractMetadata(r,e)}catch(d){console.log("HTML \uAC00\uC838\uC624\uAE30 \uC2E4\uD328:",d)}if(e.includes("blog.naver.com")){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, \uC804\uC6A9 \uCD94\uCD9C \uC2DC\uB3C4");try{let d=await this.fetchNaverBlog(e);if(n=d.title,s=d.content,s.length<100)throw new Error("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uCD94\uCD9C \uC2E4\uD328")}catch(d){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uC804\uC6A9 \uCD94\uCD9C \uC2E4\uD328, Jina Reader \uC2DC\uB3C4:",d);let h=await this.fetchWithJinaReader(e);n=h.title,s=h.content}}else try{console.log("Jina Reader\uB85C \uCF58\uD150\uCE20 \uCD94\uCD9C \uC2DC\uB3C4");let d=await this.fetchWithJinaReader(e);n=d.title,s=d.content}catch(d){if(console.log("Jina Reader \uC2E4\uD328, \uC9C1\uC811 \uCD94\uCD9C\uB85C \uD3F4\uBC31:",d),r){let h=this.extractContent(r);n=h.title,s=h.content}else throw new Error("\uC6F9\uD398\uC774\uC9C0\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4")}if(s.length<50)throw new Error("\uBCF8\uBB38\uC744 \uCD94\uCD9C\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC811\uADFC\uC774 \uC81C\uD55C\uB41C \uD398\uC774\uC9C0\uC77C \uC218 \uC788\uC2B5\uB2C8\uB2E4.");let a=5e4,l=s.length>a?s.slice(0,a)+"...":s,c=await this.gemini.summarizeContent(l,"webpage");return t&&(t.title=t.title||n),{url:e,title:c.title||n,content:l,summary:c.summary,keyPoints:c.keyPoints,metadata:t}}generateMarkdownNote(e){let t=Oe(this.settings.timezone,this.settings.dateFormat),n=e.metadata,s=e.url;e.url.includes("blog.naver.com")&&!e.url.includes("m.blog.naver.com")&&(s=e.url.replace("blog.naver.com","m.blog.naver.com"));let r="";if(n){let o=n.image?`
> ![](${n.image})
>`:"",a=n.description?`
> ${n.description}
>`:"";r=`
> [!bookmark] ${n.siteName||new URL(e.url).hostname}
> **${n.title||e.title}**
>${a}${o}
> \u{1F517} ${e.url}

`}else r=`
> [!bookmark] \uC6F9\uD398\uC774\uC9C0
> **${e.title}**
>
> \u{1F517} ${e.url}

`;return`---
type: webpage
source: "${e.url}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}
${r}
<div style="resize: both; overflow: hidden; width: 100%; height: 600px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${s}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none; color-scheme: light;"></iframe>
</div>

## \uC694\uC57D
${e.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${e.keyPoints.map(o=>`- ${o}`).join(`
`)}
`}};var hs=require("obsidian"),EU="YOUR_CLIENT_ID.apps.googleusercontent.com",wU="YOUR_CLIENT_SECRET",ZR="http://127.0.0.1:42813/callback",SU="https://accounts.google.com/o/oauth2/v2/auth",jR="https://oauth2.googleapis.com/token",AU="https://www.googleapis.com/calendar/v3",CU="https://www.googleapis.com/auth/calendar.events",zh=class{constructor(e,t,n){this.authServer=null;this.app=e,this.settings=t,this.saveSettings=n}isConnected(){return!!this.settings.googleRefreshToken}getClientId(){return this.settings.useOwnApiKey?this.settings.googleClientId:EU}getClientSecret(){return this.settings.useOwnApiKey?this.settings.googleClientSecret:wU}async startOAuth(){let e=this.getClientId();if(!e||e==="YOUR_CLIENT_ID.apps.googleusercontent.com"){new hs.Notice(`Google Calendar Client ID\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.
\uC124\uC815\uC5D0\uC11C Advanced \uBAA8\uB4DC\uB85C \uC9C1\uC811 Client ID\uB97C \uC785\uB825\uD558\uAC70\uB098,
\uD50C\uB7EC\uADF8\uC778 \uC5C5\uB370\uC774\uD2B8\uB97C \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.`,1e4);return}let t=new URLSearchParams({client_id:e,redirect_uri:ZR,response_type:"code",scope:CU,access_type:"offline",prompt:"consent"}),n=`${SU}?${t.toString()}`;try{let s=await this.startAuthServer();await this.exchangeCodeForTokens(s),new hs.Notice("Google Calendar \uC5F0\uACB0 \uC644\uB8CC!")}catch(s){console.error("OAuth \uC5D0\uB7EC:",s),new hs.Notice("Google Calendar \uC5F0\uACB0 \uC2E4\uD328: "+s.message)}window.open(n,"_blank")}startAuthServer(){return new Promise((e,t)=>{let n=require("http"),s=setTimeout(()=>{this.stopAuthServer(),t(new Error("\uC778\uC99D \uC2DC\uAC04 \uCD08\uACFC (5\uBD84)"))},5*60*1e3);this.authServer=n.createServer((r,o)=>{let a=new URL(r.url||"","http://127.0.0.1:42813");if(a.pathname==="/callback"){let l=a.searchParams.get("code"),c=a.searchParams.get("error");if(c){o.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),o.end(`
							<html><body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
								<h1>\uC5F0\uACB0 \uC2E4\uD328</h1>
								<p>Google Calendar \uC5F0\uACB0\uC774 \uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p>
								<p>\uC774 \uCC3D\uC744 \uB2EB\uC544\uB3C4 \uB429\uB2C8\uB2E4.</p>
							</body></html>
						`),clearTimeout(s),this.stopAuthServer(),t(new Error(c));return}if(l){o.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),o.end(`
							<html><body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
								<h1>\uC5F0\uACB0 \uC644\uB8CC!</h1>
								<p>Google Calendar\uAC00 \uC5F0\uACB0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p>
								<p>\uC774 \uCC3D\uC744 \uB2EB\uACE0 Obsidian\uC73C\uB85C \uB3CC\uC544\uAC00\uC138\uC694.</p>
							</body></html>
						`),clearTimeout(s),this.stopAuthServer(),e(l);return}}o.writeHead(404),o.end("Not Found")}),this.authServer.listen(42813,"127.0.0.1",()=>{console.log("OAuth \uCF5C\uBC31 \uC11C\uBC84 \uC2DC\uC791: http://127.0.0.1:42813")}),this.authServer.on("error",r=>{clearTimeout(s),t(new Error(`\uC11C\uBC84 \uC2DC\uC791 \uC2E4\uD328: ${r.message}`))})})}stopAuthServer(){this.authServer&&(this.authServer.close(),this.authServer=null)}async exchangeCodeForTokens(e){let n=(await(0,hs.requestUrl)({url:jR,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:this.getClientId(),client_secret:this.getClientSecret(),code:e,grant_type:"authorization_code",redirect_uri:ZR}).toString()})).json;if(n.error)throw new Error(n.error_description||n.error);this.settings.googleAccessToken=n.access_token,n.refresh_token&&(this.settings.googleRefreshToken=n.refresh_token),this.settings.googleTokenExpiry=Date.now()+n.expires_in*1e3,await this.saveSettings()}async refreshAccessToken(){if(!this.settings.googleRefreshToken)throw new Error("Refresh token\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC5F0\uACB0\uD574\uC8FC\uC138\uC694.");let t=(await(0,hs.requestUrl)({url:jR,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:this.getClientId(),client_secret:this.getClientSecret(),refresh_token:this.settings.googleRefreshToken,grant_type:"refresh_token"}).toString()})).json;if(t.error)throw t.error==="invalid_grant"?(this.settings.googleRefreshToken="",await this.saveSettings(),new Error("Google \uC5F0\uACB0\uC774 \uB9CC\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC5F0\uACB0\uD574\uC8FC\uC138\uC694.")):new Error(t.error_description||t.error);this.settings.googleAccessToken=t.access_token,this.settings.googleTokenExpiry=Date.now()+t.expires_in*1e3,await this.saveSettings()}async ensureValidToken(){Date.now()>this.settings.googleTokenExpiry-5*60*1e3&&await this.refreshAccessToken()}async createEvent(e){var o;if(!this.isConnected())throw new Error("Google Calendar\uAC00 \uC5F0\uACB0\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");await this.ensureValidToken();let t,n;if(e.time){let a=`${e.date}T${e.time}:00`,l=this.addHour(e.time),c=`${e.date}T${l}:00`;t={dateTime:a,timeZone:this.resolveTimezone()},n={dateTime:c,timeZone:this.resolveTimezone()}}else t={date:e.date},n={date:this.getNextDay(e.date)};let s={summary:e.title,start:t,end:n},r=await(0,hs.requestUrl)({url:`${AU}/calendars/primary/events`,method:"POST",headers:{Authorization:`Bearer ${this.settings.googleAccessToken}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(r.status>=400){let a=r.json;throw new Error(((o=a.error)==null?void 0:o.message)||"\uC774\uBCA4\uD2B8 \uC0DD\uC131 \uC2E4\uD328")}}async saveSchedules(e){let t=0;for(let n of e)try{await this.createEvent(n),t++}catch(s){console.error("\uC77C\uC815 \uC800\uC7A5 \uC2E4\uD328:",n.title,s)}return t}addHour(e){let[t,n]=e.split(":").map(Number),s=(t+1)%24;return`${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}`}getNextDay(e){let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}resolveTimezone(){return this.settings.timezone==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:this.settings.timezone}async disconnect(){this.settings.googleAccessToken="",this.settings.googleRefreshToken="",this.settings.googleTokenExpiry=0,await this.saveSettings(),new hs.Notice("Google Calendar \uC5F0\uACB0\uC774 \uD574\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}};var QR=require("obsidian"),ev=class extends QR.Modal{constructor(t,n,s,r){super(t);this.resolvePromise=null;this.choiceMade=!1;this.schedules=n,this.settings=s,this.selected=new Set(n.map((o,a)=>a)),this.saveToDaily=!0,this.saveToGoogle=s.googleCalendarEnabled&&!!s.googleRefreshToken,this.moveToArchives=!1,this.onFeedback=r}async openAndWait(){return new Promise(t=>{this.resolvePromise=t,this.open()})}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-schedule-modal"),t.createEl("h2",{text:"\uAC10\uC9C0\uB41C \uC77C\uC815"}),t.createEl("p",{text:`${this.schedules.length}\uAC1C\uC758 \uC77C\uC815\uC774 \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uC800\uC7A5\uD560 \uC77C\uC815\uC744 \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let n=t.createDiv({cls:"schedule-list"});n.style.maxHeight="300px",n.style.overflowY="auto",n.style.marginBottom="16px",this.schedules.forEach((S,C)=>{let _=n.createDiv({cls:"schedule-item"});_.style.display="flex",_.style.alignItems="center",_.style.padding="10px 12px",_.style.marginBottom="8px",_.style.border="1px solid var(--background-modifier-border)",_.style.borderRadius="8px",_.style.gap="12px";let T=_.createEl("input",{type:"checkbox",attr:{checked:!0}});T.style.flexShrink="0",T.addEventListener("change",()=>{T.checked?this.selected.add(C):this.selected.delete(C),this.updateSaveButton()});let R=_.createDiv({cls:"schedule-info"});R.style.flex="1",R.style.minWidth="0";let I=R.createEl("div",{text:S.title});I.style.fontWeight="500",I.style.overflow="hidden",I.style.textOverflow="ellipsis",I.style.whiteSpace="nowrap";let D=R.createEl("div");D.style.fontSize="12px",D.style.color="var(--text-muted)";let k=S.type==="event"?"\uC57D\uC18D":"\uD560\uC77C",N=S.type==="event"?"\u{1F4C5}":"\u{1F4CB}",F=S.time||"\uC885\uC77C";D.setText(`${N} ${k} | ${S.date} ${F}`)});let s=t.createDiv({cls:"schedule-destinations"});s.style.padding="12px",s.style.backgroundColor="var(--background-secondary)",s.style.borderRadius="8px",s.style.marginBottom="16px",s.createEl("div",{text:"\uC800\uC7A5 \uC704\uCE58"}).style.fontWeight="500";let r=s.createDiv({cls:"destination-option"});r.style.display="flex",r.style.alignItems="center",r.style.gap="8px",r.style.marginTop="8px";let o=r.createEl("input",{type:"checkbox",attr:{checked:!0}});o.id="save-to-daily",o.addEventListener("change",()=>{this.saveToDaily=o.checked});let a=r.createEl("label",{text:`Daily Notes (${this.settings.dailyNotesFolder}/)`,attr:{for:"save-to-daily"}});a.style.cursor="pointer";let l=s.createDiv({cls:"destination-option"});l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginTop="8px";let c=l.createEl("input",{type:"checkbox",attr:{checked:this.saveToGoogle,disabled:!this.settings.googleCalendarEnabled||!this.settings.googleRefreshToken}});c.id="save-to-google",c.addEventListener("change",()=>{this.saveToGoogle=c.checked});let d=l.createEl("label",{attr:{for:"save-to-google"}});d.style.cursor="pointer",this.settings.googleCalendarEnabled&&this.settings.googleRefreshToken?d.setText("Google Calendar (\uC5F0\uACB0\uB428)"):this.settings.googleCalendarEnabled?(d.setText("Google Calendar (\uC5F0\uACB0 \uD544\uC694)"),d.style.color="var(--text-muted)"):(d.setText("Google Calendar (\uBE44\uD65C\uC131\uD654)"),d.style.color="var(--text-muted)");let h=s.createDiv({cls:"destination-option"});h.style.display="flex",h.style.alignItems="center",h.style.gap="8px",h.style.marginTop="8px";let p=h.createEl("input",{type:"checkbox",attr:{checked:!1}});p.id="move-to-archives",p.addEventListener("change",()=>{this.moveToArchives=p.checked});let m=h.createEl("label",{text:"\u{1F4E6} \uC800\uC7A5 \uD6C4 \uC6D0\uBCF8 \uB178\uD2B8 Archives\uB85C \uC774\uB3D9",attr:{for:"move-to-archives"}});m.style.cursor="pointer";let y=t.createDiv({cls:"modal-button-container"});y.style.display="flex",y.style.justifyContent="flex-end",y.style.gap="8px",y.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>{this.choiceMade=!0,this.onFeedback&&this.onFeedback({type:"schedule_detection",accepted:!1,allSchedules:this.schedules,selectedSchedules:[],rejectedSchedules:this.schedules}),this.close(),this.resolvePromise&&this.resolvePromise(null)});let E=y.createEl("button",{text:`${this.selected.size}\uAC1C \uC800\uC7A5`,cls:"mod-cta"});E.id="save-schedule-btn",E.addEventListener("click",()=>{this.choiceMade=!0;let S=this.schedules.filter((_,T)=>this.selected.has(T)),C=this.schedules.filter((_,T)=>!this.selected.has(T));this.onFeedback&&this.onFeedback({type:"schedule_detection",accepted:S.length>0,allSchedules:this.schedules,selectedSchedules:S,rejectedSchedules:C}),this.close(),this.resolvePromise&&this.resolvePromise({selectedSchedules:S,saveToDaily:this.saveToDaily,saveToGoogle:this.saveToGoogle,moveToArchives:this.moveToArchives})})}updateSaveButton(){let t=this.contentEl.querySelector("#save-schedule-btn");t&&t.setText(`${this.selected.size}\uAC1C \uC800\uC7A5`)}onClose(){this.choiceMade||(this.onFeedback&&this.onFeedback({type:"schedule_detection",accepted:!1,allSchedules:this.schedules,selectedSchedules:[],dismissed:!0}),this.resolvePromise&&this.resolvePromise(null)),this.contentEl.empty()}};var wc=require("obsidian"),tv=class extends wc.Modal{constructor(t,n,s,r,o=null){super(t);this.choiceMade=!1;this.activeTab="restructured";this.result=n,this.originalContent=s,this.onChoice=r,this.feedbackManager=o,this.component=new wc.Component}getRestructureTypeLabel(t){switch(t){case"meeting":return"\u{1F4CB} \uD68C\uC758/\uBBF8\uD305";case"idea":return"\u{1F4A1} \uC544\uC774\uB514\uC5B4";case"learning":return"\u{1F4DA} \uD559\uC2B5/\uC5F0\uAD6C";case"general":return"\u{1F4DD} \uC77C\uBC18";default:return"\u{1F4DD} \uC77C\uBC18"}}recordFeedback(t){this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"content_restructure",noteTitle:this.result.title,aiSuggestion:{restructuredContent:this.result.restructuredContent,restructureType:this.result.restructureType},userChoice:{accepted:t===!0,dismissed:t===null}})}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-restructure-modal"),t.createEl("h2",{text:"\u2728 \uCF58\uD150\uCE20 \uC7AC\uAD6C\uC131 \uC81C\uC548"});let n=t.createDiv({cls:"restructure-info"});n.style.marginBottom="16px",n.style.padding="12px",n.style.backgroundColor="var(--background-secondary)",n.style.borderRadius="8px",n.createEl("p",{text:"\uC774 \uB178\uD2B8\uAC00 \uC815\uB9AC\uB418\uC9C0 \uC54A\uC740 \uAC83 \uAC19\uC544 \uC7AC\uAD6C\uC131\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4."});let s=this.getRestructureTypeLabel(this.result.restructureType);n.createEl("p",{text:`\uC720\uD615: ${s}`,cls:"restructure-type"}).style.fontWeight="bold";let r=t.createDiv({cls:"restructure-tabs"});r.style.display="flex",r.style.borderBottom="1px solid var(--background-modifier-border)",r.style.marginBottom="12px";let o=r.createEl("button",{text:"\u{1F4C4} \uC6D0\uBCF8"});o.style.flex="1",o.style.padding="8px 16px",o.style.border="none",o.style.cursor="pointer",o.style.backgroundColor="transparent";let a=r.createEl("button",{text:"\u2728 \uC7AC\uAD6C\uC131"});a.style.flex="1",a.style.padding="8px 16px",a.style.border="none",a.style.cursor="pointer",a.style.backgroundColor="transparent";let l=t.createDiv({cls:"restructure-content-area"});l.style.minHeight="200px",l.style.maxHeight="400px",l.style.overflow="auto",l.style.padding="12px",l.style.border="1px solid var(--background-modifier-border)",l.style.borderRadius="8px",l.style.backgroundColor="var(--background-primary)";let c=()=>{this.activeTab==="original"?(o.style.borderBottom="2px solid var(--interactive-accent)",o.style.color="var(--text-normal)",a.style.borderBottom="none",a.style.color="var(--text-muted)",l.empty(),l.createEl("pre",{text:this.originalContent,cls:"original-content"}).style.whiteSpace="pre-wrap"):(a.style.borderBottom="2px solid var(--interactive-accent)",a.style.color="var(--text-normal)",o.style.borderBottom="none",o.style.color="var(--text-muted)",l.empty(),this.result.restructuredContent&&wc.MarkdownRenderer.render(this.app,this.result.restructuredContent,l,"",this.component))};o.addEventListener("click",()=>{this.activeTab="original",c()}),a.addEventListener("click",()=>{this.activeTab="restructured",c()}),c();let d=t.createDiv({cls:"modal-button-container"});d.style.marginTop="16px",d.style.display="flex",d.style.gap="8px",d.style.justifyContent="flex-end",d.createEl("button",{text:"\u{1F4C4} \uC6D0\uBCF8 \uC720\uC9C0"}).addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback(!1),this.close(),this.onChoice(!1)}),d.createEl("button",{text:"\u2728 \uC7AC\uAD6C\uC131 \uC801\uC6A9",cls:"mod-cta"}).addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback(!0),this.close(),this.onChoice(!0)})}onClose(){this.choiceMade||this.recordFeedback(null),this.component.unload(),this.contentEl.empty()}};var _U="feedback.json",qh=10,eI=100,tI=20,nv=class{constructor(e,t){this.app=e,this.pluginDir=t,this.store={...Vf}}async load(){try{let e=this.getFilePath(),t=this.app.vault.adapter;if(await t.exists(e)){let n=await t.read(e),s=JSON.parse(n);this.store=this.migrate(s)}else this.store={...Vf}}catch(e){console.error("Failed to load feedback store:",e),this.store={...Vf}}}async save(){try{let e=this.getFilePath(),t=this.app.vault.adapter;this.store.lastUpdated=new Date().toISOString(),await t.write(e,JSON.stringify(this.store,null,2))}catch(e){console.error("Failed to save feedback store:",e)}}getFilePath(){return`${this.pluginDir}/${_U}`}migrate(e){return!e.version||e.version<1?{version:1,entries:e.entries||[],preferences:this.migratePreferences(e.preferences),lastUpdated:e.lastUpdated||new Date().toISOString()}:(e.preferences=this.migratePreferences(e.preferences),e)}migratePreferences(e){var n,s,r,o;let t={...hb};return e?{version:e.version||t.version,feedback:{referenceLocation:{...t.feedback.referenceLocation,...(n=e.feedback)==null?void 0:n.referenceLocation},scheduleDetection:{...t.feedback.scheduleDetection,...(s=e.feedback)==null?void 0:s.scheduleDetection},projectClassification:{...t.feedback.projectClassification,...(r=e.feedback)==null?void 0:r.projectClassification}},restructure:{...t.restructure,...e.restructure},embedding:{...t.embedding,...e.embedding},rag:{...t.rag,...e.rag,feedbackOnAnswers:{...t.rag.feedbackOnAnswers,...(o=e.rag)==null?void 0:o.feedbackOnAnswers}}}:t}addFeedback(e){this.store.entries.push(e),this.store.entries.length>eI&&(this.store.entries=this.store.entries.slice(-eI)),this.updatePreferences(e),this.save()}updatePreferences(e){if(!e.userChoice.dismissed)switch(e.type){case"reference_location":this.updateReferencePreference(e);break;case"schedule_detection":this.updateSchedulePreference(e);break;case"related_notes":this.updateRelatedNotesPreference(e);break;case"project_classification":this.updateProjectClassificationPreference(e);break;case"content_restructure":this.updateRestructurePreference(e);break;case"rag_chat":this.updateRAGPreference(e);break}}updateReferencePreference(e){let t=this.store.preferences.feedback.referenceLocation;e.userChoice.modified==="library"?t.toLibrary++:e.userChoice.modified==="project"&&t.toProject++;let n=t.toLibrary+t.toProject;if(n>=5){let s=t.toLibrary/n;s>.7?t.preference="library":s<.3?t.preference="project":t.preference="neutral"}}updateSchedulePreference(e){let t=this.store.preferences.feedback.scheduleDetection;e.userChoice.accepted?t.accepted++:t.rejected++,e.userChoice.rejectedItems&&e.userChoice.rejectedItems.length>0}updateRelatedNotesPreference(e){}updateProjectClassificationPreference(e){let t=this.store.preferences.feedback.projectClassification;e.userChoice.modified&&e.aiSuggestion.projectName&&(t.corrections.push({original:e.aiSuggestion.projectName,corrected:e.userChoice.modified,keywords:[]}),t.corrections.length>tI&&(t.corrections=t.corrections.slice(-tI)))}updateRestructurePreference(e){let t=this.store.preferences.restructure;e.userChoice.accepted?t.accepted++:t.rejected++;let n=t.accepted+t.rejected;if(n>=5){let s=t.accepted/n;s>.7?t.preference="restructure":s<.3?t.preference="original":t.preference="neutral"}}updateRAGPreference(e){let t=this.store.preferences.rag;if(e.userChoice.accepted){if(t.feedbackOnAnswers.helpful++,e.aiSuggestion.sources)for(let n of e.aiSuggestion.sources)t.preferredNotes.includes(n)||(t.preferredNotes.push(n),t.preferredNotes.length>10&&t.preferredNotes.shift())}else t.feedbackOnAnswers.notHelpful++}generatePromptContext(){let e=this.store.preferences,t=[],n=e.feedback.referenceLocation;if(n.preference!=="neutral"){let a=n.toLibrary+n.toProject;a>=5&&(n.preference==="library"?t.push(`- \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB294 Library \uC120\uD638 (${a}\uD68C \uC911 ${n.toLibrary}\uD68C)`):t.push(`- \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB294 \uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354 \uC120\uD638 (${a}\uD68C \uC911 ${n.toProject}\uD68C)`))}let s=e.feedback.scheduleDetection;s.falsePositivePatterns.length>0&&t.push(`- \uB2E4\uC74C \uD45C\uD604\uC740 \uC77C\uC815\uC73C\uB85C \uAC10\uC9C0\uD558\uC9C0 \uC54A\uC74C: ${s.falsePositivePatterns.join(", ")}`);let r=e.feedback.projectClassification;r.corrections.length>0&&r.corrections.slice(-3).forEach(l=>{l.keywords.length>0&&t.push(`- "${l.keywords.join(", ")}" \uAD00\uB828 \uB0B4\uC6A9\uC740 ${l.corrected} \uD504\uB85C\uC81D\uD2B8\uB85C \uBD84\uB958`)});let o=e.restructure;if(o.preference!=="neutral"){let a=o.accepted+o.rejected;a>=5&&(o.preference==="restructure"?t.push(`- \uCF58\uD150\uCE20 \uC7AC\uAD6C\uC131 \uC120\uD638 (${a}\uD68C \uC911 ${o.accepted}\uD68C \uC218\uB77D)`):t.push(`- \uC6D0\uBCF8 \uC720\uC9C0 \uC120\uD638 (${a}\uD68C \uC911 ${o.rejected}\uD68C \uAC70\uBD80)`))}return t.length>0?`

## \uC0AC\uC6A9\uC790 \uC120\uD638\uB3C4 (\uC774\uC804 \uD53C\uB4DC\uBC31 \uAE30\uBC18)
${t.join(`
`)}`:""}getPreferences(){return this.store.preferences}getEntries(){return this.store.entries}getStats(){let e=this.store.preferences.feedback.referenceLocation,t=this.store.preferences.feedback.scheduleDetection;return{totalEntries:this.store.entries.length,referenceDecisions:e.toLibrary+e.toProject,scheduleDecisions:t.accepted+t.rejected,lastUpdated:this.store.lastUpdated}}};var lr=require("obsidian");var iv=class extends lr.Modal{constructor(t,n,s){super(t);this.currentStep=1;this.settings={...n},this.onComplete=s}onOpen(){this.contentEl.addClass("zfb-onboarding"),this.renderStep(1)}onClose(){this.contentEl.empty()}renderStep(t){this.currentStep=t;let{contentEl:n}=this;switch(n.empty(),this.renderProgress(n,t),t){case 1:this.renderStep1(n);break;case 2:this.renderStep2(n);break;case 3:this.renderStep3(n);break;case 4:this.renderStep4(n);break}}renderProgress(t,n){let s=t.createDiv({cls:"onboarding-progress"});for(let r=1;r<=yb;r++)s.createSpan({cls:`progress-dot ${r===n?"active":""} ${r<n?"completed":""}`}).setText(r.toString())}renderStep1(t){t.createEl("h2",{text:"1\uB2E8\uACC4: Gemini API \uD0A4 \uC124\uC815"}),t.createEl("p",{text:"\uC774 \uD50C\uB7EC\uADF8\uC778\uC740 Google Gemini AI\uB97C \uC0AC\uC6A9\uD569\uB2C8\uB2E4. \uBB34\uB8CC\uB85C API \uD0A4\uB97C \uBC1C\uAE09\uBC1B\uC744 \uC218 \uC788\uC2B5\uB2C8\uB2E4."}),t.createEl("a",{text:"\u{1F4D6} API \uD0A4 \uBC1C\uAE09 \uAC00\uC774\uB4DC (Google AI Studio)",href:P_}).setAttr("target","_blank"),new lr.Setting(t).setName("Gemini API \uD0A4").setDesc("Google AI Studio\uC5D0\uC11C \uBC1C\uAE09\uBC1B\uC740 \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694").addText(s=>s.setPlaceholder("AIza...").setValue(this.settings.geminiApiKey).onChange(r=>{this.settings.geminiApiKey=r})),this.renderNavButtons(t,1)}renderStep2(t){t.createEl("h2",{text:"2\uB2E8\uACC4: \uD3F4\uB354 \uAD6C\uC870 \uC124\uC815"}),t.createEl("p",{text:"\uB178\uD2B8\uB97C \uC815\uB9AC\uD560 \uD3F4\uB354 \uAD6C\uC870\uB97C \uC790\uB3D9\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4."});let n=t.createDiv({cls:"folder-preview"});n.innerHTML=`
			<pre>\u{1F4C1} 00 _Inbox/        \u2190 \uC5EC\uAE30\uC5D0 \uC4F0\uAE30\uB9CC \uD558\uC138\uC694
\u{1F4C1} 01 Projects/      \u2190 AI\uAC00 \uD504\uB85C\uC81D\uD2B8\uBCC4\uB85C \uC815\uB9AC
\u{1F4C1} 02 Library/       \u2190 \uCC38\uACE0\uC790\uB8CC \uBAA8\uC74C
\u{1F4C1} 03 Archives/      \u2190 \uC644\uB8CC\uB41C \uD56D\uBAA9
\u{1F4C1} 10 Zettelkasten/  \u2190 \uC601\uAD6C \uB178\uD2B8</pre>
		`,new lr.Setting(t).setName("\uD3F4\uB354 \uAD6C\uC870 \uC0DD\uC131").setDesc("\uC704 \uAD6C\uC870\uB85C \uD3F4\uB354\uB97C \uC790\uB3D9 \uC0DD\uC131\uD569\uB2C8\uB2E4").addButton(s=>s.setButtonText("\uD3F4\uB354 \uC0DD\uC131").setCta().onClick(async()=>{await this.createFolderStructure(),new lr.Notice("\uD3F4\uB354 \uAD6C\uC870\uAC00 \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4!"),s.setButtonText("\u2713 \uC644\uB8CC"),s.setDisabled(!0)})),this.renderNavButtons(t,2)}renderStep3(t){t.createEl("h2",{text:"3\uB2E8\uACC4: \uC0AC\uC6A9 \uBAA8\uB4DC \uC120\uD0DD"}),t.createEl("p",{text:"\uC0AC\uC6A9 \uD328\uD134\uC5D0 \uB9DE\uB294 \uBAA8\uB4DC\uB97C \uC120\uD0DD\uD558\uC138\uC694. \uB098\uC911\uC5D0 \uC124\uC815\uC5D0\uC11C \uBCC0\uACBD\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4."});let n=t.createDiv({cls:"preset-cards"}),s=["basic","power","experimental"];for(let r of s){let o=_t[r],a=this.settings.preset===r,l=n.createDiv({cls:`preset-card ${a?"selected":""}`});l.createDiv({text:o.icon,cls:"preset-icon"}),l.createDiv({text:o.label,cls:"preset-label"}),l.createDiv({text:o.longDesc,cls:"preset-desc"}),l.addEventListener("click",()=>{n.querySelectorAll(".preset-card").forEach(c=>c.removeClass("selected")),l.addClass("selected"),this.applyPreset(r)})}this.renderNavButtons(t,3)}renderStep4(t){t.createEl("h2",{text:"4\uB2E8\uACC4: \uC2DC\uC791\uD558\uAE30"}),t.createEl("p",{text:"\uC124\uC815\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4! \uC774\uC81C \uC0AC\uC6A9\uD574\uBCF4\uC138\uC694."});let n=t.createDiv({cls:"tips-container"});n.innerHTML=`
			<div class="tip">
				<strong>\u{1F4DD} \uB178\uD2B8 \uBD84\uB958</strong>
				<p>_Inbox\uC5D0 \uB178\uD2B8 \uC791\uC131 \u2192 <kbd>Ctrl+Shift+G</kbd></p>
			</div>
			<div class="tip">
				<strong>\u{1F517} URL \uC694\uC57D</strong>
				<p>\uB178\uD2B8\uC5D0 URL \uBD99\uC5EC\uB123\uAE30 \u2192 <kbd>Ctrl+Shift+U</kbd></p>
			</div>
			<div class="tip">
				<strong>\u{1F916} AI \uCC57\uBD07</strong>
				<p><kbd>Ctrl+Shift+'</kbd>\uB85C \uCC57\uBD07 \uC5F4\uAE30</p>
			</div>
		`;let s=t.createDiv({cls:"modal-button-container"});s.createEl("button",{text:"\uC774\uC804"}).addEventListener("click",()=>this.renderStep(3)),s.createEl("button",{text:"\uC2DC\uC791\uD558\uAE30",cls:"mod-cta"}).addEventListener("click",()=>{this.settings.onboardingCompleted=!0,this.onComplete(this.settings),this.close()})}renderNavButtons(t,n){let s=t.createDiv({cls:"modal-button-container"});n>1&&s.createEl("button",{text:"\uC774\uC804"}).addEventListener("click",()=>this.renderStep(n-1)),n<yb&&s.createEl("button",{text:"\uB2E4\uC74C",cls:"mod-cta"}).addEventListener("click",()=>{if(n===1&&!this.settings.geminiApiKey){new lr.Notice("API \uD0A4\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694");return}this.renderStep(n+1)})}async createFolderStructure(){let t=[this.settings.inboxFolder,this.settings.projectsFolder,this.settings.libraryFolder,this.settings.archivesFolder,this.settings.zettelFolder];for(let n of t)await this.app.vault.adapter.exists(n)||await this.app.vault.createFolder(n)}applyPreset(t){this.settings.preset=t;let n=zf[t];for(let[s,r]of Object.entries(n))qf.includes(s)||(this.settings[s]=r)}};var vi=require("obsidian");var Wh=class{constructor(e,t){this.dayCache=new Map;this.allEventsCache=[];this.fileEventMap=new Map;this.initialized=!1;this.changeListeners=new Set;this.vaultEventRefs=[];this.app=e,this.settings=t}async initialize(){if(this.initialized)return;let e=this.app.vault.getMarkdownFiles();for(let t of e){let n=await this.extractEventsFromFile(t);n.length>0&&(this.fileEventMap.set(t.path,n),this.allEventsCache.push(...n))}this.initialized=!0,this.registerVaultEvents()}registerVaultEvents(){let e=this.app.vault.on("create",async r=>{r instanceof vi.TFile&&r.extension==="md"&&await this.reloadFile(r)});this.vaultEventRefs.push(e);let t=this.app.vault.on("modify",async r=>{r instanceof vi.TFile&&r.extension==="md"&&await this.reloadFile(r)});this.vaultEventRefs.push(t);let n=this.app.vault.on("delete",r=>{r instanceof vi.TFile&&(this.invalidateFile(r.path),this.notifyListeners())});this.vaultEventRefs.push(n);let s=this.app.vault.on("rename",async(r,o)=>{r instanceof vi.TFile&&r.extension==="md"&&(this.invalidateFile(o),await this.reloadFile(r))});this.vaultEventRefs.push(s)}unregisterVaultEvents(){for(let e of this.vaultEventRefs)this.app.vault.offref(e);this.vaultEventRefs=[]}async reloadFile(e){this.invalidateFile(e.path);let t=await this.extractEventsFromFile(e);t.length>0&&(this.fileEventMap.set(e.path,t),this.allEventsCache.push(...t)),this.dayCache.clear(),this.notifyListeners()}invalidateFile(e){this.fileEventMap.get(e)&&(this.allEventsCache=this.allEventsCache.filter(n=>!n.source.path.startsWith(e)),this.fileEventMap.delete(e)),this.dayCache.clear()}addChangeListener(e){this.changeListeners.add(e)}removeChangeListener(e){this.changeListeners.delete(e)}notifyListeners(){for(let e of this.changeListeners)e()}updateSettings(e){this.settings=e}invalidateCache(){this.dayCache.clear(),this.allEventsCache=[],this.fileEventMap.clear(),this.initialized=!1}async getEventsForRange(e,t){return this.initialized||await this.initialize(),this.allEventsCache.filter(n=>n.start>=e&&n.start<=t)}async getEventsForDay(e){if(this.dayCache.has(e))return this.dayCache.get(e);let t=await this.getEventsForRange(new Date(e+"T00:00:00"),new Date(e+"T23:59:59")),n={date:e,notes:t.filter(s=>s.type==="note"),schedules:t.filter(s=>s.type==="schedule"),meetings:t.filter(s=>s.type==="meeting"),total:t.length};return this.dayCache.set(e,n),n}async getEventCountsForMonth(e,t){let n=new Map,s=new Date(e,t,1),r=new Date(e,t+1,0,23,59,59),o=await this.getEventsForRange(s,r);for(let a of o){let l=Le(a.start,this.settings.timezone);n.set(l,(n.get(l)||0)+1)}return n}async extractEventsFromFile(e){let t=[],n=await this.app.vault.cachedRead(e),s=this.parseFrontmatter(n),r=this.determineFileType(e,s),o=this.getEventDate(e,s);if(!o)return t;if(r==="meeting")t.push(this.createEvent(e,s,o,"meeting"));else if(this.isDailyNote(e)){let a=this.extractSchedulesFromDailyNote(e,n,o);t.push(...a)}else t.push(this.createEvent(e,s,o,"note"));return t}parseFrontmatter(e){let t=e.match(/^---\n([\s\S]*?)\n---/);if(!t)return{};try{return(0,vi.parseYaml)(t[1])||{}}catch(n){return{}}}determineFileType(e,t){return t.type==="meeting"||e.path.includes("\uD68C\uC758\uB85D")||e.path.includes("Meeting")?"meeting":this.isDailyNote(e)?"schedule":"note"}isDailyNote(e){let t=this.settings.dailyNotesFolder;return e.path.startsWith(t)}getEventDate(e,t){let n=["date","created","meetingDate"];for(let r of n){let o=t[r];if(o){let a=this.parseDate(o);if(a)return a}}let s=e.basename.match(/^(\d{4}-\d{2}-\d{2})$/);return s?new Date(s[1]+"T00:00:00"):new Date(e.stat.ctime)}parseDate(e){let t=e.match(/^(\d{4}-\d{2}-\d{2})/);if(t)return new Date(t[1]+"T00:00:00");let n=new Date(e);return isNaN(n.getTime())?null:n}createEvent(e,t,n,s){let r=t.title||e.basename,o=this.getProjectFromPath(e.path),a={note:"var(--interactive-accent)",schedule:"var(--text-success)",meeting:"var(--text-warning)"};return{id:e.path,title:r,start:n,allDay:s==="note"||s==="meeting",type:s,color:a[s],source:{path:e.path},metadata:{project:o,tags:t.tags||[],summary:t.summary||void 0}}}extractSchedulesFromDailyNote(e,t,n){let s=[],r=t.split(`
`);for(let o=0;o<r.length;o++){let a=r[o];if(a.match(/^- \[[ x]\]/)){let l=a.match(/^- \[[ x]\] (\d{1,2}:\d{2})?\s*(.+?)(?:\s+[]\s*(\d{4}-\d{2}-\d{2}))?$/);if(l){let c=l[1],d=l[2].trim(),h=l[3],p;if(h?p=new Date(h+"T00:00:00"):p=new Date(n),c){let[m,y]=c.split(":").map(Number);p.setHours(m,y,0,0)}s.push({id:`${e.path}:${o}`,title:d,start:p,allDay:!c,type:"schedule",color:"var(--text-success)",source:{path:e.path,lineNumber:o+1},metadata:{project:this.getProjectFromPath(e.path)}})}}}return s}getProjectFromPath(e){let t=this.settings.projectsFolder;if(e.startsWith(t+"/")){let n=e.substring(t.length+1),s=n.indexOf("/");if(s>0)return n.substring(0,s)}}hasTimeComponent(e){return e.getHours()!==0||e.getMinutes()!==0}async moveEvent(e,t){let[n,s]=e.split(":"),r=this.app.vault.getAbstractFileByPath(n);if(!(r instanceof vi.TFile))return!1;let o=await this.app.vault.read(r);if(s){let a=parseInt(s)-1,l=o.split(`
`);if(a>=0&&a<l.length){let c=l[a],d=Le(t,this.settings.timezone),h=c.replace(/[]\s*\d{4}-\d{2}-\d{2}/,`\u{1F4C5} ${d}`);if(h!==c)return l[a]=h,await this.app.vault.modify(r,l.join(`
`)),this.invalidateCache(),!0}}else{let a=Le(t,this.settings.timezone),l=this.updateFrontmatterDate(o,a);if(l!==o)return await this.app.vault.modify(r,l),this.invalidateCache(),!0}return!1}updateFrontmatterDate(e,t){let n=e.match(/^---\n([\s\S]*?)\n---/);if(!n)return e;let s=n[1],r;return s.includes("date:")?r=s.replace(/date:\s*.*/,`date: ${t}`):r=`date: ${t}
${s}`,e.replace(/^---\n[\s\S]*?\n---/,`---
${r}
---`)}async deleteEvent(e){let[t,n]=e.split(":"),s=this.app.vault.getAbstractFileByPath(t);if(!(s instanceof vi.TFile))return!1;if(n){let r=parseInt(n)-1,a=(await this.app.vault.read(s)).split(`
`);if(r>=0&&r<a.length)return a.splice(r,1),await this.app.vault.modify(s,a.join(`
`)),this.invalidateCache(),!0}else return!1;return!1}async openEvent(e){let[t,n]=e.split(":"),s=this.app.vault.getAbstractFileByPath(t);if(s instanceof vi.TFile){let r=this.app.workspace.getLeaf();if(await r.openFile(s),n){let o=parseInt(n)-1,a=r.view;"editor"in a&&a.editor&&a.editor.setCursor({line:o,ch:0})}}}};var iI=require("obsidian");var nI=require("obsidian"),ea=class extends nI.Modal{constructor(t,n,s,r){super(t);this.onEventClick=null;this.date=n,this.dataProvider=s,this.settings=r}setOnEventClick(t){this.onEventClick=t}async onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-calendar-day-modal"),t.createEl("p",{text:"\uB85C\uB529 \uC911..."});let n=await this.dataProvider.getEventsForDay(this.date);t.empty();let s=new Date(this.date+"T00:00:00"),o=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"][s.getDay()],a=t.createDiv({cls:"day-modal-header"});if(a.style.marginBottom="16px",a.createEl("h2",{text:`${this.date} (${o}\uC694\uC77C)`}).style.margin="0",a.createEl("p",{text:`\uCD1D ${n.total}\uAC1C \uD56D\uBAA9`,cls:"setting-item-description"}).style.margin="4px 0 0 0",n.total===0){let h=t.createDiv({cls:"day-modal-empty"});h.style.padding="32px",h.style.textAlign="center",h.style.color="var(--text-muted)",h.setText("\uC774 \uB0A0\uC9DC\uC5D0 \uB4F1\uB85D\uB41C \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let l=t.createDiv({cls:"day-modal-sections"});l.style.maxHeight="400px",l.style.overflowY="auto",n.schedules.length>0&&this.renderSection(l,"\uC77C\uC815",n.schedules,"schedule"),n.notes.length>0&&this.renderSection(l,"\uB178\uD2B8",n.notes,"note"),n.meetings.length>0&&this.renderSection(l,"\uD68C\uC758\uB85D",n.meetings,"meeting");let c=t.createDiv({cls:"modal-button-container"});c.style.display="flex",c.style.justifyContent="flex-end",c.style.marginTop="16px",c.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close())}renderSection(t,n,s,r){var d;let o={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"},a=t.createDiv({cls:"day-section"});a.style.marginBottom="16px";let l=a.createDiv({cls:"section-header"});l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginBottom="8px",l.createEl("span",{text:o[r]}),l.createEl("span",{text:`${n} (${s.length})`}).style.fontWeight="500";let c=a.createDiv({cls:"section-list"});for(let h of s){let p=c.createDiv({cls:"event-item"});p.style.display="flex",p.style.alignItems="center",p.style.padding="8px 12px",p.style.marginBottom="4px",p.style.border="1px solid var(--background-modifier-border)",p.style.borderRadius="6px",p.style.cursor="pointer",p.style.transition="background-color 0.15s";let m=p.createDiv({cls:"event-indicator"});m.style.width="4px",m.style.height="24px",m.style.borderRadius="2px",m.style.marginRight="12px",m.style.backgroundColor=h.color||"var(--interactive-accent)";let y=p.createDiv({cls:"event-info"});y.style.flex="1",y.style.minWidth="0";let v=y.createEl("div",{text:h.title});v.style.fontWeight="500",v.style.overflow="hidden",v.style.textOverflow="ellipsis",v.style.whiteSpace="nowrap";let E=y.createEl("div");E.style.fontSize="12px",E.style.color="var(--text-muted)";let S=[];if(h.allDay)S.push("\uC885\uC77C");else{let C=h.start.getHours().toString().padStart(2,"0"),_=h.start.getMinutes().toString().padStart(2,"0");S.push(`${C}:${_}`)}(d=h.metadata)!=null&&d.project&&S.push(h.metadata.project),E.setText(S.join(" | ")),p.addEventListener("mouseenter",()=>{p.style.backgroundColor="var(--background-modifier-hover)"}),p.addEventListener("mouseleave",()=>{p.style.backgroundColor=""}),p.addEventListener("click",async()=>{this.onEventClick?this.onEventClick(h):(await this.dataProvider.openEvent(h.id),this.close())})}}onClose(){this.contentEl.empty()}};var Sc="zfb-mini-calendar",Yh=class extends iI.ItemView{constructor(t,n,s){super(t);this.eventCounts=new Map;this.settings=n,this.dataProvider=s;let r=new Date;this.currentYear=r.getFullYear(),this.currentMonth=r.getMonth(),this.refreshCallback=()=>this.renderCalendar()}getViewType(){return Sc}getDisplayText(){return"\uCE98\uB9B0\uB354"}getIcon(){return"calendar"}async onOpen(){this.dataProvider.addChangeListener(this.refreshCallback),await this.renderCalendar()}async onClose(){this.dataProvider.removeChangeListener(this.refreshCallback),this.contentEl.empty()}updateSettings(t){this.settings=t,this.renderCalendar()}async renderCalendar(){let t=this.contentEl;t.empty(),t.addClass("zfb-mini-calendar"),this.eventCounts=await this.dataProvider.getEventCountsForMonth(this.currentYear,this.currentMonth),this.renderHeader(t),this.renderWeekdayHeader(t),this.renderDateGrid(t),this.renderTodayButton(t)}renderHeader(t){let n=t.createDiv({cls:"mini-calendar-header"});n.createEl("button",{cls:"nav-btn",text:"<"}).addEventListener("click",()=>this.navigateMonth(-1));let r=["1\uC6D4","2\uC6D4","3\uC6D4","4\uC6D4","5\uC6D4","6\uC6D4","7\uC6D4","8\uC6D4","9\uC6D4","10\uC6D4","11\uC6D4","12\uC6D4"];n.createEl("span",{cls:"month-title",text:`${this.currentYear}\uB144 ${r[this.currentMonth]}`}),n.createEl("button",{cls:"nav-btn",text:">"}).addEventListener("click",()=>this.navigateMonth(1))}renderWeekdayHeader(t){let n=t.createDiv({cls:"weekday-header"}),s=this.settings.calendarFirstDayOfWeek===1?["\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0","\uC77C"]:["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"];for(let r of s)n.createEl("span",{text:r})}renderDateGrid(t){let n=t.createDiv({cls:"date-grid"}),s=new Date(this.currentYear,this.currentMonth,1),r=new Date(this.currentYear,this.currentMonth+1,0),o=s.getDay();this.settings.calendarFirstDayOfWeek===1&&(o=o===0?6:o-1);let a=Le(new Date,this.settings.timezone);for(let l=0;l<o;l++)n.createDiv({cls:"date-cell empty"});for(let l=1;l<=r.getDate();l++){let c=`${this.currentYear}-${String(this.currentMonth+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`,d=this.eventCounts.get(c)||0,h=c===a,p=n.createDiv({cls:"date-cell"});if(h&&p.addClass("today"),p.createEl("span",{cls:"day-number",text:String(l)}),d>0){let m=p.createDiv({cls:"event-dots"}),y=Math.min(d,3);for(let v=0;v<y;v++)m.createDiv({cls:"event-dot"})}p.addEventListener("click",()=>{this.openDayModal(c)})}}renderTodayButton(t){t.createDiv({cls:"today-btn-container"}).createEl("button",{cls:"today-btn",text:"\uC624\uB298"}).addEventListener("click",()=>{let r=new Date;this.currentYear=r.getFullYear(),this.currentMonth=r.getMonth(),this.renderCalendar()})}navigateMonth(t){this.currentMonth+=t,this.currentMonth<0?(this.currentMonth=11,this.currentYear--):this.currentMonth>11&&(this.currentMonth=0,this.currentYear++),this.renderCalendar()}openDayModal(t){new ea(this.app,t,this.dataProvider,this.settings).open()}};var PP=require("obsidian");var lv,q,lI,rA,Ac,ta,sI,cI,dI,rv={},uI=[],TU=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function cr(i,e){for(var t in e)i[t]=e[t];return i}function hI(i){var e=i.parentNode;e&&e.removeChild(i)}function x(i,e,t){var n,s,r,o={};for(r in e)r=="key"?n=e[r]:r=="ref"?s=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?lv.call(arguments,2):t),typeof i=="function"&&i.defaultProps!=null)for(r in i.defaultProps)o[r]===void 0&&(o[r]=i.defaultProps[r]);return sv(i,o,n,s,null)}function sv(i,e,t,n,s){var r={type:i,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:s==null?++lI:s};return s==null&&q.vnode!=null&&q.vnode(r),r}function Ne(){return{current:null}}function ae(i){return i.children}function xU(i,e,t,n,s){var r;for(r in t)r==="children"||r==="key"||r in e||ov(i,r,null,t[r],n);for(r in e)s&&typeof e[r]!="function"||r==="children"||r==="key"||r==="value"||r==="checked"||t[r]===e[r]||ov(i,r,e[r],t[r],n)}function rI(i,e,t){e[0]==="-"?i.setProperty(e,t==null?"":t):i[e]=t==null?"":typeof t!="number"||TU.test(e)?t:t+"px"}function ov(i,e,t,n,s){var r;e:if(e==="style")if(typeof t=="string")i.style.cssText=t;else{if(typeof n=="string"&&(i.style.cssText=n=""),n)for(e in n)t&&e in t||rI(i.style,e,"");if(t)for(e in t)n&&t[e]===n[e]||rI(i.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")r=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in i?e.toLowerCase().slice(2):e.slice(2),i.l||(i.l={}),i.l[e+r]=t,t?n||i.addEventListener(e,r?aI:oI,r):i.removeEventListener(e,r?aI:oI,r);else if(e!=="dangerouslySetInnerHTML"){if(s)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in i)try{i[e]=t==null?"":t;break e}catch(o){}typeof t=="function"||(t==null||t===!1&&e.indexOf("-")==-1?i.removeAttribute(e):i.setAttribute(e,t))}}function oI(i){Ac=!0;try{return this.l[i.type+!1](q.event?q.event(i):i)}finally{Ac=!1}}function aI(i){Ac=!0;try{return this.l[i.type+!0](q.event?q.event(i):i)}finally{Ac=!1}}function st(i,e){this.props=i,this.context=e}function Kh(i,e){if(e==null)return i.__?Kh(i.__,i.__.__k.indexOf(i)+1):null;for(var t;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null)return t.__e;return typeof i.type=="function"?Kh(i):null}function fI(i){var e,t;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,e=0;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null){i.__e=i.__c.base=t.__e;break}return fI(i)}}function RU(i){Ac?setTimeout(i):cI(i)}function sA(i){(!i.__d&&(i.__d=!0)&&ta.push(i)&&!av.__r++||sI!==q.debounceRendering)&&((sI=q.debounceRendering)||RU)(av)}function av(){var i,e,t,n,s,r,o,a;for(ta.sort(function(l,c){return l.__v.__b-c.__v.__b});i=ta.shift();)i.__d&&(e=ta.length,n=void 0,s=void 0,o=(r=(t=i).__v).__e,(a=t.__P)&&(n=[],(s=cr({},r)).__v=r.__v+1,oA(a,r,s,t.__n,a.ownerSVGElement!==void 0,r.__h!=null?[o]:null,n,o==null?Kh(r):o,r.__h),vI(n,r),r.__e!=o&&fI(r)),ta.length>e&&ta.sort(function(l,c){return l.__v.__b-c.__v.__b}));av.__r=0}function pI(i,e,t,n,s,r,o,a,l,c){var d,h,p,m,y,v,E,S=n&&n.__k||uI,C=S.length;for(t.__k=[],d=0;d<e.length;d++)if((m=t.__k[d]=(m=e[d])==null||typeof m=="boolean"?null:typeof m=="string"||typeof m=="number"||typeof m=="bigint"?sv(null,m,null,null,m):Array.isArray(m)?sv(ae,{children:m},null,null,null):m.__b>0?sv(m.type,m.props,m.key,m.ref?m.ref:null,m.__v):m)!=null){if(m.__=t,m.__b=t.__b+1,(p=S[d])===null||p&&m.key==p.key&&m.type===p.type)S[d]=void 0;else for(h=0;h<C;h++){if((p=S[h])&&m.key==p.key&&m.type===p.type){S[h]=void 0;break}p=null}oA(i,m,p=p||rv,s,r,o,a,l,c),y=m.__e,(h=m.ref)&&p.ref!=h&&(E||(E=[]),p.ref&&E.push(p.ref,null,m),E.push(h,m.__c||y,m)),y!=null?(v==null&&(v=y),typeof m.type=="function"&&m.__k===p.__k?m.__d=l=gI(m,l,i):l=mI(i,m,p,S,y,l),typeof t.type=="function"&&(t.__d=l)):l&&p.__e==l&&l.parentNode!=i&&(l=Kh(p))}for(t.__e=v,d=C;d--;)S[d]!=null&&(typeof t.type=="function"&&S[d].__e!=null&&S[d].__e==t.__d&&(t.__d=yI(n).nextSibling),EI(S[d],S[d]));if(E)for(d=0;d<E.length;d++)bI(E[d],E[++d],E[++d])}function gI(i,e,t){for(var n,s=i.__k,r=0;s&&r<s.length;r++)(n=s[r])&&(n.__=i,e=typeof n.type=="function"?gI(n,e,t):mI(t,n,n,s,n.__e,e));return e}function Jh(i,e){return e=e||[],i==null||typeof i=="boolean"||(Array.isArray(i)?i.some(function(t){Jh(t,e)}):e.push(i)),e}function mI(i,e,t,n,s,r){var o,a,l;if(e.__d!==void 0)o=e.__d,e.__d=void 0;else if(t==null||s!=r||s.parentNode==null)e:if(r==null||r.parentNode!==i)i.appendChild(s),o=null;else{for(a=r,l=0;(a=a.nextSibling)&&l<n.length;l+=1)if(a==s)break e;i.insertBefore(s,r),o=r}return o!==void 0?o:s.nextSibling}function yI(i){var e,t,n;if(i.type==null||typeof i.type=="string")return i.__e;if(i.__k){for(e=i.__k.length-1;e>=0;e--)if((t=i.__k[e])&&(n=yI(t)))return n}return null}function oA(i,e,t,n,s,r,o,a,l){var c,d,h,p,m,y,v,E,S,C,_,T,R,I,D,k=e.type;if(e.constructor!==void 0)return null;t.__h!=null&&(l=t.__h,a=e.__e=t.__e,e.__h=null,r=[a]),(c=q.__b)&&c(e);try{e:if(typeof k=="function"){if(E=e.props,S=(c=k.contextType)&&n[c.__c],C=c?S?S.props.value:c.__:n,t.__c?v=(d=e.__c=t.__c).__=d.__E:("prototype"in k&&k.prototype.render?e.__c=d=new k(E,C):(e.__c=d=new st(E,C),d.constructor=k,d.render=DU),S&&S.sub(d),d.props=E,d.state||(d.state={}),d.context=C,d.__n=n,h=d.__d=!0,d.__h=[],d._sb=[]),d.__s==null&&(d.__s=d.state),k.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=cr({},d.__s)),cr(d.__s,k.getDerivedStateFromProps(E,d.__s))),p=d.props,m=d.state,d.__v=e,h)k.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(k.getDerivedStateFromProps==null&&E!==p&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(E,C),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(E,d.__s,C)===!1||e.__v===t.__v){for(e.__v!==t.__v&&(d.props=E,d.state=d.__s,d.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.forEach(function(N){N&&(N.__=e)}),_=0;_<d._sb.length;_++)d.__h.push(d._sb[_]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(E,d.__s,C),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(p,m,y)})}if(d.context=C,d.props=E,d.__P=i,T=q.__r,R=0,"prototype"in k&&k.prototype.render){for(d.state=d.__s,d.__d=!1,T&&T(e),c=d.render(d.props,d.state,d.context),I=0;I<d._sb.length;I++)d.__h.push(d._sb[I]);d._sb=[]}else do d.__d=!1,T&&T(e),c=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++R<25);d.state=d.__s,d.getChildContext!=null&&(n=cr(cr({},n),d.getChildContext())),h||d.getSnapshotBeforeUpdate==null||(y=d.getSnapshotBeforeUpdate(p,m)),D=c!=null&&c.type===ae&&c.key==null?c.props.children:c,pI(i,Array.isArray(D)?D:[D],e,t,n,s,r,o,a,l),d.base=e.__e,e.__h=null,d.__h.length&&o.push(d),v&&(d.__E=d.__=null),d.__e=!1}else r==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=IU(t.__e,e,t,n,s,r,o,l);(c=q.diffed)&&c(e)}catch(N){e.__v=null,(l||r!=null)&&(e.__e=a,e.__h=!!l,r[r.indexOf(a)]=null),q.__e(N,e,t)}}function vI(i,e){q.__c&&q.__c(e,i),i.some(function(t){try{i=t.__h,t.__h=[],i.some(function(n){n.call(t)})}catch(n){q.__e(n,t.__v)}})}function IU(i,e,t,n,s,r,o,a){var l,c,d,h=t.props,p=e.props,m=e.type,y=0;if(m==="svg"&&(s=!0),r!=null){for(;y<r.length;y++)if((l=r[y])&&"setAttribute"in l==!!m&&(m?l.localName===m:l.nodeType===3)){i=l,r[y]=null;break}}if(i==null){if(m===null)return document.createTextNode(p);i=s?document.createElementNS("http://www.w3.org/2000/svg",m):document.createElement(m,p.is&&p),r=null,a=!1}if(m===null)h===p||a&&i.data===p||(i.data=p);else{if(r=r&&lv.call(i.childNodes),c=(h=t.props||rv).dangerouslySetInnerHTML,d=p.dangerouslySetInnerHTML,!a){if(r!=null)for(h={},y=0;y<i.attributes.length;y++)h[i.attributes[y].name]=i.attributes[y].value;(d||c)&&(d&&(c&&d.__html==c.__html||d.__html===i.innerHTML)||(i.innerHTML=d&&d.__html||""))}if(xU(i,p,h,s,a),d)e.__k=[];else if(y=e.props.children,pI(i,Array.isArray(y)?y:[y],e,t,n,s&&m!=="foreignObject",r,o,r?r[0]:t.__k&&Kh(t,0),a),r!=null)for(y=r.length;y--;)r[y]!=null&&hI(r[y]);a||("value"in p&&(y=p.value)!==void 0&&(y!==i.value||m==="progress"&&!y||m==="option"&&y!==h.value)&&ov(i,"value",y,h.value,!1),"checked"in p&&(y=p.checked)!==void 0&&y!==i.checked&&ov(i,"checked",y,h.checked,!1))}return i}function bI(i,e,t){try{typeof i=="function"?i(e):i.current=e}catch(n){q.__e(n,t)}}function EI(i,e,t){var n,s;if(q.unmount&&q.unmount(i),(n=i.ref)&&(n.current&&n.current!==i.__e||bI(n,null,e)),(n=i.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(r){q.__e(r,e)}n.base=n.__P=null,i.__c=void 0}if(n=i.__k)for(s=0;s<n.length;s++)n[s]&&EI(n[s],e,t||typeof i.type!="function");t||i.__e==null||hI(i.__e),i.__=i.__e=i.__d=void 0}function DU(i,e,t){return this.constructor(i,t)}function dr(i,e,t){var n,s,r;q.__&&q.__(i,e),s=(n=typeof t=="function")?null:t&&t.__k||e.__k,r=[],oA(e,i=(!n&&t||e).__k=x(ae,null,[i]),s||rv,rv,e.ownerSVGElement!==void 0,!n&&t?[t]:s?null:e.firstChild?lv.call(e.childNodes):null,r,!n&&t?t:s?s.__e:e.firstChild,n),vI(r,i)}function cv(i,e){var t={__c:e="__cC"+dI++,__:i,Consumer:function(n,s){return n.children(s)},Provider:function(n){var s,r;return this.getChildContext||(s=[],(r={})[e]=this,this.getChildContext=function(){return r},this.shouldComponentUpdate=function(o){this.props.value!==o.value&&s.some(function(a){a.__e=!0,sA(a)})},this.sub=function(o){s.push(o);var a=o.componentWillUnmount;o.componentWillUnmount=function(){s.splice(s.indexOf(o),1),a&&a.call(o)}}),n.children}};return t.Provider.__=t.Consumer.contextType=t}lv=uI.slice,q={__e:function(i,e,t,n){for(var s,r,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((r=s.constructor)&&r.getDerivedStateFromError!=null&&(s.setState(r.getDerivedStateFromError(i)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(i,n||{}),o=s.__d),o)return s.__E=s}catch(a){i=a}throw i}},lI=0,rA=function(i){return i!=null&&i.constructor===void 0},Ac=!1,st.prototype.setState=function(i,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=cr({},this.state),typeof i=="function"&&(i=i(cr({},t),this.props)),i&&cr(t,i),i!=null&&this.__v&&(e&&this._sb.push(e),sA(this))},st.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),sA(this))},st.prototype.render=ae,ta=[],cI=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,av.__r=0,dI=0;var MU,bi,aA,wI;var RI=[],lA=[],SI=q.__b,AI=q.__r,CI=q.diffed,_I=q.__c,TI=q.unmount;function kU(){for(var i;i=RI.shift();)if(i.__P&&i.__H)try{i.__H.__h.forEach(dv),i.__H.__h.forEach(cA),i.__H.__h=[]}catch(e){i.__H.__h=[],q.__e(e,i.__v)}}q.__b=function(i){bi=null,SI&&SI(i)},q.__r=function(i){AI&&AI(i),MU=0;var e=(bi=i.__c).__H;e&&(aA===bi?(e.__h=[],bi.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.__V=lA,t.__N=t.i=void 0})):(e.__h.forEach(dv),e.__h.forEach(cA),e.__h=[])),aA=bi},q.diffed=function(i){CI&&CI(i);var e=i.__c;e&&e.__H&&(e.__H.__h.length&&(RI.push(e)!==1&&wI===q.requestAnimationFrame||((wI=q.requestAnimationFrame)||NU)(kU)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.__V!==lA&&(t.__=t.__V),t.i=void 0,t.__V=lA})),aA=bi=null},q.__c=function(i,e){e.some(function(t){try{t.__h.forEach(dv),t.__h=t.__h.filter(function(n){return!n.__||cA(n)})}catch(n){e.some(function(s){s.__h&&(s.__h=[])}),e=[],q.__e(n,t.__v)}}),_I&&_I(i,e)},q.unmount=function(i){TI&&TI(i);var e,t=i.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{dv(n)}catch(s){e=s}}),t.__H=void 0,e&&q.__e(e,t.__v))};var xI=typeof requestAnimationFrame=="function";function NU(i){var e,t=function(){clearTimeout(n),xI&&cancelAnimationFrame(e),setTimeout(i)},n=setTimeout(t,100);xI&&(e=requestAnimationFrame(t))}function dv(i){var e=bi,t=i.__c;typeof t=="function"&&(i.__c=void 0,t()),bi=e}function cA(i){var e=bi;i.__c=i.__(),bi=e}function FU(i,e){for(var t in e)i[t]=e[t];return i}function II(i,e){for(var t in i)if(t!=="__source"&&!(t in e))return!0;for(var n in e)if(n!=="__source"&&i[n]!==e[n])return!0;return!1}function DI(i){this.props=i}(DI.prototype=new st).isPureReactComponent=!0,DI.prototype.shouldComponentUpdate=function(i,e){return II(this.props,i)||II(this.state,e)};var PI=q.__b;q.__b=function(i){i.type&&i.type.__f&&i.ref&&(i.props.ref=i.ref,i.ref=null),PI&&PI(i)};var Jz=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;var LU=q.__e;q.__e=function(i,e,t,n){if(i.then){for(var s,r=e;r=r.__;)if((s=r.__c)&&s.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),s.__c(i,e)}LU(i,e,t,n)};var MI=q.unmount;function UI(i,e,t){return i&&(i.__c&&i.__c.__H&&(i.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),i.__c.__H=null),(i=FU({},i)).__c!=null&&(i.__c.__P===t&&(i.__c.__P=e),i.__c=null),i.__k=i.__k&&i.__k.map(function(n){return UI(n,e,t)})),i}function HI(i,e,t){return i&&(i.__v=null,i.__k=i.__k&&i.__k.map(function(n){return HI(n,e,t)}),i.__c&&i.__c.__P===e&&(i.__e&&t.insertBefore(i.__e,i.__d),i.__c.__e=!0,i.__c.__P=t)),i}function dA(){this.__u=0,this.t=null,this.__b=null}function BI(i){var e=i.__.__c;return e&&e.__a&&e.__a(i)}function uv(){this.u=null,this.o=null}q.unmount=function(i){var e=i.__c;e&&e.__R&&e.__R(),e&&i.__h===!0&&(i.type=null),MI&&MI(i)},(dA.prototype=new st).__c=function(i,e){var t=e.__c,n=this;n.t==null&&(n.t=[]),n.t.push(t);var s=BI(n.__v),r=!1,o=function(){r||(r=!0,t.__R=null,s?s(a):a())};t.__R=o;var a=function(){if(!--n.__u){if(n.state.__a){var c=n.state.__a;n.__v.__k[0]=HI(c,c.__c.__P,c.__c.__O)}var d;for(n.setState({__a:n.__b=null});d=n.t.pop();)d.forceUpdate()}},l=e.__h===!0;n.__u++||l||n.setState({__a:n.__b=n.__v.__k[0]}),i.then(o,o)},dA.prototype.componentWillUnmount=function(){this.t=[]},dA.prototype.render=function(i,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=UI(this.__b,t,n.__O=n.__P)}this.__b=null}var s=e.__a&&x(ae,null,i.fallback);return s&&(s.__h=null),[x(ae,null,e.__a?null:i.children),s]};var kI=function(i,e,t){if(++t[1]===t[0]&&i.o.delete(e),i.props.revealOrder&&(i.props.revealOrder[0]!=="t"||!i.o.size))for(t=i.u;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;i.u=t=t[2]}};function OU(i){return this.getChildContext=function(){return i.context},i.children}function UU(i){var e=this,t=i.i;e.componentWillUnmount=function(){dr(null,e.l),e.l=null,e.i=null},e.i&&e.i!==t&&e.componentWillUnmount(),i.__v?(e.l||(e.i=t,e.l={nodeType:1,parentNode:t,childNodes:[],appendChild:function(n){this.childNodes.push(n),e.i.appendChild(n)},insertBefore:function(n,s){this.childNodes.push(n),e.i.appendChild(n)},removeChild:function(n){this.childNodes.splice(this.childNodes.indexOf(n)>>>1,1),e.i.removeChild(n)}}),dr(x(OU,{context:e.context},i.__v),e.l)):e.l&&e.componentWillUnmount()}function GI(i,e){var t=x(UU,{__v:i,i:e});return t.containerInfo=e,t}(uv.prototype=new st).__a=function(i){var e=this,t=BI(e.__v),n=e.o.get(i);return n[0]++,function(s){var r=function(){e.props.revealOrder?(n.push(s),kI(e,i,n)):s()};t?t(r):r()}},uv.prototype.render=function(i){this.u=null,this.o=new Map;var e=Jh(i.children);i.revealOrder&&i.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.o.set(e[t],this.u=[1,0,this.u]);return i.children},uv.prototype.componentDidUpdate=uv.prototype.componentDidMount=function(){var i=this;this.o.forEach(function(e,t){kI(i,t,e)})};var HU=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,BU=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,GU=typeof document!="undefined",VU=function(i){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(i)};st.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(i){Object.defineProperty(st.prototype,i,{configurable:!0,get:function(){return this["UNSAFE_"+i]},set:function(e){Object.defineProperty(this,i,{configurable:!0,writable:!0,value:e})}})});var NI=q.event;function $U(){}function zU(){return this.cancelBubble}function qU(){return this.defaultPrevented}q.event=function(i){return NI&&(i=NI(i)),i.persist=$U,i.isPropagationStopped=zU,i.isDefaultPrevented=qU,i.nativeEvent=i};var WU,FI={configurable:!0,get:function(){return this.class}},LI=q.vnode;q.vnode=function(i){var e=i.type,t=i.props,n=t;if(typeof e=="string"){var s=e.indexOf("-")===-1;for(var r in n={},t){var o=t[r];GU&&r==="children"&&e==="noscript"||r==="value"&&"defaultValue"in t&&o==null||(r==="defaultValue"&&"value"in t&&t.value==null?r="value":r==="download"&&o===!0?o="":/ondoubleclick/i.test(r)?r="ondblclick":/^onchange(textarea|input)/i.test(r+e)&&!VU(t.type)?r="oninput":/^onfocus$/i.test(r)?r="onfocusin":/^onblur$/i.test(r)?r="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(r)?r=r.toLowerCase():s&&BU.test(r)?r=r.replace(/[A-Z0-9]/g,"-$&").toLowerCase():o===null&&(o=void 0),/^oninput$/i.test(r)&&(r=r.toLowerCase(),n[r]&&(r="oninputCapture")),n[r]=o)}e=="select"&&n.multiple&&Array.isArray(n.value)&&(n.value=Jh(t.children).forEach(function(a){a.props.selected=n.value.indexOf(a.props.value)!=-1})),e=="select"&&n.defaultValue!=null&&(n.value=Jh(t.children).forEach(function(a){a.props.selected=n.multiple?n.defaultValue.indexOf(a.props.value)!=-1:n.defaultValue==a.props.value})),i.props=n,t.class!=t.className&&(FI.enumerable="className"in t,t.className!=null&&(n.class=t.className),Object.defineProperty(n,"className",FI))}i.$$typeof=HU,LI&&LI(i)};var OI=q.__r;q.__r=function(i){OI&&OI(i),WU=i.__c};var tD=[],wA=new Map;function vr(i){tD.push(i),wA.forEach(e=>{sD(e,i)})}function nD(i){i.isConnected&&i.getRootNode&&iD(i.getRootNode())}function iD(i){let e=wA.get(i);if(!e||!e.isConnected){if(e=i.querySelector("style[data-fullcalendar]"),!e){e=document.createElement("style"),e.setAttribute("data-fullcalendar","");let t=KU();t&&(e.nonce=t);let n=i===document?document.head:i,s=i===document?n.querySelector("script,link[rel=stylesheet],link[as=style],style"):n.firstChild;n.insertBefore(e,s)}wA.set(i,e),YU(e)}}function YU(i){for(let e of tD)sD(i,e)}function sD(i,e){let{sheet:t}=i,n=t.cssRules.length;e.split("}").forEach((s,r)=>{s=s.trim(),s&&t.insertRule(s+"}",n+r)})}var uA;function KU(){return uA===void 0&&(uA=JU()),uA}function JU(){let i=document.querySelector('meta[name="csp-nonce"]');if(i&&i.hasAttribute("content"))return i.getAttribute("content");let e=document.querySelector("script[nonce]");return e&&e.nonce||""}typeof document!="undefined"&&iD(document);var XU=':root{--fc-small-font-size:.85em;--fc-page-bg-color:#fff;--fc-neutral-bg-color:hsla(0,0%,82%,.3);--fc-neutral-text-color:grey;--fc-border-color:#ddd;--fc-button-text-color:#fff;--fc-button-bg-color:#2c3e50;--fc-button-border-color:#2c3e50;--fc-button-hover-bg-color:#1e2b37;--fc-button-hover-border-color:#1a252f;--fc-button-active-bg-color:#1a252f;--fc-button-active-border-color:#151e27;--fc-event-bg-color:#3788d8;--fc-event-border-color:#3788d8;--fc-event-text-color:#fff;--fc-event-selected-overlay-color:rgba(0,0,0,.25);--fc-more-link-bg-color:#d0d0d0;--fc-more-link-text-color:inherit;--fc-event-resizer-thickness:8px;--fc-event-resizer-dot-total-width:8px;--fc-event-resizer-dot-border-width:1px;--fc-non-business-color:hsla(0,0%,84%,.3);--fc-bg-event-color:#8fdf82;--fc-bg-event-opacity:0.3;--fc-highlight-color:rgba(188,232,241,.3);--fc-today-bg-color:rgba(255,220,40,.15);--fc-now-indicator-color:red}.fc-not-allowed,.fc-not-allowed .fc-event{cursor:not-allowed}.fc{display:flex;flex-direction:column;font-size:1em}.fc,.fc *,.fc :after,.fc :before{box-sizing:border-box}.fc table{border-collapse:collapse;border-spacing:0;font-size:1em}.fc th{text-align:center}.fc td,.fc th{padding:0;vertical-align:top}.fc a[data-navlink]{cursor:pointer}.fc a[data-navlink]:hover{text-decoration:underline}.fc-direction-ltr{direction:ltr;text-align:left}.fc-direction-rtl{direction:rtl;text-align:right}.fc-theme-standard td,.fc-theme-standard th{border:1px solid var(--fc-border-color)}.fc-liquid-hack td,.fc-liquid-hack th{position:relative}@font-face{font-family:fcicons;font-style:normal;font-weight:400;src:url("data:application/x-font-ttf;charset=utf-8;base64,AAEAAAALAIAAAwAwT1MvMg8SBfAAAAC8AAAAYGNtYXAXVtKNAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZgYydxIAAAF4AAAFNGhlYWQUJ7cIAAAGrAAAADZoaGVhB20DzAAABuQAAAAkaG10eCIABhQAAAcIAAAALGxvY2ED4AU6AAAHNAAAABhtYXhwAA8AjAAAB0wAAAAgbmFtZXsr690AAAdsAAABhnBvc3QAAwAAAAAI9AAAACAAAwPAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBgPA/8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qb//f//AAAAAAAg6QD//f//AAH/4xcEAAMAAQAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAWIAjQKeAskAEwAAJSc3NjQnJiIHAQYUFwEWMjc2NCcCnuLiDQ0MJAz/AA0NAQAMJAwNDcni4gwjDQwM/wANIwz/AA0NDCMNAAAAAQFiAI0CngLJABMAACUBNjQnASYiBwYUHwEHBhQXFjI3AZ4BAA0N/wAMJAwNDeLiDQ0MJAyNAQAMIw0BAAwMDSMM4uINIwwNDQAAAAIA4gC3Ax4CngATACcAACUnNzY0JyYiDwEGFB8BFjI3NjQnISc3NjQnJiIPAQYUHwEWMjc2NCcB87e3DQ0MIw3VDQ3VDSMMDQ0BK7e3DQ0MJAzVDQ3VDCQMDQ3zuLcMJAwNDdUNIwzWDAwNIwy4twwkDA0N1Q0jDNYMDA0jDAAAAgDiALcDHgKeABMAJwAAJTc2NC8BJiIHBhQfAQcGFBcWMjchNzY0LwEmIgcGFB8BBwYUFxYyNwJJ1Q0N1Q0jDA0Nt7cNDQwjDf7V1Q0N1QwkDA0Nt7cNDQwkDLfWDCMN1Q0NDCQMt7gMIw0MDNYMIw3VDQ0MJAy3uAwjDQwMAAADAFUAAAOrA1UAMwBoAHcAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMhMjY1NCYjISIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAAVYRGRkR/qoRGRkRA1UFBAUOCQkVDAsZDf2rDRkLDBUJCA4FBQUFBQUOCQgVDAsZDQJVDRkLDBUJCQ4FBAVVAgECBQMCBwQECAX9qwQJAwQHAwMFAQICAgIBBQMDBwQDCQQCVQUIBAQHAgMFAgEC/oAZEhEZGRESGQAAAAADAFUAAAOrA1UAMwBoAIkAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMzFRQWMzI2PQEzMjY1NCYrATU0JiMiBh0BIyIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAgBkSEhmAERkZEYAZEhIZgBEZGREDVQUEBQ4JCRUMCxkN/asNGQsMFQkIDgUFBQUFBQ4JCBUMCxkNAlUNGQsMFQkJDgUEBVUCAQIFAwIHBAQIBf2rBAkDBAcDAwUBAgICAgEFAwMHBAMJBAJVBQgEBAcCAwUCAQL+gIASGRkSgBkSERmAEhkZEoAZERIZAAABAOIAjQMeAskAIAAAExcHBhQXFjI/ARcWMjc2NC8BNzY0JyYiDwEnJiIHBhQX4uLiDQ0MJAzi4gwkDA0N4uINDQwkDOLiDCQMDQ0CjeLiDSMMDQ3h4Q0NDCMN4uIMIw0MDOLiDAwNIwwAAAABAAAAAQAAa5n0y18PPPUACwQAAAAAANivOVsAAAAA2K85WwAAAAADqwNVAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAOrAAEAAAAAAAAAAAAAAAAAAAALBAAAAAAAAAAAAAAAAgAAAAQAAWIEAAFiBAAA4gQAAOIEAABVBAAAVQQAAOIAAAAAAAoAFAAeAEQAagCqAOoBngJkApoAAQAAAAsAigADAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGZjaWNvbnMAZgBjAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGZjaWNvbnMAZgBjAGkAYwBvAG4Ac2ZjaWNvbnMAZgBjAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmZjaWNvbnMAZgBjAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("truetype")}.fc-icon{speak:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font-family:fcicons!important;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1;text-align:center;text-transform:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1em}.fc-icon-chevron-left:before{content:"\\e900"}.fc-icon-chevron-right:before{content:"\\e901"}.fc-icon-chevrons-left:before{content:"\\e902"}.fc-icon-chevrons-right:before{content:"\\e903"}.fc-icon-minus-square:before{content:"\\e904"}.fc-icon-plus-square:before{content:"\\e905"}.fc-icon-x:before{content:"\\e906"}.fc .fc-button{border-radius:0;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible;text-transform:none}.fc .fc-button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}.fc .fc-button{-webkit-appearance:button}.fc .fc-button:not(:disabled){cursor:pointer}.fc .fc-button{background-color:transparent;border:1px solid transparent;border-radius:.25em;display:inline-block;font-size:1em;font-weight:400;line-height:1.5;padding:.4em .65em;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}.fc .fc-button:hover{text-decoration:none}.fc .fc-button:focus{box-shadow:0 0 0 .2rem rgba(44,62,80,.25);outline:0}.fc .fc-button:disabled{opacity:.65}.fc .fc-button-primary{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:hover{background-color:var(--fc-button-hover-bg-color);border-color:var(--fc-button-hover-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:disabled{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button-primary:not(:disabled).fc-button-active,.fc .fc-button-primary:not(:disabled):active{background-color:var(--fc-button-active-bg-color);border-color:var(--fc-button-active-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:not(:disabled).fc-button-active:focus,.fc .fc-button-primary:not(:disabled):active:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button .fc-icon{font-size:1.5em;vertical-align:middle}.fc .fc-button-group{display:inline-flex;position:relative;vertical-align:middle}.fc .fc-button-group>.fc-button{flex:1 1 auto;position:relative}.fc .fc-button-group>.fc-button.fc-button-active,.fc .fc-button-group>.fc-button:active,.fc .fc-button-group>.fc-button:focus,.fc .fc-button-group>.fc-button:hover{z-index:1}.fc-direction-ltr .fc-button-group>.fc-button:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0;margin-left:-1px}.fc-direction-ltr .fc-button-group>.fc-button:not(:last-child){border-bottom-right-radius:0;border-top-right-radius:0}.fc-direction-rtl .fc-button-group>.fc-button:not(:first-child){border-bottom-right-radius:0;border-top-right-radius:0;margin-right:-1px}.fc-direction-rtl .fc-button-group>.fc-button:not(:last-child){border-bottom-left-radius:0;border-top-left-radius:0}.fc .fc-toolbar{align-items:center;display:flex;justify-content:space-between}.fc .fc-toolbar.fc-header-toolbar{margin-bottom:1.5em}.fc .fc-toolbar.fc-footer-toolbar{margin-top:1.5em}.fc .fc-toolbar-title{font-size:1.75em;margin:0}.fc-direction-ltr .fc-toolbar>*>:not(:first-child){margin-left:.75em}.fc-direction-rtl .fc-toolbar>*>:not(:first-child){margin-right:.75em}.fc-direction-rtl .fc-toolbar-ltr{flex-direction:row-reverse}.fc .fc-scroller{-webkit-overflow-scrolling:touch;position:relative}.fc .fc-scroller-liquid{height:100%}.fc .fc-scroller-liquid-absolute{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-scroller-harness{direction:ltr;overflow:hidden;position:relative}.fc .fc-scroller-harness-liquid{height:100%}.fc-direction-rtl .fc-scroller-harness>.fc-scroller{direction:rtl}.fc-theme-standard .fc-scrollgrid{border:1px solid var(--fc-border-color)}.fc .fc-scrollgrid,.fc .fc-scrollgrid table{table-layout:fixed;width:100%}.fc .fc-scrollgrid table{border-left-style:hidden;border-right-style:hidden;border-top-style:hidden}.fc .fc-scrollgrid{border-bottom-width:0;border-collapse:separate;border-right-width:0}.fc .fc-scrollgrid-liquid{height:100%}.fc .fc-scrollgrid-section,.fc .fc-scrollgrid-section table,.fc .fc-scrollgrid-section>td{height:1px}.fc .fc-scrollgrid-section-liquid>td{height:100%}.fc .fc-scrollgrid-section>*{border-left-width:0;border-top-width:0}.fc .fc-scrollgrid-section-footer>*,.fc .fc-scrollgrid-section-header>*{border-bottom-width:0}.fc .fc-scrollgrid-section-body table,.fc .fc-scrollgrid-section-footer table{border-bottom-style:hidden}.fc .fc-scrollgrid-section-sticky>*{background:var(--fc-page-bg-color);position:sticky;z-index:3}.fc .fc-scrollgrid-section-header.fc-scrollgrid-section-sticky>*{top:0}.fc .fc-scrollgrid-section-footer.fc-scrollgrid-section-sticky>*{bottom:0}.fc .fc-scrollgrid-sticky-shim{height:1px;margin-bottom:-1px}.fc-sticky{position:sticky}.fc .fc-view-harness{flex-grow:1;position:relative}.fc .fc-view-harness-active>.fc-view{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-col-header-cell-cushion{display:inline-block;padding:2px 4px}.fc .fc-bg-event,.fc .fc-highlight,.fc .fc-non-business{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-non-business{background:var(--fc-non-business-color)}.fc .fc-bg-event{background:var(--fc-bg-event-color);opacity:var(--fc-bg-event-opacity)}.fc .fc-bg-event .fc-event-title{font-size:var(--fc-small-font-size);font-style:italic;margin:.5em}.fc .fc-highlight{background:var(--fc-highlight-color)}.fc .fc-cell-shaded,.fc .fc-day-disabled{background:var(--fc-neutral-bg-color)}a.fc-event,a.fc-event:hover{text-decoration:none}.fc-event.fc-event-draggable,.fc-event[href]{cursor:pointer}.fc-event .fc-event-main{position:relative;z-index:2}.fc-event-dragging:not(.fc-event-selected){opacity:.75}.fc-event-dragging.fc-event-selected{box-shadow:0 2px 7px rgba(0,0,0,.3)}.fc-event .fc-event-resizer{display:none;position:absolute;z-index:4}.fc-event-selected .fc-event-resizer,.fc-event:hover .fc-event-resizer{display:block}.fc-event-selected .fc-event-resizer{background:var(--fc-page-bg-color);border-color:inherit;border-radius:calc(var(--fc-event-resizer-dot-total-width)/2);border-style:solid;border-width:var(--fc-event-resizer-dot-border-width);height:var(--fc-event-resizer-dot-total-width);width:var(--fc-event-resizer-dot-total-width)}.fc-event-selected .fc-event-resizer:before{bottom:-20px;content:"";left:-20px;position:absolute;right:-20px;top:-20px}.fc-event-selected,.fc-event:focus{box-shadow:0 2px 5px rgba(0,0,0,.2)}.fc-event-selected:before,.fc-event:focus:before{bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3}.fc-event-selected:after,.fc-event:focus:after{background:var(--fc-event-selected-overlay-color);bottom:-1px;content:"";left:-1px;position:absolute;right:-1px;top:-1px;z-index:1}.fc-h-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-h-event .fc-event-main{color:var(--fc-event-text-color)}.fc-h-event .fc-event-main-frame{display:flex}.fc-h-event .fc-event-time{max-width:100%;overflow:hidden}.fc-h-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-width:0}.fc-h-event .fc-event-title{display:inline-block;left:0;max-width:100%;overflow:hidden;right:0;vertical-align:top}.fc-h-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-start),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-end){border-bottom-left-radius:0;border-left-width:0;border-top-left-radius:0}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-end),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-start){border-bottom-right-radius:0;border-right-width:0;border-top-right-radius:0}.fc-h-event:not(.fc-event-selected) .fc-event-resizer{bottom:0;top:0;width:var(--fc-event-resizer-thickness)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end{cursor:w-resize;left:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start{cursor:e-resize;right:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-h-event.fc-event-selected .fc-event-resizer{margin-top:calc(var(--fc-event-resizer-dot-total-width)*-.5);top:50%}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-start,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-end{left:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-end,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-start{right:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc .fc-popover{box-shadow:0 2px 6px rgba(0,0,0,.15);position:absolute;z-index:9999}.fc .fc-popover-header{align-items:center;display:flex;flex-direction:row;justify-content:space-between;padding:3px 4px}.fc .fc-popover-title{margin:0 2px}.fc .fc-popover-close{cursor:pointer;font-size:1.1em;opacity:.65}.fc-theme-standard .fc-popover{background:var(--fc-page-bg-color);border:1px solid var(--fc-border-color)}.fc-theme-standard .fc-popover-header{background:var(--fc-neutral-bg-color)}';vr(XU);var sa=class{constructor(e){this.drainedOption=e,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}request(e){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),e==null?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),e))}pause(e=""){let{pauseDepths:t}=this;t[e]=(t[e]||0)+1,this.clearTimeout()}resume(e="",t){let{pauseDepths:n}=this;e in n&&(t?delete n[e]:(n[e]-=1,n[e]<=0&&delete n[e]),this.tryDrain())}isPaused(){return Object.keys(this.pauseDepths).length}tryDrain(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}}clear(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)}drained(){this.drainedOption&&this.drainedOption()}};function ff(i){i.parentNode&&i.parentNode.removeChild(i)}function Ge(i,e){if(i.closest)return i.closest(e);if(!document.documentElement.contains(i))return null;do{if(PA(i,e))return i;i=i.parentElement||i.parentNode}while(i!==null&&i.nodeType===1);return null}function PA(i,e){return(i.matches||i.matchesSelector||i.msMatchesSelector).call(i,e)}function rD(i,e){let t=i instanceof HTMLElement?[i]:i,n=[];for(let s=0;s<t.length;s+=1){let r=t[s].querySelectorAll(e);for(let o=0;o<r.length;o+=1)n.push(r[o])}return n}var ZU=/(top|left|right|bottom|width|height)$/i;function ga(i,e){for(let t in e)MA(i,t,e[t])}function MA(i,e,t){t==null?i.style[e]="":typeof t=="number"&&ZU.test(e)?i.style[e]=`${t}px`:i.style[e]=t}function Iv(i){var e,t;return(t=(e=i.composedPath)===null||e===void 0?void 0:e.call(i)[0])!==null&&t!==void 0?t:i.target}var VI=0;function En(){return VI+=1,"fc-dom-"+VI}function pf(i){i.preventDefault()}function jU(i,e){return t=>{let n=Ge(t.target,i);n&&e.call(n,t,n)}}function kA(i,e,t,n){let s=jU(t,n);return i.addEventListener(e,s),()=>{i.removeEventListener(e,s)}}function oD(i,e,t,n){let s;return kA(i,"mouseover",e,(r,o)=>{if(o!==s){s=o,t(r,o);let a=l=>{s=null,n(l,o),o.removeEventListener("mouseleave",a)};o.addEventListener("mouseleave",a)}})}var $I=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"];function NA(i,e){let t=n=>{e(n),$I.forEach(s=>{i.removeEventListener(s,t)})};$I.forEach(n=>{i.addEventListener(n,t)})}function aD(i){return Object.assign({onClick:i},lD(i))}function lD(i){return{tabIndex:0,onKeyDown(e){(e.key==="Enter"||e.key===" ")&&(i(e),e.preventDefault())}}}var zI=0;function ys(){return zI+=1,String(zI)}function gf(){document.body.classList.add("fc-not-allowed")}function mf(){document.body.classList.remove("fc-not-allowed")}function FA(i){i.style.userSelect="none",i.style.webkitUserSelect="none",i.addEventListener("selectstart",pf)}function LA(i){i.style.userSelect="",i.style.webkitUserSelect="",i.removeEventListener("selectstart",pf)}function OA(i){i.addEventListener("contextmenu",pf)}function UA(i){i.removeEventListener("contextmenu",pf)}function cD(i){let e=[],t=[],n,s;for(typeof i=="string"?t=i.split(/\s*,\s*/):typeof i=="function"?t=[i]:Array.isArray(i)&&(t=i),n=0;n<t.length;n+=1)s=t[n],typeof s=="string"?e.push(s.charAt(0)==="-"?{field:s.substring(1),order:-1}:{field:s,order:1}):typeof s=="function"&&e.push({func:s});return e}function dD(i,e,t){let n,s;for(n=0;n<t.length;n+=1)if(s=QU(i,e,t[n]),s)return s;return 0}function QU(i,e,t){return t.func?t.func(i,e):uD(i[t.field],e[t.field])*(t.order||1)}function uD(i,e){return!i&&!e?0:e==null?-1:i==null?1:typeof i=="string"||typeof e=="string"?String(i).localeCompare(String(e)):i-e}function ia(i,e){let t=String(i);return"000".substr(0,e-t.length)+t}function Rc(i,e,t){return typeof i=="function"?i(...e):typeof i=="string"?e.reduce((n,s,r)=>n.replace("$"+r,s||""),i):t}function HA(i,e){return i-e}function Xh(i){return i%1===0}function eH(i){let e=i.querySelector(".fc-scrollgrid-shrink-frame"),t=i.querySelector(".fc-scrollgrid-shrink-cushion");if(!e)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!t)throw new Error("needs fc-scrollgrid-shrink-cushion className");return i.getBoundingClientRect().width-e.getBoundingClientRect().width+t.getBoundingClientRect().width}var qI=["years","months","days","milliseconds"],tH=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function te(i,e){return typeof i=="string"?nH(i):typeof i=="object"&&i?WI(i):typeof i=="number"?WI({[e||"milliseconds"]:i}):null}function nH(i){let e=tH.exec(i);if(e){let t=e[1]?-1:1;return{years:0,months:0,days:t*(e[2]?parseInt(e[2],10):0),milliseconds:t*((e[3]?parseInt(e[3],10):0)*60*60*1e3+(e[4]?parseInt(e[4],10):0)*60*1e3+(e[5]?parseInt(e[5],10):0)*1e3+(e[6]?parseInt(e[6],10):0))}}return null}function WI(i){let e={years:i.years||i.year||0,months:i.months||i.month||0,days:i.days||i.day||0,milliseconds:(i.hours||i.hour||0)*60*60*1e3+(i.minutes||i.minute||0)*60*1e3+(i.seconds||i.second||0)*1e3+(i.milliseconds||i.millisecond||i.ms||0)},t=i.weeks||i.week;return t&&(e.days+=t*7,e.specifiedWeeks=!0),e}function iH(i,e){return i.years===e.years&&i.months===e.months&&i.days===e.days&&i.milliseconds===e.milliseconds}function yf(i,e){return{years:i.years+e.years,months:i.months+e.months,days:i.days+e.days,milliseconds:i.milliseconds+e.milliseconds}}function hD(i,e){return{years:i.years-e.years,months:i.months-e.months,days:i.days-e.days,milliseconds:i.milliseconds-e.milliseconds}}function BA(i,e){return{years:i.years*e,months:i.months*e,days:i.days*e,milliseconds:i.milliseconds*e}}function sH(i){return Cc(i)/365}function rH(i){return Cc(i)/30}function Cc(i){return nn(i)/864e5}function nn(i){return i.years*(365*864e5)+i.months*(30*864e5)+i.days*864e5+i.milliseconds}function vf(i,e){let t=null;for(let n=0;n<qI.length;n+=1){let s=qI[n];if(e[s]){let r=i[s]/e[s];if(!Xh(r)||t!==null&&t!==r)return null;t=r}else if(i[s])return null}return t}function Zh(i){let e=i.milliseconds;if(e){if(e%1e3!==0)return{unit:"millisecond",value:e};if(e%(1e3*60)!==0)return{unit:"second",value:e/1e3};if(e%(1e3*60*60)!==0)return{unit:"minute",value:e/(1e3*60)};if(e)return{unit:"hour",value:e/(1e3*60*60)}}return i.days?i.specifiedWeeks&&i.days%7===0?{unit:"week",value:i.days/7}:{unit:"day",value:i.days}:i.months?{unit:"month",value:i.months}:i.years?{unit:"year",value:i.years}:{unit:"millisecond",value:0}}function Ai(i,e,t){if(i===e)return!0;let n=i.length,s;if(n!==e.length)return!1;for(s=0;s<n;s+=1)if(!(t?t(i[s],e[s]):i[s]===e[s]))return!1;return!0}var oH=["sun","mon","tue","wed","thu","fri","sat"];function Dv(i,e){let t=hr(i);return t[2]+=e*7,Ft(t)}function Ee(i,e){let t=hr(i);return t[2]+=e,Ft(t)}function Ei(i,e){let t=hr(i);return t[6]+=e,Ft(t)}function GA(i,e){return Ci(i,e)/7}function Ci(i,e){return(e.valueOf()-i.valueOf())/(1e3*60*60*24)}function aH(i,e){return(e.valueOf()-i.valueOf())/(1e3*60*60)}function lH(i,e){return(e.valueOf()-i.valueOf())/(1e3*60)}function cH(i,e){return(e.valueOf()-i.valueOf())/1e3}function fD(i,e){let t=de(i),n=de(e);return{years:0,months:0,days:Math.round(Ci(t,n)),milliseconds:e.valueOf()-n.valueOf()-(i.valueOf()-t.valueOf())}}function pD(i,e){let t=_c(i,e);return t!==null&&t%7===0?t/7:null}function _c(i,e){return fr(i)===fr(e)?Math.round(Ci(i,e)):null}function de(i){return Ft([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()])}function dH(i){return Ft([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours()])}function uH(i){return Ft([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes()])}function hH(i){return Ft([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds()])}function fH(i,e,t){let n=i.getUTCFullYear(),s=hA(i,n,e,t);if(s<1)return hA(i,n-1,e,t);let r=hA(i,n+1,e,t);return r>=1?Math.min(s,r):s}function hA(i,e,t,n){let s=Ft([e,0,1+pH(e,t,n)]),r=de(i),o=Math.round(Ci(s,r));return Math.floor(o/7)+1}function pH(i,e,t){let n=7+e-t;return-((7+Ft([i,0,n]).getUTCDay()-e)%7)+n-1}function YI(i){return[i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()]}function KI(i){return new Date(i[0],i[1]||0,i[2]==null?1:i[2],i[3]||0,i[4]||0,i[5]||0)}function hr(i){return[i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds()]}function Ft(i){return i.length===1&&(i=i.concat([0])),new Date(Date.UTC(...i))}function VA(i){return!isNaN(i.valueOf())}function fr(i){return i.getUTCHours()*1e3*60*60+i.getUTCMinutes()*1e3*60+i.getUTCSeconds()*1e3+i.getUTCMilliseconds()}function Pv(i,e,t=!1){let n=i.toISOString();return n=n.replace(".000",""),t&&(n=n.replace("T00:00:00Z","")),n.length>10&&(e==null?n=n.replace("Z",""):e!==0&&(n=n.replace("Z",qA(e,!0)))),n}function br(i){return i.toISOString().replace(/T.*$/,"")}function $A(i){return i.toISOString().match(/^\d{4}-\d{2}/)[0]}function zA(i){return ia(i.getUTCHours(),2)+":"+ia(i.getUTCMinutes(),2)+":"+ia(i.getUTCSeconds(),2)}function qA(i,e=!1){let t=i<0?"-":"+",n=Math.abs(i),s=Math.floor(n/60),r=Math.round(n%60);return e?`${t+ia(s,2)}:${ia(r,2)}`:`GMT${t}${s}${r?`:${ia(r,2)}`:""}`}function $(i,e,t){let n,s;return function(...r){if(!n)s=i.apply(this,r);else if(!Ai(n,r)){t&&t(s);let o=i.apply(this,r);(!e||!e(o,s))&&(s=o)}return n=r,s}}function Ic(i,e,t){let n,s;return r=>{if(!n)s=i.call(this,r);else if(!Lt(n,r)){t&&t(s);let o=i.call(this,r);(!e||!e(o,s))&&(s=o)}return n=r,s}}var fA={week:3,separator:9,omitZeroMinute:9,meridiem:9,omitCommas:9},bv={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},hv=/\s*([ap])\.?m\.?/i,gH=/,/g,mH=/\s+/g,yH=/\u200e/g,vH=/UTC|GMT/,SA=class{constructor(e){let t={},n={},s=9;for(let r in e)r in fA?(n[r]=e[r],fA[r]<9&&(s=Math.min(fA[r],s))):(t[r]=e[r],r in bv&&(s=Math.min(bv[r],s)));this.standardDateProps=t,this.extendedSettings=n,this.smallestUnitNum=s,this.buildFormattingFunc=$(JI)}format(e,t){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,t)(e)}formatRange(e,t,n,s){let{standardDateProps:r,extendedSettings:o}=this,a=CH(e.marker,t.marker,n.calendarSystem);if(!a)return this.format(e,n);let l=a;l>1&&(r.year==="numeric"||r.year==="2-digit")&&(r.month==="numeric"||r.month==="2-digit")&&(r.day==="numeric"||r.day==="2-digit")&&(l=1);let c=this.format(e,n),d=this.format(t,n);if(c===d)return c;let h=_H(r,l),p=JI(h,o,n),m=p(e),y=p(t),v=TH(c,m,d,y),E=o.separator||s||n.defaultSeparator||"";return v?v.before+m+E+y+v.after:c+E+d}getSmallestUnit(){switch(this.smallestUnitNum){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}}};function JI(i,e,t){let n=Object.keys(i).length;return n===1&&i.timeZoneName==="short"?s=>qA(s.timeZoneOffset):n===0&&e.week?s=>AH(t.computeWeekNumber(s.marker),t.weekText,t.weekTextLong,t.locale,e.week):bH(i,e,t)}function bH(i,e,t){i=Object.assign({},i),e=Object.assign({},e),EH(i,e),i.timeZone="UTC";let n=new Intl.DateTimeFormat(t.locale.codes,i),s;if(e.omitZeroMinute){let r=Object.assign({},i);delete r.minute,s=new Intl.DateTimeFormat(t.locale.codes,r)}return r=>{let{marker:o}=r,a;s&&!o.getUTCMinutes()?a=s:a=n;let l=a.format(o);return wH(l,r,i,e,t)}}function EH(i,e){i.timeZoneName&&(i.hour||(i.hour="2-digit"),i.minute||(i.minute="2-digit")),i.timeZoneName==="long"&&(i.timeZoneName="short"),e.omitZeroMinute&&(i.second||i.millisecond)&&delete e.omitZeroMinute}function wH(i,e,t,n,s){return i=i.replace(yH,""),t.timeZoneName==="short"&&(i=SH(i,s.timeZone==="UTC"||e.timeZoneOffset==null?"UTC":qA(e.timeZoneOffset))),n.omitCommas&&(i=i.replace(gH,"").trim()),n.omitZeroMinute&&(i=i.replace(":00","")),n.meridiem===!1?i=i.replace(hv,"").trim():n.meridiem==="narrow"?i=i.replace(hv,(r,o)=>o.toLocaleLowerCase()):n.meridiem==="short"?i=i.replace(hv,(r,o)=>`${o.toLocaleLowerCase()}m`):n.meridiem==="lowercase"&&(i=i.replace(hv,r=>r.toLocaleLowerCase())),i=i.replace(mH," "),i=i.trim(),i}function SH(i,e){let t=!1;return i=i.replace(vH,()=>(t=!0,e)),t||(i+=` ${e}`),i}function AH(i,e,t,n,s){let r=[];return s==="long"?r.push(t):(s==="short"||s==="narrow")&&r.push(e),(s==="long"||s==="short")&&r.push(" "),r.push(n.simpleNumberFormat.format(i)),n.options.direction==="rtl"&&r.reverse(),r.join("")}function CH(i,e,t){return t.getMarkerYear(i)!==t.getMarkerYear(e)?5:t.getMarkerMonth(i)!==t.getMarkerMonth(e)?4:t.getMarkerDay(i)!==t.getMarkerDay(e)?2:fr(i)!==fr(e)?1:0}function _H(i,e){let t={};for(let n in i)(!(n in bv)||bv[n]<=e)&&(t[n]=i[n]);return t}function TH(i,e,t,n){let s=0;for(;s<i.length;){let r=i.indexOf(e,s);if(r===-1)break;let o=i.substr(0,r);s=r+e.length;let a=i.substr(s),l=0;for(;l<t.length;){let c=t.indexOf(n,l);if(c===-1)break;let d=t.substr(0,c);l=c+n.length;let h=t.substr(l);if(o===d&&a===h)return{before:o,after:a}}}return null}function XI(i,e){let t=e.markerToArray(i.marker);return{marker:i.marker,timeZoneOffset:i.timeZoneOffset,array:t,year:t[0],month:t[1],day:t[2],hour:t[3],minute:t[4],second:t[5],millisecond:t[6]}}function Ev(i,e,t,n){let s=XI(i,t.calendarSystem),r=e?XI(e,t.calendarSystem):null;return{date:s,start:s,end:r,timeZone:t.timeZone,localeCodes:t.locale.codes,defaultSeparator:n||t.defaultSeparator}}var AA=class{constructor(e){this.cmdStr=e}format(e,t,n){return t.cmdFormatter(this.cmdStr,Ev(e,null,t,n))}formatRange(e,t,n,s){return n.cmdFormatter(this.cmdStr,Ev(e,t,n,s))}},CA=class{constructor(e){this.func=e}format(e,t,n){return this.func(Ev(e,null,t,n))}formatRange(e,t,n,s){return this.func(Ev(e,t,n,s))}};function ue(i){return typeof i=="object"&&i?new SA(i):typeof i=="string"?new AA(i):typeof i=="function"?new CA(i):null}var WA={navLinkDayClick:P,navLinkWeekClick:P,duration:te,bootstrapFontAwesome:P,buttonIcons:P,customButtons:P,defaultAllDayEventDuration:te,defaultTimedEventDuration:te,nextDayThreshold:te,scrollTime:te,scrollTimeReset:Boolean,slotMinTime:te,slotMaxTime:te,dayPopoverFormat:ue,slotDuration:te,snapDuration:te,headerToolbar:P,footerToolbar:P,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:ue,dayHeaderClassNames:P,dayHeaderContent:P,dayHeaderDidMount:P,dayHeaderWillUnmount:P,dayCellClassNames:P,dayCellContent:P,dayCellDidMount:P,dayCellWillUnmount:P,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:P,weekNumbers:Boolean,weekNumberClassNames:P,weekNumberContent:P,weekNumberDidMount:P,weekNumberWillUnmount:P,editable:Boolean,viewClassNames:P,viewDidMount:P,viewWillUnmount:P,nowIndicator:Boolean,nowIndicatorSnap:P,nowIndicatorClassNames:P,nowIndicatorContent:P,nowIndicatorDidMount:P,nowIndicatorWillUnmount:P,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:P,locale:P,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:P,eventOrder:cD,eventOrderStrict:Boolean,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:P,contentHeight:P,direction:String,weekNumberFormat:ue,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,weekTextLong:String,progressiveEventRendering:Boolean,businessHours:P,initialDate:P,now:P,eventDataTransform:P,stickyHeaderDates:P,stickyFooterScrollbar:P,viewHeight:P,defaultAllDay:Boolean,eventSourceFailure:P,eventSourceSuccess:P,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:P,eventConstraint:P,eventAllow:P,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:P,eventContent:P,eventDidMount:P,eventWillUnmount:P,selectConstraint:P,selectOverlap:P,selectAllow:P,droppable:Boolean,unselectCancel:String,slotLabelFormat:P,slotLaneClassNames:P,slotLaneContent:P,slotLaneDidMount:P,slotLaneWillUnmount:P,slotLabelClassNames:P,slotLabelContent:P,slotLabelDidMount:P,slotLabelWillUnmount:P,dayMaxEvents:P,dayMaxEventRows:P,dayMinWidth:Number,slotLabelInterval:te,allDayText:String,allDayClassNames:P,allDayContent:P,allDayDidMount:P,allDayWillUnmount:P,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:ue,rerenderDelay:Number,moreLinkText:P,moreLinkHint:P,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMaxStack:Number,eventMinHeight:Number,eventMinWidth:Number,eventShortHeight:Number,slotEventOverlap:Boolean,plugins:P,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:te,hiddenDays:P,fixedWeekCount:Boolean,validRange:P,visibleRange:P,titleFormat:P,eventInteractive:Boolean,noEventsText:String,viewHint:P,navLinkHint:P,closeHint:String,timeHint:String,eventHint:String,moreLinkClick:P,moreLinkClassNames:P,moreLinkContent:P,moreLinkDidMount:P,moreLinkWillUnmount:P,monthStartFormat:ue,handleCustomRendering:P,customRenderingMetaMap:P,customRenderingReplaces:Boolean},Er={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:" \u2013 ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",scrollTimeReset:!0,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1,eventMinHeight:15,eventMinWidth:30,eventShortHeight:30,monthStartFormat:{month:"long",day:"numeric"},nowIndicatorSnap:"auto"},YA={datesSet:P,eventsSet:P,eventAdd:P,eventChange:P,eventRemove:P,windowResize:P,eventClick:P,eventMouseEnter:P,eventMouseLeave:P,select:P,unselect:P,loading:P,_unmount:P,_beforeprint:P,_afterprint:P,_noEventDrop:P,_noEventResize:P,_resize:P,_scrollRequest:P},KA={buttonText:P,buttonHints:P,views:P,plugins:P,initialEvents:P,events:P,eventSources:P},wr={headerToolbar:na,footerToolbar:na,buttonText:na,buttonHints:na,buttonIcons:na,dateIncrement:na,plugins:fv,events:fv,eventSources:fv,resources:fv};function na(i,e){return typeof i=="object"&&typeof e=="object"&&i&&e?Lt(i,e):i===e}function fv(i,e){return Array.isArray(i)&&Array.isArray(e)?Ai(i,e):i===e}var gD={type:String,component:P,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:P,usesMinMaxTime:Boolean,classNames:P,content:P,didMount:P,willUnmount:P};function Mv(i){return Nv(i,wr)}function kv(i,e){let t={},n={};for(let s in e)s in i&&(t[s]=e[s](i[s]));for(let s in i)s in e||(n[s]=i[s]);return{refined:t,extra:n}}function P(i){return i}var{hasOwnProperty:wv}=Object.prototype;function Nv(i,e){let t={};if(e){for(let n in e)if(e[n]===na){let s=[];for(let r=i.length-1;r>=0;r-=1){let o=i[r][n];if(typeof o=="object"&&o)s.unshift(o);else if(o!==void 0){t[n]=o;break}}s.length&&(t[n]=Nv(s))}}for(let n=i.length-1;n>=0;n-=1){let s=i[n];for(let r in s)r in t||(t[r]=s[r])}return t}function fs(i,e){let t={};for(let n in i)e(i[n],n)&&(t[n]=i[n]);return t}function bn(i,e){let t={};for(let n in i)t[n]=e(i[n],n);return t}function JA(i){let e={};for(let t of i)e[t]=!0;return e}function Fv(i){let e=[];for(let t in i)e.push(i[t]);return e}function Lt(i,e){if(i===e)return!0;for(let t in i)if(wv.call(i,t)&&!(t in e))return!1;for(let t in e)if(wv.call(e,t)&&i[t]!==e[t])return!1;return!0}var xH=/^on[A-Z]/;function RH(i,e){let t=IH(i,e);for(let n of t)if(!xH.test(n))return!1;return!0}function IH(i,e){let t=[];for(let n in i)wv.call(i,n)&&(n in e||t.push(n));for(let n in e)wv.call(e,n)&&i[n]!==e[n]&&t.push(n);return t}function yv(i,e,t={}){if(i===e)return!0;for(let n in e)if(!(n in i&&DH(i[n],e[n],t[n])))return!1;for(let n in i)if(!(n in e))return!1;return!0}function DH(i,e,t){return i===e||t===!0?!0:t?t(i,e):!1}function mD(i,e=0,t,n=1){let s=[];t==null&&(t=Object.keys(i).length);for(let r=e;r<t;r+=n){let o=i[r];o!==void 0&&s.push(o)}return s}var yD={};function PH(i,e){yD[i]=e}function MH(i){return new yD[i]}var _A=class{getMarkerYear(e){return e.getUTCFullYear()}getMarkerMonth(e){return e.getUTCMonth()}getMarkerDay(e){return e.getUTCDate()}arrayToMarker(e){return Ft(e)}markerToArray(e){return hr(e)}};PH("gregory",_A);var kH=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;function vD(i){let e=kH.exec(i);if(e){let t=new Date(Date.UTC(Number(e[1]),e[3]?Number(e[3])-1:0,Number(e[5]||1),Number(e[7]||0),Number(e[8]||0),Number(e[10]||0),e[12]?+`0.${e[12]}`*1e3:0));if(VA(t)){let n=null;return e[13]&&(n=(e[15]==="-"?-1:1)*(Number(e[16]||0)*60+Number(e[18]||0))),{marker:t,isTimeUnspecified:!e[6],timeZoneOffset:n}}}return null}var jh=class{constructor(e){let t=this.timeZone=e.timeZone,n=t!=="local"&&t!=="UTC";e.namedTimeZoneImpl&&n&&(this.namedTimeZoneImpl=new e.namedTimeZoneImpl(t)),this.canComputeOffset=!!(!n||this.namedTimeZoneImpl),this.calendarSystem=MH(e.calendarSystem),this.locale=e.locale,this.weekDow=e.locale.week.dow,this.weekDoy=e.locale.week.doy,e.weekNumberCalculation==="ISO"&&(this.weekDow=1,this.weekDoy=4),typeof e.firstDay=="number"&&(this.weekDow=e.firstDay),typeof e.weekNumberCalculation=="function"&&(this.weekNumberFunc=e.weekNumberCalculation),this.weekText=e.weekText!=null?e.weekText:e.locale.options.weekText,this.weekTextLong=(e.weekTextLong!=null?e.weekTextLong:e.locale.options.weekTextLong)||this.weekText,this.cmdFormatter=e.cmdFormatter,this.defaultSeparator=e.defaultSeparator}createMarker(e){let t=this.createMarkerMeta(e);return t===null?null:t.marker}createNowMarker(){return this.canComputeOffset?this.timestampToMarker(new Date().valueOf()):Ft(YI(new Date))}createMarkerMeta(e){if(typeof e=="string")return this.parse(e);let t=null;return typeof e=="number"?t=this.timestampToMarker(e):e instanceof Date?(e=e.valueOf(),isNaN(e)||(t=this.timestampToMarker(e))):Array.isArray(e)&&(t=Ft(e)),t===null||!VA(t)?null:{marker:t,isTimeUnspecified:!1,forcedTzo:null}}parse(e){let t=vD(e);if(t===null)return null;let{marker:n}=t,s=null;return t.timeZoneOffset!==null&&(this.canComputeOffset?n=this.timestampToMarker(n.valueOf()-t.timeZoneOffset*60*1e3):s=t.timeZoneOffset),{marker:n,isTimeUnspecified:t.isTimeUnspecified,forcedTzo:s}}getYear(e){return this.calendarSystem.getMarkerYear(e)}getMonth(e){return this.calendarSystem.getMarkerMonth(e)}getDay(e){return this.calendarSystem.getMarkerDay(e)}add(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]+=t.years,n[1]+=t.months,n[2]+=t.days,n[6]+=t.milliseconds,this.calendarSystem.arrayToMarker(n)}subtract(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]-=t.years,n[1]-=t.months,n[2]-=t.days,n[6]-=t.milliseconds,this.calendarSystem.arrayToMarker(n)}addYears(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]+=t,this.calendarSystem.arrayToMarker(n)}addMonths(e,t){let n=this.calendarSystem.markerToArray(e);return n[1]+=t,this.calendarSystem.arrayToMarker(n)}diffWholeYears(e,t){let{calendarSystem:n}=this;return fr(e)===fr(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)&&n.getMarkerMonth(e)===n.getMarkerMonth(t)?n.getMarkerYear(t)-n.getMarkerYear(e):null}diffWholeMonths(e,t){let{calendarSystem:n}=this;return fr(e)===fr(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)?n.getMarkerMonth(t)-n.getMarkerMonth(e)+(n.getMarkerYear(t)-n.getMarkerYear(e))*12:null}greatestWholeUnit(e,t){let n=this.diffWholeYears(e,t);return n!==null?{unit:"year",value:n}:(n=this.diffWholeMonths(e,t),n!==null?{unit:"month",value:n}:(n=pD(e,t),n!==null?{unit:"week",value:n}:(n=_c(e,t),n!==null?{unit:"day",value:n}:(n=aH(e,t),Xh(n)?{unit:"hour",value:n}:(n=lH(e,t),Xh(n)?{unit:"minute",value:n}:(n=cH(e,t),Xh(n)?{unit:"second",value:n}:{unit:"millisecond",value:t.valueOf()-e.valueOf()}))))))}countDurationsBetween(e,t,n){let s;return n.years&&(s=this.diffWholeYears(e,t),s!==null)?s/sH(n):n.months&&(s=this.diffWholeMonths(e,t),s!==null)?s/rH(n):n.days&&(s=_c(e,t),s!==null)?s/Cc(n):(t.valueOf()-e.valueOf())/nn(n)}startOf(e,t){return t==="year"?this.startOfYear(e):t==="month"?this.startOfMonth(e):t==="week"?this.startOfWeek(e):t==="day"?de(e):t==="hour"?dH(e):t==="minute"?uH(e):t==="second"?hH(e):null}startOfYear(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e)])}startOfMonth(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e)])}startOfWeek(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e),e.getUTCDate()-(e.getUTCDay()-this.weekDow+7)%7])}computeWeekNumber(e){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(e)):fH(e,this.weekDow,this.weekDoy)}format(e,t,n={}){return t.format({marker:e,timeZoneOffset:n.forcedTzo!=null?n.forcedTzo:this.offsetForMarker(e)},this)}formatRange(e,t,n,s={}){return s.isEndExclusive&&(t=Ei(t,-1)),n.formatRange({marker:e,timeZoneOffset:s.forcedStartTzo!=null?s.forcedStartTzo:this.offsetForMarker(e)},{marker:t,timeZoneOffset:s.forcedEndTzo!=null?s.forcedEndTzo:this.offsetForMarker(t)},this,s.defaultSeparator)}formatIso(e,t={}){let n=null;return t.omitTimeZoneOffset||(t.forcedTzo!=null?n=t.forcedTzo:n=this.offsetForMarker(e)),Pv(e,n,t.omitTime)}timestampToMarker(e){return this.timeZone==="local"?Ft(YI(new Date(e))):this.timeZone==="UTC"||!this.namedTimeZoneImpl?new Date(e):Ft(this.namedTimeZoneImpl.timestampToArray(e))}offsetForMarker(e){return this.timeZone==="local"?-KI(hr(e)).getTimezoneOffset():this.timeZone==="UTC"?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(hr(e)):null}toDate(e,t){return this.timeZone==="local"?KI(hr(e)):this.timeZone==="UTC"?new Date(e.valueOf()):this.namedTimeZoneImpl?new Date(e.valueOf()-this.namedTimeZoneImpl.offsetForArray(hr(e))*1e3*60):new Date(e.valueOf()-(t||0))}},ps=class{constructor(e){this.iconOverrideOption&&this.setIconOverride(e[this.iconOverrideOption])}setIconOverride(e){let t,n;if(typeof e=="object"&&e){t=Object.assign({},this.iconClasses);for(n in e)t[n]=this.applyIconOverridePrefix(e[n]);this.iconClasses=t}else e===!1&&(this.iconClasses={})}applyIconOverridePrefix(e){let t=this.iconOverridePrefix;return t&&e.indexOf(t)!==0&&(e=t+e),e}getClass(e){return this.classes[e]||""}getIconClass(e,t){let n;return t&&this.rtlIconClasses?n=this.rtlIconClasses[e]||this.iconClasses[e]:n=this.iconClasses[e],n?`${this.baseIconClass} ${n}`:""}getCustomButtonIconClass(e){let t;return this.iconOverrideCustomButtonOption&&(t=e[this.iconOverrideCustomButtonOption],t)?`${this.baseIconClass} ${this.applyIconOverridePrefix(t)}`:""}};ps.prototype.classes={};ps.prototype.iconClasses={};ps.prototype.baseIconClass="";ps.prototype.iconOverridePrefix="";function Qh(i){i();let e=q.debounceRendering,t=[];function n(s){t.push(s)}for(q.debounceRendering=n,dr(x(TA,{}),document.createElement("div"));t.length;)t.shift()();q.debounceRendering=e}var TA=class extends st{render(){return x("div",{})}componentDidMount(){this.setState({})}};function bD(i){let e=cv(i),t=e.Provider;return e.Provider=function(){let n=!this.getChildContext,s=t.apply(this,arguments);if(n){let r=[];this.shouldComponentUpdate=o=>{this.props.value!==o.value&&r.forEach(a=>{a.context=o.value,a.forceUpdate()})},this.sub=o=>{r.push(o);let a=o.componentWillUnmount;o.componentWillUnmount=()=>{r.splice(r.indexOf(o),1),a&&a.call(o)}}}return s},e}var Sv=class{constructor(e,t,n,s){this.execFunc=e,this.emitter=t,this.scrollTime=n,this.scrollTimeReset=s,this.handleScrollRequest=r=>{this.queuedRequest=Object.assign({},this.queuedRequest||{},r),this.drain()},t.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}detach(){this.emitter.off("_scrollRequest",this.handleScrollRequest)}update(e){e&&this.scrollTimeReset?this.fireInitialScroll():this.drain()}fireInitialScroll(){this.handleScrollRequest({time:this.scrollTime})}drain(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)}},wn=bD({});function ED(i,e,t,n,s,r,o,a,l,c,d,h,p,m){return{dateEnv:s,nowManager:r,options:t,pluginHooks:a,emitter:d,dispatch:l,getCurrentData:c,calendarApi:h,viewSpec:i,viewApi:e,dateProfileGenerator:n,theme:o,isRtl:t.direction==="rtl",addResizeHandler(y){d.on("_resize",y)},removeResizeHandler(y){d.off("_resize",y)},createScrollResponder(y){return new Sv(y,d,te(t.scrollTime),t.scrollTimeReset)},registerInteractiveComponent:p,unregisterInteractiveComponent:m}}var wi=class extends st{shouldComponentUpdate(e,t){return!yv(this.props,e,this.propEquality)||!yv(this.state,t,this.stateEquality)}safeSetState(e){yv(this.state,Object.assign(Object.assign({},this.state),e),this.stateEquality)||this.setState(e)}};wi.addPropsEquality=NH;wi.addStateEquality=FH;wi.contextType=wn;wi.prototype.propEquality={};wi.prototype.stateEquality={};var ne=class extends wi{};ne.contextType=wn;function NH(i){let e=Object.create(this.prototype.propEquality);Object.assign(e,i),this.prototype.propEquality=e}function FH(i){let e=Object.create(this.prototype.stateEquality);Object.assign(e,i),this.prototype.stateEquality=e}function rn(i,e){typeof i=="function"?i(e):i&&(i.current=e)}var ef=class extends ne{constructor(){super(...arguments),this.id=ys(),this.queuedDomNodes=[],this.currentDomNodes=[],this.handleEl=e=>{let{options:t}=this.context,{generatorName:n}=this.props;(!t.customRenderingReplaces||!xA(n,t))&&this.updateElRef(e)},this.updateElRef=e=>{this.props.elRef&&rn(this.props.elRef,e)}}render(){let{props:e,context:t}=this,{options:n}=t,{customGenerator:s,defaultGenerator:r,renderProps:o}=e,a=XA(e,[],this.handleEl),l=!1,c,d=[],h;if(s!=null){let p=typeof s=="function"?s(o,x):s;if(p===!0)l=!0;else{let m=p&&typeof p=="object";m&&"html"in p?a.dangerouslySetInnerHTML={__html:p.html}:m&&"domNodes"in p?d=Array.prototype.slice.call(p.domNodes):(m?rA(p):typeof p!="function")?c=p:h=p}}else l=!xA(e.generatorName,n);return l&&r&&(c=r(o)),this.queuedDomNodes=d,this.currentGeneratorMeta=h,x(e.elTag,a,c)}componentDidMount(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentDidUpdate(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentWillUnmount(){this.triggerCustomRendering(!1)}triggerCustomRendering(e){var t;let{props:n,context:s}=this,{handleCustomRendering:r,customRenderingMetaMap:o}=s.options;if(r){let a=(t=this.currentGeneratorMeta)!==null&&t!==void 0?t:o==null?void 0:o[n.generatorName];a&&r(Object.assign(Object.assign({id:this.id,isActive:e,containerEl:this.base,reportNewContainerEl:this.updateElRef,generatorMeta:a},n),{elClasses:(n.elClasses||[]).filter(LH)}))}}applyQueueudDomNodes(){let{queuedDomNodes:e,currentDomNodes:t}=this,n=this.base;if(!Ai(e,t)){t.forEach(ff);for(let s of e)n.appendChild(s);this.currentDomNodes=e}}};ef.addPropsEquality({elClasses:Ai,elStyle:Lt,elAttrs:RH,renderProps:Lt});function xA(i,e){var t;return!!(e.handleCustomRendering&&i&&(!((t=e.customRenderingMetaMap)===null||t===void 0)&&t[i]))}function XA(i,e,t){let n=Object.assign(Object.assign({},i.elAttrs),{ref:t});return(i.elClasses||e)&&(n.className=(i.elClasses||[]).concat(e||[]).concat(n.className||[]).filter(Boolean).join(" ")),i.elStyle&&(n.style=i.elStyle),n}function LH(i){return!!i}var ZA=bD(0),xe=class extends st{constructor(){super(...arguments),this.InnerContent=OH.bind(void 0,this),this.handleEl=e=>{this.el=e,this.props.elRef&&(rn(this.props.elRef,e),e&&this.didMountMisfire&&this.componentDidMount())}}render(){let{props:e}=this,t=UH(e.classNameGenerator,e.renderProps);if(e.children){let n=XA(e,t,this.handleEl),s=e.children(this.InnerContent,e.renderProps,n);return e.elTag?x(e.elTag,n,s):s}else return x(ef,Object.assign(Object.assign({},e),{elRef:this.handleEl,elTag:e.elTag||"div",elClasses:(e.elClasses||[]).concat(t),renderId:this.context}))}componentDidMount(){var e,t;this.el?(t=(e=this.props).didMount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el})):this.didMountMisfire=!0}componentWillUnmount(){var e,t;(t=(e=this.props).willUnmount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el}))}};xe.contextType=ZA;function OH(i,e){let t=i.props;return x(ef,Object.assign({renderProps:t.renderProps,generatorName:t.generatorName,customGenerator:t.customGenerator,defaultGenerator:t.defaultGenerator,renderId:i.context},e))}function UH(i,e){let t=typeof i=="function"?i(e):i||[];return typeof t=="string"?[t]:t}var qn=class extends ne{render(){let{props:e,context:t}=this,{options:n}=t,s={view:t.viewApi};return x(xe,{elRef:e.elRef,elTag:e.elTag||"div",elAttrs:e.elAttrs,elClasses:[...jA(e.viewSpec),...e.elClasses||[]],elStyle:e.elStyle,renderProps:s,classNameGenerator:n.viewClassNames,generatorName:void 0,didMount:n.viewDidMount,willUnmount:n.viewWillUnmount},()=>e.children)}};function jA(i){return[`fc-${i.type}-view`,"fc-view"]}function HH(i,e){let t=null,n=null;return i.start&&(t=e.createMarker(i.start)),i.end&&(n=e.createMarker(i.end)),!t&&!n||t&&n&&n<t?null:{start:t,end:n}}function ZI(i,e){let t=[],{start:n}=e,s,r;for(i.sort(BH),s=0;s<i.length;s+=1)r=i[s],r.start>n&&t.push({start:n,end:r.start}),r.end>n&&(n=r.end);return n<e.end&&t.push({start:n,end:e.end}),t}function BH(i,e){return i.start.valueOf()-e.start.valueOf()}function sn(i,e){let{start:t,end:n}=i,s=null;return e.start!==null&&(t===null?t=e.start:t=new Date(Math.max(t.valueOf(),e.start.valueOf()))),e.end!=null&&(n===null?n=e.end:n=new Date(Math.min(n.valueOf(),e.end.valueOf()))),(t===null||n===null||t<n)&&(s={start:t,end:n}),s}function wD(i,e){return(i.start===null?null:i.start.valueOf())===(e.start===null?null:e.start.valueOf())&&(i.end===null?null:i.end.valueOf())===(e.end===null?null:e.end.valueOf())}function Lv(i,e){return(i.end===null||e.start===null||i.end>e.start)&&(i.start===null||e.end===null||i.start<e.end)}function Dc(i,e){return(i.start===null||e.start!==null&&e.start>=i.start)&&(i.end===null||e.end!==null&&e.end<=i.end)}function vn(i,e){return(i.start===null||e>=i.start)&&(i.end===null||e<i.end)}function GH(i,e){return e.start!=null&&i<e.start?e.start:e.end!=null&&i>=e.end?new Date(e.end.valueOf()-1):i}function SD(i){let e=Math.floor(Ci(i.start,i.end))||1,t=de(i.start),n=Ee(t,e);return{start:t,end:n}}function Ov(i,e=te(0)){let t=null,n=null;if(i.end){n=de(i.end);let s=i.end.valueOf()-n.valueOf();s&&s>=nn(e)&&(n=Ee(n,1))}return i.start&&(t=de(i.start),n&&n<=t&&(n=Ee(t,1))),{start:t,end:n}}function QA(i){let e=Ov(i);return Ci(e.start,e.end)>1}function pr(i,e,t,n){return n==="year"?te(t.diffWholeYears(i,e),"year"):n==="month"?te(t.diffWholeMonths(i,e),"month"):fD(i,e)}var ra=class{constructor(e){this.props=e,this.initHiddenDays()}buildPrev(e,t,n){let{dateEnv:s}=this.props,r=s.subtract(s.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(r,-1,n)}buildNext(e,t,n){let{dateEnv:s}=this.props,r=s.add(s.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(r,1,n)}build(e,t,n=!0){let{props:s}=this,r,o,a,l,c,d;return r=this.buildValidRange(),r=this.trimHiddenDays(r),n&&(e=GH(e,r)),o=this.buildCurrentRangeInfo(e,t),a=/^(year|month|week|day)$/.test(o.unit),l=this.buildRenderRange(this.trimHiddenDays(o.range),o.unit,a),l=this.trimHiddenDays(l),c=l,s.showNonCurrentDates||(c=sn(c,o.range)),c=this.adjustActiveRange(c),c=sn(c,r),d=Lv(o.range,r),vn(l,e)||(e=l.start),{currentDate:e,validRange:r,currentRange:o.range,currentRangeUnit:o.unit,isRangeAllDay:a,activeRange:c,renderRange:l,slotMinTime:s.slotMinTime,slotMaxTime:s.slotMaxTime,isValid:d,dateIncrement:this.buildDateIncrement(o.duration)}}buildValidRange(){let e=this.props.validRangeInput,t=typeof e=="function"?e.call(this.props.calendarApi,this.props.dateEnv.toDate(this.props.nowManager.getDateMarker())):e;return this.refineRange(t)||{start:null,end:null}}buildCurrentRangeInfo(e,t){let{props:n}=this,s=null,r=null,o=null,a;return n.duration?(s=n.duration,r=n.durationUnit,o=this.buildRangeFromDuration(e,t,s,r)):(a=this.props.dayCount)?(r="day",o=this.buildRangeFromDayCount(e,t,a)):(o=this.buildCustomVisibleRange(e))?r=n.dateEnv.greatestWholeUnit(o.start,o.end).unit:(s=this.getFallbackDuration(),r=Zh(s).unit,o=this.buildRangeFromDuration(e,t,s,r)),{duration:s,unit:r,range:o}}getFallbackDuration(){return te({day:1})}adjustActiveRange(e){let{dateEnv:t,usesMinMaxTime:n,slotMinTime:s,slotMaxTime:r}=this.props,{start:o,end:a}=e;return n&&(Cc(s)<0&&(o=de(o),o=t.add(o,s)),Cc(r)>1&&(a=de(a),a=Ee(a,-1),a=t.add(a,r))),{start:o,end:a}}buildRangeFromDuration(e,t,n,s){let{dateEnv:r,dateAlignment:o}=this.props,a,l,c;if(!o){let{dateIncrement:h}=this.props;h&&nn(h)<nn(n)?o=Zh(h).unit:o=s}Cc(n)<=1&&this.isHiddenDay(a)&&(a=this.skipHiddenDays(a,t),a=de(a));function d(){a=r.startOf(e,o),l=r.add(a,n),c={start:a,end:l}}return d(),this.trimHiddenDays(c)||(e=this.skipHiddenDays(e,t),d()),c}buildRangeFromDayCount(e,t,n){let{dateEnv:s,dateAlignment:r}=this.props,o=0,a=e,l;r&&(a=s.startOf(a,r)),a=de(a),a=this.skipHiddenDays(a,t),l=a;do l=Ee(l,1),this.isHiddenDay(l)||(o+=1);while(o<n);return{start:a,end:l}}buildCustomVisibleRange(e){let{props:t}=this,n=t.visibleRangeInput,s=typeof n=="function"?n.call(t.calendarApi,t.dateEnv.toDate(e)):n,r=this.refineRange(s);return r&&(r.start==null||r.end==null)?null:r}buildRenderRange(e,t,n){return e}buildDateIncrement(e){let{dateIncrement:t}=this.props,n;return t||((n=this.props.dateAlignment)?te(1,n):e||te({days:1}))}refineRange(e){if(e){let t=HH(e,this.props.dateEnv);return t&&(t=Ov(t)),t}return null}initHiddenDays(){let e=this.props.hiddenDays||[],t=[],n=0,s;for(this.props.weekends===!1&&e.push(0,6),s=0;s<7;s+=1)(t[s]=e.indexOf(s)!==-1)||(n+=1);if(!n)throw new Error("invalid hiddenDays");this.isHiddenDayHash=t}trimHiddenDays(e){let{start:t,end:n}=e;return t&&(t=this.skipHiddenDays(t)),n&&(n=this.skipHiddenDays(n,-1,!0)),t==null||n==null||t<n?{start:t,end:n}:null}isHiddenDay(e){return e instanceof Date&&(e=e.getUTCDay()),this.isHiddenDayHash[e]}skipHiddenDays(e,t=1,n=!1){for(;this.isHiddenDayHash[(e.getUTCDay()+(n?t:0)+7)%7];)e=Ee(e,t);return e}};function bf(i,e,t,n){return{instanceId:ys(),defId:i,range:e,forcedStartTzo:t==null?null:t,forcedEndTzo:n==null?null:n}}function VH(i,e,t,n){for(let s=0;s<n.length;s+=1){let r=n[s].parse(i,t);if(r){let{allDay:o}=i;return o==null&&(o=e,o==null&&(o=r.allDayGuess,o==null&&(o=!1))),{allDay:o,duration:r.duration,typeData:r.typeData,typeId:s}}}return null}function oa(i,e,t){let{dateEnv:n,pluginHooks:s,options:r}=t,{defs:o,instances:a}=i;a=fs(a,l=>!o[l.defId].recurringDef);for(let l in o){let c=o[l];if(c.recurringDef){let{duration:d}=c.recurringDef;d||(d=c.allDay?r.defaultAllDayEventDuration:r.defaultTimedEventDuration);let h=$H(c,d,e,n,s.recurringTypes);for(let p of h){let m=bf(l,{start:p,end:n.add(p,d)});a[m.instanceId]=m}}}return{defs:o,instances:a}}function $H(i,e,t,n,s){let o=s[i.recurringDef.typeId].expand(i.recurringDef.typeData,{start:n.subtract(t.start,e),end:t.end},n);return i.allDay&&(o=o.map(de)),o}var vv={id:String,groupId:String,title:String,url:String,interactive:Boolean},AD={start:P,end:P,date:P,allDay:Boolean},zH=Object.assign(Object.assign(Object.assign({},vv),AD),{extendedProps:P});function CD(i,e,t,n,s=eC(t),r,o){let{refined:a,extra:l}=Uv(i,t,s),c=WH(e,t),d=VH(a,c,t.dateEnv,t.pluginHooks.recurringTypes);if(d){let p=tf(a,l,e?e.sourceId:"",d.allDay,!!d.duration,t,r);return p.recurringDef={typeId:d.typeId,typeData:d.typeData,duration:d.duration},{def:p,instance:null}}let h=qH(a,c,t,n);if(h){let p=tf(a,l,e?e.sourceId:"",h.allDay,h.hasEnd,t,r),m=bf(p.defId,h.range,h.forcedStartTzo,h.forcedEndTzo);return o&&p.publicId&&o[p.publicId]&&(m.instanceId=o[p.publicId]),{def:p,instance:m}}return null}function Uv(i,e,t=eC(e)){return kv(i,t)}function eC(i){return Object.assign(Object.assign(Object.assign({},Av),zH),i.pluginHooks.eventRefiners)}function tf(i,e,t,n,s,r,o){let a={title:i.title||"",groupId:i.groupId||"",publicId:i.id||"",url:i.url||"",recurringDef:null,defId:(o&&i.id?o[i.id]:"")||ys(),sourceId:t,allDay:n,hasEnd:s,interactive:i.interactive,ui:Pc(i,r),extendedProps:Object.assign(Object.assign({},i.extendedProps||{}),e)};for(let l of r.pluginHooks.eventDefMemberAdders)Object.assign(a,l(i));return Object.freeze(a.ui.classNames),Object.freeze(a.extendedProps),a}function qH(i,e,t,n){let{allDay:s}=i,r,o=null,a=!1,l,c=null,d=i.start!=null?i.start:i.date;if(r=t.dateEnv.createMarkerMeta(d),r)o=r.marker;else if(!n)return null;return i.end!=null&&(l=t.dateEnv.createMarkerMeta(i.end)),s==null&&(e!=null?s=e:s=(!r||r.isTimeUnspecified)&&(!l||l.isTimeUnspecified)),s&&o&&(o=de(o)),l&&(c=l.marker,s&&(c=de(c)),o&&c<=o&&(c=null)),c?a=!0:n||(a=t.options.forceEventDuration||!1,c=t.dateEnv.add(o,s?t.options.defaultAllDayEventDuration:t.options.defaultTimedEventDuration)),{allDay:s,hasEnd:a,range:{start:o,end:c},forcedStartTzo:r?r.forcedTzo:null,forcedEndTzo:l?l.forcedTzo:null}}function WH(i,e){let t=null;return i&&(t=i.defaultAllDay),t==null&&(t=e.options.defaultAllDay),t}function nf(i,e,t,n,s,r){let o=yt(),a=eC(t);for(let l of i){let c=CD(l,e,t,n,a,s,r);c&&sf(c,o)}return o}function sf(i,e=yt()){return e.defs[i.def.defId]=i.def,i.instance&&(e.instances[i.instance.instanceId]=i.instance),e}function Ef(i,e){let t=i.instances[e];if(t){let n=i.defs[t.defId],s=Bv(i,r=>YH(n,r));return s.defs[n.defId]=n,s.instances[t.instanceId]=t,s}return yt()}function YH(i,e){return!!(i.groupId&&i.groupId===e.groupId)}function yt(){return{defs:{},instances:{}}}function Hv(i,e){return{defs:Object.assign(Object.assign({},i.defs),e.defs),instances:Object.assign(Object.assign({},i.instances),e.instances)}}function Bv(i,e){let t=fs(i.defs,e),n=fs(i.instances,s=>t[s.defId]);return{defs:t,instances:n}}function KH(i,e){let{defs:t,instances:n}=i,s={},r={};for(let o in t)e.defs[o]||(s[o]=t[o]);for(let o in n)!e.instances[o]&&s[n[o].defId]&&(r[o]=n[o]);return{defs:s,instances:r}}function JH(i,e){return Array.isArray(i)?nf(i,null,e,!0):typeof i=="object"&&i?nf([i],null,e,!0):i!=null?String(i):null}function RA(i){return Array.isArray(i)?i:typeof i=="string"?i.split(/\s+/):[]}var Av={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:P,overlap:P,allow:P,className:RA,classNames:RA,color:String,backgroundColor:String,borderColor:String,textColor:String},XH={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]};function Pc(i,e){let t=JH(i.constraint,e);return{display:i.display||null,startEditable:i.startEditable!=null?i.startEditable:i.editable,durationEditable:i.durationEditable!=null?i.durationEditable:i.editable,constraints:t!=null?[t]:[],overlap:i.overlap!=null?i.overlap:null,allows:i.allow!=null?[i.allow]:[],backgroundColor:i.backgroundColor||i.color||"",borderColor:i.borderColor||i.color||"",textColor:i.textColor||"",classNames:(i.className||[]).concat(i.classNames||[])}}function tC(i){return i.reduce(ZH,XH)}function ZH(i,e){return{display:e.display!=null?e.display:i.display,startEditable:e.startEditable!=null?e.startEditable:i.startEditable,durationEditable:e.durationEditable!=null?e.durationEditable:i.durationEditable,constraints:i.constraints.concat(e.constraints),overlap:typeof e.overlap=="boolean"?e.overlap:i.overlap,allows:i.allows.concat(e.allows),backgroundColor:e.backgroundColor||i.backgroundColor,borderColor:e.borderColor||i.borderColor,textColor:e.textColor||i.textColor,classNames:i.classNames.concat(e.classNames)}}var jH={id:String,defaultAllDay:Boolean,url:String,format:String,events:P,eventDataTransform:P,success:P,failure:P};function nC(i,e,t=iC(e)){let n;if(typeof i=="string"?n={url:i}:typeof i=="function"||Array.isArray(i)?n={events:i}:typeof i=="object"&&i&&(n=i),n){let{refined:s,extra:r}=kv(n,t),o=QH(s,e);if(o)return{_raw:i,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:s.defaultAllDay,eventDataTransform:s.eventDataTransform,success:s.success,failure:s.failure,publicId:s.id||"",sourceId:ys(),sourceDefId:o.sourceDefId,meta:o.meta,ui:Pc(s,e),extendedProps:r}}return null}function iC(i){return Object.assign(Object.assign(Object.assign({},Av),jH),i.pluginHooks.eventSourceRefiners)}function QH(i,e){let t=e.pluginHooks.eventSourceDefs;for(let n=t.length-1;n>=0;n-=1){let r=t[n].parseMeta(i);if(r)return{sourceDefId:n,meta:r}}return null}function _D(i,e,t,n,s){switch(e.type){case"RECEIVE_EVENTS":return eB(i,t[e.sourceId],e.fetchId,e.fetchRange,e.rawEvents,s);case"RESET_RAW_EVENTS":return tB(i,t[e.sourceId],e.rawEvents,n.activeRange,s);case"ADD_EVENTS":return nB(i,e.eventStore,n?n.activeRange:null,s);case"RESET_EVENTS":return e.eventStore;case"MERGE_EVENTS":return Hv(i,e.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return n?oa(i,n.activeRange,s):i;case"REMOVE_EVENTS":return KH(i,e.eventStore);case"REMOVE_EVENT_SOURCE":return xD(i,e.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return Bv(i,r=>!r.sourceId);case"REMOVE_ALL_EVENTS":return yt();default:return i}}function eB(i,e,t,n,s,r){if(e&&t===e.latestFetchId){let o=nf(TD(s,e,r),e,r);return n&&(o=oa(o,n,r)),Hv(xD(i,e.sourceId),o)}return i}function tB(i,e,t,n,s){let{defIdMap:r,instanceIdMap:o}=sB(i),a=nf(TD(t,e,s),e,s,!1,r,o);return oa(a,n,s)}function TD(i,e,t){let n=t.options.eventDataTransform,s=e?e.eventDataTransform:null;return s&&(i=jI(i,s)),n&&(i=jI(i,n)),i}function jI(i,e){let t;if(!e)t=i;else{t=[];for(let n of i){let s=e(n);s?t.push(s):s==null&&t.push(n)}}return t}function nB(i,e,t,n){return t&&(e=oa(e,t,n)),Hv(i,e)}function sC(i,e,t){let{defs:n}=i,s=bn(i.instances,r=>n[r.defId].allDay?r:Object.assign(Object.assign({},r),{range:{start:t.createMarker(e.toDate(r.range.start,r.forcedStartTzo)),end:t.createMarker(e.toDate(r.range.end,r.forcedEndTzo))},forcedStartTzo:t.canComputeOffset?null:r.forcedStartTzo,forcedEndTzo:t.canComputeOffset?null:r.forcedEndTzo}));return{defs:n,instances:s}}function xD(i,e){return Bv(i,t=>t.sourceId!==e)}function iB(i,e){return{defs:i.defs,instances:fs(i.instances,t=>!e[t.instanceId])}}function sB(i){let{defs:e,instances:t}=i,n={},s={};for(let r in e){let o=e[r],{publicId:a}=o;a&&(n[a]=r)}for(let r in t){let o=t[r],a=e[o.defId],{publicId:l}=a;l&&(s[l]=r)}return{defIdMap:n,instanceIdMap:s}}var gs=class{constructor(){this.handlers={},this.thisContext=null}setThisContext(e){this.thisContext=e}setOptions(e){this.options=e}on(e,t){rB(this.handlers,e,t)}off(e,t){oB(this.handlers,e,t)}trigger(e,...t){let n=this.handlers[e]||[],s=this.options&&this.options[e],r=[].concat(s||[],n);for(let o of r)o.apply(this.thisContext,t)}hasHandlers(e){return!!(this.handlers[e]&&this.handlers[e].length||this.options&&this.options[e])}};function rB(i,e,t){(i[e]||(i[e]=[])).push(t)}function oB(i,e,t){t?i[e]&&(i[e]=i[e].filter(n=>n!==t)):delete i[e]}var aB={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"};function rC(i,e){return nf(lB(i),null,e)}function lB(i){let e;return i===!0?e=[{}]:Array.isArray(i)?e=i.filter(t=>t.daysOfWeek):typeof i=="object"&&i?e=[i]:e=[],e=e.map(t=>Object.assign(Object.assign({},aB),t)),e}function Gv(i,e,t){t.emitter.trigger("select",Object.assign(Object.assign({},oC(i,t)),{jsEvent:e?e.origEvent:null,view:t.viewApi||t.calendarApi.view}))}function cB(i,e){e.emitter.trigger("unselect",{jsEvent:i?i.origEvent:null,view:e.viewApi||e.calendarApi.view})}function oC(i,e){let t={};for(let n of e.pluginHooks.dateSpanTransforms)Object.assign(t,n(i,e));return Object.assign(t,wB(i,e.dateEnv)),t}function Cv(i,e,t){let{dateEnv:n,options:s}=t,r=e;return i?(r=de(r),r=n.add(r,s.defaultAllDayEventDuration)):r=n.add(r,s.defaultTimedEventDuration),r}function wf(i,e,t,n){let s=_v(i.defs,e),r=yt();for(let o in i.defs){let a=i.defs[o];r.defs[o]=dB(a,s[o],t,n)}for(let o in i.instances){let a=i.instances[o],l=r.defs[a.defId];r.instances[o]=uB(a,l,s[a.defId],t,n)}return r}function dB(i,e,t,n){let s=t.standardProps||{};s.hasEnd==null&&e.durationEditable&&(t.startDelta||t.endDelta)&&(s.hasEnd=!0);let r=Object.assign(Object.assign(Object.assign({},i),s),{ui:Object.assign(Object.assign({},i.ui),s.ui)});t.extendedProps&&(r.extendedProps=Object.assign(Object.assign({},r.extendedProps),t.extendedProps));for(let o of n.pluginHooks.eventDefMutationAppliers)o(r,t,n);return!r.hasEnd&&n.options.forceEventDuration&&(r.hasEnd=!0),r}function uB(i,e,t,n,s){let{dateEnv:r}=s,o=n.standardProps&&n.standardProps.allDay===!0,a=n.standardProps&&n.standardProps.hasEnd===!1,l=Object.assign({},i);return o&&(l.range=SD(l.range)),n.datesDelta&&t.startEditable&&(l.range={start:r.add(l.range.start,n.datesDelta),end:r.add(l.range.end,n.datesDelta)}),n.startDelta&&t.durationEditable&&(l.range={start:r.add(l.range.start,n.startDelta),end:l.range.end}),n.endDelta&&t.durationEditable&&(l.range={start:l.range.start,end:r.add(l.range.end,n.endDelta)}),a&&(l.range={start:l.range.start,end:Cv(e.allDay,l.range.start,s)}),e.allDay&&(l.range={start:de(l.range.start),end:de(l.range.end)}),l.range.end<l.range.start&&(l.range.end=Cv(e.allDay,l.range.start,s)),l}var ur=class{constructor(e,t){this.context=e,this.internalEventSource=t}remove(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})}refetch(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId],isRefetch:!0})}get id(){return this.internalEventSource.publicId}get url(){return this.internalEventSource.meta.url}get format(){return this.internalEventSource.meta.format}},me=class i{constructor(e,t,n){this._context=e,this._def=t,this._instance=n||null}setProp(e,t){if(e in AD)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if(e==="id")t=vv[e](t),this.mutate({standardProps:{publicId:t}});else if(e in vv)t=vv[e](t),this.mutate({standardProps:{[e]:t}});else if(e in Av){let n=Av[e](t);e==="color"?n={backgroundColor:t,borderColor:t}:e==="editable"?n={startEditable:t,durationEditable:t}:n={[e]:t},this.mutate({standardProps:{ui:n}})}else console.warn(`Could not set prop '${e}'. Use setExtendedProp instead.`)}setExtendedProp(e,t){this.mutate({extendedProps:{[e]:t}})}setStart(e,t={}){let{dateEnv:n}=this._context,s=n.createMarker(e);if(s&&this._instance){let r=this._instance.range,o=pr(r.start,s,n,t.granularity);t.maintainDuration?this.mutate({datesDelta:o}):this.mutate({startDelta:o})}}setEnd(e,t={}){let{dateEnv:n}=this._context,s;if(!(e!=null&&(s=n.createMarker(e),!s))&&this._instance)if(s){let r=pr(this._instance.range.end,s,n,t.granularity);this.mutate({endDelta:r})}else this.mutate({standardProps:{hasEnd:!1}})}setDates(e,t,n={}){let{dateEnv:s}=this._context,r={allDay:n.allDay},o=s.createMarker(e),a;if(o&&!(t!=null&&(a=s.createMarker(t),!a))&&this._instance){let l=this._instance.range;n.allDay===!0&&(l=SD(l));let c=pr(l.start,o,s,n.granularity);if(a){let d=pr(l.end,a,s,n.granularity);iH(c,d)?this.mutate({datesDelta:c,standardProps:r}):this.mutate({startDelta:c,endDelta:d,standardProps:r})}else r.hasEnd=!1,this.mutate({datesDelta:c,standardProps:r})}}moveStart(e){let t=te(e);t&&this.mutate({startDelta:t})}moveEnd(e){let t=te(e);t&&this.mutate({endDelta:t})}moveDates(e){let t=te(e);t&&this.mutate({datesDelta:t})}setAllDay(e,t={}){let n={allDay:e},{maintainDuration:s}=t;s==null&&(s=this._context.options.allDayMaintainDuration),this._def.allDay!==e&&(n.hasEnd=s),this.mutate({standardProps:n})}formatRange(e){let{dateEnv:t}=this._context,n=this._instance,s=ue(e);return this._def.hasEnd?t.formatRange(n.range.start,n.range.end,s,{forcedStartTzo:n.forcedStartTzo,forcedEndTzo:n.forcedEndTzo}):t.format(n.range.start,s,{forcedTzo:n.forcedStartTzo})}mutate(e){let t=this._instance;if(t){let n=this._def,s=this._context,{eventStore:r}=s.getCurrentData(),o=Ef(r,t.instanceId);o=wf(o,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}},e,s);let l=new i(s,n,t);this._def=o.defs[n.defId],this._instance=o.instances[t.instanceId],s.dispatch({type:"MERGE_EVENTS",eventStore:o}),s.emitter.trigger("eventChange",{oldEvent:l,event:this,relatedEvents:_i(o,s,t),revert(){s.dispatch({type:"RESET_EVENTS",eventStore:r})}})}}remove(){let e=this._context,t=RD(this);e.dispatch({type:"REMOVE_EVENTS",eventStore:t}),e.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert(){e.dispatch({type:"MERGE_EVENTS",eventStore:t})}})}get source(){let{sourceId:e}=this._def;return e?new ur(this._context,this._context.getCurrentData().eventSources[e]):null}get start(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null}get end(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null}get startStr(){let e=this._instance;return e?this._context.dateEnv.formatIso(e.range.start,{omitTime:this._def.allDay,forcedTzo:e.forcedStartTzo}):""}get endStr(){let e=this._instance;return e&&this._def.hasEnd?this._context.dateEnv.formatIso(e.range.end,{omitTime:this._def.allDay,forcedTzo:e.forcedEndTzo}):""}get id(){return this._def.publicId}get groupId(){return this._def.groupId}get allDay(){return this._def.allDay}get title(){return this._def.title}get url(){return this._def.url}get display(){return this._def.ui.display||"auto"}get startEditable(){return this._def.ui.startEditable}get durationEditable(){return this._def.ui.durationEditable}get constraint(){return this._def.ui.constraints[0]||null}get overlap(){return this._def.ui.overlap}get allow(){return this._def.ui.allows[0]||null}get backgroundColor(){return this._def.ui.backgroundColor}get borderColor(){return this._def.ui.borderColor}get textColor(){return this._def.ui.textColor}get classNames(){return this._def.ui.classNames}get extendedProps(){return this._def.extendedProps}toPlainObject(e={}){let t=this._def,{ui:n}=t,{startStr:s,endStr:r}=this,o={allDay:t.allDay};return t.title&&(o.title=t.title),s&&(o.start=s),r&&(o.end=r),t.publicId&&(o.id=t.publicId),t.groupId&&(o.groupId=t.groupId),t.url&&(o.url=t.url),n.display&&n.display!=="auto"&&(o.display=n.display),e.collapseColor&&n.backgroundColor&&n.backgroundColor===n.borderColor?o.color=n.backgroundColor:(n.backgroundColor&&(o.backgroundColor=n.backgroundColor),n.borderColor&&(o.borderColor=n.borderColor)),n.textColor&&(o.textColor=n.textColor),n.classNames.length&&(o.classNames=n.classNames),Object.keys(t.extendedProps).length&&(e.collapseExtendedProps?Object.assign(o,t.extendedProps):o.extendedProps=t.extendedProps),o}toJSON(){return this.toPlainObject()}};function RD(i){let e=i._def,t=i._instance;return{defs:{[e.defId]:e},instances:t?{[t.instanceId]:t}:{}}}function _i(i,e,t){let{defs:n,instances:s}=i,r=[],o=t?t.instanceId:"";for(let a in s){let l=s[a],c=n[l.defId];l.instanceId!==o&&r.push(new me(e,c,l))}return r}function Tc(i,e,t,n){let s={},r={},o={},a=[],l=[],c=_v(i.defs,e);for(let d in i.defs){let h=i.defs[d];c[h.defId].display==="inverse-background"&&(h.groupId?(s[h.groupId]=[],o[h.groupId]||(o[h.groupId]=h)):r[d]=[])}for(let d in i.instances){let h=i.instances[d],p=i.defs[h.defId],m=c[p.defId],y=h.range,v=!p.allDay&&n?Ov(y,n):y,E=sn(v,t);E&&(m.display==="inverse-background"?p.groupId?s[p.groupId].push(E):r[h.defId].push(E):m.display!=="none"&&(m.display==="background"?a:l).push({def:p,ui:m,instance:h,range:E,isStart:v.start&&v.start.valueOf()===E.start.valueOf(),isEnd:v.end&&v.end.valueOf()===E.end.valueOf()}))}for(let d in s){let h=s[d],p=ZI(h,t);for(let m of p){let y=o[d],v=c[y.defId];a.push({def:y,ui:v,instance:null,range:m,isStart:!1,isEnd:!1})}}for(let d in r){let h=r[d],p=ZI(h,t);for(let m of p)a.push({def:i.defs[d],ui:c[d],instance:null,range:m,isStart:!1,isEnd:!1})}return{bg:a,fg:l}}function aC(i){return i.ui.display==="background"||i.ui.display==="inverse-background"}function QI(i,e){i.fcSeg=e}function vs(i){return i.fcSeg||i.parentNode.fcSeg||null}function _v(i,e){return bn(i,t=>ID(t,e))}function ID(i,e){let t=[];return e[""]&&t.push(e[""]),e[i.defId]&&t.push(e[i.defId]),t.push(i.ui),tC(t)}function ma(i,e){let t=i.map(hB);return t.sort((n,s)=>dD(n,s,e)),t.map(n=>n._seg)}function hB(i){let{eventRange:e}=i,t=e.def,n=e.instance?e.instance.range:e.range,s=n.start?n.start.valueOf():0,r=n.end?n.end.valueOf():0;return Object.assign(Object.assign(Object.assign({},t.extendedProps),t),{id:t.publicId,start:s,end:r,duration:r-s,allDay:Number(t.allDay),_seg:i})}function fB(i,e){let{pluginHooks:t}=e,n=t.isDraggableTransformers,{def:s,ui:r}=i.eventRange,o=r.startEditable;for(let a of n)o=a(o,s,r,e);return o}function pB(i,e){return i.isStart&&i.eventRange.ui.durationEditable&&e.options.eventResizableFromStart}function gB(i,e){return i.isEnd&&i.eventRange.ui.durationEditable}function Sr(i,e,t,n,s,r,o){let{dateEnv:a,options:l}=t,{displayEventTime:c,displayEventEnd:d}=l,h=i.eventRange.def,p=i.eventRange.instance;c==null&&(c=n!==!1),d==null&&(d=s!==!1);let m=p.range.start,y=p.range.end,v=r||i.start||i.eventRange.range.start,E=o||i.end||i.eventRange.range.end,S=de(m).valueOf()===de(v).valueOf(),C=de(Ei(y,-1)).valueOf()===de(Ei(E,-1)).valueOf();return c&&!h.allDay&&(S||C)?(v=S?m:v,E=C?y:E,d&&h.hasEnd?a.formatRange(v,E,e,{forcedStartTzo:r?null:p.forcedStartTzo,forcedEndTzo:o?null:p.forcedEndTzo}):a.format(v,e,{forcedTzo:r?null:p.forcedStartTzo})):""}function on(i,e,t){let n=i.eventRange.range;return{isPast:n.end<=(t||e.start),isFuture:n.start>=(t||e.end),isToday:e&&vn(e,n.start)}}function mB(i){let e=["fc-event"];return i.isMirror&&e.push("fc-event-mirror"),i.isDraggable&&e.push("fc-event-draggable"),(i.isStartResizable||i.isEndResizable)&&e.push("fc-event-resizable"),i.isDragging&&e.push("fc-event-dragging"),i.isResizing&&e.push("fc-event-resizing"),i.isSelected&&e.push("fc-event-selected"),i.isStart&&e.push("fc-event-start"),i.isEnd&&e.push("fc-event-end"),i.isPast&&e.push("fc-event-past"),i.isToday&&e.push("fc-event-today"),i.isFuture&&e.push("fc-event-future"),e}function Sf(i){return i.instance?i.instance.instanceId:`${i.def.defId}:${i.range.start.toISOString()}`}function Mc(i,e){let{def:t,instance:n}=i.eventRange,{url:s}=t;if(s)return{href:s};let{emitter:r,options:o}=e,{eventInteractive:a}=o;return a==null&&(a=t.interactive,a==null&&(a=!!r.hasHandlers("eventClick"))),a?lD(l=>{r.trigger("eventClick",{el:l.target,event:new me(e,t,n),jsEvent:l,view:e.viewApi})}):{}}var yB={start:P,end:P,allDay:Boolean};function vB(i,e,t){let n=bB(i,e),{range:s}=n;if(!s.start)return null;if(!s.end){if(t==null)return null;s.end=e.add(s.start,t)}return n}function bB(i,e){let{refined:t,extra:n}=kv(i,yB),s=t.start?e.createMarkerMeta(t.start):null,r=t.end?e.createMarkerMeta(t.end):null,{allDay:o}=t;return o==null&&(o=s&&s.isTimeUnspecified&&(!r||r.isTimeUnspecified)),Object.assign({range:{start:s?s.marker:null,end:r?r.marker:null},allDay:o},n)}function lC(i,e){return wD(i.range,e.range)&&i.allDay===e.allDay&&EB(i,e)}function EB(i,e){for(let t in e)if(t!=="range"&&t!=="allDay"&&i[t]!==e[t])return!1;for(let t in i)if(!(t in e))return!1;return!0}function wB(i,e){return Object.assign(Object.assign({},DD(i.range,e,i.allDay)),{allDay:i.allDay})}function cC(i,e,t){return Object.assign(Object.assign({},DD(i,e,t)),{timeZone:e.timeZone})}function DD(i,e,t){return{start:e.toDate(i.start),end:e.toDate(i.end),startStr:e.formatIso(i.start,{omitTime:t}),endStr:e.formatIso(i.end,{omitTime:t})}}function SB(i,e,t){let n=Uv({editable:!1},t),s=tf(n.refined,n.extra,"",i.allDay,!0,t);return{def:s,ui:ID(s,e),instance:bf(s.defId,i.range),range:i.range,isStart:!0,isEnd:!0}}function dC(i,e,t){let n=!1,s=function(a){n||(n=!0,e(a))},r=function(a){n||(n=!0,t(a))},o=i(s,r);o&&typeof o.then=="function"&&o.then(s,r)}var Tv=class extends Error{constructor(e,t){super(e),this.response=t}};function uC(i,e,t){i=i.toUpperCase();let n={method:i};return i==="GET"?e+=(e.indexOf("?")===-1?"?":"&")+new URLSearchParams(t):(n.body=new URLSearchParams(t),n.headers={"Content-Type":"application/x-www-form-urlencoded"}),fetch(e,n).then(s=>{if(s.ok)return s.json().then(r=>[r,s],()=>{throw new Tv("Failure parsing JSON",s)});throw new Tv("Request failed",s)})}var pA;function hC(){return pA==null&&(pA=AB()),pA}function AB(){if(typeof document=="undefined")return!0;let i=document.createElement("div");i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.innerHTML="<table><tr><td><div></div></td></tr></table>",i.querySelector("table").style.height="100px",i.querySelector("div").style.height="100%",document.body.appendChild(i);let t=i.querySelector("div").offsetHeight>0;return document.body.removeChild(i),t}var rf=class extends ne{constructor(){super(...arguments),this.state={forPrint:!1},this.handleBeforePrint=()=>{Qh(()=>{this.setState({forPrint:!0})})},this.handleAfterPrint=()=>{Qh(()=>{this.setState({forPrint:!1})})}}render(){let{props:e}=this,{options:t}=e,{forPrint:n}=this.state,s=n||t.height==="auto"||t.contentHeight==="auto",r=!s&&t.height!=null?t.height:"",o=["fc",n?"fc-media-print":"fc-media-screen",`fc-direction-${t.direction}`,e.theme.getClass("root")];return hC()||o.push("fc-liquid-hack"),e.children(o,r,s,n)}componentDidMount(){let{emitter:e}=this.props;e.on("_beforeprint",this.handleBeforePrint),e.on("_afterprint",this.handleAfterPrint)}componentWillUnmount(){let{emitter:e}=this.props;e.off("_beforeprint",this.handleBeforePrint),e.off("_afterprint",this.handleAfterPrint)}},Wn=class{constructor(e){this.component=e.component,this.isHitComboAllowed=e.isHitComboAllowed||null}destroy(){}};function PD(i,e){return{component:i,el:e.el,useEventCenter:e.useEventCenter!=null?e.useEventCenter:!0,isHitComboAllowed:e.isHitComboAllowed||null}}function Af(i){return{[i.component.uid]:i}}var kc={},Ot=class extends st{constructor(e,t){super(e,t),this.handleRefresh=()=>{let n=this.computeTiming();n.state.nowDate.valueOf()!==this.state.nowDate.valueOf()&&this.setState(n.state),this.clearTimeout(),this.setTimeout(n.waitMs)},this.handleVisibilityChange=()=>{document.hidden||this.handleRefresh()},this.state=this.computeTiming().state}render(){let{props:e,state:t}=this;return e.children(t.nowDate,t.todayRange)}componentDidMount(){this.setTimeout(),this.context.nowManager.addResetListener(this.handleRefresh),document.addEventListener("visibilitychange",this.handleVisibilityChange)}componentDidUpdate(e){e.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())}componentWillUnmount(){this.clearTimeout(),this.context.nowManager.removeResetListener(this.handleRefresh),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}computeTiming(){let{props:e,context:t}=this,n=t.nowManager.getDateMarker(),{nowIndicatorSnap:s}=t.options;s==="auto"&&(s=/year|month|week|day/.test(e.unit)||(e.unitValue||1)===1);let r,o;return s?(r=t.dateEnv.startOf(n,e.unit),o=t.dateEnv.add(r,te(1,e.unit)).valueOf()-n.valueOf()):(r=n,o=1e3*60),o=Math.min(1e3*60*60*24,o),{state:{nowDate:r,todayRange:CB(r)},waitMs:o}}setTimeout(e=this.computeTiming().waitMs){this.timeoutId=setTimeout(()=>{let t=this.computeTiming();this.setState(t.state,()=>{this.setTimeout(t.waitMs)})},e)}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}};Ot.contextType=wn;function CB(i){let e=de(i),t=Ee(e,1);return{start:e,end:t}}var of=class{getCurrentData(){return this.currentDataManager.getCurrentData()}dispatch(e){this.currentDataManager.dispatch(e)}get view(){return this.getCurrentData().viewApi}batchRendering(e){e()}updateSize(){this.trigger("_resize",!0)}setOption(e,t){this.dispatch({type:"SET_OPTION",optionName:e,rawOptionValue:t})}getOption(e){return this.currentDataManager.currentCalendarOptionsInput[e]}getAvailableLocaleCodes(){return Object.keys(this.getCurrentData().availableRawLocales)}on(e,t){let{currentDataManager:n}=this;n.currentCalendarOptionsRefiners[e]?n.emitter.on(e,t):console.warn(`Unknown listener name '${e}'`)}off(e,t){this.currentDataManager.emitter.off(e,t)}trigger(e,...t){this.currentDataManager.emitter.trigger(e,...t)}changeView(e,t){this.batchRendering(()=>{if(this.unselect(),t)if(t.start&&t.end)this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e}),this.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:t});else{let{dateEnv:n}=this.getCurrentData();this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e,dateMarker:n.createMarker(t)})}else this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e})})}zoomTo(e,t){let n=this.getCurrentData(),s;t=t||"day",s=n.viewSpecs[t]||this.getUnitViewSpec(t),this.unselect(),s?this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:s.type,dateMarker:e}):this.dispatch({type:"CHANGE_DATE",dateMarker:e})}getUnitViewSpec(e){let{viewSpecs:t,toolbarConfig:n}=this.getCurrentData(),s=[].concat(n.header?n.header.viewsWithButtons:[],n.footer?n.footer.viewsWithButtons:[]),r,o;for(let a in t)s.push(a);for(r=0;r<s.length;r+=1)if(o=t[s[r]],o&&o.singleUnit===e)return o;return null}prev(){this.unselect(),this.dispatch({type:"PREV"})}next(){this.unselect(),this.dispatch({type:"NEXT"})}prevYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,-1)})}nextYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,1)})}today(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.nowManager.getDateMarker()})}gotoDate(e){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.createMarker(e)})}incrementDate(e){let t=this.getCurrentData(),n=te(e);n&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.add(t.currentDate,n)}))}getDate(){let e=this.getCurrentData();return e.dateEnv.toDate(e.currentDate)}formatDate(e,t){let{dateEnv:n}=this.getCurrentData();return n.format(n.createMarker(e),ue(t))}formatRange(e,t,n){let{dateEnv:s}=this.getCurrentData();return s.formatRange(s.createMarker(e),s.createMarker(t),ue(n),n)}formatIso(e,t){let{dateEnv:n}=this.getCurrentData();return n.formatIso(n.createMarker(e),{omitTime:t})}select(e,t){let n;t==null?e.start!=null?n=e:n={start:e,end:null}:n={start:e,end:t};let s=this.getCurrentData(),r=vB(n,s.dateEnv,te({days:1}));r&&(this.dispatch({type:"SELECT_DATES",selection:r}),Gv(r,null,s))}unselect(e){let t=this.getCurrentData();t.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),cB(e,t))}addEvent(e,t){if(e instanceof me){let o=e._def,a=e._instance;return this.getCurrentData().eventStore.defs[o.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:sf({def:o,instance:a})}),this.triggerEventAdd(e)),e}let n=this.getCurrentData(),s;if(t instanceof ur)s=t.internalEventSource;else if(typeof t=="boolean")t&&([s]=Fv(n.eventSources));else if(t!=null){let o=this.getEventSourceById(t);if(!o)return console.warn(`Could not find an event source with ID "${t}"`),null;s=o.internalEventSource}let r=CD(e,s,n,!1);if(r){let o=new me(n,r.def,r.def.recurringDef?null:r.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:sf(r)}),this.triggerEventAdd(o),o}return null}triggerEventAdd(e){let{emitter:t}=this.getCurrentData();t.trigger("eventAdd",{event:e,relatedEvents:[],revert:()=>{this.dispatch({type:"REMOVE_EVENTS",eventStore:RD(e)})}})}getEventById(e){let t=this.getCurrentData(),{defs:n,instances:s}=t.eventStore;e=String(e);for(let r in n){let o=n[r];if(o.publicId===e){if(o.recurringDef)return new me(t,o,null);for(let a in s){let l=s[a];if(l.defId===o.defId)return new me(t,o,l)}}}return null}getEvents(){let e=this.getCurrentData();return _i(e.eventStore,e)}removeAllEvents(){this.dispatch({type:"REMOVE_ALL_EVENTS"})}getEventSources(){let e=this.getCurrentData(),t=e.eventSources,n=[];for(let s in t)n.push(new ur(e,t[s]));return n}getEventSourceById(e){let t=this.getCurrentData(),n=t.eventSources;e=String(e);for(let s in n)if(n[s].publicId===e)return new ur(t,n[s]);return null}addEventSource(e){let t=this.getCurrentData();if(e instanceof ur)return t.eventSources[e.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[e.internalEventSource]}),e;let n=nC(e,t);return n?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[n]}),new ur(t,n)):null}removeAllEventSources(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})}refetchEvents(){this.dispatch({type:"FETCH_EVENT_SOURCES",isRefetch:!0})}scrollToTime(e){let t=te(e);t&&this.trigger("_scrollRequest",{time:t})}};function fC(i,e){return i.left>=e.left&&i.left<e.right&&i.top>=e.top&&i.top<e.bottom}function Vv(i,e){let t={left:Math.max(i.left,e.left),right:Math.min(i.right,e.right),top:Math.max(i.top,e.top),bottom:Math.min(i.bottom,e.bottom)};return t.left<t.right&&t.top<t.bottom?t:!1}function pC(i,e){return{left:Math.min(Math.max(i.left,e.left),e.right),top:Math.min(Math.max(i.top,e.top),e.bottom)}}function gC(i){return{left:(i.left+i.right)/2,top:(i.top+i.bottom)/2}}function mC(i,e){return{left:i.left-e.left,top:i.top-e.top}}var gA=yt(),af=class{constructor(){this.getKeysForEventDefs=$(this._getKeysForEventDefs),this.splitDateSelection=$(this._splitDateSpan),this.splitEventStore=$(this._splitEventStore),this.splitIndividualUi=$(this._splitIndividualUi),this.splitEventDrag=$(this._splitInteraction),this.splitEventResize=$(this._splitInteraction),this.eventUiBuilders={}}splitProps(e){let t=this.getKeyInfo(e),n=this.getKeysForEventDefs(e.eventStore),s=this.splitDateSelection(e.dateSelection),r=this.splitIndividualUi(e.eventUiBases,n),o=this.splitEventStore(e.eventStore,n),a=this.splitEventDrag(e.eventDrag),l=this.splitEventResize(e.eventResize),c={};this.eventUiBuilders=bn(t,(d,h)=>this.eventUiBuilders[h]||$(_B));for(let d in t){let h=t[d],p=o[d]||gA,m=this.eventUiBuilders[d];c[d]={businessHours:h.businessHours||e.businessHours,dateSelection:s[d]||null,eventStore:p,eventUiBases:m(e.eventUiBases[""],h.ui,r[d]),eventSelection:p.instances[e.eventSelection]?e.eventSelection:"",eventDrag:a[d]||null,eventResize:l[d]||null}}return c}_splitDateSpan(e){let t={};if(e){let n=this.getKeysForDateSpan(e);for(let s of n)t[s]=e}return t}_getKeysForEventDefs(e){return bn(e.defs,t=>this.getKeysForEventDef(t))}_splitEventStore(e,t){let{defs:n,instances:s}=e,r={};for(let o in n)for(let a of t[o])r[a]||(r[a]=yt()),r[a].defs[o]=n[o];for(let o in s){let a=s[o];for(let l of t[a.defId])r[l]&&(r[l].instances[o]=a)}return r}_splitIndividualUi(e,t){let n={};for(let s in e)if(s)for(let r of t[s])n[r]||(n[r]={}),n[r][s]=e[s];return n}_splitInteraction(e){let t={};if(e){let n=this._splitEventStore(e.affectedEvents,this._getKeysForEventDefs(e.affectedEvents)),s=this._getKeysForEventDefs(e.mutatedEvents),r=this._splitEventStore(e.mutatedEvents,s),o=a=>{t[a]||(t[a]={affectedEvents:n[a]||gA,mutatedEvents:r[a]||gA,isEvent:e.isEvent})};for(let a in n)o(a);for(let a in r)o(a)}return t}};function _B(i,e,t){let n=[];i&&n.push(i),e&&n.push(e);let s={"":tC(n)};return t&&Object.assign(s,t),s}function Cf(i,e,t,n){return{dow:i.getUTCDay(),isDisabled:!!(n&&(!n.activeRange||!vn(n.activeRange,i))),isOther:!!(n&&!vn(n.currentRange,i)),isToday:!!(e&&vn(e,i)),isPast:!!(t?i<t:e&&i<e.start),isFuture:!!(t?i>t:e&&i>=e.end)}}function Nc(i,e){let t=["fc-day",`fc-day-${oH[i.dow]}`];return i.isDisabled?t.push("fc-day-disabled"):(i.isToday&&(t.push("fc-day-today"),t.push(e.getClass("today"))),i.isPast&&t.push("fc-day-past"),i.isFuture&&t.push("fc-day-future"),i.isOther&&t.push("fc-day-other")),t}var TB=ue({year:"numeric",month:"long",day:"numeric"}),xB=ue({week:"long"});function Ti(i,e,t="day",n=!0){let{dateEnv:s,options:r,calendarApi:o}=i,a=s.format(e,t==="week"?xB:TB);if(r.navLinks){let l=s.toDate(e),c=d=>{let h=t==="day"?r.navLinkDayClick:t==="week"?r.navLinkWeekClick:null;typeof h=="function"?h.call(o,s.toDate(e),d):(typeof h=="string"&&(t=h),o.zoomTo(e,t))};return Object.assign({title:Rc(r.navLinkHint,[a,l],a),"data-navlink":""},n?aD(c):{onClick:c})}return{"aria-label":a}}var mA=null;function MD(){return mA===null&&(mA=RB()),mA}function RB(){let i=document.createElement("div");ga(i,{position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}),i.innerHTML="<div></div>",document.body.appendChild(i);let t=i.firstChild.getBoundingClientRect().left>i.getBoundingClientRect().left;return ff(i),t}var yA;function kD(){return yA||(yA=IB()),yA}function IB(){let i=document.createElement("div");i.style.overflow="scroll",i.style.position="absolute",i.style.top="-9999px",i.style.left="-9999px",document.body.appendChild(i);let e=ND(i);return document.body.removeChild(i),e}function ND(i){return{x:i.offsetHeight-i.clientHeight,y:i.offsetWidth-i.clientWidth}}function FD(i,e=!1){let t=window.getComputedStyle(i),n=parseInt(t.borderLeftWidth,10)||0,s=parseInt(t.borderRightWidth,10)||0,r=parseInt(t.borderTopWidth,10)||0,o=parseInt(t.borderBottomWidth,10)||0,a=ND(i),l=a.y-n-s,c=a.x-r-o,d={borderLeft:n,borderRight:s,borderTop:r,borderBottom:o,scrollbarBottom:c,scrollbarLeft:0,scrollbarRight:0};return MD()&&t.direction==="rtl"?d.scrollbarLeft=l:d.scrollbarRight=l,e&&(d.paddingLeft=parseInt(t.paddingLeft,10)||0,d.paddingRight=parseInt(t.paddingRight,10)||0,d.paddingTop=parseInt(t.paddingTop,10)||0,d.paddingBottom=parseInt(t.paddingBottom,10)||0),d}function yC(i,e=!1,t){let n=t?i.getBoundingClientRect():_f(i),s=FD(i,e),r={left:n.left+s.borderLeft+s.scrollbarLeft,right:n.right-s.borderRight-s.scrollbarRight,top:n.top+s.borderTop,bottom:n.bottom-s.borderBottom-s.scrollbarBottom};return e&&(r.left+=s.paddingLeft,r.right-=s.paddingRight,r.top+=s.paddingTop,r.bottom-=s.paddingBottom),r}function _f(i){let e=i.getBoundingClientRect();return{left:e.left+window.scrollX,top:e.top+window.scrollY,right:e.right+window.scrollX,bottom:e.bottom+window.scrollY}}function DB(i){let e=$v(i),t=i.getBoundingClientRect();for(let n of e){let s=Vv(t,n.getBoundingClientRect());if(s)t=s;else return null}return t}function $v(i){let e=[];for(;i instanceof HTMLElement;){let t=window.getComputedStyle(i);if(t.position==="fixed")break;/(auto|scroll)/.test(t.overflow+t.overflowY+t.overflowX)&&e.push(i),i=i.parentNode}return e}var Yn=class{constructor(e,t,n,s){this.els=t;let r=this.originClientRect=e.getBoundingClientRect();n&&this.buildElHorizontals(r.left),s&&this.buildElVerticals(r.top)}buildElHorizontals(e){let t=[],n=[];for(let s of this.els){let r=s.getBoundingClientRect();t.push(r.left-e),n.push(r.right-e)}this.lefts=t,this.rights=n}buildElVerticals(e){let t=[],n=[];for(let s of this.els){let r=s.getBoundingClientRect();t.push(r.top-e),n.push(r.bottom-e)}this.tops=t,this.bottoms=n}leftToIndex(e){let{lefts:t,rights:n}=this,s=t.length,r;for(r=0;r<s;r+=1)if(e>=t[r]&&e<n[r])return r}topToIndex(e){let{tops:t,bottoms:n}=this,s=t.length,r;for(r=0;r<s;r+=1)if(e>=t[r]&&e<n[r])return r}getWidth(e){return this.rights[e]-this.lefts[e]}getHeight(e){return this.bottoms[e]-this.tops[e]}similarTo(e){return pv(this.tops||[],e.tops||[])&&pv(this.bottoms||[],e.bottoms||[])&&pv(this.lefts||[],e.lefts||[])&&pv(this.rights||[],e.rights||[])}};function pv(i,e){let t=i.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(Math.round(i[n])!==Math.round(e[n]))return!1;return!0}var aa=class{getMaxScrollTop(){return this.getScrollHeight()-this.getClientHeight()}getMaxScrollLeft(){return this.getScrollWidth()-this.getClientWidth()}canScrollVertically(){return this.getMaxScrollTop()>0}canScrollHorizontally(){return this.getMaxScrollLeft()>0}canScrollUp(){return this.getScrollTop()>0}canScrollDown(){return this.getScrollTop()<this.getMaxScrollTop()}canScrollLeft(){return this.getScrollLeft()>0}canScrollRight(){return this.getScrollLeft()<this.getMaxScrollLeft()}},lf=class extends aa{constructor(e){super(),this.el=e}getScrollTop(){return this.el.scrollTop}getScrollLeft(){return this.el.scrollLeft}setScrollTop(e){this.el.scrollTop=e}setScrollLeft(e){this.el.scrollLeft=e}getScrollWidth(){return this.el.scrollWidth}getScrollHeight(){return this.el.scrollHeight}getClientHeight(){return this.el.clientHeight}getClientWidth(){return this.el.clientWidth}},cf=class extends aa{getScrollTop(){return window.scrollY}getScrollLeft(){return window.scrollX}setScrollTop(e){window.scroll(window.scrollX,e)}setScrollLeft(e){window.scroll(e,window.scrollY)}getScrollWidth(){return document.documentElement.scrollWidth}getScrollHeight(){return document.documentElement.scrollHeight}getClientHeight(){return document.documentElement.clientHeight}getClientWidth(){return document.documentElement.clientWidth}},rt=class extends ne{constructor(){super(...arguments),this.uid=ys()}prepareHits(){}queryHit(e,t,n,s){return null}isValidSegDownEl(e){return!this.props.eventDrag&&!this.props.eventResize&&!Ge(e,".fc-event-mirror")}isValidDateDownEl(e){return!Ge(e,".fc-event:not(.fc-bg-event)")&&!Ge(e,".fc-more-link")&&!Ge(e,"a[data-navlink]")&&!Ge(e,".fc-popover")}};var la=class{constructor(e=t=>t.thickness||1){this.getEntryThickness=e,this.strictOrder=!1,this.allowReslicing=!1,this.maxCoord=-1,this.maxStackCnt=-1,this.levelCoords=[],this.entriesByLevel=[],this.stackCnts={}}addSegs(e){let t=[];for(let n of e)this.insertEntry(n,t);return t}insertEntry(e,t){let n=this.findInsertion(e);this.isInsertionValid(n,e)?this.insertEntryAt(e,n):this.handleInvalidInsertion(n,e,t)}isInsertionValid(e,t){return(this.maxCoord===-1||e.levelCoord+this.getEntryThickness(t)<=this.maxCoord)&&(this.maxStackCnt===-1||e.stackCnt<this.maxStackCnt)}handleInvalidInsertion(e,t,n){if(this.allowReslicing&&e.touchingEntry){let s=Object.assign(Object.assign({},t),{span:Tf(t.span,e.touchingEntry.span)});n.push(s),this.splitEntry(t,e.touchingEntry,n)}else n.push(t)}splitEntry(e,t,n){let s=e.span,r=t.span;s.start<r.start&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:s.start,end:r.start}},n),s.end>r.end&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:r.end,end:s.end}},n)}insertEntryAt(e,t){let{entriesByLevel:n,levelCoords:s}=this;t.lateral===-1?(vA(s,t.level,t.levelCoord),vA(n,t.level,[e])):vA(n[t.level],t.lateral,e),this.stackCnts[Si(e)]=t.stackCnt}findInsertion(e){let{levelCoords:t,entriesByLevel:n,strictOrder:s,stackCnts:r}=this,o=t.length,a=0,l=-1,c=-1,d=null,h=0;for(let y=0;y<o;y+=1){let v=t[y];if(!s&&v>=a+this.getEntryThickness(e))break;let E=n[y],S,C=uf(E,e.span.start,df),_=C[0]+C[1];for(;(S=E[_])&&S.span.start<e.span.end;){let T=v+this.getEntryThickness(S);T>a&&(a=T,d=S,l=y,c=_),T===a&&(h=Math.max(h,r[Si(S)]+1)),_+=1}}let p=0;if(d)for(p=l+1;p<o&&t[p]<a;)p+=1;let m=-1;return p<o&&t[p]===a&&(m=uf(n[p],e.span.end,df)[0]),{touchingLevel:l,touchingLateral:c,touchingEntry:d,stackCnt:h,levelCoord:a,level:p,lateral:m}}toRects(){let{entriesByLevel:e,levelCoords:t}=this,n=e.length,s=[];for(let r=0;r<n;r+=1){let o=e[r],a=t[r];for(let l of o)s.push(Object.assign(Object.assign({},l),{thickness:this.getEntryThickness(l),levelCoord:a}))}return s}};function df(i){return i.span.end}function Si(i){return i.index+":"+i.span.start}function vC(i){let e=[];for(let t of i){let n=[],s={span:t.span,entries:[t]};for(let r of e)Tf(r.span,s.span)?s={entries:r.entries.concat(s.entries),span:PB(r.span,s.span)}:n.push(r);n.push(s),e=n}return e}function PB(i,e){return{start:Math.min(i.start,e.start),end:Math.max(i.end,e.end)}}function Tf(i,e){let t=Math.max(i.start,e.start),n=Math.min(i.end,e.end);return t<n?{start:t,end:n}:null}function vA(i,e,t){i.splice(e,0,t)}function uf(i,e,t){let n=0,s=i.length;if(!s||e<t(i[n]))return[0,0];if(e>t(i[s-1]))return[s,0];for(;n<s;){let r=Math.floor(n+(s-n)/2),o=t(i[r]);if(e<o)s=r;else if(e>o)n=r+1;else return[r,1]}return[n,0]}var hf=class{constructor(e,t){this.emitter=new gs}destroy(){}setMirrorIsVisible(e){}setMirrorNeedsRevert(e){}setAutoScrollEnabled(e){}},xf={};function LD(i,e){return!i||e>10?ue({weekday:"short"}):e>1?ue({weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}):ue({weekday:"long"})}var OD="fc-col-header-cell";function UD(i){return i.text}var xv=class extends ne{render(){let{dateEnv:e,options:t,theme:n,viewApi:s}=this.context,{props:r}=this,{date:o,dateProfile:a}=r,l=Cf(o,r.todayRange,null,a),c=[OD].concat(Nc(l,n)),d=e.format(o,r.dayHeaderFormat),h=!l.isDisabled&&r.colCnt>1?Ti(this.context,o):{},p=e.toDate(o);e.namedTimeZoneImpl&&(p=Ei(p,36e5));let m=Object.assign(Object.assign(Object.assign({date:p,view:s},r.extraRenderProps),{text:d}),l);return x(xe,{elTag:"th",elClasses:c,elAttrs:Object.assign({role:"columnheader",colSpan:r.colSpan,"data-date":l.isDisabled?void 0:br(o)},r.extraDataAttrs),renderProps:m,generatorName:"dayHeaderContent",customGenerator:t.dayHeaderContent,defaultGenerator:UD,classNameGenerator:t.dayHeaderClassNames,didMount:t.dayHeaderDidMount,willUnmount:t.dayHeaderWillUnmount},y=>x("div",{className:"fc-scrollgrid-sync-inner"},!l.isDisabled&&x(y,{elTag:"a",elAttrs:h,elClasses:["fc-col-header-cell-cushion",r.isSticky&&"fc-sticky"]})))}},MB=ue({weekday:"long"}),Rv=class extends ne{render(){let{props:e}=this,{dateEnv:t,theme:n,viewApi:s,options:r}=this.context,o=Ee(new Date(2592e5),e.dow),a={dow:e.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},l=t.format(o,e.dayHeaderFormat),c=Object.assign(Object.assign(Object.assign(Object.assign({date:o},a),{view:s}),e.extraRenderProps),{text:l});return x(xe,{elTag:"th",elClasses:[OD,...Nc(a,n),...e.extraClassNames||[]],elAttrs:Object.assign({role:"columnheader",colSpan:e.colSpan},e.extraDataAttrs),renderProps:c,generatorName:"dayHeaderContent",customGenerator:r.dayHeaderContent,defaultGenerator:UD,classNameGenerator:r.dayHeaderClassNames,didMount:r.dayHeaderDidMount,willUnmount:r.dayHeaderWillUnmount},d=>x("div",{className:"fc-scrollgrid-sync-inner"},x(d,{elTag:"a",elClasses:["fc-col-header-cell-cushion",e.isSticky&&"fc-sticky"],elAttrs:{"aria-label":t.format(o,MB)}})))}},ca=class extends ne{constructor(){super(...arguments),this.createDayHeaderFormatter=$(kB)}render(){let{context:e}=this,{dates:t,dateProfile:n,datesRepDistinctDays:s,renderIntro:r}=this.props,o=this.createDayHeaderFormatter(e.options.dayHeaderFormat,s,t.length);return x(Ot,{unit:"day"},(a,l)=>x("tr",{role:"row"},r&&r("day"),t.map(c=>s?x(xv,{key:c.toISOString(),date:c,dateProfile:n,todayRange:l,colCnt:t.length,dayHeaderFormat:o}):x(Rv,{key:c.getUTCDay(),dow:c.getUTCDay(),dayHeaderFormat:o}))))}};function kB(i,e,t){return i||LD(e,t)}var da=class{constructor(e,t){let n=e.start,{end:s}=e,r=[],o=[],a=-1;for(;n<s;)t.isHiddenDay(n)?r.push(a+.5):(a+=1,r.push(a),o.push(n)),n=Ee(n,1);this.dates=o,this.indices=r,this.cnt=o.length}sliceRange(e){let t=this.getDateDayIndex(e.start),n=this.getDateDayIndex(Ee(e.end,-1)),s=Math.max(0,t),r=Math.min(this.cnt-1,n);return s=Math.ceil(s),r=Math.floor(r),s<=r?{firstIndex:s,lastIndex:r,isStart:t===s,isEnd:n===r}:null}getDateDayIndex(e){let{indices:t}=this,n=Math.floor(Ci(this.dates[0],e));return n<0?t[0]-1:n>=t.length?t[t.length-1]+1:t[n]}},ua=class{constructor(e,t){let{dates:n}=e,s,r,o;if(t){for(r=n[0].getUTCDay(),s=1;s<n.length&&n[s].getUTCDay()!==r;s+=1);o=Math.ceil(n.length/s)}else o=1,s=n.length;this.rowCnt=o,this.colCnt=s,this.daySeries=e,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}buildCells(){let e=[];for(let t=0;t<this.rowCnt;t+=1){let n=[];for(let s=0;s<this.colCnt;s+=1)n.push(this.buildCell(t,s));e.push(n)}return e}buildCell(e,t){let n=this.daySeries.dates[e*this.colCnt+t];return{key:n.toISOString(),date:n}}buildHeaderDates(){let e=[];for(let t=0;t<this.colCnt;t+=1)e.push(this.cells[0][t].date);return e}sliceRange(e){let{colCnt:t}=this,n=this.daySeries.sliceRange(e),s=[];if(n){let{firstIndex:r,lastIndex:o}=n,a=r;for(;a<=o;){let l=Math.floor(a/t),c=Math.min((l+1)*t,o+1);s.push({row:l,firstCol:a%t,lastCol:(c-1)%t,isStart:n.isStart&&a===r,isEnd:n.isEnd&&c-1===o}),a=c}}return s}},ha=class{constructor(){this.sliceBusinessHours=$(this._sliceBusinessHours),this.sliceDateSelection=$(this._sliceDateSpan),this.sliceEventStore=$(this._sliceEventStore),this.sliceEventDrag=$(this._sliceInteraction),this.sliceEventResize=$(this._sliceInteraction),this.forceDayIfListItem=!1}sliceProps(e,t,n,s,...r){let{eventUiBases:o}=e,a=this.sliceEventStore(e.eventStore,o,t,n,...r);return{dateSelectionSegs:this.sliceDateSelection(e.dateSelection,t,n,o,s,...r),businessHourSegs:this.sliceBusinessHours(e.businessHours,t,n,s,...r),fgEventSegs:a.fg,bgEventSegs:a.bg,eventDrag:this.sliceEventDrag(e.eventDrag,o,t,n,...r),eventResize:this.sliceEventResize(e.eventResize,o,t,n,...r),eventSelection:e.eventSelection}}sliceNowDate(e,t,n,s,...r){return this._sliceDateSpan({range:{start:e,end:Ei(e,1)},allDay:!1},t,n,{},s,...r)}_sliceBusinessHours(e,t,n,s,...r){return e?this._sliceEventStore(oa(e,gv(t,!!n),s),{},t,n,...r).bg:[]}_sliceEventStore(e,t,n,s,...r){if(e){let o=Tc(e,t,gv(n,!!s),s);return{bg:this.sliceEventRanges(o.bg,r),fg:this.sliceEventRanges(o.fg,r)}}return{bg:[],fg:[]}}_sliceInteraction(e,t,n,s,...r){if(!e)return null;let o=Tc(e.mutatedEvents,t,gv(n,!!s),s);return{segs:this.sliceEventRanges(o.fg,r),affectedInstances:e.affectedEvents.instances,isEvent:e.isEvent}}_sliceDateSpan(e,t,n,s,r,...o){if(!e)return[];let a=gv(t,!!n),l=sn(e.range,a);if(l){e=Object.assign(Object.assign({},e),{range:l});let c=SB(e,s,r),d=this.sliceRange(e.range,...o);for(let h of d)h.eventRange=c;return d}return[]}sliceEventRanges(e,t){let n=[];for(let s of e)n.push(...this.sliceEventRange(s,t));return n}sliceEventRange(e,t){let n=e.range;this.forceDayIfListItem&&e.ui.display==="list-item"&&(n={start:n.start,end:Ee(n.start,1)});let s=this.sliceRange(n,...t);for(let r of s)r.eventRange=e,r.isStart=e.isStart&&r.isStart,r.isEnd=e.isEnd&&r.isEnd;return s}};function gv(i,e){let t=i.activeRange;return e?t:{start:Ei(t.start,i.slotMinTime.milliseconds),end:Ei(t.end,i.slotMaxTime.milliseconds-864e5)}}function zv(i,e,t){let{instances:n}=i.mutatedEvents;for(let s in n)if(!Dc(e.validRange,n[s].range))return!1;return HD({eventDrag:i},t)}function bC(i,e,t){return Dc(e.validRange,i.range)?HD({dateSelection:i},t):!1}function HD(i,e){let t=e.getCurrentData(),n=Object.assign({businessHours:t.businessHours,dateSelection:"",eventStore:t.eventStore,eventUiBases:t.eventUiBases,eventSelection:"",eventDrag:null,eventResize:null},i);return(e.pluginHooks.isPropsValid||BD)(n,e)}function BD(i,e,t={},n){return!(i.eventDrag&&!NB(i,e,t,n)||i.dateSelection&&!FB(i,e,t,n))}function NB(i,e,t,n){let s=e.getCurrentData(),r=i.eventDrag,o=r.mutatedEvents,a=o.defs,l=o.instances,c=_v(a,r.isEvent?i.eventUiBases:{"":s.selectionConfig});n&&(c=bn(c,n));let d=iB(i.eventStore,r.affectedEvents.instances),h=d.defs,p=d.instances,m=_v(h,i.eventUiBases);for(let y in l){let v=l[y],E=v.range,S=c[v.defId],C=a[v.defId];if(!GD(S.constraints,E,d,i.businessHours,e))return!1;let{eventOverlap:_}=e.options,T=typeof _=="function"?_:null;for(let I in p){let D=p[I];if(Lv(E,D.range)&&(m[D.defId].overlap===!1&&r.isEvent||S.overlap===!1||T&&!T(new me(e,h[D.defId],D),new me(e,C,v))))return!1}let R=s.eventStore;for(let I of S.allows){let D=Object.assign(Object.assign({},t),{range:v.range,allDay:C.allDay}),k=R.defs[C.defId],N=R.instances[y],F;if(k?F=new me(e,k,N):F=new me(e,C),!I(oC(D,e),F))return!1}}return!0}function FB(i,e,t,n){let s=i.eventStore,r=s.defs,o=s.instances,a=i.dateSelection,l=a.range,{selectionConfig:c}=e.getCurrentData();if(n&&(c=n(c)),!GD(c.constraints,l,s,i.businessHours,e))return!1;let{selectOverlap:d}=e.options,h=typeof d=="function"?d:null;for(let p in o){let m=o[p];if(Lv(l,m.range)&&(c.overlap===!1||h&&!h(new me(e,r[m.defId],m),null)))return!1}for(let p of c.allows){let m=Object.assign(Object.assign({},t),a);if(!p(oC(m,e),null))return!1}return!0}function GD(i,e,t,n,s){for(let r of i)if(!OB(LB(r,e,t,n,s),e))return!1;return!0}function LB(i,e,t,n,s){return i==="businessHours"?bA(oa(n,e,s)):typeof i=="string"?bA(Bv(t,r=>r.groupId===i)):typeof i=="object"&&i?bA(oa(i,e,s)):[]}function bA(i){let{instances:e}=i,t=[];for(let n in e)t.push(e[n].range);return t}function OB(i,e){for(let t of i)if(Dc(t,e))return!0;return!1}var mv=/^(visible|hidden)$/,xc=class extends ne{constructor(){super(...arguments),this.handleEl=e=>{this.el=e,rn(this.props.elRef,e)}}render(){let{props:e}=this,{liquid:t,liquidIsAbsolute:n}=e,s=t&&n,r=["fc-scroller"];return t&&(n?r.push("fc-scroller-liquid-absolute"):r.push("fc-scroller-liquid")),x("div",{ref:this.handleEl,className:r.join(" "),style:{overflowX:e.overflowX,overflowY:e.overflowY,left:s&&-(e.overcomeLeft||0)||"",right:s&&-(e.overcomeRight||0)||"",bottom:s&&-(e.overcomeBottom||0)||"",marginLeft:!s&&-(e.overcomeLeft||0)||"",marginRight:!s&&-(e.overcomeRight||0)||"",marginBottom:!s&&-(e.overcomeBottom||0)||"",maxHeight:e.maxHeight||""}},e.children)}needsXScrolling(){if(mv.test(this.props.overflowX))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),{children:n}=e;for(let s=0;s<n.length;s+=1)if(n[s].getBoundingClientRect().width>t)return!0;return!1}needsYScrolling(){if(mv.test(this.props.overflowY))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),{children:n}=e;for(let s=0;s<n.length;s+=1)if(n[s].getBoundingClientRect().height>t)return!0;return!1}getXScrollbarWidth(){return mv.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight}getYScrollbarWidth(){return mv.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth}},Ut=class{constructor(e){this.masterCallback=e,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=(t,n)=>{let{depths:s,currentMap:r}=this,o=!1,a=!1;t!==null?(o=n in r,r[n]=t,s[n]=(s[n]||0)+1,a=!0):(s[n]-=1,s[n]||(delete r[n],delete this.callbackMap[n],o=!0)),this.masterCallback&&(o&&this.masterCallback(null,String(n)),a&&this.masterCallback(t,String(n)))}}createRef(e){let t=this.callbackMap[e];return t||(t=this.callbackMap[e]=n=>{this.handleValue(n,String(e))}),t}collect(e,t,n){return mD(this.currentMap,e,t,n)}getAll(){return Fv(this.currentMap)}};function VD(i){let e=rD(i,".fc-scrollgrid-shrink"),t=0;for(let n of e)t=Math.max(t,eH(n));return Math.ceil(t)}function EC(i,e){return i.liquid&&e.liquid}function $D(i,e){return e.maxHeight!=null||EC(i,e)}function zD(i,e,t,n){let{expandRows:s}=t;return typeof e.content=="function"?e.content(t):x("table",{role:"presentation",className:[e.tableClassName,i.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:t.tableMinWidth,width:t.clientWidth,height:s?t.clientHeight:""}},t.tableColGroupNode,x(n?"thead":"tbody",{role:"presentation"},typeof e.rowContent=="function"?e.rowContent(t):e.rowContent))}function qD(i,e){return Ai(i,e,Lt)}function WD(i,e){let t=[];for(let n of i){let s=n.span||1;for(let r=0;r<s;r+=1)t.push(x("col",{style:{width:n.width==="shrink"?YD(e):n.width||"",minWidth:n.minWidth||""}}))}return x("colgroup",{},...t)}function YD(i){return i==null?4:i}function KD(i){for(let e of i)if(e.width==="shrink")return!0;return!1}function JD(i,e){let t=["fc-scrollgrid",e.theme.getClass("table")];return i&&t.push("fc-scrollgrid-liquid"),t}function XD(i,e){let t=["fc-scrollgrid-section",`fc-scrollgrid-section-${i.type}`,i.className];return e&&i.liquid&&i.maxHeight==null&&t.push("fc-scrollgrid-section-liquid"),i.isSticky&&t.push("fc-scrollgrid-section-sticky"),t}function Fc(i){return x("div",{className:"fc-scrollgrid-sticky-shim",style:{width:i.clientWidth,minWidth:i.tableMinWidth}})}function ya(i){let{stickyHeaderDates:e}=i;return(e==null||e==="auto")&&(e=i.height==="auto"||i.viewHeight==="auto"),e}function Rf(i){let{stickyFooterScrollbar:e}=i;return(e==null||e==="auto")&&(e=i.height==="auto"||i.viewHeight==="auto"),e}var gr=class extends ne{constructor(){super(...arguments),this.processCols=$(e=>e,qD),this.renderMicroColGroup=$(WD),this.scrollerRefs=new Ut,this.scrollerElRefs=new Ut(this._handleScrollerEl.bind(this)),this.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},this.handleSizing=()=>{this.safeSetState(Object.assign({shrinkWidth:this.computeShrinkWidth()},this.computeScrollerDims()))}}render(){let{props:e,state:t,context:n}=this,s=e.sections||[],r=this.processCols(e.cols),o=this.renderMicroColGroup(r,t.shrinkWidth),a=JD(e.liquid,n);e.collapsibleWidth&&a.push("fc-scrollgrid-collapsible");let l=s.length,c=0,d,h=[],p=[],m=[];for(;c<l&&(d=s[c]).type==="header";)h.push(this.renderSection(d,o,!0)),c+=1;for(;c<l&&(d=s[c]).type==="body";)p.push(this.renderSection(d,o,!1)),c+=1;for(;c<l&&(d=s[c]).type==="footer";)m.push(this.renderSection(d,o,!0)),c+=1;let y=!hC(),v={role:"rowgroup"};return x("table",{role:"grid",className:a.join(" "),style:{height:e.height}},!!(!y&&h.length)&&x("thead",v,...h),!!(!y&&p.length)&&x("tbody",v,...p),!!(!y&&m.length)&&x("tfoot",v,...m),y&&x("tbody",v,...h,...p,...m))}renderSection(e,t,n){return"outerContent"in e?x(ae,{key:e.key},e.outerContent):x("tr",{key:e.key,role:"presentation",className:XD(e,this.props.liquid).join(" ")},this.renderChunkTd(e,t,e.chunk,n))}renderChunkTd(e,t,n,s){if("outerContent"in n)return n.outerContent;let{props:r}=this,{forceYScrollbars:o,scrollerClientWidths:a,scrollerClientHeights:l}=this.state,c=$D(r,e),d=EC(r,e),h=r.liquid?o?"scroll":c?"auto":"hidden":"visible",p=e.key,m=zD(e,n,{tableColGroupNode:t,tableMinWidth:"",clientWidth:!r.collapsibleWidth&&a[p]!==void 0?a[p]:null,clientHeight:l[p]!==void 0?l[p]:null,expandRows:e.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:()=>{}},s);return x(s?"th":"td",{ref:n.elRef,role:"presentation"},x("div",{className:`fc-scroller-harness${d?" fc-scroller-harness-liquid":""}`},x(xc,{ref:this.scrollerRefs.createRef(p),elRef:this.scrollerElRefs.createRef(p),overflowY:h,overflowX:r.liquid?"hidden":"visible",maxHeight:e.maxHeight,liquid:d,liquidIsAbsolute:!0},m)))}_handleScrollerEl(e,t){let n=UB(this.props.sections,t);n&&rn(n.chunk.scrollerElRef,e)}componentDidMount(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)}componentDidUpdate(){this.handleSizing()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}computeShrinkWidth(){return KD(this.props.cols)?VD(this.scrollerElRefs.getAll()):0}computeScrollerDims(){let e=kD(),{scrollerRefs:t,scrollerElRefs:n}=this,s=!1,r={},o={};for(let a in t.currentMap){let l=t.currentMap[a];if(l&&l.needsYScrolling()){s=!0;break}}for(let a of this.props.sections){let l=a.key,c=n.currentMap[l];if(c){let d=c.parentNode;r[l]=Math.floor(d.getBoundingClientRect().width-(s?e.y:0)),o[l]=Math.floor(d.getBoundingClientRect().height)}}return{forceYScrollbars:s,scrollerClientWidths:r,scrollerClientHeights:o}}};gr.addStateEquality({scrollerClientWidths:Lt,scrollerClientHeights:Lt});function UB(i,e){for(let t of i)if(t.key===e)return t;return null}var ms=class extends ne{constructor(){super(...arguments),this.buildPublicEvent=$((e,t,n)=>new me(e,t,n)),this.handleEl=e=>{this.el=e,rn(this.props.elRef,e),e&&QI(e,this.props.seg)}}render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,{eventRange:r}=s,{ui:o}=r,a={event:this.buildPublicEvent(t,r.def,r.instance),view:t.viewApi,timeText:e.timeText,textColor:o.textColor,backgroundColor:o.backgroundColor,borderColor:o.borderColor,isDraggable:!e.disableDragging&&fB(s,t),isStartResizable:!e.disableResizing&&pB(s,t),isEndResizable:!e.disableResizing&&gB(s),isMirror:!!(e.isDragging||e.isResizing||e.isDateSelecting),isStart:!!s.isStart,isEnd:!!s.isEnd,isPast:!!e.isPast,isFuture:!!e.isFuture,isToday:!!e.isToday,isSelected:!!e.isSelected,isDragging:!!e.isDragging,isResizing:!!e.isResizing};return x(xe,{elRef:this.handleEl,elTag:e.elTag,elAttrs:e.elAttrs,elClasses:[...mB(a),...s.eventRange.ui.classNames,...e.elClasses||[]],elStyle:e.elStyle,renderProps:a,generatorName:"eventContent",customGenerator:n.eventContent,defaultGenerator:e.defaultGenerator,classNameGenerator:n.eventClassNames,didMount:n.eventDidMount,willUnmount:n.eventWillUnmount},e.children)}componentDidUpdate(e){this.el&&this.props.seg!==e.seg&&QI(this.el,this.props.seg)}},mr=class extends ne{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,{ui:r}=s.eventRange,o=n.eventTimeFormat||e.defaultTimeFormat,a=Sr(s,o,t,e.defaultDisplayEventTime,e.defaultDisplayEventEnd);return x(ms,Object.assign({},e,{elTag:"a",elStyle:{borderColor:r.borderColor,backgroundColor:r.backgroundColor},elAttrs:Mc(s,t),defaultGenerator:HB,timeText:a}),(l,c)=>x(ae,null,x(l,{elTag:"div",elClasses:["fc-event-main"],elStyle:{color:c.textColor}}),!!c.isStartResizable&&x("div",{className:"fc-event-resizer fc-event-resizer-start"}),!!c.isEndResizable&&x("div",{className:"fc-event-resizer fc-event-resizer-end"})))}};mr.addPropsEquality({seg:Lt});function HB(i){return x("div",{className:"fc-event-main-frame"},i.timeText&&x("div",{className:"fc-event-time"},i.timeText),x("div",{className:"fc-event-title-container"},x("div",{className:"fc-event-title fc-sticky"},i.event.title||x(ae,null,"\xA0"))))}var If=i=>x(wn.Consumer,null,e=>{let{options:t}=e,n={isAxis:i.isAxis,date:e.dateEnv.toDate(i.date),view:e.viewApi};return x(xe,{elRef:i.elRef,elTag:i.elTag||"div",elAttrs:i.elAttrs,elClasses:i.elClasses,elStyle:i.elStyle,renderProps:n,generatorName:"nowIndicatorContent",customGenerator:t.nowIndicatorContent,classNameGenerator:t.nowIndicatorClassNames,didMount:t.nowIndicatorDidMount,willUnmount:t.nowIndicatorWillUnmount},i.children)}),BB=ue({day:"numeric"}),yr=class extends ne{constructor(){super(...arguments),this.refineRenderProps=Ic(GB)}render(){let{props:e,context:t}=this,{options:n}=t,s=this.refineRenderProps({date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,isMonthStart:e.isMonthStart||!1,showDayNumber:e.showDayNumber,extraRenderProps:e.extraRenderProps,viewApi:t.viewApi,dateEnv:t.dateEnv,monthStartFormat:n.monthStartFormat});return x(xe,{elRef:e.elRef,elTag:e.elTag,elAttrs:Object.assign(Object.assign({},e.elAttrs),s.isDisabled?{}:{"data-date":br(e.date)}),elClasses:[...Nc(s,t.theme),...e.elClasses||[]],elStyle:e.elStyle,renderProps:s,generatorName:"dayCellContent",customGenerator:n.dayCellContent,defaultGenerator:e.defaultGenerator,classNameGenerator:s.isDisabled?void 0:n.dayCellClassNames,didMount:n.dayCellDidMount,willUnmount:n.dayCellWillUnmount},e.children)}};function Lc(i){return!!(i.dayCellContent||xA("dayCellContent",i))}function GB(i){let{date:e,dateEnv:t,dateProfile:n,isMonthStart:s}=i,r=Cf(e,i.todayRange,null,n),o=i.showDayNumber?t.format(e,s?i.monthStartFormat:BB):"";return Object.assign(Object.assign(Object.assign({date:t.toDate(e),view:i.viewApi},r),{isMonthStart:s,dayNumberText:o}),i.extraRenderProps)}var fa=class extends ne{render(){let{props:e}=this,{seg:t}=e;return x(ms,{elTag:"div",elClasses:["fc-bg-event"],elStyle:{backgroundColor:t.eventRange.ui.backgroundColor},defaultGenerator:VB,seg:t,timeText:"",isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:e.isPast,isFuture:e.isFuture,isToday:e.isToday,disableDragging:!0,disableResizing:!0})}};function VB(i){let{title:e}=i.event;return e&&x("div",{className:"fc-event-title"},i.event.title)}function Df(i){return x("div",{className:`fc-${i}`})}var Pf=i=>x(wn.Consumer,null,e=>{let{dateEnv:t,options:n}=e,{date:s}=i,r=n.weekNumberFormat||i.defaultFormat,o=t.computeWeekNumber(s),a=t.format(s,r),l={num:o,text:a,date:s};return x(xe,{elRef:i.elRef,elTag:i.elTag,elAttrs:i.elAttrs,elClasses:i.elClasses,elStyle:i.elStyle,renderProps:l,generatorName:"weekNumberContent",customGenerator:n.weekNumberContent,defaultGenerator:$B,classNameGenerator:n.weekNumberClassNames,didMount:n.weekNumberDidMount,willUnmount:n.weekNumberWillUnmount},i.children)});function $B(i){return i.text}var EA=10,IA=class extends ne{constructor(){super(...arguments),this.state={titleId:En()},this.handleRootEl=e=>{this.rootEl=e,this.props.elRef&&rn(this.props.elRef,e)},this.handleDocumentMouseDown=e=>{let t=Iv(e);this.rootEl.contains(t)||this.handleCloseClick()},this.handleDocumentKeyDown=e=>{e.key==="Escape"&&this.handleCloseClick()},this.handleCloseClick=()=>{let{onClose:e}=this.props;e&&e()}}render(){let{theme:e,options:t}=this.context,{props:n,state:s}=this,r=["fc-popover",e.getClass("popover")].concat(n.extraClassNames||[]);return GI(x("div",Object.assign({},n.extraAttrs,{id:n.id,className:r.join(" "),"aria-labelledby":s.titleId,ref:this.handleRootEl}),x("div",{className:"fc-popover-header "+e.getClass("popoverHeader")},x("span",{className:"fc-popover-title",id:s.titleId},n.title),x("span",{className:"fc-popover-close "+e.getIconClass("close"),title:t.closeHint,onClick:this.handleCloseClick})),x("div",{className:"fc-popover-body "+e.getClass("popoverContent")},n.children)),n.parentEl)}componentDidMount(){document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("keydown",this.handleDocumentKeyDown),this.updateSize()}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("keydown",this.handleDocumentKeyDown)}updateSize(){let{isRtl:e}=this.context,{alignmentEl:t,alignGridTop:n}=this.props,{rootEl:s}=this,r=DB(t);if(r){let o=s.getBoundingClientRect(),a=n?Ge(t,".fc-scrollgrid").getBoundingClientRect().top:r.top,l=e?r.right-o.width:r.left;a=Math.max(a,EA),l=Math.min(l,document.documentElement.clientWidth-EA-o.width),l=Math.max(l,EA);let c=s.offsetParent.getBoundingClientRect();ga(s,{top:a-c.top,left:l-c.left})}}},DA=class extends rt{constructor(){super(...arguments),this.handleRootEl=e=>{this.rootEl=e,e?this.context.registerInteractiveComponent(this,{el:e,useEventCenter:!1}):this.context.unregisterInteractiveComponent(this)}}render(){let{options:e,dateEnv:t}=this.context,{props:n}=this,{startDate:s,todayRange:r,dateProfile:o}=n,a=t.format(s,e.dayPopoverFormat);return x(yr,{elRef:this.handleRootEl,date:s,dateProfile:o,todayRange:r},(l,c,d)=>x(IA,{elRef:d.ref,id:n.id,title:a,extraClassNames:["fc-more-popover"].concat(d.className||[]),extraAttrs:d,parentEl:n.parentEl,alignmentEl:n.alignmentEl,alignGridTop:n.alignGridTop,onClose:n.onClose},Lc(e)&&x(l,{elTag:"div",elClasses:["fc-more-popover-misc"]}),n.children))}queryHit(e,t,n,s){let{rootEl:r,props:o}=this;return e>=0&&e<n&&t>=0&&t<s?{dateProfile:o.dateProfile,dateSpan:Object.assign({allDay:!o.forceTimed,range:{start:o.startDate,end:o.endDate}},o.extraDateSpan),dayEl:r,rect:{left:0,top:0,right:n,bottom:s},layer:1}:null}},pa=class extends ne{constructor(){super(...arguments),this.state={isPopoverOpen:!1,popoverId:En()},this.handleLinkEl=e=>{this.linkEl=e,this.props.elRef&&rn(this.props.elRef,e)},this.handleClick=e=>{let{props:t,context:n}=this,{moreLinkClick:s}=n.options,r=eD(t).start;function o(a){let{def:l,instance:c,range:d}=a.eventRange;return{event:new me(n,l,c),start:n.dateEnv.toDate(d.start),end:n.dateEnv.toDate(d.end),isStart:a.isStart,isEnd:a.isEnd}}typeof s=="function"&&(s=s({date:r,allDay:!!t.allDayDate,allSegs:t.allSegs.map(o),hiddenSegs:t.hiddenSegs.map(o),jsEvent:e,view:n.viewApi})),!s||s==="popover"?this.setState({isPopoverOpen:!0}):typeof s=="string"&&n.calendarApi.zoomTo(r,s)},this.handlePopoverClose=()=>{this.setState({isPopoverOpen:!1})}}render(){let{props:e,state:t}=this;return x(wn.Consumer,null,n=>{let{viewApi:s,options:r,calendarApi:o}=n,{moreLinkText:a}=r,{moreCnt:l}=e,c=eD(e),d=typeof a=="function"?a.call(o,l):`+${l} ${a}`,h=Rc(r.moreLinkHint,[l],d),p={num:l,shortText:`+${l}`,text:d,view:s};return x(ae,null,!!e.moreCnt&&x(xe,{elTag:e.elTag||"a",elRef:this.handleLinkEl,elClasses:[...e.elClasses||[],"fc-more-link"],elStyle:e.elStyle,elAttrs:Object.assign(Object.assign(Object.assign({},e.elAttrs),aD(this.handleClick)),{title:h,"aria-expanded":t.isPopoverOpen,"aria-controls":t.isPopoverOpen?t.popoverId:""}),renderProps:p,generatorName:"moreLinkContent",customGenerator:r.moreLinkContent,defaultGenerator:e.defaultGenerator||zB,classNameGenerator:r.moreLinkClassNames,didMount:r.moreLinkDidMount,willUnmount:r.moreLinkWillUnmount},e.children),t.isPopoverOpen&&x(DA,{id:t.popoverId,startDate:c.start,endDate:c.end,dateProfile:e.dateProfile,todayRange:e.todayRange,extraDateSpan:e.extraDateSpan,parentEl:this.parentEl,alignmentEl:e.alignmentElRef?e.alignmentElRef.current:this.linkEl,alignGridTop:e.alignGridTop,forceTimed:e.forceTimed,onClose:this.handlePopoverClose},e.popoverContent()))})}componentDidMount(){this.updateParentEl()}componentDidUpdate(){this.updateParentEl()}updateParentEl(){this.linkEl&&(this.parentEl=Ge(this.linkEl,".fc-view-harness"))}};function zB(i){return i.text}function eD(i){if(i.allDayDate)return{start:i.allDayDate,end:Ee(i.allDayDate,1)};let{hiddenSegs:e}=i;return{start:qv(e),end:WB(e)}}function qv(i){return i.reduce(qB).eventRange.range.start}function qB(i,e){return i.eventRange.range.start<e.eventRange.range.start?i:e}function WB(i){return i.reduce(YB).eventRange.range.end}function YB(i,e){return i.eventRange.range.end>e.eventRange.range.end?i:e}var KB=[],iP={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},sP=Object.assign(Object.assign({},iP),{buttonHints:{prev:"Previous $0",next:"Next $0",today(i,e){return e==="day"?"Today":`This ${i}`}},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint(i){return`Show ${i} more event${i===1?"":"s"}`}});function JB(i){let e=i.length>0?i[0].code:"en",t=KB.concat(i),n={en:sP};for(let s of t)n[s.code]=s;return{map:n,defaultCode:e}}function rP(i,e){return typeof i=="object"&&!Array.isArray(i)?oP(i.code,[i.code],i):XB(i,e)}function XB(i,e){let t=[].concat(i||[]),n=ZB(t,e)||sP;return oP(i,t,n)}function ZB(i,e){for(let t=0;t<i.length;t+=1){let n=i[t].toLocaleLowerCase().split("-");for(let s=n.length;s>0;s-=1){let r=n.slice(0,s).join("-");if(e[r])return e[r]}}return null}function oP(i,e,t){let n=Nv([iP,t],["buttonText"]);delete n.code;let{week:s}=n;return delete n.week,{codeArg:i,codes:e,week:s,simpleNumberFormat:new Intl.NumberFormat(i),options:n}}function Ht(i){return{id:ys(),name:i.name,premiumReleaseDate:i.premiumReleaseDate?new Date(i.premiumReleaseDate):void 0,deps:i.deps||[],reducers:i.reducers||[],isLoadingFuncs:i.isLoadingFuncs||[],contextInit:[].concat(i.contextInit||[]),eventRefiners:i.eventRefiners||{},eventDefMemberAdders:i.eventDefMemberAdders||[],eventSourceRefiners:i.eventSourceRefiners||{},isDraggableTransformers:i.isDraggableTransformers||[],eventDragMutationMassagers:i.eventDragMutationMassagers||[],eventDefMutationAppliers:i.eventDefMutationAppliers||[],dateSelectionTransformers:i.dateSelectionTransformers||[],datePointTransforms:i.datePointTransforms||[],dateSpanTransforms:i.dateSpanTransforms||[],views:i.views||{},viewPropsTransformers:i.viewPropsTransformers||[],isPropsValid:i.isPropsValid||null,externalDefTransforms:i.externalDefTransforms||[],viewContainerAppends:i.viewContainerAppends||[],eventDropTransformers:i.eventDropTransformers||[],componentInteractions:i.componentInteractions||[],calendarInteractions:i.calendarInteractions||[],themeClasses:i.themeClasses||{},eventSourceDefs:i.eventSourceDefs||[],cmdFormatter:i.cmdFormatter,recurringTypes:i.recurringTypes||[],namedTimeZonedImpl:i.namedTimeZonedImpl,initialView:i.initialView||"",elementDraggingImpl:i.elementDraggingImpl,optionChangeHandlers:i.optionChangeHandlers||{},scrollGridImpl:i.scrollGridImpl||null,listenerRefiners:i.listenerRefiners||{},optionRefiners:i.optionRefiners||{},propSetHandlers:i.propSetHandlers||{}}}function jB(i,e){let t={},n={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function s(r){for(let o of r){let a=o.name,l=t[a];l===void 0?(t[a]=o.id,s(o.deps),n=eG(n,o)):l!==o.id&&console.warn(`Duplicate plugin '${a}'`)}}return i&&s(i),s(e),n}function QB(){let i=[],e=[],t;return(n,s)=>((!t||!Ai(n,i)||!Ai(s,e))&&(t=jB(n,s)),i=n,e=s,t)}function eG(i,e){return{premiumReleaseDate:tG(i.premiumReleaseDate,e.premiumReleaseDate),reducers:i.reducers.concat(e.reducers),isLoadingFuncs:i.isLoadingFuncs.concat(e.isLoadingFuncs),contextInit:i.contextInit.concat(e.contextInit),eventRefiners:Object.assign(Object.assign({},i.eventRefiners),e.eventRefiners),eventDefMemberAdders:i.eventDefMemberAdders.concat(e.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},i.eventSourceRefiners),e.eventSourceRefiners),isDraggableTransformers:i.isDraggableTransformers.concat(e.isDraggableTransformers),eventDragMutationMassagers:i.eventDragMutationMassagers.concat(e.eventDragMutationMassagers),eventDefMutationAppliers:i.eventDefMutationAppliers.concat(e.eventDefMutationAppliers),dateSelectionTransformers:i.dateSelectionTransformers.concat(e.dateSelectionTransformers),datePointTransforms:i.datePointTransforms.concat(e.datePointTransforms),dateSpanTransforms:i.dateSpanTransforms.concat(e.dateSpanTransforms),views:Object.assign(Object.assign({},i.views),e.views),viewPropsTransformers:i.viewPropsTransformers.concat(e.viewPropsTransformers),isPropsValid:e.isPropsValid||i.isPropsValid,externalDefTransforms:i.externalDefTransforms.concat(e.externalDefTransforms),viewContainerAppends:i.viewContainerAppends.concat(e.viewContainerAppends),eventDropTransformers:i.eventDropTransformers.concat(e.eventDropTransformers),calendarInteractions:i.calendarInteractions.concat(e.calendarInteractions),componentInteractions:i.componentInteractions.concat(e.componentInteractions),themeClasses:Object.assign(Object.assign({},i.themeClasses),e.themeClasses),eventSourceDefs:i.eventSourceDefs.concat(e.eventSourceDefs),cmdFormatter:e.cmdFormatter||i.cmdFormatter,recurringTypes:i.recurringTypes.concat(e.recurringTypes),namedTimeZonedImpl:e.namedTimeZonedImpl||i.namedTimeZonedImpl,initialView:i.initialView||e.initialView,elementDraggingImpl:i.elementDraggingImpl||e.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},i.optionChangeHandlers),e.optionChangeHandlers),scrollGridImpl:e.scrollGridImpl||i.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},i.listenerRefiners),e.listenerRefiners),optionRefiners:Object.assign(Object.assign({},i.optionRefiners),e.optionRefiners),propSetHandlers:Object.assign(Object.assign({},i.propSetHandlers),e.propSetHandlers)}}function tG(i,e){return i===void 0?e:e===void 0?i:new Date(Math.max(i.valueOf(),e.valueOf()))}var xi=class extends ps{};xi.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"};xi.prototype.baseIconClass="fc-icon";xi.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"};xi.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"};xi.prototype.iconOverrideOption="buttonIcons";xi.prototype.iconOverrideCustomButtonOption="icon";xi.prototype.iconOverridePrefix="fc-icon-";function nG(i,e){let t={},n;for(n in i)SC(n,t,i,e);for(n in e)SC(n,t,i,e);return t}function SC(i,e,t,n){if(e[i])return e[i];let s=iG(i,e,t,n);return s&&(e[i]=s),s}function iG(i,e,t,n){let s=t[i],r=n[i],o=d=>s&&s[d]!==null?s[d]:r&&r[d]!==null?r[d]:null,a=o("component"),l=o("superType"),c=null;if(l){if(l===i)throw new Error("Can't have a custom view type that references itself");c=SC(l,e,t,n)}return!a&&c&&(a=c.component),a?{type:i,component:a,defaults:Object.assign(Object.assign({},c?c.defaults:{}),s?s.rawOptions:{}),overrides:Object.assign(Object.assign({},c?c.overrides:{}),r?r.rawOptions:{})}:null}function ZD(i){return bn(i,sG)}function sG(i){let e=typeof i=="function"?{component:i}:i,{component:t}=e;return e.content?t=jD(e):t&&!(t.prototype instanceof ne)&&(t=jD(Object.assign(Object.assign({},e),{content:t}))),{superType:e.type,component:t,rawOptions:e}}function jD(i){return e=>x(wn.Consumer,null,t=>x(xe,{elTag:"div",elClasses:jA(t.viewSpec),renderProps:Object.assign(Object.assign({},e),{nextDayThreshold:t.options.nextDayThreshold}),generatorName:void 0,customGenerator:i.content,classNameGenerator:i.classNames,didMount:i.didMount,willUnmount:i.willUnmount}))}function rG(i,e,t,n){let s=ZD(i),r=ZD(e.views),o=nG(s,r);return bn(o,a=>oG(a,r,e,t,n))}function oG(i,e,t,n,s){let r=i.overrides.duration||i.defaults.duration||n.duration||t.duration,o=null,a="",l="",c={};if(r&&(o=aG(r),o)){let p=Zh(o);a=p.unit,p.value===1&&(l=a,c=e[a]?e[a].rawOptions:{})}let d=p=>{let m=p.buttonText||{},y=i.defaults.buttonTextKey;return y!=null&&m[y]!=null?m[y]:m[i.type]!=null?m[i.type]:m[l]!=null?m[l]:null},h=p=>{let m=p.buttonHints||{},y=i.defaults.buttonTextKey;return y!=null&&m[y]!=null?m[y]:m[i.type]!=null?m[i.type]:m[l]!=null?m[l]:null};return{type:i.type,component:i.component,duration:o,durationUnit:a,singleUnit:l,optionDefaults:i.defaults,optionOverrides:Object.assign(Object.assign({},c),i.overrides),buttonTextOverride:d(n)||d(t)||i.overrides.buttonText,buttonTextDefault:d(s)||i.defaults.buttonText||d(Er)||i.type,buttonTitleOverride:h(n)||h(t)||i.overrides.buttonHint,buttonTitleDefault:h(s)||i.defaults.buttonHint||h(Er)}}var QD={};function aG(i){let e=JSON.stringify(i),t=QD[e];return t===void 0&&(t=te(i),QD[e]=t),t}function lG(i,e){switch(e.type){case"CHANGE_VIEW_TYPE":i=e.viewType}return i}function cG(i,e){switch(e.type){case"CHANGE_DATE":return e.dateMarker;default:return i}}function dG(i,e,t){let n=i.initialDate;return n!=null?e.createMarker(n):t.getDateMarker()}function uG(i,e){switch(e.type){case"SET_OPTION":return Object.assign(Object.assign({},i),{[e.optionName]:e.rawOptionValue});default:return i}}function hG(i,e,t,n){let s;switch(e.type){case"CHANGE_VIEW_TYPE":return n.build(e.dateMarker||t);case"CHANGE_DATE":return n.build(e.dateMarker);case"PREV":if(s=n.buildPrev(i,t),s.isValid)return s;break;case"NEXT":if(s=n.buildNext(i,t),s.isValid)return s;break}return i}function fG(i,e,t){let n=e?e.activeRange:null;return lP({},EG(i,t),n,t)}function pG(i,e,t,n){let s=t?t.activeRange:null;switch(e.type){case"ADD_EVENT_SOURCES":return lP(i,e.sources,s,n);case"REMOVE_EVENT_SOURCE":return mG(i,e.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return t?cP(i,s,n):i;case"FETCH_EVENT_SOURCES":return PC(i,e.sourceIds?JA(e.sourceIds):dP(i,n),s,e.isRefetch||!1,n);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return bG(i,e.sourceId,e.fetchId,e.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return i}}function gG(i,e,t){let n=e?e.activeRange:null;return PC(i,dP(i,t),n,!0,t)}function aP(i){for(let e in i)if(i[e].isFetching)return!0;return!1}function lP(i,e,t,n){let s={};for(let r of e)s[r.sourceId]=r;return t&&(s=cP(s,t,n)),Object.assign(Object.assign({},i),s)}function mG(i,e){return fs(i,t=>t.sourceId!==e)}function cP(i,e,t){return PC(i,fs(i,n=>yG(n,e,t)),e,!1,t)}function yG(i,e,t){return uP(i,t)?!t.options.lazyFetching||!i.fetchRange||i.isFetching||e.start<i.fetchRange.start||e.end>i.fetchRange.end:!i.latestFetchId}function PC(i,e,t,n,s){let r={};for(let o in i){let a=i[o];e[o]?r[o]=vG(a,t,n,s):r[o]=a}return r}function vG(i,e,t,n){let{options:s,calendarApi:r}=n,o=n.pluginHooks.eventSourceDefs[i.sourceDefId],a=ys();return o.fetch({eventSource:i,range:e,isRefetch:t,context:n},l=>{let{rawEvents:c}=l;s.eventSourceSuccess&&(c=s.eventSourceSuccess.call(r,c,l.response)||c),i.success&&(c=i.success.call(r,c,l.response)||c),n.dispatch({type:"RECEIVE_EVENTS",sourceId:i.sourceId,fetchId:a,fetchRange:e,rawEvents:c})},l=>{let c=!1;s.eventSourceFailure&&(s.eventSourceFailure.call(r,l),c=!0),i.failure&&(i.failure(l),c=!0),c||console.warn(l.message,l),n.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:i.sourceId,fetchId:a,fetchRange:e,error:l})}),Object.assign(Object.assign({},i),{isFetching:!0,latestFetchId:a})}function bG(i,e,t,n){let s=i[e];return s&&t===s.latestFetchId?Object.assign(Object.assign({},i),{[e]:Object.assign(Object.assign({},s),{isFetching:!1,fetchRange:n})}):i}function dP(i,e){return fs(i,t=>uP(t,e))}function EG(i,e){let t=iC(e),n=[].concat(i.eventSources||[]),s=[];i.initialEvents&&n.unshift(i.initialEvents),i.events&&n.unshift(i.events);for(let r of n){let o=nC(r,e,t);o&&s.push(o)}return s}function uP(i,e){return!e.pluginHooks.eventSourceDefs[i.sourceDefId].ignoreRange}function wG(i,e){switch(e.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return e.selection;default:return i}}function SG(i,e){switch(e.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return e.eventInstanceId;default:return i}}function AG(i,e){let t;switch(e.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return i}}function CG(i,e){let t;switch(e.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return i}}function _G(i,e,t,n,s){let r=i.headerToolbar?eP(i.headerToolbar,i,e,t,n,s):null,o=i.footerToolbar?eP(i.footerToolbar,i,e,t,n,s):null;return{header:r,footer:o}}function eP(i,e,t,n,s,r){let o={},a=[],l=!1;for(let c in i){let d=i[c],h=TG(d,e,t,n,s,r);o[c]=h.widgets,a.push(...h.viewsWithButtons),l=l||h.hasTitle}return{sectionWidgets:o,viewsWithButtons:a,hasTitle:l}}function TG(i,e,t,n,s,r){let o=e.direction==="rtl",a=e.customButtons||{},l=t.buttonText||{},c=e.buttonText||{},d=t.buttonHints||{},h=e.buttonHints||{},p=i?i.split(" "):[],m=[],y=!1;return{widgets:p.map(E=>E.split(",").map(S=>{if(S==="title")return y=!0,{buttonName:S};let C,_,T,R,I,D;if(C=a[S])T=k=>{C.click&&C.click.call(k.target,k,k.target)},(R=n.getCustomButtonIconClass(C))||(R=n.getIconClass(S,o))||(I=C.text),D=C.hint||C.text;else if(_=s[S]){m.push(S),T=()=>{r.changeView(S)},(I=_.buttonTextOverride)||(R=n.getIconClass(S,o))||(I=_.buttonTextDefault);let k=_.buttonTextOverride||_.buttonTextDefault;D=Rc(_.buttonTitleOverride||_.buttonTitleDefault||e.viewHint,[k,S],k)}else if(r[S])if(T=()=>{r[S]()},(I=l[S])||(R=n.getIconClass(S,o))||(I=c[S]),S==="prevYear"||S==="nextYear"){let k=S==="prevYear"?"prev":"next";D=Rc(d[k]||h[k],[c.year||"year","year"],c[S])}else D=k=>Rc(d[S]||h[S],[c[k]||k,k],c[S]);return{buttonName:S,buttonClick:T,buttonIcon:R,buttonText:I,buttonHint:D}})),viewsWithButtons:m,hasTitle:y}}var AC=class{constructor(e,t,n){this.type=e,this.getCurrentData=t,this.dateEnv=n}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(e){return this.getCurrentData().options[e]}},xG={ignoreRange:!0,parseMeta(i){return Array.isArray(i.events)?i.events:null},fetch(i,e){e({rawEvents:i.eventSource.meta})}},RG=Ht({name:"array-event-source",eventSourceDefs:[xG]}),IG={parseMeta(i){return typeof i.events=="function"?i.events:null},fetch(i,e,t){let{dateEnv:n}=i.context,s=i.eventSource.meta;dC(s.bind(null,cC(i.range,n)),r=>e({rawEvents:r}),t)}},DG=Ht({name:"func-event-source",eventSourceDefs:[IG]}),PG={method:String,extraParams:P,startParam:String,endParam:String,timeZoneParam:String},MG={parseMeta(i){return i.url&&(i.format==="json"||!i.format)?{url:i.url,format:"json",method:(i.method||"GET").toUpperCase(),extraParams:i.extraParams,startParam:i.startParam,endParam:i.endParam,timeZoneParam:i.timeZoneParam}:null},fetch(i,e,t){let{meta:n}=i.eventSource,s=NG(n,i.range,i.context);uC(n.method,n.url,s).then(([r,o])=>{e({rawEvents:r,response:o})},t)}},kG=Ht({name:"json-event-source",eventSourceRefiners:PG,eventSourceDefs:[MG]});function NG(i,e,t){let{dateEnv:n,options:s}=t,r,o,a,l,c={};return r=i.startParam,r==null&&(r=s.startParam),o=i.endParam,o==null&&(o=s.endParam),a=i.timeZoneParam,a==null&&(a=s.timeZoneParam),typeof i.extraParams=="function"?l=i.extraParams():l=i.extraParams||{},Object.assign(c,l),c[r]=n.formatIso(e.start),c[o]=n.formatIso(e.end),n.timeZone!=="local"&&(c[a]=n.timeZone),c}var FG={daysOfWeek:P,startTime:te,endTime:te,duration:te,startRecur:P,endRecur:P},LG={parse(i,e){if(i.daysOfWeek||i.startTime||i.endTime||i.startRecur||i.endRecur){let t={daysOfWeek:i.daysOfWeek||null,startTime:i.startTime||null,endTime:i.endTime||null,startRecur:i.startRecur?e.createMarker(i.startRecur):null,endRecur:i.endRecur?e.createMarker(i.endRecur):null,dateEnv:e},n;return i.duration&&(n=i.duration),!n&&i.startTime&&i.endTime&&(n=hD(i.endTime,i.startTime)),{allDayGuess:!i.startTime&&!i.endTime,duration:n,typeData:t}}return null},expand(i,e,t){let n=sn(e,{start:i.startRecur,end:i.endRecur});return n?UG(i.daysOfWeek,i.startTime,i.dateEnv,t,n):[]}},OG=Ht({name:"simple-recurring-event",recurringTypes:[LG],eventRefiners:FG});function UG(i,e,t,n,s){let r=i?JA(i):null,o=de(s.start),a=s.end,l=[];for(e&&(e.milliseconds<0?a=Ee(a,1):e.milliseconds>=1e3*60*60*24&&(o=Ee(o,-1)));o<a;){let c;(!r||r[o.getUTCDay()])&&(e?c=n.add(o,e):c=o,l.push(n.createMarker(t.toDate(c)))),o=Ee(o,1)}return l}var HG=Ht({name:"change-handler",optionChangeHandlers:{events(i,e){tP([i],e)},eventSources:tP}});function tP(i,e){let t=Fv(e.getCurrentData().eventSources);if(t.length===1&&i.length===1&&Array.isArray(t[0]._raw)&&Array.isArray(i[0])){e.dispatch({type:"RESET_RAW_EVENTS",sourceId:t[0].sourceId,rawEvents:i[0]});return}let n=[];for(let s of i){let r=!1;for(let o=0;o<t.length;o+=1)if(t[o]._raw===s){t.splice(o,1),r=!0;break}r||n.push(s)}for(let s of t)e.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:s.sourceId});for(let s of n)e.calendarApi.addEventSource(s)}function BG(i,e){e.emitter.trigger("datesSet",Object.assign(Object.assign({},cC(i.activeRange,e.dateEnv)),{view:e.viewApi}))}function GG(i,e){let{emitter:t}=e;t.hasHandlers("eventsSet")&&t.trigger("eventsSet",_i(i,e))}var VG=[RG,DG,kG,OG,HG,Ht({name:"misc",isLoadingFuncs:[i=>aP(i.eventSources)],propSetHandlers:{dateProfile:BG,eventStore:GG}})],CC=class{constructor(e,t){this.runTaskOption=e,this.drainedOption=t,this.queue=[],this.delayedRunner=new sa(this.drain.bind(this))}request(e,t){this.queue.push(e),this.delayedRunner.request(t)}pause(e){this.delayedRunner.pause(e)}resume(e,t){this.delayedRunner.resume(e,t)}drain(){let{queue:e}=this;for(;e.length;){let t=[],n;for(;n=e.shift();)this.runTask(n),t.push(n);this.drained(t)}}runTask(e){this.runTaskOption&&this.runTaskOption(e)}drained(e){this.drainedOption&&this.drainedOption(e)}};function $G(i,e,t){let n;return/^(year|month)$/.test(i.currentRangeUnit)?n=i.currentRange:n=i.activeRange,t.formatRange(n.start,n.end,ue(e.titleFormat||zG(i)),{isEndExclusive:i.isRangeAllDay,defaultSeparator:e.titleRangeSeparator})}function zG(i){let{currentRangeUnit:e}=i;if(e==="year")return{year:"numeric"};if(e==="month")return{year:"numeric",month:"long"};let t=_c(i.currentRange.start,i.currentRange.end);return t!==null&&t>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}var Wv=class{constructor(){this.resetListeners=new Set}handleInput(e,t){let n=this.dateEnv;if(e!==n&&(typeof t=="function"?this.nowFn=t:n||(this.nowAnchorDate=e.toDate(t?e.createMarker(t):e.createNowMarker()),this.nowAnchorQueried=Date.now()),this.dateEnv=e,n))for(let s of this.resetListeners.values())s()}getDateMarker(){return this.nowAnchorDate?this.dateEnv.timestampToMarker(this.nowAnchorDate.valueOf()+(Date.now()-this.nowAnchorQueried)):this.dateEnv.createMarker(this.nowFn())}addResetListener(e){this.resetListeners.add(e)}removeResetListener(e){this.resetListeners.delete(e)}},_C=class{constructor(e){this.computeCurrentViewData=$(this._computeCurrentViewData),this.organizeRawLocales=$(JB),this.buildLocale=$(rP),this.buildPluginHooks=QB(),this.buildDateEnv=$(qG),this.buildTheme=$(WG),this.parseToolbars=$(_G),this.buildViewSpecs=$(rG),this.buildDateProfileGenerator=Ic(YG),this.buildViewApi=$(KG),this.buildViewUiProps=Ic(ZG),this.buildEventUiBySource=$(JG,Lt),this.buildEventUiBases=$(XG),this.parseContextBusinessHours=Ic(jG),this.buildTitle=$($G),this.nowManager=new Wv,this.emitter=new gs,this.actionRunner=new CC(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=p=>{this.actionRunner.request(p)},this.props=e,this.actionRunner.pause(),this.nowManager=new Wv;let t={},n=this.computeOptionsData(e.optionOverrides,t,e.calendarApi),s=n.calendarOptions.initialView||n.pluginHooks.initialView,r=this.computeCurrentViewData(s,n,e.optionOverrides,t);e.calendarApi.currentDataManager=this,this.emitter.setThisContext(e.calendarApi),this.emitter.setOptions(r.options);let o={nowManager:this.nowManager,dateEnv:n.dateEnv,options:n.calendarOptions,pluginHooks:n.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},a=dG(n.calendarOptions,n.dateEnv,this.nowManager),l=r.dateProfileGenerator.build(a);vn(l.activeRange,a)||(a=l.currentRange.start);for(let p of n.pluginHooks.contextInit)p(o);let c=fG(n.calendarOptions,l,o),d={dynamicOptionOverrides:t,currentViewType:s,currentDate:a,dateProfile:l,businessHours:this.parseContextBusinessHours(o),eventSources:c,eventUiBases:{},eventStore:yt(),renderableEventStore:yt(),dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(o).selectionConfig},h=Object.assign(Object.assign({},o),d);for(let p of n.pluginHooks.reducers)Object.assign(d,p(null,null,h));wC(d,o)&&this.emitter.trigger("loading",!0),this.state=d,this.updateData(),this.actionRunner.resume()}resetOptions(e,t){let{props:n}=this;t===void 0?n.optionOverrides=e:(n.optionOverrides=Object.assign(Object.assign({},n.optionOverrides||{}),e),this.optionsForRefining.push(...t)),(t===void 0||t.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(e){let{props:t,state:n,emitter:s}=this,r=uG(n.dynamicOptionOverrides,e),o=this.computeOptionsData(t.optionOverrides,r,t.calendarApi),a=lG(n.currentViewType,e),l=this.computeCurrentViewData(a,o,t.optionOverrides,r);t.calendarApi.currentDataManager=this,s.setThisContext(t.calendarApi),s.setOptions(l.options);let c={nowManager:this.nowManager,dateEnv:o.dateEnv,options:o.calendarOptions,pluginHooks:o.pluginHooks,calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:s,getCurrentData:this.getCurrentData},{currentDate:d,dateProfile:h}=n;this.data&&this.data.dateProfileGenerator!==l.dateProfileGenerator&&(h=l.dateProfileGenerator.build(d)),d=cG(d,e),h=hG(h,e,d,l.dateProfileGenerator),(e.type==="PREV"||e.type==="NEXT"||!vn(h.currentRange,d))&&(d=h.currentRange.start);let p=pG(n.eventSources,e,h,c),m=_D(n.eventStore,e,p,h,c),v=aP(p)&&!l.options.progressiveEventRendering&&n.renderableEventStore||m,{eventUiSingleBase:E,selectionConfig:S}=this.buildViewUiProps(c),C=this.buildEventUiBySource(p),_=this.buildEventUiBases(v.defs,E,C),T={dynamicOptionOverrides:r,currentViewType:a,currentDate:d,dateProfile:h,eventSources:p,eventStore:m,renderableEventStore:v,selectionConfig:S,eventUiBases:_,businessHours:this.parseContextBusinessHours(c),dateSelection:wG(n.dateSelection,e),eventSelection:SG(n.eventSelection,e),eventDrag:AG(n.eventDrag,e),eventResize:CG(n.eventResize,e)},R=Object.assign(Object.assign({},c),T);for(let k of o.pluginHooks.reducers)Object.assign(T,k(n,e,R));let I=wC(n,c),D=wC(T,c);!I&&D?s.trigger("loading",!0):I&&!D&&s.trigger("loading",!1),this.state=T,t.onAction&&t.onAction(e)}updateData(){let{props:e,state:t}=this,n=this.data,s=this.computeOptionsData(e.optionOverrides,t.dynamicOptionOverrides,e.calendarApi),r=this.computeCurrentViewData(t.currentViewType,s,e.optionOverrides,t.dynamicOptionOverrides),o=this.data=Object.assign(Object.assign(Object.assign({nowManager:this.nowManager,viewTitle:this.buildTitle(t.dateProfile,r.options,s.dateEnv),calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},s),r),t),a=s.pluginHooks.optionChangeHandlers,l=n&&n.calendarOptions,c=s.calendarOptions;if(l&&l!==c){l.timeZone!==c.timeZone&&(t.eventSources=o.eventSources=gG(o.eventSources,t.dateProfile,o),t.eventStore=o.eventStore=sC(o.eventStore,n.dateEnv,o.dateEnv),t.renderableEventStore=o.renderableEventStore=sC(o.renderableEventStore,n.dateEnv,o.dateEnv));for(let d in a)(this.optionsForHandling.indexOf(d)!==-1||l[d]!==c[d])&&a[d](c[d],o)}this.optionsForHandling=[],e.onData&&e.onData(o)}computeOptionsData(e,t,n){if(!this.optionsForRefining.length&&e===this.stableOptionOverrides&&t===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:s,pluginHooks:r,localeDefaults:o,availableLocaleData:a,extra:l}=this.processRawCalendarOptions(e,t);nP(l);let c=this.buildDateEnv(s.timeZone,s.locale,s.weekNumberCalculation,s.firstDay,s.weekText,r,a,s.defaultRangeSeparator),d=this.buildViewSpecs(r.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,o),h=this.buildTheme(s,r),p=this.parseToolbars(s,this.stableOptionOverrides,h,d,n);return this.stableCalendarOptionsData={calendarOptions:s,pluginHooks:r,dateEnv:c,viewSpecs:d,theme:h,toolbarConfig:p,localeDefaults:o,availableRawLocales:a.map}}processRawCalendarOptions(e,t){let{locales:n,locale:s}=Mv([Er,e,t]),r=this.organizeRawLocales(n),o=r.map,a=this.buildLocale(s||r.defaultCode,o).options,l=this.buildPluginHooks(e.plugins||[],VG),c=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},WA),YA),KA),l.listenerRefiners),l.optionRefiners),d={},h=Mv([Er,a,e,t]),p={},m=this.currentCalendarOptionsInput,y=this.currentCalendarOptionsRefined,v=!1;for(let E in h)this.optionsForRefining.indexOf(E)===-1&&(h[E]===m[E]||wr[E]&&E in m&&wr[E](m[E],h[E]))?p[E]=y[E]:c[E]?(p[E]=c[E](h[E]),v=!0):d[E]=m[E];return v&&(this.currentCalendarOptionsInput=h,this.currentCalendarOptionsRefined=p,this.stableOptionOverrides=e,this.stableDynamicOptionOverrides=t),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:l,availableLocaleData:r,localeDefaults:a,extra:d}}_computeCurrentViewData(e,t,n,s){let r=t.viewSpecs[e];if(!r)throw new Error(`viewType "${e}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:o,extra:a}=this.processRawViewOptions(r,t.pluginHooks,t.localeDefaults,n,s);nP(a),this.nowManager.handleInput(t.dateEnv,o.now);let l=this.buildDateProfileGenerator({dateProfileGeneratorClass:r.optionDefaults.dateProfileGeneratorClass,nowManager:this.nowManager,duration:r.duration,durationUnit:r.durationUnit,usesMinMaxTime:r.optionDefaults.usesMinMaxTime,dateEnv:t.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:o.slotMinTime,slotMaxTime:o.slotMaxTime,showNonCurrentDates:o.showNonCurrentDates,dayCount:o.dayCount,dateAlignment:o.dateAlignment,dateIncrement:o.dateIncrement,hiddenDays:o.hiddenDays,weekends:o.weekends,validRangeInput:o.validRange,visibleRangeInput:o.visibleRange,fixedWeekCount:o.fixedWeekCount}),c=this.buildViewApi(e,this.getCurrentData,t.dateEnv);return{viewSpec:r,options:o,dateProfileGenerator:l,viewApi:c}}processRawViewOptions(e,t,n,s,r){let o=Mv([Er,e.optionDefaults,n,s,e.optionOverrides,r]),a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},WA),YA),KA),gD),t.listenerRefiners),t.optionRefiners),l={},c=this.currentViewOptionsInput,d=this.currentViewOptionsRefined,h=!1,p={};for(let m in o)o[m]===c[m]||wr[m]&&wr[m](o[m],c[m])?l[m]=d[m]:(o[m]===this.currentCalendarOptionsInput[m]||wr[m]&&wr[m](o[m],this.currentCalendarOptionsInput[m])?m in this.currentCalendarOptionsRefined&&(l[m]=this.currentCalendarOptionsRefined[m]):a[m]?l[m]=a[m](o[m]):p[m]=o[m],h=!0);return h&&(this.currentViewOptionsInput=o,this.currentViewOptionsRefined=l),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:p}}};function qG(i,e,t,n,s,r,o,a){let l=rP(e||o.defaultCode,o.map);return new jh({calendarSystem:"gregory",timeZone:i,namedTimeZoneImpl:r.namedTimeZonedImpl,locale:l,weekNumberCalculation:t,firstDay:n,weekText:s,cmdFormatter:r.cmdFormatter,defaultSeparator:a})}function WG(i,e){let t=e.themeClasses[i.themeSystem]||xi;return new t(i)}function YG(i){let e=i.dateProfileGeneratorClass||ra;return new e(i)}function KG(i,e,t){return new AC(i,e,t)}function JG(i){return bn(i,e=>e.ui)}function XG(i,e,t){let n={"":e};for(let s in i){let r=i[s];r.sourceId&&t[r.sourceId]&&(n[s]=t[r.sourceId])}return n}function ZG(i){let{options:e}=i;return{eventUiSingleBase:Pc({display:e.eventDisplay,editable:e.editable,startEditable:e.eventStartEditable,durationEditable:e.eventDurationEditable,constraint:e.eventConstraint,overlap:typeof e.eventOverlap=="boolean"?e.eventOverlap:void 0,allow:e.eventAllow,backgroundColor:e.eventBackgroundColor,borderColor:e.eventBorderColor,textColor:e.eventTextColor,color:e.eventColor},i),selectionConfig:Pc({constraint:e.selectConstraint,overlap:typeof e.selectOverlap=="boolean"?e.selectOverlap:void 0,allow:e.selectAllow},i)}}function wC(i,e){for(let t of e.pluginHooks.isLoadingFuncs)if(t(i))return!0;return!1}function jG(i){return rC(i.options.businessHours,i)}function nP(i,e){for(let t in i)console.warn(`Unknown option '${t}'`+(e?` for view '${e}'`:""))}var TC=class extends ne{render(){let e=this.props.widgetGroups.map(t=>this.renderWidgetGroup(t));return x("div",{className:"fc-toolbar-chunk"},...e)}renderWidgetGroup(e){let{props:t}=this,{theme:n}=this.context,s=[],r=!0;for(let o of e){let{buttonName:a,buttonClick:l,buttonText:c,buttonIcon:d,buttonHint:h}=o;if(a==="title")r=!1,s.push(x("h2",{className:"fc-toolbar-title",id:t.titleId},t.title));else{let p=a===t.activeButton,m=!t.isTodayEnabled&&a==="today"||!t.isPrevEnabled&&a==="prev"||!t.isNextEnabled&&a==="next",y=[`fc-${a}-button`,n.getClass("button")];p&&y.push(n.getClass("buttonActive")),s.push(x("button",{type:"button",title:typeof h=="function"?h(t.navUnit):h,disabled:m,"aria-pressed":p,className:y.join(" "),onClick:l},c||(d?x("span",{className:d,role:"img"}):"")))}}if(s.length>1){let o=r&&n.getClass("buttonGroup")||"";return x("div",{className:o},...s)}return s[0]}},Yv=class extends ne{render(){let{model:e,extraClassName:t}=this.props,n=!1,s,r,o=e.sectionWidgets,a=o.center;return o.left?(n=!0,s=o.left):s=o.start,o.right?(n=!0,r=o.right):r=o.end,x("div",{className:[t||"","fc-toolbar",n?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",s||[]),this.renderSection("center",a||[]),this.renderSection("end",r||[]))}renderSection(e,t){let{props:n}=this;return x(TC,{key:e,widgetGroups:t,title:n.title,navUnit:n.navUnit,activeButton:n.activeButton,isTodayEnabled:n.isTodayEnabled,isPrevEnabled:n.isPrevEnabled,isNextEnabled:n.isNextEnabled,titleId:n.titleId})}},xC=class extends ne{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=e=>{this.el=e,rn(this.props.elRef,e),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:e,state:t}=this,{aspectRatio:n}=e,s=["fc-view-harness",n||e.liquid||e.height?"fc-view-harness-active":"fc-view-harness-passive"],r="",o="";return n?t.availableWidth!==null?r=t.availableWidth/n:o=`${1/n*100}%`:r=e.height||"",x("div",{"aria-labelledby":e.labeledById,ref:this.handleEl,className:s.join(" "),style:{height:r,paddingBottom:o}},e.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}},RC=class extends Wn{constructor(e){super(e),this.handleSegClick=(t,n)=>{let{component:s}=this,{context:r}=s,o=vs(n);if(o&&s.isValidSegDownEl(t.target)){let a=Ge(t.target,".fc-event-forced-url"),l=a?a.querySelector("a[href]").href:"";r.emitter.trigger("eventClick",{el:n,event:new me(s.context,o.eventRange.def,o.eventRange.instance),jsEvent:t,view:r.viewApi}),l&&!t.defaultPrevented&&(window.location.href=l)}},this.destroy=kA(e.el,"click",".fc-event",this.handleSegClick)}},IC=class extends Wn{constructor(e){super(e),this.handleEventElRemove=t=>{t===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(t,n)=>{vs(n)&&(this.currentSegEl=n,this.triggerEvent("eventMouseEnter",t,n))},this.handleSegLeave=(t,n)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",t,n))},this.removeHoverListeners=oD(e.el,".fc-event",this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(e,t,n){let{component:s}=this,{context:r}=s,o=vs(n);(!t||s.isValidSegDownEl(t.target))&&r.emitter.trigger(e,{el:n,event:new me(r,o.eventRange.def,o.eventRange.instance),jsEvent:t,view:r.viewApi})}},DC=class extends wi{constructor(){super(...arguments),this.buildViewContext=$(ED),this.buildViewPropTransformers=$(eV),this.buildToolbarProps=$(QG),this.headerRef=Ne(),this.footerRef=Ne(),this.interactionsStore={},this.state={viewLabelId:En()},this.registerInteractiveComponent=(e,t)=>{let n=PD(e,t),o=[RC,IC].concat(this.props.pluginHooks.componentInteractions).map(a=>new a(n));this.interactionsStore[e.uid]=o,kc[e.uid]=n},this.unregisterInteractiveComponent=e=>{let t=this.interactionsStore[e.uid];if(t){for(let n of t)n.destroy();delete this.interactionsStore[e.uid]}delete kc[e.uid]},this.resizeRunner=new sa(()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})}),this.handleWindowResize=e=>{let{options:t}=this.props;t.handleWindowResize&&e.target===window&&this.resizeRunner.request(t.windowResizeDelay)}}render(){let{props:e}=this,{toolbarConfig:t,options:n}=e,s=!1,r="",o;e.isHeightAuto||e.forPrint?r="":n.height!=null?s=!0:n.contentHeight!=null?r=n.contentHeight:o=Math.max(n.aspectRatio,.5);let a=this.buildViewContext(e.viewSpec,e.viewApi,e.options,e.dateProfileGenerator,e.dateEnv,e.nowManager,e.theme,e.pluginHooks,e.dispatch,e.getCurrentData,e.emitter,e.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),l=t.header&&t.header.hasTitle?this.state.viewLabelId:void 0;return x(wn.Provider,{value:a},x(Ot,{unit:"day"},c=>{let d=this.buildToolbarProps(e.viewSpec,e.dateProfile,e.dateProfileGenerator,e.currentDate,c,e.viewTitle);return x(ae,null,t.header&&x(Yv,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:t.header,titleId:l},d)),x(xC,{liquid:s,height:r,aspectRatio:o,labeledById:l},this.renderView(e),this.buildAppendContent()),t.footer&&x(Yv,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:t.footer,titleId:""},d)))}))}componentDidMount(){let{props:e}=this;this.calendarInteractions=e.pluginHooks.calendarInteractions.map(n=>new n(e)),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:t}=e.pluginHooks;for(let n in t)t[n](e[n],e)}componentDidUpdate(e){let{props:t}=this,{propSetHandlers:n}=t.pluginHooks;for(let s in n)t[s]!==e[s]&&n[s](t[s],t)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let e of this.calendarInteractions)e.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:e}=this,t=e.pluginHooks.viewContainerAppends.map(n=>n(e));return x(ae,{},...t)}renderView(e){let{pluginHooks:t}=e,{viewSpec:n}=e,s={dateProfile:e.dateProfile,businessHours:e.businessHours,eventStore:e.renderableEventStore,eventUiBases:e.eventUiBases,dateSelection:e.dateSelection,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,isHeightAuto:e.isHeightAuto,forPrint:e.forPrint},r=this.buildViewPropTransformers(t.viewPropsTransformers);for(let a of r)Object.assign(s,a.transform(s,e));let o=n.component;return x(o,Object.assign({},s))}};function QG(i,e,t,n,s,r){let o=t.build(s,void 0,!1),a=t.buildPrev(e,n,!1),l=t.buildNext(e,n,!1);return{title:r,activeButton:i.type,navUnit:i.singleUnit,isTodayEnabled:o.isValid&&!vn(e.currentRange,s),isPrevEnabled:a.isValid,isNextEnabled:l.isValid}}function eV(i){return i.map(e=>new e)}var Mf=class extends of{constructor(e,t={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=n=>{switch(n.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=n=>{this.currentData=n,this.renderRunner.request(n.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:n}=this;Qh(()=>{dr(x(rf,{options:n.calendarOptions,theme:n.theme,emitter:n.emitter},(s,r,o,a)=>(this.setClassNames(s),this.setHeight(r),x(ZA.Provider,{value:this.customContentRenderId},x(DC,Object.assign({isHeightAuto:o,forPrint:a},n))))),this.el)})}else this.isRendered&&(this.isRendered=!1,dr(null,this.el),this.setClassNames([]),this.setHeight(""))},nD(e),this.el=e,this.renderRunner=new sa(this.handleRenderRequest),new _C({optionOverrides:t,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let e=this.isRendering;e?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),e&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){Qh(()=>{super.updateSize()})}batchRendering(e){this.renderRunner.pause("batchRendering"),e(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(e,t){this.currentDataManager.resetOptions(e,t)}setClassNames(e){if(!Ai(e,this.currentClassNames)){let{classList:t}=this.el;for(let n of this.currentClassNames)t.remove(n);for(let n of e)t.add(n);this.currentClassNames=e}}setHeight(e){MA(this.el,"height",e)}};var MC=class extends rt{constructor(){super(...arguments),this.headerElRef=Ne()}renderSimpleLayout(e,t){let{props:n,context:s}=this,r=[],o=ya(s.options);return e&&r.push({type:"header",key:"header",isSticky:o,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),r.push({type:"body",key:"body",liquid:!0,chunk:{content:t}}),x(qn,{elClasses:["fc-daygrid"],viewSpec:s.viewSpec},x(gr,{liquid:!n.isHeightAuto&&!n.forPrint,collapsibleWidth:n.forPrint,cols:[],sections:r}))}renderHScrollLayout(e,t,n,s){let r=this.context.pluginHooks.scrollGridImpl;if(!r)throw new Error("No ScrollGrid implementation");let{props:o,context:a}=this,l=!o.forPrint&&ya(a.options),c=!o.forPrint&&Rf(a.options),d=[];return e&&d.push({type:"header",key:"header",isSticky:l,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),d.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:t}]}),c&&d.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:Fc}]}),x(qn,{elClasses:["fc-daygrid"],viewSpec:a.viewSpec},x(r,{liquid:!o.isHeightAuto&&!o.forPrint,forPrint:o.forPrint,collapsibleWidth:o.forPrint,colGroups:[{cols:[{span:n,minWidth:s}]}],sections:d}))}};function Jv(i,e){let t=[];for(let n=0;n<e;n+=1)t[n]=[];for(let n of i)t[n.row].push(n);return t}function Kv(i,e){let t=[];for(let n=0;n<e;n+=1)t[n]=[];for(let n of i)t[n.firstCol].push(n);return t}function hP(i,e){let t=[];if(i){for(let n=0;n<e;n+=1)t[n]={affectedInstances:i.affectedInstances,isEvent:i.isEvent,segs:[]};for(let n of i.segs)t[n.row].segs.push(n)}else for(let n=0;n<e;n+=1)t[n]=null;return t}var fP=ue({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function pP(i){let{display:e}=i.eventRange.ui;return e==="list-item"||e==="auto"&&!i.eventRange.def.allDay&&i.firstCol===i.lastCol&&i.isStart&&i.isEnd}var Xv=class extends ne{render(){let{props:e}=this;return x(mr,Object.assign({},e,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:fP,defaultDisplayEventEnd:e.defaultDisplayEventEnd,disableResizing:!e.seg.eventRange.def.allDay}))}},Zv=class extends ne{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,r=n.eventTimeFormat||fP,o=Sr(s,r,t,!0,e.defaultDisplayEventEnd);return x(ms,Object.assign({},e,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:Mc(e.seg,t),defaultGenerator:nV,timeText:o,isResizing:!1,isDateSelecting:!1}))}};function nV(i){return x(ae,null,x("div",{className:"fc-daygrid-event-dot",style:{borderColor:i.borderColor||i.backgroundColor}}),i.timeText&&x("div",{className:"fc-event-time"},i.timeText),x("div",{className:"fc-event-title"},i.event.title||x(ae,null,"\xA0")))}var kC=class extends ne{constructor(){super(...arguments),this.compileSegs=$(iV)}render(){let{props:e}=this,{allSegs:t,invisibleSegs:n}=this.compileSegs(e.singlePlacements);return x(pa,{elClasses:["fc-daygrid-more-link"],dateProfile:e.dateProfile,todayRange:e.todayRange,allDayDate:e.allDayDate,moreCnt:e.moreCnt,allSegs:t,hiddenSegs:n,alignmentElRef:e.alignmentElRef,alignGridTop:e.alignGridTop,extraDateSpan:e.extraDateSpan,popoverContent:()=>{let s=(e.eventDrag?e.eventDrag.affectedInstances:null)||(e.eventResize?e.eventResize.affectedInstances:null)||{};return x(ae,null,t.map(r=>{let o=r.eventRange.instance.instanceId;return x("div",{className:"fc-daygrid-event-harness",key:o,style:{visibility:s[o]?"hidden":""}},pP(r)?x(Zv,Object.assign({seg:r,isDragging:!1,isSelected:o===e.eventSelection,defaultDisplayEventEnd:!1},on(r,e.todayRange))):x(Xv,Object.assign({seg:r,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:o===e.eventSelection,defaultDisplayEventEnd:!1},on(r,e.todayRange))))}))}})}};function iV(i){let e=[],t=[];for(let n of i)e.push(n.seg),n.isVisible||t.push(n.seg);return{allSegs:e,invisibleSegs:t}}var sV=ue({week:"narrow"}),NC=class extends rt{constructor(){super(...arguments),this.rootElRef=Ne(),this.state={dayNumberId:En()},this.handleRootEl=e=>{rn(this.rootElRef,e),rn(this.props.elRef,e)}}render(){let{context:e,props:t,state:n,rootElRef:s}=this,{options:r,dateEnv:o}=e,{date:a,dateProfile:l}=t,c=t.showDayNumber&&oV(a,l.currentRange,o);return x(yr,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...t.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},t.extraDataAttrs),t.showDayNumber?{"aria-labelledby":n.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:rV,date:a,dateProfile:l,todayRange:t.todayRange,showDayNumber:t.showDayNumber,isMonthStart:c,extraRenderProps:t.extraRenderProps},(d,h)=>x("div",{ref:t.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:t.minHeight}},t.showWeekNumber&&x(Pf,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:Ti(e,a,"week"),date:a,defaultFormat:sV}),!h.isDisabled&&(t.showDayNumber||Lc(r)||t.forceDayTop)?x("div",{className:"fc-daygrid-day-top"},x(d,{elTag:"a",elClasses:["fc-daygrid-day-number",c&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},Ti(e,a)),{id:n.dayNumberId})})):t.showDayNumber?x("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},x("a",{className:"fc-daygrid-day-number"},"\xA0")):void 0,x("div",{className:"fc-daygrid-day-events",ref:t.fgContentElRef},t.fgContent,x("div",{className:"fc-daygrid-day-bottom",style:{marginTop:t.moreMarginTop}},x(kC,{allDayDate:a,singlePlacements:t.singlePlacements,moreCnt:t.moreCnt,alignmentElRef:s,alignGridTop:!t.showDayNumber,extraDateSpan:t.extraDateSpan,dateProfile:t.dateProfile,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,todayRange:t.todayRange}))),x("div",{className:"fc-daygrid-day-bg"},t.bgContent)))}};function rV(i){return i.dayNumberText||x(ae,null,"\xA0")}function oV(i,e,t){let{start:n,end:s}=e,r=Ei(s,-1),o=t.getYear(n),a=t.getMonth(n),l=t.getYear(r),c=t.getMonth(r);return!(o===l&&a===c)&&(i.valueOf()===n.valueOf()||t.getDay(i)===1&&i.valueOf()<s.valueOf())}function gP(i){return i.eventRange.instance.instanceId+":"+i.firstCol}function mP(i){return gP(i)+":"+i.lastCol}function aV(i,e,t,n,s,r,o){let a=new FC(S=>{let C=i[S.index].eventRange.instance.instanceId+":"+S.span.start+":"+(S.span.end-1);return s[C]||1});a.allowReslicing=!0,a.strictOrder=n,e===!0||t===!0?(a.maxCoord=r,a.hiddenConsumes=!0):typeof e=="number"?a.maxStackCnt=e:typeof t=="number"&&(a.maxStackCnt=t,a.hiddenConsumes=!0);let l=[],c=[];for(let S=0;S<i.length;S+=1){let C=i[S],_=mP(C);s[_]!=null?l.push({index:S,span:{start:C.firstCol,end:C.lastCol+1}}):c.push(C)}let d=a.addSegs(l),h=a.toRects(),{singleColPlacements:p,multiColPlacements:m,leftoverMargins:y}=lV(h,i,o),v=[],E=[];for(let S of c){m[S.firstCol].push({seg:S,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let C=S.firstCol;C<=S.lastCol;C+=1)p[C].push({seg:Oc(S,C,C+1,o),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let S=0;S<o.length;S+=1)v.push(0);for(let S of d){let C=i[S.index],_=S.span;m[_.start].push({seg:Oc(C,_.start,_.end,o),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let T=_.start;T<_.end;T+=1)v[T]+=1,p[T].push({seg:Oc(C,T,T+1,o),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let S=0;S<o.length;S+=1)E.push(y[S]);return{singleColPlacements:p,multiColPlacements:m,moreCnts:v,moreMarginTops:E}}function lV(i,e,t){let n=cV(i,t.length),s=[],r=[],o=[];for(let a=0;a<t.length;a+=1){let l=n[a],c=[],d=0,h=0;for(let m of l){let y=e[m.index];c.push({seg:Oc(y,a,a+1,t),isVisible:!0,isAbsolute:!1,absoluteTop:m.levelCoord,marginTop:m.levelCoord-d}),d=m.levelCoord+m.thickness}let p=[];d=0,h=0;for(let m of l){let y=e[m.index],v=m.span.end-m.span.start>1,E=m.span.start===a;h+=m.levelCoord-d,d=m.levelCoord+m.thickness,v?(h+=m.thickness,E&&p.push({seg:Oc(y,m.span.start,m.span.end,t),isVisible:!0,isAbsolute:!0,absoluteTop:m.levelCoord,marginTop:0})):E&&(p.push({seg:Oc(y,m.span.start,m.span.end,t),isVisible:!0,isAbsolute:!1,absoluteTop:m.levelCoord,marginTop:h}),h=0)}s.push(c),r.push(p),o.push(h)}return{singleColPlacements:s,multiColPlacements:r,leftoverMargins:o}}function cV(i,e){let t=[];for(let n=0;n<e;n+=1)t.push([]);for(let n of i)for(let s=n.span.start;s<n.span.end;s+=1)t[s].push(n);return t}function Oc(i,e,t,n){if(i.firstCol===e&&i.lastCol===t-1)return i;let s=i.eventRange,r=s.range,o=sn(r,{start:n[e].date,end:Ee(n[t-1].date,1)});return Object.assign(Object.assign({},i),{firstCol:e,lastCol:t-1,eventRange:{def:s.def,ui:Object.assign(Object.assign({},s.ui),{durationEditable:!1}),instance:s.instance,range:o},isStart:i.isStart&&o.start.valueOf()===r.start.valueOf(),isEnd:i.isEnd&&o.end.valueOf()===r.end.valueOf()})}var FC=class extends la{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(e){let t=super.addSegs(e),{entriesByLevel:n}=this,s=r=>!this.forceHidden[Si(r)];for(let r=0;r<n.length;r+=1)n[r]=n[r].filter(s);return t}handleInvalidInsertion(e,t,n){let{entriesByLevel:s,forceHidden:r}=this,{touchingEntry:o,touchingLevel:a,touchingLateral:l}=e;if(this.hiddenConsumes&&o){let c=Si(o);if(!r[c])if(this.allowReslicing){let d=Object.assign(Object.assign({},o),{span:Tf(o.span,t.span)}),h=Si(d);r[h]=!0,s[a][l]=d,n.push(d),this.splitEntry(o,t,n)}else r[c]=!0,n.push(o)}super.handleInvalidInsertion(e,t,n)}},jv=class extends rt{constructor(){super(...arguments),this.cellElRefs=new Ut,this.frameElRefs=new Ut,this.fgElRefs=new Ut,this.segHarnessRefs=new Ut,this.rootElRef=Ne(),this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=e=>{e&&this.updateSizing(!0)}}render(){let{props:e,state:t,context:n}=this,{options:s}=n,r=e.cells.length,o=Kv(e.businessHourSegs,r),a=Kv(e.bgEventSegs,r),l=Kv(this.getHighlightSegs(),r),c=Kv(this.getMirrorSegs(),r),{singleColPlacements:d,multiColPlacements:h,moreCnts:p,moreMarginTops:m}=aV(ma(e.fgEventSegs,s.eventOrder),e.dayMaxEvents,e.dayMaxEventRows,s.eventOrderStrict,t.segHeights,t.maxContentHeight,e.cells),y=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{};return x("tr",{ref:this.rootElRef,role:"row"},e.renderIntro&&e.renderIntro(),e.cells.map((v,E)=>{let S=this.renderFgSegs(E,e.forPrint?d[E]:h[E],e.todayRange,y),C=this.renderFgSegs(E,dV(c[E],h),e.todayRange,{},!!e.eventDrag,!!e.eventResize,!1);return x(NC,{key:v.key,elRef:this.cellElRefs.createRef(v.key),innerElRef:this.frameElRefs.createRef(v.key),dateProfile:e.dateProfile,date:v.date,showDayNumber:e.showDayNumbers,showWeekNumber:e.showWeekNumbers&&E===0,forceDayTop:e.showWeekNumbers,todayRange:e.todayRange,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,extraRenderProps:v.extraRenderProps,extraDataAttrs:v.extraDataAttrs,extraClassNames:v.extraClassNames,extraDateSpan:v.extraDateSpan,moreCnt:p[E],moreMarginTop:m[E],singlePlacements:d[E],fgContentElRef:this.fgElRefs.createRef(v.key),fgContent:x(ae,null,x(ae,null,S),x(ae,null,C)),bgContent:x(ae,null,this.renderFillSegs(l[E],"highlight"),this.renderFillSegs(o[E],"non-business"),this.renderFillSegs(a[E],"bg-event")),minHeight:e.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(e,t){let n=this.props;this.updateSizing(!Lt(e,n))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:e}=this;return e.eventDrag&&e.eventDrag.segs.length?e.eventDrag.segs:e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:e.dateSelectionSegs}getMirrorSegs(){let{props:e}=this;return e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:[]}renderFgSegs(e,t,n,s,r,o,a){let{context:l}=this,{eventSelection:c}=this.props,{framePositions:d}=this.state,h=this.props.cells.length===1,p=r||o||a,m=[];if(d)for(let y of t){let{seg:v}=y,{instanceId:E}=v.eventRange.instance,S=y.isVisible&&!s[E],C=y.isAbsolute,_="",T="";C&&(l.isRtl?(T=0,_=d.lefts[v.lastCol]-d.lefts[v.firstCol]):(_=0,T=d.rights[v.firstCol]-d.rights[v.lastCol])),m.push(x("div",{className:"fc-daygrid-event-harness"+(C?" fc-daygrid-event-harness-abs":""),key:gP(v),ref:p?null:this.segHarnessRefs.createRef(mP(v)),style:{visibility:S?"":"hidden",marginTop:C?"":y.marginTop,top:C?y.absoluteTop:"",left:_,right:T}},pP(v)?x(Zv,Object.assign({seg:v,isDragging:r,isSelected:E===c,defaultDisplayEventEnd:h},on(v,n))):x(Xv,Object.assign({seg:v,isDragging:r,isResizing:o,isDateSelecting:a,isSelected:E===c,defaultDisplayEventEnd:h},on(v,n)))))}return m}renderFillSegs(e,t){let{isRtl:n}=this.context,{todayRange:s}=this.props,{framePositions:r}=this.state,o=[];if(r)for(let a of e){let l=n?{right:0,left:r.lefts[a.lastCol]-r.lefts[a.firstCol]}:{left:0,right:r.rights[a.firstCol]-r.rights[a.lastCol]};o.push(x("div",{key:Sf(a.eventRange),className:"fc-daygrid-bg-harness",style:l},t==="bg-event"?x(fa,Object.assign({seg:a},on(a,s))):Df(t)))}return x(ae,{},...o)}updateSizing(e){let{props:t,state:n,frameElRefs:s}=this;if(!t.forPrint&&t.clientWidth!==null){if(e){let l=t.cells.map(c=>s.currentMap[c.key]);if(l.length){let c=this.rootElRef.current,d=new Yn(c,l,!0,!1);(!n.framePositions||!n.framePositions.similarTo(d))&&this.setState({framePositions:new Yn(c,l,!0,!1)})}}let r=this.state.segHeights,o=this.querySegHeights(),a=t.dayMaxEvents===!0||t.dayMaxEventRows===!0;this.safeSetState({segHeights:Object.assign(Object.assign({},r),o),maxContentHeight:a?this.computeMaxContentHeight():null})}}querySegHeights(){let e=this.segHarnessRefs.currentMap,t={};for(let n in e){let s=Math.round(e[n].getBoundingClientRect().height);t[n]=Math.max(t[n]||0,s)}return t}computeMaxContentHeight(){let e=this.props.cells[0].key,t=this.cellElRefs.currentMap[e],n=this.fgElRefs.currentMap[e];return t.getBoundingClientRect().bottom-n.getBoundingClientRect().top}getCellEls(){let e=this.cellElRefs.currentMap;return this.props.cells.map(t=>e[t.key])}};jv.addStateEquality({segHeights:Lt});function dV(i,e){if(!i.length)return[];let t=uV(e);return i.map(n=>({seg:n,isVisible:!0,isAbsolute:!0,absoluteTop:t[n.eventRange.instance.instanceId],marginTop:0}))}function uV(i){let e={};for(let t of i)for(let n of t)e[n.seg.eventRange.instance.instanceId]=n.absoluteTop;return e}var LC=class extends rt{constructor(){super(...arguments),this.splitBusinessHourSegs=$(Jv),this.splitBgEventSegs=$(hV),this.splitFgEventSegs=$(Jv),this.splitDateSelectionSegs=$(Jv),this.splitEventDrag=$(hP),this.splitEventResize=$(hP),this.rowRefs=new Ut}render(){let{props:e,context:t}=this,n=e.cells.length,s=this.splitBusinessHourSegs(e.businessHourSegs,n),r=this.splitBgEventSegs(e.bgEventSegs,n),o=this.splitFgEventSegs(e.fgEventSegs,n),a=this.splitDateSelectionSegs(e.dateSelectionSegs,n),l=this.splitEventDrag(e.eventDrag,n),c=this.splitEventResize(e.eventResize,n),d=n>=7&&e.clientWidth?e.clientWidth/t.options.aspectRatio/6:null;return x(Ot,{unit:"day"},(h,p)=>x(ae,null,e.cells.map((m,y)=>x(jv,{ref:this.rowRefs.createRef(y),key:m.length?m[0].date.toISOString():y,showDayNumbers:n>1,showWeekNumbers:e.showWeekNumbers,todayRange:p,dateProfile:e.dateProfile,cells:m,renderIntro:e.renderRowIntro,businessHourSegs:s[y],eventSelection:e.eventSelection,bgEventSegs:r[y],fgEventSegs:o[y],dateSelectionSegs:a[y],eventDrag:l[y],eventResize:c[y],dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,clientWidth:e.clientWidth,clientHeight:e.clientHeight,cellMinHeight:d,forPrint:e.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){let e=this.rowRefs.currentMap[0].getCellEls()[0],t=e?e.closest(".fc-daygrid-body"):null;t&&(this.rootEl=t,this.context.registerInteractiveComponent(this,{el:t,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new Yn(this.rootEl,this.rowRefs.collect().map(e=>e.getCellEls()[0]),!1,!0),this.colPositions=new Yn(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(e,t){let{colPositions:n,rowPositions:s}=this,r=n.leftToIndex(e),o=s.topToIndex(t);if(o!=null&&r!=null){let a=this.props.cells[o][r];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(o,r),allDay:!0},a.extraDateSpan),dayEl:this.getCellEl(o,r),rect:{left:n.lefts[r],right:n.rights[r],top:s.tops[o],bottom:s.bottoms[o]},layer:0}}return null}getCellEl(e,t){return this.rowRefs.currentMap[e].getCellEls()[t]}getCellRange(e,t){let n=this.props.cells[e][t].date,s=Ee(n,1);return{start:n,end:s}}};function hV(i,e){return Jv(i.filter(fV),e)}function fV(i){return i.eventRange.def.allDay}var OC=class extends rt{constructor(){super(...arguments),this.elRef=Ne(),this.needsScrollReset=!1}render(){let{props:e}=this,{dayMaxEventRows:t,dayMaxEvents:n,expandRows:s}=e,r=n===!0||t===!0;r&&!s&&(r=!1,t=null,n=null);let o=["fc-daygrid-body",r?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",s?"":"fc-daygrid-body-natural"];return x("div",{ref:this.elRef,className:o.join(" "),style:{width:e.clientWidth,minWidth:e.tableMinWidth}},x("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:e.clientWidth,minWidth:e.tableMinWidth,height:s?e.clientHeight:""}},e.colGroupNode,x("tbody",{role:"presentation"},x(LC,{dateProfile:e.dateProfile,cells:e.cells,renderRowIntro:e.renderRowIntro,showWeekNumbers:e.showWeekNumbers,clientWidth:e.clientWidth,clientHeight:e.clientHeight,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,dayMaxEvents:n,dayMaxEventRows:t,forPrint:e.forPrint,isHitComboAllowed:e.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(e){e.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){let e=pV(this.elRef.current,this.props.dateProfile);if(e){let t=e.closest(".fc-daygrid-body"),n=t.closest(".fc-scroller"),s=e.getBoundingClientRect().top-t.getBoundingClientRect().top;n.scrollTop=s?s+1:0}this.needsScrollReset=!1}}};function pV(i,e){let t;return e.currentRangeUnit.match(/year|month/)&&(t=i.querySelector(`[data-date="${$A(e.currentDate)}-01"]`)),t||(t=i.querySelector(`[data-date="${br(e.currentDate)}"]`)),t}var UC=class extends ha{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(e,t){return t.sliceRange(e)}},kf=class extends rt{constructor(){super(...arguments),this.slicer=new UC,this.tableRef=Ne()}render(){let{props:e,context:t}=this;return x(OC,Object.assign({ref:this.tableRef},this.slicer.sliceProps(e,e.dateProfile,e.nextDayThreshold,t,e.dayTableModel),{dateProfile:e.dateProfile,cells:e.dayTableModel.cells,colGroupNode:e.colGroupNode,tableMinWidth:e.tableMinWidth,renderRowIntro:e.renderRowIntro,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.showWeekNumbers,expandRows:e.expandRows,headerAlignElRef:e.headerAlignElRef,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:e.forPrint}))}},Qv=class extends MC{constructor(){super(...arguments),this.buildDayTableModel=$(gV),this.headerRef=Ne(),this.tableRef=Ne()}render(){let{options:e,dateProfileGenerator:t}=this.context,{props:n}=this,s=this.buildDayTableModel(n.dateProfile,t),r=e.dayHeaders&&x(ca,{ref:this.headerRef,dateProfile:n.dateProfile,dates:s.headerDates,datesRepDistinctDays:s.rowCnt===1}),o=a=>x(kf,{ref:this.tableRef,dateProfile:n.dateProfile,dayTableModel:s,businessHours:n.businessHours,dateSelection:n.dateSelection,eventStore:n.eventStore,eventUiBases:n.eventUiBases,eventSelection:n.eventSelection,eventDrag:n.eventDrag,eventResize:n.eventResize,nextDayThreshold:e.nextDayThreshold,colGroupNode:a.tableColGroupNode,tableMinWidth:a.tableMinWidth,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.weekNumbers,expandRows:!n.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:a.clientWidth,clientHeight:a.clientHeight,forPrint:n.forPrint});return e.dayMinWidth?this.renderHScrollLayout(r,o,s.colCnt,e.dayMinWidth):this.renderSimpleLayout(r,o)}};function gV(i,e){let t=new da(i.renderRange,e);return new ua(t,/year|month|week/.test(i.currentRangeUnit))}var eb=class extends ra{buildRenderRange(e,t,n){let s=super.buildRenderRange(e,t,n),{props:r}=this;return mV({currentRange:s,snapToWeek:/^(year|month)$/.test(t),fixedWeekCount:r.fixedWeekCount,dateEnv:r.dateEnv})}};function mV(i){let{dateEnv:e,currentRange:t}=i,{start:n,end:s}=t,r;if(i.snapToWeek&&(n=e.startOfWeek(n),r=e.startOfWeek(s),r.valueOf()!==s.valueOf()&&(s=Dv(r,1))),i.fixedWeekCount){let o=e.startOfWeek(e.startOfMonth(Ee(t.end,-1))),a=Math.ceil(GA(o,s));s=Dv(s,6-a)}return{start:n,end:s}}var yV=':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}';vr(yV);var yP=Ht({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:Qv,dateProfileGeneratorClass:eb},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});var BC=class extends af{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(e){return e.allDay?["allDay"]:["timed"]}getKeysForEventDef(e){return e.allDay?aC(e)?["timed","allDay"]:["allDay"]:["timed"]}},vV=ue({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function SP(i){let e=["fc-timegrid-slot","fc-timegrid-slot-label",i.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return x(wn.Consumer,null,t=>{if(!i.isLabeled)return x("td",{className:e.join(" "),"data-time":i.isoTimeStr});let{dateEnv:n,options:s,viewApi:r}=t,o=s.slotLabelFormat==null?vV:Array.isArray(s.slotLabelFormat)?ue(s.slotLabelFormat[0]):ue(s.slotLabelFormat),a={level:0,time:i.time,date:n.toDate(i.date),view:r,text:n.format(i.date,o)};return x(xe,{elTag:"td",elClasses:e,elAttrs:{"data-time":i.isoTimeStr},renderProps:a,generatorName:"slotLabelContent",customGenerator:s.slotLabelContent,defaultGenerator:bV,classNameGenerator:s.slotLabelClassNames,didMount:s.slotLabelDidMount,willUnmount:s.slotLabelWillUnmount},l=>x("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},x(l,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function bV(i){return i.text}var GC=class extends ne{render(){return this.props.slatMetas.map(e=>x("tr",{key:e.key},x(SP,Object.assign({},e))))}},EV=ue({week:"short"}),wV=5,VC=class extends rt{constructor(){super(...arguments),this.allDaySplitter=new BC,this.headerElRef=Ne(),this.rootElRef=Ne(),this.scrollerElRef=Ne(),this.state={slatCoords:null},this.handleScrollTopRequest=e=>{let t=this.scrollerElRef.current;t&&(t.scrollTop=e)},this.renderHeadAxis=(e,t="")=>{let{options:n}=this.context,{dateProfile:s}=this.props,r=s.renderRange,a=Ci(r.start,r.end)===1?Ti(this.context,r.start,"week"):{};return n.weekNumbers&&e==="day"?x(Pf,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:r.start,defaultFormat:EV},l=>x("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:t}},x(l,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:a}))):x("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},x("div",{className:"fc-timegrid-axis-frame",style:{height:t}}))},this.renderTableRowAxis=e=>{let{options:t,viewApi:n}=this.context,s={text:t.allDayText,view:n};return x(xe,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:s,generatorName:"allDayContent",customGenerator:t.allDayContent,defaultGenerator:SV,classNameGenerator:t.allDayClassNames,didMount:t.allDayDidMount,willUnmount:t.allDayWillUnmount},r=>x("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",e==null?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:e}},x(r,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=e=>{this.setState({slatCoords:e})}}renderSimpleLayout(e,t,n){let{context:s,props:r}=this,o=[],a=ya(s.options);return e&&o.push({type:"header",key:"header",isSticky:a,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),t&&(o.push({type:"body",key:"all-day",chunk:{content:t}}),o.push({type:"body",key:"all-day-divider",outerContent:x("tr",{role:"presentation",className:"fc-scrollgrid-section"},x("td",{className:"fc-timegrid-divider "+s.theme.getClass("tableCellShaded")}))})),o.push({type:"body",key:"body",liquid:!0,expandRows:!!s.options.expandRows,chunk:{scrollerElRef:this.scrollerElRef,content:n}}),x(qn,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:s.viewSpec},x(gr,{liquid:!r.isHeightAuto&&!r.forPrint,collapsibleWidth:r.forPrint,cols:[{width:"shrink"}],sections:o}))}renderHScrollLayout(e,t,n,s,r,o,a){let l=this.context.pluginHooks.scrollGridImpl;if(!l)throw new Error("No ScrollGrid implementation");let{context:c,props:d}=this,h=!d.forPrint&&ya(c.options),p=!d.forPrint&&Rf(c.options),m=[];e&&m.push({type:"header",key:"header",isSticky:h,syncRowHeights:!0,chunks:[{key:"axis",rowContent:v=>x("tr",{role:"presentation"},this.renderHeadAxis("day",v.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),t&&(m.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:v=>x("tr",{role:"presentation"},this.renderTableRowAxis(v.rowSyncHeights[0]))},{key:"cols",content:t}]}),m.push({key:"all-day-divider",type:"body",outerContent:x("tr",{role:"presentation",className:"fc-scrollgrid-section"},x("td",{colSpan:2,className:"fc-timegrid-divider "+c.theme.getClass("tableCellShaded")}))}));let y=c.options.nowIndicator;return m.push({type:"body",key:"body",liquid:!0,expandRows:!!c.options.expandRows,chunks:[{key:"axis",content:v=>x("div",{className:"fc-timegrid-axis-chunk"},x("table",{"aria-hidden":!0,style:{height:v.expandRows?v.clientHeight:""}},v.tableColGroupNode,x("tbody",null,x(GC,{slatMetas:o}))),x("div",{className:"fc-timegrid-now-indicator-container"},x(Ot,{unit:y?"minute":"day"},E=>{let S=y&&a&&a.safeComputeTop(E);return typeof S=="number"?x(If,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:S},isAxis:!0,date:E}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:n}]}),p&&m.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:Fc},{key:"cols",content:Fc}]}),x(qn,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:c.viewSpec},x(l,{liquid:!d.isHeightAuto&&!d.forPrint,forPrint:d.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:s,minWidth:r}]}],sections:m}))}getAllDayMaxEventProps(){let{dayMaxEvents:e,dayMaxEventRows:t}=this.context.options;return(e===!0||t===!0)&&(e=void 0,t=wV),{dayMaxEvents:e,dayMaxEventRows:t}}};function SV(i){return i.text}var $C=class{constructor(e,t,n){this.positions=e,this.dateProfile=t,this.slotDuration=n}safeComputeTop(e){let{dateProfile:t}=this;if(vn(t.currentRange,e)){let n=de(e),s=e.valueOf()-n.valueOf();if(s>=nn(t.slotMinTime)&&s<nn(t.slotMaxTime))return this.computeTimeTop(te(s))}return null}computeDateTop(e,t){return t||(t=de(e)),this.computeTimeTop(te(e.valueOf()-t.valueOf()))}computeTimeTop(e){let{positions:t,dateProfile:n}=this,s=t.els.length,r=(e.milliseconds-nn(n.slotMinTime))/nn(this.slotDuration),o,a;return r=Math.max(0,r),r=Math.min(s,r),o=Math.floor(r),o=Math.min(o,s-1),a=r-o,t.tops[o]+t.getHeight(o)*a}},zC=class extends ne{render(){let{props:e,context:t}=this,{options:n}=t,{slatElRefs:s}=e;return x("tbody",null,e.slatMetas.map((r,o)=>{let a={time:r.time,date:t.dateEnv.toDate(r.date),view:t.viewApi};return x("tr",{key:r.key,ref:s.createRef(r.key)},e.axis&&x(SP,Object.assign({},r)),x(xe,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!r.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":r.isoTimeStr},renderProps:a,generatorName:"slotLaneContent",customGenerator:n.slotLaneContent,classNameGenerator:n.slotLaneClassNames,didMount:n.slotLaneDidMount,willUnmount:n.slotLaneWillUnmount}))}))}},qC=class extends ne{constructor(){super(...arguments),this.rootElRef=Ne(),this.slatElRefs=new Ut}render(){let{props:e,context:t}=this;return x("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},x("table",{"aria-hidden":!0,className:t.theme.getClass("table"),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:e.minHeight}},e.tableColGroupNode,x(zC,{slatElRefs:this.slatElRefs,axis:e.axis,slatMetas:e.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:e,props:t}=this;t.onCoords&&t.clientWidth!==null&&this.rootElRef.current.offsetHeight&&t.onCoords(new $C(new Yn(this.rootElRef.current,AV(this.slatElRefs.currentMap,t.slatMetas),!1,!0),this.props.dateProfile,e.options.slotDuration))}};function AV(i,e){return e.map(t=>i[t.key])}function Nf(i,e){let t=[],n;for(n=0;n<e;n+=1)t.push([]);if(i)for(n=0;n<i.length;n+=1)t[i[n].col].push(i[n]);return t}function vP(i,e){let t=[];if(i){for(let n=0;n<e;n+=1)t[n]={affectedInstances:i.affectedInstances,isEvent:i.isEvent,segs:[]};for(let n of i.segs)t[n.col].segs.push(n)}else for(let n=0;n<e;n+=1)t[n]=null;return t}var WC=class extends ne{render(){let{props:e}=this;return x(pa,{elClasses:["fc-timegrid-more-link"],elStyle:{top:e.top,bottom:e.bottom},allDayDate:null,moreCnt:e.hiddenSegs.length,allSegs:e.hiddenSegs,hiddenSegs:e.hiddenSegs,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,todayRange:e.todayRange,popoverContent:()=>AP(e.hiddenSegs,e),defaultGenerator:CV,forceTimed:!0},t=>x(t,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}};function CV(i){return i.shortText}function _V(i,e,t){let n=new la;e!=null&&(n.strictOrder=e),t!=null&&(n.maxStackCnt=t);let s=n.addSegs(i),r=vC(s),o=TV(n);return o=DV(o,1),{segRects:PV(o),hiddenGroups:r}}function TV(i){let{entriesByLevel:e}=i,t=jC((n,s)=>n+":"+s,(n,s)=>{let r=IV(i,n,s),o=bP(r,t),a=e[n][s];return[Object.assign(Object.assign({},a),{nextLevelNodes:o[0]}),a.thickness+o[1]]});return bP(e.length?{level:0,lateralStart:0,lateralEnd:e[0].length}:null,t)[0]}function bP(i,e){if(!i)return[[],0];let{level:t,lateralStart:n,lateralEnd:s}=i,r=n,o=[];for(;r<s;)o.push(e(t,r)),r+=1;return o.sort(xV),[o.map(RV),o[0][1]]}function xV(i,e){return e[1]-i[1]}function RV(i){return i[0]}function IV(i,e,t){let{levelCoords:n,entriesByLevel:s}=i,r=s[e][t],o=n[e]+r.thickness,a=n.length,l=e;for(;l<a&&n[l]<o;l+=1);for(;l<a;l+=1){let c=s[l],d,h=uf(c,r.span.start,df),p=h[0]+h[1],m=p;for(;(d=c[m])&&d.span.start<r.span.end;)m+=1;if(p<m)return{level:l,lateralStart:p,lateralEnd:m}}return null}function DV(i,e){let t=jC((n,s,r)=>Si(n),(n,s,r)=>{let{nextLevelNodes:o,thickness:a}=n,l=a+r,c=a/l,d,h=[];if(!o.length)d=e;else for(let m of o)if(d===void 0){let y=t(m,s,l);d=y[0],h.push(y[1])}else{let y=t(m,d,0);h.push(y[1])}let p=(d-s)*c;return[d-p,Object.assign(Object.assign({},n),{thickness:p,nextLevelNodes:h})]});return i.map(n=>t(n,0,0)[1])}function PV(i){let e=[],t=jC((s,r,o)=>Si(s),(s,r,o)=>{let a=Object.assign(Object.assign({},s),{levelCoord:r,stackDepth:o,stackForward:0});return e.push(a),a.stackForward=n(s.nextLevelNodes,r+s.thickness,o+1)+1});function n(s,r,o){let a=0;for(let l of s)a=Math.max(t(l,r,o),a);return a}return n(i,0,0),e}function jC(i,e){let t={};return(...n)=>{let s=i(...n);return s in t?t[s]:t[s]=e(...n)}}function EP(i,e,t=null,n=0){let s=[];if(t)for(let r=0;r<i.length;r+=1){let o=i[r],a=t.computeDateTop(o.start,e),l=Math.max(a+(n||0),t.computeDateTop(o.end,e));s.push({start:Math.round(a),end:Math.round(l)})}return s}function MV(i,e,t,n){let s=[],r=[];for(let c=0;c<i.length;c+=1){let d=e[c];d?s.push({index:c,thickness:1,span:d}):r.push(i[c])}let{segRects:o,hiddenGroups:a}=_V(s,t,n),l=[];for(let c of o)l.push({seg:i[c.index],rect:c});for(let c of r)l.push({seg:c,rect:null});return{segPlacements:l,hiddenGroups:a}}var kV=ue({hour:"numeric",minute:"2-digit",meridiem:!1}),tb=class extends ne{render(){return x(mr,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:kV}))}},YC=class extends ne{constructor(){super(...arguments),this.sortEventSegs=$(ma)}render(){let{props:e,context:t}=this,{options:n}=t,s=n.selectMirror,r=e.eventDrag&&e.eventDrag.segs||e.eventResize&&e.eventResize.segs||s&&e.dateSelectionSegs||[],o=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{},a=this.sortEventSegs(e.fgEventSegs,n.eventOrder);return x(yr,{elTag:"td",elRef:e.elRef,elClasses:["fc-timegrid-col",...e.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},e.extraDataAttrs),date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,extraRenderProps:e.extraRenderProps},l=>x("div",{className:"fc-timegrid-col-frame"},x("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(e.businessHourSegs,"non-business"),this.renderFillSegs(e.bgEventSegs,"bg-event"),this.renderFillSegs(e.dateSelectionSegs,"highlight")),x("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(a,o,!1,!1,!1)),x("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(r,{},!!e.eventDrag,!!e.eventResize,!!s,"mirror")),x("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(e.nowIndicatorSegs)),Lc(n)&&x(l,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(e,t,n,s,r,o){let{props:a}=this;return a.forPrint?AP(e,a):this.renderPositionedFgSegs(e,t,n,s,r,o)}renderPositionedFgSegs(e,t,n,s,r,o){let{eventMaxStack:a,eventShortHeight:l,eventOrderStrict:c,eventMinHeight:d}=this.context.options,{date:h,slatCoords:p,eventSelection:m,todayRange:y,nowDate:v}=this.props,E=n||s||r,S=EP(e,h,p,d),{segPlacements:C,hiddenGroups:_}=MV(e,S,c,a);return x(ae,null,this.renderHiddenGroups(_,e),C.map(T=>{let{seg:R,rect:I}=T,D=R.eventRange.instance.instanceId,k=E||!!(!t[D]&&I),N=HC(I&&I.span),F=!E&&I?this.computeSegHStyle(I):{left:0,right:0},U=!!I&&I.stackForward>0,re=!!I&&I.span.end-I.span.start<l;return x("div",{className:"fc-timegrid-event-harness"+(U?" fc-timegrid-event-harness-inset":""),key:o||D,style:Object.assign(Object.assign({visibility:k?"":"hidden"},N),F)},x(tb,Object.assign({seg:R,isDragging:n,isResizing:s,isDateSelecting:r,isSelected:D===m,isShort:re},on(R,y,v))))}))}renderHiddenGroups(e,t){let{extraDateSpan:n,dateProfile:s,todayRange:r,nowDate:o,eventSelection:a,eventDrag:l,eventResize:c}=this.props;return x(ae,null,e.map(d=>{let h=HC(d.span),p=NV(d.entries,t);return x(WC,{key:Pv(qv(p)),hiddenSegs:p,top:h.top,bottom:h.bottom,extraDateSpan:n,dateProfile:s,todayRange:r,nowDate:o,eventSelection:a,eventDrag:l,eventResize:c})}))}renderFillSegs(e,t){let{props:n,context:s}=this,o=EP(e,n.date,n.slatCoords,s.options.eventMinHeight).map((a,l)=>{let c=e[l];return x("div",{key:Sf(c.eventRange),className:"fc-timegrid-bg-harness",style:HC(a)},t==="bg-event"?x(fa,Object.assign({seg:c},on(c,n.todayRange,n.nowDate))):Df(t))});return x(ae,null,o)}renderNowIndicator(e){let{slatCoords:t,date:n}=this.props;return t?e.map((s,r)=>x(If,{key:r,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:t.computeDateTop(s.start,n)},isAxis:!1,date:n})):null}computeSegHStyle(e){let{isRtl:t,options:n}=this.context,s=n.slotEventOverlap,r=e.levelCoord,o=e.levelCoord+e.thickness,a,l;s&&(o=Math.min(1,r+(o-r)*2)),t?(a=1-o,l=r):(a=r,l=1-o);let c={zIndex:e.stackDepth+1,left:a*100+"%",right:l*100+"%"};return s&&!e.stackForward&&(c[t?"marginLeft":"marginRight"]=10*2),c}};function AP(i,{todayRange:e,nowDate:t,eventSelection:n,eventDrag:s,eventResize:r}){let o=(s?s.affectedInstances:null)||(r?r.affectedInstances:null)||{};return x(ae,null,i.map(a=>{let l=a.eventRange.instance.instanceId;return x("div",{key:l,style:{visibility:o[l]?"hidden":""}},x(tb,Object.assign({seg:a,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:l===n,isShort:!1},on(a,e,t))))}))}function HC(i){return i?{top:i.start,bottom:-i.end}:{top:"",bottom:""}}function NV(i,e){return i.map(t=>e[t.index])}var KC=class extends ne{constructor(){super(...arguments),this.splitFgEventSegs=$(Nf),this.splitBgEventSegs=$(Nf),this.splitBusinessHourSegs=$(Nf),this.splitNowIndicatorSegs=$(Nf),this.splitDateSelectionSegs=$(Nf),this.splitEventDrag=$(vP),this.splitEventResize=$(vP),this.rootElRef=Ne(),this.cellElRefs=new Ut}render(){let{props:e,context:t}=this,n=t.options.nowIndicator&&e.slatCoords&&e.slatCoords.safeComputeTop(e.nowDate),s=e.cells.length,r=this.splitFgEventSegs(e.fgEventSegs,s),o=this.splitBgEventSegs(e.bgEventSegs,s),a=this.splitBusinessHourSegs(e.businessHourSegs,s),l=this.splitNowIndicatorSegs(e.nowIndicatorSegs,s),c=this.splitDateSelectionSegs(e.dateSelectionSegs,s),d=this.splitEventDrag(e.eventDrag,s),h=this.splitEventResize(e.eventResize,s);return x("div",{className:"fc-timegrid-cols",ref:this.rootElRef},x("table",{role:"presentation",style:{minWidth:e.tableMinWidth,width:e.clientWidth}},e.tableColGroupNode,x("tbody",{role:"presentation"},x("tr",{role:"row"},e.axis&&x("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},x("div",{className:"fc-timegrid-col-frame"},x("div",{className:"fc-timegrid-now-indicator-container"},typeof n=="number"&&x(If,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:n},isAxis:!0,date:e.nowDate})))),e.cells.map((p,m)=>x(YC,{key:p.key,elRef:this.cellElRefs.createRef(p.key),dateProfile:e.dateProfile,date:p.date,nowDate:e.nowDate,todayRange:e.todayRange,extraRenderProps:p.extraRenderProps,extraDataAttrs:p.extraDataAttrs,extraClassNames:p.extraClassNames,extraDateSpan:p.extraDateSpan,fgEventSegs:r[m],bgEventSegs:o[m],businessHourSegs:a[m],nowIndicatorSegs:l[m],dateSelectionSegs:c[m],eventDrag:d[m],eventResize:h[m],slatCoords:e.slatCoords,eventSelection:e.eventSelection,forPrint:e.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:e}=this;e.onColCoords&&e.clientWidth!==null&&e.onColCoords(new Yn(this.rootElRef.current,FV(this.cellElRefs.currentMap,e.cells),!0,!1))}};function FV(i,e){return e.map(t=>i[t.key])}var JC=class extends rt{constructor(){super(...arguments),this.processSlotOptions=$(LV),this.state={slatCoords:null},this.handleRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=e=>{let{onScrollTopRequest:t}=this.props,{slatCoords:n}=this.state;if(t&&n){if(e.time){let s=n.computeTimeTop(e.time);s=Math.ceil(s),s&&(s+=1),t(s)}return!0}return!1},this.handleColCoords=e=>{this.colCoords=e},this.handleSlatCoords=e=>{this.setState({slatCoords:e}),this.props.onSlatCoords&&this.props.onSlatCoords(e)}}render(){let{props:e,state:t}=this;return x("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:e.clientWidth,minWidth:e.tableMinWidth}},x(qC,{axis:e.axis,dateProfile:e.dateProfile,slatMetas:e.slatMetas,clientWidth:e.clientWidth,minHeight:e.expandRows?e.clientHeight:"",tableMinWidth:e.tableMinWidth,tableColGroupNode:e.axis?e.tableColGroupNode:null,onCoords:this.handleSlatCoords}),x(KC,{cells:e.cells,axis:e.axis,dateProfile:e.dateProfile,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange,nowDate:e.nowDate,nowIndicatorSegs:e.nowIndicatorSegs,clientWidth:e.clientWidth,tableMinWidth:e.tableMinWidth,tableColGroupNode:e.tableColGroupNode,slatCoords:t.slatCoords,onColCoords:this.handleColCoords,forPrint:e.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(e){this.scrollResponder.update(e.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(e,t){let{dateEnv:n,options:s}=this.context,{colCoords:r}=this,{dateProfile:o}=this.props,{slatCoords:a}=this.state,{snapDuration:l,snapsPerSlot:c}=this.processSlotOptions(this.props.slotDuration,s.snapDuration),d=r.leftToIndex(e),h=a.positions.topToIndex(t);if(d!=null&&h!=null){let p=this.props.cells[d],m=a.positions.tops[h],y=a.positions.getHeight(h),v=(t-m)/y,E=Math.floor(v*c),S=h*c+E,C=this.props.cells[d].date,_=yf(o.slotMinTime,BA(l,S)),T=n.add(C,_),R=n.add(T,l);return{dateProfile:o,dateSpan:Object.assign({range:{start:T,end:R},allDay:!1},p.extraDateSpan),dayEl:r.els[d],rect:{left:r.lefts[d],right:r.rights[d],top:m,bottom:m+y},layer:0}}return null}};function LV(i,e){let t=e||i,n=vf(i,t);return n===null&&(t=i,n=1),{snapDuration:t,snapsPerSlot:n}}var XC=class extends ha{sliceRange(e,t){let n=[];for(let s=0;s<t.length;s+=1){let r=sn(e,t[s]);r&&n.push({start:r.start,end:r.end,isStart:r.start.valueOf()===e.start.valueOf(),isEnd:r.end.valueOf()===e.end.valueOf(),col:s})}return n}},ZC=class extends rt{constructor(){super(...arguments),this.buildDayRanges=$(OV),this.slicer=new XC,this.timeColsRef=Ne()}render(){let{props:e,context:t}=this,{dateProfile:n,dayTableModel:s}=e,{nowIndicator:r,nextDayThreshold:o}=t.options,a=this.buildDayRanges(s,n,t.dateEnv);return x(Ot,{unit:r?"minute":"day"},(l,c)=>x(JC,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(e,n,null,t,a),{forPrint:e.forPrint,axis:e.axis,dateProfile:n,slatMetas:e.slatMetas,slotDuration:e.slotDuration,cells:s.cells[0],tableColGroupNode:e.tableColGroupNode,tableMinWidth:e.tableMinWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight,expandRows:e.expandRows,nowDate:l,nowIndicatorSegs:r&&this.slicer.sliceNowDate(l,n,o,t,a),todayRange:c,onScrollTopRequest:e.onScrollTopRequest,onSlatCoords:e.onSlatCoords})))}};function OV(i,e,t){let n=[];for(let s of i.headerDates)n.push({start:t.add(s,e.slotMinTime),end:t.add(s,e.slotMaxTime)});return n}var wP=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function UV(i,e,t,n,s){let r=new Date(0),o=i,a=te(0),l=t||HV(n),c=[];for(;nn(o)<nn(e);){let d=s.add(r,o),h=vf(a,l)!==null;c.push({date:d,time:o,key:d.toISOString(),isoTimeStr:zA(d),isLabeled:h}),o=yf(o,n),a=yf(a,n)}return c}function HV(i){let e,t,n;for(e=wP.length-1;e>=0;e-=1)if(t=te(wP[e]),n=vf(t,i),n!==null&&n>1)return t;return i}var nb=class extends VC{constructor(){super(...arguments),this.buildTimeColsModel=$(BV),this.buildSlatMetas=$(UV)}render(){let{options:e,dateEnv:t,dateProfileGenerator:n}=this.context,{props:s}=this,{dateProfile:r}=s,o=this.buildTimeColsModel(r,n),a=this.allDaySplitter.splitProps(s),l=this.buildSlatMetas(r.slotMinTime,r.slotMaxTime,e.slotLabelInterval,e.slotDuration,t),{dayMinWidth:c}=e,d=!c,h=c,p=e.dayHeaders&&x(ca,{dates:o.headerDates,dateProfile:r,datesRepDistinctDays:!0,renderIntro:d?this.renderHeadAxis:null}),m=e.allDaySlot!==!1&&(v=>x(kf,Object.assign({},a.allDay,{dateProfile:r,dayTableModel:o,nextDayThreshold:e.nextDayThreshold,tableMinWidth:v.tableMinWidth,colGroupNode:v.tableColGroupNode,renderRowIntro:d?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:v.clientWidth,clientHeight:v.clientHeight,forPrint:s.forPrint},this.getAllDayMaxEventProps()))),y=v=>x(ZC,Object.assign({},a.timed,{dayTableModel:o,dateProfile:r,axis:d,slotDuration:e.slotDuration,slatMetas:l,forPrint:s.forPrint,tableColGroupNode:v.tableColGroupNode,tableMinWidth:v.tableMinWidth,clientWidth:v.clientWidth,clientHeight:v.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:v.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return h?this.renderHScrollLayout(p,m,y,o.colCnt,c,l,this.state.slatCoords):this.renderSimpleLayout(p,m,y)}};function BV(i,e){let t=new da(i.renderRange,e);return new ua(t,!1)}var GV='.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}';vr(GV);var VV={allDaySlot:Boolean},CP=Ht({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:VV,views:{timeGrid:{component:nb,usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});var QC=class extends ne{constructor(){super(...arguments),this.state={textId:En()}}render(){let{theme:e,dateEnv:t,options:n,viewApi:s}=this.context,{cellId:r,dayDate:o,todayRange:a}=this.props,{textId:l}=this.state,c=Cf(o,a),d=n.listDayFormat?t.format(o,n.listDayFormat):"",h=n.listDaySideFormat?t.format(o,n.listDaySideFormat):"",p=Object.assign({date:t.toDate(o),view:s,textId:l,text:d,sideText:h,navLinkAttrs:Ti(this.context,o),sideNavLinkAttrs:Ti(this.context,o,"day",!1)},c);return x(xe,{elTag:"tr",elClasses:["fc-list-day",...Nc(c,e)],elAttrs:{"data-date":br(o)},renderProps:p,generatorName:"dayHeaderContent",customGenerator:n.dayHeaderContent,defaultGenerator:$V,classNameGenerator:n.dayHeaderClassNames,didMount:n.dayHeaderDidMount,willUnmount:n.dayHeaderWillUnmount},m=>x("th",{scope:"colgroup",colSpan:3,id:r,"aria-labelledby":l},x(m,{elTag:"div",elClasses:["fc-list-day-cushion",e.getClass("tableCellShaded")]})))}};function $V(i){return x(ae,null,i.text&&x("a",Object.assign({id:i.textId,className:"fc-list-day-text"},i.navLinkAttrs),i.text),i.sideText&&x("a",Object.assign({"aria-hidden":!0,className:"fc-list-day-side-text"},i.sideNavLinkAttrs),i.sideText))}var zV=ue({hour:"numeric",minute:"2-digit",meridiem:"short"}),e_=class extends ne{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s,timeHeaderId:r,eventHeaderId:o,dateHeaderId:a}=e,l=n.eventTimeFormat||zV;return x(ms,Object.assign({},e,{elTag:"tr",elClasses:["fc-list-event",s.eventRange.def.url&&"fc-event-forced-url"],defaultGenerator:()=>qV(s,t),seg:s,timeText:"",disableDragging:!0,disableResizing:!0}),(c,d)=>x(ae,null,WV(s,l,t,r,a),x("td",{"aria-hidden":!0,className:"fc-list-event-graphic"},x("span",{className:"fc-list-event-dot",style:{borderColor:d.borderColor||d.backgroundColor}})),x(c,{elTag:"td",elClasses:["fc-list-event-title"],elAttrs:{headers:`${o} ${a}`}})))}};function qV(i,e){let t=Mc(i,e);return x("a",Object.assign({},t),i.eventRange.def.title)}function WV(i,e,t,n,s){let{options:r}=t;if(r.displayEventTime!==!1){let o=i.eventRange.def,a=i.eventRange.instance,l=!1,c;if(o.allDay?l=!0:QA(i.eventRange.range)?i.isStart?c=Sr(i,e,t,null,null,a.range.start,i.end):i.isEnd?c=Sr(i,e,t,null,null,i.start,a.range.end):l=!0:c=Sr(i,e,t),l){let d={text:t.options.allDayText,view:t.viewApi};return x(xe,{elTag:"td",elClasses:["fc-list-event-time"],elAttrs:{headers:`${n} ${s}`},renderProps:d,generatorName:"allDayContent",customGenerator:r.allDayContent,defaultGenerator:YV,classNameGenerator:r.allDayClassNames,didMount:r.allDayDidMount,willUnmount:r.allDayWillUnmount})}return x("td",{className:"fc-list-event-time"},c)}return null}function YV(i){return i.text}var ib=class extends rt{constructor(){super(...arguments),this.computeDateVars=$(JV),this.eventStoreToSegs=$(this._eventStoreToSegs),this.state={timeHeaderId:En(),eventHeaderId:En(),dateHeaderIdRoot:En()},this.setRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e}):this.context.unregisterInteractiveComponent(this)}}render(){let{props:e,context:t}=this,{dayDates:n,dayRanges:s}=this.computeDateVars(e.dateProfile),r=this.eventStoreToSegs(e.eventStore,e.eventUiBases,s);return x(qn,{elRef:this.setRootEl,elClasses:["fc-list",t.theme.getClass("table"),t.options.stickyHeaderDates!==!1?"fc-list-sticky":""],viewSpec:t.viewSpec},x(xc,{liquid:!e.isHeightAuto,overflowX:e.isHeightAuto?"visible":"hidden",overflowY:e.isHeightAuto?"visible":"auto"},r.length>0?this.renderSegList(r,n):this.renderEmptyMessage()))}renderEmptyMessage(){let{options:e,viewApi:t}=this.context,n={text:e.noEventsText,view:t};return x(xe,{elTag:"div",elClasses:["fc-list-empty"],renderProps:n,generatorName:"noEventsContent",customGenerator:e.noEventsContent,defaultGenerator:KV,classNameGenerator:e.noEventsClassNames,didMount:e.noEventsDidMount,willUnmount:e.noEventsWillUnmount},s=>x(s,{elTag:"div",elClasses:["fc-list-empty-cushion"]}))}renderSegList(e,t){let{theme:n,options:s}=this.context,{timeHeaderId:r,eventHeaderId:o,dateHeaderIdRoot:a}=this.state,l=XV(e);return x(Ot,{unit:"day"},(c,d)=>{let h=[];for(let p=0;p<l.length;p+=1){let m=l[p];if(m){let y=br(t[p]),v=a+"-"+y;h.push(x(QC,{key:y,cellId:v,dayDate:t[p],todayRange:d})),m=ma(m,s.eventOrder);for(let E of m)h.push(x(e_,Object.assign({key:y+":"+E.eventRange.instance.instanceId,seg:E,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,timeHeaderId:r,eventHeaderId:o,dateHeaderId:v},on(E,d,c))))}}return x("table",{className:"fc-list-table "+n.getClass("table")},x("thead",null,x("tr",null,x("th",{scope:"col",id:r},s.timeHint),x("th",{scope:"col","aria-hidden":!0}),x("th",{scope:"col",id:o},s.eventHint))),x("tbody",null,h))})}_eventStoreToSegs(e,t,n){return this.eventRangesToSegs(Tc(e,t,this.props.dateProfile.activeRange,this.context.options.nextDayThreshold).fg,n)}eventRangesToSegs(e,t){let n=[];for(let s of e)n.push(...this.eventRangeToSegs(s,t));return n}eventRangeToSegs(e,t){let{dateEnv:n}=this.context,{nextDayThreshold:s}=this.context.options,r=e.range,o=e.def.allDay,a,l,c,d=[];for(a=0;a<t.length;a+=1)if(l=sn(r,t[a]),l&&(c={component:this,eventRange:e,start:l.start,end:l.end,isStart:e.isStart&&l.start.valueOf()===r.start.valueOf(),isEnd:e.isEnd&&l.end.valueOf()===r.end.valueOf(),dayIndex:a},d.push(c),!c.isEnd&&!o&&a+1<t.length&&r.end<n.add(t[a+1].start,s))){c.end=r.end,c.isEnd=!0;break}return d}};function KV(i){return i.text}function JV(i){let e=de(i.renderRange.start),t=i.renderRange.end,n=[],s=[];for(;e<t;)n.push(e),s.push({start:e,end:Ee(e,1)}),e=Ee(e,1);return{dayDates:n,dayRanges:s}}function XV(i){let e=[],t,n;for(t=0;t<i.length;t+=1)n=i[t],(e[n.dayIndex]||(e[n.dayIndex]=[])).push(n);return e}var ZV=':root{--fc-list-event-dot-width:10px;--fc-list-event-hover-bg-color:#f5f5f5}.fc-theme-standard .fc-list{border:1px solid var(--fc-border-color)}.fc .fc-list-empty{align-items:center;background-color:var(--fc-neutral-bg-color);display:flex;height:100%;justify-content:center}.fc .fc-list-empty-cushion{margin:5em 0}.fc .fc-list-table{border-style:hidden;width:100%}.fc .fc-list-table tr>*{border-left:0;border-right:0}.fc .fc-list-sticky .fc-list-day>*{background:var(--fc-page-bg-color);position:sticky;top:0}.fc .fc-list-table thead{left:-10000px;position:absolute}.fc .fc-list-table tbody>tr:first-child th{border-top:0}.fc .fc-list-table th{padding:0}.fc .fc-list-day-cushion,.fc .fc-list-table td{padding:8px 14px}.fc .fc-list-day-cushion:after{clear:both;content:"";display:table}.fc-theme-standard .fc-list-day-cushion{background-color:var(--fc-neutral-bg-color)}.fc-direction-ltr .fc-list-day-text,.fc-direction-rtl .fc-list-day-side-text{float:left}.fc-direction-ltr .fc-list-day-side-text,.fc-direction-rtl .fc-list-day-text{float:right}.fc-direction-ltr .fc-list-table .fc-list-event-graphic{padding-right:0}.fc-direction-rtl .fc-list-table .fc-list-event-graphic{padding-left:0}.fc .fc-list-event.fc-event-forced-url{cursor:pointer}.fc .fc-list-event:hover td{background-color:var(--fc-list-event-hover-bg-color)}.fc .fc-list-event-graphic,.fc .fc-list-event-time{white-space:nowrap;width:1px}.fc .fc-list-event-dot{border:calc(var(--fc-list-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-list-event-dot-width)/2);box-sizing:content-box;display:inline-block;height:0;width:0}.fc .fc-list-event-title a{color:inherit;text-decoration:none}.fc .fc-list-event.fc-event-forced-url:hover a{text-decoration:underline}';vr(ZV);var jV={listDayFormat:_P,listDaySideFormat:_P,noEventsClassNames:P,noEventsContent:P,noEventsDidMount:P,noEventsWillUnmount:P};function _P(i){return i===!1?null:ue(i)}var TP=Ht({name:"@fullcalendar/list",optionRefiners:jV,views:{list:{component:ib,buttonTextKey:"list",listDayFormat:{month:"long",day:"numeric",year:"numeric"}},listDay:{type:"list",duration:{days:1},listDayFormat:{weekday:"long"}},listWeek:{type:"list",duration:{weeks:1},listDayFormat:{weekday:"long"},listDaySideFormat:{month:"long",day:"numeric",year:"numeric"}},listMonth:{type:"list",duration:{month:1},listDaySideFormat:{weekday:"long"}},listYear:{type:"list",duration:{year:1},listDaySideFormat:{weekday:"long"}}}});xf.touchMouseIgnoreWait=500;var t_=0,sb=0,n_=!1,rb=class{constructor(e){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=t=>{if(!this.shouldIgnoreMouse()&&QV(t)&&this.tryStart(t)){let n=this.createEventFromMouse(t,!0);this.emitter.trigger("pointerdown",n),this.initScrollWatch(n),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=t=>{let n=this.createEventFromMouse(t);this.recordCoords(n),this.emitter.trigger("pointermove",n)},this.handleMouseUp=t=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(t)),this.cleanup()},this.handleTouchStart=t=>{if(this.tryStart(t)){this.isTouchDragging=!0;let n=this.createEventFromTouch(t,!0);this.emitter.trigger("pointerdown",n),this.initScrollWatch(n);let s=t.target;this.shouldIgnoreMove||s.addEventListener("touchmove",this.handleTouchMove),s.addEventListener("touchend",this.handleTouchEnd),s.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=t=>{let n=this.createEventFromTouch(t);this.recordCoords(n),this.emitter.trigger("pointermove",n)},this.handleTouchEnd=t=>{if(this.isDragging){let n=t.target;n.removeEventListener("touchmove",this.handleTouchMove),n.removeEventListener("touchend",this.handleTouchEnd),n.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(t)),this.cleanup(),this.isTouchDragging=!1,e$()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=t=>{if(!this.shouldIgnoreMove){let n=window.scrollX-this.prevScrollX+this.prevPageX,s=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:t,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:n,pageY:s,deltaX:n-this.origPageX,deltaY:s-this.origPageY})}},this.containerEl=e,this.emitter=new gs,e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),t$()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),n$()}tryStart(e){let t=this.querySubjectEl(e),n=e.target;return t&&(!this.handleSelector||Ge(n,this.handleSelector))?(this.subjectEl=t,this.isDragging=!0,this.wasTouchScroll=!1,!0):!1}cleanup(){n_=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(e){return this.selector?Ge(e.target,this.selector):this.containerEl}shouldIgnoreMouse(){return t_||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(n_=!0)}initScrollWatch(e){this.shouldWatchScroll&&(this.recordCoords(e),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(e){this.shouldWatchScroll&&(this.prevPageX=e.pageX,this.prevPageY=e.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(e,t){let n=0,s=0;return t?(this.origPageX=e.pageX,this.origPageY=e.pageY):(n=e.pageX-this.origPageX,s=e.pageY-this.origPageY),{origEvent:e,isTouch:!1,subjectEl:this.subjectEl,pageX:e.pageX,pageY:e.pageY,deltaX:n,deltaY:s}}createEventFromTouch(e,t){let n=e.touches,s,r,o=0,a=0;return n&&n.length?(s=n[0].pageX,r=n[0].pageY):(s=e.pageX,r=e.pageY),t?(this.origPageX=s,this.origPageY=r):(o=s-this.origPageX,a=r-this.origPageY),{origEvent:e,isTouch:!0,subjectEl:this.subjectEl,pageX:s,pageY:r,deltaX:o,deltaY:a}}};function QV(i){return i.button===0&&!i.ctrlKey}function e$(){t_+=1,setTimeout(()=>{t_-=1},xf.touchMouseIgnoreWait)}function t$(){sb+=1,sb===1&&window.addEventListener("touchmove",RP,{passive:!1})}function n$(){sb-=1,sb||window.removeEventListener("touchmove",RP,{passive:!1})}function RP(i){n_&&i.preventDefault()}var i_=class{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(e,t,n){this.sourceEl=e,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=t-window.scrollX,this.origScreenY=n-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(e,t){this.deltaX=e-window.scrollX-this.origScreenX,this.deltaY=t-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(e){e?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=e,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=e)}stop(e,t){let n=()=>{this.cleanup(),t()};e&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(n,this.revertDuration):setTimeout(n,0)}doRevertAnimation(e,t){let n=this.mirrorEl,s=this.sourceEl.getBoundingClientRect();n.style.transition="top "+t+"ms,left "+t+"ms",ga(n,{left:s.left,top:s.top}),NA(n,()=>{n.style.transition="",e()})}cleanup(){this.mirrorEl&&(ff(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&ga(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let e=this.sourceElRect,t=this.mirrorEl;return t||(t=this.mirrorEl=this.sourceEl.cloneNode(!0),t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.pointerEvents="none",t.classList.add("fc-event-dragging"),ga(t,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:e.right-e.left,height:e.bottom-e.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(t)),t}},ob=class extends aa{constructor(e,t){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=e,this.doesListening=t,this.scrollTop=this.origScrollTop=e.getScrollTop(),this.scrollLeft=this.origScrollLeft=e.getScrollLeft(),this.scrollWidth=e.getScrollWidth(),this.scrollHeight=e.getScrollHeight(),this.clientWidth=e.getClientWidth(),this.clientHeight=e.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(e){this.scrollController.setScrollTop(e),this.doesListening||(this.scrollTop=Math.max(Math.min(e,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(e){this.scrollController.setScrollLeft(e),this.doesListening||(this.scrollLeft=Math.max(Math.min(e,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}},ab=class extends ob{constructor(e,t){super(new lf(e),t)}getEventTarget(){return this.scrollController.el}computeClientRect(){return yC(this.scrollController.el)}},s_=class extends ob{constructor(e){super(new cf,e)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}},xP=typeof performance=="function"?performance.now:Date.now,r_=class{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let e=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(e){let t=xP();this.handleSide(e,(t-this.msSinceRequest)/1e3),this.requestAnimation(t)}else this.isAnimating=!1}}}start(e,t,n){this.isEnabled&&(this.scrollCaches=this.buildCaches(n),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(e,t))}handleMove(e,t){if(this.isEnabled){let n=e-window.scrollX,s=t-window.scrollY,r=this.pointerScreenY===null?0:s-this.pointerScreenY,o=this.pointerScreenX===null?0:n-this.pointerScreenX;r<0?this.everMovedUp=!0:r>0&&(this.everMovedDown=!0),o<0?this.everMovedLeft=!0:o>0&&(this.everMovedRight=!0),this.pointerScreenX=n,this.pointerScreenY=s,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(xP()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let e of this.scrollCaches)e.destroy();this.scrollCaches=null}}requestAnimation(e){this.msSinceRequest=e,requestAnimationFrame(this.animate)}handleSide(e,t){let{scrollCache:n}=e,{edgeThreshold:s}=this,r=s-e.distance,o=r*r/(s*s)*this.maxVelocity*t,a=1;switch(e.name){case"left":a=-1;case"right":n.setScrollLeft(n.getScrollLeft()+o*a);break;case"top":a=-1;case"bottom":n.setScrollTop(n.getScrollTop()+o*a);break}}computeBestEdge(e,t){let{edgeThreshold:n}=this,s=null,r=this.scrollCaches||[];for(let o of r){let a=o.clientRect,l=e-a.left,c=a.right-e,d=t-a.top,h=a.bottom-t;l>=0&&c>=0&&d>=0&&h>=0&&(d<=n&&this.everMovedUp&&o.canScrollUp()&&(!s||s.distance>d)&&(s={scrollCache:o,name:"top",distance:d}),h<=n&&this.everMovedDown&&o.canScrollDown()&&(!s||s.distance>h)&&(s={scrollCache:o,name:"bottom",distance:h}),l<=n&&this.everMovedLeft&&o.canScrollLeft()&&(!s||s.distance>l)&&(s={scrollCache:o,name:"left",distance:l}),c<=n&&this.everMovedRight&&o.canScrollRight()&&(!s||s.distance>c)&&(s={scrollCache:o,name:"right",distance:c}))}return s}buildCaches(e){return this.queryScrollEls(e).map(t=>t===window?new s_(!1):new ab(t,!1))}queryScrollEls(e){let t=[];for(let n of this.scrollQuery)typeof n=="object"?t.push(n):t.push(...Array.prototype.slice.call(e.getRootNode().querySelectorAll(n)));return t}},va=class extends hf{constructor(e,t){super(e),this.containerEl=e,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=s=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,FA(document.body),OA(document.body),s.isTouch||s.origEvent.preventDefault(),this.emitter.trigger("pointerdown",s),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(s.subjectEl,s.pageX,s.pageY),this.startDelay(s),this.minDistance||this.handleDistanceSurpassed(s)))},this.onPointerMove=s=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",s),!this.isDistanceSurpassed){let r=this.minDistance,o,{deltaX:a,deltaY:l}=s;o=a*a+l*l,o>=r*r&&this.handleDistanceSurpassed(s)}this.isDragging&&(s.origEvent.type!=="scroll"&&(this.mirror.handleMove(s.pageX,s.pageY),this.autoScroller.handleMove(s.pageX,s.pageY)),this.emitter.trigger("dragmove",s))}},this.onPointerUp=s=>{this.isInteracting&&(this.isInteracting=!1,LA(document.body),UA(document.body),this.emitter.trigger("pointerup",s),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(s)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let n=this.pointer=new rb(e);n.emitter.on("pointerdown",this.onPointerDown),n.emitter.on("pointermove",this.onPointerMove),n.emitter.on("pointerup",this.onPointerUp),t&&(n.selector=t),this.mirror=new i_,this.autoScroller=new r_}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(e){typeof this.delay=="number"?this.delayTimeoutId=setTimeout(()=>{this.delayTimeoutId=null,this.handleDelayEnd(e)},this.delay):this.handleDelayEnd(e)}handleDelayEnd(e){this.isDelayEnded=!0,this.tryStartDrag(e)}handleDistanceSurpassed(e){this.isDistanceSurpassed=!0,this.tryStartDrag(e)}tryStartDrag(e){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(e.pageX,e.pageY,this.containerEl),this.emitter.trigger("dragstart",e),this.touchScrollAllowed===!1&&this.pointer.cancelTouchScroll())}tryStopDrag(e){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,e))}stopDrag(e){this.isDragging=!1,this.emitter.trigger("dragend",e)}setIgnoreMove(e){this.pointer.shouldIgnoreMove=e}setMirrorIsVisible(e){this.mirror.setIsVisible(e)}setMirrorNeedsRevert(e){this.mirrorNeedsRevert=e}setAutoScrollEnabled(e){this.autoScroller.isEnabled=e}},o_=class{constructor(e){this.el=e,this.origRect=_f(e),this.scrollCaches=$v(e).map(t=>new ab(t,!0))}destroy(){for(let e of this.scrollCaches)e.destroy()}computeLeft(){let e=this.origRect.left;for(let t of this.scrollCaches)e+=t.origScrollLeft-t.getScrollLeft();return e}computeTop(){let e=this.origRect.top;for(let t of this.scrollCaches)e+=t.origScrollTop-t.getScrollTop();return e}isWithinClipping(e,t){let n={left:e,top:t};for(let s of this.scrollCaches)if(!i$(s.getEventTarget())&&!fC(n,s.clientRect))return!1;return!0}};function i$(i){let e=i.tagName;return e==="HTML"||e==="BODY"}var Uc=class{constructor(e,t){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=n=>{let{dragging:s}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(n),this.initialHit||!this.requireInitial?(s.setIgnoreMove(!1),this.emitter.trigger("pointerdown",n)):s.setIgnoreMove(!0)},this.handleDragStart=n=>{this.emitter.trigger("dragstart",n),this.handleMove(n,!0)},this.handleDragMove=n=>{this.emitter.trigger("dragmove",n),this.handleMove(n)},this.handlePointerUp=n=>{this.releaseHits(),this.emitter.trigger("pointerup",n)},this.handleDragEnd=n=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,n),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",n)},this.droppableStore=t,e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragstart",this.handleDragStart),e.emitter.on("dragmove",this.handleDragMove),e.emitter.on("pointerup",this.handlePointerUp),e.emitter.on("dragend",this.handleDragEnd),this.dragging=e,this.emitter=new gs}processFirstCoord(e){let t={left:e.pageX,top:e.pageY},n=t,s=e.subjectEl,r;s instanceof HTMLElement&&(r=_f(s),n=pC(n,r));let o=this.initialHit=this.queryHitForOffset(n.left,n.top);if(o){if(this.useSubjectCenter&&r){let a=Vv(r,o.rect);a&&(n=gC(a))}this.coordAdjust=mC(n,t)}else this.coordAdjust={left:0,top:0}}handleMove(e,t){let n=this.queryHitForOffset(e.pageX+this.coordAdjust.left,e.pageY+this.coordAdjust.top);(t||!lb(this.movingHit,n))&&(this.movingHit=n,this.emitter.trigger("hitupdate",n,!1,e))}prepareHits(){this.offsetTrackers=bn(this.droppableStore,e=>(e.component.prepareHits(),new o_(e.el)))}releaseHits(){let{offsetTrackers:e}=this;for(let t in e)e[t].destroy();this.offsetTrackers={}}queryHitForOffset(e,t){let{droppableStore:n,offsetTrackers:s}=this,r=null;for(let o in n){let a=n[o].component,l=s[o];if(l&&l.isWithinClipping(e,t)){let c=l.computeLeft(),d=l.computeTop(),h=e-c,p=t-d,{origRect:m}=l,y=m.right-m.left,v=m.bottom-m.top;if(h>=0&&h<y&&p>=0&&p<v){let E=a.queryHit(h,p,y,v);E&&Dc(E.dateProfile.activeRange,E.dateSpan.range)&&(this.disablePointCheck||l.el.contains(l.el.getRootNode().elementFromPoint(h+c-window.scrollX,p+d-window.scrollY)))&&(!r||E.layer>r.layer)&&(E.componentId=o,E.context=a.context,E.rect.left+=c,E.rect.right+=c,E.rect.top+=d,E.rect.bottom+=d,r=E)}}}return r}};function lb(i,e){return!i&&!e?!0:!!i!=!!e?!1:lC(i.dateSpan,e.dateSpan)}function IP(i,e){let t={};for(let n of e.pluginHooks.datePointTransforms)Object.assign(t,n(i,e));return Object.assign(t,s$(i,e.dateEnv)),t}function s$(i,e){return{date:e.toDate(i.range.start),dateStr:e.formatIso(i.range.start,{omitTime:i.allDay}),allDay:i.allDay}}var a_=class extends Wn{constructor(e){super(e),this.handlePointerDown=n=>{let{dragging:s}=this,r=n.origEvent.target;s.setIgnoreMove(!this.component.isValidDateDownEl(r))},this.handleDragEnd=n=>{let{component:s}=this,{pointer:r}=this.dragging;if(!r.wasTouchScroll){let{initialHit:o,finalHit:a}=this.hitDragging;if(o&&a&&lb(o,a)){let{context:l}=s,c=Object.assign(Object.assign({},IP(o.dateSpan,l)),{dayEl:o.dayEl,jsEvent:n.origEvent,view:l.viewApi||l.calendarApi.view});l.emitter.trigger("dateClick",c)}}},this.dragging=new va(e.el),this.dragging.autoScroller.isEnabled=!1;let t=this.hitDragging=new Uc(this.dragging,Af(e));t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}},l_=class extends Wn{constructor(e){super(e),this.dragSelection=null,this.handlePointerDown=o=>{let{component:a,dragging:l}=this,{options:c}=a.context,d=c.selectable&&a.isValidDateDownEl(o.origEvent.target);l.setIgnoreMove(!d),l.delay=o.isTouch?r$(a):null},this.handleDragStart=o=>{this.component.context.calendarApi.unselect(o)},this.handleHitUpdate=(o,a)=>{let{context:l}=this.component,c=null,d=!1;if(o){let h=this.hitDragging.initialHit;o.componentId===h.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(h,o)||(c=o$(h,o,l.pluginHooks.dateSelectionTransformers)),(!c||!bC(c,o.dateProfile,l))&&(d=!0,c=null)}c?l.dispatch({type:"SELECT_DATES",selection:c}):a||l.dispatch({type:"UNSELECT_DATES"}),d?gf():mf(),a||(this.dragSelection=c)},this.handlePointerUp=o=>{this.dragSelection&&(Gv(this.dragSelection,o,this.component.context),this.dragSelection=null)};let{component:t}=e,{options:n}=t.context,s=this.dragging=new va(e.el);s.touchScrollAllowed=!1,s.minDistance=n.selectMinDistance||0,s.autoScroller.isEnabled=n.dragScroll;let r=this.hitDragging=new Uc(this.dragging,Af(e));r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}};function r$(i){let{options:e}=i.context,t=e.selectLongPressDelay;return t==null&&(t=e.longPressDelay),t}function o$(i,e,t){let n=i.dateSpan,s=e.dateSpan,r=[n.range.start,n.range.end,s.range.start,s.range.end];r.sort(HA);let o={};for(let a of t){let l=a(i,e);if(l===!1)return null;l&&Object.assign(o,l)}return o.range={start:r[0],end:r[3]},o.allDay=n.allDay,o}var Ff=class i extends Wn{constructor(e){super(e),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=o=>{let a=o.origEvent.target,{component:l,dragging:c}=this,{mirror:d}=c,{options:h}=l.context,p=l.context;this.subjectEl=o.subjectEl;let m=this.subjectSeg=vs(o.subjectEl),v=(this.eventRange=m.eventRange).instance.instanceId;this.relevantEvents=Ef(p.getCurrentData().eventStore,v),c.minDistance=o.isTouch?0:h.eventDragMinDistance,c.delay=o.isTouch&&v!==l.props.eventSelection?l$(l):null,h.fixedMirrorParent?d.parentNode=h.fixedMirrorParent:d.parentNode=Ge(a,".fc"),d.revertDuration=h.dragRevertDuration;let E=l.isValidSegDownEl(a)&&!Ge(a,".fc-event-resizer");c.setIgnoreMove(!E),this.isDragging=E&&o.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=o=>{let a=this.component.context,l=this.eventRange,c=l.instance.instanceId;o.isTouch?c!==this.component.props.eventSelection&&a.dispatch({type:"SELECT_EVENT",eventInstanceId:c}):a.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(a.calendarApi.unselect(o),a.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new me(a,l.def,l.instance),jsEvent:o.origEvent,view:a.viewApi}))},this.handleHitUpdate=(o,a)=>{if(!this.isDragging)return;let l=this.relevantEvents,c=this.hitDragging.initialHit,d=this.component.context,h=null,p=null,m=null,y=!1,v={affectedEvents:l,mutatedEvents:yt(),isEvent:!0};if(o){h=o.context;let E=h.options;d===h||E.editable&&E.droppable?(p=a$(c,o,this.eventRange.instance.range.start,h.getCurrentData().pluginHooks.eventDragMutationMassagers),p&&(m=wf(l,h.getCurrentData().eventUiBases,p,h),v.mutatedEvents=m,zv(v,o.dateProfile,h)||(y=!0,p=null,m=null,v.mutatedEvents=yt()))):h=null}this.displayDrag(h,v),y?gf():mf(),a||(d===h&&lb(c,o)&&(p=null),this.dragging.setMirrorNeedsRevert(!p),this.dragging.setMirrorIsVisible(!o||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=h,this.validMutation=p,this.mutatedRelevantEvents=m)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=o=>{if(this.isDragging){let a=this.component.context,l=a.viewApi,{receivingContext:c,validMutation:d}=this,h=this.eventRange.def,p=this.eventRange.instance,m=new me(a,h,p),y=this.relevantEvents,v=this.mutatedRelevantEvents,{finalHit:E}=this.hitDragging;if(this.clearDrag(),a.emitter.trigger("eventDragStop",{el:this.subjectEl,event:m,jsEvent:o.origEvent,view:l}),d){if(c===a){let S=new me(a,v.defs[h.defId],p?v.instances[p.instanceId]:null);a.dispatch({type:"MERGE_EVENTS",eventStore:v});let C={oldEvent:m,event:S,relatedEvents:_i(v,a,p),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:y})}},_={};for(let T of a.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(_,T(d,a));a.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},C),_),{el:o.subjectEl,delta:d.datesDelta,jsEvent:o.origEvent,view:l})),a.emitter.trigger("eventChange",C)}else if(c){let S={event:m,relatedEvents:_i(y,a,p),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:y})}};a.emitter.trigger("eventLeave",Object.assign(Object.assign({},S),{draggedEl:o.subjectEl,view:l})),a.dispatch({type:"REMOVE_EVENTS",eventStore:y}),a.emitter.trigger("eventRemove",S);let C=v.defs[h.defId],_=v.instances[p.instanceId],T=new me(c,C,_);c.dispatch({type:"MERGE_EVENTS",eventStore:v});let R={event:T,relatedEvents:_i(v,c,_),revert(){c.dispatch({type:"REMOVE_EVENTS",eventStore:v})}};c.emitter.trigger("eventAdd",R),o.isTouch&&c.dispatch({type:"SELECT_EVENT",eventInstanceId:p.instanceId}),c.emitter.trigger("drop",Object.assign(Object.assign({},IP(E.dateSpan,c)),{draggedEl:o.subjectEl,jsEvent:o.origEvent,view:E.context.viewApi})),c.emitter.trigger("eventReceive",Object.assign(Object.assign({},R),{draggedEl:o.subjectEl,view:E.context.viewApi}))}}else a.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:t}=this,{options:n}=t.context,s=this.dragging=new va(e.el);s.pointer.selector=i.SELECTOR,s.touchScrollAllowed=!1,s.autoScroller.isEnabled=n.dragScroll;let r=this.hitDragging=new Uc(this.dragging,kc);r.useSubjectCenter=e.useEventCenter,r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("pointerup",this.handlePointerUp),r.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(e,t){let n=this.component.context,s=this.receivingContext;s&&s!==e&&(s===n?s.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:t.affectedEvents,mutatedEvents:yt(),isEvent:!0}}):s.dispatch({type:"UNSET_EVENT_DRAG"})),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){let e=this.component.context,{receivingContext:t}=this;t&&t.dispatch({type:"UNSET_EVENT_DRAG"}),e!==t&&e.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}};Ff.SELECTOR=".fc-event-draggable, .fc-event-resizable";function a$(i,e,t,n){let s=i.dateSpan,r=e.dateSpan,o=s.range.start,a=r.range.start,l={};s.allDay!==r.allDay&&(l.allDay=r.allDay,l.hasEnd=e.context.options.allDayMaintainDuration,r.allDay?o=de(t):o=t);let c=pr(o,a,i.context.dateEnv,i.componentId===e.componentId?i.largeUnit:null);c.milliseconds&&(l.allDay=!1);let d={datesDelta:c,standardProps:l};for(let h of n)h(d,i,e);return d}function l$(i){let{options:e}=i.context,t=e.eventLongPressDelay;return t==null&&(t=e.longPressDelay),t}var c_=class extends Wn{constructor(e){super(e),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=r=>{let{component:o}=this,a=this.querySegEl(r),l=vs(a),c=this.eventRange=l.eventRange;this.dragging.minDistance=o.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(r.origEvent.target)||r.isTouch&&this.component.props.eventSelection!==c.instance.instanceId)},this.handleDragStart=r=>{let{context:o}=this.component,a=this.eventRange;this.relevantEvents=Ef(o.getCurrentData().eventStore,this.eventRange.instance.instanceId);let l=this.querySegEl(r);this.draggingSegEl=l,this.draggingSeg=vs(l),o.calendarApi.unselect(),o.emitter.trigger("eventResizeStart",{el:l,event:new me(o,a.def,a.instance),jsEvent:r.origEvent,view:o.viewApi})},this.handleHitUpdate=(r,o,a)=>{let{context:l}=this.component,c=this.relevantEvents,d=this.hitDragging.initialHit,h=this.eventRange.instance,p=null,m=null,y=!1,v={affectedEvents:c,mutatedEvents:yt(),isEvent:!0};r&&(r.componentId===d.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(d,r)||(p=c$(d,r,a.subjectEl.classList.contains("fc-event-resizer-start"),h.range))),p&&(m=wf(c,l.getCurrentData().eventUiBases,p,l),v.mutatedEvents=m,zv(v,r.dateProfile,l)||(y=!0,p=null,m=null,v.mutatedEvents=null)),m?l.dispatch({type:"SET_EVENT_RESIZE",state:v}):l.dispatch({type:"UNSET_EVENT_RESIZE"}),y?gf():mf(),o||(p&&lb(d,r)&&(p=null),this.validMutation=p,this.mutatedRelevantEvents=m)},this.handleDragEnd=r=>{let{context:o}=this.component,a=this.eventRange.def,l=this.eventRange.instance,c=new me(o,a,l),d=this.relevantEvents,h=this.mutatedRelevantEvents;if(o.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:c,jsEvent:r.origEvent,view:o.viewApi}),this.validMutation){let p=new me(o,h.defs[a.defId],l?h.instances[l.instanceId]:null);o.dispatch({type:"MERGE_EVENTS",eventStore:h});let m={oldEvent:c,event:p,relatedEvents:_i(h,o,l),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:d})}};o.emitter.trigger("eventResize",Object.assign(Object.assign({},m),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||te(0),endDelta:this.validMutation.endDelta||te(0),jsEvent:r.origEvent,view:o.viewApi})),o.emitter.trigger("eventChange",m)}else o.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:t}=e,n=this.dragging=new va(e.el);n.pointer.selector=".fc-event-resizer",n.touchScrollAllowed=!1,n.autoScroller.isEnabled=t.context.options.dragScroll;let s=this.hitDragging=new Uc(this.dragging,Af(e));s.emitter.on("pointerdown",this.handlePointerDown),s.emitter.on("dragstart",this.handleDragStart),s.emitter.on("hitupdate",this.handleHitUpdate),s.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(e){return Ge(e.subjectEl,".fc-event")}};function c$(i,e,t,n){let s=i.context.dateEnv,r=i.dateSpan.range.start,o=e.dateSpan.range.start,a=pr(r,o,s,i.largeUnit);if(t){if(s.add(n.start,a)<n.end)return{startDelta:a}}else if(s.add(n.end,a)>n.start)return{endDelta:a};return null}var d_=class{constructor(e){this.context=e,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=n=>{n.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=n=>{let s=this.context.options.unselectCancel,r=Iv(n.origEvent);this.matchesCancel=!!Ge(r,s),this.matchesEvent=!!Ge(r,Ff.SELECTOR)},this.onDocumentPointerUp=n=>{let{context:s}=this,{documentPointer:r}=this,o=s.getCurrentData();if(!r.wasTouchScroll){if(o.dateSelection&&!this.isRecentPointerDateSelect){let a=s.options.unselectAuto;a&&(!a||!this.matchesCancel)&&s.calendarApi.unselect(n)}o.eventSelection&&!this.matchesEvent&&s.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let t=this.documentPointer=new rb(document);t.shouldIgnoreMove=!0,t.shouldWatchScroll=!1,t.emitter.on("pointerdown",this.onDocumentPointerDown),t.emitter.on("pointerup",this.onDocumentPointerUp),e.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}},d$={fixedMirrorParent:P},u$={dateClick:P,eventDragStart:P,eventDragStop:P,eventDrop:P,eventResizeStart:P,eventResizeStop:P,eventResize:P,drop:P,eventReceive:P,eventLeave:P};xf.dataAttrPrefix="";var DP=Ht({name:"@fullcalendar/interaction",componentInteractions:[a_,l_,Ff,c_],calendarInteractions:[d_],elementDraggingImpl:va,optionRefiners:d$,listenerRefiners:u$});var Lf=require("obsidian");var Of=class extends Lf.Modal{constructor(t,n,s,r){super(t);this.saveCallback=null;this.event=n,this.dataProvider=s,this.settings=r}onSave(t){this.saveCallback=t}onOpen(){var S,C,_;let{contentEl:t}=this;t.empty(),t.addClass("zfb-event-modal");let n={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"},s={note:"\uB178\uD2B8",schedule:"\uC77C\uC815",meeting:"\uD68C\uC758\uB85D"},r=t.createDiv({cls:"event-modal-header"});r.style.display="flex",r.style.alignItems="center",r.style.gap="12px",r.style.marginBottom="16px";let o=r.createEl("span",{text:`${n[this.event.type]} ${s[this.event.type]}`});o.style.padding="4px 8px",o.style.backgroundColor=this.event.color||"var(--interactive-accent)",o.style.color="var(--text-on-accent)",o.style.borderRadius="4px",o.style.fontSize="12px",r.createEl("h2",{text:this.event.title}).style.margin="0";let a=t.createDiv({cls:"event-details"});a.style.padding="16px",a.style.backgroundColor="var(--background-secondary)",a.style.borderRadius="8px",a.style.marginBottom="16px";let l=a.createDiv({cls:"detail-row"});l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginBottom="8px",l.createEl("span",{text:"\u{1F4C5}"});let c=Le(this.event.start,this.settings.timezone),d="";if(this.event.allDay)d=" (\uC885\uC77C)";else{let T=this.event.start.getHours().toString().padStart(2,"0"),R=this.event.start.getMinutes().toString().padStart(2,"0");d=` ${T}:${R}`}if(l.createEl("span",{text:c+d}),(S=this.event.metadata)!=null&&S.project){let T=a.createDiv({cls:"detail-row"});T.style.display="flex",T.style.alignItems="center",T.style.gap="8px",T.style.marginBottom="8px",T.createEl("span",{text:"\u{1F4C1}"}),T.createEl("span",{text:this.event.metadata.project})}if((C=this.event.metadata)!=null&&C.tags&&this.event.metadata.tags.length>0){let T=a.createDiv({cls:"detail-row"});T.style.display="flex",T.style.alignItems="center",T.style.gap="8px",T.style.marginBottom="8px",T.createEl("span",{text:"\u{1F3F7}"});let R=T.createDiv({cls:"tags"});R.style.display="flex",R.style.gap="4px",R.style.flexWrap="wrap";for(let I of this.event.metadata.tags){let D=R.createEl("span",{text:`#${I}`});D.style.padding="2px 6px",D.style.backgroundColor="var(--background-modifier-border)",D.style.borderRadius="4px",D.style.fontSize="12px"}}if((_=this.event.metadata)!=null&&_.summary){let T=a.createDiv({cls:"detail-row"});T.style.marginTop="12px",T.style.paddingTop="12px",T.style.borderTop="1px solid var(--background-modifier-border)",T.createEl("div",{text:"\uC694\uC57D"}).style.fontWeight="500",T.createEl("p",{text:this.event.metadata.summary}).style.margin="4px 0 0 0"}let h=a.createDiv({cls:"detail-row"});h.style.marginTop="12px",h.style.fontSize="12px",h.style.color="var(--text-muted)",h.setText(`\uD30C\uC77C: ${this.event.source.path}`),this.event.source.lineNumber&&h.appendText(` (\uB77C\uC778 ${this.event.source.lineNumber})`);let p=t.createDiv({cls:"modal-button-container"});p.style.display="flex",p.style.justifyContent="space-between",p.style.marginTop="16px";let m=p.createDiv();if(this.event.type==="schedule"&&this.event.source.lineNumber){let T=m.createEl("button",{text:"\uC0AD\uC81C"});T.style.color="var(--text-error)",T.addEventListener("click",async()=>{confirm("\uC774 \uC77C\uC815\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")&&(await this.dataProvider.deleteEvent(this.event.id)?(new Lf.Notice("\uC77C\uC815\uC774 \uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),this.saveCallback&&this.saveCallback(),this.close()):new Lf.Notice("\uC77C\uC815 \uC0AD\uC81C\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4."))})}let y=p.createDiv();y.style.display="flex",y.style.gap="8px",y.createEl("button",{text:"\uD30C\uC77C \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",async()=>{await this.dataProvider.openEvent(this.event.id),this.close()}),y.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}};var Hc="zfb-calendar",Uf=class extends PP.ItemView{constructor(t,n,s){super(t);this.calendar=null;this.refreshTimeout=null;this.isRefreshing=!1;this.settings=n,this.dataProvider=s,this.refreshCallback=()=>this.debouncedRefresh()}debouncedRefresh(){this.isRefreshing||(this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(async()=>{await this.refreshEvents()},1e3))}getViewType(){return Hc}getDisplayText(){return"Zero Friction \uCE98\uB9B0\uB354"}getIcon(){return"calendar"}async onOpen(){this.dataProvider.addChangeListener(this.refreshCallback);let t=this.contentEl;t.empty(),t.addClass("zfb-full-calendar");let n=t.createDiv({cls:"calendar-container"});n.style.height="100%",n.style.padding="16px",this.calendar=new Mf(n,this.getCalendarOptions()),this.calendar.render()}getCalendarOptions(){return{plugins:[yP,CP,TP,DP],initialView:this.getInitialView(),locale:"ko",firstDay:this.settings.calendarFirstDayOfWeek,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},buttonText:{today:"\uC624\uB298",month:"\uC6D4",week:"\uC8FC",day:"\uC77C",list:"\uBAA9\uB85D"},events:async(t,n)=>{let s=await this.loadEvents();n(s)},editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,eventOrder:(t,n)=>{var a,l,c,d;let s={schedule:0,note:1,meeting:2},r=((a=t.extendedProps)==null?void 0:a.type)||"note",o=((l=n.extendedProps)==null?void 0:l.type)||"note";return((c=s[r])!=null?c:2)-((d=s[o])!=null?d:2)},eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},eventClick:t=>{this.handleEventClick(t)},eventDrop:async t=>{await this.handleEventDrop(t)},select:t=>{this.handleDateSelect(t)},eventDidMount:t=>{let n=t.event,s=n.extendedProps;s!=null&&s.project&&(t.el.title=`${n.title}
\uD504\uB85C\uC81D\uD2B8: ${s.project}`)}}}async onClose(){this.refreshTimeout&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=null),this.dataProvider.removeChangeListener(this.refreshCallback),this.calendar&&(this.calendar.destroy(),this.calendar=null),this.contentEl.empty()}updateSettings(t){this.settings=t,this.calendar&&this.calendar.setOption("firstDay",t.calendarFirstDayOfWeek)}async refreshEvents(){if(!(!this.calendar||this.isRefreshing)){this.isRefreshing=!0;try{let t=this.calendar.view.type,n=this.calendar.getDate(),s=this.contentEl.querySelector(".calendar-container");if(!s)return;this.calendar.destroy(),this.calendar=new Mf(s,this.getCalendarOptions()),this.calendar.render(),this.calendar.changeView(t,n)}finally{this.isRefreshing=!1}}}getInitialView(){switch(this.settings.calendarDefaultView){case"month":return"dayGridMonth";case"week":return"timeGridWeek";case"day":return"timeGridDay";case"list":return"listWeek";default:return"dayGridMonth"}}async loadEvents(){let t=new Date,n=new Date(t.getFullYear(),t.getMonth()-3,1),s=new Date(t.getFullYear(),t.getMonth()+3,0);return(await this.dataProvider.getEventsForRange(n,s)).map(o=>this.convertToFullCalendarEvent(o))}convertToFullCalendarEvent(t){return{id:t.id,title:t.title,start:t.start,end:t.end,allDay:t.allDay,backgroundColor:t.color,borderColor:t.color,extendedProps:{type:t.type,source:t.source,...t.metadata}}}handleEventClick(t){let n=t.event.id,s=t.event.extendedProps,r={id:n,title:t.event.title,start:t.event.start,end:t.event.end||void 0,allDay:t.event.allDay,type:s.type,color:t.event.backgroundColor||void 0,source:s.source,metadata:{project:s.project,tags:s.tags,summary:s.summary}},o=new Of(this.app,r,this.dataProvider,this.settings);o.onSave(async()=>{await this.refreshEvents()}),o.open()}async handleEventDrop(t){let n=t.event.id,s=t.event.start;await this.dataProvider.moveEvent(n,s)||t.revert()}handleDateSelect(t){var r;(r=this.calendar)==null||r.unselect();let n=t.startStr.split("T")[0];new ea(this.app,n,this.dataProvider,this.settings).open()}};function Hf(i,e=100){return i.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,e)}var cb=class extends M.Plugin{constructor(){super(...arguments);this.gemini=null;this.ocrProcessor=null;this.relatedNoteFinder=null;this.mocManager=null;this.zkIndexManager=null;this.youtubeExtractor=null;this.webPageExtractor=null;this.reviewManager=null;this.meetingProcessor=null;this.scheduleManager=null;this.googleCalendar=null;this.calendarDataProvider=null;this.feedbackManager=null;this.embeddingManager=null;this.ragEngine=null;this.chatStorage=null;this.watcherRegistered=!1;this.pendingFiles=new Map;this.zkDailyCounter=new Map;this.zkLuhmannCounter=0;this.pendingEmbeddings=new Map}async onload(){await this.loadSettings(),this.addSettingTab(new Wf(this.app,this)),this.processDebounced=(0,M.debounce)(()=>this.processPendingFiles(),3e3,!0),this.feedbackManager=new nv(this.app,this.manifest.dir),await this.feedbackManager.load(),this.calendarDataProvider=new Wh(this.app,this.settings),this.registerCalendarViews(),this.registerCommands(),this.settings.autoWatch&&this.startWatcher(),this.app.workspace.onLayoutReady(async()=>{this.settings.onboardingCompleted?await this.initGemini():new iv(this.app,this.settings,async t=>{this.settings=t,await this.saveSettings(),await this.initGemini(),new M.Notice("\u{1F389} Zero Friction Brain \uC124\uC815 \uC644\uB8CC!")}).open()}),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uB85C\uB4DC\uB428")}onunload(){this.stopWatcher(),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uC5B8\uB85C\uB4DC\uB428")}async loadSettings(){this.settings=Object.assign({},A_,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.initGemini()}async initGemini(){this.settings.geminiApiKey?(this.gemini=new Np(this.settings.geminiApiKey),this.ocrProcessor=new By(this.gemini,this.settings,this.app.vault),this.relatedNoteFinder=new Gy(this.app,this.gemini,this.settings),this.embeddingManager=new $y(this.app,this.gemini,this.settings),await this.embeddingManager.loadIndex(),this.relatedNoteFinder.setEmbeddingManager(this.embeddingManager),this.chatStorage=new qy(this.app,this.settings),await this.chatStorage.loadSessions(),this.ragEngine=new zy(this.app,this.gemini,this.embeddingManager,this.settings),this.registerView(vc,t=>new Vh(t,this.settings,this.ragEngine,this.chatStorage)),this.mocManager=new Wy(this.app,this.gemini,this.settings.projectsFolder,this.settings),this.zkIndexManager=new Yy(this.app,this.relatedNoteFinder,this.settings.zettelFolder,this.settings,this.gemini),this.youtubeExtractor=new jy(this.gemini,this.settings),this.webPageExtractor=new Qy(this.gemini,this.settings),this.reviewManager=new Ky(this.app,this.gemini,this.settings),this.meetingProcessor=new Jy(this.app,this.gemini,this.settings),this.scheduleManager=new Xy(this.app,this.settings),this.googleCalendar=new zh(this.app,this.settings,()=>this.saveSettings()),Promise.all([this.relatedNoteFinder.buildIndex(),this.mocManager.scanProjectMOCs()]).then(()=>{var t,n,s;console.log(`\uB178\uD2B8 \uC778\uB371\uC2A4: ${(t=this.relatedNoteFinder)==null?void 0:t.getIndexSize()}\uAC1C, MOC: ${(n=this.mocManager)==null?void 0:n.getMOCCount()}\uAC1C, ZK: ${(s=this.relatedNoteFinder)==null?void 0:s.getZettelCount()}\uAC1C`),this.initializeZKCounters()})):(this.gemini=null,this.ocrProcessor=null,this.relatedNoteFinder=null,this.embeddingManager=null,this.ragEngine=null,this.chatStorage=null,this.mocManager=null,this.youtubeExtractor=null,this.webPageExtractor=null,this.reviewManager=null,this.scheduleManager=null,this.googleCalendar=null)}checkApiKey(){return this.gemini?!0:(new M.Notice("Gemini API \uD0A4\uB97C \uC124\uC815\uD574\uC8FC\uC138\uC694"),!1)}truncateContent(t,n=5e5){let s=t.replace(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g,"[\uC774\uBBF8\uC9C0]");return s=s.replace(/!\[[^\]]*\]\(data:[^)]+\)/g,"[\uC774\uBBF8\uC9C0]"),s.length<=n?s:s.slice(0,n)+`

[... \uB0B4\uC6A9\uC774 \uB108\uBB34 \uAE38\uC5B4 \uC77C\uBD80\uB9CC \uBD84\uC11D\uB428 ...]`}registerCommands(){this.addCommand({id:"project-classify",name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkeys:[{modifiers:["Ctrl","Shift"],key:"g"}],callback:()=>this.classifyCurrentFile()}),this.addCommand({id:"zk-extract",name:"ZK \uCD94\uCD9C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"z"}],callback:()=>this.extractZKFromCurrentFile()}),this.addCommand({id:"focus-top3",name:"Focus Top 3",hotkeys:[{modifiers:["Ctrl","Shift"],key:";"}],callback:()=>this.showFocusTop3()}),this.addCommand({id:"process-inbox",name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",callback:()=>this.processInbox()}),this.addCommand({id:"toggle-watch",name:"Watch \uD1A0\uAE00",callback:()=>this.toggleWatch()}),this.addCommand({id:"ocr-extract",name:"OCR \uCD94\uCD9C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"o"}],callback:()=>this.ocrCurrentFile()}),this.addCommand({id:"ocr-inbox",name:"Inbox OCR \uCC98\uB9AC",callback:()=>this.processInboxOCR()}),this.addCommand({id:"smart-process",name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkeys:[{modifiers:["Ctrl","Shift"],key:"s"}],callback:()=>this.smartProcessCurrentFile()}),this.addCommand({id:"create-moc",name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",callback:()=>this.showCreateMOCModal()}),this.addCommand({id:"url-import",name:"URL \uAC00\uC838\uC624\uAE30",hotkeys:[{modifiers:["Ctrl","Shift"],key:"u"}],callback:()=>this.showURLImportModal()}),this.addCommand({id:"rebuild-zk-index",name:"ZK Index \uC7AC\uAD6C\uCD95",callback:()=>this.rebuildZKIndex()}),this.addCommand({id:"smart-split",name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkeys:[{modifiers:["Ctrl","Shift"],key:"d"}],callback:()=>this.smartSplitCurrentFile()}),this.addCommand({id:"link-related-notes",name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkeys:[{modifiers:["Ctrl","Shift"],key:"l"}],callback:()=>this.linkRelatedNotesForCurrentFile()}),this.addCommand({id:"review-mode",name:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC",hotkeys:[{modifiers:["Ctrl","Shift"],key:"r"}],callback:()=>this.showReviewModal()}),this.addCommand({id:"show-command-list",name:"\uBA85\uB839 \uB9AC\uC2A4\uD2B8",callback:()=>this.showCommandListModal()}),this.addCommand({id:"open-calendar",name:"\uCE98\uB9B0\uB354 \uBDF0",hotkeys:[{modifiers:["Ctrl","Shift"],key:"c"}],callback:()=>this.openCalendarView()}),this.addCommand({id:"toggle-chatbot",name:"AI \uCC57\uBD07 \uC5F4\uAE30/\uB2EB\uAE30",hotkeys:[{modifiers:["Ctrl","Shift"],key:"'"}],callback:()=>this.toggleChatbot()}),this.addRibbonIcon("brain","Zero Friction Brain",()=>{this.showCommandListModal()}),this.settings.calendarEnabled&&this.addRibbonIcon("calendar","\uCE98\uB9B0\uB354 \uBDF0",()=>{this.openCalendarView()}),this.settings.ragEnabled&&this.settings.embeddingEnabled&&this.addRibbonIcon("bot","AI \uCC57\uBD07",()=>{this.toggleChatbot()})}registerCalendarViews(){this.registerView(Hc,t=>new Uf(t,this.settings,this.calendarDataProvider)),this.registerView(Sc,t=>new Yh(t,this.settings,this.calendarDataProvider))}async toggleChatbot(){let t=this.app.workspace.getLeavesOfType(vc);if(t.length>0)t[0].detach();else{let n=this.app.workspace.getRightLeaf(!1);n&&await n.setViewState({type:vc,active:!0})}}async openCalendarView(){let t=this.app.workspace.getLeavesOfType(Hc);t.length>0?this.app.workspace.revealLeaf(t[0]):await this.app.workspace.getLeaf("tab").setViewState({type:Hc,active:!0})}async toggleMiniCalendar(){let t=this.app.workspace.getLeavesOfType(Sc);if(t.length>0)t[0].detach();else{let n=this.app.workspace.getRightLeaf(!1);n&&await n.setViewState({type:Sc,active:!0})}}showReviewModal(){if(this.checkApiKey()){if(!this.reviewManager){new M.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new w_(this.app,this.reviewManager,this.settings).open()}}async connectGoogleCalendar(){this.googleCalendar||(this.googleCalendar=new zh(this.app,this.settings,()=>this.saveSettings())),await this.googleCalendar.startOAuth()}async disconnectGoogleCalendar(){this.googleCalendar&&await this.googleCalendar.disconnect()}async detectAndSaveSchedules(t,n){if(this.settings.scheduleDetectionEnabled&&!(!this.gemini||!this.scheduleManager))try{let s=Jn(this.settings.timezone),r=await this.gemini.detectSchedules(t,s);if(r.length===0)return;let a=await new ev(this.app,r,this.settings,h=>{var p;this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"schedule_detection",noteTitle:(n==null?void 0:n.basename)||"Unknown",aiSuggestion:{schedules:h.allSchedules},userChoice:{accepted:h.accepted,rejectedItems:(p=h.rejectedSchedules)==null?void 0:p.map(m=>m.title),dismissed:h.dismissed}})}).openAndWait();if(!a||a.selectedSchedules.length===0)return;let l=0,c=0;if(a.saveToDaily&&(l=await this.scheduleManager.saveToDaily(a.selectedSchedules)),a.saveToGoogle&&this.googleCalendar&&this.googleCalendar.isConnected()&&(c=await this.googleCalendar.saveSchedules(a.selectedSchedules)),a.moveToArchives&&n){let h=`${this.settings.archivesFolder}/${n.name}`;await this.app.fileManager.renameFile(n,h),new M.Notice("\uC6D0\uBCF8 \uB178\uD2B8\uAC00 Archives\uB85C \uC774\uB3D9\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}let d=[];l>0&&d.push(`Daily Notes: ${l}\uAC1C`),c>0&&d.push(`Google Calendar: ${c}\uAC1C`),d.length>0&&new M.Notice(`\uC77C\uC815 \uC800\uC7A5\uB428
${d.join(", ")}`)}catch(s){console.error("\uC77C\uC815 \uAC10\uC9C0 \uC2E4\uD328:",s)}}async rebuildZKIndex(){var t;if(!this.zkIndexManager){new M.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new M.Notice("ZK Index \uC7AC\uAD6C\uCD95 \uC911...");try{await this.zkIndexManager.rebuildIndex();let n=((t=this.relatedNoteFinder)==null?void 0:t.getZettelCount())||0;new M.Notice(`ZK Index \uC7AC\uAD6C\uCD95 \uC644\uB8CC: ${n}\uAC1C \uB178\uD2B8`)}catch(n){console.error("ZK Index \uC7AC\uAD6C\uCD95 \uC2E4\uD328:",n),new M.Notice(`\uC7AC\uAD6C\uCD95 \uC2E4\uD328: ${n}`)}}async smartSplitCurrentFile(){var n;if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new M.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(t.extension!=="md"){new M.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uBD84\uB9AC\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4");return}new M.Notice("\uBA54\uBAA8 \uBD84\uC11D \uC911...");try{let s=await this.app.vault.read(t),r=((n=this.mocManager)==null?void 0:n.getProjectList())||[],o=await this.gemini.splitContent(s,r);if(o.length===0){new M.Notice("\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(o.length===1){new M.Notice("\uB2E8\uC77C \uC8FC\uC81C\uB85C \uD310\uB2E8\uB428. \uC77C\uBC18 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958\uB97C \uC0AC\uC6A9\uD558\uC138\uC694.");return}new v_(this.app,o,t,this).open()}catch(s){console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC2E4\uD328:",s),new M.Notice(`\uBD84\uB9AC \uC2E4\uD328: ${s}`)}}async createSplitNotes(t,n){let s=[];for(let o of t){let a=this.getTargetFolder(o.targetType,o.project);if(o.project&&!o.project.startsWith("NEW:")){let p=`${this.settings.projectsFolder}/${o.project}`;this.app.vault.getAbstractFileByPath(p)instanceof M.TFolder&&(a=p)}let l=Hf(o.title),c=`${a}/${l}.md`,d=`---
targetType: ${o.targetType}
keywords: [${o.keywords.join(", ")}]
source: "[[${n.basename}]]"
created: ${Oe(this.settings.timezone,this.settings.dateFormat)}
${o.project?`project: "${o.project}"`:""}
---

# ${o.title}

${o.content}
`;this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a);try{let p=await this.app.vault.create(c,d);if(s.push(o.title),this.relatedNoteFinder&&await this.relatedNoteFinder.updateIndex(p),o.project&&this.mocManager)if(o.project.startsWith("NEW:")){let m=o.project.slice(4).trim();await this.mocManager.createProjectMOC(m,this.settings.projectsFolder)&&await this.mocManager.addNoteToMOC(m,o.title,p.path)}else await this.mocManager.addNoteToMOC(o.project,o.title,p.path)}catch(p){console.error(`\uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328: ${o.title}`,p)}}let r=`${this.settings.archivesFolder}/${n.name}`;try{this.app.vault.getAbstractFileByPath(this.settings.archivesFolder)||await this.app.vault.createFolder(this.settings.archivesFolder),await this.app.fileManager.renameFile(n,r)}catch(o){console.error("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uC2E4\uD328:",o)}new M.Notice(`${s.length}\uAC1C \uB178\uD2B8 \uC0DD\uC131\uB428, \uC6D0\uBCF8\uC740 Archives\uB85C \uC774\uB3D9`)}showCreateMOCModal(){new m_(this.app,this.mocManager,this.settings.projectsFolder).open()}showURLImportModal(){this.checkApiKey()&&new y_(this.app,"URL \uAC00\uC838\uC624\uAE30","\uC720\uD29C\uBE0C \uB610\uB294 \uC6F9\uD398\uC774\uC9C0 URL\uC744 \uC785\uB825\uD558\uC138\uC694 (\uC790\uB3D9 \uAC10\uC9C0)","https://...",async t=>{await this.processURL(t)}).open()}async processURL(t){/(?:youtube\.com|youtu\.be)/.test(t)?await this.processYouTube(t):await this.processWebPage(t)}async processYouTube(t){var n,s;if(!(!this.youtubeExtractor||!this.gemini)){new M.Notice("\uC720\uD29C\uBE0C \uC601\uC0C1 \uBD84\uC11D \uC911...");try{let r=await this.youtubeExtractor.processVideo(t),o=this.youtubeExtractor.generateMarkdownNote(r),a=Hf(r.title),l=`${a}.md`,c=`${this.settings.inboxFolder}/${l}`,d=await this.app.vault.create(c,o);new M.Notice(`\uC720\uD29C\uBE0C \uB178\uD2B8 \uC0DD\uC131: ${a}`);let h=((n=this.mocManager)==null?void 0:n.getProjectList())||[],p=(s=this.feedbackManager)==null?void 0:s.generatePromptContext(),m=await this.gemini.classifyProject(o,h,p);d=await this.applyClassifyResultWithConfirmation(d,m),new M.Notice(`${m.targetType}${m.projectName?` (${m.projectName})`:""}\uB85C \uBD84\uB958\uB428`),this.app.workspace.getLeaf().openFile(d),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(d,o,m.title)}catch(r){console.error("\uC720\uD29C\uBE0C \uCC98\uB9AC \uC624\uB958:",r),new M.Notice(`\uC720\uD29C\uBE0C \uCC98\uB9AC \uC2E4\uD328: ${r}`)}}}async processWebPage(t){var n,s;if(!(!this.webPageExtractor||!this.gemini)){new M.Notice("\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38 \uCD94\uCD9C \uC911...");try{let r=await this.webPageExtractor.processUrl(t),o=this.webPageExtractor.generateMarkdownNote(r),a=Hf(r.title),l=`${a}.md`,c=`${this.settings.inboxFolder}/${l}`,d=await this.app.vault.create(c,o);new M.Notice(`\uC6F9\uD398\uC774\uC9C0 \uB178\uD2B8 \uC0DD\uC131: ${a}`);let h=((n=this.mocManager)==null?void 0:n.getProjectList())||[],p=(s=this.feedbackManager)==null?void 0:s.generatePromptContext(),m=await this.gemini.classifyProject(o,h,p);d=await this.applyClassifyResultWithConfirmation(d,m),new M.Notice(`${m.targetType}${m.projectName?` (${m.projectName})`:""}\uB85C \uBD84\uB958\uB428`),this.app.workspace.getLeaf().openFile(d),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(d,o,m.title)}catch(r){console.error("\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC624\uB958:",r),new M.Notice(`\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC2E4\uD328: ${r}`)}}}async classifyCurrentFile(){var r,o,a,l,c,d;if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new M.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase(),s=["pdf","png","jpg","jpeg","webp","gif"];if(iA.includes(n)){if(!this.meetingProcessor){new M.Notice("\uD68C\uC758\uB85D \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}new M.Notice("\uD68C\uC758\uB85D \uBD84\uC11D \uC911...");try{let h=await this.meetingProcessor.processAudio(t),p=this.meetingProcessor.generateMarkdownNote(h),m=`\uD68C\uC758\uB85D_${Hf(h.title)}.md`,y=`${this.settings.inboxFolder}/${m}`,v=await this.app.vault.create(y,p);if(this.settings.ocrMoveOriginal){let T=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(T)||await this.app.vault.createFolder(T);let I=`${T}/${t.name}`;await this.app.fileManager.renameFile(t,I)}let E=((r=this.mocManager)==null?void 0:r.getProjectList())||[],S=(o=this.feedbackManager)==null?void 0:o.generatePromptContext(),C=await this.gemini.classifyProject(p,E,S),_=await this.applyClassifyResultWithConfirmation(v,C);new M.Notice(`\uD68C\uC758\uB85D \uC0DD\uC131 \uC644\uB8CC: ${C.targetType}${C.projectName?` (${C.projectName})`:""}`),await this.findAndShowRelatedNotes(_,p,h.title),await this.detectAndSaveSchedules(p,_)}catch(h){console.error("\uD68C\uC758\uB85D \uBD84\uC11D \uC624\uB958:",h),new M.Notice(`\uD68C\uC758\uB85D \uBD84\uC11D \uC2E4\uD328: ${h}`)}return}if(s.includes(n)){if(!this.settings.ocrEnabled){new M.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new M.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let h=await this.ocrProcessor.checkLimits(t);if(!h.allowed){new Bf(this.app,h.reason,t,this).open();return}new M.Notice("\uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let p=await this.ocrProcessor.processFile(t);new M.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let m=await this.gemini.summarizePDF(p.text),y=this.ocrProcessor.generateSummarizedNote(p,m),v=t.basename+"_OCR.md",E=`${this.settings.inboxFolder}/${v}`,S=await this.app.vault.create(E,y);if(this.settings.ocrMoveOriginal){let I=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(I)||await this.app.vault.createFolder(I);let k=`${I}/${t.name}`;await this.app.fileManager.renameFile(t,k)}let C=((a=this.mocManager)==null?void 0:a.getProjectList())||[],_=(l=this.feedbackManager)==null?void 0:l.generatePromptContext(),T=await this.gemini.classifyProject(y,C,_),R=await this.applyClassifyResultWithConfirmation(S,T);new M.Notice(`\uC644\uB8CC: OCR(${p.pages}p) \u2192 ${T.targetType}${T.projectName?` (${T.projectName})`:""}`),await this.findAndShowRelatedNotes(R,y,T.title),await this.detectAndSaveSchedules(y,R)}catch(p){console.error("\uCC98\uB9AC \uC624\uB958:",p),new M.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${p}`)}return}if(n==="md"){new M.Notice("\uBD84\uB958 \uC911...");try{let h=await this.app.vault.read(t),p=this.truncateContent(h),m=((c=this.mocManager)==null?void 0:c.getProjectList())||[],y=(d=this.feedbackManager)==null?void 0:d.generatePromptContext(),v=await this.gemini.classifyProject(p,m,y),E=await this.applyClassifyResultWithConfirmation(t,v);new M.Notice(`${v.targetType}${v.projectName?` (${v.projectName})`:""}\uB85C \uBD84\uB958\uB428`),await this.findAndShowRelatedNotes(E,h,v.title),await this.detectAndSaveSchedules(h,E)}catch(h){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",h),new M.Notice(`\uBD84\uB958 \uC2E4\uD328: ${h}`)}return}new M.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}async linkRelatedNotesForCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new M.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(t.extension!=="md"){new M.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uC9C0\uC6D0\uD569\uB2C8\uB2E4");return}new M.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");try{let n=await this.app.vault.read(t),s=this.truncateContent(n),r=n.match(/^#\s+(.+)$/m),o=(r==null?void 0:r[1])||t.basename;await this.findAndShowRelatedNotes(t,s,o)}catch(n){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",n),new M.Notice(`\uAC80\uC0C9 \uC2E4\uD328: ${n}`)}}showCommandListModal(){new E_(this.app,this).open()}async applyClassifyResult(t,n){let s=await this.app.vault.read(t),r=this.updateFrontmatter(s,{targetType:n.targetType,project:n.projectName||void 0,title:n.title,summary:n.summary,next_action:n.nextAction||void 0,processed_at:Oe(this.settings.timezone,this.settings.dateFormat)});await this.app.vault.modify(t,r);let o=this.getTargetFolder(n.targetType,n.projectName);if(o){this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o);let l=`${o}/${t.name}`;await this.app.fileManager.renameFile(t,l);let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof M.TFile)return c}return t}async applyClassifyResultWithConfirmation(t,n){var r,o;if(n.shouldRestructure&&n.restructuredContent){let a=(r=this.feedbackManager)==null?void 0:r.getPreferences();if(a){let l=a.restructure,c=l.accepted+l.rejected;if(l.preference==="restructure"&&l.accepted>=qh)new M.Notice(`\u2728 \uCF58\uD150\uCE20 \uC790\uB3D9 \uC7AC\uAD6C\uC131 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${l.accepted}/${c}\uD68C)`),await this.applyRestructuredContent(t,n.restructuredContent);else if(l.preference==="original"&&l.rejected>=qh)new M.Notice(`\u{1F4C4} \uC6D0\uBCF8 \uC720\uC9C0 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${l.rejected}/${c}\uD68C)`);else{let d=await this.app.vault.read(t);await this.showRestructureModal(t,n,d)&&await this.applyRestructuredContent(t,n.restructuredContent)}}else{let l=await this.app.vault.read(t);await this.showRestructureModal(t,n,l)&&await this.applyRestructuredContent(t,n.restructuredContent)}}if(n.contentType!=="reference"||!n.projectName)return this.applyClassifyResult(t,n);let s=(o=this.feedbackManager)==null?void 0:o.getPreferences();if(s){let a=s.feedback.referenceLocation,l=a.toLibrary+a.toProject;if(a.preference==="library"&&a.toLibrary>=qh){new M.Notice(`\u{1F4DA} Library\uC5D0 \uC790\uB3D9 \uC800\uC7A5 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${a.toLibrary}/${l}\uD68C)`);let c={...n,targetType:"library"};return this.applyClassifyResult(t,c)}if(a.preference==="project"&&a.toProject>=qh){new M.Notice(`\u{1F4C1} \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC790\uB3D9 \uC800\uC7A5 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${a.toProject}/${l}\uD68C)`);let c={...n,targetType:"project"};return this.applyClassifyResult(t,c)}}return new Promise(a=>{new b_(this.app,n,async l=>{let c={...n};l==="library"?(c={...n,targetType:"library"},new M.Notice(`Library\uC5D0 \uC800\uC7A5 + ${n.projectName} \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C`)):c={...n,targetType:"project"};let d=await this.applyClassifyResult(t,c);a(d)},this.feedbackManager).open()})}showRestructureModal(t,n,s){return new Promise(r=>{new tv(this.app,n,s,o=>{r(o)},this.feedbackManager).open()})}async applyRestructuredContent(t,n){let r=(await this.app.vault.read(t)).match(/^---\n([\s\S]*?)\n---\n?/),a=(r?r[0]:"")+n;await this.app.vault.modify(t,a)}async findAndShowRelatedNotes(t,n,s){if(!this.relatedNoteFinder||!this.gemini)return;let r=this.truncateContent(n);try{let o=await this.gemini.extractKeywords(r);o.length>0&&this.relatedNoteFinder&&await this.relatedNoteFinder.saveKeywordsToNote(t,o),this.mocManager&&this.mocManager.getMOCCount()>0&&await this.handleProjectMOC(t,s,o),new M.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");let a=await this.relatedNoteFinder.findRelated(r,s,t.path);a.length>0?new p_(this.app,a,t,this.relatedNoteFinder,this.feedbackManager).open():o.length>0&&new M.Notice(`\uD0A4\uC6CC\uB4DC ${o.length}\uAC1C \uC800\uC7A5\uB428`)}catch(o){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",o)}}async handleProjectMOC(t,n,s){if(!(!this.mocManager||!this.gemini))try{let r=await this.mocManager.detectProject(n,s);if(!r)return;if(r.startsWith("NEW:")){let a=r.slice(4).trim();new g_(this.app,a,t,n,this.mocManager,this.settings.projectsFolder).open();return}await this.mocManager.addNoteToMOC(r,n,t.path)&&new M.Notice(`\u{1F4C1} ${r} MOC\uC5D0 \uC5F0\uACB0\uB428`)}catch(r){console.error("MOC \uC5F0\uACB0 \uC624\uB958:",r)}}getTargetFolder(t,n){switch(t){case"project":return n?`${this.settings.projectsFolder}/${n}`:this.settings.projectsFolder;case"library":return this.settings.libraryFolder;case"archive":return this.settings.archivesFolder;default:return this.settings.libraryFolder}}updateFrontmatter(t,n){let s=/^---\n([\s\S]*?)\n---\n?/,r=t.match(s),o="",a=t;r&&(o=r[1],a=t.slice(r[0].length));let l=o.split(`
`).filter(h=>h.trim()),c=new Map;for(let h of l){let p=h.indexOf(":");if(p!==-1){let m=h.slice(0,p).trim(),y=h.slice(p+1).trim();c.set(m,y)}}for(let[h,p]of Object.entries(n))if(p!==void 0){let y=/[:\[\]{}#&*!|>'"%@`]/.test(p)&&!p.startsWith('"')?`"${p.replace(/"/g,'\\"')}"`:p;c.set(h,y)}return`---
${Array.from(c.entries()).map(([h,p])=>`${h}: ${p}`).join(`
`)}
---
${a}`}async extractZKFromCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new M.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new M.Notice("ZK \uC544\uC774\uB514\uC5B4 \uCD94\uCD9C \uC911...");try{let n=await this.app.vault.read(t),s=await this.gemini.extractZK(n);if(s.length===0){new M.Notice("\uCD94\uCD9C\uD560 \uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new u_(this.app,s,t,this).open()}catch(n){console.error("ZK \uCD94\uCD9C \uC624\uB958:",n),new M.Notice(`\uCD94\uCD9C \uC2E4\uD328: ${n}`)}}initializeZKCounters(){if(!this.relatedNoteFinder)return;let t=this.relatedNoteFinder.getZettelIndex();for(let[n]of t){let r=(n.split("/").pop()||"").match(/^(\d{8})-(\d{3})/);if(r){let o=r[1],a=parseInt(r[2],10),l=this.zkDailyCounter.get(o)||0;a>l&&this.zkDailyCounter.set(o,a)}this.zkLuhmannCounter=Math.max(this.zkLuhmannCounter,t.size)}console.log(`ZK \uCE74\uC6B4\uD130 \uCD08\uAE30\uD654: \uB8E8\uB9CC=${this.zkLuhmannCounter}, \uC77C\uBCC4=${this.zkDailyCounter.size}\uAC1C \uB0A0\uC9DC`)}generateZKId(){switch(this.settings.zkIdType){case"timestamp":return Date.now().toString();case"date-sequence":{let n=Jn(this.settings.timezone).replace(/-/g,""),s=(this.zkDailyCounter.get(n)||0)+1;return this.zkDailyCounter.set(n,s),`${n}-${s.toString().padStart(3,"0")}`}case"luhmann":return this.zkLuhmannCounter++,this.toLuhmannId(this.zkLuhmannCounter);default:return Date.now().toString()}}toLuhmannId(t){if(t<=0)return"1";let n=[],s=t,r=0;for(;s>0;){if(r%2===0){let o=(s-1)%9+1;n.push(o.toString()),s=Math.floor((s-1)/9)}else{let o=(s-1)%26;n.push(String.fromCharCode(97+o)),s=Math.floor((s-1)/26)}r++}return n.reverse().join("")}async createZKNotes(t,n){var d;let s=this.settings.zettelFolder;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s);let o=[],a=[],l=0;for(let h of t){let m=(await this.relatedNoteFinder.findRelatedZettels(h.keywords)).find(_=>_.relevance>=this.settings.zkMergeThreshold);if(m&&await this.showMergeConfirmModal(h,m)){await this.mergeToExistingZK(m.note.path,h,n),a.push(h.title);continue}let y=this.generateZKId(),v=Hf(h.title),E=`${s}/${y} ${v}.md`,S=`---
type: zettel
source: "[[${n.basename}]]"
keywords: [${h.keywords.join(", ")}]
created: ${Oe(this.settings.timezone,this.settings.dateFormat)}
---

# ${h.title}

## \uD575\uC2EC \uC544\uC774\uB514\uC5B4
${h.body}

## \uC65C \uC911\uC694\uD55C\uAC00?
${h.importance||""}

## \uB9E5\uB77D
- **\uC6D0\uBCF8**: [[${n.basename}]]
- **\uAD00\uB828 \uAC1C\uB150**: ${((d=h.relatedConcepts)==null?void 0:d.join(", "))||""}

---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
- [[${n.basename}]] (\uC6D0\uBCF8)
`;await this.app.vault.create(E,S),o.push(h.title);let C=this.app.vault.getAbstractFileByPath(E);if(C instanceof M.TFile){await this.relatedNoteFinder.updateIndex(C);let _=await this.relatedNoteFinder.findRelatedZettels(h.keywords,E);_.length>0&&(await this.addZKRelatedLinks(C,_),await this.addBacklinksToZettels(C,_),l+=_.length),this.zkIndexManager&&await this.zkIndexManager.updateIndex(C,h.keywords)}await new Promise(_=>setTimeout(_,10))}let c=[];o.length>0&&c.push(`${o.length}\uAC1C \uC0DD\uC131`),a.length>0&&c.push(`${a.length}\uAC1C \uBCD1\uD569`),l>0&&c.push(`${l}\uAC1C \uC5F0\uACB0`),new M.Notice(`ZK \uB178\uD2B8: ${c.join(", ")}`)}showMergeConfirmModal(t,n){return new Promise(s=>{new h_(this.app,t,n,o=>s(o)).open()})}async mergeToExistingZK(t,n,s){let r=this.app.vault.getAbstractFileByPath(t);if(!(r instanceof M.TFile))return;let o=await this.app.vault.read(r),a=`

---
## \uCD94\uAC00\uB41C \uB0B4\uC6A9 (${new Date().toLocaleDateString()})
*\uC6D0\uBCF8: [[${s.basename}]]*

${n.body}
`,l=/(\n---\n##  )/,c;l.test(o)?c=o.replace(l,`${a}$1`):c=o+a;let d=this.extractKeywordsFromFrontmatter(o),h=[...new Set([...d,...n.keywords])];c=this.updateFrontmatterKeywordsInContent(c,h),await this.app.vault.modify(r,c),await this.relatedNoteFinder.updateIndex(r)}extractKeywordsFromFrontmatter(t){let n=t.match(/^---\n[\s\S]*?keywords:\s*\[(.*?)\][\s\S]*?---/);return n?n[1].split(",").map(s=>s.trim().replace(/^["']|["']$/g,"")).filter(s=>s.length>0):[]}updateFrontmatterKeywordsInContent(t,n){let s=`keywords: [${n.join(", ")}]`;return t.replace(/^(---\n[\s\S]*?)(keywords:\s*\[.*?\])([\s\S]*?---)/,`$1${s}$3`)}async addZKRelatedLinks(t,n){if(n.length===0)return;let s=await this.app.vault.read(t),r=n.map(c=>{let d=c.note.path.split("/"),p=d[d.length-1].replace(/\.md$/,""),m=c.reason?`
  \u2192 ${c.reason}`:"";return`- [[${p}]] (${Math.round(c.relevance*100)}%)${m}`}).join(`
`),o=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,a=s.match(o),l;a?l=s.replace(o,`$1
${r}$2`):l=s+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${r}
`,await this.app.vault.modify(t,l)}async addBacklinksToZettels(t,n){for(let s of n){let r=this.app.vault.getAbstractFileByPath(s.note.path);if(!(r instanceof M.TFile))continue;let o=await this.app.vault.read(r);if(o.includes(`[[${t.basename}]]`))continue;let a=s.reason?`
  \u2192 ${s.reason}`:"",l=`- [[${t.basename}]] (${Math.round(s.relevance*100)}%)${a}`,c=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,d=o.match(c),h;d?h=o.replace(c,`$1
${l}$2`):h=o+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${l}
`,await this.app.vault.modify(r,h)}}async showFocusTop3(){if(this.checkApiKey()){new M.Notice("\uD504\uB85C\uC81D\uD2B8 \uBD84\uC11D \uC911...");try{let t=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(!t||!(t instanceof M.TFolder)){new M.Notice("Projects \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=await this.collectProjectsSummary(t);if(!n){new M.Notice("\uC9C4\uD589 \uC911\uC778 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let s=await this.gemini.getFocus(n);if(s.length===0){new M.Notice("\uCD94\uCC9C\uD560 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new f_(this.app,s).open()}catch(t){console.error("Focus \uBD84\uC11D \uC624\uB958:",t),new M.Notice(`\uBD84\uC11D \uC2E4\uD328: ${t}`)}}}async collectProjectsSummary(t){let n=[];for(let s of t.children)if(s instanceof M.TFile&&s.extension==="md"){let r=await this.app.vault.read(s),o=this.extractFrontmatter(r),a=o.title||s.basename,l=o.summary||"",c=o.next_action||"";n.push(`- ${a}: ${l} (\uB2E4\uC74C: ${c})`)}return n.join(`
`)}extractFrontmatter(t){let n=/^---\n([\s\S]*?)\n---/,s=t.match(n);if(!s)return{};let r={},o=s[1].split(`
`);for(let a of o){let l=a.indexOf(":");if(l!==-1){let c=a.slice(0,l).trim(),d=a.slice(l+1).trim();r[c]=d}}return r}async processInbox(){var c,d;if(!this.checkApiKey())return;let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof M.TFolder)){new M.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=0,s=0,r=this.settings.triggerTag,o=[];for(let h of t.children)h instanceof M.TFile&&h.extension==="md"&&(await this.app.vault.read(h)).includes(r)&&o.push(h);if(o.length===0){new M.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new M.Notice(`${o.length}\uAC1C \uD30C\uC77C \uCC98\uB9AC \uC2DC\uC791...`);let a=((c=this.mocManager)==null?void 0:c.getProjectList())||[],l=(d=this.feedbackManager)==null?void 0:d.generatePromptContext();for(let h=0;h<o.length;h++){let p=o[h];try{new M.Notice(`\uCC98\uB9AC \uC911: ${h+1}/${o.length} - ${p.name}`,2e3);let m=await this.app.vault.read(p),y=await this.gemini.classifyProject(m,a,l);await this.applyClassifyResult(p,y),n++}catch(m){console.error(`\uCC98\uB9AC \uC2E4\uD328: ${p.name}`,m),s++}}new M.Notice(`\uC644\uB8CC: ${n}\uAC1C \uCC98\uB9AC, ${s}\uAC1C \uC2E4\uD328`)}toggleWatch(){this.watcherRegistered?(this.stopWatcher(),new M.Notice("Watch \uC911\uC9C0\uB428")):(this.startWatcher(),new M.Notice("Watch \uC2DC\uC791\uB428"))}startWatcher(){this.watcherRegistered||(this.registerEvent(this.app.vault.on("create",t=>{t instanceof M.TFile&&(this.onFileChange(t),this.scheduleEmbeddingUpdate(t))})),this.registerEvent(this.app.vault.on("modify",t=>{t instanceof M.TFile&&(this.onFileChange(t),this.scheduleEmbeddingUpdate(t))})),this.registerEvent(this.app.vault.on("delete",t=>{var n,s,r,o;t instanceof M.TFile&&((n=this.relatedNoteFinder)==null||n.removeFromIndex(t.path),(s=this.mocManager)==null||s.removeFromIndex(t.path),(r=this.embeddingManager)==null||r.removeNote(t.path),(o=this.embeddingManager)==null||o.saveIndex(),console.log(`\uC778\uB371\uC2A4\uC5D0\uC11C \uC81C\uAC70: ${t.path}`))})),this.registerEvent(this.app.vault.on("rename",(t,n)=>{var s,r;t instanceof M.TFile&&((s=this.embeddingManager)==null||s.renameNote(n,t.path),(r=this.embeddingManager)==null||r.saveIndex())})),this.watcherRegistered=!0,console.log("Inbox \uAC10\uC2DC \uC2DC\uC791"))}stopWatcher(){this.watcherRegistered=!1,this.pendingFiles.clear(),console.log("Inbox \uAC10\uC2DC \uC911\uC9C0")}scheduleEmbeddingUpdate(t){if(!this.settings.embeddingEnabled||!this.embeddingManager||t.extension!=="md")return;let n=this.pendingEmbeddings.get(t.path);n&&clearTimeout(n);let s=setTimeout(async()=>{var o,a;this.pendingEmbeddings.delete(t.path),await((o=this.embeddingManager)==null?void 0:o.updateNoteEmbedding(t,!1))&&(await((a=this.embeddingManager)==null?void 0:a.saveIndex()),console.log("Embedding \uC790\uB3D9 \uC5C5\uB370\uC774\uD2B8:",t.path))},5e3);this.pendingEmbeddings.set(t.path,s)}onFileChange(t){this.watcherRegistered&&this.gemini&&t.path.startsWith(this.settings.inboxFolder)&&t.extension==="md"&&(this.pendingFiles.set(t.path,Date.now()),this.processDebounced())}async processPendingFiles(){var o,a;if(!this.gemini)return;let t=Date.now(),n=this.settings.triggerTag,s=((o=this.mocManager)==null?void 0:o.getProjectList())||[],r=(a=this.feedbackManager)==null?void 0:a.generatePromptContext();for(let[l,c]of this.pendingFiles.entries()){if(t-c<3e3)continue;this.pendingFiles.delete(l);let d=this.app.vault.getAbstractFileByPath(l);if(d instanceof M.TFile)try{let h=await this.app.vault.read(d);if(!h.includes(n))continue;let p=await this.gemini.classifyProject(h,s,r);await this.applyClassifyResult(d,p),new M.Notice(`\uC790\uB3D9 \uBD84\uB958: ${d.name} \u2192 ${p.targetType}${p.projectName?` (${p.projectName})`:""}`)}catch(h){console.error(`\uC790\uB3D9 \uBD84\uB958 \uC2E4\uD328: ${l}`,h)}}}async ocrCurrentFile(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new M.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new M.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.workspace.getActiveFile();if(!t){new M.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase();if(!["png","jpg","jpeg","webp","gif","pdf"].includes(n)){new M.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`);return}let r=await this.ocrProcessor.checkLimits(t);if(!r.allowed){new Bf(this.app,r.reason,t,this).open();return}new M.Notice("OCR \uCC98\uB9AC \uC911...");try{let o=await this.ocrProcessor.processFile(t),a=this.ocrProcessor.generateMarkdownNote(o),l=t.basename+"_OCR.md",c=`${this.settings.inboxFolder}/${l}`;if(await this.app.vault.create(c,a),this.settings.ocrMoveOriginal){let d=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(d)||await this.app.vault.createFolder(d);let p=`${d}/${t.name}`;await this.app.fileManager.renameFile(t,p)}new M.Notice(`OCR \uC644\uB8CC: ${l} \uC0DD\uC131\uB428 (${o.pages}\uD398\uC774\uC9C0)`)}catch(o){console.error("OCR \uC624\uB958:",o),new M.Notice(`OCR \uC2E4\uD328: ${o}`)}}async processInboxOCR(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new M.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new M.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof M.TFolder)){new M.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=["png","jpg","jpeg","webp","gif","pdf"],s=[];for(let a of t.children){if(!(a instanceof M.TFile))continue;let l=a.extension.toLowerCase();if(!n.includes(l))continue;(await this.ocrProcessor.checkLimits(a)).allowed&&s.push(a)}if(s.length===0){new M.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new M.Notice(`${s.length}\uAC1C \uD30C\uC77C OCR \uCC98\uB9AC \uC2DC\uC791...`);let r=0,o=0;for(let a=0;a<s.length;a++){let l=s[a];try{new M.Notice(`OCR \uC911: ${a+1}/${s.length} - ${l.name}`,3e3);let c=await this.ocrProcessor.processFile(l),d=this.ocrProcessor.generateMarkdownNote(c),h=l.basename+"_OCR.md",p=`${this.settings.inboxFolder}/${h}`;if(await this.app.vault.create(p,d),this.settings.ocrMoveOriginal){let m=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(m)||await this.app.vault.createFolder(m);let v=`${m}/${l.name}`;await this.app.fileManager.renameFile(l,v)}r++,a<s.length-1&&await new Promise(m=>setTimeout(m,1e3))}catch(c){console.error(`OCR \uCC98\uB9AC \uC2E4\uD328: ${l.name}`,c),o++}}new M.Notice(`OCR \uC644\uB8CC: ${r}\uAC1C \uCC98\uB9AC, ${o}\uAC1C \uC2E4\uD328`)}async smartProcessCurrentFile(){var r,o,a,l;if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new M.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase();if(["pdf","png","jpg","jpeg","webp","gif"].includes(n)){if(!this.settings.ocrEnabled){new M.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new M.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let c=await this.ocrProcessor.checkLimits(t);if(!c.allowed){new Bf(this.app,c.reason,t,this).open();return}new M.Notice("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let d=await this.ocrProcessor.processFile(t);new M.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let h=await this.gemini.summarizePDF(d.text),p=this.ocrProcessor.generateSummarizedNote(d,h),m=t.basename+"_OCR.md",y=`${this.settings.inboxFolder}/${m}`,v=await this.app.vault.create(y,p);if(this.settings.ocrMoveOriginal){let _=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(_)||await this.app.vault.createFolder(_);let R=`${_}/${t.name}`;await this.app.fileManager.renameFile(t,R)}let E=((r=this.mocManager)==null?void 0:r.getProjectList())||[],S=(o=this.feedbackManager)==null?void 0:o.generatePromptContext(),C=await this.gemini.classifyProject(p,E,S);await this.applyClassifyResultWithConfirmation(v,C),new M.Notice(`\uC644\uB8CC: OCR(${d.pages}p) \u2192 ${C.targetType}${C.projectName?` (${C.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(d){console.error("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC624\uB958:",d),new M.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${d}`)}}else if(n==="md"){new M.Notice("\uBD84\uB958 \uC911...");try{let c=await this.app.vault.read(t),d=((a=this.mocManager)==null?void 0:a.getProjectList())||[],h=(l=this.feedbackManager)==null?void 0:l.generatePromptContext(),p=await this.gemini.classifyProject(c,d,h);await this.applyClassifyResultWithConfirmation(t,p),new M.Notice(`${p.targetType}${p.projectName?` (${p.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(c){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",c),new M.Notice(`\uBD84\uB958 \uC2E4\uD328: ${c}`)}}else new M.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}getOCRDailyUsage(){return this.ocrProcessor?this.ocrProcessor.getDailyUsage():{date:Jn(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}},u_=class extends M.Modal{constructor(e,t,n,s){super(e),this.candidates=t,this.selected=new Set(t.map((r,o)=>o)),this.sourceFile=n,this.plugin=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"ZK \uC544\uC774\uB514\uC5B4 \uC120\uD0DD"}),e.createEl("p",{text:"\uC0DD\uC131\uD560 Zettelkasten \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let t=e.createDiv({cls:"zk-candidate-list"});this.candidates.forEach((o,a)=>{let l=t.createDiv({cls:"zk-candidate-item"}),c=l.createEl("input",{type:"checkbox",attr:{checked:!0}});c.addEventListener("change",()=>{c.checked?this.selected.add(a):this.selected.delete(a)});let d=l.createDiv({cls:"zk-candidate-label"});d.createEl("strong",{text:o.title}),d.createEl("p",{text:o.body,cls:"zk-candidate-body"}),d.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${o.keywords.join(", ")}`,cls:"zk-candidate-keywords"})});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{let o=this.candidates.filter((a,l)=>this.selected.has(l));o.length>0&&await this.plugin.createZKNotes(o,this.sourceFile),this.close()})}onClose(){this.contentEl.empty()}},h_=class extends M.Modal{constructor(e,t,n,s){super(e),this.candidate=t,this.similarNote=n,this.onResult=s}onOpen(){var l;let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC720\uC0AC\uD55C \uB178\uD2B8 \uBC1C\uACAC"}),e.createEl("p",{text:`\uC0C8 \uC544\uC774\uB514\uC5B4\uC640 ${Math.round(this.similarNote.relevance*100)}% \uC720\uC0AC\uD55C \uB178\uD2B8\uAC00 \uC788\uC2B5\uB2C8\uB2E4.`,cls:"setting-item-description"});let t=e.createDiv({cls:"merge-section"});t.createEl("h4",{text:"\uC0C8 \uC544\uC774\uB514\uC5B4"}),t.createEl("p",{text:this.candidate.title,cls:"merge-title"}),t.createEl("p",{text:this.candidate.body,cls:"merge-body"});let n=e.createDiv({cls:"merge-section"});n.createEl("h4",{text:"\uAE30\uC874 \uB178\uD2B8"});let s=((l=this.similarNote.note.path.split("/").pop())==null?void 0:l.replace(/\.md$/,""))||this.similarNote.note.title;n.createEl("p",{text:s,cls:"merge-title"}),n.createEl("p",{text:`\uD0A4\uC6CC\uB4DC: ${this.similarNote.note.keywords.join(", ")}`,cls:"merge-keywords"});let r=e.createDiv({cls:"merge-buttons"});r.createEl("button",{text:"\uAE30\uC874 \uB178\uD2B8\uC5D0 \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",()=>{this.onResult(!0),this.close()}),r.createEl("button",{text:"\uC0C8 \uB178\uD2B8 \uC0DD\uC131"}).addEventListener("click",()=>{this.onResult(!1),this.close()})}onClose(){this.contentEl.empty()}},f_=class extends M.Modal{constructor(e,t){super(e),this.items=t}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC624\uB298 \uC9D1\uC911\uD560 \uD504\uB85C\uC81D\uD2B8 Top 3"});let t=e.createDiv({cls:"focus-list"});this.items.forEach((r,o)=>{let a=t.createDiv({cls:"focus-item"});a.createEl("h3",{text:`${o+1}. ${r.title}`}),a.createEl("p",{text:r.why,cls:"focus-why"}),a.createEl("p",{text:`\u2192 ${r.nextAction}`,cls:"focus-action"})}),e.createDiv({cls:"modal-button-container"}).createEl("button",{text:"\uB2EB\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}},Bf=class extends M.Modal{constructor(e,t,n,s){super(e),this.reason=t,this.file=n,this.plugin=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uD30C\uC77C\uC774 \uB108\uBB34 \uD07D\uB2C8\uB2E4"}),e.createEl("p",{text:this.reason}),e.createEl("p",{text:"\uC124\uC815\uC5D0\uC11C \uC81C\uD55C\uC744 \uC870\uC815\uD558\uAC70\uB098, \uD30C\uC77C\uC744 \uBD84\uD560\uD574\uC11C \uCC98\uB9AC\uD558\uC138\uC694.",cls:"setting-item-description"});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"\uC124\uC815 \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.app.setting.open()})}onClose(){this.contentEl.empty()}},p_=class extends M.Modal{constructor(t,n,s,r,o=null){super(t);this.choiceMade=!1;this.relatedNotes=n,this.selected=new Set(n.map((a,l)=>l)),this.currentFile=s,this.finder=r,this.feedbackManager=o}recordFeedback(t,n,s){this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"related_notes",noteTitle:this.currentFile.basename,aiSuggestion:{suggestedNotePaths:this.relatedNotes.map(r=>r.note.path)},userChoice:{accepted:t.length>0,rejectedItems:n.map(r=>r.note.path),dismissed:s}})}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uAD00\uB828 \uB178\uD2B8 \uBC1C\uACAC"}),t.createEl("p",{text:"\uC5F0\uACB0\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let n=t.createDiv({cls:"related-notes-list"});this.relatedNotes.forEach((a,l)=>{var y;let c=n.createDiv({cls:"related-note-item"}),d=c.createEl("input",{type:"checkbox",attr:{checked:!0}});d.addEventListener("change",()=>{d.checked?this.selected.add(l):this.selected.delete(l)});let h=c.createDiv({cls:"related-note-label"}),p=((y=a.note.path.split("/").pop())==null?void 0:y.replace(/\.md$/,""))||a.note.title;h.createEl("strong",{text:p});let m=Math.round(a.relevance*100);h.createEl("span",{text:` (${m}%)`,cls:"related-note-relevance"}),a.matchedKeywords.length>0&&h.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${a.matchedKeywords.join(", ")}`,cls:"related-note-keywords"})});let s=t.createDiv({cls:"modal-button-container"});s.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback([],this.relatedNotes,!1),this.close()}),s.createEl("button",{text:"\uB9C1\uD06C \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",async()=>{this.choiceMade=!0;let a=this.relatedNotes.filter((c,d)=>this.selected.has(d)),l=this.relatedNotes.filter((c,d)=>!this.selected.has(d));this.recordFeedback(a,l,!1),a.length>0&&(await this.finder.addRelatedLinks(this.currentFile,a),new M.Notice(`${a.length}\uAC1C \uAD00\uB828 \uB178\uD2B8 \uB9C1\uD06C \uCD94\uAC00\uB428`)),this.close()})}onClose(){this.choiceMade||this.recordFeedback([],this.relatedNotes,!0),this.contentEl.empty()}},g_=class extends M.Modal{constructor(e,t,n,s,r,o){super(e),this.projectName=t,this.noteFile=n,this.noteTitle=s,this.mocManager=r,this.projectsFolder=o}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 \uAC10\uC9C0"}),e.createEl("p",{text:`"${this.projectName}" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC0C8\uB85C \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`}),e.createEl("p",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8\uC758 MOC(Map of Content)\uB97C \uC0DD\uC131\uD560\uAE4C\uC694?",cls:"setting-item-description"});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"MOC \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{await this.mocManager.createProjectMOC(this.projectName,this.projectsFolder)?(await this.mocManager.addNoteToMOC(this.projectName,this.noteTitle,this.noteFile.path),new M.Notice(`\u{1F4C1} ${this.projectName} MOC \uC0DD\uC131 \uBC0F \uC5F0\uACB0 \uC644\uB8CC`)):new M.Notice("MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4"),this.close()})}onClose(){this.contentEl.empty()}},m_=class extends M.Modal{constructor(e,t,n){super(e),this.mocManager=t,this.projectsFolder=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131"}),e.createEl("p",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 MOC\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4. \uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694.",cls:"setting-item-description"});let t=e.createDiv({cls:"moc-input-container"});if(t.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uC774\uB984:"}),this.inputEl=t.createEl("input",{type:"text",placeholder:"\uC608: \uC2A4\uB9C8\uD2B8\uD31C"}),this.inputEl.style.width="100%",this.inputEl.style.marginTop="8px",this.inputEl.style.padding="8px",this.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.createMOC()}),this.mocManager&&this.mocManager.getMOCCount()>0){let o=e.createDiv({cls:"existing-mocs"});o.createEl("h4",{text:"\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 MOC:"});let a=o.createEl("ul");for(let l of this.mocManager.getProjectList())a.createEl("li",{text:l})}let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createMOC()),setTimeout(()=>this.inputEl.focus(),10)}async createMOC(){let e=this.inputEl.value.trim();if(!e){new M.Notice("\uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694");return}if(!this.mocManager){new M.Notice("MOC \uAD00\uB9AC\uC790\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4"),this.close();return}if(this.mocManager.getProjectList().includes(e)){new M.Notice(`"${e}" MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4`);return}let n=await this.mocManager.createProjectMOC(e,this.projectsFolder);n?(new M.Notice(`\u{1F4C1} ${e} MOC \uC0DD\uC131 \uC644\uB8CC`),this.app.workspace.getLeaf().openFile(n)):new M.Notice("MOC \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4"),this.close()}onClose(){this.contentEl.empty()}},y_=class extends M.Modal{constructor(e,t,n,s,r){super(e),this.title=t,this.description=n,this.placeholder=s,this.onSubmit=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.title}),e.createEl("p",{text:this.description,cls:"setting-item-description"});let t=e.createDiv({cls:"url-input-container"});this.inputEl=t.createEl("input",{type:"text",placeholder:this.placeholder}),this.inputEl.style.width="100%",this.inputEl.style.padding="8px",navigator.clipboard.readText().then(o=>{o&&(o.startsWith("http://")||o.startsWith("https://"))&&(this.inputEl.value=o)}).catch(()=>{}),this.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.submit()});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uAC00\uC838\uC624\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.submit()),setTimeout(()=>this.inputEl.focus(),10)}async submit(){let e=this.inputEl.value.trim();if(!e){new M.Notice("URL\uC744 \uC785\uB825\uD558\uC138\uC694");return}this.close(),await this.onSubmit(e)}onClose(){this.contentEl.empty()}},v_=class extends M.Modal{constructor(e,t,n,s){super(e),this.sections=t,this.selected=new Set(t.map((r,o)=>o)),this.sourceFile=n,this.plugin=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uACB0\uACFC"}),e.createEl("p",{text:`${this.sections.length}\uAC1C\uC758 \uC139\uC158\uC73C\uB85C \uBD84\uB9AC\uB428. \uC0DD\uC131\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let t=e.createDiv({cls:"split-section-list"});this.sections.forEach((o,a)=>{let l=t.createDiv({cls:"split-section-item"});l.style.marginBottom="16px",l.style.padding="12px",l.style.border="1px solid var(--background-modifier-border)",l.style.borderRadius="8px";let c=l.createDiv({cls:"split-section-header"});c.style.display="flex",c.style.alignItems="center",c.style.gap="8px";let d=c.createEl("input",{type:"checkbox",attr:{checked:!0}});d.addEventListener("change",()=>{d.checked?this.selected.add(a):this.selected.delete(a)}),c.createEl("strong",{text:o.title});let h=c.createDiv({cls:"split-section-badges"});h.style.marginLeft="auto",h.style.display="flex",h.style.gap="4px";let p=h.createEl("span",{text:o.targetType,cls:"split-category-badge"});if(p.style.padding="2px 8px",p.style.borderRadius="4px",p.style.fontSize="12px",p.style.backgroundColor=this.getTargetTypeColor(o.targetType),p.style.color="white",o.project){let v=h.createEl("span",{text:o.project.startsWith("NEW:")?`\u2728 ${o.project.slice(4)}`:`\u{1F4C1} ${o.project}`,cls:"split-project-badge"});v.style.padding="2px 8px",v.style.borderRadius="4px",v.style.fontSize="12px",v.style.backgroundColor="var(--interactive-accent)",v.style.color="white"}let m=l.createDiv({cls:"split-section-preview"});m.style.marginTop="8px",m.style.fontSize="13px",m.style.color="var(--text-muted)",m.style.maxHeight="60px",m.style.overflow="hidden",m.style.textOverflow="ellipsis";let y=o.content.length>150?o.content.slice(0,150)+"...":o.content;if(m.setText(y),o.keywords.length>0){let v=l.createDiv({cls:"split-section-keywords"});v.style.marginTop="8px",v.style.fontSize="12px",v.setText(`\uD0A4\uC6CC\uB4DC: ${o.keywords.join(", ")}`)}});let n=e.createDiv({cls:"modal-button-container"});n.style.marginTop="16px",n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:`${this.selected.size}\uAC1C \uB178\uD2B8 \uC0DD\uC131`,cls:"mod-cta"}).addEventListener("click",async()=>{let o=this.sections.filter((a,l)=>this.selected.has(l));o.length>0&&(this.close(),await this.plugin.createSplitNotes(o,this.sourceFile))})}getTargetTypeColor(e){switch(e){case"project":return"#e67e22";case"library":return"#27ae60";case"archive":return"#95a5a6";default:return"#7f8c8d"}}onClose(){this.contentEl.empty()}},b_=class extends M.Modal{constructor(t,n,s,r=null){super(t);this.choiceMade=!1;this.result=n,this.onChoice=s,this.feedbackManager=r}recordFeedback(t){this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"reference_location",noteTitle:this.result.title,aiSuggestion:{targetType:this.result.targetType,projectName:this.result.projectName},userChoice:{accepted:t!==null&&this.result.targetType==="project"&&t==="project",modified:t||void 0,dismissed:t===null}})}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC800\uC7A5 \uC704\uCE58 \uC120\uD0DD"});let n=t.createDiv({cls:"reference-confirm-info"});n.style.marginBottom="16px",n.style.padding="12px",n.style.backgroundColor="var(--background-secondary)",n.style.borderRadius="8px",n.createEl("p",{text:`"${this.result.title}"`,cls:"reference-title"}).style.fontWeight="bold",n.createEl("p",{text:`\uAD00\uB828 \uD504\uB85C\uC81D\uD2B8: ${this.result.projectName}`,cls:"reference-project"}).style.color="var(--text-muted)",n.createEl("p",{text:"\uC774 \uC790\uB8CC\uB294 \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB85C \uBCF4\uC785\uB2C8\uB2E4. \uC5B4\uB514\uC5D0 \uC800\uC7A5\uD560\uAE4C\uC694?",cls:"reference-question"}).style.marginTop="8px";let s=t.createDiv({cls:"reference-options"});s.style.display="flex",s.style.flexDirection="column",s.style.gap="12px";let r=s.createDiv({cls:"reference-option"});r.style.padding="12px",r.style.border="1px solid var(--background-modifier-border)",r.style.borderRadius="8px",r.style.cursor="pointer",r.addEventListener("mouseenter",()=>{r.style.backgroundColor="var(--background-secondary)"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor=""}),r.createEl("strong",{text:"\u{1F4C1} \uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC800\uC7A5"}),r.createEl("p",{text:`Projects/${this.result.projectName}/ \uC5D0 \uC800\uC7A5`,cls:"option-desc"}).style.color="var(--text-muted)",r.createEl("small",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8 \uC804\uC6A9 \uC790\uB8CC\uB85C \uAD00\uB9AC"}).style.color="var(--text-faint)",r.addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback("project"),this.close(),this.onChoice("project")});let o=s.createDiv({cls:"reference-option"});o.style.padding="12px",o.style.border="2px solid var(--interactive-accent)",o.style.borderRadius="8px",o.style.cursor="pointer",o.style.backgroundColor="var(--background-secondary)",o.createEl("strong",{text:"\u{1F4DA} Library\uC5D0 \uC800\uC7A5 + \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C (\uAD8C\uC7A5)"}),o.createEl("p",{text:"Library/ \uC5D0 \uC800\uC7A5\uD558\uACE0 \uD504\uB85C\uC81D\uD2B8\uC640 \uC5F0\uACB0",cls:"option-desc"}).style.color="var(--text-muted)",o.createEl("small",{text:"\uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5"}).style.color="var(--text-faint)",o.addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback("library"),this.close(),this.onChoice("library")});let a=t.createDiv({cls:"modal-button-container"});a.style.marginTop="16px",a.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close())}onClose(){this.choiceMade||this.recordFeedback(null),this.contentEl.empty()}},E_=class extends M.Modal{constructor(e,t){super(e),this.plugin=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("zfb-command-list-modal");let t=e.createEl("h2",{text:"\u{1F9E0} Zero Friction Brain"});t.style.marginBottom="16px",t.style.textAlign="center";let n=[{name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkey:"Ctrl+Shift+G",icon:"folder",action:()=>this.plugin.classifyCurrentFile()},{name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkey:"Ctrl+Shift+L",icon:"link",action:()=>this.plugin.linkRelatedNotesForCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkey:"Ctrl+Shift+S",icon:"sparkles",action:()=>this.plugin.smartProcessCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkey:"Ctrl+Shift+D",icon:"split",action:()=>this.plugin.smartSplitCurrentFile()},{name:"ZK \uCD94\uCD9C",hotkey:"Ctrl+Shift+Z",icon:"file-plus",action:()=>this.plugin.extractZKFromCurrentFile()},{name:"URL \uAC00\uC838\uC624\uAE30",hotkey:"Ctrl+Shift+U",icon:"globe",action:()=>this.plugin.showURLImportModal()},{name:"Focus Top 3",hotkey:"Ctrl+Shift+;",icon:"target",action:()=>this.plugin.showFocusTop3()},{name:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC",hotkey:"Ctrl+Shift+R",icon:"calendar-check",action:()=>this.plugin.showReviewModal()},{name:"OCR \uCD94\uCD9C",hotkey:"Ctrl+Shift+O",icon:"scan",action:()=>this.plugin.ocrCurrentFile()},{divider:!0},{name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",hotkey:"",icon:"inbox",action:()=>this.plugin.processInbox()},{name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",hotkey:"",icon:"map",action:()=>this.plugin.showCreateMOCModal()},{name:"ZK Index \uC7AC\uAD6C\uCD95",hotkey:"",icon:"refresh-cw",action:()=>this.plugin.rebuildZKIndex()},{name:"Watch \uD1A0\uAE00",hotkey:"",icon:"eye",action:()=>this.plugin.toggleWatch()}],s=e.createDiv({cls:"zfb-command-list"});s.style.display="flex",s.style.flexDirection="column",s.style.gap="4px";for(let a of n){if("divider"in a&&a.divider){let h=s.createEl("hr");h.style.margin="8px 0",h.style.border="none",h.style.borderTop="1px solid var(--background-modifier-border)";continue}let l=s.createDiv({cls:"zfb-command-item"});l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="space-between",l.style.padding="10px 12px",l.style.borderRadius="6px",l.style.cursor="pointer",l.style.transition="background-color 0.1s",l.addEventListener("mouseenter",()=>{l.style.backgroundColor="var(--background-secondary)"}),l.addEventListener("mouseleave",()=>{l.style.backgroundColor=""});let c=l.createDiv();c.style.display="flex",c.style.alignItems="center",c.style.gap="10px";let d=c.createSpan({cls:"zfb-command-icon"});if((0,M.setIcon)(d,a.icon||"command"),d.style.opacity="0.7",c.createSpan({text:a.name}),a.hotkey){let h=l.createSpan({text:a.hotkey,cls:"zfb-command-hotkey"});h.style.fontSize="0.85em",h.style.color="var(--text-muted)",h.style.backgroundColor="var(--background-secondary)",h.style.padding="2px 8px",h.style.borderRadius="4px",h.style.fontFamily="monospace"}l.addEventListener("click",()=>{this.close(),a.action()})}let r=e.createDiv({cls:"zfb-command-footer"});r.style.marginTop="16px",r.style.paddingTop="12px",r.style.borderTop="1px solid var(--background-modifier-border)",r.style.textAlign="center",r.style.color="var(--text-muted)",r.style.fontSize="0.85em",r.createSpan({text:`v${this.plugin.manifest.version} \u2022 `});let o=r.createEl("a",{text:"\uC124\uC815"});o.style.cursor="pointer",o.addEventListener("click",()=>{this.close(),this.app.setting.open(),this.app.setting.openTabById("zero-friction-brain")})}onClose(){this.contentEl.empty()}},w_=class extends M.Modal{constructor(t,n,s){super(t);this.selectedPeriod="week";this.resultContainer=null;this.isLoading=!1;this.reviewManager=n,this.settings=s}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-review-modal"),t.createEl("h2",{text:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC"});let n=t.createDiv({cls:"zfb-review-period-section"});n.createEl("label",{text:"\uAE30\uAC04 \uC120\uD0DD:",cls:"setting-item-name"});let s=n.createDiv({cls:"zfb-period-buttons"});s.style.display="flex",s.style.gap="8px",s.style.marginTop="8px",s.style.marginBottom="16px",[{value:"today",label:"\uC624\uB298"},{value:"week",label:"\uC774\uBC88 \uC8FC"},{value:"month",label:"\uC774\uBC88 \uB2EC"}].forEach(({value:m,label:y})=>{let v=s.createEl("button",{text:y});v.style.padding="8px 16px",v.style.borderRadius="6px",v.style.cursor="pointer",m===this.selectedPeriod&&v.addClass("mod-cta"),v.addEventListener("click",()=>{this.selectedPeriod=m,s.querySelectorAll("button").forEach(E=>E.removeClass("mod-cta")),v.addClass("mod-cta"),this.loadNotes()})});let o=t.createDiv({cls:"zfb-review-filter-section"});o.style.marginBottom="16px",o.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uD544\uD130 (\uC120\uD0DD):",cls:"setting-item-name"});let a=o.createEl("select");a.style.marginLeft="8px",a.style.padding="4px 8px";let l=a.createEl("option",{text:"\uC804\uCCB4",value:""});l.value="",this.reviewManager.getProjectList().forEach(m=>{let y=a.createEl("option",{text:m,value:m});y.value=m}),a.addEventListener("change",()=>{this.projectFilter=a.value||void 0,this.loadNotes()}),this.resultContainer=t.createDiv({cls:"zfb-review-results"}),this.resultContainer.style.marginTop="16px",this.resultContainer.style.maxHeight="400px",this.resultContainer.style.overflowY="auto";let d=t.createDiv({cls:"modal-button-container"});d.style.marginTop="16px",d.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close()),d.createEl("button",{text:"AI \uBD84\uC11D \uBC0F \uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createReviewNote()),this.loadNotes()}async loadNotes(){if(!(!this.resultContainer||this.isLoading)){this.isLoading=!0,this.resultContainer.empty(),this.resultContainer.createEl("p",{text:"\uB178\uD2B8 \uC218\uC9D1 \uC911...",cls:"zfb-loading"});try{let t={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.collectNotes(t),s=this.reviewManager.groupByProject(n);this.renderResults(n,s)}catch(t){console.error("\uB178\uD2B8 \uC218\uC9D1 \uC2E4\uD328:",t),this.resultContainer.empty(),this.resultContainer.createEl("p",{text:`\uC624\uB958: ${t}`,cls:"zfb-error"})}finally{this.isLoading=!1}}}renderResults(t,n){if(!this.resultContainer)return;if(this.resultContainer.empty(),t.length===0){this.resultContainer.createEl("p",{text:"\uD574\uB2F9 \uAE30\uAC04\uC5D0 \uC791\uC5C5\uD55C \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.",cls:"zfb-empty-message"});return}let s=this.resultContainer.createDiv({cls:"zfb-review-summary"});s.style.padding="12px",s.style.backgroundColor="var(--background-secondary)",s.style.borderRadius="8px",s.style.marginBottom="16px";let r=Vc(this.selectedPeriod,this.settings.timezone);s.createEl("p",{text:`${r.label} \uC791\uC5C5: ${t.length}\uAC1C \uB178\uD2B8, ${n.length}\uAC1C \uD504\uB85C\uC81D\uD2B8/\uC601\uC5ED`});for(let o of n){let a=this.resultContainer.createDiv({cls:"zfb-review-group"});a.style.marginBottom="16px";let l=a.createEl("h4",{text:`\u{1F4C1} ${o.projectName} (${o.noteCount}\uAC1C)`});l.style.marginBottom="8px",l.style.borderBottom="1px solid var(--background-modifier-border)",l.style.paddingBottom="4px";let c=a.createEl("ul");c.style.listStyle="none",c.style.paddingLeft="16px",c.style.margin="0";for(let d of o.notes){let h=c.createEl("li");h.style.display="flex",h.style.justifyContent="space-between",h.style.alignItems="center",h.style.padding="4px 0";let p=h.createEl("a",{text:d.title});p.style.cursor="pointer",p.style.color="var(--text-accent)",p.addEventListener("click",async()=>{this.app.vault.getAbstractFileByPath(d.path)instanceof M.TFile&&await this.app.workspace.openLinkText(d.path,"")});let m=h.createEl("span",{text:D_(d.modified),cls:"zfb-note-time"});m.style.fontSize="0.85em",m.style.color="var(--text-muted)"}}}async createReviewNote(){if(!this.isLoading){this.isLoading=!0,new M.Notice("AI \uBD84\uC11D \uC911...");try{let t={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.analyze(t),s=await this.reviewManager.createReviewNote(n);new M.Notice(`\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131\uB428: ${s.basename}`),await this.app.workspace.openLinkText(s.path,""),this.close()}catch(t){console.error("\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328:",t),new M.Notice(`\uC0DD\uC131 \uC2E4\uD328: ${t}`)}finally{this.isLoading=!1}}}onClose(){this.contentEl.empty()}};
/*! Bundled license information:

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
