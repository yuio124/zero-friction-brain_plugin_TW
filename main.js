/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var kf=Object.defineProperty;var oM=Object.getOwnPropertyDescriptor;var aM=Object.getOwnPropertyNames;var lM=Object.prototype.hasOwnProperty;var cM=(i,e,t)=>e in i?kf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var dM=(i,e)=>{for(var t in e)kf(i,t,{get:e[t],enumerable:!0})},uM=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of aM(e))!lM.call(i,s)&&s!==t&&kf(i,s,{get:()=>e[s],enumerable:!(n=oM(e,s))||n.enumerable});return i};var hM=i=>uM(kf({},"__esModule",{value:!0}),i);var W=(i,e,t)=>(cM(i,typeof e!="symbol"?e+"":e,t),t),Kv=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var u=(i,e,t)=>(Kv(i,e,"read from private field"),t?t.call(i):e.get(i)),E=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},A=(i,e,t,n)=>(Kv(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t);var vt=(i,e,t,n)=>({set _(s){A(i,e,s,t)},get _(){return u(i,e,n)}}),S=(i,e,t)=>(Kv(i,e,"access private method"),t);var OG={};dM(OG,{default:()=>Wv});module.exports=hM(OG);var P=require("obsidian");var iC={geminiApiKey:"",inboxFolder:"00 _Inbox",projectsFolder:"01 Projects",libraryFolder:"02 Library",archivesFolder:"03 Archives",zettelFolder:"10 Zettelkasten",autoWatch:!0,triggerTag:"#\uC644\uB8CC",language:"ko",ocrEnabled:!0,ocrAutoProcess:!1,ocrMoveOriginal:!0,ocrOriginalFolder:"03 Archives/OCR_\uC6D0\uBCF8",ocrMinTextThreshold:50,ocrMaxPages:20,ocrMaxFileSizeMB:10,ocrDailyLimit:50,zkIdType:"date-sequence",zkMergeThreshold:.8,timezone:"auto",dateFormat:"local",scheduleDetectionEnabled:!0,dailyNotesFolder:"00 _Inbox",googleCalendarEnabled:!1,useOwnApiKey:!1,googleClientId:"",googleClientSecret:"",googleAccessToken:"",googleRefreshToken:"",googleTokenExpiry:0,calendarEnabled:!0,calendarDefaultView:"month",calendarFirstDayOfWeek:0,showMiniCalendar:!0};var se=require("obsidian");var oC=[{value:"auto",label:"\uC790\uB3D9 \uAC10\uC9C0"},{value:"Asia/Seoul",label:"\uD55C\uAD6D (KST, UTC+9)"},{value:"Asia/Tokyo",label:"\uC77C\uBCF8 (JST, UTC+9)"},{value:"Asia/Shanghai",label:"\uC911\uAD6D (CST, UTC+8)"},{value:"America/New_York",label:"\uBBF8\uAD6D \uB3D9\uBD80 (EST/EDT)"},{value:"America/Los_Angeles",label:"\uBBF8\uAD6D \uC11C\uBD80 (PST/PDT)"},{value:"Europe/London",label:"\uC601\uAD6D (GMT/BST)"},{value:"UTC",label:"UTC"}],aC=[{value:"iso",label:"ISO \uD615\uC2DD (2026-01-05T16:24:45+09:00)"},{value:"local",label:"\uB85C\uCEEC \uD615\uC2DD (2026-01-05 16:24:45)"},{value:"friendly",label:"\uCE5C\uADFC\uD55C \uD615\uC2DD (2026\uB144 1\uC6D4 5\uC77C 16:24)"}];function Nf(i){return i==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:i}function Xv(i,e,t){let n=Nf(e);switch(t){case"iso":return fM(i,n);case"local":return sC(i,n);case"friendly":return pM(i,n);default:return sC(i,n)}}function fM(i,e){let t={timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",t).formatToParts(i),s=p=>{var m;return((m=n.find(y=>y.type===p))==null?void 0:m.value)||""},r=s("year"),o=s("month"),a=s("day"),l=s("hour"),c=s("minute"),d=s("second"),h=gM(i,e);return`${r}-${o}-${a}T${l}:${c}:${d}${h}`}function sC(i,e){let t={timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",t).formatToParts(i),s=h=>{var p;return((p=n.find(m=>m.type===h))==null?void 0:p.value)||""},r=s("year"),o=s("month"),a=s("day"),l=s("hour"),c=s("minute"),d=s("second");return`${r}-${o}-${a} ${l}:${c}:${d}`}function pM(i,e){let t={timeZone:e,year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};return new Intl.DateTimeFormat("ko-KR",t).format(i)}function gM(i,e){let t=new Date(i.toLocaleString("en-US",{timeZone:"UTC"})),s=(new Date(i.toLocaleString("en-US",{timeZone:e})).getTime()-t.getTime())/(1e3*60);if(s===0)return"Z";let r=s>=0?"+":"-",o=Math.abs(s),a=Math.floor(o/60),l=o%60;return`${r}${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}`}function Le(i,e){let n={timeZone:Nf(e),year:"numeric",month:"2-digit",day:"2-digit"},s=new Intl.DateTimeFormat("en-CA",n).formatToParts(i),r=o=>{var a;return((a=s.find(l=>l.type===o))==null?void 0:a.value)||""};return`${r("year")}-${r("month")}-${r("day")}`}function Oe(i,e){return Xv(new Date,i,e)}function Yn(i){return Le(new Date,i)}function Lc(i,e){let t=Nf(e),n=new Date;switch(i){case"today":return rC(n,t);case"week":return mM(n,t);case"month":return yM(n,t);default:return rC(n,t)}}function rC(i,e){let t=Jv(i,e),n=Zv(i,e);return{start:t,end:n,label:"\uC624\uB298"}}function mM(i,e){let t=i.getDay(),n=t===0?6:t-1,s=new Date(i);s.setDate(s.getDate()-n);let r=new Date(s);return r.setDate(r.getDate()+6),{start:Jv(s,e),end:Zv(r,e),label:"\uC774\uBC88 \uC8FC"}}function yM(i,e){let t=new Date(i.getFullYear(),i.getMonth(),1),n=new Date(i.getFullYear(),i.getMonth()+1,0);return{start:Jv(t,e),end:Zv(n,e),label:"\uC774\uBC88 \uB2EC"}}function Jv(i,e){let t=new Date(i);return t.setHours(0,0,0,0),t}function Zv(i,e){let t=new Date(i);return t.setHours(23,59,59,999),t}function lC(i,e){return i>=e.start&&i<=e.end}function Qv(i){let e=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);let n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e.getTime()-n.getTime())/864e5+1)/7)}function cC(i,e,t){let n=Nf(t);switch(i){case"today":return`${Le(e,n)} \uC77C\uC77C \uD68C\uACE0.md`;case"week":let s=Qv(e);return`${e.getFullYear()}-W${String(s).padStart(2,"0")} \uC8FC\uAC04 \uD68C\uACE0.md`;case"month":return`${Le(e,n).substring(0,7)} \uC6D4\uAC04 \uD68C\uACE0.md`;default:return`${Le(e,n)} \uD68C\uACE0.md`}}function dC(i){let t=new Date().getTime()-i.getTime(),n=Math.floor(t/(1e3*60)),s=Math.floor(t/(1e3*60*60)),r=Math.floor(t/(1e3*60*60*24));return n<1?"\uBC29\uAE08 \uC804":n<60?`${n}\uBD84 \uC804`:s<24?`${s}\uC2DC\uAC04 \uC804`:r===1?"\uC5B4\uC81C":r<7?`${r}\uC77C \uC804`:r<30?`${Math.floor(r/7)}\uC8FC \uC804`:`${Math.floor(r/30)}\uAC1C\uC6D4 \uC804`}var Ff=class extends se.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"Zero Friction Brain \uC124\uC815"}),e.createEl("h3",{text:"API \uC124\uC815"}),new se.Setting(e).setName("Gemini API \uD0A4").setDesc(createFragment(n=>{n.appendText("Gemini API \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694. "),n.createEl("a",{text:"API \uD0A4 \uBC1C\uAE09\uBC1B\uAE30",href:"https://aistudio.google.com/apikey"})})).addText(n=>n.setPlaceholder("AIzaSy...").setValue(this.plugin.settings.geminiApiKey).onChange(async s=>{this.plugin.settings.geminiApiKey=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:"\uD3F4\uB354 \uC124\uC815"}),new se.Setting(e).setName("Inbox \uD3F4\uB354").setDesc("\uC0C8 \uB178\uD2B8\uAC00 \uC800\uC7A5\uB418\uB294 \uD3F4\uB354").addText(n=>n.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.inboxFolder).onChange(async s=>{this.plugin.settings.inboxFolder=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Projects \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uBCC4 \uD558\uC704 \uD3F4\uB354\uAC00 \uC0DD\uC131\uB429\uB2C8\uB2E4").addText(n=>n.setPlaceholder("01 Projects").setValue(this.plugin.settings.projectsFolder).onChange(async s=>{this.plugin.settings.projectsFolder=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Library \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uC5D0 \uC18D\uD558\uC9C0 \uC54A\uB294 \uCC38\uACE0 \uC790\uB8CC").addText(n=>n.setPlaceholder("02 Library").setValue(this.plugin.settings.libraryFolder).onChange(async s=>{this.plugin.settings.libraryFolder=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Archives \uD3F4\uB354").setDesc("\uC644\uB8CC\uB41C \uD504\uB85C\uC81D\uD2B8 (\uD1B5\uC9F8\uB85C \uC774\uB3D9)").addText(n=>n.setPlaceholder("03 Archives").setValue(this.plugin.settings.archivesFolder).onChange(async s=>{this.plugin.settings.archivesFolder=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Zettelkasten \uD3F4\uB354").setDesc("ZK \uC601\uAD6C \uB178\uD2B8 \uC800\uC7A5 \uC704\uCE58").addText(n=>n.setPlaceholder("10 Zettelkasten").setValue(this.plugin.settings.zettelFolder).onChange(async s=>{this.plugin.settings.zettelFolder=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("\uD3F4\uB354 \uAD6C\uC870 \uC0DD\uC131").setDesc("\uC704\uC5D0 \uC124\uC815\uB41C \uD3F4\uB354\uB4E4\uC744 \uC790\uB3D9\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4").addButton(n=>n.setButtonText("\uD3F4\uB354 \uC0DD\uC131").setCta().onClick(async()=>{await this.createFolderStructure()})),e.createEl("h3",{text:"\uC635\uC158"}),new se.Setting(e).setName("Inbox \uC790\uB3D9 \uAC10\uC2DC").setDesc("Inbox \uD3F4\uB354\uC758 \uD30C\uC77C\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC2DC\uD558\uC5EC \uBD84\uB958").addToggle(n=>n.setValue(this.plugin.settings.autoWatch).onChange(async s=>{this.plugin.settings.autoWatch=s,await this.plugin.saveSettings(),s?this.plugin.startWatcher():this.plugin.stopWatcher()})),new se.Setting(e).setName("\uD2B8\uB9AC\uAC70 \uD0DC\uADF8").setDesc("\uC774 \uD0DC\uADF8\uAC00 \uC788\uB294 \uB178\uD2B8\uB9CC \uC790\uB3D9 \uBD84\uB958 (\uC608: #\uC644\uB8CC)").addText(n=>n.setPlaceholder("#\uC644\uB8CC").setValue(this.plugin.settings.triggerTag).onChange(async s=>{this.plugin.settings.triggerTag=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:"OCR \uC124\uC815"}),new se.Setting(e).setName("OCR \uAE30\uB2A5 \uD65C\uC131\uD654").setDesc("\uC774\uBBF8\uC9C0 \uBC0F PDF\uC5D0\uC11C \uD14D\uC2A4\uD2B8 \uCD94\uCD9C").addToggle(n=>n.setValue(this.plugin.settings.ocrEnabled).onChange(async s=>{this.plugin.settings.ocrEnabled=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("OCR \uD6C4 \uC6D0\uBCF8 \uC774\uB3D9").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC744 \uC9C0\uC815 \uD3F4\uB354\uB85C \uC774\uB3D9").addToggle(n=>n.setValue(this.plugin.settings.ocrMoveOriginal).onChange(async s=>{this.plugin.settings.ocrMoveOriginal=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uD3F4\uB354").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC774 \uC774\uB3D9\uB420 \uD3F4\uB354").addText(n=>n.setPlaceholder("03 Archives/OCR_\uC6D0\uBCF8").setValue(this.plugin.settings.ocrOriginalFolder).onChange(async s=>{this.plugin.settings.ocrOriginalFolder=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:"OCR \uC81C\uD55C (API \uC694\uAE08 \uBCF4\uD638)"}),new se.Setting(e).setName("\uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").setDesc("\uD55C \uBC88\uC5D0 \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 PDF \uD398\uC774\uC9C0 \uC218").addSlider(n=>n.setLimits(1,100,1).setValue(this.plugin.settings.ocrMaxPages).setDynamicTooltip().onChange(async s=>{this.plugin.settings.ocrMaxPages=s,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (20)").onClick(async()=>{this.plugin.settings.ocrMaxPages=20,await this.plugin.saveSettings(),this.display()})),new se.Setting(e).setName("\uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30 (MB)").setDesc("\uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30").addSlider(n=>n.setLimits(1,50,1).setValue(this.plugin.settings.ocrMaxFileSizeMB).setDynamicTooltip().onChange(async s=>{this.plugin.settings.ocrMaxFileSizeMB=s,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (10)").onClick(async()=>{this.plugin.settings.ocrMaxFileSizeMB=10,await this.plugin.saveSettings(),this.display()})),new se.Setting(e).setName("\uC77C\uC77C \uCC98\uB9AC \uD55C\uB3C4 (\uD398\uC774\uC9C0)").setDesc("\uD558\uB8E8\uC5D0 OCR \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").addSlider(n=>n.setLimits(10,500,10).setValue(this.plugin.settings.ocrDailyLimit).setDynamicTooltip().onChange(async s=>{this.plugin.settings.ocrDailyLimit=s,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (50)").onClick(async()=>{this.plugin.settings.ocrDailyLimit=50,await this.plugin.saveSettings(),this.display()})),e.createDiv({cls:"ocr-usage-info"}).createEl("p",{text:`\uC624\uB298 \uC0AC\uC6A9\uB7C9: ${this.plugin.getOCRDailyUsage().pagesProcessed}/${this.plugin.settings.ocrDailyLimit} \uD398\uC774\uC9C0`,cls:"setting-item-description"}),e.createEl("h3",{text:"Zettelkasten \uC124\uC815"}),new se.Setting(e).setName("ZK \uB178\uD2B8 ID \uD615\uC2DD").setDesc("ZK \uB178\uD2B8 \uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uD560 ID \uD615\uC2DD").addDropdown(n=>n.addOption("timestamp","\uD0C0\uC784\uC2A4\uD0EC\uD504 (1735789200000)").addOption("date-sequence","\uB0A0\uC9DC+\uC21C\uBC88 (20260102-001)").addOption("luhmann","\uB8E8\uB9CC \uC2A4\uD0C0\uC77C (1a1b)").setValue(this.plugin.settings.zkIdType).onChange(async s=>{this.plugin.settings.zkIdType=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("\uC720\uC0AC \uB178\uD2B8 \uBCD1\uD569 \uC784\uACC4\uAC12").setDesc("\uC774 \uAC12 \uC774\uC0C1\uC758 \uC720\uC0AC\uB3C4\uB97C \uAC00\uC9C4 \uB178\uD2B8\uAC00 \uC788\uC73C\uBA74 \uBCD1\uD569 \uC81C\uC548 (0.5~1.0)").addSlider(n=>n.setLimits(.5,1,.05).setValue(this.plugin.settings.zkMergeThreshold).setDynamicTooltip().onChange(async s=>{this.plugin.settings.zkMergeThreshold=s,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (0.8)").onClick(async()=>{this.plugin.settings.zkMergeThreshold=.8,await this.plugin.saveSettings(),this.display()})),e.createEl("h3",{text:"\uC2DC\uAC04\uB300 \uBC0F \uB0A0\uC9DC \uD615\uC2DD"}),new se.Setting(e).setName("\uC2DC\uAC04\uB300").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504\uC5D0 \uC0AC\uC6A9\uD560 \uC2DC\uAC04\uB300").addDropdown(n=>{oC.forEach(s=>{n.addOption(s.value,s.label)}),n.setValue(this.plugin.settings.timezone).onChange(async s=>{this.plugin.settings.timezone=s,await this.plugin.saveSettings()})}),new se.Setting(e).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504 \uD45C\uC2DC \uD615\uC2DD").addDropdown(n=>{aC.forEach(s=>{n.addOption(s.value,s.label)}),n.setValue(this.plugin.settings.dateFormat).onChange(async s=>{this.plugin.settings.dateFormat=s,await this.plugin.saveSettings()})}),e.createEl("h3",{text:"\uC77C\uC815 \uAC10\uC9C0"}),new se.Setting(e).setName("\uC77C\uC815 \uC790\uB3D9 \uAC10\uC9C0").setDesc("\uB178\uD2B8 \uBD84\uB958 \uC2DC \uC77C\uC815/\uD560\uC77C/\uC57D\uC18D\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC9C0").addToggle(n=>n.setValue(this.plugin.settings.scheduleDetectionEnabled).onChange(async s=>{this.plugin.settings.scheduleDetectionEnabled=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("Daily Notes \uD3F4\uB354").setDesc("\uC77C\uC815\uC774 \uC800\uC7A5\uB420 Daily Notes \uD3F4\uB354").addText(n=>n.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.dailyNotesFolder).onChange(async s=>{this.plugin.settings.dailyNotesFolder=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Google Calendar \uC5F0\uB3D9"}),new se.Setting(e).setName("Google Calendar \uD65C\uC131\uD654").setDesc("\uC77C\uC815\uC744 Google Calendar\uC5D0\uB3C4 \uC800\uC7A5\uD569\uB2C8\uB2E4").addToggle(n=>n.setValue(this.plugin.settings.googleCalendarEnabled).onChange(async s=>{this.plugin.settings.googleCalendarEnabled=s,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.googleCalendarEnabled){let n=!!this.plugin.settings.googleRefreshToken,s=n?"\uC5F0\uACB0\uB428 \u2713":"\uC5F0\uACB0 \uC548\uB428";if(new se.Setting(e).setName("Google \uACC4\uC815").setDesc(s).addButton(r=>r.setButtonText(n?"\uC7AC\uC5F0\uACB0":"\uC5F0\uACB0\uD558\uAE30").setCta().onClick(async()=>{await this.plugin.connectGoogleCalendar()})).addButton(r=>(n&&r.setButtonText("\uC5F0\uACB0 \uD574\uC81C").onClick(async()=>{await this.plugin.disconnectGoogleCalendar(),this.display()}),r)),new se.Setting(e).setName("\uC790\uCCB4 API \uD0A4 \uC0AC\uC6A9 (Advanced)").setDesc("\uC9C1\uC811 Google Cloud Console\uC5D0\uC11C \uC0DD\uC131\uD55C Client ID\uB97C \uC0AC\uC6A9\uD569\uB2C8\uB2E4").addToggle(r=>r.setValue(this.plugin.settings.useOwnApiKey).onChange(async o=>{this.plugin.settings.useOwnApiKey=o,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.useOwnApiKey){new se.Setting(e).setName("Google Client ID").setDesc("Google Cloud Console\uC5D0\uC11C \uC0DD\uC131\uD55C OAuth 2.0 Client ID").addText(o=>o.setPlaceholder("xxxxx.apps.googleusercontent.com").setValue(this.plugin.settings.googleClientId).onChange(async a=>{this.plugin.settings.googleClientId=a,await this.plugin.saveSettings()})),new se.Setting(e).setName("Google Client Secret").setDesc("OAuth 2.0 Client Secret").addText(o=>o.setPlaceholder("GOCSPX-...").setValue(this.plugin.settings.googleClientSecret).onChange(async a=>{this.plugin.settings.googleClientSecret=a,await this.plugin.saveSettings()}));let r=e.createDiv({cls:"setting-item-description"});r.createEl("p",{text:"Google Cloud Console\uC5D0\uC11C OAuth 2.0 \uD074\uB77C\uC774\uC5B8\uD2B8 ID\uB97C \uC0DD\uC131\uD558\uC138\uC694:"}),r.createEl("a",{text:"Google Cloud Console \uC5F4\uAE30",href:"https://console.cloud.google.com/apis/credentials"}),r.createEl("p",{text:"\uB9AC\uB514\uB809\uC158 URI: http://127.0.0.1:42813/callback",cls:"setting-item-description"}).style.fontFamily="monospace"}}e.createEl("h3",{text:"\uCE98\uB9B0\uB354 \uBDF0"}),new se.Setting(e).setName("\uCE98\uB9B0\uB354 \uBDF0 \uD65C\uC131\uD654").setDesc("\uB178\uD2B8, \uC77C\uC815, \uD68C\uC758\uB85D\uC744 \uCE98\uB9B0\uB354\uB85C \uD655\uC778\uD569\uB2C8\uB2E4").addToggle(n=>n.setValue(this.plugin.settings.calendarEnabled).onChange(async s=>{this.plugin.settings.calendarEnabled=s,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.calendarEnabled&&(new se.Setting(e).setName("\uAE30\uBCF8 \uBDF0").setDesc("\uCE98\uB9B0\uB354\uB97C \uC5F4 \uB54C \uAE30\uBCF8\uC73C\uB85C \uD45C\uC2DC\uD560 \uBDF0").addDropdown(n=>n.addOption("month","\uC6D4\uAC04").addOption("week","\uC8FC\uAC04").addOption("day","\uC77C\uAC04").addOption("list","\uBAA9\uB85D").setValue(this.plugin.settings.calendarDefaultView).onChange(async s=>{this.plugin.settings.calendarDefaultView=s,await this.plugin.saveSettings()})),new se.Setting(e).setName("\uC8FC \uC2DC\uC791\uC77C").setDesc("\uCE98\uB9B0\uB354\uC758 \uCCAB \uBC88\uC9F8 \uC694\uC77C").addDropdown(n=>n.addOption("0","\uC77C\uC694\uC77C").addOption("1","\uC6D4\uC694\uC77C").setValue(String(this.plugin.settings.calendarFirstDayOfWeek)).onChange(async s=>{this.plugin.settings.calendarFirstDayOfWeek=parseInt(s),await this.plugin.saveSettings()})),new se.Setting(e).setName("\uC0AC\uC774\uB4DC\uBC14 \uBBF8\uB2C8 \uCE98\uB9B0\uB354").setDesc("\uC624\uB978\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uBBF8\uB2C8 \uCE98\uB9B0\uB354\uB97C \uD45C\uC2DC\uD569\uB2C8\uB2E4").addToggle(n=>n.setValue(this.plugin.settings.showMiniCalendar).onChange(async s=>{this.plugin.settings.showMiniCalendar=s,await this.plugin.saveSettings(),s&&await this.plugin.toggleMiniCalendar()})),new se.Setting(e).setName("\uCE98\uB9B0\uB354 \uC5F4\uAE30").setDesc("Ctrl+Shift+C \uB610\uB294 \uB9AC\uBCF8 \uC544\uC774\uCF58\uC73C\uB85C\uB3C4 \uC5F4 \uC218 \uC788\uC2B5\uB2C8\uB2E4").addButton(n=>n.setButtonText("\uCE98\uB9B0\uB354 \uC5F4\uAE30").setCta().onClick(async()=>{await this.plugin.openCalendarView()})))}async createFolderStructure(){let e=[this.plugin.settings.inboxFolder,this.plugin.settings.projectsFolder,this.plugin.settings.libraryFolder,this.plugin.settings.archivesFolder,this.plugin.settings.zettelFolder],t=0,n=0;for(let s of e){if(!s)continue;if(this.app.vault.getAbstractFileByPath(s))n++;else try{await this.app.vault.createFolder(s),t++}catch(o){console.error(`\uD3F4\uB354 \uC0DD\uC131 \uC2E4\uD328: ${s}`,o)}}t>0?new se.Notice(`${t}\uAC1C \uD3F4\uB354 \uC0DD\uC131\uB428, ${n}\uAC1C \uC774\uBBF8 \uC874\uC7AC`):new se.Notice(`\uBAA8\uB4E0 \uD3F4\uB354\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4 (${n}\uAC1C)`)}};var vM,EM;function bM(){return{geminiUrl:vM,vertexUrl:EM}}function AM(i,e,t,n){var s,r;if(!(i!=null&&i.baseUrl)){let o=bM();return e?(s=o.vertexUrl)!==null&&s!==void 0?s:t:(r=o.geminiUrl)!==null&&r!==void 0?r:n}return i.baseUrl}var Sn=class{};function O(i,e){let t=/\{([^}]+)\}/g;return i.replace(t,(n,s)=>{if(Object.prototype.hasOwnProperty.call(e,s)){let r=e[s];return r!=null?String(r):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function g(i,e,t){for(let r=0;r<e.length-1;r++){let o=e[r];if(o.endsWith("[]")){let a=o.slice(0,-2);if(!(a in i))if(Array.isArray(t))i[a]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(i[a])){let l=i[a];if(Array.isArray(t))for(let c=0;c<l.length;c++){let d=l[c];g(d,e.slice(r+1),t[c])}else for(let c of l)g(c,e.slice(r+1),t)}return}else if(o.endsWith("[0]")){let a=o.slice(0,-3);a in i||(i[a]=[{}]);let l=i[a];g(l[0],e.slice(r+1),t);return}(!i[o]||typeof i[o]!="object")&&(i[o]={}),i=i[o]}let n=e[e.length-1],s=i[n];if(s!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===s)return;if(typeof s=="object"&&typeof t=="object"&&s!==null&&t!==null)Object.assign(s,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(i,t):i[n]=t}function f(i,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return i;for(let n=0;n<e.length;n++){if(typeof i!="object"||i===null)return t;let s=e[n];if(s.endsWith("[]")){let r=s.slice(0,-2);if(r in i){let o=i[r];return Array.isArray(o)?o.map(a=>f(a,e.slice(n+1),t)):t}else return t}else i=i[s]}return i}catch(n){if(n instanceof TypeError)return t;throw n}}function wM(i,e){for(let[t,n]of Object.entries(e)){let s=t.split("."),r=n.split("."),o=new Set,a=-1;for(let l=0;l<s.length;l++)if(s[l]==="*"){a=l;break}if(a!==-1&&r.length>a)for(let l=a;l<r.length;l++){let c=r[l];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&o.add(c)}tE(i,s,r,0,o)}}function tE(i,e,t,n,s){if(n>=e.length||typeof i!="object"||i===null)return;let r=e[n];if(r.endsWith("[]")){let o=r.slice(0,-2),a=i;if(o in a&&Array.isArray(a[o]))for(let l of a[o])tE(l,e,t,n+1,s)}else if(r==="*"){if(typeof i=="object"&&i!==null&&!Array.isArray(i)){let o=i,a=Object.keys(o).filter(c=>!c.startsWith("_")&&!s.has(c)),l={};for(let c of a)l[c]=o[c];for(let[c,d]of Object.entries(l)){let h=[];for(let p of t.slice(n))p==="*"?h.push(c):h.push(p);g(o,h,d)}for(let c of a)delete o[c]}}else{let o=i;r in o&&tE(o[r],e,t,n+1,s)}}function jE(i){if(typeof i!="string")throw new Error("fromImageBytes must be a string");return i}function SM(i){let e={},t=f(i,["operationName"]);t!=null&&g(e,["operationName"],t);let n=f(i,["resourceName"]);return n!=null&&g(e,["_url","resourceName"],n),e}function _M(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response","generateVideoResponse"]);return o!=null&&g(e,["response"],TM(o)),e}function CM(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],xM(o)),e}function TM(i){let e={},t=f(i,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>RM(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function xM(i){let e={},t=f(i,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>IM(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function RM(i){let e={},t=f(i,["video"]);return t!=null&&g(e,["video"],FM(t)),e}function IM(i){let e={},t=f(i,["_self"]);return t!=null&&g(e,["video"],LM(t)),e}function DM(i){let e={},t=f(i,["operationName"]);return t!=null&&g(e,["_url","operationName"],t),e}function MM(i){let e={},t=f(i,["operationName"]);return t!=null&&g(e,["_url","operationName"],t),e}function PM(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],kM(o)),e}function kM(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["parent"]);n!=null&&g(e,["parent"],n);let s=f(i,["documentName"]);return s!=null&&g(e,["documentName"],s),e}function NT(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],NM(o)),e}function NM(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["parent"]);n!=null&&g(e,["parent"],n);let s=f(i,["documentName"]);return s!=null&&g(e,["documentName"],s),e}function FM(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["uri"],t);let n=f(i,["encodedVideo"]);n!=null&&g(e,["videoBytes"],jE(n));let s=f(i,["encoding"]);return s!=null&&g(e,["mimeType"],s),e}function LM(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["uri"],t);let n=f(i,["bytesBase64Encoded"]);n!=null&&g(e,["videoBytes"],jE(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}var uC;(function(i){i.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",i.OUTCOME_OK="OUTCOME_OK",i.OUTCOME_FAILED="OUTCOME_FAILED",i.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(uC||(uC={}));var hC;(function(i){i.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",i.PYTHON="PYTHON"})(hC||(hC={}));var fC;(function(i){i.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",i.SILENT="SILENT",i.WHEN_IDLE="WHEN_IDLE",i.INTERRUPT="INTERRUPT"})(fC||(fC={}));var ms;(function(i){i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.STRING="STRING",i.NUMBER="NUMBER",i.INTEGER="INTEGER",i.BOOLEAN="BOOLEAN",i.ARRAY="ARRAY",i.OBJECT="OBJECT",i.NULL="NULL"})(ms||(ms={}));var pC;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(pC||(pC={}));var gC;(function(i){i.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",i.SIMPLE_SEARCH="SIMPLE_SEARCH",i.ELASTIC_SEARCH="ELASTIC_SEARCH"})(gC||(gC={}));var mC;(function(i){i.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",i.NO_AUTH="NO_AUTH",i.API_KEY_AUTH="API_KEY_AUTH",i.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",i.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",i.OAUTH="OAUTH",i.OIDC_AUTH="OIDC_AUTH"})(mC||(mC={}));var yC;(function(i){i.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",i.HTTP_IN_QUERY="HTTP_IN_QUERY",i.HTTP_IN_HEADER="HTTP_IN_HEADER",i.HTTP_IN_PATH="HTTP_IN_PATH",i.HTTP_IN_BODY="HTTP_IN_BODY",i.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(yC||(yC={}));var vC;(function(i){i.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",i.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",i.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",i.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(vC||(vC={}));var EC;(function(i){i.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH",i.MINIMAL="MINIMAL"})(EC||(EC={}));var bC;(function(i){i.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",i.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",i.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",i.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",i.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",i.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",i.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",i.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",i.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(bC||(bC={}));var AC;(function(i){i.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",i.SEVERITY="SEVERITY",i.PROBABILITY="PROBABILITY"})(AC||(AC={}));var wC;(function(i){i.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",i.OFF="OFF"})(wC||(wC={}));var SC;(function(i){i.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",i.STOP="STOP",i.MAX_TOKENS="MAX_TOKENS",i.SAFETY="SAFETY",i.RECITATION="RECITATION",i.LANGUAGE="LANGUAGE",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.SPII="SPII",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.IMAGE_SAFETY="IMAGE_SAFETY",i.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",i.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",i.NO_IMAGE="NO_IMAGE",i.IMAGE_RECITATION="IMAGE_RECITATION",i.IMAGE_OTHER="IMAGE_OTHER"})(SC||(SC={}));var _C;(function(i){i.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH"})(_C||(_C={}));var CC;(function(i){i.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",i.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",i.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",i.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",i.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(CC||(CC={}));var TC;(function(i){i.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",i.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",i.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",i.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",i.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(TC||(TC={}));var xC;(function(i){i.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",i.SAFETY="SAFETY",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.IMAGE_SAFETY="IMAGE_SAFETY",i.MODEL_ARMOR="MODEL_ARMOR",i.JAILBREAK="JAILBREAK"})(xC||(xC={}));var RC;(function(i){i.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",i.ON_DEMAND="ON_DEMAND",i.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(RC||(RC={}));var $f;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.AUDIO="AUDIO"})($f||($f={}));var IC;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(IC||(IC={}));var DC;(function(i){i.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",i.TUNING_MODE_FULL="TUNING_MODE_FULL",i.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(DC||(DC={}));var MC;(function(i){i.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",i.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",i.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",i.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",i.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",i.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",i.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(MC||(MC={}));var nE;(function(i){i.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",i.JOB_STATE_QUEUED="JOB_STATE_QUEUED",i.JOB_STATE_PENDING="JOB_STATE_PENDING",i.JOB_STATE_RUNNING="JOB_STATE_RUNNING",i.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",i.JOB_STATE_FAILED="JOB_STATE_FAILED",i.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",i.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",i.JOB_STATE_PAUSED="JOB_STATE_PAUSED",i.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",i.JOB_STATE_UPDATING="JOB_STATE_UPDATING",i.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(nE||(nE={}));var PC;(function(i){i.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",i.TUNING_TASK_I2V="TUNING_TASK_I2V",i.TUNING_TASK_T2V="TUNING_TASK_T2V",i.TUNING_TASK_R2V="TUNING_TASK_R2V"})(PC||(PC={}));var kC;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",i.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(kC||(kC={}));var NC;(function(i){i.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",i.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",i.BALANCED="BALANCED",i.PRIORITIZE_COST="PRIORITIZE_COST"})(NC||(NC={}));var FC;(function(i){i.UNSPECIFIED="UNSPECIFIED",i.BLOCKING="BLOCKING",i.NON_BLOCKING="NON_BLOCKING"})(FC||(FC={}));var LC;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(LC||(LC={}));var OC;(function(i){i.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",i.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(OC||(OC={}));var UC;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.AUTO="AUTO",i.ANY="ANY",i.NONE="NONE",i.VALIDATED="VALIDATED"})(UC||(UC={}));var HC;(function(i){i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE"})(HC||(HC={}));var BC;(function(i){i.DONT_ALLOW="DONT_ALLOW",i.ALLOW_ADULT="ALLOW_ADULT",i.ALLOW_ALL="ALLOW_ALL"})(BC||(BC={}));var VC;(function(i){i.auto="auto",i.en="en",i.ja="ja",i.ko="ko",i.hi="hi",i.zh="zh",i.pt="pt",i.es="es"})(VC||(VC={}));var GC;(function(i){i.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",i.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",i.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",i.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",i.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(GC||(GC={}));var $C;(function(i){i.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",i.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",i.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",i.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})($C||($C={}));var zC;(function(i){i.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",i.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",i.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",i.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(zC||(zC={}));var qC;(function(i){i.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",i.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",i.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",i.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",i.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",i.EDIT_MODE_STYLE="EDIT_MODE_STYLE",i.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",i.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(qC||(qC={}));var WC;(function(i){i.FOREGROUND="FOREGROUND",i.BACKGROUND="BACKGROUND",i.PROMPT="PROMPT",i.SEMANTIC="SEMANTIC",i.INTERACTIVE="INTERACTIVE"})(WC||(WC={}));var YC;(function(i){i.ASSET="ASSET",i.STYLE="STYLE"})(YC||(YC={}));var KC;(function(i){i.INSERT="INSERT",i.REMOVE="REMOVE",i.REMOVE_STATIC="REMOVE_STATIC",i.OUTPAINT="OUTPAINT"})(KC||(KC={}));var XC;(function(i){i.OPTIMIZED="OPTIMIZED",i.LOSSLESS="LOSSLESS"})(XC||(XC={}));var JC;(function(i){i.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",i.PREFERENCE_TUNING="PREFERENCE_TUNING"})(JC||(JC={}));var ZC;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.STATE_PENDING="STATE_PENDING",i.STATE_ACTIVE="STATE_ACTIVE",i.STATE_FAILED="STATE_FAILED"})(ZC||(ZC={}));var QC;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.PROCESSING="PROCESSING",i.ACTIVE="ACTIVE",i.FAILED="FAILED"})(QC||(QC={}));var jC;(function(i){i.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",i.UPLOADED="UPLOADED",i.GENERATED="GENERATED"})(jC||(jC={}));var eT;(function(i){i.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.RESPONSE_REJECTED="RESPONSE_REJECTED",i.NEED_MORE_INPUT="NEED_MORE_INPUT"})(eT||(eT={}));var tT;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.VIDEO="VIDEO",i.AUDIO="AUDIO",i.DOCUMENT="DOCUMENT"})(tT||(tT={}));var nT;(function(i){i.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",i.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",i.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(nT||(nT={}));var iT;(function(i){i.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",i.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",i.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(iT||(iT={}));var sT;(function(i){i.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",i.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",i.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(sT||(sT={}));var rT;(function(i){i.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",i.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",i.NO_INTERRUPTION="NO_INTERRUPTION"})(rT||(rT={}));var oT;(function(i){i.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",i.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",i.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(oT||(oT={}));var aT;(function(i){i.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",i.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",i.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",i.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",i.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",i.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",i.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",i.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",i.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",i.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",i.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",i.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",i.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(aT||(aT={}));var lT;(function(i){i.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",i.QUALITY="QUALITY",i.DIVERSITY="DIVERSITY",i.VOCALIZATION="VOCALIZATION"})(lT||(lT={}));var ya;(function(i){i.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",i.PLAY="PLAY",i.PAUSE="PAUSE",i.STOP="STOP",i.RESET_CONTEXT="RESET_CONTEXT"})(ya||(ya={}));var Hc=class{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var br=class{get text(){var e,t,n,s,r,o,a,l;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",d=!1,h=[];for(let p of(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[m,y]of Object.entries(p))m!=="text"&&m!=="thought"&&m!=="thoughtSignature"&&(y!==null||y!==void 0)&&h.push(m);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;d=!0,c+=p.text}}return h.length>0&&console.warn(`there are non-text parts ${h} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?c:void 0}get data(){var e,t,n,s,r,o,a,l;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="",d=[];for(let h of(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[p,m]of Object.entries(h))p!=="inlineData"&&(m!==null||m!==void 0)&&d.push(p);h.inlineData&&typeof h.inlineData.data=="string"&&(c+=atob(h.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,t,n,s,r,o,a,l;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let c=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,t,n,s,r,o,a,l,c;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let d=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(h=>h.executableCode).map(h=>h.executableCode).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,t,n,s,r,o,a,l,c;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let d=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(h=>h.codeExecutionResult).map(h=>h.codeExecutionResult).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.output}},zf=class{},qf=class{},iE=class{},sE=class{},rE=class{},oE=class{},Wf=class{},Yf=class{},Kf=class{},aE=class{};var Xf=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,s,r=e;return t?s=CM(r):s=_M(r),Object.assign(n,s),n}},Jf=class{},Zf=class{},Qf=class{},jf=class{},lE=class{},cE=class{},dE=class{};var uE=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,r=PM(e);return Object.assign(n,r),n}},hE=class{},fE=class{},pE=class{};var ep=class{};var gE=class{get text(){var e,t,n;let s="",r=!1,o=[];for(let a of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[l,c]of Object.entries(a))l!=="text"&&l!=="thought"&&c!==null&&o.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;r=!0,s+=a.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?s:void 0}get data(){var e,t,n;let s="",r=[];for(let o of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[a,l]of Object.entries(o))a!=="inlineData"&&l!==null&&r.push(a);o.inlineData&&typeof o.inlineData.data=="string"&&(s+=atob(o.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}};var mE=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var yE=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,r=NT(e);return Object.assign(n,r),n}};function ce(i,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(i.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function FT(i,e){let t=ce(i,e);return t?t.startsWith("publishers/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}`:t.startsWith("models/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/publishers/google/${t}`:t:""}function LT(i){return Array.isArray(i)?i.map(e=>tp(e)):[tp(i)]}function tp(i){if(typeof i=="object"&&i!==null)return i;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof i}`)}function OT(i){let e=tp(i);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function UT(i){let e=tp(i);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function cT(i){if(i==null)throw new Error("PartUnion is required");if(typeof i=="object")return i;if(typeof i=="string")return{text:i};throw new Error(`Unsupported part type: ${typeof i}`)}function HT(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("PartListUnion is required");return Array.isArray(i)?i.map(e=>cT(e)):[cT(i)]}function vE(i){return i!=null&&typeof i=="object"&&"parts"in i&&Array.isArray(i.parts)}function dT(i){return i!=null&&typeof i=="object"&&"functionCall"in i}function uT(i){return i!=null&&typeof i=="object"&&"functionResponse"in i}function ot(i){if(i==null)throw new Error("ContentUnion is required");return vE(i)?i:{role:"user",parts:HT(i)}}function eb(i,e){if(!e)return[];if(i.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let n=ot(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(i.isVertexAI()){let t=ot(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>ot(t)):[ot(e)]}function on(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("contents are required");if(!Array.isArray(i)){if(dT(i)||uT(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[ot(i)]}let e=[],t=[],n=vE(i[0]);for(let s of i){let r=vE(s);if(r!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(s);else{if(dT(s)||uT(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(s)}}return n||e.push({role:"user",parts:HT(t)}),e}function OM(i,e){i.includes("null")&&(e.nullable=!0);let t=i.filter(n=>n!=="null");if(t.length===1)e.type=Object.values(ms).includes(t[0].toUpperCase())?t[0].toUpperCase():ms.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let n of t)e.anyOf.push({type:Object.values(ms).includes(n.toUpperCase())?n.toUpperCase():ms.TYPE_UNSPECIFIED})}}function va(i){let e={},t=["items"],n=["anyOf"],s=["properties"];if(i.type&&i.anyOf)throw new Error("type and anyOf cannot be both populated.");let r=i.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,i=r[1]):r[1].type==="null"&&(e.nullable=!0,i=r[0])),i.type instanceof Array&&OM(i.type,e);for(let[o,a]of Object.entries(i))if(a!=null)if(o=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(ms).includes(a.toUpperCase())?a.toUpperCase():ms.TYPE_UNSPECIFIED}else if(t.includes(o))e[o]=va(a);else if(n.includes(o)){let l=[];for(let c of a){if(c.type=="null"){e.nullable=!0;continue}l.push(va(c))}e[o]=l}else if(s.includes(o)){let l={};for(let[c,d]of Object.entries(a))l[c]=va(d);e[o]=l}else{if(o==="additionalProperties")continue;e[o]=a}return e}function tb(i){return va(i)}function nb(i){if(typeof i=="object")return i;if(typeof i=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:i}}};throw new Error(`Unsupported speechConfig type: ${typeof i}`)}function ib(i){if("multiSpeakerVoiceConfig"in i)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return i}function wa(i){if(i.functionDeclarations)for(let e of i.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=va(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=va(e.response));return i}function Sa(i){if(i==null)throw new Error("tools is required");if(!Array.isArray(i))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of i)e.push(t);return e}function UM(i,e,t,n=1){let s=!e.startsWith(`${t}/`)&&e.split("/").length===n;return i.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${i.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}`:s?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}/${e}`:e:s?`${t}/${e}`:e}function Ri(i,e){if(typeof e!="string")throw new Error("name must be a string");return UM(i,e,"cachedContents")}function BT(i){switch(i){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return i}}function ys(i){return jE(i)}function HM(i){return i!=null&&typeof i=="object"&&"name"in i}function BM(i){return i!=null&&typeof i=="object"&&"video"in i}function VM(i){return i!=null&&typeof i=="object"&&"uri"in i}function VT(i){var e;let t;if(HM(i)&&(t=i.name),!(VM(i)&&(t=i.uri,t===void 0))&&!(BM(i)&&(t=(e=i.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof i=="string"&&(t=i),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let s=t.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${t}`);t=s[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function GT(i,e){let t;return i.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function $T(i){for(let e of["models","tunedModels","publisherModels"])if(GM(i,e))return i[e];return[]}function GM(i,e){return i!==null&&typeof i=="object"&&e in i}function $M(i,e={}){let t=i,n={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(n.responseJsonSchema=t.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function zM(i,e={}){let t=[],n=new Set;for(let s of i){let r=s.name;if(n.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);n.add(r);let o=$M(s,e);o.functionDeclarations&&t.push(...o.functionDeclarations)}return{functionDeclarations:t}}function zT(i,e){let t;if(typeof e=="string")if(i.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(i.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let n=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,s=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(i.isVertexAI()){if(s>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||s!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function qM(i){if(typeof i!="string")return i;let e=i;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function qT(i){if(typeof i!="object"||i===null)return{};let e=i,t=e.inlinedResponses;if(typeof t!="object"||t===null)return i;let s=t.inlinedResponses;if(!Array.isArray(s)||s.length===0)return i;let r=!1;for(let o of s){if(typeof o!="object"||o===null)continue;let l=o.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),i}function _a(i,e){let t=e;if(!i.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function WT(i){let e=i;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function WM(i){let e={},t=f(i,["responsesFile"]);t!=null&&g(e,["fileName"],t);let n=f(i,["inlinedResponses","inlinedResponses"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>TP(o))),g(e,["inlinedResponses"],r)}let s=f(i,["inlinedEmbedContentResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["inlinedEmbedContentResponses"],r)}return e}function YM(i){let e={},t=f(i,["predictionsFormat"]);t!=null&&g(e,["format"],t);let n=f(i,["gcsDestination","outputUriPrefix"]);n!=null&&g(e,["gcsUri"],n);let s=f(i,["bigqueryDestination","outputUri"]);return s!=null&&g(e,["bigqueryUri"],s),e}function KM(i){let e={},t=f(i,["format"]);t!=null&&g(e,["predictionsFormat"],t);let n=f(i,["gcsUri"]);n!=null&&g(e,["gcsDestination","outputUriPrefix"],n);let s=f(i,["bigqueryUri"]);if(s!=null&&g(e,["bigqueryDestination","outputUri"],s),f(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(i,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(f(i,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Vf(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata","displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["metadata","state"]);s!=null&&g(e,["state"],WT(s));let r=f(i,["metadata","createTime"]);r!=null&&g(e,["createTime"],r);let o=f(i,["metadata","endTime"]);o!=null&&g(e,["endTime"],o);let a=f(i,["metadata","updateTime"]);a!=null&&g(e,["updateTime"],a);let l=f(i,["metadata","model"]);l!=null&&g(e,["model"],l);let c=f(i,["metadata","output"]);return c!=null&&g(e,["dest"],WM(qT(c))),e}function EE(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["state"]);s!=null&&g(e,["state"],WT(s));let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["createTime"]);o!=null&&g(e,["createTime"],o);let a=f(i,["startTime"]);a!=null&&g(e,["startTime"],a);let l=f(i,["endTime"]);l!=null&&g(e,["endTime"],l);let c=f(i,["updateTime"]);c!=null&&g(e,["updateTime"],c);let d=f(i,["model"]);d!=null&&g(e,["model"],d);let h=f(i,["inputConfig"]);h!=null&&g(e,["src"],XM(h));let p=f(i,["outputConfig"]);p!=null&&g(e,["dest"],YM(qT(p)));let m=f(i,["completionStats"]);return m!=null&&g(e,["completionStats"],m),e}function XM(i){let e={},t=f(i,["instancesFormat"]);t!=null&&g(e,["format"],t);let n=f(i,["gcsSource","uris"]);n!=null&&g(e,["gcsUri"],n);let s=f(i,["bigquerySource","inputUri"]);return s!=null&&g(e,["bigqueryUri"],s),e}function JM(i,e){let t={};if(f(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(f(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let n=f(e,["fileName"]);n!=null&&g(t,["fileName"],n);let s=f(e,["inlinedRequests"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>CP(i,o))),g(t,["requests","requests"],r)}return t}function ZM(i){let e={},t=f(i,["format"]);t!=null&&g(e,["instancesFormat"],t);let n=f(i,["gcsUri"]);n!=null&&g(e,["gcsSource","uris"],n);let s=f(i,["bigqueryUri"]);if(s!=null&&g(e,["bigquerySource","inputUri"],s),f(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(i,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function QM(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function jM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],_a(i,n)),t}function eP(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],_a(i,n)),t}function tP(i){let e={},t=f(i,["content"]);t!=null&&g(e,["content"],t);let n=f(i,["citationMetadata"]);n!=null&&g(e,["citationMetadata"],nP(n));let s=f(i,["tokenCount"]);s!=null&&g(e,["tokenCount"],s);let r=f(i,["finishReason"]);r!=null&&g(e,["finishReason"],r);let o=f(i,["avgLogprobs"]);o!=null&&g(e,["avgLogprobs"],o);let a=f(i,["groundingMetadata"]);a!=null&&g(e,["groundingMetadata"],a);let l=f(i,["index"]);l!=null&&g(e,["index"],l);let c=f(i,["logprobsResult"]);c!=null&&g(e,["logprobsResult"],c);let d=f(i,["safetyRatings"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>m)),g(e,["safetyRatings"],p)}let h=f(i,["urlContextMetadata"]);return h!=null&&g(e,["urlContextMetadata"],h),e}function nP(i){let e={},t=f(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),g(e,["citations"],n)}return e}function YT(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>kP(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function iP(i,e){let t={},n=f(i,["displayName"]);if(e!==void 0&&n!=null&&g(e,["batch","displayName"],n),f(i,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function sP(i,e){let t={},n=f(i,["displayName"]);e!==void 0&&n!=null&&g(e,["displayName"],n);let s=f(i,["dest"]);return e!==void 0&&s!=null&&g(e,["outputConfig"],KM(qM(s))),t}function hT(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["src"]);s!=null&&g(t,["batch","inputConfig"],JM(i,zT(i,s)));let r=f(e,["config"]);return r!=null&&iP(r,t),t}function rP(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["model"],ce(i,n));let s=f(e,["src"]);s!=null&&g(t,["inputConfig"],ZM(zT(i,s)));let r=f(e,["config"]);return r!=null&&sP(r,t),t}function oP(i,e){let t={},n=f(i,["displayName"]);return e!==void 0&&n!=null&&g(e,["batch","displayName"],n),t}function aP(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["src"]);s!=null&&g(t,["batch","inputConfig"],pP(i,s));let r=f(e,["config"]);return r!=null&&oP(r,t),t}function lP(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],_a(i,n)),t}function cP(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],_a(i,n)),t}function dP(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);return r!=null&&g(e,["error"],r),e}function uP(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);return r!=null&&g(e,["error"],r),e}function hP(i,e){let t={},n=f(e,["contents"]);if(n!=null){let r=eb(i,n);Array.isArray(r)&&(r=r.map(o=>o)),g(t,["requests[]","request","content"],r)}let s=f(e,["config"]);return s!=null&&(g(t,["_self"],fP(s,t)),wM(t,{"requests[].*":"requests[].request.*"})),t}function fP(i,e){let t={},n=f(i,["taskType"]);e!==void 0&&n!=null&&g(e,["requests[]","taskType"],n);let s=f(i,["title"]);e!==void 0&&s!=null&&g(e,["requests[]","title"],s);let r=f(i,["outputDimensionality"]);if(e!==void 0&&r!=null&&g(e,["requests[]","outputDimensionality"],r),f(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function pP(i,e){let t={},n=f(e,["fileName"]);n!=null&&g(t,["file_name"],n);let s=f(e,["inlinedRequests"]);return s!=null&&g(t,["requests"],hP(i,s)),t}function gP(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function mP(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function yP(i){let e={},t=f(i,["mode"]);t!=null&&g(e,["mode"],t);let n=f(i,["allowedFunctionNames"]);if(n!=null&&g(e,["allowedFunctionNames"],n),f(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function vP(i,e,t){let n={},s=f(e,["systemInstruction"]);t!==void 0&&s!=null&&g(t,["systemInstruction"],YT(ot(s)));let r=f(e,["temperature"]);r!=null&&g(n,["temperature"],r);let o=f(e,["topP"]);o!=null&&g(n,["topP"],o);let a=f(e,["topK"]);a!=null&&g(n,["topK"],a);let l=f(e,["candidateCount"]);l!=null&&g(n,["candidateCount"],l);let c=f(e,["maxOutputTokens"]);c!=null&&g(n,["maxOutputTokens"],c);let d=f(e,["stopSequences"]);d!=null&&g(n,["stopSequences"],d);let h=f(e,["responseLogprobs"]);h!=null&&g(n,["responseLogprobs"],h);let p=f(e,["logprobs"]);p!=null&&g(n,["logprobs"],p);let m=f(e,["presencePenalty"]);m!=null&&g(n,["presencePenalty"],m);let y=f(e,["frequencyPenalty"]);y!=null&&g(n,["frequencyPenalty"],y);let v=f(e,["seed"]);v!=null&&g(n,["seed"],v);let b=f(e,["responseMimeType"]);b!=null&&g(n,["responseMimeType"],b);let w=f(e,["responseSchema"]);w!=null&&g(n,["responseSchema"],tb(w));let _=f(e,["responseJsonSchema"]);if(_!=null&&g(n,["responseJsonSchema"],_),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let C=f(e,["safetySettings"]);if(t!==void 0&&C!=null){let X=C;Array.isArray(X)&&(X=X.map(J=>NP(J))),g(t,["safetySettings"],X)}let T=f(e,["tools"]);if(t!==void 0&&T!=null){let X=Sa(T);Array.isArray(X)&&(X=X.map(J=>LP(wa(J)))),g(t,["tools"],X)}let R=f(e,["toolConfig"]);if(t!==void 0&&R!=null&&g(t,["toolConfig"],FP(R)),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let D=f(e,["cachedContent"]);t!==void 0&&D!=null&&g(t,["cachedContent"],Ri(i,D));let I=f(e,["responseModalities"]);I!=null&&g(n,["responseModalities"],I);let k=f(e,["mediaResolution"]);k!=null&&g(n,["mediaResolution"],k);let N=f(e,["speechConfig"]);if(N!=null&&g(n,["speechConfig"],nb(N)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=f(e,["thinkingConfig"]);F!=null&&g(n,["thinkingConfig"],F);let U=f(e,["imageConfig"]);U!=null&&g(n,["imageConfig"],_P(U));let re=f(e,["enableEnhancedCivicAnswers"]);return re!=null&&g(n,["enableEnhancedCivicAnswers"],re),n}function EP(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>tP(c))),g(e,["candidates"],l)}let s=f(i,["modelVersion"]);s!=null&&g(e,["modelVersion"],s);let r=f(i,["promptFeedback"]);r!=null&&g(e,["promptFeedback"],r);let o=f(i,["responseId"]);o!=null&&g(e,["responseId"],o);let a=f(i,["usageMetadata"]);return a!=null&&g(e,["usageMetadata"],a),e}function bP(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],_a(i,n)),t}function AP(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],_a(i,n)),t}function wP(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function SP(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function _P(i){let e={},t=f(i,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);let n=f(i,["imageSize"]);if(n!=null&&g(e,["imageSize"],n),f(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function CP(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["request","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let a=on(s);Array.isArray(a)&&(a=a.map(l=>YT(l))),g(t,["request","contents"],a)}let r=f(e,["metadata"]);r!=null&&g(t,["metadata"],r);let o=f(e,["config"]);return o!=null&&g(t,["request","generationConfig"],vP(i,o,f(t,["request"],{}))),t}function TP(i){let e={},t=f(i,["response"]);t!=null&&g(e,["response"],EP(t));let n=f(i,["error"]);return n!=null&&g(e,["error"],n),e}function xP(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);if(e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),f(i,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function RP(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);e!==void 0&&s!=null&&g(e,["_query","pageToken"],s);let r=f(i,["filter"]);return e!==void 0&&r!=null&&g(e,["_query","filter"],r),t}function IP(i){let e={},t=f(i,["config"]);return t!=null&&xP(t,e),e}function DP(i){let e={},t=f(i,["config"]);return t!=null&&RP(t,e),e}function MP(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["operations"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>Vf(o))),g(e,["batchJobs"],r)}return e}function PP(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["batchPredictionJobs"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>EE(o))),g(e,["batchJobs"],r)}return e}function kP(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],gP(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],mP(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],QM(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function NP(i){let e={},t=f(i,["category"]);if(t!=null&&g(e,["category"],t),f(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=f(i,["threshold"]);return n!=null&&g(e,["threshold"],n),e}function FP(i){let e={},t=f(i,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],yP(t));let n=f(i,["retrievalConfig"]);return n!=null&&g(e,["retrievalConfig"],n),e}function LP(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],wP(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],SP(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}var Ti;(function(i){i.PAGED_ITEM_BATCH_JOBS="batchJobs",i.PAGED_ITEM_MODELS="models",i.PAGED_ITEM_TUNING_JOBS="tuningJobs",i.PAGED_ITEM_FILES="files",i.PAGED_ITEM_CACHED_CONTENTS="cachedContents",i.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",i.PAGED_ITEM_DOCUMENTS="documents"})(Ti||(Ti={}));var xi=class{constructor(e,t,n,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,s)}init(e,t,n){var s,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};!n||Object.keys(n).length===0?o={config:{}}:typeof n=="object"?o=Object.assign({},n):o=n,o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(r=(s=o.config)===null||s===void 0?void 0:s.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var bE=class extends Sn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new xi(Ti.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){let t=hT(this.apiClient,e),n=t._url,s=O("{model}:batchGenerateContent",n),a=t.batch.inputConfig.requests,l=a.requests,c=[];for(let d of l){let h=Object.assign({},d);if(h.systemInstruction){let p=h.systemInstruction;delete h.systemInstruction;let m=h.request;m.systemInstruction=p,h.request=m}c.push(h)}return a.requests=c,delete t.config,delete t._url,delete t._query,{path:s,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},s=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${s}`),n.dest===void 0){let r=this.getGcsUri(e),o=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?n.dest=`${r.slice(0,-6)}/dest`:n.dest=`${r}_dest_${s}`;else if(o)n.dest=`${o}_dest_${s}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=rP(this.apiClient,e);return a=O("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>EE(d))}else{let c=hT(this.apiClient,e);return a=O("{model}:batchGenerateContent",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>Vf(d))}}async createEmbeddingsInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=aP(this.apiClient,e);return r=O("{model}:asyncBatchEmbedContent",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>Vf(l))}}async get(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=AP(this.apiClient,e);return a=O("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>EE(d))}else{let c=bP(this.apiClient,e);return a=O("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>Vf(d))}}async cancel(e){var t,n,s,r;let o="",a={};if(this.apiClient.isVertexAI()){let l=eP(this.apiClient,e);o=O("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{let l=jM(this.apiClient,e);o=O("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=DP(e);return a=O("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=PP(d),p=new ep;return Object.assign(p,h),p})}else{let c=IP(e);return a=O("batches",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=MP(d),p=new ep;return Object.assign(p,h),p})}}async delete(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=cP(this.apiClient,e);return a=O("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>uP(d))}else{let c=lP(this.apiClient,e);return a=O("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>dP(d))}}};function OP(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function fT(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>ok(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function UP(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);e!==void 0&&s!=null&&g(e,["expireTime"],s);let r=f(i,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);let o=f(i,["contents"]);if(e!==void 0&&o!=null){let d=on(o);Array.isArray(d)&&(d=d.map(h=>fT(h))),g(e,["contents"],d)}let a=f(i,["systemInstruction"]);e!==void 0&&a!=null&&g(e,["systemInstruction"],fT(ot(a)));let l=f(i,["tools"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(h=>lk(h))),g(e,["tools"],d)}let c=f(i,["toolConfig"]);if(e!==void 0&&c!=null&&g(e,["toolConfig"],ak(c)),f(i,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function HP(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);e!==void 0&&s!=null&&g(e,["expireTime"],s);let r=f(i,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);let o=f(i,["contents"]);if(e!==void 0&&o!=null){let h=on(o);Array.isArray(h)&&(h=h.map(p=>p)),g(e,["contents"],h)}let a=f(i,["systemInstruction"]);e!==void 0&&a!=null&&g(e,["systemInstruction"],ot(a));let l=f(i,["tools"]);if(e!==void 0&&l!=null){let h=l;Array.isArray(h)&&(h=h.map(p=>ck(p))),g(e,["tools"],h)}let c=f(i,["toolConfig"]);e!==void 0&&c!=null&&g(e,["toolConfig"],c);let d=f(i,["kmsKeyName"]);return e!==void 0&&d!=null&&g(e,["encryption_spec","kmsKeyName"],d),t}function BP(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["model"],FT(i,n));let s=f(e,["config"]);return s!=null&&UP(s,t),t}function VP(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["model"],FT(i,n));let s=f(e,["config"]);return s!=null&&HP(s,t),t}function GP(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ri(i,n)),t}function $P(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ri(i,n)),t}function zP(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function qP(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function WP(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function YP(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function KP(i){let e={},t=f(i,["mode"]);t!=null&&g(e,["mode"],t);let n=f(i,["allowedFunctionNames"]);if(n!=null&&g(e,["allowedFunctionNames"],n),f(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function XP(i){let e={};if(f(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=f(i,["description"]);t!=null&&g(e,["description"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["parameters"]);s!=null&&g(e,["parameters"],s);let r=f(i,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);let o=f(i,["response"]);o!=null&&g(e,["response"],o);let a=f(i,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function JP(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ri(i,n)),t}function ZP(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ri(i,n)),t}function QP(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function jP(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function ek(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function tk(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function nk(i){let e={},t=f(i,["config"]);return t!=null&&ek(t,e),e}function ik(i){let e={},t=f(i,["config"]);return t!=null&&tk(t,e),e}function sk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["cachedContents"],r)}return e}function rk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["cachedContents"],r)}return e}function ok(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],WP(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],YP(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],OP(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function ak(i){let e={},t=f(i,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],KP(t));let n=f(i,["retrievalConfig"]);return n!=null&&g(e,["retrievalConfig"],n),e}function lk(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],QP(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],jP(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function ck(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(p=>XP(p))),g(e,["functionDeclarations"],h)}let n=f(i,["retrieval"]);n!=null&&g(e,["retrieval"],n);let s=f(i,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);let r=f(i,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=f(i,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);let a=f(i,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);let l=f(i,["googleMaps"]);l!=null&&g(e,["googleMaps"],l);let c=f(i,["googleSearch"]);c!=null&&g(e,["googleSearch"],c);let d=f(i,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function dk(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);return e!==void 0&&s!=null&&g(e,["expireTime"],s),t}function uk(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);return e!==void 0&&s!=null&&g(e,["expireTime"],s),t}function hk(i,e){let t={},n=f(e,["name"]);n!=null&&g(t,["_url","name"],Ri(i,n));let s=f(e,["config"]);return s!=null&&dk(s,t),t}function fk(i,e){let t={},n=f(e,["name"]);n!=null&&g(t,["_url","name"],Ri(i,n));let s=f(e,["config"]);return s!=null&&uk(s,t),t}var AE=class extends Sn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new xi(Ti.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=VP(this.apiClient,e);return a=O("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let c=BP(this.apiClient,e);return a=O("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async get(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=ZP(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let c=JP(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async delete(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=$P(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=qP(d),p=new Qf;return Object.assign(p,h),p})}else{let c=GP(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=zP(d),p=new Qf;return Object.assign(p,h),p})}}async update(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=fk(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let c=hk(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=ik(e);return a=O("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=rk(d),p=new jf;return Object.assign(p,h),p})}else{let c=nk(e);return a=O("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=sk(d),p=new jf;return Object.assign(p,h),p})}}};function np(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t}function pT(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function K(i){return this instanceof K?(this.v=i,this):new K(i)}function An(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),s,r=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(m){return function(y){return Promise.resolve(y).then(m,h)}}function a(m,y){n[m]&&(s[m]=function(v){return new Promise(function(b,w){r.push([m,v,b,w])>1||l(m,v)})},y&&(s[m]=y(s[m])))}function l(m,y){try{c(n[m](y))}catch(v){p(r[0][3],v)}}function c(m){m.value instanceof K?Promise.resolve(m.value.v).then(d,h):p(r[0][2],m)}function d(m){l("next",m)}function h(m){l("throw",m)}function p(m,y){m(y),r.shift(),r.length&&l(r[0][0],r[0][1])}}function wn(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof pT=="function"?pT(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=i[r]&&function(o){return new Promise(function(a,l){o=i[r](o),s(a,l,o.done,o.value)})}}function s(r,o,a,l){Promise.resolve(l).then(function(c){r({value:c,done:a})},o)}}function pk(i){var e;if(i.candidates==null||i.candidates.length===0)return!1;let t=(e=i.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:KT(t)}function KT(i){if(i.parts===void 0||i.parts.length===0)return!1;for(let e of i.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function gk(i){if(i.length!==0){for(let e of i)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function gT(i){if(i===void 0||i.length===0)return[];let e=[],t=i.length,n=0;for(;n<t;)if(i[n].role==="user")e.push(i[n]),n++;else{let s=[],r=!0;for(;n<t&&i[n].role==="model";)s.push(i[n]),r&&!KT(i[n])&&(r=!1),n++;r?e.push(...s):e.pop()}return e}var wE=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new SE(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},SE=class{constructor(e,t,n,s={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=s,this.history=r,this.sendPromise=Promise.resolve(),gk(r)}async sendMessage(e){var t;await this.sendPromise;let n=ot(e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,o,a;let l=await s,c=(o=(r=l.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content,d=l.automaticFunctionCallingHistory,h=this.getHistory(!0).length,p=[];d!=null&&(p=(a=d.slice(h))!==null&&a!==void 0?a:[]);let m=c?[c]:[];this.recordHistory(n,m,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(e){var t;await this.sendPromise;let n=ot(e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});let r=await s;return this.processStreamResponse(r,n)}getHistory(e=!1){let t=e?gT(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return An(this,arguments,function*(){var s,r,o,a,l,c;let d=[];try{for(var h=!0,p=wn(e),m;m=yield K(p.next()),s=m.done,!s;h=!0){a=m.value,h=!1;let y=a;if(pk(y)){let v=(c=(l=y.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content;v!==void 0&&d.push(v)}yield yield K(y)}}catch(y){r={error:y}}finally{try{!h&&!s&&(o=p.return)&&(yield K(o.call(p)))}finally{if(r)throw r.error}}this.recordHistory(t,d)})}recordHistory(e,t,n){let s=[];t.length>0&&t.every(r=>r.role!==void 0)?s=t:s.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...gT(n)):this.history.push(e),this.history.push(...s)}};var ip=class i extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,i.prototype)}};function mk(i){let e={},t=f(i,["file"]);return t!=null&&g(e,["file"],t),e}function yk(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function vk(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","file"],VT(t)),e}function Ek(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function bk(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","file"],VT(t)),e}function Ak(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function wk(i){let e={},t=f(i,["config"]);return t!=null&&Ak(t,e),e}function Sk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["files"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["files"],r)}return e}var _E=class extends Sn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new xi(Ti.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=wk(e);return r=O("files",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=Sk(l),d=new hE;return Object.assign(d,c),d})}}async createInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=mk(e);return r=O("upload/v1beta/files",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=yk(l),d=new fE;return Object.assign(d,c),d})}}async get(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=bk(e);return r=O("files/{file}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=vk(e);return r=O("files/{file}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=Ek(l),d=new pE;return Object.assign(d,c),d})}}};function Gf(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function _k(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>Bk(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function Ck(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function Tk(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function xk(i){let e={};if(f(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=f(i,["description"]);t!=null&&g(e,["description"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["parameters"]);s!=null&&g(e,["parameters"],s);let r=f(i,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);let o=f(i,["response"]);o!=null&&g(e,["response"],o);let a=f(i,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function Rk(i){let e={},t=f(i,["modelSelectionConfig"]);t!=null&&g(e,["modelConfig"],t);let n=f(i,["responseJsonSchema"]);n!=null&&g(e,["responseJsonSchema"],n);let s=f(i,["audioTimestamp"]);s!=null&&g(e,["audioTimestamp"],s);let r=f(i,["candidateCount"]);r!=null&&g(e,["candidateCount"],r);let o=f(i,["enableAffectiveDialog"]);o!=null&&g(e,["enableAffectiveDialog"],o);let a=f(i,["frequencyPenalty"]);a!=null&&g(e,["frequencyPenalty"],a);let l=f(i,["logprobs"]);l!=null&&g(e,["logprobs"],l);let c=f(i,["maxOutputTokens"]);c!=null&&g(e,["maxOutputTokens"],c);let d=f(i,["mediaResolution"]);d!=null&&g(e,["mediaResolution"],d);let h=f(i,["presencePenalty"]);h!=null&&g(e,["presencePenalty"],h);let p=f(i,["responseLogprobs"]);p!=null&&g(e,["responseLogprobs"],p);let m=f(i,["responseMimeType"]);m!=null&&g(e,["responseMimeType"],m);let y=f(i,["responseModalities"]);y!=null&&g(e,["responseModalities"],y);let v=f(i,["responseSchema"]);v!=null&&g(e,["responseSchema"],v);let b=f(i,["routingConfig"]);b!=null&&g(e,["routingConfig"],b);let w=f(i,["seed"]);w!=null&&g(e,["seed"],w);let _=f(i,["speechConfig"]);_!=null&&g(e,["speechConfig"],_);let C=f(i,["stopSequences"]);C!=null&&g(e,["stopSequences"],C);let T=f(i,["temperature"]);T!=null&&g(e,["temperature"],T);let R=f(i,["thinkingConfig"]);R!=null&&g(e,["thinkingConfig"],R);let D=f(i,["topK"]);D!=null&&g(e,["topK"],D);let I=f(i,["topP"]);if(I!=null&&g(e,["topP"],I),f(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Ik(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function Dk(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function Mk(i,e){let t={},n=f(i,["generationConfig"]);e!==void 0&&n!=null&&g(e,["setup","generationConfig"],n);let s=f(i,["responseModalities"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig","responseModalities"],s);let r=f(i,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);let o=f(i,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);let a=f(i,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);let l=f(i,["maxOutputTokens"]);e!==void 0&&l!=null&&g(e,["setup","generationConfig","maxOutputTokens"],l);let c=f(i,["mediaResolution"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","mediaResolution"],c);let d=f(i,["seed"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","seed"],d);let h=f(i,["speechConfig"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","speechConfig"],ib(h));let p=f(i,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);let m=f(i,["enableAffectiveDialog"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=f(i,["systemInstruction"]);e!==void 0&&y!=null&&g(e,["setup","systemInstruction"],_k(ot(y)));let v=f(i,["tools"]);if(e!==void 0&&v!=null){let D=Sa(v);Array.isArray(D)&&(D=D.map(I=>Gk(wa(I)))),g(e,["setup","tools"],D)}let b=f(i,["sessionResumption"]);e!==void 0&&b!=null&&g(e,["setup","sessionResumption"],Vk(b));let w=f(i,["inputAudioTranscription"]);e!==void 0&&w!=null&&g(e,["setup","inputAudioTranscription"],w);let _=f(i,["outputAudioTranscription"]);e!==void 0&&_!=null&&g(e,["setup","outputAudioTranscription"],_);let C=f(i,["realtimeInputConfig"]);e!==void 0&&C!=null&&g(e,["setup","realtimeInputConfig"],C);let T=f(i,["contextWindowCompression"]);e!==void 0&&T!=null&&g(e,["setup","contextWindowCompression"],T);let R=f(i,["proactivity"]);if(e!==void 0&&R!=null&&g(e,["setup","proactivity"],R),f(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function Pk(i,e){let t={},n=f(i,["generationConfig"]);e!==void 0&&n!=null&&g(e,["setup","generationConfig"],Rk(n));let s=f(i,["responseModalities"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig","responseModalities"],s);let r=f(i,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);let o=f(i,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);let a=f(i,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);let l=f(i,["maxOutputTokens"]);e!==void 0&&l!=null&&g(e,["setup","generationConfig","maxOutputTokens"],l);let c=f(i,["mediaResolution"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","mediaResolution"],c);let d=f(i,["seed"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","seed"],d);let h=f(i,["speechConfig"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","speechConfig"],ib(h));let p=f(i,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);let m=f(i,["enableAffectiveDialog"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=f(i,["systemInstruction"]);e!==void 0&&y!=null&&g(e,["setup","systemInstruction"],ot(y));let v=f(i,["tools"]);if(e!==void 0&&v!=null){let I=Sa(v);Array.isArray(I)&&(I=I.map(k=>$k(wa(k)))),g(e,["setup","tools"],I)}let b=f(i,["sessionResumption"]);e!==void 0&&b!=null&&g(e,["setup","sessionResumption"],b);let w=f(i,["inputAudioTranscription"]);e!==void 0&&w!=null&&g(e,["setup","inputAudioTranscription"],w);let _=f(i,["outputAudioTranscription"]);e!==void 0&&_!=null&&g(e,["setup","outputAudioTranscription"],_);let C=f(i,["realtimeInputConfig"]);e!==void 0&&C!=null&&g(e,["setup","realtimeInputConfig"],C);let T=f(i,["contextWindowCompression"]);e!==void 0&&T!=null&&g(e,["setup","contextWindowCompression"],T);let R=f(i,["proactivity"]);e!==void 0&&R!=null&&g(e,["setup","proactivity"],R);let D=f(i,["explicitVadSignal"]);return e!==void 0&&D!=null&&g(e,["setup","explicitVadSignal"],D),t}function kk(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["setup","model"],ce(i,n));let s=f(e,["config"]);return s!=null&&g(t,["config"],Mk(s,t)),t}function Nk(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["setup","model"],ce(i,n));let s=f(e,["config"]);return s!=null&&g(t,["config"],Pk(s,t)),t}function Fk(i){let e={},t=f(i,["musicGenerationConfig"]);return t!=null&&g(e,["musicGenerationConfig"],t),e}function Lk(i){let e={},t=f(i,["weightedPrompts"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),g(e,["weightedPrompts"],n)}return e}function Ok(i){let e={},t=f(i,["media"]);if(t!=null){let c=LT(t);Array.isArray(c)&&(c=c.map(d=>Gf(d))),g(e,["mediaChunks"],c)}let n=f(i,["audio"]);n!=null&&g(e,["audio"],Gf(UT(n)));let s=f(i,["audioStreamEnd"]);s!=null&&g(e,["audioStreamEnd"],s);let r=f(i,["video"]);r!=null&&g(e,["video"],Gf(OT(r)));let o=f(i,["text"]);o!=null&&g(e,["text"],o);let a=f(i,["activityStart"]);a!=null&&g(e,["activityStart"],a);let l=f(i,["activityEnd"]);return l!=null&&g(e,["activityEnd"],l),e}function Uk(i){let e={},t=f(i,["media"]);if(t!=null){let c=LT(t);Array.isArray(c)&&(c=c.map(d=>d)),g(e,["mediaChunks"],c)}let n=f(i,["audio"]);n!=null&&g(e,["audio"],UT(n));let s=f(i,["audioStreamEnd"]);s!=null&&g(e,["audioStreamEnd"],s);let r=f(i,["video"]);r!=null&&g(e,["video"],OT(r));let o=f(i,["text"]);o!=null&&g(e,["text"],o);let a=f(i,["activityStart"]);a!=null&&g(e,["activityStart"],a);let l=f(i,["activityEnd"]);return l!=null&&g(e,["activityEnd"],l),e}function Hk(i){let e={},t=f(i,["setupComplete"]);t!=null&&g(e,["setupComplete"],t);let n=f(i,["serverContent"]);n!=null&&g(e,["serverContent"],n);let s=f(i,["toolCall"]);s!=null&&g(e,["toolCall"],s);let r=f(i,["toolCallCancellation"]);r!=null&&g(e,["toolCallCancellation"],r);let o=f(i,["usageMetadata"]);o!=null&&g(e,["usageMetadata"],zk(o));let a=f(i,["goAway"]);a!=null&&g(e,["goAway"],a);let l=f(i,["sessionResumptionUpdate"]);l!=null&&g(e,["sessionResumptionUpdate"],l);let c=f(i,["voiceActivityDetectionSignal"]);return c!=null&&g(e,["voiceActivityDetectionSignal"],c),e}function Bk(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],Ck(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],Tk(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],Gf(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function Vk(i){let e={},t=f(i,["handle"]);if(t!=null&&g(e,["handle"],t),f(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Gk(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],Ik(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],Dk(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function $k(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(p=>xk(p))),g(e,["functionDeclarations"],h)}let n=f(i,["retrieval"]);n!=null&&g(e,["retrieval"],n);let s=f(i,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);let r=f(i,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=f(i,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);let a=f(i,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);let l=f(i,["googleMaps"]);l!=null&&g(e,["googleMaps"],l);let c=f(i,["googleSearch"]);c!=null&&g(e,["googleSearch"],c);let d=f(i,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function zk(i){let e={},t=f(i,["promptTokenCount"]);t!=null&&g(e,["promptTokenCount"],t);let n=f(i,["cachedContentTokenCount"]);n!=null&&g(e,["cachedContentTokenCount"],n);let s=f(i,["candidatesTokenCount"]);s!=null&&g(e,["responseTokenCount"],s);let r=f(i,["toolUsePromptTokenCount"]);r!=null&&g(e,["toolUsePromptTokenCount"],r);let o=f(i,["thoughtsTokenCount"]);o!=null&&g(e,["thoughtsTokenCount"],o);let a=f(i,["totalTokenCount"]);a!=null&&g(e,["totalTokenCount"],a);let l=f(i,["promptTokensDetails"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["promptTokensDetails"],m)}let c=f(i,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["cacheTokensDetails"],m)}let d=f(i,["candidatesTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["responseTokensDetails"],m)}let h=f(i,["toolUsePromptTokensDetails"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["toolUsePromptTokensDetails"],m)}let p=f(i,["trafficType"]);return p!=null&&g(e,["trafficType"],p),e}function qk(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function Wk(i){let e={},t=f(i,["content"]);t!=null&&g(e,["content"],t);let n=f(i,["citationMetadata"]);n!=null&&g(e,["citationMetadata"],Yk(n));let s=f(i,["tokenCount"]);s!=null&&g(e,["tokenCount"],s);let r=f(i,["finishReason"]);r!=null&&g(e,["finishReason"],r);let o=f(i,["avgLogprobs"]);o!=null&&g(e,["avgLogprobs"],o);let a=f(i,["groundingMetadata"]);a!=null&&g(e,["groundingMetadata"],a);let l=f(i,["index"]);l!=null&&g(e,["index"],l);let c=f(i,["logprobsResult"]);c!=null&&g(e,["logprobsResult"],c);let d=f(i,["safetyRatings"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>m)),g(e,["safetyRatings"],p)}let h=f(i,["urlContextMetadata"]);return h!=null&&g(e,["urlContextMetadata"],h),e}function Yk(i){let e={},t=f(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),g(e,["citations"],n)}return e}function Kk(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let r=on(s);Array.isArray(r)&&(r=r.map(o=>o)),g(t,["contents"],r)}return t}function Xk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["tokensInfo"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),g(e,["tokensInfo"],s)}return e}function Jk(i){let e={},t=f(i,["values"]);t!=null&&g(e,["values"],t);let n=f(i,["statistics"]);return n!=null&&g(e,["statistics"],Zk(n)),e}function Zk(i){let e={},t=f(i,["truncated"]);t!=null&&g(e,["truncated"],t);let n=f(i,["token_count"]);return n!=null&&g(e,["tokenCount"],n),e}function bp(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>oF(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function Qk(i){let e={},t=f(i,["controlType"]);t!=null&&g(e,["controlType"],t);let n=f(i,["enableControlImageComputation"]);return n!=null&&g(e,["computeControl"],n),e}function jk(i){let e={};if(f(i,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(f(i,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(f(i,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function eN(i,e){let t={},n=f(i,["systemInstruction"]);e!==void 0&&n!=null&&g(e,["systemInstruction"],ot(n));let s=f(i,["tools"]);if(e!==void 0&&s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>QT(a))),g(e,["tools"],o)}let r=f(i,["generationConfig"]);return e!==void 0&&r!=null&&g(e,["generationConfig"],qN(r)),t}function tN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=on(s);Array.isArray(o)&&(o=o.map(a=>bp(a))),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&jk(r),t}function nN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=on(s);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&eN(r,t),t}function iN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["totalTokens"]);n!=null&&g(e,["totalTokens"],n);let s=f(i,["cachedContentTokenCount"]);return s!=null&&g(e,["cachedContentTokenCount"],s),e}function sN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["totalTokens"]);return n!=null&&g(e,["totalTokens"],n),e}function rN(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],ce(i,n)),t}function oN(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],ce(i,n)),t}function aN(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function lN(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function cN(i,e){let t={},n=f(i,["outputGcsUri"]);e!==void 0&&n!=null&&g(e,["parameters","storageUri"],n);let s=f(i,["negativePrompt"]);e!==void 0&&s!=null&&g(e,["parameters","negativePrompt"],s);let r=f(i,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);let o=f(i,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);let a=f(i,["guidanceScale"]);e!==void 0&&a!=null&&g(e,["parameters","guidanceScale"],a);let l=f(i,["seed"]);e!==void 0&&l!=null&&g(e,["parameters","seed"],l);let c=f(i,["safetyFilterLevel"]);e!==void 0&&c!=null&&g(e,["parameters","safetySetting"],c);let d=f(i,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);let h=f(i,["includeSafetyAttributes"]);e!==void 0&&h!=null&&g(e,["parameters","includeSafetyAttributes"],h);let p=f(i,["includeRaiReason"]);e!==void 0&&p!=null&&g(e,["parameters","includeRaiReason"],p);let m=f(i,["language"]);e!==void 0&&m!=null&&g(e,["parameters","language"],m);let y=f(i,["outputMimeType"]);e!==void 0&&y!=null&&g(e,["parameters","outputOptions","mimeType"],y);let v=f(i,["outputCompressionQuality"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","compressionQuality"],v);let b=f(i,["addWatermark"]);e!==void 0&&b!=null&&g(e,["parameters","addWatermark"],b);let w=f(i,["labels"]);e!==void 0&&w!=null&&g(e,["labels"],w);let _=f(i,["editMode"]);e!==void 0&&_!=null&&g(e,["parameters","editMode"],_);let C=f(i,["baseSteps"]);return e!==void 0&&C!=null&&g(e,["parameters","editConfig","baseSteps"],C),t}function dN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["referenceImages"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>hF(l))),g(t,["instances[0]","referenceImages"],a)}let o=f(e,["config"]);return o!=null&&cN(o,t),t}function uN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>Ap(r))),g(e,["generatedImages"],s)}return e}function hN(i,e){let t={},n=f(i,["taskType"]);e!==void 0&&n!=null&&g(e,["requests[]","taskType"],n);let s=f(i,["title"]);e!==void 0&&s!=null&&g(e,["requests[]","title"],s);let r=f(i,["outputDimensionality"]);if(e!==void 0&&r!=null&&g(e,["requests[]","outputDimensionality"],r),f(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function fN(i,e){let t={},n=f(i,["taskType"]);e!==void 0&&n!=null&&g(e,["instances[]","task_type"],n);let s=f(i,["title"]);e!==void 0&&s!=null&&g(e,["instances[]","title"],s);let r=f(i,["outputDimensionality"]);e!==void 0&&r!=null&&g(e,["parameters","outputDimensionality"],r);let o=f(i,["mimeType"]);e!==void 0&&o!=null&&g(e,["instances[]","mimeType"],o);let a=f(i,["autoTruncate"]);return e!==void 0&&a!=null&&g(e,["parameters","autoTruncate"],a),t}function pN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let a=eb(i,s);Array.isArray(a)&&(a=a.map(l=>l)),g(t,["requests[]","content"],a)}let r=f(e,["config"]);r!=null&&hN(r,t);let o=f(e,["model"]);return o!==void 0&&g(t,["requests[]","model"],ce(i,o)),t}function gN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=eb(i,s);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["instances[]","content"],o)}let r=f(e,["config"]);return r!=null&&fN(r,t),t}function mN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["embeddings"],r)}let s=f(i,["metadata"]);return s!=null&&g(e,["metadata"],s),e}function yN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions[]","embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Jk(o))),g(e,["embeddings"],r)}let s=f(i,["metadata"]);return s!=null&&g(e,["metadata"],s),e}function vN(i){let e={},t=f(i,["endpoint"]);t!=null&&g(e,["name"],t);let n=f(i,["deployedModelId"]);return n!=null&&g(e,["deployedModelId"],n),e}function EN(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function bN(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function AN(i){let e={},t=f(i,["mode"]);t!=null&&g(e,["mode"],t);let n=f(i,["allowedFunctionNames"]);if(n!=null&&g(e,["allowedFunctionNames"],n),f(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function wN(i){let e={};if(f(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=f(i,["description"]);t!=null&&g(e,["description"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["parameters"]);s!=null&&g(e,["parameters"],s);let r=f(i,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);let o=f(i,["response"]);o!=null&&g(e,["response"],o);let a=f(i,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function SN(i,e,t){let n={},s=f(e,["systemInstruction"]);t!==void 0&&s!=null&&g(t,["systemInstruction"],bp(ot(s)));let r=f(e,["temperature"]);r!=null&&g(n,["temperature"],r);let o=f(e,["topP"]);o!=null&&g(n,["topP"],o);let a=f(e,["topK"]);a!=null&&g(n,["topK"],a);let l=f(e,["candidateCount"]);l!=null&&g(n,["candidateCount"],l);let c=f(e,["maxOutputTokens"]);c!=null&&g(n,["maxOutputTokens"],c);let d=f(e,["stopSequences"]);d!=null&&g(n,["stopSequences"],d);let h=f(e,["responseLogprobs"]);h!=null&&g(n,["responseLogprobs"],h);let p=f(e,["logprobs"]);p!=null&&g(n,["logprobs"],p);let m=f(e,["presencePenalty"]);m!=null&&g(n,["presencePenalty"],m);let y=f(e,["frequencyPenalty"]);y!=null&&g(n,["frequencyPenalty"],y);let v=f(e,["seed"]);v!=null&&g(n,["seed"],v);let b=f(e,["responseMimeType"]);b!=null&&g(n,["responseMimeType"],b);let w=f(e,["responseSchema"]);w!=null&&g(n,["responseSchema"],tb(w));let _=f(e,["responseJsonSchema"]);if(_!=null&&g(n,["responseJsonSchema"],_),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let C=f(e,["safetySettings"]);if(t!==void 0&&C!=null){let X=C;Array.isArray(X)&&(X=X.map(J=>fF(J))),g(t,["safetySettings"],X)}let T=f(e,["tools"]);if(t!==void 0&&T!=null){let X=Sa(T);Array.isArray(X)&&(X=X.map(J=>bF(wa(J)))),g(t,["tools"],X)}let R=f(e,["toolConfig"]);if(t!==void 0&&R!=null&&g(t,["toolConfig"],EF(R)),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let D=f(e,["cachedContent"]);t!==void 0&&D!=null&&g(t,["cachedContent"],Ri(i,D));let I=f(e,["responseModalities"]);I!=null&&g(n,["responseModalities"],I);let k=f(e,["mediaResolution"]);k!=null&&g(n,["mediaResolution"],k);let N=f(e,["speechConfig"]);if(N!=null&&g(n,["speechConfig"],nb(N)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=f(e,["thinkingConfig"]);F!=null&&g(n,["thinkingConfig"],F);let U=f(e,["imageConfig"]);U!=null&&g(n,["imageConfig"],JN(U));let re=f(e,["enableEnhancedCivicAnswers"]);return re!=null&&g(n,["enableEnhancedCivicAnswers"],re),n}function _N(i,e,t){let n={},s=f(e,["systemInstruction"]);t!==void 0&&s!=null&&g(t,["systemInstruction"],ot(s));let r=f(e,["temperature"]);r!=null&&g(n,["temperature"],r);let o=f(e,["topP"]);o!=null&&g(n,["topP"],o);let a=f(e,["topK"]);a!=null&&g(n,["topK"],a);let l=f(e,["candidateCount"]);l!=null&&g(n,["candidateCount"],l);let c=f(e,["maxOutputTokens"]);c!=null&&g(n,["maxOutputTokens"],c);let d=f(e,["stopSequences"]);d!=null&&g(n,["stopSequences"],d);let h=f(e,["responseLogprobs"]);h!=null&&g(n,["responseLogprobs"],h);let p=f(e,["logprobs"]);p!=null&&g(n,["logprobs"],p);let m=f(e,["presencePenalty"]);m!=null&&g(n,["presencePenalty"],m);let y=f(e,["frequencyPenalty"]);y!=null&&g(n,["frequencyPenalty"],y);let v=f(e,["seed"]);v!=null&&g(n,["seed"],v);let b=f(e,["responseMimeType"]);b!=null&&g(n,["responseMimeType"],b);let w=f(e,["responseSchema"]);w!=null&&g(n,["responseSchema"],tb(w));let _=f(e,["responseJsonSchema"]);_!=null&&g(n,["responseJsonSchema"],_);let C=f(e,["routingConfig"]);C!=null&&g(n,["routingConfig"],C);let T=f(e,["modelSelectionConfig"]);T!=null&&g(n,["modelConfig"],T);let R=f(e,["safetySettings"]);if(t!==void 0&&R!=null){let L=R;Array.isArray(L)&&(L=L.map(q=>q)),g(t,["safetySettings"],L)}let D=f(e,["tools"]);if(t!==void 0&&D!=null){let L=Sa(D);Array.isArray(L)&&(L=L.map(q=>QT(wa(q)))),g(t,["tools"],L)}let I=f(e,["toolConfig"]);t!==void 0&&I!=null&&g(t,["toolConfig"],I);let k=f(e,["labels"]);t!==void 0&&k!=null&&g(t,["labels"],k);let N=f(e,["cachedContent"]);t!==void 0&&N!=null&&g(t,["cachedContent"],Ri(i,N));let F=f(e,["responseModalities"]);F!=null&&g(n,["responseModalities"],F);let U=f(e,["mediaResolution"]);U!=null&&g(n,["mediaResolution"],U);let re=f(e,["speechConfig"]);re!=null&&g(n,["speechConfig"],nb(re));let X=f(e,["audioTimestamp"]);X!=null&&g(n,["audioTimestamp"],X);let J=f(e,["thinkingConfig"]);J!=null&&g(n,["thinkingConfig"],J);let Ge=f(e,["imageConfig"]);if(Ge!=null&&g(n,["imageConfig"],ZN(Ge)),f(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function mT(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=on(s);Array.isArray(o)&&(o=o.map(a=>bp(a))),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&g(t,["generationConfig"],SN(i,r,t)),t}function yT(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=on(s);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&g(t,["generationConfig"],_N(i,r,t)),t}function vT(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>Wk(c))),g(e,["candidates"],l)}let s=f(i,["modelVersion"]);s!=null&&g(e,["modelVersion"],s);let r=f(i,["promptFeedback"]);r!=null&&g(e,["promptFeedback"],r);let o=f(i,["responseId"]);o!=null&&g(e,["responseId"],o);let a=f(i,["usageMetadata"]);return a!=null&&g(e,["usageMetadata"],a),e}function ET(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>d)),g(e,["candidates"],c)}let s=f(i,["createTime"]);s!=null&&g(e,["createTime"],s);let r=f(i,["modelVersion"]);r!=null&&g(e,["modelVersion"],r);let o=f(i,["promptFeedback"]);o!=null&&g(e,["promptFeedback"],o);let a=f(i,["responseId"]);a!=null&&g(e,["responseId"],a);let l=f(i,["usageMetadata"]);return l!=null&&g(e,["usageMetadata"],l),e}function CN(i,e){let t={};if(f(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(i,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let n=f(i,["numberOfImages"]);e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n);let s=f(i,["aspectRatio"]);e!==void 0&&s!=null&&g(e,["parameters","aspectRatio"],s);let r=f(i,["guidanceScale"]);if(e!==void 0&&r!=null&&g(e,["parameters","guidanceScale"],r),f(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=f(i,["safetyFilterLevel"]);e!==void 0&&o!=null&&g(e,["parameters","safetySetting"],o);let a=f(i,["personGeneration"]);e!==void 0&&a!=null&&g(e,["parameters","personGeneration"],a);let l=f(i,["includeSafetyAttributes"]);e!==void 0&&l!=null&&g(e,["parameters","includeSafetyAttributes"],l);let c=f(i,["includeRaiReason"]);e!==void 0&&c!=null&&g(e,["parameters","includeRaiReason"],c);let d=f(i,["language"]);e!==void 0&&d!=null&&g(e,["parameters","language"],d);let h=f(i,["outputMimeType"]);e!==void 0&&h!=null&&g(e,["parameters","outputOptions","mimeType"],h);let p=f(i,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&g(e,["parameters","outputOptions","compressionQuality"],p),f(i,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(f(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let m=f(i,["imageSize"]);if(e!==void 0&&m!=null&&g(e,["parameters","sampleImageSize"],m),f(i,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function TN(i,e){let t={},n=f(i,["outputGcsUri"]);e!==void 0&&n!=null&&g(e,["parameters","storageUri"],n);let s=f(i,["negativePrompt"]);e!==void 0&&s!=null&&g(e,["parameters","negativePrompt"],s);let r=f(i,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);let o=f(i,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);let a=f(i,["guidanceScale"]);e!==void 0&&a!=null&&g(e,["parameters","guidanceScale"],a);let l=f(i,["seed"]);e!==void 0&&l!=null&&g(e,["parameters","seed"],l);let c=f(i,["safetyFilterLevel"]);e!==void 0&&c!=null&&g(e,["parameters","safetySetting"],c);let d=f(i,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);let h=f(i,["includeSafetyAttributes"]);e!==void 0&&h!=null&&g(e,["parameters","includeSafetyAttributes"],h);let p=f(i,["includeRaiReason"]);e!==void 0&&p!=null&&g(e,["parameters","includeRaiReason"],p);let m=f(i,["language"]);e!==void 0&&m!=null&&g(e,["parameters","language"],m);let y=f(i,["outputMimeType"]);e!==void 0&&y!=null&&g(e,["parameters","outputOptions","mimeType"],y);let v=f(i,["outputCompressionQuality"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","compressionQuality"],v);let b=f(i,["addWatermark"]);e!==void 0&&b!=null&&g(e,["parameters","addWatermark"],b);let w=f(i,["labels"]);e!==void 0&&w!=null&&g(e,["labels"],w);let _=f(i,["imageSize"]);e!==void 0&&_!=null&&g(e,["parameters","sampleImageSize"],_);let C=f(i,["enhancePrompt"]);return e!==void 0&&C!=null&&g(e,["parameters","enhancePrompt"],C),t}function xN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["config"]);return r!=null&&CN(r,t),t}function RN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["config"]);return r!=null&&TN(r,t),t}function IN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>VN(o))),g(e,["generatedImages"],r)}let s=f(i,["positivePromptSafetyAttributes"]);return s!=null&&g(e,["positivePromptSafetyAttributes"],JT(s)),e}function DN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Ap(o))),g(e,["generatedImages"],r)}let s=f(i,["positivePromptSafetyAttributes"]);return s!=null&&g(e,["positivePromptSafetyAttributes"],ZT(s)),e}function MN(i,e){let t={},n=f(i,["numberOfVideos"]);if(e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n),f(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(i,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let s=f(i,["durationSeconds"]);if(e!==void 0&&s!=null&&g(e,["parameters","durationSeconds"],s),f(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let r=f(i,["aspectRatio"]);e!==void 0&&r!=null&&g(e,["parameters","aspectRatio"],r);let o=f(i,["resolution"]);e!==void 0&&o!=null&&g(e,["parameters","resolution"],o);let a=f(i,["personGeneration"]);if(e!==void 0&&a!=null&&g(e,["parameters","personGeneration"],a),f(i,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let l=f(i,["negativePrompt"]);e!==void 0&&l!=null&&g(e,["parameters","negativePrompt"],l);let c=f(i,["enhancePrompt"]);if(e!==void 0&&c!=null&&g(e,["parameters","enhancePrompt"],c),f(i,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let d=f(i,["lastFrame"]);e!==void 0&&d!=null&&g(e,["instances[0]","lastFrame"],wp(d));let h=f(i,["referenceImages"]);if(e!==void 0&&h!=null){let p=h;Array.isArray(p)&&(p=p.map(m=>kF(m))),g(e,["instances[0]","referenceImages"],p)}if(f(i,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(f(i,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function PN(i,e){let t={},n=f(i,["numberOfVideos"]);e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n);let s=f(i,["outputGcsUri"]);e!==void 0&&s!=null&&g(e,["parameters","storageUri"],s);let r=f(i,["fps"]);e!==void 0&&r!=null&&g(e,["parameters","fps"],r);let o=f(i,["durationSeconds"]);e!==void 0&&o!=null&&g(e,["parameters","durationSeconds"],o);let a=f(i,["seed"]);e!==void 0&&a!=null&&g(e,["parameters","seed"],a);let l=f(i,["aspectRatio"]);e!==void 0&&l!=null&&g(e,["parameters","aspectRatio"],l);let c=f(i,["resolution"]);e!==void 0&&c!=null&&g(e,["parameters","resolution"],c);let d=f(i,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);let h=f(i,["pubsubTopic"]);e!==void 0&&h!=null&&g(e,["parameters","pubsubTopic"],h);let p=f(i,["negativePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","negativePrompt"],p);let m=f(i,["enhancePrompt"]);e!==void 0&&m!=null&&g(e,["parameters","enhancePrompt"],m);let y=f(i,["generateAudio"]);e!==void 0&&y!=null&&g(e,["parameters","generateAudio"],y);let v=f(i,["lastFrame"]);e!==void 0&&v!=null&&g(e,["instances[0]","lastFrame"],_n(v));let b=f(i,["referenceImages"]);if(e!==void 0&&b!=null){let C=b;Array.isArray(C)&&(C=C.map(T=>NF(T))),g(e,["instances[0]","referenceImages"],C)}let w=f(i,["mask"]);e!==void 0&&w!=null&&g(e,["instances[0]","mask"],PF(w));let _=f(i,["compressionQuality"]);return e!==void 0&&_!=null&&g(e,["parameters","compressionQuality"],_),t}function kN(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response","generateVideoResponse"]);return o!=null&&g(e,["response"],ON(o)),e}function NN(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],UN(o)),e}function FN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["image"]);r!=null&&g(t,["instances[0]","image"],wp(r));let o=f(e,["video"]);o!=null&&g(t,["instances[0]","video"],jT(o));let a=f(e,["source"]);a!=null&&HN(a,t);let l=f(e,["config"]);return l!=null&&MN(l,t),t}function LN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["image"]);r!=null&&g(t,["instances[0]","image"],_n(r));let o=f(e,["video"]);o!=null&&g(t,["instances[0]","video"],e0(o));let a=f(e,["source"]);a!=null&&BN(a,t);let l=f(e,["config"]);return l!=null&&PN(l,t),t}function ON(i){let e={},t=f(i,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>$N(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function UN(i){let e={},t=f(i,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>zN(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function HN(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["image"]);e!==void 0&&s!=null&&g(e,["instances[0]","image"],wp(s));let r=f(i,["video"]);return e!==void 0&&r!=null&&g(e,["instances[0]","video"],jT(r)),t}function BN(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["image"]);e!==void 0&&s!=null&&g(e,["instances[0]","image"],_n(s));let r=f(i,["video"]);return e!==void 0&&r!=null&&g(e,["instances[0]","video"],e0(r)),t}function VN(i){let e={},t=f(i,["_self"]);t!=null&&g(e,["image"],QN(t));let n=f(i,["raiFilteredReason"]);n!=null&&g(e,["raiFilteredReason"],n);let s=f(i,["_self"]);return s!=null&&g(e,["safetyAttributes"],JT(s)),e}function Ap(i){let e={},t=f(i,["_self"]);t!=null&&g(e,["image"],XT(t));let n=f(i,["raiFilteredReason"]);n!=null&&g(e,["raiFilteredReason"],n);let s=f(i,["_self"]);s!=null&&g(e,["safetyAttributes"],ZT(s));let r=f(i,["prompt"]);return r!=null&&g(e,["enhancedPrompt"],r),e}function GN(i){let e={},t=f(i,["_self"]);t!=null&&g(e,["mask"],XT(t));let n=f(i,["labels"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),g(e,["labels"],s)}return e}function $N(i){let e={},t=f(i,["video"]);return t!=null&&g(e,["video"],DF(t)),e}function zN(i){let e={},t=f(i,["_self"]);return t!=null&&g(e,["video"],MF(t)),e}function qN(i){let e={},t=f(i,["modelSelectionConfig"]);t!=null&&g(e,["modelConfig"],t);let n=f(i,["responseJsonSchema"]);n!=null&&g(e,["responseJsonSchema"],n);let s=f(i,["audioTimestamp"]);s!=null&&g(e,["audioTimestamp"],s);let r=f(i,["candidateCount"]);r!=null&&g(e,["candidateCount"],r);let o=f(i,["enableAffectiveDialog"]);o!=null&&g(e,["enableAffectiveDialog"],o);let a=f(i,["frequencyPenalty"]);a!=null&&g(e,["frequencyPenalty"],a);let l=f(i,["logprobs"]);l!=null&&g(e,["logprobs"],l);let c=f(i,["maxOutputTokens"]);c!=null&&g(e,["maxOutputTokens"],c);let d=f(i,["mediaResolution"]);d!=null&&g(e,["mediaResolution"],d);let h=f(i,["presencePenalty"]);h!=null&&g(e,["presencePenalty"],h);let p=f(i,["responseLogprobs"]);p!=null&&g(e,["responseLogprobs"],p);let m=f(i,["responseMimeType"]);m!=null&&g(e,["responseMimeType"],m);let y=f(i,["responseModalities"]);y!=null&&g(e,["responseModalities"],y);let v=f(i,["responseSchema"]);v!=null&&g(e,["responseSchema"],v);let b=f(i,["routingConfig"]);b!=null&&g(e,["routingConfig"],b);let w=f(i,["seed"]);w!=null&&g(e,["seed"],w);let _=f(i,["speechConfig"]);_!=null&&g(e,["speechConfig"],_);let C=f(i,["stopSequences"]);C!=null&&g(e,["stopSequences"],C);let T=f(i,["temperature"]);T!=null&&g(e,["temperature"],T);let R=f(i,["thinkingConfig"]);R!=null&&g(e,["thinkingConfig"],R);let D=f(i,["topK"]);D!=null&&g(e,["topK"],D);let I=f(i,["topP"]);if(I!=null&&g(e,["topP"],I),f(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function WN(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],ce(i,n)),t}function YN(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],ce(i,n)),t}function KN(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function XN(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function JN(i){let e={},t=f(i,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);let n=f(i,["imageSize"]);if(n!=null&&g(e,["imageSize"],n),f(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function ZN(i){let e={},t=f(i,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);let n=f(i,["imageSize"]);n!=null&&g(e,["imageSize"],n);let s=f(i,["outputMimeType"]);s!=null&&g(e,["imageOutputOptions","mimeType"],s);let r=f(i,["outputCompressionQuality"]);return r!=null&&g(e,["imageOutputOptions","compressionQuality"],r),e}function QN(i){let e={},t=f(i,["bytesBase64Encoded"]);t!=null&&g(e,["imageBytes"],ys(t));let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function XT(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["gcsUri"],t);let n=f(i,["bytesBase64Encoded"]);n!=null&&g(e,["imageBytes"],ys(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function wp(i){let e={};if(f(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=f(i,["imageBytes"]);t!=null&&g(e,["bytesBase64Encoded"],ys(t));let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function _n(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["gcsUri"],t);let n=f(i,["imageBytes"]);n!=null&&g(e,["bytesBase64Encoded"],ys(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function jN(i,e,t){let n={},s=f(e,["pageSize"]);t!==void 0&&s!=null&&g(t,["_query","pageSize"],s);let r=f(e,["pageToken"]);t!==void 0&&r!=null&&g(t,["_query","pageToken"],r);let o=f(e,["filter"]);t!==void 0&&o!=null&&g(t,["_query","filter"],o);let a=f(e,["queryBase"]);return t!==void 0&&a!=null&&g(t,["_url","models_url"],GT(i,a)),n}function eF(i,e,t){let n={},s=f(e,["pageSize"]);t!==void 0&&s!=null&&g(t,["_query","pageSize"],s);let r=f(e,["pageToken"]);t!==void 0&&r!=null&&g(t,["_query","pageToken"],r);let o=f(e,["filter"]);t!==void 0&&o!=null&&g(t,["_query","filter"],o);let a=f(e,["queryBase"]);return t!==void 0&&a!=null&&g(t,["_url","models_url"],GT(i,a)),n}function tF(i,e){let t={},n=f(e,["config"]);return n!=null&&jN(i,n,t),t}function nF(i,e){let t={},n=f(e,["config"]);return n!=null&&eF(i,n,t),t}function iF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["_self"]);if(s!=null){let r=$T(s);Array.isArray(r)&&(r=r.map(o=>CE(o))),g(e,["models"],r)}return e}function sF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["_self"]);if(s!=null){let r=$T(s);Array.isArray(r)&&(r=r.map(o=>TE(o))),g(e,["models"],r)}return e}function rF(i){let e={},t=f(i,["maskMode"]);t!=null&&g(e,["maskMode"],t);let n=f(i,["segmentationClasses"]);n!=null&&g(e,["maskClasses"],n);let s=f(i,["maskDilation"]);return s!=null&&g(e,["dilation"],s),e}function CE(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);s!=null&&g(e,["description"],s);let r=f(i,["version"]);r!=null&&g(e,["version"],r);let o=f(i,["_self"]);o!=null&&g(e,["tunedModelInfo"],AF(o));let a=f(i,["inputTokenLimit"]);a!=null&&g(e,["inputTokenLimit"],a);let l=f(i,["outputTokenLimit"]);l!=null&&g(e,["outputTokenLimit"],l);let c=f(i,["supportedGenerationMethods"]);c!=null&&g(e,["supportedActions"],c);let d=f(i,["temperature"]);d!=null&&g(e,["temperature"],d);let h=f(i,["maxTemperature"]);h!=null&&g(e,["maxTemperature"],h);let p=f(i,["topP"]);p!=null&&g(e,["topP"],p);let m=f(i,["topK"]);m!=null&&g(e,["topK"],m);let y=f(i,["thinking"]);return y!=null&&g(e,["thinking"],y),e}function TE(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);s!=null&&g(e,["description"],s);let r=f(i,["versionId"]);r!=null&&g(e,["version"],r);let o=f(i,["deployedModels"]);if(o!=null){let h=o;Array.isArray(h)&&(h=h.map(p=>vN(p))),g(e,["endpoints"],h)}let a=f(i,["labels"]);a!=null&&g(e,["labels"],a);let l=f(i,["_self"]);l!=null&&g(e,["tunedModelInfo"],wF(l));let c=f(i,["defaultCheckpointId"]);c!=null&&g(e,["defaultCheckpointId"],c);let d=f(i,["checkpoints"]);if(d!=null){let h=d;Array.isArray(h)&&(h=h.map(p=>p)),g(e,["checkpoints"],h)}return e}function oF(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],EN(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],bN(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],qk(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function aF(i){let e={},t=f(i,["productImage"]);return t!=null&&g(e,["image"],_n(t)),e}function lF(i,e){let t={},n=f(i,["numberOfImages"]);e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n);let s=f(i,["baseSteps"]);e!==void 0&&s!=null&&g(e,["parameters","baseSteps"],s);let r=f(i,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);let o=f(i,["seed"]);e!==void 0&&o!=null&&g(e,["parameters","seed"],o);let a=f(i,["safetyFilterLevel"]);e!==void 0&&a!=null&&g(e,["parameters","safetySetting"],a);let l=f(i,["personGeneration"]);e!==void 0&&l!=null&&g(e,["parameters","personGeneration"],l);let c=f(i,["addWatermark"]);e!==void 0&&c!=null&&g(e,["parameters","addWatermark"],c);let d=f(i,["outputMimeType"]);e!==void 0&&d!=null&&g(e,["parameters","outputOptions","mimeType"],d);let h=f(i,["outputCompressionQuality"]);e!==void 0&&h!=null&&g(e,["parameters","outputOptions","compressionQuality"],h);let p=f(i,["enhancePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","enhancePrompt"],p);let m=f(i,["labels"]);return e!==void 0&&m!=null&&g(e,["labels"],m),t}function cF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["source"]);s!=null&&uF(s,t);let r=f(e,["config"]);return r!=null&&lF(r,t),t}function dF(i){let e={},t=f(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>Ap(s))),g(e,["generatedImages"],n)}return e}function uF(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["personImage"]);e!==void 0&&s!=null&&g(e,["instances[0]","personImage","image"],_n(s));let r=f(i,["productImages"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>aF(a))),g(e,["instances[0]","productImages"],o)}return t}function hF(i){let e={},t=f(i,["referenceImage"]);t!=null&&g(e,["referenceImage"],_n(t));let n=f(i,["referenceId"]);n!=null&&g(e,["referenceId"],n);let s=f(i,["referenceType"]);s!=null&&g(e,["referenceType"],s);let r=f(i,["maskImageConfig"]);r!=null&&g(e,["maskImageConfig"],rF(r));let o=f(i,["controlImageConfig"]);o!=null&&g(e,["controlImageConfig"],Qk(o));let a=f(i,["styleImageConfig"]);a!=null&&g(e,["styleImageConfig"],a);let l=f(i,["subjectImageConfig"]);return l!=null&&g(e,["subjectImageConfig"],l),e}function JT(i){let e={},t=f(i,["safetyAttributes","categories"]);t!=null&&g(e,["categories"],t);let n=f(i,["safetyAttributes","scores"]);n!=null&&g(e,["scores"],n);let s=f(i,["contentType"]);return s!=null&&g(e,["contentType"],s),e}function ZT(i){let e={},t=f(i,["safetyAttributes","categories"]);t!=null&&g(e,["categories"],t);let n=f(i,["safetyAttributes","scores"]);n!=null&&g(e,["scores"],n);let s=f(i,["contentType"]);return s!=null&&g(e,["contentType"],s),e}function fF(i){let e={},t=f(i,["category"]);if(t!=null&&g(e,["category"],t),f(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=f(i,["threshold"]);return n!=null&&g(e,["threshold"],n),e}function pF(i){let e={},t=f(i,["image"]);return t!=null&&g(e,["image"],_n(t)),e}function gF(i,e){let t={},n=f(i,["mode"]);e!==void 0&&n!=null&&g(e,["parameters","mode"],n);let s=f(i,["maxPredictions"]);e!==void 0&&s!=null&&g(e,["parameters","maxPredictions"],s);let r=f(i,["confidenceThreshold"]);e!==void 0&&r!=null&&g(e,["parameters","confidenceThreshold"],r);let o=f(i,["maskDilation"]);e!==void 0&&o!=null&&g(e,["parameters","maskDilation"],o);let a=f(i,["binaryColorThreshold"]);e!==void 0&&a!=null&&g(e,["parameters","binaryColorThreshold"],a);let l=f(i,["labels"]);return e!==void 0&&l!=null&&g(e,["labels"],l),t}function mF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["source"]);s!=null&&vF(s,t);let r=f(e,["config"]);return r!=null&&gF(r,t),t}function yF(i){let e={},t=f(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>GN(s))),g(e,["generatedMasks"],n)}return e}function vF(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["image"]);e!==void 0&&s!=null&&g(e,["instances[0]","image"],_n(s));let r=f(i,["scribbleImage"]);return e!==void 0&&r!=null&&g(e,["instances[0]","scribble"],pF(r)),t}function EF(i){let e={},t=f(i,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],AN(t));let n=f(i,["retrievalConfig"]);return n!=null&&g(e,["retrievalConfig"],n),e}function bF(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],KN(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],XN(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function QT(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(p=>wN(p))),g(e,["functionDeclarations"],h)}let n=f(i,["retrieval"]);n!=null&&g(e,["retrieval"],n);let s=f(i,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);let r=f(i,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=f(i,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);let a=f(i,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);let l=f(i,["googleMaps"]);l!=null&&g(e,["googleMaps"],l);let c=f(i,["googleSearch"]);c!=null&&g(e,["googleSearch"],c);let d=f(i,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function AF(i){let e={},t=f(i,["baseModel"]);t!=null&&g(e,["baseModel"],t);let n=f(i,["createTime"]);n!=null&&g(e,["createTime"],n);let s=f(i,["updateTime"]);return s!=null&&g(e,["updateTime"],s),e}function wF(i){let e={},t=f(i,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&g(e,["baseModel"],t);let n=f(i,["createTime"]);n!=null&&g(e,["createTime"],n);let s=f(i,["updateTime"]);return s!=null&&g(e,["updateTime"],s),e}function SF(i,e){let t={},n=f(i,["displayName"]);e!==void 0&&n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);e!==void 0&&s!=null&&g(e,["description"],s);let r=f(i,["defaultCheckpointId"]);return e!==void 0&&r!=null&&g(e,["defaultCheckpointId"],r),t}function _F(i,e){let t={},n=f(i,["displayName"]);e!==void 0&&n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);e!==void 0&&s!=null&&g(e,["description"],s);let r=f(i,["defaultCheckpointId"]);return e!==void 0&&r!=null&&g(e,["defaultCheckpointId"],r),t}function CF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","name"],ce(i,n));let s=f(e,["config"]);return s!=null&&SF(s,t),t}function TF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["config"]);return s!=null&&_F(s,t),t}function xF(i,e){let t={},n=f(i,["outputGcsUri"]);e!==void 0&&n!=null&&g(e,["parameters","storageUri"],n);let s=f(i,["safetyFilterLevel"]);e!==void 0&&s!=null&&g(e,["parameters","safetySetting"],s);let r=f(i,["personGeneration"]);e!==void 0&&r!=null&&g(e,["parameters","personGeneration"],r);let o=f(i,["includeRaiReason"]);e!==void 0&&o!=null&&g(e,["parameters","includeRaiReason"],o);let a=f(i,["outputMimeType"]);e!==void 0&&a!=null&&g(e,["parameters","outputOptions","mimeType"],a);let l=f(i,["outputCompressionQuality"]);e!==void 0&&l!=null&&g(e,["parameters","outputOptions","compressionQuality"],l);let c=f(i,["enhanceInputImage"]);e!==void 0&&c!=null&&g(e,["parameters","upscaleConfig","enhanceInputImage"],c);let d=f(i,["imagePreservationFactor"]);e!==void 0&&d!=null&&g(e,["parameters","upscaleConfig","imagePreservationFactor"],d);let h=f(i,["labels"]);e!==void 0&&h!=null&&g(e,["labels"],h);let p=f(i,["numberOfImages"]);e!==void 0&&p!=null&&g(e,["parameters","sampleCount"],p);let m=f(i,["mode"]);return e!==void 0&&m!=null&&g(e,["parameters","mode"],m),t}function RF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["image"]);s!=null&&g(t,["instances[0]","image"],_n(s));let r=f(e,["upscaleFactor"]);r!=null&&g(t,["parameters","upscaleConfig","upscaleFactor"],r);let o=f(e,["config"]);return o!=null&&xF(o,t),t}function IF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>Ap(r))),g(e,["generatedImages"],s)}return e}function DF(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["uri"],t);let n=f(i,["encodedVideo"]);n!=null&&g(e,["videoBytes"],ys(n));let s=f(i,["encoding"]);return s!=null&&g(e,["mimeType"],s),e}function MF(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["uri"],t);let n=f(i,["bytesBase64Encoded"]);n!=null&&g(e,["videoBytes"],ys(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function PF(i){let e={},t=f(i,["image"]);t!=null&&g(e,["_self"],_n(t));let n=f(i,["maskMode"]);return n!=null&&g(e,["maskMode"],n),e}function kF(i){let e={},t=f(i,["image"]);t!=null&&g(e,["image"],wp(t));let n=f(i,["referenceType"]);return n!=null&&g(e,["referenceType"],n),e}function NF(i){let e={},t=f(i,["image"]);t!=null&&g(e,["image"],_n(t));let n=f(i,["referenceType"]);return n!=null&&g(e,["referenceType"],n),e}function jT(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["uri"],t);let n=f(i,["videoBytes"]);n!=null&&g(e,["encodedVideo"],ys(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["encoding"],s),e}function e0(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["gcsUri"],t);let n=f(i,["videoBytes"]);n!=null&&g(e,["bytesBase64Encoded"],ys(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function FF(i,e){let t={},n=f(i,["displayName"]);return e!==void 0&&n!=null&&g(e,["displayName"],n),t}function LF(i){let e={},t=f(i,["config"]);return t!=null&&FF(t,e),e}function OF(i,e){let t={},n=f(i,["force"]);return e!==void 0&&n!=null&&g(e,["_query","force"],n),t}function UF(i){let e={},t=f(i,["name"]);t!=null&&g(e,["_url","name"],t);let n=f(i,["config"]);return n!=null&&OF(n,e),e}function HF(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","name"],t),e}function BF(i,e){let t={},n=f(i,["customMetadata"]);if(e!==void 0&&n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["customMetadata"],r)}let s=f(i,["chunkingConfig"]);return e!==void 0&&s!=null&&g(e,["chunkingConfig"],s),t}function VF(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],$F(o)),e}function GF(i){let e={},t=f(i,["fileSearchStoreName"]);t!=null&&g(e,["_url","file_search_store_name"],t);let n=f(i,["fileName"]);n!=null&&g(e,["fileName"],n);let s=f(i,["config"]);return s!=null&&BF(s,e),e}function $F(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["parent"]);n!=null&&g(e,["parent"],n);let s=f(i,["documentName"]);return s!=null&&g(e,["documentName"],s),e}function zF(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function qF(i){let e={},t=f(i,["config"]);return t!=null&&zF(t,e),e}function WF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["fileSearchStores"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["fileSearchStores"],r)}return e}function t0(i,e){let t={},n=f(i,["mimeType"]);e!==void 0&&n!=null&&g(e,["mimeType"],n);let s=f(i,["displayName"]);e!==void 0&&s!=null&&g(e,["displayName"],s);let r=f(i,["customMetadata"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>l)),g(e,["customMetadata"],a)}let o=f(i,["chunkingConfig"]);return e!==void 0&&o!=null&&g(e,["chunkingConfig"],o),t}function YF(i){let e={},t=f(i,["fileSearchStoreName"]);t!=null&&g(e,["_url","file_search_store_name"],t);let n=f(i,["config"]);return n!=null&&t0(n,e),e}function KF(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}var XF="Content-Type",JF="X-Server-Timeout",ZF="User-Agent",xE="x-goog-api-client",QF="1.34.0",jF=`google-genai-sdk/${QF}`,eL="v1beta1",tL="v1beta",RE=class{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let s={};this.clientOptions.vertexai?(s.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:eL,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:tL,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let s=[this.getRequestUrlInternal(t)];return n&&s.push(this.getBaseResourcePath()),e!==""&&s.push(e),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[o,a]of Object.entries(e.queryParams))s.searchParams.append(o,String(a));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.unaryApiCall(s,r,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[s,r]of Object.entries(t))typeof r=="object"?n[s]=Object.assign(Object.assign({},n[s]),r):r!==void 0&&(n[s]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.streamApiCall(s,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,s){if(t&&t.timeout||s){let r=new AbortController,o=r.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){let a=setTimeout(()=>r.abort(),t.timeout);a&&typeof a.unref=="function"&&a.unref()}s&&s.addEventListener("abort",()=>{r.abort()}),e.signal=o}return t&&t.extraBody!==null&&nL(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await bT(s),new Hc(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await bT(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(e){return An(this,arguments,function*(){var n;let s=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let o="",a="data:",l=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:c,value:d}=yield K(s.read());if(c){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let h=r.decode(d,{stream:!0});try{let y=JSON.parse(h);if("error"in y){let v=JSON.parse(JSON.stringify(y.error)),b=v.status,w=v.code,_=`got status: ${b}. ${JSON.stringify(y)}`;if(w>=400&&w<600)throw new ip({message:_,status:w})}}catch(y){if(y.name==="ApiError")throw y}o+=h;let p=-1,m=0;for(;;){p=-1,m=0;for(let b of l){let w=o.indexOf(b);w!==-1&&(p===-1||w<p)&&(p=w,m=b.length)}if(p===-1)break;let y=o.substring(0,p);o=o.substring(p+m);let v=y.trim();if(v.startsWith(a)){let b=v.substring(a.length).trim();try{let w=new Response(b,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield K(new Hc(w))}catch(w){throw new Error(`exception parsing stream chunk ${b}. ${w}`)}}}}}finally{s.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){let e={},t=jF+" "+this.clientOptions.userAgentExtra;return e[ZF]=t,e[xE]=t,e[XF]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[s,r]of Object.entries(e.headers))n.append(s,r);e.timeout&&e.timeout>0&&n.append(JF,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(t=n.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),n}async uploadFile(e,t){var n;let s={};t!=null&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);let r=this.clientOptions.uploader,o=await r.stat(e);s.sizeBytes=String(o.size);let a=(n=t==null?void 0:t.mimeType)!==null&&n!==void 0?n:o.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=a;let l={file:s},c=this.getFileName(e),d=O("upload/v1beta/files",l._url),h=await this.fetchUploadUrl(d,s.sizeBytes,s.mimeType,c,l,t==null?void 0:t.httpOptions);return r.upload(e,h,this)}async uploadFileToFileSearchStore(e,t,n){var s;let r=this.clientOptions.uploader,o=await r.stat(t),a=String(o.size),l=(s=n==null?void 0:n.mimeType)!==null&&s!==void 0?s:o.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let c=`upload/v1beta/${e}:uploadToFileSearchStore`,d=this.getFileName(t),h={};n!=null&&t0(n,h);let p=await this.fetchUploadUrl(c,a,l,d,h,n==null?void 0:n.httpOptions);return r.uploadToFileSearchStore(t,p,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,s,r,o){var a;let l={};o?l=o:l={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},s?{"X-Goog-Upload-File-Name":s}:{})};let c=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:l});if(!c||!(c!=null&&c.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let d=(a=c==null?void 0:c.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(d===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return d}};async function bT(i){var e;if(i===void 0)throw new Error("response is undefined");if(!i.ok){let t=i.status,n;!((e=i.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await i.json():n={error:{message:await i.text(),code:i.status,status:i.statusText}};let s=JSON.stringify(n);throw t>=400&&t<600?new ip({message:s,status:t}):new Error(s)}}function nL(i,e){if(!e||Object.keys(e).length===0)return;if(i.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof i.body=="string"&&i.body.length>0)try{let r=JSON.parse(i.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))t=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch(r){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(r,o){let a=Object.assign({},r);for(let l in o)if(Object.prototype.hasOwnProperty.call(o,l)){let c=o[l],d=a[l];c&&typeof c=="object"&&!Array.isArray(c)&&d&&typeof d=="object"&&!Array.isArray(d)?a[l]=n(d,c):(d&&c&&typeof d!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof d}, New type: ${typeof c}. Overwriting.`),a[l]=c)}return a}let s=n(t,e);i.body=JSON.stringify(s)}var iL="mcp_used/unknown",sL=!1;function n0(i){for(let e of i)if(rL(e)||typeof e=="object"&&"inputSchema"in e)return!0;return sL}function i0(i){var e;let t=(e=i[xE])!==null&&e!==void 0?e:"";i[xE]=(t+` ${iL}`).trimStart()}function rL(i){return i!==null&&typeof i=="object"&&i instanceof IE}function oL(i){return An(this,arguments,function*(t,n=100){let s,r=0;for(;r<n;){let o=yield K(t.listTools({cursor:s}));for(let a of o.tools)yield yield K(a),r++;if(!o.nextCursor)break;s=o.nextCursor}})}var IE=class i{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new i(e,t)}async initialize(){var e,t,n,s;if(this.mcpTools.length>0)return;let r={},o=[];for(let d of this.mcpClients)try{for(var a=!0,l=(t=void 0,wn(oL(d))),c;c=await l.next(),e=c.done,!e;a=!0){s=c.value,a=!1;let h=s;o.push(h);let p=h.name;if(r[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);r[p]=d}}catch(h){t={error:h}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),zM(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let s=this.functionNameToMcpClient[n.name],r;this.config.timeout&&(r={timeout:this.config.timeout});let o=await s.callTool({name:n.name,arguments:n.args},void 0,r);t.push({functionResponse:{name:n.name,response:o.isError?{error:o}:o}})}return t}};async function aL(i,e,t){let n=new mE,s;t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data),Object.assign(n,s),e(n)}var DE=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let s=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),o=cL(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${s}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${a}`,c=()=>{},d=new Promise(C=>{c=C}),h=e.callbacks,p=function(){c({})},m=this.apiClient,y={onopen:p,onmessage:C=>{aL(m,h.onmessage,C)},onerror:(t=h==null?void 0:h.onerror)!==null&&t!==void 0?t:function(C){},onclose:(n=h==null?void 0:h.onclose)!==null&&n!==void 0?n:function(C){}},v=this.webSocketFactory.create(l,lL(o),y);v.connect(),await d;let _={setup:{model:ce(this.apiClient,e.model)}};return v.send(JSON.stringify(_)),new ME(v,this.apiClient)}},ME=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=Lk(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=Fk(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(ya.PLAY)}pause(){this.sendPlaybackControl(ya.PAUSE)}stop(){this.sendPlaybackControl(ya.STOP)}resetContext(){this.sendPlaybackControl(ya.RESET_CONTEXT)}close(){this.conn.close()}};function lL(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function cL(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var dL="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function uL(i,e,t){let n=new gE,s;t.data instanceof Blob?s=await t.data.text():t.data instanceof ArrayBuffer?s=new TextDecoder().decode(t.data):s=t.data;let r=JSON.parse(s);if(i.isVertexAI()){let o=Hk(r);Object.assign(n,o)}else Object.assign(n,r);e(n)}var PE=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new DE(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,s,r,o,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),d,h=this.apiClient.getHeaders();e.config&&e.config.tools&&n0(e.config.tools)&&i0(h);let p=pL(h);if(this.apiClient.isVertexAI())d=`${l}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p,d);else{let N=this.apiClient.getApiKey(),F="BidiGenerateContent",U="key";N!=null&&N.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),F="BidiGenerateContentConstrained",U="access_token"),d=`${l}/ws/google.ai.generativelanguage.${c}.GenerativeService.${F}?${U}=${N}`}let m=()=>{},y=new Promise(N=>{m=N}),v=e.callbacks,b=function(){var N;(N=v==null?void 0:v.onopen)===null||N===void 0||N.call(v),m({})},w=this.apiClient,_={onopen:b,onmessage:N=>{uL(w,v.onmessage,N)},onerror:(t=v==null?void 0:v.onerror)!==null&&t!==void 0?t:function(N){},onclose:(n=v==null?void 0:v.onclose)!==null&&n!==void 0?n:function(N){}},C=this.webSocketFactory.create(d,fL(p),_);C.connect(),await y;let T=ce(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&T.startsWith("publishers/")){let N=this.apiClient.getProject(),F=this.apiClient.getLocation();T=`projects/${N}/locations/${F}/`+T}let R={};this.apiClient.isVertexAI()&&((s=e.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[$f.AUDIO]}:e.config.responseModalities=[$f.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let D=(a=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[],I=[];for(let N of D)if(this.isCallableTool(N)){let F=N;I.push(await F.tool())}else I.push(N);I.length>0&&(e.config.tools=I);let k={model:T,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?R=Nk(this.apiClient,k):R=kk(this.apiClient,k),delete R.config,C.send(JSON.stringify(R)),new kE(C,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},hL={turnComplete:!0},kE=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=on(t.turns),e.isVertexAI()||(n=n.map(s=>bp(s)))}catch(s){throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(let r of n){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(dL)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},hL),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:Uk(e)}:t={realtimeInput:Ok(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function fL(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function pL(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var AT=10;function wT(i){var e,t,n;if(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let s=!1;for(let o of(t=i==null?void 0:i.tools)!==null&&t!==void 0?t:[])if(Ea(o)){s=!0;break}if(!s)return!0;let r=(n=i==null?void 0:i.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function Ea(i){return"callTool"in i&&typeof i.callTool=="function"}function gL(i){var e,t,n;return(n=(t=(e=i.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>Ea(s)))!==null&&n!==void 0?n:!1}function ST(i){var e;let t=[];return!((e=i==null?void 0:i.config)===null||e===void 0)&&e.tools&&i.config.tools.forEach((n,s)=>{if(Ea(n))return;let r=n;r.functionDeclarations&&r.functionDeclarations.length>0&&t.push(s)}),t}function _T(i){var e;return!(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var NE=class extends Sn{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,s,r,o,a;let l=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!gL(t)||wT(t.config))return await this.generateContentInternal(l);let c=ST(t);if(c.length>0){let v=c.map(b=>`tools[${b}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${v}.`)}let d,h,p=on(l.contents),m=(r=(s=(n=l.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&r!==void 0?r:AT,y=0;for(;y<m&&(d=await this.generateContentInternal(l),!(!d.functionCalls||d.functionCalls.length===0));){let v=d.candidates[0].content,b=[];for(let w of(a=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[])if(Ea(w)){let C=await w.callTool(d.functionCalls);b.push(...C)}y++,h={role:"user",parts:b},l.contents=on(l.contents),l.contents.push(v),l.contents.push(h),_T(l.config)&&(p.push(v),p.push(h))}return _T(l.config)&&(d.automaticFunctionCallingHistory=p),d},this.generateContentStream=async t=>{var n,s,r,o,a;if(this.maybeMoveToResponseJsonSchem(t),wT(t.config)){let h=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(h)}let l=ST(t);if(l.length>0){let h=l.map(p=>`tools[${p}]`).join(", ");throw new Error(`Incompatible tools found at ${h}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let c=(r=(s=(n=t==null?void 0:t.config)===null||n===void 0?void 0:n.toolConfig)===null||s===void 0?void 0:s.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,d=(a=(o=t==null?void 0:t.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(c&&!d)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var s;let r,o=[];if(n!=null&&n.generatedImages)for(let l of n.generatedImages)l&&(l!=null&&l.safetyAttributes)&&((s=l==null?void 0:l.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?r=l==null?void 0:l.safetyAttributes:o.push(l);let a;return r?a={generatedImages:o,positivePromptSafetyAttributes:r,sdkHttpResponse:n.sdkHttpResponse}:a={generatedImages:o,sdkHttpResponse:n.sdkHttpResponse},a}),this.list=async t=>{var n;let o={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((n=o.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new xi(Ti.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(o),o)},this.editImage=async t=>{let n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));let s={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(s)},this.generateVideos=async t=>{var n,s,r,o,a,l;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=t.video)===null||n===void 0)&&n.uri&&(!((s=t.video)===null||s===void 0)&&s.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((o=(r=t.source)===null||r===void 0?void 0:r.video)===null||o===void 0)&&o.uri&&(!((l=(a=t.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,s;let r=(t=e.config)===null||t===void 0?void 0:t.tools;if(!r)return e;let o=await Promise.all(r.map(async l=>Ea(l)?await l.tool():l)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(a.config.tools=o,e.config&&e.config.tools&&n0(e.config.tools)){let l=(s=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&s!==void 0?s:{},c=Object.assign({},l);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),i0(c),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return a}async initAfcToolsMap(e){var t,n,s;let r=new Map;for(let o of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(Ea(o)){let a=o,l=await a.tool();for(let c of(s=l.functionDeclarations)!==null&&s!==void 0?s:[]){if(!c.name)throw new Error("Function declaration name is required.");if(r.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);r.set(c.name,a)}}return r}async processAfcStream(e){var t,n,s;let r=(s=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&s!==void 0?s:AT,o=!1,a=0,l=await this.initAfcToolsMap(e);return function(c,d,h){return An(this,arguments,function*(){for(var p,m,y,v,b,w;a<r;){o&&(a++,o=!1);let R=yield K(c.processParamsMaybeAddMcpUsage(h)),D=yield K(c.generateContentStreamInternal(R)),I=[],k=[];try{for(var _=!0,C=(m=void 0,wn(D)),T;T=yield K(C.next()),p=T.done,!p;_=!0){v=T.value,_=!1;let N=v;if(yield yield K(N),N.candidates&&(!((b=N.candidates[0])===null||b===void 0)&&b.content)){k.push(N.candidates[0].content);for(let F of(w=N.candidates[0].content.parts)!==null&&w!==void 0?w:[])if(a<r&&F.functionCall){if(!F.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(F.functionCall.name)){let U=yield K(d.get(F.functionCall.name).callTool([F.functionCall]));I.push(...U)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${F.functionCall.name}`)}}}}catch(N){m={error:N}}finally{try{!_&&!p&&(y=C.return)&&(yield K(y.call(C)))}finally{if(m)throw m.error}}if(I.length>0){o=!0;let N=new br;N.candidates=[{content:{role:"user",parts:I}}],yield yield K(N);let F=[];F.push(...k),F.push({role:"user",parts:I});let U=on(h.contents).concat(F);h.contents=U}else break}})}(this,l,e)}async generateContentInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=yT(this.apiClient,e);return a=O("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=ET(d),p=new br;return Object.assign(p,h),p})}else{let c=mT(this.apiClient,e);return a=O("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=vT(d),p=new br;return Object.assign(p,h),p})}}async generateContentStreamInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=yT(this.apiClient,e);return a=O("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),o.then(function(h){return An(this,arguments,function*(){var p,m,y,v;try{for(var b=!0,w=wn(h),_;_=yield K(w.next()),p=_.done,!p;b=!0){v=_.value,b=!1;let C=v,T=ET(yield K(C.json()));T.sdkHttpResponse={headers:C.headers};let R=new br;Object.assign(R,T),yield yield K(R)}}catch(C){m={error:C}}finally{try{!b&&!p&&(y=w.return)&&(yield K(y.call(w)))}finally{if(m)throw m.error}}})})}else{let c=mT(this.apiClient,e);return a=O("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),o.then(function(h){return An(this,arguments,function*(){var p,m,y,v;try{for(var b=!0,w=wn(h),_;_=yield K(w.next()),p=_.done,!p;b=!0){v=_.value,b=!1;let C=v,T=vT(yield K(C.json()));T.sdkHttpResponse={headers:C.headers};let R=new br;Object.assign(R,T),yield yield K(R)}}catch(C){m={error:C}}finally{try{!b&&!p&&(y=w.return)&&(yield K(y.call(w)))}finally{if(m)throw m.error}}})})}}async embedContent(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=gN(this.apiClient,e);return a=O("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=yN(d),p=new zf;return Object.assign(p,h),p})}else{let c=pN(this.apiClient,e);return a=O("{model}:batchEmbedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=mN(d),p=new zf;return Object.assign(p,h),p})}}async generateImagesInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=RN(this.apiClient,e);return a=O("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=DN(d),p=new qf;return Object.assign(p,h),p})}else{let c=xN(this.apiClient,e);return a=O("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=IN(d),p=new qf;return Object.assign(p,h),p})}}async editImageInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=dN(this.apiClient,e);return r=O("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=uN(l),d=new iE;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=RF(this.apiClient,e);return r=O("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=IF(l),d=new sE;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=cF(this.apiClient,e);return r=O("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=dF(l),d=new rE;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=mF(this.apiClient,e);return r=O("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=yF(l),d=new oE;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=YN(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>TE(d))}else{let c=WN(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>CE(d))}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=nF(this.apiClient,e);return a=O("{models_url}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=sF(d),p=new Wf;return Object.assign(p,h),p})}else{let c=tF(this.apiClient,e);return a=O("{models_url}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=iF(d),p=new Wf;return Object.assign(p,h),p})}}async update(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=TF(this.apiClient,e);return a=O("{model}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>TE(d))}else{let c=CF(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>CE(d))}}async delete(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=oN(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=lN(d),p=new Yf;return Object.assign(p,h),p})}else{let c=rN(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=aN(d),p=new Yf;return Object.assign(p,h),p})}}async countTokens(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=nN(this.apiClient,e);return a=O("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=sN(d),p=new Kf;return Object.assign(p,h),p})}else{let c=tN(this.apiClient,e);return a=O("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=iN(d),p=new Kf;return Object.assign(p,h),p})}}async computeTokens(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=Kk(this.apiClient,e);return r=O("{model}:computeTokens",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=Xk(l),d=new aE;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=LN(this.apiClient,e);return a=O("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>{let h=NN(d),p=new Xf;return Object.assign(p,h),p})}else{let c=FN(this.apiClient,e);return a=O("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>{let h=kN(d),p=new Xf;return Object.assign(p,h),p})}}};var FE=class extends Sn{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let s=t.name.split("/operations/")[0],r;n&&"httpOptions"in n&&(r=n.httpOptions);let o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{let s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let s=t.name.split("/operations/")[0],r;n&&"httpOptions"in n&&(r=n.httpOptions);let o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{let s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=MM(e);return a=O("{operationName}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o}else{let c=DM(e);return a=O("{operationName}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o}}async fetchPredictVideosOperationInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=SM(e);return r=O("{resourceName}:fetchPredictOperation",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s}else throw new Error("This method is only supported by the Vertex AI.")}};function mL(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function yL(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>TL(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function vL(i,e,t){let n={},s=f(e,["expireTime"]);t!==void 0&&s!=null&&g(t,["expireTime"],s);let r=f(e,["newSessionExpireTime"]);t!==void 0&&r!=null&&g(t,["newSessionExpireTime"],r);let o=f(e,["uses"]);t!==void 0&&o!=null&&g(t,["uses"],o);let a=f(e,["liveConnectConstraints"]);t!==void 0&&a!=null&&g(t,["bidiGenerateContentSetup"],CL(i,a));let l=f(e,["lockAdditionalFields"]);return t!==void 0&&l!=null&&g(t,["fieldMask"],l),n}function EL(i,e){let t={},n=f(e,["config"]);return n!=null&&g(t,["config"],vL(i,n,t)),t}function bL(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function AL(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function wL(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function SL(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function _L(i,e){let t={},n=f(i,["generationConfig"]);e!==void 0&&n!=null&&g(e,["setup","generationConfig"],n);let s=f(i,["responseModalities"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig","responseModalities"],s);let r=f(i,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);let o=f(i,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);let a=f(i,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);let l=f(i,["maxOutputTokens"]);e!==void 0&&l!=null&&g(e,["setup","generationConfig","maxOutputTokens"],l);let c=f(i,["mediaResolution"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","mediaResolution"],c);let d=f(i,["seed"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","seed"],d);let h=f(i,["speechConfig"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","speechConfig"],ib(h));let p=f(i,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);let m=f(i,["enableAffectiveDialog"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=f(i,["systemInstruction"]);e!==void 0&&y!=null&&g(e,["setup","systemInstruction"],yL(ot(y)));let v=f(i,["tools"]);if(e!==void 0&&v!=null){let D=Sa(v);Array.isArray(D)&&(D=D.map(I=>RL(wa(I)))),g(e,["setup","tools"],D)}let b=f(i,["sessionResumption"]);e!==void 0&&b!=null&&g(e,["setup","sessionResumption"],xL(b));let w=f(i,["inputAudioTranscription"]);e!==void 0&&w!=null&&g(e,["setup","inputAudioTranscription"],w);let _=f(i,["outputAudioTranscription"]);e!==void 0&&_!=null&&g(e,["setup","outputAudioTranscription"],_);let C=f(i,["realtimeInputConfig"]);e!==void 0&&C!=null&&g(e,["setup","realtimeInputConfig"],C);let T=f(i,["contextWindowCompression"]);e!==void 0&&T!=null&&g(e,["setup","contextWindowCompression"],T);let R=f(i,["proactivity"]);if(e!==void 0&&R!=null&&g(e,["setup","proactivity"],R),f(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function CL(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["setup","model"],ce(i,n));let s=f(e,["config"]);return s!=null&&g(t,["config"],_L(s,t)),t}function TL(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],bL(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],AL(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],mL(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function xL(i){let e={},t=f(i,["handle"]);if(t!=null&&g(e,["handle"],t),f(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function RL(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],wL(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],SL(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function IL(i){let e=[];for(let t in i)if(Object.prototype.hasOwnProperty.call(i,t)){let n=i[t];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){let s=Object.keys(n).map(r=>`${t}.${r}`);e.push(...s)}else e.push(t)}return e.join(",")}function DL(i,e){let t=null,n=i.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){let r=n.setup;typeof r=="object"&&r!==null?(i.bidiGenerateContentSetup=r,t=r):delete i.bidiGenerateContentSetup}else n!==void 0&&delete i.bidiGenerateContentSetup;let s=i.fieldMask;if(t){let r=IL(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?i.fieldMask=r:delete i.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&s!==null&&Array.isArray(s)&&s.length>0){let o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],a=[];s.length>0&&(a=s.map(c=>o.includes(c)?`generationConfig.${c}`:c));let l=[];r&&l.push(r),a.length>0&&l.push(...a),l.length>0?i.fieldMask=l.join(","):delete i.fieldMask}else delete i.fieldMask}else s!==null&&Array.isArray(s)&&s.length>0?i.fieldMask=s.join(","):delete i.fieldMask;return i}var LE=class extends Sn{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let a=EL(this.apiClient,e);r=O("auth_tokens",a._url),o=a._query,delete a.config,delete a._url,delete a._query;let l=DL(a,e.config);return s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),s.then(c=>c)}}};function ML(i,e){let t={},n=f(i,["force"]);return e!==void 0&&n!=null&&g(e,["_query","force"],n),t}function PL(i){let e={},t=f(i,["name"]);t!=null&&g(e,["_url","name"],t);let n=f(i,["config"]);return n!=null&&ML(n,e),e}function kL(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","name"],t),e}function NL(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function FL(i){let e={},t=f(i,["parent"]);t!=null&&g(e,["_url","parent"],t);let n=f(i,["config"]);return n!=null&&NL(n,e),e}function LL(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["documents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["documents"],r)}return e}var OE=class extends Sn{constructor(e){super(),this.apiClient=e,this.list=async t=>new xi(Ti.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:t.parent,config:n.config}),await this.listInternal(t),t)}async get(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=kL(e);return r=O("{name}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let o=PL(e);s=O("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=FL(e);return r=O("{parent}/documents",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=LL(l),d=new lE;return Object.assign(d,c),d})}}};var UE=class extends Sn{constructor(e,t=new OE(e)){super(),this.apiClient=e,this.documents=t,this.list=async(n={})=>new xi(Ti.PAGED_ITEM_FILE_SEARCH_STORES,s=>this.listInternal(s),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=LF(e);return r=O("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async get(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=HF(e);return r=O("{name}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let o=UF(e);s=O("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=qF(e);return r=O("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=WF(l),d=new cE;return Object.assign(d,c),d})}}async uploadToFileSearchStoreInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=YF(e);return r=O("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=KF(l),d=new dE;return Object.assign(d,c),d})}}async importFile(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=GF(e);return r=O("{file_search_store_name}:importFile",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=VF(l),d=new uE;return Object.assign(d,c),d})}}};var s0=function(){let{crypto:i}=globalThis;if(i!=null&&i.randomUUID)return s0=i.randomUUID.bind(i),i.randomUUID();let e=new Uint8Array(1),t=i?()=>i.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))},OL=()=>s0();function HE(i){return typeof i=="object"&&i!==null&&("name"in i&&i.name==="AbortError"||"message"in i&&String(i.message).includes("FetchRequestCanceledException"))}var BE=i=>{if(i instanceof Error)return i;if(typeof i=="object"&&i!==null){try{if(Object.prototype.toString.call(i)==="[object Error]"){let e=new Error(i.message,i.cause?{cause:i.cause}:{});return i.stack&&(e.stack=i.stack),i.cause&&!e.cause&&(e.cause=i.cause),i.name&&(e.name=i.name),e}}catch(e){}try{return new Error(JSON.stringify(i))}catch(e){}}return new Error(i)};var Ct=class extends Error{},Tt=class i extends Ct{constructor(e,t,n,s){super(`${i.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,n){let s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new ba({message:n,cause:BE(t)});let r=t;return e===400?new rp(e,r,n,s):e===401?new op(e,r,n,s):e===403?new ap(e,r,n,s):e===404?new lp(e,r,n,s):e===409?new cp(e,r,n,s):e===422?new dp(e,r,n,s):e===429?new up(e,r,n,s):e>=500?new hp(e,r,n,s):new i(e,r,n,s)}},Bc=class extends Tt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},ba=class extends Tt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},sp=class extends ba{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},rp=class extends Tt{},op=class extends Tt{},ap=class extends Tt{},lp=class extends Tt{},cp=class extends Tt{},dp=class extends Tt{},up=class extends Tt{},hp=class extends Tt{};var UL=/^[a-z][a-z0-9+.-]*:/i,HL=i=>UL.test(i),VE=i=>(VE=Array.isArray,VE(i)),BL=VE,VL=BL,CT=VL;function GL(i){if(!i)return!0;for(let e in i)return!1;return!0}function $L(i,e){return Object.prototype.hasOwnProperty.call(i,e)}var zL=(i,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Ct(`${i} must be an integer`);if(e<0)throw new Ct(`${i} must be a positive integer`);return e},qL=i=>{try{return JSON.parse(i)}catch(e){return}};var WL=i=>new Promise(e=>setTimeout(e,i));var ma="0.0.1";function YL(){return typeof Deno!="undefined"&&Deno.build!=null?"deno":typeof EdgeRuntime!="undefined"?"edge":Object.prototype.toString.call(typeof globalThis.process!="undefined"?globalThis.process:0)==="[object process]"?"node":"unknown"}var KL=()=>{var i,e,t,n,s;let r=YL();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ma,"X-Stainless-OS":xT(Deno.build.os),"X-Stainless-Arch":TT(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(i=Deno.version)===null||i===void 0?void 0:i.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ma,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ma,"X-Stainless-OS":xT((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":TT((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(s=globalThis.process.version)!==null&&s!==void 0?s:"unknown"};let o=XL();return o?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ma,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${o.browser}`,"X-Stainless-Runtime-Version":o.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ma,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function XL(){if(typeof navigator=="undefined"||!navigator)return null;let i=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of i){let n=t.exec(navigator.userAgent);if(n){let s=n[1]||0,r=n[2]||0,o=n[3]||0;return{browser:e,version:`${s}.${r}.${o}`}}}return null}var TT=i=>i==="x32"?"x32":i==="x86_64"||i==="x64"?"x64":i==="arm"?"arm":i==="aarch64"||i==="arm64"?"arm64":i?`other:${i}`:"unknown",xT=i=>(i=i.toLowerCase(),i.includes("ios")?"iOS":i==="android"?"Android":i==="darwin"?"MacOS":i==="win32"?"Windows":i==="freebsd"?"FreeBSD":i==="openbsd"?"OpenBSD":i==="linux"?"Linux":i?`Other:${i}`:"Unknown"),Lf,JL=()=>Lf!=null?Lf:Lf=KL();function ZL(){if(typeof fetch!="undefined")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function r0(...i){let e=globalThis.ReadableStream;if(typeof e=="undefined")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...i)}function QL(i){let e=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i[Symbol.iterator]();return r0({start(){},async pull(t){let{done:n,value:s}=await e.next();n?t.close():t.enqueue(s)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function o0(i){if(i[Symbol.asyncIterator])return i;let e=i.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function jL(i){var e,t;if(i===null||typeof i!="object")return;if(i[Symbol.asyncIterator]){await((t=(e=i[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}let n=i.getReader(),s=n.cancel();n.releaseLock(),await s}var e1=({headers:i,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var a0=()=>{var i;if(typeof File=="undefined"){let{process:e}=globalThis,t=typeof((i=e==null?void 0:e.versions)===null||i===void 0?void 0:i.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function jv(i,e,t){return a0(),new File(i,e!=null?e:"unknown_file",t)}function t1(i){return(typeof i=="object"&&i!==null&&("name"in i&&i.name&&String(i.name)||"url"in i&&i.url&&String(i.url)||"filename"in i&&i.filename&&String(i.filename)||"path"in i&&i.path&&String(i.path))||"").split(/[\\/]/).pop()||void 0}var n1=i=>i!=null&&typeof i=="object"&&typeof i[Symbol.asyncIterator]=="function";var l0=i=>i!=null&&typeof i=="object"&&typeof i.size=="number"&&typeof i.type=="string"&&typeof i.text=="function"&&typeof i.slice=="function"&&typeof i.arrayBuffer=="function",i1=i=>i!=null&&typeof i=="object"&&typeof i.name=="string"&&typeof i.lastModified=="number"&&l0(i),s1=i=>i!=null&&typeof i=="object"&&typeof i.url=="string"&&typeof i.blob=="function";async function r1(i,e,t){if(a0(),i=await i,i1(i))return i instanceof File?i:jv([await i.arrayBuffer()],i.name);if(s1(i)){let s=await i.blob();return e||(e=new URL(i.url).pathname.split(/[\\/]/).pop()),jv(await GE(s),e,t)}let n=await GE(i);if(e||(e=t1(i)),!(t!=null&&t.type)){let s=n.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof s=="string"&&(t=Object.assign(Object.assign({},t),{type:s}))}return jv(n,e,t)}async function GE(i){var e,t,n,s,r;let o=[];if(typeof i=="string"||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)o.push(i);else if(l0(i))o.push(i instanceof Blob?i:await i.arrayBuffer());else if(n1(i))try{for(var a=!0,l=wn(i),c;c=await l.next(),e=c.done,!e;a=!0){s=c.value,a=!1;let d=s;o.push(...await GE(d))}}catch(d){t={error:d}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}else{let d=(r=i==null?void 0:i.constructor)===null||r===void 0?void 0:r.name;throw new Error(`Unexpected data type: ${typeof i}${d?`; constructor: ${d}`:""}${o1(i)}`)}return o}function o1(i){return typeof i!="object"||i===null?"":`; props: [${Object.getOwnPropertyNames(i).map(t=>`"${t}"`).join(", ")}]`}var fp=class{constructor(e){this._client=e}};fp._key=[];function c0(i){return i.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var RT=Object.freeze(Object.create(null)),a1=(i=c0)=>function(t,...n){if(t.length===1)return t[0];let s=!1,r=[],o=t.reduce((d,h,p)=>{var m,y,v;/[?#]/.test(h)&&(s=!0);let b=n[p],w=(s?encodeURIComponent:i)(""+b);return p!==n.length&&(b==null||typeof b=="object"&&b.toString===((v=Object.getPrototypeOf((y=Object.getPrototypeOf((m=b.hasOwnProperty)!==null&&m!==void 0?m:RT))!==null&&y!==void 0?y:RT))===null||v===void 0?void 0:v.toString))&&(w=b+"",r.push({start:d.length+h.length,length:w.length,error:`Value of type ${Object.prototype.toString.call(b).slice(8,-1)} is not a valid path parameter`})),d+h+(p===n.length?"":w)},""),a=o.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,c;for(;(c=l.exec(a))!==null;)r.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(r.sort((d,h)=>d.start-h.start),r.length>0){let d=0,h=r.reduce((p,m)=>{let y=" ".repeat(m.start-d),v="^".repeat(m.length);return d=m.start+m.length,p+y+v},"");throw new Ct(`Path parameters result in path with invalid segments:
${r.map(p=>p.error).join(`
`)}
${o}
${h}`)}return o},Of=a1(c0);var pp=class extends fp{create(e,t){var n;let{api_version:s=this._client.apiVersion}=e,r=np(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new Ct("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new Ct("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Of`/${s}/interactions`,Object.assign(Object.assign({body:r},t),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,t={},n){let{api_version:s=this._client.apiVersion}=t!=null?t:{};return this._client.delete(Of`/${s}/interactions/${e}`,n)}cancel(e,t={},n){let{api_version:s=this._client.apiVersion}=t!=null?t:{};return this._client.post(Of`/${s}/interactions/${e}/cancel`,n)}get(e,t={},n){var s;let r=t!=null?t:{},{api_version:o=this._client.apiVersion}=r,a=np(r,["api_version"]);return this._client.get(Of`/${o}/interactions/${e}`,Object.assign(Object.assign({query:a},n),{stream:(s=t==null?void 0:t.stream)!==null&&s!==void 0?s:!1}))}};pp._key=Object.freeze(["interactions"]);var gp=class extends pp{};function l1(i){let e=0;for(let s of i)e+=s.length;let t=new Uint8Array(e),n=0;for(let s of i)t.set(s,n),n+=s.length;return t}var Uf;function sb(i){let e;return(Uf!=null?Uf:(e=new globalThis.TextEncoder,Uf=e.encode.bind(e)))(i)}var Hf;function IT(i){let e;return(Hf!=null?Hf:(e=new globalThis.TextDecoder,Hf=e.decode.bind(e)))(i)}var Aa=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?sb(e):e;this.buffer=l1([this.buffer,t]);let n=[],s;for(;(s=c1(this.buffer,this.carriageReturnIndex))!=null;){if(s.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=s.index;continue}if(this.carriageReturnIndex!=null&&(s.index!==this.carriageReturnIndex+1||s.carriage)){n.push(IT(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let r=this.carriageReturnIndex!==null?s.preceding-1:s.preceding,o=IT(this.buffer.subarray(0,r));n.push(o),this.buffer=this.buffer.subarray(s.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}};Aa.NEWLINE_CHARS=new Set([`
`,"\r"]);Aa.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function c1(i,e){for(let s=e!=null?e:0;s<i.length;s++){if(i[s]===10)return{preceding:s,index:s+1,carriage:!1};if(i[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function d1(i){for(let n=0;n<i.length-1;n++){if(i[n]===10&&i[n+1]===10||i[n]===13&&i[n+1]===13)return n+2;if(i[n]===13&&i[n+1]===10&&n+3<i.length&&i[n+2]===13&&i[n+3]===10)return n+4}return-1}var mp={off:0,error:200,warn:300,info:400,debug:500},DT=(i,e,t)=>{if(i){if($L(mp,i))return i;Et(t).warn(`${e} was set to ${JSON.stringify(i)}, expected one of ${JSON.stringify(Object.keys(mp))}`)}};function Uc(){}function Bf(i,e,t){return!e||mp[i]>mp[t]?Uc:e[i].bind(e)}var u1={error:Uc,warn:Uc,info:Uc,debug:Uc},MT=new WeakMap;function Et(i){var e;let t=i.logger,n=(e=i.logLevel)!==null&&e!==void 0?e:"off";if(!t)return u1;let s=MT.get(t);if(s&&s[0]===n)return s[1];let r={error:Bf("error",t,n),warn:Bf("warn",t,n),info:Bf("info",t,n),debug:Bf("debug",t,n)};return MT.set(t,[n,r]),r}var Er=i=>(i.options&&(i.options=Object.assign({},i.options),delete i.options.headers),i.headers&&(i.headers=Object.fromEntries((i.headers instanceof Headers?[...i.headers]:Object.entries(i.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in i&&(i.retryOfRequestLogID&&(i.retryOf=i.retryOfRequestLogID),delete i.retryOfRequestLogID),i);var $E=class i{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let s=!1,r=n?Et(n):console;function o(){return An(this,arguments,function*(){var l,c,d,h;if(s)throw new Ct("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let p=!1;try{try{for(var m=!0,y=wn(h1(e,t)),v;v=yield K(y.next()),l=v.done,!l;m=!0){h=v.value,m=!1;let b=h;if(!p)if(b.data.startsWith("[DONE]")){p=!0;continue}else try{yield yield K(JSON.parse(b.data))}catch(w){throw r.error("Could not parse message into JSON:",b.data),r.error("From chunk:",b.raw),w}}}catch(b){c={error:b}}finally{try{!m&&!l&&(d=y.return)&&(yield K(d.call(y)))}finally{if(c)throw c.error}}p=!0}catch(b){if(HE(b))return yield K(void 0);throw b}finally{p||t.abort()}})}return new i(o,t,n)}static fromReadableStream(e,t,n){let s=!1;function r(){return An(this,arguments,function*(){var l,c,d,h;let p=new Aa,m=o0(e);try{for(var y=!0,v=wn(m),b;b=yield K(v.next()),l=b.done,!l;y=!0){h=b.value,y=!1;let w=h;for(let _ of p.decode(w))yield yield K(_)}}catch(w){c={error:w}}finally{try{!y&&!l&&(d=v.return)&&(yield K(d.call(v)))}finally{if(c)throw c.error}}for(let w of p.flush())yield yield K(w)})}function o(){return An(this,arguments,function*(){var l,c,d,h;if(s)throw new Ct("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let p=!1;try{try{for(var m=!0,y=wn(r()),v;v=yield K(y.next()),l=v.done,!l;m=!0){h=v.value,m=!1;let b=h;p||b&&(yield yield K(JSON.parse(b)))}}catch(b){c={error:b}}finally{try{!m&&!l&&(d=y.return)&&(yield K(d.call(y)))}finally{if(c)throw c.error}}p=!0}catch(b){if(HE(b))return yield K(void 0);throw b}finally{p||t.abort()}})}return new i(o,t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),s=r=>({next:()=>{if(r.length===0){let o=n.next();e.push(o),t.push(o)}return r.shift()}});return[new i(()=>s(e),this.controller,this.client),new i(()=>s(t),this.controller,this.client)]}toReadableStream(){let e=this,t;return r0({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:s,done:r}=await t.next();if(r)return n.close();let o=sb(JSON.stringify(s)+`
`);n.enqueue(o)}catch(s){n.error(s)}},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}};function h1(i,e){return An(this,arguments,function*(){var n,s,r,o;if(!i.body)throw e.abort(),typeof globalThis.navigator!="undefined"&&globalThis.navigator.product==="ReactNative"?new Ct("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Ct("Attempted to iterate over a response with no body");let a=new zE,l=new Aa,c=o0(i.body);try{for(var d=!0,h=wn(f1(c)),p;p=yield K(h.next()),n=p.done,!n;d=!0){o=p.value,d=!1;let m=o;for(let y of l.decode(m)){let v=a.decode(y);v&&(yield yield K(v))}}}catch(m){s={error:m}}finally{try{!d&&!n&&(r=h.return)&&(yield K(r.call(h)))}finally{if(s)throw s.error}}for(let m of l.flush()){let y=a.decode(m);y&&(yield yield K(y))}})}function f1(i){return An(this,arguments,function*(){var t,n,s,r;let o=new Uint8Array;try{for(var a=!0,l=wn(i),c;c=yield K(l.next()),t=c.done,!t;a=!0){r=c.value,a=!1;let d=r;if(d==null)continue;let h=d instanceof ArrayBuffer?new Uint8Array(d):typeof d=="string"?sb(d):d,p=new Uint8Array(o.length+h.length);p.set(o),p.set(h,o.length),o=p;let m;for(;(m=d1(o))!==-1;)yield yield K(o.slice(0,m)),o=o.slice(m)}}catch(d){n={error:d}}finally{try{!a&&!t&&(s=l.return)&&(yield K(s.call(l)))}finally{if(n)throw n.error}}o.length>0&&(yield yield K(o))})}var zE=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=p1(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function p1(i,e){let t=i.indexOf(e);return t!==-1?[i.substring(0,t),e,i.substring(t+e.length)]:[i,"",""]}async function g1(i,e){let{response:t,requestLogID:n,retryOfRequestLogID:s,startTime:r}=e,o=await(async()=>{var a;if(e.options.stream)return Et(i).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,i):$E.fromSSEResponse(t,e.controller,i);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let l=t.headers.get("content-type"),c=(a=l==null?void 0:l.split(";")[0])===null||a===void 0?void 0:a.trim();return(c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))?await t.json():await t.text()})();return Et(i).debug(`[${n}] response parsed`,Er({retryOfRequestLogID:s,url:t.url,status:t.status,body:o,durationMs:Date.now()-r})),o}var qE=class i extends Promise{constructor(e,t,n=g1){super(s=>{s(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new i(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var d0=Symbol("brand.privateNullableHeaders");function*m1(i){if(!i)return;if(d0 in i){let{values:n,nulls:s}=i;yield*n.entries();for(let r of s)yield[r,null];return}let e=!1,t;i instanceof Headers?t=i.entries():CT(i)?t=i:(e=!0,t=Object.entries(i!=null?i:{}));for(let n of t){let s=n[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");let r=CT(n[1])?n[1]:[n[1]],o=!1;for(let a of r)a!==void 0&&(e&&!o&&(o=!0,yield[s,null]),yield[s,a])}}var Oc=i=>{let e=new Headers,t=new Set;for(let n of i){let s=new Set;for(let[r,o]of m1(n)){let a=r.toLowerCase();s.has(a)||(e.delete(r),s.add(a)),o===null?(e.delete(r),t.add(a)):(e.append(r,o),t.delete(a))}}return{[d0]:!0,values:e,nulls:t}};var eE=i=>{var e,t,n,s,r,o;if(typeof globalThis.process!="undefined")return(n=(t=(e=globalThis.process.env)===null||e===void 0?void 0:e[i])===null||t===void 0?void 0:t.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno!="undefined")return(o=(r=(s=globalThis.Deno.env)===null||s===void 0?void 0:s.get)===null||r===void 0?void 0:r.call(s,i))===null||o===void 0?void 0:o.trim()};var u0,yp=class i{constructor(e){var t,n,s,r,o,a,l,{baseURL:c=eE("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:d=(t=eE("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:h="v1beta"}=e,p=np(e,["baseURL","apiKey","apiVersion"]);let m=Object.assign(Object.assign({apiKey:d,apiVersion:h},p),{baseURL:c||"https://generativelanguage.googleapis.com"});this.baseURL=m.baseURL,this.timeout=(n=m.timeout)!==null&&n!==void 0?n:i.DEFAULT_TIMEOUT,this.logger=(s=m.logger)!==null&&s!==void 0?s:console;let y="warn";this.logLevel=y,this.logLevel=(o=(r=DT(m.logLevel,"ClientOptions.logLevel",this))!==null&&r!==void 0?r:DT(eE("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&o!==void 0?o:y,this.fetchOptions=m.fetchOptions,this.maxRetries=(a=m.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(l=m.fetch)!==null&&l!==void 0?l:ZL(),this.encoder=e1,this._options=m,this.apiKey=d,this.apiVersion=h,this.clientAdapter=m.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){let t=Oc([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return Oc([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Oc([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n!="undefined").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new Ct(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${ma}`}defaultIdempotencyKey(){return`stainless-node-retry-${OL()}`}makeStatusError(e,t,n,s){return Tt.generate(e,t,n,s)}buildURL(e,t,n){let s=!this.baseURLOverridden()&&n||this.baseURL,r=HL(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return GL(o)||(t=Object.assign(Object.assign({},o),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(s=>Object.assign({method:e,path:t},s)))}request(e,t=null){return new qE(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var s,r,o;let a=await e,l=(s=a.maxRetries)!==null&&s!==void 0?s:this.maxRetries;t==null&&(t=l),await this.prepareOptions(a);let{req:c,url:d,timeout:h}=await this.buildRequest(a,{retryCount:l-t});await this.prepareRequest(c,{url:d,options:a});let p="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),m=n===void 0?"":`, retryOf: ${n}`,y=Date.now();if(Et(this).debug(`[${p}] sending request`,Er({retryOfRequestLogID:n,method:a.method,url:d,options:a,headers:c.headers})),!((r=a.signal)===null||r===void 0)&&r.aborted)throw new Bc;let v=new AbortController,b=await this.fetchWithTimeout(d,c,h,v).catch(BE),w=Date.now();if(b instanceof globalThis.Error){let C=`retrying, ${t} attempts remaining`;if(!((o=a.signal)===null||o===void 0)&&o.aborted)throw new Bc;let T=HE(b)||/timed? ?out/i.test(String(b)+("cause"in b?String(b.cause):""));if(t)return Et(this).info(`[${p}] connection ${T?"timed out":"failed"} - ${C}`),Et(this).debug(`[${p}] connection ${T?"timed out":"failed"} (${C})`,Er({retryOfRequestLogID:n,url:d,durationMs:w-y,message:b.message})),this.retryRequest(a,t,n!=null?n:p);throw Et(this).info(`[${p}] connection ${T?"timed out":"failed"} - error; no more retries left`),Et(this).debug(`[${p}] connection ${T?"timed out":"failed"} (error; no more retries left)`,Er({retryOfRequestLogID:n,url:d,durationMs:w-y,message:b.message})),T?new sp:new ba({cause:b})}let _=`[${p}${m}] ${c.method} ${d} ${b.ok?"succeeded":"failed"} with status ${b.status} in ${w-y}ms`;if(!b.ok){let C=await this.shouldRetry(b);if(t&&C){let N=`retrying, ${t} attempts remaining`;return await jL(b.body),Et(this).info(`${_} - ${N}`),Et(this).debug(`[${p}] response error (${N})`,Er({retryOfRequestLogID:n,url:b.url,status:b.status,headers:b.headers,durationMs:w-y})),this.retryRequest(a,t,n!=null?n:p,b.headers)}let T=C?"error; no more retries left":"error; not retryable";Et(this).info(`${_} - ${T}`);let R=await b.text().catch(N=>BE(N).message),D=qL(R),I=D?void 0:R;throw Et(this).debug(`[${p}] response error (${T})`,Er({retryOfRequestLogID:n,url:b.url,status:b.status,headers:b.headers,message:I,durationMs:Date.now()-y})),this.makeStatusError(b.status,D,I,b.headers)}return Et(this).info(_),Et(this).debug(`[${p}] response start`,Er({retryOfRequestLogID:n,url:b.url,status:b.status,headers:b.headers,durationMs:w-y})),{response:b,options:a,controller:v,requestLogID:p,retryOfRequestLogID:n,startTime:y}}async fetchWithTimeout(e,t,n,s){let r=t||{},{signal:o,method:a}=r,l=np(r,["signal","method"]);o&&o.addEventListener("abort",()=>s.abort());let c=setTimeout(()=>s.abort(),n),d=globalThis.ReadableStream&&l.body instanceof globalThis.ReadableStream||typeof l.body=="object"&&l.body!==null&&Symbol.asyncIterator in l.body,h=Object.assign(Object.assign(Object.assign({signal:s.signal},d?{duplex:"half"}:{}),{method:"GET"}),l);a&&(h.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,h)}finally{clearTimeout(c)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,s){var r;let o,a=s==null?void 0:s.get("retry-after-ms");if(a){let c=parseFloat(a);Number.isNaN(c)||(o=c)}let l=s==null?void 0:s.get("retry-after");if(l&&!o){let c=parseFloat(l);Number.isNaN(c)?o=Date.parse(l)-Date.now():o=c*1e3}if(!(o&&0<=o&&o<60*1e3)){let c=(r=e.maxRetries)!==null&&r!==void 0?r:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,c)}return await WL(o),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let r=t-e,o=Math.min(.5*Math.pow(2,r),8),a=1-Math.random()*.25;return o*a*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,s,r;let o=Object.assign({},e),{method:a,path:l,query:c,defaultBaseURL:d}=o,h=this.buildURL(l,c,d);"timeout"in o&&zL("timeout",o.timeout),o.timeout=(n=o.timeout)!==null&&n!==void 0?n:this.timeout;let{bodyHeaders:p,body:m}=this.buildBody({options:o}),y=await this.buildHeaders({options:e,method:a,bodyHeaders:p,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:y},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&m instanceof globalThis.ReadableStream&&{duplex:"half"}),m&&{body:m}),(s=this.fetchOptions)!==null&&s!==void 0?s:{}),(r=o.fetchOptions)!==null&&r!==void 0?r:{}),url:h,timeout:o.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:s}){let r={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let o=await this.authHeaders(e),a=Oc([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),JL()),this._options.defaultHeaders,n,e.headers,o]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=Oc([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:QL(e)}:this.encoder({body:e,headers:n})}};yp.DEFAULT_TIMEOUT=6e4;var Me=class extends yp{constructor(){super(...arguments),this.interactions=new gp(this)}};u0=Me;Me.GeminiNextGenAPIClient=u0;Me.GeminiNextGenAPIClientError=Ct;Me.APIError=Tt;Me.APIConnectionError=ba;Me.APIConnectionTimeoutError=sp;Me.APIUserAbortError=Bc;Me.NotFoundError=lp;Me.ConflictError=cp;Me.RateLimitError=up;Me.BadRequestError=rp;Me.AuthenticationError=op;Me.InternalServerError=hp;Me.PermissionDeniedError=ap;Me.UnprocessableEntityError=dp;Me.toFile=r1;Me.Interactions=gp;function y1(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function v1(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function E1(i,e){let t={},n=f(i,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function b1(i,e){let t={},n=f(i,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function A1(i,e,t){let n={};if(f(i,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let s=f(i,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&g(e,["displayName"],s),f(i,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let r=f(i,["epochCount"]);e!==void 0&&r!=null&&g(e,["tuningTask","hyperparameters","epochCount"],r);let o=f(i,["learningRateMultiplier"]);if(o!=null&&g(n,["tuningTask","hyperparameters","learningRateMultiplier"],o),f(i,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(f(i,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(f(i,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let a=f(i,["batchSize"]);e!==void 0&&a!=null&&g(e,["tuningTask","hyperparameters","batchSize"],a);let l=f(i,["learningRate"]);if(e!==void 0&&l!=null&&g(e,["tuningTask","hyperparameters","learningRate"],l),f(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(f(i,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function w1(i,e,t){let n={},s=f(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){let m=f(i,["validationDataset"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec"],PT(m))}else if(s==="PREFERENCE_TUNING"){let m=f(i,["validationDataset"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec"],PT(m))}let r=f(i,["tunedModelDisplayName"]);e!==void 0&&r!=null&&g(e,["tunedModelDisplayName"],r);let o=f(i,["description"]);e!==void 0&&o!=null&&g(e,["description"],o);let a=f(t,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){let m=f(i,["epochCount"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","hyperParameters","epochCount"],m)}else if(a==="PREFERENCE_TUNING"){let m=f(i,["epochCount"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],m)}let l=f(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){let m=f(i,["learningRateMultiplier"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],m)}else if(l==="PREFERENCE_TUNING"){let m=f(i,["learningRateMultiplier"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],m)}let c=f(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){let m=f(i,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","exportLastCheckpointOnly"],m)}else if(c==="PREFERENCE_TUNING"){let m=f(i,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],m)}let d=f(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){let m=f(i,["adapterSize"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","hyperParameters","adapterSize"],m)}else if(d==="PREFERENCE_TUNING"){let m=f(i,["adapterSize"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],m)}if(f(i,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(f(i,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let h=f(i,["labels"]);e!==void 0&&h!=null&&g(e,["labels"],h);let p=f(i,["beta"]);return e!==void 0&&p!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","beta"],p),n}function S1(i,e){let t={},n=f(i,["baseModel"]);n!=null&&g(t,["baseModel"],n);let s=f(i,["preTunedModel"]);s!=null&&g(t,["preTunedModel"],s);let r=f(i,["trainingDataset"]);r!=null&&N1(r);let o=f(i,["config"]);return o!=null&&A1(o,t),t}function _1(i,e){let t={},n=f(i,["baseModel"]);n!=null&&g(t,["baseModel"],n);let s=f(i,["preTunedModel"]);s!=null&&g(t,["preTunedModel"],s);let r=f(i,["trainingDataset"]);r!=null&&F1(r,t,e);let o=f(i,["config"]);return o!=null&&w1(o,t,e),t}function C1(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function T1(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function x1(i,e,t){let n={},s=f(i,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);let r=f(i,["pageToken"]);e!==void 0&&r!=null&&g(e,["_query","pageToken"],r);let o=f(i,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),n}function R1(i,e,t){let n={},s=f(i,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);let r=f(i,["pageToken"]);e!==void 0&&r!=null&&g(e,["_query","pageToken"],r);let o=f(i,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),n}function I1(i,e){let t={},n=f(i,["config"]);return n!=null&&x1(n,t),t}function D1(i,e){let t={},n=f(i,["config"]);return n!=null&&R1(n,t),t}function M1(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["nextPageToken"]);s!=null&&g(t,["nextPageToken"],s);let r=f(i,["tunedModels"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>h0(a))),g(t,["tuningJobs"],o)}return t}function P1(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["nextPageToken"]);s!=null&&g(t,["nextPageToken"],s);let r=f(i,["tuningJobs"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>WE(a))),g(t,["tuningJobs"],o)}return t}function k1(i,e){let t={},n=f(i,["name"]);n!=null&&g(t,["model"],n);let s=f(i,["name"]);return s!=null&&g(t,["endpoint"],s),t}function N1(i,e){let t={};if(f(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(i,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=f(i,["examples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),g(t,["examples","examples"],s)}return t}function F1(i,e,t){let n={},s=f(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){let o=f(i,["gcsUri"]);e!==void 0&&o!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(s==="PREFERENCE_TUNING"){let o=f(i,["gcsUri"]);e!==void 0&&o!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}let r=f(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){let o=f(i,["vertexDatasetResource"]);e!==void 0&&o!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(r==="PREFERENCE_TUNING"){let o=f(i,["vertexDatasetResource"]);e!==void 0&&o!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}if(f(i,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function h0(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["name"]);s!=null&&g(t,["name"],s);let r=f(i,["state"]);r!=null&&g(t,["state"],BT(r));let o=f(i,["createTime"]);o!=null&&g(t,["createTime"],o);let a=f(i,["tuningTask","startTime"]);a!=null&&g(t,["startTime"],a);let l=f(i,["tuningTask","completeTime"]);l!=null&&g(t,["endTime"],l);let c=f(i,["updateTime"]);c!=null&&g(t,["updateTime"],c);let d=f(i,["description"]);d!=null&&g(t,["description"],d);let h=f(i,["baseModel"]);h!=null&&g(t,["baseModel"],h);let p=f(i,["_self"]);return p!=null&&g(t,["tunedModel"],k1(p)),t}function WE(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["name"]);s!=null&&g(t,["name"],s);let r=f(i,["state"]);r!=null&&g(t,["state"],BT(r));let o=f(i,["createTime"]);o!=null&&g(t,["createTime"],o);let a=f(i,["startTime"]);a!=null&&g(t,["startTime"],a);let l=f(i,["endTime"]);l!=null&&g(t,["endTime"],l);let c=f(i,["updateTime"]);c!=null&&g(t,["updateTime"],c);let d=f(i,["error"]);d!=null&&g(t,["error"],d);let h=f(i,["description"]);h!=null&&g(t,["description"],h);let p=f(i,["baseModel"]);p!=null&&g(t,["baseModel"],p);let m=f(i,["tunedModel"]);m!=null&&g(t,["tunedModel"],m);let y=f(i,["preTunedModel"]);y!=null&&g(t,["preTunedModel"],y);let v=f(i,["supervisedTuningSpec"]);v!=null&&g(t,["supervisedTuningSpec"],v);let b=f(i,["preferenceOptimizationSpec"]);b!=null&&g(t,["preferenceOptimizationSpec"],b);let w=f(i,["tuningDataStats"]);w!=null&&g(t,["tuningDataStats"],w);let _=f(i,["encryptionSpec"]);_!=null&&g(t,["encryptionSpec"],_);let C=f(i,["partnerModelTuningSpec"]);C!=null&&g(t,["partnerModelTuningSpec"],C);let T=f(i,["customBaseModel"]);T!=null&&g(t,["customBaseModel"],T);let R=f(i,["experiment"]);R!=null&&g(t,["experiment"],R);let D=f(i,["labels"]);D!=null&&g(t,["labels"],D);let I=f(i,["outputUri"]);I!=null&&g(t,["outputUri"],I);let k=f(i,["pipelineJob"]);k!=null&&g(t,["pipelineJob"],k);let N=f(i,["serviceAccount"]);N!=null&&g(t,["serviceAccount"],N);let F=f(i,["tunedModelDisplayName"]);F!=null&&g(t,["tunedModelDisplayName"],F);let U=f(i,["veoTuningSpec"]);return U!=null&&g(t,["veoTuningSpec"],U),t}function L1(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["name"]);s!=null&&g(t,["name"],s);let r=f(i,["metadata"]);r!=null&&g(t,["metadata"],r);let o=f(i,["done"]);o!=null&&g(t,["done"],o);let a=f(i,["error"]);return a!=null&&g(t,["error"],a),t}function PT(i,e){let t={},n=f(i,["gcsUri"]);n!=null&&g(t,["validationDatasetUri"],n);let s=f(i,["vertexDatasetResource"]);return s!=null&&g(t,["validationDatasetUri"],s),t}var YE=class extends Sn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new xi(Ti.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var n;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let s={tunedModelName:t.baseModel};!((n=t.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(s.checkpointId=t.config.preTunedModelCheckpointId);let r=Object.assign(Object.assign({},t),{preTunedModel:s});return r.baseModel=void 0,await this.tuneInternal(r)}else{let s=Object.assign({},t);return await this.tuneInternal(s)}else{let s=Object.assign({},t),r=await this.tuneMldevInternal(s),o="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?o=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(o=r.name.split("/operations/")[0]),{name:o,state:nE.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=T1(e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>WE(d))}else{let c=C1(e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>h0(d))}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=D1(e);return a=O("tuningJobs",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=P1(d),p=new Jf;return Object.assign(p,h),p})}else{let c=I1(e);return a=O("tunedModels",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=M1(d),p=new Jf;return Object.assign(p,h),p})}}async cancel(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=v1(e);return a=O("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=b1(d),p=new Zf;return Object.assign(p,h),p})}else{let c=y1(e);return a=O("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=E1(d),p=new Zf;return Object.assign(p,h),p})}}async tuneInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=_1(e,e);return r=O("tuningJobs",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>WE(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=S1(e);return r=O("tunedModels",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>L1(l))}}};var KE=class{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},O1=1024*1024*8,U1=3,H1=1e3,B1=2,vp="x-goog-upload-status";async function V1(i,e,t){var n;let s=await f0(i,e,t),r=await(s==null?void 0:s.json());if(((n=s==null?void 0:s.headers)===null||n===void 0?void 0:n[vp])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function G1(i,e,t){var n;let s=await f0(i,e,t),r=await(s==null?void 0:s.json());if(((n=s==null?void 0:s.headers)===null||n===void 0?void 0:n[vp])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let o=NT(r),a=new yE;return Object.assign(a,o),a}async function f0(i,e,t){var n,s;let r=0,o=0,a=new Hc(new Response),l="upload";for(r=i.size;o<r;){let c=Math.min(O1,r-o),d=i.slice(o,o+c);o+c>=r&&(l+=", finalize");let h=0,p=H1;for(;h<U1&&(a=await t.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(o),"Content-Length":String(c)}}}),!(!((n=a==null?void 0:a.headers)===null||n===void 0)&&n[vp]));)h++,await z1(p),p=p*B1;if(o+=c,((s=a==null?void 0:a.headers)===null||s===void 0?void 0:s[vp])!=="active")break;if(r<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function $1(i){return{size:i.size,type:i.type}}function z1(i){return new Promise(e=>setTimeout(e,i))}var XE=class{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await V1(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await G1(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await $1(e)}};var JE=class{create(e,t,n){return new ZE(e,t,n)}},ZE=class{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var kT="x-goog-api-key",QE=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(kT)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(kT,this.apiKey)}}};var q1="gl-node/",Ep=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e!=null&&e.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new Me({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e==null?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;let n=AM(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let s=new QE(this.apiKey);this.apiClient=new RE({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:q1+"web",uploader:new XE,downloader:new KE}),this.models=new NE(this.apiClient),this.live=new PE(this.apiClient,s,new JE),this.batches=new bE(this.apiClient),this.chats=new wE(this.models,this.apiClient),this.caches=new AE(this.apiClient),this.files=new _E(this.apiClient),this.operations=new FE(this.apiClient),this.authTokens=new LE(this.apiClient),this.tunings=new YE(this.apiClient),this.fileSearchStores=new UE(this.apiClient)}};var p0=`\uB108\uB294 \uB098\uC758 \uAC1C\uC778 \uC9C0\uC2DD\uAD00\uB9AC \uC2DC\uC2A4\uD15C\uC5D0\uC11C \uB178\uD2B8\uB97C \uD504\uB85C\uC81D\uD2B8\uBCC4\uB85C \uBD84\uB958\uD558\uB294 \uBE44\uC11C\uB2E4.
\uC544\uB798 \uB178\uD2B8 \uB0B4\uC6A9\uC744 \uC77D\uACE0 \uC5B4\uB5A4 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC18D\uD558\uB294\uC9C0 **\uC2E0\uC911\uD558\uAC8C** \uD310\uB2E8\uD574\uB77C.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uBD84\uB958 \uADDC\uCE59 (\uC911\uC694\uB3C4 \uC21C)

### 1. \uD504\uB85C\uC81D\uD2B8 \uC0B0\uCD9C\uBB3C (contentType: "artifact")
\uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC9C1\uC811 \uC800\uC7A5\uD574\uC57C \uD560 \uAC83:
- \uC9C1\uC811 \uC791\uC131\uD55C \uBB38\uC11C, \uACC4\uD68D\uC11C, \uD68C\uC758\uB85D
- \uD504\uB85C\uC81D\uD2B8\uB97C \uC704\uD574 \uB9CC\uB4E0 \uCF54\uB4DC, \uC124\uACC4\uC11C
- \uD504\uB85C\uC81D\uD2B8 \uC9C4\uD589 \uAD00\uB828 \uBA54\uBAA8

### 2. \uD504\uB85C\uC81D\uD2B8 \uCC38\uACE0\uC790\uB8CC (contentType: "reference")
Library\uC5D0 \uC800\uC7A5\uD558\uB418 \uD504\uB85C\uC81D\uD2B8\uC640 \uB9C1\uD06C\uD574\uC57C \uD560 \uAC83:
- \uC678\uBD80 \uD29C\uD1A0\uB9AC\uC5BC, \uC608\uC81C \uCF54\uB4DC, \uBB38\uC11C
- \uC6F9\uD398\uC774\uC9C0 \uC2A4\uD06C\uB7A9, \uC544\uD2F0\uD074
- \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uC790\uB8CC
- \uC608: "ESP32 \uC608\uC81C" \u2192 \uD30C\uCE20\uD31C\uC5D0 \uC720\uC6A9\uD558\uC9C0\uB9CC Library\uC5D0 \uC800\uC7A5

### 3. \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC (targetType: "library", contentType: "general")
- \uD2B9\uC815 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828 \uC5C6\uB294 \uC77C\uBC18 \uC815\uBCF4
- \uB274\uC2A4, \uACF5\uACE0, \uC77C\uBC18 \uC544\uD2F0\uD074

### 4. archive
- \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83

## \uD310\uB2E8 \uAE30\uC900
- "\uC774\uAC74 \uB0B4\uAC00 \uC9C1\uC811 \uB9CC\uB4E0 \uC0B0\uCD9C\uBB3C\uC778\uAC00?" \u2192 artifact
- "\uC774\uAC74 \uC678\uBD80 \uC790\uB8CC\uC778\uB370 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC720\uC6A9\uD55C\uAC00?" \u2192 reference
- "\uC774\uAC74 \uADF8\uB0E5 \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC\uC778\uAC00?" \u2192 general
- "\uD504\uB85C\uC81D\uD2B8 \uB05D\uB098\uB3C4 \uACC4\uC18D \uCC38\uACE0\uD560 \uC790\uB8CC\uC778\uAC00?" \u2192 reference (Library)

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "targetType": "project \uB610\uB294 library \uB610\uB294 archive",
  "contentType": "artifact \uB610\uB294 reference \uB610\uB294 general",
  "projectName": "\uD504\uB85C\uC81D\uD2B8\uBA85 (project \uB610\uB294 reference\uC77C \uB54C)",
  "isNewProject": true/false,
  "confidence": "high \uB610\uB294 medium \uB610\uB294 low",
  "reason": "\uC774 \uBD84\uB958\uB97C \uC120\uD0DD\uD55C \uC774\uC720 (1\uC904)",
  "title": "\uB178\uD2B8 \uC81C\uBAA9",
  "summary": "2-3\uBB38\uC7A5 \uC694\uC57D",
  "nextAction": "\uB2E4\uC74C \uD589\uB3D9 \uB610\uB294 null"
}
`,g0=`\uB108\uB294 \uC81C\uD154\uCE74\uC2A4\uD150(Zettelkasten) \uBC29\uC2DD\uC758 \uC601\uAD6C \uB178\uD2B8\uB97C \uB9CC\uB4DC\uB294 \uBE44\uC11C\uB2E4.
\uC544\uB798 \uB178\uD2B8\uC5D0\uC11C \uC81C\uD154\uCE74\uC2A4\uD150\uC6A9 \uC601\uAD6C \uB178\uD2B8 \uD6C4\uBCF4 \uC544\uC774\uB514\uC5B4\uB4E4\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uD55C \uB178\uD2B8\uC5D0\uB294 \uD558\uB098\uC758 \uC544\uC774\uB514\uC5B4\uB9CC \uB2F4\uB294\uB2E4 (atomic note)
- \uAC01 \uC544\uC774\uB514\uC5B4\uB294 3-5\uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD55C\uB2E4
- \uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C
- \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC5F0\uACB0\uB420 \uC218 \uC788\uB294 \uAC1C\uB150 2-3\uAC1C\uB97C \uC81C\uC548\uD574\uB77C
- \uC544\uC774\uB514\uC5B4\uB9C8\uB2E4 \uC5F0\uAD00 \uD0A4\uC6CC\uB4DC\uB97C \uD568\uAED8 \uC801\uC5B4\uB77C

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uC544\uC774\uB514\uC5B4\uB97C \uD55C \uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD558\uB294 \uC81C\uBAA9",
    "body": "3-5\uBB38\uC7A5\uC758 \uC124\uBA85",
    "importance": "\uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uAC00? (1\uC904)",
    "relatedConcepts": ["\uAC1C\uB1501", "\uAC1C\uB1502", "\uAC1C\uB1503"],
    "keywords": ["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3"]
  }
]

\uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uC744 \uBC18\uD658\uD574\uB77C.
`,m0=`\uB108\uB294 \uB098\uC758 \uC791\uC5C5 \uC6B0\uC120\uC21C\uC704 \uCF54\uCE58\uB2E4.
\uC544\uB798 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D\uC744 \uBCF4\uACE0, \uC9C0\uAE08 \uB0B4\uAC00 \uC9D1\uC911\uD574\uC57C \uD560 \uC0C1\uC704 3\uAC1C\uB9CC \uACE8\uB77C\uB77C.

## \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uAC01 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uB300\uD574 \uB2E4\uC74C\uC744 \uC81C\uACF5\uD574\uB77C
- title: \uD504\uB85C\uC81D\uD2B8 \uC774\uB984
- why: \uC65C \uC9C0\uAE08 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904 \uC124\uBA85
- next_action: \uC624\uB298 \uB2F9\uC7A5 \uD560 \uC218 \uC788\uB294 \uAC00\uC7A5 \uC791\uC740 \uB2E4\uC74C \uD589\uB3D9

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uD504\uB85C\uC81D\uD2B8 \uC774\uB984",
    "why": "\uC911\uC694\uD55C \uC774\uC720",
    "next_action": "\uB2E4\uC74C \uD589\uB3D9"
  }
]
`,y0=`\uC774 \uC774\uBBF8\uC9C0\uC5D0\uC11C \uD14D\uC2A4\uD2B8\uB97C \uCD94\uCD9C\uD574\uB77C.
\uC190\uAE00\uC528, \uC778\uC1C4\uBB3C, \uC2A4\uCE94 \uBB38\uC11C \uB4F1 \uBAA8\uB4E0 \uD615\uD0DC\uC758 \uD14D\uC2A4\uD2B8\uB97C \uC77D\uC5B4\uB77C.

## \uADDC\uCE59
- \uC774\uBBF8\uC9C0\uC5D0 \uBCF4\uC774\uB294 \uBAA8\uB4E0 \uD14D\uC2A4\uD2B8\uB97C \uADF8\uB300\uB85C \uCD94\uCD9C
- \uC6D0\uBCF8\uC758 \uC904\uBC14\uAFC8\uACFC \uAD6C\uC870\uB97C \uCD5C\uB300\uD55C \uC720\uC9C0
- \uD45C\uAC00 \uC788\uC73C\uBA74 \uB9C8\uD06C\uB2E4\uC6B4 \uD45C\uB85C \uBCC0\uD658
- \uC77D\uC744 \uC218 \uC5C6\uB294 \uBD80\uBD84\uC740 [\uBD88\uBA85\uD655] \uC73C\uB85C \uD45C\uC2DC
- \uD14D\uC2A4\uD2B8\uB9CC \uCD9C\uB825\uD558\uACE0 \uB2E4\uB978 \uC124\uBA85\uC740 \uD558\uC9C0 \uB9C8\uB77C
`,v0=`\uB178\uD2B8 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD575\uC2EC \uD0A4\uC6CC\uB4DC 5-10\uAC1C\uB97C \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uAE30\uC220 \uC6A9\uC5B4, \uD504\uB85C\uC81D\uD2B8\uBA85, \uC8FC\uC694 \uAC1C\uB150 \uC704\uC8FC\uB85C \uCD94\uCD9C
- \uB108\uBB34 \uC77C\uBC18\uC801\uC778 \uB2E8\uC5B4 (\uC608: \uBC29\uBC95, \uB0B4\uC6A9, \uC815\uBCF4)\uB294 \uC81C\uC678
- \uD55C\uAE00/\uC601\uC5B4 \uBAA8\uB450 \uAC00\uB2A5
- \uBCF5\uD569 \uBA85\uC0AC\uB294 \uBD84\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C (\uC608: "\uC2A4\uB9C8\uD2B8\uD31C", "API\uD0A4")

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3", ...]
`,E0=`\uC0C8 \uB178\uD2B8\uC640 \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4\uC758 \uAD00\uB828\uC131\uC744 \uBD84\uC11D\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {newTitle}
\uD0A4\uC6CC\uB4DC: {newKeywords}

## \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4
{candidates}

## \uADDC\uCE59
- \uAC01 \uD6C4\uBCF4 \uB178\uD2B8\uC5D0 \uB300\uD574 \uAD00\uB828\uB3C4 \uC810\uC218(0.0~1.0)\uB97C \uB9E4\uACA8\uB77C
- 0.5 \uC774\uC0C1\uC778 \uB178\uD2B8\uB9CC \uBC18\uD658
- \uCD5C\uB300 5\uAC1C\uAE4C\uC9C0\uB9CC \uBC18\uD658
- \uAD00\uB828\uB3C4 \uB192\uC740 \uC21C\uC73C\uB85C \uC815\uB82C
- \uAC01 \uC5F0\uACB0\uC758 "\uC774\uC720"\uB97C \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C (\uC65C \uAD00\uB828\uC788\uB294\uAC00?)
- \uC5F0\uACB0 \uC720\uD615 \uBD84\uB958: \uD655\uC7A5|\uBC18\uBC15|\uC608\uC2DC|\uC804\uC81C|\uC751\uC6A9 \uC911 \uD558\uB098

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
[
  {
    "index": 0,
    "relevance": 0.8,
    "reason": "\uC774 \uB178\uD2B8\uC640 \uAD00\uB828\uC788\uB294 \uAD6C\uCCB4\uC801 \uC774\uC720",
    "type": "\uD655\uC7A5"
  }
]
`,b0=`\uC0C8 \uB178\uD2B8\uAC00 \uC5B4\uB5A4 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828\uC788\uB294\uC9C0 **\uC2E0\uC911\uD558\uAC8C** \uD310\uB2E8\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {noteTitle}
\uD0A4\uC6CC\uB4DC: {noteKeywords}

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- \uB178\uD2B8\uC758 **\uD575\uC2EC \uC8FC\uC81C**\uAC00 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB420 \uB54C\uB9CC \uD504\uB85C\uC81D\uD2B8 \uC120\uD0DD
- \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
- **\uD655\uC2E4\uD558\uC9C0 \uC54A\uC73C\uBA74 "None" \uBC18\uD658** (\uC798\uBABB\uB41C \uBD84\uB958\uBCF4\uB2E4 \uB098\uC74C)
- \uC77C\uBC18\uC801\uC778 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 \u2192 "None"
- \uC0C8\uB85C\uC6B4 \uD504\uB85C\uC81D\uD2B8\uB85C \uBCF4\uC774\uBA74 "NEW: \uD504\uB85C\uC81D\uD2B8\uBA85" \uD615\uC2DD\uC73C\uB85C \uBC18\uD658

## \uCD9C\uB825 \uD615\uC2DD (\uD504\uB85C\uC81D\uD2B8\uBA85\uB9CC \uC751\uB2F5)
\uD504\uB85C\uC81D\uD2B8\uBA85 \uB610\uB294 None \uB610\uB294 NEW: \uC0C8\uD504\uB85C\uC81D\uD2B8\uBA85
`,A0=`\uC720\uD29C\uBE0C \uC601\uC0C1\uC758 \uC790\uB9C9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uC790\uB9C9 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,w0=`\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBCF8\uBB38 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uAE00\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uAD11\uACE0\uB098 \uAD00\uB828 \uC5C6\uB294 \uB0B4\uC6A9\uC740 \uBB34\uC2DC\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,S0=`\uB108\uB294 \uBA54\uBAA8\uB97C \uBD84\uC11D\uD558\uC5EC \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uBCC4\uB85C \uBD84\uB9AC\uD558\uB294 \uBE44\uC11C\uB2E4.
\uD558\uB098\uC758 \uBA54\uBAA8\uC5D0 \uC5EC\uB7EC \uC8FC\uC81C\uB098 \uD504\uB85C\uC81D\uD2B8 \uAD00\uB828 \uB0B4\uC6A9\uC774 \uC11E\uC5EC \uC788\uC744 \uC218 \uC788\uB2E4.
\uAC01\uAC01\uC744 \uB3C5\uB9BD\uC801\uC778 \uB178\uD2B8\uB85C \uBD84\uB9AC\uD574\uB77C.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D (\uCC38\uACE0\uC6A9)
{projects}

## \uBA54\uBAA8 \uB0B4\uC6A9
{content}

## \uBD84\uB9AC \uADDC\uCE59
- \uC11C\uB85C \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uB294 \uBC18\uB4DC\uC2DC \uBD84\uB9AC\uD574\uB77C
- \uD55C \uC904\uC9DC\uB9AC \uBA54\uBAA8\uB3C4 \uC758\uBBF8\uAC00 \uC788\uC73C\uBA74 \uBD84\uB9AC \uB300\uC0C1\uC774\uB2E4
- \uAD00\uB828 \uB0B4\uC6A9\uC740 \uD558\uB098\uB85C \uBB36\uC5B4\uB77C (\uACFC\uB3C4\uD55C \uBD84\uB9AC \uAE08\uC9C0)
- \uAC01 \uC139\uC158\uC5D0 \uC801\uC808\uD55C \uC81C\uBAA9\uC744 \uBD99\uC5EC\uB77C

## \uBD84\uB958 \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- **project**: \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB41C \uB0B4\uC6A9\uB9CC
  - \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
  - \uC608: "\uC2A4\uB9C8\uD2B8\uD31C" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC788\uC5B4\uB3C4 "\uB18D\uC5C5 \uB274\uC2A4"\uB294 library
- **library**: \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 (**\uC560\uB9E4\uD558\uBA74 library**)
- **archive**: \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83
- \uC0C8 \uD504\uB85C\uC81D\uD2B8: \uBA85\uD655\uD55C \uBAA9\uD45C\uAC00 \uC788\uB294 \uC0C8\uB85C\uC6B4 \uC791\uC5C5\uC77C \uB54C\uB9CC isNewProject: true

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uBD84\uB9AC\uB41C \uC139\uC158\uC758 \uC81C\uBAA9",
    "content": "\uD574\uB2F9 \uC139\uC158\uC758 \uC6D0\uBCF8 \uB0B4\uC6A9 (\uC815\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C)",
    "targetType": "project",
    "projectName": "\uC2A4\uB9C8\uD2B8\uD31C",
    "isNewProject": false,
    "keywords": ["\uC13C\uC11C", "\uB370\uC774\uD130", "IoT"],
    "isAtomic": false
  }
]

\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC73C\uBA74 \uC804\uCCB4\uB97C \uD558\uB098\uC758 \uC139\uC158\uC73C\uB85C \uBC18\uD658\uD574\uB77C.
`,_0=`\uC8FC\uC81C\uC5D0 \uC18D\uD55C ZK \uB178\uD2B8\uB4E4\uC744 \uBD84\uC11D\uD558\uC5EC \uAD6C\uC870\uD654\uB41C \uC124\uBA85\uC744 \uC0DD\uC131\uD574\uB77C.

## \uC8FC\uC81C
{topic}

## \uB178\uD2B8 \uBAA9\uB85D
{notes}

## \uADDC\uCE59
- \uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85 \uC791\uC131
- \uAC01 \uB178\uD2B8\uC758 \uC5ED\uD560/\uC704\uCE58 \uC124\uBA85 (\uAE30\uCD08, \uC2EC\uD654, \uC751\uC6A9, \uC608\uC2DC \uC911 \uD558\uB098)
- \uB178\uD2B8 \uAC04 \uAD00\uACC4 \uD45C\uC2DC (\uBC1C\uC804, \uAE30\uBC18, \uAD00\uB828 \uC911 \uD558\uB098)
- \uAD00\uB828 \uC8FC\uC81C 2-3\uAC1C \uC81C\uC548

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "description": "\uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85",
  "notes": [
    {
      "title": "\uB178\uD2B8 \uC81C\uBAA9",
      "role": "\uAE30\uCD08",
      "relations": [{"target": "\uB2E4\uB978\uB178\uD2B8\uC81C\uBAA9", "type": "\uBC1C\uC804"}]
    }
  ],
  "relatedTopics": ["\uAD00\uB828\uC8FC\uC81C1", "\uAD00\uB828\uC8FC\uC81C2"]
}
`,C0=`PDF/\uC774\uBBF8\uC9C0 \uBB38\uC11C \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBB38\uC11C \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uBB38\uC11C\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD398\uC774\uC9C0 \uAD6C\uBD84\uC740 \uBB34\uC2DC\uD558\uACE0 \uC804\uCCB4 \uB0B4\uC6A9\uC744 \uD1B5\uD569\uD574\uC11C \uBD84\uC11D\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uBB38\uC11C \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,T0=`\uD68C\uC758 \uB179\uC74C\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uC758\uB85D\uC744 \uC791\uC131\uD574\uB77C.

## \uADDC\uCE59
1. **\uC804\uC0AC(Transcription)**: \uC74C\uC131\uC744 \uD14D\uC2A4\uD2B8\uB85C \uBCC0\uD658. \uD654\uC790 \uAD6C\uBD84\uC774 \uAC00\uB2A5\uD558\uBA74 "\uD654\uC7901:", "\uD654\uC7902:" \uD615\uC2DD\uC73C\uB85C \uD45C\uC2DC
2. **\uC694\uC57D**: \uD68C\uC758 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
3. **\uC561\uC158 \uC544\uC774\uD15C**: \uB204\uAC00 \uBB34\uC5C7\uC744 \uC5B8\uC81C\uAE4C\uC9C0 \uD560\uC9C0 \uCD94\uCD9C. \uBA85\uC2DC\uB418\uC9C0 \uC54A\uC740 \uD56D\uBAA9\uC740 null
4. **\uACB0\uC815\uC0AC\uD56D**: \uD68C\uC758\uC5D0\uC11C \uACB0\uC815\uB41C \uC0AC\uD56D\uB4E4
5. **\uB2E4\uC74C \uD68C\uC758 \uC548\uAC74**: \uD6C4\uC18D \uB17C\uC758\uAC00 \uD544\uC694\uD55C \uC8FC\uC81C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD68C\uC758 \uC81C\uBAA9 (\uC8FC\uC81C \uAE30\uBC18\uC73C\uB85C \uC0DD\uC131)",
  "transcription": "\uC804\uCCB4 \uB300\uD654 \uB0B4\uC6A9 (\uD654\uC790 \uAD6C\uBD84 \uD3EC\uD568)",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "actionItems": [
    {"task": "\uD560 \uC77C", "assignee": "\uB2F4\uB2F9\uC790 \uB610\uB294 null", "deadline": "\uAE30\uD55C \uB610\uB294 null"}
  ],
  "decisions": ["\uACB0\uC815\uC0AC\uD56D1", "\uACB0\uC815\uC0AC\uD56D2"],
  "nextAgenda": ["\uB2E4\uC74C \uC548\uAC741", "\uB2E4\uC74C \uC548\uAC742"]
}

\uC561\uC158 \uC544\uC774\uD15C, \uACB0\uC815\uC0AC\uD56D, \uB2E4\uC74C \uC548\uAC74\uC774 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uB85C \uBC18\uD658\uD574\uB77C.
`,x0=`\uB108\uB294 \uB098\uC758 \uC0DD\uC0B0\uC131 \uCF54\uCE58\uB2E4.
\uC8FC\uC5B4\uC9C4 \uAE30\uAC04 \uB3D9\uC548\uC758 \uC791\uC5C5 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uACE0 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uB77C.

## \uAE30\uAC04
{period} ({dateRange})

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5 \uB0B4\uC6A9
{projectData}

## \uBD84\uC11D \uADDC\uCE59
1. \uC804\uCCB4 \uC694\uC57D: \uC774 \uAE30\uAC04\uC758 \uC791\uC5C5\uC744 2-3\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
2. \uC8FC\uC694 \uC8FC\uC81C: \uB2E4\uB8EC \uD575\uC2EC \uC8FC\uC81C 3-5\uAC1C \uCD94\uCD9C
3. \uC778\uC0AC\uC774\uD2B8: \uBC1C\uACAC\uD55C \uC810, \uBC30\uC6B4 \uC810, \uD328\uD134 3-5\uAC1C
4. \uB2E4\uC74C \uC561\uC158: \uD6C4\uC18D\uC73C\uB85C \uD574\uC57C \uD560 \uAD6C\uCCB4\uC801\uC778 \uD589\uB3D9 3-5\uAC1C
5. \uC791\uC5C5 \uD328\uD134: \uC791\uC5C5 \uBC29\uC2DD\uC5D0\uC11C \uBC1C\uACAC\uB41C \uD328\uD134 (\uC120\uD0DD)

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "summary": "\uC804\uCCB4 \uC694\uC57D (2-3\uBB38\uC7A5)",
  "mainTopics": ["\uC8FC\uC81C1", "\uC8FC\uC81C2", "\uC8FC\uC81C3"],
  "insights": ["\uC778\uC0AC\uC774\uD2B81", "\uC778\uC0AC\uC774\uD2B82", "\uC778\uC0AC\uC774\uD2B83"],
  "nextActions": ["\uC561\uC1581", "\uC561\uC1582", "\uC561\uC1583"],
  "patterns": "\uC791\uC5C5 \uD328\uD134 \uBD84\uC11D (\uC120\uD0DD, \uC5C6\uC73C\uBA74 null)"
}
`,R0=`\uB178\uD2B8 \uB0B4\uC6A9\uC5D0\uC11C \uC77C\uC815/\uD560\uC77C/\uC57D\uC18D\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uC624\uB298 \uB0A0\uC9DC
{today}

## \uCD94\uCD9C \uADDC\uCE59
- \uB0A0\uC9DC/\uC2DC\uAC04\uC774 \uC5B8\uAE09\uB41C \uBAA8\uB4E0 \uC77C\uC815 \uCD94\uCD9C
- \uC0C1\uB300\uC801 \uB0A0\uC9DC\uB97C \uC808\uB300 \uB0A0\uC9DC\uB85C \uBCC0\uD658:
  - "\uB0B4\uC77C" \u2192 \uC624\uB298 + 1\uC77C
  - "\uBAA8\uB808" \u2192 \uC624\uB298 + 2\uC77C
  - "\uB2E4\uC74C \uC8FC \uC6D4\uC694\uC77C" \u2192 \uB2E4\uC74C \uC8FC \uC6D4\uC694\uC77C \uB0A0\uC9DC
  - "\uC774\uBC88 \uC8FC \uAE08\uC694\uC77C" \u2192 \uC774\uBC88 \uC8FC \uAE08\uC694\uC77C \uB0A0\uC9DC
  - "\uB2E4\uC74C \uB2EC" \u2192 \uB2E4\uC74C \uB2EC 1\uC77C
- \uC2DC\uAC04\uC774 \uC5C6\uC73C\uBA74 time\uC744 null\uB85C
- type \uAD6C\uBD84:
  - "event": \uC57D\uC18D, \uBBF8\uD305, \uD68C\uC758, \uBC1C\uD45C, \uBC29\uBB38 \uB4F1 \uD2B9\uC815 \uC2DC\uC810\uC758 \uD65C\uB3D9
  - "task": \uB9C8\uAC10\uC77C, \uC81C\uCD9C, \uC644\uB8CC\uD574\uC57C \uD560 \uC77C

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4)
[
  {
    "title": "\uC77C\uC815 \uC81C\uBAA9",
    "date": "2026-01-15",
    "time": "14:00",
    "type": "event"
  },
  {
    "title": "\uBCF4\uACE0\uC11C \uC81C\uCD9C",
    "date": "2026-01-17",
    "time": null,
    "type": "task"
  }
]

\uC77C\uC815\uC774 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 [] \uBC18\uD658.
`;var W1=1e3,Y1=3,K1=2e3,at="gemini-3-flash-preview",Sp=class{constructor(e){this.lastRequestTime=0;this.minDelayMs=W1;this.ai=new Ep({apiKey:e})}async waitForRateLimit(){let t=Date.now()-this.lastRequestTime;if(t<this.minDelayMs){let n=this.minDelayMs-t;await this.delay(n)}this.lastRequestTime=Date.now()}delay(e){return new Promise(t=>setTimeout(t,e))}async callWithRetry(e,t=Y1){await this.waitForRateLimit();for(let n=0;n<=t;n++)try{return await e()}catch(s){if(s instanceof Error&&(s.message.includes("429")||s.message.includes("RESOURCE_EXHAUSTED")||s.message.includes("quota"))&&n<t){let o=K1*Math.pow(2,n);console.log(`Rate limit hit, retrying in ${o/1e3}s... (attempt ${n+1}/${t})`),await this.delay(o),this.minDelayMs=Math.min(this.minDelayMs*1.5,5e3)}else throw s}throw new Error("Max retries exceeded")}async classifyProject(e,t){var a;let n=t.length>0?t.map((l,c)=>`${c+1}. ${l}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",s=p0.replace("{projects}",n).replace("{content}",e),o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:s}))).text)!=null?a:"";return this.parseProjectResponse(o)}async extractZK(e){var r;let t=g0.replace("{content}",e),s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:t}))).text)!=null?r:"";return this.parseZKResponse(s)}async getFocus(e){var r;let t=m0.replace("{projects}",e),s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:t}))).text)!=null?r:"";return this.parseFocusResponse(s)}parseProjectResponse(e){var n;let t=e.match(/\{[\s\S]*\}/);if(!t)throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: JSON \uC5C6\uC74C");try{let s=JSON.parse(t[0]);return{targetType:this.validateTargetType(s.targetType),projectName:s.projectName||void 0,isNewProject:(n=s.isNewProject)!=null?n:!1,title:s.title||"Untitled",summary:s.summary||"",nextAction:s.nextAction||null}}catch(s){throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: "+e)}}parseZKResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{return JSON.parse(t[0]).map(s=>({title:s.title,body:s.body,keywords:s.keywords||[],importance:s.importance||"",relatedConcepts:s.relatedConcepts||[]}))}catch(n){return console.error("ZK \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}parseFocusResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{return JSON.parse(t[0]).map(s=>({title:s.title,why:s.why,nextAction:s.next_action}))}catch(n){return console.error("Focus \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async extractTextFromImage(e,t){var s;return(s=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:[{role:"user",parts:[{text:y0},{inlineData:{mimeType:t,data:e}}]}]}))).text)!=null?s:""}async extractTextFromImages(e,t){let n=[];for(let s=0;s<e.length;s++){let r=e[s];t&&t(s+1,e.length);let o=await this.extractTextFromImage(r.base64,r.mimeType);n.push(o),s<e.length-1&&await this.delay(500)}return n}async extractKeywords(e){var r;let t=v0.replace("{content}",e),s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:t}))).text)!=null?r:"";return this.parseKeywordsResponse(s)}async findRelatedNotes(e,t,n){var a;let s=E0.replace("{newTitle}",e).replace("{newKeywords}",t.join(", ")).replace("{candidates}",n),o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:s}))).text)!=null?a:"";return this.parseRelatedNotesResponse(o)}async detectProject(e,t,n){var l;if(n.length===0)return null;let s=b0.replace("{noteTitle}",e).replace("{noteKeywords}",t.join(", ")).replace("{projects}",n.map((c,d)=>`${d+1}. ${c}`).join(`
`)),o=((l=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:s}))).text)!=null?l:"").trim();return o.toLowerCase()==="none"||o===""?null:o.startsWith("NEW:")?o:n.find(c=>o.toLowerCase().includes(c.toLowerCase()))||null}async summarizeContent(e,t){var a;let s=(t==="youtube"?A0:w0).replace("{content}",e),o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:s}))).text)!=null?a:"";return this.parseSummaryResponse(o)}async summarizePDF(e){var r;let t=C0.replace("{content}",e),s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:t}))).text)!=null?r:"";return this.parseSummaryResponse(s)}async analyzeYouTube(e){var r;let t=`\uC774 YouTube \uC601\uC0C1\uC744 \uBD84\uC11D\uD574\uC8FC\uC138\uC694.

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD654\uBA74\uC5D0 \uBCF4\uC774\uB294 \uD14D\uC2A4\uD2B8, \uC2AC\uB77C\uC774\uB4DC, \uCF54\uB4DC \uB4F1\uB3C4 \uCC38\uACE0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:[{role:"user",parts:[{fileData:{mimeType:"video/mp4",fileUri:e}},{text:t}]}]}))).text)!=null?r:"";return this.parseSummaryResponse(s)}async analyzeWebpage(e){var r;let t=`\uB2E4\uC74C \uC6F9\uD398\uC774\uC9C0\uB97C \uBD84\uC11D\uD574\uC8FC\uC138\uC694: ${e}

## \uADDC\uCE59
- \uD398\uC774\uC9C0\uC758 \uD575\uC2EC \uB0B4\uC6A9\uC744 \uC815\uD655\uD788 \uD30C\uC545\uD574\uB77C
- \uACF5\uACE0/\uBAA8\uC9D1\uC774\uBA74: \uB300\uC0C1, \uC870\uAC74, \uAE30\uAC04, \uD61C\uD0DD\uC744 \uAD6C\uCCB4\uC801\uC73C\uB85C
- \uB274\uC2A4/\uAE30\uC0AC\uBA74: \uD575\uC2EC \uC0AC\uC2E4, \uBC30\uACBD, \uC758\uBBF8\uB97C
- \uC81C\uD488/\uC11C\uBE44\uC2A4\uBA74: \uC8FC\uC694 \uAE30\uB2A5, \uAC00\uACA9, \uD2B9\uC9D5\uC744
- \uC77C\uBC18 \uC815\uBCF4\uBA74: \uD575\uC2EC \uBA54\uC2DC\uC9C0\uC640 \uC911\uC694 \uC138\uBD80\uC0AC\uD56D\uC744
- \uC804\uBB38 \uC6A9\uC5B4, \uACE0\uC720\uBA85\uC0AC, \uC22B\uC790\uB294 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD398\uC774\uC9C0 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D (\uAD6C\uCCB4\uC801\uC778 \uC815\uBCF4 \uD3EC\uD568)",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:t,config:{tools:[{urlContext:{}}]}}))).text)!=null?r:"";return this.parseSummaryResponse(s)}parseSummaryResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{title:"Untitled",summary:e.trim(),keyPoints:[]};try{let n=JSON.parse(t[0]);return{title:n.title||"Untitled",summary:n.summary||"",keyPoints:Array.isArray(n.keyPoints)?n.keyPoints:[]}}catch(n){return console.error("\uC694\uC57D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{title:"Untitled",summary:e.trim(),keyPoints:[]}}}parseKeywordsResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(s=>typeof s=="string"):[]}catch(n){return console.error("\uD0A4\uC6CC\uB4DC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}parseRelatedNotesResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(s=>typeof s=="object"&&typeof s.index=="number"&&typeof s.relevance=="number").filter(s=>s.relevance>=.5).sort((s,r)=>r.relevance-s.relevance).slice(0,5).map(s=>({index:s.index,relevance:s.relevance,reason:s.reason||"",type:s.type||""})):[]}catch(n){return console.error("\uAD00\uB828 \uB178\uD2B8 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async generateTopicStructure(e,t){var o;let n=_0.replace("{topic}",e).replace("{notes}",t),r=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:n}))).text)!=null?o:"";return this.parseTopicStructureResponse(r)}parseTopicStructureResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{description:"",notes:[],relatedTopics:[]};try{let n=JSON.parse(t[0]);return{description:n.description||"",notes:Array.isArray(n.notes)?n.notes:[],relatedTopics:Array.isArray(n.relatedTopics)?n.relatedTopics:[]}}catch(n){return console.error("\uC8FC\uC81C \uAD6C\uC870 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{description:"",notes:[],relatedTopics:[]}}}async splitContent(e,t){var a;let n=t.length>0?t.map((l,c)=>`${c+1}. ${l}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",s=S0.replace("{projects}",n).replace("{content}",e),o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:s}))).text)!=null?a:"";return this.parseSplitResponse(o)}parseSplitResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.map(s=>{var r,o;return{title:s.title||"Untitled",content:s.content||"",targetType:this.validateTargetType(s.targetType),project:s.projectName||void 0,isNewProject:(r=s.isNewProject)!=null?r:!1,keywords:Array.isArray(s.keywords)?s.keywords:[],isAtomic:(o=s.isAtomic)!=null?o:!1}}):[]}catch(n){return console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}validateTargetType(e){return["project","library","archive"].includes(e)?e:"library"}async analyzeReview(e,t,n){var h;let r={today:"\uC624\uB298",week:"\uC774\uBC88 \uC8FC",month:"\uC774\uBC88 \uB2EC",custom:"\uC0AC\uC6A9\uC790 \uC9C0\uC815 \uAE30\uAC04"}[e]||"\uAE30\uAC04",o=`${Le(t.start,"auto")} ~ ${Le(t.end,"auto")}`,a=n.map(p=>{let m=p.notes.map(y=>`  - ${y.title}${y.summary?`: ${y.summary}`:""}`).join(`
`);return`### ${p.projectName} (${p.noteCount}\uAC1C)
${m}`}).join(`

`),l=x0.replace("{period}",r).replace("{dateRange}",o).replace("{projectData}",a),d=(h=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:l}))).text)!=null?h:"";return this.parseReviewAnalysisResponse(d)}parseReviewAnalysisResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]};try{let n=JSON.parse(t[0]);return{summary:n.summary||"",mainTopics:Array.isArray(n.mainTopics)?n.mainTopics:[],insights:Array.isArray(n.insights)?n.insights:[],nextActions:Array.isArray(n.nextActions)?n.nextActions:[],patterns:n.patterns||void 0}}catch(n){return console.error("\uD68C\uACE0 \uBD84\uC11D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]}}}async analyzeMeeting(e,t,n){var a;console.log("\uD68C\uC758 \uB179\uC74C \uC5C5\uB85C\uB4DC \uC911...",n);let s=await this.ai.files.upload({file:e,config:{mimeType:t}});console.log("\uC5C5\uB85C\uB4DC \uC644\uB8CC:",s.uri);let o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:[{role:"user",parts:[{fileData:{fileUri:s.uri,mimeType:s.mimeType}},{text:T0}]}]}))).text)!=null?a:"";return this.parseMeetingResponse(o,n)}parseMeetingResponse(e,t){let n=e.match(/\{[\s\S]*\}/);if(!n)return{title:"\uD68C\uC758\uB85D",transcription:e.trim(),summary:"",actionItems:[],decisions:[],nextAgenda:[],sourceFile:t};try{let s=JSON.parse(n[0]);return{title:s.title||"\uD68C\uC758\uB85D",transcription:s.transcription||"",summary:s.summary||"",actionItems:Array.isArray(s.actionItems)?s.actionItems.map(r=>({task:r.task||"",assignee:r.assignee||null,deadline:r.deadline||null})):[],decisions:Array.isArray(s.decisions)?s.decisions:[],nextAgenda:Array.isArray(s.nextAgenda)?s.nextAgenda:[],sourceFile:t}}catch(s){return console.error("\uD68C\uC758\uB85D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{title:"\uD68C\uC758\uB85D",transcription:e.trim(),summary:"",actionItems:[],decisions:[],nextAgenda:[],sourceFile:t}}}async detectSchedules(e,t){var o;let n=R0.replace("{content}",e).replace("{today}",t),r=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:n}))).text)!=null?o:"";return this.parseSchedulesResponse(r)}parseSchedulesResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(s=>typeof s=="object"&&typeof s.title=="string"&&typeof s.date=="string"&&(s.type==="event"||s.type==="task")).map(s=>({title:s.title,date:s.date,time:s.time||null,type:s.type})):[]}catch(n){return console.error("\uC77C\uC815 \uAC10\uC9C0 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}};var Fw=require("obsidian");var zO={};var od={};od.d=(i,e)=>{for(var t in e)od.o(e,t)&&!od.o(i,t)&&Object.defineProperty(i,t,{enumerable:!0,get:e[t]})};od.o=(i,e)=>Object.prototype.hasOwnProperty.call(i,e);var Y=globalThis.pdfjsLib={};od.d(Y,{AbortException:()=>gi,AnnotationEditorLayer:()=>Ew,AnnotationEditorParamsType:()=>oe,AnnotationEditorType:()=>Z,AnnotationEditorUIManager:()=>Ko,AnnotationLayer:()=>JA,AnnotationMode:()=>Es,ColorPicker:()=>Pg,DOMSVGFactory:()=>vd,DrawLayer:()=>ww,FeatureTest:()=>nt,GlobalWorkerOptions:()=>Vn,ImageKind:()=>Ip,InvalidPDFException:()=>dd,MissingPDFException:()=>qo,OPS:()=>Tn,OutputScale:()=>fd,PDFDataRangeTransport:()=>bg,PDFDateString:()=>ld,PDFWorker:()=>Fa,PasswordResponses:()=>j1,PermissionFlag:()=>Q1,PixelsPerInch:()=>ir,RenderingCancelledException:()=>hd,TextLayer:()=>md,TouchManager:()=>cg,UnexpectedResponseException:()=>hc,Util:()=>V,VerbosityLevel:()=>Ey,XfaLayer:()=>Sg,build:()=>VO,createValidAbsoluteUrl:()=>iO,fetchData:()=>Sy,getDocument:()=>OO,getFilenameFromUrl:()=>uO,getPdfFilenameFromUrl:()=>hO,getXfaPageViewport:()=>fO,isDataScheme:()=>_y,isPdfFile:()=>xw,noContextMenu:()=>Gn,normalizeUnicode:()=>lO,setLayerDimensions:()=>Wo,shadow:()=>ie,stopEvent:()=>jt,version:()=>BO});var mt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),z0=[1,0,0,1,0,0],db=[.001,0,0,.001,0,0],X1=1e7,Rp=1.35,J1=.35,QG=J1/Rp,Qt={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Es={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Z1="pdfjs_internal_editor_",Z={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},oe={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},Q1={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},lt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Ip={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ue={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var Vc={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var Ey={ERRORS:0,WARNINGS:1,INFOS:5},Tn={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},j1={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},by=Ey.WARNINGS;function eO(i){Number.isInteger(i)&&(by=i)}function tO(){return by}function Ay(i){by>=Ey.INFOS&&console.log(`Info: ${i}`)}function Q(i){by>=Ey.WARNINGS&&console.log(`Warning: ${i}`)}function ge(i){throw new Error(i)}function ke(i,e){i||ge(e)}function nO(i){switch(i==null?void 0:i.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function iO(i,e=null,t=null){if(!i)return null;try{if(t&&typeof i=="string"){if(t.addDefaultProtocol&&i.startsWith("www.")){let s=i.match(/\./g);(s==null?void 0:s.length)>=2&&(i=`http://${i}`)}if(t.tryConvertEncoding)try{i=aO(i)}catch(s){}}let n=e?new URL(i,e):new URL(i);if(nO(n))return n}catch(n){}return null}function ie(i,e,t,n=!1){return Object.defineProperty(i,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}var sr=function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}(),rg=class extends sr{constructor(e,t){super(e,"PasswordException"),this.code=t}},ad=class extends sr{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},dd=class extends sr{constructor(e){super(e,"InvalidPDFException")}},qo=class extends sr{constructor(e){super(e,"MissingPDFException")}},hc=class extends sr{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},ub=class extends sr{constructor(e){super(e,"FormatError")}},gi=class extends sr{constructor(e){super(e,"AbortException")}};function q0(i){(typeof i!="object"||(i==null?void 0:i.length)===void 0)&&ge("Invalid argument for bytesToString");let e=i.length,t=8192;if(e<t)return String.fromCharCode.apply(null,i);let n=[];for(let s=0;s<e;s+=t){let r=Math.min(s+t,e),o=i.subarray(s,r);n.push(String.fromCharCode.apply(null,o))}return n.join("")}function wy(i){typeof i!="string"&&ge("Invalid argument for stringToBytes");let e=i.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=i.charCodeAt(n)&255;return t}function sO(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255)}function Cw(i){let e=Object.create(null);for(let[t,n]of i)e[t]=n;return e}function rO(){let i=new Uint8Array(4);return i[0]=1,new Uint32Array(i.buffer,0,1)[0]===1}function oO(){try{return new Function(""),!0}catch(i){return!1}}var nt=class{static get isLittleEndian(){return ie(this,"isLittleEndian",rO())}static get isEvalSupported(){return ie(this,"isEvalSupported",oO())}static get isOffscreenCanvasSupported(){return ie(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas!="undefined")}static get isImageDecoderSupported(){return ie(this,"isImageDecoderSupported",typeof ImageDecoder!="undefined")}static get platform(){return typeof navigator!="undefined"&&typeof(navigator==null?void 0:navigator.platform)=="string"?ie(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):ie(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return ie(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}},rb=Array.from(Array(256).keys(),i=>i.toString(16).padStart(2,"0")),La,Dp,Sd,hb,V=class{static makeHexColor(e,t,n){return`#${rb[e]}${rb[t]}${rb[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){let n=e[0]*t[0]+e[1]*t[2]+t[4],s=e[0]*t[1]+e[1]*t[3]+t[5];return[n,s]}static applyInverseTransform(e,t){let n=t[0]*t[3]-t[1]*t[2],s=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[s,r]}static getAxialAlignedBoundingBox(e,t){let n=this.applyTransform(e,t),s=this.applyTransform(e.slice(2,4),t),r=this.applyTransform([e[0],e[3]],t),o=this.applyTransform([e[2],e[1]],t);return[Math.min(n[0],s[0],r[0],o[0]),Math.min(n[1],s[1],r[1],o[1]),Math.max(n[0],s[0],r[0],o[0]),Math.max(n[1],s[1],r[1],o[1])]}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){let t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],s=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],a=(n+o)/2,l=Math.sqrt((n+o)**2-4*(n*o-r*s))/2,c=a+l||1,d=a-l||1;return[Math.sqrt(c),Math.sqrt(d)]}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>s)return null;let r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[n,r,s,o]}static bezierBoundingBox(e,t,n,s,r,o,a,l,c){return c?(c[0]=Math.min(c[0],e,a),c[1]=Math.min(c[1],t,l),c[2]=Math.max(c[2],e,a),c[3]=Math.max(c[3],t,l)):c=[Math.min(e,a),Math.min(t,l),Math.max(e,a),Math.max(t,l)],S(this,Sd,hb).call(this,e,n,r,a,t,s,o,l,3*(-e+3*(n-r)+a),6*(e-2*n+r),3*(n-e),c),S(this,Sd,hb).call(this,e,n,r,a,t,s,o,l,3*(-t+3*(s-o)+l),6*(t-2*s+o),3*(s-t),c),c}};La=new WeakSet,Dp=function(e,t,n,s,r,o,a,l,c,d){if(c<=0||c>=1)return;let h=1-c,p=c*c,m=p*c,y=h*(h*(h*e+3*c*t)+3*p*n)+m*s,v=h*(h*(h*r+3*c*o)+3*p*a)+m*l;d[0]=Math.min(d[0],y),d[1]=Math.min(d[1],v),d[2]=Math.max(d[2],y),d[3]=Math.max(d[3],v)},Sd=new WeakSet,hb=function(e,t,n,s,r,o,a,l,c,d,h,p){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&S(this,La,Dp).call(this,e,t,n,s,r,o,a,l,-h/d,p);return}let m=d**2-4*h*c;if(m<0)return;let y=Math.sqrt(m),v=2*c;S(this,La,Dp).call(this,e,t,n,s,r,o,a,l,(-d+y)/v,p),S(this,La,Dp).call(this,e,t,n,s,r,o,a,l,(-d-y)/v,p)},E(V,La),E(V,Sd);function aO(i){return decodeURIComponent(escape(i))}var ob=null,I0=null;function lO(i){return ob||(ob=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,I0=new Map([["\uFB05","\u017Ft"]])),i.replaceAll(ob,(e,t,n)=>t?t.normalize("NFKC"):I0.get(n))}function cO(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let i=new Uint8Array(32);return crypto.getRandomValues(i),q0(i)}var Tw="pdfjs_internal_id_";function dO(i){return Uint8Array.prototype.toBase64?i.toBase64():btoa(q0(i))}typeof Promise.try!="function"&&(Promise.try=function(i,...e){return new Promise(t=>{t(i(...e))})});var Ii="http://www.w3.org/2000/svg",_r=class _r{};W(_r,"CSS",96),W(_r,"PDF",72),W(_r,"PDF_TO_CSS_UNITS",_r.CSS/_r.PDF);var ir=_r;async function Sy(i,e="text"){if(qc(i,document.baseURI)){let t=await fetch(i);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{let s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}n(new Error(s.statusText))}},s.send(null)})}var ud=class i{constructor({viewBox:e,userUnit:t,scale:n,rotation:s,offsetX:r=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=s,this.offsetX=r,this.offsetY=o,n*=t;let l=(e[2]+e[0])/2,c=(e[3]+e[1])/2,d,h,p,m;switch(s%=360,s<0&&(s+=360),s){case 180:d=-1,h=0,p=0,m=1;break;case 90:d=0,h=1,p=1,m=0;break;case 270:d=0,h=-1,p=-1,m=0;break;case 0:d=1,h=0,p=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(p=-p,m=-m);let y,v,b,w;d===0?(y=Math.abs(c-e[1])*n+r,v=Math.abs(l-e[0])*n+o,b=(e[3]-e[1])*n,w=(e[2]-e[0])*n):(y=Math.abs(l-e[0])*n+r,v=Math.abs(c-e[1])*n+o,b=(e[2]-e[0])*n,w=(e[3]-e[1])*n),this.transform=[d*n,h*n,p*n,m*n,y-d*n*l-p*n*c,v-h*n*l-m*n*c],this.width=b,this.height=w}get rawDims(){let{userUnit:e,viewBox:t}=this,n=t.map(s=>s*e);return ie(this,"rawDims",{pageWidth:n[2]-n[0],pageHeight:n[3]-n[1],pageX:n[0],pageY:n[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:r=!1}={}){return new i({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}convertToViewportPoint(e,t){return V.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){let t=V.applyTransform([e[0],e[1]],this.transform),n=V.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return V.applyInverseTransform([e,t],this.transform)}},hd=class extends sr{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}};function _y(i){let e=i.length,t=0;for(;t<e&&i[t].trim()==="";)t++;return i.substring(t,t+5).toLowerCase()==="data:"}function xw(i){return typeof i=="string"&&/\.pdf$/i.test(i)}function uO(i){return[i]=i.split(/[#?]/,1),i.substring(i.lastIndexOf("/")+1)}function hO(i,e="document.pdf"){if(typeof i!="string")return e;if(_y(i))return Q('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;let t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=t.exec(i),r=n.exec(s[1])||n.exec(s[2])||n.exec(s[3]);if(r&&(r=r[0],r.includes("%")))try{r=n.exec(decodeURIComponent(r))[0]}catch(o){}return r||e}var og=class{constructor(){W(this,"started",Object.create(null));W(this,"times",[])}time(e){e in this.started&&Q(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Q(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:n}of this.times)t=Math.max(n.length,t);for(let{name:n,start:s,end:r}of this.times)e.push(`${n.padEnd(t)} ${r-s}ms
`);return e.join("")}};function qc(i,e){try{let{protocol:t}=e?new URL(i,e):new URL(i);return t==="http:"||t==="https:"}catch(t){return!1}}function Gn(i){i.preventDefault()}function jt(i){i.preventDefault(),i.stopPropagation()}var _d,ld=class{static toDateObject(e){if(!e||typeof e!="string")return null;u(this,_d)||A(this,_d,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let t=u(this,_d).exec(e);if(!t)return null;let n=parseInt(t[1],10),s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;let c=t[7]||"Z",d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,c==="-"?(o+=d,a+=h):c==="+"&&(o-=d,a-=h),new Date(Date.UTC(n,s,r,o,a,l))}};_d=new WeakMap,E(ld,_d,void 0);function fO(i,{scale:e=1,rotation:t=0}){let{width:n,height:s}=i.attributes.style,r=[0,0,parseInt(n),parseInt(s)];return new ud({viewBox:r,userUnit:1,scale:e,rotation:t})}function Rw(i){if(i.startsWith("#")){let e=parseInt(i.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return i.startsWith("rgb(")?i.slice(4,-1).split(",").map(e=>parseInt(e)):i.startsWith("rgba(")?i.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Q(`Not a valid color format: "${i}"`),[0,0,0])}function pO(i){let e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(let t of i.keys()){e.style.color=t;let n=window.getComputedStyle(e).color;i.set(t,Rw(n))}e.remove()}function Ee(i){let{a:e,b:t,c:n,d:s,e:r,f:o}=i.getTransform();return[e,t,n,s,r,o]}function Kn(i){let{a:e,b:t,c:n,d:s,e:r,f:o}=i.getTransform().invertSelf();return[e,t,n,s,r,o]}function Wo(i,e,t=!1,n=!0){if(e instanceof ud){let{pageWidth:s,pageHeight:r}=e.rawDims,{style:o}=i,a=nt.isCSSRoundSupported,l=`var(--scale-factor) * ${s}px`,c=`var(--scale-factor) * ${r}px`,d=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,h=a?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!t||e.rotation%180===0?(o.width=d,o.height=h):(o.width=h,o.height=d)}n&&i.setAttribute("data-main-rotation",e.rotation)}var fd=class{constructor(){let e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},bs,xr,xn,Rr,Cd,Td,Fg,W0,Lg,Y0,Og,K0,Oa,Mp,Ug,X0,xd,pb,Pi=class Pi{constructor(e){E(this,Lg);E(this,Og);E(this,Oa);E(this,Ug);E(this,xd);E(this,bs,null);E(this,xr,null);E(this,xn,void 0);E(this,Rr,null);E(this,Cd,null);A(this,xn,e),u(Pi,Td)||A(Pi,Td,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){let e=A(this,bs,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");let t=u(this,xn)._uiManager._signal;e.addEventListener("contextmenu",Gn,{signal:t}),e.addEventListener("pointerdown",S(Pi,Fg,W0),{signal:t});let n=A(this,Rr,document.createElement("div"));n.className="buttons",e.append(n);let s=u(this,xn).toolbarPosition;if(s){let{style:r}=e,o=u(this,xn)._uiManager.direction==="ltr"?1-s[0]:s[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return S(this,Ug,X0).call(this),e}get div(){return u(this,bs)}hide(){var e;u(this,bs).classList.add("hidden"),(e=u(this,xr))==null||e.hideDropdown()}show(){var e;u(this,bs).classList.remove("hidden"),(e=u(this,Cd))==null||e.shown()}async addAltText(e){let t=await e.render();S(this,Oa,Mp).call(this,t),u(this,Rr).prepend(t,u(this,xd,pb)),A(this,Cd,e)}addColorPicker(e){A(this,xr,e);let t=e.renderButton();S(this,Oa,Mp).call(this,t),u(this,Rr).prepend(t,u(this,xd,pb))}remove(){var e;u(this,bs).remove(),(e=u(this,xr))==null||e.destroy(),A(this,xr,null)}};bs=new WeakMap,xr=new WeakMap,xn=new WeakMap,Rr=new WeakMap,Cd=new WeakMap,Td=new WeakMap,Fg=new WeakSet,W0=function(e){e.stopPropagation()},Lg=new WeakSet,Y0=function(e){u(this,xn)._focusEventsAllowed=!1,jt(e)},Og=new WeakSet,K0=function(e){u(this,xn)._focusEventsAllowed=!0,jt(e)},Oa=new WeakSet,Mp=function(e){let t=u(this,xn)._uiManager._signal;e.addEventListener("focusin",S(this,Lg,Y0).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",S(this,Og,K0).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Gn,{signal:t})},Ug=new WeakSet,X0=function(){let{editorType:e,_uiManager:t}=u(this,xn),n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",u(Pi,Td)[e]),S(this,Oa,Mp).call(this,n),n.addEventListener("click",s=>{t.delete()},{signal:t._signal}),u(this,Rr).append(n)},xd=new WeakSet,pb=function(){let e=document.createElement("div");return e.className="divider",e},E(Pi,Fg),E(Pi,Td,null);var fb=Pi,Rd,Ir,Dr,Hg,J0,Bg,Z0,Vg,Q0,gb=class{constructor(e){E(this,Hg);E(this,Bg);E(this,Vg);E(this,Rd,null);E(this,Ir,null);E(this,Dr,void 0);A(this,Dr,e)}show(e,t,n){let[s,r]=S(this,Bg,Z0).call(this,t,n),{style:o}=u(this,Ir)||A(this,Ir,S(this,Hg,J0).call(this));e.append(u(this,Ir)),o.insetInlineEnd=`${100*s}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){u(this,Ir).remove()}};Rd=new WeakMap,Ir=new WeakMap,Dr=new WeakMap,Hg=new WeakSet,J0=function(){let e=A(this,Ir,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Gn,{signal:u(this,Dr)._signal});let t=A(this,Rd,document.createElement("div"));return t.className="buttons",e.append(t),S(this,Vg,Q0).call(this),e},Bg=new WeakSet,Z0=function(e,t){let n=0,s=0;for(let r of e){let o=r.y+r.height;if(o<n)continue;let a=r.x+(t?r.width:0);if(o>n){s=a,n=o;continue}t?a>s&&(s=a):a<s&&(s=a)}return[t?1-s:s,n]},Vg=new WeakSet,Q0=function(){let e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let n=u(this,Dr)._signal;e.addEventListener("contextmenu",Gn,{signal:n}),e.addEventListener("click",()=>{u(this,Dr).highlightSelection("floating_button")},{signal:n}),u(this,Rd).append(e)};function ag(i,e,t){for(let n of t)e.addEventListener(n,i[n].bind(i))}var Gg,mb=class{constructor(){E(this,Gg,0)}get id(){return`${Z1}${vt(this,Gg)._++}`}};Gg=new WeakMap;var Ua,Id,ut,Ha,Pp,Iw=class Iw{constructor(){E(this,Ha);E(this,Ua,cO());E(this,Id,0);E(this,ut,null)}static get _isSVGFittingCanvas(){let e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;let r=s.decode().then(()=>(n.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return ie(this,"_isSVGFittingCanvas",r)}async getFromFile(e){let{lastModified:t,name:n,size:s,type:r}=e;return S(this,Ha,Pp).call(this,`${t}_${n}_${s}_${r}`,e)}async getFromUrl(e){return S(this,Ha,Pp).call(this,e,e)}async getFromBlob(e,t){let n=await t;return S(this,Ha,Pp).call(this,e,n)}async getFromId(e){u(this,ut)||A(this,ut,new Map);let t=u(this,ut).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){let{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){u(this,ut)||A(this,ut,new Map);let n=u(this,ut).get(e);if(n!=null&&n.bitmap)return n.refCounter+=1,n;let s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),n={bitmap:s.transferToImageBitmap(),id:`image_${u(this,Ua)}_${vt(this,Id)._++}`,refCounter:1,isSvg:!1},u(this,ut).set(e,n),u(this,ut).set(n.id,n),n}getSvgUrl(e){let t=u(this,ut).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var s;u(this,ut)||A(this,ut,new Map);let t=u(this,ut).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;let{bitmap:n}=t;if(!t.url&&!t.file){let r=new OffscreenCanvas(n.width,n.height);r.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=r.convertToBlob()}(s=n.close)==null||s.call(n),t.bitmap=null}isValidId(e){return e.startsWith(`image_${u(this,Ua)}_`)}};Ua=new WeakMap,Id=new WeakMap,ut=new WeakMap,Ha=new WeakSet,Pp=async function(e,t){u(this,ut)||A(this,ut,new Map);let n=u(this,ut).get(e);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${u(this,Ua)}_${vt(this,Id)._++}`,refCounter:0,isSvg:!1});let s;if(typeof t=="string"?(n.url=t,s=await Sy(t,"blob")):t instanceof File?s=n.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){let r=Iw._isSVGFittingCanvas,o=new FileReader,a=new Image,l=new Promise((c,d)=>{a.onload=()=>{n.bitmap=a,n.isSvg=!0,c()},o.onload=async()=>{let h=n.svgUrl=o.result;a.src=await r?`${h}#svgView(preserveAspectRatio(none))`:h},a.onerror=o.onerror=d});o.readAsDataURL(s),await l}else n.bitmap=await createImageBitmap(s);n.refCounter=1}catch(s){Q(s),n=null}return u(this,ut).set(e,n),n&&u(this,ut).set(n.id,n),n};var yb=Iw,Re,As,Dd,we,vb=class{constructor(e=128){E(this,Re,[]);E(this,As,!1);E(this,Dd,void 0);E(this,we,-1);A(this,Dd,e)}add({cmd:e,undo:t,post:n,mustExec:s,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(s&&e(),u(this,As))return;let l={cmd:e,undo:t,post:n,type:r};if(u(this,we)===-1){u(this,Re).length>0&&(u(this,Re).length=0),A(this,we,0),u(this,Re).push(l);return}if(o&&u(this,Re)[u(this,we)].type===r){a&&(l.undo=u(this,Re)[u(this,we)].undo),u(this,Re)[u(this,we)]=l;return}let c=u(this,we)+1;c===u(this,Dd)?u(this,Re).splice(0,1):(A(this,we,c),c<u(this,Re).length&&u(this,Re).splice(c)),u(this,Re).push(l)}undo(){if(u(this,we)===-1)return;A(this,As,!0);let{undo:e,post:t}=u(this,Re)[u(this,we)];e(),t==null||t(),A(this,As,!1),A(this,we,u(this,we)-1)}redo(){if(u(this,we)<u(this,Re).length-1){A(this,we,u(this,we)+1),A(this,As,!0);let{cmd:e,post:t}=u(this,Re)[u(this,we)];e(),t==null||t(),A(this,As,!1)}}hasSomethingToUndo(){return u(this,we)!==-1}hasSomethingToRedo(){return u(this,we)<u(this,Re).length-1}cleanType(e){if(u(this,we)!==-1){for(let t=u(this,we);t>=0;t--)if(u(this,Re)[t].type!==e){u(this,Re).splice(t+1,u(this,we)-t),A(this,we,t);return}u(this,Re).length=0,A(this,we,-1)}}destroy(){A(this,Re,null)}};Re=new WeakMap,As=new WeakMap,Dd=new WeakMap,we=new WeakMap;var $g,j0,Yo=class{constructor(e){E(this,$g);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=nt.platform;for(let[n,s,r={}]of e)for(let o of n){let a=o.startsWith("mac+");t&&a?(this.callbacks.set(o.slice(4),{callback:s,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!a&&(this.callbacks.set(o,{callback:s,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;let n=this.callbacks.get(S(this,$g,j0).call(this,t));if(!n)return;let{callback:s,options:{bubbles:r=!1,args:o=[],checker:a=null}}=n;a&&!a(e,t)||(s.bind(e,...o,t)(),r||jt(t))}};$g=new WeakSet,j0=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let t=this.buffer.join("+");return this.buffer.length=0,t};var zg=class zg{get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return pO(e),ie(this,"_colors",e)}convert(e){let t=Rw(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(let[n,s]of this._colors)if(s.every((r,o)=>r===t[o]))return zg._colorsMapping.get(n);return t}getHexCode(e){let t=this._colors.get(e);return t?V.makeHexColor(...t):e}};W(zg,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var Eb=zg,Ba,Bt,He,Je,Va,Ni,Ga,ln,ws,Mr,$a,Pr,Zn,Rn,kr,Md,Pd,za,kd,Qn,Ss,qa,_s,jn,qg,Cs,Nd,Ts,Nr,Fd,Ld,$e,he,Fi,Fr,Od,Ud,xs,ei,Li,Hd,cn,Wa,kp,Bd,bb,Wg,ex,Yg,tx,Ya,Np,Kg,nx,Xg,ix,Jg,sx,Vd,Ab,Zg,rx,Gd,wb,$d,Sb,Qg,ox,Ze,bt,In,Di,jg,ax,em,lx,zd,_b,tm,cx,Lr,Wc,qd,Cb,Pa=class Pa{constructor(e,t,n,s,r,o,a,l,c,d,h,p,m){E(this,Wa);E(this,Bd);E(this,Wg);E(this,Yg);E(this,Ya);E(this,Kg);E(this,Xg);E(this,Jg);E(this,Vd);E(this,Zg);E(this,Gd);E(this,$d);E(this,Qg);E(this,Ze);E(this,In);E(this,jg);E(this,em);E(this,zd);E(this,tm);E(this,Lr);E(this,qd);E(this,Ba,new AbortController);E(this,Bt,null);E(this,He,new Map);E(this,Je,new Map);E(this,Va,null);E(this,Ni,null);E(this,Ga,null);E(this,ln,new vb);E(this,ws,null);E(this,Mr,null);E(this,$a,0);E(this,Pr,new Set);E(this,Zn,null);E(this,Rn,null);E(this,kr,new Set);W(this,"_editorUndoBar",null);E(this,Md,!1);E(this,Pd,!1);E(this,za,!1);E(this,kd,null);E(this,Qn,null);E(this,Ss,null);E(this,qa,null);E(this,_s,!1);E(this,jn,null);E(this,qg,new mb);E(this,Cs,!1);E(this,Nd,!1);E(this,Ts,null);E(this,Nr,null);E(this,Fd,null);E(this,Ld,null);E(this,$e,Z.NONE);E(this,he,new Set);E(this,Fi,null);E(this,Fr,null);E(this,Od,null);E(this,Ud,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});E(this,xs,[0,0]);E(this,ei,null);E(this,Li,null);E(this,Hd,null);E(this,cn,null);let y=this._signal=u(this,Ba).signal;A(this,Li,e),A(this,Hd,t),A(this,Va,n),this._eventBus=s,s._on("editingaction",this.onEditingAction.bind(this),{signal:y}),s._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),s._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),s._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),s._on("setpreference",this.onSetPreference.bind(this),{signal:y}),s._on("switchannotationeditorparams",v=>this.updateParams(v.type,v.value),{signal:y}),S(this,Kg,nx).call(this),S(this,Qg,ox).call(this),S(this,Vd,Ab).call(this),A(this,Ni,r.annotationStorage),A(this,kd,r.filterFactory),A(this,Fr,o),A(this,qa,a||null),A(this,Md,l),A(this,Pd,c),A(this,za,d),A(this,Ld,h||null),this.viewParameters={realScale:ir.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=p||null,this._supportsPinchToZoom=m!==!1}static get _keyboardManager(){let e=Pa.prototype,t=o=>u(o,Li).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),n=(o,{target:a})=>{if(a instanceof HTMLInputElement){let{type:l}=a;return l!=="text"&&l!=="number"}return!0},s=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return ie(this,"_keyboardManager",new Yo([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&u(o,Li).contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&u(o,Li).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,n,s,r;(e=u(this,cn))==null||e.resolve(),A(this,cn,null),(t=u(this,Ba))==null||t.abort(),A(this,Ba,null),this._signal=null;for(let o of u(this,Je).values())o.destroy();u(this,Je).clear(),u(this,He).clear(),u(this,kr).clear(),A(this,Bt,null),u(this,he).clear(),u(this,ln).destroy(),(n=u(this,Va))==null||n.destroy(),(s=u(this,jn))==null||s.hide(),A(this,jn,null),u(this,Qn)&&(clearTimeout(u(this,Qn)),A(this,Qn,null)),u(this,ei)&&(clearTimeout(u(this,ei)),A(this,ei,null)),(r=this._editorUndoBar)==null||r.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return u(this,Ld)}get useNewAltTextFlow(){return u(this,Pd)}get useNewAltTextWhenAddingImage(){return u(this,za)}get hcmFilter(){return ie(this,"hcmFilter",u(this,Fr)?u(this,kd).addHCMFilter(u(this,Fr).foreground,u(this,Fr).background):"none")}get direction(){return ie(this,"direction",getComputedStyle(u(this,Li)).direction)}get highlightColors(){return ie(this,"highlightColors",u(this,qa)?new Map(u(this,qa).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return ie(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),A(this,Mr,e)}setMainHighlightColorPicker(e){A(this,Fd,e)}editAltText(e,t=!1){var n;(n=u(this,Va))==null||n.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":A(this,za,t);break}}onPageChanging({pageNumber:e}){A(this,$a,e-1)}focusMainContainer(){u(this,Li).focus()}findParent(e,t){for(let n of u(this,Je).values()){let{x:s,y:r,width:o,height:a}=n.div.getBoundingClientRect();if(e>=s&&e<=s+o&&t>=r&&t<=r+a)return n}return null}disableUserSelect(e=!1){u(this,Hd).classList.toggle("noUserSelect",e)}addShouldRescale(e){u(this,kr).add(e)}removeShouldRescale(e){u(this,kr).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*ir.PDF_TO_CSS_UNITS;for(let n of u(this,kr))n.onScaleChanging();(t=u(this,Mr))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){let t=document.getSelection();if(!t||t.isCollapsed)return;let{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}=t,a=t.toString(),c=S(this,Wa,kp).call(this,t).closest(".textLayer"),d=this.getSelectionBoxes(c);if(!d)return;t.empty();let h=S(this,Bd,bb).call(this,c),p=u(this,$e)===Z.NONE,m=()=>{h==null||h.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o,text:a}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode(Z.HIGHLIGHT,m);return}m()}addToAnnotationStorage(e){!e.isEmpty()&&u(this,Ni)&&!u(this,Ni).has(e.id)&&u(this,Ni).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,u(this,_s)&&(A(this,_s,!1),S(this,Ya,Np).call(this,"main_toolbar")),!this.hasSelection)return;let{activeElement:e}=document;for(let t of u(this,he))if(t.div.contains(e)){A(this,Nr,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!u(this,Nr))return;let[e,t]=u(this,Nr);A(this,Nr,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){S(this,Vd,Ab).call(this),S(this,Gd,wb).call(this)}removeEditListeners(){S(this,Zg,rx).call(this),S(this,$d,Sb).call(this)}dragOver(e){for(let{type:t}of e.dataTransfer.items)for(let n of u(this,Rn))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(let t of e.dataTransfer.items)for(let n of u(this,Rn))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var n;if(e.preventDefault(),(n=u(this,Bt))==null||n.commitOrRemove(),!this.hasSelection)return;let t=[];for(let s of u(this,he)){let r=s.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();let{clipboardData:t}=e;for(let r of t.items)for(let o of u(this,Rn))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(r){Q(`paste: "${r.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();let s=this.currentLayer;try{let r=[];for(let l of n){let c=await s.deserialize(l);if(!c)return;r.push(c)}let o=()=>{for(let l of r)S(this,zd,_b).call(this,l);S(this,qd,Cb).call(this,r)},a=()=>{for(let l of r)l.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(r){Q(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),u(this,$e)!==Z.NONE&&!this.isEditorHandlingKeyboard&&Pa._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,u(this,_s)&&(A(this,_s,!1),S(this,Ya,Np).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(S(this,Xg,ix).call(this),S(this,Gd,wb).call(this),S(this,Ze,bt).call(this,{isEditing:u(this,$e)!==Z.NONE,isEmpty:S(this,Lr,Wc).call(this),hasSomethingToUndo:u(this,ln).hasSomethingToUndo(),hasSomethingToRedo:u(this,ln).hasSomethingToRedo(),hasSelectedEditor:!1})):(S(this,Jg,sx).call(this),S(this,$d,Sb).call(this),S(this,Ze,bt).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!u(this,Rn)){A(this,Rn,e);for(let t of u(this,Rn))S(this,In,Di).call(this,t.defaultPropertiesToUpdate)}}getId(){return u(this,qg).id}get currentLayer(){return u(this,Je).get(u(this,$a))}getLayer(e){return u(this,Je).get(e)}get currentPageIndex(){return u(this,$a)}addLayer(e){u(this,Je).set(e.pageIndex,e),u(this,Cs)?e.enable():e.disable()}removeLayer(e){u(this,Je).delete(e.pageIndex)}async updateMode(e,t=null,n=!1){var s;if(u(this,$e)!==e&&!(u(this,cn)&&(await u(this,cn).promise,!u(this,cn)))){if(A(this,cn,Promise.withResolvers()),A(this,$e,e),e===Z.NONE){this.setEditingState(!1),S(this,em,lx).call(this),(s=this._editorUndoBar)==null||s.hide(),u(this,cn).resolve();return}this.setEditingState(!0),await S(this,jg,ax).call(this),this.unselectAll();for(let r of u(this,Je).values())r.updateMode(e);if(!t){n&&this.addNewEditorFromKeyboard(),u(this,cn).resolve();return}for(let r of u(this,He).values())r.annotationElementId===t?(this.setSelected(r),r.enterInEditMode()):r.unselect();u(this,cn).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==u(this,$e)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var n;if(u(this,Rn)){switch(e){case oe.CREATE:this.currentLayer.addNewEditor();return;case oe.HIGHLIGHT_DEFAULT_COLOR:(n=u(this,Fd))==null||n.updateColor(t);break;case oe.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(u(this,Od)||A(this,Od,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(let s of u(this,he))s.updateParams(e,t);for(let s of u(this,Rn))s.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){var r,o;for(let a of u(this,He).values())a.editorType===e&&a.show(t);((o=(r=u(this,Od))==null?void 0:r.get(oe.HIGHLIGHT_SHOW_ALL))!=null?o:!0)!==t&&S(this,In,Di).call(this,[[oe.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(u(this,Nd)!==e){A(this,Nd,e);for(let t of u(this,Je).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){let t=[];for(let n of u(this,He).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return u(this,He).get(e)}addEditor(e){u(this,He).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(u(this,Qn)&&clearTimeout(u(this,Qn)),A(this,Qn,setTimeout(()=>{this.focusMainContainer(),A(this,Qn,null)},0))),u(this,He).delete(e.id),this.unselect(e),(!e.annotationElementId||!u(this,Pr).has(e.annotationElementId))&&((t=u(this,Ni))==null||t.remove(e.id))}addDeletedAnnotationElement(e){u(this,Pr).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return u(this,Pr).has(e)}removeDeletedAnnotationElement(e){u(this,Pr).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){u(this,Bt)!==e&&(A(this,Bt,e),e&&S(this,In,Di).call(this,e.propertiesToUpdate))}updateUI(e){u(this,tm,cx)===e&&S(this,In,Di).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){S(this,In,Di).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(u(this,he).has(e)){u(this,he).delete(e),e.unselect(),S(this,Ze,bt).call(this,{hasSelectedEditor:this.hasSelection});return}u(this,he).add(e),e.select(),S(this,In,Di).call(this,e.propertiesToUpdate),S(this,Ze,bt).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=u(this,Mr))==null||t.commitOrRemove();for(let n of u(this,he))n!==e&&n.unselect();u(this,he).clear(),u(this,he).add(e),e.select(),S(this,In,Di).call(this,e.propertiesToUpdate),S(this,Ze,bt).call(this,{hasSelectedEditor:!0})}isSelected(e){return u(this,he).has(e)}get firstSelectedEditor(){return u(this,he).values().next().value}unselect(e){e.unselect(),u(this,he).delete(e),S(this,Ze,bt).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return u(this,he).size!==0}get isEnterHandled(){return u(this,he).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;u(this,ln).undo(),S(this,Ze,bt).call(this,{hasSomethingToUndo:u(this,ln).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:S(this,Lr,Wc).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){u(this,ln).redo(),S(this,Ze,bt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:u(this,ln).hasSomethingToRedo(),isEmpty:S(this,Lr,Wc).call(this)})}addCommands(e){u(this,ln).add(e),S(this,Ze,bt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:S(this,Lr,Wc).call(this)})}cleanUndoStack(e){u(this,ln).cleanType(e)}delete(){var r;this.commitOrRemove();let e=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!e)return;let t=e?[e]:[...u(this,he)],n=()=>{var o;(o=this._editorUndoBar)==null||o.show(s,t.length===1?t[0].editorType:t.length);for(let a of t)a.remove()},s=()=>{for(let o of t)S(this,zd,_b).call(this,o)};this.addCommands({cmd:n,undo:s,mustExec:!0})}commitOrRemove(){var e;(e=u(this,Bt))==null||e.commitOrRemove()}hasSomethingToControl(){return u(this,Bt)||this.hasSelection}selectAll(){for(let e of u(this,he))e.commit();S(this,qd,Cb).call(this,u(this,He).values())}unselectAll(){var e;if(!(u(this,Bt)&&(u(this,Bt).commitOrRemove(),u(this,$e)!==Z.NONE))&&!((e=u(this,Mr))!=null&&e.commitOrRemove())&&this.hasSelection){for(let t of u(this,he))t.unselect();u(this,he).clear(),S(this,Ze,bt).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;u(this,xs)[0]+=e,u(this,xs)[1]+=t;let[s,r]=u(this,xs),o=[...u(this,he)],a=1e3;u(this,ei)&&clearTimeout(u(this,ei)),A(this,ei,setTimeout(()=>{A(this,ei,null),u(this,xs)[0]=u(this,xs)[1]=0,this.addCommands({cmd:()=>{for(let l of o)u(this,He).has(l.id)&&l.translateInPage(s,r)},undo:()=>{for(let l of o)u(this,He).has(l.id)&&l.translateInPage(-s,-r)},mustExec:!1})},a));for(let l of o)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),A(this,Zn,new Map);for(let e of u(this,he))u(this,Zn).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!u(this,Zn))return!1;this.disableUserSelect(!1);let e=u(this,Zn);A(this,Zn,null);let t=!1;for(let[{x:s,y:r,pageIndex:o},a]of e)a.newX=s,a.newY=r,a.newPageIndex=o,t||(t=s!==a.savedX||r!==a.savedY||o!==a.savedPageIndex);if(!t)return!1;let n=(s,r,o,a)=>{if(u(this,He).has(s.id)){let l=u(this,Je).get(a);l?s._setParentAndPosition(l,r,o):(s.pageIndex=a,s.x=r,s.y=o)}};return this.addCommands({cmd:()=>{for(let[s,{newX:r,newY:o,newPageIndex:a}]of e)n(s,r,o,a)},undo:()=>{for(let[s,{savedX:r,savedY:o,savedPageIndex:a}]of e)n(s,r,o,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(u(this,Zn))for(let n of u(this,Zn).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){let t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||u(this,he).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return u(this,Bt)===e}getActive(){return u(this,Bt)}getMode(){return u(this,$e)}get imageManager(){return ie(this,"imageManager",new yb)}getSelectionBoxes(e){if(!e)return null;let t=document.getSelection();for(let c=0,d=t.rangeCount;c<d;c++)if(!e.contains(t.getRangeAt(c).commonAncestorContainer))return null;let{x:n,y:s,width:r,height:o}=e.getBoundingClientRect(),a;switch(e.getAttribute("data-main-rotation")){case"90":a=(c,d,h,p)=>({x:(d-s)/o,y:1-(c+h-n)/r,width:p/o,height:h/r});break;case"180":a=(c,d,h,p)=>({x:1-(c+h-n)/r,y:1-(d+p-s)/o,width:h/r,height:p/o});break;case"270":a=(c,d,h,p)=>({x:1-(d+p-s)/o,y:(c-n)/r,width:p/o,height:h/r});break;default:a=(c,d,h,p)=>({x:(c-n)/r,y:(d-s)/o,width:h/r,height:p/o});break}let l=[];for(let c=0,d=t.rangeCount;c<d;c++){let h=t.getRangeAt(c);if(!h.collapsed)for(let{x:p,y:m,width:y,height:v}of h.getClientRects())y===0||v===0||l.push(a(p,m,y,v))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(u(this,Ga)||A(this,Ga,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=u(this,Ga))==null||t.delete(e)}renderAnnotationElement(e){var s;let t=(s=u(this,Ga))==null?void 0:s.get(e.data.id);if(!t)return;let n=u(this,Ni).getRawValue(t);n&&(u(this,$e)===Z.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}};Ba=new WeakMap,Bt=new WeakMap,He=new WeakMap,Je=new WeakMap,Va=new WeakMap,Ni=new WeakMap,Ga=new WeakMap,ln=new WeakMap,ws=new WeakMap,Mr=new WeakMap,$a=new WeakMap,Pr=new WeakMap,Zn=new WeakMap,Rn=new WeakMap,kr=new WeakMap,Md=new WeakMap,Pd=new WeakMap,za=new WeakMap,kd=new WeakMap,Qn=new WeakMap,Ss=new WeakMap,qa=new WeakMap,_s=new WeakMap,jn=new WeakMap,qg=new WeakMap,Cs=new WeakMap,Nd=new WeakMap,Ts=new WeakMap,Nr=new WeakMap,Fd=new WeakMap,Ld=new WeakMap,$e=new WeakMap,he=new WeakMap,Fi=new WeakMap,Fr=new WeakMap,Od=new WeakMap,Ud=new WeakMap,xs=new WeakMap,ei=new WeakMap,Li=new WeakMap,Hd=new WeakMap,cn=new WeakMap,Wa=new WeakSet,kp=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},Bd=new WeakSet,bb=function(e){let{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(let n of u(this,Je).values())if(n.hasTextLayer(e))return n;return null},Wg=new WeakSet,ex=function(){let e=document.getSelection();if(!e||e.isCollapsed)return;let n=S(this,Wa,kp).call(this,e).closest(".textLayer"),s=this.getSelectionBoxes(n);s&&(u(this,jn)||A(this,jn,new gb(this)),u(this,jn).show(n,s,this.direction==="ltr"))},Yg=new WeakSet,tx=function(){var r,o,a;let e=document.getSelection();if(!e||e.isCollapsed){u(this,Fi)&&((r=u(this,jn))==null||r.hide(),A(this,Fi,null),S(this,Ze,bt).call(this,{hasSelectedText:!1}));return}let{anchorNode:t}=e;if(t===u(this,Fi))return;let s=S(this,Wa,kp).call(this,e).closest(".textLayer");if(!s){u(this,Fi)&&((o=u(this,jn))==null||o.hide(),A(this,Fi,null),S(this,Ze,bt).call(this,{hasSelectedText:!1}));return}if((a=u(this,jn))==null||a.hide(),A(this,Fi,t),S(this,Ze,bt).call(this,{hasSelectedText:!0}),!(u(this,$e)!==Z.HIGHLIGHT&&u(this,$e)!==Z.NONE)&&(u(this,$e)===Z.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),A(this,_s,this.isShiftKeyDown),!this.isShiftKeyDown)){let l=u(this,$e)===Z.HIGHLIGHT?S(this,Bd,bb).call(this,s):null;l==null||l.toggleDrawing();let c=new AbortController,d=this.combinedSignal(c),h=p=>{p.type==="pointerup"&&p.button!==0||(c.abort(),l==null||l.toggleDrawing(!0),p.type==="pointerup"&&S(this,Ya,Np).call(this,"main_toolbar"))};window.addEventListener("pointerup",h,{signal:d}),window.addEventListener("blur",h,{signal:d})}},Ya=new WeakSet,Np=function(e=""){u(this,$e)===Z.HIGHLIGHT?this.highlightSelection(e):u(this,Md)&&S(this,Wg,ex).call(this)},Kg=new WeakSet,nx=function(){document.addEventListener("selectionchange",S(this,Yg,tx).bind(this),{signal:this._signal})},Xg=new WeakSet,ix=function(){if(u(this,Ss))return;A(this,Ss,new AbortController);let e=this.combinedSignal(u(this,Ss));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},Jg=new WeakSet,sx=function(){var e;(e=u(this,Ss))==null||e.abort(),A(this,Ss,null)},Vd=new WeakSet,Ab=function(){if(u(this,Ts))return;A(this,Ts,new AbortController);let e=this.combinedSignal(u(this,Ts));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},Zg=new WeakSet,rx=function(){var e;(e=u(this,Ts))==null||e.abort(),A(this,Ts,null)},Gd=new WeakSet,wb=function(){if(u(this,ws))return;A(this,ws,new AbortController);let e=this.combinedSignal(u(this,ws));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},$d=new WeakSet,Sb=function(){var e;(e=u(this,ws))==null||e.abort(),A(this,ws,null)},Qg=new WeakSet,ox=function(){let e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Ze=new WeakSet,bt=function(e){Object.entries(e).some(([n,s])=>u(this,Ud)[n]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(u(this,Ud),e)}),u(this,$e)===Z.HIGHLIGHT&&e.hasSelectedEditor===!1&&S(this,In,Di).call(this,[[oe.HIGHLIGHT_FREE,!0]]))},In=new WeakSet,Di=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},jg=new WeakSet,ax=async function(){if(!u(this,Cs)){A(this,Cs,!0);let e=[];for(let t of u(this,Je).values())e.push(t.enable());await Promise.all(e);for(let t of u(this,He).values())t.enable()}},em=new WeakSet,lx=function(){if(this.unselectAll(),u(this,Cs)){A(this,Cs,!1);for(let e of u(this,Je).values())e.disable();for(let e of u(this,He).values())e.disable()}},zd=new WeakSet,_b=function(e){let t=u(this,Je).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},tm=new WeakSet,cx=function(){let e=null;for(e of u(this,he));return e},Lr=new WeakSet,Wc=function(){if(u(this,He).size===0)return!0;if(u(this,He).size===1)for(let e of u(this,He).values())return e.isEmpty();return!1},qd=new WeakSet,Cb=function(e){for(let t of u(this,he))t.unselect();u(this,he).clear();for(let t of e)t.isEmpty()||(u(this,he).add(t),t.select());S(this,Ze,bt).call(this,{hasSelectedEditor:this.hasSelection})},W(Pa,"TRANSLATE_SMALL",1),W(Pa,"TRANSLATE_BIG",10);var Ko=Pa,ze,ti,Dn,Ka,ni,Vt,Xa,ii,Dt,Oi,Or,si,Rs,Ur,Yc,Ja,Fp,At=class At{constructor(e){E(this,Ur);E(this,Ja);E(this,ze,null);E(this,ti,!1);E(this,Dn,null);E(this,Ka,null);E(this,ni,null);E(this,Vt,null);E(this,Xa,!1);E(this,ii,null);E(this,Dt,null);E(this,Oi,null);E(this,Or,null);E(this,si,!1);A(this,Dt,e),A(this,si,e._uiManager.useNewAltTextFlow),u(At,Rs)||A(At,Rs,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){var t;(t=At._l10n)!=null||(At._l10n=e)}async render(){let e=A(this,Dn,document.createElement("button"));e.className="altText",e.tabIndex="0";let t=A(this,Ka,document.createElement("span"));e.append(t),u(this,si)?(e.classList.add("new"),e.setAttribute("data-l10n-id",u(At,Rs).missing),t.setAttribute("data-l10n-id",u(At,Rs)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let n=u(this,Dt)._uiManager._signal;e.addEventListener("contextmenu",Gn,{signal:n}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});let s=r=>{r.preventDefault(),u(this,Dt)._uiManager.editAltText(u(this,Dt)),u(this,si)&&u(this,Dt)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:u(this,Ur,Yc)}})};return e.addEventListener("click",s,{capture:!0,signal:n}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(A(this,Xa,!0),s(r))},{signal:n}),await S(this,Ja,Fp).call(this),e}finish(){u(this,Dn)&&(u(this,Dn).focus({focusVisible:u(this,Xa)}),A(this,Xa,!1))}isEmpty(){return u(this,si)?u(this,ze)===null:!u(this,ze)&&!u(this,ti)}hasData(){return u(this,si)?u(this,ze)!==null||!!u(this,Oi):this.isEmpty()}get guessedText(){return u(this,Oi)}async setGuessedText(e){u(this,ze)===null&&(A(this,Oi,e),A(this,Or,await At._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),S(this,Ja,Fp).call(this))}toggleAltTextBadge(e=!1){var t;if(!u(this,si)||u(this,ze)){(t=u(this,ii))==null||t.remove(),A(this,ii,null);return}if(!u(this,ii)){let n=A(this,ii,document.createElement("div"));n.className="noAltTextBadge",u(this,Dt).div.append(n)}u(this,ii).classList.toggle("hidden",!e)}serialize(e){let t=u(this,ze);return!e&&u(this,Oi)===t&&(t=u(this,Or)),{altText:t,decorative:u(this,ti),guessedText:u(this,Oi),textWithDisclaimer:u(this,Or)}}get data(){return{altText:u(this,ze),decorative:u(this,ti)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:s,cancel:r=!1}){n&&(A(this,Oi,n),A(this,Or,s)),!(u(this,ze)===e&&u(this,ti)===t)&&(r||(A(this,ze,e),A(this,ti,t)),S(this,Ja,Fp).call(this))}toggle(e=!1){u(this,Dn)&&(!e&&u(this,Vt)&&(clearTimeout(u(this,Vt)),A(this,Vt,null)),u(this,Dn).disabled=!e)}shown(){u(this,Dt)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:u(this,Ur,Yc)}})}destroy(){var e,t;(e=u(this,Dn))==null||e.remove(),A(this,Dn,null),A(this,Ka,null),A(this,ni,null),(t=u(this,ii))==null||t.remove(),A(this,ii,null)}};ze=new WeakMap,ti=new WeakMap,Dn=new WeakMap,Ka=new WeakMap,ni=new WeakMap,Vt=new WeakMap,Xa=new WeakMap,ii=new WeakMap,Dt=new WeakMap,Oi=new WeakMap,Or=new WeakMap,si=new WeakMap,Rs=new WeakMap,Ur=new WeakSet,Yc=function(){return u(this,ze)&&"added"||u(this,ze)===null&&this.guessedText&&"review"||"missing"},Ja=new WeakSet,Fp=async function(){var s,r,o;let e=u(this,Dn);if(!e)return;if(u(this,si)){if(e.classList.toggle("done",!!u(this,ze)),e.setAttribute("data-l10n-id",u(At,Rs)[u(this,Ur,Yc)]),(s=u(this,Ka))==null||s.setAttribute("data-l10n-id",u(At,Rs)[`${u(this,Ur,Yc)}-label`]),!u(this,ze)){(r=u(this,ni))==null||r.remove();return}}else{if(!u(this,ze)&&!u(this,ti)){e.classList.remove("done"),(o=u(this,ni))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=u(this,ni);if(!t){A(this,ni,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${u(this,Dt).id}`;let a=100,l=u(this,Dt)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(u(this,Vt)),A(this,Vt,null)},{once:!0}),e.addEventListener("mouseenter",()=>{A(this,Vt,setTimeout(()=>{A(this,Vt,null),u(this,ni).classList.add("show"),u(this,Dt)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:l}),e.addEventListener("mouseleave",()=>{var c;u(this,Vt)&&(clearTimeout(u(this,Vt)),A(this,Vt,null)),(c=u(this,ni))==null||c.classList.remove("show")},{signal:l})}u(this,ti)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=u(this,ze)),t.parentNode||e.append(t);let n=u(this,Dt).getImageForAltText();n==null||n.setAttribute("aria-describedby",t.id)},E(At,Rs,null),W(At,"_l10n",null);var lg=At,Wd,Hr,Yd,Kd,Xd,Jd,Zd,Za,Ui,Br,Is,nm,dx,im,ux,Qd,Tb,Dw=class Dw{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:s=null,onPinching:r=null,onPinchEnd:o=null,signal:a}){E(this,nm);E(this,im);E(this,Qd);E(this,Wd,void 0);E(this,Hr,!1);E(this,Yd,null);E(this,Kd,void 0);E(this,Xd,void 0);E(this,Jd,void 0);E(this,Zd,void 0);E(this,Za,void 0);E(this,Ui,null);E(this,Br,void 0);E(this,Is,null);A(this,Wd,e),A(this,Yd,n),A(this,Kd,t),A(this,Xd,s),A(this,Jd,r),A(this,Zd,o),A(this,Br,new AbortController),A(this,Za,AbortSignal.any([a,u(this,Br).signal])),e.addEventListener("touchstart",S(this,nm,dx).bind(this),{passive:!1,signal:u(this,Za)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return ie(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=u(this,Br))==null||e.abort(),A(this,Br,null)}};Wd=new WeakMap,Hr=new WeakMap,Yd=new WeakMap,Kd=new WeakMap,Xd=new WeakMap,Jd=new WeakMap,Zd=new WeakMap,Za=new WeakMap,Ui=new WeakMap,Br=new WeakMap,Is=new WeakMap,nm=new WeakSet,dx=function(e){var s,r,o;if((s=u(this,Kd))!=null&&s.call(this)||e.touches.length<2)return;if(!u(this,Is)){A(this,Is,new AbortController);let a=AbortSignal.any([u(this,Za),u(this,Is).signal]),l=u(this,Wd),c={signal:a,passive:!1};l.addEventListener("touchmove",S(this,im,ux).bind(this),c),l.addEventListener("touchend",S(this,Qd,Tb).bind(this),c),l.addEventListener("touchcancel",S(this,Qd,Tb).bind(this),c),(r=u(this,Xd))==null||r.call(this)}if(jt(e),e.touches.length!==2||(o=u(this,Yd))!=null&&o.call(this)){A(this,Ui,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),A(this,Ui,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},im=new WeakSet,ux=function(e){var T;if(!u(this,Ui)||e.touches.length!==2)return;let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);let{screenX:s,screenY:r}=t,{screenX:o,screenY:a}=n,l=u(this,Ui),{touch0X:c,touch0Y:d,touch1X:h,touch1Y:p}=l,m=h-c,y=p-d,v=o-s,b=a-r,w=Math.hypot(v,b)||1,_=Math.hypot(m,y)||1;if(!u(this,Hr)&&Math.abs(_-w)<=Dw.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=s,l.touch0Y=r,l.touch1X=o,l.touch1Y=a,e.preventDefault(),!u(this,Hr)){A(this,Hr,!0);return}let C=[(s+o)/2,(r+a)/2];(T=u(this,Jd))==null||T.call(this,C,_,w)},Qd=new WeakSet,Tb=function(e){var t;u(this,Is).abort(),A(this,Is,null),(t=u(this,Zd))==null||t.call(this),u(this,Ui)&&(e.preventDefault(),A(this,Ui,null),A(this,Hr,!1))};var cg=Dw,Vr,Mn,ye,Qa,Ds,jd,Gr,Qe,$r,Hi,Ms,eu,zr,Gt,tu,qr,Bi,ri,ja,el,dn,Wr,nu,sm,iu,xb,su,Rb,tl,Lp,rm,hx,om,fx,ru,Ib,nl,Op,ou,Db,am,px,lm,gx,cm,mx,au,Mb,dm,yx,lu,Pb,um,vx,hm,Ex,fm,bx,cu,kb,Yr,Kc,j=class j{constructor(e){E(this,iu);E(this,tl);E(this,rm);E(this,om);E(this,ru);E(this,nl);E(this,ou);E(this,am);E(this,lm);E(this,cm);E(this,au);E(this,dm);E(this,lu);E(this,um);E(this,hm);E(this,fm);E(this,cu);E(this,Yr);E(this,Vr,null);E(this,Mn,null);E(this,ye,null);E(this,Qa,!1);E(this,Ds,null);E(this,jd,"");E(this,Gr,!1);E(this,Qe,null);E(this,$r,null);E(this,Hi,null);E(this,Ms,null);E(this,eu,"");E(this,zr,!1);E(this,Gt,null);E(this,tu,!1);E(this,qr,!1);E(this,Bi,!1);E(this,ri,null);E(this,ja,0);E(this,el,0);E(this,dn,null);E(this,Wr,null);W(this,"_editToolbar",null);W(this,"_initialOptions",Object.create(null));W(this,"_initialData",null);W(this,"_isVisible",!0);W(this,"_uiManager",null);W(this,"_focusEventsAllowed",!0);E(this,nu,!1);E(this,sm,j._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;let{rotation:t,rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,s],this.pageTranslation=[r,o];let[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){let e=j.prototype._resizeWithKeyboard,t=Ko.TRANSLATE_SMALL,n=Ko.TRANSLATE_BIG;return ie(this,"_resizerKeyboardManager",new Yo([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],j.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return ie(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let t=new Nb({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){var s;if((s=j._l10n)!=null||(j._l10n=e),j._l10nResizer||(j._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),j._borderLineWidth!==-1)return;let n=getComputedStyle(document.documentElement);j._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){ge("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return u(this,nu)}set _isDraggable(e){var t;A(this,nu,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){let[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=u(this,sm)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):S(this,Yr,Kc).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(u(this,zr)?A(this,zr,!1):this.parent.setSelected(this))}focusout(e){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;let t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,s){let[r,o]=this.parentDimensions;[n,s]=this.screenToPageTranslation(n,s),this.x=(e+n)/r,this.y=(t+s)/o,this.fixAndSetPosition()}translate(e,t){S(this,iu,xb).call(this,this.parentDimensions,e,t)}translateInPage(e,t){u(this,Gt)||A(this,Gt,[this.x,this.y,this.width,this.height]),S(this,iu,xb).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){u(this,Gt)||A(this,Gt,[this.x,this.y,this.width,this.height]);let{div:n,parentDimensions:[s,r]}=this;if(this.x+=e/s,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:h,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this,[l,c]=this.getBaseTranslation();o+=l,a+=c;let{style:d}=n;d.left=`${(100*o).toFixed(2)}%`,d.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!u(this,Gt)&&(u(this,Gt)[0]!==this.x||u(this,Gt)[1]!==this.y)}get _hasBeenResized(){return!!u(this,Gt)&&(u(this,Gt)[2]!==this.width||u(this,Gt)[3]!==this.height)}getBaseTranslation(){let[e,t]=this.parentDimensions,{_borderLineWidth:n}=j,s=n/e,r=n/t;switch(this.rotation){case 90:return[-s,r];case 180:return[s,r];case 270:return[s,-r];default:return[-s,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){let{div:{style:t},pageDimensions:[n,s]}=this,{x:r,y:o,width:a,height:l}=this;if(a*=n,l*=s,r*=n,o*=s,this._mustFixPosition)switch(e){case 0:r=Math.max(0,Math.min(n-a,r)),o=Math.max(0,Math.min(s-l,o));break;case 90:r=Math.max(0,Math.min(n-l,r)),o=Math.min(s,Math.max(a,o));break;case 180:r=Math.min(n,Math.max(a,r)),o=Math.min(s,Math.max(l,o));break;case 270:r=Math.min(n,Math.max(l,r)),o=Math.max(0,Math.min(s-a,o));break}this.x=r/=n,this.y=o/=s;let[c,d]=this.getBaseTranslation();r+=c,o+=d,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return S(n=j,su,Rb).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return S(n=j,su,Rb).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(e,t){let[n,s]=this.parentDimensions,{style:r}=this.div;r.width=`${(100*e/n).toFixed(2)}%`,u(this,Gr)||(r.height=`${(100*t/s).toFixed(2)}%`)}fixDims(){let{style:e}=this.div,{height:t,width:n}=e,s=n.endsWith("%"),r=!u(this,Gr)&&t.endsWith("%");if(s&&r)return;let[o,a]=this.parentDimensions;s||(e.width=`${(100*parseFloat(n)/o).toFixed(2)}%`),!u(this,Gr)&&!r&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=u(this,ye))==null||e.finish()}async addEditToolbar(){return this._editToolbar||u(this,qr)?this._editToolbar:(this._editToolbar=new fb(this),this.div.append(this._editToolbar.render()),u(this,ye)&&await this._editToolbar.addAltText(u(this,ye)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=u(this,ye))==null||e.destroy())}addContainer(e){var n;let t=(n=this._editToolbar)==null?void 0:n.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){u(this,ye)||(lg.initialize(j._l10n),A(this,ye,new lg(this)),u(this,Vr)&&(u(this,ye).data=u(this,Vr),A(this,Vr,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=u(this,ye))==null?void 0:e.data}set altTextData(e){u(this,ye)&&(u(this,ye).data=e)}get guessedAltText(){var e;return(e=u(this,ye))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=u(this,ye))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=u(this,ye))==null?void 0:t.serialize(e)}hasAltText(){return!!u(this,ye)&&!u(this,ye).isEmpty()}hasAltTextData(){var e,t;return(t=(e=u(this,ye))==null?void 0:e.hasData())!=null?t:!1}render(){var r;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=u(this,Qa)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),S(this,lu,Pb).call(this);let[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);let[n,s]=this.getInitialTranslation();return this.translate(n,s),ag(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(u(this,Wr)||A(this,Wr,new cg({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:S(this,am,px).bind(this),onPinching:S(this,lm,gx).bind(this),onPinchEnd:S(this,cm,mx).bind(this),signal:this._uiManager._signal}))),(r=this._uiManager._editorUndoBar)==null||r.hide(),this.div}pointerdown(e){let{isMac:t}=nt.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(A(this,zr,!0),this._isDraggable){S(this,dm,yx).call(this,e);return}S(this,au,Mb).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){u(this,ri)&&clearTimeout(u(this,ri)),A(this,ri,setTimeout(()=>{var e;A(this,ri,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){let s=this.parentScale,[r,o]=this.pageDimensions,[a,l]=this.pageTranslation,c=e/s,d=t/s,h=this.x*r,p=this.y*o,m=this.width*r,y=this.height*o;switch(n){case 0:return[h+c+a,o-p-d-y+l,h+c+m+a,o-p-d+l];case 90:return[h+d+a,o-p+c+l,h+d+y+a,o-p+c+m+l];case 180:return[h-c-m+a,o-p+d+l,h-c+a,o-p+d+y+l];case 270:return[h-d-y+a,o-p-c-m+l,h-d+a,o-p-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){let[n,s,r,o]=e,a=r-n,l=o-s;switch(this.rotation){case 0:return[n,t-o,a,l];case 90:return[n,t-s,l,a];case 180:return[r,t-s,a,l];case 270:return[r,t-o,l,a];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){A(this,qr,!0)}disableEditMode(){A(this,qr,!1)}isInEditMode(){return u(this,qr)}shouldGetKeyboardEvents(){return u(this,Bi)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:e,left:t,bottom:n,right:s}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&s>0&&e<r&&n>0}rebuild(){S(this,lu,Pb).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){ge("An editor must be serializable")}static async deserialize(e,t,n){let s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n});s.rotation=e.rotation,A(s,Vr,e.accessibilityData);let[r,o]=s.pageDimensions,[a,l,c,d]=s.getRectInCurrentCoords(e.rect,o);return s.x=a/r,s.y=l/o,s.width=c/r,s.height=d/o,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=u(this,Ms))==null||e.abort(),A(this,Ms,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),u(this,ri)&&(clearTimeout(u(this,ri)),A(this,ri,null)),S(this,Yr,Kc).call(this),this.removeEditToolbar(),u(this,dn)){for(let n of u(this,dn).values())clearTimeout(n);A(this,dn,null)}this.parent=null,(t=u(this,Wr))==null||t.destroy(),A(this,Wr,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(S(this,rm,hx).call(this),u(this,Qe).classList.remove("hidden"),ag(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),A(this,Hi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let t=u(this,Qe).children;if(!u(this,Mn)){A(this,Mn,Array.from(t));let o=S(this,um,vx).bind(this),a=S(this,hm,Ex).bind(this),l=this._uiManager._signal;for(let c of u(this,Mn)){let d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",o,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",S(this,fm,bx).bind(this,d),{signal:l}),c.setAttribute("data-l10n-id",j._l10nResizer[d])}}let n=u(this,Mn)[0],s=0;for(let o of t){if(o===n)break;s++}let r=(360-this.rotation+this.parentRotation)%360/90*(u(this,Mn).length/4);if(r!==s){if(r<s)for(let a=0;a<s-r;a++)u(this,Qe).append(u(this,Qe).firstChild);else if(r>s)for(let a=0;a<r-s;a++)u(this,Qe).firstChild.before(u(this,Qe).lastChild);let o=0;for(let a of t){let c=u(this,Mn)[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",j._l10nResizer[c])}}S(this,cu,kb).call(this,0),A(this,Bi,!0),u(this,Qe).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){u(this,Bi)&&S(this,ou,Db).call(this,u(this,eu),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){S(this,Yr,Kc).call(this),this.div.focus()}select(){var e,t,n;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var s,r;(s=this.div)!=null&&s.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(n=u(this,ye))==null||n.toggleAltTextBadge(!1)}unselect(){var e,t,n,s,r;(e=u(this,Qe))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(s=this._editToolbar)==null||s.hide(),(r=u(this,ye))==null||r.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return u(this,tu)}set isEditing(e){A(this,tu,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){A(this,Gr,!0);let n=e/t,{style:s}=this.div;s.aspectRatio=n,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){u(this,dn)||A(this,dn,new Map);let{action:n}=e,s=u(this,dn).get(n);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),u(this,dn).delete(n),u(this,dn).size===0&&A(this,dn,null)},j._telemetryTimeout),u(this,dn).set(n,s);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),A(this,Qa,!1)}disable(){this.div&&(this.div.tabIndex=-1),A(this,Qa,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){let n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){let{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Vr=new WeakMap,Mn=new WeakMap,ye=new WeakMap,Qa=new WeakMap,Ds=new WeakMap,jd=new WeakMap,Gr=new WeakMap,Qe=new WeakMap,$r=new WeakMap,Hi=new WeakMap,Ms=new WeakMap,eu=new WeakMap,zr=new WeakMap,Gt=new WeakMap,tu=new WeakMap,qr=new WeakMap,Bi=new WeakMap,ri=new WeakMap,ja=new WeakMap,el=new WeakMap,dn=new WeakMap,Wr=new WeakMap,nu=new WeakMap,sm=new WeakMap,iu=new WeakSet,xb=function([e,t],n,s){[n,s]=this.screenToPageTranslation(n,s),this.x+=n/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},su=new WeakSet,Rb=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},tl=new WeakSet,Lp=function(e){switch(e){case 90:{let[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{let[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},rm=new WeakSet,hx=function(){if(u(this,Qe))return;A(this,Qe,document.createElement("div")),u(this,Qe).classList.add("resizers");let e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(let n of e){let s=document.createElement("div");u(this,Qe).append(s),s.classList.add("resizer",n),s.setAttribute("data-resizer-name",n),s.addEventListener("pointerdown",S(this,om,fx).bind(this,n),{signal:t}),s.addEventListener("contextmenu",Gn,{signal:t}),s.tabIndex=-1}this.div.prepend(u(this,Qe))},om=new WeakSet,fx=function(e,t){var d;t.preventDefault();let{isMac:n}=nt.platform;if(t.button!==0||t.ctrlKey&&n)return;(d=u(this,ye))==null||d.toggle(!1);let s=this._isDraggable;this._isDraggable=!1,A(this,$r,[t.screenX,t.screenY]);let r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",S(this,ou,Db).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",jt,{passive:!1,signal:o}),window.addEventListener("contextmenu",Gn,{signal:o}),A(this,Hi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;let c=()=>{var h;r.abort(),this.parent.togglePointerEvents(!0),(h=u(this,ye))==null||h.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=a,this.div.style.cursor=l,S(this,nl,Op).call(this)};window.addEventListener("pointerup",c,{signal:o}),window.addEventListener("blur",c,{signal:o})},ru=new WeakSet,Ib=function(e,t,n,s){this.width=n,this.height=s,this.x=e,this.y=t;let[r,o]=this.parentDimensions;this.setDims(r*n,o*s),this.fixAndSetPosition(),this._onResized()},nl=new WeakSet,Op=function(){if(!u(this,Hi))return;let{savedX:e,savedY:t,savedWidth:n,savedHeight:s}=u(this,Hi);A(this,Hi,null);let r=this.x,o=this.y,a=this.width,l=this.height;r===e&&o===t&&a===n&&l===s||this.addCommands({cmd:S(this,ru,Ib).bind(this,r,o,a,l),undo:S(this,ru,Ib).bind(this,e,t,n,s),mustExec:!0})},ou=new WeakSet,Db=function(e,t){let[n,s]=this.parentDimensions,r=this.x,o=this.y,a=this.width,l=this.height,c=j.MIN_SIZE/n,d=j.MIN_SIZE/s,h=S(this,tl,Lp).call(this,this.rotation),p=(L,q)=>[h[0]*L+h[2]*q,h[1]*L+h[3]*q],m=S(this,tl,Lp).call(this,360-this.rotation),y=(L,q)=>[m[0]*L+m[2]*q,m[1]*L+m[3]*q],v,b,w=!1,_=!1;switch(e){case"topLeft":w=!0,v=(L,q)=>[0,0],b=(L,q)=>[L,q];break;case"topMiddle":v=(L,q)=>[L/2,0],b=(L,q)=>[L/2,q];break;case"topRight":w=!0,v=(L,q)=>[L,0],b=(L,q)=>[0,q];break;case"middleRight":_=!0,v=(L,q)=>[L,q/2],b=(L,q)=>[0,q/2];break;case"bottomRight":w=!0,v=(L,q)=>[L,q],b=(L,q)=>[0,0];break;case"bottomMiddle":v=(L,q)=>[L/2,q],b=(L,q)=>[L/2,0];break;case"bottomLeft":w=!0,v=(L,q)=>[0,q],b=(L,q)=>[L,0];break;case"middleLeft":_=!0,v=(L,q)=>[0,q/2],b=(L,q)=>[L,q/2];break}let C=v(a,l),T=b(a,l),R=p(...T),D=j._round(r+R[0]),I=j._round(o+R[1]),k=1,N=1,F,U;if(t.fromKeyboard)({deltaX:F,deltaY:U}=t);else{let{screenX:L,screenY:q}=t,[Ht,Wn]=u(this,$r);[F,U]=this.screenToPageTranslation(L-Ht,q-Wn),u(this,$r)[0]=L,u(this,$r)[1]=q}if([F,U]=y(F/n,U/s),w){let L=Math.hypot(a,l);k=N=Math.max(Math.min(Math.hypot(T[0]-C[0]-F,T[1]-C[1]-U)/L,1/a,1/l),c/a,d/l)}else _?k=Math.max(c,Math.min(1,Math.abs(T[0]-C[0]-F)))/a:N=Math.max(d,Math.min(1,Math.abs(T[1]-C[1]-U)))/l;let re=j._round(a*k),X=j._round(l*N);R=p(...b(re,X));let J=D-R[0],Ge=I-R[1];u(this,Gt)||A(this,Gt,[this.x,this.y,this.width,this.height]),this.width=re,this.height=X,this.x=J,this.y=Ge,this.setDims(n*re,s*X),this.fixAndSetPosition(),this._onResizing()},am=new WeakSet,px=function(){var e;A(this,Hi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=u(this,ye))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},lm=new WeakSet,gx=function(e,t,n){let r=.7*(n/t)+1-.7;if(r===1)return;let o=S(this,tl,Lp).call(this,this.rotation),a=(D,I)=>[o[0]*D+o[2]*I,o[1]*D+o[3]*I],[l,c]=this.parentDimensions,d=this.x,h=this.y,p=this.width,m=this.height,y=j.MIN_SIZE/l,v=j.MIN_SIZE/c;r=Math.max(Math.min(r,1/p,1/m),y/p,v/m);let b=j._round(p*r),w=j._round(m*r);if(b===p&&w===m)return;u(this,Gt)||A(this,Gt,[d,h,p,m]);let _=a(p/2,m/2),C=j._round(d+_[0]),T=j._round(h+_[1]),R=a(b/2,w/2);this.x=C-R[0],this.y=T-R[1],this.width=b,this.height=w,this.setDims(l*b,c*w),this.fixAndSetPosition(),this._onResizing()},cm=new WeakSet,mx=function(){var e;(e=u(this,ye))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),S(this,nl,Op).call(this)},au=new WeakSet,Mb=function(e){let{isMac:t}=nt.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},dm=new WeakSet,yx=function(e){let{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1,s=new AbortController,r=this._uiManager.combinedSignal(s),o={capture:!0,passive:!1,signal:r},a=c=>{s.abort(),A(this,Ds,null),A(this,zr,!1),this._uiManager.endDragSession()||S(this,au,Mb).call(this,c),n&&this._onStopDragging()};t&&(A(this,ja,e.clientX),A(this,el,e.clientY),A(this,Ds,e.pointerId),A(this,jd,e.pointerType),window.addEventListener("pointermove",c=>{n||(n=!0,this._onStartDragging());let{clientX:d,clientY:h,pointerId:p}=c;if(p!==u(this,Ds)){jt(c);return}let[m,y]=this.screenToPageTranslation(d-u(this,ja),h-u(this,el));A(this,ja,d),A(this,el,h),this._uiManager.dragSelectedEditors(m,y)},o),window.addEventListener("touchmove",jt,o),window.addEventListener("pointerdown",c=>{c.pointerType===u(this,jd)&&(u(this,Wr)||c.isPrimary)&&a(c),jt(c)},o));let l=c=>{if(!u(this,Ds)||u(this,Ds)===c.pointerId){a(c);return}jt(c)};window.addEventListener("pointerup",l,{signal:r}),window.addEventListener("blur",l,{signal:r})},lu=new WeakSet,Pb=function(){if(u(this,Ms)||!this.div)return;A(this,Ms,new AbortController);let e=this._uiManager.combinedSignal(u(this,Ms));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},um=new WeakSet,vx=function(e){j._resizerKeyboardManager.exec(this,e)},hm=new WeakSet,Ex=function(e){var t;u(this,Bi)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==u(this,Qe)&&S(this,Yr,Kc).call(this)},fm=new WeakSet,bx=function(e){A(this,eu,u(this,Bi)?e:"")},cu=new WeakSet,kb=function(e){if(u(this,Mn))for(let t of u(this,Mn))t.tabIndex=e},Yr=new WeakSet,Kc=function(){A(this,Bi,!1),S(this,cu,kb).call(this,-1),S(this,nl,Op).call(this)},E(j,su),W(j,"_l10n",null),W(j,"_l10nResizer",null),W(j,"_borderLineWidth",-1),W(j,"_colorManager",new Eb),W(j,"_zIndex",1),W(j,"_telemetryTimeout",1e3);var _e=j,Nb=class extends _e{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},D0=3285377520,an=4294901760,Xn=65535,dg=class{constructor(e){this.h1=e?e&4294967295:D0,this.h2=e?e&4294967295:D0}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let v=0,b=e.length;v<b;v++){let w=e.charCodeAt(v);w<=255?t[n++]=w:(t[n++]=w>>>8,t[n++]=w&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let s=n>>2,r=n-s*4,o=new Uint32Array(t.buffer,0,s),a=0,l=0,c=this.h1,d=this.h2,h=3432918353,p=461845907,m=h&Xn,y=p&Xn;for(let v=0;v<s;v++)v&1?(a=o[v],a=a*h&an|a*m&Xn,a=a<<15|a>>>17,a=a*p&an|a*y&Xn,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=o[v],l=l*h&an|l*m&Xn,l=l<<15|l>>>17,l=l*p&an|l*y&Xn,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(a=0,r){case 3:a^=t[s*4+2]<<16;case 2:a^=t[s*4+1]<<8;case 1:a^=t[s*4],a=a*h&an|a*m&Xn,a=a<<15|a>>>17,a=a*p&an|a*y&Xn,s&1?c^=a:d^=a}this.h1=c,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&an|e*36045&Xn,t=t*4283543511&an|((t<<16|e>>>16)*2950163797&an)>>>16,e^=t>>>1,e=e*444984403&an|e*60499&Xn,t=t*3301882366&an|((t<<16|e>>>16)*3120437893&an)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}},Fb=Object.freeze({map:null,hash:"",transfer:void 0}),Kr,Xr,qe,pm,Ax,pd=class{constructor(){E(this,pm);E(this,Kr,!1);E(this,Xr,null);E(this,qe,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let n=u(this,qe).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return u(this,qe).get(e)}remove(e){if(u(this,qe).delete(e),u(this,qe).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let t of u(this,qe).values())if(t instanceof _e)return;this.onAnnotationEditor(null)}}setValue(e,t){let n=u(this,qe).get(e),s=!1;if(n!==void 0)for(let[r,o]of Object.entries(t))n[r]!==o&&(s=!0,n[r]=o);else s=!0,u(this,qe).set(e,t);s&&S(this,pm,Ax).call(this),t instanceof _e&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return u(this,qe).has(e)}getAll(){return u(this,qe).size>0?Cw(u(this,qe)):null}setAll(e){for(let[t,n]of Object.entries(e))this.setValue(t,n)}get size(){return u(this,qe).size}resetModified(){u(this,Kr)&&(A(this,Kr,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new ug(this)}get serializable(){if(u(this,qe).size===0)return Fb;let e=new Map,t=new dg,n=[],s=Object.create(null),r=!1;for(let[o,a]of u(this,qe)){let l=a instanceof _e?a.serialize(!1,s):a;l&&(e.set(o,l),t.update(`${o}:${JSON.stringify(l)}`),r||(r=!!l.bitmap))}if(r)for(let o of e.values())o.bitmap&&n.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:Fb}get editorStats(){var n;let e=null,t=new Map;for(let s of u(this,qe).values()){if(!(s instanceof _e))continue;let r=s.telemetryFinalData;if(!r)continue;let{type:o}=r;t.has(o)||t.set(o,Object.getPrototypeOf(s).constructor),e||(e=Object.create(null));let a=e[o]||(e[o]=new Map);for(let[l,c]of Object.entries(r)){if(l==="type")continue;let d=a.get(l);d||(d=new Map,a.set(l,d));let h=(n=d.get(c))!=null?n:0;d.set(c,h+1)}}for(let[s,r]of t)e[s]=r.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){A(this,Xr,null)}get modifiedIds(){if(u(this,Xr))return u(this,Xr);let e=[];for(let t of u(this,qe).values())!(t instanceof _e)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return A(this,Xr,{ids:new Set(e),hash:e.join(",")})}};Kr=new WeakMap,Xr=new WeakMap,qe=new WeakMap,pm=new WeakSet,Ax=function(){u(this,Kr)||(A(this,Kr,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var du,ug=class extends pd{constructor(t){super();E(this,du,void 0);let{map:n,hash:s,transfer:r}=t.serializable,o=structuredClone(n,r?{transfer:r}:null);A(this,du,{map:o,hash:s,transfer:r})}get print(){ge("Should not call PrintAnnotationStorage.print")}get serializable(){return u(this,du)}get modifiedIds(){return ie(this,"modifiedIds",{ids:new Set,hash:""})}};du=new WeakMap;var il,Lb=class{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){E(this,il,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),u(this,il).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||u(this,il).has(e.loadedName))){if(ke(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:n,src:s,style:r}=e,o=new FontFace(n,s,r);this.addNativeFontFace(o);try{await o.load(),u(this,il).add(n),t==null||t(e)}catch(a){Q(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}ge("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){let n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(s){throw Q(`Failed to load font '${n.family}': '${s}'.`),e.disableFontFace=!0,s}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{let s=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,s)})}}get isFontLoadingAPISupported(){var t;let e=!!((t=this._document)!=null&&t.fonts);return ie(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(mt||typeof navigator!="undefined"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),ie(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(ke(!s.done,"completeRequest() cannot be called twice."),s.done=!0;n.length>0&&n[0].done;){let r=n.shift();setTimeout(r.callback,0)}}let{loadingRequests:n}=this,s={done:!1,complete:t,callback:e};return n.push(s),s}get _loadTestFont(){let e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return ie(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(T,R){return T.charCodeAt(R)<<24|T.charCodeAt(R+1)<<16|T.charCodeAt(R+2)<<8|T.charCodeAt(R+3)&255}function s(T,R,D,I){let k=T.substring(0,R),N=T.substring(R+D);return k+I+N}let r,o,a=this._document.createElement("canvas");a.width=1,a.height=1;let l=a.getContext("2d"),c=0;function d(T,R){if(++c>30){Q("Load test font never loaded."),R();return}if(l.font="30px "+T,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){R();return}setTimeout(d.bind(null,T,R))}let h=`lt${Date.now()}${this.loadTestFontId++}`,p=this._loadTestFont;p=s(p,976,h.length,h);let y=16,v=1482184792,b=n(p,y);for(r=0,o=h.length-3;r<o;r+=4)b=b-v+n(h,r)|0;r<h.length&&(b=b-v+n(h+"XXX",r)|0),p=s(p,y,4,sO(b));let w=`url(data:font/opentype;base64,${btoa(p)});`,_=`@font-face {font-family:"${h}";src:${w}}`;this.insertRule(_);let C=this._document.createElement("div");C.style.visibility="hidden",C.style.width=C.style.height="10px",C.style.position="absolute",C.style.top=C.style.left="0px";for(let T of[e.loadedName,h]){let R=this._document.createElement("span");R.textContent="Hi",R.style.fontFamily=T,C.append(R)}this._document.body.append(C),d(h,()=>{C.remove(),t.complete()})}};il=new WeakMap;var Ob=class{constructor(e,{disableFontFace:t=!1,fontExtraProperties:n=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(let r in e)this[r]=e[r];this.disableFontFace=t===!0,this.fontExtraProperties=n===!0,this._inspectFont=s}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{let n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;let e=`url(data:${this.mimetype};base64,${dO(this.data)});`,t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${e}}`}return(n=this._inspectFont)==null||n.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let n=this.loadedName+"_path_"+t,s;try{s=e.get(n)}catch(o){Q(`getPathGenerator - ignoring character: "${o}".`)}let r=new Path2D(s||"");return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=r}},_p={DATA:1,ERROR:2},Pe={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function M0(){}function Rt(i){if(i instanceof gi||i instanceof dd||i instanceof qo||i instanceof rg||i instanceof hc||i instanceof ad)return i;switch(i instanceof Error||typeof i=="object"&&i!==null||ge('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),i.name){case"AbortException":return new gi(i.message);case"InvalidPDFException":return new dd(i.message);case"MissingPDFException":return new qo(i.message);case"PasswordException":return new rg(i.message,i.code);case"UnexpectedResponseException":return new hc(i.message,i.status);case"UnknownErrorException":return new ad(i.message,i.details)}return new ad(i.message,i.toString())}var sl,gm,wx,mm,Sx,ym,_x,rl,Up,Tr=class{constructor(e,t,n){E(this,gm);E(this,mm);E(this,ym);E(this,rl);E(this,sl,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",S(this,gm,wx).bind(this),{signal:u(this,sl).signal})}on(e,t){let n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){let s=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[s]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},n)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,n,s){let r=this.streamId++,o=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{let d=Promise.withResolvers();return this.streamControllers[r]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:o,targetName:a,action:e,streamId:r,data:t,desiredSize:c.desiredSize},s),d.promise},pull:c=>{let d=Promise.withResolvers();return this.streamControllers[r].pullCall=d,l.postMessage({sourceName:o,targetName:a,stream:Pe.PULL,streamId:r,desiredSize:c.desiredSize}),d.promise},cancel:c=>{ke(c instanceof Error,"cancel must have a valid reason");let d=Promise.withResolvers();return this.streamControllers[r].cancelCall=d,this.streamControllers[r].isClosed=!0,l.postMessage({sourceName:o,targetName:a,stream:Pe.CANCEL,streamId:r,reason:Rt(c)}),d.promise}},n)}destroy(){var e;(e=u(this,sl))==null||e.abort(),A(this,sl,null)}};sl=new WeakMap,gm=new WeakSet,wx=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){S(this,ym,_x).call(this,e);return}if(e.callback){let n=e.callbackId,s=this.callbackCapabilities[n];if(!s)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===_p.DATA)s.resolve(e.data);else if(e.callback===_p.ERROR)s.reject(Rt(e.reason));else throw new Error("Unexpected callback case");return}let t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){let n=this.sourceName,s=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:n,targetName:s,callback:_p.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:n,targetName:s,callback:_p.ERROR,callbackId:e.callbackId,reason:Rt(o)})});return}if(e.streamId){S(this,mm,Sx).call(this,e);return}t(e.data)},mm=new WeakSet,Sx=function(e){let t=e.streamId,n=this.sourceName,s=e.sourceName,r=this.comObj,o=this,a=this.actionHandler[e.action],l={enqueue(c,d=1,h){if(this.isCancelled)return;let p=this.desiredSize;this.desiredSize-=d,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:n,targetName:s,stream:Pe.ENQUEUE,streamId:t,chunk:c},h)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:Pe.CLOSE,streamId:t}),delete o.streamSinks[t])},error(c){ke(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:Pe.ERROR,streamId:t,reason:Rt(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){r.postMessage({sourceName:n,targetName:s,stream:Pe.START_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:n,targetName:s,stream:Pe.START_COMPLETE,streamId:t,reason:Rt(c)})})},ym=new WeakSet,_x=function(e){let t=e.streamId,n=this.sourceName,s=e.sourceName,r=this.comObj,o=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case Pe.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(Rt(e.reason));break;case Pe.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(Rt(e.reason));break;case Pe.PULL:if(!a){r.postMessage({sourceName:n,targetName:s,stream:Pe.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||M0).then(function(){r.postMessage({sourceName:n,targetName:s,stream:Pe.PULL_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:n,targetName:s,stream:Pe.PULL_COMPLETE,streamId:t,reason:Rt(c)})});break;case Pe.ENQUEUE:if(ke(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case Pe.CLOSE:if(ke(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),S(this,rl,Up).call(this,o,t);break;case Pe.ERROR:ke(o,"error should have stream controller"),o.controller.error(Rt(e.reason)),S(this,rl,Up).call(this,o,t);break;case Pe.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(Rt(e.reason)),S(this,rl,Up).call(this,o,t);break;case Pe.CANCEL:if(!a)break;let l=Rt(e.reason);Promise.try(a.onCancel||M0,l).then(function(){r.postMessage({sourceName:n,targetName:s,stream:Pe.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:n,targetName:s,stream:Pe.CANCEL_COMPLETE,streamId:t,reason:Rt(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},rl=new WeakSet,Up=async function(e,t){var n,s,r;await Promise.allSettled([(n=e.startCall)==null?void 0:n.promise,(s=e.pullCall)==null?void 0:s.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]};var uu,hg=class{constructor({enableHWA:e=!1}){E(this,uu,!1);A(this,uu,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");let n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!u(this,uu)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){ge("Abstract method `_createCanvas` called.")}};uu=new WeakMap;var Ub=class extends hg{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){let n=this._document.createElement("canvas");return n.width=e,n.height=t,n}},fg=class{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");let t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){ge("Abstract method `_fetch` called.")}},pg=class extends fg{async _fetch(e){let t=await Sy(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):wy(t)}},gg=class{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,s,r){return"none"}destroy(e=!1){}},Jr,ol,Vi,Gi,ht,Zr,Qr,We,ct,jr,Xc,Ps,Ca,al,Hp,ks,Ta,vm,Cx,hu,Bb,Ns,xa,eo,Jc,to,Zc,fu,Vb,no,Qc,Hb=class extends gg{constructor({docId:t,ownerDocument:n=globalThis.document}){super();E(this,We);E(this,jr);E(this,Ps);E(this,al);E(this,ks);E(this,vm);E(this,hu);E(this,Ns);E(this,eo);E(this,to);E(this,fu);E(this,no);E(this,Jr,void 0);E(this,ol,void 0);E(this,Vi,void 0);E(this,Gi,void 0);E(this,ht,void 0);E(this,Zr,void 0);E(this,Qr,0);A(this,Gi,t),A(this,ht,n)}addFilter(t){if(!t)return"none";let n=u(this,We,ct).get(t);if(n)return n;let[s,r,o]=S(this,al,Hp).call(this,t),a=t.length===1?s:`${s}${r}${o}`;if(n=u(this,We,ct).get(a),n)return u(this,We,ct).set(t,n),n;let l=`g_${u(this,Gi)}_transfer_map_${vt(this,Qr)._++}`,c=S(this,ks,Ta).call(this,l);u(this,We,ct).set(t,c),u(this,We,ct).set(a,c);let d=S(this,Ns,xa).call(this,l);return S(this,to,Zc).call(this,s,r,o,d),c}addHCMFilter(t,n){var y;let s=`${t}-${n}`,r="base",o=u(this,jr,Xc).get(r);if((o==null?void 0:o.key)===s||(o?((y=o.filter)==null||y.remove(),o.key=s,o.url="none",o.filter=null):(o={key:s,url:"none",filter:null},u(this,jr,Xc).set(r,o)),!t||!n))return o.url;let a=S(this,no,Qc).call(this,t);t=V.makeHexColor(...a);let l=S(this,no,Qc).call(this,n);if(n=V.makeHexColor(...l),u(this,Ps,Ca).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return o.url;let c=new Array(256);for(let v=0;v<=255;v++){let b=v/255;c[v]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}let d=c.join(","),h=`g_${u(this,Gi)}_hcm_filter`,p=o.filter=S(this,Ns,xa).call(this,h);S(this,to,Zc).call(this,d,d,d,p),S(this,hu,Bb).call(this,p);let m=(v,b)=>{let w=a[v]/255,_=l[v]/255,C=new Array(b+1);for(let T=0;T<=b;T++)C[T]=w+T/b*(_-w);return C.join(",")};return S(this,to,Zc).call(this,m(0,5),m(1,5),m(2,5),p),o.url=S(this,ks,Ta).call(this,h),o.url}addAlphaFilter(t){let n=u(this,We,ct).get(t);if(n)return n;let[s]=S(this,al,Hp).call(this,[t]),r=`alpha_${s}`;if(n=u(this,We,ct).get(r),n)return u(this,We,ct).set(t,n),n;let o=`g_${u(this,Gi)}_alpha_map_${vt(this,Qr)._++}`,a=S(this,ks,Ta).call(this,o);u(this,We,ct).set(t,a),u(this,We,ct).set(r,a);let l=S(this,Ns,xa).call(this,o);return S(this,fu,Vb).call(this,s,l),a}addLuminosityFilter(t){let n=u(this,We,ct).get(t||"luminosity");if(n)return n;let s,r;if(t?([s]=S(this,al,Hp).call(this,[t]),r=`luminosity_${s}`):r="luminosity",n=u(this,We,ct).get(r),n)return u(this,We,ct).set(t,n),n;let o=`g_${u(this,Gi)}_luminosity_map_${vt(this,Qr)._++}`,a=S(this,ks,Ta).call(this,o);u(this,We,ct).set(t,a),u(this,We,ct).set(r,a);let l=S(this,Ns,xa).call(this,o);return S(this,vm,Cx).call(this,l),t&&S(this,fu,Vb).call(this,s,l),a}addHighlightHCMFilter(t,n,s,r,o){var _;let a=`${n}-${s}-${r}-${o}`,l=u(this,jr,Xc).get(t);if((l==null?void 0:l.key)===a||(l?((_=l.filter)==null||_.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},u(this,jr,Xc).set(t,l)),!n||!s))return l.url;let[c,d]=[n,s].map(S(this,no,Qc).bind(this)),h=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),p=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[m,y]=[r,o].map(S(this,no,Qc).bind(this));p<h&&([h,p,m,y]=[p,h,y,m]),u(this,Ps,Ca).style.color="";let v=(C,T,R)=>{let D=new Array(256),I=(p-h)/R,k=C/255,N=(T-C)/(255*R),F=0;for(let U=0;U<=R;U++){let re=Math.round(h+U*I),X=k+U*N;for(let J=F;J<=re;J++)D[J]=X;F=re+1}for(let U=F;U<256;U++)D[U]=D[F-1];return D.join(",")},b=`g_${u(this,Gi)}_hcm_${t}_filter`,w=l.filter=S(this,Ns,xa).call(this,b);return S(this,hu,Bb).call(this,w),S(this,to,Zc).call(this,v(m[0],y[0],5),v(m[1],y[1],5),v(m[2],y[2],5),w),l.url=S(this,ks,Ta).call(this,b),l.url}destroy(t=!1){var n,s,r,o;t&&((n=u(this,Zr))!=null&&n.size)||((s=u(this,Vi))==null||s.parentNode.parentNode.remove(),A(this,Vi,null),(r=u(this,ol))==null||r.clear(),A(this,ol,null),(o=u(this,Zr))==null||o.clear(),A(this,Zr,null),A(this,Qr,0))}};Jr=new WeakMap,ol=new WeakMap,Vi=new WeakMap,Gi=new WeakMap,ht=new WeakMap,Zr=new WeakMap,Qr=new WeakMap,We=new WeakSet,ct=function(){return u(this,ol)||A(this,ol,new Map)},jr=new WeakSet,Xc=function(){return u(this,Zr)||A(this,Zr,new Map)},Ps=new WeakSet,Ca=function(){if(!u(this,Vi)){let t=u(this,ht).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;let s=u(this,ht).createElementNS(Ii,"svg");s.setAttribute("width",0),s.setAttribute("height",0),A(this,Vi,u(this,ht).createElementNS(Ii,"defs")),t.append(s),s.append(u(this,Vi)),u(this,ht).body.append(t)}return u(this,Vi)},al=new WeakSet,Hp=function(t){if(t.length===1){let c=t[0],d=new Array(256);for(let p=0;p<256;p++)d[p]=c[p]/255;let h=d.join(",");return[h,h,h]}let[n,s,r]=t,o=new Array(256),a=new Array(256),l=new Array(256);for(let c=0;c<256;c++)o[c]=n[c]/255,a[c]=s[c]/255,l[c]=r[c]/255;return[o.join(","),a.join(","),l.join(",")]},ks=new WeakSet,Ta=function(t){if(u(this,Jr)===void 0){A(this,Jr,"");let n=u(this,ht).URL;n!==u(this,ht).baseURI&&(_y(n)?Q('#createUrl: ignore "data:"-URL for performance reasons.'):A(this,Jr,n.split("#",1)[0]))}return`url(${u(this,Jr)}#${t})`},vm=new WeakSet,Cx=function(t){let n=u(this,ht).createElementNS(Ii,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},hu=new WeakSet,Bb=function(t){let n=u(this,ht).createElementNS(Ii,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},Ns=new WeakSet,xa=function(t){let n=u(this,ht).createElementNS(Ii,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),u(this,Ps,Ca).append(n),n},eo=new WeakSet,Jc=function(t,n,s){let r=u(this,ht).createElementNS(Ii,n);r.setAttribute("type","discrete"),r.setAttribute("tableValues",s),t.append(r)},to=new WeakSet,Zc=function(t,n,s,r){let o=u(this,ht).createElementNS(Ii,"feComponentTransfer");r.append(o),S(this,eo,Jc).call(this,o,"feFuncR",t),S(this,eo,Jc).call(this,o,"feFuncG",n),S(this,eo,Jc).call(this,o,"feFuncB",s)},fu=new WeakSet,Vb=function(t,n){let s=u(this,ht).createElementNS(Ii,"feComponentTransfer");n.append(s),S(this,eo,Jc).call(this,s,"feFuncA",t)},no=new WeakSet,Qc=function(t){return u(this,Ps,Ca).style.color=t,Rw(getComputedStyle(u(this,Ps,Ca)).getPropertyValue("color"))};var mg=class{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");let t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){ge("Abstract method `_fetch` called.")}},yg=class extends mg{async _fetch(e){let t=await Sy(e,"arraybuffer");return new Uint8Array(t)}};mt&&Q("Please use the `legacy` build in Node.js environments.");async function Tx(i){let t=await process.getBuiltinModule("fs").promises.readFile(i);return new Uint8Array(t)}var Gb=class extends gg{},$b=class extends hg{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(zO.url)("@napi-rs/canvas").createCanvas(e,t)}},zb=class extends fg{async _fetch(e){return Tx(e)}},qb=class extends mg{async _fetch(e){return Tx(e)}},gt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Wb(i,e){if(!e)return;let t=e[2]-e[0],n=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,n),i.clip(s)}var gd=class{getPattern(){ge("Abstract method `getPattern` called.")}},Yb=class extends gd{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,s){let r;if(s===gt.STROKE||s===gt.FILL){let o=t.current.getClippedPathBoundingBox(s,Ee(e))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,l=Math.ceil(o[3]-o[1])||1,c=t.cachedCanvases.getCanvas("pattern",a,l),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-o[0],-o[1]),n=V.transform(n,[1,0,0,1,o[0],o[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),Wb(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),r=e.createPattern(c.canvas,"no-repeat");let h=new DOMMatrix(n);r.setTransform(h)}else Wb(e,this._bbox),r=this._createGradient(e);return r}};function ab(i,e,t,n,s,r,o,a){let l=e.coords,c=e.colors,d=i.data,h=i.width*4,p;l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=r,r=o,o=p),l[n+1]>l[s+1]&&(p=n,n=s,s=p,p=o,o=a,a=p),l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=r,r=o,o=p);let m=(l[t]+e.offsetX)*e.scaleX,y=(l[t+1]+e.offsetY)*e.scaleY,v=(l[n]+e.offsetX)*e.scaleX,b=(l[n+1]+e.offsetY)*e.scaleY,w=(l[s]+e.offsetX)*e.scaleX,_=(l[s+1]+e.offsetY)*e.scaleY;if(y>=_)return;let C=c[r],T=c[r+1],R=c[r+2],D=c[o],I=c[o+1],k=c[o+2],N=c[a],F=c[a+1],U=c[a+2],re=Math.round(y),X=Math.round(_),J,Ge,L,q,Ht,Wn,Ci,rn;for(let rt=re;rt<=X;rt++){if(rt<b){let Ae=rt<y?0:(y-rt)/(y-b);J=m-(m-v)*Ae,Ge=C-(C-D)*Ae,L=T-(T-I)*Ae,q=R-(R-k)*Ae}else{let Ae;rt>_?Ae=1:b===_?Ae=0:Ae=(b-rt)/(b-_),J=v-(v-w)*Ae,Ge=D-(D-N)*Ae,L=I-(I-F)*Ae,q=k-(k-U)*Ae}let Fe;rt<y?Fe=0:rt>_?Fe=1:Fe=(y-rt)/(y-_),Ht=m-(m-w)*Fe,Wn=C-(C-N)*Fe,Ci=T-(T-F)*Fe,rn=R-(R-U)*Fe;let pa=Math.round(Math.min(J,Ht)),Nc=Math.round(Math.max(J,Ht)),bn=h*rt+pa*4;for(let Ae=pa;Ae<=Nc;Ae++)Fe=(J-Ae)/(J-Ht),Fe<0?Fe=0:Fe>1&&(Fe=1),d[bn++]=Ge-(Ge-Wn)*Fe|0,d[bn++]=L-(L-Ci)*Fe|0,d[bn++]=q-(q-rn)*Fe|0,d[bn++]=255}}function gO(i,e,t){let n=e.coords,s=e.colors,r,o;switch(e.type){case"lattice":let a=e.verticesPerRow,l=Math.floor(n.length/a)-1,c=a-1;for(r=0;r<l;r++){let d=r*a;for(let h=0;h<c;h++,d++)ab(i,t,n[d],n[d+1],n[d+a],s[d],s[d+1],s[d+a]),ab(i,t,n[d+a+1],n[d+1],n[d+a],s[d+a+1],s[d+1],s[d+a])}break;case"triangles":for(r=0,o=n.length;r<o;r+=3)ab(i,t,n[r],n[r+1],n[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}var Kb=class extends gd{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){let a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,d=Math.ceil(this._bounds[3])-l,h=Math.min(Math.ceil(Math.abs(c*e[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),m=c/h,y=d/p,v={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/m,scaleY:1/y},b=h+2*2,w=p+2*2,_=n.getCanvas("mesh",b,w),C=_.context,T=C.createImageData(h,p);if(t){let D=T.data;for(let I=0,k=D.length;I<k;I+=4)D[I]=t[0],D[I+1]=t[1],D[I+2]=t[2],D[I+3]=255}for(let D of this._figures)gO(T,D,v);return C.putImageData(T,2,2),{canvas:_.canvas,offsetX:a-2*m,offsetY:l-2*y,scaleX:m,scaleY:y}}getPattern(e,t,n,s){Wb(e,this._bbox);let r;if(s===gt.SHADING)r=V.singularValueDecompose2dScale(Ee(e));else if(r=V.singularValueDecompose2dScale(t.baseTransform),this.matrix){let a=V.singularValueDecompose2dScale(this.matrix);r=[r[0]*a[0],r[1]*a[1]]}let o=this._createMeshCanvas(r,s===gt.SHADING?null:this._background,t.cachedCanvases);return s!==gt.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}},Xb=class extends gd{getPattern(){return"hotpink"}};function mO(i){switch(i[0]){case"RadialAxial":return new Yb(i);case"Mesh":return new Kb(i);case"Dummy":return new Xb}throw new Error(`Unknown IR type: ${i[0]}`)}var P0={COLORED:1,UNCOLORED:2},Em=class Em{constructor(e,t,n,s,r){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=s,this.baseTransform=r}createPatternCanvas(e){let{bbox:t,operatorList:n,paintType:s,tilingType:r,color:o,canvasGraphicsFactory:a}=this,{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),Ay("TilingType: "+r);let d=t[0],h=t[1],p=t[2],m=t[3],y=p-d,v=m-h,b=V.singularValueDecompose2dScale(this.matrix),w=V.singularValueDecompose2dScale(this.baseTransform),_=b[0]*w[0],C=b[1]*w[1],T=y,R=v,D=!1,I=!1,k=Math.ceil(l*_),N=Math.ceil(c*C),F=Math.ceil(y*_),U=Math.ceil(v*C);k>=F?T=l:D=!0,N>=U?R=c:I=!0;let re=this.getSizeAndScale(T,this.ctx.canvas.width,_),X=this.getSizeAndScale(R,this.ctx.canvas.height,C),J=e.cachedCanvases.getCanvas("pattern",re.size,X.size),Ge=J.context,L=a.createCanvasGraphics(Ge);if(L.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(L,s,o),Ge.translate(-re.scale*d,-X.scale*h),L.transform(re.scale,0,0,X.scale,0,0),Ge.save(),this.clipBbox(L,d,h,p,m),L.baseTransform=Ee(L.ctx),L.executeOperatorList(n),L.endDrawing(),Ge.restore(),D||I){let q=J.canvas;D&&(T=l),I&&(R=c);let Ht=this.getSizeAndScale(T,this.ctx.canvas.width,_),Wn=this.getSizeAndScale(R,this.ctx.canvas.height,C),Ci=Ht.size,rn=Wn.size,rt=e.cachedCanvases.getCanvas("pattern-workaround",Ci,rn),Fe=rt.context,pa=D?Math.floor(y/l):0,Nc=I?Math.floor(v/c):0;for(let bn=0;bn<=pa;bn++)for(let Ae=0;Ae<=Nc;Ae++)Fe.drawImage(q,Ci*bn,rn*Ae,Ci,rn,0,0,Ci,rn);return{canvas:rt.canvas,scaleX:Ht.scale,scaleY:Wn.scale,offsetX:d,offsetY:h}}return{canvas:J.canvas,scaleX:re.scale,scaleY:X.scale,offsetX:d,offsetY:h}}getSizeAndScale(e,t,n){let s=Math.max(Em.MAX_PATTERN_SIZE,t),r=Math.ceil(e*n);return r>=s?r=s:n=r/e,{scale:n,size:r}}clipBbox(e,t,n,s,r){let o=s-t,a=r-n;e.ctx.rect(t,n,o,a),e.current.updateRectMinMax(Ee(e.ctx),[t,n,s,r]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){let s=e.ctx,r=e.current;switch(t){case P0.COLORED:let o=this.ctx;s.fillStyle=o.fillStyle,s.strokeStyle=o.strokeStyle,r.fillColor=o.fillStyle,r.strokeColor=o.strokeStyle;break;case P0.UNCOLORED:let a=V.makeHexColor(n[0],n[1],n[2]);s.fillStyle=a,s.strokeStyle=a,r.fillColor=a,r.strokeColor=a;break;default:throw new ub(`Unsupported paint type: ${t}`)}}getPattern(e,t,n,s){let r=n;s!==gt.SHADING&&(r=V.transform(r,t.baseTransform),this.matrix&&(r=V.transform(r,this.matrix)));let o=this.createPatternCanvas(t),a=new DOMMatrix(r);a=a.translate(o.offsetX,o.offsetY),a=a.scale(1/o.scaleX,1/o.scaleY);let l=e.createPattern(o.canvas,"repeat");return l.setTransform(a),l}};W(Em,"MAX_PATTERN_SIZE",3e3);var Jb=Em;function yO({src:i,srcPos:e=0,dest:t,width:n,height:s,nonBlackColor:r=4294967295,inverseDecode:o=!1}){let a=nt.isLittleEndian?4278190080:255,[l,c]=o?[r,a]:[a,r],d=n>>3,h=n&7,p=i.length;t=new Uint32Array(t.buffer);let m=0;for(let y=0;y<s;y++){for(let b=e+d;e<b;e++){let w=e<p?i[e]:255;t[m++]=w&128?c:l,t[m++]=w&64?c:l,t[m++]=w&32?c:l,t[m++]=w&16?c:l,t[m++]=w&8?c:l,t[m++]=w&4?c:l,t[m++]=w&2?c:l,t[m++]=w&1?c:l}if(h===0)continue;let v=e<p?i[e++]:255;for(let b=0;b<h;b++)t[m++]=v&1<<7-b?c:l}return{srcPos:e,destPos:m}}var k0=16,N0=100,vO=15,F0=10,L0=1e3,kt=16;function EO(i,e){if(i._removeMirroring)throw new Error("Context is already forwarding operations.");i.__originalSave=i.save,i.__originalRestore=i.restore,i.__originalRotate=i.rotate,i.__originalScale=i.scale,i.__originalTranslate=i.translate,i.__originalTransform=i.transform,i.__originalSetTransform=i.setTransform,i.__originalResetTransform=i.resetTransform,i.__originalClip=i.clip,i.__originalMoveTo=i.moveTo,i.__originalLineTo=i.lineTo,i.__originalBezierCurveTo=i.bezierCurveTo,i.__originalRect=i.rect,i.__originalClosePath=i.closePath,i.__originalBeginPath=i.beginPath,i._removeMirroring=()=>{i.save=i.__originalSave,i.restore=i.__originalRestore,i.rotate=i.__originalRotate,i.scale=i.__originalScale,i.translate=i.__originalTranslate,i.transform=i.__originalTransform,i.setTransform=i.__originalSetTransform,i.resetTransform=i.__originalResetTransform,i.clip=i.__originalClip,i.moveTo=i.__originalMoveTo,i.lineTo=i.__originalLineTo,i.bezierCurveTo=i.__originalBezierCurveTo,i.rect=i.__originalRect,i.closePath=i.__originalClosePath,i.beginPath=i.__originalBeginPath,delete i._removeMirroring},i.save=function(){e.save(),this.__originalSave()},i.restore=function(){e.restore(),this.__originalRestore()},i.translate=function(n,s){e.translate(n,s),this.__originalTranslate(n,s)},i.scale=function(n,s){e.scale(n,s),this.__originalScale(n,s)},i.transform=function(n,s,r,o,a,l){e.transform(n,s,r,o,a,l),this.__originalTransform(n,s,r,o,a,l)},i.setTransform=function(n,s,r,o,a,l){e.setTransform(n,s,r,o,a,l),this.__originalSetTransform(n,s,r,o,a,l)},i.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},i.rotate=function(n){e.rotate(n),this.__originalRotate(n)},i.clip=function(n){e.clip(n),this.__originalClip(n)},i.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},i.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},i.bezierCurveTo=function(t,n,s,r,o,a){e.bezierCurveTo(t,n,s,r,o,a),this.__originalBezierCurveTo(t,n,s,r,o,a)},i.rect=function(t,n,s,r){e.rect(t,n,s,r),this.__originalRect(t,n,s,r)},i.closePath=function(){e.closePath(),this.__originalClosePath()},i.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}var Zb=class{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,n)):(s=this.canvasFactory.create(t,n),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}};function Cp(i,e,t,n,s,r,o,a,l,c){let[d,h,p,m,y,v]=Ee(i);if(h===0&&p===0){let _=o*d+y,C=Math.round(_),T=a*m+v,R=Math.round(T),D=(o+l)*d+y,I=Math.abs(Math.round(D)-C)||1,k=(a+c)*m+v,N=Math.abs(Math.round(k)-R)||1;return i.setTransform(Math.sign(d),0,0,Math.sign(m),C,R),i.drawImage(e,t,n,s,r,0,0,I,N),i.setTransform(d,h,p,m,y,v),[I,N]}if(d===0&&m===0){let _=a*p+y,C=Math.round(_),T=o*h+v,R=Math.round(T),D=(a+c)*p+y,I=Math.abs(Math.round(D)-C)||1,k=(o+l)*h+v,N=Math.abs(Math.round(k)-R)||1;return i.setTransform(0,Math.sign(h),Math.sign(p),0,C,R),i.drawImage(e,t,n,s,r,0,0,N,I),i.setTransform(d,h,p,m,y,v),[N,I]}i.drawImage(e,t,n,s,r,o,a,l,c);let b=Math.hypot(d,h),w=Math.hypot(p,m);return[b*l,w*c]}function bO(i){let{width:e,height:t}=i;if(e>L0||t>L0)return null;let n=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=e+1,o=new Uint8Array(r*(t+1)),a,l,c,d=e+7&-8,h=new Uint8Array(d*t),p=0;for(let w of i.data){let _=128;for(;_>0;)h[p++]=w&_?0:255,_>>=1}let m=0;for(p=0,h[p]!==0&&(o[0]=1,++m),l=1;l<e;l++)h[p]!==h[p+1]&&(o[l]=h[p]?2:1,++m),p++;for(h[p]!==0&&(o[l]=2,++m),a=1;a<t;a++){p=a*d,c=a*r,h[p-d]!==h[p]&&(o[c]=h[p]?1:8,++m);let w=(h[p]?4:0)+(h[p-d]?8:0);for(l=1;l<e;l++)w=(w>>2)+(h[p+1]?4:0)+(h[p-d+1]?8:0),s[w]&&(o[c+l]=s[w],++m),p++;if(h[p-d]!==h[p]&&(o[c+l]=h[p]?2:4,++m),m>n)return null}for(p=d*(t-1),c=a*r,h[p]!==0&&(o[c]=8,++m),l=1;l<e;l++)h[p]!==h[p+1]&&(o[c+l]=h[p]?4:8,++m),p++;if(h[p]!==0&&(o[c+l]=4,++m),m>n)return null;let y=new Int32Array([0,r,-1,0,-r,0,0,0,1]),v=new Path2D;for(a=0;m&&a<=t;a++){let w=a*r,_=w+e;for(;w<_&&!o[w];)w++;if(w===_)continue;v.moveTo(w%r,a);let C=w,T=o[w];do{let R=y[T];do w+=R;while(!o[w]);let D=o[w];D!==5&&D!==10?(T=D,o[w]=0):(T=D&51*T>>4,o[w]&=T>>2|T<<2),v.lineTo(w%r,w/r|0),o[w]||--m}while(C!==w);--a}return h=null,o=null,function(w){w.save(),w.scale(1/e,-1/t),w.translate(0,-t),w.fill(v),w.beginPath(),w.restore()}}var vg=class{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=z0,this.textMatrixScale=1,this.fontMatrix=db,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=lt.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=V.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(e,t){let n=V.applyTransform(t,e),s=V.applyTransform(t.slice(2),e),r=V.applyTransform([t[0],t[3]],e),o=V.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,n[0],s[0],r[0],o[0]),this.minY=Math.min(this.minY,n[1],s[1],r[1],o[1]),this.maxX=Math.max(this.maxX,n[0],s[0],r[0],o[0]),this.maxY=Math.max(this.maxY,n[1],s[1],r[1],o[1])}updateScalingPathMinMax(e,t){V.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,s,r,o,a,l,c,d){let h=V.bezierBoundingBox(t,n,s,r,o,a,l,c,d);d||this.updateRectMinMax(e,h)}getPathBoundingBox(e=gt.FILL,t=null){let n=[this.minX,this.minY,this.maxX,this.maxY];if(e===gt.STROKE){t||ge("Stroke bounding box must include transform.");let s=V.singularValueDecompose2dScale(t),r=s[0]*this.lineWidth/2,o=s[1]*this.lineWidth/2;n[0]-=r,n[1]-=o,n[2]+=r,n[3]+=o}return n}updateClipFromPath(){let e=V.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=gt.FILL,t=null){return V.intersect(this.clipBox,this.getPathBoundingBox(e,t))}};function O0(i,e){if(e instanceof ImageData){i.putImageData(e,0,0);return}let t=e.height,n=e.width,s=t%kt,r=(t-s)/kt,o=s===0?r:r+1,a=i.createImageData(n,kt),l=0,c,d=e.data,h=a.data,p,m,y,v;if(e.kind===Ip.GRAYSCALE_1BPP){let b=d.byteLength,w=new Uint32Array(h.buffer,0,h.byteLength>>2),_=w.length,C=n+7>>3,T=4294967295,R=nt.isLittleEndian?4278190080:255;for(p=0;p<o;p++){for(y=p<r?kt:s,c=0,m=0;m<y;m++){let D=b-l,I=0,k=D>C?n:D*8-7,N=k&-8,F=0,U=0;for(;I<N;I+=8)U=d[l++],w[c++]=U&128?T:R,w[c++]=U&64?T:R,w[c++]=U&32?T:R,w[c++]=U&16?T:R,w[c++]=U&8?T:R,w[c++]=U&4?T:R,w[c++]=U&2?T:R,w[c++]=U&1?T:R;for(;I<k;I++)F===0&&(U=d[l++],F=128),w[c++]=U&F?T:R,F>>=1}for(;c<_;)w[c++]=0;i.putImageData(a,0,p*kt)}}else if(e.kind===Ip.RGBA_32BPP){for(m=0,v=n*kt*4,p=0;p<r;p++)h.set(d.subarray(l,l+v)),l+=v,i.putImageData(a,0,m),m+=kt;p<o&&(v=n*s*4,h.set(d.subarray(l,l+v)),i.putImageData(a,0,m))}else if(e.kind===Ip.RGB_24BPP)for(y=kt,v=n*y,p=0;p<o;p++){for(p>=r&&(y=s,v=n*y),c=0,m=v;m--;)h[c++]=d[l++],h[c++]=d[l++],h[c++]=d[l++],h[c++]=255;i.putImageData(a,0,p*kt)}else throw new Error(`bad image kind: ${e.kind}`)}function U0(i,e){if(e.bitmap){i.drawImage(e.bitmap,0,0);return}let t=e.height,n=e.width,s=t%kt,r=(t-s)/kt,o=s===0?r:r+1,a=i.createImageData(n,kt),l=0,c=e.data,d=a.data;for(let h=0;h<o;h++){let p=h<r?kt:s;({srcPos:l}=yO({src:c,srcPos:l,dest:d,width:n,height:p,nonBlackColor:0})),i.putImageData(a,0,h*kt)}}function Gc(i,e){let t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let n of t)i[n]!==void 0&&(e[n]=i[n]);i.setLineDash!==void 0&&(e.setLineDash(i.getLineDash()),e.lineDashOffset=i.lineDashOffset)}function Tp(i){if(i.strokeStyle=i.fillStyle="#000000",i.fillRule="nonzero",i.globalAlpha=1,i.lineWidth=1,i.lineCap="butt",i.lineJoin="miter",i.miterLimit=10,i.globalCompositeOperation="source-over",i.font="10px sans-serif",i.setLineDash!==void 0&&(i.setLineDash([]),i.lineDashOffset=0),!mt){let{filter:e}=i;e!=="none"&&e!==""&&(i.filter="none")}}function H0(i,e){if(e)return!0;let t=V.singularValueDecompose2dScale(i);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);let n=Math.fround((globalThis.devicePixelRatio||1)*ir.PDF_TO_CSS_UNITS);return t[0]<=n&&t[1]<=n}var AO=["butt","round","square"],wO=["miter","round","bevel"],SO={},B0={},pu,Qb,gu,jb,mu,eA,Mw=class Mw{constructor(e,t,n,s,r,{optionalContentConfig:o,markedContentStack:a=null},l,c){E(this,pu);E(this,gu);E(this,mu);this.ctx=e,this.current=new vg(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=s,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new Zb(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:s=null}){let r=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=a,n){let l=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Ee(this.compositeCtx))}this.ctx.save(),Tp(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Ee(this.ctx)}executeOperatorList(e,t,n,s){let r=e.argsArray,o=e.fnArray,a=t||0,l=r.length;if(l===a)return a;let c=l-a>F0&&typeof n=="function",d=c?Date.now()+vO:0,h=0,p=this.commonObjs,m=this.objs,y;for(;;){if(s!==void 0&&a===s.nextBreakPoint)return s.breakIt(a,n),a;if(y=o[a],y!==Tn.dependency)this[y].apply(this,r[a]);else for(let v of r[a]){let b=v.startsWith("g_")?p:m;if(!b.has(v))return b.get(v,n),a}if(a++,a===l)return a;if(c&&++h>F0){if(Date.now()>d)return n(),a;h=0}}}endDrawing(){S(this,pu,Qb).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())typeof HTMLCanvasElement!="undefined"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),S(this,gu,jb).call(this)}_scaleImage(e,t){var p,m;let n=(p=e.width)!=null?p:e.displayWidth,s=(m=e.height)!=null?m:e.displayHeight,r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),a=n,l=s,c="prescale1",d,h;for(;r>2&&a>1||o>2&&l>1;){let y=a,v=l;r>2&&a>1&&(y=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),r/=a/y),o>2&&l>1&&(v=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,o/=l/v),d=this.cachedCanvases.getCanvas(c,y,v),h=d.context,h.clearRect(0,0,y,v),h.drawImage(e,0,0,a,l,0,0,y,v),e=d.canvas,a=y,l=v,c=c==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e){let t=this.ctx,{width:n,height:s}=e,r=this.current.fillColor,o=this.current.patternFill,a=Ee(t),l,c,d,h;if((e.bitmap||e.data)&&e.count>1){let k=e.bitmap||e.data.buffer;c=JSON.stringify(o?a:[a.slice(0,4),r]),l=this._cachedBitmapsMap.get(k),l||(l=new Map,this._cachedBitmapsMap.set(k,l));let N=l.get(c);if(N&&!o){let F=Math.round(Math.min(a[0],a[2])+a[4]),U=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:N,offsetX:F,offsetY:U}}d=N}d||(h=this.cachedCanvases.getCanvas("maskCanvas",n,s),U0(h.context,e));let p=V.transform(a,[1/n,0,0,-1/s,0,0]);p=V.transform(p,[1,0,0,1,0,-s]);let[m,y,v,b]=V.getAxialAlignedBoundingBox([0,0,n,s],p),w=Math.round(v-m)||1,_=Math.round(b-y)||1,C=this.cachedCanvases.getCanvas("fillCanvas",w,_),T=C.context,R=m,D=y;T.translate(-R,-D),T.transform(...p),d||(d=this._scaleImage(h.canvas,Kn(T)),d=d.img,l&&o&&l.set(c,d)),T.imageSmoothingEnabled=H0(Ee(T),e.interpolate),Cp(T,d,0,0,d.width,d.height,0,0,n,s),T.globalCompositeOperation="source-in";let I=V.transform(Kn(T),[1,0,0,1,-R,-D]);return T.fillStyle=o?r.getPattern(t,this,I,gt.FILL):r,T.fillRect(0,0,n,s),l&&!o&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,C.canvas)),{canvas:C.canvas,offsetX:Math.round(R),offsetY:Math.round(D)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=AO[e]}setLineJoin(e){this.ctx.lineJoin=wO[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){let n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx,this.ctx=s.context;let r=this.ctx;r.setTransform(...Ee(this.suspendedCtx)),Gc(this.suspendedCtx,r),EO(r,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Gc(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,s){let r=s[0],o=s[1],a=s[2]-r,l=s[3]-o;a===0||l===0||(this.genericComposeSMask(t.context,n,a,l,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,s,r,o,a,l,c,d,h){let p=e.canvas,m=l-d,y=c-h;if(o){let b=V.makeHexColor(...o);if(m<0||y<0||m+n>p.width||y+s>p.height){let w=this.cachedCanvases.getCanvas("maskExtension",n,s),_=w.context;_.drawImage(p,-m,-y),_.globalCompositeOperation="destination-atop",_.fillStyle=b,_.fillRect(0,0,n,s),_.globalCompositeOperation="source-over",p=w.canvas,m=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);let w=new Path2D;w.rect(m,y,n,s),e.clip(w),e.globalCompositeOperation="destination-atop",e.fillStyle=b,e.fillRect(m,y,n,s),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));let v=new Path2D;v.rect(l,c,n,s),t.clip(v),t.globalCompositeOperation="destination-in",t.drawImage(p,m,y,n,s,l,c,n,s),t.restore()}save(){this.inSMaskMode?(Gc(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Gc(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,s,r,o){this.ctx.transform(e,t,n,s,r,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){let s=this.ctx,r=this.current,o=r.x,a=r.y,l,c,d=Ee(s),h=d[0]===0&&d[3]===0||d[1]===0&&d[2]===0,p=h?n.slice(0):null;for(let m=0,y=0,v=e.length;m<v;m++)switch(e[m]|0){case Tn.rectangle:o=t[y++],a=t[y++];let b=t[y++],w=t[y++],_=o+b,C=a+w;s.moveTo(o,a),b===0||w===0?s.lineTo(_,C):(s.lineTo(_,a),s.lineTo(_,C),s.lineTo(o,C)),h||r.updateRectMinMax(d,[o,a,_,C]),s.closePath();break;case Tn.moveTo:o=t[y++],a=t[y++],s.moveTo(o,a),h||r.updatePathMinMax(d,o,a);break;case Tn.lineTo:o=t[y++],a=t[y++],s.lineTo(o,a),h||r.updatePathMinMax(d,o,a);break;case Tn.curveTo:l=o,c=a,o=t[y+4],a=t[y+5],s.bezierCurveTo(t[y],t[y+1],t[y+2],t[y+3],o,a),r.updateCurvePathMinMax(d,l,c,t[y],t[y+1],t[y+2],t[y+3],o,a,p),y+=6;break;case Tn.curveTo2:l=o,c=a,s.bezierCurveTo(o,a,t[y],t[y+1],t[y+2],t[y+3]),r.updateCurvePathMinMax(d,l,c,o,a,t[y],t[y+1],t[y+2],t[y+3],p),o=t[y+2],a=t[y+3],y+=4;break;case Tn.curveTo3:l=o,c=a,o=t[y+2],a=t[y+3],s.bezierCurveTo(t[y],t[y+1],o,a,o,a),r.updateCurvePathMinMax(d,l,c,t[y],t[y+1],o,a,o,a,p),y+=4;break;case Tn.closePath:s.closePath();break}h&&r.updateScalingPathMinMax(d,p),r.setCurrentPoint(o,a)}closePath(){this.ctx.closePath()}stroke(e=!0){let t=this.ctx,n=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof n=="object"&&(n!=null&&n.getPattern)?(t.save(),t.strokeStyle=n.getPattern(t,this,Kn(t),gt.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){let t=this.ctx,n=this.current.fillColor,s=this.current.patternFill,r=!1;s&&(t.save(),t.fillStyle=n.getPattern(t,this,Kn(t),gt.FILL),r=!0);let o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),r&&t.restore(),e&&this.consumePath(o)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=SO}eoClip(){this.pendingClip=B0}beginText(){this.current.textMatrix=z0,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}let n=new Path2D,s=t.getTransform().invertSelf();for(let{transform:r,x:o,y:a,fontSize:l,path:c}of e)n.addPath(c,new DOMMatrix(r).preMultiplySelf(s).translate(o,a).scale(l,-l));t.clip(n),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var d;let n=this.commonObjs.get(e),s=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=n.fontMatrix||db,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&Q("Invalid font matrix for font "+e),t<0?(t=-t,s.fontDirection=-1):s.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;let r=n.loadedName||"sans-serif",o=((d=n.systemFontInfo)==null?void 0:d.css)||`"${r}", ${n.fallbackName}`,a="normal";n.black?a="900":n.bold&&(a="bold");let l=n.italic?"italic":"normal",c=t;t<k0?c=k0:t>N0&&(c=N0),this.current.fontSizeScale=t/c,this.ctx.font=`${l} ${a} ${c}px ${o}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,s,r,o){this.current.textMatrix=[e,t,n,s,r,o],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,s,r){let o=this.ctx,a=this.current,l=a.font,c=a.textRenderingMode,d=a.fontSize/a.fontSizeScale,h=c&lt.FILL_STROKE_MASK,p=!!(c&lt.ADD_TO_PATH_FLAG),m=a.patternFill&&!l.missingFile,y=a.patternStroke&&!l.missingFile,v;if((l.disableFontFace||p||m||y)&&(v=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||m||y){if(o.save(),o.translate(t,n),o.scale(d,-d),h===lt.FILL||h===lt.FILL_STROKE)if(s){let b=o.getTransform();o.setTransform(...s),o.fill(S(this,mu,eA).call(this,v,b,s))}else o.fill(v);if(h===lt.STROKE||h===lt.FILL_STROKE)if(r){let b=o.getTransform();o.setTransform(...r),o.stroke(S(this,mu,eA).call(this,v,b,r))}else o.lineWidth/=d,o.stroke(v);o.restore()}else(h===lt.FILL||h===lt.FILL_STROKE)&&o.fillText(e,t,n),(h===lt.STROKE||h===lt.FILL_STROKE)&&o.strokeText(e,t,n);p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Ee(o),x:t,y:n,fontSize:d,path:v})}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let t=e.getImageData(0,0,10,10).data,n=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){n=!0;break}return ie(this,"isFontSubpixelAAEnabled",n)}showText(e){let t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);let s=t.fontSize;if(s===0)return;let r=this.ctx,o=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,c=t.fontDirection,d=t.textHScale*c,h=e.length,p=n.vertical,m=p?1:-1,y=n.defaultVMetrics,v=s*t.fontMatrix[0],b=t.textRenderingMode===lt.FILL&&!n.disableFontFace&&!t.patternFill;r.save(),r.transform(...t.textMatrix),r.translate(t.x,t.y+t.textRise),c>0?r.scale(d,-1):r.scale(d,1);let w,_;if(t.patternFill){r.save();let I=t.fillColor.getPattern(r,this,Kn(r),gt.FILL);w=Ee(r),r.restore(),r.fillStyle=I}if(t.patternStroke){r.save();let I=t.strokeColor.getPattern(r,this,Kn(r),gt.STROKE);_=Ee(r),r.restore(),r.strokeStyle=I}let C=t.lineWidth,T=t.textMatrixScale;if(T===0||C===0){let I=t.textRenderingMode&lt.FILL_STROKE_MASK;(I===lt.STROKE||I===lt.FILL_STROKE)&&(C=this.getSinglePixelWidth())}else C/=T;if(o!==1&&(r.scale(o,o),C/=o),r.lineWidth=C,n.isInvalidPDFjsFont){let I=[],k=0;for(let N of e)I.push(N.unicode),k+=N.width;r.fillText(I.join(""),0,0),t.x+=k*v*d,r.restore(),this.compose();return}let R=0,D;for(D=0;D<h;++D){let I=e[D];if(typeof I=="number"){R+=m*I*s/1e3;continue}let k=!1,N=(I.isSpace?l:0)+a,F=I.fontChar,U=I.accent,re,X,J=I.width;if(p){let L=I.vmetric||y,q=-(I.vmetric?L[1]:J*.5)*v,Ht=L[2]*v;J=L?-L[0]:J,re=q/o,X=(R+Ht)/o}else re=R/o,X=0;if(n.remeasure&&J>0){let L=r.measureText(F).width*1e3/s*o;if(J<L&&this.isFontSubpixelAAEnabled){let q=J/L;k=!0,r.save(),r.scale(q,1),re/=q}else J!==L&&(re+=(J-L)/2e3*s/o)}if(this.contentVisible&&(I.isInFont||n.missingFile)){if(b&&!U)r.fillText(F,re,X);else if(this.paintChar(F,re,X,w,_),U){let L=re+s*U.offset.x/o,q=X-s*U.offset.y/o;this.paintChar(U.fontChar,L,q,w,_)}}let Ge=p?J*v-N*c:J*v+N*c;R+=Ge,k&&r.restore()}p?t.y-=R:t.x+=R*d,r.restore(),this.compose()}showType3Text(e){let t=this.ctx,n=this.current,s=n.font,r=n.fontSize,o=n.fontDirection,a=s.vertical?1:-1,l=n.charSpacing,c=n.wordSpacing,d=n.textHScale*o,h=n.fontMatrix||db,p=e.length,m=n.textRenderingMode===lt.INVISIBLE,y,v,b,w;if(!(m||r===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...n.textMatrix),t.translate(n.x,n.y),t.scale(d,o),y=0;y<p;++y){if(v=e[y],typeof v=="number"){w=a*v*r/1e3,this.ctx.translate(w,0),n.x+=w*d;continue}let _=(v.isSpace?c:0)+l,C=s.charProcOperatorList[v.operatorListId];if(!C){Q(`Type3 character "${v.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=v,this.save(),t.scale(r,r),t.transform(...h),this.executeOperatorList(C),this.restore()),b=V.applyTransform([v.width,0],h)[0]*r+_,t.translate(b,0),n.x+=b*d}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,s,r,o){this.ctx.rect(n,s,r-n,o-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){let n=e[1],s=this.baseTransform||Ee(this.ctx),r={createCanvasGraphics:o=>new Mw(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new Jb(e,n,this.ctx,r,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){this.ctx.strokeStyle=this.current.strokeColor=V.makeHexColor(e,t,n),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,n){this.ctx.fillStyle=this.current.fillColor=V.makeHexColor(e,t,n),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=mO(this.getObject(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;let t=this.ctx;this.save();let n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,Kn(t),gt.SHADING);let s=Kn(t);if(s){let{width:r,height:o}=t.canvas,[a,l,c,d]=V.getAxialAlignedBoundingBox([0,0,r,o],s);this.ctx.fillRect(a,l,c-a,d-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){ge("Should not call beginInlineImage")}beginImageData(){ge("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=Ee(this.ctx),t)){let n=t[2]-t[0],s=t[3]-t[1];this.ctx.rect(t[0],t[1],n,s),this.current.updateRectMinMax(Ee(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let t=this.ctx;e.isolated||Ay("TODO: Support non-isolated groups."),e.knockout&&Q("Knockout groups not supported.");let n=Ee(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=V.getAxialAlignedBoundingBox(e.bbox,Ee(t)),r=[0,0,t.canvas.width,t.canvas.height];s=V.intersect(s,r)||[0,0,0,0];let o=Math.floor(s[0]),a=Math.floor(s[1]),l=Math.max(Math.ceil(s[2])-o,1),c=Math.max(Math.ceil(s[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,c]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);let h=this.cachedCanvases.getCanvas(d,l,c),p=h.context;p.translate(-o,-a),p.transform(...n),e.smask?this.smaskStack.push({canvas:h.canvas,context:p,offsetX:o,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,a),t.save()),Gc(t,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;let t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let s=Ee(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);let r=V.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],s);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(e,t,n,s,r){if(S(this,pu,Qb).call(this),Tp(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){let o=t[2]-t[0],a=t[3]-t[1];if(r&&this.annotationCanvasMap){n=n.slice(),n[4]-=t[0],n[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=o,t[3]=a;let[l,c]=V.singularValueDecompose2dScale(Ee(this.ctx)),{viewportScale:d}=this,h=Math.ceil(o*this.outputScaleX*d),p=Math.ceil(a*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(h,p);let{canvas:m,context:y}=this.annotationCanvas;this.annotationCanvasMap.set(e,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=y,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,a*c),Tp(this.ctx)}else Tp(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],o,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new vg(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),S(this,gu,jb).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;let t=e.count;e=this.getObject(e.data,e),e.count=t;let n=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=bO(e)),s.compiled)){s.compiled(n);return}let r=this._createMaskCanvas(e),o=r.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(o,r.offsetX,r.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,s=0,r,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);let a=this.ctx;a.save();let l=Ee(a);a.transform(t,n,s,r,0,0);let c=this._createMaskCanvas(e);a.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let d=0,h=o.length;d<h;d+=2){let p=V.transform(l,[t,n,s,r,o[d],o[d+1]]),[m,y]=V.applyTransform([0,0],p);a.drawImage(c.canvas,m,y)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;let t=this.ctx,n=this.current.fillColor,s=this.current.patternFill;for(let r of e){let{data:o,width:a,height:l,transform:c}=r,d=this.cachedCanvases.getCanvas("maskCanvas",a,l),h=d.context;h.save();let p=this.getObject(o,r);U0(h,p),h.globalCompositeOperation="source-in",h.fillStyle=s?n.getPattern(h,this,Kn(t),gt.FILL):n,h.fillRect(0,0,a,l),h.restore(),t.save(),t.transform(...c),t.scale(1,-1),Cp(t,d.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);if(!t){Q("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,n,s){if(!this.contentVisible)return;let r=this.getObject(e);if(!r){Q("Dependent image isn't ready yet");return}let o=r.width,a=r.height,l=[];for(let c=0,d=s.length;c<d;c+=2)l.push({transform:[t,0,0,n,s[c],s[c+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(r,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;let{bitmap:t,width:n,height:s}=e,r=this.cachedCanvases.getCanvas("inlineImage",n,s),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;let t=e.width,n=e.height,s=this.ctx;if(this.save(),!mt){let{filter:a}=s;a!=="none"&&a!==""&&(s.filter="none")}s.scale(1/t,-1/n);let r;if(e.bitmap)r=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)r=e;else{let l=this.cachedCanvases.getCanvas("inlineImage",t,n).context;O0(l,e),r=this.applyTransferMapsToCanvas(l)}let o=this._scaleImage(r,Kn(s));s.imageSmoothingEnabled=H0(Ee(s),e.interpolate),Cp(s,o.img,0,0,o.paintWidth,o.paintHeight,0,-n,t,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;let n=this.ctx,s;if(e.bitmap)s=e.bitmap;else{let r=e.width,o=e.height,l=this.cachedCanvases.getCanvas("inlineImage",r,o).context;O0(l,e),s=this.applyTransferMapsToCanvas(l)}for(let r of t)n.save(),n.transform(...r.transform),n.scale(1,-1),Cp(n,s,r.x,r.y,r.w,r.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);let n=this.ctx;this.pendingClip&&(t||(this.pendingClip===B0?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=Ee(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:e}=this.current,{a:t,b:n,c:s,d:r}=this.ctx.getTransform(),o,a;if(n===0&&s===0){let l=Math.abs(t),c=Math.abs(r);if(l===c)if(e===0)o=a=1/l;else{let d=l*e;o=a=d<1?1/d:1}else if(e===0)o=1/l,a=1/c;else{let d=l*e,h=c*e;o=d<1?1/d:1,a=h<1?1/h:1}}else{let l=Math.abs(t*r-n*s),c=Math.hypot(t,n),d=Math.hypot(s,r);if(e===0)o=d/l,a=c/l;else{let h=e*l;o=d>h?d/h:1,a=c>h?c/h:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){let{ctx:t}=this,{lineWidth:n}=this.current,[s,r]=this.getScaleForStroking();if(t.lineWidth=n||1,s===1&&r===1){t.stroke();return}let o=t.getLineDash();if(e&&t.save(),t.scale(s,r),o.length>0){let a=Math.max(s,r);t.setLineDash(o.map(l=>l/a)),t.lineDashOffset/=a}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};pu=new WeakSet,Qb=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},gu=new WeakSet,jb=function(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},mu=new WeakSet,eA=function(e,t,n){let s=new Path2D;return s.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),s};var Na=Mw;for(let i in Tn)Na.prototype[i]!==void 0&&(Na.prototype[Tn[i]]=Na.prototype[i]);var yu,vu,Vn=class{static get workerPort(){return u(this,yu)}static set workerPort(e){if(!(typeof Worker!="undefined"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");A(this,yu,e)}static get workerSrc(){return u(this,vu)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");A(this,vu,e)}};yu=new WeakMap,vu=new WeakMap,E(Vn,yu,null),E(Vn,vu,"");var io,Eu,tA=class{constructor({parsedData:e,rawData:t}){E(this,io,void 0);E(this,Eu,void 0);A(this,io,e),A(this,Eu,t)}getRaw(){return u(this,Eu)}get(e){var t;return(t=u(this,io).get(e))!=null?t:null}getAll(){return Cw(u(this,io))}has(e){return u(this,io).has(e)}};io=new WeakMap,Eu=new WeakMap;var Ra=Symbol("INTERNAL"),bu,Au,wu,ll,nA=class{constructor(e,{name:t,intent:n,usage:s,rbGroups:r}){E(this,bu,!1);E(this,Au,!1);E(this,wu,!1);E(this,ll,!0);A(this,bu,!!(e&Qt.DISPLAY)),A(this,Au,!!(e&Qt.PRINT)),this.name=t,this.intent=n,this.usage=s,this.rbGroups=r}get visible(){if(u(this,wu))return u(this,ll);if(!u(this,ll))return!1;let{print:e,view:t}=this.usage;return u(this,bu)?(t==null?void 0:t.viewState)!=="OFF":u(this,Au)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,n=!1){e!==Ra&&ge("Internal method `_setVisible` called."),A(this,wu,n),A(this,ll,t)}};bu=new WeakMap,Au=new WeakMap,wu=new WeakMap,ll=new WeakMap;var Fs,fe,cl,dl,Su,sA,iA=class{constructor(e,t=Qt.DISPLAY){E(this,Su);E(this,Fs,null);E(this,fe,new Map);E(this,cl,null);E(this,dl,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,A(this,dl,e.order);for(let n of e.groups)u(this,fe).set(n.id,new nA(t,n));if(e.baseState==="OFF")for(let n of u(this,fe).values())n._setVisible(Ra,!1);for(let n of e.on)u(this,fe).get(n)._setVisible(Ra,!0);for(let n of e.off)u(this,fe).get(n)._setVisible(Ra,!1);A(this,cl,this.getHash())}}isVisible(e){if(u(this,fe).size===0)return!0;if(!e)return Ay("Optional content group not defined."),!0;if(e.type==="OCG")return u(this,fe).has(e.id)?u(this,fe).get(e.id).visible:(Q(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return S(this,Su,sA).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(let t of e.ids){if(!u(this,fe).has(t))return Q(`Optional content group not found: ${t}`),!0;if(u(this,fe).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(let t of e.ids){if(!u(this,fe).has(t))return Q(`Optional content group not found: ${t}`),!0;if(!u(this,fe).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(let t of e.ids){if(!u(this,fe).has(t))return Q(`Optional content group not found: ${t}`),!0;if(!u(this,fe).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(let t of e.ids){if(!u(this,fe).has(t))return Q(`Optional content group not found: ${t}`),!0;if(u(this,fe).get(t).visible)return!1}return!0}return Q(`Unknown optional content policy ${e.policy}.`),!0}return Q(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){var r;let s=u(this,fe).get(e);if(!s){Q(`Optional content group not found: ${e}`);return}if(n&&t&&s.rbGroups.length)for(let o of s.rbGroups)for(let a of o)a!==e&&((r=u(this,fe).get(a))==null||r._setVisible(Ra,!1,!0));s._setVisible(Ra,!!t,!0),A(this,Fs,null)}setOCGState({state:e,preserveRB:t}){let n;for(let s of e){switch(s){case"ON":case"OFF":case"Toggle":n=s;continue}let r=u(this,fe).get(s);if(r)switch(n){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!r.visible,t);break}}A(this,Fs,null)}get hasInitialVisibility(){return u(this,cl)===null||this.getHash()===u(this,cl)}getOrder(){return u(this,fe).size?u(this,dl)?u(this,dl).slice():[...u(this,fe).keys()]:null}getGroups(){return u(this,fe).size>0?Cw(u(this,fe)):null}getGroup(e){return u(this,fe).get(e)||null}getHash(){if(u(this,Fs)!==null)return u(this,Fs);let e=new dg;for(let[t,n]of u(this,fe))e.update(`${t}:${n.visible}`);return A(this,Fs,e.hexdigest())}};Fs=new WeakMap,fe=new WeakMap,cl=new WeakMap,dl=new WeakMap,Su=new WeakSet,sA=function(e){let t=e.length;if(t<2)return!0;let n=e[0];for(let s=1;s<t;s++){let r=e[s],o;if(Array.isArray(r))o=S(this,Su,sA).call(this,r);else if(u(this,fe).has(r))o=u(this,fe).get(r).visible;else return Q(`Optional content group not found: ${r}`),!0;switch(n){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return n==="And"};var rA=class{constructor(e,{disableRange:t=!1,disableStream:n=!1}){ke(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:s,initialData:r,progressiveDone:o,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,(r==null?void 0:r.length)>0){let l=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),e.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){let n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{let s=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(n),!0)});ke(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e,t;return(t=(e=this._fullRequestReader)==null?void 0:e._loaded)!=null?t:0}_onProgress(e){var t,n,s,r;e.total===void 0?(n=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||n.call(t,{loaded:e.loaded}):(r=(s=this._fullRequestReader)==null?void 0:s.onProgress)==null||r.call(s,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ke(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new oA(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new aA(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}},oA=class{constructor(e,t,n=!1,s=null){this._stream=e,this._done=n||!1,this._filename=xw(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(let r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},aA=class{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function _O(i){let e=!0,t=n("filename\\*","i").exec(i);if(t){t=t[1];let d=a(t);return d=unescape(d),d=l(d),d=c(d),r(d)}if(t=o(i),t){let d=c(t);return r(d)}if(t=n("filename","i").exec(i),t){t=t[1];let d=a(t);return d=c(d),r(d)}function n(d,h){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function s(d,h){if(d){if(!/^[\x00-\xFF]+$/.test(h))return h;try{let p=new TextDecoder(d,{fatal:!0}),m=wy(h);h=p.decode(m),e=!1}catch(p){}}return h}function r(d){return e&&/[\x80-\xff]/.test(d)&&(d=s("utf-8",d),e&&(d=s("iso-8859-1",d))),d}function o(d){let h=[],p,m=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=m.exec(d))!==null;){let[,v,b,w]=p;if(v=parseInt(v,10),v in h){if(v===0)break;continue}h[v]=[b,w]}let y=[];for(let v=0;v<h.length&&v in h;++v){let[b,w]=h[v];w=a(w),b&&(w=unescape(w),v===0&&(w=l(w))),y.push(w)}return y.join("")}function a(d){if(d.startsWith('"')){let h=d.slice(1).split('\\"');for(let p=0;p<h.length;++p){let m=h[p].indexOf('"');m!==-1&&(h[p]=h[p].slice(0,m),h.length=p+1),h[p]=h[p].replaceAll(/\\(.)/g,"$1")}d=h.join('"')}return d}function l(d){let h=d.indexOf("'");if(h===-1)return d;let p=d.slice(0,h),y=d.slice(h+1).replace(/^[^']*'/,"");return s(p,y)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,p,m,y){if(m==="q"||m==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(v,b){return String.fromCharCode(parseInt(b,16))}),s(p,y);try{y=atob(y)}catch(v){}return s(p,y)})}return""}function xx(i,e){let t=new Headers;if(!i||!e||typeof e!="object")return t;for(let n in e){let s=e[n];s!==void 0&&t.append(n,s)}return t}function Cy(i){try{return new URL(i).origin}catch(e){}return null}function Rx({responseHeaders:i,isHttp:e,rangeChunkSize:t,disableRange:n}){let s={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(i.get("Content-Length"),10);return!Number.isInteger(r)||(s.suggestedLength=r,r<=2*t)||n||!e||i.get("Accept-Ranges")!=="bytes"||(i.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function Ix(i){let e=i.get("Content-Disposition");if(e){let t=_O(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch(n){}if(xw(t))return t}return null}function Ty(i,e){return i===404||i===0&&e.startsWith("file:")?new qo('Missing PDF "'+e+'".'):new hc(`Unexpected server response (${i}) while retrieving PDF "${e}".`,i)}function Dx(i){return i===200||i===206}function Mx(i,e,t){return{method:"GET",headers:i,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function Px(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:(Q(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}var Eg=class{constructor(e){W(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=xx(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return(t=(e=this._fullRequestReader)==null?void 0:e._loaded)!=null?t:0}getFullReader(){return ke(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new lA(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new cA(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeRequestReaders.slice(0))n.cancel(e)}},lA=class{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;let n=new Headers(e.headers),s=t.url;fetch(s,Mx(n,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=Cy(r.url),!Dx(r.status))throw Ty(r.status,s);this._reader=r.body.getReader(),this._headersCapability.resolve();let o=r.headers,{allowRangeRequests:a,suggestedLength:l}=Rx({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=Ix(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new gi("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:Px(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}},cA=class{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;let s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;let r=new Headers(e.headers);r.append("Range",`bytes=${t}-${n-1}`);let o=s.url;fetch(o,Mx(r,this._withCredentials,this._abortController)).then(a=>{let l=Cy(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!Dx(a.status))throw Ty(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:Px(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}},lb=200,cb=206;function CO(i){let e=i.response;return typeof e!="string"?e:wy(e).buffer}var dA=class{constructor({url:e,httpHeaders:t,withCredentials:n}){W(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=xx(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){let t=new XMLHttpRequest,n=this.currXhrId++,s=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(let[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=cb):s.expectedStatus=lb,t.responseType="arraybuffer",ke(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var s;let n=this.pendingRequests[e];n&&((s=n.onProgress)==null||s.call(n,t))}onStateChange(e,t){let n=this.pendingRequests[e];if(!n)return;let s=n.xhr;if(s.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){n.onError(s.status);return}let r=s.status||lb;if(!(r===lb&&n.expectedStatus===cb)&&r!==n.expectedStatus){n.onError(s.status);return}let a=CO(s);if(r===cb){let l=s.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?n.onDone({begin:parseInt(c[1],10),chunk:a}):(Q('Missing or invalid "Content-Range" header.'),n.onError(0))}else a?n.onDone({begin:0,chunk:a}):n.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}},uA=class{constructor(e){this._source=e,this._manager=new dA(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ke(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new hA(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let n=new fA(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeRequestReaders.slice(0))n.cancel(e)}},hA=class{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Cy(t.responseURL);let n=t.getAllResponseHeaders(),s=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{let[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=Rx({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=Ix(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Ty(e,this._url),this._headersCapability.reject(this._storedError);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},fA=class{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;let e=Cy((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){var t;(t=this._storedError)!=null||(this._storedError=Ty(e,this._url));for(let n of this._requests)n.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},TO=/^[a-z][a-z0-9\-+.]+:/i;function xO(i){if(TO.test(i))return new URL(i);let e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(i))}var pA=class{constructor(e){this.source=e,this.url=xO(e.url),ke(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return(t=(e=this._fullRequestReader)==null?void 0:e._loaded)!=null?t:0}getFullReader(){return ke(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new gA(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new mA(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeRequestReaders.slice(0))n.cancel(e)}},gA=class{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new qo(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new gi("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},mA=class{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let s=e.source;this._isStreamingSupported=!s.disableStream;let r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}},RO=1e5,xt=30,IO=.8,$0,Ls,Mt,_u,Cu,so,$i,Tu,xu,ro,ul,hl,Os,fl,Ru,pl,oo,Iu,Du,ao,lo,Mu,Us,gl,bm,kx,Am,Nx,Pu,yA,ml,Bp,ku,vA,wm,Fx,Sm,Lx,Ce=class Ce{constructor({textContentSource:e,container:t,viewport:n}){E(this,bm);E(this,Am);E(this,Pu);E(this,Ls,Promise.withResolvers());E(this,Mt,null);E(this,_u,!1);E(this,Cu,!!(($0=globalThis.FontInspector)!=null&&$0.enabled));E(this,so,null);E(this,$i,null);E(this,Tu,0);E(this,xu,0);E(this,ro,null);E(this,ul,null);E(this,hl,0);E(this,Os,0);E(this,fl,Object.create(null));E(this,Ru,[]);E(this,pl,null);E(this,oo,[]);E(this,Iu,new WeakMap);E(this,Du,null);var l;if(e instanceof ReadableStream)A(this,pl,e);else if(typeof e=="object")A(this,pl,new ReadableStream({start(c){c.enqueue(e),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');A(this,Mt,A(this,ul,t)),A(this,Os,n.scale*(globalThis.devicePixelRatio||1)),A(this,hl,n.rotation),A(this,$i,{div:null,properties:null,ctx:null});let{pageWidth:s,pageHeight:r,pageX:o,pageY:a}=n.rawDims;A(this,Du,[1,0,0,-1,-o,a+r]),A(this,xu,s),A(this,Tu,r),S(l=Ce,wm,Fx).call(l),Wo(t,n),u(this,Ls).promise.finally(()=>{u(Ce,gl).delete(this),A(this,$i,null),A(this,fl,null)}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:e,isFirefox:t}=nt.platform;return ie(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){let e=()=>{u(this,ro).read().then(({value:t,done:n})=>{var s;if(n){u(this,Ls).resolve();return}(s=u(this,so))!=null||A(this,so,t.lang),Object.assign(u(this,fl),t.styles),S(this,bm,kx).call(this,t.items),e()},u(this,Ls).reject)};return A(this,ro,u(this,pl).getReader()),u(Ce,gl).add(this),e(),u(this,Ls).promise}update({viewport:e,onBefore:t=null}){var r;let n=e.scale*(globalThis.devicePixelRatio||1),s=e.rotation;if(s!==u(this,hl)&&(t==null||t(),A(this,hl,s),Wo(u(this,ul),{rotation:s})),n!==u(this,Os)){t==null||t(),A(this,Os,n);let o={div:null,properties:null,ctx:S(r=Ce,ml,Bp).call(r,u(this,so))};for(let a of u(this,oo))o.properties=u(this,Iu).get(a),o.div=a,S(this,Pu,yA).call(this,o)}}cancel(){var t;let e=new gi("TextLayer task cancelled.");(t=u(this,ro))==null||t.cancel(e).catch(()=>{}),A(this,ro,null),u(this,Ls).reject(e)}get textDivs(){return u(this,oo)}get textContentItemsStr(){return u(this,Ru)}static cleanup(){if(!(u(this,gl).size>0)){u(this,ao).clear();for(let{canvas:e}of u(this,lo).values())e.remove();u(this,lo).clear()}}};Ls=new WeakMap,Mt=new WeakMap,_u=new WeakMap,Cu=new WeakMap,so=new WeakMap,$i=new WeakMap,Tu=new WeakMap,xu=new WeakMap,ro=new WeakMap,ul=new WeakMap,hl=new WeakMap,Os=new WeakMap,fl=new WeakMap,Ru=new WeakMap,pl=new WeakMap,oo=new WeakMap,Iu=new WeakMap,Du=new WeakMap,ao=new WeakMap,lo=new WeakMap,Mu=new WeakMap,Us=new WeakMap,gl=new WeakMap,bm=new WeakSet,kx=function(e){var s,r,o;if(u(this,_u))return;(o=(r=u(this,$i)).ctx)!=null||(r.ctx=S(s=Ce,ml,Bp).call(s,u(this,so)));let t=u(this,oo),n=u(this,Ru);for(let a of e){if(t.length>RO){Q("Ignoring additional textDivs for performance reasons."),A(this,_u,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){let l=u(this,Mt);A(this,Mt,document.createElement("span")),u(this,Mt).classList.add("markedContent"),a.id!==null&&u(this,Mt).setAttribute("id",`${a.id}`),l.append(u(this,Mt))}else a.type==="endMarkedContent"&&A(this,Mt,u(this,Mt).parentNode);continue}n.push(a.str),S(this,Am,Nx).call(this,a)}},Am=new WeakSet,Nx=function(e){var v;let t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};u(this,oo).push(t);let s=V.transform(u(this,Du),e.transform),r=Math.atan2(s[1],s[0]),o=u(this,fl)[e.fontName];o.vertical&&(r+=Math.PI/2);let a=u(this,Cu)&&o.fontSubstitution||o.fontFamily;a=Ce.fontFamilyMap.get(a)||a;let l=Math.hypot(s[2],s[3]),c=l*S(v=Ce,Sm,Lx).call(v,a,u(this,so)),d,h;r===0?(d=s[4],h=s[5]-c):(d=s[4]+c*Math.sin(r),h=s[5]-c*Math.cos(r));let p="calc(var(--scale-factor)*",m=t.style;u(this,Mt)===u(this,ul)?(m.left=`${(100*d/u(this,xu)).toFixed(2)}%`,m.top=`${(100*h/u(this,Tu)).toFixed(2)}%`):(m.left=`${p}${d.toFixed(2)}px)`,m.top=`${p}${h.toFixed(2)}px)`),m.fontSize=`${p}${(u(Ce,Us)*l).toFixed(2)}px)`,m.fontFamily=a,n.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,u(this,Cu)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(n.angle=r*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){let b=Math.abs(e.transform[0]),w=Math.abs(e.transform[3]);b!==w&&Math.max(b,w)/Math.min(b,w)>1.5&&(y=!0)}if(y&&(n.canvasWidth=o.vertical?e.height:e.width),u(this,Iu).set(t,n),u(this,$i).div=t,u(this,$i).properties=n,S(this,Pu,yA).call(this,u(this,$i)),n.hasText&&u(this,Mt).append(t),n.hasEOL){let b=document.createElement("br");b.setAttribute("role","presentation"),u(this,Mt).append(b)}},Pu=new WeakSet,yA=function(e){var a;let{div:t,properties:n,ctx:s}=e,{style:r}=t,o="";if(u(Ce,Us)>1&&(o=`scale(${1/u(Ce,Us)})`),n.canvasWidth!==0&&n.hasText){let{fontFamily:l}=r,{canvasWidth:c,fontSize:d}=n;S(a=Ce,ku,vA).call(a,s,d*u(this,Os),l);let{width:h}=s.measureText(t.textContent);h>0&&(o=`scaleX(${c*u(this,Os)/h}) ${o}`)}n.angle!==0&&(o=`rotate(${n.angle}deg) ${o}`),o.length>0&&(r.transform=o)},ml=new WeakSet,Bp=function(e=null){let t=u(this,lo).get(e||(e=""));if(!t){let n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),u(this,lo).set(e,t),u(this,Mu).set(t,{size:0,family:""})}return t},ku=new WeakSet,vA=function(e,t,n){let s=u(this,Mu).get(e);t===s.size&&n===s.family||(e.font=`${t}px ${n}`,s.size=t,s.family=n)},wm=new WeakSet,Fx=function(){if(u(this,Us)!==null)return;let e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),A(this,Us,e.getBoundingClientRect().height),e.remove()},Sm=new WeakSet,Lx=function(e,t){let n=u(this,ao).get(e);if(n)return n;let s=S(this,ml,Bp).call(this,t);s.canvas.width=s.canvas.height=xt,S(this,ku,vA).call(this,s,xt,e);let r=s.measureText(""),o=r.fontBoundingBoxAscent,a=Math.abs(r.fontBoundingBoxDescent);if(o){let d=o/(o+a);return u(this,ao).set(e,d),s.canvas.width=s.canvas.height=0,d}s.strokeStyle="red",s.clearRect(0,0,xt,xt),s.strokeText("g",0,0);let l=s.getImageData(0,0,xt,xt).data;a=0;for(let d=l.length-1-3;d>=0;d-=4)if(l[d]>0){a=Math.ceil(d/4/xt);break}s.clearRect(0,0,xt,xt),s.strokeText("A",0,xt),l=s.getImageData(0,0,xt,xt).data,o=0;for(let d=0,h=l.length;d<h;d+=4)if(l[d]>0){o=xt-Math.floor(d/4/xt);break}s.canvas.width=s.canvas.height=0;let c=o?o/(o+a):IO;return u(this,ao).set(e,c),c},E(Ce,ml),E(Ce,ku),E(Ce,wm),E(Ce,Sm),E(Ce,ao,new Map),E(Ce,lo,new Map),E(Ce,Mu,new WeakMap),E(Ce,Us,null),E(Ce,gl,new Set);var md=Ce,yd=class i{static textContent(e){let t=[],n={items:t,styles:Object.create(null)};function s(r){var l;if(!r)return;let o=null,a=r.name;if(a==="#text")o=r.value;else if(i.shouldBuildText(a))(l=r==null?void 0:r.attributes)!=null&&l.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(let c of r.children)s(c)}return s(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}},DO=65536,MO=100,PO=5e3,kO=mt?$b:Ub,NO=mt?zb:pg,FO=mt?Gb:Hb,LO=mt?qb:yg;function OO(i={}){var bn,Ae;typeof i=="string"||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});let e=new EA,{docId:t}=e,n=i.url?UO(i.url):null,s=i.data?HO(i.data):null,r=i.httpHeaders||null,o=i.withCredentials===!0,a=(bn=i.password)!=null?bn:null,l=i.range instanceof bg?i.range:null,c=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:DO,d=i.worker instanceof Fa?i.worker:null,h=i.verbosity,p=typeof i.docBaseUrl=="string"&&!_y(i.docBaseUrl)?i.docBaseUrl:null,m=typeof i.cMapUrl=="string"?i.cMapUrl:null,y=i.cMapPacked!==!1,v=i.CMapReaderFactory||NO,b=typeof i.standardFontDataUrl=="string"?i.standardFontDataUrl:null,w=i.StandardFontDataFactory||LO,_=i.stopAtErrors!==!0,C=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,T=i.isEvalSupported!==!1,R=typeof i.isOffscreenCanvasSupported=="boolean"?i.isOffscreenCanvasSupported:!mt,D=typeof i.isImageDecoderSupported=="boolean"?i.isImageDecoderSupported:!mt&&(nt.platform.isFirefox||!globalThis.chrome),I=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,k=typeof i.disableFontFace=="boolean"?i.disableFontFace:mt,N=i.fontExtraProperties===!0,F=i.enableXfa===!0,U=i.ownerDocument||globalThis.document,re=i.disableRange===!0,X=i.disableStream===!0,J=i.disableAutoFetch===!0,Ge=i.pdfBug===!0,L=i.CanvasFactory||kO,q=i.FilterFactory||FO,Ht=i.enableHWA===!0,Wn=l?l.length:(Ae=i.length)!=null?Ae:NaN,Ci=typeof i.useSystemFonts=="boolean"?i.useSystemFonts:!mt&&!k,rn=typeof i.useWorkerFetch=="boolean"?i.useWorkerFetch:v===pg&&w===yg&&m&&b&&qc(m,document.baseURI)&&qc(b,document.baseURI),rt=null;eO(h);let Fe={canvasFactory:new L({ownerDocument:U,enableHWA:Ht}),filterFactory:new q({docId:t,ownerDocument:U}),cMapReaderFactory:rn?null:new v({baseUrl:m,isCompressed:y}),standardFontDataFactory:rn?null:new w({baseUrl:b})};if(!d){let Fc={verbosity:h,port:Vn.workerPort};d=Fc.port?Fa.fromPort(Fc):new Fa(Fc),e._worker=d}let pa={docId:t,apiVersion:"4.10.38",data:s,password:a,disableAutoFetch:J,rangeChunkSize:c,length:Wn,docBaseUrl:p,enableXfa:F,evaluatorOptions:{maxImageSize:C,disableFontFace:k,ignoreErrors:_,isEvalSupported:T,isOffscreenCanvasSupported:R,isImageDecoderSupported:D,canvasMaxAreaInBytes:I,fontExtraProperties:N,useSystemFonts:Ci,cMapUrl:rn?m:null,standardFontDataUrl:rn?b:null}},Nc={disableFontFace:k,fontExtraProperties:N,ownerDocument:U,pdfBug:Ge,styleElement:rt,loadingParams:{disableAutoFetch:J,enableXfa:F}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let Fc=d.messageHandler.sendWithPromise("GetDocRequest",pa,s?[s.buffer]:null),Yv;if(l)Yv=new rA(l,{disableRange:re,disableStream:X});else if(!s){if(!n)throw new Error("getDocument - no `url` parameter provided.");let ga;if(mt)if(qc(n)){if(typeof fetch=="undefined"||typeof Response=="undefined"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");ga=Eg}else ga=pA;else ga=qc(n)?Eg:uA;Yv=new ga({url:n,length:Wn,httpHeaders:r,withCredentials:o,rangeChunkSize:c,disableRange:re,disableStream:X})}return Fc.then(ga=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let nC=new Tr(t,ga,d.port),rM=new SA(nC,e,Yv,Nc,Fe);e._transport=rM,nC.send("Ready",null)})}).catch(e._capability.reject),e}function UO(i){if(i instanceof URL)return i.href;try{return new URL(i,window.location).href}catch(e){if(mt&&typeof i=="string")return i}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function HO(i){if(mt&&typeof Buffer!="undefined"&&i instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength)return i;if(typeof i=="string")return wy(i);if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)||typeof i=="object"&&!isNaN(i==null?void 0:i.length))return new Uint8Array(i);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function V0(i){return typeof i=="object"&&Number.isInteger(i==null?void 0:i.num)&&i.num>=0&&Number.isInteger(i==null?void 0:i.gen)&&i.gen>=0}var _m,Cm=class Cm{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${vt(Cm,_m)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,n,s;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(r){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,r}this._transport=null,(s=this._worker)==null||s.destroy(),this._worker=null}};_m=new WeakMap,E(Cm,_m,0);var EA=Cm,bg=class{constructor(e,t,n=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let n of this._progressListeners)n(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){ge("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},bA=class{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return ie(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},Hs,zi,Bs,Ia,yl,Vp,AA=class{constructor(e,t,n,s=!1){E(this,Bs);E(this,yl);E(this,Hs,null);E(this,zi,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=s?new og:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new Ag,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:s=0,dontFlip:r=!1}={}){return new ud({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}getAnnotations({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return ie(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:s=Es.ENABLE,transform:r=null,background:o=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:h=!1}){var T,R;(T=this._stats)==null||T.time("Overall");let p=this._transport.getRenderingIntent(n,s,d,h),{renderingIntent:m,cacheKey:y}=p;A(this,zi,!1),S(this,yl,Vp).call(this),a||(a=this._transport.getOptionalContentConfig(m));let v=this._intentStates.get(y);v||(v=Object.create(null),this._intentStates.set(y,v)),v.streamReaderCancelTimeout&&(clearTimeout(v.streamReaderCancelTimeout),v.streamReaderCancelTimeout=null);let b=!!(m&Qt.PRINT);v.displayReadyCapability||(v.displayReadyCapability=Promise.withResolvers(),v.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(R=this._stats)==null||R.time("Page Request"),this._pumpOperatorList(p));let w=D=>{var I;v.renderTasks.delete(_),(this._maybeCleanupAfterRender||b)&&A(this,zi,!0),S(this,Bs,Ia).call(this,!b),D?(_.capability.reject(D),this._abortOperatorList({intentState:v,reason:D instanceof Error?D:new Error(D)})):_.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(I=globalThis.Stats)!=null&&I.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},_=new TA({callback:w,params:{canvasContext:e,viewport:t,transform:r,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:v.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!b,pdfBug:this._pdfBug,pageColors:c});(v.renderTasks||(v.renderTasks=new Set)).add(_);let C=_.task;return Promise.all([v.displayReadyCapability.promise,a]).then(([D,I])=>{var k;if(this.destroyed){w();return}if((k=this._stats)==null||k.time("Rendering"),!(I.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");_.initializeGraphics({transparency:D,optionalContentConfig:I}),_.operatorListChanged()}).catch(w),C}getOperatorList({intent:e="display",annotationMode:t=Es.ENABLE,printAnnotationStorage:n=null,isEditing:s=!1}={}){var c;function r(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}let o=this._transport.getRenderingIntent(e,t,n,s,!0),a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=r,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>yd.textContent(n));let t=this.streamTextContent(e);return new Promise(function(n,s){function r(){o.read().then(function({value:l,done:c}){var d;if(c){n(a);return}(d=a.lang)!=null||(a.lang=l.lang),Object.assign(a.styles,l.styles),a.items.push(...l.items),r()},s)}let o=t.getReader(),a={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),A(this,zi,!1),S(this,yl,Vp).call(this),Promise.all(e)}cleanup(e=!1){A(this,zi,!0);let t=S(this,Bs,Ia).call(this,!1);return e&&t&&this._stats&&(this._stats=new og),t}_startRenderPage(e,t){var s,r;let n=this._intentStates.get(t);n&&((s=this._stats)==null||s.timeEnd("Page Request"),(r=n.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let n=0,s=e.length;n<s;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let n of t.renderTasks)n.operatorListChanged();e.lastChunk&&S(this,Bs,Ia).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:s}){let{map:r,transfer:o}=n,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:s},o).getReader(),c=this._intentStates.get(t);c.streamReader=l;let d=()=>{l.read().then(({value:h,done:p})=>{if(p){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,c),d())},h=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(let p of c.renderTasks)p.operatorListChanged();S(this,Bs,Ia).call(this,!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(h);else if(c.opListReadCapability)c.opListReadCapability.reject(h);else throw h}})};d()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof hd){let s=MO;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new gi(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[s,r]of this._intentStates)if(r===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}};Hs=new WeakMap,zi=new WeakMap,Bs=new WeakSet,Ia=function(e=!1){if(S(this,yl,Vp).call(this),!u(this,zi)||this.destroyed)return!1;if(e)return A(this,Hs,setTimeout(()=>{A(this,Hs,null),S(this,Bs,Ia).call(this,!1)},PO)),!1;for(let{renderTasks:t,operatorList:n}of this._intentStates.values())if(t.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),A(this,zi,!1),!0},yl=new WeakSet,Vp=function(){u(this,Hs)&&(clearTimeout(u(this,Hs)),A(this,Hs,null))};var qi,Tm,wA=class{constructor(){E(this,qi,new Map);E(this,Tm,Promise.resolve())}postMessage(e,t){let n={data:structuredClone(e,t?{transfer:t}:null)};u(this,Tm).then(()=>{for(let[s]of u(this,qi))s.call(this,n)})}addEventListener(e,t,n=null){let s=null;if((n==null?void 0:n.signal)instanceof AbortSignal){let{signal:r}=n;if(r.aborted){Q("LoopbackPort - cannot use an `aborted` signal.");return}let o=()=>this.removeEventListener(e,t);s=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}u(this,qi).set(t,s)}removeEventListener(e,t){let n=u(this,qi).get(t);n==null||n(),u(this,qi).delete(t)}terminate(){for(let[,e]of u(this,qi))e==null||e();u(this,qi).clear()}};qi=new WeakMap,Tm=new WeakMap;var xm,co,uo,vl,Gp,El,$p,ve=class ve{constructor({name:e=null,port:t=null,verbosity:n=tO()}={}){E(this,vl);var s;if(this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((s=u(ve,uo))!=null&&s.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(u(ve,uo)||A(ve,uo,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new Tr("main","worker",e),this._messageHandler.on("ready",function(){}),S(this,vl,Gp).call(this)}_initialize(){if(u(ve,co)||u(ve,El,$p)){this._setupFakeWorker();return}let{workerSrc:e}=ve;try{ve._isSameOrigin(window.location.href,e)||(e=ve._createCDNWrapper(new URL(e,window.location).href));let t=new Worker(e,{type:"module"}),n=new Tr("main","worker",t),s=()=>{r.abort(),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=new AbortController;t.addEventListener("error",()=>{this._webWorker||s()},{signal:r.signal}),n.on("test",a=>{if(r.abort(),this.destroyed||!a){s();return}this._messageHandler=n,this._port=t,this._webWorker=t,S(this,vl,Gp).call(this)}),n.on("ready",a=>{if(r.abort(),this.destroyed){s();return}try{o()}catch(l){this._setupFakeWorker()}});let o=()=>{let a=new Uint8Array;n.send("test",a,[a.buffer])};o();return}catch(t){Ay("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){u(ve,co)||(Q("Setting up fake worker."),A(ve,co,!0)),ve._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let t=new wA;this._port=t;let n=`fake${vt(ve,xm)._++}`,s=new Tr(n+"_worker",n,t);e.setup(s,t),this._messageHandler=new Tr(n,n+"_worker",t),S(this,vl,Gp).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,n;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=u(ve,uo))==null||t.delete(this._port),this._port=null,(n=this._messageHandler)==null||n.destroy(),this._messageHandler=null}static fromPort(e){var n;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");let t=(n=u(this,uo))==null?void 0:n.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new ve(e)}static get workerSrc(){if(Vn.workerSrc)return Vn.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return ie(this,"_setupFakeWorkerGlobal",(async()=>u(this,El,$p)?u(this,El,$p):(await import(this.workerSrc)).WorkerMessageHandler)())}};xm=new WeakMap,co=new WeakMap,uo=new WeakMap,vl=new WeakSet,Gp=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},El=new WeakSet,$p=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch(t){return null}},E(ve,El),E(ve,xm,0),E(ve,co,!1),E(ve,uo,void 0),mt&&(A(ve,co,!0),Vn.workerSrc||(Vn.workerSrc="./pdf.worker.mjs")),ve._isSameOrigin=(e,t)=>{let n;try{if(n=new URL(e),!n.origin||n.origin==="null")return!1}catch(r){return!1}let s=new URL(t,n);return n.origin===s.origin},ve._createCDNWrapper=e=>{let t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};var Fa=ve,Wi,oi,bl,Al,Yi,ho,jc,SA=class{constructor(e,t,n,s,r){E(this,ho);E(this,Wi,new Map);E(this,oi,new Map);E(this,bl,new Map);E(this,Al,new Map);E(this,Yi,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Ag,this.fontLoader=new Lb({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return ie(this,"annotationStorage",new pd)}getRenderingIntent(e,t=Es.ENABLE,n=null,s=!1,r=!1){let o=Qt.DISPLAY,a=Fb;switch(e){case"any":o=Qt.ANY;break;case"display":break;case"print":o=Qt.PRINT;break;default:Q(`getRenderingIntent - invalid intent: ${e}`)}let l=o&Qt.PRINT&&n instanceof ug?n:this.annotationStorage;switch(t){case Es.DISABLE:o+=Qt.ANNOTATIONS_DISABLE;break;case Es.ENABLE:break;case Es.ENABLE_FORMS:o+=Qt.ANNOTATIONS_FORMS;break;case Es.ENABLE_STORAGE:o+=Qt.ANNOTATIONS_STORAGE,a=l.serializable;break;default:Q(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(o+=Qt.IS_EDITING),r&&(o+=Qt.OPLIST);let{ids:c,hash:d}=l.modifiedIds,h=[o,a.hash,d];return{renderingIntent:o,cacheKey:h.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=u(this,Yi))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let s of u(this,oi).values())e.push(s._destroy());u(this,oi).clear(),u(this,bl).clear(),u(this,Al).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var s,r;this.commonObjs.clear(),this.fontLoader.clear(),u(this,Wi).clear(),this.filterFactory.destroy(),md.cleanup(),(s=this._networkStream)==null||s.cancelAllRequests(new gi("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,s)=>{ke(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},s.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){s.close();return}ke(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{this._fullReader.cancel(r),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async n=>{var a;await this._fullReader.headersReady;let{isStreamingSupported:s,isRangeSupported:r,contentLength:o}=this._fullReader;return(!s||!r)&&(this._lastProgress&&((a=t.onProgress)==null||a.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var c;(c=t.onProgress)==null||c.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:s,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(n,s)=>{ke(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let r=this._networkStream.getRangeReader(n.begin,n.end);if(!r){s.close();return}s.onPull=()=>{r.read().then(function({value:o,done:a}){if(a){s.close();return}ke(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{s.error(o)})},s.onCancel=o=>{r.cancel(o),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new bA(n,this))}),e.on("DocException",n=>{t._capability.reject(Rt(n))}),e.on("PasswordRequest",n=>{A(this,Yi,Promise.withResolvers());try{if(!t.onPassword)throw Rt(n);let s=r=>{r instanceof Error?u(this,Yi).reject(r):u(this,Yi).resolve({password:r})};t.onPassword(s,n.code)}catch(s){u(this,Yi).reject(s)}return u(this,Yi).promise}),e.on("DataLoaded",n=>{var s;(s=t.onProgress)==null||s.call(t,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;u(this,oi).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,s,r])=>{var o;if(this.destroyed||this.commonObjs.has(n))return null;switch(s){case"Font":let{disableFontFace:a,fontExtraProperties:l,pdfBug:c}=this._params;if("error"in r){let m=r.error;Q(`Error during font loading: ${m}`),this.commonObjs.resolve(n,m);break}let d=c&&((o=globalThis.FontInspector)!=null&&o.enabled)?(m,y)=>globalThis.FontInspector.fontAdded(m,y):null,h=new Ob(r,{disableFontFace:a,fontExtraProperties:l,inspectFont:d});this.fontLoader.bind(h).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!l&&h.data&&(h.data=null),this.commonObjs.resolve(n,h)});break;case"CopyLocalImage":let{imageRef:p}=r;ke(p,"The imageRef must be defined.");for(let m of u(this,oi).values())for(let[,y]of m.objs)if((y==null?void 0:y.ref)===p)return y.dataLen?(this.commonObjs.resolve(n,structuredClone(y)),y.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,r);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([n,s,r,o])=>{var l;if(this.destroyed)return;let a=u(this,oi).get(s);if(!a.objs.has(n)){if(a._intentStates.size===0){(l=o==null?void 0:o.bitmap)==null||l.close();return}switch(r){case"Image":a.objs.resolve(n,o),(o==null?void 0:o.dataLen)>X1&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(n,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",n=>{var s;this.destroyed||(s=t.onProgress)==null||s.call(t,{loaded:n.loaded,total:n.total})}),e.on("FetchBuiltInCMap",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(n)}),e.on("FetchStandardFontData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n,s;this.annotationStorage.size<=0&&Q("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:(s=(n=this._fullReader)==null?void 0:n.filename)!=null?s:null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,n=u(this,bl).get(t);if(n)return n;let s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&u(this,Al).set(r.refStr,e);let o=new AA(t,r,this,this._params.pdfBug);return u(this,oi).set(t,o),o});return u(this,bl).set(t,s),s}getPageIndex(e){return V0(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return S(this,ho,jc).call(this,"GetFieldObjects")}hasJSActions(){return S(this,ho,jc).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return S(this,ho,jc).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return S(this,ho,jc).call(this,"GetOptionalContentConfig").then(t=>new iA(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",t=u(this,Wi).get(e);if(t)return t;let n=this.messageHandler.sendWithPromise(e,null).then(s=>{var r,o,a,l;return{info:s[0],metadata:s[1]?new tA(s[1]):null,contentDispositionFilename:(o=(r=this._fullReader)==null?void 0:r.filename)!=null?o:null,contentLength:(l=(a=this._fullReader)==null?void 0:a.contentLength)!=null?l:null}});return u(this,Wi).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(let t of u(this,oi).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),u(this,Wi).clear(),this.filterFactory.destroy(!0),md.cleanup()}}cachedPageNumber(e){var n;if(!V0(e))return null;let t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return(n=u(this,Al).get(t))!=null?n:null}};Wi=new WeakMap,oi=new WeakMap,bl=new WeakMap,Al=new WeakMap,Yi=new WeakMap,ho=new WeakSet,jc=function(e,t=null){let n=u(this,Wi).get(e);if(n)return n;let s=this.messageHandler.sendWithPromise(e,t);return u(this,Wi).set(e,s),s};var $c=Symbol("INITIAL_DATA"),$t,Nu,_A,Ag=class{constructor(){E(this,Nu);E(this,$t,Object.create(null))}get(e,t=null){if(t){let s=S(this,Nu,_A).call(this,e);return s.promise.then(()=>t(s.data)),null}let n=u(this,$t)[e];if(!n||n.data===$c)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){let t=u(this,$t)[e];return!!t&&t.data!==$c}delete(e){let t=u(this,$t)[e];return!t||t.data===$c?!1:(delete u(this,$t)[e],!0)}resolve(e,t=null){let n=S(this,Nu,_A).call(this,e);n.data=t,n.resolve()}clear(){var e;for(let t in u(this,$t)){let{data:n}=u(this,$t)[t];(e=n==null?void 0:n.bitmap)==null||e.close()}A(this,$t,Object.create(null))}*[Symbol.iterator](){for(let e in u(this,$t)){let{data:t}=u(this,$t)[e];t!==$c&&(yield[e,t])}}};$t=new WeakMap,Nu=new WeakSet,_A=function(e){var t;return(t=u(this,$t))[e]||(t[e]={...Promise.withResolvers(),data:$c})};var Vs,CA=class{constructor(e){E(this,Vs,null);A(this,Vs,e),this.onContinue=null}get promise(){return u(this,Vs).capability.promise}cancel(e=0){u(this,Vs).cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=u(this,Vs).operatorList;if(!e)return!1;let{annotationCanvasMap:t}=u(this,Vs);return e.form||e.canvas&&(t==null?void 0:t.size)>0}};Vs=new WeakMap;var Gs,fo,Cr=class Cr{constructor({callback:e,params:t,objs:n,commonObjs:s,annotationCanvasMap:r,operatorList:o,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:h=!1,pageColors:p=null}){E(this,Gs,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=s,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=h,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window!="undefined",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new CA(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var a,l;if(this.cancelled)return;if(this._canvas){if(u(Cr,fo).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");u(Cr,fo).add(this._canvas)}this._pdfBug&&((a=globalThis.StepperManager)!=null&&a.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:n,viewport:s,transform:r,background:o}=this.params;this.gfx=new Na(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:s,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var n;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),u(this,Gs)&&(window.cancelAnimationFrame(u(this,Gs)),A(this,Gs,null)),u(Cr,fo).delete(this._canvas),this.callback(e||new hd(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?A(this,Gs,window.requestAnimationFrame(()=>{A(this,Gs,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),u(Cr,fo).delete(this._canvas),this.callback())))}};Gs=new WeakMap,fo=new WeakMap,E(Cr,fo,new WeakSet);var TA=Cr,BO="4.10.38",VO="f9bea397f";function G0(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function zc(i){return Math.max(0,Math.min(255,255*i))}var wg=class{static CMYK_G([e,t,n,s]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=zc(e),[e,e,e]}static G_HTML([e]){let t=G0(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(zc)}static RGB_HTML(e){return`#${e.map(G0).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,n+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,n,s]){return[zc(1-Math.min(1,e+s)),zc(1-Math.min(1,n+s)),zc(1-Math.min(1,t+s))]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){let s=1-e,r=1-t,o=1-n,a=Math.min(s,r,o);return["CMYK",s,r,o,a]}},xA=class{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");let s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),n||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){ge("Abstract method `_createSVG` called.")}},vd=class extends xA{_createSVG(e){return document.createElementNS(Ii,e)}},Sg=class{static setupStorage(e,t,n,s,r){let o=s.getValue(t,{value:null});switch(n.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(o.value===n.attributes.xfaOn?e.setAttribute("checked",!0):o.value===n.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",a=>{s.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(let a of n.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{let l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;s.setValue(t,{value:c})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:s,linkService:r}){let{attributes:o}=t,a=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${s}`);for(let[l,c]of Object.entries(o))if(c!=null)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,c)}a&&r.addLinkAttributes(e,o.href,o.newWindow),n&&o.dataId&&this.setupStorage(e,o.dataId,t,n)}static render(e){var h,p;let t=e.annotationStorage,n=e.linkService,s=e.xfaHtml,r=e.intent||"display",o=document.createElement(s.name);s.attributes&&this.setAttributes({html:o,element:s,intent:r,linkService:n});let a=r!=="richText",l=e.div;if(l.append(o),e.viewport){let m=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=m}a&&l.setAttribute("class","xfaLayer xfaFont");let c=[];if(s.children.length===0){if(s.value){let m=document.createTextNode(s.value);o.append(m),a&&yd.shouldBuildText(s.name)&&c.push(m)}return{textDivs:c}}let d=[[s,-1,o]];for(;d.length>0;){let[m,y,v]=d.at(-1);if(y+1===m.children.length){d.pop();continue}let b=m.children[++d.at(-1)[1]];if(b===null)continue;let{name:w}=b;if(w==="#text"){let C=document.createTextNode(b.value);c.push(C),v.append(C);continue}let _=(h=b==null?void 0:b.attributes)!=null&&h.xmlns?document.createElementNS(b.attributes.xmlns,w):document.createElement(w);if(v.append(_),b.attributes&&this.setAttributes({html:_,element:b,storage:t,intent:r,linkService:n}),((p=b.children)==null?void 0:p.length)>0)d.push([b,-1,_]);else if(b.value){let C=document.createTextNode(b.value);a&&yd.shouldBuildText(w)&&c.push(C),_.append(C)}}for(let m of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){let t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}},Fh=1e3,GO=9,Xo=new WeakSet;function nr(i){return{width:i[2]-i[0],height:i[3]-i[1]}}var RA=class{static create(e){switch(e.data.annotationType){case Ue.LINK:return new _g(e);case Ue.TEXT:return new DA(e);case Ue.WIDGET:switch(e.data.fieldType){case"Tx":return new MA(e);case"Btn":return e.data.radioButton?new Cg(e):e.data.checkBox?new kA(e):new NA(e);case"Ch":return new FA(e);case"Sig":return new PA(e)}return new ls(e);case Ue.POPUP:return new Ed(e);case Ue.FREETEXT:return new Tg(e);case Ue.LINE:return new HA(e);case Ue.SQUARE:return new BA(e);case Ue.CIRCLE:return new VA(e);case Ue.POLYLINE:return new xg(e);case Ue.CARET:return new $A(e);case Ue.INK:return new bd(e);case Ue.POLYGON:return new GA(e);case Ue.HIGHLIGHT:return new Rg(e);case Ue.UNDERLINE:return new qA(e);case Ue.SQUIGGLY:return new WA(e);case Ue.STRIKEOUT:return new YA(e);case Ue.STAMP:return new Ig(e);case Ue.FILEATTACHMENT:return new KA(e);default:return new De(e)}}},po,wl,Sl,Fu,IA,Pw=class Pw{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:s=!1}={}){E(this,Fu);E(this,po,null);E(this,wl,!1);E(this,Sl,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:n}){return!!(e!=null&&e.str||t!=null&&t.str||n!=null&&n.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Pw._hasPopupData(this.data)}updateEdited(e){var n;if(!this.container)return;u(this,po)||A(this,po,{rect:this.data.rect.slice(0)});let{rect:t}=e;t&&S(this,Fu,IA).call(this,t),(n=u(this,Sl))==null||n.popup.updateEdited(e)}resetEdited(){var e;u(this,po)&&(S(this,Fu,IA).call(this,u(this,po).rect),(e=u(this,Sl))==null||e.popup.resetEdited(),A(this,po,null))}_createContainer(e){let{data:t,parent:{page:n,viewport:s}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),this instanceof ls||(r.tabIndex=Fh);let{style:o}=r;if(o.zIndex=this.parent.zIndex++,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof Ed){let{rotation:v}=t;return!t.hasOwnCanvas&&v!==0&&this.setRotation(v,r),r}let{width:a,height:l}=nr(t.rect);if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;let v=t.borderStyle.horizontalCornerRadius,b=t.borderStyle.verticalCornerRadius;if(v>0||b>0){let _=`calc(${v}px * var(--scale-factor)) / calc(${b}px * var(--scale-factor))`;o.borderRadius=_}else if(this instanceof Cg){let _=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;o.borderRadius=_}switch(t.borderStyle.style){case Vc.SOLID:o.borderStyle="solid";break;case Vc.DASHED:o.borderStyle="dashed";break;case Vc.BEVELED:Q("Unimplemented border style: beveled");break;case Vc.INSET:Q("Unimplemented border style: inset");break;case Vc.UNDERLINE:o.borderBottomStyle="solid";break;default:break}let w=t.borderColor||null;w?(A(this,wl,!0),o.borderColor=V.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):o.borderWidth=0}let c=V.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:d,pageHeight:h,pageX:p,pageY:m}=s.rawDims;o.left=`${100*(c[0]-p)/d}%`,o.top=`${100*(c[1]-m)/h}%`;let{rotation:y}=t;return t.hasOwnCanvas||y===0?(o.width=`${100*a/d}%`,o.height=`${100*l/h}%`):this.setRotation(y,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;let{pageWidth:n,pageHeight:s}=this.parent.viewport.rawDims,{width:r,height:o}=nr(this.data.rect),a,l;e%180===0?(a=100*r/n,l=100*o/s):(a=100*o/n,l=100*r/s),t.style.width=`${a}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(t,n,s)=>{let r=s.detail[t],o=r[0],a=r.slice(1);s.target.style[n]=wg[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[n]:wg[`${o}_rgb`](a)})};return ie(this,"_commonActions",{display:t=>{let{display:n}=t.detail,s=n%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{let{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{let n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){let n=this._commonActions;for(let s of Object.keys(t.detail)){let r=e[s]||n[s];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let n=this._commonActions;for(let[s,r]of Object.entries(t)){let o=n[s];if(o){let a={detail:{[s]:r},target:e};o(a),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:e}=this.data;if(!e)return;let[t,n,s,r]=this.data.rect.map(v=>Math.fround(v));if(e.length===8){let[v,b,w,_]=e.subarray(2,6);if(s===v&&r===b&&t===w&&n===_)return}let{style:o}=this.container,a;if(u(this,wl)){let{borderColor:v,borderWidth:b}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${v}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}let l=s-t,c=r-n,{svgFactory:d}=this,h=d.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0);let p=d.createElement("defs");h.append(p);let m=d.createElement("clipPath"),y=`clippath_${this.data.id}`;m.setAttribute("id",y),m.setAttribute("clipPathUnits","objectBoundingBox"),p.append(m);for(let v=2,b=e.length;v<b;v+=8){let w=e[v],_=e[v+1],C=e[v+2],T=e[v+3],R=d.createElement("rect"),D=(C-t)/l,I=(r-_)/c,k=(w-C)/l,N=(_-T)/c;R.setAttribute("x",D),R.setAttribute("y",I),R.setAttribute("width",k),R.setAttribute("height",N),m.append(R),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${D}" y="${I}" width="${k}" height="${N}"/>`)}u(this,wl)&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(h),this.container.style.clipPath=`url(#${y})`}_createPopup(){let{data:e}=this,t=A(this,Sl,new Ed({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){ge("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let n=[];if(this._fieldObjects){let s=this._fieldObjects[e];if(s)for(let{page:r,id:o,exportValues:a}of s){if(r===-1||o===t)continue;let l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${o}"]`);if(c&&!Xo.has(c)){Q(`_getElementsByName - element not allowed: ${o}`);continue}n.push({id:o,exportValue:l,domElement:c})}return n}for(let s of document.getElementsByName(e)){let{exportValue:r}=s,o=s.getAttribute("data-element-id");o!==t&&Xo.has(s)&&n.push({id:o,exportValue:r,domElement:s})}return n}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};po=new WeakMap,wl=new WeakMap,Sl=new WeakMap,Fu=new WeakSet,IA=function(e){let{container:{style:t},data:{rect:n,rotation:s},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:l}}}}=this;n==null||n.splice(0,4,...e);let{width:c,height:d}=nr(e);t.left=`${100*(e[0]-a)/r}%`,t.top=`${100*(o-e[3]+l)/o}%`,s===0?(t.width=`${100*c/r}%`,t.height=`${100*d/o}%`):this.setRotation(s)};var De=Pw,Ki,Ar,Rm,Ox,Im,Ux,_g=class extends De{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});E(this,Ki);E(this,Rm);E(this,Im);this.isTooltipOnly=t.data.isTooltipOnly}render(){let{data:t,linkService:n}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let r=!1;return t.url?(n.addLinkAttributes(s,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(s,t.action),r=!0):t.attachment?(S(this,Rm,Ox).call(this,s,t.attachment,t.attachmentDest),r=!0):t.setOCGState?(S(this,Im,Ux).call(this,s,t.setOCGState),r=!0):t.dest?(this._bindLink(s,t.dest),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),r=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(s,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(s),this.container}_bindLink(t,n){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&S(this,Ki,Ar).call(this)}_bindNamedAction(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),S(this,Ki,Ar).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");let s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let r of Object.keys(n.actions)){let o=s.get(r);o&&(t[o]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:r}}),!1})}t.onclick||(t.onclick=()=>!1),S(this,Ki,Ar).call(this)}_bindResetFormAction(t,n){let s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),S(this,Ki,Ar).call(this),!this._fieldObjects){Q('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{var h;s==null||s();let{fields:r,refs:o,include:a}=n,l=[];if(r.length!==0||o.length!==0){let p=new Set(o);for(let m of r){let y=this._fieldObjects[m]||[];for(let{id:v}of y)p.add(v)}for(let m of Object.values(this._fieldObjects))for(let y of m)p.has(y.id)===a&&l.push(y)}else for(let p of Object.values(this._fieldObjects))l.push(...p);let c=this.annotationStorage,d=[];for(let p of l){let{id:m}=p;switch(d.push(m),p.type){case"text":{let v=p.defaultValue||"";c.setValue(m,{value:v});break}case"checkbox":case"radiobutton":{let v=p.defaultValue===p.exportValues;c.setValue(m,{value:v});break}case"combobox":case"listbox":{let v=p.defaultValue||"";c.setValue(m,{value:v});break}default:continue}let y=document.querySelector(`[data-element-id="${m}"]`);if(y){if(!Xo.has(y)){Q(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((h=this.linkService.eventBus)==null||h.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}};Ki=new WeakSet,Ar=function(){this.container.setAttribute("data-internal-link","")},Rm=new WeakSet,Ox=function(t,n,s=null){t.href=this.linkService.getAnchorUrl(""),n.description&&(t.title=n.description),t.onclick=()=>{var r;return(r=this.downloadManager)==null||r.openOrDownloadData(n.content,n.filename,s),!1},S(this,Ki,Ar).call(this)},Im=new WeakSet,Ux=function(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),S(this,Ki,Ar).call(this)};var DA=class extends De{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}},ls=class extends De{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return nt.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,s,r){n.includes("mouse")?e.addEventListener(n,o=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(n,o=>{var a;if(n==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}r&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(o)}}))})}_setEventListeners(e,t,n,s){var r,o,a;for(let[l,c]of n)(c==="Action"||(r=this.data.actions)!=null&&r[c])&&((c==="Focus"||c==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,c,s),c==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):c==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":V.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||GO,r=e.style,o,a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),d=Math.round(c/(Rp*s))||1,h=c/d;o=Math.min(s,l(h/Rp))}else{let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(s,l(c/Rp))}r.fontSize=`calc(${o}px * var(--scale-factor))`,r.color=V.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}},MA=class extends ls{constructor(e){let t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,s){let r=this.annotationStorage;for(let o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=n),r.setValue(o.id,{[s]:n})}render(){var s,r;let e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){let o=e.getValue(t,{value:this.data.fieldValue}),a=o.value||"",l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&a.length>l&&(a=a.slice(0,l));let c=o.formattedValue||((s=this.data.textContent)==null?void 0:s.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));let d={userValue:a,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=c!=null?c:a,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",c!=null?c:a),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Xo.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=Fh,this._setRequired(n,this.data.required),l&&(n.maxLength=l),n.addEventListener("input",p=>{e.setValue(t,{value:p.target.value}),this.setPropertyOnSiblings(n,"value",p.target.value,"value"),d.formattedValue=null}),n.addEventListener("resetform",p=>{var y;let m=(y=this.data.defaultFieldValue)!=null?y:"";n.value=d.userValue=m,d.formattedValue=null});let h=p=>{let{formattedValue:m}=d;m!=null&&(p.target.value=m),p.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",m=>{var v;if(d.focused)return;let{target:y}=m;d.userValue&&(y.value=d.userValue),d.lastCommittedValue=y.value,d.commitKey=1,(v=this.data.actions)!=null&&v.Focus||(d.focused=!0)}),n.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);let y={value(v){var b;d.userValue=(b=v.detail.value)!=null?b:"",e.setValue(t,{value:d.userValue.toString()}),v.target.value=d.userValue},formattedValue(v){let{formattedValue:b}=v.detail;d.formattedValue=b,b!=null&&v.target!==document.activeElement&&(v.target.value=b),e.setValue(t,{formattedValue:b})},selRange(v){v.target.setSelectionRange(...v.detail.selRange)},charLimit:v=>{var C;let{charLimit:b}=v.detail,{target:w}=v;if(b===0){w.removeAttribute("maxLength");return}w.setAttribute("maxLength",b);let _=d.userValue;!_||_.length<=b||(_=_.slice(0,b),w.value=d.userValue=_,e.setValue(t,{value:_}),(C=this.linkService.eventBus)==null||C.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,willCommit:!0,commitKey:1,selStart:w.selectionStart,selEnd:w.selectionEnd}}))}};this._dispatchEventFromSandbox(y,m)}),n.addEventListener("keydown",m=>{var b;d.commitKey=1;let y=-1;if(m.key==="Escape"?y=0:m.key==="Enter"&&!this.data.multiLine?y=2:m.key==="Tab"&&(d.commitKey=3),y===-1)return;let{value:v}=m.target;d.lastCommittedValue!==v&&(d.lastCommittedValue=v,d.userValue=v,(b=this.linkService.eventBus)==null||b.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,willCommit:!0,commitKey:y,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});let p=h;h=null,n.addEventListener("blur",m=>{var v,b;if(!d.focused||!m.relatedTarget)return;(v=this.data.actions)!=null&&v.Blur||(d.focused=!1);let{value:y}=m.target;d.userValue=y,d.lastCommittedValue!==y&&((b=this.linkService.eventBus)==null||b.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:d.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}})),p(m)}),(r=this.data.actions)!=null&&r.Keystroke&&n.addEventListener("beforeinput",m=>{var R;d.lastCommittedValue=null;let{data:y,target:v}=m,{value:b,selectionStart:w,selectionEnd:_}=v,C=w,T=_;switch(m.inputType){case"deleteWordBackward":{let D=b.substring(0,w).match(/\w*[^\w]*$/);D&&(C-=D[0].length);break}case"deleteWordForward":{let D=b.substring(w).match(/^[^\w]*\w*/);D&&(T+=D[0].length);break}case"deleteContentBackward":w===_&&(C-=1);break;case"deleteContentForward":w===_&&(T+=1);break}m.preventDefault(),(R=this.linkService.eventBus)==null||R.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:b,change:y||"",willCommit:!1,selStart:C,selEnd:T}})}),this._setEventListeners(n,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(h&&n.addEventListener("blur",h),this.data.comb){let m=(this.data.rect[2]-this.data.rect[0])/l;n.classList.add("comb"),n.style.letterSpacing=`calc(${m}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},PA=class extends ls{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}},kA=class extends ls{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,n=t.id,s=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(n,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let r=document.createElement("input");return Xo.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=Fh,r.addEventListener("change",o=>{let{name:a,checked:l}=o.target;for(let c of this._getElementsByName(a,n)){let d=l&&c.exportValue===t.exportValue;c.domElement&&(c.domElement.checked=d),e.setValue(c.id,{value:d})}e.setValue(n,{value:l})}),r.addEventListener("resetform",o=>{let a=t.defaultFieldValue||"Off";o.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{let a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(n,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},Cg=class extends ls{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,t=this.data,n=t.id,s=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(n,{value:s})),s)for(let o of this._getElementsByName(t.fieldName,n))e.setValue(o.id,{value:!1});let r=document.createElement("input");if(Xo.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.tabIndex=Fh,r.addEventListener("change",o=>{let{name:a,checked:l}=o.target;for(let c of this._getElementsByName(a,n))e.setValue(c.id,{value:!1});e.setValue(n,{value:l})}),r.addEventListener("resetform",o=>{let a=t.defaultFieldValue;o.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){let o=t.buttonValue;r.addEventListener("updatefromsandbox",a=>{let l={value:c=>{let d=o===c.detail.value;for(let h of this._getElementsByName(c.target.name)){let p=d&&h.id===n;h.domElement&&(h.domElement.checked=p),e.setValue(h.id,{value:p})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},NA=class extends _g{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}},FA=class extends ls{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");Xo.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=Fh;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",d=>{let h=this.data.defaultFieldValue;for(let p of s.options)p.selected=p.value===h});for(let d of this.data.options){let h=document.createElement("option");h.textContent=d.displayValue,h.value=d.exportValue,n.value.includes(d.exportValue)&&(h.setAttribute("selected",!0),r=!1),s.append(h)}let o=null;if(r){let d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),s.prepend(d),o=()=>{d.remove(),s.removeEventListener("input",o),o=null},s.addEventListener("input",o)}let a=d=>{let h=d?"value":"textContent",{options:p,multiple:m}=s;return m?Array.prototype.filter.call(p,y=>y.selected).map(y=>y[h]):p.selectedIndex===-1?null:p[p.selectedIndex][h]},l=a(!1),c=d=>{let h=d.target.options;return Array.prototype.map.call(h,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",d=>{let h={value(p){o==null||o();let m=p.detail.value,y=new Set(Array.isArray(m)?m:[m]);for(let v of s.options)v.selected=y.has(v.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(p){s.multiple=!0},remove(p){let m=s.options,y=p.detail.remove;m[y].selected=!1,s.remove(y),m.length>0&&Array.prototype.findIndex.call(m,b=>b.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:a(!0),items:c(p)}),l=a(!1)},clear(p){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(p){let{index:m,displayValue:y,exportValue:v}=p.detail.insert,b=s.children[m],w=document.createElement("option");w.textContent=y,w.value=v,b?b.before(w):s.append(w),e.setValue(t,{value:a(!0),items:c(p)}),l=a(!1)},items(p){let{items:m}=p.detail;for(;s.length!==0;)s.remove(0);for(let y of m){let{displayValue:v,exportValue:b}=y,w=document.createElement("option");w.textContent=v,w.value=b,s.append(w)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:a(!0),items:c(p)}),l=a(!1)},indices(p){let m=new Set(p.detail.indices);for(let y of p.target.options)y.selected=m.has(y.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(h,d)}),s.addEventListener("input",d=>{var m;let h=a(!0),p=a(!1);e.setValue(t,{value:h}),d.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:p,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):s.addEventListener("input",function(d){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}},Ed=class extends De{constructor(e){let{data:t,elements:n}=e;super(e,{isRenderable:De._hasPopupData(t)}),this.elements=n,this.popup=null}render(){this.container.classList.add("popupAnnotation");let e=this.popup=new LA({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let n of this.elements)n.popup=e,n.container.ariaHasPopup="dialog",t.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(n=>`${Tw}${n}`).join(",")),this.container}},_l,Dm,Mm,Cl,go,Te,Xi,Tl,Lu,Ou,xl,Ji,Pn,Zi,Uu,Qi,Hu,mo,yo,Rl,zp,Bu,OA,Pm,Hx,km,Bx,Nm,Vx,Fm,Gx,Il,qp,Dl,Wp,Vu,UA,LA=class{constructor({container:e,color:t,elements:n,titleObj:s,modificationDate:r,contentsObj:o,richText:a,parent:l,rect:c,parentRect:d,open:h}){E(this,Rl);E(this,Bu);E(this,Pm);E(this,km);E(this,Nm);E(this,Fm);E(this,Il);E(this,Dl);E(this,Vu);E(this,_l,S(this,Nm,Vx).bind(this));E(this,Dm,S(this,Vu,UA).bind(this));E(this,Mm,S(this,Dl,Wp).bind(this));E(this,Cl,S(this,Il,qp).bind(this));E(this,go,null);E(this,Te,null);E(this,Xi,null);E(this,Tl,null);E(this,Lu,null);E(this,Ou,null);E(this,xl,null);E(this,Ji,!1);E(this,Pn,null);E(this,Zi,null);E(this,Uu,null);E(this,Qi,null);E(this,Hu,null);E(this,mo,null);E(this,yo,!1);var p;A(this,Te,e),A(this,Hu,s),A(this,Xi,o),A(this,Qi,a),A(this,Ou,l),A(this,go,t),A(this,Uu,c),A(this,xl,d),A(this,Lu,n),A(this,Tl,ld.toDateObject(r)),this.trigger=n.flatMap(m=>m.getElementsToTriggerPopup());for(let m of this.trigger)m.addEventListener("click",u(this,Cl)),m.addEventListener("mouseenter",u(this,Mm)),m.addEventListener("mouseleave",u(this,Dm)),m.classList.add("popupTriggerArea");for(let m of n)(p=m.container)==null||p.addEventListener("keydown",u(this,_l));u(this,Te).hidden=!0,h&&S(this,Il,qp).call(this)}render(){if(u(this,Pn))return;let e=A(this,Pn,document.createElement("div"));if(e.className="popup",u(this,go)){let r=e.style.outlineColor=V.makeHexColor(...u(this,go));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`:e.style.backgroundColor=V.makeHexColor(...u(this,go).map(a=>Math.floor(.7*(255-a)+a)))}let t=document.createElement("span");t.className="header";let n=document.createElement("h1");if(t.append(n),{dir:n.dir,str:n.textContent}=u(this,Hu),e.append(t),u(this,Tl)){let r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:u(this,Tl).valueOf()})),t.append(r)}let s=u(this,Rl,zp);if(s)Sg.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{let r=this._formatContents(u(this,Xi));e.append(r)}u(this,Te).append(e)}_formatContents({str:e,dir:t}){let n=document.createElement("p");n.classList.add("popupContent"),n.dir=t;let s=e.split(/(?:\r\n?|\n)/);for(let r=0,o=s.length;r<o;++r){let a=s[r];n.append(document.createTextNode(a)),r<o-1&&n.append(document.createElement("br"))}return n}updateEdited({rect:e,popupContent:t}){var n;u(this,mo)||A(this,mo,{contentsObj:u(this,Xi),richText:u(this,Qi)}),e&&A(this,Zi,null),t&&(A(this,Qi,S(this,km,Bx).call(this,t)),A(this,Xi,null)),(n=u(this,Pn))==null||n.remove(),A(this,Pn,null)}resetEdited(){var e;u(this,mo)&&({contentsObj:vt(this,Xi)._,richText:vt(this,Qi)._}=u(this,mo),A(this,mo,null),(e=u(this,Pn))==null||e.remove(),A(this,Pn,null),A(this,Zi,null))}forceHide(){A(this,yo,this.isVisible),u(this,yo)&&(u(this,Te).hidden=!0)}maybeShow(){u(this,yo)&&(u(this,Pn)||S(this,Dl,Wp).call(this),A(this,yo,!1),u(this,Te).hidden=!1)}get isVisible(){return u(this,Te).hidden===!1}};_l=new WeakMap,Dm=new WeakMap,Mm=new WeakMap,Cl=new WeakMap,go=new WeakMap,Te=new WeakMap,Xi=new WeakMap,Tl=new WeakMap,Lu=new WeakMap,Ou=new WeakMap,xl=new WeakMap,Ji=new WeakMap,Pn=new WeakMap,Zi=new WeakMap,Uu=new WeakMap,Qi=new WeakMap,Hu=new WeakMap,mo=new WeakMap,yo=new WeakMap,Rl=new WeakSet,zp=function(){let e=u(this,Qi),t=u(this,Xi);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&u(this,Qi).html||null},Bu=new WeakSet,OA=function(){var e,t,n;return((n=(t=(e=u(this,Rl,zp))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.fontSize)||0},Pm=new WeakSet,Hx=function(){var e,t,n;return((n=(t=(e=u(this,Rl,zp))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.color)||null},km=new WeakSet,Bx=function(e){let t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:u(this,Pm,Hx),fontSize:u(this,Bu,OA)?`calc(${u(this,Bu,OA)}px * var(--scale-factor))`:""}};for(let r of e.split(`
`))t.push({name:"span",value:r,attributes:s});return n},Nm=new WeakSet,Vx=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&u(this,Ji))&&S(this,Il,qp).call(this)},Fm=new WeakSet,Gx=function(){if(u(this,Zi)!==null)return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:s,pageY:r}}}=u(this,Ou),o=!!u(this,xl),a=o?u(this,xl):u(this,Uu);for(let y of u(this,Lu))if(!a||V.intersect(y.data.rect,a)!==null){a=y.data.rect,o=!0;break}let l=V.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),d=o?a[2]-a[0]+5:0,h=l[0]+d,p=l[1];A(this,Zi,[100*(h-s)/t,100*(p-r)/n]);let{style:m}=u(this,Te);m.left=`${u(this,Zi)[0]}%`,m.top=`${u(this,Zi)[1]}%`},Il=new WeakSet,qp=function(){A(this,Ji,!u(this,Ji)),u(this,Ji)?(S(this,Dl,Wp).call(this),u(this,Te).addEventListener("click",u(this,Cl)),u(this,Te).addEventListener("keydown",u(this,_l))):(S(this,Vu,UA).call(this),u(this,Te).removeEventListener("click",u(this,Cl)),u(this,Te).removeEventListener("keydown",u(this,_l)))},Dl=new WeakSet,Wp=function(){u(this,Pn)||this.render(),this.isVisible?u(this,Ji)&&u(this,Te).classList.add("focused"):(S(this,Fm,Gx).call(this),u(this,Te).hidden=!1,u(this,Te).style.zIndex=parseInt(u(this,Te).style.zIndex)+1e3)},Vu=new WeakSet,UA=function(){u(this,Te).classList.remove("focused"),!(u(this,Ji)||!this.isVisible)&&(u(this,Te).hidden=!0,u(this,Te).style.zIndex=parseInt(u(this,Te).style.zIndex)-1e3)};var Tg=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Z.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(let t of this.textContent){let n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Gu,HA=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,Gu,null)}render(){this.container.classList.add("lineAnnotation");let t=this.data,{width:n,height:s}=nr(t.rect),r=this.svgFactory.create(n,s,!0),o=A(this,Gu,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Gu)}addHighlightArea(){this.container.classList.add("highlightArea")}};Gu=new WeakMap;var $u,BA=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,$u,null)}render(){this.container.classList.add("squareAnnotation");let t=this.data,{width:n,height:s}=nr(t.rect),r=this.svgFactory.create(n,s,!0),o=t.borderStyle.width,a=A(this,$u,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",o/2),a.setAttribute("y",o/2),a.setAttribute("width",n-o),a.setAttribute("height",s-o),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,$u)}addHighlightArea(){this.container.classList.add("highlightArea")}};$u=new WeakMap;var zu,VA=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,zu,null)}render(){this.container.classList.add("circleAnnotation");let t=this.data,{width:n,height:s}=nr(t.rect),r=this.svgFactory.create(n,s,!0),o=t.borderStyle.width,a=A(this,zu,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",n/2),a.setAttribute("cy",s/2),a.setAttribute("rx",n/2-o/2),a.setAttribute("ry",s/2-o/2),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,zu)}addHighlightArea(){this.container.classList.add("highlightArea")}};zu=new WeakMap;var qu,xg=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,qu,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,vertices:n,borderStyle:s,popupRef:r}}=this;if(!n)return this.container;let{width:o,height:a}=nr(t),l=this.svgFactory.create(o,a,!0),c=[];for(let h=0,p=n.length;h<p;h+=2){let m=n[h]-t[0],y=t[3]-n[h+1];c.push(`${m},${y}`)}c=c.join(" ");let d=A(this,qu,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",c),d.setAttribute("stroke-width",s.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),l.append(d),this.container.append(l),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,qu)}addHighlightArea(){this.container.classList.add("highlightArea")}};qu=new WeakMap;var GA=class extends xg{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},$A=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},Wu,vo,Yu,zA,bd=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,Yu);E(this,Wu,null);E(this,vo,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Z.HIGHLIGHT:Z.INK}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,rotation:n,inkLists:s,borderStyle:r,popupRef:o}}=this,{transform:a,width:l,height:c}=S(this,Yu,zA).call(this,n,t),d=this.svgFactory.create(l,c,!0),h=A(this,Wu,this.svgFactory.createElement("svg:g"));d.append(h),h.setAttribute("stroke-width",r.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",a);for(let p=0,m=s.length;p<m;p++){let y=this.svgFactory.createElement(this.svgElementName);u(this,vo).push(y),y.setAttribute("points",s[p].join(",")),h.append(y)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);let{thickness:n,points:s,rect:r}=t,o=u(this,Wu);if(n>=0&&o.setAttribute("stroke-width",n||1),s)for(let a=0,l=u(this,vo).length;a<l;a++)u(this,vo)[a].setAttribute("points",s[a].join(","));if(r){let{transform:a,width:l,height:c}=S(this,Yu,zA).call(this,this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${l} ${c}`),o.setAttribute("transform",a)}}getElementsToTriggerPopup(){return u(this,vo)}addHighlightArea(){this.container.classList.add("highlightArea")}};Wu=new WeakMap,vo=new WeakMap,Yu=new WeakSet,zA=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};var Rg=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Z.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},qA=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},WA=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},YA=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},Ig=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Z.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Ku,Xu,XA,KA=class extends De{constructor(t){var s;super(t,{isRenderable:!0});E(this,Xu);E(this,Ku,null);let{file:n}=this.data;this.filename=n.filename,this.content=n.content,(s=this.linkService.eventBus)==null||s.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:t,data:n}=this,s;n.hasAppearance||n.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),s.addEventListener("dblclick",S(this,Xu,XA).bind(this)),A(this,Ku,s);let{isMac:r}=nt.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&S(this,Xu,XA).call(this)}),!n.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return u(this,Ku)}addHighlightArea(){this.container.classList.add("highlightArea")}};Ku=new WeakMap,Xu=new WeakSet,XA=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var Ju,Eo,bo,Zu,Lm,$x,Qu,ZA,JA=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:s,page:r,viewport:o,structTreeLayer:a}){E(this,Lm);E(this,Qu);E(this,Ju,null);E(this,Eo,null);E(this,bo,new Map);E(this,Zu,null);this.div=e,A(this,Ju,t),A(this,Eo,n),A(this,Zu,a||null),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return u(this,bo).size>0}async render(e){var o;let{annotations:t}=e,n=this.div;Wo(n,this.viewport);let s=new Map,r={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new vd,annotationStorage:e.annotationStorage||new pd,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let a of t){if(a.noHTML)continue;let l=a.annotationType===Ue.POPUP;if(l){let h=s.get(a.id);if(!h)continue;r.elements=h}else{let{width:h,height:p}=nr(a.rect);if(h<=0||p<=0)continue}r.data=a;let c=RA.create(r);if(!c.isRenderable)continue;if(!l&&a.popupRef){let h=s.get(a.popupRef);h?h.push(c):s.set(a.popupRef,[c])}let d=c.render();a.hidden&&(d.style.visibility="hidden"),await S(this,Lm,$x).call(this,d,a.id),c._isEditable&&(u(this,bo).set(c.data.id,c),(o=this._annotationEditorUIManager)==null||o.renderAnnotationElement(c))}S(this,Qu,ZA).call(this)}update({viewport:e}){let t=this.div;this.viewport=e,Wo(t,{rotation:e.rotation}),S(this,Qu,ZA).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(u(this,bo).values())}getEditableAnnotation(e){return u(this,bo).get(e)}};Ju=new WeakMap,Eo=new WeakMap,bo=new WeakMap,Zu=new WeakMap,Lm=new WeakSet,$x=async function(e,t){var o,a;let n=e.firstChild||e,s=n.id=`${Tw}${t}`,r=await((o=u(this,Zu))==null?void 0:o.getAriaAttributes(s));if(r)for(let[l,c]of r)n.setAttribute(l,c);this.div.append(e),(a=u(this,Ju))==null||a.moveElementInDOM(this.div,e,n,!1)},Qu=new WeakSet,ZA=function(){if(!u(this,Eo))return;let e=this.div;for(let[t,n]of u(this,Eo)){let s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;n.className="annotationContent";let{firstChild:r}=s;r?r.nodeName==="CANVAS"?r.replaceWith(n):r.classList.contains("annotationContent")?r.after(n):r.before(n):s.append(n)}u(this,Eo).clear()};var xp=/\r\n?|\n/g,kn,zt,ju,Ao,qt,Om,zx,Um,qx,Hm,Wx,Ml,Yp,Pl,Kp,kl,Xp,Bm,Yx,eh,jA,Vm,Kx,pe=class pe extends _e{constructor(t){super({...t,name:"freeTextEditor"});E(this,Om);E(this,Um);E(this,Hm);E(this,Ml);E(this,kl);E(this,Bm);E(this,Vm);E(this,kn,void 0);E(this,zt,"");E(this,ju,`${this.id}-editor`);E(this,Ao,null);E(this,qt,void 0);A(this,kn,t.color||pe._defaultColor||_e._defaultLineColor),A(this,qt,t.fontSize||pe._defaultFontSize)}static get _keyboardManager(){let t=pe.prototype,n=o=>o.isEmpty(),s=Ko.TRANSLATE_SMALL,r=Ko.TRANSLATE_BIG;return ie(this,"_keyboardManager",new Yo([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:n}]]))}static initialize(t,n){_e.initialize(t,n);let s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case oe.FREETEXT_SIZE:pe._defaultFontSize=n;break;case oe.FREETEXT_COLOR:pe._defaultColor=n;break}}updateParams(t,n){switch(t){case oe.FREETEXT_SIZE:S(this,Om,zx).call(this,n);break;case oe.FREETEXT_COLOR:S(this,Um,qx).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[oe.FREETEXT_SIZE,pe._defaultFontSize],[oe.FREETEXT_COLOR,pe._defaultColor||_e._defaultLineColor]]}get propertiesToUpdate(){return[[oe.FREETEXT_SIZE,u(this,qt)],[oe.FREETEXT_COLOR,u(this,kn)]]}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){let t=this.parentScale;return[-pe._internalPadding*t,-(pe._internalPadding+u(this,qt))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Z.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),A(this,Ao,new AbortController);let t=this._uiManager.combinedSignal(u(this,Ao));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",u(this,ju)),this._isDraggable=!0,(t=u(this,Ao))==null||t.abort(),A(this,Ao,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var n;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let t=u(this,zt),n=A(this,zt,S(this,Hm,Wx).call(this).trimEnd());if(t===n)return;let s=r=>{if(A(this,zt,r),!r){this.remove();return}S(this,kl,Xp).call(this),this._uiManager.rebuild(this),S(this,Ml,Yp).call(this)};this.addCommands({cmd:()=>{s(n)},undo:()=>{s(t)},mustExec:!1}),S(this,Ml,Yp).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){pe._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,n;this.width&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",u(this,ju)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:s}=this.editorDiv;if(s.fontSize=`calc(${u(this,qt)}px * var(--scale-factor))`,s.color=u(this,kn),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),ag(this,this.div,["dblclick","keydown"]),this.width){let[r,o]=this.parentDimensions;if(this.annotationElementId){let{position:a}=this._initialData,[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);let[d,h]=this.pageDimensions,[p,m]=this.pageTranslation,y,v;switch(this.rotation){case 0:y=t+(a[0]-p)/d,v=n+this.height-(a[1]-m)/h;break;case 90:y=t+(a[0]-p)/d,v=n-(a[1]-m)/h,[l,c]=[c,-l];break;case 180:y=t-this.width+(a[0]-p)/d,v=n-(a[1]-m)/h,[l,c]=[-l,-c];break;case 270:y=t+(a[0]-p-this.height*h)/d,v=n+(a[1]-m-this.width*d)/h,[l,c]=[-c,l];break}this.setAt(y*r,v*o,l,c)}else this.setAt(t*r,n*o,this.width*r,this.height*o);S(this,kl,Xp).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var y,v,b;let n=t.clipboardData||window.clipboardData,{types:s}=n;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();let r=S(y=pe,eh,jA).call(y,n.getData("text")||"").replaceAll(xp,`
`);if(!r)return;let o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();let a=o.getRangeAt(0);if(!r.includes(`
`)){a.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}let{startContainer:l,startOffset:c}=a,d=[],h=[];if(l.nodeType===Node.TEXT_NODE){let w=l.parentElement;if(h.push(l.nodeValue.slice(c).replaceAll(xp,"")),w!==this.editorDiv){let _=d;for(let C of this.editorDiv.childNodes){if(C===w){_=h;continue}_.push(S(v=pe,Pl,Kp).call(v,C))}}d.push(l.nodeValue.slice(0,c).replaceAll(xp,""))}else if(l===this.editorDiv){let w=d,_=0;for(let C of this.editorDiv.childNodes)_++===c&&(w=h),w.push(S(b=pe,Pl,Kp).call(b,C))}A(this,zt,`${d.join(`
`)}${r}${h.join(`
`)}`),S(this,kl,Xp).call(this);let p=new Range,m=d.reduce((w,_)=>w+_.length,0);for(let{firstChild:w}of this.editorDiv.childNodes)if(w.nodeType===Node.TEXT_NODE){let _=w.nodeValue.length;if(m<=_){p.setStart(w,m),p.setEnd(w,m);break}m-=_}o.removeAllRanges(),o.addRange(p)}get contentDiv(){return this.editorDiv}static async deserialize(t,n,s){var a;let r=null;if(t instanceof Tg){let{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:d,rotation:h,id:p,popupRef:m},textContent:y,textPosition:v,parent:{page:{pageNumber:b}}}=t;if(!y||y.length===0)return null;r=t={annotationType:Z.FREETEXT,color:Array.from(c),fontSize:l,value:y.join(`
`),position:v,pageIndex:b-1,rect:d.slice(0),rotation:h,id:p,deleted:!1,popupRef:m}}let o=await super.deserialize(t,n,s);return A(o,qt,t.fontSize),A(o,kn,V.makeHexColor(...t.color)),A(o,zt,S(a=pe,eh,jA).call(a,t.value)),o.annotationElementId=t.id||null,o._initialData=r,o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let n=pe._internalPadding*this.parentScale,s=this.getRect(n,n),r=_e._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:u(this,kn)),o={annotationType:Z.FREETEXT,color:r,fontSize:u(this,qt),value:S(this,Bm,Yx).call(this),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?o:this.annotationElementId&&!S(this,Vm,Kx).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(t){let n=super.renderAnnotationElement(t);if(this.deleted)return n;let{style:s}=n;s.fontSize=`calc(${u(this,qt)}px * var(--scale-factor))`,s.color=u(this,kn),n.replaceChildren();for(let o of u(this,zt).split(`
`)){let a=document.createElement("div");a.append(o?document.createTextNode(o):document.createElement("br")),n.append(a)}let r=pe._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(r,r),popupContent:u(this,zt)}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};kn=new WeakMap,zt=new WeakMap,ju=new WeakMap,Ao=new WeakMap,qt=new WeakMap,Om=new WeakSet,zx=function(t){let n=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--scale-factor))`,this.translate(0,-(r-u(this,qt))*this.parentScale),A(this,qt,r),S(this,Ml,Yp).call(this)},s=u(this,qt);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:oe.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Um=new WeakSet,qx=function(t){let n=r=>{A(this,kn,this.editorDiv.style.color=r)},s=u(this,kn);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:oe.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Hm=new WeakSet,Wx=function(){var s;let t=[];this.editorDiv.normalize();let n=null;for(let r of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(S(s=pe,Pl,Kp).call(s,r)),n=r);return t.join(`
`)},Ml=new WeakSet,Yp=function(){let[t,n]=this.parentDimensions,s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{let{currentLayer:r,div:o}=this,a=o.style.display,l=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),s=o.getBoundingClientRect(),o.remove(),o.style.display=a,o.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/n):(this.width=s.height/t,this.height=s.width/n),this.fixAndSetPosition()},Pl=new WeakSet,Kp=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(xp,"")},kl=new WeakSet,Xp=function(){if(this.editorDiv.replaceChildren(),!!u(this,zt))for(let t of u(this,zt).split(`
`)){let n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},Bm=new WeakSet,Yx=function(){return u(this,zt).replaceAll("\xA0"," ")},eh=new WeakSet,jA=function(t){return t.replaceAll(" ","\xA0")},Vm=new WeakSet,Kx=function(t){let{value:n,fontSize:s,color:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||t.value!==n||t.fontSize!==s||t.color.some((a,l)=>a!==r[l])||t.pageIndex!==o},E(pe,Pl),E(pe,eh),W(pe,"_freeTextDefaultContent",""),W(pe,"_internalPadding",0),W(pe,"_defaultColor",null),W(pe,"_defaultFontSize",10),W(pe,"_type","freetext"),W(pe,"_editorType",Z.FREETEXT);var QA=pe,H=class{toSVGPath(){ge("Abstract method `toSVGPath` must be implemented.")}get box(){ge("Abstract getter `box` must be implemented.")}serialize(e,t){ge("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,s,r,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a]*s,o[a+1]=n+e[a+1]*r;return o}static _rescaleAndSwap(e,t,n,s,r,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a+1]*s,o[a+1]=n+e[a]*r;return o}static _translate(e,t,n,s){s||(s=new Float32Array(e.length));for(let r=0,o=e.length;r<o;r+=2)s[r]=t+e[r],s[r+1]=n+e[r+1];return s}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,s,r){switch(r){case 90:return[1-t/n,e/s];case 180:return[1-e/n,1-t/s];case 270:return[t/n,1-e/s];default:return[e/n,t/s]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,s,r,o){return[(e+5*n)/6,(t+5*s)/6,(5*n+r)/6,(5*s+o)/6,(n+r)/2,(s+o)/2]}};W(H,"PRECISION",1e-4);var Wt,Nn,Nl,Fl,ai,ne,wo,So,th,nh,Ll,Ol,$s,ih,Gm,$m,_o,ed,zm,Xx,qm,Jx,Wm,Zx,Ym,Qx,Km,jx,Xm,eR,ki=class ki{constructor({x:e,y:t},n,s,r,o,a=0){E(this,_o);E(this,zm);E(this,qm);E(this,Wm);E(this,Ym);E(this,Km);E(this,Xm);E(this,Wt,void 0);E(this,Nn,[]);E(this,Nl,void 0);E(this,Fl,void 0);E(this,ai,[]);E(this,ne,new Float32Array(18));E(this,wo,void 0);E(this,So,void 0);E(this,th,void 0);E(this,nh,void 0);E(this,Ll,void 0);E(this,Ol,void 0);E(this,$s,[]);A(this,Wt,n),A(this,Ol,r*s),A(this,Fl,o),u(this,ne).set([NaN,NaN,NaN,NaN,e,t],6),A(this,Nl,a),A(this,nh,u(ki,ih)*s),A(this,th,u(ki,$m)*s),A(this,Ll,s),u(this,$s).push(e,t)}isEmpty(){return isNaN(u(this,ne)[8])}add({x:e,y:t}){var N;A(this,wo,e),A(this,So,t);let[n,s,r,o]=u(this,Wt),[a,l,c,d]=u(this,ne).subarray(8,12),h=e-c,p=t-d,m=Math.hypot(h,p);if(m<u(this,th))return!1;let y=m-u(this,nh),v=y/m,b=v*h,w=v*p,_=a,C=l;a=c,l=d,c+=b,d+=w,(N=u(this,$s))==null||N.push(e,t);let T=-w/y,R=b/y,D=T*u(this,Ol),I=R*u(this,Ol);return u(this,ne).set(u(this,ne).subarray(2,8),0),u(this,ne).set([c+D,d+I],4),u(this,ne).set(u(this,ne).subarray(14,18),12),u(this,ne).set([c-D,d-I],16),isNaN(u(this,ne)[6])?(u(this,ai).length===0&&(u(this,ne).set([a+D,l+I],2),u(this,ai).push(NaN,NaN,NaN,NaN,(a+D-n)/r,(l+I-s)/o),u(this,ne).set([a-D,l-I],14),u(this,Nn).push(NaN,NaN,NaN,NaN,(a-D-n)/r,(l-I-s)/o)),u(this,ne).set([_,C,a,l,c,d],6),!this.isEmpty()):(u(this,ne).set([_,C,a,l,c,d],6),Math.abs(Math.atan2(C-l,_-a)-Math.atan2(w,b))<Math.PI/2?([a,l,c,d]=u(this,ne).subarray(2,6),u(this,ai).push(NaN,NaN,NaN,NaN,((a+c)/2-n)/r,((l+d)/2-s)/o),[a,l,_,C]=u(this,ne).subarray(14,18),u(this,Nn).push(NaN,NaN,NaN,NaN,((_+a)/2-n)/r,((C+l)/2-s)/o),!0):([_,C,a,l,c,d]=u(this,ne).subarray(0,6),u(this,ai).push(((_+5*a)/6-n)/r,((C+5*l)/6-s)/o,((5*a+c)/6-n)/r,((5*l+d)/6-s)/o,((a+c)/2-n)/r,((l+d)/2-s)/o),[c,d,a,l,_,C]=u(this,ne).subarray(12,18),u(this,Nn).push(((_+5*a)/6-n)/r,((C+5*l)/6-s)/o,((5*a+c)/6-n)/r,((5*l+d)/6-s)/o,((a+c)/2-n)/r,((l+d)/2-s)/o),!0))}toSVGPath(){if(this.isEmpty())return"";let e=u(this,ai),t=u(this,Nn);if(isNaN(u(this,ne)[6])&&!this.isEmpty())return S(this,zm,Xx).call(this);let n=[];n.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?n.push(`L${e[s+4]} ${e[s+5]}`):n.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);S(this,Wm,Zx).call(this,n);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?n.push(`L${t[s+4]} ${t[s+5]}`):n.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return S(this,qm,Jx).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,s,r,o){return new Mg(e,t,n,s,r,o)}getOutlines(){var h,p;let e=u(this,ai),t=u(this,Nn),n=u(this,ne),[s,r,o,a]=u(this,Wt),l=new Float32Array(((p=(h=u(this,$s))==null?void 0:h.length)!=null?p:0)+2);for(let m=0,y=l.length-2;m<y;m+=2)l[m]=(u(this,$s)[m]-s)/o,l[m+1]=(u(this,$s)[m+1]-r)/a;if(l[l.length-2]=(u(this,wo)-s)/o,l[l.length-1]=(u(this,So)-r)/a,isNaN(n[6])&&!this.isEmpty())return S(this,Ym,Qx).call(this,l);let c=new Float32Array(u(this,ai).length+24+u(this,Nn).length),d=e.length;for(let m=0;m<d;m+=2){if(isNaN(e[m])){c[m]=c[m+1]=NaN;continue}c[m]=e[m],c[m+1]=e[m+1]}d=S(this,Xm,eR).call(this,c,d);for(let m=t.length-6;m>=6;m-=6)for(let y=0;y<6;y+=2){if(isNaN(t[m+y])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=t[m+y],c[d+1]=t[m+y+1],d+=2}return S(this,Km,jx).call(this,c,d),this.newFreeDrawOutline(c,l,u(this,Wt),u(this,Ll),u(this,Nl),u(this,Fl))}};Wt=new WeakMap,Nn=new WeakMap,Nl=new WeakMap,Fl=new WeakMap,ai=new WeakMap,ne=new WeakMap,wo=new WeakMap,So=new WeakMap,th=new WeakMap,nh=new WeakMap,Ll=new WeakMap,Ol=new WeakMap,$s=new WeakMap,ih=new WeakMap,Gm=new WeakMap,$m=new WeakMap,_o=new WeakSet,ed=function(){let e=u(this,ne).subarray(4,6),t=u(this,ne).subarray(16,18),[n,s,r,o]=u(this,Wt);return[(u(this,wo)+(e[0]-t[0])/2-n)/r,(u(this,So)+(e[1]-t[1])/2-s)/o,(u(this,wo)+(t[0]-e[0])/2-n)/r,(u(this,So)+(t[1]-e[1])/2-s)/o]},zm=new WeakSet,Xx=function(){let[e,t,n,s]=u(this,Wt),[r,o,a,l]=S(this,_o,ed).call(this);return`M${(u(this,ne)[2]-e)/n} ${(u(this,ne)[3]-t)/s} L${(u(this,ne)[4]-e)/n} ${(u(this,ne)[5]-t)/s} L${r} ${o} L${a} ${l} L${(u(this,ne)[16]-e)/n} ${(u(this,ne)[17]-t)/s} L${(u(this,ne)[14]-e)/n} ${(u(this,ne)[15]-t)/s} Z`},qm=new WeakSet,Jx=function(e){let t=u(this,Nn);e.push(`L${t[4]} ${t[5]} Z`)},Wm=new WeakSet,Zx=function(e){let[t,n,s,r]=u(this,Wt),o=u(this,ne).subarray(4,6),a=u(this,ne).subarray(16,18),[l,c,d,h]=S(this,_o,ed).call(this);e.push(`L${(o[0]-t)/s} ${(o[1]-n)/r} L${l} ${c} L${d} ${h} L${(a[0]-t)/s} ${(a[1]-n)/r}`)},Ym=new WeakSet,Qx=function(e){let t=u(this,ne),[n,s,r,o]=u(this,Wt),[a,l,c,d]=S(this,_o,ed).call(this),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-n)/r,(t[3]-s)/o,NaN,NaN,NaN,NaN,(t[4]-n)/r,(t[5]-s)/o,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(t[16]-n)/r,(t[17]-s)/o,NaN,NaN,NaN,NaN,(t[14]-n)/r,(t[15]-s)/o],0),this.newFreeDrawOutline(h,e,u(this,Wt),u(this,Ll),u(this,Nl),u(this,Fl))},Km=new WeakSet,jx=function(e,t){let n=u(this,Nn);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},Xm=new WeakSet,eR=function(e,t){let n=u(this,ne).subarray(4,6),s=u(this,ne).subarray(16,18),[r,o,a,l]=u(this,Wt),[c,d,h,p]=S(this,_o,ed).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-r)/a,(n[1]-o)/l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,h,p,NaN,NaN,NaN,NaN,(s[0]-r)/a,(s[1]-o)/l],t),t+=24},E(ki,ih,8),E(ki,Gm,2),E(ki,$m,u(ki,ih)+u(ki,Gm));var Dg=ki,Ul,Co,ji,sh,Yt,rh,Ie,Jm,tR,Mg=class extends H{constructor(t,n,s,r,o,a){super();E(this,Jm);E(this,Ul,void 0);E(this,Co,new Float32Array(4));E(this,ji,void 0);E(this,sh,void 0);E(this,Yt,void 0);E(this,rh,void 0);E(this,Ie,void 0);A(this,Ie,t),A(this,Yt,n),A(this,Ul,s),A(this,rh,r),A(this,ji,o),A(this,sh,a),this.lastPoint=[NaN,NaN],S(this,Jm,tR).call(this,a);let[l,c,d,h]=u(this,Co);for(let p=0,m=t.length;p<m;p+=2)t[p]=(t[p]-l)/d,t[p+1]=(t[p+1]-c)/h;for(let p=0,m=n.length;p<m;p+=2)n[p]=(n[p]-l)/d,n[p+1]=(n[p+1]-c)/h}toSVGPath(){let t=[`M${u(this,Ie)[4]} ${u(this,Ie)[5]}`];for(let n=6,s=u(this,Ie).length;n<s;n+=6){if(isNaN(u(this,Ie)[n])){t.push(`L${u(this,Ie)[n+4]} ${u(this,Ie)[n+5]}`);continue}t.push(`C${u(this,Ie)[n]} ${u(this,Ie)[n+1]} ${u(this,Ie)[n+2]} ${u(this,Ie)[n+3]} ${u(this,Ie)[n+4]} ${u(this,Ie)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,s,r],o){let a=s-t,l=r-n,c,d;switch(o){case 0:c=H._rescale(u(this,Ie),t,r,a,-l),d=H._rescale(u(this,Yt),t,r,a,-l);break;case 90:c=H._rescaleAndSwap(u(this,Ie),t,n,a,l),d=H._rescaleAndSwap(u(this,Yt),t,n,a,l);break;case 180:c=H._rescale(u(this,Ie),s,n,-a,l),d=H._rescale(u(this,Yt),s,n,-a,l);break;case 270:c=H._rescaleAndSwap(u(this,Ie),s,r,-a,-l),d=H._rescaleAndSwap(u(this,Yt),s,r,-a,-l);break}return{outline:Array.from(c),points:[Array.from(d)]}}get box(){return u(this,Co)}newOutliner(t,n,s,r,o,a=0){return new Dg(t,n,s,r,o,a)}getNewOutline(t,n){let[s,r,o,a]=u(this,Co),[l,c,d,h]=u(this,Ul),p=o*d,m=a*h,y=s*d+l,v=r*h+c,b=this.newOutliner({x:u(this,Yt)[0]*p+y,y:u(this,Yt)[1]*m+v},u(this,Ul),u(this,rh),t,u(this,sh),n!=null?n:u(this,ji));for(let w=2;w<u(this,Yt).length;w+=2)b.add({x:u(this,Yt)[w]*p+y,y:u(this,Yt)[w+1]*m+v});return b.getOutlines()}};Ul=new WeakMap,Co=new WeakMap,ji=new WeakMap,sh=new WeakMap,Yt=new WeakMap,rh=new WeakMap,Ie=new WeakMap,Jm=new WeakSet,tR=function(t){let n=u(this,Ie),s=n[4],r=n[5],o=s,a=r,l=s,c=r,d=s,h=r,p=t?Math.max:Math.min;for(let y=6,v=n.length;y<v;y+=6){if(isNaN(n[y]))o=Math.min(o,n[y+4]),a=Math.min(a,n[y+5]),l=Math.max(l,n[y+4]),c=Math.max(c,n[y+5]),h<n[y+5]?(d=n[y+4],h=n[y+5]):h===n[y+5]&&(d=p(d,n[y+4]));else{let b=V.bezierBoundingBox(s,r,...n.slice(y,y+6));o=Math.min(o,b[0]),a=Math.min(a,b[1]),l=Math.max(l,b[2]),c=Math.max(c,b[3]),h<b[3]?(d=b[2],h=b[3]):h===b[3]&&(d=p(d,b[2]))}s=n[y+4],r=n[y+5]}let m=u(this,Co);m[0]=o-u(this,ji),m[1]=a-u(this,ji),m[2]=l-o+2*u(this,ji),m[3]=c-a+2*u(this,ji),this.lastPoint=[d,h]};var oh,ah,zs,Fn,Zm,nR,Hl,Jp,Qm,iR,jm,sR,lh,ew,Ad=class{constructor(e,t=0,n=0,s=!0){E(this,Zm);E(this,Hl);E(this,Qm);E(this,jm);E(this,lh);E(this,oh,void 0);E(this,ah,void 0);E(this,zs,[]);E(this,Fn,[]);let r=1/0,o=-1/0,a=1/0,l=-1/0,d=10**-4;for(let{x:w,y:_,width:C,height:T}of e){let R=Math.floor((w-t)/d)*d,D=Math.ceil((w+C+t)/d)*d,I=Math.floor((_-t)/d)*d,k=Math.ceil((_+T+t)/d)*d,N=[R,I,k,!0],F=[D,I,k,!1];u(this,zs).push(N,F),r=Math.min(r,R),o=Math.max(o,D),a=Math.min(a,I),l=Math.max(l,k)}let h=o-r+2*n,p=l-a+2*n,m=r-n,y=a-n,v=u(this,zs).at(s?-1:-2),b=[v[0],v[2]];for(let w of u(this,zs)){let[_,C,T]=w;w[0]=(_-m)/h,w[1]=(C-y)/p,w[2]=(T-y)/p}A(this,oh,new Float32Array([m,y,h,p])),A(this,ah,b)}getOutlines(){u(this,zs).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);let e=[];for(let t of u(this,zs))t[3]?(e.push(...S(this,lh,ew).call(this,t)),S(this,Qm,iR).call(this,t)):(S(this,jm,sR).call(this,t),e.push(...S(this,lh,ew).call(this,t)));return S(this,Zm,nR).call(this,e)}};oh=new WeakMap,ah=new WeakMap,zs=new WeakMap,Fn=new WeakMap,Zm=new WeakSet,nR=function(e){let t=[],n=new Set;for(let o of e){let[a,l,c]=o;t.push([a,l,o],[a,c,o])}t.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=t.length;o<a;o+=2){let l=t[o][2],c=t[o+1][2];l.push(c),c.push(l),n.add(l),n.add(c)}let s=[],r;for(;n.size>0;){let o=n.values().next().value,[a,l,c,d,h]=o;n.delete(o);let p=a,m=l;for(r=[a,c],s.push(r);;){let y;if(n.has(d))y=d;else if(n.has(h))y=h;else break;n.delete(y),[a,l,c,d,h]=y,p!==a&&(r.push(p,m,a,m===l?l:c),p=a),m=m===l?c:l}r.push(p,m)}return new tw(s,u(this,oh),u(this,ah))},Hl=new WeakSet,Jp=function(e){let t=u(this,Fn),n=0,s=t.length-1;for(;n<=s;){let r=n+s>>1,o=t[r][0];if(o===e)return r;o<e?n=r+1:s=r-1}return s+1},Qm=new WeakSet,iR=function([,e,t]){let n=S(this,Hl,Jp).call(this,e);u(this,Fn).splice(n,0,[e,t])},jm=new WeakSet,sR=function([,e,t]){let n=S(this,Hl,Jp).call(this,e);for(let s=n;s<u(this,Fn).length;s++){let[r,o]=u(this,Fn)[s];if(r!==e)break;if(r===e&&o===t){u(this,Fn).splice(s,1);return}}for(let s=n-1;s>=0;s--){let[r,o]=u(this,Fn)[s];if(r!==e)break;if(r===e&&o===t){u(this,Fn).splice(s,1);return}}},lh=new WeakSet,ew=function(e){let[t,n,s]=e,r=[[t,n,s]],o=S(this,Hl,Jp).call(this,s);for(let a=0;a<o;a++){let[l,c]=u(this,Fn)[a];for(let d=0,h=r.length;d<h;d++){let[,p,m]=r[d];if(!(c<=p||m<=l)){if(p>=l){if(m>c)r[d][1]=c;else{if(h===1)return[];r.splice(d,1),d--,h--}continue}r[d][2]=l,m>c&&r.push([t,c,m])}}}return r};var ch,Bl,tw=class extends H{constructor(t,n,s){super();E(this,ch,void 0);E(this,Bl,void 0);A(this,Bl,t),A(this,ch,n),this.lastPoint=s}toSVGPath(){let t=[];for(let n of u(this,Bl)){let[s,r]=n;t.push(`M${s} ${r}`);for(let o=2;o<n.length;o+=2){let a=n[o],l=n[o+1];a===s?(t.push(`V${l}`),r=l):l===r&&(t.push(`H${a}`),s=a)}t.push("Z")}return t.join(" ")}serialize([t,n,s,r],o){let a=[],l=s-t,c=r-n;for(let d of u(this,Bl)){let h=new Array(d.length);for(let p=0;p<d.length;p+=2)h[p]=t+d[p]*l,h[p+1]=r-d[p+1]*c;a.push(h)}return a}get box(){return u(this,ch)}get classNamesForOutlining(){return["highlightOutline"]}};ch=new WeakMap,Bl=new WeakMap;var wd=class extends Dg{newFreeDrawOutline(e,t,n,s,r,o){return new nw(e,t,n,s,r,o)}},nw=class extends Mg{newOutliner(e,t,n,s,r,o=0){return new wd(e,t,n,s,r,o)}},Ln,To,Vl,Be,dh,Gl,uh,hh,qs,On,$l,fh,ph,iw,gh,sw,mh,rw,es,wr,ey,rR,li,vs,It=class It{constructor({editor:e=null,uiManager:t=null}){E(this,ph);E(this,gh);E(this,mh);E(this,es);E(this,ey);E(this,li);E(this,Ln,null);E(this,To,null);E(this,Vl,void 0);E(this,Be,null);E(this,dh,!1);E(this,Gl,!1);E(this,uh,null);E(this,hh,void 0);E(this,qs,null);E(this,On,null);E(this,$l,void 0);var n;e?(A(this,Gl,!1),A(this,$l,oe.HIGHLIGHT_COLOR),A(this,uh,e)):(A(this,Gl,!0),A(this,$l,oe.HIGHLIGHT_DEFAULT_COLOR)),A(this,On,(e==null?void 0:e._uiManager)||t),A(this,hh,u(this,On)._eventBus),A(this,Vl,(e==null?void 0:e.color)||((n=u(this,On))==null?void 0:n.highlightColors.values().next().value)||"#FFFF98"),u(It,fh)||A(It,fh,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return ie(this,"_keyboardManager",new Yo([[["Escape","mac+Escape"],It.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],It.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],It.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],It.prototype._moveToPrevious],[["Home","mac+Home"],It.prototype._moveToBeginning],[["End","mac+End"],It.prototype._moveToEnd]]))}renderButton(){let e=A(this,Ln,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);let t=u(this,On)._signal;e.addEventListener("click",S(this,es,wr).bind(this),{signal:t}),e.addEventListener("keydown",S(this,mh,rw).bind(this),{signal:t});let n=A(this,To,document.createElement("span"));return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=u(this,Vl),e.append(n),e}renderMainDropdown(){let e=A(this,Be,S(this,ph,iw).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===u(this,Ln)){S(this,es,wr).call(this,e);return}let t=e.target.getAttribute("data-color");t&&S(this,gh,sw).call(this,t,e)}_moveToNext(e){var t,n;if(!u(this,li,vs)){S(this,es,wr).call(this,e);return}if(e.target===u(this,Ln)){(t=u(this,Be).firstChild)==null||t.focus();return}(n=e.target.nextSibling)==null||n.focus()}_moveToPrevious(e){var t,n;if(e.target===((t=u(this,Be))==null?void 0:t.firstChild)||e.target===u(this,Ln)){u(this,li,vs)&&this._hideDropdownFromKeyboard();return}u(this,li,vs)||S(this,es,wr).call(this,e),(n=e.target.previousSibling)==null||n.focus()}_moveToBeginning(e){var t;if(!u(this,li,vs)){S(this,es,wr).call(this,e);return}(t=u(this,Be).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!u(this,li,vs)){S(this,es,wr).call(this,e);return}(t=u(this,Be).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=u(this,Be))==null||e.classList.add("hidden"),(t=u(this,qs))==null||t.abort(),A(this,qs,null)}_hideDropdownFromKeyboard(){var e;if(!u(this,Gl)){if(!u(this,li,vs)){(e=u(this,uh))==null||e.unselect();return}this.hideDropdown(),u(this,Ln).focus({preventScroll:!0,focusVisible:u(this,dh)})}}updateColor(e){if(u(this,To)&&(u(this,To).style.backgroundColor=e),!u(this,Be))return;let t=u(this,On).highlightColors.values();for(let n of u(this,Be).children)n.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=u(this,Ln))==null||e.remove(),A(this,Ln,null),A(this,To,null),(t=u(this,Be))==null||t.remove(),A(this,Be,null)}};Ln=new WeakMap,To=new WeakMap,Vl=new WeakMap,Be=new WeakMap,dh=new WeakMap,Gl=new WeakMap,uh=new WeakMap,hh=new WeakMap,qs=new WeakMap,On=new WeakMap,$l=new WeakMap,fh=new WeakMap,ph=new WeakSet,iw=function(){let e=document.createElement("div"),t=u(this,On)._signal;e.addEventListener("contextmenu",Gn,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[n,s]of u(this,On).highlightColors){let r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",s),r.title=n,r.setAttribute("data-l10n-id",u(It,fh)[n]);let o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=s,r.setAttribute("aria-selected",s===u(this,Vl)),r.addEventListener("click",S(this,gh,sw).bind(this,s),{signal:t}),e.append(r)}return e.addEventListener("keydown",S(this,mh,rw).bind(this),{signal:t}),e},gh=new WeakSet,sw=function(e,t){t.stopPropagation(),u(this,hh).dispatch("switchannotationeditorparams",{source:this,type:u(this,$l),value:e})},mh=new WeakSet,rw=function(e){It._keyboardManager.exec(this,e)},es=new WeakSet,wr=function(e){if(u(this,li,vs)){this.hideDropdown();return}if(A(this,dh,e.detail===0),u(this,qs)||(A(this,qs,new AbortController),window.addEventListener("pointerdown",S(this,ey,rR).bind(this),{signal:u(this,On).combinedSignal(u(this,qs))})),u(this,Be)){u(this,Be).classList.remove("hidden");return}let t=A(this,Be,S(this,ph,iw).call(this));u(this,Ln).append(t)},ey=new WeakSet,rR=function(e){var t;(t=u(this,Be))!=null&&t.contains(e.target)||this.hideDropdown()},li=new WeakSet,vs=function(){return u(this,Be)&&!u(this,Be).classList.contains("hidden")},E(It,fh,null);var Pg=It,zl,yh,ts,xo,ql,Pt,vh,Eh,Ro,un,Kt,je,Wl,ns,ft,Yl,hn,bh,Ah,ow,Kl,Zp,ty,oR,ny,aR,iy,lR,wh,aw,is,Sr,Ws,Da,sy,cR,Xl,Qp,Io,td,ry,dR,oy,uR,ay,hR,ly,fR,cy,pR,le=class le extends _e{constructor(t){super({...t,name:"highlightEditor"});E(this,Ah);E(this,Kl);E(this,ty);E(this,ny);E(this,iy);E(this,wh);E(this,is);E(this,sy);E(this,Xl);E(this,Io);E(this,ry);E(this,oy);E(this,cy);E(this,zl,null);E(this,yh,0);E(this,ts,void 0);E(this,xo,null);E(this,ql,null);E(this,Pt,null);E(this,vh,null);E(this,Eh,0);E(this,Ro,null);E(this,un,null);E(this,Kt,null);E(this,je,!1);E(this,Wl,null);E(this,ns,void 0);E(this,ft,null);E(this,Yl,"");E(this,hn,void 0);E(this,bh,"");this.color=t.color||le._defaultColor,A(this,hn,t.thickness||le._defaultThickness),A(this,ns,t.opacity||le._defaultOpacity),A(this,ts,t.boxes||null),A(this,bh,t.methodOfCreation||""),A(this,Yl,t.text||""),this._isDraggable=!1,t.highlightId>-1?(A(this,je,!0),S(this,Kl,Zp).call(this,t),S(this,is,Sr).call(this)):u(this,ts)&&(A(this,zl,t.anchorNode),A(this,yh,t.anchorOffset),A(this,vh,t.focusNode),A(this,Eh,t.focusOffset),S(this,Ah,ow).call(this),S(this,is,Sr).call(this),this.rotate(this.rotation))}static get _keyboardManager(){let t=le.prototype;return ie(this,"_keyboardManager",new Yo([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:u(this,je)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:u(this,hn),methodOfCreation:u(this,bh)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){var s;_e.initialize(t,n),le._defaultColor||(le._defaultColor=((s=n.highlightColors)==null?void 0:s.values().next().value)||"#fff066")}static updateDefaultParams(t,n){switch(t){case oe.HIGHLIGHT_DEFAULT_COLOR:le._defaultColor=n;break;case oe.HIGHLIGHT_THICKNESS:le._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return u(this,Wl)}updateParams(t,n){switch(t){case oe.HIGHLIGHT_COLOR:S(this,ty,oR).call(this,n);break;case oe.HIGHLIGHT_THICKNESS:S(this,ny,aR).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[oe.HIGHLIGHT_DEFAULT_COLOR,le._defaultColor],[oe.HIGHLIGHT_THICKNESS,le._defaultThickness]]}get propertiesToUpdate(){return[[oe.HIGHLIGHT_COLOR,this.color||le._defaultColor],[oe.HIGHLIGHT_THICKNESS,u(this,hn)||le._defaultThickness],[oe.HIGHLIGHT_FREE,u(this,je)]]}async addEditToolbar(){let t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(A(this,ql,new Pg({editor:this})),t.addColorPicker(u(this,ql))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(S(this,Io,td).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,S(this,Io,td).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){S(this,wh,aw).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(S(this,is,Sr).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let n=!1;this.parent&&!t?S(this,wh,aw).call(this):t&&(S(this,is,Sr).call(this,t),n=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var r,o,a;let{drawLayer:n}=this.parent,s;u(this,je)?(t=(t-this.rotation+360)%360,s=S(r=le,Ws,Da).call(r,u(this,un).box,t)):s=S(o=le,Ws,Da).call(o,[this.x,this.y,this.width,this.height],t),n.updateProperties(u(this,Kt),{bbox:s,root:{"data-main-rotation":t}}),n.updateProperties(u(this,ft),{bbox:S(a=le,Ws,Da).call(a,u(this,Pt).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;let t=super.render();u(this,Yl)&&(t.setAttribute("aria-label",u(this,Yl)),t.setAttribute("role","mark")),u(this,je)?t.classList.add("free"):this.div.addEventListener("keydown",S(this,sy,cR).bind(this),{signal:this._uiManager._signal});let n=A(this,Ro,document.createElement("div"));t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=u(this,xo);let[s,r]=this.parentDimensions;return this.setDims(this.width*s,this.height*r),ag(this,u(this,Ro),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(u(this,ft),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(u(this,ft),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:S(this,Xl,Qp).call(this,!0);break;case 1:case 3:S(this,Xl,Qp).call(this,!1);break}}select(){var t;super.select(),u(this,ft)&&((t=this.parent)==null||t.drawLayer.updateProperties(u(this,ft),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),u(this,ft)&&((t=this.parent)==null||t.drawLayer.updateProperties(u(this,ft),{rootClass:{selected:!1}}),u(this,je)||S(this,Xl,Qp).call(this,!1))}get _mustFixPosition(){return!u(this,je)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(u(this,Kt),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(u(this,ft),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:s,x:r,y:o}){let{x:a,y:l,width:c,height:d}=s.getBoundingClientRect(),h=new AbortController,p=t.combinedSignal(h),m=y=>{h.abort(),S(this,ly,fR).call(this,t,y)};window.addEventListener("blur",m,{signal:p}),window.addEventListener("pointerup",m,{signal:p}),window.addEventListener("pointerdown",jt,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Gn,{signal:p}),s.addEventListener("pointermove",S(this,ay,hR).bind(this,t),{signal:p}),this._freeHighlight=new wd({x:r,y:o},[a,l,c,d],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,s){var v,b,w,_;let r=null;if(t instanceof Rg){let{data:{quadPoints:C,rect:T,rotation:R,id:D,color:I,opacity:k,popupRef:N},parent:{page:{pageNumber:F}}}=t;r=t={annotationType:Z.HIGHLIGHT,color:Array.from(I),opacity:k,quadPoints:C,boxes:null,pageIndex:F-1,rect:T.slice(0),rotation:R,id:D,deleted:!1,popupRef:N}}else if(t instanceof bd){let{data:{inkLists:C,rect:T,rotation:R,id:D,color:I,borderStyle:{rawWidth:k},popupRef:N},parent:{page:{pageNumber:F}}}=t;r=t={annotationType:Z.HIGHLIGHT,color:Array.from(I),thickness:k,inkLists:C,boxes:null,pageIndex:F-1,rect:T.slice(0),rotation:R,id:D,deleted:!1,popupRef:N}}let{color:o,quadPoints:a,inkLists:l,opacity:c}=t,d=await super.deserialize(t,n,s);d.color=V.makeHexColor(...o),A(d,ns,c||1),l&&A(d,hn,t.thickness),d.annotationElementId=t.id||null,d._initialData=r;let[h,p]=d.pageDimensions,[m,y]=d.pageTranslation;if(a){let C=A(d,ts,[]);for(let T=0;T<a.length;T+=8)C.push({x:(a[T]-m)/h,y:1-(a[T+1]-y)/p,width:(a[T+2]-a[T])/h,height:(a[T+1]-a[T+5])/p});S(v=d,Ah,ow).call(v),S(b=d,is,Sr).call(b),d.rotate(d.rotation)}else if(l){A(d,je,!0);let C=l[0],T={x:C[0]-m,y:p-(C[1]-y)},R=new wd(T,[0,0,h,p],1,u(d,hn)/2,!0,.001);for(let k=0,N=C.length;k<N;k+=2)T.x=C[k]-m,T.y=p-(C[k+1]-y),R.add(T);let{id:D,clipPathId:I}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:R.toSVGPath()}},!0,!0);S(w=d,Kl,Zp).call(w,{highlightOutlines:R.getOutlines(),highlightId:D,clipPathId:I}),S(_=d,is,Sr).call(_)}return d}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();let n=this.getRect(0,0),s=_e._colorManager.convert(this.color),r={annotationType:Z.HIGHLIGHT,color:s,opacity:u(this,ns),thickness:u(this,hn),quadPoints:S(this,ry,dR).call(this),outlines:S(this,oy,uR).call(this,n),pageIndex:this.pageIndex,rect:n,rotation:S(this,Io,td).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!S(this,cy,pR).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};zl=new WeakMap,yh=new WeakMap,ts=new WeakMap,xo=new WeakMap,ql=new WeakMap,Pt=new WeakMap,vh=new WeakMap,Eh=new WeakMap,Ro=new WeakMap,un=new WeakMap,Kt=new WeakMap,je=new WeakMap,Wl=new WeakMap,ns=new WeakMap,ft=new WeakMap,Yl=new WeakMap,hn=new WeakMap,bh=new WeakMap,Ah=new WeakSet,ow=function(){let t=new Ad(u(this,ts),.001);A(this,un,t.getOutlines()),[this.x,this.y,this.width,this.height]=u(this,un).box;let n=new Ad(u(this,ts),.0025,.001,this._uiManager.direction==="ltr");A(this,Pt,n.getOutlines());let{lastPoint:s}=u(this,Pt);A(this,Wl,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height])},Kl=new WeakSet,Zp=function({highlightOutlines:t,highlightId:n,clipPathId:s}){var h,p;if(A(this,un,t),A(this,Pt,t.getNewOutline(u(this,hn)/2+1.5,.0025)),n>=0)A(this,Kt,n),A(this,xo,s),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),A(this,ft,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:u(this,Pt).box,path:{d:u(this,Pt).toSVGPath()}},!0));else if(this.parent){let m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(u(this,Kt),{bbox:S(h=le,Ws,Da).call(h,u(this,un).box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(u(this,ft),{bbox:S(p=le,Ws,Da).call(p,u(this,Pt).box,m),path:{d:u(this,Pt).toSVGPath()}})}let[o,a,l,c]=t.box;switch(this.rotation){case 0:this.x=o,this.y=a,this.width=l,this.height=c;break;case 90:{let[m,y]=this.parentDimensions;this.x=a,this.y=1-o,this.width=l*y/m,this.height=c*m/y;break}case 180:this.x=1-o,this.y=1-a,this.width=l,this.height=c;break;case 270:{let[m,y]=this.parentDimensions;this.x=1-a,this.y=o,this.width=l*y/m,this.height=c*m/y;break}}let{lastPoint:d}=u(this,Pt);A(this,Wl,[(d[0]-o)/l,(d[1]-a)/c])},ty=new WeakSet,oR=function(t){let n=(o,a)=>{var l,c;this.color=o,A(this,ns,a),(l=this.parent)==null||l.drawLayer.updateProperties(u(this,Kt),{root:{fill:o,"fill-opacity":a}}),(c=u(this,ql))==null||c.updateColor(o)},s=this.color,r=u(this,ns);this.addCommands({cmd:n.bind(this,t,le._defaultOpacity),undo:n.bind(this,s,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:oe.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},ny=new WeakSet,aR=function(t){let n=u(this,hn),s=r=>{A(this,hn,r),S(this,iy,lR).call(this,r)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:oe.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},iy=new WeakSet,lR=function(t){if(!u(this,je))return;S(this,Kl,Zp).call(this,{highlightOutlines:u(this,un).getNewOutline(t/2)}),this.fixAndSetPosition();let[n,s]=this.parentDimensions;this.setDims(this.width*n,this.height*s)},wh=new WeakSet,aw=function(){u(this,Kt)===null||!this.parent||(this.parent.drawLayer.remove(u(this,Kt)),A(this,Kt,null),this.parent.drawLayer.remove(u(this,ft)),A(this,ft,null))},is=new WeakSet,Sr=function(t=this.parent){u(this,Kt)===null&&({id:vt(this,Kt)._,clipPathId:vt(this,xo)._}=t.drawLayer.draw({bbox:u(this,un).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":u(this,ns)},rootClass:{highlight:!0,free:u(this,je)},path:{d:u(this,un).toSVGPath()}},!1,!0),A(this,ft,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:u(this,je)},bbox:u(this,Pt).box,path:{d:u(this,Pt).toSVGPath()}},u(this,je))),u(this,Ro)&&(u(this,Ro).style.clipPath=u(this,xo)))},Ws=new WeakSet,Da=function([t,n,s,r],o){switch(o){case 90:return[1-n-r,t,r,s];case 180:return[1-t-s,1-n-r,s,r];case 270:return[n,1-t-s,r,s]}return[t,n,s,r]},sy=new WeakSet,cR=function(t){le._keyboardManager.exec(this,t)},Xl=new WeakSet,Qp=function(t){if(!u(this,zl))return;let n=window.getSelection();t?n.setPosition(u(this,zl),u(this,yh)):n.setPosition(u(this,vh),u(this,Eh))},Io=new WeakSet,td=function(){return u(this,je)?this.rotation:0},ry=new WeakSet,dR=function(){if(u(this,je))return null;let[t,n]=this.pageDimensions,[s,r]=this.pageTranslation,o=u(this,ts),a=new Float32Array(o.length*8),l=0;for(let{x:c,y:d,width:h,height:p}of o){let m=c*t+s,y=(1-d)*n+r;a[l]=a[l+4]=m,a[l+1]=a[l+3]=y,a[l+2]=a[l+6]=m+h*t,a[l+5]=a[l+7]=y-p*n,l+=8}return a},oy=new WeakSet,uR=function(t){return u(this,un).serialize(t,S(this,Io,td).call(this))},ay=new WeakSet,hR=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},ly=new WeakSet,fR=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},cy=new WeakSet,pR=function(t){let{color:n}=this._initialData;return t.color.some((s,r)=>s!==n[r])},E(le,Ws),E(le,ay),E(le,ly),W(le,"_defaultColor",null),W(le,"_defaultOpacity",1),W(le,"_defaultThickness",12),W(le,"_type","highlight"),W(le,"_editorType",Z.HIGHLIGHT),W(le,"_freeHighlightId",-1),W(le,"_freeHighlight",null),W(le,"_freeHighlightClipId","");var kg=le,Do,lw=class{constructor(){E(this,Do,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(let[t,n]of Object.entries(e))this.updateProperty(t,n)}updateSVGProperty(e,t){u(this,Do)[e]=t}toSVGProperties(){let e=u(this,Do);return A(this,Do,Object.create(null)),{root:e}}reset(){A(this,Do,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){ge("Not implemented")}};Do=new WeakMap;var Xt,Jl,Ye,Mo,Po,Ys,Ks,Xs,ko,Sh,dw,_h,uw,Ch,hw,No,nd,dy,gR,Zl,jp,Fo,id,Js,Ma,B=class B extends _e{constructor(t){super(t);E(this,Sh);E(this,_h);E(this,Ch);E(this,No);E(this,dy);E(this,Zl);E(this,Fo);E(this,Js);E(this,Xt,null);E(this,Jl,void 0);W(this,"_drawId",null);A(this,Jl,t.mustBeCommitted||!1),t.drawOutlines&&(S(this,Sh,dw).call(this,t),S(this,No,nd).call(this))}static _mergeSVGProperties(t,n){let s=new Set(Object.keys(t));for(let[r,o]of Object.entries(n))s.has(r)?Object.assign(t[r],o):t[r]=o;return t}static getDefaultDrawingOptions(t){ge("Not implemented")}static get typesMap(){ge("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){let s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,n),this._currentParent&&(u(B,Ye).updateProperty(s,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){let s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,n)}static get defaultPropertiesToUpdate(){let t=[],n=this._defaultDrawingOptions;for(let[s,r]of this.typesMap)t.push([s,n[r]]);return t}get propertiesToUpdate(){let t=[],{_drawingOptions:n}=this;for(let[s,r]of this.constructor.typesMap)t.push([s,n[r]]);return t}_updateProperty(t,n,s){let r=this._drawingOptions,o=r[n],a=l=>{var d;r.updateProperty(n,l);let c=u(this,Xt).updateProperty(n,l);c&&S(this,Fo,id).call(this,c),(d=this.parent)==null||d.drawLayer.updateProperties(this._drawId,r.toSVGProperties())};this.addCommands({cmd:a.bind(this,s),undo:a.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,B._mergeSVGProperties(u(this,Xt).getPathResizingSVGProperties(S(this,Zl,jp).call(this)),{bbox:S(this,Js,Ma).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,B._mergeSVGProperties(u(this,Xt).getPathResizedSVGProperties(S(this,Zl,jp).call(this)),{bbox:S(this,Js,Ma).call(this)}))}_onTranslating(t,n){var s;(s=this.parent)==null||s.drawLayer.updateProperties(this._drawId,{bbox:S(this,Js,Ma).call(this,t,n)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,B._mergeSVGProperties(u(this,Xt).getPathTranslatedSVGProperties(S(this,Zl,jp).call(this),this.parentDimensions),{bbox:S(this,Js,Ma).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,u(this,Jl)&&(A(this,Jl,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){S(this,Ch,hw).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(S(this,No,nd).call(this),S(this,Fo,id).call(this,u(this,Xt).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),S(this,Ch,hw).call(this)):t&&(this._uiManager.addShouldRescale(this),S(this,No,nd).call(this,t),n=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,B._mergeSVGProperties({bbox:S(this,Js,Ma).call(this)},u(this,Xt).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&S(this,Fo,id).call(this,u(this,Xt).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t=super.render();t.classList.add("draw");let n=document.createElement("div");t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";let[s,r]=this.parentDimensions;return this.setDims(this.width*s,this.height*r),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,n,s,r,o){ge("Not implemented")}static startDrawing(t,n,s,r){var b,w;let{target:o,offsetX:a,offsetY:l,pointerId:c,pointerType:d}=r;if(u(B,Ks)&&u(B,Ks)!==d)return;let{viewport:{rotation:h}}=t,{width:p,height:m}=o.getBoundingClientRect(),y=A(B,Mo,new AbortController),v=t.combinedSignal(y);if(u(B,Ys)||A(B,Ys,c),(b=u(B,Ks))!=null||A(B,Ks,d),window.addEventListener("pointerup",_=>{var C;u(B,Ys)===_.pointerId?this._endDraw(_):(C=u(B,Xs))==null||C.delete(_.pointerId)},{signal:v}),window.addEventListener("pointercancel",_=>{var C;u(B,Ys)===_.pointerId?this._currentParent.endDrawingSession():(C=u(B,Xs))==null||C.delete(_.pointerId)},{signal:v}),window.addEventListener("pointerdown",_=>{u(B,Ks)===_.pointerType&&((u(B,Xs)||A(B,Xs,new Set)).add(_.pointerId),u(B,Ye).isCancellable()&&(u(B,Ye).removeLastElement(),u(B,Ye).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:v}),window.addEventListener("contextmenu",Gn,{signal:v}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:v}),o.addEventListener("touchmove",_=>{_.timeStamp===u(B,ko)&&jt(_)},{signal:v}),t.toggleDrawing(),(w=n._editorUndoBar)==null||w.hide(),u(B,Ye)){t.drawLayer.updateProperties(this._currentDrawId,u(B,Ye).startNew(a,l,p,m,h));return}n.updateUIForDefaultProperties(this),A(B,Ye,this.createDrawerInstance(a,l,p,m,h)),A(B,Po,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(u(B,Po).toSVGProperties(),u(B,Ye).defaultSVGProperties),!0,!1)}static _drawMove(t){var o;if(A(B,ko,-1),!u(B,Ye))return;let{offsetX:n,offsetY:s,pointerId:r}=t;if(u(B,Ys)===r){if(((o=u(B,Xs))==null?void 0:o.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,u(B,Ye).add(n,s)),A(B,ko,t.timeStamp),jt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,A(B,Ye,null),A(B,Po,null),A(B,Ks,null),A(B,ko,NaN)),u(B,Mo)&&(u(B,Mo).abort(),A(B,Mo,null),A(B,Ys,NaN),A(B,Xs,null))}static _endDraw(t){let n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),t&&n.drawLayer.updateProperties(this._currentDrawId,u(B,Ye).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){let s=u(B,Ye),r=this._currentDrawId,o=s.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(r,s.setLastElement(o))},undo:()=>{n.drawLayer.updateProperties(r,s.removeLastElement())},mustExec:!1,type:oe.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){let n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(oe.DRAW_STEP),!u(B,Ye).isEmpty()){let{pageDimensions:[s,r],scale:o}=n,a=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:u(B,Ye).getOutlines(s*o,r*o,o,this._INNER_MARGIN),drawingOptions:u(B,Po),mustBeCommitted:!t});return this._cleanup(!0),a}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,s,r,o,a){ge("Not implemented")}static async deserialize(t,n,s){var h,p;let{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:l}}=n.viewport,c=this.deserializeDraw(a,l,r,o,this._INNER_MARGIN,t),d=await super.deserialize(t,n,s);return d.createDrawingOptions(t),S(h=d,Sh,dw).call(h,{drawOutlines:c}),S(p=d,No,nd).call(p),d.onScaleChanging(),d.rotate(),d}serializeDraw(t){let[n,s]=this.pageTranslation,[r,o]=this.pageDimensions;return u(this,Xt).serialize([n,s,r,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Xt=new WeakMap,Jl=new WeakMap,Ye=new WeakMap,Mo=new WeakMap,Po=new WeakMap,Ys=new WeakMap,Ks=new WeakMap,Xs=new WeakMap,ko=new WeakMap,Sh=new WeakSet,dw=function({drawOutlines:t,drawId:n,drawingOptions:s}){A(this,Xt,t),this._drawingOptions||(this._drawingOptions=s),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=S(this,_h,uw).call(this,t,this.parent),S(this,Fo,id).call(this,t.box)},_h=new WeakSet,uw=function(t,n){let{id:s}=n.drawLayer.draw(B._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s},Ch=new WeakSet,hw=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},No=new WeakSet,nd=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=S(this,_h,uw).call(this,u(this,Xt),t)}},dy=new WeakSet,gR=function([t,n,s,r]){let{parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[n,1-t,s*(a/o),r*(o/a)];case 180:return[1-t,1-n,s,r];case 270:return[1-n,t,s*(a/o),r*(o/a)];default:return[t,n,s,r]}},Zl=new WeakSet,jp=function(){let{x:t,y:n,width:s,height:r,parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[1-n,t,s*(o/a),r*(a/o)];case 180:return[1-t,1-n,s,r];case 270:return[n,1-t,s*(o/a),r*(a/o)];default:return[t,n,s,r]}},Fo=new WeakSet,id=function(t){if([this.x,this.y,this.width,this.height]=S(this,dy,gR).call(this,t),this.div){this.fixAndSetPosition();let[n,s]=this.parentDimensions;this.setDims(this.width*n,this.height*s)}this._onResized()},Js=new WeakSet,Ma=function(){let{x:t,y:n,width:s,height:r,rotation:o,parentRotation:a,parentDimensions:[l,c]}=this;switch((o*4+a)/90){case 1:return[1-n-r,t,r,s];case 2:return[1-t-s,1-n-r,s,r];case 3:return[n,1-t-s,r,s];case 4:return[t,n-s*(l/c),r*(c/l),s*(l/c)];case 5:return[1-n,t,s*(l/c),r*(c/l)];case 6:return[1-t-r*(c/l),1-n,r*(c/l),s*(l/c)];case 7:return[n-s*(l/c),1-t-r*(c/l),s*(l/c),r*(c/l)];case 8:return[t-s,n-r,s,r];case 9:return[1-n,t-s,r,s];case 10:return[1-t,1-n,s,r];case 11:return[n-r,1-t,r,s];case 12:return[t-r*(c/l),n,r*(c/l),s*(l/c)];case 13:return[1-n-s*(l/c),t-r*(c/l),s*(l/c),r*(c/l)];case 14:return[1-t,1-n-s*(l/c),r*(c/l),s*(l/c)];case 15:return[n,1-t,s*(l/c),r*(c/l)];default:return[t,n,s,r]}},W(B,"_currentDrawId",-1),W(B,"_currentParent",null),E(B,Ye,null),E(B,Mo,null),E(B,Po,null),E(B,Ys,NaN),E(B,Ks,null),E(B,Xs,null),E(B,ko,NaN),W(B,"_INNER_MARGIN",3);var cw=B,ci,Ke,Xe,Lo,Ql,wt,et,fn,Oo,Uo,Ho,jl,eg,fw=class{constructor(e,t,n,s,r,o){E(this,jl);E(this,ci,new Float64Array(6));E(this,Ke,void 0);E(this,Xe,void 0);E(this,Lo,void 0);E(this,Ql,void 0);E(this,wt,void 0);E(this,et,"");E(this,fn,0);E(this,Oo,new Ng);E(this,Uo,void 0);E(this,Ho,void 0);A(this,Uo,n),A(this,Ho,s),A(this,Lo,r),A(this,Ql,o),[e,t]=S(this,jl,eg).call(this,e,t);let a=A(this,Ke,[NaN,NaN,NaN,NaN,e,t]);A(this,wt,[e,t]),A(this,Xe,[{line:a,points:u(this,wt)}]),u(this,ci).set(a,0)}updateProperty(e,t){e==="stroke-width"&&A(this,Ql,t)}isEmpty(){return!u(this,Xe)||u(this,Xe).length===0}isCancellable(){return u(this,wt).length<=10}add(e,t){[e,t]=S(this,jl,eg).call(this,e,t);let[n,s,r,o]=u(this,ci).subarray(2,6),a=e-r,l=t-o;return Math.hypot(u(this,Uo)*a,u(this,Ho)*l)<=2?null:(u(this,wt).push(e,t),isNaN(n)?(u(this,ci).set([r,o,e,t],2),u(this,Ke).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(u(this,ci)[0])&&u(this,Ke).splice(6,6),u(this,ci).set([n,s,r,o,e,t],0),u(this,Ke).push(...H.createBezierPoints(n,s,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){let n=this.add(e,t);return n||(u(this,wt).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,s,r){A(this,Uo,n),A(this,Ho,s),A(this,Lo,r),[e,t]=S(this,jl,eg).call(this,e,t);let o=A(this,Ke,[NaN,NaN,NaN,NaN,e,t]);A(this,wt,[e,t]);let a=u(this,Xe).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),u(this,Xe).push({line:o,points:u(this,wt)}),u(this,ci).set(o,0),A(this,fn,0),this.toSVGPath(),null}getLastElement(){return u(this,Xe).at(-1)}setLastElement(e){return u(this,Xe)?(u(this,Xe).push(e),A(this,Ke,e.line),A(this,wt,e.points),A(this,fn,0),{path:{d:this.toSVGPath()}}):u(this,Oo).setLastElement(e)}removeLastElement(){if(!u(this,Xe))return u(this,Oo).removeLastElement();u(this,Xe).pop(),A(this,et,"");for(let e=0,t=u(this,Xe).length;e<t;e++){let{line:n,points:s}=u(this,Xe)[e];A(this,Ke,n),A(this,wt,s),A(this,fn,0),this.toSVGPath()}return{path:{d:u(this,et)}}}toSVGPath(){let e=H.svgRound(u(this,Ke)[4]),t=H.svgRound(u(this,Ke)[5]);if(u(this,wt).length===2)return A(this,et,`${u(this,et)} M ${e} ${t} Z`),u(this,et);if(u(this,wt).length<=6){let s=u(this,et).lastIndexOf("M");A(this,et,`${u(this,et).slice(0,s)} M ${e} ${t}`),A(this,fn,6)}if(u(this,wt).length===4){let s=H.svgRound(u(this,Ke)[10]),r=H.svgRound(u(this,Ke)[11]);return A(this,et,`${u(this,et)} L ${s} ${r}`),A(this,fn,12),u(this,et)}let n=[];u(this,fn)===0&&(n.push(`M ${e} ${t}`),A(this,fn,6));for(let s=u(this,fn),r=u(this,Ke).length;s<r;s+=6){let[o,a,l,c,d,h]=u(this,Ke).slice(s,s+6).map(H.svgRound);n.push(`C${o} ${a} ${l} ${c} ${d} ${h}`)}return A(this,et,u(this,et)+n.join(" ")),A(this,fn,u(this,Ke).length),u(this,et)}getOutlines(e,t,n,s){let r=u(this,Xe).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),u(this,Oo).build(u(this,Xe),e,t,n,u(this,Lo),u(this,Ql),s),A(this,ci,null),A(this,Ke,null),A(this,Xe,null),A(this,et,null),u(this,Oo)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}};ci=new WeakMap,Ke=new WeakMap,Xe=new WeakMap,Lo=new WeakMap,Ql=new WeakMap,wt=new WeakMap,et=new WeakMap,fn=new WeakMap,Oo=new WeakMap,Uo=new WeakMap,Ho=new WeakMap,jl=new WeakSet,eg=function(e,t){return H._normalizePoint(e,t,u(this,Uo),u(this,Ho),u(this,Lo))};var St,Th,xh,Jt,di,ui,ec,tc,nc,Un,Mi,uy,mR,hy,yR,fy,vR,kw=class kw extends H{constructor(){super(...arguments);E(this,Un);E(this,uy);E(this,hy);E(this,fy);E(this,St,void 0);E(this,Th,0);E(this,xh,void 0);E(this,Jt,void 0);E(this,di,void 0);E(this,ui,void 0);E(this,ec,void 0);E(this,tc,void 0);E(this,nc,void 0)}build(t,n,s,r,o,a,l){A(this,di,n),A(this,ui,s),A(this,ec,r),A(this,tc,o),A(this,nc,a),A(this,xh,l!=null?l:0),A(this,Jt,t),S(this,hy,yR).call(this)}setLastElement(t){return u(this,Jt).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return u(this,Jt).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let t=[];for(let{line:n}of u(this,Jt)){if(t.push(`M${H.svgRound(n[4])} ${H.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12){t.push(`L${H.svgRound(n[10])} ${H.svgRound(n[11])}`);continue}for(let s=6,r=n.length;s<r;s+=6){let[o,a,l,c,d,h]=n.subarray(s,s+6).map(H.svgRound);t.push(`C${o} ${a} ${l} ${c} ${d} ${h}`)}}return t.join("")}serialize([t,n,s,r],o){let a=[],l=[],[c,d,h,p]=S(this,uy,mR).call(this),m,y,v,b,w,_,C,T,R;switch(u(this,tc)){case 0:R=H._rescale,m=t,y=n+r,v=s,b=-r,w=t+c*s,_=n+(1-d-p)*r,C=t+(c+h)*s,T=n+(1-d)*r;break;case 90:R=H._rescaleAndSwap,m=t,y=n,v=s,b=r,w=t+d*s,_=n+c*r,C=t+(d+p)*s,T=n+(c+h)*r;break;case 180:R=H._rescale,m=t+s,y=n,v=-s,b=r,w=t+(1-c-h)*s,_=n+d*r,C=t+(1-c)*s,T=n+(d+p)*r;break;case 270:R=H._rescaleAndSwap,m=t+s,y=n+r,v=-s,b=-r,w=t+(1-d-p)*s,_=n+(1-c-h)*r,C=t+(1-d)*s,T=n+(1-c)*r;break}for(let{line:D,points:I}of u(this,Jt))a.push(R(D,m,y,v,b,o?new Array(D.length):null)),l.push(R(I,m,y,v,b,o?new Array(I.length):null));return{lines:a,points:l,rect:[w,_,C,T]}}static deserialize(t,n,s,r,o,{paths:{lines:a,points:l},rotation:c,thickness:d}){let h=[],p,m,y,v,b;switch(c){case 0:b=H._rescale,p=-t/s,m=n/r+1,y=1/s,v=-1/r;break;case 90:b=H._rescaleAndSwap,p=-n/r,m=-t/s,y=1/r,v=1/s;break;case 180:b=H._rescale,p=t/s+1,m=-n/r,y=-1/s,v=1/r;break;case 270:b=H._rescaleAndSwap,p=n/r+1,m=t/s+1,y=-1/r,v=-1/s;break}if(!a){a=[];for(let _ of l){let C=_.length;if(C===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,_[0],_[1]]));continue}if(C===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,_[0],_[1],NaN,NaN,NaN,NaN,_[2],_[3]]));continue}let T=new Float32Array(3*(C-2));a.push(T);let[R,D,I,k]=_.subarray(0,4);T.set([NaN,NaN,NaN,NaN,R,D],0);for(let N=4;N<C;N+=2){let F=_[N],U=_[N+1];T.set(H.createBezierPoints(R,D,I,k,F,U),(N-2)*3),[R,D,I,k]=[I,k,F,U]}}}for(let _=0,C=a.length;_<C;_++)h.push({line:b(a[_].map(T=>T!=null?T:NaN),p,m,y,v),points:b(l[_].map(T=>T!=null?T:NaN),p,m,y,v)});let w=new kw;return w.build(h,s,r,1,c,d,o),w}get box(){return u(this,St)}updateProperty(t,n){return t==="stroke-width"?S(this,fy,vR).call(this,n):null}updateParentDimensions([t,n],s){let[r,o]=S(this,Un,Mi).call(this);A(this,di,t),A(this,ui,n),A(this,ec,s);let[a,l]=S(this,Un,Mi).call(this),c=a-r,d=l-o,h=u(this,St);return h[0]-=c,h[1]-=d,h[2]+=2*c,h[3]+=2*d,h}updateRotation(t){return A(this,Th,t),{path:{transform:this.rotationTransform}}}get viewBox(){return u(this,St).map(H.svgRound).join(" ")}get defaultProperties(){let[t,n]=u(this,St);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`}}}get rotationTransform(){let[,,t,n]=u(this,St),s=0,r=0,o=0,a=0,l=0,c=0;switch(u(this,Th)){case 90:r=n/t,o=-t/n,l=t;break;case 180:s=-1,a=-1,l=t,c=n;break;case 270:r=-n/t,o=t/n,c=n;break;default:return""}return`matrix(${s} ${r} ${o} ${a} ${H.svgRound(l)} ${H.svgRound(c)})`}getPathResizingSVGProperties([t,n,s,r]){let[o,a]=S(this,Un,Mi).call(this),[l,c,d,h]=u(this,St);if(Math.abs(d-o)<=H.PRECISION||Math.abs(h-a)<=H.PRECISION){let b=t+s/2-(l+d/2),w=n+r/2-(c+h/2);return{path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`,transform:`${this.rotationTransform} translate(${b} ${w})`}}}let p=(s-2*o)/(d-2*o),m=(r-2*a)/(h-2*a),y=d/s,v=h/r;return{path:{"transform-origin":`${H.svgRound(l)} ${H.svgRound(c)}`,transform:`${this.rotationTransform} scale(${y} ${v}) translate(${H.svgRound(o)} ${H.svgRound(a)}) scale(${p} ${m}) translate(${H.svgRound(-o)} ${H.svgRound(-a)})`}}}getPathResizedSVGProperties([t,n,s,r]){let[o,a]=S(this,Un,Mi).call(this),l=u(this,St),[c,d,h,p]=l;if(l[0]=t,l[1]=n,l[2]=s,l[3]=r,Math.abs(h-o)<=H.PRECISION||Math.abs(p-a)<=H.PRECISION){let w=t+s/2-(c+h/2),_=n+r/2-(d+p/2);for(let{line:C,points:T}of u(this,Jt))H._translate(C,w,_,C),H._translate(T,w,_,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let m=(s-2*o)/(h-2*o),y=(r-2*a)/(p-2*a),v=-m*(c+o)+t+o,b=-y*(d+a)+n+a;if(m!==1||y!==1||v!==0||b!==0)for(let{line:w,points:_}of u(this,Jt))H._rescale(w,v,b,m,y,w),H._rescale(_,v,b,m,y,_);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],s){let[r,o]=s,a=u(this,St),l=t-a[0],c=n-a[1];if(u(this,di)===r&&u(this,ui)===o)for(let{line:d,points:h}of u(this,Jt))H._translate(d,l,c,d),H._translate(h,l,c,h);else{let d=u(this,di)/r,h=u(this,ui)/o;A(this,di,r),A(this,ui,o);for(let{line:p,points:m}of u(this,Jt))H._rescale(p,l,c,d,h,p),H._rescale(m,l,c,d,h,m);a[2]*=d,a[3]*=h}return a[0]=t,a[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`}}}get defaultSVGProperties(){let t=u(this,St);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${H.svgRound(t[0])} ${H.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};St=new WeakMap,Th=new WeakMap,xh=new WeakMap,Jt=new WeakMap,di=new WeakMap,ui=new WeakMap,ec=new WeakMap,tc=new WeakMap,nc=new WeakMap,Un=new WeakSet,Mi=function(t=u(this,nc)){let n=u(this,xh)+t/2*u(this,ec);return u(this,tc)%180===0?[n/u(this,di),n/u(this,ui)]:[n/u(this,ui),n/u(this,di)]},uy=new WeakSet,mR=function(){let[t,n,s,r]=u(this,St),[o,a]=S(this,Un,Mi).call(this,0);return[t+o,n+a,s-2*o,r-2*a]},hy=new WeakSet,yR=function(){let t=A(this,St,new Float32Array([1/0,1/0,-1/0,-1/0]));for(let{line:r}of u(this,Jt)){if(r.length<=12){for(let l=4,c=r.length;l<c;l+=6){let[d,h]=r.subarray(l,l+2);t[0]=Math.min(t[0],d),t[1]=Math.min(t[1],h),t[2]=Math.max(t[2],d),t[3]=Math.max(t[3],h)}continue}let o=r[4],a=r[5];for(let l=6,c=r.length;l<c;l+=6){let[d,h,p,m,y,v]=r.subarray(l,l+6);V.bezierBoundingBox(o,a,d,h,p,m,y,v,t),o=y,a=v}}let[n,s]=S(this,Un,Mi).call(this);t[0]=Math.min(1,Math.max(0,t[0]-n)),t[1]=Math.min(1,Math.max(0,t[1]-s)),t[2]=Math.min(1,Math.max(0,t[2]+n)),t[3]=Math.min(1,Math.max(0,t[3]+s)),t[2]-=t[0],t[3]-=t[1]},fy=new WeakSet,vR=function(t){let[n,s]=S(this,Un,Mi).call(this);A(this,nc,t);let[r,o]=S(this,Un,Mi).call(this),[a,l]=[r-n,o-s],c=u(this,St);return c[0]-=a,c[1]-=l,c[2]+=2*a,c[3]+=2*l,c};var Ng=kw,ic,Nw=class Nw extends lw{constructor(t){super();E(this,ic,void 0);A(this,ic,t),super.updateProperties({fill:"none",stroke:_e._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,n){t==="stroke-width"&&(n!=null||(n=this["stroke-width"]),n*=u(this,ic).realScale),super.updateSVGProperty(t,n)}clone(){let t=new Nw(u(this,ic));return t.updateAll(this),t}};ic=new WeakMap;var pw=Nw,py,ER,ka=class ka extends cw{constructor(t){super({...t,name:"inkEditor"});E(this,py);this._willKeepAspectRatio=!0}static initialize(t,n){_e.initialize(t,n),this._defaultDrawingOptions=new pw(n.viewParameters)}static getDefaultDrawingOptions(t){let n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return ie(this,"typesMap",new Map([[oe.INK_THICKNESS,"stroke-width"],[oe.INK_COLOR,"stroke"],[oe.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,s,r,o){return new fw(t,n,s,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,s,r,o,a){return Ng.deserialize(t,n,s,r,o,a)}static async deserialize(t,n,s){let r=null;if(t instanceof bd){let{data:{inkLists:a,rect:l,rotation:c,id:d,color:h,opacity:p,borderStyle:{rawWidth:m},popupRef:y},parent:{page:{pageNumber:v}}}=t;r=t={annotationType:Z.INK,color:Array.from(h),thickness:m,opacity:p,paths:{points:a},boxes:null,pageIndex:v-1,rect:l.slice(0),rotation:c,id:d,deleted:!1,popupRef:y}}let o=await super.deserialize(t,n,s);return o.annotationElementId=t.id||null,o._initialData=r,o}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:t,_drawingOptions:n,parent:s}=this;n.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){let t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:s}){this._drawingOptions=ka.getDefaultDrawingOptions({stroke:V.makeHexColor(...t),"stroke-width":n,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:n,points:s,rect:r}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":a,"stroke-width":l}}=this,c={annotationType:Z.INK,color:_e._colorManager.convert(o),opacity:a,thickness:l,paths:{lines:n,points:s},pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?c:this.annotationElementId&&!S(this,py,ER).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(t){let{points:n,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:n}),null}};py=new WeakSet,ER=function(t){let{color:n,thickness:s,opacity:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((a,l)=>a!==n[l])||t.thickness!==s||t.opacity!==r||t.pageIndex!==o},W(ka,"_type","ink"),W(ka,"_editorType",Z.INK),W(ka,"_defaultDrawingOptions",null);var gw=ka,Se,tt,Zs,ss,Qs,sc,hi,fi,Zt,rc,Bo,sd,Vo,rd,oc,tg,Rh,yw,ac,ng,Ih,vw,lc,ig,gy,bR,cd=class cd extends _e{constructor(t){super({...t,name:"stampEditor"});E(this,Bo);E(this,Vo);E(this,oc);E(this,Rh);E(this,ac);E(this,Ih);E(this,lc);E(this,gy);E(this,Se,null);E(this,tt,null);E(this,Zs,null);E(this,ss,null);E(this,Qs,null);E(this,sc,"");E(this,hi,null);E(this,fi,null);E(this,Zt,!1);E(this,rc,!1);A(this,ss,t.bitmapUrl),A(this,Qs,t.bitmapFile)}static initialize(t,n){_e.initialize(t,n)}static get supportedTypes(){return ie(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(n=>`image/${n}`))}static get supportedTypesStr(){return ie(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,n){n.pasteEditor(Z.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){var s,r;let n=t.get("hasAltText");return{hasAltText:(s=n.get(!0))!=null?s:0,hasNoAltText:(r=n.get(!1))!=null?r:0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;let{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");let{data:r,width:o,height:a}=t||this.copyCanvas(null,null,!0).imageData,l=await s.guess({name:"altText",request:{data:r,width:o,height:a,channels:r.length/(o*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");let c=l.output;return await this.setGuessedAltText(c),n&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){var t;u(this,tt)&&(A(this,Se,null),this._uiManager.imageManager.deleteId(u(this,tt)),(t=u(this,hi))==null||t.remove(),A(this,hi,null),u(this,fi)&&(clearTimeout(u(this,fi)),A(this,fi,null))),super.remove()}rebuild(){if(!this.parent){u(this,tt)&&S(this,oc,tg).call(this);return}super.rebuild(),this.div!==null&&(u(this,tt)&&u(this,hi)===null&&S(this,oc,tg).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(u(this,Zs)||u(this,Se)||u(this,ss)||u(this,Qs)||u(this,tt))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;if(this.width&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),u(this,Se)?S(this,Rh,yw).call(this):S(this,oc,tg).call(this),this.width&&!this.annotationElementId){let[s,r]=this.parentDimensions;this.setAt(t*s,n*r,this.width*s,this.height*r)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;u(this,fi)!==null&&clearTimeout(u(this,fi)),A(this,fi,setTimeout(()=>{A(this,fi,null),S(this,Ih,vw).call(this)},200))}copyCanvas(t,n,s=!1){var m;t||(t=224);let{width:r,height:o}=u(this,Se),a=new fd,l=u(this,Se),c=r,d=o,h=null;if(n){if(r>n||o>n){let k=Math.min(n/r,n/o);c=Math.floor(r*k),d=Math.floor(o*k)}h=document.createElement("canvas");let y=h.width=Math.ceil(c*a.sx),v=h.height=Math.ceil(d*a.sy);u(this,Zt)||(l=S(this,ac,ng).call(this,y,v));let b=h.getContext("2d");b.filter=this._uiManager.hcmFilter;let w="white",_="#cfcfd8";this._uiManager.hcmFilter!=="none"?_="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(w="#8f8f9d",_="#42414d");let C=15,T=C*a.sx,R=C*a.sy,D=new OffscreenCanvas(T*2,R*2),I=D.getContext("2d");I.fillStyle=w,I.fillRect(0,0,T*2,R*2),I.fillStyle=_,I.fillRect(0,0,T,R),I.fillRect(T,R,T,R),b.fillStyle=b.createPattern(D,"repeat"),b.fillRect(0,0,y,v),b.drawImage(l,0,0,l.width,l.height,0,0,y,v)}let p=null;if(s){let y,v;if(a.symmetric&&l.width<t&&l.height<t)y=l.width,v=l.height;else if(l=u(this,Se),r>t||o>t){let _=Math.min(t/r,t/o);y=Math.floor(r*_),v=Math.floor(o*_),u(this,Zt)||(l=S(this,ac,ng).call(this,y,v))}let w=new OffscreenCanvas(y,v).getContext("2d",{willReadFrequently:!0});w.drawImage(l,0,0,l.width,l.height,0,0,y,v),p={width:y,height:v,data:w.getImageData(0,0,y,v).data}}return{canvas:h,width:c,height:d,imageData:p}}getImageForAltText(){return u(this,hi)}static async deserialize(t,n,s){var v;let r=null;if(t instanceof Ig){let{data:{rect:b,rotation:w,id:_,structParent:C,popupRef:T},container:R,parent:{page:{pageNumber:D}}}=t,I=R.querySelector("canvas"),k=s.imageManager.getFromCanvas(R.id,I);I.remove();let N=((v=await n._structTree.getAriaAttributes(`${Tw}${_}`))==null?void 0:v.get("aria-label"))||"";r=t={annotationType:Z.STAMP,bitmapId:k.id,bitmap:k.bitmap,pageIndex:D-1,rect:b.slice(0),rotation:w,id:_,deleted:!1,accessibilityData:{decorative:!1,altText:N},isSvg:!1,structParent:C,popupRef:T}}let o=await super.deserialize(t,n,s),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:d,isSvg:h,accessibilityData:p}=t;d&&s.imageManager.isValidId(d)?(A(o,tt,d),l&&A(o,Se,l)):A(o,ss,c),A(o,Zt,h);let[m,y]=o.pageDimensions;return o.width=(a[2]-a[0])/m,o.height=(a[3]-a[1])/y,o.annotationElementId=t.id||null,p&&(o.altTextData=p),o._initialData=r,A(o,rc,!!r),o}serialize(t=!1,n=null){var l;if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let s={annotationType:Z.STAMP,bitmapId:u(this,tt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:u(this,Zt),structTreeParentId:this._structTreeParentId};if(t)return s.bitmapUrl=S(this,lc,ig).call(this,!0),s.accessibilityData=this.serializeAltText(!0),s;let{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(s.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){let c=S(this,gy,bR).call(this,s);if(c.isSame)return null;c.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=(l=this._initialData.structParent)!=null?l:-1}if(s.id=this.annotationElementId,n===null)return s;n.stamps||(n.stamps=new Map);let a=u(this,Zt)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!n.stamps.has(u(this,tt)))n.stamps.set(u(this,tt),{area:a,serialized:s}),s.bitmap=S(this,lc,ig).call(this,!1);else if(u(this,Zt)){let c=n.stamps.get(u(this,tt));a>c.area&&(c.area=a,c.serialized.bitmap.close(),c.serialized.bitmap=S(this,lc,ig).call(this,!1))}return s}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};Se=new WeakMap,tt=new WeakMap,Zs=new WeakMap,ss=new WeakMap,Qs=new WeakMap,sc=new WeakMap,hi=new WeakMap,fi=new WeakMap,Zt=new WeakMap,rc=new WeakMap,Bo=new WeakSet,sd=function(t,n=!1){if(!t){this.remove();return}A(this,Se,t.bitmap),n||(A(this,tt,t.id),A(this,Zt,t.isSvg)),t.file&&A(this,sc,t.file.name),S(this,Rh,yw).call(this)},Vo=new WeakSet,rd=function(){if(A(this,Zs,null),this._uiManager.enableWaiting(!1),!!u(this,hi)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,Se)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,Se)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch(t){}}this.div.focus()}},oc=new WeakSet,tg=function(){if(u(this,tt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(u(this,tt)).then(s=>S(this,Bo,sd).call(this,s,!0)).finally(()=>S(this,Vo,rd).call(this));return}if(u(this,ss)){let s=u(this,ss);A(this,ss,null),this._uiManager.enableWaiting(!0),A(this,Zs,this._uiManager.imageManager.getFromUrl(s).then(r=>S(this,Bo,sd).call(this,r)).finally(()=>S(this,Vo,rd).call(this)));return}if(u(this,Qs)){let s=u(this,Qs);A(this,Qs,null),this._uiManager.enableWaiting(!0),A(this,Zs,this._uiManager.imageManager.getFromFile(s).then(r=>S(this,Bo,sd).call(this,r)).finally(()=>S(this,Vo,rd).call(this)));return}let t=document.createElement("input");t.type="file",t.accept=cd.supportedTypesStr;let n=this._uiManager._signal;A(this,Zs,new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),S(this,Bo,sd).call(this,r)}s()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:n})}).finally(()=>S(this,Vo,rd).call(this))),t.click()},Rh=new WeakSet,yw=function(){var h;let{div:t}=this,{width:n,height:s}=u(this,Se),[r,o]=this.pageDimensions,a=.75;if(this.width)n=this.width*r,s=this.height*o;else if(n>a*r||s>a*o){let p=Math.min(a*r/n,a*o/s);n*=p,s*=p}let[l,c]=this.parentDimensions;this.setDims(n*l/r,s*c/o),this._uiManager.enableWaiting(!1);let d=A(this,hi,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=n/r,this.height=s/o,(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),S(this,Ih,vw).call(this),u(this,rc)||(this.parent.addUndoableEditor(this),A(this,rc,!0)),this._reportTelemetry({action:"inserted_image"}),u(this,sc)&&d.setAttribute("aria-label",u(this,sc))},ac=new WeakSet,ng=function(t,n){let{width:s,height:r}=u(this,Se),o=s,a=r,l=u(this,Se);for(;o>2*t||a>2*n;){let c=o,d=a;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),a>2*n&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));let h=new OffscreenCanvas(o,a);h.getContext("2d").drawImage(l,0,0,c,d,0,0,o,a),l=h.transferToImageBitmap()}return l},Ih=new WeakSet,vw=function(){let[t,n]=this.parentDimensions,{width:s,height:r}=this,o=new fd,a=Math.ceil(s*t*o.sx),l=Math.ceil(r*n*o.sy),c=u(this,hi);if(!c||c.width===a&&c.height===l)return;c.width=a,c.height=l;let d=u(this,Zt)?u(this,Se):S(this,ac,ng).call(this,a,l),h=c.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(d,0,0,d.width,d.height,0,0,a,l)},lc=new WeakSet,ig=function(t){if(t){if(u(this,Zt)){let r=this._uiManager.imageManager.getSvgUrl(u(this,tt));if(r)return r}let n=document.createElement("canvas");return{width:n.width,height:n.height}=u(this,Se),n.getContext("2d").drawImage(u(this,Se),0,0),n.toDataURL()}if(u(this,Zt)){let[n,s]=this.pageDimensions,r=Math.round(this.width*n*ir.PDF_TO_CSS_UNITS),o=Math.round(this.height*s*ir.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(r,o);return a.getContext("2d").drawImage(u(this,Se),0,0,u(this,Se).width,u(this,Se).height,0,0,r,o),a.transferToImageBitmap()}return structuredClone(u(this,Se))},gy=new WeakSet,bR=function(t){var a;let{pageIndex:n,accessibilityData:{altText:s}}=this._initialData,r=t.pageIndex===n,o=(((a=t.accessibilityData)==null?void 0:a.alt)||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}},W(cd,"_type","stamp"),W(cd,"_editorType",Z.STAMP);var mw=cd,Go,cc,pi,js,rs,pn,er,dc,$o,Hn,os,pt,as,G,tr,my,AR,gn,Jn,Dh,bw,Mh,Aw,uc,sg,Cn=class Cn{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:s,accessibilityManager:r,annotationLayer:o,drawLayer:a,textLayer:l,viewport:c,l10n:d}){E(this,my);E(this,gn);E(this,Dh);E(this,Mh);E(this,uc);E(this,Go,void 0);E(this,cc,!1);E(this,pi,null);E(this,js,null);E(this,rs,null);E(this,pn,new Map);E(this,er,!1);E(this,dc,!1);E(this,$o,!1);E(this,Hn,null);E(this,os,null);E(this,pt,null);E(this,as,null);E(this,G,void 0);let h=[...u(Cn,tr).values()];if(!Cn._initialized){Cn._initialized=!0;for(let p of h)p.initialize(d,e)}e.registerEditorTypes(h),A(this,G,e),this.pageIndex=t,this.div=n,A(this,Go,r),A(this,pi,o),this.viewport=c,A(this,pt,l),this.drawLayer=a,this._structTree=s,u(this,G).addLayer(this)}get isEmpty(){return u(this,pn).size===0}get isInvisible(){return this.isEmpty&&u(this,G).getMode()===Z.NONE}updateToolbar(e){u(this,G).updateToolbar(e)}updateMode(e=u(this,G).getMode()){switch(S(this,uc,sg).call(this),e){case Z.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Z.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Z.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:t}=this.div;for(let n of u(Cn,tr).values())t.toggle(`${n._type}Editing`,e===n._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=u(this,pt))==null?void 0:t.div)}setEditingState(e){u(this,G).setEditingState(e)}addCommands(e){u(this,G).addCommands(e)}cleanUndoStack(e){u(this,G).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=u(this,pi))==null||t.div.classList.toggle("disabled",!e)}async enable(){A(this,$o,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);let e=new Set;for(let n of u(this,pn).values())n.enableEditing(),n.show(!0),n.annotationElementId&&(u(this,G).removeChangedExistingAnnotation(n),e.add(n.annotationElementId));if(!u(this,pi)){A(this,$o,!1);return}let t=u(this,pi).getEditableAnnotations();for(let n of t){if(n.hide(),u(this,G).isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;let s=await this.deserialize(n);s&&(this.addOrRebuild(s),s.enableEditing())}A(this,$o,!1)}disable(){var s;A(this,dc,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);let e=new Map,t=new Map;for(let r of u(this,pn).values())if(r.disableEditing(),!!r.annotationElementId){if(r.serialize()!==null){e.set(r.annotationElementId,r);continue}else t.set(r.annotationElementId,r);(s=this.getEditableAnnotation(r.annotationElementId))==null||s.show(),r.remove()}if(u(this,pi)){let r=u(this,pi).getEditableAnnotations();for(let o of r){let{id:a}=o.data;if(u(this,G).isDeletedAnnotationElement(a))continue;let l=t.get(a);if(l){l.resetAnnotationElement(o),l.show(!1),o.show();continue}l=e.get(a),l&&(u(this,G).addChangedExistingAnnotation(l),l.renderAnnotationElement(o)&&l.show(!1)),o.show()}}S(this,uc,sg).call(this),this.isEmpty&&(this.div.hidden=!0);let{classList:n}=this.div;for(let r of u(Cn,tr).values())n.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),A(this,dc,!1)}getEditableAnnotation(e){var t;return((t=u(this,pi))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){u(this,G).getActive()!==e&&u(this,G).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=u(this,pt))!=null&&e.div&&!u(this,as)){A(this,as,new AbortController);let t=u(this,G).combinedSignal(u(this,as));u(this,pt).div.addEventListener("pointerdown",S(this,my,AR).bind(this),{signal:t}),u(this,pt).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=u(this,pt))!=null&&e.div&&u(this,as)&&(u(this,as).abort(),A(this,as,null),u(this,pt).div.classList.remove("highlighting"))}enableClick(){if(u(this,js))return;A(this,js,new AbortController);let e=u(this,G).combinedSignal(u(this,js));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});let t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=u(this,js))==null||e.abort(),A(this,js,null)}attach(e){u(this,pn).set(e.id,e);let{annotationElementId:t}=e;t&&u(this,G).isDeletedAnnotationElement(t)&&u(this,G).removeDeletedAnnotationElement(e)}detach(e){var t;u(this,pn).delete(e.id),(t=u(this,Go))==null||t.removePointerInTextLayer(e.contentDiv),!u(this,dc)&&e.annotationElementId&&u(this,G).addDeletedAnnotationElement(e)}remove(e){this.detach(e),u(this,G).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(u(this,G).addDeletedAnnotationElement(e.annotationElementId),_e.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),u(this,G).addEditor(e),this.attach(e),!e.isAttachedToDOM){let t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!u(this,$o)),u(this,G).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var n;if(!e.isAttachedToDOM)return;let{activeElement:t}=document;e.div.contains(t)&&!u(this,rs)&&(e._focusEventsAllowed=!1,A(this,rs,setTimeout(()=>{A(this,rs,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:u(this,G)._signal}),t.focus())},0))),e._structTreeParentId=(n=u(this,Go))==null?void 0:n.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){let t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getNextId(){return u(this,G).getId()}combinedSignal(e){return u(this,G).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=u(this,gn,Jn))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){u(this,G).updateToolbar(e),u(this,G).updateMode(e);let{offsetX:n,offsetY:s}=S(this,Mh,Aw).call(this),r=this.getNextId(),o=S(this,Dh,bw).call(this,{parent:this,id:r,x:n,y:s,uiManager:u(this,G),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t,n;return await((n=u(Cn,tr).get((t=e.annotationType)!=null?t:e.annotationEditorType))==null?void 0:n.deserialize(e,this,u(this,G)))||null}createAndAddNewEditor(e,t,n={}){let s=this.getNextId(),r=S(this,Dh,bw).call(this,{parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:u(this,G),isCentered:t,...n});return r&&this.add(r),r}addNewEditor(){this.createAndAddNewEditor(S(this,Mh,Aw).call(this),!0)}setSelected(e){u(this,G).setSelected(e)}toggleSelected(e){u(this,G).toggleSelected(e)}unselect(e){u(this,G).unselect(e)}pointerup(e){var n;let{isMac:t}=nt.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&u(this,er)&&(A(this,er,!1),!((n=u(this,gn,Jn))!=null&&n.isDrawer&&u(this,gn,Jn).supportMultipleDrawings))){if(!u(this,cc)){A(this,cc,!0);return}if(u(this,G).getMode()===Z.STAMP){u(this,G).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var s;if(u(this,G).getMode()===Z.HIGHLIGHT&&this.enableTextSelection(),u(this,er)){A(this,er,!1);return}let{isMac:t}=nt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(A(this,er,!0),(s=u(this,gn,Jn))!=null&&s.isDrawer){this.startDrawingSession(e);return}let n=u(this,G).getActive();A(this,cc,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus(),u(this,Hn)){u(this,gn,Jn).startDrawing(this,u(this,G),!1,e);return}u(this,G).setCurrentDrawingSession(this),A(this,Hn,new AbortController);let t=u(this,G).combinedSignal(u(this,Hn));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(A(this,os,null),this.commitOrRemove())},{signal:t}),u(this,gn,Jn).startDrawing(this,u(this,G),!1,e)}pause(e){if(e){let{activeElement:t}=document;this.div.contains(t)&&A(this,os,t);return}u(this,os)&&setTimeout(()=>{var t;(t=u(this,os))==null||t.focus(),A(this,os,null)},0)}endDrawingSession(e=!1){return u(this,Hn)?(u(this,G).setCurrentDrawingSession(null),u(this,Hn).abort(),A(this,Hn,null),A(this,os,null),u(this,gn,Jn).endDrawing(e)):null}findNewParent(e,t,n){let s=u(this,G).findParent(t,n);return s===null||s===this?!1:(s.changeParent(e),!0)}commitOrRemove(){return u(this,Hn)?(this.endDrawingSession(),!0):!1}onScaleChanging(){u(this,Hn)&&u(this,gn,Jn).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=u(this,G).getActive())==null?void 0:e.parent)===this&&(u(this,G).commitOrRemove(),u(this,G).setActiveEditor(null)),u(this,rs)&&(clearTimeout(u(this,rs)),A(this,rs,null));for(let n of u(this,pn).values())(t=u(this,Go))==null||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,u(this,pn).clear(),u(this,G).removeLayer(this)}render({viewport:e}){this.viewport=e,Wo(this.div,e);for(let t of u(this,G).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){u(this,G).commitOrRemove(),S(this,uc,sg).call(this);let t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,Wo(this.div,{rotation:n}),t!==n)for(let s of u(this,pn).values())s.rotate(n)}get pageDimensions(){let{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return u(this,G).viewParameters.realScale}};Go=new WeakMap,cc=new WeakMap,pi=new WeakMap,js=new WeakMap,rs=new WeakMap,pn=new WeakMap,er=new WeakMap,dc=new WeakMap,$o=new WeakMap,Hn=new WeakMap,os=new WeakMap,pt=new WeakMap,as=new WeakMap,G=new WeakMap,tr=new WeakMap,my=new WeakSet,AR=function(e){u(this,G).unselectAll();let{target:t}=e;if(t===u(this,pt).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&u(this,pt).div.contains(t)){let{isMac:n}=nt.platform;if(e.button!==0||e.ctrlKey&&n)return;u(this,G).showAllEditors("highlight",!0,!0),u(this,pt).div.classList.add("free"),this.toggleDrawing(),kg.startHighlighting(this,u(this,G).direction==="ltr",{target:u(this,pt).div,x:e.x,y:e.y}),u(this,pt).div.addEventListener("pointerup",()=>{u(this,pt).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:u(this,G)._signal}),e.preventDefault()}},gn=new WeakSet,Jn=function(){return u(Cn,tr).get(u(this,G).getMode())},Dh=new WeakSet,bw=function(e){let t=u(this,gn,Jn);return t?new t.prototype.constructor(e):null},Mh=new WeakSet,Aw=function(){let{x:e,y:t,width:n,height:s}=this.div.getBoundingClientRect(),r=Math.max(0,e),o=Math.max(0,t),a=Math.min(window.innerWidth,e+n),l=Math.min(window.innerHeight,t+s),c=(r+a)/2-e,d=(o+l)/2-t,[h,p]=this.viewport.rotation%180===0?[c,d]:[d,c];return{offsetX:h,offsetY:p}},uc=new WeakSet,sg=function(){for(let e of u(this,pn).values())e.isEmpty()&&e.remove()},W(Cn,"_initialized",!1),E(Cn,tr,new Map([QA,gw,mw,kg].map(e=>[e._editorType,e])));var Ew=Cn,Bn,Ph,_t,zo,yy,wR,kh,Sw,vy,SR,Nh,_w,dt=class dt{constructor({pageIndex:e}){E(this,kh);E(this,vy);E(this,Nh);E(this,Bn,null);E(this,Ph,0);E(this,_t,new Map);E(this,zo,new Map);this.pageIndex=e}setParent(e){if(!u(this,Bn)){A(this,Bn,e);return}if(u(this,Bn)!==e){if(u(this,_t).size>0)for(let t of u(this,_t).values())t.remove(),e.append(t);A(this,Bn,e)}}static get _svgFactory(){return ie(this,"_svgFactory",new vd)}draw(e,t=!1,n=!1){let s=vt(this,Ph)._++,r=S(this,kh,Sw).call(this),o=dt._svgFactory.createElement("defs");r.append(o);let a=dt._svgFactory.createElement("path");o.append(a);let l=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&u(this,zo).set(s,a);let c=n?S(this,vy,SR).call(this,o,l):null,d=dt._svgFactory.createElement("use");return r.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(r,e),u(this,_t).set(s,r),{id:s,clipPathId:`url(#${c})`}}drawOutline(e,t){let n=vt(this,Ph)._++,s=S(this,kh,Sw).call(this),r=dt._svgFactory.createElement("defs");s.append(r);let o=dt._svgFactory.createElement("path");r.append(o);let a=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){let h=dt._svgFactory.createElement("mask");r.append(h),l=`mask_p${this.pageIndex}_${n}`,h.setAttribute("id",l),h.setAttribute("maskUnits","objectBoundingBox");let p=dt._svgFactory.createElement("rect");h.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");let m=dt._svgFactory.createElement("use");h.append(m),m.setAttribute("href",`#${a}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}let c=dt._svgFactory.createElement("use");s.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);let d=c.cloneNode();return s.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(s,e),u(this,_t).set(n,s),n}finalizeDraw(e,t){u(this,zo).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;let{root:n,bbox:s,rootClass:r,path:o}=t,a=typeof e=="number"?u(this,_t).get(e):e;if(a){if(n&&S(this,Nh,_w).call(this,a,n),s&&S(l=dt,yy,wR).call(l,a,s),r){let{classList:c}=a;for(let[d,h]of Object.entries(r))c.toggle(d,h)}if(o){let d=a.firstChild.firstChild;S(this,Nh,_w).call(this,d,o)}}}updateParent(e,t){if(t===this)return;let n=u(this,_t).get(e);n&&(u(t,Bn).append(n),u(this,_t).delete(e),u(t,_t).set(e,n))}remove(e){u(this,zo).delete(e),u(this,Bn)!==null&&(u(this,_t).get(e).remove(),u(this,_t).delete(e))}destroy(){A(this,Bn,null);for(let e of u(this,_t).values())e.remove();u(this,_t).clear(),u(this,zo).clear()}};Bn=new WeakMap,Ph=new WeakMap,_t=new WeakMap,zo=new WeakMap,yy=new WeakSet,wR=function(e,[t,n,s,r]){let{style:o}=e;o.top=`${100*n}%`,o.left=`${100*t}%`,o.width=`${100*s}%`,o.height=`${100*r}%`},kh=new WeakSet,Sw=function(){let e=dt._svgFactory.create(1,1,!0);return u(this,Bn).append(e),e.setAttribute("aria-hidden",!0),e},vy=new WeakSet,SR=function(e,t){let n=dt._svgFactory.createElement("clipPath");e.append(n);let s=`clip_${t}`;n.setAttribute("id",s),n.setAttribute("clipPathUnits","objectBoundingBox");let r=dt._svgFactory.createElement("use");return n.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),s},Nh=new WeakSet,_w=function(e,t){for(let[n,s]of Object.entries(t))s===null?e.removeAttribute(n):e.setAttribute(n,s)},E(dt,yy);var ww=dt;globalThis.pdfjsTestingUtils={HighlightOutliner:Ad};var jG=Y.AbortException,e$=Y.AnnotationEditorLayer,t$=Y.AnnotationEditorParamsType,n$=Y.AnnotationEditorType,i$=Y.AnnotationEditorUIManager,s$=Y.AnnotationLayer,r$=Y.AnnotationMode,o$=Y.ColorPicker,a$=Y.DOMSVGFactory,l$=Y.DrawLayer,c$=Y.FeatureTest,_R=Y.GlobalWorkerOptions,d$=Y.ImageKind,u$=Y.InvalidPDFException,h$=Y.MissingPDFException,f$=Y.OPS,p$=Y.OutputScale,g$=Y.PDFDataRangeTransport,m$=Y.PDFDateString,y$=Y.PDFWorker,v$=Y.PasswordResponses,E$=Y.PermissionFlag,b$=Y.PixelsPerInch,A$=Y.RenderingCancelledException,w$=Y.TextLayer,S$=Y.TouchManager,_$=Y.UnexpectedResponseException,C$=Y.Util,T$=Y.VerbosityLevel,x$=Y.XfaLayer,R$=Y.build,I$=Y.createValidAbsoluteUrl,D$=Y.fetchData,xy=Y.getDocument,M$=Y.getFilenameFromUrl,P$=Y.getPdfFilenameFromUrl,k$=Y.getXfaPageViewport,N$=Y.isDataScheme,F$=Y.isPdfFile,L$=Y.noContextMenu,O$=Y.normalizeUnicode,U$=Y.setLayerDimensions,H$=Y.shadow,B$=Y.stopEvent,V$=Y.version;_R.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.mjs";var Ry=class{constructor(e=50){this.minTextThreshold=e}async extractText(e){let t=await xy({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,n="";for(let o=1;o<=t.numPages;o++){let c=(await(await t.getPage(o)).getTextContent()).items.map(d=>d.str||"").join(" ");n+=`
## \uD398\uC774\uC9C0 ${o}

${c}
`}let r=n.replace(/\s/g,"").length/t.numPages<this.minTextThreshold;return{text:n,isScanned:r,numPages:t.numPages}}async renderPagesToImages(e,t){let n=await xy({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,s=[],r=t?Math.min(n.numPages,t):n.numPages;for(let o=1;o<=r;o++){let a=await n.getPage(o),l=a.getViewport({scale:2}),c=document.createElement("canvas");c.width=l.width,c.height=l.height;let d=c.getContext("2d");await a.render({canvasContext:d,viewport:l}).promise;let h=c.toDataURL("image/png").split(",")[1];s.push({base64:h,mimeType:"image/png",pageNum:o})}return s}async getPageCount(e){return(await xy({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise).numPages}};var Iy=class{constructor(e,t,n){this.gemini=e,this.settings=t,this.vault=n,this.pdfProcessor=new Ry(t.ocrMinTextThreshold),this.dailyUsage=this.loadDailyUsage()}loadDailyUsage(){return{date:Yn(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}saveDailyUsage(){}checkDailyLimit(e){let t=Yn(this.settings.timezone);this.dailyUsage.date!==t&&(this.dailyUsage={date:t,pagesProcessed:0,filesProcessed:0});let n=this.settings.ocrDailyLimit-this.dailyUsage.pagesProcessed;return{allowed:e<=n,remaining:n}}getFileSizeMB(e){return e.stat.size/(1024*1024)}async checkLimits(e){let t=this.getFileSizeMB(e);if(t>this.settings.ocrMaxFileSizeMB)return{allowed:!1,reason:`\uD30C\uC77C \uD06C\uAE30(${t.toFixed(1)}MB)\uAC00 \uC81C\uD55C(${this.settings.ocrMaxFileSizeMB}MB)\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,fileSize:t};if(e.extension==="pdf"){let s=await this.vault.readBinary(e),r=await this.pdfProcessor.getPageCount(s);if(r>this.settings.ocrMaxPages)return{allowed:!1,reason:`\uD398\uC774\uC9C0 \uC218(${r})\uAC00 \uC81C\uD55C(${this.settings.ocrMaxPages})\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,pageCount:r,fileSize:t};let o=this.checkDailyLimit(r);return o.allowed?{allowed:!0,pageCount:r,fileSize:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${o.remaining})`,pageCount:r,fileSize:t}}let n=this.checkDailyLimit(1);return n.allowed?{allowed:!0,pageCount:1,fileSize:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${n.remaining})`,pageCount:1,fileSize:t}}async processImage(e){let t=await this.vault.readBinary(e),n=this.arrayBufferToBase64(t),s=this.getMimeType(e.extension),r=await this.gemini.extractTextFromImage(n,s);return this.dailyUsage.pagesProcessed+=1,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:r,pages:1,sourceType:"image",sourceFile:e.name}}async processPDF(e,t=!1,n){let s=await this.vault.readBinary(e),r=n||this.settings.ocrMaxPages,o=await this.pdfProcessor.extractText(s);if(!o.isScanned&&!t)return{text:o.text,pages:o.numPages,sourceType:"pdf_text",sourceFile:e.name};let a=Math.min(o.numPages,r);new Fw.Notice(`\uC2A4\uCE94 PDF \uAC10\uC9C0\uB428. OCR \uCC98\uB9AC \uC911... (${a}\uD398\uC774\uC9C0)`);let l=await this.pdfProcessor.renderPagesToImages(s,r),c=await this.gemini.extractTextFromImages(l,(h,p)=>{new Fw.Notice(`OCR \uC9C4\uD589 \uC911: ${h}/${p} \uD398\uC774\uC9C0`,1500)}),d="";for(let h=0;h<c.length;h++)d+=`
## \uD398\uC774\uC9C0 ${h+1}

${c[h]}
`;return this.dailyUsage.pagesProcessed+=c.length,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:d,pages:c.length,sourceType:"pdf_scanned",sourceFile:e.name}}async processFile(e,t){let n=e.extension.toLowerCase();if(["png","jpg","jpeg","webp","gif"].includes(n))return this.processImage(e);if(n==="pdf")return this.processPDF(e,!1,t);throw new Error(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD: ${n}`)}generateMarkdownNote(e){let t=Oe(this.settings.timezone,this.settings.dateFormat),n={image:"\uC774\uBBF8\uC9C0",pdf_text:"PDF (\uD14D\uC2A4\uD2B8)",pdf_scanned:"PDF (\uC2A4\uCE94/OCR)"}[e.sourceType];return`---
type: ocr
source_file: "${e.sourceFile}"
source_type: ${e.sourceType}
pages: ${e.pages}
ocr_at: ${t}
---

# OCR: ${e.sourceFile.replace(/\.[^.]+$/,"")}

> \uC6D0\uBCF8: ${e.sourceFile} | \uCC98\uB9AC \uBC29\uC2DD: ${n} | ${e.pages}\uD398\uC774\uC9C0

${e.text}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}generateSummarizedNote(e,t){let n=Oe(this.settings.timezone,this.settings.dateFormat);return`---
type: ocr
source_file: "${e.sourceFile}"
source_type: ${e.sourceType}
title: "${t.title}"
pages: ${e.pages}
ocr_at: ${n}
---

# ${t.title}

## \uC694\uC57D
${t.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${t.keyPoints.map(s=>`- ${s}`).join(`
`)}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}arrayBufferToBase64(e){let t="",n=new Uint8Array(e);for(let s=0;s<n.byteLength;s++)t+=String.fromCharCode(n[s]);return btoa(t)}getMimeType(e){return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/webp",gif:"image/gif"}[e.toLowerCase()]||"image/png"}getDailyUsage(){return{...this.dailyUsage}}};var Dy=class{constructor(e,t){this.index=new Map;this.app=e,this.gemini=t}async buildIndex(){this.index.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e)try{let n=await this.indexNote(t);n&&this.index.set(t.path,n)}catch(n){console.error(`\uC778\uB371\uC2F1 \uC2E4\uD328: ${t.path}`,n)}console.log(`\uC778\uB371\uC2A4 \uAD6C\uCD95 \uC644\uB8CC: ${this.index.size}\uAC1C \uB178\uD2B8`)}async indexNote(e){let t=this.app.metadataCache.getFileCache(e),n=t==null?void 0:t.frontmatter,s=[];n!=null&&n.keywords&&(s=Array.isArray(n.keywords)?n.keywords:[n.keywords]);let r;if(n!=null&&n.targetType){let l=n.targetType;["project","library","archive"].includes(l)&&(r=l)}let o=(n==null?void 0:n.title)||e.basename,a=n==null?void 0:n.type;return{path:e.path,title:o,keywords:s,category:r,project:n==null?void 0:n.project,type:a}}async updateIndex(e){let t=await this.indexNote(e);t&&this.index.set(e.path,t)}removeFromIndex(e){this.index.delete(e)}async findRelated(e,t,n){let s=await this.gemini.extractKeywords(e);if(s.length===0)return[];let r=this.filterByKeywords(s,n);if(r.length===0)return[];let o=r.map((c,d)=>`${d}. ${c.note.title} (\uD0A4\uC6CC\uB4DC: ${c.note.keywords.join(", ")})`).join(`
`),a=await this.gemini.findRelatedNotes(t,s,o),l=[];for(let c of a)if(c.index>=0&&c.index<r.length){let d=r[c.index];l.push({note:d.note,relevance:c.relevance,matchedKeywords:d.matchedKeywords,reason:c.reason||"",connectionType:c.type||""})}return l}filterByKeywords(e,t){let n=[],s=new Set(e.map(r=>r.toLowerCase()));for(let[r,o]of this.index){if(t&&r===t||o.keywords.length===0)continue;let a=[];for(let l of o.keywords){let c=l.toLowerCase();for(let d of s)if(c===d||c.includes(d)||d.includes(c)){a.push(l);break}}a.length>0&&n.push({note:o,matchedKeywords:a})}return n.sort((r,o)=>o.matchedKeywords.length-r.matchedKeywords.length),n.slice(0,10)}async saveKeywordsToNote(e,t){let n=await this.app.vault.read(e),s=this.updateFrontmatterKeywords(n,t);await this.app.vault.modify(e,s),await this.updateIndex(e)}updateFrontmatterKeywords(e,t){let n=`keywords: [${t.map(r=>`"${r}"`).join(", ")}]`,s=e.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(s){let r=s[1];if(/^keywords:/m.test(r)){let o=r.replace(/^keywords:.*$/m,n);return e.replace(/^---\r?\n[\s\S]*?\r?\n---/,`---
${o}
---`)}else return e.replace(/^---\r?\n([\s\S]*?)\r?\n---/,`---
$1
${n}
---`)}else return`---
${n}
---

${e}`}async addRelatedLinks(e,t){if(t.length===0)return;let n=await this.app.vault.read(e),s=`

---
## \uAD00\uB828 \uB178\uD2B8
${t.map(a=>{let l=a.note.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]] (\uAD00\uB828\uB3C4: ${Math.round(a.relevance*100)}%)`}).join(`
`)}
`,r=/\n---\n##  \n[\s\S]*?(?=\n---\n|$)/,o;r.test(n)?o=n.replace(r,s):o=n+s,await this.app.vault.modify(e,o)}getIndexSize(){return this.index.size}getZettelIndex(){let e=new Map;for(let[t,n]of this.index)n.type==="zettel"&&e.set(t,n);return e}getZettelCount(){return this.getZettelIndex().size}async findRelatedZettels(e,t){if(e.length===0)return[];let n=this.getZettelIndex();if(n.size===0)return[];let s=this.filterZettelsByKeywords(e,n,t);if(s.length===0)return[];let r=s.map((l,c)=>`${c}. ${l.note.title} (\uD0A4\uC6CC\uB4DC: ${l.note.keywords.join(", ")})`).join(`
`),o=await this.gemini.findRelatedNotes("\uC0C8 ZK \uB178\uD2B8",e,r),a=[];for(let l of o)if(l.index>=0&&l.index<s.length){let c=s[l.index];a.push({note:c.note,relevance:l.relevance,matchedKeywords:c.matchedKeywords,reason:l.reason||"",connectionType:l.type||""})}return a}filterZettelsByKeywords(e,t,n){let s=[],r=new Set(e.map(o=>o.toLowerCase()));for(let[o,a]of t){if(n&&o===n||a.keywords.length===0)continue;let l=[];for(let c of a.keywords){let d=c.toLowerCase();for(let h of r)if(d===h||d.includes(h)||h.includes(d)){l.push(c);break}}l.length>0&&s.push({note:a,matchedKeywords:l})}return s.sort((o,a)=>a.matchedKeywords.length-o.matchedKeywords.length),s.slice(0,10)}};var fc=require("obsidian");function CR(i,e=100){return i.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,e)}var My=class{constructor(e,t,n,s){this.projectMOCs=new Map;this.app=e,this.gemini=t,this.projectsFolder=n,this.settings=s}async scanProjectMOCs(){this.projectMOCs.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e){let n=await this.parseProjectMOC(t);n&&this.projectMOCs.set(n.project,n)}console.log(`\uD504\uB85C\uC81D\uD2B8 MOC \uC2A4\uCE94 \uC644\uB8CC: ${this.projectMOCs.size}\uAC1C`)}async parseProjectMOC(e){let t=this.app.metadataCache.getFileCache(e),n=t==null?void 0:t.frontmatter;if(!n||n.type!=="project-moc")return null;let s=n.project||e.basename,r=n.title||e.basename;return{path:e.path,title:r,project:s}}getProjectList(){let e=this.app.vault.getAbstractFileByPath(this.projectsFolder);return e instanceof fc.TFolder?e.children.filter(t=>t instanceof fc.TFolder).map(t=>t.name):[]}getMOCCount(){return this.projectMOCs.size}async detectProject(e,t){let n=this.getProjectList();return n.length===0?null:await this.gemini.detectProject(e,t,n)}async addNoteToMOC(e,t,n){let s=this.projectMOCs.get(e);if(!s)return!1;let r=this.app.vault.getAbstractFileByPath(s.path);if(!(r instanceof fc.TFile))return!1;let o=await this.app.vault.read(r),a=this.app.vault.getAbstractFileByPath(n),c=`[[${a instanceof fc.TFile?a.basename:CR(t)}]]`;if(o.includes(c))return!0;let d=/^##  \s*$/m,h;return d.test(o)?h=o.replace(/^(##  \s*\n)/m,`$1- ${c}
`):h=o.trimEnd()+`

## \uAD00\uB828 \uB178\uD2B8
- ${c}
`,await this.app.vault.modify(r,h),!0}async createProjectMOC(e,t){this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);let s=CR(e),r=`${t}/${s} MOC.md`;if(this.app.vault.getAbstractFileByPath(r))return null;let a=`---
type: project-moc
project: "${e}"
title: "${e} \uD504\uB85C\uC81D\uD2B8"
created: ${Oe(this.settings.timezone,this.settings.dateFormat)}
---

# ${e} \uD504\uB85C\uC81D\uD2B8

## \uAC1C\uC694


## \uC9C4\uD589 \uC911


## \uAD00\uB828 \uB178\uD2B8

`,l=await this.app.vault.create(r,a);return this.projectMOCs.set(e,{path:l.path,title:`${e} \uD504\uB85C\uC81D\uD2B8`,project:e}),l}hasProject(e){return this.projectMOCs.has(e)}getProjectMOCPath(e){let t=this.projectMOCs.get(e);return(t==null?void 0:t.path)||null}removeFromIndex(e){for(let[t,n]of this.projectMOCs)if(n.path===e){this.projectMOCs.delete(t);break}}};var Lw=require("obsidian");var Py=class{constructor(e,t,n,s,r){this.app=e,this.relatedNoteFinder=t,this.zettelFolder=n,this.settings=s,this.gemini=r||null}get indexPath(){return`${this.zettelFolder}/ZK Index.md`}async updateIndex(e,t){let n=this.app.vault.getAbstractFileByPath(this.indexPath);n instanceof Lw.TFile?await this.addNoteToIndex(n,e,t):await this.createIndex(e,t)}async createIndex(e,t){let n=Oe(this.settings.timezone,this.settings.dateFormat),s=t[0]||"\uAE30\uD0C0",r=`---
type: zk-index
updated: ${n}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
- [[${e.basename}]]

## \uC8FC\uC81C\uBCC4
### ${s}
- [[${e.basename}]]
`;await this.app.vault.create(this.indexPath,r)}async addNoteToIndex(e,t,n){let s=await this.app.vault.read(e);s=this.updateRecentSection(s,t);let r=n[0]||"\uAE30\uD0C0";s=this.updateTopicSection(s,t,r),s=this.updateTimestamp(s),await this.app.vault.modify(e,s)}updateRecentSection(e,t){let n=/(##  \n)([\s\S]*?)(\n## |\n*$)/,s=e.match(n);if(s){let r=s[2].trim().split(`
`).filter(a=>a.startsWith("- ")),o=`- [[${t.basename}]]`;return r=r.filter(a=>!a.includes(t.basename)),r.unshift(o),r=r.slice(0,10),e.replace(n,`$1${r.join(`
`)}

$3`)}return e}updateTopicSection(e,t,n){let s=`### ${n}`,r=`- [[${t.basename}]]`;if(e.includes(s)){let o=new RegExp(`(### ${this.escapeRegex(n)}
)((?:- \\[\\[.*?\\]\\]
?)*)`),a=e.match(o);if(a)return a[2].includes(t.basename)?e:e.replace(o,`$1$2${r}
`)}else{let o=/(## \n)/;if(o.test(e))return e.replace(o,`$1${s}
${r}

`)}return e}updateTimestamp(e){let t=Oe(this.settings.timezone,this.settings.dateFormat);return e.replace(/^(---\n[\s\S]*?updated: ).*?(\n[\s\S]*?---)/,`$1${t}$2`)}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}async rebuildIndex(){let e=this.relatedNoteFinder.getZettelIndex();if(e.size===0)return;let t=new Map,n=[];for(let[,a]of e){let l=a.keywords[0]||"\uAE30\uD0C0";t.has(l)||t.set(l,[]),t.get(l).push(a);let c=a.path.match(/(\d{13})/),d=a.path.match(/(\d{8})-\d{3}/),h;if(c)h=new Date(parseInt(c[1]));else if(d){let p=d[1];h=new Date(parseInt(p.slice(0,4)),parseInt(p.slice(4,6))-1,parseInt(p.slice(6,8)))}else h=new Date;n.push({note:a,created:h})}n.sort((a,l)=>l.created.getTime()-a.created.getTime());let r=`---
type: zk-index
updated: ${Oe(this.settings.timezone,this.settings.dateFormat)}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
${n.slice(0,10).map(({note:a})=>{let l=a.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]]`}).join(`
`)}

## \uC8FC\uC81C\uBCC4
`;for(let[a,l]of t){let c=null;if(this.gemini&&l.length>=2)try{let d=l.map(h=>`- ${h.title} (\uD0A4\uC6CC\uB4DC: ${h.keywords.join(", ")})`).join(`
`);c=await this.gemini.generateTopicStructure(a,d)}catch(d){console.error(`\uC8FC\uC81C \uAD6C\uC870 \uC0DD\uC131 \uC2E4\uD328: ${a}`,d)}r+=`### ${a}
`,c!=null&&c.description&&(r+=`${c.description}

`),r+=`**\uD575\uC2EC \uB178\uD2B8:**
`;for(let d of l){let h=d.path.split("/"),p=h[h.length-1].replace(/\.md$/,""),m=c==null?void 0:c.notes.find(v=>v.title===d.title),y=m!=null&&m.role?` - ${m.role}`:"";if(r+=`- [[${p}]]${y}
`,m!=null&&m.relations&&m.relations.length>0)for(let v of m.relations){let b=v.type==="\uBC1C\uC804"?"\u2192":v.type==="\uAE30\uBC18"?"\u2190":"\u2194";r+=`  ${b} ${v.target}
`}}c!=null&&c.relatedTopics&&c.relatedTopics.length>0&&(r+=`
**\uAD00\uB828 \uC8FC\uC81C:** ${c.relatedTopics.join(", ")}
`),r+=`
`}let o=this.app.vault.getAbstractFileByPath(this.indexPath);o instanceof Lw.TFile&&await this.app.vault.delete(o),await this.app.vault.create(this.indexPath,r)}};var pc=require("obsidian");var ky=class{constructor(e,t,n){this.app=e,this.gemini=t,this.settings=n}async collectNotes(e){let t=e.customRange||Lc(e.period,this.settings.timezone),n=this.app.vault.getMarkdownFiles(),s=[];for(let r of n){if(this.shouldExclude(r,e))continue;let o=this.getProjectFromPath(r.path);if(e.projectFilter&&o!==e.projectFilter)continue;let a=await this.getNoteDate(r);if(!lC(a,t))continue;let l=await this.extractNoteInfo(r,o,a);s.push(l)}return s.sort((r,o)=>o.modified.getTime()-r.modified.getTime()),s}getBasename(e){let t=e.lastIndexOf("/");return(t>=0?e.substring(t+1):e).replace(/\.md$/,"")}shouldExclude(e,t){let n=[this.settings.archivesFolder,this.settings.zettelFolder],s=t.excludeFolders||n;for(let r of s)if(e.path.startsWith(r))return!0;return!!e.basename.includes("\uD68C\uACE0")}getProjectFromPath(e){let t=this.settings.projectsFolder+"/";if(e.startsWith(t)){let n=e.substring(t.length),s=n.indexOf("/");return s>0?n.substring(0,s):void 0}if(e.startsWith(this.settings.libraryFolder))return"Library";if(e.startsWith(this.settings.inboxFolder))return"Inbox"}async getNoteDate(e){let t=this.app.metadataCache.getFileCache(e),n=t==null?void 0:t.frontmatter;if(n!=null&&n.created){let s=new Date(n.created);if(!isNaN(s.getTime()))return s}return new Date(e.stat.mtime)}async extractNoteInfo(e,t,n){let s=this.app.metadataCache.getFileCache(e),r=s==null?void 0:s.frontmatter,o=[];return r!=null&&r.tags&&(Array.isArray(r.tags)?o.push(...r.tags):o.push(r.tags)),{path:e.path,title:(r==null?void 0:r.title)||e.basename,project:t,created:n,modified:new Date(e.stat.mtime),summary:r==null?void 0:r.summary,tags:o,type:r==null?void 0:r.type}}groupByProject(e){let t=new Map;for(let s of e){let r=s.project||"\uAE30\uD0C0";t.has(r)||t.set(r,[]),t.get(r).push(s)}let n=[];for(let[s,r]of t)n.push({projectName:s,notes:r,noteCount:r.length});return n.sort((s,r)=>r.noteCount-s.noteCount),n}async analyze(e){let t=e.customRange||Lc(e.period,this.settings.timezone),n=await this.collectNotes(e),s=this.groupByProject(n),r=n.filter(a=>a.type==="zettel").length,o=await this.gemini.analyzeReview(e.period,t,s);return{period:e.period,dateRange:t,totalNotes:n.length,newZKNotes:r,projectGroups:s,analysis:o}}async createReviewNote(e){let t=cC(e.period,new Date,this.settings.timezone),n=`${this.settings.archivesFolder}/Reviews`;await this.ensureFolder(n);let s=`${n}/${t}`,r=this.generateReviewContent(e),o=this.app.vault.getAbstractFileByPath(s);return o instanceof pc.TFile?(await this.app.vault.modify(o,r),o):await this.app.vault.create(s,r)}async ensureFolder(e){this.app.vault.getAbstractFileByPath(e)instanceof pc.TFolder||await this.app.vault.createFolder(e)}generateReviewContent(e){let t=new Date,n=Xv(t,this.settings.timezone,this.settings.dateFormat),s=`${Le(e.dateRange.start,this.settings.timezone)} ~ ${Le(e.dateRange.end,this.settings.timezone)}`,r;switch(e.period){case"today":r=`${Le(t,this.settings.timezone)} \uC77C\uC77C \uD68C\uACE0`;break;case"week":let l=Qv(t);r=`${t.getFullYear()}\uB144 ${l}\uC8FC\uCC28 \uC8FC\uAC04 \uD68C\uACE0`;break;case"month":r=`${t.getFullYear()}\uB144 ${t.getMonth()+1}\uC6D4 \uC6D4\uAC04 \uD68C\uACE0`;break;default:r=`${s} \uD68C\uACE0`}let o=e.projectGroups.map(l=>{let c=l.notes.map(d=>`- [[${this.getBasename(d.path)}]]${d.summary?` - ${d.summary}`:""}`).join(`
`);return`### ${l.projectName} (${l.noteCount}\uAC1C)
${c}`}).join(`

`),a="";if(e.analysis){let{summary:l,mainTopics:c,insights:d,nextActions:h,patterns:p}=e.analysis;a=`
## \uBD84\uC11D \uACB0\uACFC

### \uC694\uC57D
${l}

### \uC8FC\uC694 \uC8FC\uC81C
${c.map(m=>`- ${m}`).join(`
`)}

### \uC778\uC0AC\uC774\uD2B8
${d.map(m=>`- ${m}`).join(`
`)}

### \uB2E4\uC74C \uC561\uC158
${h.map(m=>`- [ ] ${m}`).join(`
`)}
${p?`
### \uC791\uC5C5 \uD328\uD134
${p}`:""}`}return`---
type: review
period: ${e.period}
date_range: ${s}
created: ${n}
tags: [review, ${e.period==="today"?"daily":e.period==="week"?"weekly":"monthly"}]
---

# ${r}

## \uD1B5\uACC4
- \uC791\uC5C5\uD55C \uB178\uD2B8: ${e.totalNotes}\uAC1C
- \uC0C8 ZK \uB178\uD2B8: ${e.newZKNotes}\uAC1C
- \uD65C\uC131 \uD504\uB85C\uC81D\uD2B8: ${e.projectGroups.filter(l=>l.projectName!=="\uAE30\uD0C0"&&l.projectName!=="Library"&&l.projectName!=="Inbox").length}\uAC1C

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5

${o}
${a}
`}getProjectList(){let e=new Set,t=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(t instanceof pc.TFolder)for(let n of t.children)n instanceof pc.TFolder&&e.add(n.name);return Array.from(e).sort()}};var Ow=["mp3","wav","m4a","aac","ogg","flac","webm"],qO=2*1024*1024*1024,Ny=class{constructor(e,t,n){this.app=e,this.gemini=t,this.settings=n}isAudioFile(e){return Ow.includes(e.extension.toLowerCase())}getMimeType(e){return{mp3:"audio/mp3",wav:"audio/wav",m4a:"audio/m4a",aac:"audio/aac",ogg:"audio/ogg",flac:"audio/flac",webm:"audio/webm"}[e.toLowerCase()]||"audio/mp3"}async fileToBlob(e,t){let n=await this.app.vault.readBinary(e);return new Blob([n],{type:t})}async processAudio(e){if(e.stat.size>qO)throw new Error("\uD30C\uC77C \uD06C\uAE30\uAC00 2GB\uB97C \uCD08\uACFC\uD569\uB2C8\uB2E4");let t=e.extension.toLowerCase(),n=this.getMimeType(t),s=await this.fileToBlob(e,n);return await this.gemini.analyzeMeeting(s,n,e.name)}generateMarkdownNote(e){let t=Oe(this.settings.timezone,this.settings.dateFormat),n=e.actionItems.length>0?e.actionItems.map(o=>{let a=`- [ ] ${o.task}`;return o.assignee&&(a+=` - @${o.assignee}`),o.deadline&&(a+=` (\uAE30\uD55C: ${o.deadline})`),a}).join(`
`):"- (\uC5C6\uC74C)",s=e.decisions.length>0?e.decisions.map(o=>`- ${o}`).join(`
`):"- (\uC5C6\uC74C)",r=e.nextAgenda.length>0?e.nextAgenda.map(o=>`- ${o}`).join(`
`):"- (\uC5C6\uC74C)";return`---
type: meeting
source_file: "${e.sourceFile}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}

## \uC694\uC57D
${e.summary}

## \uC561\uC158 \uC544\uC774\uD15C
${n}

## \uACB0\uC815\uC0AC\uD56D
${s}

## \uB2E4\uC74C \uD68C\uC758 \uC548\uAC74
${r}

---

<details>
<summary>\uC804\uCCB4 \uB179\uCDE8\uB85D</summary>

${e.transcription}

</details>

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}};var Ly=require("obsidian");var Fy=class{constructor(e,t){this.app=e,this.settings=t}async saveToDaily(e){let t=new Map;for(let s of e)t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s);let n=0;for(let[s,r]of t)await this.appendToDaily(s,r),n+=r.length;return n}async appendToDaily(e,t){let n=this.settings.dailyNotesFolder,s=`${n}/${e}.md`;await this.ensureFolder(n);let r=t.map(a=>this.formatTask(a)).join(`
`),o=this.app.vault.getAbstractFileByPath(s);if(o instanceof Ly.TFile){let a=await this.app.vault.read(o),l=this.appendSchedulesToContent(a,r);await this.app.vault.modify(o,l)}else{let a=this.createDailyNoteContent(e,r);await this.app.vault.create(s,a)}}formatTask(e){let t=e.time?`${e.time} `:"",n=e.type==="event"?"\u{1F4C5}":"\u{1F4CB}";return`- [ ] ${t}${e.title} ${n} ${e.date}`}appendSchedulesToContent(e,t){let n="## \uC77C\uC815";if(e.includes(n)){let r=e.indexOf(n),o=e.indexOf(`
## `,r+1);return o>0?e.substring(0,o)+t+`

`+e.substring(o):e+`
`+t}let s=e.indexOf("---",3);if(s>0){let r=e.indexOf(`
`,s)+1;return e.substring(0,r)+`
## \uC77C\uC815
`+t+`
`+e.substring(r)}return`## \uC77C\uC815
`+t+`

`+e}createDailyNoteContent(e,t){return`---
type: daily
date: ${e}
created: ${Yn(this.settings.timezone)}
---

# ${e}

## \uC77C\uC815
${t}

## \uBA54\uBAA8

`}async ensureFolder(e){if(!(this.app.vault.getAbstractFileByPath(e)instanceof Ly.TFolder))try{await this.app.vault.createFolder(e)}catch(n){}}getToday(){return Yn(this.settings.timezone)}};var Oy=class{constructor(e,t){this.gemini=e,this.settings=t}extractVideoId(e){let t=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/|youtube\.com\/shorts\/)([a-zA-Z0-9_-]{11})/,/^([a-zA-Z0-9_-]{11})$/];for(let n of t){let s=e.match(n);if(s)return s[1]}return null}isValidYouTubeUrl(e){return this.extractVideoId(e)!==null}async processVideo(e){let t=this.extractVideoId(e);if(!t)throw new Error("\uC720\uD6A8\uD55C YouTube URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let n=`https://www.youtube.com/watch?v=${t}`;console.log("Gemini \uB124\uC774\uD2F0\uBE0C YouTube \uBD84\uC11D \uC2DC\uC791:",n);let s=await this.gemini.analyzeYouTube(n);return{videoId:t,url:n,title:s.title,summary:s.summary,keyPoints:s.keyPoints}}generateMarkdownNote(e){let t=Oe(this.settings.timezone,this.settings.dateFormat),n=`https://www.youtube.com/embed/${e.videoId}`;return`---
type: youtube
source: "${e.url}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}

<div style="resize: both; overflow: hidden; width: 100%; height: 400px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${n}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none;" allowfullscreen></iframe>
</div>

## \uC694\uC57D
${e.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${e.keyPoints.map(s=>`- ${s}`).join(`
`)}
`}};var Lh=require("obsidian");var Uy=class{constructor(e,t){this.gemini=e,this.settings=t}isValidUrl(e){try{let t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch(t){return!1}}extractMetadata(e,t){let n=l=>{let c=[new RegExp(`<meta[^>]*property=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*property=["']${l}["']`,"i"),new RegExp(`<meta[^>]*name=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*name=["']${l}["']`,"i")];for(let d of c){let h=e.match(d);if(h)return h[1]}return""},s=e.match(/<title[^>]*>([^<]+)<\/title>/i),r=e.match(/<link[^>]*rel=["'](?:shortcut )?icon["'][^>]*href=["']([^"']+)["']/i),o=new URL(t),a=l=>l?l.startsWith("http")?l:l.startsWith("//")?o.protocol+l:l.startsWith("/")?o.origin+l:o.origin+"/"+l:"";return{title:n("og:title")||n("twitter:title")||(s==null?void 0:s[1])||"",description:n("og:description")||n("twitter:description")||n("description")||"",image:a(n("og:image")||n("twitter:image")||""),siteName:n("og:site_name")||o.hostname,favicon:a((r==null?void 0:r[1])||"/favicon.ico")}}extractContent(e){let t=e.match(/<title[^>]*>([^<]+)<\/title>/i),n=e.match(/<meta[^>]*property=["']og:title["'][^>]*content=["']([^"']+)["']/i),s=(n==null?void 0:n[1])||(t==null?void 0:t[1])||"Untitled",r=e.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<nav[^>]*>[\s\S]*?<\/nav>/gi,"").replace(/<header[^>]*>[\s\S]*?<\/header>/gi,"").replace(/<footer[^>]*>[\s\S]*?<\/footer>/gi,"").replace(/<aside[^>]*>[\s\S]*?<\/aside>/gi,""),o="",a=r.match(/<article[^>]*>([\s\S]*?)<\/article>/i),l=r.match(/<main[^>]*>([\s\S]*?)<\/main>/i),c=r.match(/<div[^>]*(?:class|id)=["'][^"']*content[^"']*["'][^>]*>([\s\S]*?)<\/div>/i);if(a)o=a[1];else if(l)o=l[1];else if(c)o=c[1];else{let h=r.match(/<body[^>]*>([\s\S]*?)<\/body>/i);o=(h==null?void 0:h[1])||r}return o=o.replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&[a-z]+;/gi," ").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim(),{title:s.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim(),content:o}}async fetchWithJinaReader(e){var c,d;let t=`https://r.jina.ai/${e}`,s=(await(0,Lh.requestUrl)({url:t,method:"GET",headers:{Accept:"text/plain","X-Timeout":"30","X-Wait-For-Selector":"article, .post-content, .se-main-container, #postViewArea"}})).text;s.includes("Warning: This page maybe not yet fully loaded")&&console.log("Jina Reader: \uD398\uC774\uC9C0 \uB85C\uB529 \uACBD\uACE0 \uAC10\uC9C0");let r=s.split(`
`),o="Untitled",a=0;for((c=r[0])!=null&&c.startsWith("# ")?(o=r[0].substring(2).trim(),a=1):(d=r[0])!=null&&d.startsWith("Title: ")&&(o=r[0].substring(7).trim(),a=1);a<r.length;){let h=r[a];if(h!=null&&h.startsWith("URL Source:")||h!=null&&h.startsWith("http")||h!=null&&h.startsWith("Warning:")||h!=null&&h.startsWith("Markdown Content:")||(h==null?void 0:h.trim())==="")a++;else break}let l=r.slice(a).join(`
`).trim();if(l.length<100&&!l.includes(`
`))throw new Error("\uD398\uC774\uC9C0 \uCF58\uD150\uCE20\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4 (JavaScript \uB85C\uB529 \uB300\uAE30 \uC2E4\uD328)");return{title:o,content:l}}async fetchNaverBlog(e){var h;let t=e;if(e.includes("blog.naver.com")){let p=e.match(/blog\.naver\.com\/([^\/]+)\/(\d+)/);p&&(t=`https://m.blog.naver.com/${p[1]}/${p[2]}`)}let s=(await(0,Lh.requestUrl)({url:t,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15",Accept:"text/html,application/xhtml+xml","Accept-Language":"ko-KR,ko;q=0.9"}})).text,r=s.match(/<title[^>]*>([^<]+)<\/title>/i),o=((h=r==null?void 0:r[1])==null?void 0:h.replace(/ :  $/,"").trim())||"Untitled",a="",l=s.match(/<div[^>]*class="[^"]*se-main-container[^"]*"[^>]*>([\s\S]*?)<\/div>\s*<\/div>\s*<\/div>/i),c=s.match(/<div[^>]*id="postViewArea"[^>]*>([\s\S]*?)<\/div>/i),d=(l==null?void 0:l[1])||(c==null?void 0:c[1])||"";return d&&(a=d.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim()),{title:o,content:a}}async processUrl(e){if(!this.isValidUrl(e))throw new Error("\uC720\uD6A8\uD55C URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let t;try{let r=(await(0,Lh.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text;t=this.extractMetadata(r,e)}catch(s){console.log("\uBA54\uD0C0\uB370\uC774\uD130 \uCD94\uCD9C \uC2E4\uD328:",s)}if(e.includes("blog.naver.com"))return console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, Jina Reader \uC0AC\uC6A9"),await this.processUrlFallback(e,t);try{console.log("URL Context Tool\uB85C \uC6F9\uD398\uC774\uC9C0 \uBD84\uC11D \uC2DC\uB3C4");let s=await this.gemini.analyzeWebpage(e),r=["unable to access","cannot access","could not access","\uC811\uADFC\uD560 \uC218 \uC5C6","\uAC00\uC838\uC62C \uC218 \uC5C6"],o=s.summary.toLowerCase();return r.some(l=>o.includes(l.toLowerCase()))?(console.log("URL Context Tool \uC811\uADFC \uC2E4\uD328 \uAC10\uC9C0, \uD3F4\uBC31 \uC2DC\uB3C4"),await this.processUrlFallback(e,t)):(t&&(t.title=t.title||s.title),{url:e,title:s.title,content:"",summary:s.summary,keyPoints:s.keyPoints,metadata:t})}catch(s){console.log("URL Context Tool \uC2E4\uD328, \uD3F4\uBC31 \uC2DC\uB3C4:",s)}return await this.processUrlFallback(e,t)}async processUrlFallback(e,t){let n,s,r=null;if(!t)try{r=(await(0,Lh.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text,t=this.extractMetadata(r,e)}catch(d){console.log("HTML \uAC00\uC838\uC624\uAE30 \uC2E4\uD328:",d)}if(e.includes("blog.naver.com")){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, \uC804\uC6A9 \uCD94\uCD9C \uC2DC\uB3C4");try{let d=await this.fetchNaverBlog(e);if(n=d.title,s=d.content,s.length<100)throw new Error("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uCD94\uCD9C \uC2E4\uD328")}catch(d){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uC804\uC6A9 \uCD94\uCD9C \uC2E4\uD328, Jina Reader \uC2DC\uB3C4:",d);let h=await this.fetchWithJinaReader(e);n=h.title,s=h.content}}else try{console.log("Jina Reader\uB85C \uCF58\uD150\uCE20 \uCD94\uCD9C \uC2DC\uB3C4");let d=await this.fetchWithJinaReader(e);n=d.title,s=d.content}catch(d){if(console.log("Jina Reader \uC2E4\uD328, \uC9C1\uC811 \uCD94\uCD9C\uB85C \uD3F4\uBC31:",d),r){let h=this.extractContent(r);n=h.title,s=h.content}else throw new Error("\uC6F9\uD398\uC774\uC9C0\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4")}if(s.length<50)throw new Error("\uBCF8\uBB38\uC744 \uCD94\uCD9C\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC811\uADFC\uC774 \uC81C\uD55C\uB41C \uD398\uC774\uC9C0\uC77C \uC218 \uC788\uC2B5\uB2C8\uB2E4.");let a=5e4,l=s.length>a?s.slice(0,a)+"...":s,c=await this.gemini.summarizeContent(l,"webpage");return t&&(t.title=t.title||n),{url:e,title:c.title||n,content:l,summary:c.summary,keyPoints:c.keyPoints,metadata:t}}generateMarkdownNote(e){let t=Oe(this.settings.timezone,this.settings.dateFormat),n=e.metadata,s=e.url;e.url.includes("blog.naver.com")&&!e.url.includes("m.blog.naver.com")&&(s=e.url.replace("blog.naver.com","m.blog.naver.com"));let r="";if(n){let o=n.image?`
> ![](${n.image})
>`:"",a=n.description?`
> ${n.description}
>`:"";r=`
> [!bookmark] ${n.siteName||new URL(e.url).hostname}
> **${n.title||e.title}**
>${a}${o}
> \u{1F517} ${e.url}

`}else r=`
> [!bookmark] \uC6F9\uD398\uC774\uC9C0
> **${e.title}**
>
> \u{1F517} ${e.url}

`;return`---
type: webpage
source: "${e.url}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}
${r}
<div style="resize: both; overflow: hidden; width: 100%; height: 600px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${s}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none; color-scheme: light;"></iframe>
</div>

## \uC694\uC57D
${e.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${e.keyPoints.map(o=>`- ${o}`).join(`
`)}
`}};var cs=require("obsidian"),WO="YOUR_CLIENT_ID.apps.googleusercontent.com",YO="YOUR_CLIENT_SECRET",TR="http://127.0.0.1:42813/callback",KO="https://accounts.google.com/o/oauth2/v2/auth",xR="https://oauth2.googleapis.com/token",XO="https://www.googleapis.com/calendar/v3",JO="https://www.googleapis.com/auth/calendar.events",Oh=class{constructor(e,t,n){this.authServer=null;this.app=e,this.settings=t,this.saveSettings=n}isConnected(){return!!this.settings.googleRefreshToken}getClientId(){return this.settings.useOwnApiKey?this.settings.googleClientId:WO}getClientSecret(){return this.settings.useOwnApiKey?this.settings.googleClientSecret:YO}async startOAuth(){let e=this.getClientId();if(!e||e==="YOUR_CLIENT_ID.apps.googleusercontent.com"){new cs.Notice(`Google Calendar Client ID\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.
\uC124\uC815\uC5D0\uC11C Advanced \uBAA8\uB4DC\uB85C \uC9C1\uC811 Client ID\uB97C \uC785\uB825\uD558\uAC70\uB098,
\uD50C\uB7EC\uADF8\uC778 \uC5C5\uB370\uC774\uD2B8\uB97C \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.`,1e4);return}let t=new URLSearchParams({client_id:e,redirect_uri:TR,response_type:"code",scope:JO,access_type:"offline",prompt:"consent"}),n=`${KO}?${t.toString()}`;try{let s=await this.startAuthServer();await this.exchangeCodeForTokens(s),new cs.Notice("Google Calendar \uC5F0\uACB0 \uC644\uB8CC!")}catch(s){console.error("OAuth \uC5D0\uB7EC:",s),new cs.Notice("Google Calendar \uC5F0\uACB0 \uC2E4\uD328: "+s.message)}window.open(n,"_blank")}startAuthServer(){return new Promise((e,t)=>{let n=require("http"),s=setTimeout(()=>{this.stopAuthServer(),t(new Error("\uC778\uC99D \uC2DC\uAC04 \uCD08\uACFC (5\uBD84)"))},5*60*1e3);this.authServer=n.createServer((r,o)=>{let a=new URL(r.url||"","http://127.0.0.1:42813");if(a.pathname==="/callback"){let l=a.searchParams.get("code"),c=a.searchParams.get("error");if(c){o.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),o.end(`
							<html><body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
								<h1>\uC5F0\uACB0 \uC2E4\uD328</h1>
								<p>Google Calendar \uC5F0\uACB0\uC774 \uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p>
								<p>\uC774 \uCC3D\uC744 \uB2EB\uC544\uB3C4 \uB429\uB2C8\uB2E4.</p>
							</body></html>
						`),clearTimeout(s),this.stopAuthServer(),t(new Error(c));return}if(l){o.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),o.end(`
							<html><body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
								<h1>\uC5F0\uACB0 \uC644\uB8CC!</h1>
								<p>Google Calendar\uAC00 \uC5F0\uACB0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p>
								<p>\uC774 \uCC3D\uC744 \uB2EB\uACE0 Obsidian\uC73C\uB85C \uB3CC\uC544\uAC00\uC138\uC694.</p>
							</body></html>
						`),clearTimeout(s),this.stopAuthServer(),e(l);return}}o.writeHead(404),o.end("Not Found")}),this.authServer.listen(42813,"127.0.0.1",()=>{console.log("OAuth \uCF5C\uBC31 \uC11C\uBC84 \uC2DC\uC791: http://127.0.0.1:42813")}),this.authServer.on("error",r=>{clearTimeout(s),t(new Error(`\uC11C\uBC84 \uC2DC\uC791 \uC2E4\uD328: ${r.message}`))})})}stopAuthServer(){this.authServer&&(this.authServer.close(),this.authServer=null)}async exchangeCodeForTokens(e){let n=(await(0,cs.requestUrl)({url:xR,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:this.getClientId(),client_secret:this.getClientSecret(),code:e,grant_type:"authorization_code",redirect_uri:TR}).toString()})).json;if(n.error)throw new Error(n.error_description||n.error);this.settings.googleAccessToken=n.access_token,n.refresh_token&&(this.settings.googleRefreshToken=n.refresh_token),this.settings.googleTokenExpiry=Date.now()+n.expires_in*1e3,await this.saveSettings()}async refreshAccessToken(){if(!this.settings.googleRefreshToken)throw new Error("Refresh token\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC5F0\uACB0\uD574\uC8FC\uC138\uC694.");let t=(await(0,cs.requestUrl)({url:xR,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:this.getClientId(),client_secret:this.getClientSecret(),refresh_token:this.settings.googleRefreshToken,grant_type:"refresh_token"}).toString()})).json;if(t.error)throw t.error==="invalid_grant"?(this.settings.googleRefreshToken="",await this.saveSettings(),new Error("Google \uC5F0\uACB0\uC774 \uB9CC\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC5F0\uACB0\uD574\uC8FC\uC138\uC694.")):new Error(t.error_description||t.error);this.settings.googleAccessToken=t.access_token,this.settings.googleTokenExpiry=Date.now()+t.expires_in*1e3,await this.saveSettings()}async ensureValidToken(){Date.now()>this.settings.googleTokenExpiry-5*60*1e3&&await this.refreshAccessToken()}async createEvent(e){var o;if(!this.isConnected())throw new Error("Google Calendar\uAC00 \uC5F0\uACB0\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");await this.ensureValidToken();let t,n;if(e.time){let a=`${e.date}T${e.time}:00`,l=this.addHour(e.time),c=`${e.date}T${l}:00`;t={dateTime:a,timeZone:this.resolveTimezone()},n={dateTime:c,timeZone:this.resolveTimezone()}}else t={date:e.date},n={date:this.getNextDay(e.date)};let s={summary:e.title,start:t,end:n},r=await(0,cs.requestUrl)({url:`${XO}/calendars/primary/events`,method:"POST",headers:{Authorization:`Bearer ${this.settings.googleAccessToken}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(r.status>=400){let a=r.json;throw new Error(((o=a.error)==null?void 0:o.message)||"\uC774\uBCA4\uD2B8 \uC0DD\uC131 \uC2E4\uD328")}}async saveSchedules(e){let t=0;for(let n of e)try{await this.createEvent(n),t++}catch(s){console.error("\uC77C\uC815 \uC800\uC7A5 \uC2E4\uD328:",n.title,s)}return t}addHour(e){let[t,n]=e.split(":").map(Number),s=(t+1)%24;return`${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}`}getNextDay(e){let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}resolveTimezone(){return this.settings.timezone==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:this.settings.timezone}async disconnect(){this.settings.googleAccessToken="",this.settings.googleRefreshToken="",this.settings.googleTokenExpiry=0,await this.saveSettings(),new cs.Notice("Google Calendar \uC5F0\uACB0\uC774 \uD574\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}};var RR=require("obsidian"),Hy=class extends RR.Modal{constructor(t,n,s){super(t);this.resolvePromise=null;this.schedules=n,this.settings=s,this.selected=new Set(n.map((r,o)=>o)),this.saveToDaily=!0,this.saveToGoogle=s.googleCalendarEnabled&&!!s.googleRefreshToken}async openAndWait(){return new Promise(t=>{this.resolvePromise=t,this.open()})}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-schedule-modal"),t.createEl("h2",{text:"\uAC10\uC9C0\uB41C \uC77C\uC815"}),t.createEl("p",{text:`${this.schedules.length}\uAC1C\uC758 \uC77C\uC815\uC774 \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uC800\uC7A5\uD560 \uC77C\uC815\uC744 \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let n=t.createDiv({cls:"schedule-list"});n.style.maxHeight="300px",n.style.overflowY="auto",n.style.marginBottom="16px",this.schedules.forEach((y,v)=>{let b=n.createDiv({cls:"schedule-item"});b.style.display="flex",b.style.alignItems="center",b.style.padding="10px 12px",b.style.marginBottom="8px",b.style.border="1px solid var(--background-modifier-border)",b.style.borderRadius="8px",b.style.gap="12px";let w=b.createEl("input",{type:"checkbox",attr:{checked:!0}});w.style.flexShrink="0",w.addEventListener("change",()=>{w.checked?this.selected.add(v):this.selected.delete(v),this.updateSaveButton()});let _=b.createDiv({cls:"schedule-info"});_.style.flex="1",_.style.minWidth="0";let C=_.createEl("div",{text:y.title});C.style.fontWeight="500",C.style.overflow="hidden",C.style.textOverflow="ellipsis",C.style.whiteSpace="nowrap";let T=_.createEl("div");T.style.fontSize="12px",T.style.color="var(--text-muted)";let R=y.type==="event"?"\uC57D\uC18D":"\uD560\uC77C",D=y.type==="event"?"\u{1F4C5}":"\u{1F4CB}",I=y.time||"\uC885\uC77C";T.setText(`${D} ${R} | ${y.date} ${I}`)});let s=t.createDiv({cls:"schedule-destinations"});s.style.padding="12px",s.style.backgroundColor="var(--background-secondary)",s.style.borderRadius="8px",s.style.marginBottom="16px",s.createEl("div",{text:"\uC800\uC7A5 \uC704\uCE58"}).style.fontWeight="500";let r=s.createDiv({cls:"destination-option"});r.style.display="flex",r.style.alignItems="center",r.style.gap="8px",r.style.marginTop="8px";let o=r.createEl("input",{type:"checkbox",attr:{checked:!0}});o.id="save-to-daily",o.addEventListener("change",()=>{this.saveToDaily=o.checked});let a=r.createEl("label",{text:`Daily Notes (${this.settings.dailyNotesFolder}/)`,attr:{for:"save-to-daily"}});a.style.cursor="pointer";let l=s.createDiv({cls:"destination-option"});l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginTop="8px";let c=l.createEl("input",{type:"checkbox",attr:{checked:this.saveToGoogle,disabled:!this.settings.googleCalendarEnabled||!this.settings.googleRefreshToken}});c.id="save-to-google",c.addEventListener("change",()=>{this.saveToGoogle=c.checked});let d=l.createEl("label",{attr:{for:"save-to-google"}});d.style.cursor="pointer",this.settings.googleCalendarEnabled&&this.settings.googleRefreshToken?d.setText("Google Calendar (\uC5F0\uACB0\uB428)"):this.settings.googleCalendarEnabled?(d.setText("Google Calendar (\uC5F0\uACB0 \uD544\uC694)"),d.style.color="var(--text-muted)"):(d.setText("Google Calendar (\uBE44\uD65C\uC131\uD654)"),d.style.color="var(--text-muted)");let h=t.createDiv({cls:"modal-button-container"});h.style.display="flex",h.style.justifyContent="flex-end",h.style.gap="8px",h.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>{this.close(),this.resolvePromise&&this.resolvePromise(null)});let m=h.createEl("button",{text:`${this.selected.size}\uAC1C \uC800\uC7A5`,cls:"mod-cta"});m.id="save-schedule-btn",m.addEventListener("click",()=>{let y=this.schedules.filter((v,b)=>this.selected.has(b));this.close(),this.resolvePromise&&this.resolvePromise({selectedSchedules:y,saveToDaily:this.saveToDaily,saveToGoogle:this.saveToGoogle})})}updateSaveButton(){let t=this.contentEl.querySelector("#save-schedule-btn");t&&t.setText(`${this.selected.size}\uAC1C \uC800\uC7A5`)}onClose(){this.contentEl.empty()}};var gc=require("obsidian");var Uh=class{constructor(e,t){this.cache=new Map;this.cacheTime=0;this.cacheTTL=6e4;this.app=e,this.settings=t}updateSettings(e){this.settings=e}invalidateCache(){this.cache.clear(),this.cacheTime=0}async getEventsForRange(e,t){let n=[],s=this.app.vault.getMarkdownFiles();for(let r of s){let o=await this.extractEventsFromFile(r);for(let a of o)a.start>=e&&a.start<=t&&n.push(a)}return n}async getEventsForDay(e){if(this.isCacheValid()&&this.cache.has(e))return this.cache.get(e);let t=await this.getEventsForRange(new Date(e+"T00:00:00"),new Date(e+"T23:59:59")),n={date:e,notes:t.filter(s=>s.type==="note"),schedules:t.filter(s=>s.type==="schedule"),meetings:t.filter(s=>s.type==="meeting"),total:t.length};return this.cache.set(e,n),this.cacheTime=Date.now(),n}async getEventCountsForMonth(e,t){let n=new Map,s=new Date(e,t,1),r=new Date(e,t+1,0,23,59,59),o=await this.getEventsForRange(s,r);for(let a of o){let l=Le(a.start,this.settings.timezone);n.set(l,(n.get(l)||0)+1)}return n}async extractEventsFromFile(e){let t=[],n=await this.app.vault.cachedRead(e),s=this.parseFrontmatter(n),r=this.determineFileType(e,s),o=this.getEventDate(e,s);if(!o)return t;if(r==="meeting")t.push(this.createEvent(e,s,o,"meeting"));else if(this.isDailyNote(e)){let a=this.extractSchedulesFromDailyNote(e,n,o);t.push(...a)}else t.push(this.createEvent(e,s,o,"note"));return t}parseFrontmatter(e){let t=e.match(/^---\n([\s\S]*?)\n---/);if(!t)return{};try{return(0,gc.parseYaml)(t[1])||{}}catch(n){return{}}}determineFileType(e,t){return t.type==="meeting"||e.path.includes("\uD68C\uC758\uB85D")||e.path.includes("Meeting")?"meeting":this.isDailyNote(e)?"schedule":"note"}isDailyNote(e){let t=this.settings.dailyNotesFolder;return e.path.startsWith(t)}getEventDate(e,t){let n=["date","created","meetingDate"];for(let r of n){let o=t[r];if(o){let a=this.parseDate(o);if(a)return a}}let s=e.basename.match(/^(\d{4}-\d{2}-\d{2})$/);return s?new Date(s[1]+"T00:00:00"):new Date(e.stat.mtime)}parseDate(e){let t=new Date(e);return isNaN(t.getTime())?null:t}createEvent(e,t,n,s){let r=t.title||e.basename,o=this.getProjectFromPath(e.path),a={note:"var(--interactive-accent)",schedule:"var(--text-success)",meeting:"var(--text-warning)"};return{id:e.path,title:r,start:n,allDay:!this.hasTimeComponent(n),type:s,color:a[s],source:{path:e.path},metadata:{project:o,tags:t.tags||[],summary:t.summary||void 0}}}extractSchedulesFromDailyNote(e,t,n){let s=[],r=/^- \[[ x]\] (\d{1,2}:\d{2})?\s*(.+?)(?:\s+[]\s*\d{4}-\d{2}-\d{2})?$/gm,o,a=0,l=t.split(`
`);for(let c=0;c<l.length;c++){let d=l[c];if(d.match(/^- \[[ x]\]/)){let h=d.match(/^- \[[ x]\] (\d{1,2}:\d{2})?\s*(.+?)(?:\s+[]\s*(\d{4}-\d{2}-\d{2}))?$/);if(h){let p=h[1],m=h[2].trim(),y=h[3],v;if(y?v=new Date(y+"T00:00:00"):v=new Date(n),p){let[b,w]=p.split(":").map(Number);v.setHours(b,w,0,0)}s.push({id:`${e.path}:${c}`,title:m,start:v,allDay:!p,type:"schedule",color:"var(--text-success)",source:{path:e.path,lineNumber:c+1},metadata:{project:this.getProjectFromPath(e.path)}})}}}return s}getProjectFromPath(e){let t=this.settings.projectsFolder;if(e.startsWith(t+"/")){let n=e.substring(t.length+1),s=n.indexOf("/");if(s>0)return n.substring(0,s)}}hasTimeComponent(e){return e.getHours()!==0||e.getMinutes()!==0}isCacheValid(){return Date.now()-this.cacheTime<this.cacheTTL}async moveEvent(e,t){let[n,s]=e.split(":"),r=this.app.vault.getAbstractFileByPath(n);if(!(r instanceof gc.TFile))return!1;let o=await this.app.vault.read(r);if(s){let a=parseInt(s)-1,l=o.split(`
`);if(a>=0&&a<l.length){let c=l[a],d=Le(t,this.settings.timezone),h=c.replace(/[]\s*\d{4}-\d{2}-\d{2}/,`\u{1F4C5} ${d}`);if(h!==c)return l[a]=h,await this.app.vault.modify(r,l.join(`
`)),this.invalidateCache(),!0}}else{let a=Le(t,this.settings.timezone),l=this.updateFrontmatterDate(o,a);if(l!==o)return await this.app.vault.modify(r,l),this.invalidateCache(),!0}return!1}updateFrontmatterDate(e,t){let n=e.match(/^---\n([\s\S]*?)\n---/);if(!n)return e;let s=n[1],r;return s.includes("date:")?r=s.replace(/date:\s*.*/,`date: ${t}`):r=`date: ${t}
${s}`,e.replace(/^---\n[\s\S]*?\n---/,`---
${r}
---`)}async deleteEvent(e){let[t,n]=e.split(":"),s=this.app.vault.getAbstractFileByPath(t);if(!(s instanceof gc.TFile))return!1;if(n){let r=parseInt(n)-1,a=(await this.app.vault.read(s)).split(`
`);if(r>=0&&r<a.length)return a.splice(r,1),await this.app.vault.modify(s,a.join(`
`)),this.invalidateCache(),!0}else return!1;return!1}async openEvent(e){let[t,n]=e.split(":"),s=this.app.vault.getAbstractFileByPath(t);if(s instanceof gc.TFile){let r=this.app.workspace.getLeaf();if(await r.openFile(s),n){let o=parseInt(n)-1,a=r.view;"editor"in a&&a.editor&&a.editor.setCursor({line:o,ch:0})}}}};var DR=require("obsidian");var IR=require("obsidian"),Hh=class extends IR.Modal{constructor(t,n,s,r){super(t);this.onEventClick=null;this.date=n,this.dataProvider=s,this.settings=r}setOnEventClick(t){this.onEventClick=t}async onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-calendar-day-modal"),t.createEl("p",{text:"\uB85C\uB529 \uC911..."});let n=await this.dataProvider.getEventsForDay(this.date);t.empty();let s=new Date(this.date+"T00:00:00"),o=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"][s.getDay()],a=t.createDiv({cls:"day-modal-header"});if(a.style.marginBottom="16px",a.createEl("h2",{text:`${this.date} (${o}\uC694\uC77C)`}).style.margin="0",a.createEl("p",{text:`\uCD1D ${n.total}\uAC1C \uD56D\uBAA9`,cls:"setting-item-description"}).style.margin="4px 0 0 0",n.total===0){let h=t.createDiv({cls:"day-modal-empty"});h.style.padding="32px",h.style.textAlign="center",h.style.color="var(--text-muted)",h.setText("\uC774 \uB0A0\uC9DC\uC5D0 \uB4F1\uB85D\uB41C \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let l=t.createDiv({cls:"day-modal-sections"});l.style.maxHeight="400px",l.style.overflowY="auto",n.notes.length>0&&this.renderSection(l,"\uB178\uD2B8",n.notes,"note"),n.schedules.length>0&&this.renderSection(l,"\uC77C\uC815",n.schedules,"schedule"),n.meetings.length>0&&this.renderSection(l,"\uD68C\uC758\uB85D",n.meetings,"meeting");let c=t.createDiv({cls:"modal-button-container"});c.style.display="flex",c.style.justifyContent="flex-end",c.style.marginTop="16px",c.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close())}renderSection(t,n,s,r){var d;let o={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"},a=t.createDiv({cls:"day-section"});a.style.marginBottom="16px";let l=a.createDiv({cls:"section-header"});l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginBottom="8px",l.createEl("span",{text:o[r]}),l.createEl("span",{text:`${n} (${s.length})`}).style.fontWeight="500";let c=a.createDiv({cls:"section-list"});for(let h of s){let p=c.createDiv({cls:"event-item"});p.style.display="flex",p.style.alignItems="center",p.style.padding="8px 12px",p.style.marginBottom="4px",p.style.border="1px solid var(--background-modifier-border)",p.style.borderRadius="6px",p.style.cursor="pointer",p.style.transition="background-color 0.15s";let m=p.createDiv({cls:"event-indicator"});m.style.width="4px",m.style.height="24px",m.style.borderRadius="2px",m.style.marginRight="12px",m.style.backgroundColor=h.color||"var(--interactive-accent)";let y=p.createDiv({cls:"event-info"});y.style.flex="1",y.style.minWidth="0";let v=y.createEl("div",{text:h.title});v.style.fontWeight="500",v.style.overflow="hidden",v.style.textOverflow="ellipsis",v.style.whiteSpace="nowrap";let b=y.createEl("div");b.style.fontSize="12px",b.style.color="var(--text-muted)";let w=[];if(h.allDay)w.push("\uC885\uC77C");else{let _=h.start.getHours().toString().padStart(2,"0"),C=h.start.getMinutes().toString().padStart(2,"0");w.push(`${_}:${C}`)}(d=h.metadata)!=null&&d.project&&w.push(h.metadata.project),b.setText(w.join(" | ")),p.addEventListener("mouseenter",()=>{p.style.backgroundColor="var(--background-modifier-hover)"}),p.addEventListener("mouseleave",()=>{p.style.backgroundColor=""}),p.addEventListener("click",async()=>{this.onEventClick?this.onEventClick(h):(await this.dataProvider.openEvent(h.id),this.close())})}}onClose(){this.contentEl.empty()}};var mc="zfb-mini-calendar",Bh=class extends DR.ItemView{constructor(t,n,s){super(t);this.eventCounts=new Map;this.settings=n,this.dataProvider=s;let r=new Date;this.currentYear=r.getFullYear(),this.currentMonth=r.getMonth()}getViewType(){return mc}getDisplayText(){return"\uCE98\uB9B0\uB354"}getIcon(){return"calendar"}async onOpen(){await this.renderCalendar()}async onClose(){this.contentEl.empty()}updateSettings(t){this.settings=t,this.renderCalendar()}async renderCalendar(){let t=this.contentEl;t.empty(),t.addClass("zfb-mini-calendar"),this.eventCounts=await this.dataProvider.getEventCountsForMonth(this.currentYear,this.currentMonth),this.renderHeader(t),this.renderWeekdayHeader(t),this.renderDateGrid(t),this.renderTodayButton(t)}renderHeader(t){let n=t.createDiv({cls:"mini-calendar-header"});n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="space-between",n.style.padding="8px 4px",n.style.marginBottom="8px";let s=n.createEl("button",{cls:"nav-btn"});s.innerHTML="&lt;",s.style.padding="4px 8px",s.style.border="none",s.style.background="none",s.style.cursor="pointer",s.style.fontSize="16px",s.style.color="var(--text-muted)",s.addEventListener("click",()=>this.navigateMonth(-1));let r=["1\uC6D4","2\uC6D4","3\uC6D4","4\uC6D4","5\uC6D4","6\uC6D4","7\uC6D4","8\uC6D4","9\uC6D4","10\uC6D4","11\uC6D4","12\uC6D4"],o=n.createEl("span",{text:`${this.currentYear}\uB144 ${r[this.currentMonth]}`});o.style.fontWeight="600";let a=n.createEl("button",{cls:"nav-btn"});a.innerHTML="&gt;",a.style.padding="4px 8px",a.style.border="none",a.style.background="none",a.style.cursor="pointer",a.style.fontSize="16px",a.style.color="var(--text-muted)",a.addEventListener("click",()=>this.navigateMonth(1))}renderWeekdayHeader(t){let n=t.createDiv({cls:"weekday-header"});n.style.display="grid",n.style.gridTemplateColumns="repeat(7, 1fr)",n.style.textAlign="center",n.style.fontSize="11px",n.style.color="var(--text-muted)",n.style.marginBottom="4px";let s=this.settings.calendarFirstDayOfWeek===1?["\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0","\uC77C"]:["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"];for(let r of s)n.createEl("span",{text:r})}renderDateGrid(t){let n=t.createDiv({cls:"date-grid"});n.style.display="grid",n.style.gridTemplateColumns="repeat(7, 1fr)",n.style.gap="2px";let s=new Date(this.currentYear,this.currentMonth,1),r=new Date(this.currentYear,this.currentMonth+1,0),o=s.getDay();this.settings.calendarFirstDayOfWeek===1&&(o=o===0?6:o-1);let a=Le(new Date,this.settings.timezone);for(let l=0;l<o;l++){let c=n.createDiv({cls:"date-cell empty"});c.style.aspectRatio="1"}for(let l=1;l<=r.getDate();l++){let c=`${this.currentYear}-${String(this.currentMonth+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`,d=this.eventCounts.get(c)||0,h=c===a,p=n.createDiv({cls:"date-cell"});p.style.aspectRatio="1",p.style.display="flex",p.style.flexDirection="column",p.style.alignItems="center",p.style.justifyContent="center",p.style.cursor="pointer",p.style.borderRadius="6px",p.style.transition="background-color 0.15s",p.style.position="relative";let m=p.createEl("span",{text:String(l)});if(m.style.fontSize="12px",h&&(p.style.backgroundColor="var(--interactive-accent)",p.style.color="var(--text-on-accent)"),d>0){let y=p.createDiv({cls:"event-dots"});y.style.display="flex",y.style.gap="2px",y.style.marginTop="2px";let v=Math.min(d,3);for(let b=0;b<v;b++){let w=y.createDiv({cls:"event-dot"});w.style.width="4px",w.style.height="4px",w.style.borderRadius="50%",w.style.backgroundColor=h?"var(--text-on-accent)":"var(--interactive-accent)"}}h||(p.addEventListener("mouseenter",()=>{p.style.backgroundColor="var(--background-modifier-hover)"}),p.addEventListener("mouseleave",()=>{p.style.backgroundColor=""})),p.addEventListener("click",()=>{this.openDayModal(c)})}}renderTodayButton(t){let n=t.createDiv({cls:"today-btn-container"});n.style.marginTop="12px",n.style.textAlign="center";let s=n.createEl("button",{text:"\uC624\uB298"});s.style.padding="6px 16px",s.style.border="1px solid var(--background-modifier-border)",s.style.borderRadius="4px",s.style.background="var(--background-secondary)",s.style.cursor="pointer",s.style.fontSize="12px",s.addEventListener("click",()=>{let r=new Date;this.currentYear=r.getFullYear(),this.currentMonth=r.getMonth(),this.renderCalendar()})}navigateMonth(t){this.currentMonth+=t,this.currentMonth<0?(this.currentMonth=11,this.currentYear--):this.currentMonth>11&&(this.currentMonth=0,this.currentYear++),this.renderCalendar()}openDayModal(t){new Hh(this.app,t,this.dataProvider,this.settings).open()}};var sM=require("obsidian");var zy,z,FR,Hw,yc,Jo,MR,LR,OR,Vy={},UR=[],ZO=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function rr(i,e){for(var t in e)i[t]=e[t];return i}function HR(i){var e=i.parentNode;e&&e.removeChild(i)}function x(i,e,t){var n,s,r,o={};for(r in e)r=="key"?n=e[r]:r=="ref"?s=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?zy.call(arguments,2):t),typeof i=="function"&&i.defaultProps!=null)for(r in i.defaultProps)o[r]===void 0&&(o[r]=i.defaultProps[r]);return By(i,o,n,s,null)}function By(i,e,t,n,s){var r={type:i,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:s==null?++FR:s};return s==null&&z.vnode!=null&&z.vnode(r),r}function Ne(){return{current:null}}function ae(i){return i.children}function QO(i,e,t,n,s){var r;for(r in t)r==="children"||r==="key"||r in e||Gy(i,r,null,t[r],n);for(r in e)s&&typeof e[r]!="function"||r==="children"||r==="key"||r==="value"||r==="checked"||t[r]===e[r]||Gy(i,r,e[r],t[r],n)}function PR(i,e,t){e[0]==="-"?i.setProperty(e,t==null?"":t):i[e]=t==null?"":typeof t!="number"||ZO.test(e)?t:t+"px"}function Gy(i,e,t,n,s){var r;e:if(e==="style")if(typeof t=="string")i.style.cssText=t;else{if(typeof n=="string"&&(i.style.cssText=n=""),n)for(e in n)t&&e in t||PR(i.style,e,"");if(t)for(e in t)n&&t[e]===n[e]||PR(i.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")r=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in i?e.toLowerCase().slice(2):e.slice(2),i.l||(i.l={}),i.l[e+r]=t,t?n||i.addEventListener(e,r?NR:kR,r):i.removeEventListener(e,r?NR:kR,r);else if(e!=="dangerouslySetInnerHTML"){if(s)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in i)try{i[e]=t==null?"":t;break e}catch(o){}typeof t=="function"||(t==null||t===!1&&e.indexOf("-")==-1?i.removeAttribute(e):i.setAttribute(e,t))}}function kR(i){yc=!0;try{return this.l[i.type+!1](z.event?z.event(i):i)}finally{yc=!1}}function NR(i){yc=!0;try{return this.l[i.type+!0](z.event?z.event(i):i)}finally{yc=!1}}function it(i,e){this.props=i,this.context=e}function Vh(i,e){if(e==null)return i.__?Vh(i.__,i.__.__k.indexOf(i)+1):null;for(var t;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null)return t.__e;return typeof i.type=="function"?Vh(i):null}function BR(i){var e,t;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,e=0;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null){i.__e=i.__c.base=t.__e;break}return BR(i)}}function jO(i){yc?setTimeout(i):LR(i)}function Uw(i){(!i.__d&&(i.__d=!0)&&Jo.push(i)&&!$y.__r++||MR!==z.debounceRendering)&&((MR=z.debounceRendering)||jO)($y)}function $y(){var i,e,t,n,s,r,o,a;for(Jo.sort(function(l,c){return l.__v.__b-c.__v.__b});i=Jo.shift();)i.__d&&(e=Jo.length,n=void 0,s=void 0,o=(r=(t=i).__v).__e,(a=t.__P)&&(n=[],(s=rr({},r)).__v=r.__v+1,Bw(a,r,s,t.__n,a.ownerSVGElement!==void 0,r.__h!=null?[o]:null,n,o==null?Vh(r):o,r.__h),qR(n,r),r.__e!=o&&BR(r)),Jo.length>e&&Jo.sort(function(l,c){return l.__v.__b-c.__v.__b}));$y.__r=0}function VR(i,e,t,n,s,r,o,a,l,c){var d,h,p,m,y,v,b,w=n&&n.__k||UR,_=w.length;for(t.__k=[],d=0;d<e.length;d++)if((m=t.__k[d]=(m=e[d])==null||typeof m=="boolean"?null:typeof m=="string"||typeof m=="number"||typeof m=="bigint"?By(null,m,null,null,m):Array.isArray(m)?By(ae,{children:m},null,null,null):m.__b>0?By(m.type,m.props,m.key,m.ref?m.ref:null,m.__v):m)!=null){if(m.__=t,m.__b=t.__b+1,(p=w[d])===null||p&&m.key==p.key&&m.type===p.type)w[d]=void 0;else for(h=0;h<_;h++){if((p=w[h])&&m.key==p.key&&m.type===p.type){w[h]=void 0;break}p=null}Bw(i,m,p=p||Vy,s,r,o,a,l,c),y=m.__e,(h=m.ref)&&p.ref!=h&&(b||(b=[]),p.ref&&b.push(p.ref,null,m),b.push(h,m.__c||y,m)),y!=null?(v==null&&(v=y),typeof m.type=="function"&&m.__k===p.__k?m.__d=l=GR(m,l,i):l=$R(i,m,p,w,y,l),typeof t.type=="function"&&(t.__d=l)):l&&p.__e==l&&l.parentNode!=i&&(l=Vh(p))}for(t.__e=v,d=_;d--;)w[d]!=null&&(typeof t.type=="function"&&w[d].__e!=null&&w[d].__e==t.__d&&(t.__d=zR(n).nextSibling),YR(w[d],w[d]));if(b)for(d=0;d<b.length;d++)WR(b[d],b[++d],b[++d])}function GR(i,e,t){for(var n,s=i.__k,r=0;s&&r<s.length;r++)(n=s[r])&&(n.__=i,e=typeof n.type=="function"?GR(n,e,t):$R(t,n,n,s,n.__e,e));return e}function Gh(i,e){return e=e||[],i==null||typeof i=="boolean"||(Array.isArray(i)?i.some(function(t){Gh(t,e)}):e.push(i)),e}function $R(i,e,t,n,s,r){var o,a,l;if(e.__d!==void 0)o=e.__d,e.__d=void 0;else if(t==null||s!=r||s.parentNode==null)e:if(r==null||r.parentNode!==i)i.appendChild(s),o=null;else{for(a=r,l=0;(a=a.nextSibling)&&l<n.length;l+=1)if(a==s)break e;i.insertBefore(s,r),o=r}return o!==void 0?o:s.nextSibling}function zR(i){var e,t,n;if(i.type==null||typeof i.type=="string")return i.__e;if(i.__k){for(e=i.__k.length-1;e>=0;e--)if((t=i.__k[e])&&(n=zR(t)))return n}return null}function Bw(i,e,t,n,s,r,o,a,l){var c,d,h,p,m,y,v,b,w,_,C,T,R,D,I,k=e.type;if(e.constructor!==void 0)return null;t.__h!=null&&(l=t.__h,a=e.__e=t.__e,e.__h=null,r=[a]),(c=z.__b)&&c(e);try{e:if(typeof k=="function"){if(b=e.props,w=(c=k.contextType)&&n[c.__c],_=c?w?w.props.value:c.__:n,t.__c?v=(d=e.__c=t.__c).__=d.__E:("prototype"in k&&k.prototype.render?e.__c=d=new k(b,_):(e.__c=d=new it(b,_),d.constructor=k,d.render=tU),w&&w.sub(d),d.props=b,d.state||(d.state={}),d.context=_,d.__n=n,h=d.__d=!0,d.__h=[],d._sb=[]),d.__s==null&&(d.__s=d.state),k.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=rr({},d.__s)),rr(d.__s,k.getDerivedStateFromProps(b,d.__s))),p=d.props,m=d.state,d.__v=e,h)k.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(k.getDerivedStateFromProps==null&&b!==p&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(b,_),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(b,d.__s,_)===!1||e.__v===t.__v){for(e.__v!==t.__v&&(d.props=b,d.state=d.__s,d.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.forEach(function(N){N&&(N.__=e)}),C=0;C<d._sb.length;C++)d.__h.push(d._sb[C]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(b,d.__s,_),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(p,m,y)})}if(d.context=_,d.props=b,d.__P=i,T=z.__r,R=0,"prototype"in k&&k.prototype.render){for(d.state=d.__s,d.__d=!1,T&&T(e),c=d.render(d.props,d.state,d.context),D=0;D<d._sb.length;D++)d.__h.push(d._sb[D]);d._sb=[]}else do d.__d=!1,T&&T(e),c=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++R<25);d.state=d.__s,d.getChildContext!=null&&(n=rr(rr({},n),d.getChildContext())),h||d.getSnapshotBeforeUpdate==null||(y=d.getSnapshotBeforeUpdate(p,m)),I=c!=null&&c.type===ae&&c.key==null?c.props.children:c,VR(i,Array.isArray(I)?I:[I],e,t,n,s,r,o,a,l),d.base=e.__e,e.__h=null,d.__h.length&&o.push(d),v&&(d.__E=d.__=null),d.__e=!1}else r==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=eU(t.__e,e,t,n,s,r,o,l);(c=z.diffed)&&c(e)}catch(N){e.__v=null,(l||r!=null)&&(e.__e=a,e.__h=!!l,r[r.indexOf(a)]=null),z.__e(N,e,t)}}function qR(i,e){z.__c&&z.__c(e,i),i.some(function(t){try{i=t.__h,t.__h=[],i.some(function(n){n.call(t)})}catch(n){z.__e(n,t.__v)}})}function eU(i,e,t,n,s,r,o,a){var l,c,d,h=t.props,p=e.props,m=e.type,y=0;if(m==="svg"&&(s=!0),r!=null){for(;y<r.length;y++)if((l=r[y])&&"setAttribute"in l==!!m&&(m?l.localName===m:l.nodeType===3)){i=l,r[y]=null;break}}if(i==null){if(m===null)return document.createTextNode(p);i=s?document.createElementNS("http://www.w3.org/2000/svg",m):document.createElement(m,p.is&&p),r=null,a=!1}if(m===null)h===p||a&&i.data===p||(i.data=p);else{if(r=r&&zy.call(i.childNodes),c=(h=t.props||Vy).dangerouslySetInnerHTML,d=p.dangerouslySetInnerHTML,!a){if(r!=null)for(h={},y=0;y<i.attributes.length;y++)h[i.attributes[y].name]=i.attributes[y].value;(d||c)&&(d&&(c&&d.__html==c.__html||d.__html===i.innerHTML)||(i.innerHTML=d&&d.__html||""))}if(QO(i,p,h,s,a),d)e.__k=[];else if(y=e.props.children,VR(i,Array.isArray(y)?y:[y],e,t,n,s&&m!=="foreignObject",r,o,r?r[0]:t.__k&&Vh(t,0),a),r!=null)for(y=r.length;y--;)r[y]!=null&&HR(r[y]);a||("value"in p&&(y=p.value)!==void 0&&(y!==i.value||m==="progress"&&!y||m==="option"&&y!==h.value)&&Gy(i,"value",y,h.value,!1),"checked"in p&&(y=p.checked)!==void 0&&y!==i.checked&&Gy(i,"checked",y,h.checked,!1))}return i}function WR(i,e,t){try{typeof i=="function"?i(e):i.current=e}catch(n){z.__e(n,t)}}function YR(i,e,t){var n,s;if(z.unmount&&z.unmount(i),(n=i.ref)&&(n.current&&n.current!==i.__e||WR(n,null,e)),(n=i.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(r){z.__e(r,e)}n.base=n.__P=null,i.__c=void 0}if(n=i.__k)for(s=0;s<n.length;s++)n[s]&&YR(n[s],e,t||typeof i.type!="function");t||i.__e==null||HR(i.__e),i.__=i.__e=i.__d=void 0}function tU(i,e,t){return this.constructor(i,t)}function or(i,e,t){var n,s,r;z.__&&z.__(i,e),s=(n=typeof t=="function")?null:t&&t.__k||e.__k,r=[],Bw(e,i=(!n&&t||e).__k=x(ae,null,[i]),s||Vy,Vy,e.ownerSVGElement!==void 0,!n&&t?[t]:s?null:e.firstChild?zy.call(e.childNodes):null,r,!n&&t?t:s?s.__e:e.firstChild,n),qR(r,i)}function qy(i,e){var t={__c:e="__cC"+OR++,__:i,Consumer:function(n,s){return n.children(s)},Provider:function(n){var s,r;return this.getChildContext||(s=[],(r={})[e]=this,this.getChildContext=function(){return r},this.shouldComponentUpdate=function(o){this.props.value!==o.value&&s.some(function(a){a.__e=!0,Uw(a)})},this.sub=function(o){s.push(o);var a=o.componentWillUnmount;o.componentWillUnmount=function(){s.splice(s.indexOf(o),1),a&&a.call(o)}}),n.children}};return t.Provider.__=t.Consumer.contextType=t}zy=UR.slice,z={__e:function(i,e,t,n){for(var s,r,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((r=s.constructor)&&r.getDerivedStateFromError!=null&&(s.setState(r.getDerivedStateFromError(i)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(i,n||{}),o=s.__d),o)return s.__E=s}catch(a){i=a}throw i}},FR=0,Hw=function(i){return i!=null&&i.constructor===void 0},yc=!1,it.prototype.setState=function(i,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=rr({},this.state),typeof i=="function"&&(i=i(rr({},t),this.props)),i&&rr(t,i),i!=null&&this.__v&&(e&&this._sb.push(e),Uw(this))},it.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),Uw(this))},it.prototype.render=ae,Jo=[],LR=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,$y.__r=0,OR=0;var iU,mi,Vw,KR;var tI=[],Gw=[],XR=z.__b,JR=z.__r,ZR=z.diffed,QR=z.__c,jR=z.unmount;function sU(){for(var i;i=tI.shift();)if(i.__P&&i.__H)try{i.__H.__h.forEach(Wy),i.__H.__h.forEach($w),i.__H.__h=[]}catch(e){i.__H.__h=[],z.__e(e,i.__v)}}z.__b=function(i){mi=null,XR&&XR(i)},z.__r=function(i){JR&&JR(i),iU=0;var e=(mi=i.__c).__H;e&&(Vw===mi?(e.__h=[],mi.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.__V=Gw,t.__N=t.i=void 0})):(e.__h.forEach(Wy),e.__h.forEach($w),e.__h=[])),Vw=mi},z.diffed=function(i){ZR&&ZR(i);var e=i.__c;e&&e.__H&&(e.__H.__h.length&&(tI.push(e)!==1&&KR===z.requestAnimationFrame||((KR=z.requestAnimationFrame)||rU)(sU)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.__V!==Gw&&(t.__=t.__V),t.i=void 0,t.__V=Gw})),Vw=mi=null},z.__c=function(i,e){e.some(function(t){try{t.__h.forEach(Wy),t.__h=t.__h.filter(function(n){return!n.__||$w(n)})}catch(n){e.some(function(s){s.__h&&(s.__h=[])}),e=[],z.__e(n,t.__v)}}),QR&&QR(i,e)},z.unmount=function(i){jR&&jR(i);var e,t=i.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{Wy(n)}catch(s){e=s}}),t.__H=void 0,e&&z.__e(e,t.__v))};var eI=typeof requestAnimationFrame=="function";function rU(i){var e,t=function(){clearTimeout(n),eI&&cancelAnimationFrame(e),setTimeout(i)},n=setTimeout(t,100);eI&&(e=requestAnimationFrame(t))}function Wy(i){var e=mi,t=i.__c;typeof t=="function"&&(i.__c=void 0,t()),mi=e}function $w(i){var e=mi;i.__c=i.__(),mi=e}function oU(i,e){for(var t in e)i[t]=e[t];return i}function nI(i,e){for(var t in i)if(t!=="__source"&&!(t in e))return!0;for(var n in e)if(n!=="__source"&&i[n]!==e[n])return!0;return!1}function iI(i){this.props=i}(iI.prototype=new it).isPureReactComponent=!0,iI.prototype.shouldComponentUpdate=function(i,e){return nI(this.props,i)||nI(this.state,e)};var sI=z.__b;z.__b=function(i){i.type&&i.type.__f&&i.ref&&(i.props.ref=i.ref,i.ref=null),sI&&sI(i)};var K2=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;var aU=z.__e;z.__e=function(i,e,t,n){if(i.then){for(var s,r=e;r=r.__;)if((s=r.__c)&&s.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),s.__c(i,e)}aU(i,e,t,n)};var rI=z.unmount;function uI(i,e,t){return i&&(i.__c&&i.__c.__H&&(i.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),i.__c.__H=null),(i=oU({},i)).__c!=null&&(i.__c.__P===t&&(i.__c.__P=e),i.__c=null),i.__k=i.__k&&i.__k.map(function(n){return uI(n,e,t)})),i}function hI(i,e,t){return i&&(i.__v=null,i.__k=i.__k&&i.__k.map(function(n){return hI(n,e,t)}),i.__c&&i.__c.__P===e&&(i.__e&&t.insertBefore(i.__e,i.__d),i.__c.__e=!0,i.__c.__P=t)),i}function zw(){this.__u=0,this.t=null,this.__b=null}function fI(i){var e=i.__.__c;return e&&e.__a&&e.__a(i)}function Yy(){this.u=null,this.o=null}z.unmount=function(i){var e=i.__c;e&&e.__R&&e.__R(),e&&i.__h===!0&&(i.type=null),rI&&rI(i)},(zw.prototype=new it).__c=function(i,e){var t=e.__c,n=this;n.t==null&&(n.t=[]),n.t.push(t);var s=fI(n.__v),r=!1,o=function(){r||(r=!0,t.__R=null,s?s(a):a())};t.__R=o;var a=function(){if(!--n.__u){if(n.state.__a){var c=n.state.__a;n.__v.__k[0]=hI(c,c.__c.__P,c.__c.__O)}var d;for(n.setState({__a:n.__b=null});d=n.t.pop();)d.forceUpdate()}},l=e.__h===!0;n.__u++||l||n.setState({__a:n.__b=n.__v.__k[0]}),i.then(o,o)},zw.prototype.componentWillUnmount=function(){this.t=[]},zw.prototype.render=function(i,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=uI(this.__b,t,n.__O=n.__P)}this.__b=null}var s=e.__a&&x(ae,null,i.fallback);return s&&(s.__h=null),[x(ae,null,e.__a?null:i.children),s]};var oI=function(i,e,t){if(++t[1]===t[0]&&i.o.delete(e),i.props.revealOrder&&(i.props.revealOrder[0]!=="t"||!i.o.size))for(t=i.u;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;i.u=t=t[2]}};function lU(i){return this.getChildContext=function(){return i.context},i.children}function cU(i){var e=this,t=i.i;e.componentWillUnmount=function(){or(null,e.l),e.l=null,e.i=null},e.i&&e.i!==t&&e.componentWillUnmount(),i.__v?(e.l||(e.i=t,e.l={nodeType:1,parentNode:t,childNodes:[],appendChild:function(n){this.childNodes.push(n),e.i.appendChild(n)},insertBefore:function(n,s){this.childNodes.push(n),e.i.appendChild(n)},removeChild:function(n){this.childNodes.splice(this.childNodes.indexOf(n)>>>1,1),e.i.removeChild(n)}}),or(x(lU,{context:e.context},i.__v),e.l)):e.l&&e.componentWillUnmount()}function pI(i,e){var t=x(cU,{__v:i,i:e});return t.containerInfo=e,t}(Yy.prototype=new it).__a=function(i){var e=this,t=fI(e.__v),n=e.o.get(i);return n[0]++,function(s){var r=function(){e.props.revealOrder?(n.push(s),oI(e,i,n)):s()};t?t(r):r()}},Yy.prototype.render=function(i){this.u=null,this.o=new Map;var e=Gh(i.children);i.revealOrder&&i.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.o.set(e[t],this.u=[1,0,this.u]);return i.children},Yy.prototype.componentDidUpdate=Yy.prototype.componentDidMount=function(){var i=this;this.o.forEach(function(e,t){oI(i,t,e)})};var dU=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,uU=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,hU=typeof document!="undefined",fU=function(i){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(i)};it.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(i){Object.defineProperty(it.prototype,i,{configurable:!0,get:function(){return this["UNSAFE_"+i]},set:function(e){Object.defineProperty(this,i,{configurable:!0,writable:!0,value:e})}})});var aI=z.event;function pU(){}function gU(){return this.cancelBubble}function mU(){return this.defaultPrevented}z.event=function(i){return aI&&(i=aI(i)),i.persist=pU,i.isPropagationStopped=gU,i.isDefaultPrevented=mU,i.nativeEvent=i};var yU,lI={configurable:!0,get:function(){return this.class}},cI=z.vnode;z.vnode=function(i){var e=i.type,t=i.props,n=t;if(typeof e=="string"){var s=e.indexOf("-")===-1;for(var r in n={},t){var o=t[r];hU&&r==="children"&&e==="noscript"||r==="value"&&"defaultValue"in t&&o==null||(r==="defaultValue"&&"value"in t&&t.value==null?r="value":r==="download"&&o===!0?o="":/ondoubleclick/i.test(r)?r="ondblclick":/^onchange(textarea|input)/i.test(r+e)&&!fU(t.type)?r="oninput":/^onfocus$/i.test(r)?r="onfocusin":/^onblur$/i.test(r)?r="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(r)?r=r.toLowerCase():s&&uU.test(r)?r=r.replace(/[A-Z0-9]/g,"-$&").toLowerCase():o===null&&(o=void 0),/^oninput$/i.test(r)&&(r=r.toLowerCase(),n[r]&&(r="oninputCapture")),n[r]=o)}e=="select"&&n.multiple&&Array.isArray(n.value)&&(n.value=Gh(t.children).forEach(function(a){a.props.selected=n.value.indexOf(a.props.value)!=-1})),e=="select"&&n.defaultValue!=null&&(n.value=Gh(t.children).forEach(function(a){a.props.selected=n.multiple?n.defaultValue.indexOf(a.props.value)!=-1:n.defaultValue==a.props.value})),i.props=n,t.class!=t.className&&(lI.enumerable="className"in t,t.className!=null&&(n.class=t.className),Object.defineProperty(n,"className",lI))}i.$$typeof=dU,cI&&cI(i)};var dI=z.__r;z.__r=function(i){dI&&dI(i),yU=i.__c};var RI=[],tS=new Map;function pr(i){RI.push(i),tS.forEach(e=>{MI(e,i)})}function II(i){i.isConnected&&i.getRootNode&&DI(i.getRootNode())}function DI(i){let e=tS.get(i);if(!e||!e.isConnected){if(e=i.querySelector("style[data-fullcalendar]"),!e){e=document.createElement("style"),e.setAttribute("data-fullcalendar","");let t=EU();t&&(e.nonce=t);let n=i===document?document.head:i,s=i===document?n.querySelector("script,link[rel=stylesheet],link[as=style],style"):n.firstChild;n.insertBefore(e,s)}tS.set(i,e),vU(e)}}function vU(i){for(let e of RI)MI(i,e)}function MI(i,e){let{sheet:t}=i,n=t.cssRules.length;e.split("}").forEach((s,r)=>{s=s.trim(),s&&t.insertRule(s+"}",n+r)})}var qw;function EU(){return qw===void 0&&(qw=bU()),qw}function bU(){let i=document.querySelector('meta[name="csp-nonce"]');if(i&&i.hasAttribute("content"))return i.getAttribute("content");let e=document.querySelector("script[nonce]");return e&&e.nonce||""}typeof document!="undefined"&&DI(document);var AU=':root{--fc-small-font-size:.85em;--fc-page-bg-color:#fff;--fc-neutral-bg-color:hsla(0,0%,82%,.3);--fc-neutral-text-color:grey;--fc-border-color:#ddd;--fc-button-text-color:#fff;--fc-button-bg-color:#2c3e50;--fc-button-border-color:#2c3e50;--fc-button-hover-bg-color:#1e2b37;--fc-button-hover-border-color:#1a252f;--fc-button-active-bg-color:#1a252f;--fc-button-active-border-color:#151e27;--fc-event-bg-color:#3788d8;--fc-event-border-color:#3788d8;--fc-event-text-color:#fff;--fc-event-selected-overlay-color:rgba(0,0,0,.25);--fc-more-link-bg-color:#d0d0d0;--fc-more-link-text-color:inherit;--fc-event-resizer-thickness:8px;--fc-event-resizer-dot-total-width:8px;--fc-event-resizer-dot-border-width:1px;--fc-non-business-color:hsla(0,0%,84%,.3);--fc-bg-event-color:#8fdf82;--fc-bg-event-opacity:0.3;--fc-highlight-color:rgba(188,232,241,.3);--fc-today-bg-color:rgba(255,220,40,.15);--fc-now-indicator-color:red}.fc-not-allowed,.fc-not-allowed .fc-event{cursor:not-allowed}.fc{display:flex;flex-direction:column;font-size:1em}.fc,.fc *,.fc :after,.fc :before{box-sizing:border-box}.fc table{border-collapse:collapse;border-spacing:0;font-size:1em}.fc th{text-align:center}.fc td,.fc th{padding:0;vertical-align:top}.fc a[data-navlink]{cursor:pointer}.fc a[data-navlink]:hover{text-decoration:underline}.fc-direction-ltr{direction:ltr;text-align:left}.fc-direction-rtl{direction:rtl;text-align:right}.fc-theme-standard td,.fc-theme-standard th{border:1px solid var(--fc-border-color)}.fc-liquid-hack td,.fc-liquid-hack th{position:relative}@font-face{font-family:fcicons;font-style:normal;font-weight:400;src:url("data:application/x-font-ttf;charset=utf-8;base64,AAEAAAALAIAAAwAwT1MvMg8SBfAAAAC8AAAAYGNtYXAXVtKNAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZgYydxIAAAF4AAAFNGhlYWQUJ7cIAAAGrAAAADZoaGVhB20DzAAABuQAAAAkaG10eCIABhQAAAcIAAAALGxvY2ED4AU6AAAHNAAAABhtYXhwAA8AjAAAB0wAAAAgbmFtZXsr690AAAdsAAABhnBvc3QAAwAAAAAI9AAAACAAAwPAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBgPA/8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qb//f//AAAAAAAg6QD//f//AAH/4xcEAAMAAQAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAWIAjQKeAskAEwAAJSc3NjQnJiIHAQYUFwEWMjc2NCcCnuLiDQ0MJAz/AA0NAQAMJAwNDcni4gwjDQwM/wANIwz/AA0NDCMNAAAAAQFiAI0CngLJABMAACUBNjQnASYiBwYUHwEHBhQXFjI3AZ4BAA0N/wAMJAwNDeLiDQ0MJAyNAQAMIw0BAAwMDSMM4uINIwwNDQAAAAIA4gC3Ax4CngATACcAACUnNzY0JyYiDwEGFB8BFjI3NjQnISc3NjQnJiIPAQYUHwEWMjc2NCcB87e3DQ0MIw3VDQ3VDSMMDQ0BK7e3DQ0MJAzVDQ3VDCQMDQ3zuLcMJAwNDdUNIwzWDAwNIwy4twwkDA0N1Q0jDNYMDA0jDAAAAgDiALcDHgKeABMAJwAAJTc2NC8BJiIHBhQfAQcGFBcWMjchNzY0LwEmIgcGFB8BBwYUFxYyNwJJ1Q0N1Q0jDA0Nt7cNDQwjDf7V1Q0N1QwkDA0Nt7cNDQwkDLfWDCMN1Q0NDCQMt7gMIw0MDNYMIw3VDQ0MJAy3uAwjDQwMAAADAFUAAAOrA1UAMwBoAHcAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMhMjY1NCYjISIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAAVYRGRkR/qoRGRkRA1UFBAUOCQkVDAsZDf2rDRkLDBUJCA4FBQUFBQUOCQgVDAsZDQJVDRkLDBUJCQ4FBAVVAgECBQMCBwQECAX9qwQJAwQHAwMFAQICAgIBBQMDBwQDCQQCVQUIBAQHAgMFAgEC/oAZEhEZGRESGQAAAAADAFUAAAOrA1UAMwBoAIkAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMzFRQWMzI2PQEzMjY1NCYrATU0JiMiBh0BIyIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAgBkSEhmAERkZEYAZEhIZgBEZGREDVQUEBQ4JCRUMCxkN/asNGQsMFQkIDgUFBQUFBQ4JCBUMCxkNAlUNGQsMFQkJDgUEBVUCAQIFAwIHBAQIBf2rBAkDBAcDAwUBAgICAgEFAwMHBAMJBAJVBQgEBAcCAwUCAQL+gIASGRkSgBkSERmAEhkZEoAZERIZAAABAOIAjQMeAskAIAAAExcHBhQXFjI/ARcWMjc2NC8BNzY0JyYiDwEnJiIHBhQX4uLiDQ0MJAzi4gwkDA0N4uINDQwkDOLiDCQMDQ0CjeLiDSMMDQ3h4Q0NDCMN4uIMIw0MDOLiDAwNIwwAAAABAAAAAQAAa5n0y18PPPUACwQAAAAAANivOVsAAAAA2K85WwAAAAADqwNVAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAOrAAEAAAAAAAAAAAAAAAAAAAALBAAAAAAAAAAAAAAAAgAAAAQAAWIEAAFiBAAA4gQAAOIEAABVBAAAVQQAAOIAAAAAAAoAFAAeAEQAagCqAOoBngJkApoAAQAAAAsAigADAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGZjaWNvbnMAZgBjAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGZjaWNvbnMAZgBjAGkAYwBvAG4Ac2ZjaWNvbnMAZgBjAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmZjaWNvbnMAZgBjAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("truetype")}.fc-icon{speak:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font-family:fcicons!important;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1;text-align:center;text-transform:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1em}.fc-icon-chevron-left:before{content:"\\e900"}.fc-icon-chevron-right:before{content:"\\e901"}.fc-icon-chevrons-left:before{content:"\\e902"}.fc-icon-chevrons-right:before{content:"\\e903"}.fc-icon-minus-square:before{content:"\\e904"}.fc-icon-plus-square:before{content:"\\e905"}.fc-icon-x:before{content:"\\e906"}.fc .fc-button{border-radius:0;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible;text-transform:none}.fc .fc-button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}.fc .fc-button{-webkit-appearance:button}.fc .fc-button:not(:disabled){cursor:pointer}.fc .fc-button{background-color:transparent;border:1px solid transparent;border-radius:.25em;display:inline-block;font-size:1em;font-weight:400;line-height:1.5;padding:.4em .65em;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}.fc .fc-button:hover{text-decoration:none}.fc .fc-button:focus{box-shadow:0 0 0 .2rem rgba(44,62,80,.25);outline:0}.fc .fc-button:disabled{opacity:.65}.fc .fc-button-primary{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:hover{background-color:var(--fc-button-hover-bg-color);border-color:var(--fc-button-hover-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:disabled{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button-primary:not(:disabled).fc-button-active,.fc .fc-button-primary:not(:disabled):active{background-color:var(--fc-button-active-bg-color);border-color:var(--fc-button-active-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:not(:disabled).fc-button-active:focus,.fc .fc-button-primary:not(:disabled):active:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button .fc-icon{font-size:1.5em;vertical-align:middle}.fc .fc-button-group{display:inline-flex;position:relative;vertical-align:middle}.fc .fc-button-group>.fc-button{flex:1 1 auto;position:relative}.fc .fc-button-group>.fc-button.fc-button-active,.fc .fc-button-group>.fc-button:active,.fc .fc-button-group>.fc-button:focus,.fc .fc-button-group>.fc-button:hover{z-index:1}.fc-direction-ltr .fc-button-group>.fc-button:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0;margin-left:-1px}.fc-direction-ltr .fc-button-group>.fc-button:not(:last-child){border-bottom-right-radius:0;border-top-right-radius:0}.fc-direction-rtl .fc-button-group>.fc-button:not(:first-child){border-bottom-right-radius:0;border-top-right-radius:0;margin-right:-1px}.fc-direction-rtl .fc-button-group>.fc-button:not(:last-child){border-bottom-left-radius:0;border-top-left-radius:0}.fc .fc-toolbar{align-items:center;display:flex;justify-content:space-between}.fc .fc-toolbar.fc-header-toolbar{margin-bottom:1.5em}.fc .fc-toolbar.fc-footer-toolbar{margin-top:1.5em}.fc .fc-toolbar-title{font-size:1.75em;margin:0}.fc-direction-ltr .fc-toolbar>*>:not(:first-child){margin-left:.75em}.fc-direction-rtl .fc-toolbar>*>:not(:first-child){margin-right:.75em}.fc-direction-rtl .fc-toolbar-ltr{flex-direction:row-reverse}.fc .fc-scroller{-webkit-overflow-scrolling:touch;position:relative}.fc .fc-scroller-liquid{height:100%}.fc .fc-scroller-liquid-absolute{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-scroller-harness{direction:ltr;overflow:hidden;position:relative}.fc .fc-scroller-harness-liquid{height:100%}.fc-direction-rtl .fc-scroller-harness>.fc-scroller{direction:rtl}.fc-theme-standard .fc-scrollgrid{border:1px solid var(--fc-border-color)}.fc .fc-scrollgrid,.fc .fc-scrollgrid table{table-layout:fixed;width:100%}.fc .fc-scrollgrid table{border-left-style:hidden;border-right-style:hidden;border-top-style:hidden}.fc .fc-scrollgrid{border-bottom-width:0;border-collapse:separate;border-right-width:0}.fc .fc-scrollgrid-liquid{height:100%}.fc .fc-scrollgrid-section,.fc .fc-scrollgrid-section table,.fc .fc-scrollgrid-section>td{height:1px}.fc .fc-scrollgrid-section-liquid>td{height:100%}.fc .fc-scrollgrid-section>*{border-left-width:0;border-top-width:0}.fc .fc-scrollgrid-section-footer>*,.fc .fc-scrollgrid-section-header>*{border-bottom-width:0}.fc .fc-scrollgrid-section-body table,.fc .fc-scrollgrid-section-footer table{border-bottom-style:hidden}.fc .fc-scrollgrid-section-sticky>*{background:var(--fc-page-bg-color);position:sticky;z-index:3}.fc .fc-scrollgrid-section-header.fc-scrollgrid-section-sticky>*{top:0}.fc .fc-scrollgrid-section-footer.fc-scrollgrid-section-sticky>*{bottom:0}.fc .fc-scrollgrid-sticky-shim{height:1px;margin-bottom:-1px}.fc-sticky{position:sticky}.fc .fc-view-harness{flex-grow:1;position:relative}.fc .fc-view-harness-active>.fc-view{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-col-header-cell-cushion{display:inline-block;padding:2px 4px}.fc .fc-bg-event,.fc .fc-highlight,.fc .fc-non-business{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-non-business{background:var(--fc-non-business-color)}.fc .fc-bg-event{background:var(--fc-bg-event-color);opacity:var(--fc-bg-event-opacity)}.fc .fc-bg-event .fc-event-title{font-size:var(--fc-small-font-size);font-style:italic;margin:.5em}.fc .fc-highlight{background:var(--fc-highlight-color)}.fc .fc-cell-shaded,.fc .fc-day-disabled{background:var(--fc-neutral-bg-color)}a.fc-event,a.fc-event:hover{text-decoration:none}.fc-event.fc-event-draggable,.fc-event[href]{cursor:pointer}.fc-event .fc-event-main{position:relative;z-index:2}.fc-event-dragging:not(.fc-event-selected){opacity:.75}.fc-event-dragging.fc-event-selected{box-shadow:0 2px 7px rgba(0,0,0,.3)}.fc-event .fc-event-resizer{display:none;position:absolute;z-index:4}.fc-event-selected .fc-event-resizer,.fc-event:hover .fc-event-resizer{display:block}.fc-event-selected .fc-event-resizer{background:var(--fc-page-bg-color);border-color:inherit;border-radius:calc(var(--fc-event-resizer-dot-total-width)/2);border-style:solid;border-width:var(--fc-event-resizer-dot-border-width);height:var(--fc-event-resizer-dot-total-width);width:var(--fc-event-resizer-dot-total-width)}.fc-event-selected .fc-event-resizer:before{bottom:-20px;content:"";left:-20px;position:absolute;right:-20px;top:-20px}.fc-event-selected,.fc-event:focus{box-shadow:0 2px 5px rgba(0,0,0,.2)}.fc-event-selected:before,.fc-event:focus:before{bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3}.fc-event-selected:after,.fc-event:focus:after{background:var(--fc-event-selected-overlay-color);bottom:-1px;content:"";left:-1px;position:absolute;right:-1px;top:-1px;z-index:1}.fc-h-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-h-event .fc-event-main{color:var(--fc-event-text-color)}.fc-h-event .fc-event-main-frame{display:flex}.fc-h-event .fc-event-time{max-width:100%;overflow:hidden}.fc-h-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-width:0}.fc-h-event .fc-event-title{display:inline-block;left:0;max-width:100%;overflow:hidden;right:0;vertical-align:top}.fc-h-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-start),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-end){border-bottom-left-radius:0;border-left-width:0;border-top-left-radius:0}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-end),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-start){border-bottom-right-radius:0;border-right-width:0;border-top-right-radius:0}.fc-h-event:not(.fc-event-selected) .fc-event-resizer{bottom:0;top:0;width:var(--fc-event-resizer-thickness)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end{cursor:w-resize;left:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start{cursor:e-resize;right:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-h-event.fc-event-selected .fc-event-resizer{margin-top:calc(var(--fc-event-resizer-dot-total-width)*-.5);top:50%}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-start,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-end{left:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-end,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-start{right:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc .fc-popover{box-shadow:0 2px 6px rgba(0,0,0,.15);position:absolute;z-index:9999}.fc .fc-popover-header{align-items:center;display:flex;flex-direction:row;justify-content:space-between;padding:3px 4px}.fc .fc-popover-title{margin:0 2px}.fc .fc-popover-close{cursor:pointer;font-size:1.1em;opacity:.65}.fc-theme-standard .fc-popover{background:var(--fc-page-bg-color);border:1px solid var(--fc-border-color)}.fc-theme-standard .fc-popover-header{background:var(--fc-neutral-bg-color)}';pr(AU);var jo=class{constructor(e){this.drainedOption=e,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}request(e){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),e==null?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),e))}pause(e=""){let{pauseDepths:t}=this;t[e]=(t[e]||0)+1,this.clearTimeout()}resume(e="",t){let{pauseDepths:n}=this;e in n&&(t?delete n[e]:(n[e]-=1,n[e]<=0&&delete n[e]),this.tryDrain())}isPaused(){return Object.keys(this.pauseDepths).length}tryDrain(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}}clear(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)}drained(){this.drainedOption&&this.drainedOption()}};function of(i){i.parentNode&&i.parentNode.removeChild(i)}function Ve(i,e){if(i.closest)return i.closest(e);if(!document.documentElement.contains(i))return null;do{if(uS(i,e))return i;i=i.parentElement||i.parentNode}while(i!==null&&i.nodeType===1);return null}function uS(i,e){return(i.matches||i.matchesSelector||i.msMatchesSelector).call(i,e)}function PI(i,e){let t=i instanceof HTMLElement?[i]:i,n=[];for(let s=0;s<t.length;s+=1){let r=t[s].querySelectorAll(e);for(let o=0;o<r.length;o+=1)n.push(r[o])}return n}var wU=/(top|left|right|bottom|width|height)$/i;function da(i,e){for(let t in e)hS(i,t,e[t])}function hS(i,e,t){t==null?i.style[e]="":typeof t=="number"&&wU.test(e)?i.style[e]=`${t}px`:i.style[e]=t}function uv(i){var e,t;return(t=(e=i.composedPath)===null||e===void 0?void 0:e.call(i)[0])!==null&&t!==void 0?t:i.target}var gI=0;function vn(){return gI+=1,"fc-dom-"+gI}function af(i){i.preventDefault()}function SU(i,e){return t=>{let n=Ve(t.target,i);n&&e.call(n,t,n)}}function fS(i,e,t,n){let s=SU(t,n);return i.addEventListener(e,s),()=>{i.removeEventListener(e,s)}}function kI(i,e,t,n){let s;return fS(i,"mouseover",e,(r,o)=>{if(o!==s){s=o,t(r,o);let a=l=>{s=null,n(l,o),o.removeEventListener("mouseleave",a)};o.addEventListener("mouseleave",a)}})}var mI=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"];function pS(i,e){let t=n=>{e(n),mI.forEach(s=>{i.removeEventListener(s,t)})};mI.forEach(n=>{i.addEventListener(n,t)})}function NI(i){return Object.assign({onClick:i},FI(i))}function FI(i){return{tabIndex:0,onKeyDown(e){(e.key==="Enter"||e.key===" ")&&(i(e),e.preventDefault())}}}var yI=0;function ps(){return yI+=1,String(yI)}function lf(){document.body.classList.add("fc-not-allowed")}function cf(){document.body.classList.remove("fc-not-allowed")}function gS(i){i.style.userSelect="none",i.style.webkitUserSelect="none",i.addEventListener("selectstart",af)}function mS(i){i.style.userSelect="",i.style.webkitUserSelect="",i.removeEventListener("selectstart",af)}function yS(i){i.addEventListener("contextmenu",af)}function vS(i){i.removeEventListener("contextmenu",af)}function LI(i){let e=[],t=[],n,s;for(typeof i=="string"?t=i.split(/\s*,\s*/):typeof i=="function"?t=[i]:Array.isArray(i)&&(t=i),n=0;n<t.length;n+=1)s=t[n],typeof s=="string"?e.push(s.charAt(0)==="-"?{field:s.substring(1),order:-1}:{field:s,order:1}):typeof s=="function"&&e.push({func:s});return e}function OI(i,e,t){let n,s;for(n=0;n<t.length;n+=1)if(s=_U(i,e,t[n]),s)return s;return 0}function _U(i,e,t){return t.func?t.func(i,e):UI(i[t.field],e[t.field])*(t.order||1)}function UI(i,e){return!i&&!e?0:e==null?-1:i==null?1:typeof i=="string"||typeof e=="string"?String(i).localeCompare(String(e)):i-e}function Qo(i,e){let t=String(i);return"000".substr(0,e-t.length)+t}function wc(i,e,t){return typeof i=="function"?i(...e):typeof i=="string"?e.reduce((n,s,r)=>n.replace("$"+r,s||""),i):t}function ES(i,e){return i-e}function $h(i){return i%1===0}function CU(i){let e=i.querySelector(".fc-scrollgrid-shrink-frame"),t=i.querySelector(".fc-scrollgrid-shrink-cushion");if(!e)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!t)throw new Error("needs fc-scrollgrid-shrink-cushion className");return i.getBoundingClientRect().width-e.getBoundingClientRect().width+t.getBoundingClientRect().width}var vI=["years","months","days","milliseconds"],TU=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function ee(i,e){return typeof i=="string"?xU(i):typeof i=="object"&&i?EI(i):typeof i=="number"?EI({[e||"milliseconds"]:i}):null}function xU(i){let e=TU.exec(i);if(e){let t=e[1]?-1:1;return{years:0,months:0,days:t*(e[2]?parseInt(e[2],10):0),milliseconds:t*((e[3]?parseInt(e[3],10):0)*60*60*1e3+(e[4]?parseInt(e[4],10):0)*60*1e3+(e[5]?parseInt(e[5],10):0)*1e3+(e[6]?parseInt(e[6],10):0))}}return null}function EI(i){let e={years:i.years||i.year||0,months:i.months||i.month||0,days:i.days||i.day||0,milliseconds:(i.hours||i.hour||0)*60*60*1e3+(i.minutes||i.minute||0)*60*1e3+(i.seconds||i.second||0)*1e3+(i.milliseconds||i.millisecond||i.ms||0)},t=i.weeks||i.week;return t&&(e.days+=t*7,e.specifiedWeeks=!0),e}function RU(i,e){return i.years===e.years&&i.months===e.months&&i.days===e.days&&i.milliseconds===e.milliseconds}function df(i,e){return{years:i.years+e.years,months:i.months+e.months,days:i.days+e.days,milliseconds:i.milliseconds+e.milliseconds}}function HI(i,e){return{years:i.years-e.years,months:i.months-e.months,days:i.days-e.days,milliseconds:i.milliseconds-e.milliseconds}}function bS(i,e){return{years:i.years*e,months:i.months*e,days:i.days*e,milliseconds:i.milliseconds*e}}function IU(i){return vc(i)/365}function DU(i){return vc(i)/30}function vc(i){return en(i)/864e5}function en(i){return i.years*(365*864e5)+i.months*(30*864e5)+i.days*864e5+i.milliseconds}function uf(i,e){let t=null;for(let n=0;n<vI.length;n+=1){let s=vI[n];if(e[s]){let r=i[s]/e[s];if(!$h(r)||t!==null&&t!==r)return null;t=r}else if(i[s])return null}return t}function zh(i){let e=i.milliseconds;if(e){if(e%1e3!==0)return{unit:"millisecond",value:e};if(e%(1e3*60)!==0)return{unit:"second",value:e/1e3};if(e%(1e3*60*60)!==0)return{unit:"minute",value:e/(1e3*60)};if(e)return{unit:"hour",value:e/(1e3*60*60)}}return i.days?i.specifiedWeeks&&i.days%7===0?{unit:"week",value:i.days/7}:{unit:"day",value:i.days}:i.months?{unit:"month",value:i.months}:i.years?{unit:"year",value:i.years}:{unit:"millisecond",value:0}}function bi(i,e,t){if(i===e)return!0;let n=i.length,s;if(n!==e.length)return!1;for(s=0;s<n;s+=1)if(!(t?t(i[s],e[s]):i[s]===e[s]))return!1;return!0}var MU=["sun","mon","tue","wed","thu","fri","sat"];function hv(i,e){let t=lr(i);return t[2]+=e*7,Nt(t)}function be(i,e){let t=lr(i);return t[2]+=e,Nt(t)}function yi(i,e){let t=lr(i);return t[6]+=e,Nt(t)}function AS(i,e){return Ai(i,e)/7}function Ai(i,e){return(e.valueOf()-i.valueOf())/(1e3*60*60*24)}function PU(i,e){return(e.valueOf()-i.valueOf())/(1e3*60*60)}function kU(i,e){return(e.valueOf()-i.valueOf())/(1e3*60)}function NU(i,e){return(e.valueOf()-i.valueOf())/1e3}function BI(i,e){let t=de(i),n=de(e);return{years:0,months:0,days:Math.round(Ai(t,n)),milliseconds:e.valueOf()-n.valueOf()-(i.valueOf()-t.valueOf())}}function VI(i,e){let t=Ec(i,e);return t!==null&&t%7===0?t/7:null}function Ec(i,e){return cr(i)===cr(e)?Math.round(Ai(i,e)):null}function de(i){return Nt([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()])}function FU(i){return Nt([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours()])}function LU(i){return Nt([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes()])}function OU(i){return Nt([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds()])}function UU(i,e,t){let n=i.getUTCFullYear(),s=Ww(i,n,e,t);if(s<1)return Ww(i,n-1,e,t);let r=Ww(i,n+1,e,t);return r>=1?Math.min(s,r):s}function Ww(i,e,t,n){let s=Nt([e,0,1+HU(e,t,n)]),r=de(i),o=Math.round(Ai(s,r));return Math.floor(o/7)+1}function HU(i,e,t){let n=7+e-t;return-((7+Nt([i,0,n]).getUTCDay()-e)%7)+n-1}function bI(i){return[i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()]}function AI(i){return new Date(i[0],i[1]||0,i[2]==null?1:i[2],i[3]||0,i[4]||0,i[5]||0)}function lr(i){return[i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds()]}function Nt(i){return i.length===1&&(i=i.concat([0])),new Date(Date.UTC(...i))}function wS(i){return!isNaN(i.valueOf())}function cr(i){return i.getUTCHours()*1e3*60*60+i.getUTCMinutes()*1e3*60+i.getUTCSeconds()*1e3+i.getUTCMilliseconds()}function fv(i,e,t=!1){let n=i.toISOString();return n=n.replace(".000",""),t&&(n=n.replace("T00:00:00Z","")),n.length>10&&(e==null?n=n.replace("Z",""):e!==0&&(n=n.replace("Z",CS(e,!0)))),n}function gr(i){return i.toISOString().replace(/T.*$/,"")}function SS(i){return i.toISOString().match(/^\d{4}-\d{2}/)[0]}function _S(i){return Qo(i.getUTCHours(),2)+":"+Qo(i.getUTCMinutes(),2)+":"+Qo(i.getUTCSeconds(),2)}function CS(i,e=!1){let t=i<0?"-":"+",n=Math.abs(i),s=Math.floor(n/60),r=Math.round(n%60);return e?`${t+Qo(s,2)}:${Qo(r,2)}`:`GMT${t}${s}${r?`:${Qo(r,2)}`:""}`}function $(i,e,t){let n,s;return function(...r){if(!n)s=i.apply(this,r);else if(!bi(n,r)){t&&t(s);let o=i.apply(this,r);(!e||!e(o,s))&&(s=o)}return n=r,s}}function Sc(i,e,t){let n,s;return r=>{if(!n)s=i.call(this,r);else if(!Ft(n,r)){t&&t(s);let o=i.call(this,r);(!e||!e(o,s))&&(s=o)}return n=r,s}}var Yw={week:3,separator:9,omitZeroMinute:9,meridiem:9,omitCommas:9},tv={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},Ky=/\s*([ap])\.?m\.?/i,BU=/,/g,VU=/\s+/g,GU=/\u200e/g,$U=/UTC|GMT/,nS=class{constructor(e){let t={},n={},s=9;for(let r in e)r in Yw?(n[r]=e[r],Yw[r]<9&&(s=Math.min(Yw[r],s))):(t[r]=e[r],r in tv&&(s=Math.min(tv[r],s)));this.standardDateProps=t,this.extendedSettings=n,this.smallestUnitNum=s,this.buildFormattingFunc=$(wI)}format(e,t){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,t)(e)}formatRange(e,t,n,s){let{standardDateProps:r,extendedSettings:o}=this,a=XU(e.marker,t.marker,n.calendarSystem);if(!a)return this.format(e,n);let l=a;l>1&&(r.year==="numeric"||r.year==="2-digit")&&(r.month==="numeric"||r.month==="2-digit")&&(r.day==="numeric"||r.day==="2-digit")&&(l=1);let c=this.format(e,n),d=this.format(t,n);if(c===d)return c;let h=JU(r,l),p=wI(h,o,n),m=p(e),y=p(t),v=ZU(c,m,d,y),b=o.separator||s||n.defaultSeparator||"";return v?v.before+m+b+y+v.after:c+b+d}getSmallestUnit(){switch(this.smallestUnitNum){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}}};function wI(i,e,t){let n=Object.keys(i).length;return n===1&&i.timeZoneName==="short"?s=>CS(s.timeZoneOffset):n===0&&e.week?s=>KU(t.computeWeekNumber(s.marker),t.weekText,t.weekTextLong,t.locale,e.week):zU(i,e,t)}function zU(i,e,t){i=Object.assign({},i),e=Object.assign({},e),qU(i,e),i.timeZone="UTC";let n=new Intl.DateTimeFormat(t.locale.codes,i),s;if(e.omitZeroMinute){let r=Object.assign({},i);delete r.minute,s=new Intl.DateTimeFormat(t.locale.codes,r)}return r=>{let{marker:o}=r,a;s&&!o.getUTCMinutes()?a=s:a=n;let l=a.format(o);return WU(l,r,i,e,t)}}function qU(i,e){i.timeZoneName&&(i.hour||(i.hour="2-digit"),i.minute||(i.minute="2-digit")),i.timeZoneName==="long"&&(i.timeZoneName="short"),e.omitZeroMinute&&(i.second||i.millisecond)&&delete e.omitZeroMinute}function WU(i,e,t,n,s){return i=i.replace(GU,""),t.timeZoneName==="short"&&(i=YU(i,s.timeZone==="UTC"||e.timeZoneOffset==null?"UTC":CS(e.timeZoneOffset))),n.omitCommas&&(i=i.replace(BU,"").trim()),n.omitZeroMinute&&(i=i.replace(":00","")),n.meridiem===!1?i=i.replace(Ky,"").trim():n.meridiem==="narrow"?i=i.replace(Ky,(r,o)=>o.toLocaleLowerCase()):n.meridiem==="short"?i=i.replace(Ky,(r,o)=>`${o.toLocaleLowerCase()}m`):n.meridiem==="lowercase"&&(i=i.replace(Ky,r=>r.toLocaleLowerCase())),i=i.replace(VU," "),i=i.trim(),i}function YU(i,e){let t=!1;return i=i.replace($U,()=>(t=!0,e)),t||(i+=` ${e}`),i}function KU(i,e,t,n,s){let r=[];return s==="long"?r.push(t):(s==="short"||s==="narrow")&&r.push(e),(s==="long"||s==="short")&&r.push(" "),r.push(n.simpleNumberFormat.format(i)),n.options.direction==="rtl"&&r.reverse(),r.join("")}function XU(i,e,t){return t.getMarkerYear(i)!==t.getMarkerYear(e)?5:t.getMarkerMonth(i)!==t.getMarkerMonth(e)?4:t.getMarkerDay(i)!==t.getMarkerDay(e)?2:cr(i)!==cr(e)?1:0}function JU(i,e){let t={};for(let n in i)(!(n in tv)||tv[n]<=e)&&(t[n]=i[n]);return t}function ZU(i,e,t,n){let s=0;for(;s<i.length;){let r=i.indexOf(e,s);if(r===-1)break;let o=i.substr(0,r);s=r+e.length;let a=i.substr(s),l=0;for(;l<t.length;){let c=t.indexOf(n,l);if(c===-1)break;let d=t.substr(0,c);l=c+n.length;let h=t.substr(l);if(o===d&&a===h)return{before:o,after:a}}}return null}function SI(i,e){let t=e.markerToArray(i.marker);return{marker:i.marker,timeZoneOffset:i.timeZoneOffset,array:t,year:t[0],month:t[1],day:t[2],hour:t[3],minute:t[4],second:t[5],millisecond:t[6]}}function nv(i,e,t,n){let s=SI(i,t.calendarSystem),r=e?SI(e,t.calendarSystem):null;return{date:s,start:s,end:r,timeZone:t.timeZone,localeCodes:t.locale.codes,defaultSeparator:n||t.defaultSeparator}}var iS=class{constructor(e){this.cmdStr=e}format(e,t,n){return t.cmdFormatter(this.cmdStr,nv(e,null,t,n))}formatRange(e,t,n,s){return n.cmdFormatter(this.cmdStr,nv(e,t,n,s))}},sS=class{constructor(e){this.func=e}format(e,t,n){return this.func(nv(e,null,t,n))}formatRange(e,t,n,s){return this.func(nv(e,t,n,s))}};function ue(i){return typeof i=="object"&&i?new nS(i):typeof i=="string"?new iS(i):typeof i=="function"?new sS(i):null}var TS={navLinkDayClick:M,navLinkWeekClick:M,duration:ee,bootstrapFontAwesome:M,buttonIcons:M,customButtons:M,defaultAllDayEventDuration:ee,defaultTimedEventDuration:ee,nextDayThreshold:ee,scrollTime:ee,scrollTimeReset:Boolean,slotMinTime:ee,slotMaxTime:ee,dayPopoverFormat:ue,slotDuration:ee,snapDuration:ee,headerToolbar:M,footerToolbar:M,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:ue,dayHeaderClassNames:M,dayHeaderContent:M,dayHeaderDidMount:M,dayHeaderWillUnmount:M,dayCellClassNames:M,dayCellContent:M,dayCellDidMount:M,dayCellWillUnmount:M,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:M,weekNumbers:Boolean,weekNumberClassNames:M,weekNumberContent:M,weekNumberDidMount:M,weekNumberWillUnmount:M,editable:Boolean,viewClassNames:M,viewDidMount:M,viewWillUnmount:M,nowIndicator:Boolean,nowIndicatorSnap:M,nowIndicatorClassNames:M,nowIndicatorContent:M,nowIndicatorDidMount:M,nowIndicatorWillUnmount:M,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:M,locale:M,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:M,eventOrder:LI,eventOrderStrict:Boolean,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:M,contentHeight:M,direction:String,weekNumberFormat:ue,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,weekTextLong:String,progressiveEventRendering:Boolean,businessHours:M,initialDate:M,now:M,eventDataTransform:M,stickyHeaderDates:M,stickyFooterScrollbar:M,viewHeight:M,defaultAllDay:Boolean,eventSourceFailure:M,eventSourceSuccess:M,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:M,eventConstraint:M,eventAllow:M,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:M,eventContent:M,eventDidMount:M,eventWillUnmount:M,selectConstraint:M,selectOverlap:M,selectAllow:M,droppable:Boolean,unselectCancel:String,slotLabelFormat:M,slotLaneClassNames:M,slotLaneContent:M,slotLaneDidMount:M,slotLaneWillUnmount:M,slotLabelClassNames:M,slotLabelContent:M,slotLabelDidMount:M,slotLabelWillUnmount:M,dayMaxEvents:M,dayMaxEventRows:M,dayMinWidth:Number,slotLabelInterval:ee,allDayText:String,allDayClassNames:M,allDayContent:M,allDayDidMount:M,allDayWillUnmount:M,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:ue,rerenderDelay:Number,moreLinkText:M,moreLinkHint:M,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMaxStack:Number,eventMinHeight:Number,eventMinWidth:Number,eventShortHeight:Number,slotEventOverlap:Boolean,plugins:M,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:ee,hiddenDays:M,fixedWeekCount:Boolean,validRange:M,visibleRange:M,titleFormat:M,eventInteractive:Boolean,noEventsText:String,viewHint:M,navLinkHint:M,closeHint:String,timeHint:String,eventHint:String,moreLinkClick:M,moreLinkClassNames:M,moreLinkContent:M,moreLinkDidMount:M,moreLinkWillUnmount:M,monthStartFormat:ue,handleCustomRendering:M,customRenderingMetaMap:M,customRenderingReplaces:Boolean},mr={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:" \u2013 ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",scrollTimeReset:!0,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1,eventMinHeight:15,eventMinWidth:30,eventShortHeight:30,monthStartFormat:{month:"long",day:"numeric"},nowIndicatorSnap:"auto"},xS={datesSet:M,eventsSet:M,eventAdd:M,eventChange:M,eventRemove:M,windowResize:M,eventClick:M,eventMouseEnter:M,eventMouseLeave:M,select:M,unselect:M,loading:M,_unmount:M,_beforeprint:M,_afterprint:M,_noEventDrop:M,_noEventResize:M,_resize:M,_scrollRequest:M},RS={buttonText:M,buttonHints:M,views:M,plugins:M,initialEvents:M,events:M,eventSources:M},yr={headerToolbar:Zo,footerToolbar:Zo,buttonText:Zo,buttonHints:Zo,buttonIcons:Zo,dateIncrement:Zo,plugins:Xy,events:Xy,eventSources:Xy,resources:Xy};function Zo(i,e){return typeof i=="object"&&typeof e=="object"&&i&&e?Ft(i,e):i===e}function Xy(i,e){return Array.isArray(i)&&Array.isArray(e)?bi(i,e):i===e}var GI={type:String,component:M,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:M,usesMinMaxTime:Boolean,classNames:M,content:M,didMount:M,willUnmount:M};function pv(i){return mv(i,yr)}function gv(i,e){let t={},n={};for(let s in e)s in i&&(t[s]=e[s](i[s]));for(let s in i)s in e||(n[s]=i[s]);return{refined:t,extra:n}}function M(i){return i}var{hasOwnProperty:iv}=Object.prototype;function mv(i,e){let t={};if(e){for(let n in e)if(e[n]===Zo){let s=[];for(let r=i.length-1;r>=0;r-=1){let o=i[r][n];if(typeof o=="object"&&o)s.unshift(o);else if(o!==void 0){t[n]=o;break}}s.length&&(t[n]=mv(s))}}for(let n=i.length-1;n>=0;n-=1){let s=i[n];for(let r in s)r in t||(t[r]=s[r])}return t}function ds(i,e){let t={};for(let n in i)e(i[n],n)&&(t[n]=i[n]);return t}function yn(i,e){let t={};for(let n in i)t[n]=e(i[n],n);return t}function IS(i){let e={};for(let t of i)e[t]=!0;return e}function yv(i){let e=[];for(let t in i)e.push(i[t]);return e}function Ft(i,e){if(i===e)return!0;for(let t in i)if(iv.call(i,t)&&!(t in e))return!1;for(let t in e)if(iv.call(e,t)&&i[t]!==e[t])return!1;return!0}var QU=/^on[A-Z]/;function jU(i,e){let t=eH(i,e);for(let n of t)if(!QU.test(n))return!1;return!0}function eH(i,e){let t=[];for(let n in i)iv.call(i,n)&&(n in e||t.push(n));for(let n in e)iv.call(e,n)&&i[n]!==e[n]&&t.push(n);return t}function jy(i,e,t={}){if(i===e)return!0;for(let n in e)if(!(n in i&&tH(i[n],e[n],t[n])))return!1;for(let n in i)if(!(n in e))return!1;return!0}function tH(i,e,t){return i===e||t===!0?!0:t?t(i,e):!1}function $I(i,e=0,t,n=1){let s=[];t==null&&(t=Object.keys(i).length);for(let r=e;r<t;r+=n){let o=i[r];o!==void 0&&s.push(o)}return s}var zI={};function nH(i,e){zI[i]=e}function iH(i){return new zI[i]}var rS=class{getMarkerYear(e){return e.getUTCFullYear()}getMarkerMonth(e){return e.getUTCMonth()}getMarkerDay(e){return e.getUTCDate()}arrayToMarker(e){return Nt(e)}markerToArray(e){return lr(e)}};nH("gregory",rS);var sH=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;function qI(i){let e=sH.exec(i);if(e){let t=new Date(Date.UTC(Number(e[1]),e[3]?Number(e[3])-1:0,Number(e[5]||1),Number(e[7]||0),Number(e[8]||0),Number(e[10]||0),e[12]?+`0.${e[12]}`*1e3:0));if(wS(t)){let n=null;return e[13]&&(n=(e[15]==="-"?-1:1)*(Number(e[16]||0)*60+Number(e[18]||0))),{marker:t,isTimeUnspecified:!e[6],timeZoneOffset:n}}}return null}var qh=class{constructor(e){let t=this.timeZone=e.timeZone,n=t!=="local"&&t!=="UTC";e.namedTimeZoneImpl&&n&&(this.namedTimeZoneImpl=new e.namedTimeZoneImpl(t)),this.canComputeOffset=!!(!n||this.namedTimeZoneImpl),this.calendarSystem=iH(e.calendarSystem),this.locale=e.locale,this.weekDow=e.locale.week.dow,this.weekDoy=e.locale.week.doy,e.weekNumberCalculation==="ISO"&&(this.weekDow=1,this.weekDoy=4),typeof e.firstDay=="number"&&(this.weekDow=e.firstDay),typeof e.weekNumberCalculation=="function"&&(this.weekNumberFunc=e.weekNumberCalculation),this.weekText=e.weekText!=null?e.weekText:e.locale.options.weekText,this.weekTextLong=(e.weekTextLong!=null?e.weekTextLong:e.locale.options.weekTextLong)||this.weekText,this.cmdFormatter=e.cmdFormatter,this.defaultSeparator=e.defaultSeparator}createMarker(e){let t=this.createMarkerMeta(e);return t===null?null:t.marker}createNowMarker(){return this.canComputeOffset?this.timestampToMarker(new Date().valueOf()):Nt(bI(new Date))}createMarkerMeta(e){if(typeof e=="string")return this.parse(e);let t=null;return typeof e=="number"?t=this.timestampToMarker(e):e instanceof Date?(e=e.valueOf(),isNaN(e)||(t=this.timestampToMarker(e))):Array.isArray(e)&&(t=Nt(e)),t===null||!wS(t)?null:{marker:t,isTimeUnspecified:!1,forcedTzo:null}}parse(e){let t=qI(e);if(t===null)return null;let{marker:n}=t,s=null;return t.timeZoneOffset!==null&&(this.canComputeOffset?n=this.timestampToMarker(n.valueOf()-t.timeZoneOffset*60*1e3):s=t.timeZoneOffset),{marker:n,isTimeUnspecified:t.isTimeUnspecified,forcedTzo:s}}getYear(e){return this.calendarSystem.getMarkerYear(e)}getMonth(e){return this.calendarSystem.getMarkerMonth(e)}getDay(e){return this.calendarSystem.getMarkerDay(e)}add(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]+=t.years,n[1]+=t.months,n[2]+=t.days,n[6]+=t.milliseconds,this.calendarSystem.arrayToMarker(n)}subtract(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]-=t.years,n[1]-=t.months,n[2]-=t.days,n[6]-=t.milliseconds,this.calendarSystem.arrayToMarker(n)}addYears(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]+=t,this.calendarSystem.arrayToMarker(n)}addMonths(e,t){let n=this.calendarSystem.markerToArray(e);return n[1]+=t,this.calendarSystem.arrayToMarker(n)}diffWholeYears(e,t){let{calendarSystem:n}=this;return cr(e)===cr(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)&&n.getMarkerMonth(e)===n.getMarkerMonth(t)?n.getMarkerYear(t)-n.getMarkerYear(e):null}diffWholeMonths(e,t){let{calendarSystem:n}=this;return cr(e)===cr(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)?n.getMarkerMonth(t)-n.getMarkerMonth(e)+(n.getMarkerYear(t)-n.getMarkerYear(e))*12:null}greatestWholeUnit(e,t){let n=this.diffWholeYears(e,t);return n!==null?{unit:"year",value:n}:(n=this.diffWholeMonths(e,t),n!==null?{unit:"month",value:n}:(n=VI(e,t),n!==null?{unit:"week",value:n}:(n=Ec(e,t),n!==null?{unit:"day",value:n}:(n=PU(e,t),$h(n)?{unit:"hour",value:n}:(n=kU(e,t),$h(n)?{unit:"minute",value:n}:(n=NU(e,t),$h(n)?{unit:"second",value:n}:{unit:"millisecond",value:t.valueOf()-e.valueOf()}))))))}countDurationsBetween(e,t,n){let s;return n.years&&(s=this.diffWholeYears(e,t),s!==null)?s/IU(n):n.months&&(s=this.diffWholeMonths(e,t),s!==null)?s/DU(n):n.days&&(s=Ec(e,t),s!==null)?s/vc(n):(t.valueOf()-e.valueOf())/en(n)}startOf(e,t){return t==="year"?this.startOfYear(e):t==="month"?this.startOfMonth(e):t==="week"?this.startOfWeek(e):t==="day"?de(e):t==="hour"?FU(e):t==="minute"?LU(e):t==="second"?OU(e):null}startOfYear(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e)])}startOfMonth(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e)])}startOfWeek(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e),e.getUTCDate()-(e.getUTCDay()-this.weekDow+7)%7])}computeWeekNumber(e){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(e)):UU(e,this.weekDow,this.weekDoy)}format(e,t,n={}){return t.format({marker:e,timeZoneOffset:n.forcedTzo!=null?n.forcedTzo:this.offsetForMarker(e)},this)}formatRange(e,t,n,s={}){return s.isEndExclusive&&(t=yi(t,-1)),n.formatRange({marker:e,timeZoneOffset:s.forcedStartTzo!=null?s.forcedStartTzo:this.offsetForMarker(e)},{marker:t,timeZoneOffset:s.forcedEndTzo!=null?s.forcedEndTzo:this.offsetForMarker(t)},this,s.defaultSeparator)}formatIso(e,t={}){let n=null;return t.omitTimeZoneOffset||(t.forcedTzo!=null?n=t.forcedTzo:n=this.offsetForMarker(e)),fv(e,n,t.omitTime)}timestampToMarker(e){return this.timeZone==="local"?Nt(bI(new Date(e))):this.timeZone==="UTC"||!this.namedTimeZoneImpl?new Date(e):Nt(this.namedTimeZoneImpl.timestampToArray(e))}offsetForMarker(e){return this.timeZone==="local"?-AI(lr(e)).getTimezoneOffset():this.timeZone==="UTC"?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(lr(e)):null}toDate(e,t){return this.timeZone==="local"?AI(lr(e)):this.timeZone==="UTC"?new Date(e.valueOf()):this.namedTimeZoneImpl?new Date(e.valueOf()-this.namedTimeZoneImpl.offsetForArray(lr(e))*1e3*60):new Date(e.valueOf()-(t||0))}},us=class{constructor(e){this.iconOverrideOption&&this.setIconOverride(e[this.iconOverrideOption])}setIconOverride(e){let t,n;if(typeof e=="object"&&e){t=Object.assign({},this.iconClasses);for(n in e)t[n]=this.applyIconOverridePrefix(e[n]);this.iconClasses=t}else e===!1&&(this.iconClasses={})}applyIconOverridePrefix(e){let t=this.iconOverridePrefix;return t&&e.indexOf(t)!==0&&(e=t+e),e}getClass(e){return this.classes[e]||""}getIconClass(e,t){let n;return t&&this.rtlIconClasses?n=this.rtlIconClasses[e]||this.iconClasses[e]:n=this.iconClasses[e],n?`${this.baseIconClass} ${n}`:""}getCustomButtonIconClass(e){let t;return this.iconOverrideCustomButtonOption&&(t=e[this.iconOverrideCustomButtonOption],t)?`${this.baseIconClass} ${this.applyIconOverridePrefix(t)}`:""}};us.prototype.classes={};us.prototype.iconClasses={};us.prototype.baseIconClass="";us.prototype.iconOverridePrefix="";function Wh(i){i();let e=z.debounceRendering,t=[];function n(s){t.push(s)}for(z.debounceRendering=n,or(x(oS,{}),document.createElement("div"));t.length;)t.shift()();z.debounceRendering=e}var oS=class extends it{render(){return x("div",{})}componentDidMount(){this.setState({})}};function WI(i){let e=qy(i),t=e.Provider;return e.Provider=function(){let n=!this.getChildContext,s=t.apply(this,arguments);if(n){let r=[];this.shouldComponentUpdate=o=>{this.props.value!==o.value&&r.forEach(a=>{a.context=o.value,a.forceUpdate()})},this.sub=o=>{r.push(o);let a=o.componentWillUnmount;o.componentWillUnmount=()=>{r.splice(r.indexOf(o),1),a&&a.call(o)}}}return s},e}var sv=class{constructor(e,t,n,s){this.execFunc=e,this.emitter=t,this.scrollTime=n,this.scrollTimeReset=s,this.handleScrollRequest=r=>{this.queuedRequest=Object.assign({},this.queuedRequest||{},r),this.drain()},t.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}detach(){this.emitter.off("_scrollRequest",this.handleScrollRequest)}update(e){e&&this.scrollTimeReset?this.fireInitialScroll():this.drain()}fireInitialScroll(){this.handleScrollRequest({time:this.scrollTime})}drain(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)}},En=WI({});function YI(i,e,t,n,s,r,o,a,l,c,d,h,p,m){return{dateEnv:s,nowManager:r,options:t,pluginHooks:a,emitter:d,dispatch:l,getCurrentData:c,calendarApi:h,viewSpec:i,viewApi:e,dateProfileGenerator:n,theme:o,isRtl:t.direction==="rtl",addResizeHandler(y){d.on("_resize",y)},removeResizeHandler(y){d.off("_resize",y)},createScrollResponder(y){return new sv(y,d,ee(t.scrollTime),t.scrollTimeReset)},registerInteractiveComponent:p,unregisterInteractiveComponent:m}}var vi=class extends it{shouldComponentUpdate(e,t){return!jy(this.props,e,this.propEquality)||!jy(this.state,t,this.stateEquality)}safeSetState(e){jy(this.state,Object.assign(Object.assign({},this.state),e),this.stateEquality)||this.setState(e)}};vi.addPropsEquality=rH;vi.addStateEquality=oH;vi.contextType=En;vi.prototype.propEquality={};vi.prototype.stateEquality={};var te=class extends vi{};te.contextType=En;function rH(i){let e=Object.create(this.prototype.propEquality);Object.assign(e,i),this.prototype.propEquality=e}function oH(i){let e=Object.create(this.prototype.stateEquality);Object.assign(e,i),this.prototype.stateEquality=e}function nn(i,e){typeof i=="function"?i(e):i&&(i.current=e)}var Yh=class extends te{constructor(){super(...arguments),this.id=ps(),this.queuedDomNodes=[],this.currentDomNodes=[],this.handleEl=e=>{let{options:t}=this.context,{generatorName:n}=this.props;(!t.customRenderingReplaces||!aS(n,t))&&this.updateElRef(e)},this.updateElRef=e=>{this.props.elRef&&nn(this.props.elRef,e)}}render(){let{props:e,context:t}=this,{options:n}=t,{customGenerator:s,defaultGenerator:r,renderProps:o}=e,a=DS(e,[],this.handleEl),l=!1,c,d=[],h;if(s!=null){let p=typeof s=="function"?s(o,x):s;if(p===!0)l=!0;else{let m=p&&typeof p=="object";m&&"html"in p?a.dangerouslySetInnerHTML={__html:p.html}:m&&"domNodes"in p?d=Array.prototype.slice.call(p.domNodes):(m?Hw(p):typeof p!="function")?c=p:h=p}}else l=!aS(e.generatorName,n);return l&&r&&(c=r(o)),this.queuedDomNodes=d,this.currentGeneratorMeta=h,x(e.elTag,a,c)}componentDidMount(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentDidUpdate(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentWillUnmount(){this.triggerCustomRendering(!1)}triggerCustomRendering(e){var t;let{props:n,context:s}=this,{handleCustomRendering:r,customRenderingMetaMap:o}=s.options;if(r){let a=(t=this.currentGeneratorMeta)!==null&&t!==void 0?t:o==null?void 0:o[n.generatorName];a&&r(Object.assign(Object.assign({id:this.id,isActive:e,containerEl:this.base,reportNewContainerEl:this.updateElRef,generatorMeta:a},n),{elClasses:(n.elClasses||[]).filter(aH)}))}}applyQueueudDomNodes(){let{queuedDomNodes:e,currentDomNodes:t}=this,n=this.base;if(!bi(e,t)){t.forEach(of);for(let s of e)n.appendChild(s);this.currentDomNodes=e}}};Yh.addPropsEquality({elClasses:bi,elStyle:Ft,elAttrs:jU,renderProps:Ft});function aS(i,e){var t;return!!(e.handleCustomRendering&&i&&(!((t=e.customRenderingMetaMap)===null||t===void 0)&&t[i]))}function DS(i,e,t){let n=Object.assign(Object.assign({},i.elAttrs),{ref:t});return(i.elClasses||e)&&(n.className=(i.elClasses||[]).concat(e||[]).concat(n.className||[]).filter(Boolean).join(" ")),i.elStyle&&(n.style=i.elStyle),n}function aH(i){return!!i}var MS=WI(0),xe=class extends it{constructor(){super(...arguments),this.InnerContent=lH.bind(void 0,this),this.handleEl=e=>{this.el=e,this.props.elRef&&(nn(this.props.elRef,e),e&&this.didMountMisfire&&this.componentDidMount())}}render(){let{props:e}=this,t=cH(e.classNameGenerator,e.renderProps);if(e.children){let n=DS(e,t,this.handleEl),s=e.children(this.InnerContent,e.renderProps,n);return e.elTag?x(e.elTag,n,s):s}else return x(Yh,Object.assign(Object.assign({},e),{elRef:this.handleEl,elTag:e.elTag||"div",elClasses:(e.elClasses||[]).concat(t),renderId:this.context}))}componentDidMount(){var e,t;this.el?(t=(e=this.props).didMount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el})):this.didMountMisfire=!0}componentWillUnmount(){var e,t;(t=(e=this.props).willUnmount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el}))}};xe.contextType=MS;function lH(i,e){let t=i.props;return x(Yh,Object.assign({renderProps:t.renderProps,generatorName:t.generatorName,customGenerator:t.customGenerator,defaultGenerator:t.defaultGenerator,renderId:i.context},e))}function cH(i,e){let t=typeof i=="function"?i(e):i||[];return typeof t=="string"?[t]:t}var $n=class extends te{render(){let{props:e,context:t}=this,{options:n}=t,s={view:t.viewApi};return x(xe,{elRef:e.elRef,elTag:e.elTag||"div",elAttrs:e.elAttrs,elClasses:[...PS(e.viewSpec),...e.elClasses||[]],elStyle:e.elStyle,renderProps:s,classNameGenerator:n.viewClassNames,generatorName:void 0,didMount:n.viewDidMount,willUnmount:n.viewWillUnmount},()=>e.children)}};function PS(i){return[`fc-${i.type}-view`,"fc-view"]}function dH(i,e){let t=null,n=null;return i.start&&(t=e.createMarker(i.start)),i.end&&(n=e.createMarker(i.end)),!t&&!n||t&&n&&n<t?null:{start:t,end:n}}function _I(i,e){let t=[],{start:n}=e,s,r;for(i.sort(uH),s=0;s<i.length;s+=1)r=i[s],r.start>n&&t.push({start:n,end:r.start}),r.end>n&&(n=r.end);return n<e.end&&t.push({start:n,end:e.end}),t}function uH(i,e){return i.start.valueOf()-e.start.valueOf()}function tn(i,e){let{start:t,end:n}=i,s=null;return e.start!==null&&(t===null?t=e.start:t=new Date(Math.max(t.valueOf(),e.start.valueOf()))),e.end!=null&&(n===null?n=e.end:n=new Date(Math.min(n.valueOf(),e.end.valueOf()))),(t===null||n===null||t<n)&&(s={start:t,end:n}),s}function KI(i,e){return(i.start===null?null:i.start.valueOf())===(e.start===null?null:e.start.valueOf())&&(i.end===null?null:i.end.valueOf())===(e.end===null?null:e.end.valueOf())}function vv(i,e){return(i.end===null||e.start===null||i.end>e.start)&&(i.start===null||e.end===null||i.start<e.end)}function _c(i,e){return(i.start===null||e.start!==null&&e.start>=i.start)&&(i.end===null||e.end!==null&&e.end<=i.end)}function mn(i,e){return(i.start===null||e>=i.start)&&(i.end===null||e<i.end)}function hH(i,e){return e.start!=null&&i<e.start?e.start:e.end!=null&&i>=e.end?new Date(e.end.valueOf()-1):i}function XI(i){let e=Math.floor(Ai(i.start,i.end))||1,t=de(i.start),n=be(t,e);return{start:t,end:n}}function Ev(i,e=ee(0)){let t=null,n=null;if(i.end){n=de(i.end);let s=i.end.valueOf()-n.valueOf();s&&s>=en(e)&&(n=be(n,1))}return i.start&&(t=de(i.start),n&&n<=t&&(n=be(t,1))),{start:t,end:n}}function kS(i){let e=Ev(i);return Ai(e.start,e.end)>1}function dr(i,e,t,n){return n==="year"?ee(t.diffWholeYears(i,e),"year"):n==="month"?ee(t.diffWholeMonths(i,e),"month"):BI(i,e)}var ea=class{constructor(e){this.props=e,this.initHiddenDays()}buildPrev(e,t,n){let{dateEnv:s}=this.props,r=s.subtract(s.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(r,-1,n)}buildNext(e,t,n){let{dateEnv:s}=this.props,r=s.add(s.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(r,1,n)}build(e,t,n=!0){let{props:s}=this,r,o,a,l,c,d;return r=this.buildValidRange(),r=this.trimHiddenDays(r),n&&(e=hH(e,r)),o=this.buildCurrentRangeInfo(e,t),a=/^(year|month|week|day)$/.test(o.unit),l=this.buildRenderRange(this.trimHiddenDays(o.range),o.unit,a),l=this.trimHiddenDays(l),c=l,s.showNonCurrentDates||(c=tn(c,o.range)),c=this.adjustActiveRange(c),c=tn(c,r),d=vv(o.range,r),mn(l,e)||(e=l.start),{currentDate:e,validRange:r,currentRange:o.range,currentRangeUnit:o.unit,isRangeAllDay:a,activeRange:c,renderRange:l,slotMinTime:s.slotMinTime,slotMaxTime:s.slotMaxTime,isValid:d,dateIncrement:this.buildDateIncrement(o.duration)}}buildValidRange(){let e=this.props.validRangeInput,t=typeof e=="function"?e.call(this.props.calendarApi,this.props.dateEnv.toDate(this.props.nowManager.getDateMarker())):e;return this.refineRange(t)||{start:null,end:null}}buildCurrentRangeInfo(e,t){let{props:n}=this,s=null,r=null,o=null,a;return n.duration?(s=n.duration,r=n.durationUnit,o=this.buildRangeFromDuration(e,t,s,r)):(a=this.props.dayCount)?(r="day",o=this.buildRangeFromDayCount(e,t,a)):(o=this.buildCustomVisibleRange(e))?r=n.dateEnv.greatestWholeUnit(o.start,o.end).unit:(s=this.getFallbackDuration(),r=zh(s).unit,o=this.buildRangeFromDuration(e,t,s,r)),{duration:s,unit:r,range:o}}getFallbackDuration(){return ee({day:1})}adjustActiveRange(e){let{dateEnv:t,usesMinMaxTime:n,slotMinTime:s,slotMaxTime:r}=this.props,{start:o,end:a}=e;return n&&(vc(s)<0&&(o=de(o),o=t.add(o,s)),vc(r)>1&&(a=de(a),a=be(a,-1),a=t.add(a,r))),{start:o,end:a}}buildRangeFromDuration(e,t,n,s){let{dateEnv:r,dateAlignment:o}=this.props,a,l,c;if(!o){let{dateIncrement:h}=this.props;h&&en(h)<en(n)?o=zh(h).unit:o=s}vc(n)<=1&&this.isHiddenDay(a)&&(a=this.skipHiddenDays(a,t),a=de(a));function d(){a=r.startOf(e,o),l=r.add(a,n),c={start:a,end:l}}return d(),this.trimHiddenDays(c)||(e=this.skipHiddenDays(e,t),d()),c}buildRangeFromDayCount(e,t,n){let{dateEnv:s,dateAlignment:r}=this.props,o=0,a=e,l;r&&(a=s.startOf(a,r)),a=de(a),a=this.skipHiddenDays(a,t),l=a;do l=be(l,1),this.isHiddenDay(l)||(o+=1);while(o<n);return{start:a,end:l}}buildCustomVisibleRange(e){let{props:t}=this,n=t.visibleRangeInput,s=typeof n=="function"?n.call(t.calendarApi,t.dateEnv.toDate(e)):n,r=this.refineRange(s);return r&&(r.start==null||r.end==null)?null:r}buildRenderRange(e,t,n){return e}buildDateIncrement(e){let{dateIncrement:t}=this.props,n;return t||((n=this.props.dateAlignment)?ee(1,n):e||ee({days:1}))}refineRange(e){if(e){let t=dH(e,this.props.dateEnv);return t&&(t=Ev(t)),t}return null}initHiddenDays(){let e=this.props.hiddenDays||[],t=[],n=0,s;for(this.props.weekends===!1&&e.push(0,6),s=0;s<7;s+=1)(t[s]=e.indexOf(s)!==-1)||(n+=1);if(!n)throw new Error("invalid hiddenDays");this.isHiddenDayHash=t}trimHiddenDays(e){let{start:t,end:n}=e;return t&&(t=this.skipHiddenDays(t)),n&&(n=this.skipHiddenDays(n,-1,!0)),t==null||n==null||t<n?{start:t,end:n}:null}isHiddenDay(e){return e instanceof Date&&(e=e.getUTCDay()),this.isHiddenDayHash[e]}skipHiddenDays(e,t=1,n=!1){for(;this.isHiddenDayHash[(e.getUTCDay()+(n?t:0)+7)%7];)e=be(e,t);return e}};function hf(i,e,t,n){return{instanceId:ps(),defId:i,range:e,forcedStartTzo:t==null?null:t,forcedEndTzo:n==null?null:n}}function fH(i,e,t,n){for(let s=0;s<n.length;s+=1){let r=n[s].parse(i,t);if(r){let{allDay:o}=i;return o==null&&(o=e,o==null&&(o=r.allDayGuess,o==null&&(o=!1))),{allDay:o,duration:r.duration,typeData:r.typeData,typeId:s}}}return null}function ta(i,e,t){let{dateEnv:n,pluginHooks:s,options:r}=t,{defs:o,instances:a}=i;a=ds(a,l=>!o[l.defId].recurringDef);for(let l in o){let c=o[l];if(c.recurringDef){let{duration:d}=c.recurringDef;d||(d=c.allDay?r.defaultAllDayEventDuration:r.defaultTimedEventDuration);let h=pH(c,d,e,n,s.recurringTypes);for(let p of h){let m=hf(l,{start:p,end:n.add(p,d)});a[m.instanceId]=m}}}return{defs:o,instances:a}}function pH(i,e,t,n,s){let o=s[i.recurringDef.typeId].expand(i.recurringDef.typeData,{start:n.subtract(t.start,e),end:t.end},n);return i.allDay&&(o=o.map(de)),o}var ev={id:String,groupId:String,title:String,url:String,interactive:Boolean},JI={start:M,end:M,date:M,allDay:Boolean},gH=Object.assign(Object.assign(Object.assign({},ev),JI),{extendedProps:M});function ZI(i,e,t,n,s=NS(t),r,o){let{refined:a,extra:l}=bv(i,t,s),c=yH(e,t),d=fH(a,c,t.dateEnv,t.pluginHooks.recurringTypes);if(d){let p=Kh(a,l,e?e.sourceId:"",d.allDay,!!d.duration,t,r);return p.recurringDef={typeId:d.typeId,typeData:d.typeData,duration:d.duration},{def:p,instance:null}}let h=mH(a,c,t,n);if(h){let p=Kh(a,l,e?e.sourceId:"",h.allDay,h.hasEnd,t,r),m=hf(p.defId,h.range,h.forcedStartTzo,h.forcedEndTzo);return o&&p.publicId&&o[p.publicId]&&(m.instanceId=o[p.publicId]),{def:p,instance:m}}return null}function bv(i,e,t=NS(e)){return gv(i,t)}function NS(i){return Object.assign(Object.assign(Object.assign({},rv),gH),i.pluginHooks.eventRefiners)}function Kh(i,e,t,n,s,r,o){let a={title:i.title||"",groupId:i.groupId||"",publicId:i.id||"",url:i.url||"",recurringDef:null,defId:(o&&i.id?o[i.id]:"")||ps(),sourceId:t,allDay:n,hasEnd:s,interactive:i.interactive,ui:Cc(i,r),extendedProps:Object.assign(Object.assign({},i.extendedProps||{}),e)};for(let l of r.pluginHooks.eventDefMemberAdders)Object.assign(a,l(i));return Object.freeze(a.ui.classNames),Object.freeze(a.extendedProps),a}function mH(i,e,t,n){let{allDay:s}=i,r,o=null,a=!1,l,c=null,d=i.start!=null?i.start:i.date;if(r=t.dateEnv.createMarkerMeta(d),r)o=r.marker;else if(!n)return null;return i.end!=null&&(l=t.dateEnv.createMarkerMeta(i.end)),s==null&&(e!=null?s=e:s=(!r||r.isTimeUnspecified)&&(!l||l.isTimeUnspecified)),s&&o&&(o=de(o)),l&&(c=l.marker,s&&(c=de(c)),o&&c<=o&&(c=null)),c?a=!0:n||(a=t.options.forceEventDuration||!1,c=t.dateEnv.add(o,s?t.options.defaultAllDayEventDuration:t.options.defaultTimedEventDuration)),{allDay:s,hasEnd:a,range:{start:o,end:c},forcedStartTzo:r?r.forcedTzo:null,forcedEndTzo:l?l.forcedTzo:null}}function yH(i,e){let t=null;return i&&(t=i.defaultAllDay),t==null&&(t=e.options.defaultAllDay),t}function Xh(i,e,t,n,s,r){let o=yt(),a=NS(t);for(let l of i){let c=ZI(l,e,t,n,a,s,r);c&&Jh(c,o)}return o}function Jh(i,e=yt()){return e.defs[i.def.defId]=i.def,i.instance&&(e.instances[i.instance.instanceId]=i.instance),e}function ff(i,e){let t=i.instances[e];if(t){let n=i.defs[t.defId],s=wv(i,r=>vH(n,r));return s.defs[n.defId]=n,s.instances[t.instanceId]=t,s}return yt()}function vH(i,e){return!!(i.groupId&&i.groupId===e.groupId)}function yt(){return{defs:{},instances:{}}}function Av(i,e){return{defs:Object.assign(Object.assign({},i.defs),e.defs),instances:Object.assign(Object.assign({},i.instances),e.instances)}}function wv(i,e){let t=ds(i.defs,e),n=ds(i.instances,s=>t[s.defId]);return{defs:t,instances:n}}function EH(i,e){let{defs:t,instances:n}=i,s={},r={};for(let o in t)e.defs[o]||(s[o]=t[o]);for(let o in n)!e.instances[o]&&s[n[o].defId]&&(r[o]=n[o]);return{defs:s,instances:r}}function bH(i,e){return Array.isArray(i)?Xh(i,null,e,!0):typeof i=="object"&&i?Xh([i],null,e,!0):i!=null?String(i):null}function lS(i){return Array.isArray(i)?i:typeof i=="string"?i.split(/\s+/):[]}var rv={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:M,overlap:M,allow:M,className:lS,classNames:lS,color:String,backgroundColor:String,borderColor:String,textColor:String},AH={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]};function Cc(i,e){let t=bH(i.constraint,e);return{display:i.display||null,startEditable:i.startEditable!=null?i.startEditable:i.editable,durationEditable:i.durationEditable!=null?i.durationEditable:i.editable,constraints:t!=null?[t]:[],overlap:i.overlap!=null?i.overlap:null,allows:i.allow!=null?[i.allow]:[],backgroundColor:i.backgroundColor||i.color||"",borderColor:i.borderColor||i.color||"",textColor:i.textColor||"",classNames:(i.className||[]).concat(i.classNames||[])}}function FS(i){return i.reduce(wH,AH)}function wH(i,e){return{display:e.display!=null?e.display:i.display,startEditable:e.startEditable!=null?e.startEditable:i.startEditable,durationEditable:e.durationEditable!=null?e.durationEditable:i.durationEditable,constraints:i.constraints.concat(e.constraints),overlap:typeof e.overlap=="boolean"?e.overlap:i.overlap,allows:i.allows.concat(e.allows),backgroundColor:e.backgroundColor||i.backgroundColor,borderColor:e.borderColor||i.borderColor,textColor:e.textColor||i.textColor,classNames:i.classNames.concat(e.classNames)}}var SH={id:String,defaultAllDay:Boolean,url:String,format:String,events:M,eventDataTransform:M,success:M,failure:M};function LS(i,e,t=OS(e)){let n;if(typeof i=="string"?n={url:i}:typeof i=="function"||Array.isArray(i)?n={events:i}:typeof i=="object"&&i&&(n=i),n){let{refined:s,extra:r}=gv(n,t),o=_H(s,e);if(o)return{_raw:i,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:s.defaultAllDay,eventDataTransform:s.eventDataTransform,success:s.success,failure:s.failure,publicId:s.id||"",sourceId:ps(),sourceDefId:o.sourceDefId,meta:o.meta,ui:Cc(s,e),extendedProps:r}}return null}function OS(i){return Object.assign(Object.assign(Object.assign({},rv),SH),i.pluginHooks.eventSourceRefiners)}function _H(i,e){let t=e.pluginHooks.eventSourceDefs;for(let n=t.length-1;n>=0;n-=1){let r=t[n].parseMeta(i);if(r)return{sourceDefId:n,meta:r}}return null}function QI(i,e,t,n,s){switch(e.type){case"RECEIVE_EVENTS":return CH(i,t[e.sourceId],e.fetchId,e.fetchRange,e.rawEvents,s);case"RESET_RAW_EVENTS":return TH(i,t[e.sourceId],e.rawEvents,n.activeRange,s);case"ADD_EVENTS":return xH(i,e.eventStore,n?n.activeRange:null,s);case"RESET_EVENTS":return e.eventStore;case"MERGE_EVENTS":return Av(i,e.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return n?ta(i,n.activeRange,s):i;case"REMOVE_EVENTS":return EH(i,e.eventStore);case"REMOVE_EVENT_SOURCE":return eD(i,e.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return wv(i,r=>!r.sourceId);case"REMOVE_ALL_EVENTS":return yt();default:return i}}function CH(i,e,t,n,s,r){if(e&&t===e.latestFetchId){let o=Xh(jI(s,e,r),e,r);return n&&(o=ta(o,n,r)),Av(eD(i,e.sourceId),o)}return i}function TH(i,e,t,n,s){let{defIdMap:r,instanceIdMap:o}=IH(i),a=Xh(jI(t,e,s),e,s,!1,r,o);return ta(a,n,s)}function jI(i,e,t){let n=t.options.eventDataTransform,s=e?e.eventDataTransform:null;return s&&(i=CI(i,s)),n&&(i=CI(i,n)),i}function CI(i,e){let t;if(!e)t=i;else{t=[];for(let n of i){let s=e(n);s?t.push(s):s==null&&t.push(n)}}return t}function xH(i,e,t,n){return t&&(e=ta(e,t,n)),Av(i,e)}function US(i,e,t){let{defs:n}=i,s=yn(i.instances,r=>n[r.defId].allDay?r:Object.assign(Object.assign({},r),{range:{start:t.createMarker(e.toDate(r.range.start,r.forcedStartTzo)),end:t.createMarker(e.toDate(r.range.end,r.forcedEndTzo))},forcedStartTzo:t.canComputeOffset?null:r.forcedStartTzo,forcedEndTzo:t.canComputeOffset?null:r.forcedEndTzo}));return{defs:n,instances:s}}function eD(i,e){return wv(i,t=>t.sourceId!==e)}function RH(i,e){return{defs:i.defs,instances:ds(i.instances,t=>!e[t.instanceId])}}function IH(i){let{defs:e,instances:t}=i,n={},s={};for(let r in e){let o=e[r],{publicId:a}=o;a&&(n[a]=r)}for(let r in t){let o=t[r],a=e[o.defId],{publicId:l}=a;l&&(s[l]=r)}return{defIdMap:n,instanceIdMap:s}}var hs=class{constructor(){this.handlers={},this.thisContext=null}setThisContext(e){this.thisContext=e}setOptions(e){this.options=e}on(e,t){DH(this.handlers,e,t)}off(e,t){MH(this.handlers,e,t)}trigger(e,...t){let n=this.handlers[e]||[],s=this.options&&this.options[e],r=[].concat(s||[],n);for(let o of r)o.apply(this.thisContext,t)}hasHandlers(e){return!!(this.handlers[e]&&this.handlers[e].length||this.options&&this.options[e])}};function DH(i,e,t){(i[e]||(i[e]=[])).push(t)}function MH(i,e,t){t?i[e]&&(i[e]=i[e].filter(n=>n!==t)):delete i[e]}var PH={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"};function HS(i,e){return Xh(kH(i),null,e)}function kH(i){let e;return i===!0?e=[{}]:Array.isArray(i)?e=i.filter(t=>t.daysOfWeek):typeof i=="object"&&i?e=[i]:e=[],e=e.map(t=>Object.assign(Object.assign({},PH),t)),e}function Sv(i,e,t){t.emitter.trigger("select",Object.assign(Object.assign({},BS(i,t)),{jsEvent:e?e.origEvent:null,view:t.viewApi||t.calendarApi.view}))}function NH(i,e){e.emitter.trigger("unselect",{jsEvent:i?i.origEvent:null,view:e.viewApi||e.calendarApi.view})}function BS(i,e){let t={};for(let n of e.pluginHooks.dateSpanTransforms)Object.assign(t,n(i,e));return Object.assign(t,WH(i,e.dateEnv)),t}function ov(i,e,t){let{dateEnv:n,options:s}=t,r=e;return i?(r=de(r),r=n.add(r,s.defaultAllDayEventDuration)):r=n.add(r,s.defaultTimedEventDuration),r}function pf(i,e,t,n){let s=av(i.defs,e),r=yt();for(let o in i.defs){let a=i.defs[o];r.defs[o]=FH(a,s[o],t,n)}for(let o in i.instances){let a=i.instances[o],l=r.defs[a.defId];r.instances[o]=LH(a,l,s[a.defId],t,n)}return r}function FH(i,e,t,n){let s=t.standardProps||{};s.hasEnd==null&&e.durationEditable&&(t.startDelta||t.endDelta)&&(s.hasEnd=!0);let r=Object.assign(Object.assign(Object.assign({},i),s),{ui:Object.assign(Object.assign({},i.ui),s.ui)});t.extendedProps&&(r.extendedProps=Object.assign(Object.assign({},r.extendedProps),t.extendedProps));for(let o of n.pluginHooks.eventDefMutationAppliers)o(r,t,n);return!r.hasEnd&&n.options.forceEventDuration&&(r.hasEnd=!0),r}function LH(i,e,t,n,s){let{dateEnv:r}=s,o=n.standardProps&&n.standardProps.allDay===!0,a=n.standardProps&&n.standardProps.hasEnd===!1,l=Object.assign({},i);return o&&(l.range=XI(l.range)),n.datesDelta&&t.startEditable&&(l.range={start:r.add(l.range.start,n.datesDelta),end:r.add(l.range.end,n.datesDelta)}),n.startDelta&&t.durationEditable&&(l.range={start:r.add(l.range.start,n.startDelta),end:l.range.end}),n.endDelta&&t.durationEditable&&(l.range={start:l.range.start,end:r.add(l.range.end,n.endDelta)}),a&&(l.range={start:l.range.start,end:ov(e.allDay,l.range.start,s)}),e.allDay&&(l.range={start:de(l.range.start),end:de(l.range.end)}),l.range.end<l.range.start&&(l.range.end=ov(e.allDay,l.range.start,s)),l}var ar=class{constructor(e,t){this.context=e,this.internalEventSource=t}remove(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})}refetch(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId],isRefetch:!0})}get id(){return this.internalEventSource.publicId}get url(){return this.internalEventSource.meta.url}get format(){return this.internalEventSource.meta.format}},me=class i{constructor(e,t,n){this._context=e,this._def=t,this._instance=n||null}setProp(e,t){if(e in JI)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if(e==="id")t=ev[e](t),this.mutate({standardProps:{publicId:t}});else if(e in ev)t=ev[e](t),this.mutate({standardProps:{[e]:t}});else if(e in rv){let n=rv[e](t);e==="color"?n={backgroundColor:t,borderColor:t}:e==="editable"?n={startEditable:t,durationEditable:t}:n={[e]:t},this.mutate({standardProps:{ui:n}})}else console.warn(`Could not set prop '${e}'. Use setExtendedProp instead.`)}setExtendedProp(e,t){this.mutate({extendedProps:{[e]:t}})}setStart(e,t={}){let{dateEnv:n}=this._context,s=n.createMarker(e);if(s&&this._instance){let r=this._instance.range,o=dr(r.start,s,n,t.granularity);t.maintainDuration?this.mutate({datesDelta:o}):this.mutate({startDelta:o})}}setEnd(e,t={}){let{dateEnv:n}=this._context,s;if(!(e!=null&&(s=n.createMarker(e),!s))&&this._instance)if(s){let r=dr(this._instance.range.end,s,n,t.granularity);this.mutate({endDelta:r})}else this.mutate({standardProps:{hasEnd:!1}})}setDates(e,t,n={}){let{dateEnv:s}=this._context,r={allDay:n.allDay},o=s.createMarker(e),a;if(o&&!(t!=null&&(a=s.createMarker(t),!a))&&this._instance){let l=this._instance.range;n.allDay===!0&&(l=XI(l));let c=dr(l.start,o,s,n.granularity);if(a){let d=dr(l.end,a,s,n.granularity);RU(c,d)?this.mutate({datesDelta:c,standardProps:r}):this.mutate({startDelta:c,endDelta:d,standardProps:r})}else r.hasEnd=!1,this.mutate({datesDelta:c,standardProps:r})}}moveStart(e){let t=ee(e);t&&this.mutate({startDelta:t})}moveEnd(e){let t=ee(e);t&&this.mutate({endDelta:t})}moveDates(e){let t=ee(e);t&&this.mutate({datesDelta:t})}setAllDay(e,t={}){let n={allDay:e},{maintainDuration:s}=t;s==null&&(s=this._context.options.allDayMaintainDuration),this._def.allDay!==e&&(n.hasEnd=s),this.mutate({standardProps:n})}formatRange(e){let{dateEnv:t}=this._context,n=this._instance,s=ue(e);return this._def.hasEnd?t.formatRange(n.range.start,n.range.end,s,{forcedStartTzo:n.forcedStartTzo,forcedEndTzo:n.forcedEndTzo}):t.format(n.range.start,s,{forcedTzo:n.forcedStartTzo})}mutate(e){let t=this._instance;if(t){let n=this._def,s=this._context,{eventStore:r}=s.getCurrentData(),o=ff(r,t.instanceId);o=pf(o,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}},e,s);let l=new i(s,n,t);this._def=o.defs[n.defId],this._instance=o.instances[t.instanceId],s.dispatch({type:"MERGE_EVENTS",eventStore:o}),s.emitter.trigger("eventChange",{oldEvent:l,event:this,relatedEvents:wi(o,s,t),revert(){s.dispatch({type:"RESET_EVENTS",eventStore:r})}})}}remove(){let e=this._context,t=tD(this);e.dispatch({type:"REMOVE_EVENTS",eventStore:t}),e.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert(){e.dispatch({type:"MERGE_EVENTS",eventStore:t})}})}get source(){let{sourceId:e}=this._def;return e?new ar(this._context,this._context.getCurrentData().eventSources[e]):null}get start(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null}get end(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null}get startStr(){let e=this._instance;return e?this._context.dateEnv.formatIso(e.range.start,{omitTime:this._def.allDay,forcedTzo:e.forcedStartTzo}):""}get endStr(){let e=this._instance;return e&&this._def.hasEnd?this._context.dateEnv.formatIso(e.range.end,{omitTime:this._def.allDay,forcedTzo:e.forcedEndTzo}):""}get id(){return this._def.publicId}get groupId(){return this._def.groupId}get allDay(){return this._def.allDay}get title(){return this._def.title}get url(){return this._def.url}get display(){return this._def.ui.display||"auto"}get startEditable(){return this._def.ui.startEditable}get durationEditable(){return this._def.ui.durationEditable}get constraint(){return this._def.ui.constraints[0]||null}get overlap(){return this._def.ui.overlap}get allow(){return this._def.ui.allows[0]||null}get backgroundColor(){return this._def.ui.backgroundColor}get borderColor(){return this._def.ui.borderColor}get textColor(){return this._def.ui.textColor}get classNames(){return this._def.ui.classNames}get extendedProps(){return this._def.extendedProps}toPlainObject(e={}){let t=this._def,{ui:n}=t,{startStr:s,endStr:r}=this,o={allDay:t.allDay};return t.title&&(o.title=t.title),s&&(o.start=s),r&&(o.end=r),t.publicId&&(o.id=t.publicId),t.groupId&&(o.groupId=t.groupId),t.url&&(o.url=t.url),n.display&&n.display!=="auto"&&(o.display=n.display),e.collapseColor&&n.backgroundColor&&n.backgroundColor===n.borderColor?o.color=n.backgroundColor:(n.backgroundColor&&(o.backgroundColor=n.backgroundColor),n.borderColor&&(o.borderColor=n.borderColor)),n.textColor&&(o.textColor=n.textColor),n.classNames.length&&(o.classNames=n.classNames),Object.keys(t.extendedProps).length&&(e.collapseExtendedProps?Object.assign(o,t.extendedProps):o.extendedProps=t.extendedProps),o}toJSON(){return this.toPlainObject()}};function tD(i){let e=i._def,t=i._instance;return{defs:{[e.defId]:e},instances:t?{[t.instanceId]:t}:{}}}function wi(i,e,t){let{defs:n,instances:s}=i,r=[],o=t?t.instanceId:"";for(let a in s){let l=s[a],c=n[l.defId];l.instanceId!==o&&r.push(new me(e,c,l))}return r}function bc(i,e,t,n){let s={},r={},o={},a=[],l=[],c=av(i.defs,e);for(let d in i.defs){let h=i.defs[d];c[h.defId].display==="inverse-background"&&(h.groupId?(s[h.groupId]=[],o[h.groupId]||(o[h.groupId]=h)):r[d]=[])}for(let d in i.instances){let h=i.instances[d],p=i.defs[h.defId],m=c[p.defId],y=h.range,v=!p.allDay&&n?Ev(y,n):y,b=tn(v,t);b&&(m.display==="inverse-background"?p.groupId?s[p.groupId].push(b):r[h.defId].push(b):m.display!=="none"&&(m.display==="background"?a:l).push({def:p,ui:m,instance:h,range:b,isStart:v.start&&v.start.valueOf()===b.start.valueOf(),isEnd:v.end&&v.end.valueOf()===b.end.valueOf()}))}for(let d in s){let h=s[d],p=_I(h,t);for(let m of p){let y=o[d],v=c[y.defId];a.push({def:y,ui:v,instance:null,range:m,isStart:!1,isEnd:!1})}}for(let d in r){let h=r[d],p=_I(h,t);for(let m of p)a.push({def:i.defs[d],ui:c[d],instance:null,range:m,isStart:!1,isEnd:!1})}return{bg:a,fg:l}}function VS(i){return i.ui.display==="background"||i.ui.display==="inverse-background"}function TI(i,e){i.fcSeg=e}function gs(i){return i.fcSeg||i.parentNode.fcSeg||null}function av(i,e){return yn(i,t=>nD(t,e))}function nD(i,e){let t=[];return e[""]&&t.push(e[""]),e[i.defId]&&t.push(e[i.defId]),t.push(i.ui),FS(t)}function ua(i,e){let t=i.map(OH);return t.sort((n,s)=>OI(n,s,e)),t.map(n=>n._seg)}function OH(i){let{eventRange:e}=i,t=e.def,n=e.instance?e.instance.range:e.range,s=n.start?n.start.valueOf():0,r=n.end?n.end.valueOf():0;return Object.assign(Object.assign(Object.assign({},t.extendedProps),t),{id:t.publicId,start:s,end:r,duration:r-s,allDay:Number(t.allDay),_seg:i})}function UH(i,e){let{pluginHooks:t}=e,n=t.isDraggableTransformers,{def:s,ui:r}=i.eventRange,o=r.startEditable;for(let a of n)o=a(o,s,r,e);return o}function HH(i,e){return i.isStart&&i.eventRange.ui.durationEditable&&e.options.eventResizableFromStart}function BH(i,e){return i.isEnd&&i.eventRange.ui.durationEditable}function vr(i,e,t,n,s,r,o){let{dateEnv:a,options:l}=t,{displayEventTime:c,displayEventEnd:d}=l,h=i.eventRange.def,p=i.eventRange.instance;c==null&&(c=n!==!1),d==null&&(d=s!==!1);let m=p.range.start,y=p.range.end,v=r||i.start||i.eventRange.range.start,b=o||i.end||i.eventRange.range.end,w=de(m).valueOf()===de(v).valueOf(),_=de(yi(y,-1)).valueOf()===de(yi(b,-1)).valueOf();return c&&!h.allDay&&(w||_)?(v=w?m:v,b=_?y:b,d&&h.hasEnd?a.formatRange(v,b,e,{forcedStartTzo:r?null:p.forcedStartTzo,forcedEndTzo:o?null:p.forcedEndTzo}):a.format(v,e,{forcedTzo:r?null:p.forcedStartTzo})):""}function sn(i,e,t){let n=i.eventRange.range;return{isPast:n.end<=(t||e.start),isFuture:n.start>=(t||e.end),isToday:e&&mn(e,n.start)}}function VH(i){let e=["fc-event"];return i.isMirror&&e.push("fc-event-mirror"),i.isDraggable&&e.push("fc-event-draggable"),(i.isStartResizable||i.isEndResizable)&&e.push("fc-event-resizable"),i.isDragging&&e.push("fc-event-dragging"),i.isResizing&&e.push("fc-event-resizing"),i.isSelected&&e.push("fc-event-selected"),i.isStart&&e.push("fc-event-start"),i.isEnd&&e.push("fc-event-end"),i.isPast&&e.push("fc-event-past"),i.isToday&&e.push("fc-event-today"),i.isFuture&&e.push("fc-event-future"),e}function gf(i){return i.instance?i.instance.instanceId:`${i.def.defId}:${i.range.start.toISOString()}`}function Tc(i,e){let{def:t,instance:n}=i.eventRange,{url:s}=t;if(s)return{href:s};let{emitter:r,options:o}=e,{eventInteractive:a}=o;return a==null&&(a=t.interactive,a==null&&(a=!!r.hasHandlers("eventClick"))),a?FI(l=>{r.trigger("eventClick",{el:l.target,event:new me(e,t,n),jsEvent:l,view:e.viewApi})}):{}}var GH={start:M,end:M,allDay:Boolean};function $H(i,e,t){let n=zH(i,e),{range:s}=n;if(!s.start)return null;if(!s.end){if(t==null)return null;s.end=e.add(s.start,t)}return n}function zH(i,e){let{refined:t,extra:n}=gv(i,GH),s=t.start?e.createMarkerMeta(t.start):null,r=t.end?e.createMarkerMeta(t.end):null,{allDay:o}=t;return o==null&&(o=s&&s.isTimeUnspecified&&(!r||r.isTimeUnspecified)),Object.assign({range:{start:s?s.marker:null,end:r?r.marker:null},allDay:o},n)}function GS(i,e){return KI(i.range,e.range)&&i.allDay===e.allDay&&qH(i,e)}function qH(i,e){for(let t in e)if(t!=="range"&&t!=="allDay"&&i[t]!==e[t])return!1;for(let t in i)if(!(t in e))return!1;return!0}function WH(i,e){return Object.assign(Object.assign({},iD(i.range,e,i.allDay)),{allDay:i.allDay})}function $S(i,e,t){return Object.assign(Object.assign({},iD(i,e,t)),{timeZone:e.timeZone})}function iD(i,e,t){return{start:e.toDate(i.start),end:e.toDate(i.end),startStr:e.formatIso(i.start,{omitTime:t}),endStr:e.formatIso(i.end,{omitTime:t})}}function YH(i,e,t){let n=bv({editable:!1},t),s=Kh(n.refined,n.extra,"",i.allDay,!0,t);return{def:s,ui:nD(s,e),instance:hf(s.defId,i.range),range:i.range,isStart:!0,isEnd:!0}}function zS(i,e,t){let n=!1,s=function(a){n||(n=!0,e(a))},r=function(a){n||(n=!0,t(a))},o=i(s,r);o&&typeof o.then=="function"&&o.then(s,r)}var lv=class extends Error{constructor(e,t){super(e),this.response=t}};function qS(i,e,t){i=i.toUpperCase();let n={method:i};return i==="GET"?e+=(e.indexOf("?")===-1?"?":"&")+new URLSearchParams(t):(n.body=new URLSearchParams(t),n.headers={"Content-Type":"application/x-www-form-urlencoded"}),fetch(e,n).then(s=>{if(s.ok)return s.json().then(r=>[r,s],()=>{throw new lv("Failure parsing JSON",s)});throw new lv("Request failed",s)})}var Kw;function WS(){return Kw==null&&(Kw=KH()),Kw}function KH(){if(typeof document=="undefined")return!0;let i=document.createElement("div");i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.innerHTML="<table><tr><td><div></div></td></tr></table>",i.querySelector("table").style.height="100px",i.querySelector("div").style.height="100%",document.body.appendChild(i);let t=i.querySelector("div").offsetHeight>0;return document.body.removeChild(i),t}var Zh=class extends te{constructor(){super(...arguments),this.state={forPrint:!1},this.handleBeforePrint=()=>{Wh(()=>{this.setState({forPrint:!0})})},this.handleAfterPrint=()=>{Wh(()=>{this.setState({forPrint:!1})})}}render(){let{props:e}=this,{options:t}=e,{forPrint:n}=this.state,s=n||t.height==="auto"||t.contentHeight==="auto",r=!s&&t.height!=null?t.height:"",o=["fc",n?"fc-media-print":"fc-media-screen",`fc-direction-${t.direction}`,e.theme.getClass("root")];return WS()||o.push("fc-liquid-hack"),e.children(o,r,s,n)}componentDidMount(){let{emitter:e}=this.props;e.on("_beforeprint",this.handleBeforePrint),e.on("_afterprint",this.handleAfterPrint)}componentWillUnmount(){let{emitter:e}=this.props;e.off("_beforeprint",this.handleBeforePrint),e.off("_afterprint",this.handleAfterPrint)}},zn=class{constructor(e){this.component=e.component,this.isHitComboAllowed=e.isHitComboAllowed||null}destroy(){}};function sD(i,e){return{component:i,el:e.el,useEventCenter:e.useEventCenter!=null?e.useEventCenter:!0,isHitComboAllowed:e.isHitComboAllowed||null}}function mf(i){return{[i.component.uid]:i}}var xc={},Lt=class extends it{constructor(e,t){super(e,t),this.handleRefresh=()=>{let n=this.computeTiming();n.state.nowDate.valueOf()!==this.state.nowDate.valueOf()&&this.setState(n.state),this.clearTimeout(),this.setTimeout(n.waitMs)},this.handleVisibilityChange=()=>{document.hidden||this.handleRefresh()},this.state=this.computeTiming().state}render(){let{props:e,state:t}=this;return e.children(t.nowDate,t.todayRange)}componentDidMount(){this.setTimeout(),this.context.nowManager.addResetListener(this.handleRefresh),document.addEventListener("visibilitychange",this.handleVisibilityChange)}componentDidUpdate(e){e.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())}componentWillUnmount(){this.clearTimeout(),this.context.nowManager.removeResetListener(this.handleRefresh),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}computeTiming(){let{props:e,context:t}=this,n=t.nowManager.getDateMarker(),{nowIndicatorSnap:s}=t.options;s==="auto"&&(s=/year|month|week|day/.test(e.unit)||(e.unitValue||1)===1);let r,o;return s?(r=t.dateEnv.startOf(n,e.unit),o=t.dateEnv.add(r,ee(1,e.unit)).valueOf()-n.valueOf()):(r=n,o=1e3*60),o=Math.min(1e3*60*60*24,o),{state:{nowDate:r,todayRange:XH(r)},waitMs:o}}setTimeout(e=this.computeTiming().waitMs){this.timeoutId=setTimeout(()=>{let t=this.computeTiming();this.setState(t.state,()=>{this.setTimeout(t.waitMs)})},e)}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}};Lt.contextType=En;function XH(i){let e=de(i),t=be(e,1);return{start:e,end:t}}var Qh=class{getCurrentData(){return this.currentDataManager.getCurrentData()}dispatch(e){this.currentDataManager.dispatch(e)}get view(){return this.getCurrentData().viewApi}batchRendering(e){e()}updateSize(){this.trigger("_resize",!0)}setOption(e,t){this.dispatch({type:"SET_OPTION",optionName:e,rawOptionValue:t})}getOption(e){return this.currentDataManager.currentCalendarOptionsInput[e]}getAvailableLocaleCodes(){return Object.keys(this.getCurrentData().availableRawLocales)}on(e,t){let{currentDataManager:n}=this;n.currentCalendarOptionsRefiners[e]?n.emitter.on(e,t):console.warn(`Unknown listener name '${e}'`)}off(e,t){this.currentDataManager.emitter.off(e,t)}trigger(e,...t){this.currentDataManager.emitter.trigger(e,...t)}changeView(e,t){this.batchRendering(()=>{if(this.unselect(),t)if(t.start&&t.end)this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e}),this.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:t});else{let{dateEnv:n}=this.getCurrentData();this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e,dateMarker:n.createMarker(t)})}else this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e})})}zoomTo(e,t){let n=this.getCurrentData(),s;t=t||"day",s=n.viewSpecs[t]||this.getUnitViewSpec(t),this.unselect(),s?this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:s.type,dateMarker:e}):this.dispatch({type:"CHANGE_DATE",dateMarker:e})}getUnitViewSpec(e){let{viewSpecs:t,toolbarConfig:n}=this.getCurrentData(),s=[].concat(n.header?n.header.viewsWithButtons:[],n.footer?n.footer.viewsWithButtons:[]),r,o;for(let a in t)s.push(a);for(r=0;r<s.length;r+=1)if(o=t[s[r]],o&&o.singleUnit===e)return o;return null}prev(){this.unselect(),this.dispatch({type:"PREV"})}next(){this.unselect(),this.dispatch({type:"NEXT"})}prevYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,-1)})}nextYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,1)})}today(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.nowManager.getDateMarker()})}gotoDate(e){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.createMarker(e)})}incrementDate(e){let t=this.getCurrentData(),n=ee(e);n&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.add(t.currentDate,n)}))}getDate(){let e=this.getCurrentData();return e.dateEnv.toDate(e.currentDate)}formatDate(e,t){let{dateEnv:n}=this.getCurrentData();return n.format(n.createMarker(e),ue(t))}formatRange(e,t,n){let{dateEnv:s}=this.getCurrentData();return s.formatRange(s.createMarker(e),s.createMarker(t),ue(n),n)}formatIso(e,t){let{dateEnv:n}=this.getCurrentData();return n.formatIso(n.createMarker(e),{omitTime:t})}select(e,t){let n;t==null?e.start!=null?n=e:n={start:e,end:null}:n={start:e,end:t};let s=this.getCurrentData(),r=$H(n,s.dateEnv,ee({days:1}));r&&(this.dispatch({type:"SELECT_DATES",selection:r}),Sv(r,null,s))}unselect(e){let t=this.getCurrentData();t.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),NH(e,t))}addEvent(e,t){if(e instanceof me){let o=e._def,a=e._instance;return this.getCurrentData().eventStore.defs[o.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:Jh({def:o,instance:a})}),this.triggerEventAdd(e)),e}let n=this.getCurrentData(),s;if(t instanceof ar)s=t.internalEventSource;else if(typeof t=="boolean")t&&([s]=yv(n.eventSources));else if(t!=null){let o=this.getEventSourceById(t);if(!o)return console.warn(`Could not find an event source with ID "${t}"`),null;s=o.internalEventSource}let r=ZI(e,s,n,!1);if(r){let o=new me(n,r.def,r.def.recurringDef?null:r.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:Jh(r)}),this.triggerEventAdd(o),o}return null}triggerEventAdd(e){let{emitter:t}=this.getCurrentData();t.trigger("eventAdd",{event:e,relatedEvents:[],revert:()=>{this.dispatch({type:"REMOVE_EVENTS",eventStore:tD(e)})}})}getEventById(e){let t=this.getCurrentData(),{defs:n,instances:s}=t.eventStore;e=String(e);for(let r in n){let o=n[r];if(o.publicId===e){if(o.recurringDef)return new me(t,o,null);for(let a in s){let l=s[a];if(l.defId===o.defId)return new me(t,o,l)}}}return null}getEvents(){let e=this.getCurrentData();return wi(e.eventStore,e)}removeAllEvents(){this.dispatch({type:"REMOVE_ALL_EVENTS"})}getEventSources(){let e=this.getCurrentData(),t=e.eventSources,n=[];for(let s in t)n.push(new ar(e,t[s]));return n}getEventSourceById(e){let t=this.getCurrentData(),n=t.eventSources;e=String(e);for(let s in n)if(n[s].publicId===e)return new ar(t,n[s]);return null}addEventSource(e){let t=this.getCurrentData();if(e instanceof ar)return t.eventSources[e.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[e.internalEventSource]}),e;let n=LS(e,t);return n?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[n]}),new ar(t,n)):null}removeAllEventSources(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})}refetchEvents(){this.dispatch({type:"FETCH_EVENT_SOURCES",isRefetch:!0})}scrollToTime(e){let t=ee(e);t&&this.trigger("_scrollRequest",{time:t})}};function YS(i,e){return i.left>=e.left&&i.left<e.right&&i.top>=e.top&&i.top<e.bottom}function _v(i,e){let t={left:Math.max(i.left,e.left),right:Math.min(i.right,e.right),top:Math.max(i.top,e.top),bottom:Math.min(i.bottom,e.bottom)};return t.left<t.right&&t.top<t.bottom?t:!1}function KS(i,e){return{left:Math.min(Math.max(i.left,e.left),e.right),top:Math.min(Math.max(i.top,e.top),e.bottom)}}function XS(i){return{left:(i.left+i.right)/2,top:(i.top+i.bottom)/2}}function JS(i,e){return{left:i.left-e.left,top:i.top-e.top}}var Xw=yt(),jh=class{constructor(){this.getKeysForEventDefs=$(this._getKeysForEventDefs),this.splitDateSelection=$(this._splitDateSpan),this.splitEventStore=$(this._splitEventStore),this.splitIndividualUi=$(this._splitIndividualUi),this.splitEventDrag=$(this._splitInteraction),this.splitEventResize=$(this._splitInteraction),this.eventUiBuilders={}}splitProps(e){let t=this.getKeyInfo(e),n=this.getKeysForEventDefs(e.eventStore),s=this.splitDateSelection(e.dateSelection),r=this.splitIndividualUi(e.eventUiBases,n),o=this.splitEventStore(e.eventStore,n),a=this.splitEventDrag(e.eventDrag),l=this.splitEventResize(e.eventResize),c={};this.eventUiBuilders=yn(t,(d,h)=>this.eventUiBuilders[h]||$(JH));for(let d in t){let h=t[d],p=o[d]||Xw,m=this.eventUiBuilders[d];c[d]={businessHours:h.businessHours||e.businessHours,dateSelection:s[d]||null,eventStore:p,eventUiBases:m(e.eventUiBases[""],h.ui,r[d]),eventSelection:p.instances[e.eventSelection]?e.eventSelection:"",eventDrag:a[d]||null,eventResize:l[d]||null}}return c}_splitDateSpan(e){let t={};if(e){let n=this.getKeysForDateSpan(e);for(let s of n)t[s]=e}return t}_getKeysForEventDefs(e){return yn(e.defs,t=>this.getKeysForEventDef(t))}_splitEventStore(e,t){let{defs:n,instances:s}=e,r={};for(let o in n)for(let a of t[o])r[a]||(r[a]=yt()),r[a].defs[o]=n[o];for(let o in s){let a=s[o];for(let l of t[a.defId])r[l]&&(r[l].instances[o]=a)}return r}_splitIndividualUi(e,t){let n={};for(let s in e)if(s)for(let r of t[s])n[r]||(n[r]={}),n[r][s]=e[s];return n}_splitInteraction(e){let t={};if(e){let n=this._splitEventStore(e.affectedEvents,this._getKeysForEventDefs(e.affectedEvents)),s=this._getKeysForEventDefs(e.mutatedEvents),r=this._splitEventStore(e.mutatedEvents,s),o=a=>{t[a]||(t[a]={affectedEvents:n[a]||Xw,mutatedEvents:r[a]||Xw,isEvent:e.isEvent})};for(let a in n)o(a);for(let a in r)o(a)}return t}};function JH(i,e,t){let n=[];i&&n.push(i),e&&n.push(e);let s={"":FS(n)};return t&&Object.assign(s,t),s}function yf(i,e,t,n){return{dow:i.getUTCDay(),isDisabled:!!(n&&(!n.activeRange||!mn(n.activeRange,i))),isOther:!!(n&&!mn(n.currentRange,i)),isToday:!!(e&&mn(e,i)),isPast:!!(t?i<t:e&&i<e.start),isFuture:!!(t?i>t:e&&i>=e.end)}}function Rc(i,e){let t=["fc-day",`fc-day-${MU[i.dow]}`];return i.isDisabled?t.push("fc-day-disabled"):(i.isToday&&(t.push("fc-day-today"),t.push(e.getClass("today"))),i.isPast&&t.push("fc-day-past"),i.isFuture&&t.push("fc-day-future"),i.isOther&&t.push("fc-day-other")),t}var ZH=ue({year:"numeric",month:"long",day:"numeric"}),QH=ue({week:"long"});function Si(i,e,t="day",n=!0){let{dateEnv:s,options:r,calendarApi:o}=i,a=s.format(e,t==="week"?QH:ZH);if(r.navLinks){let l=s.toDate(e),c=d=>{let h=t==="day"?r.navLinkDayClick:t==="week"?r.navLinkWeekClick:null;typeof h=="function"?h.call(o,s.toDate(e),d):(typeof h=="string"&&(t=h),o.zoomTo(e,t))};return Object.assign({title:wc(r.navLinkHint,[a,l],a),"data-navlink":""},n?NI(c):{onClick:c})}return{"aria-label":a}}var Jw=null;function rD(){return Jw===null&&(Jw=jH()),Jw}function jH(){let i=document.createElement("div");da(i,{position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}),i.innerHTML="<div></div>",document.body.appendChild(i);let t=i.firstChild.getBoundingClientRect().left>i.getBoundingClientRect().left;return of(i),t}var Zw;function oD(){return Zw||(Zw=eB()),Zw}function eB(){let i=document.createElement("div");i.style.overflow="scroll",i.style.position="absolute",i.style.top="-9999px",i.style.left="-9999px",document.body.appendChild(i);let e=aD(i);return document.body.removeChild(i),e}function aD(i){return{x:i.offsetHeight-i.clientHeight,y:i.offsetWidth-i.clientWidth}}function lD(i,e=!1){let t=window.getComputedStyle(i),n=parseInt(t.borderLeftWidth,10)||0,s=parseInt(t.borderRightWidth,10)||0,r=parseInt(t.borderTopWidth,10)||0,o=parseInt(t.borderBottomWidth,10)||0,a=aD(i),l=a.y-n-s,c=a.x-r-o,d={borderLeft:n,borderRight:s,borderTop:r,borderBottom:o,scrollbarBottom:c,scrollbarLeft:0,scrollbarRight:0};return rD()&&t.direction==="rtl"?d.scrollbarLeft=l:d.scrollbarRight=l,e&&(d.paddingLeft=parseInt(t.paddingLeft,10)||0,d.paddingRight=parseInt(t.paddingRight,10)||0,d.paddingTop=parseInt(t.paddingTop,10)||0,d.paddingBottom=parseInt(t.paddingBottom,10)||0),d}function ZS(i,e=!1,t){let n=t?i.getBoundingClientRect():vf(i),s=lD(i,e),r={left:n.left+s.borderLeft+s.scrollbarLeft,right:n.right-s.borderRight-s.scrollbarRight,top:n.top+s.borderTop,bottom:n.bottom-s.borderBottom-s.scrollbarBottom};return e&&(r.left+=s.paddingLeft,r.right-=s.paddingRight,r.top+=s.paddingTop,r.bottom-=s.paddingBottom),r}function vf(i){let e=i.getBoundingClientRect();return{left:e.left+window.scrollX,top:e.top+window.scrollY,right:e.right+window.scrollX,bottom:e.bottom+window.scrollY}}function tB(i){let e=Cv(i),t=i.getBoundingClientRect();for(let n of e){let s=_v(t,n.getBoundingClientRect());if(s)t=s;else return null}return t}function Cv(i){let e=[];for(;i instanceof HTMLElement;){let t=window.getComputedStyle(i);if(t.position==="fixed")break;/(auto|scroll)/.test(t.overflow+t.overflowY+t.overflowX)&&e.push(i),i=i.parentNode}return e}var qn=class{constructor(e,t,n,s){this.els=t;let r=this.originClientRect=e.getBoundingClientRect();n&&this.buildElHorizontals(r.left),s&&this.buildElVerticals(r.top)}buildElHorizontals(e){let t=[],n=[];for(let s of this.els){let r=s.getBoundingClientRect();t.push(r.left-e),n.push(r.right-e)}this.lefts=t,this.rights=n}buildElVerticals(e){let t=[],n=[];for(let s of this.els){let r=s.getBoundingClientRect();t.push(r.top-e),n.push(r.bottom-e)}this.tops=t,this.bottoms=n}leftToIndex(e){let{lefts:t,rights:n}=this,s=t.length,r;for(r=0;r<s;r+=1)if(e>=t[r]&&e<n[r])return r}topToIndex(e){let{tops:t,bottoms:n}=this,s=t.length,r;for(r=0;r<s;r+=1)if(e>=t[r]&&e<n[r])return r}getWidth(e){return this.rights[e]-this.lefts[e]}getHeight(e){return this.bottoms[e]-this.tops[e]}similarTo(e){return Jy(this.tops||[],e.tops||[])&&Jy(this.bottoms||[],e.bottoms||[])&&Jy(this.lefts||[],e.lefts||[])&&Jy(this.rights||[],e.rights||[])}};function Jy(i,e){let t=i.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(Math.round(i[n])!==Math.round(e[n]))return!1;return!0}var na=class{getMaxScrollTop(){return this.getScrollHeight()-this.getClientHeight()}getMaxScrollLeft(){return this.getScrollWidth()-this.getClientWidth()}canScrollVertically(){return this.getMaxScrollTop()>0}canScrollHorizontally(){return this.getMaxScrollLeft()>0}canScrollUp(){return this.getScrollTop()>0}canScrollDown(){return this.getScrollTop()<this.getMaxScrollTop()}canScrollLeft(){return this.getScrollLeft()>0}canScrollRight(){return this.getScrollLeft()<this.getMaxScrollLeft()}},ef=class extends na{constructor(e){super(),this.el=e}getScrollTop(){return this.el.scrollTop}getScrollLeft(){return this.el.scrollLeft}setScrollTop(e){this.el.scrollTop=e}setScrollLeft(e){this.el.scrollLeft=e}getScrollWidth(){return this.el.scrollWidth}getScrollHeight(){return this.el.scrollHeight}getClientHeight(){return this.el.clientHeight}getClientWidth(){return this.el.clientWidth}},tf=class extends na{getScrollTop(){return window.scrollY}getScrollLeft(){return window.scrollX}setScrollTop(e){window.scroll(window.scrollX,e)}setScrollLeft(e){window.scroll(e,window.scrollY)}getScrollWidth(){return document.documentElement.scrollWidth}getScrollHeight(){return document.documentElement.scrollHeight}getClientHeight(){return document.documentElement.clientHeight}getClientWidth(){return document.documentElement.clientWidth}},st=class extends te{constructor(){super(...arguments),this.uid=ps()}prepareHits(){}queryHit(e,t,n,s){return null}isValidSegDownEl(e){return!this.props.eventDrag&&!this.props.eventResize&&!Ve(e,".fc-event-mirror")}isValidDateDownEl(e){return!Ve(e,".fc-event:not(.fc-bg-event)")&&!Ve(e,".fc-more-link")&&!Ve(e,"a[data-navlink]")&&!Ve(e,".fc-popover")}};var ia=class{constructor(e=t=>t.thickness||1){this.getEntryThickness=e,this.strictOrder=!1,this.allowReslicing=!1,this.maxCoord=-1,this.maxStackCnt=-1,this.levelCoords=[],this.entriesByLevel=[],this.stackCnts={}}addSegs(e){let t=[];for(let n of e)this.insertEntry(n,t);return t}insertEntry(e,t){let n=this.findInsertion(e);this.isInsertionValid(n,e)?this.insertEntryAt(e,n):this.handleInvalidInsertion(n,e,t)}isInsertionValid(e,t){return(this.maxCoord===-1||e.levelCoord+this.getEntryThickness(t)<=this.maxCoord)&&(this.maxStackCnt===-1||e.stackCnt<this.maxStackCnt)}handleInvalidInsertion(e,t,n){if(this.allowReslicing&&e.touchingEntry){let s=Object.assign(Object.assign({},t),{span:Ef(t.span,e.touchingEntry.span)});n.push(s),this.splitEntry(t,e.touchingEntry,n)}else n.push(t)}splitEntry(e,t,n){let s=e.span,r=t.span;s.start<r.start&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:s.start,end:r.start}},n),s.end>r.end&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:r.end,end:s.end}},n)}insertEntryAt(e,t){let{entriesByLevel:n,levelCoords:s}=this;t.lateral===-1?(Qw(s,t.level,t.levelCoord),Qw(n,t.level,[e])):Qw(n[t.level],t.lateral,e),this.stackCnts[Ei(e)]=t.stackCnt}findInsertion(e){let{levelCoords:t,entriesByLevel:n,strictOrder:s,stackCnts:r}=this,o=t.length,a=0,l=-1,c=-1,d=null,h=0;for(let y=0;y<o;y+=1){let v=t[y];if(!s&&v>=a+this.getEntryThickness(e))break;let b=n[y],w,_=sf(b,e.span.start,nf),C=_[0]+_[1];for(;(w=b[C])&&w.span.start<e.span.end;){let T=v+this.getEntryThickness(w);T>a&&(a=T,d=w,l=y,c=C),T===a&&(h=Math.max(h,r[Ei(w)]+1)),C+=1}}let p=0;if(d)for(p=l+1;p<o&&t[p]<a;)p+=1;let m=-1;return p<o&&t[p]===a&&(m=sf(n[p],e.span.end,nf)[0]),{touchingLevel:l,touchingLateral:c,touchingEntry:d,stackCnt:h,levelCoord:a,level:p,lateral:m}}toRects(){let{entriesByLevel:e,levelCoords:t}=this,n=e.length,s=[];for(let r=0;r<n;r+=1){let o=e[r],a=t[r];for(let l of o)s.push(Object.assign(Object.assign({},l),{thickness:this.getEntryThickness(l),levelCoord:a}))}return s}};function nf(i){return i.span.end}function Ei(i){return i.index+":"+i.span.start}function QS(i){let e=[];for(let t of i){let n=[],s={span:t.span,entries:[t]};for(let r of e)Ef(r.span,s.span)?s={entries:r.entries.concat(s.entries),span:nB(r.span,s.span)}:n.push(r);n.push(s),e=n}return e}function nB(i,e){return{start:Math.min(i.start,e.start),end:Math.max(i.end,e.end)}}function Ef(i,e){let t=Math.max(i.start,e.start),n=Math.min(i.end,e.end);return t<n?{start:t,end:n}:null}function Qw(i,e,t){i.splice(e,0,t)}function sf(i,e,t){let n=0,s=i.length;if(!s||e<t(i[n]))return[0,0];if(e>t(i[s-1]))return[s,0];for(;n<s;){let r=Math.floor(n+(s-n)/2),o=t(i[r]);if(e<o)s=r;else if(e>o)n=r+1;else return[r,1]}return[n,0]}var rf=class{constructor(e,t){this.emitter=new hs}destroy(){}setMirrorIsVisible(e){}setMirrorNeedsRevert(e){}setAutoScrollEnabled(e){}},bf={};function cD(i,e){return!i||e>10?ue({weekday:"short"}):e>1?ue({weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}):ue({weekday:"long"})}var dD="fc-col-header-cell";function uD(i){return i.text}var cv=class extends te{render(){let{dateEnv:e,options:t,theme:n,viewApi:s}=this.context,{props:r}=this,{date:o,dateProfile:a}=r,l=yf(o,r.todayRange,null,a),c=[dD].concat(Rc(l,n)),d=e.format(o,r.dayHeaderFormat),h=!l.isDisabled&&r.colCnt>1?Si(this.context,o):{},p=e.toDate(o);e.namedTimeZoneImpl&&(p=yi(p,36e5));let m=Object.assign(Object.assign(Object.assign({date:p,view:s},r.extraRenderProps),{text:d}),l);return x(xe,{elTag:"th",elClasses:c,elAttrs:Object.assign({role:"columnheader",colSpan:r.colSpan,"data-date":l.isDisabled?void 0:gr(o)},r.extraDataAttrs),renderProps:m,generatorName:"dayHeaderContent",customGenerator:t.dayHeaderContent,defaultGenerator:uD,classNameGenerator:t.dayHeaderClassNames,didMount:t.dayHeaderDidMount,willUnmount:t.dayHeaderWillUnmount},y=>x("div",{className:"fc-scrollgrid-sync-inner"},!l.isDisabled&&x(y,{elTag:"a",elAttrs:h,elClasses:["fc-col-header-cell-cushion",r.isSticky&&"fc-sticky"]})))}},iB=ue({weekday:"long"}),dv=class extends te{render(){let{props:e}=this,{dateEnv:t,theme:n,viewApi:s,options:r}=this.context,o=be(new Date(2592e5),e.dow),a={dow:e.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},l=t.format(o,e.dayHeaderFormat),c=Object.assign(Object.assign(Object.assign(Object.assign({date:o},a),{view:s}),e.extraRenderProps),{text:l});return x(xe,{elTag:"th",elClasses:[dD,...Rc(a,n),...e.extraClassNames||[]],elAttrs:Object.assign({role:"columnheader",colSpan:e.colSpan},e.extraDataAttrs),renderProps:c,generatorName:"dayHeaderContent",customGenerator:r.dayHeaderContent,defaultGenerator:uD,classNameGenerator:r.dayHeaderClassNames,didMount:r.dayHeaderDidMount,willUnmount:r.dayHeaderWillUnmount},d=>x("div",{className:"fc-scrollgrid-sync-inner"},x(d,{elTag:"a",elClasses:["fc-col-header-cell-cushion",e.isSticky&&"fc-sticky"],elAttrs:{"aria-label":t.format(o,iB)}})))}},sa=class extends te{constructor(){super(...arguments),this.createDayHeaderFormatter=$(sB)}render(){let{context:e}=this,{dates:t,dateProfile:n,datesRepDistinctDays:s,renderIntro:r}=this.props,o=this.createDayHeaderFormatter(e.options.dayHeaderFormat,s,t.length);return x(Lt,{unit:"day"},(a,l)=>x("tr",{role:"row"},r&&r("day"),t.map(c=>s?x(cv,{key:c.toISOString(),date:c,dateProfile:n,todayRange:l,colCnt:t.length,dayHeaderFormat:o}):x(dv,{key:c.getUTCDay(),dow:c.getUTCDay(),dayHeaderFormat:o}))))}};function sB(i,e,t){return i||cD(e,t)}var ra=class{constructor(e,t){let n=e.start,{end:s}=e,r=[],o=[],a=-1;for(;n<s;)t.isHiddenDay(n)?r.push(a+.5):(a+=1,r.push(a),o.push(n)),n=be(n,1);this.dates=o,this.indices=r,this.cnt=o.length}sliceRange(e){let t=this.getDateDayIndex(e.start),n=this.getDateDayIndex(be(e.end,-1)),s=Math.max(0,t),r=Math.min(this.cnt-1,n);return s=Math.ceil(s),r=Math.floor(r),s<=r?{firstIndex:s,lastIndex:r,isStart:t===s,isEnd:n===r}:null}getDateDayIndex(e){let{indices:t}=this,n=Math.floor(Ai(this.dates[0],e));return n<0?t[0]-1:n>=t.length?t[t.length-1]+1:t[n]}},oa=class{constructor(e,t){let{dates:n}=e,s,r,o;if(t){for(r=n[0].getUTCDay(),s=1;s<n.length&&n[s].getUTCDay()!==r;s+=1);o=Math.ceil(n.length/s)}else o=1,s=n.length;this.rowCnt=o,this.colCnt=s,this.daySeries=e,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}buildCells(){let e=[];for(let t=0;t<this.rowCnt;t+=1){let n=[];for(let s=0;s<this.colCnt;s+=1)n.push(this.buildCell(t,s));e.push(n)}return e}buildCell(e,t){let n=this.daySeries.dates[e*this.colCnt+t];return{key:n.toISOString(),date:n}}buildHeaderDates(){let e=[];for(let t=0;t<this.colCnt;t+=1)e.push(this.cells[0][t].date);return e}sliceRange(e){let{colCnt:t}=this,n=this.daySeries.sliceRange(e),s=[];if(n){let{firstIndex:r,lastIndex:o}=n,a=r;for(;a<=o;){let l=Math.floor(a/t),c=Math.min((l+1)*t,o+1);s.push({row:l,firstCol:a%t,lastCol:(c-1)%t,isStart:n.isStart&&a===r,isEnd:n.isEnd&&c-1===o}),a=c}}return s}},aa=class{constructor(){this.sliceBusinessHours=$(this._sliceBusinessHours),this.sliceDateSelection=$(this._sliceDateSpan),this.sliceEventStore=$(this._sliceEventStore),this.sliceEventDrag=$(this._sliceInteraction),this.sliceEventResize=$(this._sliceInteraction),this.forceDayIfListItem=!1}sliceProps(e,t,n,s,...r){let{eventUiBases:o}=e,a=this.sliceEventStore(e.eventStore,o,t,n,...r);return{dateSelectionSegs:this.sliceDateSelection(e.dateSelection,t,n,o,s,...r),businessHourSegs:this.sliceBusinessHours(e.businessHours,t,n,s,...r),fgEventSegs:a.fg,bgEventSegs:a.bg,eventDrag:this.sliceEventDrag(e.eventDrag,o,t,n,...r),eventResize:this.sliceEventResize(e.eventResize,o,t,n,...r),eventSelection:e.eventSelection}}sliceNowDate(e,t,n,s,...r){return this._sliceDateSpan({range:{start:e,end:yi(e,1)},allDay:!1},t,n,{},s,...r)}_sliceBusinessHours(e,t,n,s,...r){return e?this._sliceEventStore(ta(e,Zy(t,!!n),s),{},t,n,...r).bg:[]}_sliceEventStore(e,t,n,s,...r){if(e){let o=bc(e,t,Zy(n,!!s),s);return{bg:this.sliceEventRanges(o.bg,r),fg:this.sliceEventRanges(o.fg,r)}}return{bg:[],fg:[]}}_sliceInteraction(e,t,n,s,...r){if(!e)return null;let o=bc(e.mutatedEvents,t,Zy(n,!!s),s);return{segs:this.sliceEventRanges(o.fg,r),affectedInstances:e.affectedEvents.instances,isEvent:e.isEvent}}_sliceDateSpan(e,t,n,s,r,...o){if(!e)return[];let a=Zy(t,!!n),l=tn(e.range,a);if(l){e=Object.assign(Object.assign({},e),{range:l});let c=YH(e,s,r),d=this.sliceRange(e.range,...o);for(let h of d)h.eventRange=c;return d}return[]}sliceEventRanges(e,t){let n=[];for(let s of e)n.push(...this.sliceEventRange(s,t));return n}sliceEventRange(e,t){let n=e.range;this.forceDayIfListItem&&e.ui.display==="list-item"&&(n={start:n.start,end:be(n.start,1)});let s=this.sliceRange(n,...t);for(let r of s)r.eventRange=e,r.isStart=e.isStart&&r.isStart,r.isEnd=e.isEnd&&r.isEnd;return s}};function Zy(i,e){let t=i.activeRange;return e?t:{start:yi(t.start,i.slotMinTime.milliseconds),end:yi(t.end,i.slotMaxTime.milliseconds-864e5)}}function Tv(i,e,t){let{instances:n}=i.mutatedEvents;for(let s in n)if(!_c(e.validRange,n[s].range))return!1;return hD({eventDrag:i},t)}function jS(i,e,t){return _c(e.validRange,i.range)?hD({dateSelection:i},t):!1}function hD(i,e){let t=e.getCurrentData(),n=Object.assign({businessHours:t.businessHours,dateSelection:"",eventStore:t.eventStore,eventUiBases:t.eventUiBases,eventSelection:"",eventDrag:null,eventResize:null},i);return(e.pluginHooks.isPropsValid||fD)(n,e)}function fD(i,e,t={},n){return!(i.eventDrag&&!rB(i,e,t,n)||i.dateSelection&&!oB(i,e,t,n))}function rB(i,e,t,n){let s=e.getCurrentData(),r=i.eventDrag,o=r.mutatedEvents,a=o.defs,l=o.instances,c=av(a,r.isEvent?i.eventUiBases:{"":s.selectionConfig});n&&(c=yn(c,n));let d=RH(i.eventStore,r.affectedEvents.instances),h=d.defs,p=d.instances,m=av(h,i.eventUiBases);for(let y in l){let v=l[y],b=v.range,w=c[v.defId],_=a[v.defId];if(!pD(w.constraints,b,d,i.businessHours,e))return!1;let{eventOverlap:C}=e.options,T=typeof C=="function"?C:null;for(let D in p){let I=p[D];if(vv(b,I.range)&&(m[I.defId].overlap===!1&&r.isEvent||w.overlap===!1||T&&!T(new me(e,h[I.defId],I),new me(e,_,v))))return!1}let R=s.eventStore;for(let D of w.allows){let I=Object.assign(Object.assign({},t),{range:v.range,allDay:_.allDay}),k=R.defs[_.defId],N=R.instances[y],F;if(k?F=new me(e,k,N):F=new me(e,_),!D(BS(I,e),F))return!1}}return!0}function oB(i,e,t,n){let s=i.eventStore,r=s.defs,o=s.instances,a=i.dateSelection,l=a.range,{selectionConfig:c}=e.getCurrentData();if(n&&(c=n(c)),!pD(c.constraints,l,s,i.businessHours,e))return!1;let{selectOverlap:d}=e.options,h=typeof d=="function"?d:null;for(let p in o){let m=o[p];if(vv(l,m.range)&&(c.overlap===!1||h&&!h(new me(e,r[m.defId],m),null)))return!1}for(let p of c.allows){let m=Object.assign(Object.assign({},t),a);if(!p(BS(m,e),null))return!1}return!0}function pD(i,e,t,n,s){for(let r of i)if(!lB(aB(r,e,t,n,s),e))return!1;return!0}function aB(i,e,t,n,s){return i==="businessHours"?jw(ta(n,e,s)):typeof i=="string"?jw(wv(t,r=>r.groupId===i)):typeof i=="object"&&i?jw(ta(i,e,s)):[]}function jw(i){let{instances:e}=i,t=[];for(let n in e)t.push(e[n].range);return t}function lB(i,e){for(let t of i)if(_c(t,e))return!0;return!1}var Qy=/^(visible|hidden)$/,Ac=class extends te{constructor(){super(...arguments),this.handleEl=e=>{this.el=e,nn(this.props.elRef,e)}}render(){let{props:e}=this,{liquid:t,liquidIsAbsolute:n}=e,s=t&&n,r=["fc-scroller"];return t&&(n?r.push("fc-scroller-liquid-absolute"):r.push("fc-scroller-liquid")),x("div",{ref:this.handleEl,className:r.join(" "),style:{overflowX:e.overflowX,overflowY:e.overflowY,left:s&&-(e.overcomeLeft||0)||"",right:s&&-(e.overcomeRight||0)||"",bottom:s&&-(e.overcomeBottom||0)||"",marginLeft:!s&&-(e.overcomeLeft||0)||"",marginRight:!s&&-(e.overcomeRight||0)||"",marginBottom:!s&&-(e.overcomeBottom||0)||"",maxHeight:e.maxHeight||""}},e.children)}needsXScrolling(){if(Qy.test(this.props.overflowX))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),{children:n}=e;for(let s=0;s<n.length;s+=1)if(n[s].getBoundingClientRect().width>t)return!0;return!1}needsYScrolling(){if(Qy.test(this.props.overflowY))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),{children:n}=e;for(let s=0;s<n.length;s+=1)if(n[s].getBoundingClientRect().height>t)return!0;return!1}getXScrollbarWidth(){return Qy.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight}getYScrollbarWidth(){return Qy.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth}},Ot=class{constructor(e){this.masterCallback=e,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=(t,n)=>{let{depths:s,currentMap:r}=this,o=!1,a=!1;t!==null?(o=n in r,r[n]=t,s[n]=(s[n]||0)+1,a=!0):(s[n]-=1,s[n]||(delete r[n],delete this.callbackMap[n],o=!0)),this.masterCallback&&(o&&this.masterCallback(null,String(n)),a&&this.masterCallback(t,String(n)))}}createRef(e){let t=this.callbackMap[e];return t||(t=this.callbackMap[e]=n=>{this.handleValue(n,String(e))}),t}collect(e,t,n){return $I(this.currentMap,e,t,n)}getAll(){return yv(this.currentMap)}};function gD(i){let e=PI(i,".fc-scrollgrid-shrink"),t=0;for(let n of e)t=Math.max(t,CU(n));return Math.ceil(t)}function e_(i,e){return i.liquid&&e.liquid}function mD(i,e){return e.maxHeight!=null||e_(i,e)}function yD(i,e,t,n){let{expandRows:s}=t;return typeof e.content=="function"?e.content(t):x("table",{role:"presentation",className:[e.tableClassName,i.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:t.tableMinWidth,width:t.clientWidth,height:s?t.clientHeight:""}},t.tableColGroupNode,x(n?"thead":"tbody",{role:"presentation"},typeof e.rowContent=="function"?e.rowContent(t):e.rowContent))}function vD(i,e){return bi(i,e,Ft)}function ED(i,e){let t=[];for(let n of i){let s=n.span||1;for(let r=0;r<s;r+=1)t.push(x("col",{style:{width:n.width==="shrink"?bD(e):n.width||"",minWidth:n.minWidth||""}}))}return x("colgroup",{},...t)}function bD(i){return i==null?4:i}function AD(i){for(let e of i)if(e.width==="shrink")return!0;return!1}function wD(i,e){let t=["fc-scrollgrid",e.theme.getClass("table")];return i&&t.push("fc-scrollgrid-liquid"),t}function SD(i,e){let t=["fc-scrollgrid-section",`fc-scrollgrid-section-${i.type}`,i.className];return e&&i.liquid&&i.maxHeight==null&&t.push("fc-scrollgrid-section-liquid"),i.isSticky&&t.push("fc-scrollgrid-section-sticky"),t}function Ic(i){return x("div",{className:"fc-scrollgrid-sticky-shim",style:{width:i.clientWidth,minWidth:i.tableMinWidth}})}function ha(i){let{stickyHeaderDates:e}=i;return(e==null||e==="auto")&&(e=i.height==="auto"||i.viewHeight==="auto"),e}function Af(i){let{stickyFooterScrollbar:e}=i;return(e==null||e==="auto")&&(e=i.height==="auto"||i.viewHeight==="auto"),e}var ur=class extends te{constructor(){super(...arguments),this.processCols=$(e=>e,vD),this.renderMicroColGroup=$(ED),this.scrollerRefs=new Ot,this.scrollerElRefs=new Ot(this._handleScrollerEl.bind(this)),this.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},this.handleSizing=()=>{this.safeSetState(Object.assign({shrinkWidth:this.computeShrinkWidth()},this.computeScrollerDims()))}}render(){let{props:e,state:t,context:n}=this,s=e.sections||[],r=this.processCols(e.cols),o=this.renderMicroColGroup(r,t.shrinkWidth),a=wD(e.liquid,n);e.collapsibleWidth&&a.push("fc-scrollgrid-collapsible");let l=s.length,c=0,d,h=[],p=[],m=[];for(;c<l&&(d=s[c]).type==="header";)h.push(this.renderSection(d,o,!0)),c+=1;for(;c<l&&(d=s[c]).type==="body";)p.push(this.renderSection(d,o,!1)),c+=1;for(;c<l&&(d=s[c]).type==="footer";)m.push(this.renderSection(d,o,!0)),c+=1;let y=!WS(),v={role:"rowgroup"};return x("table",{role:"grid",className:a.join(" "),style:{height:e.height}},!!(!y&&h.length)&&x("thead",v,...h),!!(!y&&p.length)&&x("tbody",v,...p),!!(!y&&m.length)&&x("tfoot",v,...m),y&&x("tbody",v,...h,...p,...m))}renderSection(e,t,n){return"outerContent"in e?x(ae,{key:e.key},e.outerContent):x("tr",{key:e.key,role:"presentation",className:SD(e,this.props.liquid).join(" ")},this.renderChunkTd(e,t,e.chunk,n))}renderChunkTd(e,t,n,s){if("outerContent"in n)return n.outerContent;let{props:r}=this,{forceYScrollbars:o,scrollerClientWidths:a,scrollerClientHeights:l}=this.state,c=mD(r,e),d=e_(r,e),h=r.liquid?o?"scroll":c?"auto":"hidden":"visible",p=e.key,m=yD(e,n,{tableColGroupNode:t,tableMinWidth:"",clientWidth:!r.collapsibleWidth&&a[p]!==void 0?a[p]:null,clientHeight:l[p]!==void 0?l[p]:null,expandRows:e.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:()=>{}},s);return x(s?"th":"td",{ref:n.elRef,role:"presentation"},x("div",{className:`fc-scroller-harness${d?" fc-scroller-harness-liquid":""}`},x(Ac,{ref:this.scrollerRefs.createRef(p),elRef:this.scrollerElRefs.createRef(p),overflowY:h,overflowX:r.liquid?"hidden":"visible",maxHeight:e.maxHeight,liquid:d,liquidIsAbsolute:!0},m)))}_handleScrollerEl(e,t){let n=cB(this.props.sections,t);n&&nn(n.chunk.scrollerElRef,e)}componentDidMount(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)}componentDidUpdate(){this.handleSizing()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}computeShrinkWidth(){return AD(this.props.cols)?gD(this.scrollerElRefs.getAll()):0}computeScrollerDims(){let e=oD(),{scrollerRefs:t,scrollerElRefs:n}=this,s=!1,r={},o={};for(let a in t.currentMap){let l=t.currentMap[a];if(l&&l.needsYScrolling()){s=!0;break}}for(let a of this.props.sections){let l=a.key,c=n.currentMap[l];if(c){let d=c.parentNode;r[l]=Math.floor(d.getBoundingClientRect().width-(s?e.y:0)),o[l]=Math.floor(d.getBoundingClientRect().height)}}return{forceYScrollbars:s,scrollerClientWidths:r,scrollerClientHeights:o}}};ur.addStateEquality({scrollerClientWidths:Ft,scrollerClientHeights:Ft});function cB(i,e){for(let t of i)if(t.key===e)return t;return null}var fs=class extends te{constructor(){super(...arguments),this.buildPublicEvent=$((e,t,n)=>new me(e,t,n)),this.handleEl=e=>{this.el=e,nn(this.props.elRef,e),e&&TI(e,this.props.seg)}}render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,{eventRange:r}=s,{ui:o}=r,a={event:this.buildPublicEvent(t,r.def,r.instance),view:t.viewApi,timeText:e.timeText,textColor:o.textColor,backgroundColor:o.backgroundColor,borderColor:o.borderColor,isDraggable:!e.disableDragging&&UH(s,t),isStartResizable:!e.disableResizing&&HH(s,t),isEndResizable:!e.disableResizing&&BH(s),isMirror:!!(e.isDragging||e.isResizing||e.isDateSelecting),isStart:!!s.isStart,isEnd:!!s.isEnd,isPast:!!e.isPast,isFuture:!!e.isFuture,isToday:!!e.isToday,isSelected:!!e.isSelected,isDragging:!!e.isDragging,isResizing:!!e.isResizing};return x(xe,{elRef:this.handleEl,elTag:e.elTag,elAttrs:e.elAttrs,elClasses:[...VH(a),...s.eventRange.ui.classNames,...e.elClasses||[]],elStyle:e.elStyle,renderProps:a,generatorName:"eventContent",customGenerator:n.eventContent,defaultGenerator:e.defaultGenerator,classNameGenerator:n.eventClassNames,didMount:n.eventDidMount,willUnmount:n.eventWillUnmount},e.children)}componentDidUpdate(e){this.el&&this.props.seg!==e.seg&&TI(this.el,this.props.seg)}},hr=class extends te{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,{ui:r}=s.eventRange,o=n.eventTimeFormat||e.defaultTimeFormat,a=vr(s,o,t,e.defaultDisplayEventTime,e.defaultDisplayEventEnd);return x(fs,Object.assign({},e,{elTag:"a",elStyle:{borderColor:r.borderColor,backgroundColor:r.backgroundColor},elAttrs:Tc(s,t),defaultGenerator:dB,timeText:a}),(l,c)=>x(ae,null,x(l,{elTag:"div",elClasses:["fc-event-main"],elStyle:{color:c.textColor}}),!!c.isStartResizable&&x("div",{className:"fc-event-resizer fc-event-resizer-start"}),!!c.isEndResizable&&x("div",{className:"fc-event-resizer fc-event-resizer-end"})))}};hr.addPropsEquality({seg:Ft});function dB(i){return x("div",{className:"fc-event-main-frame"},i.timeText&&x("div",{className:"fc-event-time"},i.timeText),x("div",{className:"fc-event-title-container"},x("div",{className:"fc-event-title fc-sticky"},i.event.title||x(ae,null,"\xA0"))))}var wf=i=>x(En.Consumer,null,e=>{let{options:t}=e,n={isAxis:i.isAxis,date:e.dateEnv.toDate(i.date),view:e.viewApi};return x(xe,{elRef:i.elRef,elTag:i.elTag||"div",elAttrs:i.elAttrs,elClasses:i.elClasses,elStyle:i.elStyle,renderProps:n,generatorName:"nowIndicatorContent",customGenerator:t.nowIndicatorContent,classNameGenerator:t.nowIndicatorClassNames,didMount:t.nowIndicatorDidMount,willUnmount:t.nowIndicatorWillUnmount},i.children)}),uB=ue({day:"numeric"}),fr=class extends te{constructor(){super(...arguments),this.refineRenderProps=Sc(hB)}render(){let{props:e,context:t}=this,{options:n}=t,s=this.refineRenderProps({date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,isMonthStart:e.isMonthStart||!1,showDayNumber:e.showDayNumber,extraRenderProps:e.extraRenderProps,viewApi:t.viewApi,dateEnv:t.dateEnv,monthStartFormat:n.monthStartFormat});return x(xe,{elRef:e.elRef,elTag:e.elTag,elAttrs:Object.assign(Object.assign({},e.elAttrs),s.isDisabled?{}:{"data-date":gr(e.date)}),elClasses:[...Rc(s,t.theme),...e.elClasses||[]],elStyle:e.elStyle,renderProps:s,generatorName:"dayCellContent",customGenerator:n.dayCellContent,defaultGenerator:e.defaultGenerator,classNameGenerator:s.isDisabled?void 0:n.dayCellClassNames,didMount:n.dayCellDidMount,willUnmount:n.dayCellWillUnmount},e.children)}};function Dc(i){return!!(i.dayCellContent||aS("dayCellContent",i))}function hB(i){let{date:e,dateEnv:t,dateProfile:n,isMonthStart:s}=i,r=yf(e,i.todayRange,null,n),o=i.showDayNumber?t.format(e,s?i.monthStartFormat:uB):"";return Object.assign(Object.assign(Object.assign({date:t.toDate(e),view:i.viewApi},r),{isMonthStart:s,dayNumberText:o}),i.extraRenderProps)}var la=class extends te{render(){let{props:e}=this,{seg:t}=e;return x(fs,{elTag:"div",elClasses:["fc-bg-event"],elStyle:{backgroundColor:t.eventRange.ui.backgroundColor},defaultGenerator:fB,seg:t,timeText:"",isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:e.isPast,isFuture:e.isFuture,isToday:e.isToday,disableDragging:!0,disableResizing:!0})}};function fB(i){let{title:e}=i.event;return e&&x("div",{className:"fc-event-title"},i.event.title)}function Sf(i){return x("div",{className:`fc-${i}`})}var _f=i=>x(En.Consumer,null,e=>{let{dateEnv:t,options:n}=e,{date:s}=i,r=n.weekNumberFormat||i.defaultFormat,o=t.computeWeekNumber(s),a=t.format(s,r),l={num:o,text:a,date:s};return x(xe,{elRef:i.elRef,elTag:i.elTag,elAttrs:i.elAttrs,elClasses:i.elClasses,elStyle:i.elStyle,renderProps:l,generatorName:"weekNumberContent",customGenerator:n.weekNumberContent,defaultGenerator:pB,classNameGenerator:n.weekNumberClassNames,didMount:n.weekNumberDidMount,willUnmount:n.weekNumberWillUnmount},i.children)});function pB(i){return i.text}var eS=10,cS=class extends te{constructor(){super(...arguments),this.state={titleId:vn()},this.handleRootEl=e=>{this.rootEl=e,this.props.elRef&&nn(this.props.elRef,e)},this.handleDocumentMouseDown=e=>{let t=uv(e);this.rootEl.contains(t)||this.handleCloseClick()},this.handleDocumentKeyDown=e=>{e.key==="Escape"&&this.handleCloseClick()},this.handleCloseClick=()=>{let{onClose:e}=this.props;e&&e()}}render(){let{theme:e,options:t}=this.context,{props:n,state:s}=this,r=["fc-popover",e.getClass("popover")].concat(n.extraClassNames||[]);return pI(x("div",Object.assign({},n.extraAttrs,{id:n.id,className:r.join(" "),"aria-labelledby":s.titleId,ref:this.handleRootEl}),x("div",{className:"fc-popover-header "+e.getClass("popoverHeader")},x("span",{className:"fc-popover-title",id:s.titleId},n.title),x("span",{className:"fc-popover-close "+e.getIconClass("close"),title:t.closeHint,onClick:this.handleCloseClick})),x("div",{className:"fc-popover-body "+e.getClass("popoverContent")},n.children)),n.parentEl)}componentDidMount(){document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("keydown",this.handleDocumentKeyDown),this.updateSize()}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("keydown",this.handleDocumentKeyDown)}updateSize(){let{isRtl:e}=this.context,{alignmentEl:t,alignGridTop:n}=this.props,{rootEl:s}=this,r=tB(t);if(r){let o=s.getBoundingClientRect(),a=n?Ve(t,".fc-scrollgrid").getBoundingClientRect().top:r.top,l=e?r.right-o.width:r.left;a=Math.max(a,eS),l=Math.min(l,document.documentElement.clientWidth-eS-o.width),l=Math.max(l,eS);let c=s.offsetParent.getBoundingClientRect();da(s,{top:a-c.top,left:l-c.left})}}},dS=class extends st{constructor(){super(...arguments),this.handleRootEl=e=>{this.rootEl=e,e?this.context.registerInteractiveComponent(this,{el:e,useEventCenter:!1}):this.context.unregisterInteractiveComponent(this)}}render(){let{options:e,dateEnv:t}=this.context,{props:n}=this,{startDate:s,todayRange:r,dateProfile:o}=n,a=t.format(s,e.dayPopoverFormat);return x(fr,{elRef:this.handleRootEl,date:s,dateProfile:o,todayRange:r},(l,c,d)=>x(cS,{elRef:d.ref,id:n.id,title:a,extraClassNames:["fc-more-popover"].concat(d.className||[]),extraAttrs:d,parentEl:n.parentEl,alignmentEl:n.alignmentEl,alignGridTop:n.alignGridTop,onClose:n.onClose},Dc(e)&&x(l,{elTag:"div",elClasses:["fc-more-popover-misc"]}),n.children))}queryHit(e,t,n,s){let{rootEl:r,props:o}=this;return e>=0&&e<n&&t>=0&&t<s?{dateProfile:o.dateProfile,dateSpan:Object.assign({allDay:!o.forceTimed,range:{start:o.startDate,end:o.endDate}},o.extraDateSpan),dayEl:r,rect:{left:0,top:0,right:n,bottom:s},layer:1}:null}},ca=class extends te{constructor(){super(...arguments),this.state={isPopoverOpen:!1,popoverId:vn()},this.handleLinkEl=e=>{this.linkEl=e,this.props.elRef&&nn(this.props.elRef,e)},this.handleClick=e=>{let{props:t,context:n}=this,{moreLinkClick:s}=n.options,r=xI(t).start;function o(a){let{def:l,instance:c,range:d}=a.eventRange;return{event:new me(n,l,c),start:n.dateEnv.toDate(d.start),end:n.dateEnv.toDate(d.end),isStart:a.isStart,isEnd:a.isEnd}}typeof s=="function"&&(s=s({date:r,allDay:!!t.allDayDate,allSegs:t.allSegs.map(o),hiddenSegs:t.hiddenSegs.map(o),jsEvent:e,view:n.viewApi})),!s||s==="popover"?this.setState({isPopoverOpen:!0}):typeof s=="string"&&n.calendarApi.zoomTo(r,s)},this.handlePopoverClose=()=>{this.setState({isPopoverOpen:!1})}}render(){let{props:e,state:t}=this;return x(En.Consumer,null,n=>{let{viewApi:s,options:r,calendarApi:o}=n,{moreLinkText:a}=r,{moreCnt:l}=e,c=xI(e),d=typeof a=="function"?a.call(o,l):`+${l} ${a}`,h=wc(r.moreLinkHint,[l],d),p={num:l,shortText:`+${l}`,text:d,view:s};return x(ae,null,!!e.moreCnt&&x(xe,{elTag:e.elTag||"a",elRef:this.handleLinkEl,elClasses:[...e.elClasses||[],"fc-more-link"],elStyle:e.elStyle,elAttrs:Object.assign(Object.assign(Object.assign({},e.elAttrs),NI(this.handleClick)),{title:h,"aria-expanded":t.isPopoverOpen,"aria-controls":t.isPopoverOpen?t.popoverId:""}),renderProps:p,generatorName:"moreLinkContent",customGenerator:r.moreLinkContent,defaultGenerator:e.defaultGenerator||gB,classNameGenerator:r.moreLinkClassNames,didMount:r.moreLinkDidMount,willUnmount:r.moreLinkWillUnmount},e.children),t.isPopoverOpen&&x(dS,{id:t.popoverId,startDate:c.start,endDate:c.end,dateProfile:e.dateProfile,todayRange:e.todayRange,extraDateSpan:e.extraDateSpan,parentEl:this.parentEl,alignmentEl:e.alignmentElRef?e.alignmentElRef.current:this.linkEl,alignGridTop:e.alignGridTop,forceTimed:e.forceTimed,onClose:this.handlePopoverClose},e.popoverContent()))})}componentDidMount(){this.updateParentEl()}componentDidUpdate(){this.updateParentEl()}updateParentEl(){this.linkEl&&(this.parentEl=Ve(this.linkEl,".fc-view-harness"))}};function gB(i){return i.text}function xI(i){if(i.allDayDate)return{start:i.allDayDate,end:be(i.allDayDate,1)};let{hiddenSegs:e}=i;return{start:xv(e),end:yB(e)}}function xv(i){return i.reduce(mB).eventRange.range.start}function mB(i,e){return i.eventRange.range.start<e.eventRange.range.start?i:e}function yB(i){return i.reduce(vB).eventRange.range.end}function vB(i,e){return i.eventRange.range.end>e.eventRange.range.end?i:e}var EB=[],DD={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},MD=Object.assign(Object.assign({},DD),{buttonHints:{prev:"Previous $0",next:"Next $0",today(i,e){return e==="day"?"Today":`This ${i}`}},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint(i){return`Show ${i} more event${i===1?"":"s"}`}});function bB(i){let e=i.length>0?i[0].code:"en",t=EB.concat(i),n={en:MD};for(let s of t)n[s.code]=s;return{map:n,defaultCode:e}}function PD(i,e){return typeof i=="object"&&!Array.isArray(i)?kD(i.code,[i.code],i):AB(i,e)}function AB(i,e){let t=[].concat(i||[]),n=wB(t,e)||MD;return kD(i,t,n)}function wB(i,e){for(let t=0;t<i.length;t+=1){let n=i[t].toLocaleLowerCase().split("-");for(let s=n.length;s>0;s-=1){let r=n.slice(0,s).join("-");if(e[r])return e[r]}}return null}function kD(i,e,t){let n=mv([DD,t],["buttonText"]);delete n.code;let{week:s}=n;return delete n.week,{codeArg:i,codes:e,week:s,simpleNumberFormat:new Intl.NumberFormat(i),options:n}}function Ut(i){return{id:ps(),name:i.name,premiumReleaseDate:i.premiumReleaseDate?new Date(i.premiumReleaseDate):void 0,deps:i.deps||[],reducers:i.reducers||[],isLoadingFuncs:i.isLoadingFuncs||[],contextInit:[].concat(i.contextInit||[]),eventRefiners:i.eventRefiners||{},eventDefMemberAdders:i.eventDefMemberAdders||[],eventSourceRefiners:i.eventSourceRefiners||{},isDraggableTransformers:i.isDraggableTransformers||[],eventDragMutationMassagers:i.eventDragMutationMassagers||[],eventDefMutationAppliers:i.eventDefMutationAppliers||[],dateSelectionTransformers:i.dateSelectionTransformers||[],datePointTransforms:i.datePointTransforms||[],dateSpanTransforms:i.dateSpanTransforms||[],views:i.views||{},viewPropsTransformers:i.viewPropsTransformers||[],isPropsValid:i.isPropsValid||null,externalDefTransforms:i.externalDefTransforms||[],viewContainerAppends:i.viewContainerAppends||[],eventDropTransformers:i.eventDropTransformers||[],componentInteractions:i.componentInteractions||[],calendarInteractions:i.calendarInteractions||[],themeClasses:i.themeClasses||{},eventSourceDefs:i.eventSourceDefs||[],cmdFormatter:i.cmdFormatter,recurringTypes:i.recurringTypes||[],namedTimeZonedImpl:i.namedTimeZonedImpl,initialView:i.initialView||"",elementDraggingImpl:i.elementDraggingImpl,optionChangeHandlers:i.optionChangeHandlers||{},scrollGridImpl:i.scrollGridImpl||null,listenerRefiners:i.listenerRefiners||{},optionRefiners:i.optionRefiners||{},propSetHandlers:i.propSetHandlers||{}}}function SB(i,e){let t={},n={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function s(r){for(let o of r){let a=o.name,l=t[a];l===void 0?(t[a]=o.id,s(o.deps),n=CB(n,o)):l!==o.id&&console.warn(`Duplicate plugin '${a}'`)}}return i&&s(i),s(e),n}function _B(){let i=[],e=[],t;return(n,s)=>((!t||!bi(n,i)||!bi(s,e))&&(t=SB(n,s)),i=n,e=s,t)}function CB(i,e){return{premiumReleaseDate:TB(i.premiumReleaseDate,e.premiumReleaseDate),reducers:i.reducers.concat(e.reducers),isLoadingFuncs:i.isLoadingFuncs.concat(e.isLoadingFuncs),contextInit:i.contextInit.concat(e.contextInit),eventRefiners:Object.assign(Object.assign({},i.eventRefiners),e.eventRefiners),eventDefMemberAdders:i.eventDefMemberAdders.concat(e.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},i.eventSourceRefiners),e.eventSourceRefiners),isDraggableTransformers:i.isDraggableTransformers.concat(e.isDraggableTransformers),eventDragMutationMassagers:i.eventDragMutationMassagers.concat(e.eventDragMutationMassagers),eventDefMutationAppliers:i.eventDefMutationAppliers.concat(e.eventDefMutationAppliers),dateSelectionTransformers:i.dateSelectionTransformers.concat(e.dateSelectionTransformers),datePointTransforms:i.datePointTransforms.concat(e.datePointTransforms),dateSpanTransforms:i.dateSpanTransforms.concat(e.dateSpanTransforms),views:Object.assign(Object.assign({},i.views),e.views),viewPropsTransformers:i.viewPropsTransformers.concat(e.viewPropsTransformers),isPropsValid:e.isPropsValid||i.isPropsValid,externalDefTransforms:i.externalDefTransforms.concat(e.externalDefTransforms),viewContainerAppends:i.viewContainerAppends.concat(e.viewContainerAppends),eventDropTransformers:i.eventDropTransformers.concat(e.eventDropTransformers),calendarInteractions:i.calendarInteractions.concat(e.calendarInteractions),componentInteractions:i.componentInteractions.concat(e.componentInteractions),themeClasses:Object.assign(Object.assign({},i.themeClasses),e.themeClasses),eventSourceDefs:i.eventSourceDefs.concat(e.eventSourceDefs),cmdFormatter:e.cmdFormatter||i.cmdFormatter,recurringTypes:i.recurringTypes.concat(e.recurringTypes),namedTimeZonedImpl:e.namedTimeZonedImpl||i.namedTimeZonedImpl,initialView:i.initialView||e.initialView,elementDraggingImpl:i.elementDraggingImpl||e.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},i.optionChangeHandlers),e.optionChangeHandlers),scrollGridImpl:e.scrollGridImpl||i.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},i.listenerRefiners),e.listenerRefiners),optionRefiners:Object.assign(Object.assign({},i.optionRefiners),e.optionRefiners),propSetHandlers:Object.assign(Object.assign({},i.propSetHandlers),e.propSetHandlers)}}function TB(i,e){return i===void 0?e:e===void 0?i:new Date(Math.max(i.valueOf(),e.valueOf()))}var _i=class extends us{};_i.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"};_i.prototype.baseIconClass="fc-icon";_i.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"};_i.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"};_i.prototype.iconOverrideOption="buttonIcons";_i.prototype.iconOverrideCustomButtonOption="icon";_i.prototype.iconOverridePrefix="fc-icon-";function xB(i,e){let t={},n;for(n in i)n_(n,t,i,e);for(n in e)n_(n,t,i,e);return t}function n_(i,e,t,n){if(e[i])return e[i];let s=RB(i,e,t,n);return s&&(e[i]=s),s}function RB(i,e,t,n){let s=t[i],r=n[i],o=d=>s&&s[d]!==null?s[d]:r&&r[d]!==null?r[d]:null,a=o("component"),l=o("superType"),c=null;if(l){if(l===i)throw new Error("Can't have a custom view type that references itself");c=n_(l,e,t,n)}return!a&&c&&(a=c.component),a?{type:i,component:a,defaults:Object.assign(Object.assign({},c?c.defaults:{}),s?s.rawOptions:{}),overrides:Object.assign(Object.assign({},c?c.overrides:{}),r?r.rawOptions:{})}:null}function _D(i){return yn(i,IB)}function IB(i){let e=typeof i=="function"?{component:i}:i,{component:t}=e;return e.content?t=CD(e):t&&!(t.prototype instanceof te)&&(t=CD(Object.assign(Object.assign({},e),{content:t}))),{superType:e.type,component:t,rawOptions:e}}function CD(i){return e=>x(En.Consumer,null,t=>x(xe,{elTag:"div",elClasses:PS(t.viewSpec),renderProps:Object.assign(Object.assign({},e),{nextDayThreshold:t.options.nextDayThreshold}),generatorName:void 0,customGenerator:i.content,classNameGenerator:i.classNames,didMount:i.didMount,willUnmount:i.willUnmount}))}function DB(i,e,t,n){let s=_D(i),r=_D(e.views),o=xB(s,r);return yn(o,a=>MB(a,r,e,t,n))}function MB(i,e,t,n,s){let r=i.overrides.duration||i.defaults.duration||n.duration||t.duration,o=null,a="",l="",c={};if(r&&(o=PB(r),o)){let p=zh(o);a=p.unit,p.value===1&&(l=a,c=e[a]?e[a].rawOptions:{})}let d=p=>{let m=p.buttonText||{},y=i.defaults.buttonTextKey;return y!=null&&m[y]!=null?m[y]:m[i.type]!=null?m[i.type]:m[l]!=null?m[l]:null},h=p=>{let m=p.buttonHints||{},y=i.defaults.buttonTextKey;return y!=null&&m[y]!=null?m[y]:m[i.type]!=null?m[i.type]:m[l]!=null?m[l]:null};return{type:i.type,component:i.component,duration:o,durationUnit:a,singleUnit:l,optionDefaults:i.defaults,optionOverrides:Object.assign(Object.assign({},c),i.overrides),buttonTextOverride:d(n)||d(t)||i.overrides.buttonText,buttonTextDefault:d(s)||i.defaults.buttonText||d(mr)||i.type,buttonTitleOverride:h(n)||h(t)||i.overrides.buttonHint,buttonTitleDefault:h(s)||i.defaults.buttonHint||h(mr)}}var TD={};function PB(i){let e=JSON.stringify(i),t=TD[e];return t===void 0&&(t=ee(i),TD[e]=t),t}function kB(i,e){switch(e.type){case"CHANGE_VIEW_TYPE":i=e.viewType}return i}function NB(i,e){switch(e.type){case"CHANGE_DATE":return e.dateMarker;default:return i}}function FB(i,e,t){let n=i.initialDate;return n!=null?e.createMarker(n):t.getDateMarker()}function LB(i,e){switch(e.type){case"SET_OPTION":return Object.assign(Object.assign({},i),{[e.optionName]:e.rawOptionValue});default:return i}}function OB(i,e,t,n){let s;switch(e.type){case"CHANGE_VIEW_TYPE":return n.build(e.dateMarker||t);case"CHANGE_DATE":return n.build(e.dateMarker);case"PREV":if(s=n.buildPrev(i,t),s.isValid)return s;break;case"NEXT":if(s=n.buildNext(i,t),s.isValid)return s;break}return i}function UB(i,e,t){let n=e?e.activeRange:null;return FD({},qB(i,t),n,t)}function HB(i,e,t,n){let s=t?t.activeRange:null;switch(e.type){case"ADD_EVENT_SOURCES":return FD(i,e.sources,s,n);case"REMOVE_EVENT_SOURCE":return VB(i,e.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return t?LD(i,s,n):i;case"FETCH_EVENT_SOURCES":return u_(i,e.sourceIds?IS(e.sourceIds):OD(i,n),s,e.isRefetch||!1,n);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return zB(i,e.sourceId,e.fetchId,e.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return i}}function BB(i,e,t){let n=e?e.activeRange:null;return u_(i,OD(i,t),n,!0,t)}function ND(i){for(let e in i)if(i[e].isFetching)return!0;return!1}function FD(i,e,t,n){let s={};for(let r of e)s[r.sourceId]=r;return t&&(s=LD(s,t,n)),Object.assign(Object.assign({},i),s)}function VB(i,e){return ds(i,t=>t.sourceId!==e)}function LD(i,e,t){return u_(i,ds(i,n=>GB(n,e,t)),e,!1,t)}function GB(i,e,t){return UD(i,t)?!t.options.lazyFetching||!i.fetchRange||i.isFetching||e.start<i.fetchRange.start||e.end>i.fetchRange.end:!i.latestFetchId}function u_(i,e,t,n,s){let r={};for(let o in i){let a=i[o];e[o]?r[o]=$B(a,t,n,s):r[o]=a}return r}function $B(i,e,t,n){let{options:s,calendarApi:r}=n,o=n.pluginHooks.eventSourceDefs[i.sourceDefId],a=ps();return o.fetch({eventSource:i,range:e,isRefetch:t,context:n},l=>{let{rawEvents:c}=l;s.eventSourceSuccess&&(c=s.eventSourceSuccess.call(r,c,l.response)||c),i.success&&(c=i.success.call(r,c,l.response)||c),n.dispatch({type:"RECEIVE_EVENTS",sourceId:i.sourceId,fetchId:a,fetchRange:e,rawEvents:c})},l=>{let c=!1;s.eventSourceFailure&&(s.eventSourceFailure.call(r,l),c=!0),i.failure&&(i.failure(l),c=!0),c||console.warn(l.message,l),n.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:i.sourceId,fetchId:a,fetchRange:e,error:l})}),Object.assign(Object.assign({},i),{isFetching:!0,latestFetchId:a})}function zB(i,e,t,n){let s=i[e];return s&&t===s.latestFetchId?Object.assign(Object.assign({},i),{[e]:Object.assign(Object.assign({},s),{isFetching:!1,fetchRange:n})}):i}function OD(i,e){return ds(i,t=>UD(t,e))}function qB(i,e){let t=OS(e),n=[].concat(i.eventSources||[]),s=[];i.initialEvents&&n.unshift(i.initialEvents),i.events&&n.unshift(i.events);for(let r of n){let o=LS(r,e,t);o&&s.push(o)}return s}function UD(i,e){return!e.pluginHooks.eventSourceDefs[i.sourceDefId].ignoreRange}function WB(i,e){switch(e.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return e.selection;default:return i}}function YB(i,e){switch(e.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return e.eventInstanceId;default:return i}}function KB(i,e){let t;switch(e.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return i}}function XB(i,e){let t;switch(e.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return i}}function JB(i,e,t,n,s){let r=i.headerToolbar?xD(i.headerToolbar,i,e,t,n,s):null,o=i.footerToolbar?xD(i.footerToolbar,i,e,t,n,s):null;return{header:r,footer:o}}function xD(i,e,t,n,s,r){let o={},a=[],l=!1;for(let c in i){let d=i[c],h=ZB(d,e,t,n,s,r);o[c]=h.widgets,a.push(...h.viewsWithButtons),l=l||h.hasTitle}return{sectionWidgets:o,viewsWithButtons:a,hasTitle:l}}function ZB(i,e,t,n,s,r){let o=e.direction==="rtl",a=e.customButtons||{},l=t.buttonText||{},c=e.buttonText||{},d=t.buttonHints||{},h=e.buttonHints||{},p=i?i.split(" "):[],m=[],y=!1;return{widgets:p.map(b=>b.split(",").map(w=>{if(w==="title")return y=!0,{buttonName:w};let _,C,T,R,D,I;if(_=a[w])T=k=>{_.click&&_.click.call(k.target,k,k.target)},(R=n.getCustomButtonIconClass(_))||(R=n.getIconClass(w,o))||(D=_.text),I=_.hint||_.text;else if(C=s[w]){m.push(w),T=()=>{r.changeView(w)},(D=C.buttonTextOverride)||(R=n.getIconClass(w,o))||(D=C.buttonTextDefault);let k=C.buttonTextOverride||C.buttonTextDefault;I=wc(C.buttonTitleOverride||C.buttonTitleDefault||e.viewHint,[k,w],k)}else if(r[w])if(T=()=>{r[w]()},(D=l[w])||(R=n.getIconClass(w,o))||(D=c[w]),w==="prevYear"||w==="nextYear"){let k=w==="prevYear"?"prev":"next";I=wc(d[k]||h[k],[c.year||"year","year"],c[w])}else I=k=>wc(d[w]||h[w],[c[k]||k,k],c[w]);return{buttonName:w,buttonClick:T,buttonIcon:R,buttonText:D,buttonHint:I}})),viewsWithButtons:m,hasTitle:y}}var i_=class{constructor(e,t,n){this.type=e,this.getCurrentData=t,this.dateEnv=n}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(e){return this.getCurrentData().options[e]}},QB={ignoreRange:!0,parseMeta(i){return Array.isArray(i.events)?i.events:null},fetch(i,e){e({rawEvents:i.eventSource.meta})}},jB=Ut({name:"array-event-source",eventSourceDefs:[QB]}),eV={parseMeta(i){return typeof i.events=="function"?i.events:null},fetch(i,e,t){let{dateEnv:n}=i.context,s=i.eventSource.meta;zS(s.bind(null,$S(i.range,n)),r=>e({rawEvents:r}),t)}},tV=Ut({name:"func-event-source",eventSourceDefs:[eV]}),nV={method:String,extraParams:M,startParam:String,endParam:String,timeZoneParam:String},iV={parseMeta(i){return i.url&&(i.format==="json"||!i.format)?{url:i.url,format:"json",method:(i.method||"GET").toUpperCase(),extraParams:i.extraParams,startParam:i.startParam,endParam:i.endParam,timeZoneParam:i.timeZoneParam}:null},fetch(i,e,t){let{meta:n}=i.eventSource,s=rV(n,i.range,i.context);qS(n.method,n.url,s).then(([r,o])=>{e({rawEvents:r,response:o})},t)}},sV=Ut({name:"json-event-source",eventSourceRefiners:nV,eventSourceDefs:[iV]});function rV(i,e,t){let{dateEnv:n,options:s}=t,r,o,a,l,c={};return r=i.startParam,r==null&&(r=s.startParam),o=i.endParam,o==null&&(o=s.endParam),a=i.timeZoneParam,a==null&&(a=s.timeZoneParam),typeof i.extraParams=="function"?l=i.extraParams():l=i.extraParams||{},Object.assign(c,l),c[r]=n.formatIso(e.start),c[o]=n.formatIso(e.end),n.timeZone!=="local"&&(c[a]=n.timeZone),c}var oV={daysOfWeek:M,startTime:ee,endTime:ee,duration:ee,startRecur:M,endRecur:M},aV={parse(i,e){if(i.daysOfWeek||i.startTime||i.endTime||i.startRecur||i.endRecur){let t={daysOfWeek:i.daysOfWeek||null,startTime:i.startTime||null,endTime:i.endTime||null,startRecur:i.startRecur?e.createMarker(i.startRecur):null,endRecur:i.endRecur?e.createMarker(i.endRecur):null,dateEnv:e},n;return i.duration&&(n=i.duration),!n&&i.startTime&&i.endTime&&(n=HI(i.endTime,i.startTime)),{allDayGuess:!i.startTime&&!i.endTime,duration:n,typeData:t}}return null},expand(i,e,t){let n=tn(e,{start:i.startRecur,end:i.endRecur});return n?cV(i.daysOfWeek,i.startTime,i.dateEnv,t,n):[]}},lV=Ut({name:"simple-recurring-event",recurringTypes:[aV],eventRefiners:oV});function cV(i,e,t,n,s){let r=i?IS(i):null,o=de(s.start),a=s.end,l=[];for(e&&(e.milliseconds<0?a=be(a,1):e.milliseconds>=1e3*60*60*24&&(o=be(o,-1)));o<a;){let c;(!r||r[o.getUTCDay()])&&(e?c=n.add(o,e):c=o,l.push(n.createMarker(t.toDate(c)))),o=be(o,1)}return l}var dV=Ut({name:"change-handler",optionChangeHandlers:{events(i,e){RD([i],e)},eventSources:RD}});function RD(i,e){let t=yv(e.getCurrentData().eventSources);if(t.length===1&&i.length===1&&Array.isArray(t[0]._raw)&&Array.isArray(i[0])){e.dispatch({type:"RESET_RAW_EVENTS",sourceId:t[0].sourceId,rawEvents:i[0]});return}let n=[];for(let s of i){let r=!1;for(let o=0;o<t.length;o+=1)if(t[o]._raw===s){t.splice(o,1),r=!0;break}r||n.push(s)}for(let s of t)e.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:s.sourceId});for(let s of n)e.calendarApi.addEventSource(s)}function uV(i,e){e.emitter.trigger("datesSet",Object.assign(Object.assign({},$S(i.activeRange,e.dateEnv)),{view:e.viewApi}))}function hV(i,e){let{emitter:t}=e;t.hasHandlers("eventsSet")&&t.trigger("eventsSet",wi(i,e))}var fV=[jB,tV,sV,lV,dV,Ut({name:"misc",isLoadingFuncs:[i=>ND(i.eventSources)],propSetHandlers:{dateProfile:uV,eventStore:hV}})],s_=class{constructor(e,t){this.runTaskOption=e,this.drainedOption=t,this.queue=[],this.delayedRunner=new jo(this.drain.bind(this))}request(e,t){this.queue.push(e),this.delayedRunner.request(t)}pause(e){this.delayedRunner.pause(e)}resume(e,t){this.delayedRunner.resume(e,t)}drain(){let{queue:e}=this;for(;e.length;){let t=[],n;for(;n=e.shift();)this.runTask(n),t.push(n);this.drained(t)}}runTask(e){this.runTaskOption&&this.runTaskOption(e)}drained(e){this.drainedOption&&this.drainedOption(e)}};function pV(i,e,t){let n;return/^(year|month)$/.test(i.currentRangeUnit)?n=i.currentRange:n=i.activeRange,t.formatRange(n.start,n.end,ue(e.titleFormat||gV(i)),{isEndExclusive:i.isRangeAllDay,defaultSeparator:e.titleRangeSeparator})}function gV(i){let{currentRangeUnit:e}=i;if(e==="year")return{year:"numeric"};if(e==="month")return{year:"numeric",month:"long"};let t=Ec(i.currentRange.start,i.currentRange.end);return t!==null&&t>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}var Rv=class{constructor(){this.resetListeners=new Set}handleInput(e,t){let n=this.dateEnv;if(e!==n&&(typeof t=="function"?this.nowFn=t:n||(this.nowAnchorDate=e.toDate(t?e.createMarker(t):e.createNowMarker()),this.nowAnchorQueried=Date.now()),this.dateEnv=e,n))for(let s of this.resetListeners.values())s()}getDateMarker(){return this.nowAnchorDate?this.dateEnv.timestampToMarker(this.nowAnchorDate.valueOf()+(Date.now()-this.nowAnchorQueried)):this.dateEnv.createMarker(this.nowFn())}addResetListener(e){this.resetListeners.add(e)}removeResetListener(e){this.resetListeners.delete(e)}},r_=class{constructor(e){this.computeCurrentViewData=$(this._computeCurrentViewData),this.organizeRawLocales=$(bB),this.buildLocale=$(PD),this.buildPluginHooks=_B(),this.buildDateEnv=$(mV),this.buildTheme=$(yV),this.parseToolbars=$(JB),this.buildViewSpecs=$(DB),this.buildDateProfileGenerator=Sc(vV),this.buildViewApi=$(EV),this.buildViewUiProps=Sc(wV),this.buildEventUiBySource=$(bV,Ft),this.buildEventUiBases=$(AV),this.parseContextBusinessHours=Sc(SV),this.buildTitle=$(pV),this.nowManager=new Rv,this.emitter=new hs,this.actionRunner=new s_(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=p=>{this.actionRunner.request(p)},this.props=e,this.actionRunner.pause(),this.nowManager=new Rv;let t={},n=this.computeOptionsData(e.optionOverrides,t,e.calendarApi),s=n.calendarOptions.initialView||n.pluginHooks.initialView,r=this.computeCurrentViewData(s,n,e.optionOverrides,t);e.calendarApi.currentDataManager=this,this.emitter.setThisContext(e.calendarApi),this.emitter.setOptions(r.options);let o={nowManager:this.nowManager,dateEnv:n.dateEnv,options:n.calendarOptions,pluginHooks:n.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},a=FB(n.calendarOptions,n.dateEnv,this.nowManager),l=r.dateProfileGenerator.build(a);mn(l.activeRange,a)||(a=l.currentRange.start);for(let p of n.pluginHooks.contextInit)p(o);let c=UB(n.calendarOptions,l,o),d={dynamicOptionOverrides:t,currentViewType:s,currentDate:a,dateProfile:l,businessHours:this.parseContextBusinessHours(o),eventSources:c,eventUiBases:{},eventStore:yt(),renderableEventStore:yt(),dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(o).selectionConfig},h=Object.assign(Object.assign({},o),d);for(let p of n.pluginHooks.reducers)Object.assign(d,p(null,null,h));t_(d,o)&&this.emitter.trigger("loading",!0),this.state=d,this.updateData(),this.actionRunner.resume()}resetOptions(e,t){let{props:n}=this;t===void 0?n.optionOverrides=e:(n.optionOverrides=Object.assign(Object.assign({},n.optionOverrides||{}),e),this.optionsForRefining.push(...t)),(t===void 0||t.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(e){let{props:t,state:n,emitter:s}=this,r=LB(n.dynamicOptionOverrides,e),o=this.computeOptionsData(t.optionOverrides,r,t.calendarApi),a=kB(n.currentViewType,e),l=this.computeCurrentViewData(a,o,t.optionOverrides,r);t.calendarApi.currentDataManager=this,s.setThisContext(t.calendarApi),s.setOptions(l.options);let c={nowManager:this.nowManager,dateEnv:o.dateEnv,options:o.calendarOptions,pluginHooks:o.pluginHooks,calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:s,getCurrentData:this.getCurrentData},{currentDate:d,dateProfile:h}=n;this.data&&this.data.dateProfileGenerator!==l.dateProfileGenerator&&(h=l.dateProfileGenerator.build(d)),d=NB(d,e),h=OB(h,e,d,l.dateProfileGenerator),(e.type==="PREV"||e.type==="NEXT"||!mn(h.currentRange,d))&&(d=h.currentRange.start);let p=HB(n.eventSources,e,h,c),m=QI(n.eventStore,e,p,h,c),v=ND(p)&&!l.options.progressiveEventRendering&&n.renderableEventStore||m,{eventUiSingleBase:b,selectionConfig:w}=this.buildViewUiProps(c),_=this.buildEventUiBySource(p),C=this.buildEventUiBases(v.defs,b,_),T={dynamicOptionOverrides:r,currentViewType:a,currentDate:d,dateProfile:h,eventSources:p,eventStore:m,renderableEventStore:v,selectionConfig:w,eventUiBases:C,businessHours:this.parseContextBusinessHours(c),dateSelection:WB(n.dateSelection,e),eventSelection:YB(n.eventSelection,e),eventDrag:KB(n.eventDrag,e),eventResize:XB(n.eventResize,e)},R=Object.assign(Object.assign({},c),T);for(let k of o.pluginHooks.reducers)Object.assign(T,k(n,e,R));let D=t_(n,c),I=t_(T,c);!D&&I?s.trigger("loading",!0):D&&!I&&s.trigger("loading",!1),this.state=T,t.onAction&&t.onAction(e)}updateData(){let{props:e,state:t}=this,n=this.data,s=this.computeOptionsData(e.optionOverrides,t.dynamicOptionOverrides,e.calendarApi),r=this.computeCurrentViewData(t.currentViewType,s,e.optionOverrides,t.dynamicOptionOverrides),o=this.data=Object.assign(Object.assign(Object.assign({nowManager:this.nowManager,viewTitle:this.buildTitle(t.dateProfile,r.options,s.dateEnv),calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},s),r),t),a=s.pluginHooks.optionChangeHandlers,l=n&&n.calendarOptions,c=s.calendarOptions;if(l&&l!==c){l.timeZone!==c.timeZone&&(t.eventSources=o.eventSources=BB(o.eventSources,t.dateProfile,o),t.eventStore=o.eventStore=US(o.eventStore,n.dateEnv,o.dateEnv),t.renderableEventStore=o.renderableEventStore=US(o.renderableEventStore,n.dateEnv,o.dateEnv));for(let d in a)(this.optionsForHandling.indexOf(d)!==-1||l[d]!==c[d])&&a[d](c[d],o)}this.optionsForHandling=[],e.onData&&e.onData(o)}computeOptionsData(e,t,n){if(!this.optionsForRefining.length&&e===this.stableOptionOverrides&&t===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:s,pluginHooks:r,localeDefaults:o,availableLocaleData:a,extra:l}=this.processRawCalendarOptions(e,t);ID(l);let c=this.buildDateEnv(s.timeZone,s.locale,s.weekNumberCalculation,s.firstDay,s.weekText,r,a,s.defaultRangeSeparator),d=this.buildViewSpecs(r.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,o),h=this.buildTheme(s,r),p=this.parseToolbars(s,this.stableOptionOverrides,h,d,n);return this.stableCalendarOptionsData={calendarOptions:s,pluginHooks:r,dateEnv:c,viewSpecs:d,theme:h,toolbarConfig:p,localeDefaults:o,availableRawLocales:a.map}}processRawCalendarOptions(e,t){let{locales:n,locale:s}=pv([mr,e,t]),r=this.organizeRawLocales(n),o=r.map,a=this.buildLocale(s||r.defaultCode,o).options,l=this.buildPluginHooks(e.plugins||[],fV),c=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},TS),xS),RS),l.listenerRefiners),l.optionRefiners),d={},h=pv([mr,a,e,t]),p={},m=this.currentCalendarOptionsInput,y=this.currentCalendarOptionsRefined,v=!1;for(let b in h)this.optionsForRefining.indexOf(b)===-1&&(h[b]===m[b]||yr[b]&&b in m&&yr[b](m[b],h[b]))?p[b]=y[b]:c[b]?(p[b]=c[b](h[b]),v=!0):d[b]=m[b];return v&&(this.currentCalendarOptionsInput=h,this.currentCalendarOptionsRefined=p,this.stableOptionOverrides=e,this.stableDynamicOptionOverrides=t),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:l,availableLocaleData:r,localeDefaults:a,extra:d}}_computeCurrentViewData(e,t,n,s){let r=t.viewSpecs[e];if(!r)throw new Error(`viewType "${e}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:o,extra:a}=this.processRawViewOptions(r,t.pluginHooks,t.localeDefaults,n,s);ID(a),this.nowManager.handleInput(t.dateEnv,o.now);let l=this.buildDateProfileGenerator({dateProfileGeneratorClass:r.optionDefaults.dateProfileGeneratorClass,nowManager:this.nowManager,duration:r.duration,durationUnit:r.durationUnit,usesMinMaxTime:r.optionDefaults.usesMinMaxTime,dateEnv:t.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:o.slotMinTime,slotMaxTime:o.slotMaxTime,showNonCurrentDates:o.showNonCurrentDates,dayCount:o.dayCount,dateAlignment:o.dateAlignment,dateIncrement:o.dateIncrement,hiddenDays:o.hiddenDays,weekends:o.weekends,validRangeInput:o.validRange,visibleRangeInput:o.visibleRange,fixedWeekCount:o.fixedWeekCount}),c=this.buildViewApi(e,this.getCurrentData,t.dateEnv);return{viewSpec:r,options:o,dateProfileGenerator:l,viewApi:c}}processRawViewOptions(e,t,n,s,r){let o=pv([mr,e.optionDefaults,n,s,e.optionOverrides,r]),a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},TS),xS),RS),GI),t.listenerRefiners),t.optionRefiners),l={},c=this.currentViewOptionsInput,d=this.currentViewOptionsRefined,h=!1,p={};for(let m in o)o[m]===c[m]||yr[m]&&yr[m](o[m],c[m])?l[m]=d[m]:(o[m]===this.currentCalendarOptionsInput[m]||yr[m]&&yr[m](o[m],this.currentCalendarOptionsInput[m])?m in this.currentCalendarOptionsRefined&&(l[m]=this.currentCalendarOptionsRefined[m]):a[m]?l[m]=a[m](o[m]):p[m]=o[m],h=!0);return h&&(this.currentViewOptionsInput=o,this.currentViewOptionsRefined=l),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:p}}};function mV(i,e,t,n,s,r,o,a){let l=PD(e||o.defaultCode,o.map);return new qh({calendarSystem:"gregory",timeZone:i,namedTimeZoneImpl:r.namedTimeZonedImpl,locale:l,weekNumberCalculation:t,firstDay:n,weekText:s,cmdFormatter:r.cmdFormatter,defaultSeparator:a})}function yV(i,e){let t=e.themeClasses[i.themeSystem]||_i;return new t(i)}function vV(i){let e=i.dateProfileGeneratorClass||ea;return new e(i)}function EV(i,e,t){return new i_(i,e,t)}function bV(i){return yn(i,e=>e.ui)}function AV(i,e,t){let n={"":e};for(let s in i){let r=i[s];r.sourceId&&t[r.sourceId]&&(n[s]=t[r.sourceId])}return n}function wV(i){let{options:e}=i;return{eventUiSingleBase:Cc({display:e.eventDisplay,editable:e.editable,startEditable:e.eventStartEditable,durationEditable:e.eventDurationEditable,constraint:e.eventConstraint,overlap:typeof e.eventOverlap=="boolean"?e.eventOverlap:void 0,allow:e.eventAllow,backgroundColor:e.eventBackgroundColor,borderColor:e.eventBorderColor,textColor:e.eventTextColor,color:e.eventColor},i),selectionConfig:Cc({constraint:e.selectConstraint,overlap:typeof e.selectOverlap=="boolean"?e.selectOverlap:void 0,allow:e.selectAllow},i)}}function t_(i,e){for(let t of e.pluginHooks.isLoadingFuncs)if(t(i))return!0;return!1}function SV(i){return HS(i.options.businessHours,i)}function ID(i,e){for(let t in i)console.warn(`Unknown option '${t}'`+(e?` for view '${e}'`:""))}var o_=class extends te{render(){let e=this.props.widgetGroups.map(t=>this.renderWidgetGroup(t));return x("div",{className:"fc-toolbar-chunk"},...e)}renderWidgetGroup(e){let{props:t}=this,{theme:n}=this.context,s=[],r=!0;for(let o of e){let{buttonName:a,buttonClick:l,buttonText:c,buttonIcon:d,buttonHint:h}=o;if(a==="title")r=!1,s.push(x("h2",{className:"fc-toolbar-title",id:t.titleId},t.title));else{let p=a===t.activeButton,m=!t.isTodayEnabled&&a==="today"||!t.isPrevEnabled&&a==="prev"||!t.isNextEnabled&&a==="next",y=[`fc-${a}-button`,n.getClass("button")];p&&y.push(n.getClass("buttonActive")),s.push(x("button",{type:"button",title:typeof h=="function"?h(t.navUnit):h,disabled:m,"aria-pressed":p,className:y.join(" "),onClick:l},c||(d?x("span",{className:d,role:"img"}):"")))}}if(s.length>1){let o=r&&n.getClass("buttonGroup")||"";return x("div",{className:o},...s)}return s[0]}},Iv=class extends te{render(){let{model:e,extraClassName:t}=this.props,n=!1,s,r,o=e.sectionWidgets,a=o.center;return o.left?(n=!0,s=o.left):s=o.start,o.right?(n=!0,r=o.right):r=o.end,x("div",{className:[t||"","fc-toolbar",n?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",s||[]),this.renderSection("center",a||[]),this.renderSection("end",r||[]))}renderSection(e,t){let{props:n}=this;return x(o_,{key:e,widgetGroups:t,title:n.title,navUnit:n.navUnit,activeButton:n.activeButton,isTodayEnabled:n.isTodayEnabled,isPrevEnabled:n.isPrevEnabled,isNextEnabled:n.isNextEnabled,titleId:n.titleId})}},a_=class extends te{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=e=>{this.el=e,nn(this.props.elRef,e),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:e,state:t}=this,{aspectRatio:n}=e,s=["fc-view-harness",n||e.liquid||e.height?"fc-view-harness-active":"fc-view-harness-passive"],r="",o="";return n?t.availableWidth!==null?r=t.availableWidth/n:o=`${1/n*100}%`:r=e.height||"",x("div",{"aria-labelledby":e.labeledById,ref:this.handleEl,className:s.join(" "),style:{height:r,paddingBottom:o}},e.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}},l_=class extends zn{constructor(e){super(e),this.handleSegClick=(t,n)=>{let{component:s}=this,{context:r}=s,o=gs(n);if(o&&s.isValidSegDownEl(t.target)){let a=Ve(t.target,".fc-event-forced-url"),l=a?a.querySelector("a[href]").href:"";r.emitter.trigger("eventClick",{el:n,event:new me(s.context,o.eventRange.def,o.eventRange.instance),jsEvent:t,view:r.viewApi}),l&&!t.defaultPrevented&&(window.location.href=l)}},this.destroy=fS(e.el,"click",".fc-event",this.handleSegClick)}},c_=class extends zn{constructor(e){super(e),this.handleEventElRemove=t=>{t===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(t,n)=>{gs(n)&&(this.currentSegEl=n,this.triggerEvent("eventMouseEnter",t,n))},this.handleSegLeave=(t,n)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",t,n))},this.removeHoverListeners=kI(e.el,".fc-event",this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(e,t,n){let{component:s}=this,{context:r}=s,o=gs(n);(!t||s.isValidSegDownEl(t.target))&&r.emitter.trigger(e,{el:n,event:new me(r,o.eventRange.def,o.eventRange.instance),jsEvent:t,view:r.viewApi})}},d_=class extends vi{constructor(){super(...arguments),this.buildViewContext=$(YI),this.buildViewPropTransformers=$(CV),this.buildToolbarProps=$(_V),this.headerRef=Ne(),this.footerRef=Ne(),this.interactionsStore={},this.state={viewLabelId:vn()},this.registerInteractiveComponent=(e,t)=>{let n=sD(e,t),o=[l_,c_].concat(this.props.pluginHooks.componentInteractions).map(a=>new a(n));this.interactionsStore[e.uid]=o,xc[e.uid]=n},this.unregisterInteractiveComponent=e=>{let t=this.interactionsStore[e.uid];if(t){for(let n of t)n.destroy();delete this.interactionsStore[e.uid]}delete xc[e.uid]},this.resizeRunner=new jo(()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})}),this.handleWindowResize=e=>{let{options:t}=this.props;t.handleWindowResize&&e.target===window&&this.resizeRunner.request(t.windowResizeDelay)}}render(){let{props:e}=this,{toolbarConfig:t,options:n}=e,s=!1,r="",o;e.isHeightAuto||e.forPrint?r="":n.height!=null?s=!0:n.contentHeight!=null?r=n.contentHeight:o=Math.max(n.aspectRatio,.5);let a=this.buildViewContext(e.viewSpec,e.viewApi,e.options,e.dateProfileGenerator,e.dateEnv,e.nowManager,e.theme,e.pluginHooks,e.dispatch,e.getCurrentData,e.emitter,e.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),l=t.header&&t.header.hasTitle?this.state.viewLabelId:void 0;return x(En.Provider,{value:a},x(Lt,{unit:"day"},c=>{let d=this.buildToolbarProps(e.viewSpec,e.dateProfile,e.dateProfileGenerator,e.currentDate,c,e.viewTitle);return x(ae,null,t.header&&x(Iv,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:t.header,titleId:l},d)),x(a_,{liquid:s,height:r,aspectRatio:o,labeledById:l},this.renderView(e),this.buildAppendContent()),t.footer&&x(Iv,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:t.footer,titleId:""},d)))}))}componentDidMount(){let{props:e}=this;this.calendarInteractions=e.pluginHooks.calendarInteractions.map(n=>new n(e)),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:t}=e.pluginHooks;for(let n in t)t[n](e[n],e)}componentDidUpdate(e){let{props:t}=this,{propSetHandlers:n}=t.pluginHooks;for(let s in n)t[s]!==e[s]&&n[s](t[s],t)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let e of this.calendarInteractions)e.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:e}=this,t=e.pluginHooks.viewContainerAppends.map(n=>n(e));return x(ae,{},...t)}renderView(e){let{pluginHooks:t}=e,{viewSpec:n}=e,s={dateProfile:e.dateProfile,businessHours:e.businessHours,eventStore:e.renderableEventStore,eventUiBases:e.eventUiBases,dateSelection:e.dateSelection,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,isHeightAuto:e.isHeightAuto,forPrint:e.forPrint},r=this.buildViewPropTransformers(t.viewPropsTransformers);for(let a of r)Object.assign(s,a.transform(s,e));let o=n.component;return x(o,Object.assign({},s))}};function _V(i,e,t,n,s,r){let o=t.build(s,void 0,!1),a=t.buildPrev(e,n,!1),l=t.buildNext(e,n,!1);return{title:r,activeButton:i.type,navUnit:i.singleUnit,isTodayEnabled:o.isValid&&!mn(e.currentRange,s),isPrevEnabled:a.isValid,isNextEnabled:l.isValid}}function CV(i){return i.map(e=>new e)}var Dv=class extends Qh{constructor(e,t={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=n=>{switch(n.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=n=>{this.currentData=n,this.renderRunner.request(n.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:n}=this;Wh(()=>{or(x(Zh,{options:n.calendarOptions,theme:n.theme,emitter:n.emitter},(s,r,o,a)=>(this.setClassNames(s),this.setHeight(r),x(MS.Provider,{value:this.customContentRenderId},x(d_,Object.assign({isHeightAuto:o,forPrint:a},n))))),this.el)})}else this.isRendered&&(this.isRendered=!1,or(null,this.el),this.setClassNames([]),this.setHeight(""))},II(e),this.el=e,this.renderRunner=new jo(this.handleRenderRequest),new r_({optionOverrides:t,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let e=this.isRendering;e?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),e&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){Wh(()=>{super.updateSize()})}batchRendering(e){this.renderRunner.pause("batchRendering"),e(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(e,t){this.currentDataManager.resetOptions(e,t)}setClassNames(e){if(!bi(e,this.currentClassNames)){let{classList:t}=this.el;for(let n of this.currentClassNames)t.remove(n);for(let n of e)t.add(n);this.currentClassNames=e}}setHeight(e){hS(this.el,"height",e)}};var h_=class extends st{constructor(){super(...arguments),this.headerElRef=Ne()}renderSimpleLayout(e,t){let{props:n,context:s}=this,r=[],o=ha(s.options);return e&&r.push({type:"header",key:"header",isSticky:o,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),r.push({type:"body",key:"body",liquid:!0,chunk:{content:t}}),x($n,{elClasses:["fc-daygrid"],viewSpec:s.viewSpec},x(ur,{liquid:!n.isHeightAuto&&!n.forPrint,collapsibleWidth:n.forPrint,cols:[],sections:r}))}renderHScrollLayout(e,t,n,s){let r=this.context.pluginHooks.scrollGridImpl;if(!r)throw new Error("No ScrollGrid implementation");let{props:o,context:a}=this,l=!o.forPrint&&ha(a.options),c=!o.forPrint&&Af(a.options),d=[];return e&&d.push({type:"header",key:"header",isSticky:l,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),d.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:t}]}),c&&d.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:Ic}]}),x($n,{elClasses:["fc-daygrid"],viewSpec:a.viewSpec},x(r,{liquid:!o.isHeightAuto&&!o.forPrint,forPrint:o.forPrint,collapsibleWidth:o.forPrint,colGroups:[{cols:[{span:n,minWidth:s}]}],sections:d}))}};function Pv(i,e){let t=[];for(let n=0;n<e;n+=1)t[n]=[];for(let n of i)t[n.row].push(n);return t}function Mv(i,e){let t=[];for(let n=0;n<e;n+=1)t[n]=[];for(let n of i)t[n.firstCol].push(n);return t}function HD(i,e){let t=[];if(i){for(let n=0;n<e;n+=1)t[n]={affectedInstances:i.affectedInstances,isEvent:i.isEvent,segs:[]};for(let n of i.segs)t[n.row].segs.push(n)}else for(let n=0;n<e;n+=1)t[n]=null;return t}var BD=ue({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function VD(i){let{display:e}=i.eventRange.ui;return e==="list-item"||e==="auto"&&!i.eventRange.def.allDay&&i.firstCol===i.lastCol&&i.isStart&&i.isEnd}var kv=class extends te{render(){let{props:e}=this;return x(hr,Object.assign({},e,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:BD,defaultDisplayEventEnd:e.defaultDisplayEventEnd,disableResizing:!e.seg.eventRange.def.allDay}))}},Nv=class extends te{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,r=n.eventTimeFormat||BD,o=vr(s,r,t,!0,e.defaultDisplayEventEnd);return x(fs,Object.assign({},e,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:Tc(e.seg,t),defaultGenerator:xV,timeText:o,isResizing:!1,isDateSelecting:!1}))}};function xV(i){return x(ae,null,x("div",{className:"fc-daygrid-event-dot",style:{borderColor:i.borderColor||i.backgroundColor}}),i.timeText&&x("div",{className:"fc-event-time"},i.timeText),x("div",{className:"fc-event-title"},i.event.title||x(ae,null,"\xA0")))}var f_=class extends te{constructor(){super(...arguments),this.compileSegs=$(RV)}render(){let{props:e}=this,{allSegs:t,invisibleSegs:n}=this.compileSegs(e.singlePlacements);return x(ca,{elClasses:["fc-daygrid-more-link"],dateProfile:e.dateProfile,todayRange:e.todayRange,allDayDate:e.allDayDate,moreCnt:e.moreCnt,allSegs:t,hiddenSegs:n,alignmentElRef:e.alignmentElRef,alignGridTop:e.alignGridTop,extraDateSpan:e.extraDateSpan,popoverContent:()=>{let s=(e.eventDrag?e.eventDrag.affectedInstances:null)||(e.eventResize?e.eventResize.affectedInstances:null)||{};return x(ae,null,t.map(r=>{let o=r.eventRange.instance.instanceId;return x("div",{className:"fc-daygrid-event-harness",key:o,style:{visibility:s[o]?"hidden":""}},VD(r)?x(Nv,Object.assign({seg:r,isDragging:!1,isSelected:o===e.eventSelection,defaultDisplayEventEnd:!1},sn(r,e.todayRange))):x(kv,Object.assign({seg:r,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:o===e.eventSelection,defaultDisplayEventEnd:!1},sn(r,e.todayRange))))}))}})}};function RV(i){let e=[],t=[];for(let n of i)e.push(n.seg),n.isVisible||t.push(n.seg);return{allSegs:e,invisibleSegs:t}}var IV=ue({week:"narrow"}),p_=class extends st{constructor(){super(...arguments),this.rootElRef=Ne(),this.state={dayNumberId:vn()},this.handleRootEl=e=>{nn(this.rootElRef,e),nn(this.props.elRef,e)}}render(){let{context:e,props:t,state:n,rootElRef:s}=this,{options:r,dateEnv:o}=e,{date:a,dateProfile:l}=t,c=t.showDayNumber&&MV(a,l.currentRange,o);return x(fr,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...t.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},t.extraDataAttrs),t.showDayNumber?{"aria-labelledby":n.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:DV,date:a,dateProfile:l,todayRange:t.todayRange,showDayNumber:t.showDayNumber,isMonthStart:c,extraRenderProps:t.extraRenderProps},(d,h)=>x("div",{ref:t.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:t.minHeight}},t.showWeekNumber&&x(_f,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:Si(e,a,"week"),date:a,defaultFormat:IV}),!h.isDisabled&&(t.showDayNumber||Dc(r)||t.forceDayTop)?x("div",{className:"fc-daygrid-day-top"},x(d,{elTag:"a",elClasses:["fc-daygrid-day-number",c&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},Si(e,a)),{id:n.dayNumberId})})):t.showDayNumber?x("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},x("a",{className:"fc-daygrid-day-number"},"\xA0")):void 0,x("div",{className:"fc-daygrid-day-events",ref:t.fgContentElRef},t.fgContent,x("div",{className:"fc-daygrid-day-bottom",style:{marginTop:t.moreMarginTop}},x(f_,{allDayDate:a,singlePlacements:t.singlePlacements,moreCnt:t.moreCnt,alignmentElRef:s,alignGridTop:!t.showDayNumber,extraDateSpan:t.extraDateSpan,dateProfile:t.dateProfile,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,todayRange:t.todayRange}))),x("div",{className:"fc-daygrid-day-bg"},t.bgContent)))}};function DV(i){return i.dayNumberText||x(ae,null,"\xA0")}function MV(i,e,t){let{start:n,end:s}=e,r=yi(s,-1),o=t.getYear(n),a=t.getMonth(n),l=t.getYear(r),c=t.getMonth(r);return!(o===l&&a===c)&&(i.valueOf()===n.valueOf()||t.getDay(i)===1&&i.valueOf()<s.valueOf())}function GD(i){return i.eventRange.instance.instanceId+":"+i.firstCol}function $D(i){return GD(i)+":"+i.lastCol}function PV(i,e,t,n,s,r,o){let a=new g_(w=>{let _=i[w.index].eventRange.instance.instanceId+":"+w.span.start+":"+(w.span.end-1);return s[_]||1});a.allowReslicing=!0,a.strictOrder=n,e===!0||t===!0?(a.maxCoord=r,a.hiddenConsumes=!0):typeof e=="number"?a.maxStackCnt=e:typeof t=="number"&&(a.maxStackCnt=t,a.hiddenConsumes=!0);let l=[],c=[];for(let w=0;w<i.length;w+=1){let _=i[w],C=$D(_);s[C]!=null?l.push({index:w,span:{start:_.firstCol,end:_.lastCol+1}}):c.push(_)}let d=a.addSegs(l),h=a.toRects(),{singleColPlacements:p,multiColPlacements:m,leftoverMargins:y}=kV(h,i,o),v=[],b=[];for(let w of c){m[w.firstCol].push({seg:w,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let _=w.firstCol;_<=w.lastCol;_+=1)p[_].push({seg:Mc(w,_,_+1,o),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let w=0;w<o.length;w+=1)v.push(0);for(let w of d){let _=i[w.index],C=w.span;m[C.start].push({seg:Mc(_,C.start,C.end,o),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let T=C.start;T<C.end;T+=1)v[T]+=1,p[T].push({seg:Mc(_,T,T+1,o),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let w=0;w<o.length;w+=1)b.push(y[w]);return{singleColPlacements:p,multiColPlacements:m,moreCnts:v,moreMarginTops:b}}function kV(i,e,t){let n=NV(i,t.length),s=[],r=[],o=[];for(let a=0;a<t.length;a+=1){let l=n[a],c=[],d=0,h=0;for(let m of l){let y=e[m.index];c.push({seg:Mc(y,a,a+1,t),isVisible:!0,isAbsolute:!1,absoluteTop:m.levelCoord,marginTop:m.levelCoord-d}),d=m.levelCoord+m.thickness}let p=[];d=0,h=0;for(let m of l){let y=e[m.index],v=m.span.end-m.span.start>1,b=m.span.start===a;h+=m.levelCoord-d,d=m.levelCoord+m.thickness,v?(h+=m.thickness,b&&p.push({seg:Mc(y,m.span.start,m.span.end,t),isVisible:!0,isAbsolute:!0,absoluteTop:m.levelCoord,marginTop:0})):b&&(p.push({seg:Mc(y,m.span.start,m.span.end,t),isVisible:!0,isAbsolute:!1,absoluteTop:m.levelCoord,marginTop:h}),h=0)}s.push(c),r.push(p),o.push(h)}return{singleColPlacements:s,multiColPlacements:r,leftoverMargins:o}}function NV(i,e){let t=[];for(let n=0;n<e;n+=1)t.push([]);for(let n of i)for(let s=n.span.start;s<n.span.end;s+=1)t[s].push(n);return t}function Mc(i,e,t,n){if(i.firstCol===e&&i.lastCol===t-1)return i;let s=i.eventRange,r=s.range,o=tn(r,{start:n[e].date,end:be(n[t-1].date,1)});return Object.assign(Object.assign({},i),{firstCol:e,lastCol:t-1,eventRange:{def:s.def,ui:Object.assign(Object.assign({},s.ui),{durationEditable:!1}),instance:s.instance,range:o},isStart:i.isStart&&o.start.valueOf()===r.start.valueOf(),isEnd:i.isEnd&&o.end.valueOf()===r.end.valueOf()})}var g_=class extends ia{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(e){let t=super.addSegs(e),{entriesByLevel:n}=this,s=r=>!this.forceHidden[Ei(r)];for(let r=0;r<n.length;r+=1)n[r]=n[r].filter(s);return t}handleInvalidInsertion(e,t,n){let{entriesByLevel:s,forceHidden:r}=this,{touchingEntry:o,touchingLevel:a,touchingLateral:l}=e;if(this.hiddenConsumes&&o){let c=Ei(o);if(!r[c])if(this.allowReslicing){let d=Object.assign(Object.assign({},o),{span:Ef(o.span,t.span)}),h=Ei(d);r[h]=!0,s[a][l]=d,n.push(d),this.splitEntry(o,t,n)}else r[c]=!0,n.push(o)}super.handleInvalidInsertion(e,t,n)}},Fv=class extends st{constructor(){super(...arguments),this.cellElRefs=new Ot,this.frameElRefs=new Ot,this.fgElRefs=new Ot,this.segHarnessRefs=new Ot,this.rootElRef=Ne(),this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=e=>{e&&this.updateSizing(!0)}}render(){let{props:e,state:t,context:n}=this,{options:s}=n,r=e.cells.length,o=Mv(e.businessHourSegs,r),a=Mv(e.bgEventSegs,r),l=Mv(this.getHighlightSegs(),r),c=Mv(this.getMirrorSegs(),r),{singleColPlacements:d,multiColPlacements:h,moreCnts:p,moreMarginTops:m}=PV(ua(e.fgEventSegs,s.eventOrder),e.dayMaxEvents,e.dayMaxEventRows,s.eventOrderStrict,t.segHeights,t.maxContentHeight,e.cells),y=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{};return x("tr",{ref:this.rootElRef,role:"row"},e.renderIntro&&e.renderIntro(),e.cells.map((v,b)=>{let w=this.renderFgSegs(b,e.forPrint?d[b]:h[b],e.todayRange,y),_=this.renderFgSegs(b,FV(c[b],h),e.todayRange,{},!!e.eventDrag,!!e.eventResize,!1);return x(p_,{key:v.key,elRef:this.cellElRefs.createRef(v.key),innerElRef:this.frameElRefs.createRef(v.key),dateProfile:e.dateProfile,date:v.date,showDayNumber:e.showDayNumbers,showWeekNumber:e.showWeekNumbers&&b===0,forceDayTop:e.showWeekNumbers,todayRange:e.todayRange,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,extraRenderProps:v.extraRenderProps,extraDataAttrs:v.extraDataAttrs,extraClassNames:v.extraClassNames,extraDateSpan:v.extraDateSpan,moreCnt:p[b],moreMarginTop:m[b],singlePlacements:d[b],fgContentElRef:this.fgElRefs.createRef(v.key),fgContent:x(ae,null,x(ae,null,w),x(ae,null,_)),bgContent:x(ae,null,this.renderFillSegs(l[b],"highlight"),this.renderFillSegs(o[b],"non-business"),this.renderFillSegs(a[b],"bg-event")),minHeight:e.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(e,t){let n=this.props;this.updateSizing(!Ft(e,n))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:e}=this;return e.eventDrag&&e.eventDrag.segs.length?e.eventDrag.segs:e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:e.dateSelectionSegs}getMirrorSegs(){let{props:e}=this;return e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:[]}renderFgSegs(e,t,n,s,r,o,a){let{context:l}=this,{eventSelection:c}=this.props,{framePositions:d}=this.state,h=this.props.cells.length===1,p=r||o||a,m=[];if(d)for(let y of t){let{seg:v}=y,{instanceId:b}=v.eventRange.instance,w=y.isVisible&&!s[b],_=y.isAbsolute,C="",T="";_&&(l.isRtl?(T=0,C=d.lefts[v.lastCol]-d.lefts[v.firstCol]):(C=0,T=d.rights[v.firstCol]-d.rights[v.lastCol])),m.push(x("div",{className:"fc-daygrid-event-harness"+(_?" fc-daygrid-event-harness-abs":""),key:GD(v),ref:p?null:this.segHarnessRefs.createRef($D(v)),style:{visibility:w?"":"hidden",marginTop:_?"":y.marginTop,top:_?y.absoluteTop:"",left:C,right:T}},VD(v)?x(Nv,Object.assign({seg:v,isDragging:r,isSelected:b===c,defaultDisplayEventEnd:h},sn(v,n))):x(kv,Object.assign({seg:v,isDragging:r,isResizing:o,isDateSelecting:a,isSelected:b===c,defaultDisplayEventEnd:h},sn(v,n)))))}return m}renderFillSegs(e,t){let{isRtl:n}=this.context,{todayRange:s}=this.props,{framePositions:r}=this.state,o=[];if(r)for(let a of e){let l=n?{right:0,left:r.lefts[a.lastCol]-r.lefts[a.firstCol]}:{left:0,right:r.rights[a.firstCol]-r.rights[a.lastCol]};o.push(x("div",{key:gf(a.eventRange),className:"fc-daygrid-bg-harness",style:l},t==="bg-event"?x(la,Object.assign({seg:a},sn(a,s))):Sf(t)))}return x(ae,{},...o)}updateSizing(e){let{props:t,state:n,frameElRefs:s}=this;if(!t.forPrint&&t.clientWidth!==null){if(e){let l=t.cells.map(c=>s.currentMap[c.key]);if(l.length){let c=this.rootElRef.current,d=new qn(c,l,!0,!1);(!n.framePositions||!n.framePositions.similarTo(d))&&this.setState({framePositions:new qn(c,l,!0,!1)})}}let r=this.state.segHeights,o=this.querySegHeights(),a=t.dayMaxEvents===!0||t.dayMaxEventRows===!0;this.safeSetState({segHeights:Object.assign(Object.assign({},r),o),maxContentHeight:a?this.computeMaxContentHeight():null})}}querySegHeights(){let e=this.segHarnessRefs.currentMap,t={};for(let n in e){let s=Math.round(e[n].getBoundingClientRect().height);t[n]=Math.max(t[n]||0,s)}return t}computeMaxContentHeight(){let e=this.props.cells[0].key,t=this.cellElRefs.currentMap[e],n=this.fgElRefs.currentMap[e];return t.getBoundingClientRect().bottom-n.getBoundingClientRect().top}getCellEls(){let e=this.cellElRefs.currentMap;return this.props.cells.map(t=>e[t.key])}};Fv.addStateEquality({segHeights:Ft});function FV(i,e){if(!i.length)return[];let t=LV(e);return i.map(n=>({seg:n,isVisible:!0,isAbsolute:!0,absoluteTop:t[n.eventRange.instance.instanceId],marginTop:0}))}function LV(i){let e={};for(let t of i)for(let n of t)e[n.seg.eventRange.instance.instanceId]=n.absoluteTop;return e}var m_=class extends st{constructor(){super(...arguments),this.splitBusinessHourSegs=$(Pv),this.splitBgEventSegs=$(OV),this.splitFgEventSegs=$(Pv),this.splitDateSelectionSegs=$(Pv),this.splitEventDrag=$(HD),this.splitEventResize=$(HD),this.rowRefs=new Ot}render(){let{props:e,context:t}=this,n=e.cells.length,s=this.splitBusinessHourSegs(e.businessHourSegs,n),r=this.splitBgEventSegs(e.bgEventSegs,n),o=this.splitFgEventSegs(e.fgEventSegs,n),a=this.splitDateSelectionSegs(e.dateSelectionSegs,n),l=this.splitEventDrag(e.eventDrag,n),c=this.splitEventResize(e.eventResize,n),d=n>=7&&e.clientWidth?e.clientWidth/t.options.aspectRatio/6:null;return x(Lt,{unit:"day"},(h,p)=>x(ae,null,e.cells.map((m,y)=>x(Fv,{ref:this.rowRefs.createRef(y),key:m.length?m[0].date.toISOString():y,showDayNumbers:n>1,showWeekNumbers:e.showWeekNumbers,todayRange:p,dateProfile:e.dateProfile,cells:m,renderIntro:e.renderRowIntro,businessHourSegs:s[y],eventSelection:e.eventSelection,bgEventSegs:r[y],fgEventSegs:o[y],dateSelectionSegs:a[y],eventDrag:l[y],eventResize:c[y],dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,clientWidth:e.clientWidth,clientHeight:e.clientHeight,cellMinHeight:d,forPrint:e.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){let e=this.rowRefs.currentMap[0].getCellEls()[0],t=e?e.closest(".fc-daygrid-body"):null;t&&(this.rootEl=t,this.context.registerInteractiveComponent(this,{el:t,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new qn(this.rootEl,this.rowRefs.collect().map(e=>e.getCellEls()[0]),!1,!0),this.colPositions=new qn(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(e,t){let{colPositions:n,rowPositions:s}=this,r=n.leftToIndex(e),o=s.topToIndex(t);if(o!=null&&r!=null){let a=this.props.cells[o][r];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(o,r),allDay:!0},a.extraDateSpan),dayEl:this.getCellEl(o,r),rect:{left:n.lefts[r],right:n.rights[r],top:s.tops[o],bottom:s.bottoms[o]},layer:0}}return null}getCellEl(e,t){return this.rowRefs.currentMap[e].getCellEls()[t]}getCellRange(e,t){let n=this.props.cells[e][t].date,s=be(n,1);return{start:n,end:s}}};function OV(i,e){return Pv(i.filter(UV),e)}function UV(i){return i.eventRange.def.allDay}var y_=class extends st{constructor(){super(...arguments),this.elRef=Ne(),this.needsScrollReset=!1}render(){let{props:e}=this,{dayMaxEventRows:t,dayMaxEvents:n,expandRows:s}=e,r=n===!0||t===!0;r&&!s&&(r=!1,t=null,n=null);let o=["fc-daygrid-body",r?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",s?"":"fc-daygrid-body-natural"];return x("div",{ref:this.elRef,className:o.join(" "),style:{width:e.clientWidth,minWidth:e.tableMinWidth}},x("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:e.clientWidth,minWidth:e.tableMinWidth,height:s?e.clientHeight:""}},e.colGroupNode,x("tbody",{role:"presentation"},x(m_,{dateProfile:e.dateProfile,cells:e.cells,renderRowIntro:e.renderRowIntro,showWeekNumbers:e.showWeekNumbers,clientWidth:e.clientWidth,clientHeight:e.clientHeight,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,dayMaxEvents:n,dayMaxEventRows:t,forPrint:e.forPrint,isHitComboAllowed:e.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(e){e.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){let e=HV(this.elRef.current,this.props.dateProfile);if(e){let t=e.closest(".fc-daygrid-body"),n=t.closest(".fc-scroller"),s=e.getBoundingClientRect().top-t.getBoundingClientRect().top;n.scrollTop=s?s+1:0}this.needsScrollReset=!1}}};function HV(i,e){let t;return e.currentRangeUnit.match(/year|month/)&&(t=i.querySelector(`[data-date="${SS(e.currentDate)}-01"]`)),t||(t=i.querySelector(`[data-date="${gr(e.currentDate)}"]`)),t}var v_=class extends aa{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(e,t){return t.sliceRange(e)}},Cf=class extends st{constructor(){super(...arguments),this.slicer=new v_,this.tableRef=Ne()}render(){let{props:e,context:t}=this;return x(y_,Object.assign({ref:this.tableRef},this.slicer.sliceProps(e,e.dateProfile,e.nextDayThreshold,t,e.dayTableModel),{dateProfile:e.dateProfile,cells:e.dayTableModel.cells,colGroupNode:e.colGroupNode,tableMinWidth:e.tableMinWidth,renderRowIntro:e.renderRowIntro,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.showWeekNumbers,expandRows:e.expandRows,headerAlignElRef:e.headerAlignElRef,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:e.forPrint}))}},Lv=class extends h_{constructor(){super(...arguments),this.buildDayTableModel=$(BV),this.headerRef=Ne(),this.tableRef=Ne()}render(){let{options:e,dateProfileGenerator:t}=this.context,{props:n}=this,s=this.buildDayTableModel(n.dateProfile,t),r=e.dayHeaders&&x(sa,{ref:this.headerRef,dateProfile:n.dateProfile,dates:s.headerDates,datesRepDistinctDays:s.rowCnt===1}),o=a=>x(Cf,{ref:this.tableRef,dateProfile:n.dateProfile,dayTableModel:s,businessHours:n.businessHours,dateSelection:n.dateSelection,eventStore:n.eventStore,eventUiBases:n.eventUiBases,eventSelection:n.eventSelection,eventDrag:n.eventDrag,eventResize:n.eventResize,nextDayThreshold:e.nextDayThreshold,colGroupNode:a.tableColGroupNode,tableMinWidth:a.tableMinWidth,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.weekNumbers,expandRows:!n.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:a.clientWidth,clientHeight:a.clientHeight,forPrint:n.forPrint});return e.dayMinWidth?this.renderHScrollLayout(r,o,s.colCnt,e.dayMinWidth):this.renderSimpleLayout(r,o)}};function BV(i,e){let t=new ra(i.renderRange,e);return new oa(t,/year|month|week/.test(i.currentRangeUnit))}var Ov=class extends ea{buildRenderRange(e,t,n){let s=super.buildRenderRange(e,t,n),{props:r}=this;return VV({currentRange:s,snapToWeek:/^(year|month)$/.test(t),fixedWeekCount:r.fixedWeekCount,dateEnv:r.dateEnv})}};function VV(i){let{dateEnv:e,currentRange:t}=i,{start:n,end:s}=t,r;if(i.snapToWeek&&(n=e.startOfWeek(n),r=e.startOfWeek(s),r.valueOf()!==s.valueOf()&&(s=hv(r,1))),i.fixedWeekCount){let o=e.startOfWeek(e.startOfMonth(be(t.end,-1))),a=Math.ceil(AS(o,s));s=hv(s,6-a)}return{start:n,end:s}}var GV=':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}';pr(GV);var zD=Ut({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:Lv,dateProfileGeneratorClass:Ov},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});var b_=class extends jh{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(e){return e.allDay?["allDay"]:["timed"]}getKeysForEventDef(e){return e.allDay?VS(e)?["timed","allDay"]:["allDay"]:["timed"]}},$V=ue({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function XD(i){let e=["fc-timegrid-slot","fc-timegrid-slot-label",i.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return x(En.Consumer,null,t=>{if(!i.isLabeled)return x("td",{className:e.join(" "),"data-time":i.isoTimeStr});let{dateEnv:n,options:s,viewApi:r}=t,o=s.slotLabelFormat==null?$V:Array.isArray(s.slotLabelFormat)?ue(s.slotLabelFormat[0]):ue(s.slotLabelFormat),a={level:0,time:i.time,date:n.toDate(i.date),view:r,text:n.format(i.date,o)};return x(xe,{elTag:"td",elClasses:e,elAttrs:{"data-time":i.isoTimeStr},renderProps:a,generatorName:"slotLabelContent",customGenerator:s.slotLabelContent,defaultGenerator:zV,classNameGenerator:s.slotLabelClassNames,didMount:s.slotLabelDidMount,willUnmount:s.slotLabelWillUnmount},l=>x("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},x(l,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function zV(i){return i.text}var A_=class extends te{render(){return this.props.slatMetas.map(e=>x("tr",{key:e.key},x(XD,Object.assign({},e))))}},qV=ue({week:"short"}),WV=5,w_=class extends st{constructor(){super(...arguments),this.allDaySplitter=new b_,this.headerElRef=Ne(),this.rootElRef=Ne(),this.scrollerElRef=Ne(),this.state={slatCoords:null},this.handleScrollTopRequest=e=>{let t=this.scrollerElRef.current;t&&(t.scrollTop=e)},this.renderHeadAxis=(e,t="")=>{let{options:n}=this.context,{dateProfile:s}=this.props,r=s.renderRange,a=Ai(r.start,r.end)===1?Si(this.context,r.start,"week"):{};return n.weekNumbers&&e==="day"?x(_f,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:r.start,defaultFormat:qV},l=>x("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:t}},x(l,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:a}))):x("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},x("div",{className:"fc-timegrid-axis-frame",style:{height:t}}))},this.renderTableRowAxis=e=>{let{options:t,viewApi:n}=this.context,s={text:t.allDayText,view:n};return x(xe,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:s,generatorName:"allDayContent",customGenerator:t.allDayContent,defaultGenerator:YV,classNameGenerator:t.allDayClassNames,didMount:t.allDayDidMount,willUnmount:t.allDayWillUnmount},r=>x("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",e==null?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:e}},x(r,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=e=>{this.setState({slatCoords:e})}}renderSimpleLayout(e,t,n){let{context:s,props:r}=this,o=[],a=ha(s.options);return e&&o.push({type:"header",key:"header",isSticky:a,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),t&&(o.push({type:"body",key:"all-day",chunk:{content:t}}),o.push({type:"body",key:"all-day-divider",outerContent:x("tr",{role:"presentation",className:"fc-scrollgrid-section"},x("td",{className:"fc-timegrid-divider "+s.theme.getClass("tableCellShaded")}))})),o.push({type:"body",key:"body",liquid:!0,expandRows:!!s.options.expandRows,chunk:{scrollerElRef:this.scrollerElRef,content:n}}),x($n,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:s.viewSpec},x(ur,{liquid:!r.isHeightAuto&&!r.forPrint,collapsibleWidth:r.forPrint,cols:[{width:"shrink"}],sections:o}))}renderHScrollLayout(e,t,n,s,r,o,a){let l=this.context.pluginHooks.scrollGridImpl;if(!l)throw new Error("No ScrollGrid implementation");let{context:c,props:d}=this,h=!d.forPrint&&ha(c.options),p=!d.forPrint&&Af(c.options),m=[];e&&m.push({type:"header",key:"header",isSticky:h,syncRowHeights:!0,chunks:[{key:"axis",rowContent:v=>x("tr",{role:"presentation"},this.renderHeadAxis("day",v.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),t&&(m.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:v=>x("tr",{role:"presentation"},this.renderTableRowAxis(v.rowSyncHeights[0]))},{key:"cols",content:t}]}),m.push({key:"all-day-divider",type:"body",outerContent:x("tr",{role:"presentation",className:"fc-scrollgrid-section"},x("td",{colSpan:2,className:"fc-timegrid-divider "+c.theme.getClass("tableCellShaded")}))}));let y=c.options.nowIndicator;return m.push({type:"body",key:"body",liquid:!0,expandRows:!!c.options.expandRows,chunks:[{key:"axis",content:v=>x("div",{className:"fc-timegrid-axis-chunk"},x("table",{"aria-hidden":!0,style:{height:v.expandRows?v.clientHeight:""}},v.tableColGroupNode,x("tbody",null,x(A_,{slatMetas:o}))),x("div",{className:"fc-timegrid-now-indicator-container"},x(Lt,{unit:y?"minute":"day"},b=>{let w=y&&a&&a.safeComputeTop(b);return typeof w=="number"?x(wf,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:w},isAxis:!0,date:b}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:n}]}),p&&m.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:Ic},{key:"cols",content:Ic}]}),x($n,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:c.viewSpec},x(l,{liquid:!d.isHeightAuto&&!d.forPrint,forPrint:d.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:s,minWidth:r}]}],sections:m}))}getAllDayMaxEventProps(){let{dayMaxEvents:e,dayMaxEventRows:t}=this.context.options;return(e===!0||t===!0)&&(e=void 0,t=WV),{dayMaxEvents:e,dayMaxEventRows:t}}};function YV(i){return i.text}var S_=class{constructor(e,t,n){this.positions=e,this.dateProfile=t,this.slotDuration=n}safeComputeTop(e){let{dateProfile:t}=this;if(mn(t.currentRange,e)){let n=de(e),s=e.valueOf()-n.valueOf();if(s>=en(t.slotMinTime)&&s<en(t.slotMaxTime))return this.computeTimeTop(ee(s))}return null}computeDateTop(e,t){return t||(t=de(e)),this.computeTimeTop(ee(e.valueOf()-t.valueOf()))}computeTimeTop(e){let{positions:t,dateProfile:n}=this,s=t.els.length,r=(e.milliseconds-en(n.slotMinTime))/en(this.slotDuration),o,a;return r=Math.max(0,r),r=Math.min(s,r),o=Math.floor(r),o=Math.min(o,s-1),a=r-o,t.tops[o]+t.getHeight(o)*a}},__=class extends te{render(){let{props:e,context:t}=this,{options:n}=t,{slatElRefs:s}=e;return x("tbody",null,e.slatMetas.map((r,o)=>{let a={time:r.time,date:t.dateEnv.toDate(r.date),view:t.viewApi};return x("tr",{key:r.key,ref:s.createRef(r.key)},e.axis&&x(XD,Object.assign({},r)),x(xe,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!r.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":r.isoTimeStr},renderProps:a,generatorName:"slotLaneContent",customGenerator:n.slotLaneContent,classNameGenerator:n.slotLaneClassNames,didMount:n.slotLaneDidMount,willUnmount:n.slotLaneWillUnmount}))}))}},C_=class extends te{constructor(){super(...arguments),this.rootElRef=Ne(),this.slatElRefs=new Ot}render(){let{props:e,context:t}=this;return x("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},x("table",{"aria-hidden":!0,className:t.theme.getClass("table"),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:e.minHeight}},e.tableColGroupNode,x(__,{slatElRefs:this.slatElRefs,axis:e.axis,slatMetas:e.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:e,props:t}=this;t.onCoords&&t.clientWidth!==null&&this.rootElRef.current.offsetHeight&&t.onCoords(new S_(new qn(this.rootElRef.current,KV(this.slatElRefs.currentMap,t.slatMetas),!1,!0),this.props.dateProfile,e.options.slotDuration))}};function KV(i,e){return e.map(t=>i[t.key])}function Tf(i,e){let t=[],n;for(n=0;n<e;n+=1)t.push([]);if(i)for(n=0;n<i.length;n+=1)t[i[n].col].push(i[n]);return t}function qD(i,e){let t=[];if(i){for(let n=0;n<e;n+=1)t[n]={affectedInstances:i.affectedInstances,isEvent:i.isEvent,segs:[]};for(let n of i.segs)t[n.col].segs.push(n)}else for(let n=0;n<e;n+=1)t[n]=null;return t}var T_=class extends te{render(){let{props:e}=this;return x(ca,{elClasses:["fc-timegrid-more-link"],elStyle:{top:e.top,bottom:e.bottom},allDayDate:null,moreCnt:e.hiddenSegs.length,allSegs:e.hiddenSegs,hiddenSegs:e.hiddenSegs,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,todayRange:e.todayRange,popoverContent:()=>JD(e.hiddenSegs,e),defaultGenerator:XV,forceTimed:!0},t=>x(t,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}};function XV(i){return i.shortText}function JV(i,e,t){let n=new ia;e!=null&&(n.strictOrder=e),t!=null&&(n.maxStackCnt=t);let s=n.addSegs(i),r=QS(s),o=ZV(n);return o=tG(o,1),{segRects:nG(o),hiddenGroups:r}}function ZV(i){let{entriesByLevel:e}=i,t=P_((n,s)=>n+":"+s,(n,s)=>{let r=eG(i,n,s),o=WD(r,t),a=e[n][s];return[Object.assign(Object.assign({},a),{nextLevelNodes:o[0]}),a.thickness+o[1]]});return WD(e.length?{level:0,lateralStart:0,lateralEnd:e[0].length}:null,t)[0]}function WD(i,e){if(!i)return[[],0];let{level:t,lateralStart:n,lateralEnd:s}=i,r=n,o=[];for(;r<s;)o.push(e(t,r)),r+=1;return o.sort(QV),[o.map(jV),o[0][1]]}function QV(i,e){return e[1]-i[1]}function jV(i){return i[0]}function eG(i,e,t){let{levelCoords:n,entriesByLevel:s}=i,r=s[e][t],o=n[e]+r.thickness,a=n.length,l=e;for(;l<a&&n[l]<o;l+=1);for(;l<a;l+=1){let c=s[l],d,h=sf(c,r.span.start,nf),p=h[0]+h[1],m=p;for(;(d=c[m])&&d.span.start<r.span.end;)m+=1;if(p<m)return{level:l,lateralStart:p,lateralEnd:m}}return null}function tG(i,e){let t=P_((n,s,r)=>Ei(n),(n,s,r)=>{let{nextLevelNodes:o,thickness:a}=n,l=a+r,c=a/l,d,h=[];if(!o.length)d=e;else for(let m of o)if(d===void 0){let y=t(m,s,l);d=y[0],h.push(y[1])}else{let y=t(m,d,0);h.push(y[1])}let p=(d-s)*c;return[d-p,Object.assign(Object.assign({},n),{thickness:p,nextLevelNodes:h})]});return i.map(n=>t(n,0,0)[1])}function nG(i){let e=[],t=P_((s,r,o)=>Ei(s),(s,r,o)=>{let a=Object.assign(Object.assign({},s),{levelCoord:r,stackDepth:o,stackForward:0});return e.push(a),a.stackForward=n(s.nextLevelNodes,r+s.thickness,o+1)+1});function n(s,r,o){let a=0;for(let l of s)a=Math.max(t(l,r,o),a);return a}return n(i,0,0),e}function P_(i,e){let t={};return(...n)=>{let s=i(...n);return s in t?t[s]:t[s]=e(...n)}}function YD(i,e,t=null,n=0){let s=[];if(t)for(let r=0;r<i.length;r+=1){let o=i[r],a=t.computeDateTop(o.start,e),l=Math.max(a+(n||0),t.computeDateTop(o.end,e));s.push({start:Math.round(a),end:Math.round(l)})}return s}function iG(i,e,t,n){let s=[],r=[];for(let c=0;c<i.length;c+=1){let d=e[c];d?s.push({index:c,thickness:1,span:d}):r.push(i[c])}let{segRects:o,hiddenGroups:a}=JV(s,t,n),l=[];for(let c of o)l.push({seg:i[c.index],rect:c});for(let c of r)l.push({seg:c,rect:null});return{segPlacements:l,hiddenGroups:a}}var sG=ue({hour:"numeric",minute:"2-digit",meridiem:!1}),Uv=class extends te{render(){return x(hr,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:sG}))}},x_=class extends te{constructor(){super(...arguments),this.sortEventSegs=$(ua)}render(){let{props:e,context:t}=this,{options:n}=t,s=n.selectMirror,r=e.eventDrag&&e.eventDrag.segs||e.eventResize&&e.eventResize.segs||s&&e.dateSelectionSegs||[],o=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{},a=this.sortEventSegs(e.fgEventSegs,n.eventOrder);return x(fr,{elTag:"td",elRef:e.elRef,elClasses:["fc-timegrid-col",...e.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},e.extraDataAttrs),date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,extraRenderProps:e.extraRenderProps},l=>x("div",{className:"fc-timegrid-col-frame"},x("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(e.businessHourSegs,"non-business"),this.renderFillSegs(e.bgEventSegs,"bg-event"),this.renderFillSegs(e.dateSelectionSegs,"highlight")),x("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(a,o,!1,!1,!1)),x("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(r,{},!!e.eventDrag,!!e.eventResize,!!s,"mirror")),x("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(e.nowIndicatorSegs)),Dc(n)&&x(l,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(e,t,n,s,r,o){let{props:a}=this;return a.forPrint?JD(e,a):this.renderPositionedFgSegs(e,t,n,s,r,o)}renderPositionedFgSegs(e,t,n,s,r,o){let{eventMaxStack:a,eventShortHeight:l,eventOrderStrict:c,eventMinHeight:d}=this.context.options,{date:h,slatCoords:p,eventSelection:m,todayRange:y,nowDate:v}=this.props,b=n||s||r,w=YD(e,h,p,d),{segPlacements:_,hiddenGroups:C}=iG(e,w,c,a);return x(ae,null,this.renderHiddenGroups(C,e),_.map(T=>{let{seg:R,rect:D}=T,I=R.eventRange.instance.instanceId,k=b||!!(!t[I]&&D),N=E_(D&&D.span),F=!b&&D?this.computeSegHStyle(D):{left:0,right:0},U=!!D&&D.stackForward>0,re=!!D&&D.span.end-D.span.start<l;return x("div",{className:"fc-timegrid-event-harness"+(U?" fc-timegrid-event-harness-inset":""),key:o||I,style:Object.assign(Object.assign({visibility:k?"":"hidden"},N),F)},x(Uv,Object.assign({seg:R,isDragging:n,isResizing:s,isDateSelecting:r,isSelected:I===m,isShort:re},sn(R,y,v))))}))}renderHiddenGroups(e,t){let{extraDateSpan:n,dateProfile:s,todayRange:r,nowDate:o,eventSelection:a,eventDrag:l,eventResize:c}=this.props;return x(ae,null,e.map(d=>{let h=E_(d.span),p=rG(d.entries,t);return x(T_,{key:fv(xv(p)),hiddenSegs:p,top:h.top,bottom:h.bottom,extraDateSpan:n,dateProfile:s,todayRange:r,nowDate:o,eventSelection:a,eventDrag:l,eventResize:c})}))}renderFillSegs(e,t){let{props:n,context:s}=this,o=YD(e,n.date,n.slatCoords,s.options.eventMinHeight).map((a,l)=>{let c=e[l];return x("div",{key:gf(c.eventRange),className:"fc-timegrid-bg-harness",style:E_(a)},t==="bg-event"?x(la,Object.assign({seg:c},sn(c,n.todayRange,n.nowDate))):Sf(t))});return x(ae,null,o)}renderNowIndicator(e){let{slatCoords:t,date:n}=this.props;return t?e.map((s,r)=>x(wf,{key:r,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:t.computeDateTop(s.start,n)},isAxis:!1,date:n})):null}computeSegHStyle(e){let{isRtl:t,options:n}=this.context,s=n.slotEventOverlap,r=e.levelCoord,o=e.levelCoord+e.thickness,a,l;s&&(o=Math.min(1,r+(o-r)*2)),t?(a=1-o,l=r):(a=r,l=1-o);let c={zIndex:e.stackDepth+1,left:a*100+"%",right:l*100+"%"};return s&&!e.stackForward&&(c[t?"marginLeft":"marginRight"]=10*2),c}};function JD(i,{todayRange:e,nowDate:t,eventSelection:n,eventDrag:s,eventResize:r}){let o=(s?s.affectedInstances:null)||(r?r.affectedInstances:null)||{};return x(ae,null,i.map(a=>{let l=a.eventRange.instance.instanceId;return x("div",{key:l,style:{visibility:o[l]?"hidden":""}},x(Uv,Object.assign({seg:a,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:l===n,isShort:!1},sn(a,e,t))))}))}function E_(i){return i?{top:i.start,bottom:-i.end}:{top:"",bottom:""}}function rG(i,e){return i.map(t=>e[t.index])}var R_=class extends te{constructor(){super(...arguments),this.splitFgEventSegs=$(Tf),this.splitBgEventSegs=$(Tf),this.splitBusinessHourSegs=$(Tf),this.splitNowIndicatorSegs=$(Tf),this.splitDateSelectionSegs=$(Tf),this.splitEventDrag=$(qD),this.splitEventResize=$(qD),this.rootElRef=Ne(),this.cellElRefs=new Ot}render(){let{props:e,context:t}=this,n=t.options.nowIndicator&&e.slatCoords&&e.slatCoords.safeComputeTop(e.nowDate),s=e.cells.length,r=this.splitFgEventSegs(e.fgEventSegs,s),o=this.splitBgEventSegs(e.bgEventSegs,s),a=this.splitBusinessHourSegs(e.businessHourSegs,s),l=this.splitNowIndicatorSegs(e.nowIndicatorSegs,s),c=this.splitDateSelectionSegs(e.dateSelectionSegs,s),d=this.splitEventDrag(e.eventDrag,s),h=this.splitEventResize(e.eventResize,s);return x("div",{className:"fc-timegrid-cols",ref:this.rootElRef},x("table",{role:"presentation",style:{minWidth:e.tableMinWidth,width:e.clientWidth}},e.tableColGroupNode,x("tbody",{role:"presentation"},x("tr",{role:"row"},e.axis&&x("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},x("div",{className:"fc-timegrid-col-frame"},x("div",{className:"fc-timegrid-now-indicator-container"},typeof n=="number"&&x(wf,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:n},isAxis:!0,date:e.nowDate})))),e.cells.map((p,m)=>x(x_,{key:p.key,elRef:this.cellElRefs.createRef(p.key),dateProfile:e.dateProfile,date:p.date,nowDate:e.nowDate,todayRange:e.todayRange,extraRenderProps:p.extraRenderProps,extraDataAttrs:p.extraDataAttrs,extraClassNames:p.extraClassNames,extraDateSpan:p.extraDateSpan,fgEventSegs:r[m],bgEventSegs:o[m],businessHourSegs:a[m],nowIndicatorSegs:l[m],dateSelectionSegs:c[m],eventDrag:d[m],eventResize:h[m],slatCoords:e.slatCoords,eventSelection:e.eventSelection,forPrint:e.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:e}=this;e.onColCoords&&e.clientWidth!==null&&e.onColCoords(new qn(this.rootElRef.current,oG(this.cellElRefs.currentMap,e.cells),!0,!1))}};function oG(i,e){return e.map(t=>i[t.key])}var I_=class extends st{constructor(){super(...arguments),this.processSlotOptions=$(aG),this.state={slatCoords:null},this.handleRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=e=>{let{onScrollTopRequest:t}=this.props,{slatCoords:n}=this.state;if(t&&n){if(e.time){let s=n.computeTimeTop(e.time);s=Math.ceil(s),s&&(s+=1),t(s)}return!0}return!1},this.handleColCoords=e=>{this.colCoords=e},this.handleSlatCoords=e=>{this.setState({slatCoords:e}),this.props.onSlatCoords&&this.props.onSlatCoords(e)}}render(){let{props:e,state:t}=this;return x("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:e.clientWidth,minWidth:e.tableMinWidth}},x(C_,{axis:e.axis,dateProfile:e.dateProfile,slatMetas:e.slatMetas,clientWidth:e.clientWidth,minHeight:e.expandRows?e.clientHeight:"",tableMinWidth:e.tableMinWidth,tableColGroupNode:e.axis?e.tableColGroupNode:null,onCoords:this.handleSlatCoords}),x(R_,{cells:e.cells,axis:e.axis,dateProfile:e.dateProfile,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange,nowDate:e.nowDate,nowIndicatorSegs:e.nowIndicatorSegs,clientWidth:e.clientWidth,tableMinWidth:e.tableMinWidth,tableColGroupNode:e.tableColGroupNode,slatCoords:t.slatCoords,onColCoords:this.handleColCoords,forPrint:e.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(e){this.scrollResponder.update(e.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(e,t){let{dateEnv:n,options:s}=this.context,{colCoords:r}=this,{dateProfile:o}=this.props,{slatCoords:a}=this.state,{snapDuration:l,snapsPerSlot:c}=this.processSlotOptions(this.props.slotDuration,s.snapDuration),d=r.leftToIndex(e),h=a.positions.topToIndex(t);if(d!=null&&h!=null){let p=this.props.cells[d],m=a.positions.tops[h],y=a.positions.getHeight(h),v=(t-m)/y,b=Math.floor(v*c),w=h*c+b,_=this.props.cells[d].date,C=df(o.slotMinTime,bS(l,w)),T=n.add(_,C),R=n.add(T,l);return{dateProfile:o,dateSpan:Object.assign({range:{start:T,end:R},allDay:!1},p.extraDateSpan),dayEl:r.els[d],rect:{left:r.lefts[d],right:r.rights[d],top:m,bottom:m+y},layer:0}}return null}};function aG(i,e){let t=e||i,n=uf(i,t);return n===null&&(t=i,n=1),{snapDuration:t,snapsPerSlot:n}}var D_=class extends aa{sliceRange(e,t){let n=[];for(let s=0;s<t.length;s+=1){let r=tn(e,t[s]);r&&n.push({start:r.start,end:r.end,isStart:r.start.valueOf()===e.start.valueOf(),isEnd:r.end.valueOf()===e.end.valueOf(),col:s})}return n}},M_=class extends st{constructor(){super(...arguments),this.buildDayRanges=$(lG),this.slicer=new D_,this.timeColsRef=Ne()}render(){let{props:e,context:t}=this,{dateProfile:n,dayTableModel:s}=e,{nowIndicator:r,nextDayThreshold:o}=t.options,a=this.buildDayRanges(s,n,t.dateEnv);return x(Lt,{unit:r?"minute":"day"},(l,c)=>x(I_,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(e,n,null,t,a),{forPrint:e.forPrint,axis:e.axis,dateProfile:n,slatMetas:e.slatMetas,slotDuration:e.slotDuration,cells:s.cells[0],tableColGroupNode:e.tableColGroupNode,tableMinWidth:e.tableMinWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight,expandRows:e.expandRows,nowDate:l,nowIndicatorSegs:r&&this.slicer.sliceNowDate(l,n,o,t,a),todayRange:c,onScrollTopRequest:e.onScrollTopRequest,onSlatCoords:e.onSlatCoords})))}};function lG(i,e,t){let n=[];for(let s of i.headerDates)n.push({start:t.add(s,e.slotMinTime),end:t.add(s,e.slotMaxTime)});return n}var KD=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function cG(i,e,t,n,s){let r=new Date(0),o=i,a=ee(0),l=t||dG(n),c=[];for(;en(o)<en(e);){let d=s.add(r,o),h=uf(a,l)!==null;c.push({date:d,time:o,key:d.toISOString(),isoTimeStr:_S(d),isLabeled:h}),o=df(o,n),a=df(a,n)}return c}function dG(i){let e,t,n;for(e=KD.length-1;e>=0;e-=1)if(t=ee(KD[e]),n=uf(t,i),n!==null&&n>1)return t;return i}var Hv=class extends w_{constructor(){super(...arguments),this.buildTimeColsModel=$(uG),this.buildSlatMetas=$(cG)}render(){let{options:e,dateEnv:t,dateProfileGenerator:n}=this.context,{props:s}=this,{dateProfile:r}=s,o=this.buildTimeColsModel(r,n),a=this.allDaySplitter.splitProps(s),l=this.buildSlatMetas(r.slotMinTime,r.slotMaxTime,e.slotLabelInterval,e.slotDuration,t),{dayMinWidth:c}=e,d=!c,h=c,p=e.dayHeaders&&x(sa,{dates:o.headerDates,dateProfile:r,datesRepDistinctDays:!0,renderIntro:d?this.renderHeadAxis:null}),m=e.allDaySlot!==!1&&(v=>x(Cf,Object.assign({},a.allDay,{dateProfile:r,dayTableModel:o,nextDayThreshold:e.nextDayThreshold,tableMinWidth:v.tableMinWidth,colGroupNode:v.tableColGroupNode,renderRowIntro:d?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:v.clientWidth,clientHeight:v.clientHeight,forPrint:s.forPrint},this.getAllDayMaxEventProps()))),y=v=>x(M_,Object.assign({},a.timed,{dayTableModel:o,dateProfile:r,axis:d,slotDuration:e.slotDuration,slatMetas:l,forPrint:s.forPrint,tableColGroupNode:v.tableColGroupNode,tableMinWidth:v.tableMinWidth,clientWidth:v.clientWidth,clientHeight:v.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:v.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return h?this.renderHScrollLayout(p,m,y,o.colCnt,c,l,this.state.slatCoords):this.renderSimpleLayout(p,m,y)}};function uG(i,e){let t=new ra(i.renderRange,e);return new oa(t,!1)}var hG='.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}';pr(hG);var fG={allDaySlot:Boolean},ZD=Ut({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:fG,views:{timeGrid:{component:Hv,usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});var k_=class extends te{constructor(){super(...arguments),this.state={textId:vn()}}render(){let{theme:e,dateEnv:t,options:n,viewApi:s}=this.context,{cellId:r,dayDate:o,todayRange:a}=this.props,{textId:l}=this.state,c=yf(o,a),d=n.listDayFormat?t.format(o,n.listDayFormat):"",h=n.listDaySideFormat?t.format(o,n.listDaySideFormat):"",p=Object.assign({date:t.toDate(o),view:s,textId:l,text:d,sideText:h,navLinkAttrs:Si(this.context,o),sideNavLinkAttrs:Si(this.context,o,"day",!1)},c);return x(xe,{elTag:"tr",elClasses:["fc-list-day",...Rc(c,e)],elAttrs:{"data-date":gr(o)},renderProps:p,generatorName:"dayHeaderContent",customGenerator:n.dayHeaderContent,defaultGenerator:pG,classNameGenerator:n.dayHeaderClassNames,didMount:n.dayHeaderDidMount,willUnmount:n.dayHeaderWillUnmount},m=>x("th",{scope:"colgroup",colSpan:3,id:r,"aria-labelledby":l},x(m,{elTag:"div",elClasses:["fc-list-day-cushion",e.getClass("tableCellShaded")]})))}};function pG(i){return x(ae,null,i.text&&x("a",Object.assign({id:i.textId,className:"fc-list-day-text"},i.navLinkAttrs),i.text),i.sideText&&x("a",Object.assign({"aria-hidden":!0,className:"fc-list-day-side-text"},i.sideNavLinkAttrs),i.sideText))}var gG=ue({hour:"numeric",minute:"2-digit",meridiem:"short"}),N_=class extends te{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s,timeHeaderId:r,eventHeaderId:o,dateHeaderId:a}=e,l=n.eventTimeFormat||gG;return x(fs,Object.assign({},e,{elTag:"tr",elClasses:["fc-list-event",s.eventRange.def.url&&"fc-event-forced-url"],defaultGenerator:()=>mG(s,t),seg:s,timeText:"",disableDragging:!0,disableResizing:!0}),(c,d)=>x(ae,null,yG(s,l,t,r,a),x("td",{"aria-hidden":!0,className:"fc-list-event-graphic"},x("span",{className:"fc-list-event-dot",style:{borderColor:d.borderColor||d.backgroundColor}})),x(c,{elTag:"td",elClasses:["fc-list-event-title"],elAttrs:{headers:`${o} ${a}`}})))}};function mG(i,e){let t=Tc(i,e);return x("a",Object.assign({},t),i.eventRange.def.title)}function yG(i,e,t,n,s){let{options:r}=t;if(r.displayEventTime!==!1){let o=i.eventRange.def,a=i.eventRange.instance,l=!1,c;if(o.allDay?l=!0:kS(i.eventRange.range)?i.isStart?c=vr(i,e,t,null,null,a.range.start,i.end):i.isEnd?c=vr(i,e,t,null,null,i.start,a.range.end):l=!0:c=vr(i,e,t),l){let d={text:t.options.allDayText,view:t.viewApi};return x(xe,{elTag:"td",elClasses:["fc-list-event-time"],elAttrs:{headers:`${n} ${s}`},renderProps:d,generatorName:"allDayContent",customGenerator:r.allDayContent,defaultGenerator:vG,classNameGenerator:r.allDayClassNames,didMount:r.allDayDidMount,willUnmount:r.allDayWillUnmount})}return x("td",{className:"fc-list-event-time"},c)}return null}function vG(i){return i.text}var Bv=class extends st{constructor(){super(...arguments),this.computeDateVars=$(bG),this.eventStoreToSegs=$(this._eventStoreToSegs),this.state={timeHeaderId:vn(),eventHeaderId:vn(),dateHeaderIdRoot:vn()},this.setRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e}):this.context.unregisterInteractiveComponent(this)}}render(){let{props:e,context:t}=this,{dayDates:n,dayRanges:s}=this.computeDateVars(e.dateProfile),r=this.eventStoreToSegs(e.eventStore,e.eventUiBases,s);return x($n,{elRef:this.setRootEl,elClasses:["fc-list",t.theme.getClass("table"),t.options.stickyHeaderDates!==!1?"fc-list-sticky":""],viewSpec:t.viewSpec},x(Ac,{liquid:!e.isHeightAuto,overflowX:e.isHeightAuto?"visible":"hidden",overflowY:e.isHeightAuto?"visible":"auto"},r.length>0?this.renderSegList(r,n):this.renderEmptyMessage()))}renderEmptyMessage(){let{options:e,viewApi:t}=this.context,n={text:e.noEventsText,view:t};return x(xe,{elTag:"div",elClasses:["fc-list-empty"],renderProps:n,generatorName:"noEventsContent",customGenerator:e.noEventsContent,defaultGenerator:EG,classNameGenerator:e.noEventsClassNames,didMount:e.noEventsDidMount,willUnmount:e.noEventsWillUnmount},s=>x(s,{elTag:"div",elClasses:["fc-list-empty-cushion"]}))}renderSegList(e,t){let{theme:n,options:s}=this.context,{timeHeaderId:r,eventHeaderId:o,dateHeaderIdRoot:a}=this.state,l=AG(e);return x(Lt,{unit:"day"},(c,d)=>{let h=[];for(let p=0;p<l.length;p+=1){let m=l[p];if(m){let y=gr(t[p]),v=a+"-"+y;h.push(x(k_,{key:y,cellId:v,dayDate:t[p],todayRange:d})),m=ua(m,s.eventOrder);for(let b of m)h.push(x(N_,Object.assign({key:y+":"+b.eventRange.instance.instanceId,seg:b,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,timeHeaderId:r,eventHeaderId:o,dateHeaderId:v},sn(b,d,c))))}}return x("table",{className:"fc-list-table "+n.getClass("table")},x("thead",null,x("tr",null,x("th",{scope:"col",id:r},s.timeHint),x("th",{scope:"col","aria-hidden":!0}),x("th",{scope:"col",id:o},s.eventHint))),x("tbody",null,h))})}_eventStoreToSegs(e,t,n){return this.eventRangesToSegs(bc(e,t,this.props.dateProfile.activeRange,this.context.options.nextDayThreshold).fg,n)}eventRangesToSegs(e,t){let n=[];for(let s of e)n.push(...this.eventRangeToSegs(s,t));return n}eventRangeToSegs(e,t){let{dateEnv:n}=this.context,{nextDayThreshold:s}=this.context.options,r=e.range,o=e.def.allDay,a,l,c,d=[];for(a=0;a<t.length;a+=1)if(l=tn(r,t[a]),l&&(c={component:this,eventRange:e,start:l.start,end:l.end,isStart:e.isStart&&l.start.valueOf()===r.start.valueOf(),isEnd:e.isEnd&&l.end.valueOf()===r.end.valueOf(),dayIndex:a},d.push(c),!c.isEnd&&!o&&a+1<t.length&&r.end<n.add(t[a+1].start,s))){c.end=r.end,c.isEnd=!0;break}return d}};function EG(i){return i.text}function bG(i){let e=de(i.renderRange.start),t=i.renderRange.end,n=[],s=[];for(;e<t;)n.push(e),s.push({start:e,end:be(e,1)}),e=be(e,1);return{dayDates:n,dayRanges:s}}function AG(i){let e=[],t,n;for(t=0;t<i.length;t+=1)n=i[t],(e[n.dayIndex]||(e[n.dayIndex]=[])).push(n);return e}var wG=':root{--fc-list-event-dot-width:10px;--fc-list-event-hover-bg-color:#f5f5f5}.fc-theme-standard .fc-list{border:1px solid var(--fc-border-color)}.fc .fc-list-empty{align-items:center;background-color:var(--fc-neutral-bg-color);display:flex;height:100%;justify-content:center}.fc .fc-list-empty-cushion{margin:5em 0}.fc .fc-list-table{border-style:hidden;width:100%}.fc .fc-list-table tr>*{border-left:0;border-right:0}.fc .fc-list-sticky .fc-list-day>*{background:var(--fc-page-bg-color);position:sticky;top:0}.fc .fc-list-table thead{left:-10000px;position:absolute}.fc .fc-list-table tbody>tr:first-child th{border-top:0}.fc .fc-list-table th{padding:0}.fc .fc-list-day-cushion,.fc .fc-list-table td{padding:8px 14px}.fc .fc-list-day-cushion:after{clear:both;content:"";display:table}.fc-theme-standard .fc-list-day-cushion{background-color:var(--fc-neutral-bg-color)}.fc-direction-ltr .fc-list-day-text,.fc-direction-rtl .fc-list-day-side-text{float:left}.fc-direction-ltr .fc-list-day-side-text,.fc-direction-rtl .fc-list-day-text{float:right}.fc-direction-ltr .fc-list-table .fc-list-event-graphic{padding-right:0}.fc-direction-rtl .fc-list-table .fc-list-event-graphic{padding-left:0}.fc .fc-list-event.fc-event-forced-url{cursor:pointer}.fc .fc-list-event:hover td{background-color:var(--fc-list-event-hover-bg-color)}.fc .fc-list-event-graphic,.fc .fc-list-event-time{white-space:nowrap;width:1px}.fc .fc-list-event-dot{border:calc(var(--fc-list-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-list-event-dot-width)/2);box-sizing:content-box;display:inline-block;height:0;width:0}.fc .fc-list-event-title a{color:inherit;text-decoration:none}.fc .fc-list-event.fc-event-forced-url:hover a{text-decoration:underline}';pr(wG);var SG={listDayFormat:QD,listDaySideFormat:QD,noEventsClassNames:M,noEventsContent:M,noEventsDidMount:M,noEventsWillUnmount:M};function QD(i){return i===!1?null:ue(i)}var jD=Ut({name:"@fullcalendar/list",optionRefiners:SG,views:{list:{component:Bv,buttonTextKey:"list",listDayFormat:{month:"long",day:"numeric",year:"numeric"}},listDay:{type:"list",duration:{days:1},listDayFormat:{weekday:"long"}},listWeek:{type:"list",duration:{weeks:1},listDayFormat:{weekday:"long"},listDaySideFormat:{month:"long",day:"numeric",year:"numeric"}},listMonth:{type:"list",duration:{month:1},listDaySideFormat:{weekday:"long"}},listYear:{type:"list",duration:{year:1},listDaySideFormat:{weekday:"long"}}}});bf.touchMouseIgnoreWait=500;var F_=0,Vv=0,L_=!1,Gv=class{constructor(e){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=t=>{if(!this.shouldIgnoreMouse()&&_G(t)&&this.tryStart(t)){let n=this.createEventFromMouse(t,!0);this.emitter.trigger("pointerdown",n),this.initScrollWatch(n),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=t=>{let n=this.createEventFromMouse(t);this.recordCoords(n),this.emitter.trigger("pointermove",n)},this.handleMouseUp=t=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(t)),this.cleanup()},this.handleTouchStart=t=>{if(this.tryStart(t)){this.isTouchDragging=!0;let n=this.createEventFromTouch(t,!0);this.emitter.trigger("pointerdown",n),this.initScrollWatch(n);let s=t.target;this.shouldIgnoreMove||s.addEventListener("touchmove",this.handleTouchMove),s.addEventListener("touchend",this.handleTouchEnd),s.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=t=>{let n=this.createEventFromTouch(t);this.recordCoords(n),this.emitter.trigger("pointermove",n)},this.handleTouchEnd=t=>{if(this.isDragging){let n=t.target;n.removeEventListener("touchmove",this.handleTouchMove),n.removeEventListener("touchend",this.handleTouchEnd),n.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(t)),this.cleanup(),this.isTouchDragging=!1,CG()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=t=>{if(!this.shouldIgnoreMove){let n=window.scrollX-this.prevScrollX+this.prevPageX,s=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:t,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:n,pageY:s,deltaX:n-this.origPageX,deltaY:s-this.origPageY})}},this.containerEl=e,this.emitter=new hs,e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),TG()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),xG()}tryStart(e){let t=this.querySubjectEl(e),n=e.target;return t&&(!this.handleSelector||Ve(n,this.handleSelector))?(this.subjectEl=t,this.isDragging=!0,this.wasTouchScroll=!1,!0):!1}cleanup(){L_=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(e){return this.selector?Ve(e.target,this.selector):this.containerEl}shouldIgnoreMouse(){return F_||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(L_=!0)}initScrollWatch(e){this.shouldWatchScroll&&(this.recordCoords(e),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(e){this.shouldWatchScroll&&(this.prevPageX=e.pageX,this.prevPageY=e.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(e,t){let n=0,s=0;return t?(this.origPageX=e.pageX,this.origPageY=e.pageY):(n=e.pageX-this.origPageX,s=e.pageY-this.origPageY),{origEvent:e,isTouch:!1,subjectEl:this.subjectEl,pageX:e.pageX,pageY:e.pageY,deltaX:n,deltaY:s}}createEventFromTouch(e,t){let n=e.touches,s,r,o=0,a=0;return n&&n.length?(s=n[0].pageX,r=n[0].pageY):(s=e.pageX,r=e.pageY),t?(this.origPageX=s,this.origPageY=r):(o=s-this.origPageX,a=r-this.origPageY),{origEvent:e,isTouch:!0,subjectEl:this.subjectEl,pageX:s,pageY:r,deltaX:o,deltaY:a}}};function _G(i){return i.button===0&&!i.ctrlKey}function CG(){F_+=1,setTimeout(()=>{F_-=1},bf.touchMouseIgnoreWait)}function TG(){Vv+=1,Vv===1&&window.addEventListener("touchmove",tM,{passive:!1})}function xG(){Vv-=1,Vv||window.removeEventListener("touchmove",tM,{passive:!1})}function tM(i){L_&&i.preventDefault()}var O_=class{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(e,t,n){this.sourceEl=e,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=t-window.scrollX,this.origScreenY=n-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(e,t){this.deltaX=e-window.scrollX-this.origScreenX,this.deltaY=t-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(e){e?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=e,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=e)}stop(e,t){let n=()=>{this.cleanup(),t()};e&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(n,this.revertDuration):setTimeout(n,0)}doRevertAnimation(e,t){let n=this.mirrorEl,s=this.sourceEl.getBoundingClientRect();n.style.transition="top "+t+"ms,left "+t+"ms",da(n,{left:s.left,top:s.top}),pS(n,()=>{n.style.transition="",e()})}cleanup(){this.mirrorEl&&(of(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&da(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let e=this.sourceElRect,t=this.mirrorEl;return t||(t=this.mirrorEl=this.sourceEl.cloneNode(!0),t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.pointerEvents="none",t.classList.add("fc-event-dragging"),da(t,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:e.right-e.left,height:e.bottom-e.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(t)),t}},$v=class extends na{constructor(e,t){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=e,this.doesListening=t,this.scrollTop=this.origScrollTop=e.getScrollTop(),this.scrollLeft=this.origScrollLeft=e.getScrollLeft(),this.scrollWidth=e.getScrollWidth(),this.scrollHeight=e.getScrollHeight(),this.clientWidth=e.getClientWidth(),this.clientHeight=e.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(e){this.scrollController.setScrollTop(e),this.doesListening||(this.scrollTop=Math.max(Math.min(e,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(e){this.scrollController.setScrollLeft(e),this.doesListening||(this.scrollLeft=Math.max(Math.min(e,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}},zv=class extends $v{constructor(e,t){super(new ef(e),t)}getEventTarget(){return this.scrollController.el}computeClientRect(){return ZS(this.scrollController.el)}},U_=class extends $v{constructor(e){super(new tf,e)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}},eM=typeof performance=="function"?performance.now:Date.now,H_=class{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let e=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(e){let t=eM();this.handleSide(e,(t-this.msSinceRequest)/1e3),this.requestAnimation(t)}else this.isAnimating=!1}}}start(e,t,n){this.isEnabled&&(this.scrollCaches=this.buildCaches(n),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(e,t))}handleMove(e,t){if(this.isEnabled){let n=e-window.scrollX,s=t-window.scrollY,r=this.pointerScreenY===null?0:s-this.pointerScreenY,o=this.pointerScreenX===null?0:n-this.pointerScreenX;r<0?this.everMovedUp=!0:r>0&&(this.everMovedDown=!0),o<0?this.everMovedLeft=!0:o>0&&(this.everMovedRight=!0),this.pointerScreenX=n,this.pointerScreenY=s,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(eM()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let e of this.scrollCaches)e.destroy();this.scrollCaches=null}}requestAnimation(e){this.msSinceRequest=e,requestAnimationFrame(this.animate)}handleSide(e,t){let{scrollCache:n}=e,{edgeThreshold:s}=this,r=s-e.distance,o=r*r/(s*s)*this.maxVelocity*t,a=1;switch(e.name){case"left":a=-1;case"right":n.setScrollLeft(n.getScrollLeft()+o*a);break;case"top":a=-1;case"bottom":n.setScrollTop(n.getScrollTop()+o*a);break}}computeBestEdge(e,t){let{edgeThreshold:n}=this,s=null,r=this.scrollCaches||[];for(let o of r){let a=o.clientRect,l=e-a.left,c=a.right-e,d=t-a.top,h=a.bottom-t;l>=0&&c>=0&&d>=0&&h>=0&&(d<=n&&this.everMovedUp&&o.canScrollUp()&&(!s||s.distance>d)&&(s={scrollCache:o,name:"top",distance:d}),h<=n&&this.everMovedDown&&o.canScrollDown()&&(!s||s.distance>h)&&(s={scrollCache:o,name:"bottom",distance:h}),l<=n&&this.everMovedLeft&&o.canScrollLeft()&&(!s||s.distance>l)&&(s={scrollCache:o,name:"left",distance:l}),c<=n&&this.everMovedRight&&o.canScrollRight()&&(!s||s.distance>c)&&(s={scrollCache:o,name:"right",distance:c}))}return s}buildCaches(e){return this.queryScrollEls(e).map(t=>t===window?new U_(!1):new zv(t,!1))}queryScrollEls(e){let t=[];for(let n of this.scrollQuery)typeof n=="object"?t.push(n):t.push(...Array.prototype.slice.call(e.getRootNode().querySelectorAll(n)));return t}},fa=class extends rf{constructor(e,t){super(e),this.containerEl=e,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=s=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,gS(document.body),yS(document.body),s.isTouch||s.origEvent.preventDefault(),this.emitter.trigger("pointerdown",s),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(s.subjectEl,s.pageX,s.pageY),this.startDelay(s),this.minDistance||this.handleDistanceSurpassed(s)))},this.onPointerMove=s=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",s),!this.isDistanceSurpassed){let r=this.minDistance,o,{deltaX:a,deltaY:l}=s;o=a*a+l*l,o>=r*r&&this.handleDistanceSurpassed(s)}this.isDragging&&(s.origEvent.type!=="scroll"&&(this.mirror.handleMove(s.pageX,s.pageY),this.autoScroller.handleMove(s.pageX,s.pageY)),this.emitter.trigger("dragmove",s))}},this.onPointerUp=s=>{this.isInteracting&&(this.isInteracting=!1,mS(document.body),vS(document.body),this.emitter.trigger("pointerup",s),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(s)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let n=this.pointer=new Gv(e);n.emitter.on("pointerdown",this.onPointerDown),n.emitter.on("pointermove",this.onPointerMove),n.emitter.on("pointerup",this.onPointerUp),t&&(n.selector=t),this.mirror=new O_,this.autoScroller=new H_}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(e){typeof this.delay=="number"?this.delayTimeoutId=setTimeout(()=>{this.delayTimeoutId=null,this.handleDelayEnd(e)},this.delay):this.handleDelayEnd(e)}handleDelayEnd(e){this.isDelayEnded=!0,this.tryStartDrag(e)}handleDistanceSurpassed(e){this.isDistanceSurpassed=!0,this.tryStartDrag(e)}tryStartDrag(e){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(e.pageX,e.pageY,this.containerEl),this.emitter.trigger("dragstart",e),this.touchScrollAllowed===!1&&this.pointer.cancelTouchScroll())}tryStopDrag(e){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,e))}stopDrag(e){this.isDragging=!1,this.emitter.trigger("dragend",e)}setIgnoreMove(e){this.pointer.shouldIgnoreMove=e}setMirrorIsVisible(e){this.mirror.setIsVisible(e)}setMirrorNeedsRevert(e){this.mirrorNeedsRevert=e}setAutoScrollEnabled(e){this.autoScroller.isEnabled=e}},B_=class{constructor(e){this.el=e,this.origRect=vf(e),this.scrollCaches=Cv(e).map(t=>new zv(t,!0))}destroy(){for(let e of this.scrollCaches)e.destroy()}computeLeft(){let e=this.origRect.left;for(let t of this.scrollCaches)e+=t.origScrollLeft-t.getScrollLeft();return e}computeTop(){let e=this.origRect.top;for(let t of this.scrollCaches)e+=t.origScrollTop-t.getScrollTop();return e}isWithinClipping(e,t){let n={left:e,top:t};for(let s of this.scrollCaches)if(!RG(s.getEventTarget())&&!YS(n,s.clientRect))return!1;return!0}};function RG(i){let e=i.tagName;return e==="HTML"||e==="BODY"}var Pc=class{constructor(e,t){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=n=>{let{dragging:s}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(n),this.initialHit||!this.requireInitial?(s.setIgnoreMove(!1),this.emitter.trigger("pointerdown",n)):s.setIgnoreMove(!0)},this.handleDragStart=n=>{this.emitter.trigger("dragstart",n),this.handleMove(n,!0)},this.handleDragMove=n=>{this.emitter.trigger("dragmove",n),this.handleMove(n)},this.handlePointerUp=n=>{this.releaseHits(),this.emitter.trigger("pointerup",n)},this.handleDragEnd=n=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,n),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",n)},this.droppableStore=t,e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragstart",this.handleDragStart),e.emitter.on("dragmove",this.handleDragMove),e.emitter.on("pointerup",this.handlePointerUp),e.emitter.on("dragend",this.handleDragEnd),this.dragging=e,this.emitter=new hs}processFirstCoord(e){let t={left:e.pageX,top:e.pageY},n=t,s=e.subjectEl,r;s instanceof HTMLElement&&(r=vf(s),n=KS(n,r));let o=this.initialHit=this.queryHitForOffset(n.left,n.top);if(o){if(this.useSubjectCenter&&r){let a=_v(r,o.rect);a&&(n=XS(a))}this.coordAdjust=JS(n,t)}else this.coordAdjust={left:0,top:0}}handleMove(e,t){let n=this.queryHitForOffset(e.pageX+this.coordAdjust.left,e.pageY+this.coordAdjust.top);(t||!qv(this.movingHit,n))&&(this.movingHit=n,this.emitter.trigger("hitupdate",n,!1,e))}prepareHits(){this.offsetTrackers=yn(this.droppableStore,e=>(e.component.prepareHits(),new B_(e.el)))}releaseHits(){let{offsetTrackers:e}=this;for(let t in e)e[t].destroy();this.offsetTrackers={}}queryHitForOffset(e,t){let{droppableStore:n,offsetTrackers:s}=this,r=null;for(let o in n){let a=n[o].component,l=s[o];if(l&&l.isWithinClipping(e,t)){let c=l.computeLeft(),d=l.computeTop(),h=e-c,p=t-d,{origRect:m}=l,y=m.right-m.left,v=m.bottom-m.top;if(h>=0&&h<y&&p>=0&&p<v){let b=a.queryHit(h,p,y,v);b&&_c(b.dateProfile.activeRange,b.dateSpan.range)&&(this.disablePointCheck||l.el.contains(l.el.getRootNode().elementFromPoint(h+c-window.scrollX,p+d-window.scrollY)))&&(!r||b.layer>r.layer)&&(b.componentId=o,b.context=a.context,b.rect.left+=c,b.rect.right+=c,b.rect.top+=d,b.rect.bottom+=d,r=b)}}}return r}};function qv(i,e){return!i&&!e?!0:!!i!=!!e?!1:GS(i.dateSpan,e.dateSpan)}function nM(i,e){let t={};for(let n of e.pluginHooks.datePointTransforms)Object.assign(t,n(i,e));return Object.assign(t,IG(i,e.dateEnv)),t}function IG(i,e){return{date:e.toDate(i.range.start),dateStr:e.formatIso(i.range.start,{omitTime:i.allDay}),allDay:i.allDay}}var V_=class extends zn{constructor(e){super(e),this.handlePointerDown=n=>{let{dragging:s}=this,r=n.origEvent.target;s.setIgnoreMove(!this.component.isValidDateDownEl(r))},this.handleDragEnd=n=>{let{component:s}=this,{pointer:r}=this.dragging;if(!r.wasTouchScroll){let{initialHit:o,finalHit:a}=this.hitDragging;if(o&&a&&qv(o,a)){let{context:l}=s,c=Object.assign(Object.assign({},nM(o.dateSpan,l)),{dayEl:o.dayEl,jsEvent:n.origEvent,view:l.viewApi||l.calendarApi.view});l.emitter.trigger("dateClick",c)}}},this.dragging=new fa(e.el),this.dragging.autoScroller.isEnabled=!1;let t=this.hitDragging=new Pc(this.dragging,mf(e));t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}},G_=class extends zn{constructor(e){super(e),this.dragSelection=null,this.handlePointerDown=o=>{let{component:a,dragging:l}=this,{options:c}=a.context,d=c.selectable&&a.isValidDateDownEl(o.origEvent.target);l.setIgnoreMove(!d),l.delay=o.isTouch?DG(a):null},this.handleDragStart=o=>{this.component.context.calendarApi.unselect(o)},this.handleHitUpdate=(o,a)=>{let{context:l}=this.component,c=null,d=!1;if(o){let h=this.hitDragging.initialHit;o.componentId===h.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(h,o)||(c=MG(h,o,l.pluginHooks.dateSelectionTransformers)),(!c||!jS(c,o.dateProfile,l))&&(d=!0,c=null)}c?l.dispatch({type:"SELECT_DATES",selection:c}):a||l.dispatch({type:"UNSELECT_DATES"}),d?lf():cf(),a||(this.dragSelection=c)},this.handlePointerUp=o=>{this.dragSelection&&(Sv(this.dragSelection,o,this.component.context),this.dragSelection=null)};let{component:t}=e,{options:n}=t.context,s=this.dragging=new fa(e.el);s.touchScrollAllowed=!1,s.minDistance=n.selectMinDistance||0,s.autoScroller.isEnabled=n.dragScroll;let r=this.hitDragging=new Pc(this.dragging,mf(e));r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}};function DG(i){let{options:e}=i.context,t=e.selectLongPressDelay;return t==null&&(t=e.longPressDelay),t}function MG(i,e,t){let n=i.dateSpan,s=e.dateSpan,r=[n.range.start,n.range.end,s.range.start,s.range.end];r.sort(ES);let o={};for(let a of t){let l=a(i,e);if(l===!1)return null;l&&Object.assign(o,l)}return o.range={start:r[0],end:r[3]},o.allDay=n.allDay,o}var xf=class i extends zn{constructor(e){super(e),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=o=>{let a=o.origEvent.target,{component:l,dragging:c}=this,{mirror:d}=c,{options:h}=l.context,p=l.context;this.subjectEl=o.subjectEl;let m=this.subjectSeg=gs(o.subjectEl),v=(this.eventRange=m.eventRange).instance.instanceId;this.relevantEvents=ff(p.getCurrentData().eventStore,v),c.minDistance=o.isTouch?0:h.eventDragMinDistance,c.delay=o.isTouch&&v!==l.props.eventSelection?kG(l):null,h.fixedMirrorParent?d.parentNode=h.fixedMirrorParent:d.parentNode=Ve(a,".fc"),d.revertDuration=h.dragRevertDuration;let b=l.isValidSegDownEl(a)&&!Ve(a,".fc-event-resizer");c.setIgnoreMove(!b),this.isDragging=b&&o.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=o=>{let a=this.component.context,l=this.eventRange,c=l.instance.instanceId;o.isTouch?c!==this.component.props.eventSelection&&a.dispatch({type:"SELECT_EVENT",eventInstanceId:c}):a.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(a.calendarApi.unselect(o),a.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new me(a,l.def,l.instance),jsEvent:o.origEvent,view:a.viewApi}))},this.handleHitUpdate=(o,a)=>{if(!this.isDragging)return;let l=this.relevantEvents,c=this.hitDragging.initialHit,d=this.component.context,h=null,p=null,m=null,y=!1,v={affectedEvents:l,mutatedEvents:yt(),isEvent:!0};if(o){h=o.context;let b=h.options;d===h||b.editable&&b.droppable?(p=PG(c,o,this.eventRange.instance.range.start,h.getCurrentData().pluginHooks.eventDragMutationMassagers),p&&(m=pf(l,h.getCurrentData().eventUiBases,p,h),v.mutatedEvents=m,Tv(v,o.dateProfile,h)||(y=!0,p=null,m=null,v.mutatedEvents=yt()))):h=null}this.displayDrag(h,v),y?lf():cf(),a||(d===h&&qv(c,o)&&(p=null),this.dragging.setMirrorNeedsRevert(!p),this.dragging.setMirrorIsVisible(!o||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=h,this.validMutation=p,this.mutatedRelevantEvents=m)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=o=>{if(this.isDragging){let a=this.component.context,l=a.viewApi,{receivingContext:c,validMutation:d}=this,h=this.eventRange.def,p=this.eventRange.instance,m=new me(a,h,p),y=this.relevantEvents,v=this.mutatedRelevantEvents,{finalHit:b}=this.hitDragging;if(this.clearDrag(),a.emitter.trigger("eventDragStop",{el:this.subjectEl,event:m,jsEvent:o.origEvent,view:l}),d){if(c===a){let w=new me(a,v.defs[h.defId],p?v.instances[p.instanceId]:null);a.dispatch({type:"MERGE_EVENTS",eventStore:v});let _={oldEvent:m,event:w,relatedEvents:wi(v,a,p),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:y})}},C={};for(let T of a.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(C,T(d,a));a.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},_),C),{el:o.subjectEl,delta:d.datesDelta,jsEvent:o.origEvent,view:l})),a.emitter.trigger("eventChange",_)}else if(c){let w={event:m,relatedEvents:wi(y,a,p),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:y})}};a.emitter.trigger("eventLeave",Object.assign(Object.assign({},w),{draggedEl:o.subjectEl,view:l})),a.dispatch({type:"REMOVE_EVENTS",eventStore:y}),a.emitter.trigger("eventRemove",w);let _=v.defs[h.defId],C=v.instances[p.instanceId],T=new me(c,_,C);c.dispatch({type:"MERGE_EVENTS",eventStore:v});let R={event:T,relatedEvents:wi(v,c,C),revert(){c.dispatch({type:"REMOVE_EVENTS",eventStore:v})}};c.emitter.trigger("eventAdd",R),o.isTouch&&c.dispatch({type:"SELECT_EVENT",eventInstanceId:p.instanceId}),c.emitter.trigger("drop",Object.assign(Object.assign({},nM(b.dateSpan,c)),{draggedEl:o.subjectEl,jsEvent:o.origEvent,view:b.context.viewApi})),c.emitter.trigger("eventReceive",Object.assign(Object.assign({},R),{draggedEl:o.subjectEl,view:b.context.viewApi}))}}else a.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:t}=this,{options:n}=t.context,s=this.dragging=new fa(e.el);s.pointer.selector=i.SELECTOR,s.touchScrollAllowed=!1,s.autoScroller.isEnabled=n.dragScroll;let r=this.hitDragging=new Pc(this.dragging,xc);r.useSubjectCenter=e.useEventCenter,r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("pointerup",this.handlePointerUp),r.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(e,t){let n=this.component.context,s=this.receivingContext;s&&s!==e&&(s===n?s.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:t.affectedEvents,mutatedEvents:yt(),isEvent:!0}}):s.dispatch({type:"UNSET_EVENT_DRAG"})),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){let e=this.component.context,{receivingContext:t}=this;t&&t.dispatch({type:"UNSET_EVENT_DRAG"}),e!==t&&e.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}};xf.SELECTOR=".fc-event-draggable, .fc-event-resizable";function PG(i,e,t,n){let s=i.dateSpan,r=e.dateSpan,o=s.range.start,a=r.range.start,l={};s.allDay!==r.allDay&&(l.allDay=r.allDay,l.hasEnd=e.context.options.allDayMaintainDuration,r.allDay?o=de(t):o=t);let c=dr(o,a,i.context.dateEnv,i.componentId===e.componentId?i.largeUnit:null);c.milliseconds&&(l.allDay=!1);let d={datesDelta:c,standardProps:l};for(let h of n)h(d,i,e);return d}function kG(i){let{options:e}=i.context,t=e.eventLongPressDelay;return t==null&&(t=e.longPressDelay),t}var $_=class extends zn{constructor(e){super(e),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=r=>{let{component:o}=this,a=this.querySegEl(r),l=gs(a),c=this.eventRange=l.eventRange;this.dragging.minDistance=o.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(r.origEvent.target)||r.isTouch&&this.component.props.eventSelection!==c.instance.instanceId)},this.handleDragStart=r=>{let{context:o}=this.component,a=this.eventRange;this.relevantEvents=ff(o.getCurrentData().eventStore,this.eventRange.instance.instanceId);let l=this.querySegEl(r);this.draggingSegEl=l,this.draggingSeg=gs(l),o.calendarApi.unselect(),o.emitter.trigger("eventResizeStart",{el:l,event:new me(o,a.def,a.instance),jsEvent:r.origEvent,view:o.viewApi})},this.handleHitUpdate=(r,o,a)=>{let{context:l}=this.component,c=this.relevantEvents,d=this.hitDragging.initialHit,h=this.eventRange.instance,p=null,m=null,y=!1,v={affectedEvents:c,mutatedEvents:yt(),isEvent:!0};r&&(r.componentId===d.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(d,r)||(p=NG(d,r,a.subjectEl.classList.contains("fc-event-resizer-start"),h.range))),p&&(m=pf(c,l.getCurrentData().eventUiBases,p,l),v.mutatedEvents=m,Tv(v,r.dateProfile,l)||(y=!0,p=null,m=null,v.mutatedEvents=null)),m?l.dispatch({type:"SET_EVENT_RESIZE",state:v}):l.dispatch({type:"UNSET_EVENT_RESIZE"}),y?lf():cf(),o||(p&&qv(d,r)&&(p=null),this.validMutation=p,this.mutatedRelevantEvents=m)},this.handleDragEnd=r=>{let{context:o}=this.component,a=this.eventRange.def,l=this.eventRange.instance,c=new me(o,a,l),d=this.relevantEvents,h=this.mutatedRelevantEvents;if(o.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:c,jsEvent:r.origEvent,view:o.viewApi}),this.validMutation){let p=new me(o,h.defs[a.defId],l?h.instances[l.instanceId]:null);o.dispatch({type:"MERGE_EVENTS",eventStore:h});let m={oldEvent:c,event:p,relatedEvents:wi(h,o,l),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:d})}};o.emitter.trigger("eventResize",Object.assign(Object.assign({},m),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||ee(0),endDelta:this.validMutation.endDelta||ee(0),jsEvent:r.origEvent,view:o.viewApi})),o.emitter.trigger("eventChange",m)}else o.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:t}=e,n=this.dragging=new fa(e.el);n.pointer.selector=".fc-event-resizer",n.touchScrollAllowed=!1,n.autoScroller.isEnabled=t.context.options.dragScroll;let s=this.hitDragging=new Pc(this.dragging,mf(e));s.emitter.on("pointerdown",this.handlePointerDown),s.emitter.on("dragstart",this.handleDragStart),s.emitter.on("hitupdate",this.handleHitUpdate),s.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(e){return Ve(e.subjectEl,".fc-event")}};function NG(i,e,t,n){let s=i.context.dateEnv,r=i.dateSpan.range.start,o=e.dateSpan.range.start,a=dr(r,o,s,i.largeUnit);if(t){if(s.add(n.start,a)<n.end)return{startDelta:a}}else if(s.add(n.end,a)>n.start)return{endDelta:a};return null}var z_=class{constructor(e){this.context=e,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=n=>{n.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=n=>{let s=this.context.options.unselectCancel,r=uv(n.origEvent);this.matchesCancel=!!Ve(r,s),this.matchesEvent=!!Ve(r,xf.SELECTOR)},this.onDocumentPointerUp=n=>{let{context:s}=this,{documentPointer:r}=this,o=s.getCurrentData();if(!r.wasTouchScroll){if(o.dateSelection&&!this.isRecentPointerDateSelect){let a=s.options.unselectAuto;a&&(!a||!this.matchesCancel)&&s.calendarApi.unselect(n)}o.eventSelection&&!this.matchesEvent&&s.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let t=this.documentPointer=new Gv(document);t.shouldIgnoreMove=!0,t.shouldWatchScroll=!1,t.emitter.on("pointerdown",this.onDocumentPointerDown),t.emitter.on("pointerup",this.onDocumentPointerUp),e.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}},FG={fixedMirrorParent:M},LG={dateClick:M,eventDragStart:M,eventDragStop:M,eventDrop:M,eventResizeStart:M,eventResizeStop:M,eventResize:M,drop:M,eventReceive:M,eventLeave:M};bf.dataAttrPrefix="";var iM=Ut({name:"@fullcalendar/interaction",componentInteractions:[V_,G_,xf,$_],calendarInteractions:[z_],elementDraggingImpl:fa,optionRefiners:FG,listenerRefiners:LG});var Rf=require("obsidian");var If=class extends Rf.Modal{constructor(t,n,s,r){super(t);this.saveCallback=null;this.event=n,this.dataProvider=s,this.settings=r}onSave(t){this.saveCallback=t}onOpen(){var w,_,C;let{contentEl:t}=this;t.empty(),t.addClass("zfb-event-modal");let n={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"},s={note:"\uB178\uD2B8",schedule:"\uC77C\uC815",meeting:"\uD68C\uC758\uB85D"},r=t.createDiv({cls:"event-modal-header"});r.style.display="flex",r.style.alignItems="center",r.style.gap="12px",r.style.marginBottom="16px";let o=r.createEl("span",{text:`${n[this.event.type]} ${s[this.event.type]}`});o.style.padding="4px 8px",o.style.backgroundColor=this.event.color||"var(--interactive-accent)",o.style.color="var(--text-on-accent)",o.style.borderRadius="4px",o.style.fontSize="12px",r.createEl("h2",{text:this.event.title}).style.margin="0";let a=t.createDiv({cls:"event-details"});a.style.padding="16px",a.style.backgroundColor="var(--background-secondary)",a.style.borderRadius="8px",a.style.marginBottom="16px";let l=a.createDiv({cls:"detail-row"});l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginBottom="8px",l.createEl("span",{text:"\u{1F4C5}"});let c=Le(this.event.start,this.settings.timezone),d="";if(this.event.allDay)d=" (\uC885\uC77C)";else{let T=this.event.start.getHours().toString().padStart(2,"0"),R=this.event.start.getMinutes().toString().padStart(2,"0");d=` ${T}:${R}`}if(l.createEl("span",{text:c+d}),(w=this.event.metadata)!=null&&w.project){let T=a.createDiv({cls:"detail-row"});T.style.display="flex",T.style.alignItems="center",T.style.gap="8px",T.style.marginBottom="8px",T.createEl("span",{text:"\u{1F4C1}"}),T.createEl("span",{text:this.event.metadata.project})}if((_=this.event.metadata)!=null&&_.tags&&this.event.metadata.tags.length>0){let T=a.createDiv({cls:"detail-row"});T.style.display="flex",T.style.alignItems="center",T.style.gap="8px",T.style.marginBottom="8px",T.createEl("span",{text:"\u{1F3F7}"});let R=T.createDiv({cls:"tags"});R.style.display="flex",R.style.gap="4px",R.style.flexWrap="wrap";for(let D of this.event.metadata.tags){let I=R.createEl("span",{text:`#${D}`});I.style.padding="2px 6px",I.style.backgroundColor="var(--background-modifier-border)",I.style.borderRadius="4px",I.style.fontSize="12px"}}if((C=this.event.metadata)!=null&&C.summary){let T=a.createDiv({cls:"detail-row"});T.style.marginTop="12px",T.style.paddingTop="12px",T.style.borderTop="1px solid var(--background-modifier-border)",T.createEl("div",{text:"\uC694\uC57D"}).style.fontWeight="500",T.createEl("p",{text:this.event.metadata.summary}).style.margin="4px 0 0 0"}let h=a.createDiv({cls:"detail-row"});h.style.marginTop="12px",h.style.fontSize="12px",h.style.color="var(--text-muted)",h.setText(`\uD30C\uC77C: ${this.event.source.path}`),this.event.source.lineNumber&&h.appendText(` (\uB77C\uC778 ${this.event.source.lineNumber})`);let p=t.createDiv({cls:"modal-button-container"});p.style.display="flex",p.style.justifyContent="space-between",p.style.marginTop="16px";let m=p.createDiv();if(this.event.type==="schedule"&&this.event.source.lineNumber){let T=m.createEl("button",{text:"\uC0AD\uC81C"});T.style.color="var(--text-error)",T.addEventListener("click",async()=>{confirm("\uC774 \uC77C\uC815\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")&&(await this.dataProvider.deleteEvent(this.event.id)?(new Rf.Notice("\uC77C\uC815\uC774 \uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),this.saveCallback&&this.saveCallback(),this.close()):new Rf.Notice("\uC77C\uC815 \uC0AD\uC81C\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4."))})}let y=p.createDiv();y.style.display="flex",y.style.gap="8px",y.createEl("button",{text:"\uD30C\uC77C \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",async()=>{await this.dataProvider.openEvent(this.event.id),this.close()}),y.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}};var kc="zfb-calendar",Df=class extends sM.ItemView{constructor(t,n,s){super(t);this.calendar=null;this.settings=n,this.dataProvider=s}getViewType(){return kc}getDisplayText(){return"Zero Friction \uCE98\uB9B0\uB354"}getIcon(){return"calendar"}async onOpen(){let t=this.contentEl;t.empty(),t.addClass("zfb-full-calendar");let n=t.createDiv({cls:"calendar-container"});n.style.height="100%",n.style.padding="16px";let s=await this.loadEvents();this.calendar=new Dv(n,{plugins:[zD,ZD,jD,iM],initialView:this.getInitialView(),locale:"ko",firstDay:this.settings.calendarFirstDayOfWeek,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},buttonText:{today:"\uC624\uB298",month:"\uC6D4",week:"\uC8FC",day:"\uC77C",list:"\uBAA9\uB85D"},events:s,editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},eventClick:r=>{this.handleEventClick(r)},eventDrop:async r=>{await this.handleEventDrop(r)},select:r=>{this.handleDateSelect(r)},eventDidMount:r=>{let o=r.event,a=o.extendedProps;a!=null&&a.project&&(r.el.title=`${o.title}
\uD504\uB85C\uC81D\uD2B8: ${a.project}`)}}),this.calendar.render()}async onClose(){this.calendar&&(this.calendar.destroy(),this.calendar=null),this.contentEl.empty()}updateSettings(t){this.settings=t,this.calendar&&this.calendar.setOption("firstDay",t.calendarFirstDayOfWeek)}async refreshEvents(){if(!this.calendar)return;let t=await this.loadEvents();this.calendar.removeAllEvents(),this.calendar.addEventSource(t)}getInitialView(){switch(this.settings.calendarDefaultView){case"month":return"dayGridMonth";case"week":return"timeGridWeek";case"day":return"timeGridDay";case"list":return"listWeek";default:return"dayGridMonth"}}async loadEvents(){let t=new Date,n=new Date(t.getFullYear(),t.getMonth()-3,1),s=new Date(t.getFullYear(),t.getMonth()+3,0);return(await this.dataProvider.getEventsForRange(n,s)).map(o=>this.convertToFullCalendarEvent(o))}convertToFullCalendarEvent(t){return{id:t.id,title:t.title,start:t.start,end:t.end,allDay:t.allDay,backgroundColor:t.color,borderColor:t.color,extendedProps:{type:t.type,source:t.source,...t.metadata}}}handleEventClick(t){let n=t.event.id,s=t.event.extendedProps,r={id:n,title:t.event.title,start:t.event.start,end:t.event.end||void 0,allDay:t.event.allDay,type:s.type,color:t.event.backgroundColor||void 0,source:s.source,metadata:{project:s.project,tags:s.tags,summary:s.summary}},o=new If(this.app,r,this.dataProvider,this.settings);o.onSave(async()=>{await this.refreshEvents()}),o.open()}async handleEventDrop(t){let n=t.event.id,s=t.event.start;await this.dataProvider.moveEvent(n,s)||t.revert()}handleDateSelect(t){var n;(n=this.calendar)==null||n.unselect()}};function Mf(i,e=100){return i.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,e)}var Wv=class extends P.Plugin{constructor(){super(...arguments);this.gemini=null;this.ocrProcessor=null;this.relatedNoteFinder=null;this.mocManager=null;this.zkIndexManager=null;this.youtubeExtractor=null;this.webPageExtractor=null;this.reviewManager=null;this.meetingProcessor=null;this.scheduleManager=null;this.googleCalendar=null;this.calendarDataProvider=null;this.watcherRegistered=!1;this.pendingFiles=new Map;this.zkDailyCounter=new Map;this.zkLuhmannCounter=0}async onload(){await this.loadSettings(),this.addSettingTab(new Ff(this.app,this)),this.processDebounced=(0,P.debounce)(()=>this.processPendingFiles(),3e3,!0),this.calendarDataProvider=new Uh(this.app,this.settings),this.registerCalendarViews(),this.registerCommands(),this.settings.autoWatch&&this.startWatcher(),this.app.workspace.onLayoutReady(()=>{this.initGemini()}),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uB85C\uB4DC\uB428")}onunload(){this.stopWatcher(),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uC5B8\uB85C\uB4DC\uB428")}async loadSettings(){this.settings=Object.assign({},iC,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.initGemini()}async initGemini(){this.settings.geminiApiKey?(this.gemini=new Sp(this.settings.geminiApiKey),this.ocrProcessor=new Iy(this.gemini,this.settings,this.app.vault),this.relatedNoteFinder=new Dy(this.app,this.gemini),this.mocManager=new My(this.app,this.gemini,this.settings.projectsFolder,this.settings),this.zkIndexManager=new Py(this.app,this.relatedNoteFinder,this.settings.zettelFolder,this.settings,this.gemini),this.youtubeExtractor=new Oy(this.gemini,this.settings),this.webPageExtractor=new Uy(this.gemini,this.settings),this.reviewManager=new ky(this.app,this.gemini,this.settings),this.meetingProcessor=new Ny(this.app,this.gemini,this.settings),this.scheduleManager=new Fy(this.app,this.settings),this.googleCalendar=new Oh(this.app,this.settings,()=>this.saveSettings()),Promise.all([this.relatedNoteFinder.buildIndex(),this.mocManager.scanProjectMOCs()]).then(()=>{var t,n,s;console.log(`\uB178\uD2B8 \uC778\uB371\uC2A4: ${(t=this.relatedNoteFinder)==null?void 0:t.getIndexSize()}\uAC1C, MOC: ${(n=this.mocManager)==null?void 0:n.getMOCCount()}\uAC1C, ZK: ${(s=this.relatedNoteFinder)==null?void 0:s.getZettelCount()}\uAC1C`),this.initializeZKCounters()})):(this.gemini=null,this.ocrProcessor=null,this.relatedNoteFinder=null,this.mocManager=null,this.youtubeExtractor=null,this.webPageExtractor=null,this.reviewManager=null,this.scheduleManager=null,this.googleCalendar=null)}checkApiKey(){return this.gemini?!0:(new P.Notice("Gemini API \uD0A4\uB97C \uC124\uC815\uD574\uC8FC\uC138\uC694"),!1)}truncateContent(t,n=5e5){let s=t.replace(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g,"[\uC774\uBBF8\uC9C0]");return s=s.replace(/!\[[^\]]*\]\(data:[^)]+\)/g,"[\uC774\uBBF8\uC9C0]"),s.length<=n?s:s.slice(0,n)+`

[... \uB0B4\uC6A9\uC774 \uB108\uBB34 \uAE38\uC5B4 \uC77C\uBD80\uB9CC \uBD84\uC11D\uB428 ...]`}registerCommands(){this.addCommand({id:"project-classify",name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkeys:[{modifiers:["Ctrl","Shift"],key:"g"}],callback:()=>this.classifyCurrentFile()}),this.addCommand({id:"zk-extract",name:"ZK \uCD94\uCD9C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"z"}],callback:()=>this.extractZKFromCurrentFile()}),this.addCommand({id:"focus-top3",name:"Focus Top 3",hotkeys:[{modifiers:["Ctrl","Shift"],key:";"}],callback:()=>this.showFocusTop3()}),this.addCommand({id:"process-inbox",name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",callback:()=>this.processInbox()}),this.addCommand({id:"toggle-watch",name:"Watch \uD1A0\uAE00",callback:()=>this.toggleWatch()}),this.addCommand({id:"ocr-extract",name:"OCR \uCD94\uCD9C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"o"}],callback:()=>this.ocrCurrentFile()}),this.addCommand({id:"ocr-inbox",name:"Inbox OCR \uCC98\uB9AC",callback:()=>this.processInboxOCR()}),this.addCommand({id:"smart-process",name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkeys:[{modifiers:["Ctrl","Shift"],key:"s"}],callback:()=>this.smartProcessCurrentFile()}),this.addCommand({id:"create-moc",name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",callback:()=>this.showCreateMOCModal()}),this.addCommand({id:"url-import",name:"URL \uAC00\uC838\uC624\uAE30",hotkeys:[{modifiers:["Ctrl","Shift"],key:"u"}],callback:()=>this.showURLImportModal()}),this.addCommand({id:"rebuild-zk-index",name:"ZK Index \uC7AC\uAD6C\uCD95",callback:()=>this.rebuildZKIndex()}),this.addCommand({id:"smart-split",name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkeys:[{modifiers:["Ctrl","Shift"],key:"d"}],callback:()=>this.smartSplitCurrentFile()}),this.addCommand({id:"link-related-notes",name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkeys:[{modifiers:["Ctrl","Shift"],key:"l"}],callback:()=>this.linkRelatedNotesForCurrentFile()}),this.addCommand({id:"review-mode",name:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC",hotkeys:[{modifiers:["Ctrl","Shift"],key:"r"}],callback:()=>this.showReviewModal()}),this.addCommand({id:"show-command-list",name:"\uBA85\uB839 \uB9AC\uC2A4\uD2B8",callback:()=>this.showCommandListModal()}),this.addCommand({id:"open-calendar",name:"\uCE98\uB9B0\uB354 \uBDF0",hotkeys:[{modifiers:["Ctrl","Shift"],key:"c"}],callback:()=>this.openCalendarView()}),this.addRibbonIcon("brain","Zero Friction Brain",()=>{this.showCommandListModal()}),this.settings.calendarEnabled&&this.addRibbonIcon("calendar","\uCE98\uB9B0\uB354 \uBDF0",()=>{this.openCalendarView()})}registerCalendarViews(){this.registerView(kc,t=>new Df(t,this.settings,this.calendarDataProvider)),this.registerView(mc,t=>new Bh(t,this.settings,this.calendarDataProvider))}async openCalendarView(){let t=this.app.workspace.getLeavesOfType(kc);t.length>0?this.app.workspace.revealLeaf(t[0]):await this.app.workspace.getLeaf("tab").setViewState({type:kc,active:!0})}async toggleMiniCalendar(){let t=this.app.workspace.getLeavesOfType(mc);if(t.length>0)t[0].detach();else{let n=this.app.workspace.getRightLeaf(!1);n&&await n.setViewState({type:mc,active:!0})}}showReviewModal(){if(this.checkApiKey()){if(!this.reviewManager){new P.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new tC(this.app,this.reviewManager,this.settings).open()}}async connectGoogleCalendar(){this.googleCalendar||(this.googleCalendar=new Oh(this.app,this.settings,()=>this.saveSettings())),await this.googleCalendar.startOAuth()}async disconnectGoogleCalendar(){this.googleCalendar&&await this.googleCalendar.disconnect()}async detectAndSaveSchedules(t){if(this.settings.scheduleDetectionEnabled&&!(!this.gemini||!this.scheduleManager))try{let n=Yn(this.settings.timezone),s=await this.gemini.detectSchedules(t,n);if(s.length===0)return;let o=await new Hy(this.app,s,this.settings).openAndWait();if(!o||o.selectedSchedules.length===0)return;let a=0,l=0;o.saveToDaily&&(a=await this.scheduleManager.saveToDaily(o.selectedSchedules)),o.saveToGoogle&&this.googleCalendar&&this.googleCalendar.isConnected()&&(l=await this.googleCalendar.saveSchedules(o.selectedSchedules));let c=[];a>0&&c.push(`Daily Notes: ${a}\uAC1C`),l>0&&c.push(`Google Calendar: ${l}\uAC1C`),c.length>0&&new P.Notice(`\uC77C\uC815 \uC800\uC7A5\uB428
${c.join(", ")}`)}catch(n){console.error("\uC77C\uC815 \uAC10\uC9C0 \uC2E4\uD328:",n)}}async rebuildZKIndex(){var t;if(!this.zkIndexManager){new P.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new P.Notice("ZK Index \uC7AC\uAD6C\uCD95 \uC911...");try{await this.zkIndexManager.rebuildIndex();let n=((t=this.relatedNoteFinder)==null?void 0:t.getZettelCount())||0;new P.Notice(`ZK Index \uC7AC\uAD6C\uCD95 \uC644\uB8CC: ${n}\uAC1C \uB178\uD2B8`)}catch(n){console.error("ZK Index \uC7AC\uAD6C\uCD95 \uC2E4\uD328:",n),new P.Notice(`\uC7AC\uAD6C\uCD95 \uC2E4\uD328: ${n}`)}}async smartSplitCurrentFile(){var n;if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new P.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(t.extension!=="md"){new P.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uBD84\uB9AC\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4");return}new P.Notice("\uBA54\uBAA8 \uBD84\uC11D \uC911...");try{let s=await this.app.vault.read(t),r=((n=this.mocManager)==null?void 0:n.getProjectList())||[],o=await this.gemini.splitContent(s,r);if(o.length===0){new P.Notice("\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(o.length===1){new P.Notice("\uB2E8\uC77C \uC8FC\uC81C\uB85C \uD310\uB2E8\uB428. \uC77C\uBC18 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958\uB97C \uC0AC\uC6A9\uD558\uC138\uC694.");return}new Q_(this.app,o,t,this).open()}catch(s){console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC2E4\uD328:",s),new P.Notice(`\uBD84\uB9AC \uC2E4\uD328: ${s}`)}}async createSplitNotes(t,n){let s=[];for(let o of t){let a=this.getTargetFolder(o.targetType,o.project);if(o.project&&!o.project.startsWith("NEW:")){let p=`${this.settings.projectsFolder}/${o.project}`;this.app.vault.getAbstractFileByPath(p)instanceof P.TFolder&&(a=p)}let l=Mf(o.title),c=`${a}/${l}.md`,d=`---
targetType: ${o.targetType}
keywords: [${o.keywords.join(", ")}]
source: "[[${n.basename}]]"
created: ${Oe(this.settings.timezone,this.settings.dateFormat)}
${o.project?`project: "${o.project}"`:""}
---

# ${o.title}

${o.content}
`;this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a);try{let p=await this.app.vault.create(c,d);if(s.push(o.title),this.relatedNoteFinder&&await this.relatedNoteFinder.updateIndex(p),o.project&&this.mocManager)if(o.project.startsWith("NEW:")){let m=o.project.slice(4).trim();await this.mocManager.createProjectMOC(m,this.settings.projectsFolder)&&await this.mocManager.addNoteToMOC(m,o.title,p.path)}else await this.mocManager.addNoteToMOC(o.project,o.title,p.path)}catch(p){console.error(`\uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328: ${o.title}`,p)}}let r=`${this.settings.archivesFolder}/${n.name}`;try{this.app.vault.getAbstractFileByPath(this.settings.archivesFolder)||await this.app.vault.createFolder(this.settings.archivesFolder),await this.app.fileManager.renameFile(n,r)}catch(o){console.error("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uC2E4\uD328:",o)}new P.Notice(`${s.length}\uAC1C \uB178\uD2B8 \uC0DD\uC131\uB428, \uC6D0\uBCF8\uC740 Archives\uB85C \uC774\uB3D9`)}showCreateMOCModal(){new J_(this.app,this.mocManager,this.settings.projectsFolder).open()}showURLImportModal(){this.checkApiKey()&&new Z_(this.app,"URL \uAC00\uC838\uC624\uAE30","\uC720\uD29C\uBE0C \uB610\uB294 \uC6F9\uD398\uC774\uC9C0 URL\uC744 \uC785\uB825\uD558\uC138\uC694 (\uC790\uB3D9 \uAC10\uC9C0)","https://...",async t=>{await this.processURL(t)}).open()}async processURL(t){/(?:youtube\.com|youtu\.be)/.test(t)?await this.processYouTube(t):await this.processWebPage(t)}async processYouTube(t){var n;if(!(!this.youtubeExtractor||!this.gemini)){new P.Notice("\uC720\uD29C\uBE0C \uC601\uC0C1 \uBD84\uC11D \uC911...");try{let s=await this.youtubeExtractor.processVideo(t),r=this.youtubeExtractor.generateMarkdownNote(s),o=Mf(s.title),a=`${o}.md`,l=`${this.settings.inboxFolder}/${a}`,c=await this.app.vault.create(l,r);new P.Notice(`\uC720\uD29C\uBE0C \uB178\uD2B8 \uC0DD\uC131: ${o}`);let d=((n=this.mocManager)==null?void 0:n.getProjectList())||[],h=await this.gemini.classifyProject(r,d);c=await this.applyClassifyResultWithConfirmation(c,h),new P.Notice(`${h.targetType}${h.projectName?` (${h.projectName})`:""}\uB85C \uBD84\uB958\uB428`),this.app.workspace.getLeaf().openFile(c),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(c,r,h.title)}catch(s){console.error("\uC720\uD29C\uBE0C \uCC98\uB9AC \uC624\uB958:",s),new P.Notice(`\uC720\uD29C\uBE0C \uCC98\uB9AC \uC2E4\uD328: ${s}`)}}}async processWebPage(t){var n;if(!(!this.webPageExtractor||!this.gemini)){new P.Notice("\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38 \uCD94\uCD9C \uC911...");try{let s=await this.webPageExtractor.processUrl(t),r=this.webPageExtractor.generateMarkdownNote(s),o=Mf(s.title),a=`${o}.md`,l=`${this.settings.inboxFolder}/${a}`,c=await this.app.vault.create(l,r);new P.Notice(`\uC6F9\uD398\uC774\uC9C0 \uB178\uD2B8 \uC0DD\uC131: ${o}`);let d=((n=this.mocManager)==null?void 0:n.getProjectList())||[],h=await this.gemini.classifyProject(r,d);c=await this.applyClassifyResultWithConfirmation(c,h),new P.Notice(`${h.targetType}${h.projectName?` (${h.projectName})`:""}\uB85C \uBD84\uB958\uB428`),this.app.workspace.getLeaf().openFile(c),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(c,r,h.title)}catch(s){console.error("\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC624\uB958:",s),new P.Notice(`\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC2E4\uD328: ${s}`)}}}async classifyCurrentFile(){var r,o,a;if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new P.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase(),s=["pdf","png","jpg","jpeg","webp","gif"];if(Ow.includes(n)){if(!this.meetingProcessor){new P.Notice("\uD68C\uC758\uB85D \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}new P.Notice("\uD68C\uC758\uB85D \uBD84\uC11D \uC911...");try{let l=await this.meetingProcessor.processAudio(t),c=this.meetingProcessor.generateMarkdownNote(l),d=`\uD68C\uC758\uB85D_${Mf(l.title)}.md`,h=`${this.settings.inboxFolder}/${d}`,p=await this.app.vault.create(h,c);if(this.settings.ocrMoveOriginal){let b=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(b)||await this.app.vault.createFolder(b);let _=`${b}/${t.name}`;await this.app.fileManager.renameFile(t,_)}let m=((r=this.mocManager)==null?void 0:r.getProjectList())||[],y=await this.gemini.classifyProject(c,m),v=await this.applyClassifyResultWithConfirmation(p,y);new P.Notice(`\uD68C\uC758\uB85D \uC0DD\uC131 \uC644\uB8CC: ${y.targetType}${y.projectName?` (${y.projectName})`:""}`),await this.findAndShowRelatedNotes(v,c,l.title),await this.detectAndSaveSchedules(c)}catch(l){console.error("\uD68C\uC758\uB85D \uBD84\uC11D \uC624\uB958:",l),new P.Notice(`\uD68C\uC758\uB85D \uBD84\uC11D \uC2E4\uD328: ${l}`)}return}if(s.includes(n)){if(!this.settings.ocrEnabled){new P.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new P.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let l=await this.ocrProcessor.checkLimits(t);if(!l.allowed){new Pf(this.app,l.reason,t,this).open();return}new P.Notice("\uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let c=await this.ocrProcessor.processFile(t);new P.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let d=await this.gemini.summarizePDF(c.text),h=this.ocrProcessor.generateSummarizedNote(c,d),p=t.basename+"_OCR.md",m=`${this.settings.inboxFolder}/${p}`,y=await this.app.vault.create(m,h);if(this.settings.ocrMoveOriginal){let _=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(_)||await this.app.vault.createFolder(_);let T=`${_}/${t.name}`;await this.app.fileManager.renameFile(t,T)}let v=((o=this.mocManager)==null?void 0:o.getProjectList())||[],b=await this.gemini.classifyProject(h,v),w=await this.applyClassifyResultWithConfirmation(y,b);new P.Notice(`\uC644\uB8CC: OCR(${c.pages}p) \u2192 ${b.targetType}${b.projectName?` (${b.projectName})`:""}`),await this.findAndShowRelatedNotes(w,h,b.title),await this.detectAndSaveSchedules(h)}catch(c){console.error("\uCC98\uB9AC \uC624\uB958:",c),new P.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${c}`)}return}if(n==="md"){new P.Notice("\uBD84\uB958 \uC911...");try{let l=await this.app.vault.read(t),c=this.truncateContent(l),d=((a=this.mocManager)==null?void 0:a.getProjectList())||[],h=await this.gemini.classifyProject(c,d),p=await this.applyClassifyResultWithConfirmation(t,h);new P.Notice(`${h.targetType}${h.projectName?` (${h.projectName})`:""}\uB85C \uBD84\uB958\uB428`),await this.findAndShowRelatedNotes(p,l,h.title),await this.detectAndSaveSchedules(l)}catch(l){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",l),new P.Notice(`\uBD84\uB958 \uC2E4\uD328: ${l}`)}return}new P.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}async linkRelatedNotesForCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new P.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(t.extension!=="md"){new P.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uC9C0\uC6D0\uD569\uB2C8\uB2E4");return}new P.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");try{let n=await this.app.vault.read(t),s=this.truncateContent(n),r=n.match(/^#\s+(.+)$/m),o=(r==null?void 0:r[1])||t.basename;await this.findAndShowRelatedNotes(t,s,o)}catch(n){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",n),new P.Notice(`\uAC80\uC0C9 \uC2E4\uD328: ${n}`)}}showCommandListModal(){new eC(this.app,this).open()}async applyClassifyResult(t,n){let s=await this.app.vault.read(t),r=this.updateFrontmatter(s,{targetType:n.targetType,project:n.projectName||void 0,title:n.title,summary:n.summary,next_action:n.nextAction||void 0,processed_at:Oe(this.settings.timezone,this.settings.dateFormat)});await this.app.vault.modify(t,r);let o=this.getTargetFolder(n.targetType,n.projectName);if(o){this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o);let l=`${o}/${t.name}`;await this.app.fileManager.renameFile(t,l);let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof P.TFile)return c}return t}async applyClassifyResultWithConfirmation(t,n){return n.contentType!=="reference"||!n.projectName?this.applyClassifyResult(t,n):new Promise(s=>{new j_(this.app,n,async r=>{let o={...n};r==="library"?(o={...n,targetType:"library"},new P.Notice(`Library\uC5D0 \uC800\uC7A5 + ${n.projectName} \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C`)):o={...n,targetType:"project"};let a=await this.applyClassifyResult(t,o);s(a)}).open()})}async findAndShowRelatedNotes(t,n,s){if(!this.relatedNoteFinder||!this.gemini)return;let r=this.truncateContent(n);try{let o=await this.gemini.extractKeywords(r);o.length>0&&this.relatedNoteFinder&&await this.relatedNoteFinder.saveKeywordsToNote(t,o),this.mocManager&&this.mocManager.getMOCCount()>0&&await this.handleProjectMOC(t,s,o),new P.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");let a=await this.relatedNoteFinder.findRelated(r,s,t.path);a.length>0?new K_(this.app,a,t,this.relatedNoteFinder).open():o.length>0&&new P.Notice(`\uD0A4\uC6CC\uB4DC ${o.length}\uAC1C \uC800\uC7A5\uB428`)}catch(o){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",o)}}async handleProjectMOC(t,n,s){if(!(!this.mocManager||!this.gemini))try{let r=await this.mocManager.detectProject(n,s);if(!r)return;if(r.startsWith("NEW:")){let a=r.slice(4).trim();new X_(this.app,a,t,n,this.mocManager,this.settings.projectsFolder).open();return}await this.mocManager.addNoteToMOC(r,n,t.path)&&new P.Notice(`\u{1F4C1} ${r} MOC\uC5D0 \uC5F0\uACB0\uB428`)}catch(r){console.error("MOC \uC5F0\uACB0 \uC624\uB958:",r)}}getTargetFolder(t,n){switch(t){case"project":return n?`${this.settings.projectsFolder}/${n}`:this.settings.projectsFolder;case"library":return this.settings.libraryFolder;case"archive":return this.settings.archivesFolder;default:return this.settings.libraryFolder}}updateFrontmatter(t,n){let s=/^---\n([\s\S]*?)\n---\n?/,r=t.match(s),o="",a=t;r&&(o=r[1],a=t.slice(r[0].length));let l=o.split(`
`).filter(h=>h.trim()),c=new Map;for(let h of l){let p=h.indexOf(":");if(p!==-1){let m=h.slice(0,p).trim(),y=h.slice(p+1).trim();c.set(m,y)}}for(let[h,p]of Object.entries(n))if(p!==void 0){let y=/[:\[\]{}#&*!|>'"%@`]/.test(p)&&!p.startsWith('"')?`"${p.replace(/"/g,'\\"')}"`:p;c.set(h,y)}return`---
${Array.from(c.entries()).map(([h,p])=>`${h}: ${p}`).join(`
`)}
---
${a}`}async extractZKFromCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new P.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new P.Notice("ZK \uC544\uC774\uB514\uC5B4 \uCD94\uCD9C \uC911...");try{let n=await this.app.vault.read(t),s=await this.gemini.extractZK(n);if(s.length===0){new P.Notice("\uCD94\uCD9C\uD560 \uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new q_(this.app,s,t,this).open()}catch(n){console.error("ZK \uCD94\uCD9C \uC624\uB958:",n),new P.Notice(`\uCD94\uCD9C \uC2E4\uD328: ${n}`)}}initializeZKCounters(){if(!this.relatedNoteFinder)return;let t=this.relatedNoteFinder.getZettelIndex();for(let[n]of t){let r=(n.split("/").pop()||"").match(/^(\d{8})-(\d{3})/);if(r){let o=r[1],a=parseInt(r[2],10),l=this.zkDailyCounter.get(o)||0;a>l&&this.zkDailyCounter.set(o,a)}this.zkLuhmannCounter=Math.max(this.zkLuhmannCounter,t.size)}console.log(`ZK \uCE74\uC6B4\uD130 \uCD08\uAE30\uD654: \uB8E8\uB9CC=${this.zkLuhmannCounter}, \uC77C\uBCC4=${this.zkDailyCounter.size}\uAC1C \uB0A0\uC9DC`)}generateZKId(){switch(this.settings.zkIdType){case"timestamp":return Date.now().toString();case"date-sequence":{let n=Yn(this.settings.timezone).replace(/-/g,""),s=(this.zkDailyCounter.get(n)||0)+1;return this.zkDailyCounter.set(n,s),`${n}-${s.toString().padStart(3,"0")}`}case"luhmann":return this.zkLuhmannCounter++,this.toLuhmannId(this.zkLuhmannCounter);default:return Date.now().toString()}}toLuhmannId(t){if(t<=0)return"1";let n=[],s=t,r=0;for(;s>0;){if(r%2===0){let o=(s-1)%9+1;n.push(o.toString()),s=Math.floor((s-1)/9)}else{let o=(s-1)%26;n.push(String.fromCharCode(97+o)),s=Math.floor((s-1)/26)}r++}return n.reverse().join("")}async createZKNotes(t,n){var d;let s=this.settings.zettelFolder;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s);let o=[],a=[],l=0;for(let h of t){let m=(await this.relatedNoteFinder.findRelatedZettels(h.keywords)).find(C=>C.relevance>=this.settings.zkMergeThreshold);if(m&&await this.showMergeConfirmModal(h,m)){await this.mergeToExistingZK(m.note.path,h,n),a.push(h.title);continue}let y=this.generateZKId(),v=Mf(h.title),b=`${s}/${y} ${v}.md`,w=`---
type: zettel
source: "[[${n.basename}]]"
keywords: [${h.keywords.join(", ")}]
created: ${Oe(this.settings.timezone,this.settings.dateFormat)}
---

# ${h.title}

## \uD575\uC2EC \uC544\uC774\uB514\uC5B4
${h.body}

## \uC65C \uC911\uC694\uD55C\uAC00?
${h.importance||""}

## \uB9E5\uB77D
- **\uC6D0\uBCF8**: [[${n.basename}]]
- **\uAD00\uB828 \uAC1C\uB150**: ${((d=h.relatedConcepts)==null?void 0:d.join(", "))||""}

---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
- [[${n.basename}]] (\uC6D0\uBCF8)
`;await this.app.vault.create(b,w),o.push(h.title);let _=this.app.vault.getAbstractFileByPath(b);if(_ instanceof P.TFile){await this.relatedNoteFinder.updateIndex(_);let C=await this.relatedNoteFinder.findRelatedZettels(h.keywords,b);C.length>0&&(await this.addZKRelatedLinks(_,C),await this.addBacklinksToZettels(_,C),l+=C.length),this.zkIndexManager&&await this.zkIndexManager.updateIndex(_,h.keywords)}await new Promise(C=>setTimeout(C,10))}let c=[];o.length>0&&c.push(`${o.length}\uAC1C \uC0DD\uC131`),a.length>0&&c.push(`${a.length}\uAC1C \uBCD1\uD569`),l>0&&c.push(`${l}\uAC1C \uC5F0\uACB0`),new P.Notice(`ZK \uB178\uD2B8: ${c.join(", ")}`)}showMergeConfirmModal(t,n){return new Promise(s=>{new W_(this.app,t,n,o=>s(o)).open()})}async mergeToExistingZK(t,n,s){let r=this.app.vault.getAbstractFileByPath(t);if(!(r instanceof P.TFile))return;let o=await this.app.vault.read(r),a=`

---
## \uCD94\uAC00\uB41C \uB0B4\uC6A9 (${new Date().toLocaleDateString()})
*\uC6D0\uBCF8: [[${s.basename}]]*

${n.body}
`,l=/(\n---\n##  )/,c;l.test(o)?c=o.replace(l,`${a}$1`):c=o+a;let d=this.extractKeywordsFromFrontmatter(o),h=[...new Set([...d,...n.keywords])];c=this.updateFrontmatterKeywordsInContent(c,h),await this.app.vault.modify(r,c),await this.relatedNoteFinder.updateIndex(r)}extractKeywordsFromFrontmatter(t){let n=t.match(/^---\n[\s\S]*?keywords:\s*\[(.*?)\][\s\S]*?---/);return n?n[1].split(",").map(s=>s.trim().replace(/^["']|["']$/g,"")).filter(s=>s.length>0):[]}updateFrontmatterKeywordsInContent(t,n){let s=`keywords: [${n.join(", ")}]`;return t.replace(/^(---\n[\s\S]*?)(keywords:\s*\[.*?\])([\s\S]*?---)/,`$1${s}$3`)}async addZKRelatedLinks(t,n){if(n.length===0)return;let s=await this.app.vault.read(t),r=n.map(c=>{let d=c.note.path.split("/"),p=d[d.length-1].replace(/\.md$/,""),m=c.reason?`
  \u2192 ${c.reason}`:"";return`- [[${p}]] (${Math.round(c.relevance*100)}%)${m}`}).join(`
`),o=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,a=s.match(o),l;a?l=s.replace(o,`$1
${r}$2`):l=s+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${r}
`,await this.app.vault.modify(t,l)}async addBacklinksToZettels(t,n){for(let s of n){let r=this.app.vault.getAbstractFileByPath(s.note.path);if(!(r instanceof P.TFile))continue;let o=await this.app.vault.read(r);if(o.includes(`[[${t.basename}]]`))continue;let a=s.reason?`
  \u2192 ${s.reason}`:"",l=`- [[${t.basename}]] (${Math.round(s.relevance*100)}%)${a}`,c=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,d=o.match(c),h;d?h=o.replace(c,`$1
${l}$2`):h=o+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${l}
`,await this.app.vault.modify(r,h)}}async showFocusTop3(){if(this.checkApiKey()){new P.Notice("\uD504\uB85C\uC81D\uD2B8 \uBD84\uC11D \uC911...");try{let t=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(!t||!(t instanceof P.TFolder)){new P.Notice("Projects \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=await this.collectProjectsSummary(t);if(!n){new P.Notice("\uC9C4\uD589 \uC911\uC778 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let s=await this.gemini.getFocus(n);if(s.length===0){new P.Notice("\uCD94\uCC9C\uD560 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new Y_(this.app,s).open()}catch(t){console.error("Focus \uBD84\uC11D \uC624\uB958:",t),new P.Notice(`\uBD84\uC11D \uC2E4\uD328: ${t}`)}}}async collectProjectsSummary(t){let n=[];for(let s of t.children)if(s instanceof P.TFile&&s.extension==="md"){let r=await this.app.vault.read(s),o=this.extractFrontmatter(r),a=o.title||s.basename,l=o.summary||"",c=o.next_action||"";n.push(`- ${a}: ${l} (\uB2E4\uC74C: ${c})`)}return n.join(`
`)}extractFrontmatter(t){let n=/^---\n([\s\S]*?)\n---/,s=t.match(n);if(!s)return{};let r={},o=s[1].split(`
`);for(let a of o){let l=a.indexOf(":");if(l!==-1){let c=a.slice(0,l).trim(),d=a.slice(l+1).trim();r[c]=d}}return r}async processInbox(){var l;if(!this.checkApiKey())return;let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof P.TFolder)){new P.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=0,s=0,r=this.settings.triggerTag,o=[];for(let c of t.children)c instanceof P.TFile&&c.extension==="md"&&(await this.app.vault.read(c)).includes(r)&&o.push(c);if(o.length===0){new P.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new P.Notice(`${o.length}\uAC1C \uD30C\uC77C \uCC98\uB9AC \uC2DC\uC791...`);let a=((l=this.mocManager)==null?void 0:l.getProjectList())||[];for(let c=0;c<o.length;c++){let d=o[c];try{new P.Notice(`\uCC98\uB9AC \uC911: ${c+1}/${o.length} - ${d.name}`,2e3);let h=await this.app.vault.read(d),p=await this.gemini.classifyProject(h,a);await this.applyClassifyResult(d,p),n++}catch(h){console.error(`\uCC98\uB9AC \uC2E4\uD328: ${d.name}`,h),s++}}new P.Notice(`\uC644\uB8CC: ${n}\uAC1C \uCC98\uB9AC, ${s}\uAC1C \uC2E4\uD328`)}toggleWatch(){this.watcherRegistered?(this.stopWatcher(),new P.Notice("Watch \uC911\uC9C0\uB428")):(this.startWatcher(),new P.Notice("Watch \uC2DC\uC791\uB428"))}startWatcher(){this.watcherRegistered||(this.registerEvent(this.app.vault.on("create",t=>{t instanceof P.TFile&&this.onFileChange(t)})),this.registerEvent(this.app.vault.on("modify",t=>{t instanceof P.TFile&&this.onFileChange(t)})),this.registerEvent(this.app.vault.on("delete",t=>{var n,s;t instanceof P.TFile&&((n=this.relatedNoteFinder)==null||n.removeFromIndex(t.path),(s=this.mocManager)==null||s.removeFromIndex(t.path),console.log(`\uC778\uB371\uC2A4\uC5D0\uC11C \uC81C\uAC70: ${t.path}`))})),this.watcherRegistered=!0,console.log("Inbox \uAC10\uC2DC \uC2DC\uC791"))}stopWatcher(){this.watcherRegistered=!1,this.pendingFiles.clear(),console.log("Inbox \uAC10\uC2DC \uC911\uC9C0")}onFileChange(t){this.watcherRegistered&&this.gemini&&t.path.startsWith(this.settings.inboxFolder)&&t.extension==="md"&&(this.pendingFiles.set(t.path,Date.now()),this.processDebounced())}async processPendingFiles(){var r;if(!this.gemini)return;let t=Date.now(),n=this.settings.triggerTag,s=((r=this.mocManager)==null?void 0:r.getProjectList())||[];for(let[o,a]of this.pendingFiles.entries()){if(t-a<3e3)continue;this.pendingFiles.delete(o);let l=this.app.vault.getAbstractFileByPath(o);if(l instanceof P.TFile)try{let c=await this.app.vault.read(l);if(!c.includes(n))continue;let d=await this.gemini.classifyProject(c,s);await this.applyClassifyResult(l,d),new P.Notice(`\uC790\uB3D9 \uBD84\uB958: ${l.name} \u2192 ${d.targetType}${d.projectName?` (${d.projectName})`:""}`)}catch(c){console.error(`\uC790\uB3D9 \uBD84\uB958 \uC2E4\uD328: ${o}`,c)}}}async ocrCurrentFile(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new P.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new P.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.workspace.getActiveFile();if(!t){new P.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase();if(!["png","jpg","jpeg","webp","gif","pdf"].includes(n)){new P.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`);return}let r=await this.ocrProcessor.checkLimits(t);if(!r.allowed){new Pf(this.app,r.reason,t,this).open();return}new P.Notice("OCR \uCC98\uB9AC \uC911...");try{let o=await this.ocrProcessor.processFile(t),a=this.ocrProcessor.generateMarkdownNote(o),l=t.basename+"_OCR.md",c=`${this.settings.inboxFolder}/${l}`;if(await this.app.vault.create(c,a),this.settings.ocrMoveOriginal){let d=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(d)||await this.app.vault.createFolder(d);let p=`${d}/${t.name}`;await this.app.fileManager.renameFile(t,p)}new P.Notice(`OCR \uC644\uB8CC: ${l} \uC0DD\uC131\uB428 (${o.pages}\uD398\uC774\uC9C0)`)}catch(o){console.error("OCR \uC624\uB958:",o),new P.Notice(`OCR \uC2E4\uD328: ${o}`)}}async processInboxOCR(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new P.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new P.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof P.TFolder)){new P.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=["png","jpg","jpeg","webp","gif","pdf"],s=[];for(let a of t.children){if(!(a instanceof P.TFile))continue;let l=a.extension.toLowerCase();if(!n.includes(l))continue;(await this.ocrProcessor.checkLimits(a)).allowed&&s.push(a)}if(s.length===0){new P.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new P.Notice(`${s.length}\uAC1C \uD30C\uC77C OCR \uCC98\uB9AC \uC2DC\uC791...`);let r=0,o=0;for(let a=0;a<s.length;a++){let l=s[a];try{new P.Notice(`OCR \uC911: ${a+1}/${s.length} - ${l.name}`,3e3);let c=await this.ocrProcessor.processFile(l),d=this.ocrProcessor.generateMarkdownNote(c),h=l.basename+"_OCR.md",p=`${this.settings.inboxFolder}/${h}`;if(await this.app.vault.create(p,d),this.settings.ocrMoveOriginal){let m=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(m)||await this.app.vault.createFolder(m);let v=`${m}/${l.name}`;await this.app.fileManager.renameFile(l,v)}r++,a<s.length-1&&await new Promise(m=>setTimeout(m,1e3))}catch(c){console.error(`OCR \uCC98\uB9AC \uC2E4\uD328: ${l.name}`,c),o++}}new P.Notice(`OCR \uC644\uB8CC: ${r}\uAC1C \uCC98\uB9AC, ${o}\uAC1C \uC2E4\uD328`)}async smartProcessCurrentFile(){var r,o;if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new P.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase();if(["pdf","png","jpg","jpeg","webp","gif"].includes(n)){if(!this.settings.ocrEnabled){new P.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new P.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let a=await this.ocrProcessor.checkLimits(t);if(!a.allowed){new Pf(this.app,a.reason,t,this).open();return}new P.Notice("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let l=await this.ocrProcessor.processFile(t);new P.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let c=await this.gemini.summarizePDF(l.text),d=this.ocrProcessor.generateSummarizedNote(l,c),h=t.basename+"_OCR.md",p=`${this.settings.inboxFolder}/${h}`,m=await this.app.vault.create(p,d);if(this.settings.ocrMoveOriginal){let b=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(b)||await this.app.vault.createFolder(b);let _=`${b}/${t.name}`;await this.app.fileManager.renameFile(t,_)}let y=((r=this.mocManager)==null?void 0:r.getProjectList())||[],v=await this.gemini.classifyProject(d,y);await this.applyClassifyResultWithConfirmation(m,v),new P.Notice(`\uC644\uB8CC: OCR(${l.pages}p) \u2192 ${v.targetType}${v.projectName?` (${v.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(l){console.error("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC624\uB958:",l),new P.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${l}`)}}else if(n==="md"){new P.Notice("\uBD84\uB958 \uC911...");try{let a=await this.app.vault.read(t),l=((o=this.mocManager)==null?void 0:o.getProjectList())||[],c=await this.gemini.classifyProject(a,l);await this.applyClassifyResultWithConfirmation(t,c),new P.Notice(`${c.targetType}${c.projectName?` (${c.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(a){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",a),new P.Notice(`\uBD84\uB958 \uC2E4\uD328: ${a}`)}}else new P.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}getOCRDailyUsage(){return this.ocrProcessor?this.ocrProcessor.getDailyUsage():{date:Yn(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}},q_=class extends P.Modal{constructor(e,t,n,s){super(e),this.candidates=t,this.selected=new Set(t.map((r,o)=>o)),this.sourceFile=n,this.plugin=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"ZK \uC544\uC774\uB514\uC5B4 \uC120\uD0DD"}),e.createEl("p",{text:"\uC0DD\uC131\uD560 Zettelkasten \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let t=e.createDiv({cls:"zk-candidate-list"});this.candidates.forEach((o,a)=>{let l=t.createDiv({cls:"zk-candidate-item"}),c=l.createEl("input",{type:"checkbox",attr:{checked:!0}});c.addEventListener("change",()=>{c.checked?this.selected.add(a):this.selected.delete(a)});let d=l.createDiv({cls:"zk-candidate-label"});d.createEl("strong",{text:o.title}),d.createEl("p",{text:o.body,cls:"zk-candidate-body"}),d.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${o.keywords.join(", ")}`,cls:"zk-candidate-keywords"})});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{let o=this.candidates.filter((a,l)=>this.selected.has(l));o.length>0&&await this.plugin.createZKNotes(o,this.sourceFile),this.close()})}onClose(){this.contentEl.empty()}},W_=class extends P.Modal{constructor(e,t,n,s){super(e),this.candidate=t,this.similarNote=n,this.onResult=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC720\uC0AC\uD55C \uB178\uD2B8 \uBC1C\uACAC"}),e.createEl("p",{text:`\uC0C8 \uC544\uC774\uB514\uC5B4\uC640 ${Math.round(this.similarNote.relevance*100)}% \uC720\uC0AC\uD55C \uB178\uD2B8\uAC00 \uC788\uC2B5\uB2C8\uB2E4.`,cls:"setting-item-description"});let t=e.createDiv({cls:"merge-section"});t.createEl("h4",{text:"\uC0C8 \uC544\uC774\uB514\uC5B4"}),t.createEl("p",{text:this.candidate.title,cls:"merge-title"}),t.createEl("p",{text:this.candidate.body,cls:"merge-body"});let n=e.createDiv({cls:"merge-section"});n.createEl("h4",{text:"\uAE30\uC874 \uB178\uD2B8"}),n.createEl("p",{text:this.similarNote.note.title,cls:"merge-title"}),n.createEl("p",{text:`\uD0A4\uC6CC\uB4DC: ${this.similarNote.note.keywords.join(", ")}`,cls:"merge-keywords"});let s=e.createDiv({cls:"merge-buttons"});s.createEl("button",{text:"\uAE30\uC874 \uB178\uD2B8\uC5D0 \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",()=>{this.onResult(!0),this.close()}),s.createEl("button",{text:"\uC0C8 \uB178\uD2B8 \uC0DD\uC131"}).addEventListener("click",()=>{this.onResult(!1),this.close()})}onClose(){this.contentEl.empty()}},Y_=class extends P.Modal{constructor(e,t){super(e),this.items=t}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC624\uB298 \uC9D1\uC911\uD560 \uD504\uB85C\uC81D\uD2B8 Top 3"});let t=e.createDiv({cls:"focus-list"});this.items.forEach((r,o)=>{let a=t.createDiv({cls:"focus-item"});a.createEl("h3",{text:`${o+1}. ${r.title}`}),a.createEl("p",{text:r.why,cls:"focus-why"}),a.createEl("p",{text:`\u2192 ${r.nextAction}`,cls:"focus-action"})}),e.createDiv({cls:"modal-button-container"}).createEl("button",{text:"\uB2EB\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}},Pf=class extends P.Modal{constructor(e,t,n,s){super(e),this.reason=t,this.file=n,this.plugin=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uD30C\uC77C\uC774 \uB108\uBB34 \uD07D\uB2C8\uB2E4"}),e.createEl("p",{text:this.reason}),e.createEl("p",{text:"\uC124\uC815\uC5D0\uC11C \uC81C\uD55C\uC744 \uC870\uC815\uD558\uAC70\uB098, \uD30C\uC77C\uC744 \uBD84\uD560\uD574\uC11C \uCC98\uB9AC\uD558\uC138\uC694.",cls:"setting-item-description"});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"\uC124\uC815 \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.app.setting.open()})}onClose(){this.contentEl.empty()}},K_=class extends P.Modal{constructor(e,t,n,s){super(e),this.relatedNotes=t,this.selected=new Set(t.map((r,o)=>o)),this.currentFile=n,this.finder=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uAD00\uB828 \uB178\uD2B8 \uBC1C\uACAC"}),e.createEl("p",{text:"\uC5F0\uACB0\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let t=e.createDiv({cls:"related-notes-list"});this.relatedNotes.forEach((o,a)=>{let l=t.createDiv({cls:"related-note-item"}),c=l.createEl("input",{type:"checkbox",attr:{checked:!0}});c.addEventListener("change",()=>{c.checked?this.selected.add(a):this.selected.delete(a)});let d=l.createDiv({cls:"related-note-label"});d.createEl("strong",{text:o.note.title});let h=Math.round(o.relevance*100);d.createEl("span",{text:` (${h}%)`,cls:"related-note-relevance"}),o.matchedKeywords.length>0&&d.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${o.matchedKeywords.join(", ")}`,cls:"related-note-keywords"})});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uB9C1\uD06C \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",async()=>{let o=this.relatedNotes.filter((a,l)=>this.selected.has(l));o.length>0&&(await this.finder.addRelatedLinks(this.currentFile,o),new P.Notice(`${o.length}\uAC1C \uAD00\uB828 \uB178\uD2B8 \uB9C1\uD06C \uCD94\uAC00\uB428`)),this.close()})}onClose(){this.contentEl.empty()}},X_=class extends P.Modal{constructor(e,t,n,s,r,o){super(e),this.projectName=t,this.noteFile=n,this.noteTitle=s,this.mocManager=r,this.projectsFolder=o}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 \uAC10\uC9C0"}),e.createEl("p",{text:`"${this.projectName}" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC0C8\uB85C \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`}),e.createEl("p",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8\uC758 MOC(Map of Content)\uB97C \uC0DD\uC131\uD560\uAE4C\uC694?",cls:"setting-item-description"});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"MOC \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{await this.mocManager.createProjectMOC(this.projectName,this.projectsFolder)?(await this.mocManager.addNoteToMOC(this.projectName,this.noteTitle,this.noteFile.path),new P.Notice(`\u{1F4C1} ${this.projectName} MOC \uC0DD\uC131 \uBC0F \uC5F0\uACB0 \uC644\uB8CC`)):new P.Notice("MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4"),this.close()})}onClose(){this.contentEl.empty()}},J_=class extends P.Modal{constructor(e,t,n){super(e),this.mocManager=t,this.projectsFolder=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131"}),e.createEl("p",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 MOC\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4. \uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694.",cls:"setting-item-description"});let t=e.createDiv({cls:"moc-input-container"});if(t.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uC774\uB984:"}),this.inputEl=t.createEl("input",{type:"text",placeholder:"\uC608: \uC2A4\uB9C8\uD2B8\uD31C"}),this.inputEl.style.width="100%",this.inputEl.style.marginTop="8px",this.inputEl.style.padding="8px",this.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.createMOC()}),this.mocManager&&this.mocManager.getMOCCount()>0){let o=e.createDiv({cls:"existing-mocs"});o.createEl("h4",{text:"\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 MOC:"});let a=o.createEl("ul");for(let l of this.mocManager.getProjectList())a.createEl("li",{text:l})}let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createMOC()),setTimeout(()=>this.inputEl.focus(),10)}async createMOC(){let e=this.inputEl.value.trim();if(!e){new P.Notice("\uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694");return}if(!this.mocManager){new P.Notice("MOC \uAD00\uB9AC\uC790\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4"),this.close();return}if(this.mocManager.getProjectList().includes(e)){new P.Notice(`"${e}" MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4`);return}let n=await this.mocManager.createProjectMOC(e,this.projectsFolder);n?(new P.Notice(`\u{1F4C1} ${e} MOC \uC0DD\uC131 \uC644\uB8CC`),this.app.workspace.getLeaf().openFile(n)):new P.Notice("MOC \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4"),this.close()}onClose(){this.contentEl.empty()}},Z_=class extends P.Modal{constructor(e,t,n,s,r){super(e),this.title=t,this.description=n,this.placeholder=s,this.onSubmit=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.title}),e.createEl("p",{text:this.description,cls:"setting-item-description"});let t=e.createDiv({cls:"url-input-container"});this.inputEl=t.createEl("input",{type:"text",placeholder:this.placeholder}),this.inputEl.style.width="100%",this.inputEl.style.padding="8px",navigator.clipboard.readText().then(o=>{o&&(o.startsWith("http://")||o.startsWith("https://"))&&(this.inputEl.value=o)}).catch(()=>{}),this.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.submit()});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uAC00\uC838\uC624\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.submit()),setTimeout(()=>this.inputEl.focus(),10)}async submit(){let e=this.inputEl.value.trim();if(!e){new P.Notice("URL\uC744 \uC785\uB825\uD558\uC138\uC694");return}this.close(),await this.onSubmit(e)}onClose(){this.contentEl.empty()}},Q_=class extends P.Modal{constructor(e,t,n,s){super(e),this.sections=t,this.selected=new Set(t.map((r,o)=>o)),this.sourceFile=n,this.plugin=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uACB0\uACFC"}),e.createEl("p",{text:`${this.sections.length}\uAC1C\uC758 \uC139\uC158\uC73C\uB85C \uBD84\uB9AC\uB428. \uC0DD\uC131\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let t=e.createDiv({cls:"split-section-list"});this.sections.forEach((o,a)=>{let l=t.createDiv({cls:"split-section-item"});l.style.marginBottom="16px",l.style.padding="12px",l.style.border="1px solid var(--background-modifier-border)",l.style.borderRadius="8px";let c=l.createDiv({cls:"split-section-header"});c.style.display="flex",c.style.alignItems="center",c.style.gap="8px";let d=c.createEl("input",{type:"checkbox",attr:{checked:!0}});d.addEventListener("change",()=>{d.checked?this.selected.add(a):this.selected.delete(a)}),c.createEl("strong",{text:o.title});let h=c.createDiv({cls:"split-section-badges"});h.style.marginLeft="auto",h.style.display="flex",h.style.gap="4px";let p=h.createEl("span",{text:o.targetType,cls:"split-category-badge"});if(p.style.padding="2px 8px",p.style.borderRadius="4px",p.style.fontSize="12px",p.style.backgroundColor=this.getTargetTypeColor(o.targetType),p.style.color="white",o.project){let v=h.createEl("span",{text:o.project.startsWith("NEW:")?`\u2728 ${o.project.slice(4)}`:`\u{1F4C1} ${o.project}`,cls:"split-project-badge"});v.style.padding="2px 8px",v.style.borderRadius="4px",v.style.fontSize="12px",v.style.backgroundColor="var(--interactive-accent)",v.style.color="white"}let m=l.createDiv({cls:"split-section-preview"});m.style.marginTop="8px",m.style.fontSize="13px",m.style.color="var(--text-muted)",m.style.maxHeight="60px",m.style.overflow="hidden",m.style.textOverflow="ellipsis";let y=o.content.length>150?o.content.slice(0,150)+"...":o.content;if(m.setText(y),o.keywords.length>0){let v=l.createDiv({cls:"split-section-keywords"});v.style.marginTop="8px",v.style.fontSize="12px",v.setText(`\uD0A4\uC6CC\uB4DC: ${o.keywords.join(", ")}`)}});let n=e.createDiv({cls:"modal-button-container"});n.style.marginTop="16px",n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:`${this.selected.size}\uAC1C \uB178\uD2B8 \uC0DD\uC131`,cls:"mod-cta"}).addEventListener("click",async()=>{let o=this.sections.filter((a,l)=>this.selected.has(l));o.length>0&&(this.close(),await this.plugin.createSplitNotes(o,this.sourceFile))})}getTargetTypeColor(e){switch(e){case"project":return"#e67e22";case"library":return"#27ae60";case"archive":return"#95a5a6";default:return"#7f8c8d"}}onClose(){this.contentEl.empty()}},j_=class extends P.Modal{constructor(e,t,n){super(e),this.result=t,this.onChoice=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC800\uC7A5 \uC704\uCE58 \uC120\uD0DD"});let t=e.createDiv({cls:"reference-confirm-info"});t.style.marginBottom="16px",t.style.padding="12px",t.style.backgroundColor="var(--background-secondary)",t.style.borderRadius="8px",t.createEl("p",{text:`"${this.result.title}"`,cls:"reference-title"}).style.fontWeight="bold",t.createEl("p",{text:`\uAD00\uB828 \uD504\uB85C\uC81D\uD2B8: ${this.result.projectName}`,cls:"reference-project"}).style.color="var(--text-muted)",t.createEl("p",{text:"\uC774 \uC790\uB8CC\uB294 \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB85C \uBCF4\uC785\uB2C8\uB2E4. \uC5B4\uB514\uC5D0 \uC800\uC7A5\uD560\uAE4C\uC694?",cls:"reference-question"}).style.marginTop="8px";let n=e.createDiv({cls:"reference-options"});n.style.display="flex",n.style.flexDirection="column",n.style.gap="12px";let s=n.createDiv({cls:"reference-option"});s.style.padding="12px",s.style.border="1px solid var(--background-modifier-border)",s.style.borderRadius="8px",s.style.cursor="pointer",s.addEventListener("mouseenter",()=>{s.style.backgroundColor="var(--background-secondary)"}),s.addEventListener("mouseleave",()=>{s.style.backgroundColor=""}),s.createEl("strong",{text:"\u{1F4C1} \uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC800\uC7A5"}),s.createEl("p",{text:`Projects/${this.result.projectName}/ \uC5D0 \uC800\uC7A5`,cls:"option-desc"}).style.color="var(--text-muted)",s.createEl("small",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8 \uC804\uC6A9 \uC790\uB8CC\uB85C \uAD00\uB9AC"}).style.color="var(--text-faint)",s.addEventListener("click",()=>{this.close(),this.onChoice("project")});let r=n.createDiv({cls:"reference-option"});r.style.padding="12px",r.style.border="2px solid var(--interactive-accent)",r.style.borderRadius="8px",r.style.cursor="pointer",r.style.backgroundColor="var(--background-secondary)",r.createEl("strong",{text:"\u{1F4DA} Library\uC5D0 \uC800\uC7A5 + \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C (\uAD8C\uC7A5)"}),r.createEl("p",{text:"Library/ \uC5D0 \uC800\uC7A5\uD558\uACE0 \uD504\uB85C\uC81D\uD2B8\uC640 \uC5F0\uACB0",cls:"option-desc"}).style.color="var(--text-muted)",r.createEl("small",{text:"\uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5"}).style.color="var(--text-faint)",r.addEventListener("click",()=>{this.close(),this.onChoice("library")});let o=e.createDiv({cls:"modal-button-container"});o.style.marginTop="16px",o.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}},eC=class extends P.Modal{constructor(e,t){super(e),this.plugin=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("zfb-command-list-modal");let t=e.createEl("h2",{text:"\u{1F9E0} Zero Friction Brain"});t.style.marginBottom="16px",t.style.textAlign="center";let n=[{name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkey:"Ctrl+Shift+G",icon:"folder",action:()=>this.plugin.classifyCurrentFile()},{name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkey:"Ctrl+Shift+L",icon:"link",action:()=>this.plugin.linkRelatedNotesForCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkey:"Ctrl+Shift+S",icon:"sparkles",action:()=>this.plugin.smartProcessCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkey:"Ctrl+Shift+D",icon:"split",action:()=>this.plugin.smartSplitCurrentFile()},{name:"ZK \uCD94\uCD9C",hotkey:"Ctrl+Shift+Z",icon:"file-plus",action:()=>this.plugin.extractZKFromCurrentFile()},{name:"URL \uAC00\uC838\uC624\uAE30",hotkey:"Ctrl+Shift+U",icon:"globe",action:()=>this.plugin.showURLImportModal()},{name:"Focus Top 3",hotkey:"Ctrl+Shift+;",icon:"target",action:()=>this.plugin.showFocusTop3()},{name:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC",hotkey:"Ctrl+Shift+R",icon:"calendar-check",action:()=>this.plugin.showReviewModal()},{name:"OCR \uCD94\uCD9C",hotkey:"Ctrl+Shift+O",icon:"scan",action:()=>this.plugin.ocrCurrentFile()},{divider:!0},{name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",hotkey:"",icon:"inbox",action:()=>this.plugin.processInbox()},{name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",hotkey:"",icon:"map",action:()=>this.plugin.showCreateMOCModal()},{name:"ZK Index \uC7AC\uAD6C\uCD95",hotkey:"",icon:"refresh-cw",action:()=>this.plugin.rebuildZKIndex()},{name:"Watch \uD1A0\uAE00",hotkey:"",icon:"eye",action:()=>this.plugin.toggleWatch()}],s=e.createDiv({cls:"zfb-command-list"});s.style.display="flex",s.style.flexDirection="column",s.style.gap="4px";for(let a of n){if("divider"in a&&a.divider){let h=s.createEl("hr");h.style.margin="8px 0",h.style.border="none",h.style.borderTop="1px solid var(--background-modifier-border)";continue}let l=s.createDiv({cls:"zfb-command-item"});l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="space-between",l.style.padding="10px 12px",l.style.borderRadius="6px",l.style.cursor="pointer",l.style.transition="background-color 0.1s",l.addEventListener("mouseenter",()=>{l.style.backgroundColor="var(--background-secondary)"}),l.addEventListener("mouseleave",()=>{l.style.backgroundColor=""});let c=l.createDiv();c.style.display="flex",c.style.alignItems="center",c.style.gap="10px";let d=c.createSpan({cls:"zfb-command-icon"});if((0,P.setIcon)(d,a.icon||"command"),d.style.opacity="0.7",c.createSpan({text:a.name}),a.hotkey){let h=l.createSpan({text:a.hotkey,cls:"zfb-command-hotkey"});h.style.fontSize="0.85em",h.style.color="var(--text-muted)",h.style.backgroundColor="var(--background-secondary)",h.style.padding="2px 8px",h.style.borderRadius="4px",h.style.fontFamily="monospace"}l.addEventListener("click",()=>{this.close(),a.action()})}let r=e.createDiv({cls:"zfb-command-footer"});r.style.marginTop="16px",r.style.paddingTop="12px",r.style.borderTop="1px solid var(--background-modifier-border)",r.style.textAlign="center",r.style.color="var(--text-muted)",r.style.fontSize="0.85em",r.createSpan({text:`v${this.plugin.manifest.version} \u2022 `});let o=r.createEl("a",{text:"\uC124\uC815"});o.style.cursor="pointer",o.addEventListener("click",()=>{this.close(),this.app.setting.open(),this.app.setting.openTabById("zero-friction-brain")})}onClose(){this.contentEl.empty()}},tC=class extends P.Modal{constructor(t,n,s){super(t);this.selectedPeriod="week";this.resultContainer=null;this.isLoading=!1;this.reviewManager=n,this.settings=s}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-review-modal"),t.createEl("h2",{text:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC"});let n=t.createDiv({cls:"zfb-review-period-section"});n.createEl("label",{text:"\uAE30\uAC04 \uC120\uD0DD:",cls:"setting-item-name"});let s=n.createDiv({cls:"zfb-period-buttons"});s.style.display="flex",s.style.gap="8px",s.style.marginTop="8px",s.style.marginBottom="16px",[{value:"today",label:"\uC624\uB298"},{value:"week",label:"\uC774\uBC88 \uC8FC"},{value:"month",label:"\uC774\uBC88 \uB2EC"}].forEach(({value:m,label:y})=>{let v=s.createEl("button",{text:y});v.style.padding="8px 16px",v.style.borderRadius="6px",v.style.cursor="pointer",m===this.selectedPeriod&&v.addClass("mod-cta"),v.addEventListener("click",()=>{this.selectedPeriod=m,s.querySelectorAll("button").forEach(b=>b.removeClass("mod-cta")),v.addClass("mod-cta"),this.loadNotes()})});let o=t.createDiv({cls:"zfb-review-filter-section"});o.style.marginBottom="16px",o.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uD544\uD130 (\uC120\uD0DD):",cls:"setting-item-name"});let a=o.createEl("select");a.style.marginLeft="8px",a.style.padding="4px 8px";let l=a.createEl("option",{text:"\uC804\uCCB4",value:""});l.value="",this.reviewManager.getProjectList().forEach(m=>{let y=a.createEl("option",{text:m,value:m});y.value=m}),a.addEventListener("change",()=>{this.projectFilter=a.value||void 0,this.loadNotes()}),this.resultContainer=t.createDiv({cls:"zfb-review-results"}),this.resultContainer.style.marginTop="16px",this.resultContainer.style.maxHeight="400px",this.resultContainer.style.overflowY="auto";let d=t.createDiv({cls:"modal-button-container"});d.style.marginTop="16px",d.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close()),d.createEl("button",{text:"AI \uBD84\uC11D \uBC0F \uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createReviewNote()),this.loadNotes()}async loadNotes(){if(!(!this.resultContainer||this.isLoading)){this.isLoading=!0,this.resultContainer.empty(),this.resultContainer.createEl("p",{text:"\uB178\uD2B8 \uC218\uC9D1 \uC911...",cls:"zfb-loading"});try{let t={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.collectNotes(t),s=this.reviewManager.groupByProject(n);this.renderResults(n,s)}catch(t){console.error("\uB178\uD2B8 \uC218\uC9D1 \uC2E4\uD328:",t),this.resultContainer.empty(),this.resultContainer.createEl("p",{text:`\uC624\uB958: ${t}`,cls:"zfb-error"})}finally{this.isLoading=!1}}}renderResults(t,n){if(!this.resultContainer)return;if(this.resultContainer.empty(),t.length===0){this.resultContainer.createEl("p",{text:"\uD574\uB2F9 \uAE30\uAC04\uC5D0 \uC791\uC5C5\uD55C \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.",cls:"zfb-empty-message"});return}let s=this.resultContainer.createDiv({cls:"zfb-review-summary"});s.style.padding="12px",s.style.backgroundColor="var(--background-secondary)",s.style.borderRadius="8px",s.style.marginBottom="16px";let r=Lc(this.selectedPeriod,this.settings.timezone);s.createEl("p",{text:`${r.label} \uC791\uC5C5: ${t.length}\uAC1C \uB178\uD2B8, ${n.length}\uAC1C \uD504\uB85C\uC81D\uD2B8/\uC601\uC5ED`});for(let o of n){let a=this.resultContainer.createDiv({cls:"zfb-review-group"});a.style.marginBottom="16px";let l=a.createEl("h4",{text:`\u{1F4C1} ${o.projectName} (${o.noteCount}\uAC1C)`});l.style.marginBottom="8px",l.style.borderBottom="1px solid var(--background-modifier-border)",l.style.paddingBottom="4px";let c=a.createEl("ul");c.style.listStyle="none",c.style.paddingLeft="16px",c.style.margin="0";for(let d of o.notes){let h=c.createEl("li");h.style.display="flex",h.style.justifyContent="space-between",h.style.alignItems="center",h.style.padding="4px 0";let p=h.createEl("a",{text:d.title});p.style.cursor="pointer",p.style.color="var(--text-accent)",p.addEventListener("click",async()=>{this.app.vault.getAbstractFileByPath(d.path)instanceof P.TFile&&await this.app.workspace.openLinkText(d.path,"")});let m=h.createEl("span",{text:dC(d.modified),cls:"zfb-note-time"});m.style.fontSize="0.85em",m.style.color="var(--text-muted)"}}}async createReviewNote(){if(!this.isLoading){this.isLoading=!0,new P.Notice("AI \uBD84\uC11D \uC911...");try{let t={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.analyze(t),s=await this.reviewManager.createReviewNote(n);new P.Notice(`\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131\uB428: ${s.basename}`),await this.app.workspace.openLinkText(s.path,""),this.close()}catch(t){console.error("\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328:",t),new P.Notice(`\uC0DD\uC131 \uC2E4\uD328: ${t}`)}finally{this.isLoading=!1}}}onClose(){this.contentEl.empty()}};
/*! Bundled license information:

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
