/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Ju=Object.defineProperty;var DE=Object.getOwnPropertyDescriptor;var FE=Object.getOwnPropertyNames;var LE=Object.prototype.hasOwnProperty;var UE=(s,e,t)=>e in s?Ju(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var OE=(s,e)=>{for(var t in e)Ju(s,t,{get:e[t],enumerable:!0})},$E=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of FE(e))!LE.call(s,i)&&i!==t&&Ju(s,i,{get:()=>e[i],enumerable:!(n=DE(e,i))||n.enumerable});return s};var GE=s=>$E(Ju({},"__esModule",{value:!0}),s);var H=(s,e,t)=>(UE(s,typeof e!="symbol"?e+"":e,t),t),og=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var u=(s,e,t)=>(og(s,e,"read from private field"),t?t.call(s):e.get(s)),v=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},w=(s,e,t,n)=>(og(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t);var et=(s,e,t,n)=>({set _(i){w(s,e,i,t)},get _(){return u(s,e,n)}}),T=(s,e,t)=>(og(s,e,"access private method"),t);var SP={};OE(SP,{default:()=>ig});module.exports=GE(SP);var R=require("obsidian");var aw={geminiApiKey:"",inboxFolder:"00 _Inbox",projectsFolder:"01 Projects",libraryFolder:"02 Library",archivesFolder:"03 Archives",zettelFolder:"10 Zettelkasten",autoWatch:!0,triggerTag:"#\uC644\uB8CC",language:"ko",ocrEnabled:!0,ocrAutoProcess:!1,ocrMoveOriginal:!0,ocrOriginalFolder:"03 Archives/OCR_\uC6D0\uBCF8",ocrMinTextThreshold:50,ocrMaxPages:20,ocrMaxFileSizeMB:10,ocrDailyLimit:50,zkIdType:"date-sequence",zkMergeThreshold:.8,timezone:"auto",dateFormat:"local",scheduleDetectionEnabled:!0,dailyNotesFolder:"00 _Inbox",googleCalendarEnabled:!1,useOwnApiKey:!1,googleClientId:"",googleClientSecret:"",googleAccessToken:"",googleRefreshToken:"",googleTokenExpiry:0};var te=require("obsidian");var uw=[{value:"auto",label:"\uC790\uB3D9 \uAC10\uC9C0"},{value:"Asia/Seoul",label:"\uD55C\uAD6D (KST, UTC+9)"},{value:"Asia/Tokyo",label:"\uC77C\uBCF8 (JST, UTC+9)"},{value:"Asia/Shanghai",label:"\uC911\uAD6D (CST, UTC+8)"},{value:"America/New_York",label:"\uBBF8\uAD6D \uB3D9\uBD80 (EST/EDT)"},{value:"America/Los_Angeles",label:"\uBBF8\uAD6D \uC11C\uBD80 (PST/PDT)"},{value:"Europe/London",label:"\uC601\uAD6D (GMT/BST)"},{value:"UTC",label:"UTC"}],dw=[{value:"iso",label:"ISO \uD615\uC2DD (2026-01-05T16:24:45+09:00)"},{value:"local",label:"\uB85C\uCEEC \uD615\uC2DD (2026-01-05 16:24:45)"},{value:"friendly",label:"\uCE5C\uADFC\uD55C \uD615\uC2DD (2026\uB144 1\uC6D4 5\uC77C 16:24)"}];function Xu(s){return s==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:s}function rg(s,e,t){let n=Xu(e);switch(t){case"iso":return BE(s,n);case"local":return lw(s,n);case"friendly":return HE(s,n);default:return lw(s,n)}}function BE(s,e){let t={timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",t).formatToParts(s),i=g=>{var m;return((m=n.find(y=>y.type===g))==null?void 0:m.value)||""},o=i("year"),r=i("month"),a=i("day"),l=i("hour"),c=i("minute"),d=i("second"),p=VE(s,e);return`${o}-${r}-${a}T${l}:${c}:${d}${p}`}function lw(s,e){let t={timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",t).formatToParts(s),i=p=>{var g;return((g=n.find(m=>m.type===p))==null?void 0:g.value)||""},o=i("year"),r=i("month"),a=i("day"),l=i("hour"),c=i("minute"),d=i("second");return`${o}-${r}-${a} ${l}:${c}:${d}`}function HE(s,e){let t={timeZone:e,year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};return new Intl.DateTimeFormat("ko-KR",t).format(s)}function VE(s,e){let t=new Date(s.toLocaleString("en-US",{timeZone:"UTC"})),i=(new Date(s.toLocaleString("en-US",{timeZone:e})).getTime()-t.getTime())/(1e3*60);if(i===0)return"Z";let o=i>=0?"+":"-",r=Math.abs(i),a=Math.floor(r/60),l=r%60;return`${o}${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}`}function Vt(s,e){let n={timeZone:Xu(e),year:"numeric",month:"2-digit",day:"2-digit"},i=new Intl.DateTimeFormat("en-CA",n).formatToParts(s),o=r=>{var a;return((a=i.find(l=>l.type===r))==null?void 0:a.value)||""};return`${o("year")}-${o("month")}-${o("day")}`}function Ee(s,e){return rg(new Date,s,e)}function pn(s){return Vt(new Date,s)}function za(s,e){let t=Xu(e),n=new Date;switch(s){case"today":return cw(n,t);case"week":return qE(n,t);case"month":return zE(n,t);default:return cw(n,t)}}function cw(s,e){let t=ag(s,e),n=lg(s,e);return{start:t,end:n,label:"\uC624\uB298"}}function qE(s,e){let t=s.getDay(),n=t===0?6:t-1,i=new Date(s);i.setDate(i.getDate()-n);let o=new Date(i);return o.setDate(o.getDate()+6),{start:ag(i,e),end:lg(o,e),label:"\uC774\uBC88 \uC8FC"}}function zE(s,e){let t=new Date(s.getFullYear(),s.getMonth(),1),n=new Date(s.getFullYear(),s.getMonth()+1,0);return{start:ag(t,e),end:lg(n,e),label:"\uC774\uBC88 \uB2EC"}}function ag(s,e){let t=new Date(s);return t.setHours(0,0,0,0),t}function lg(s,e){let t=new Date(s);return t.setHours(23,59,59,999),t}function hw(s,e){return s>=e.start&&s<=e.end}function cg(s){let e=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);let n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e.getTime()-n.getTime())/864e5+1)/7)}function fw(s,e,t){let n=Xu(t);switch(s){case"today":return`${Vt(e,n)} \uC77C\uC77C \uD68C\uACE0.md`;case"week":let i=cg(e);return`${e.getFullYear()}-W${String(i).padStart(2,"0")} \uC8FC\uAC04 \uD68C\uACE0.md`;case"month":return`${Vt(e,n).substring(0,7)} \uC6D4\uAC04 \uD68C\uACE0.md`;default:return`${Vt(e,n)} \uD68C\uACE0.md`}}function pw(s){let t=new Date().getTime()-s.getTime(),n=Math.floor(t/(1e3*60)),i=Math.floor(t/(1e3*60*60)),o=Math.floor(t/(1e3*60*60*24));return n<1?"\uBC29\uAE08 \uC804":n<60?`${n}\uBD84 \uC804`:i<24?`${i}\uC2DC\uAC04 \uC804`:o===1?"\uC5B4\uC81C":o<7?`${o}\uC77C \uC804`:o<30?`${Math.floor(o/7)}\uC8FC \uC804`:`${Math.floor(o/30)}\uAC1C\uC6D4 \uC804`}var Zu=class extends te.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"Zero Friction Brain \uC124\uC815"}),e.createEl("h3",{text:"API \uC124\uC815"}),new te.Setting(e).setName("Gemini API \uD0A4").setDesc(createFragment(n=>{n.appendText("Gemini API \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694. "),n.createEl("a",{text:"API \uD0A4 \uBC1C\uAE09\uBC1B\uAE30",href:"https://aistudio.google.com/apikey"})})).addText(n=>n.setPlaceholder("AIzaSy...").setValue(this.plugin.settings.geminiApiKey).onChange(async i=>{this.plugin.settings.geminiApiKey=i,await this.plugin.saveSettings()})),e.createEl("h3",{text:"\uD3F4\uB354 \uC124\uC815"}),new te.Setting(e).setName("Inbox \uD3F4\uB354").setDesc("\uC0C8 \uB178\uD2B8\uAC00 \uC800\uC7A5\uB418\uB294 \uD3F4\uB354").addText(n=>n.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.inboxFolder).onChange(async i=>{this.plugin.settings.inboxFolder=i,await this.plugin.saveSettings()})),new te.Setting(e).setName("Projects \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uBCC4 \uD558\uC704 \uD3F4\uB354\uAC00 \uC0DD\uC131\uB429\uB2C8\uB2E4").addText(n=>n.setPlaceholder("01 Projects").setValue(this.plugin.settings.projectsFolder).onChange(async i=>{this.plugin.settings.projectsFolder=i,await this.plugin.saveSettings()})),new te.Setting(e).setName("Library \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uC5D0 \uC18D\uD558\uC9C0 \uC54A\uB294 \uCC38\uACE0 \uC790\uB8CC").addText(n=>n.setPlaceholder("02 Library").setValue(this.plugin.settings.libraryFolder).onChange(async i=>{this.plugin.settings.libraryFolder=i,await this.plugin.saveSettings()})),new te.Setting(e).setName("Archives \uD3F4\uB354").setDesc("\uC644\uB8CC\uB41C \uD504\uB85C\uC81D\uD2B8 (\uD1B5\uC9F8\uB85C \uC774\uB3D9)").addText(n=>n.setPlaceholder("03 Archives").setValue(this.plugin.settings.archivesFolder).onChange(async i=>{this.plugin.settings.archivesFolder=i,await this.plugin.saveSettings()})),new te.Setting(e).setName("Zettelkasten \uD3F4\uB354").setDesc("ZK \uC601\uAD6C \uB178\uD2B8 \uC800\uC7A5 \uC704\uCE58").addText(n=>n.setPlaceholder("10 Zettelkasten").setValue(this.plugin.settings.zettelFolder).onChange(async i=>{this.plugin.settings.zettelFolder=i,await this.plugin.saveSettings()})),new te.Setting(e).setName("\uD3F4\uB354 \uAD6C\uC870 \uC0DD\uC131").setDesc("\uC704\uC5D0 \uC124\uC815\uB41C \uD3F4\uB354\uB4E4\uC744 \uC790\uB3D9\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4").addButton(n=>n.setButtonText("\uD3F4\uB354 \uC0DD\uC131").setCta().onClick(async()=>{await this.createFolderStructure()})),e.createEl("h3",{text:"\uC635\uC158"}),new te.Setting(e).setName("Inbox \uC790\uB3D9 \uAC10\uC2DC").setDesc("Inbox \uD3F4\uB354\uC758 \uD30C\uC77C\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC2DC\uD558\uC5EC \uBD84\uB958").addToggle(n=>n.setValue(this.plugin.settings.autoWatch).onChange(async i=>{this.plugin.settings.autoWatch=i,await this.plugin.saveSettings(),i?this.plugin.startWatcher():this.plugin.stopWatcher()})),new te.Setting(e).setName("\uD2B8\uB9AC\uAC70 \uD0DC\uADF8").setDesc("\uC774 \uD0DC\uADF8\uAC00 \uC788\uB294 \uB178\uD2B8\uB9CC \uC790\uB3D9 \uBD84\uB958 (\uC608: #\uC644\uB8CC)").addText(n=>n.setPlaceholder("#\uC644\uB8CC").setValue(this.plugin.settings.triggerTag).onChange(async i=>{this.plugin.settings.triggerTag=i,await this.plugin.saveSettings()})),e.createEl("h3",{text:"OCR \uC124\uC815"}),new te.Setting(e).setName("OCR \uAE30\uB2A5 \uD65C\uC131\uD654").setDesc("\uC774\uBBF8\uC9C0 \uBC0F PDF\uC5D0\uC11C \uD14D\uC2A4\uD2B8 \uCD94\uCD9C").addToggle(n=>n.setValue(this.plugin.settings.ocrEnabled).onChange(async i=>{this.plugin.settings.ocrEnabled=i,await this.plugin.saveSettings()})),new te.Setting(e).setName("OCR \uD6C4 \uC6D0\uBCF8 \uC774\uB3D9").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC744 \uC9C0\uC815 \uD3F4\uB354\uB85C \uC774\uB3D9").addToggle(n=>n.setValue(this.plugin.settings.ocrMoveOriginal).onChange(async i=>{this.plugin.settings.ocrMoveOriginal=i,await this.plugin.saveSettings()})),new te.Setting(e).setName("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uD3F4\uB354").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC774 \uC774\uB3D9\uB420 \uD3F4\uB354").addText(n=>n.setPlaceholder("03 Archives/OCR_\uC6D0\uBCF8").setValue(this.plugin.settings.ocrOriginalFolder).onChange(async i=>{this.plugin.settings.ocrOriginalFolder=i,await this.plugin.saveSettings()})),e.createEl("h3",{text:"OCR \uC81C\uD55C (API \uC694\uAE08 \uBCF4\uD638)"}),new te.Setting(e).setName("\uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").setDesc("\uD55C \uBC88\uC5D0 \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 PDF \uD398\uC774\uC9C0 \uC218").addSlider(n=>n.setLimits(1,100,1).setValue(this.plugin.settings.ocrMaxPages).setDynamicTooltip().onChange(async i=>{this.plugin.settings.ocrMaxPages=i,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (20)").onClick(async()=>{this.plugin.settings.ocrMaxPages=20,await this.plugin.saveSettings(),this.display()})),new te.Setting(e).setName("\uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30 (MB)").setDesc("\uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30").addSlider(n=>n.setLimits(1,50,1).setValue(this.plugin.settings.ocrMaxFileSizeMB).setDynamicTooltip().onChange(async i=>{this.plugin.settings.ocrMaxFileSizeMB=i,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (10)").onClick(async()=>{this.plugin.settings.ocrMaxFileSizeMB=10,await this.plugin.saveSettings(),this.display()})),new te.Setting(e).setName("\uC77C\uC77C \uCC98\uB9AC \uD55C\uB3C4 (\uD398\uC774\uC9C0)").setDesc("\uD558\uB8E8\uC5D0 OCR \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").addSlider(n=>n.setLimits(10,500,10).setValue(this.plugin.settings.ocrDailyLimit).setDynamicTooltip().onChange(async i=>{this.plugin.settings.ocrDailyLimit=i,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (50)").onClick(async()=>{this.plugin.settings.ocrDailyLimit=50,await this.plugin.saveSettings(),this.display()})),e.createDiv({cls:"ocr-usage-info"}).createEl("p",{text:`\uC624\uB298 \uC0AC\uC6A9\uB7C9: ${this.plugin.getOCRDailyUsage().pagesProcessed}/${this.plugin.settings.ocrDailyLimit} \uD398\uC774\uC9C0`,cls:"setting-item-description"}),e.createEl("h3",{text:"Zettelkasten \uC124\uC815"}),new te.Setting(e).setName("ZK \uB178\uD2B8 ID \uD615\uC2DD").setDesc("ZK \uB178\uD2B8 \uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uD560 ID \uD615\uC2DD").addDropdown(n=>n.addOption("timestamp","\uD0C0\uC784\uC2A4\uD0EC\uD504 (1735789200000)").addOption("date-sequence","\uB0A0\uC9DC+\uC21C\uBC88 (20260102-001)").addOption("luhmann","\uB8E8\uB9CC \uC2A4\uD0C0\uC77C (1a1b)").setValue(this.plugin.settings.zkIdType).onChange(async i=>{this.plugin.settings.zkIdType=i,await this.plugin.saveSettings()})),new te.Setting(e).setName("\uC720\uC0AC \uB178\uD2B8 \uBCD1\uD569 \uC784\uACC4\uAC12").setDesc("\uC774 \uAC12 \uC774\uC0C1\uC758 \uC720\uC0AC\uB3C4\uB97C \uAC00\uC9C4 \uB178\uD2B8\uAC00 \uC788\uC73C\uBA74 \uBCD1\uD569 \uC81C\uC548 (0.5~1.0)").addSlider(n=>n.setLimits(.5,1,.05).setValue(this.plugin.settings.zkMergeThreshold).setDynamicTooltip().onChange(async i=>{this.plugin.settings.zkMergeThreshold=i,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (0.8)").onClick(async()=>{this.plugin.settings.zkMergeThreshold=.8,await this.plugin.saveSettings(),this.display()})),e.createEl("h3",{text:"\uC2DC\uAC04\uB300 \uBC0F \uB0A0\uC9DC \uD615\uC2DD"}),new te.Setting(e).setName("\uC2DC\uAC04\uB300").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504\uC5D0 \uC0AC\uC6A9\uD560 \uC2DC\uAC04\uB300").addDropdown(n=>{uw.forEach(i=>{n.addOption(i.value,i.label)}),n.setValue(this.plugin.settings.timezone).onChange(async i=>{this.plugin.settings.timezone=i,await this.plugin.saveSettings()})}),new te.Setting(e).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504 \uD45C\uC2DC \uD615\uC2DD").addDropdown(n=>{dw.forEach(i=>{n.addOption(i.value,i.label)}),n.setValue(this.plugin.settings.dateFormat).onChange(async i=>{this.plugin.settings.dateFormat=i,await this.plugin.saveSettings()})}),e.createEl("h3",{text:"\uC77C\uC815 \uAC10\uC9C0"}),new te.Setting(e).setName("\uC77C\uC815 \uC790\uB3D9 \uAC10\uC9C0").setDesc("\uB178\uD2B8 \uBD84\uB958 \uC2DC \uC77C\uC815/\uD560\uC77C/\uC57D\uC18D\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC9C0").addToggle(n=>n.setValue(this.plugin.settings.scheduleDetectionEnabled).onChange(async i=>{this.plugin.settings.scheduleDetectionEnabled=i,await this.plugin.saveSettings()})),new te.Setting(e).setName("Daily Notes \uD3F4\uB354").setDesc("\uC77C\uC815\uC774 \uC800\uC7A5\uB420 Daily Notes \uD3F4\uB354").addText(n=>n.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.dailyNotesFolder).onChange(async i=>{this.plugin.settings.dailyNotesFolder=i,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Google Calendar \uC5F0\uB3D9"}),new te.Setting(e).setName("Google Calendar \uD65C\uC131\uD654").setDesc("\uC77C\uC815\uC744 Google Calendar\uC5D0\uB3C4 \uC800\uC7A5\uD569\uB2C8\uB2E4").addToggle(n=>n.setValue(this.plugin.settings.googleCalendarEnabled).onChange(async i=>{this.plugin.settings.googleCalendarEnabled=i,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.googleCalendarEnabled){let n=!!this.plugin.settings.googleRefreshToken,i=n?"\uC5F0\uACB0\uB428 \u2713":"\uC5F0\uACB0 \uC548\uB428";if(new te.Setting(e).setName("Google \uACC4\uC815").setDesc(i).addButton(o=>o.setButtonText(n?"\uC7AC\uC5F0\uACB0":"\uC5F0\uACB0\uD558\uAE30").setCta().onClick(async()=>{await this.plugin.connectGoogleCalendar()})).addButton(o=>(n&&o.setButtonText("\uC5F0\uACB0 \uD574\uC81C").onClick(async()=>{await this.plugin.disconnectGoogleCalendar(),this.display()}),o)),new te.Setting(e).setName("\uC790\uCCB4 API \uD0A4 \uC0AC\uC6A9 (Advanced)").setDesc("\uC9C1\uC811 Google Cloud Console\uC5D0\uC11C \uC0DD\uC131\uD55C Client ID\uB97C \uC0AC\uC6A9\uD569\uB2C8\uB2E4").addToggle(o=>o.setValue(this.plugin.settings.useOwnApiKey).onChange(async r=>{this.plugin.settings.useOwnApiKey=r,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.useOwnApiKey){new te.Setting(e).setName("Google Client ID").setDesc("Google Cloud Console\uC5D0\uC11C \uC0DD\uC131\uD55C OAuth 2.0 Client ID").addText(r=>r.setPlaceholder("xxxxx.apps.googleusercontent.com").setValue(this.plugin.settings.googleClientId).onChange(async a=>{this.plugin.settings.googleClientId=a,await this.plugin.saveSettings()})),new te.Setting(e).setName("Google Client Secret").setDesc("OAuth 2.0 Client Secret").addText(r=>r.setPlaceholder("GOCSPX-...").setValue(this.plugin.settings.googleClientSecret).onChange(async a=>{this.plugin.settings.googleClientSecret=a,await this.plugin.saveSettings()}));let o=e.createDiv({cls:"setting-item-description"});o.createEl("p",{text:"Google Cloud Console\uC5D0\uC11C OAuth 2.0 \uD074\uB77C\uC774\uC5B8\uD2B8 ID\uB97C \uC0DD\uC131\uD558\uC138\uC694:"}),o.createEl("a",{text:"Google Cloud Console \uC5F4\uAE30",href:"https://console.cloud.google.com/apis/credentials"}),o.createEl("p",{text:"\uB9AC\uB514\uB809\uC158 URI: http://127.0.0.1:42813/callback",cls:"setting-item-description"}).style.fontFamily="monospace"}}}async createFolderStructure(){let e=[this.plugin.settings.inboxFolder,this.plugin.settings.projectsFolder,this.plugin.settings.libraryFolder,this.plugin.settings.archivesFolder,this.plugin.settings.zettelFolder],t=0,n=0;for(let i of e){if(!i)continue;if(this.app.vault.getAbstractFileByPath(i))n++;else try{await this.app.vault.createFolder(i),t++}catch(r){console.error(`\uD3F4\uB354 \uC0DD\uC131 \uC2E4\uD328: ${i}`,r)}}t>0?new te.Notice(`${t}\uAC1C \uD3F4\uB354 \uC0DD\uC131\uB428, ${n}\uAC1C \uC774\uBBF8 \uC874\uC7AC`):new te.Notice(`\uBAA8\uB4E0 \uD3F4\uB354\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4 (${n}\uAC1C)`)}};var WE,KE;function YE(){return{geminiUrl:WE,vertexUrl:KE}}function JE(s,e,t,n){var i,o;if(!(s!=null&&s.baseUrl)){let r=YE();return e?(i=r.vertexUrl)!==null&&i!==void 0?i:t:(o=r.geminiUrl)!==null&&o!==void 0?o:n}return s.baseUrl}var Wt=class{};function D(s,e){let t=/\{([^}]+)\}/g;return s.replace(t,(n,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){let o=e[i];return o!=null?String(o):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function f(s,e,t){for(let o=0;o<e.length-1;o++){let r=e[o];if(r.endsWith("[]")){let a=r.slice(0,-2);if(!(a in s))if(Array.isArray(t))s[a]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${r}`);if(Array.isArray(s[a])){let l=s[a];if(Array.isArray(t))for(let c=0;c<l.length;c++){let d=l[c];f(d,e.slice(o+1),t[c])}else for(let c of l)f(c,e.slice(o+1),t)}return}else if(r.endsWith("[0]")){let a=r.slice(0,-3);a in s||(s[a]=[{}]);let l=s[a];f(l[0],e.slice(o+1),t);return}(!s[r]||typeof s[r]!="object")&&(s[r]={}),s=s[r]}let n=e[e.length-1],i=s[n];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(s,t):s[n]=t}function h(s,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return s;for(let n=0;n<e.length;n++){if(typeof s!="object"||s===null)return t;let i=e[n];if(i.endsWith("[]")){let o=i.slice(0,-2);if(o in s){let r=s[o];return Array.isArray(r)?r.map(a=>h(a,e.slice(n+1),t)):t}else return t}else s=s[i]}return s}catch(n){if(n instanceof TypeError)return t;throw n}}function XE(s,e){for(let[t,n]of Object.entries(e)){let i=t.split("."),o=n.split("."),r=new Set,a=-1;for(let l=0;l<i.length;l++)if(i[l]==="*"){a=l;break}if(a!==-1&&o.length>a)for(let l=a;l<o.length;l++){let c=o[l];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&r.add(c)}hg(s,i,o,0,r)}}function hg(s,e,t,n,i){if(n>=e.length||typeof s!="object"||s===null)return;let o=e[n];if(o.endsWith("[]")){let r=o.slice(0,-2),a=s;if(r in a&&Array.isArray(a[r]))for(let l of a[r])hg(l,e,t,n+1,i)}else if(o==="*"){if(typeof s=="object"&&s!==null&&!Array.isArray(s)){let r=s,a=Object.keys(r).filter(c=>!c.startsWith("_")&&!i.has(c)),l={};for(let c of a)l[c]=r[c];for(let[c,d]of Object.entries(l)){let p=[];for(let g of t.slice(n))g==="*"?p.push(c):p.push(g);f(r,p,d)}for(let c of a)delete r[c]}}else{let r=s;o in r&&hg(r[o],e,t,n+1,i)}}function um(s){if(typeof s!="string")throw new Error("fromImageBytes must be a string");return s}function ZE(s){let e={},t=h(s,["operationName"]);t!=null&&f(e,["operationName"],t);let n=h(s,["resourceName"]);return n!=null&&f(e,["_url","resourceName"],n),e}function QE(s){let e={},t=h(s,["name"]);t!=null&&f(e,["name"],t);let n=h(s,["metadata"]);n!=null&&f(e,["metadata"],n);let i=h(s,["done"]);i!=null&&f(e,["done"],i);let o=h(s,["error"]);o!=null&&f(e,["error"],o);let r=h(s,["response","generateVideoResponse"]);return r!=null&&f(e,["response"],e0(r)),e}function jE(s){let e={},t=h(s,["name"]);t!=null&&f(e,["name"],t);let n=h(s,["metadata"]);n!=null&&f(e,["metadata"],n);let i=h(s,["done"]);i!=null&&f(e,["done"],i);let o=h(s,["error"]);o!=null&&f(e,["error"],o);let r=h(s,["response"]);return r!=null&&f(e,["response"],t0(r)),e}function e0(s){let e={},t=h(s,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>n0(r))),f(e,["generatedVideos"],o)}let n=h(s,["raiMediaFilteredCount"]);n!=null&&f(e,["raiMediaFilteredCount"],n);let i=h(s,["raiMediaFilteredReasons"]);return i!=null&&f(e,["raiMediaFilteredReasons"],i),e}function t0(s){let e={},t=h(s,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>i0(r))),f(e,["generatedVideos"],o)}let n=h(s,["raiMediaFilteredCount"]);n!=null&&f(e,["raiMediaFilteredCount"],n);let i=h(s,["raiMediaFilteredReasons"]);return i!=null&&f(e,["raiMediaFilteredReasons"],i),e}function n0(s){let e={},t=h(s,["video"]);return t!=null&&f(e,["video"],c0(t)),e}function i0(s){let e={},t=h(s,["_self"]);return t!=null&&f(e,["video"],u0(t)),e}function s0(s){let e={},t=h(s,["operationName"]);return t!=null&&f(e,["_url","operationName"],t),e}function o0(s){let e={},t=h(s,["operationName"]);return t!=null&&f(e,["_url","operationName"],t),e}function r0(s){let e={},t=h(s,["name"]);t!=null&&f(e,["name"],t);let n=h(s,["metadata"]);n!=null&&f(e,["metadata"],n);let i=h(s,["done"]);i!=null&&f(e,["done"],i);let o=h(s,["error"]);o!=null&&f(e,["error"],o);let r=h(s,["response"]);return r!=null&&f(e,["response"],a0(r)),e}function a0(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["parent"]);n!=null&&f(e,["parent"],n);let i=h(s,["documentName"]);return i!=null&&f(e,["documentName"],i),e}function OA(s){let e={},t=h(s,["name"]);t!=null&&f(e,["name"],t);let n=h(s,["metadata"]);n!=null&&f(e,["metadata"],n);let i=h(s,["done"]);i!=null&&f(e,["done"],i);let o=h(s,["error"]);o!=null&&f(e,["error"],o);let r=h(s,["response"]);return r!=null&&f(e,["response"],l0(r)),e}function l0(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["parent"]);n!=null&&f(e,["parent"],n);let i=h(s,["documentName"]);return i!=null&&f(e,["documentName"],i),e}function c0(s){let e={},t=h(s,["uri"]);t!=null&&f(e,["uri"],t);let n=h(s,["encodedVideo"]);n!=null&&f(e,["videoBytes"],um(n));let i=h(s,["encoding"]);return i!=null&&f(e,["mimeType"],i),e}function u0(s){let e={},t=h(s,["gcsUri"]);t!=null&&f(e,["uri"],t);let n=h(s,["bytesBase64Encoded"]);n!=null&&f(e,["videoBytes"],um(n));let i=h(s,["mimeType"]);return i!=null&&f(e,["mimeType"],i),e}var gw;(function(s){s.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",s.OUTCOME_OK="OUTCOME_OK",s.OUTCOME_FAILED="OUTCOME_FAILED",s.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(gw||(gw={}));var mw;(function(s){s.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",s.PYTHON="PYTHON"})(mw||(mw={}));var yw;(function(s){s.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",s.SILENT="SILENT",s.WHEN_IDLE="WHEN_IDLE",s.INTERRUPT="INTERRUPT"})(yw||(yw={}));var Ti;(function(s){s.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",s.STRING="STRING",s.NUMBER="NUMBER",s.INTEGER="INTEGER",s.BOOLEAN="BOOLEAN",s.ARRAY="ARRAY",s.OBJECT="OBJECT",s.NULL="NULL"})(Ti||(Ti={}));var vw;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(vw||(vw={}));var ww;(function(s){s.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",s.SIMPLE_SEARCH="SIMPLE_SEARCH",s.ELASTIC_SEARCH="ELASTIC_SEARCH"})(ww||(ww={}));var Aw;(function(s){s.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",s.NO_AUTH="NO_AUTH",s.API_KEY_AUTH="API_KEY_AUTH",s.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",s.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",s.OAUTH="OAUTH",s.OIDC_AUTH="OIDC_AUTH"})(Aw||(Aw={}));var _w;(function(s){s.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",s.HTTP_IN_QUERY="HTTP_IN_QUERY",s.HTTP_IN_HEADER="HTTP_IN_HEADER",s.HTTP_IN_PATH="HTTP_IN_PATH",s.HTTP_IN_BODY="HTTP_IN_BODY",s.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(_w||(_w={}));var Tw;(function(s){s.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",s.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",s.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",s.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Tw||(Tw={}));var Ew;(function(s){s.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH",s.MINIMAL="MINIMAL"})(Ew||(Ew={}));var Cw;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",s.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",s.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",s.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",s.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(Cw||(Cw={}));var Sw;(function(s){s.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",s.SEVERITY="SEVERITY",s.PROBABILITY="PROBABILITY"})(Sw||(Sw={}));var bw;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE",s.OFF="OFF"})(bw||(bw={}));var xw;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.OTHER="OTHER",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.SPII="SPII",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.IMAGE_SAFETY="IMAGE_SAFETY",s.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",s.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",s.NO_IMAGE="NO_IMAGE",s.IMAGE_RECITATION="IMAGE_RECITATION",s.IMAGE_OTHER="IMAGE_OTHER"})(xw||(xw={}));var Iw;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})(Iw||(Iw={}));var Rw;(function(s){s.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",s.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",s.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",s.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",s.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Rw||(Rw={}));var Pw;(function(s){s.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",s.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",s.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",s.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",s.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Pw||(Pw={}));var Mw;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.IMAGE_SAFETY="IMAGE_SAFETY",s.MODEL_ARMOR="MODEL_ARMOR",s.JAILBREAK="JAILBREAK"})(Mw||(Mw={}));var Nw;(function(s){s.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",s.ON_DEMAND="ON_DEMAND",s.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Nw||(Nw={}));var od;(function(s){s.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",s.TEXT="TEXT",s.IMAGE="IMAGE",s.AUDIO="AUDIO"})(od||(od={}));var kw;(function(s){s.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",s.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",s.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",s.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(kw||(kw={}));var Dw;(function(s){s.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",s.TUNING_MODE_FULL="TUNING_MODE_FULL",s.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Dw||(Dw={}));var Fw;(function(s){s.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",s.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",s.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",s.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",s.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",s.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",s.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Fw||(Fw={}));var fg;(function(s){s.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",s.JOB_STATE_QUEUED="JOB_STATE_QUEUED",s.JOB_STATE_PENDING="JOB_STATE_PENDING",s.JOB_STATE_RUNNING="JOB_STATE_RUNNING",s.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",s.JOB_STATE_FAILED="JOB_STATE_FAILED",s.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",s.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",s.JOB_STATE_PAUSED="JOB_STATE_PAUSED",s.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",s.JOB_STATE_UPDATING="JOB_STATE_UPDATING",s.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(fg||(fg={}));var Lw;(function(s){s.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",s.TUNING_TASK_I2V="TUNING_TASK_I2V",s.TUNING_TASK_T2V="TUNING_TASK_T2V",s.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Lw||(Lw={}));var Uw;(function(s){s.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",s.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",s.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",s.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",s.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(Uw||(Uw={}));var Ow;(function(s){s.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",s.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",s.BALANCED="BALANCED",s.PRIORITIZE_COST="PRIORITIZE_COST"})(Ow||(Ow={}));var $w;(function(s){s.UNSPECIFIED="UNSPECIFIED",s.BLOCKING="BLOCKING",s.NON_BLOCKING="NON_BLOCKING"})($w||($w={}));var Gw;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(Gw||(Gw={}));var Bw;(function(s){s.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",s.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Bw||(Bw={}));var Hw;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE",s.VALIDATED="VALIDATED"})(Hw||(Hw={}));var Vw;(function(s){s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(Vw||(Vw={}));var qw;(function(s){s.DONT_ALLOW="DONT_ALLOW",s.ALLOW_ADULT="ALLOW_ADULT",s.ALLOW_ALL="ALLOW_ALL"})(qw||(qw={}));var zw;(function(s){s.auto="auto",s.en="en",s.ja="ja",s.ko="ko",s.hi="hi",s.zh="zh",s.pt="pt",s.es="es"})(zw||(zw={}));var Ww;(function(s){s.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",s.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",s.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",s.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",s.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Ww||(Ww={}));var Kw;(function(s){s.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",s.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",s.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",s.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Kw||(Kw={}));var Yw;(function(s){s.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",s.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",s.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",s.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Yw||(Yw={}));var Jw;(function(s){s.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",s.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",s.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",s.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",s.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",s.EDIT_MODE_STYLE="EDIT_MODE_STYLE",s.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",s.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Jw||(Jw={}));var Xw;(function(s){s.FOREGROUND="FOREGROUND",s.BACKGROUND="BACKGROUND",s.PROMPT="PROMPT",s.SEMANTIC="SEMANTIC",s.INTERACTIVE="INTERACTIVE"})(Xw||(Xw={}));var Zw;(function(s){s.ASSET="ASSET",s.STYLE="STYLE"})(Zw||(Zw={}));var Qw;(function(s){s.INSERT="INSERT",s.REMOVE="REMOVE",s.REMOVE_STATIC="REMOVE_STATIC",s.OUTPAINT="OUTPAINT"})(Qw||(Qw={}));var jw;(function(s){s.OPTIMIZED="OPTIMIZED",s.LOSSLESS="LOSSLESS"})(jw||(jw={}));var eA;(function(s){s.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",s.PREFERENCE_TUNING="PREFERENCE_TUNING"})(eA||(eA={}));var tA;(function(s){s.STATE_UNSPECIFIED="STATE_UNSPECIFIED",s.STATE_PENDING="STATE_PENDING",s.STATE_ACTIVE="STATE_ACTIVE",s.STATE_FAILED="STATE_FAILED"})(tA||(tA={}));var nA;(function(s){s.STATE_UNSPECIFIED="STATE_UNSPECIFIED",s.PROCESSING="PROCESSING",s.ACTIVE="ACTIVE",s.FAILED="FAILED"})(nA||(nA={}));var iA;(function(s){s.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",s.UPLOADED="UPLOADED",s.GENERATED="GENERATED"})(iA||(iA={}));var sA;(function(s){s.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.RESPONSE_REJECTED="RESPONSE_REJECTED",s.NEED_MORE_INPUT="NEED_MORE_INPUT"})(sA||(sA={}));var oA;(function(s){s.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",s.TEXT="TEXT",s.IMAGE="IMAGE",s.VIDEO="VIDEO",s.AUDIO="AUDIO",s.DOCUMENT="DOCUMENT"})(oA||(oA={}));var rA;(function(s){s.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",s.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",s.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(rA||(rA={}));var aA;(function(s){s.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",s.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",s.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(aA||(aA={}));var lA;(function(s){s.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",s.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",s.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(lA||(lA={}));var cA;(function(s){s.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",s.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",s.NO_INTERRUPTION="NO_INTERRUPTION"})(cA||(cA={}));var uA;(function(s){s.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",s.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",s.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(uA||(uA={}));var dA;(function(s){s.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",s.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",s.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",s.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",s.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",s.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",s.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",s.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",s.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",s.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",s.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",s.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",s.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(dA||(dA={}));var hA;(function(s){s.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",s.QUALITY="QUALITY",s.DIVERSITY="DIVERSITY",s.VOCALIZATION="VOCALIZATION"})(hA||(hA={}));var zo;(function(s){s.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",s.PLAY="PLAY",s.PAUSE="PAUSE",s.STOP="STOP",s.RESET_CONTEXT="RESET_CONTEXT"})(zo||(zo={}));var Ya=class{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var hs=class{get text(){var e,t,n,i,o,r,a,l;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",d=!1,p=[];for(let g of(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[m,y]of Object.entries(g))m!=="text"&&m!=="thought"&&m!=="thoughtSignature"&&(y!==null||y!==void 0)&&p.push(m);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;d=!0,c+=g.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?c:void 0}get data(){var e,t,n,i,o,r,a,l;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="",d=[];for(let p of(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[g,m]of Object.entries(p))g!=="inlineData"&&(m!==null||m!==void 0)&&d.push(g);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,t,n,i,o,r,a,l;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let c=(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,t,n,i,o,r,a,l,c;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let d=(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,t,n,i,o,r,a,l,c;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let d=(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.output}},rd=class{},ad=class{},pg=class{},gg=class{},mg=class{},yg=class{},ld=class{},cd=class{},ud=class{},vg=class{};var dd=class s{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new s,i,o=e;return t?i=jE(o):i=QE(o),Object.assign(n,i),n}},hd=class{},fd=class{},pd=class{},gd=class{},wg=class{},Ag=class{},_g=class{};var Tg=class s{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new s,o=r0(e);return Object.assign(n,o),n}},Eg=class{},Cg=class{},Sg=class{};var md=class{};var bg=class{get text(){var e,t,n;let i="",o=!1,r=[];for(let a of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[l,c]of Object.entries(a))l!=="text"&&l!=="thought"&&c!==null&&r.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;o=!0,i+=a.text}}return r.length>0&&console.warn(`there are non-text parts ${r} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?i:void 0}get data(){var e,t,n;let i="",o=[];for(let r of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[a,l]of Object.entries(r))a!=="inlineData"&&l!==null&&o.push(a);r.inlineData&&typeof r.inlineData.data=="string"&&(i+=atob(r.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}};var xg=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var Ig=class s{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new s,o=OA(e);return Object.assign(n,o),n}};function ne(s,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(s.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function $A(s,e){let t=ne(s,e);return t?t.startsWith("publishers/")&&s.isVertexAI()?`projects/${s.getProject()}/locations/${s.getLocation()}/${t}`:t.startsWith("models/")&&s.isVertexAI()?`projects/${s.getProject()}/locations/${s.getLocation()}/publishers/google/${t}`:t:""}function GA(s){return Array.isArray(s)?s.map(e=>yd(e)):[yd(s)]}function yd(s){if(typeof s=="object"&&s!==null)return s;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof s}`)}function BA(s){let e=yd(s);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function HA(s){let e=yd(s);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function fA(s){if(s==null)throw new Error("PartUnion is required");if(typeof s=="object")return s;if(typeof s=="string")return{text:s};throw new Error(`Unsupported part type: ${typeof s}`)}function VA(s){if(s==null||Array.isArray(s)&&s.length===0)throw new Error("PartListUnion is required");return Array.isArray(s)?s.map(e=>fA(e)):[fA(s)]}function Rg(s){return s!=null&&typeof s=="object"&&"parts"in s&&Array.isArray(s.parts)}function pA(s){return s!=null&&typeof s=="object"&&"functionCall"in s}function gA(s){return s!=null&&typeof s=="object"&&"functionResponse"in s}function Ve(s){if(s==null)throw new Error("ContentUnion is required");return Rg(s)?s:{role:"user",parts:VA(s)}}function dm(s,e){if(!e)return[];if(s.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let n=Ve(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(s.isVertexAI()){let t=Ve(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Ve(t)):[Ve(e)]}function Nt(s){if(s==null||Array.isArray(s)&&s.length===0)throw new Error("contents are required");if(!Array.isArray(s)){if(pA(s)||gA(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Ve(s)]}let e=[],t=[],n=Rg(s[0]);for(let i of s){let o=Rg(i);if(o!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(i);else{if(pA(i)||gA(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(i)}}return n||e.push({role:"user",parts:VA(t)}),e}function d0(s,e){s.includes("null")&&(e.nullable=!0);let t=s.filter(n=>n!=="null");if(t.length===1)e.type=Object.values(Ti).includes(t[0].toUpperCase())?t[0].toUpperCase():Ti.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let n of t)e.anyOf.push({type:Object.values(Ti).includes(n.toUpperCase())?n.toUpperCase():Ti.TYPE_UNSPECIFIED})}}function Wo(s){let e={},t=["items"],n=["anyOf"],i=["properties"];if(s.type&&s.anyOf)throw new Error("type and anyOf cannot be both populated.");let o=s.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,s=o[1]):o[1].type==="null"&&(e.nullable=!0,s=o[0])),s.type instanceof Array&&d0(s.type,e);for(let[r,a]of Object.entries(s))if(a!=null)if(r=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(Ti).includes(a.toUpperCase())?a.toUpperCase():Ti.TYPE_UNSPECIFIED}else if(t.includes(r))e[r]=Wo(a);else if(n.includes(r)){let l=[];for(let c of a){if(c.type=="null"){e.nullable=!0;continue}l.push(Wo(c))}e[r]=l}else if(i.includes(r)){let l={};for(let[c,d]of Object.entries(a))l[c]=Wo(d);e[r]=l}else{if(r==="additionalProperties")continue;e[r]=a}return e}function hm(s){return Wo(s)}function fm(s){if(typeof s=="object")return s;if(typeof s=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:s}}};throw new Error(`Unsupported speechConfig type: ${typeof s}`)}function pm(s){if("multiSpeakerVoiceConfig"in s)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return s}function Xo(s){if(s.functionDeclarations)for(let e of s.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Wo(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Wo(e.response));return s}function Zo(s){if(s==null)throw new Error("tools is required");if(!Array.isArray(s))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of s)e.push(t);return e}function h0(s,e,t,n=1){let i=!e.startsWith(`${t}/`)&&e.split("/").length===n;return s.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${s.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${s.getProject()}/locations/${s.getLocation()}/${e}`:i?`projects/${s.getProject()}/locations/${s.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function Gn(s,e){if(typeof e!="string")throw new Error("name must be a string");return h0(s,e,"cachedContents")}function qA(s){switch(s){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return s}}function Ei(s){return um(s)}function f0(s){return s!=null&&typeof s=="object"&&"name"in s}function p0(s){return s!=null&&typeof s=="object"&&"video"in s}function g0(s){return s!=null&&typeof s=="object"&&"uri"in s}function zA(s){var e;let t;if(f0(s)&&(t=s.name),!(g0(s)&&(t=s.uri,t===void 0))&&!(p0(s)&&(t=(e=s.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof s=="string"&&(t=s),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let i=t.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${t}`);t=i[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function WA(s,e){let t;return s.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function KA(s){for(let e of["models","tunedModels","publisherModels"])if(m0(s,e))return s[e];return[]}function m0(s,e){return s!==null&&typeof s=="object"&&e in s}function y0(s,e={}){let t=s,n={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(n.responseJsonSchema=t.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function v0(s,e={}){let t=[],n=new Set;for(let i of s){let o=i.name;if(n.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);n.add(o);let r=y0(i,e);r.functionDeclarations&&t.push(...r.functionDeclarations)}return{functionDeclarations:t}}function YA(s,e){let t;if(typeof e=="string")if(s.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(s.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let n=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,i=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(s.isVertexAI()){if(i>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function w0(s){if(typeof s!="string")return s;let e=s;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function JA(s){if(typeof s!="object"||s===null)return{};let e=s,t=e.inlinedResponses;if(typeof t!="object"||t===null)return s;let i=t.inlinedResponses;if(!Array.isArray(i)||i.length===0)return s;let o=!1;for(let r of i){if(typeof r!="object"||r===null)continue;let l=r.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),s}function Qo(s,e){let t=e;if(!s.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function XA(s){let e=s;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function A0(s){let e={},t=h(s,["responsesFile"]);t!=null&&f(e,["fileName"],t);let n=h(s,["inlinedResponses","inlinedResponses"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>eC(r))),f(e,["inlinedResponses"],o)}let i=h(s,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(e,["inlinedEmbedContentResponses"],o)}return e}function _0(s){let e={},t=h(s,["predictionsFormat"]);t!=null&&f(e,["format"],t);let n=h(s,["gcsDestination","outputUriPrefix"]);n!=null&&f(e,["gcsUri"],n);let i=h(s,["bigqueryDestination","outputUri"]);return i!=null&&f(e,["bigqueryUri"],i),e}function T0(s){let e={},t=h(s,["format"]);t!=null&&f(e,["predictionsFormat"],t);let n=h(s,["gcsUri"]);n!=null&&f(e,["gcsDestination","outputUriPrefix"],n);let i=h(s,["bigqueryUri"]);if(i!=null&&f(e,["bigqueryDestination","outputUri"],i),h(s,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(h(s,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(h(s,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function id(s){let e={},t=h(s,["name"]);t!=null&&f(e,["name"],t);let n=h(s,["metadata","displayName"]);n!=null&&f(e,["displayName"],n);let i=h(s,["metadata","state"]);i!=null&&f(e,["state"],XA(i));let o=h(s,["metadata","createTime"]);o!=null&&f(e,["createTime"],o);let r=h(s,["metadata","endTime"]);r!=null&&f(e,["endTime"],r);let a=h(s,["metadata","updateTime"]);a!=null&&f(e,["updateTime"],a);let l=h(s,["metadata","model"]);l!=null&&f(e,["model"],l);let c=h(s,["metadata","output"]);return c!=null&&f(e,["dest"],A0(JA(c))),e}function Pg(s){let e={},t=h(s,["name"]);t!=null&&f(e,["name"],t);let n=h(s,["displayName"]);n!=null&&f(e,["displayName"],n);let i=h(s,["state"]);i!=null&&f(e,["state"],XA(i));let o=h(s,["error"]);o!=null&&f(e,["error"],o);let r=h(s,["createTime"]);r!=null&&f(e,["createTime"],r);let a=h(s,["startTime"]);a!=null&&f(e,["startTime"],a);let l=h(s,["endTime"]);l!=null&&f(e,["endTime"],l);let c=h(s,["updateTime"]);c!=null&&f(e,["updateTime"],c);let d=h(s,["model"]);d!=null&&f(e,["model"],d);let p=h(s,["inputConfig"]);p!=null&&f(e,["src"],E0(p));let g=h(s,["outputConfig"]);g!=null&&f(e,["dest"],_0(JA(g)));let m=h(s,["completionStats"]);return m!=null&&f(e,["completionStats"],m),e}function E0(s){let e={},t=h(s,["instancesFormat"]);t!=null&&f(e,["format"],t);let n=h(s,["gcsSource","uris"]);n!=null&&f(e,["gcsUri"],n);let i=h(s,["bigquerySource","inputUri"]);return i!=null&&f(e,["bigqueryUri"],i),e}function C0(s,e){let t={};if(h(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(h(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(h(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let n=h(e,["fileName"]);n!=null&&f(t,["fileName"],n);let i=h(e,["inlinedRequests"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>j0(s,r))),f(t,["requests","requests"],o)}return t}function S0(s){let e={},t=h(s,["format"]);t!=null&&f(e,["instancesFormat"],t);let n=h(s,["gcsUri"]);n!=null&&f(e,["gcsSource","uris"],n);let i=h(s,["bigqueryUri"]);if(i!=null&&f(e,["bigquerySource","inputUri"],i),h(s,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(h(s,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function b0(s){let e={},t=h(s,["data"]);if(t!=null&&f(e,["data"],t),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(e,["mimeType"],n),e}function x0(s,e){let t={},n=h(e,["name"]);return n!=null&&f(t,["_url","name"],Qo(s,n)),t}function I0(s,e){let t={},n=h(e,["name"]);return n!=null&&f(t,["_url","name"],Qo(s,n)),t}function R0(s){let e={},t=h(s,["content"]);t!=null&&f(e,["content"],t);let n=h(s,["citationMetadata"]);n!=null&&f(e,["citationMetadata"],P0(n));let i=h(s,["tokenCount"]);i!=null&&f(e,["tokenCount"],i);let o=h(s,["finishReason"]);o!=null&&f(e,["finishReason"],o);let r=h(s,["avgLogprobs"]);r!=null&&f(e,["avgLogprobs"],r);let a=h(s,["groundingMetadata"]);a!=null&&f(e,["groundingMetadata"],a);let l=h(s,["index"]);l!=null&&f(e,["index"],l);let c=h(s,["logprobsResult"]);c!=null&&f(e,["logprobsResult"],c);let d=h(s,["safetyRatings"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(m=>m)),f(e,["safetyRatings"],g)}let p=h(s,["urlContextMetadata"]);return p!=null&&f(e,["urlContextMetadata"],p),e}function P0(s){let e={},t=h(s,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(i=>i)),f(e,["citations"],n)}return e}function ZA(s){let e={},t=h(s,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>aC(o))),f(e,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(e,["role"],n),e}function M0(s,e){let t={},n=h(s,["displayName"]);if(e!==void 0&&n!=null&&f(e,["batch","displayName"],n),h(s,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function N0(s,e){let t={},n=h(s,["displayName"]);e!==void 0&&n!=null&&f(e,["displayName"],n);let i=h(s,["dest"]);return e!==void 0&&i!=null&&f(e,["outputConfig"],T0(w0(i))),t}function mA(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["src"]);i!=null&&f(t,["batch","inputConfig"],C0(s,YA(s,i)));let o=h(e,["config"]);return o!=null&&M0(o,t),t}function k0(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["model"],ne(s,n));let i=h(e,["src"]);i!=null&&f(t,["inputConfig"],S0(YA(s,i)));let o=h(e,["config"]);return o!=null&&N0(o,t),t}function D0(s,e){let t={},n=h(s,["displayName"]);return e!==void 0&&n!=null&&f(e,["batch","displayName"],n),t}function F0(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["src"]);i!=null&&f(t,["batch","inputConfig"],H0(s,i));let o=h(e,["config"]);return o!=null&&D0(o,t),t}function L0(s,e){let t={},n=h(e,["name"]);return n!=null&&f(t,["_url","name"],Qo(s,n)),t}function U0(s,e){let t={},n=h(e,["name"]);return n!=null&&f(t,["_url","name"],Qo(s,n)),t}function O0(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["name"]);n!=null&&f(e,["name"],n);let i=h(s,["done"]);i!=null&&f(e,["done"],i);let o=h(s,["error"]);return o!=null&&f(e,["error"],o),e}function $0(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["name"]);n!=null&&f(e,["name"],n);let i=h(s,["done"]);i!=null&&f(e,["done"],i);let o=h(s,["error"]);return o!=null&&f(e,["error"],o),e}function G0(s,e){let t={},n=h(e,["contents"]);if(n!=null){let o=dm(s,n);Array.isArray(o)&&(o=o.map(r=>r)),f(t,["requests[]","request","content"],o)}let i=h(e,["config"]);return i!=null&&(f(t,["_self"],B0(i,t)),XE(t,{"requests[].*":"requests[].request.*"})),t}function B0(s,e){let t={},n=h(s,["taskType"]);e!==void 0&&n!=null&&f(e,["requests[]","taskType"],n);let i=h(s,["title"]);e!==void 0&&i!=null&&f(e,["requests[]","title"],i);let o=h(s,["outputDimensionality"]);if(e!==void 0&&o!=null&&f(e,["requests[]","outputDimensionality"],o),h(s,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(h(s,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function H0(s,e){let t={},n=h(e,["fileName"]);n!=null&&f(t,["file_name"],n);let i=h(e,["inlinedRequests"]);return i!=null&&f(t,["requests"],G0(s,i)),t}function V0(s){let e={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=h(s,["fileUri"]);t!=null&&f(e,["fileUri"],t);let n=h(s,["mimeType"]);return n!=null&&f(e,["mimeType"],n),e}function q0(s){let e={},t=h(s,["id"]);t!=null&&f(e,["id"],t);let n=h(s,["args"]);n!=null&&f(e,["args"],n);let i=h(s,["name"]);if(i!=null&&f(e,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function z0(s){let e={},t=h(s,["mode"]);t!=null&&f(e,["mode"],t);let n=h(s,["allowedFunctionNames"]);if(n!=null&&f(e,["allowedFunctionNames"],n),h(s,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function W0(s,e,t){let n={},i=h(e,["systemInstruction"]);t!==void 0&&i!=null&&f(t,["systemInstruction"],ZA(Ve(i)));let o=h(e,["temperature"]);o!=null&&f(n,["temperature"],o);let r=h(e,["topP"]);r!=null&&f(n,["topP"],r);let a=h(e,["topK"]);a!=null&&f(n,["topK"],a);let l=h(e,["candidateCount"]);l!=null&&f(n,["candidateCount"],l);let c=h(e,["maxOutputTokens"]);c!=null&&f(n,["maxOutputTokens"],c);let d=h(e,["stopSequences"]);d!=null&&f(n,["stopSequences"],d);let p=h(e,["responseLogprobs"]);p!=null&&f(n,["responseLogprobs"],p);let g=h(e,["logprobs"]);g!=null&&f(n,["logprobs"],g);let m=h(e,["presencePenalty"]);m!=null&&f(n,["presencePenalty"],m);let y=h(e,["frequencyPenalty"]);y!=null&&f(n,["frequencyPenalty"],y);let A=h(e,["seed"]);A!=null&&f(n,["seed"],A);let _=h(e,["responseMimeType"]);_!=null&&f(n,["responseMimeType"],_);let E=h(e,["responseSchema"]);E!=null&&f(n,["responseSchema"],hm(E));let C=h(e,["responseJsonSchema"]);if(C!=null&&f(n,["responseJsonSchema"],C),h(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(h(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let S=h(e,["safetySettings"]);if(t!==void 0&&S!=null){let z=S;Array.isArray(z)&&(z=z.map(W=>lC(W))),f(t,["safetySettings"],z)}let b=h(e,["tools"]);if(t!==void 0&&b!=null){let z=Zo(b);Array.isArray(z)&&(z=z.map(W=>uC(Xo(W)))),f(t,["tools"],z)}let x=h(e,["toolConfig"]);if(t!==void 0&&x!=null&&f(t,["toolConfig"],cC(x)),h(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let P=h(e,["cachedContent"]);t!==void 0&&P!=null&&f(t,["cachedContent"],Gn(s,P));let I=h(e,["responseModalities"]);I!=null&&f(n,["responseModalities"],I);let N=h(e,["mediaResolution"]);N!=null&&f(n,["mediaResolution"],N);let M=h(e,["speechConfig"]);if(M!=null&&f(n,["speechConfig"],fm(M)),h(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=h(e,["thinkingConfig"]);F!=null&&f(n,["thinkingConfig"],F);let U=h(e,["imageConfig"]);U!=null&&f(n,["imageConfig"],Q0(U));let j=h(e,["enableEnhancedCivicAnswers"]);return j!=null&&f(n,["enableEnhancedCivicAnswers"],j),n}function K0(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>R0(c))),f(e,["candidates"],l)}let i=h(s,["modelVersion"]);i!=null&&f(e,["modelVersion"],i);let o=h(s,["promptFeedback"]);o!=null&&f(e,["promptFeedback"],o);let r=h(s,["responseId"]);r!=null&&f(e,["responseId"],r);let a=h(s,["usageMetadata"]);return a!=null&&f(e,["usageMetadata"],a),e}function Y0(s,e){let t={},n=h(e,["name"]);return n!=null&&f(t,["_url","name"],Qo(s,n)),t}function J0(s,e){let t={},n=h(e,["name"]);return n!=null&&f(t,["_url","name"],Qo(s,n)),t}function X0(s){let e={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=h(s,["enableWidget"]);return t!=null&&f(e,["enableWidget"],t),e}function Z0(s){let e={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=h(s,["timeRangeFilter"]);return t!=null&&f(e,["timeRangeFilter"],t),e}function Q0(s){let e={},t=h(s,["aspectRatio"]);t!=null&&f(e,["aspectRatio"],t);let n=h(s,["imageSize"]);if(n!=null&&f(e,["imageSize"],n),h(s,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(h(s,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function j0(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["request","model"],ne(s,n));let i=h(e,["contents"]);if(i!=null){let a=Nt(i);Array.isArray(a)&&(a=a.map(l=>ZA(l))),f(t,["request","contents"],a)}let o=h(e,["metadata"]);o!=null&&f(t,["metadata"],o);let r=h(e,["config"]);return r!=null&&f(t,["request","generationConfig"],W0(s,r,h(t,["request"],{}))),t}function eC(s){let e={},t=h(s,["response"]);t!=null&&f(e,["response"],K0(t));let n=h(s,["error"]);return n!=null&&f(e,["error"],n),e}function tC(s,e){let t={},n=h(s,["pageSize"]);e!==void 0&&n!=null&&f(e,["_query","pageSize"],n);let i=h(s,["pageToken"]);if(e!==void 0&&i!=null&&f(e,["_query","pageToken"],i),h(s,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function nC(s,e){let t={},n=h(s,["pageSize"]);e!==void 0&&n!=null&&f(e,["_query","pageSize"],n);let i=h(s,["pageToken"]);e!==void 0&&i!=null&&f(e,["_query","pageToken"],i);let o=h(s,["filter"]);return e!==void 0&&o!=null&&f(e,["_query","filter"],o),t}function iC(s){let e={},t=h(s,["config"]);return t!=null&&tC(t,e),e}function sC(s){let e={},t=h(s,["config"]);return t!=null&&nC(t,e),e}function oC(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["nextPageToken"]);n!=null&&f(e,["nextPageToken"],n);let i=h(s,["operations"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>id(r))),f(e,["batchJobs"],o)}return e}function rC(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["nextPageToken"]);n!=null&&f(e,["nextPageToken"],n);let i=h(s,["batchPredictionJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>Pg(r))),f(e,["batchJobs"],o)}return e}function aC(s){let e={},t=h(s,["mediaResolution"]);t!=null&&f(e,["mediaResolution"],t);let n=h(s,["codeExecutionResult"]);n!=null&&f(e,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(e,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(e,["fileData"],V0(o));let r=h(s,["functionCall"]);r!=null&&f(e,["functionCall"],q0(r));let a=h(s,["functionResponse"]);a!=null&&f(e,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(e,["inlineData"],b0(l));let c=h(s,["text"]);c!=null&&f(e,["text"],c);let d=h(s,["thought"]);d!=null&&f(e,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(e,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(e,["videoMetadata"],g),e}function lC(s){let e={},t=h(s,["category"]);if(t!=null&&f(e,["category"],t),h(s,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=h(s,["threshold"]);return n!=null&&f(e,["threshold"],n),e}function cC(s){let e={},t=h(s,["functionCallingConfig"]);t!=null&&f(e,["functionCallingConfig"],z0(t));let n=h(s,["retrievalConfig"]);return n!=null&&f(e,["retrievalConfig"],n),e}function uC(s){let e={},t=h(s,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(p=>p)),f(e,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(e,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(e,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(e,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(e,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(e,["googleMaps"],X0(a));let l=h(s,["googleSearch"]);l!=null&&f(e,["googleSearch"],Z0(l));let c=h(s,["urlContext"]);return c!=null&&f(e,["urlContext"],c),e}var On;(function(s){s.PAGED_ITEM_BATCH_JOBS="batchJobs",s.PAGED_ITEM_MODELS="models",s.PAGED_ITEM_TUNING_JOBS="tuningJobs",s.PAGED_ITEM_FILES="files",s.PAGED_ITEM_CACHED_CONTENTS="cachedContents",s.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",s.PAGED_ITEM_DOCUMENTS="documents"})(On||(On={}));var $n=class{constructor(e,t,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,i)}init(e,t,n){var i,o;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let r={config:{}};!n||Object.keys(n).length===0?r={config:{}}:typeof n=="object"?r=Object.assign({},n):r=n,r.config&&(r.config.pageToken=t.nextPageToken),this.paramsInternal=r,this.pageInternalSize=(o=(i=r.config)===null||i===void 0?void 0:i.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var Mg=class extends Wt{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new $n(On.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){let t=mA(this.apiClient,e),n=t._url,i=D("{model}:batchGenerateContent",n),a=t.batch.inputConfig.requests,l=a.requests,c=[];for(let d of l){let p=Object.assign({},d);if(p.systemInstruction){let g=p.systemInstruction;delete p.systemInstruction;let m=p.request;m.systemInstruction=g,p.request=m}c.push(p)}return a.requests=c,delete t.config,delete t._url,delete t._query,{path:i,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},i=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${i}`),n.dest===void 0){let o=this.getGcsUri(e),r=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?n.dest=`${o.slice(0,-6)}/dest`:n.dest=`${o}_dest_${i}`;else if(r)n.dest=`${r}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=k0(this.apiClient,e);return a=D("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>Pg(d))}else{let c=mA(this.apiClient,e);return a=D("{model}:batchGenerateContent",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>id(d))}}async createEmbeddingsInternal(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=F0(this.apiClient,e);return o=D("{model}:asyncBatchEmbedContent",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>id(l))}}async get(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=J0(this.apiClient,e);return a=D("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>Pg(d))}else{let c=Y0(this.apiClient,e);return a=D("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>id(d))}}async cancel(e){var t,n,i,o;let r="",a={};if(this.apiClient.isVertexAI()){let l=I0(this.apiClient,e);r=D("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{let l=x0(this.apiClient,e);r=D("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=sC(e);return a=D("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=rC(d),g=new md;return Object.assign(g,p),g})}else{let c=iC(e);return a=D("batches",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=oC(d),g=new md;return Object.assign(g,p),g})}}async delete(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=U0(this.apiClient,e);return a=D("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>$0(d))}else{let c=L0(this.apiClient,e);return a=D("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>O0(d))}}};function dC(s){let e={},t=h(s,["data"]);if(t!=null&&f(e,["data"],t),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(e,["mimeType"],n),e}function yA(s){let e={},t=h(s,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>DC(o))),f(e,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(e,["role"],n),e}function hC(s,e){let t={},n=h(s,["ttl"]);e!==void 0&&n!=null&&f(e,["ttl"],n);let i=h(s,["expireTime"]);e!==void 0&&i!=null&&f(e,["expireTime"],i);let o=h(s,["displayName"]);e!==void 0&&o!=null&&f(e,["displayName"],o);let r=h(s,["contents"]);if(e!==void 0&&r!=null){let d=Nt(r);Array.isArray(d)&&(d=d.map(p=>yA(p))),f(e,["contents"],d)}let a=h(s,["systemInstruction"]);e!==void 0&&a!=null&&f(e,["systemInstruction"],yA(Ve(a)));let l=h(s,["tools"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(p=>LC(p))),f(e,["tools"],d)}let c=h(s,["toolConfig"]);if(e!==void 0&&c!=null&&f(e,["toolConfig"],FC(c)),h(s,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function fC(s,e){let t={},n=h(s,["ttl"]);e!==void 0&&n!=null&&f(e,["ttl"],n);let i=h(s,["expireTime"]);e!==void 0&&i!=null&&f(e,["expireTime"],i);let o=h(s,["displayName"]);e!==void 0&&o!=null&&f(e,["displayName"],o);let r=h(s,["contents"]);if(e!==void 0&&r!=null){let p=Nt(r);Array.isArray(p)&&(p=p.map(g=>g)),f(e,["contents"],p)}let a=h(s,["systemInstruction"]);e!==void 0&&a!=null&&f(e,["systemInstruction"],Ve(a));let l=h(s,["tools"]);if(e!==void 0&&l!=null){let p=l;Array.isArray(p)&&(p=p.map(g=>UC(g))),f(e,["tools"],p)}let c=h(s,["toolConfig"]);e!==void 0&&c!=null&&f(e,["toolConfig"],c);let d=h(s,["kmsKeyName"]);return e!==void 0&&d!=null&&f(e,["encryption_spec","kmsKeyName"],d),t}function pC(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["model"],$A(s,n));let i=h(e,["config"]);return i!=null&&hC(i,t),t}function gC(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["model"],$A(s,n));let i=h(e,["config"]);return i!=null&&fC(i,t),t}function mC(s,e){let t={},n=h(e,["name"]);return n!=null&&f(t,["_url","name"],Gn(s,n)),t}function yC(s,e){let t={},n=h(e,["name"]);return n!=null&&f(t,["_url","name"],Gn(s,n)),t}function vC(s){let e={},t=h(s,["sdkHttpResponse"]);return t!=null&&f(e,["sdkHttpResponse"],t),e}function wC(s){let e={},t=h(s,["sdkHttpResponse"]);return t!=null&&f(e,["sdkHttpResponse"],t),e}function AC(s){let e={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=h(s,["fileUri"]);t!=null&&f(e,["fileUri"],t);let n=h(s,["mimeType"]);return n!=null&&f(e,["mimeType"],n),e}function _C(s){let e={},t=h(s,["id"]);t!=null&&f(e,["id"],t);let n=h(s,["args"]);n!=null&&f(e,["args"],n);let i=h(s,["name"]);if(i!=null&&f(e,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function TC(s){let e={},t=h(s,["mode"]);t!=null&&f(e,["mode"],t);let n=h(s,["allowedFunctionNames"]);if(n!=null&&f(e,["allowedFunctionNames"],n),h(s,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function EC(s){let e={};if(h(s,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=h(s,["description"]);t!=null&&f(e,["description"],t);let n=h(s,["name"]);n!=null&&f(e,["name"],n);let i=h(s,["parameters"]);i!=null&&f(e,["parameters"],i);let o=h(s,["parametersJsonSchema"]);o!=null&&f(e,["parametersJsonSchema"],o);let r=h(s,["response"]);r!=null&&f(e,["response"],r);let a=h(s,["responseJsonSchema"]);return a!=null&&f(e,["responseJsonSchema"],a),e}function CC(s,e){let t={},n=h(e,["name"]);return n!=null&&f(t,["_url","name"],Gn(s,n)),t}function SC(s,e){let t={},n=h(e,["name"]);return n!=null&&f(t,["_url","name"],Gn(s,n)),t}function bC(s){let e={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=h(s,["enableWidget"]);return t!=null&&f(e,["enableWidget"],t),e}function xC(s){let e={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=h(s,["timeRangeFilter"]);return t!=null&&f(e,["timeRangeFilter"],t),e}function IC(s,e){let t={},n=h(s,["pageSize"]);e!==void 0&&n!=null&&f(e,["_query","pageSize"],n);let i=h(s,["pageToken"]);return e!==void 0&&i!=null&&f(e,["_query","pageToken"],i),t}function RC(s,e){let t={},n=h(s,["pageSize"]);e!==void 0&&n!=null&&f(e,["_query","pageSize"],n);let i=h(s,["pageToken"]);return e!==void 0&&i!=null&&f(e,["_query","pageToken"],i),t}function PC(s){let e={},t=h(s,["config"]);return t!=null&&IC(t,e),e}function MC(s){let e={},t=h(s,["config"]);return t!=null&&RC(t,e),e}function NC(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["nextPageToken"]);n!=null&&f(e,["nextPageToken"],n);let i=h(s,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(e,["cachedContents"],o)}return e}function kC(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["nextPageToken"]);n!=null&&f(e,["nextPageToken"],n);let i=h(s,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(e,["cachedContents"],o)}return e}function DC(s){let e={},t=h(s,["mediaResolution"]);t!=null&&f(e,["mediaResolution"],t);let n=h(s,["codeExecutionResult"]);n!=null&&f(e,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(e,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(e,["fileData"],AC(o));let r=h(s,["functionCall"]);r!=null&&f(e,["functionCall"],_C(r));let a=h(s,["functionResponse"]);a!=null&&f(e,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(e,["inlineData"],dC(l));let c=h(s,["text"]);c!=null&&f(e,["text"],c);let d=h(s,["thought"]);d!=null&&f(e,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(e,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(e,["videoMetadata"],g),e}function FC(s){let e={},t=h(s,["functionCallingConfig"]);t!=null&&f(e,["functionCallingConfig"],TC(t));let n=h(s,["retrievalConfig"]);return n!=null&&f(e,["retrievalConfig"],n),e}function LC(s){let e={},t=h(s,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(p=>p)),f(e,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(e,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(e,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(e,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(e,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(e,["googleMaps"],bC(a));let l=h(s,["googleSearch"]);l!=null&&f(e,["googleSearch"],xC(l));let c=h(s,["urlContext"]);return c!=null&&f(e,["urlContext"],c),e}function UC(s){let e={},t=h(s,["functionDeclarations"]);if(t!=null){let p=t;Array.isArray(p)&&(p=p.map(g=>EC(g))),f(e,["functionDeclarations"],p)}let n=h(s,["retrieval"]);n!=null&&f(e,["retrieval"],n);let i=h(s,["googleSearchRetrieval"]);i!=null&&f(e,["googleSearchRetrieval"],i);let o=h(s,["computerUse"]);if(o!=null&&f(e,["computerUse"],o),h(s,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=h(s,["codeExecution"]);r!=null&&f(e,["codeExecution"],r);let a=h(s,["enterpriseWebSearch"]);a!=null&&f(e,["enterpriseWebSearch"],a);let l=h(s,["googleMaps"]);l!=null&&f(e,["googleMaps"],l);let c=h(s,["googleSearch"]);c!=null&&f(e,["googleSearch"],c);let d=h(s,["urlContext"]);return d!=null&&f(e,["urlContext"],d),e}function OC(s,e){let t={},n=h(s,["ttl"]);e!==void 0&&n!=null&&f(e,["ttl"],n);let i=h(s,["expireTime"]);return e!==void 0&&i!=null&&f(e,["expireTime"],i),t}function $C(s,e){let t={},n=h(s,["ttl"]);e!==void 0&&n!=null&&f(e,["ttl"],n);let i=h(s,["expireTime"]);return e!==void 0&&i!=null&&f(e,["expireTime"],i),t}function GC(s,e){let t={},n=h(e,["name"]);n!=null&&f(t,["_url","name"],Gn(s,n));let i=h(e,["config"]);return i!=null&&OC(i,t),t}function BC(s,e){let t={},n=h(e,["name"]);n!=null&&f(t,["_url","name"],Gn(s,n));let i=h(e,["config"]);return i!=null&&$C(i,t),t}var Ng=class extends Wt{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new $n(On.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=gC(this.apiClient,e);return a=D("cachedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>d)}else{let c=pC(this.apiClient,e);return a=D("cachedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>d)}}async get(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=SC(this.apiClient,e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>d)}else{let c=CC(this.apiClient,e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>d)}}async delete(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=yC(this.apiClient,e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=wC(d),g=new pd;return Object.assign(g,p),g})}else{let c=mC(this.apiClient,e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=vC(d),g=new pd;return Object.assign(g,p),g})}}async update(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=BC(this.apiClient,e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>d)}else{let c=GC(this.apiClient,e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>d)}}async listInternal(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=MC(e);return a=D("cachedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=kC(d),g=new gd;return Object.assign(g,p),g})}else{let c=PC(e);return a=D("cachedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=NC(d),g=new gd;return Object.assign(g,p),g})}}};function vd(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(s);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(s,n[i])&&(t[n[i]]=s[n[i]]);return t}function vA(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],n=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function q(s){return this instanceof q?(this.v=s,this):new q(s)}function qt(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(s,e||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",r),i[Symbol.asyncIterator]=function(){return this},i;function r(m){return function(y){return Promise.resolve(y).then(m,p)}}function a(m,y){n[m]&&(i[m]=function(A){return new Promise(function(_,E){o.push([m,A,_,E])>1||l(m,A)})},y&&(i[m]=y(i[m])))}function l(m,y){try{c(n[m](y))}catch(A){g(o[0][3],A)}}function c(m){m.value instanceof q?Promise.resolve(m.value.v).then(d,p):g(o[0][2],m)}function d(m){l("next",m)}function p(m){l("throw",m)}function g(m,y){m(y),o.shift(),o.length&&l(o[0][0],o[0][1])}}function zt(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=s[Symbol.asyncIterator],t;return e?e.call(s):(s=typeof vA=="function"?vA(s):s[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=s[o]&&function(r){return new Promise(function(a,l){r=s[o](r),i(a,l,r.done,r.value)})}}function i(o,r,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},r)}}function HC(s){var e;if(s.candidates==null||s.candidates.length===0)return!1;let t=(e=s.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:QA(t)}function QA(s){if(s.parts===void 0||s.parts.length===0)return!1;for(let e of s.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function VC(s){if(s.length!==0){for(let e of s)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function wA(s){if(s===void 0||s.length===0)return[];let e=[],t=s.length,n=0;for(;n<t;)if(s[n].role==="user")e.push(s[n]),n++;else{let i=[],o=!0;for(;n<t&&s[n].role==="model";)i.push(s[n]),o&&!QA(s[n])&&(o=!1),n++;o?e.push(...i):e.pop()}return e}var kg=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Dg(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},Dg=class{constructor(e,t,n,i={},o=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=i,this.history=o,this.sendPromise=Promise.resolve(),VC(o)}async sendMessage(e){var t;await this.sendPromise;let n=Ve(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var o,r,a;let l=await i,c=(r=(o=l.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content,d=l.automaticFunctionCallingHistory,p=this.getHistory(!0).length,g=[];d!=null&&(g=(a=d.slice(p))!==null&&a!==void 0?a:[]);let m=c?[c]:[];this.recordHistory(n,m,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;let n=Ve(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});let o=await i;return this.processStreamResponse(o,n)}getHistory(e=!1){let t=e?wA(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return qt(this,arguments,function*(){var i,o,r,a,l,c;let d=[];try{for(var p=!0,g=zt(e),m;m=yield q(g.next()),i=m.done,!i;p=!0){a=m.value,p=!1;let y=a;if(HC(y)){let A=(c=(l=y.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content;A!==void 0&&d.push(A)}yield yield q(y)}}catch(y){o={error:y}}finally{try{!p&&!i&&(r=g.return)&&(yield q(r.call(g)))}finally{if(o)throw o.error}}this.recordHistory(t,d)})}recordHistory(e,t,n){let i=[];t.length>0&&t.every(o=>o.role!==void 0)?i=t:i.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...wA(n)):this.history.push(e),this.history.push(...i)}};var wd=class s extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,s.prototype)}};function qC(s){let e={},t=h(s,["file"]);return t!=null&&f(e,["file"],t),e}function zC(s){let e={},t=h(s,["sdkHttpResponse"]);return t!=null&&f(e,["sdkHttpResponse"],t),e}function WC(s){let e={},t=h(s,["name"]);return t!=null&&f(e,["_url","file"],zA(t)),e}function KC(s){let e={},t=h(s,["sdkHttpResponse"]);return t!=null&&f(e,["sdkHttpResponse"],t),e}function YC(s){let e={},t=h(s,["name"]);return t!=null&&f(e,["_url","file"],zA(t)),e}function JC(s,e){let t={},n=h(s,["pageSize"]);e!==void 0&&n!=null&&f(e,["_query","pageSize"],n);let i=h(s,["pageToken"]);return e!==void 0&&i!=null&&f(e,["_query","pageToken"],i),t}function XC(s){let e={},t=h(s,["config"]);return t!=null&&JC(t,e),e}function ZC(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["nextPageToken"]);n!=null&&f(e,["nextPageToken"],n);let i=h(s,["files"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(e,["files"],o)}return e}var Fg=class extends Wt{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new $n(On.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=XC(e);return o=D("files",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=ZC(l),d=new Eg;return Object.assign(d,c),d})}}async createInternal(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=qC(e);return o=D("upload/v1beta/files",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=zC(l),d=new Cg;return Object.assign(d,c),d})}}async get(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=YC(e);return o=D("files/{file}",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=WC(e);return o=D("files/{file}",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=KC(l),d=new Sg;return Object.assign(d,c),d})}}};function sd(s){let e={},t=h(s,["data"]);if(t!=null&&f(e,["data"],t),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(e,["mimeType"],n),e}function QC(s){let e={},t=h(s,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>pS(o))),f(e,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(e,["role"],n),e}function jC(s){let e={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=h(s,["fileUri"]);t!=null&&f(e,["fileUri"],t);let n=h(s,["mimeType"]);return n!=null&&f(e,["mimeType"],n),e}function eS(s){let e={},t=h(s,["id"]);t!=null&&f(e,["id"],t);let n=h(s,["args"]);n!=null&&f(e,["args"],n);let i=h(s,["name"]);if(i!=null&&f(e,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function tS(s){let e={};if(h(s,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=h(s,["description"]);t!=null&&f(e,["description"],t);let n=h(s,["name"]);n!=null&&f(e,["name"],n);let i=h(s,["parameters"]);i!=null&&f(e,["parameters"],i);let o=h(s,["parametersJsonSchema"]);o!=null&&f(e,["parametersJsonSchema"],o);let r=h(s,["response"]);r!=null&&f(e,["response"],r);let a=h(s,["responseJsonSchema"]);return a!=null&&f(e,["responseJsonSchema"],a),e}function nS(s){let e={},t=h(s,["modelSelectionConfig"]);t!=null&&f(e,["modelConfig"],t);let n=h(s,["responseJsonSchema"]);n!=null&&f(e,["responseJsonSchema"],n);let i=h(s,["audioTimestamp"]);i!=null&&f(e,["audioTimestamp"],i);let o=h(s,["candidateCount"]);o!=null&&f(e,["candidateCount"],o);let r=h(s,["enableAffectiveDialog"]);r!=null&&f(e,["enableAffectiveDialog"],r);let a=h(s,["frequencyPenalty"]);a!=null&&f(e,["frequencyPenalty"],a);let l=h(s,["logprobs"]);l!=null&&f(e,["logprobs"],l);let c=h(s,["maxOutputTokens"]);c!=null&&f(e,["maxOutputTokens"],c);let d=h(s,["mediaResolution"]);d!=null&&f(e,["mediaResolution"],d);let p=h(s,["presencePenalty"]);p!=null&&f(e,["presencePenalty"],p);let g=h(s,["responseLogprobs"]);g!=null&&f(e,["responseLogprobs"],g);let m=h(s,["responseMimeType"]);m!=null&&f(e,["responseMimeType"],m);let y=h(s,["responseModalities"]);y!=null&&f(e,["responseModalities"],y);let A=h(s,["responseSchema"]);A!=null&&f(e,["responseSchema"],A);let _=h(s,["routingConfig"]);_!=null&&f(e,["routingConfig"],_);let E=h(s,["seed"]);E!=null&&f(e,["seed"],E);let C=h(s,["speechConfig"]);C!=null&&f(e,["speechConfig"],C);let S=h(s,["stopSequences"]);S!=null&&f(e,["stopSequences"],S);let b=h(s,["temperature"]);b!=null&&f(e,["temperature"],b);let x=h(s,["thinkingConfig"]);x!=null&&f(e,["thinkingConfig"],x);let P=h(s,["topK"]);P!=null&&f(e,["topK"],P);let I=h(s,["topP"]);if(I!=null&&f(e,["topP"],I),h(s,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function iS(s){let e={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=h(s,["enableWidget"]);return t!=null&&f(e,["enableWidget"],t),e}function sS(s){let e={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=h(s,["timeRangeFilter"]);return t!=null&&f(e,["timeRangeFilter"],t),e}function oS(s,e){let t={},n=h(s,["generationConfig"]);e!==void 0&&n!=null&&f(e,["setup","generationConfig"],n);let i=h(s,["responseModalities"]);e!==void 0&&i!=null&&f(e,["setup","generationConfig","responseModalities"],i);let o=h(s,["temperature"]);e!==void 0&&o!=null&&f(e,["setup","generationConfig","temperature"],o);let r=h(s,["topP"]);e!==void 0&&r!=null&&f(e,["setup","generationConfig","topP"],r);let a=h(s,["topK"]);e!==void 0&&a!=null&&f(e,["setup","generationConfig","topK"],a);let l=h(s,["maxOutputTokens"]);e!==void 0&&l!=null&&f(e,["setup","generationConfig","maxOutputTokens"],l);let c=h(s,["mediaResolution"]);e!==void 0&&c!=null&&f(e,["setup","generationConfig","mediaResolution"],c);let d=h(s,["seed"]);e!==void 0&&d!=null&&f(e,["setup","generationConfig","seed"],d);let p=h(s,["speechConfig"]);e!==void 0&&p!=null&&f(e,["setup","generationConfig","speechConfig"],pm(p));let g=h(s,["thinkingConfig"]);e!==void 0&&g!=null&&f(e,["setup","generationConfig","thinkingConfig"],g);let m=h(s,["enableAffectiveDialog"]);e!==void 0&&m!=null&&f(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=h(s,["systemInstruction"]);e!==void 0&&y!=null&&f(e,["setup","systemInstruction"],QC(Ve(y)));let A=h(s,["tools"]);if(e!==void 0&&A!=null){let P=Zo(A);Array.isArray(P)&&(P=P.map(I=>mS(Xo(I)))),f(e,["setup","tools"],P)}let _=h(s,["sessionResumption"]);e!==void 0&&_!=null&&f(e,["setup","sessionResumption"],gS(_));let E=h(s,["inputAudioTranscription"]);e!==void 0&&E!=null&&f(e,["setup","inputAudioTranscription"],E);let C=h(s,["outputAudioTranscription"]);e!==void 0&&C!=null&&f(e,["setup","outputAudioTranscription"],C);let S=h(s,["realtimeInputConfig"]);e!==void 0&&S!=null&&f(e,["setup","realtimeInputConfig"],S);let b=h(s,["contextWindowCompression"]);e!==void 0&&b!=null&&f(e,["setup","contextWindowCompression"],b);let x=h(s,["proactivity"]);if(e!==void 0&&x!=null&&f(e,["setup","proactivity"],x),h(s,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function rS(s,e){let t={},n=h(s,["generationConfig"]);e!==void 0&&n!=null&&f(e,["setup","generationConfig"],nS(n));let i=h(s,["responseModalities"]);e!==void 0&&i!=null&&f(e,["setup","generationConfig","responseModalities"],i);let o=h(s,["temperature"]);e!==void 0&&o!=null&&f(e,["setup","generationConfig","temperature"],o);let r=h(s,["topP"]);e!==void 0&&r!=null&&f(e,["setup","generationConfig","topP"],r);let a=h(s,["topK"]);e!==void 0&&a!=null&&f(e,["setup","generationConfig","topK"],a);let l=h(s,["maxOutputTokens"]);e!==void 0&&l!=null&&f(e,["setup","generationConfig","maxOutputTokens"],l);let c=h(s,["mediaResolution"]);e!==void 0&&c!=null&&f(e,["setup","generationConfig","mediaResolution"],c);let d=h(s,["seed"]);e!==void 0&&d!=null&&f(e,["setup","generationConfig","seed"],d);let p=h(s,["speechConfig"]);e!==void 0&&p!=null&&f(e,["setup","generationConfig","speechConfig"],pm(p));let g=h(s,["thinkingConfig"]);e!==void 0&&g!=null&&f(e,["setup","generationConfig","thinkingConfig"],g);let m=h(s,["enableAffectiveDialog"]);e!==void 0&&m!=null&&f(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=h(s,["systemInstruction"]);e!==void 0&&y!=null&&f(e,["setup","systemInstruction"],Ve(y));let A=h(s,["tools"]);if(e!==void 0&&A!=null){let I=Zo(A);Array.isArray(I)&&(I=I.map(N=>yS(Xo(N)))),f(e,["setup","tools"],I)}let _=h(s,["sessionResumption"]);e!==void 0&&_!=null&&f(e,["setup","sessionResumption"],_);let E=h(s,["inputAudioTranscription"]);e!==void 0&&E!=null&&f(e,["setup","inputAudioTranscription"],E);let C=h(s,["outputAudioTranscription"]);e!==void 0&&C!=null&&f(e,["setup","outputAudioTranscription"],C);let S=h(s,["realtimeInputConfig"]);e!==void 0&&S!=null&&f(e,["setup","realtimeInputConfig"],S);let b=h(s,["contextWindowCompression"]);e!==void 0&&b!=null&&f(e,["setup","contextWindowCompression"],b);let x=h(s,["proactivity"]);e!==void 0&&x!=null&&f(e,["setup","proactivity"],x);let P=h(s,["explicitVadSignal"]);return e!==void 0&&P!=null&&f(e,["setup","explicitVadSignal"],P),t}function aS(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["setup","model"],ne(s,n));let i=h(e,["config"]);return i!=null&&f(t,["config"],oS(i,t)),t}function lS(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["setup","model"],ne(s,n));let i=h(e,["config"]);return i!=null&&f(t,["config"],rS(i,t)),t}function cS(s){let e={},t=h(s,["musicGenerationConfig"]);return t!=null&&f(e,["musicGenerationConfig"],t),e}function uS(s){let e={},t=h(s,["weightedPrompts"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(i=>i)),f(e,["weightedPrompts"],n)}return e}function dS(s){let e={},t=h(s,["media"]);if(t!=null){let c=GA(t);Array.isArray(c)&&(c=c.map(d=>sd(d))),f(e,["mediaChunks"],c)}let n=h(s,["audio"]);n!=null&&f(e,["audio"],sd(HA(n)));let i=h(s,["audioStreamEnd"]);i!=null&&f(e,["audioStreamEnd"],i);let o=h(s,["video"]);o!=null&&f(e,["video"],sd(BA(o)));let r=h(s,["text"]);r!=null&&f(e,["text"],r);let a=h(s,["activityStart"]);a!=null&&f(e,["activityStart"],a);let l=h(s,["activityEnd"]);return l!=null&&f(e,["activityEnd"],l),e}function hS(s){let e={},t=h(s,["media"]);if(t!=null){let c=GA(t);Array.isArray(c)&&(c=c.map(d=>d)),f(e,["mediaChunks"],c)}let n=h(s,["audio"]);n!=null&&f(e,["audio"],HA(n));let i=h(s,["audioStreamEnd"]);i!=null&&f(e,["audioStreamEnd"],i);let o=h(s,["video"]);o!=null&&f(e,["video"],BA(o));let r=h(s,["text"]);r!=null&&f(e,["text"],r);let a=h(s,["activityStart"]);a!=null&&f(e,["activityStart"],a);let l=h(s,["activityEnd"]);return l!=null&&f(e,["activityEnd"],l),e}function fS(s){let e={},t=h(s,["setupComplete"]);t!=null&&f(e,["setupComplete"],t);let n=h(s,["serverContent"]);n!=null&&f(e,["serverContent"],n);let i=h(s,["toolCall"]);i!=null&&f(e,["toolCall"],i);let o=h(s,["toolCallCancellation"]);o!=null&&f(e,["toolCallCancellation"],o);let r=h(s,["usageMetadata"]);r!=null&&f(e,["usageMetadata"],vS(r));let a=h(s,["goAway"]);a!=null&&f(e,["goAway"],a);let l=h(s,["sessionResumptionUpdate"]);l!=null&&f(e,["sessionResumptionUpdate"],l);let c=h(s,["voiceActivityDetectionSignal"]);return c!=null&&f(e,["voiceActivityDetectionSignal"],c),e}function pS(s){let e={},t=h(s,["mediaResolution"]);t!=null&&f(e,["mediaResolution"],t);let n=h(s,["codeExecutionResult"]);n!=null&&f(e,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(e,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(e,["fileData"],jC(o));let r=h(s,["functionCall"]);r!=null&&f(e,["functionCall"],eS(r));let a=h(s,["functionResponse"]);a!=null&&f(e,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(e,["inlineData"],sd(l));let c=h(s,["text"]);c!=null&&f(e,["text"],c);let d=h(s,["thought"]);d!=null&&f(e,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(e,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(e,["videoMetadata"],g),e}function gS(s){let e={},t=h(s,["handle"]);if(t!=null&&f(e,["handle"],t),h(s,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function mS(s){let e={},t=h(s,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(p=>p)),f(e,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(e,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(e,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(e,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(e,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(e,["googleMaps"],iS(a));let l=h(s,["googleSearch"]);l!=null&&f(e,["googleSearch"],sS(l));let c=h(s,["urlContext"]);return c!=null&&f(e,["urlContext"],c),e}function yS(s){let e={},t=h(s,["functionDeclarations"]);if(t!=null){let p=t;Array.isArray(p)&&(p=p.map(g=>tS(g))),f(e,["functionDeclarations"],p)}let n=h(s,["retrieval"]);n!=null&&f(e,["retrieval"],n);let i=h(s,["googleSearchRetrieval"]);i!=null&&f(e,["googleSearchRetrieval"],i);let o=h(s,["computerUse"]);if(o!=null&&f(e,["computerUse"],o),h(s,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=h(s,["codeExecution"]);r!=null&&f(e,["codeExecution"],r);let a=h(s,["enterpriseWebSearch"]);a!=null&&f(e,["enterpriseWebSearch"],a);let l=h(s,["googleMaps"]);l!=null&&f(e,["googleMaps"],l);let c=h(s,["googleSearch"]);c!=null&&f(e,["googleSearch"],c);let d=h(s,["urlContext"]);return d!=null&&f(e,["urlContext"],d),e}function vS(s){let e={},t=h(s,["promptTokenCount"]);t!=null&&f(e,["promptTokenCount"],t);let n=h(s,["cachedContentTokenCount"]);n!=null&&f(e,["cachedContentTokenCount"],n);let i=h(s,["candidatesTokenCount"]);i!=null&&f(e,["responseTokenCount"],i);let o=h(s,["toolUsePromptTokenCount"]);o!=null&&f(e,["toolUsePromptTokenCount"],o);let r=h(s,["thoughtsTokenCount"]);r!=null&&f(e,["thoughtsTokenCount"],r);let a=h(s,["totalTokenCount"]);a!=null&&f(e,["totalTokenCount"],a);let l=h(s,["promptTokensDetails"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(y=>y)),f(e,["promptTokensDetails"],m)}let c=h(s,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(y=>y)),f(e,["cacheTokensDetails"],m)}let d=h(s,["candidatesTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(y=>y)),f(e,["responseTokensDetails"],m)}let p=h(s,["toolUsePromptTokensDetails"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(y=>y)),f(e,["toolUsePromptTokensDetails"],m)}let g=h(s,["trafficType"]);return g!=null&&f(e,["trafficType"],g),e}function wS(s){let e={},t=h(s,["data"]);if(t!=null&&f(e,["data"],t),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(e,["mimeType"],n),e}function AS(s){let e={},t=h(s,["content"]);t!=null&&f(e,["content"],t);let n=h(s,["citationMetadata"]);n!=null&&f(e,["citationMetadata"],_S(n));let i=h(s,["tokenCount"]);i!=null&&f(e,["tokenCount"],i);let o=h(s,["finishReason"]);o!=null&&f(e,["finishReason"],o);let r=h(s,["avgLogprobs"]);r!=null&&f(e,["avgLogprobs"],r);let a=h(s,["groundingMetadata"]);a!=null&&f(e,["groundingMetadata"],a);let l=h(s,["index"]);l!=null&&f(e,["index"],l);let c=h(s,["logprobsResult"]);c!=null&&f(e,["logprobsResult"],c);let d=h(s,["safetyRatings"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(m=>m)),f(e,["safetyRatings"],g)}let p=h(s,["urlContextMetadata"]);return p!=null&&f(e,["urlContextMetadata"],p),e}function _S(s){let e={},t=h(s,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(i=>i)),f(e,["citations"],n)}return e}function TS(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["contents"]);if(i!=null){let o=Nt(i);Array.isArray(o)&&(o=o.map(r=>r)),f(t,["contents"],o)}return t}function ES(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["tokensInfo"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>o)),f(e,["tokensInfo"],i)}return e}function CS(s){let e={},t=h(s,["values"]);t!=null&&f(e,["values"],t);let n=h(s,["statistics"]);return n!=null&&f(e,["statistics"],SS(n)),e}function SS(s){let e={},t=h(s,["truncated"]);t!=null&&f(e,["truncated"],t);let n=h(s,["token_count"]);return n!=null&&f(e,["tokenCount"],n),e}function Ld(s){let e={},t=h(s,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Db(o))),f(e,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(e,["role"],n),e}function bS(s){let e={},t=h(s,["controlType"]);t!=null&&f(e,["controlType"],t);let n=h(s,["enableControlImageComputation"]);return n!=null&&f(e,["computeControl"],n),e}function xS(s){let e={};if(h(s,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(h(s,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(h(s,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function IS(s,e){let t={},n=h(s,["systemInstruction"]);e!==void 0&&n!=null&&f(e,["systemInstruction"],Ve(n));let i=h(s,["tools"]);if(e!==void 0&&i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>n_(a))),f(e,["tools"],r)}let o=h(s,["generationConfig"]);return e!==void 0&&o!=null&&f(e,["generationConfig"],wb(o)),t}function RS(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["contents"]);if(i!=null){let r=Nt(i);Array.isArray(r)&&(r=r.map(a=>Ld(a))),f(t,["contents"],r)}let o=h(e,["config"]);return o!=null&&xS(o),t}function PS(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["contents"]);if(i!=null){let r=Nt(i);Array.isArray(r)&&(r=r.map(a=>a)),f(t,["contents"],r)}let o=h(e,["config"]);return o!=null&&IS(o,t),t}function MS(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["totalTokens"]);n!=null&&f(e,["totalTokens"],n);let i=h(s,["cachedContentTokenCount"]);return i!=null&&f(e,["cachedContentTokenCount"],i),e}function NS(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["totalTokens"]);return n!=null&&f(e,["totalTokens"],n),e}function kS(s,e){let t={},n=h(e,["model"]);return n!=null&&f(t,["_url","name"],ne(s,n)),t}function DS(s,e){let t={},n=h(e,["model"]);return n!=null&&f(t,["_url","name"],ne(s,n)),t}function FS(s){let e={},t=h(s,["sdkHttpResponse"]);return t!=null&&f(e,["sdkHttpResponse"],t),e}function LS(s){let e={},t=h(s,["sdkHttpResponse"]);return t!=null&&f(e,["sdkHttpResponse"],t),e}function US(s,e){let t={},n=h(s,["outputGcsUri"]);e!==void 0&&n!=null&&f(e,["parameters","storageUri"],n);let i=h(s,["negativePrompt"]);e!==void 0&&i!=null&&f(e,["parameters","negativePrompt"],i);let o=h(s,["numberOfImages"]);e!==void 0&&o!=null&&f(e,["parameters","sampleCount"],o);let r=h(s,["aspectRatio"]);e!==void 0&&r!=null&&f(e,["parameters","aspectRatio"],r);let a=h(s,["guidanceScale"]);e!==void 0&&a!=null&&f(e,["parameters","guidanceScale"],a);let l=h(s,["seed"]);e!==void 0&&l!=null&&f(e,["parameters","seed"],l);let c=h(s,["safetyFilterLevel"]);e!==void 0&&c!=null&&f(e,["parameters","safetySetting"],c);let d=h(s,["personGeneration"]);e!==void 0&&d!=null&&f(e,["parameters","personGeneration"],d);let p=h(s,["includeSafetyAttributes"]);e!==void 0&&p!=null&&f(e,["parameters","includeSafetyAttributes"],p);let g=h(s,["includeRaiReason"]);e!==void 0&&g!=null&&f(e,["parameters","includeRaiReason"],g);let m=h(s,["language"]);e!==void 0&&m!=null&&f(e,["parameters","language"],m);let y=h(s,["outputMimeType"]);e!==void 0&&y!=null&&f(e,["parameters","outputOptions","mimeType"],y);let A=h(s,["outputCompressionQuality"]);e!==void 0&&A!=null&&f(e,["parameters","outputOptions","compressionQuality"],A);let _=h(s,["addWatermark"]);e!==void 0&&_!=null&&f(e,["parameters","addWatermark"],_);let E=h(s,["labels"]);e!==void 0&&E!=null&&f(e,["labels"],E);let C=h(s,["editMode"]);e!==void 0&&C!=null&&f(e,["parameters","editMode"],C);let S=h(s,["baseSteps"]);return e!==void 0&&S!=null&&f(e,["parameters","editConfig","baseSteps"],S),t}function OS(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["prompt"]);i!=null&&f(t,["instances[0]","prompt"],i);let o=h(e,["referenceImages"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>Gb(l))),f(t,["instances[0]","referenceImages"],a)}let r=h(e,["config"]);return r!=null&&US(r,t),t}function $S(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Ud(o))),f(e,["generatedImages"],i)}return e}function GS(s,e){let t={},n=h(s,["taskType"]);e!==void 0&&n!=null&&f(e,["requests[]","taskType"],n);let i=h(s,["title"]);e!==void 0&&i!=null&&f(e,["requests[]","title"],i);let o=h(s,["outputDimensionality"]);if(e!==void 0&&o!=null&&f(e,["requests[]","outputDimensionality"],o),h(s,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(h(s,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function BS(s,e){let t={},n=h(s,["taskType"]);e!==void 0&&n!=null&&f(e,["instances[]","task_type"],n);let i=h(s,["title"]);e!==void 0&&i!=null&&f(e,["instances[]","title"],i);let o=h(s,["outputDimensionality"]);e!==void 0&&o!=null&&f(e,["parameters","outputDimensionality"],o);let r=h(s,["mimeType"]);e!==void 0&&r!=null&&f(e,["instances[]","mimeType"],r);let a=h(s,["autoTruncate"]);return e!==void 0&&a!=null&&f(e,["parameters","autoTruncate"],a),t}function HS(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["contents"]);if(i!=null){let a=dm(s,i);Array.isArray(a)&&(a=a.map(l=>l)),f(t,["requests[]","content"],a)}let o=h(e,["config"]);o!=null&&GS(o,t);let r=h(e,["model"]);return r!==void 0&&f(t,["requests[]","model"],ne(s,r)),t}function VS(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["contents"]);if(i!=null){let r=dm(s,i);Array.isArray(r)&&(r=r.map(a=>a)),f(t,["instances[]","content"],r)}let o=h(e,["config"]);return o!=null&&BS(o,t),t}function qS(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>r)),f(e,["embeddings"],o)}let i=h(s,["metadata"]);return i!=null&&f(e,["metadata"],i),e}function zS(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["predictions[]","embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>CS(r))),f(e,["embeddings"],o)}let i=h(s,["metadata"]);return i!=null&&f(e,["metadata"],i),e}function WS(s){let e={},t=h(s,["endpoint"]);t!=null&&f(e,["name"],t);let n=h(s,["deployedModelId"]);return n!=null&&f(e,["deployedModelId"],n),e}function KS(s){let e={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=h(s,["fileUri"]);t!=null&&f(e,["fileUri"],t);let n=h(s,["mimeType"]);return n!=null&&f(e,["mimeType"],n),e}function YS(s){let e={},t=h(s,["id"]);t!=null&&f(e,["id"],t);let n=h(s,["args"]);n!=null&&f(e,["args"],n);let i=h(s,["name"]);if(i!=null&&f(e,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function JS(s){let e={},t=h(s,["mode"]);t!=null&&f(e,["mode"],t);let n=h(s,["allowedFunctionNames"]);if(n!=null&&f(e,["allowedFunctionNames"],n),h(s,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function XS(s){let e={};if(h(s,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=h(s,["description"]);t!=null&&f(e,["description"],t);let n=h(s,["name"]);n!=null&&f(e,["name"],n);let i=h(s,["parameters"]);i!=null&&f(e,["parameters"],i);let o=h(s,["parametersJsonSchema"]);o!=null&&f(e,["parametersJsonSchema"],o);let r=h(s,["response"]);r!=null&&f(e,["response"],r);let a=h(s,["responseJsonSchema"]);return a!=null&&f(e,["responseJsonSchema"],a),e}function ZS(s,e,t){let n={},i=h(e,["systemInstruction"]);t!==void 0&&i!=null&&f(t,["systemInstruction"],Ld(Ve(i)));let o=h(e,["temperature"]);o!=null&&f(n,["temperature"],o);let r=h(e,["topP"]);r!=null&&f(n,["topP"],r);let a=h(e,["topK"]);a!=null&&f(n,["topK"],a);let l=h(e,["candidateCount"]);l!=null&&f(n,["candidateCount"],l);let c=h(e,["maxOutputTokens"]);c!=null&&f(n,["maxOutputTokens"],c);let d=h(e,["stopSequences"]);d!=null&&f(n,["stopSequences"],d);let p=h(e,["responseLogprobs"]);p!=null&&f(n,["responseLogprobs"],p);let g=h(e,["logprobs"]);g!=null&&f(n,["logprobs"],g);let m=h(e,["presencePenalty"]);m!=null&&f(n,["presencePenalty"],m);let y=h(e,["frequencyPenalty"]);y!=null&&f(n,["frequencyPenalty"],y);let A=h(e,["seed"]);A!=null&&f(n,["seed"],A);let _=h(e,["responseMimeType"]);_!=null&&f(n,["responseMimeType"],_);let E=h(e,["responseSchema"]);E!=null&&f(n,["responseSchema"],hm(E));let C=h(e,["responseJsonSchema"]);if(C!=null&&f(n,["responseJsonSchema"],C),h(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(h(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let S=h(e,["safetySettings"]);if(t!==void 0&&S!=null){let z=S;Array.isArray(z)&&(z=z.map(W=>Bb(W))),f(t,["safetySettings"],z)}let b=h(e,["tools"]);if(t!==void 0&&b!=null){let z=Zo(b);Array.isArray(z)&&(z=z.map(W=>Yb(Xo(W)))),f(t,["tools"],z)}let x=h(e,["toolConfig"]);if(t!==void 0&&x!=null&&f(t,["toolConfig"],Kb(x)),h(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let P=h(e,["cachedContent"]);t!==void 0&&P!=null&&f(t,["cachedContent"],Gn(s,P));let I=h(e,["responseModalities"]);I!=null&&f(n,["responseModalities"],I);let N=h(e,["mediaResolution"]);N!=null&&f(n,["mediaResolution"],N);let M=h(e,["speechConfig"]);if(M!=null&&f(n,["speechConfig"],fm(M)),h(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=h(e,["thinkingConfig"]);F!=null&&f(n,["thinkingConfig"],F);let U=h(e,["imageConfig"]);U!=null&&f(n,["imageConfig"],Cb(U));let j=h(e,["enableEnhancedCivicAnswers"]);return j!=null&&f(n,["enableEnhancedCivicAnswers"],j),n}function QS(s,e,t){let n={},i=h(e,["systemInstruction"]);t!==void 0&&i!=null&&f(t,["systemInstruction"],Ve(i));let o=h(e,["temperature"]);o!=null&&f(n,["temperature"],o);let r=h(e,["topP"]);r!=null&&f(n,["topP"],r);let a=h(e,["topK"]);a!=null&&f(n,["topK"],a);let l=h(e,["candidateCount"]);l!=null&&f(n,["candidateCount"],l);let c=h(e,["maxOutputTokens"]);c!=null&&f(n,["maxOutputTokens"],c);let d=h(e,["stopSequences"]);d!=null&&f(n,["stopSequences"],d);let p=h(e,["responseLogprobs"]);p!=null&&f(n,["responseLogprobs"],p);let g=h(e,["logprobs"]);g!=null&&f(n,["logprobs"],g);let m=h(e,["presencePenalty"]);m!=null&&f(n,["presencePenalty"],m);let y=h(e,["frequencyPenalty"]);y!=null&&f(n,["frequencyPenalty"],y);let A=h(e,["seed"]);A!=null&&f(n,["seed"],A);let _=h(e,["responseMimeType"]);_!=null&&f(n,["responseMimeType"],_);let E=h(e,["responseSchema"]);E!=null&&f(n,["responseSchema"],hm(E));let C=h(e,["responseJsonSchema"]);C!=null&&f(n,["responseJsonSchema"],C);let S=h(e,["routingConfig"]);S!=null&&f(n,["routingConfig"],S);let b=h(e,["modelSelectionConfig"]);b!=null&&f(n,["modelConfig"],b);let x=h(e,["safetySettings"]);if(t!==void 0&&x!=null){let k=x;Array.isArray(k)&&(k=k.map(B=>B)),f(t,["safetySettings"],k)}let P=h(e,["tools"]);if(t!==void 0&&P!=null){let k=Zo(P);Array.isArray(k)&&(k=k.map(B=>n_(Xo(B)))),f(t,["tools"],k)}let I=h(e,["toolConfig"]);t!==void 0&&I!=null&&f(t,["toolConfig"],I);let N=h(e,["labels"]);t!==void 0&&N!=null&&f(t,["labels"],N);let M=h(e,["cachedContent"]);t!==void 0&&M!=null&&f(t,["cachedContent"],Gn(s,M));let F=h(e,["responseModalities"]);F!=null&&f(n,["responseModalities"],F);let U=h(e,["mediaResolution"]);U!=null&&f(n,["mediaResolution"],U);let j=h(e,["speechConfig"]);j!=null&&f(n,["speechConfig"],fm(j));let z=h(e,["audioTimestamp"]);z!=null&&f(n,["audioTimestamp"],z);let W=h(e,["thinkingConfig"]);W!=null&&f(n,["thinkingConfig"],W);let xe=h(e,["imageConfig"]);if(xe!=null&&f(n,["imageConfig"],Sb(xe)),h(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function AA(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["contents"]);if(i!=null){let r=Nt(i);Array.isArray(r)&&(r=r.map(a=>Ld(a))),f(t,["contents"],r)}let o=h(e,["config"]);return o!=null&&f(t,["generationConfig"],ZS(s,o,t)),t}function _A(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["contents"]);if(i!=null){let r=Nt(i);Array.isArray(r)&&(r=r.map(a=>a)),f(t,["contents"],r)}let o=h(e,["config"]);return o!=null&&f(t,["generationConfig"],QS(s,o,t)),t}function TA(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>AS(c))),f(e,["candidates"],l)}let i=h(s,["modelVersion"]);i!=null&&f(e,["modelVersion"],i);let o=h(s,["promptFeedback"]);o!=null&&f(e,["promptFeedback"],o);let r=h(s,["responseId"]);r!=null&&f(e,["responseId"],r);let a=h(s,["usageMetadata"]);return a!=null&&f(e,["usageMetadata"],a),e}function EA(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>d)),f(e,["candidates"],c)}let i=h(s,["createTime"]);i!=null&&f(e,["createTime"],i);let o=h(s,["modelVersion"]);o!=null&&f(e,["modelVersion"],o);let r=h(s,["promptFeedback"]);r!=null&&f(e,["promptFeedback"],r);let a=h(s,["responseId"]);a!=null&&f(e,["responseId"],a);let l=h(s,["usageMetadata"]);return l!=null&&f(e,["usageMetadata"],l),e}function jS(s,e){let t={};if(h(s,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(h(s,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let n=h(s,["numberOfImages"]);e!==void 0&&n!=null&&f(e,["parameters","sampleCount"],n);let i=h(s,["aspectRatio"]);e!==void 0&&i!=null&&f(e,["parameters","aspectRatio"],i);let o=h(s,["guidanceScale"]);if(e!==void 0&&o!=null&&f(e,["parameters","guidanceScale"],o),h(s,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let r=h(s,["safetyFilterLevel"]);e!==void 0&&r!=null&&f(e,["parameters","safetySetting"],r);let a=h(s,["personGeneration"]);e!==void 0&&a!=null&&f(e,["parameters","personGeneration"],a);let l=h(s,["includeSafetyAttributes"]);e!==void 0&&l!=null&&f(e,["parameters","includeSafetyAttributes"],l);let c=h(s,["includeRaiReason"]);e!==void 0&&c!=null&&f(e,["parameters","includeRaiReason"],c);let d=h(s,["language"]);e!==void 0&&d!=null&&f(e,["parameters","language"],d);let p=h(s,["outputMimeType"]);e!==void 0&&p!=null&&f(e,["parameters","outputOptions","mimeType"],p);let g=h(s,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&f(e,["parameters","outputOptions","compressionQuality"],g),h(s,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(h(s,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let m=h(s,["imageSize"]);if(e!==void 0&&m!=null&&f(e,["parameters","sampleImageSize"],m),h(s,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function eb(s,e){let t={},n=h(s,["outputGcsUri"]);e!==void 0&&n!=null&&f(e,["parameters","storageUri"],n);let i=h(s,["negativePrompt"]);e!==void 0&&i!=null&&f(e,["parameters","negativePrompt"],i);let o=h(s,["numberOfImages"]);e!==void 0&&o!=null&&f(e,["parameters","sampleCount"],o);let r=h(s,["aspectRatio"]);e!==void 0&&r!=null&&f(e,["parameters","aspectRatio"],r);let a=h(s,["guidanceScale"]);e!==void 0&&a!=null&&f(e,["parameters","guidanceScale"],a);let l=h(s,["seed"]);e!==void 0&&l!=null&&f(e,["parameters","seed"],l);let c=h(s,["safetyFilterLevel"]);e!==void 0&&c!=null&&f(e,["parameters","safetySetting"],c);let d=h(s,["personGeneration"]);e!==void 0&&d!=null&&f(e,["parameters","personGeneration"],d);let p=h(s,["includeSafetyAttributes"]);e!==void 0&&p!=null&&f(e,["parameters","includeSafetyAttributes"],p);let g=h(s,["includeRaiReason"]);e!==void 0&&g!=null&&f(e,["parameters","includeRaiReason"],g);let m=h(s,["language"]);e!==void 0&&m!=null&&f(e,["parameters","language"],m);let y=h(s,["outputMimeType"]);e!==void 0&&y!=null&&f(e,["parameters","outputOptions","mimeType"],y);let A=h(s,["outputCompressionQuality"]);e!==void 0&&A!=null&&f(e,["parameters","outputOptions","compressionQuality"],A);let _=h(s,["addWatermark"]);e!==void 0&&_!=null&&f(e,["parameters","addWatermark"],_);let E=h(s,["labels"]);e!==void 0&&E!=null&&f(e,["labels"],E);let C=h(s,["imageSize"]);e!==void 0&&C!=null&&f(e,["parameters","sampleImageSize"],C);let S=h(s,["enhancePrompt"]);return e!==void 0&&S!=null&&f(e,["parameters","enhancePrompt"],S),t}function tb(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["prompt"]);i!=null&&f(t,["instances[0]","prompt"],i);let o=h(e,["config"]);return o!=null&&jS(o,t),t}function nb(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["prompt"]);i!=null&&f(t,["instances[0]","prompt"],i);let o=h(e,["config"]);return o!=null&&eb(o,t),t}function ib(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>gb(r))),f(e,["generatedImages"],o)}let i=h(s,["positivePromptSafetyAttributes"]);return i!=null&&f(e,["positivePromptSafetyAttributes"],e_(i)),e}function sb(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Ud(r))),f(e,["generatedImages"],o)}let i=h(s,["positivePromptSafetyAttributes"]);return i!=null&&f(e,["positivePromptSafetyAttributes"],t_(i)),e}function ob(s,e){let t={},n=h(s,["numberOfVideos"]);if(e!==void 0&&n!=null&&f(e,["parameters","sampleCount"],n),h(s,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(h(s,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let i=h(s,["durationSeconds"]);if(e!==void 0&&i!=null&&f(e,["parameters","durationSeconds"],i),h(s,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=h(s,["aspectRatio"]);e!==void 0&&o!=null&&f(e,["parameters","aspectRatio"],o);let r=h(s,["resolution"]);e!==void 0&&r!=null&&f(e,["parameters","resolution"],r);let a=h(s,["personGeneration"]);if(e!==void 0&&a!=null&&f(e,["parameters","personGeneration"],a),h(s,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let l=h(s,["negativePrompt"]);e!==void 0&&l!=null&&f(e,["parameters","negativePrompt"],l);let c=h(s,["enhancePrompt"]);if(e!==void 0&&c!=null&&f(e,["parameters","enhancePrompt"],c),h(s,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let d=h(s,["lastFrame"]);e!==void 0&&d!=null&&f(e,["instances[0]","lastFrame"],Od(d));let p=h(s,["referenceImages"]);if(e!==void 0&&p!=null){let g=p;Array.isArray(g)&&(g=g.map(m=>ax(m))),f(e,["instances[0]","referenceImages"],g)}if(h(s,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(h(s,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function rb(s,e){let t={},n=h(s,["numberOfVideos"]);e!==void 0&&n!=null&&f(e,["parameters","sampleCount"],n);let i=h(s,["outputGcsUri"]);e!==void 0&&i!=null&&f(e,["parameters","storageUri"],i);let o=h(s,["fps"]);e!==void 0&&o!=null&&f(e,["parameters","fps"],o);let r=h(s,["durationSeconds"]);e!==void 0&&r!=null&&f(e,["parameters","durationSeconds"],r);let a=h(s,["seed"]);e!==void 0&&a!=null&&f(e,["parameters","seed"],a);let l=h(s,["aspectRatio"]);e!==void 0&&l!=null&&f(e,["parameters","aspectRatio"],l);let c=h(s,["resolution"]);e!==void 0&&c!=null&&f(e,["parameters","resolution"],c);let d=h(s,["personGeneration"]);e!==void 0&&d!=null&&f(e,["parameters","personGeneration"],d);let p=h(s,["pubsubTopic"]);e!==void 0&&p!=null&&f(e,["parameters","pubsubTopic"],p);let g=h(s,["negativePrompt"]);e!==void 0&&g!=null&&f(e,["parameters","negativePrompt"],g);let m=h(s,["enhancePrompt"]);e!==void 0&&m!=null&&f(e,["parameters","enhancePrompt"],m);let y=h(s,["generateAudio"]);e!==void 0&&y!=null&&f(e,["parameters","generateAudio"],y);let A=h(s,["lastFrame"]);e!==void 0&&A!=null&&f(e,["instances[0]","lastFrame"],Kt(A));let _=h(s,["referenceImages"]);if(e!==void 0&&_!=null){let S=_;Array.isArray(S)&&(S=S.map(b=>lx(b))),f(e,["instances[0]","referenceImages"],S)}let E=h(s,["mask"]);e!==void 0&&E!=null&&f(e,["instances[0]","mask"],rx(E));let C=h(s,["compressionQuality"]);return e!==void 0&&C!=null&&f(e,["parameters","compressionQuality"],C),t}function ab(s){let e={},t=h(s,["name"]);t!=null&&f(e,["name"],t);let n=h(s,["metadata"]);n!=null&&f(e,["metadata"],n);let i=h(s,["done"]);i!=null&&f(e,["done"],i);let o=h(s,["error"]);o!=null&&f(e,["error"],o);let r=h(s,["response","generateVideoResponse"]);return r!=null&&f(e,["response"],db(r)),e}function lb(s){let e={},t=h(s,["name"]);t!=null&&f(e,["name"],t);let n=h(s,["metadata"]);n!=null&&f(e,["metadata"],n);let i=h(s,["done"]);i!=null&&f(e,["done"],i);let o=h(s,["error"]);o!=null&&f(e,["error"],o);let r=h(s,["response"]);return r!=null&&f(e,["response"],hb(r)),e}function cb(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["prompt"]);i!=null&&f(t,["instances[0]","prompt"],i);let o=h(e,["image"]);o!=null&&f(t,["instances[0]","image"],Od(o));let r=h(e,["video"]);r!=null&&f(t,["instances[0]","video"],i_(r));let a=h(e,["source"]);a!=null&&fb(a,t);let l=h(e,["config"]);return l!=null&&ob(l,t),t}function ub(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["prompt"]);i!=null&&f(t,["instances[0]","prompt"],i);let o=h(e,["image"]);o!=null&&f(t,["instances[0]","image"],Kt(o));let r=h(e,["video"]);r!=null&&f(t,["instances[0]","video"],s_(r));let a=h(e,["source"]);a!=null&&pb(a,t);let l=h(e,["config"]);return l!=null&&rb(l,t),t}function db(s){let e={},t=h(s,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>yb(r))),f(e,["generatedVideos"],o)}let n=h(s,["raiMediaFilteredCount"]);n!=null&&f(e,["raiMediaFilteredCount"],n);let i=h(s,["raiMediaFilteredReasons"]);return i!=null&&f(e,["raiMediaFilteredReasons"],i),e}function hb(s){let e={},t=h(s,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>vb(r))),f(e,["generatedVideos"],o)}let n=h(s,["raiMediaFilteredCount"]);n!=null&&f(e,["raiMediaFilteredCount"],n);let i=h(s,["raiMediaFilteredReasons"]);return i!=null&&f(e,["raiMediaFilteredReasons"],i),e}function fb(s,e){let t={},n=h(s,["prompt"]);e!==void 0&&n!=null&&f(e,["instances[0]","prompt"],n);let i=h(s,["image"]);e!==void 0&&i!=null&&f(e,["instances[0]","image"],Od(i));let o=h(s,["video"]);return e!==void 0&&o!=null&&f(e,["instances[0]","video"],i_(o)),t}function pb(s,e){let t={},n=h(s,["prompt"]);e!==void 0&&n!=null&&f(e,["instances[0]","prompt"],n);let i=h(s,["image"]);e!==void 0&&i!=null&&f(e,["instances[0]","image"],Kt(i));let o=h(s,["video"]);return e!==void 0&&o!=null&&f(e,["instances[0]","video"],s_(o)),t}function gb(s){let e={},t=h(s,["_self"]);t!=null&&f(e,["image"],bb(t));let n=h(s,["raiFilteredReason"]);n!=null&&f(e,["raiFilteredReason"],n);let i=h(s,["_self"]);return i!=null&&f(e,["safetyAttributes"],e_(i)),e}function Ud(s){let e={},t=h(s,["_self"]);t!=null&&f(e,["image"],jA(t));let n=h(s,["raiFilteredReason"]);n!=null&&f(e,["raiFilteredReason"],n);let i=h(s,["_self"]);i!=null&&f(e,["safetyAttributes"],t_(i));let o=h(s,["prompt"]);return o!=null&&f(e,["enhancedPrompt"],o),e}function mb(s){let e={},t=h(s,["_self"]);t!=null&&f(e,["mask"],jA(t));let n=h(s,["labels"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>o)),f(e,["labels"],i)}return e}function yb(s){let e={},t=h(s,["video"]);return t!=null&&f(e,["video"],sx(t)),e}function vb(s){let e={},t=h(s,["_self"]);return t!=null&&f(e,["video"],ox(t)),e}function wb(s){let e={},t=h(s,["modelSelectionConfig"]);t!=null&&f(e,["modelConfig"],t);let n=h(s,["responseJsonSchema"]);n!=null&&f(e,["responseJsonSchema"],n);let i=h(s,["audioTimestamp"]);i!=null&&f(e,["audioTimestamp"],i);let o=h(s,["candidateCount"]);o!=null&&f(e,["candidateCount"],o);let r=h(s,["enableAffectiveDialog"]);r!=null&&f(e,["enableAffectiveDialog"],r);let a=h(s,["frequencyPenalty"]);a!=null&&f(e,["frequencyPenalty"],a);let l=h(s,["logprobs"]);l!=null&&f(e,["logprobs"],l);let c=h(s,["maxOutputTokens"]);c!=null&&f(e,["maxOutputTokens"],c);let d=h(s,["mediaResolution"]);d!=null&&f(e,["mediaResolution"],d);let p=h(s,["presencePenalty"]);p!=null&&f(e,["presencePenalty"],p);let g=h(s,["responseLogprobs"]);g!=null&&f(e,["responseLogprobs"],g);let m=h(s,["responseMimeType"]);m!=null&&f(e,["responseMimeType"],m);let y=h(s,["responseModalities"]);y!=null&&f(e,["responseModalities"],y);let A=h(s,["responseSchema"]);A!=null&&f(e,["responseSchema"],A);let _=h(s,["routingConfig"]);_!=null&&f(e,["routingConfig"],_);let E=h(s,["seed"]);E!=null&&f(e,["seed"],E);let C=h(s,["speechConfig"]);C!=null&&f(e,["speechConfig"],C);let S=h(s,["stopSequences"]);S!=null&&f(e,["stopSequences"],S);let b=h(s,["temperature"]);b!=null&&f(e,["temperature"],b);let x=h(s,["thinkingConfig"]);x!=null&&f(e,["thinkingConfig"],x);let P=h(s,["topK"]);P!=null&&f(e,["topK"],P);let I=h(s,["topP"]);if(I!=null&&f(e,["topP"],I),h(s,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Ab(s,e){let t={},n=h(e,["model"]);return n!=null&&f(t,["_url","name"],ne(s,n)),t}function _b(s,e){let t={},n=h(e,["model"]);return n!=null&&f(t,["_url","name"],ne(s,n)),t}function Tb(s){let e={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=h(s,["enableWidget"]);return t!=null&&f(e,["enableWidget"],t),e}function Eb(s){let e={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=h(s,["timeRangeFilter"]);return t!=null&&f(e,["timeRangeFilter"],t),e}function Cb(s){let e={},t=h(s,["aspectRatio"]);t!=null&&f(e,["aspectRatio"],t);let n=h(s,["imageSize"]);if(n!=null&&f(e,["imageSize"],n),h(s,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(h(s,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Sb(s){let e={},t=h(s,["aspectRatio"]);t!=null&&f(e,["aspectRatio"],t);let n=h(s,["imageSize"]);n!=null&&f(e,["imageSize"],n);let i=h(s,["outputMimeType"]);i!=null&&f(e,["imageOutputOptions","mimeType"],i);let o=h(s,["outputCompressionQuality"]);return o!=null&&f(e,["imageOutputOptions","compressionQuality"],o),e}function bb(s){let e={},t=h(s,["bytesBase64Encoded"]);t!=null&&f(e,["imageBytes"],Ei(t));let n=h(s,["mimeType"]);return n!=null&&f(e,["mimeType"],n),e}function jA(s){let e={},t=h(s,["gcsUri"]);t!=null&&f(e,["gcsUri"],t);let n=h(s,["bytesBase64Encoded"]);n!=null&&f(e,["imageBytes"],Ei(n));let i=h(s,["mimeType"]);return i!=null&&f(e,["mimeType"],i),e}function Od(s){let e={};if(h(s,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=h(s,["imageBytes"]);t!=null&&f(e,["bytesBase64Encoded"],Ei(t));let n=h(s,["mimeType"]);return n!=null&&f(e,["mimeType"],n),e}function Kt(s){let e={},t=h(s,["gcsUri"]);t!=null&&f(e,["gcsUri"],t);let n=h(s,["imageBytes"]);n!=null&&f(e,["bytesBase64Encoded"],Ei(n));let i=h(s,["mimeType"]);return i!=null&&f(e,["mimeType"],i),e}function xb(s,e,t){let n={},i=h(e,["pageSize"]);t!==void 0&&i!=null&&f(t,["_query","pageSize"],i);let o=h(e,["pageToken"]);t!==void 0&&o!=null&&f(t,["_query","pageToken"],o);let r=h(e,["filter"]);t!==void 0&&r!=null&&f(t,["_query","filter"],r);let a=h(e,["queryBase"]);return t!==void 0&&a!=null&&f(t,["_url","models_url"],WA(s,a)),n}function Ib(s,e,t){let n={},i=h(e,["pageSize"]);t!==void 0&&i!=null&&f(t,["_query","pageSize"],i);let o=h(e,["pageToken"]);t!==void 0&&o!=null&&f(t,["_query","pageToken"],o);let r=h(e,["filter"]);t!==void 0&&r!=null&&f(t,["_query","filter"],r);let a=h(e,["queryBase"]);return t!==void 0&&a!=null&&f(t,["_url","models_url"],WA(s,a)),n}function Rb(s,e){let t={},n=h(e,["config"]);return n!=null&&xb(s,n,t),t}function Pb(s,e){let t={},n=h(e,["config"]);return n!=null&&Ib(s,n,t),t}function Mb(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["nextPageToken"]);n!=null&&f(e,["nextPageToken"],n);let i=h(s,["_self"]);if(i!=null){let o=KA(i);Array.isArray(o)&&(o=o.map(r=>Lg(r))),f(e,["models"],o)}return e}function Nb(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["nextPageToken"]);n!=null&&f(e,["nextPageToken"],n);let i=h(s,["_self"]);if(i!=null){let o=KA(i);Array.isArray(o)&&(o=o.map(r=>Ug(r))),f(e,["models"],o)}return e}function kb(s){let e={},t=h(s,["maskMode"]);t!=null&&f(e,["maskMode"],t);let n=h(s,["segmentationClasses"]);n!=null&&f(e,["maskClasses"],n);let i=h(s,["maskDilation"]);return i!=null&&f(e,["dilation"],i),e}function Lg(s){let e={},t=h(s,["name"]);t!=null&&f(e,["name"],t);let n=h(s,["displayName"]);n!=null&&f(e,["displayName"],n);let i=h(s,["description"]);i!=null&&f(e,["description"],i);let o=h(s,["version"]);o!=null&&f(e,["version"],o);let r=h(s,["_self"]);r!=null&&f(e,["tunedModelInfo"],Jb(r));let a=h(s,["inputTokenLimit"]);a!=null&&f(e,["inputTokenLimit"],a);let l=h(s,["outputTokenLimit"]);l!=null&&f(e,["outputTokenLimit"],l);let c=h(s,["supportedGenerationMethods"]);c!=null&&f(e,["supportedActions"],c);let d=h(s,["temperature"]);d!=null&&f(e,["temperature"],d);let p=h(s,["maxTemperature"]);p!=null&&f(e,["maxTemperature"],p);let g=h(s,["topP"]);g!=null&&f(e,["topP"],g);let m=h(s,["topK"]);m!=null&&f(e,["topK"],m);let y=h(s,["thinking"]);return y!=null&&f(e,["thinking"],y),e}function Ug(s){let e={},t=h(s,["name"]);t!=null&&f(e,["name"],t);let n=h(s,["displayName"]);n!=null&&f(e,["displayName"],n);let i=h(s,["description"]);i!=null&&f(e,["description"],i);let o=h(s,["versionId"]);o!=null&&f(e,["version"],o);let r=h(s,["deployedModels"]);if(r!=null){let p=r;Array.isArray(p)&&(p=p.map(g=>WS(g))),f(e,["endpoints"],p)}let a=h(s,["labels"]);a!=null&&f(e,["labels"],a);let l=h(s,["_self"]);l!=null&&f(e,["tunedModelInfo"],Xb(l));let c=h(s,["defaultCheckpointId"]);c!=null&&f(e,["defaultCheckpointId"],c);let d=h(s,["checkpoints"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(g=>g)),f(e,["checkpoints"],p)}return e}function Db(s){let e={},t=h(s,["mediaResolution"]);t!=null&&f(e,["mediaResolution"],t);let n=h(s,["codeExecutionResult"]);n!=null&&f(e,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(e,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(e,["fileData"],KS(o));let r=h(s,["functionCall"]);r!=null&&f(e,["functionCall"],YS(r));let a=h(s,["functionResponse"]);a!=null&&f(e,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(e,["inlineData"],wS(l));let c=h(s,["text"]);c!=null&&f(e,["text"],c);let d=h(s,["thought"]);d!=null&&f(e,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(e,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(e,["videoMetadata"],g),e}function Fb(s){let e={},t=h(s,["productImage"]);return t!=null&&f(e,["image"],Kt(t)),e}function Lb(s,e){let t={},n=h(s,["numberOfImages"]);e!==void 0&&n!=null&&f(e,["parameters","sampleCount"],n);let i=h(s,["baseSteps"]);e!==void 0&&i!=null&&f(e,["parameters","baseSteps"],i);let o=h(s,["outputGcsUri"]);e!==void 0&&o!=null&&f(e,["parameters","storageUri"],o);let r=h(s,["seed"]);e!==void 0&&r!=null&&f(e,["parameters","seed"],r);let a=h(s,["safetyFilterLevel"]);e!==void 0&&a!=null&&f(e,["parameters","safetySetting"],a);let l=h(s,["personGeneration"]);e!==void 0&&l!=null&&f(e,["parameters","personGeneration"],l);let c=h(s,["addWatermark"]);e!==void 0&&c!=null&&f(e,["parameters","addWatermark"],c);let d=h(s,["outputMimeType"]);e!==void 0&&d!=null&&f(e,["parameters","outputOptions","mimeType"],d);let p=h(s,["outputCompressionQuality"]);e!==void 0&&p!=null&&f(e,["parameters","outputOptions","compressionQuality"],p);let g=h(s,["enhancePrompt"]);e!==void 0&&g!=null&&f(e,["parameters","enhancePrompt"],g);let m=h(s,["labels"]);return e!==void 0&&m!=null&&f(e,["labels"],m),t}function Ub(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["source"]);i!=null&&$b(i,t);let o=h(e,["config"]);return o!=null&&Lb(o,t),t}function Ob(s){let e={},t=h(s,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(i=>Ud(i))),f(e,["generatedImages"],n)}return e}function $b(s,e){let t={},n=h(s,["prompt"]);e!==void 0&&n!=null&&f(e,["instances[0]","prompt"],n);let i=h(s,["personImage"]);e!==void 0&&i!=null&&f(e,["instances[0]","personImage","image"],Kt(i));let o=h(s,["productImages"]);if(e!==void 0&&o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>Fb(a))),f(e,["instances[0]","productImages"],r)}return t}function Gb(s){let e={},t=h(s,["referenceImage"]);t!=null&&f(e,["referenceImage"],Kt(t));let n=h(s,["referenceId"]);n!=null&&f(e,["referenceId"],n);let i=h(s,["referenceType"]);i!=null&&f(e,["referenceType"],i);let o=h(s,["maskImageConfig"]);o!=null&&f(e,["maskImageConfig"],kb(o));let r=h(s,["controlImageConfig"]);r!=null&&f(e,["controlImageConfig"],bS(r));let a=h(s,["styleImageConfig"]);a!=null&&f(e,["styleImageConfig"],a);let l=h(s,["subjectImageConfig"]);return l!=null&&f(e,["subjectImageConfig"],l),e}function e_(s){let e={},t=h(s,["safetyAttributes","categories"]);t!=null&&f(e,["categories"],t);let n=h(s,["safetyAttributes","scores"]);n!=null&&f(e,["scores"],n);let i=h(s,["contentType"]);return i!=null&&f(e,["contentType"],i),e}function t_(s){let e={},t=h(s,["safetyAttributes","categories"]);t!=null&&f(e,["categories"],t);let n=h(s,["safetyAttributes","scores"]);n!=null&&f(e,["scores"],n);let i=h(s,["contentType"]);return i!=null&&f(e,["contentType"],i),e}function Bb(s){let e={},t=h(s,["category"]);if(t!=null&&f(e,["category"],t),h(s,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=h(s,["threshold"]);return n!=null&&f(e,["threshold"],n),e}function Hb(s){let e={},t=h(s,["image"]);return t!=null&&f(e,["image"],Kt(t)),e}function Vb(s,e){let t={},n=h(s,["mode"]);e!==void 0&&n!=null&&f(e,["parameters","mode"],n);let i=h(s,["maxPredictions"]);e!==void 0&&i!=null&&f(e,["parameters","maxPredictions"],i);let o=h(s,["confidenceThreshold"]);e!==void 0&&o!=null&&f(e,["parameters","confidenceThreshold"],o);let r=h(s,["maskDilation"]);e!==void 0&&r!=null&&f(e,["parameters","maskDilation"],r);let a=h(s,["binaryColorThreshold"]);e!==void 0&&a!=null&&f(e,["parameters","binaryColorThreshold"],a);let l=h(s,["labels"]);return e!==void 0&&l!=null&&f(e,["labels"],l),t}function qb(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["source"]);i!=null&&Wb(i,t);let o=h(e,["config"]);return o!=null&&Vb(o,t),t}function zb(s){let e={},t=h(s,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(i=>mb(i))),f(e,["generatedMasks"],n)}return e}function Wb(s,e){let t={},n=h(s,["prompt"]);e!==void 0&&n!=null&&f(e,["instances[0]","prompt"],n);let i=h(s,["image"]);e!==void 0&&i!=null&&f(e,["instances[0]","image"],Kt(i));let o=h(s,["scribbleImage"]);return e!==void 0&&o!=null&&f(e,["instances[0]","scribble"],Hb(o)),t}function Kb(s){let e={},t=h(s,["functionCallingConfig"]);t!=null&&f(e,["functionCallingConfig"],JS(t));let n=h(s,["retrievalConfig"]);return n!=null&&f(e,["retrievalConfig"],n),e}function Yb(s){let e={},t=h(s,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(p=>p)),f(e,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(e,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(e,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(e,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(e,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(e,["googleMaps"],Tb(a));let l=h(s,["googleSearch"]);l!=null&&f(e,["googleSearch"],Eb(l));let c=h(s,["urlContext"]);return c!=null&&f(e,["urlContext"],c),e}function n_(s){let e={},t=h(s,["functionDeclarations"]);if(t!=null){let p=t;Array.isArray(p)&&(p=p.map(g=>XS(g))),f(e,["functionDeclarations"],p)}let n=h(s,["retrieval"]);n!=null&&f(e,["retrieval"],n);let i=h(s,["googleSearchRetrieval"]);i!=null&&f(e,["googleSearchRetrieval"],i);let o=h(s,["computerUse"]);if(o!=null&&f(e,["computerUse"],o),h(s,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=h(s,["codeExecution"]);r!=null&&f(e,["codeExecution"],r);let a=h(s,["enterpriseWebSearch"]);a!=null&&f(e,["enterpriseWebSearch"],a);let l=h(s,["googleMaps"]);l!=null&&f(e,["googleMaps"],l);let c=h(s,["googleSearch"]);c!=null&&f(e,["googleSearch"],c);let d=h(s,["urlContext"]);return d!=null&&f(e,["urlContext"],d),e}function Jb(s){let e={},t=h(s,["baseModel"]);t!=null&&f(e,["baseModel"],t);let n=h(s,["createTime"]);n!=null&&f(e,["createTime"],n);let i=h(s,["updateTime"]);return i!=null&&f(e,["updateTime"],i),e}function Xb(s){let e={},t=h(s,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&f(e,["baseModel"],t);let n=h(s,["createTime"]);n!=null&&f(e,["createTime"],n);let i=h(s,["updateTime"]);return i!=null&&f(e,["updateTime"],i),e}function Zb(s,e){let t={},n=h(s,["displayName"]);e!==void 0&&n!=null&&f(e,["displayName"],n);let i=h(s,["description"]);e!==void 0&&i!=null&&f(e,["description"],i);let o=h(s,["defaultCheckpointId"]);return e!==void 0&&o!=null&&f(e,["defaultCheckpointId"],o),t}function Qb(s,e){let t={},n=h(s,["displayName"]);e!==void 0&&n!=null&&f(e,["displayName"],n);let i=h(s,["description"]);e!==void 0&&i!=null&&f(e,["description"],i);let o=h(s,["defaultCheckpointId"]);return e!==void 0&&o!=null&&f(e,["defaultCheckpointId"],o),t}function jb(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","name"],ne(s,n));let i=h(e,["config"]);return i!=null&&Zb(i,t),t}function ex(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["config"]);return i!=null&&Qb(i,t),t}function tx(s,e){let t={},n=h(s,["outputGcsUri"]);e!==void 0&&n!=null&&f(e,["parameters","storageUri"],n);let i=h(s,["safetyFilterLevel"]);e!==void 0&&i!=null&&f(e,["parameters","safetySetting"],i);let o=h(s,["personGeneration"]);e!==void 0&&o!=null&&f(e,["parameters","personGeneration"],o);let r=h(s,["includeRaiReason"]);e!==void 0&&r!=null&&f(e,["parameters","includeRaiReason"],r);let a=h(s,["outputMimeType"]);e!==void 0&&a!=null&&f(e,["parameters","outputOptions","mimeType"],a);let l=h(s,["outputCompressionQuality"]);e!==void 0&&l!=null&&f(e,["parameters","outputOptions","compressionQuality"],l);let c=h(s,["enhanceInputImage"]);e!==void 0&&c!=null&&f(e,["parameters","upscaleConfig","enhanceInputImage"],c);let d=h(s,["imagePreservationFactor"]);e!==void 0&&d!=null&&f(e,["parameters","upscaleConfig","imagePreservationFactor"],d);let p=h(s,["labels"]);e!==void 0&&p!=null&&f(e,["labels"],p);let g=h(s,["numberOfImages"]);e!==void 0&&g!=null&&f(e,["parameters","sampleCount"],g);let m=h(s,["mode"]);return e!==void 0&&m!=null&&f(e,["parameters","mode"],m),t}function nx(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["_url","model"],ne(s,n));let i=h(e,["image"]);i!=null&&f(t,["instances[0]","image"],Kt(i));let o=h(e,["upscaleFactor"]);o!=null&&f(t,["parameters","upscaleConfig","upscaleFactor"],o);let r=h(e,["config"]);return r!=null&&tx(r,t),t}function ix(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Ud(o))),f(e,["generatedImages"],i)}return e}function sx(s){let e={},t=h(s,["uri"]);t!=null&&f(e,["uri"],t);let n=h(s,["encodedVideo"]);n!=null&&f(e,["videoBytes"],Ei(n));let i=h(s,["encoding"]);return i!=null&&f(e,["mimeType"],i),e}function ox(s){let e={},t=h(s,["gcsUri"]);t!=null&&f(e,["uri"],t);let n=h(s,["bytesBase64Encoded"]);n!=null&&f(e,["videoBytes"],Ei(n));let i=h(s,["mimeType"]);return i!=null&&f(e,["mimeType"],i),e}function rx(s){let e={},t=h(s,["image"]);t!=null&&f(e,["_self"],Kt(t));let n=h(s,["maskMode"]);return n!=null&&f(e,["maskMode"],n),e}function ax(s){let e={},t=h(s,["image"]);t!=null&&f(e,["image"],Od(t));let n=h(s,["referenceType"]);return n!=null&&f(e,["referenceType"],n),e}function lx(s){let e={},t=h(s,["image"]);t!=null&&f(e,["image"],Kt(t));let n=h(s,["referenceType"]);return n!=null&&f(e,["referenceType"],n),e}function i_(s){let e={},t=h(s,["uri"]);t!=null&&f(e,["uri"],t);let n=h(s,["videoBytes"]);n!=null&&f(e,["encodedVideo"],Ei(n));let i=h(s,["mimeType"]);return i!=null&&f(e,["encoding"],i),e}function s_(s){let e={},t=h(s,["uri"]);t!=null&&f(e,["gcsUri"],t);let n=h(s,["videoBytes"]);n!=null&&f(e,["bytesBase64Encoded"],Ei(n));let i=h(s,["mimeType"]);return i!=null&&f(e,["mimeType"],i),e}function cx(s,e){let t={},n=h(s,["displayName"]);return e!==void 0&&n!=null&&f(e,["displayName"],n),t}function ux(s){let e={},t=h(s,["config"]);return t!=null&&cx(t,e),e}function dx(s,e){let t={},n=h(s,["force"]);return e!==void 0&&n!=null&&f(e,["_query","force"],n),t}function hx(s){let e={},t=h(s,["name"]);t!=null&&f(e,["_url","name"],t);let n=h(s,["config"]);return n!=null&&dx(n,e),e}function fx(s){let e={},t=h(s,["name"]);return t!=null&&f(e,["_url","name"],t),e}function px(s,e){let t={},n=h(s,["customMetadata"]);if(e!==void 0&&n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>r)),f(e,["customMetadata"],o)}let i=h(s,["chunkingConfig"]);return e!==void 0&&i!=null&&f(e,["chunkingConfig"],i),t}function gx(s){let e={},t=h(s,["name"]);t!=null&&f(e,["name"],t);let n=h(s,["metadata"]);n!=null&&f(e,["metadata"],n);let i=h(s,["done"]);i!=null&&f(e,["done"],i);let o=h(s,["error"]);o!=null&&f(e,["error"],o);let r=h(s,["response"]);return r!=null&&f(e,["response"],yx(r)),e}function mx(s){let e={},t=h(s,["fileSearchStoreName"]);t!=null&&f(e,["_url","file_search_store_name"],t);let n=h(s,["fileName"]);n!=null&&f(e,["fileName"],n);let i=h(s,["config"]);return i!=null&&px(i,e),e}function yx(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["parent"]);n!=null&&f(e,["parent"],n);let i=h(s,["documentName"]);return i!=null&&f(e,["documentName"],i),e}function vx(s,e){let t={},n=h(s,["pageSize"]);e!==void 0&&n!=null&&f(e,["_query","pageSize"],n);let i=h(s,["pageToken"]);return e!==void 0&&i!=null&&f(e,["_query","pageToken"],i),t}function wx(s){let e={},t=h(s,["config"]);return t!=null&&vx(t,e),e}function Ax(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["nextPageToken"]);n!=null&&f(e,["nextPageToken"],n);let i=h(s,["fileSearchStores"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(e,["fileSearchStores"],o)}return e}function o_(s,e){let t={},n=h(s,["mimeType"]);e!==void 0&&n!=null&&f(e,["mimeType"],n);let i=h(s,["displayName"]);e!==void 0&&i!=null&&f(e,["displayName"],i);let o=h(s,["customMetadata"]);if(e!==void 0&&o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>l)),f(e,["customMetadata"],a)}let r=h(s,["chunkingConfig"]);return e!==void 0&&r!=null&&f(e,["chunkingConfig"],r),t}function _x(s){let e={},t=h(s,["fileSearchStoreName"]);t!=null&&f(e,["_url","file_search_store_name"],t);let n=h(s,["config"]);return n!=null&&o_(n,e),e}function Tx(s){let e={},t=h(s,["sdkHttpResponse"]);return t!=null&&f(e,["sdkHttpResponse"],t),e}var Ex="Content-Type",Cx="X-Server-Timeout",Sx="User-Agent",Og="x-goog-api-client",bx="1.34.0",xx=`google-genai-sdk/${bx}`,Ix="v1beta1",Rx="v1beta",$g=class{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:Ix,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Rx,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let i=[this.getRequestUrlInternal(t)];return n&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[r,a]of Object.entries(e.queryParams))i.searchParams.append(r,String(a));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,t,i.toString(),e.abortSignal),this.unaryApiCall(i,o,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[i,o]of Object.entries(t))typeof o=="object"?n[i]=Object.assign(Object.assign({},n[i]),o):o!==void 0&&(n[i]=o);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,t,i.toString(),e.abortSignal),this.streamApiCall(i,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,i){if(t&&t.timeout||i){let o=new AbortController,r=o.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){let a=setTimeout(()=>o.abort(),t.timeout);a&&typeof a.unref=="function"&&a.unref()}i&&i.addEventListener("abort",()=>{o.abort()}),e.signal=r}return t&&t.extraBody!==null&&Px(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async i=>(await CA(i),new Ya(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async i=>(await CA(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){return qt(this,arguments,function*(){var n;let i=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let r="",a="data:",l=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:c,value:d}=yield q(i.read());if(c){if(r.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let p=o.decode(d,{stream:!0});try{let y=JSON.parse(p);if("error"in y){let A=JSON.parse(JSON.stringify(y.error)),_=A.status,E=A.code,C=`got status: ${_}. ${JSON.stringify(y)}`;if(E>=400&&E<600)throw new wd({message:C,status:E})}}catch(y){if(y.name==="ApiError")throw y}r+=p;let g=-1,m=0;for(;;){g=-1,m=0;for(let _ of l){let E=r.indexOf(_);E!==-1&&(g===-1||E<g)&&(g=E,m=_.length)}if(g===-1)break;let y=r.substring(0,g);r=r.substring(g+m);let A=y.trim();if(A.startsWith(a)){let _=A.substring(a.length).trim();try{let E=new Response(_,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield q(new Ya(E))}catch(E){throw new Error(`exception parsing stream chunk ${_}. ${E}`)}}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){let e={},t=xx+" "+this.clientOptions.userAgentExtra;return e[Sx]=t,e[Og]=t,e[Ex]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[i,o]of Object.entries(e.headers))n.append(i,o);e.timeout&&e.timeout>0&&n.append(Cx,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(t=n.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),n}async uploadFile(e,t){var n;let i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);let o=this.clientOptions.uploader,r=await o.stat(e);i.sizeBytes=String(r.size);let a=(n=t==null?void 0:t.mimeType)!==null&&n!==void 0?n:r.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=a;let l={file:i},c=this.getFileName(e),d=D("upload/v1beta/files",l._url),p=await this.fetchUploadUrl(d,i.sizeBytes,i.mimeType,c,l,t==null?void 0:t.httpOptions);return o.upload(e,p,this)}async uploadFileToFileSearchStore(e,t,n){var i;let o=this.clientOptions.uploader,r=await o.stat(t),a=String(r.size),l=(i=n==null?void 0:n.mimeType)!==null&&i!==void 0?i:r.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let c=`upload/v1beta/${e}:uploadToFileSearchStore`,d=this.getFileName(t),p={};n!=null&&o_(n,p);let g=await this.fetchUploadUrl(c,a,l,d,p,n==null?void 0:n.httpOptions);return o.uploadToFileSearchStore(t,g,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,i,o,r){var a;let l={};r?l=r:l={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},i?{"X-Goog-Upload-File-Name":i}:{})};let c=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:l});if(!c||!(c!=null&&c.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let d=(a=c==null?void 0:c.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(d===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return d}};async function CA(s){var e;if(s===void 0)throw new Error("response is undefined");if(!s.ok){let t=s.status,n;!((e=s.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await s.json():n={error:{message:await s.text(),code:s.status,status:s.statusText}};let i=JSON.stringify(n);throw t>=400&&t<600?new wd({message:i,status:t}):new Error(i)}}function Px(s,e){if(!e||Object.keys(e).length===0)return;if(s.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof s.body=="string"&&s.body.length>0)try{let o=JSON.parse(s.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))t=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch(o){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(o,r){let a=Object.assign({},o);for(let l in r)if(Object.prototype.hasOwnProperty.call(r,l)){let c=r[l],d=a[l];c&&typeof c=="object"&&!Array.isArray(c)&&d&&typeof d=="object"&&!Array.isArray(d)?a[l]=n(d,c):(d&&c&&typeof d!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof d}, New type: ${typeof c}. Overwriting.`),a[l]=c)}return a}let i=n(t,e);s.body=JSON.stringify(i)}var Mx="mcp_used/unknown",Nx=!1;function r_(s){for(let e of s)if(kx(e)||typeof e=="object"&&"inputSchema"in e)return!0;return Nx}function a_(s){var e;let t=(e=s[Og])!==null&&e!==void 0?e:"";s[Og]=(t+` ${Mx}`).trimStart()}function kx(s){return s!==null&&typeof s=="object"&&s instanceof Gg}function Dx(s){return qt(this,arguments,function*(t,n=100){let i,o=0;for(;o<n;){let r=yield q(t.listTools({cursor:i}));for(let a of r.tools)yield yield q(a),o++;if(!r.nextCursor)break;i=r.nextCursor}})}var Gg=class s{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new s(e,t)}async initialize(){var e,t,n,i;if(this.mcpTools.length>0)return;let o={},r=[];for(let d of this.mcpClients)try{for(var a=!0,l=(t=void 0,zt(Dx(d))),c;c=await l.next(),e=c.done,!e;a=!0){i=c.value,a=!1;let p=i;r.push(p);let g=p.name;if(o[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);o[g]=d}}catch(p){t={error:p}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}this.mcpTools=r,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),v0(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let i=this.functionNameToMcpClient[n.name],o;this.config.timeout&&(o={timeout:this.config.timeout});let r=await i.callTool({name:n.name,arguments:n.args},void 0,o);t.push({functionResponse:{name:n.name,response:r.isError?{error:r}:r}})}return t}};async function Fx(s,e,t){let n=new xg,i;t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data),Object.assign(n,i),e(n)}var Bg=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let i=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),r=Ux(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${i}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${a}`,c=()=>{},d=new Promise(S=>{c=S}),p=e.callbacks,g=function(){c({})},m=this.apiClient,y={onopen:g,onmessage:S=>{Fx(m,p.onmessage,S)},onerror:(t=p==null?void 0:p.onerror)!==null&&t!==void 0?t:function(S){},onclose:(n=p==null?void 0:p.onclose)!==null&&n!==void 0?n:function(S){}},A=this.webSocketFactory.create(l,Lx(r),y);A.connect(),await d;let C={setup:{model:ne(this.apiClient,e.model)}};return A.send(JSON.stringify(C)),new Hg(A,this.apiClient)}},Hg=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=uS(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=cS(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(zo.PLAY)}pause(){this.sendPlaybackControl(zo.PAUSE)}stop(){this.sendPlaybackControl(zo.STOP)}resetContext(){this.sendPlaybackControl(zo.RESET_CONTEXT)}close(){this.conn.close()}};function Lx(s){let e={};return s.forEach((t,n)=>{e[n]=t}),e}function Ux(s){let e=new Headers;for(let[t,n]of Object.entries(s))e.append(t,n);return e}var Ox="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function $x(s,e,t){let n=new bg,i;t.data instanceof Blob?i=await t.data.text():t.data instanceof ArrayBuffer?i=new TextDecoder().decode(t.data):i=t.data;let o=JSON.parse(i);if(s.isVertexAI()){let r=fS(o);Object.assign(n,r)}else Object.assign(n,o);e(n)}var Vg=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new Bg(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,i,o,r,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),d,p=this.apiClient.getHeaders();e.config&&e.config.tools&&r_(e.config.tools)&&a_(p);let g=Hx(p);if(this.apiClient.isVertexAI())d=`${l}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g,d);else{let M=this.apiClient.getApiKey(),F="BidiGenerateContent",U="key";M!=null&&M.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),F="BidiGenerateContentConstrained",U="access_token"),d=`${l}/ws/google.ai.generativelanguage.${c}.GenerativeService.${F}?${U}=${M}`}let m=()=>{},y=new Promise(M=>{m=M}),A=e.callbacks,_=function(){var M;(M=A==null?void 0:A.onopen)===null||M===void 0||M.call(A),m({})},E=this.apiClient,C={onopen:_,onmessage:M=>{$x(E,A.onmessage,M)},onerror:(t=A==null?void 0:A.onerror)!==null&&t!==void 0?t:function(M){},onclose:(n=A==null?void 0:A.onclose)!==null&&n!==void 0?n:function(M){}},S=this.webSocketFactory.create(d,Bx(g),C);S.connect(),await y;let b=ne(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&b.startsWith("publishers/")){let M=this.apiClient.getProject(),F=this.apiClient.getLocation();b=`projects/${M}/locations/${F}/`+b}let x={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[od.AUDIO]}:e.config.responseModalities=[od.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let P=(a=(r=e.config)===null||r===void 0?void 0:r.tools)!==null&&a!==void 0?a:[],I=[];for(let M of P)if(this.isCallableTool(M)){let F=M;I.push(await F.tool())}else I.push(M);I.length>0&&(e.config.tools=I);let N={model:b,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?x=lS(this.apiClient,N):x=aS(this.apiClient,N),delete x.config,S.send(JSON.stringify(x)),new qg(S,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},Gx={turnComplete:!0},qg=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=Nt(t.turns),e.isVertexAI()||(n=n.map(i=>Ld(i)))}catch(i){throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(let o of n){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(Ox)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},Gx),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:hS(e)}:t={realtimeInput:dS(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function Bx(s){let e={};return s.forEach((t,n)=>{e[n]=t}),e}function Hx(s){let e=new Headers;for(let[t,n]of Object.entries(s))e.append(t,n);return e}var SA=10;function bA(s){var e,t,n;if(!((e=s==null?void 0:s.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(let r of(t=s==null?void 0:s.tools)!==null&&t!==void 0?t:[])if(Ko(r)){i=!0;break}if(!i)return!0;let o=(n=s==null?void 0:s.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function Ko(s){return"callTool"in s&&typeof s.callTool=="function"}function Vx(s){var e,t,n;return(n=(t=(e=s.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>Ko(i)))!==null&&n!==void 0?n:!1}function xA(s){var e;let t=[];return!((e=s==null?void 0:s.config)===null||e===void 0)&&e.tools&&s.config.tools.forEach((n,i)=>{if(Ko(n))return;let o=n;o.functionDeclarations&&o.functionDeclarations.length>0&&t.push(i)}),t}function IA(s){var e;return!(!((e=s==null?void 0:s.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var zg=class extends Wt{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,i,o,r,a;let l=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!Vx(t)||bA(t.config))return await this.generateContentInternal(l);let c=xA(t);if(c.length>0){let A=c.map(_=>`tools[${_}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${A}.`)}let d,p,g=Nt(l.contents),m=(o=(i=(n=l.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:SA,y=0;for(;y<m&&(d=await this.generateContentInternal(l),!(!d.functionCalls||d.functionCalls.length===0));){let A=d.candidates[0].content,_=[];for(let E of(a=(r=t.config)===null||r===void 0?void 0:r.tools)!==null&&a!==void 0?a:[])if(Ko(E)){let S=await E.callTool(d.functionCalls);_.push(...S)}y++,p={role:"user",parts:_},l.contents=Nt(l.contents),l.contents.push(A),l.contents.push(p),IA(l.config)&&(g.push(A),g.push(p))}return IA(l.config)&&(d.automaticFunctionCallingHistory=g),d},this.generateContentStream=async t=>{var n,i,o,r,a;if(this.maybeMoveToResponseJsonSchem(t),bA(t.config)){let p=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(p)}let l=xA(t);if(l.length>0){let p=l.map(g=>`tools[${g}]`).join(", ");throw new Error(`Incompatible tools found at ${p}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let c=(o=(i=(n=t==null?void 0:t.config)===null||n===void 0?void 0:n.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||o===void 0?void 0:o.streamFunctionCallArguments,d=(a=(r=t==null?void 0:t.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(c&&!d)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var i;let o,r=[];if(n!=null&&n.generatedImages)for(let l of n.generatedImages)l&&(l!=null&&l.safetyAttributes)&&((i=l==null?void 0:l.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?o=l==null?void 0:l.safetyAttributes:r.push(l);let a;return o?a={generatedImages:r,positivePromptSafetyAttributes:o,sdkHttpResponse:n.sdkHttpResponse}:a={generatedImages:r,sdkHttpResponse:n.sdkHttpResponse},a}),this.list=async t=>{var n;let r={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!r.config.queryBase){if(!((n=r.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");r.config.filter="labels.tune-type:*"}return new $n(On.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(r),r)},this.editImage=async t=>{let n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));let i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(i)},this.generateVideos=async t=>{var n,i,o,r,a,l;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=t.video)===null||n===void 0)&&n.uri&&(!((i=t.video)===null||i===void 0)&&i.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((r=(o=t.source)===null||o===void 0?void 0:o.video)===null||r===void 0)&&r.uri&&(!((l=(a=t.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,i;let o=(t=e.config)===null||t===void 0?void 0:t.tools;if(!o)return e;let r=await Promise.all(o.map(async l=>Ko(l)?await l.tool():l)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:r})};if(a.config.tools=r,e.config&&e.config.tools&&r_(e.config.tools)){let l=(i=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&i!==void 0?i:{},c=Object.assign({},l);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),a_(c),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return a}async initAfcToolsMap(e){var t,n,i;let o=new Map;for(let r of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(Ko(r)){let a=r,l=await a.tool();for(let c of(i=l.functionDeclarations)!==null&&i!==void 0?i:[]){if(!c.name)throw new Error("Function declaration name is required.");if(o.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);o.set(c.name,a)}}return o}async processAfcStream(e){var t,n,i;let o=(i=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&i!==void 0?i:SA,r=!1,a=0,l=await this.initAfcToolsMap(e);return function(c,d,p){return qt(this,arguments,function*(){for(var g,m,y,A,_,E;a<o;){r&&(a++,r=!1);let x=yield q(c.processParamsMaybeAddMcpUsage(p)),P=yield q(c.generateContentStreamInternal(x)),I=[],N=[];try{for(var C=!0,S=(m=void 0,zt(P)),b;b=yield q(S.next()),g=b.done,!g;C=!0){A=b.value,C=!1;let M=A;if(yield yield q(M),M.candidates&&(!((_=M.candidates[0])===null||_===void 0)&&_.content)){N.push(M.candidates[0].content);for(let F of(E=M.candidates[0].content.parts)!==null&&E!==void 0?E:[])if(a<o&&F.functionCall){if(!F.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(F.functionCall.name)){let U=yield q(d.get(F.functionCall.name).callTool([F.functionCall]));I.push(...U)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${F.functionCall.name}`)}}}}catch(M){m={error:M}}finally{try{!C&&!g&&(y=S.return)&&(yield q(y.call(S)))}finally{if(m)throw m.error}}if(I.length>0){r=!0;let M=new hs;M.candidates=[{content:{role:"user",parts:I}}],yield yield q(M);let F=[];F.push(...N),F.push({role:"user",parts:I});let U=Nt(p.contents).concat(F);p.contents=U}else break}})}(this,l,e)}async generateContentInternal(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=_A(this.apiClient,e);return a=D("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=EA(d),g=new hs;return Object.assign(g,p),g})}else{let c=AA(this.apiClient,e);return a=D("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=TA(d),g=new hs;return Object.assign(g,p),g})}}async generateContentStreamInternal(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=_A(this.apiClient,e);return a=D("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),r.then(function(p){return qt(this,arguments,function*(){var g,m,y,A;try{for(var _=!0,E=zt(p),C;C=yield q(E.next()),g=C.done,!g;_=!0){A=C.value,_=!1;let S=A,b=EA(yield q(S.json()));b.sdkHttpResponse={headers:S.headers};let x=new hs;Object.assign(x,b),yield yield q(x)}}catch(S){m={error:S}}finally{try{!_&&!g&&(y=E.return)&&(yield q(y.call(E)))}finally{if(m)throw m.error}}})})}else{let c=AA(this.apiClient,e);return a=D("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),r.then(function(p){return qt(this,arguments,function*(){var g,m,y,A;try{for(var _=!0,E=zt(p),C;C=yield q(E.next()),g=C.done,!g;_=!0){A=C.value,_=!1;let S=A,b=TA(yield q(S.json()));b.sdkHttpResponse={headers:S.headers};let x=new hs;Object.assign(x,b),yield yield q(x)}}catch(S){m={error:S}}finally{try{!_&&!g&&(y=E.return)&&(yield q(y.call(E)))}finally{if(m)throw m.error}}})})}}async embedContent(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=VS(this.apiClient,e);return a=D("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=zS(d),g=new rd;return Object.assign(g,p),g})}else{let c=HS(this.apiClient,e);return a=D("{model}:batchEmbedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=qS(d),g=new rd;return Object.assign(g,p),g})}}async generateImagesInternal(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=nb(this.apiClient,e);return a=D("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=sb(d),g=new ad;return Object.assign(g,p),g})}else{let c=tb(this.apiClient,e);return a=D("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=ib(d),g=new ad;return Object.assign(g,p),g})}}async editImageInternal(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=OS(this.apiClient,e);return o=D("{model}:predict",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=$S(l),d=new pg;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=nx(this.apiClient,e);return o=D("{model}:predict",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=ix(l),d=new gg;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=Ub(this.apiClient,e);return o=D("{model}:predict",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=Ob(l),d=new mg;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=qb(this.apiClient,e);return o=D("{model}:predict",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=zb(l),d=new yg;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=_b(this.apiClient,e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>Ug(d))}else{let c=Ab(this.apiClient,e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>Lg(d))}}async listInternal(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=Pb(this.apiClient,e);return a=D("{models_url}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=Nb(d),g=new ld;return Object.assign(g,p),g})}else{let c=Rb(this.apiClient,e);return a=D("{models_url}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=Mb(d),g=new ld;return Object.assign(g,p),g})}}async update(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=ex(this.apiClient,e);return a=D("{model}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>Ug(d))}else{let c=jb(this.apiClient,e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>Lg(d))}}async delete(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=DS(this.apiClient,e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=LS(d),g=new cd;return Object.assign(g,p),g})}else{let c=kS(this.apiClient,e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=FS(d),g=new cd;return Object.assign(g,p),g})}}async countTokens(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=PS(this.apiClient,e);return a=D("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=NS(d),g=new ud;return Object.assign(g,p),g})}else{let c=RS(this.apiClient,e);return a=D("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=MS(d),g=new ud;return Object.assign(g,p),g})}}async computeTokens(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=TS(this.apiClient,e);return o=D("{model}:computeTokens",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=ES(l),d=new vg;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=ub(this.apiClient,e);return a=D("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>{let p=lb(d),g=new dd;return Object.assign(g,p),g})}else{let c=cb(this.apiClient,e);return a=D("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>{let p=ab(d),g=new dd;return Object.assign(g,p),g})}}};var Wg=class extends Wt{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=t.name.split("/operations/")[0],o;n&&"httpOptions"in n&&(o=n.httpOptions);let r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=t.name.split("/operations/")[0],o;n&&"httpOptions"in n&&(o=n.httpOptions);let r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=o0(e);return a=D("{operationName}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r}else{let c=s0(e);return a=D("{operationName}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r}}async fetchPredictVideosOperationInternal(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=ZE(e);return o=D("{resourceName}:fetchPredictOperation",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}};function qx(s){let e={},t=h(s,["data"]);if(t!=null&&f(e,["data"],t),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(e,["mimeType"],n),e}function zx(s){let e={},t=h(s,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>eI(o))),f(e,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(e,["role"],n),e}function Wx(s,e,t){let n={},i=h(e,["expireTime"]);t!==void 0&&i!=null&&f(t,["expireTime"],i);let o=h(e,["newSessionExpireTime"]);t!==void 0&&o!=null&&f(t,["newSessionExpireTime"],o);let r=h(e,["uses"]);t!==void 0&&r!=null&&f(t,["uses"],r);let a=h(e,["liveConnectConstraints"]);t!==void 0&&a!=null&&f(t,["bidiGenerateContentSetup"],jx(s,a));let l=h(e,["lockAdditionalFields"]);return t!==void 0&&l!=null&&f(t,["fieldMask"],l),n}function Kx(s,e){let t={},n=h(e,["config"]);return n!=null&&f(t,["config"],Wx(s,n,t)),t}function Yx(s){let e={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=h(s,["fileUri"]);t!=null&&f(e,["fileUri"],t);let n=h(s,["mimeType"]);return n!=null&&f(e,["mimeType"],n),e}function Jx(s){let e={},t=h(s,["id"]);t!=null&&f(e,["id"],t);let n=h(s,["args"]);n!=null&&f(e,["args"],n);let i=h(s,["name"]);if(i!=null&&f(e,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Xx(s){let e={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=h(s,["enableWidget"]);return t!=null&&f(e,["enableWidget"],t),e}function Zx(s){let e={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=h(s,["timeRangeFilter"]);return t!=null&&f(e,["timeRangeFilter"],t),e}function Qx(s,e){let t={},n=h(s,["generationConfig"]);e!==void 0&&n!=null&&f(e,["setup","generationConfig"],n);let i=h(s,["responseModalities"]);e!==void 0&&i!=null&&f(e,["setup","generationConfig","responseModalities"],i);let o=h(s,["temperature"]);e!==void 0&&o!=null&&f(e,["setup","generationConfig","temperature"],o);let r=h(s,["topP"]);e!==void 0&&r!=null&&f(e,["setup","generationConfig","topP"],r);let a=h(s,["topK"]);e!==void 0&&a!=null&&f(e,["setup","generationConfig","topK"],a);let l=h(s,["maxOutputTokens"]);e!==void 0&&l!=null&&f(e,["setup","generationConfig","maxOutputTokens"],l);let c=h(s,["mediaResolution"]);e!==void 0&&c!=null&&f(e,["setup","generationConfig","mediaResolution"],c);let d=h(s,["seed"]);e!==void 0&&d!=null&&f(e,["setup","generationConfig","seed"],d);let p=h(s,["speechConfig"]);e!==void 0&&p!=null&&f(e,["setup","generationConfig","speechConfig"],pm(p));let g=h(s,["thinkingConfig"]);e!==void 0&&g!=null&&f(e,["setup","generationConfig","thinkingConfig"],g);let m=h(s,["enableAffectiveDialog"]);e!==void 0&&m!=null&&f(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=h(s,["systemInstruction"]);e!==void 0&&y!=null&&f(e,["setup","systemInstruction"],zx(Ve(y)));let A=h(s,["tools"]);if(e!==void 0&&A!=null){let P=Zo(A);Array.isArray(P)&&(P=P.map(I=>nI(Xo(I)))),f(e,["setup","tools"],P)}let _=h(s,["sessionResumption"]);e!==void 0&&_!=null&&f(e,["setup","sessionResumption"],tI(_));let E=h(s,["inputAudioTranscription"]);e!==void 0&&E!=null&&f(e,["setup","inputAudioTranscription"],E);let C=h(s,["outputAudioTranscription"]);e!==void 0&&C!=null&&f(e,["setup","outputAudioTranscription"],C);let S=h(s,["realtimeInputConfig"]);e!==void 0&&S!=null&&f(e,["setup","realtimeInputConfig"],S);let b=h(s,["contextWindowCompression"]);e!==void 0&&b!=null&&f(e,["setup","contextWindowCompression"],b);let x=h(s,["proactivity"]);if(e!==void 0&&x!=null&&f(e,["setup","proactivity"],x),h(s,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function jx(s,e){let t={},n=h(e,["model"]);n!=null&&f(t,["setup","model"],ne(s,n));let i=h(e,["config"]);return i!=null&&f(t,["config"],Qx(i,t)),t}function eI(s){let e={},t=h(s,["mediaResolution"]);t!=null&&f(e,["mediaResolution"],t);let n=h(s,["codeExecutionResult"]);n!=null&&f(e,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(e,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(e,["fileData"],Yx(o));let r=h(s,["functionCall"]);r!=null&&f(e,["functionCall"],Jx(r));let a=h(s,["functionResponse"]);a!=null&&f(e,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(e,["inlineData"],qx(l));let c=h(s,["text"]);c!=null&&f(e,["text"],c);let d=h(s,["thought"]);d!=null&&f(e,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(e,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(e,["videoMetadata"],g),e}function tI(s){let e={},t=h(s,["handle"]);if(t!=null&&f(e,["handle"],t),h(s,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function nI(s){let e={},t=h(s,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(p=>p)),f(e,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(e,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(e,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(e,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(e,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(e,["googleMaps"],Xx(a));let l=h(s,["googleSearch"]);l!=null&&f(e,["googleSearch"],Zx(l));let c=h(s,["urlContext"]);return c!=null&&f(e,["urlContext"],c),e}function iI(s){let e=[];for(let t in s)if(Object.prototype.hasOwnProperty.call(s,t)){let n=s[t];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){let i=Object.keys(n).map(o=>`${t}.${o}`);e.push(...i)}else e.push(t)}return e.join(",")}function sI(s,e){let t=null,n=s.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){let o=n.setup;typeof o=="object"&&o!==null?(s.bidiGenerateContentSetup=o,t=o):delete s.bidiGenerateContentSetup}else n!==void 0&&delete s.bidiGenerateContentSetup;let i=s.fieldMask;if(t){let o=iI(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?s.fieldMask=o:delete s.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){let r=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],a=[];i.length>0&&(a=i.map(c=>r.includes(c)?`generationConfig.${c}`:c));let l=[];o&&l.push(o),a.length>0&&l.push(...a),l.length>0?s.fieldMask=l.join(","):delete s.fieldMask}else delete s.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?s.fieldMask=i.join(","):delete s.fieldMask;return s}var Kg=class extends Wt{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let a=Kx(this.apiClient,e);o=D("auth_tokens",a._url),r=a._query,delete a.config,delete a._url,delete a._query;let l=sI(a,e.config);return i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>c)}}};function oI(s,e){let t={},n=h(s,["force"]);return e!==void 0&&n!=null&&f(e,["_query","force"],n),t}function rI(s){let e={},t=h(s,["name"]);t!=null&&f(e,["_url","name"],t);let n=h(s,["config"]);return n!=null&&oI(n,e),e}function aI(s){let e={},t=h(s,["name"]);return t!=null&&f(e,["_url","name"],t),e}function lI(s,e){let t={},n=h(s,["pageSize"]);e!==void 0&&n!=null&&f(e,["_query","pageSize"],n);let i=h(s,["pageToken"]);return e!==void 0&&i!=null&&f(e,["_query","pageToken"],i),t}function cI(s){let e={},t=h(s,["parent"]);t!=null&&f(e,["_url","parent"],t);let n=h(s,["config"]);return n!=null&&lI(n,e),e}function uI(s){let e={},t=h(s,["sdkHttpResponse"]);t!=null&&f(e,["sdkHttpResponse"],t);let n=h(s,["nextPageToken"]);n!=null&&f(e,["nextPageToken"],n);let i=h(s,["documents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(e,["documents"],o)}return e}var Yg=class extends Wt{constructor(e){super(),this.apiClient=e,this.list=async t=>new $n(On.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:t.parent,config:n.config}),await this.listInternal(t),t)}async get(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=aI(e);return o=D("{name}",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(e){var t,n;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let r=rI(e);i=D("{name}",r._url),o=r._query,delete r._url,delete r._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=cI(e);return o=D("{parent}/documents",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=uI(l),d=new wg;return Object.assign(d,c),d})}}};var Jg=class extends Wt{constructor(e,t=new Yg(e)){super(),this.apiClient=e,this.documents=t,this.list=async(n={})=>new $n(On.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=ux(e);return o=D("fileSearchStores",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async get(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=fx(e);return o=D("{name}",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(e){var t,n;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let r=hx(e);i=D("{name}",r._url),o=r._query,delete r._url,delete r._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=wx(e);return o=D("fileSearchStores",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=Ax(l),d=new Ag;return Object.assign(d,c),d})}}async uploadToFileSearchStoreInternal(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=_x(e);return o=D("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=Tx(l),d=new _g;return Object.assign(d,c),d})}}async importFile(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=mx(e);return o=D("{file_search_store_name}:importFile",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=gx(l),d=new Tg;return Object.assign(d,c),d})}}};var l_=function(){let{crypto:s}=globalThis;if(s!=null&&s.randomUUID)return l_=s.randomUUID.bind(s),s.randomUUID();let e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))},dI=()=>l_();function Xg(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}var Zg=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){let e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch(e){}try{return new Error(JSON.stringify(s))}catch(e){}}return new Error(s)};var at=class extends Error{},lt=class s extends at{constructor(e,t,n,i){super(`${s.makeMessage(e,t,n)}`),this.status=e,this.headers=i,this.error=t}static makeMessage(e,t,n){let i=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,n,i){if(!e||!i)return new Yo({message:n,cause:Zg(t)});let o=t;return e===400?new _d(e,o,n,i):e===401?new Td(e,o,n,i):e===403?new Ed(e,o,n,i):e===404?new Cd(e,o,n,i):e===409?new Sd(e,o,n,i):e===422?new bd(e,o,n,i):e===429?new xd(e,o,n,i):e>=500?new Id(e,o,n,i):new s(e,o,n,i)}},Ja=class extends lt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Yo=class extends lt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Ad=class extends Yo{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},_d=class extends lt{},Td=class extends lt{},Ed=class extends lt{},Cd=class extends lt{},Sd=class extends lt{},bd=class extends lt{},xd=class extends lt{},Id=class extends lt{};var hI=/^[a-z][a-z0-9+.-]*:/i,fI=s=>hI.test(s),Qg=s=>(Qg=Array.isArray,Qg(s)),pI=Qg,gI=pI,RA=gI;function mI(s){if(!s)return!0;for(let e in s)return!1;return!0}function yI(s,e){return Object.prototype.hasOwnProperty.call(s,e)}var vI=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new at(`${s} must be an integer`);if(e<0)throw new at(`${s} must be a positive integer`);return e},wI=s=>{try{return JSON.parse(s)}catch(e){return}};var AI=s=>new Promise(e=>setTimeout(e,s));var qo="0.0.1";function _I(){return typeof Deno!="undefined"&&Deno.build!=null?"deno":typeof EdgeRuntime!="undefined"?"edge":Object.prototype.toString.call(typeof globalThis.process!="undefined"?globalThis.process:0)==="[object process]"?"node":"unknown"}var TI=()=>{var s,e,t,n,i;let o=_I();if(o==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":qo,"X-Stainless-OS":MA(Deno.build.os),"X-Stainless-Arch":PA(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(s=Deno.version)===null||s===void 0?void 0:s.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":qo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(o==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":qo,"X-Stainless-OS":MA((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":PA((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!==null&&i!==void 0?i:"unknown"};let r=EI();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":qo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":qo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function EI(){if(typeof navigator=="undefined"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of s){let n=t.exec(navigator.userAgent);if(n){let i=n[1]||0,o=n[2]||0,r=n[3]||0;return{browser:e,version:`${i}.${o}.${r}`}}}return null}var PA=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",MA=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),Qu,CI=()=>Qu!=null?Qu:Qu=TI();function SI(){if(typeof fetch!="undefined")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function c_(...s){let e=globalThis.ReadableStream;if(typeof e=="undefined")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function bI(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return c_({start(){},async pull(t){let{done:n,value:i}=await e.next();n?t.close():t.enqueue(i)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function u_(s){if(s[Symbol.asyncIterator])return s;let e=s.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function xI(s){var e,t;if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await((t=(e=s[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}let n=s.getReader(),i=n.cancel();n.releaseLock(),await i}var II=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var d_=()=>{var s;if(typeof File=="undefined"){let{process:e}=globalThis,t=typeof((s=e==null?void 0:e.versions)===null||s===void 0?void 0:s.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ug(s,e,t){return d_(),new File(s,e!=null?e:"unknown_file",t)}function RI(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}var PI=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function";var h_=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",MI=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&h_(s),NI=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function kI(s,e,t){if(d_(),s=await s,MI(s))return s instanceof File?s:ug([await s.arrayBuffer()],s.name);if(NI(s)){let i=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),ug(await jg(i),e,t)}let n=await jg(s);if(e||(e=RI(s)),!(t!=null&&t.type)){let i=n.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof i=="string"&&(t=Object.assign(Object.assign({},t),{type:i}))}return ug(n,e,t)}async function jg(s){var e,t,n,i,o;let r=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)r.push(s);else if(h_(s))r.push(s instanceof Blob?s:await s.arrayBuffer());else if(PI(s))try{for(var a=!0,l=zt(s),c;c=await l.next(),e=c.done,!e;a=!0){i=c.value,a=!1;let d=i;r.push(...await jg(d))}}catch(d){t={error:d}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}else{let d=(o=s==null?void 0:s.constructor)===null||o===void 0?void 0:o.name;throw new Error(`Unexpected data type: ${typeof s}${d?`; constructor: ${d}`:""}${DI(s)}`)}return r}function DI(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}var Rd=class{constructor(e){this._client=e}};Rd._key=[];function f_(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var NA=Object.freeze(Object.create(null)),FI=(s=f_)=>function(t,...n){if(t.length===1)return t[0];let i=!1,o=[],r=t.reduce((d,p,g)=>{var m,y,A;/[?#]/.test(p)&&(i=!0);let _=n[g],E=(i?encodeURIComponent:s)(""+_);return g!==n.length&&(_==null||typeof _=="object"&&_.toString===((A=Object.getPrototypeOf((y=Object.getPrototypeOf((m=_.hasOwnProperty)!==null&&m!==void 0?m:NA))!==null&&y!==void 0?y:NA))===null||A===void 0?void 0:A.toString))&&(E=_+"",o.push({start:d.length+p.length,length:E.length,error:`Value of type ${Object.prototype.toString.call(_).slice(8,-1)} is not a valid path parameter`})),d+p+(g===n.length?"":E)},""),a=r.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,c;for(;(c=l.exec(a))!==null;)o.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(o.sort((d,p)=>d.start-p.start),o.length>0){let d=0,p=o.reduce((g,m)=>{let y=" ".repeat(m.start-d),A="^".repeat(m.length);return d=m.start+m.length,g+y+A},"");throw new at(`Path parameters result in path with invalid segments:
${o.map(g=>g.error).join(`
`)}
${r}
${p}`)}return r},ju=FI(f_);var Pd=class extends Rd{create(e,t){var n;let{api_version:i=this._client.apiVersion}=e,o=vd(e,["api_version"]);if("model"in o&&"agent_config"in o)throw new at("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in o&&"generation_config"in o)throw new at("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(ju`/${i}/interactions`,Object.assign(Object.assign({body:o},t),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,t={},n){let{api_version:i=this._client.apiVersion}=t!=null?t:{};return this._client.delete(ju`/${i}/interactions/${e}`,n)}cancel(e,t={},n){let{api_version:i=this._client.apiVersion}=t!=null?t:{};return this._client.post(ju`/${i}/interactions/${e}/cancel`,n)}get(e,t={},n){var i;let o=t!=null?t:{},{api_version:r=this._client.apiVersion}=o,a=vd(o,["api_version"]);return this._client.get(ju`/${r}/interactions/${e}`,Object.assign(Object.assign({query:a},n),{stream:(i=t==null?void 0:t.stream)!==null&&i!==void 0?i:!1}))}};Pd._key=Object.freeze(["interactions"]);var Md=class extends Pd{};function LI(s){let e=0;for(let i of s)e+=i.length;let t=new Uint8Array(e),n=0;for(let i of s)t.set(i,n),n+=i.length;return t}var ed;function gm(s){let e;return(ed!=null?ed:(e=new globalThis.TextEncoder,ed=e.encode.bind(e)))(s)}var td;function kA(s){let e;return(td!=null?td:(e=new globalThis.TextDecoder,td=e.decode.bind(e)))(s)}var Jo=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?gm(e):e;this.buffer=LI([this.buffer,t]);let n=[],i;for(;(i=UI(this.buffer,this.carriageReturnIndex))!=null;){if(i.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=i.index;continue}if(this.carriageReturnIndex!=null&&(i.index!==this.carriageReturnIndex+1||i.carriage)){n.push(kA(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let o=this.carriageReturnIndex!==null?i.preceding-1:i.preceding,r=kA(this.buffer.subarray(0,o));n.push(r),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}};Jo.NEWLINE_CHARS=new Set([`
`,"\r"]);Jo.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function UI(s,e){for(let i=e!=null?e:0;i<s.length;i++){if(s[i]===10)return{preceding:i,index:i+1,carriage:!1};if(s[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function OI(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}var Nd={off:0,error:200,warn:300,info:400,debug:500},DA=(s,e,t)=>{if(s){if(yI(Nd,s))return s;tt(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(Nd))}`)}};function Ka(){}function nd(s,e,t){return!e||Nd[s]>Nd[t]?Ka:e[s].bind(e)}var $I={error:Ka,warn:Ka,info:Ka,debug:Ka},FA=new WeakMap;function tt(s){var e;let t=s.logger,n=(e=s.logLevel)!==null&&e!==void 0?e:"off";if(!t)return $I;let i=FA.get(t);if(i&&i[0]===n)return i[1];let o={error:nd("error",t,n),warn:nd("warn",t,n),info:nd("info",t,n),debug:nd("debug",t,n)};return FA.set(t,[n,o]),o}var ds=s=>(s.options&&(s.options=Object.assign({},s.options),delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var em=class s{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let i=!1,o=n?tt(n):console;function r(){return qt(this,arguments,function*(){var l,c,d,p;if(i)throw new at("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var m=!0,y=zt(GI(e,t)),A;A=yield q(y.next()),l=A.done,!l;m=!0){p=A.value,m=!1;let _=p;if(!g)if(_.data.startsWith("[DONE]")){g=!0;continue}else try{yield yield q(JSON.parse(_.data))}catch(E){throw o.error("Could not parse message into JSON:",_.data),o.error("From chunk:",_.raw),E}}}catch(_){c={error:_}}finally{try{!m&&!l&&(d=y.return)&&(yield q(d.call(y)))}finally{if(c)throw c.error}}g=!0}catch(_){if(Xg(_))return yield q(void 0);throw _}finally{g||t.abort()}})}return new s(r,t,n)}static fromReadableStream(e,t,n){let i=!1;function o(){return qt(this,arguments,function*(){var l,c,d,p;let g=new Jo,m=u_(e);try{for(var y=!0,A=zt(m),_;_=yield q(A.next()),l=_.done,!l;y=!0){p=_.value,y=!1;let E=p;for(let C of g.decode(E))yield yield q(C)}}catch(E){c={error:E}}finally{try{!y&&!l&&(d=A.return)&&(yield q(d.call(A)))}finally{if(c)throw c.error}}for(let E of g.flush())yield yield q(E)})}function r(){return qt(this,arguments,function*(){var l,c,d,p;if(i)throw new at("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var m=!0,y=zt(o()),A;A=yield q(y.next()),l=A.done,!l;m=!0){p=A.value,m=!1;let _=p;g||_&&(yield yield q(JSON.parse(_)))}}catch(_){c={error:_}}finally{try{!m&&!l&&(d=y.return)&&(yield q(d.call(y)))}finally{if(c)throw c.error}}g=!0}catch(_){if(Xg(_))return yield q(void 0);throw _}finally{g||t.abort()}})}return new s(r,t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),i=o=>({next:()=>{if(o.length===0){let r=n.next();e.push(r),t.push(r)}return o.shift()}});return[new s(()=>i(e),this.controller,this.client),new s(()=>i(t),this.controller,this.client)]}toReadableStream(){let e=this,t;return c_({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:i,done:o}=await t.next();if(o)return n.close();let r=gm(JSON.stringify(i)+`
`);n.enqueue(r)}catch(i){n.error(i)}},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}};function GI(s,e){return qt(this,arguments,function*(){var n,i,o,r;if(!s.body)throw e.abort(),typeof globalThis.navigator!="undefined"&&globalThis.navigator.product==="ReactNative"?new at("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new at("Attempted to iterate over a response with no body");let a=new tm,l=new Jo,c=u_(s.body);try{for(var d=!0,p=zt(BI(c)),g;g=yield q(p.next()),n=g.done,!n;d=!0){r=g.value,d=!1;let m=r;for(let y of l.decode(m)){let A=a.decode(y);A&&(yield yield q(A))}}}catch(m){i={error:m}}finally{try{!d&&!n&&(o=p.return)&&(yield q(o.call(p)))}finally{if(i)throw i.error}}for(let m of l.flush()){let y=a.decode(m);y&&(yield yield q(y))}})}function BI(s){return qt(this,arguments,function*(){var t,n,i,o;let r=new Uint8Array;try{for(var a=!0,l=zt(s),c;c=yield q(l.next()),t=c.done,!t;a=!0){o=c.value,a=!1;let d=o;if(d==null)continue;let p=d instanceof ArrayBuffer?new Uint8Array(d):typeof d=="string"?gm(d):d,g=new Uint8Array(r.length+p.length);g.set(r),g.set(p,r.length),r=g;let m;for(;(m=OI(r))!==-1;)yield yield q(r.slice(0,m)),r=r.slice(m)}}catch(d){n={error:d}}finally{try{!a&&!t&&(i=l.return)&&(yield q(i.call(l)))}finally{if(n)throw n.error}}r.length>0&&(yield yield q(r))})}var tm=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,i]=HI(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}};function HI(s,e){let t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}async function VI(s,e){let{response:t,requestLogID:n,retryOfRequestLogID:i,startTime:o}=e,r=await(async()=>{var a;if(e.options.stream)return tt(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,s):em.fromSSEResponse(t,e.controller,s);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let l=t.headers.get("content-type"),c=(a=l==null?void 0:l.split(";")[0])===null||a===void 0?void 0:a.trim();return(c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))?await t.json():await t.text()})();return tt(s).debug(`[${n}] response parsed`,ds({retryOfRequestLogID:i,url:t.url,status:t.status,body:r,durationMs:Date.now()-o})),r}var nm=class s extends Promise{constructor(e,t,n=VI){super(i=>{i(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new s(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var p_=Symbol("brand.privateNullableHeaders");function*qI(s){if(!s)return;if(p_ in s){let{values:n,nulls:i}=s;yield*n.entries();for(let o of i)yield[o,null];return}let e=!1,t;s instanceof Headers?t=s.entries():RA(s)?t=s:(e=!0,t=Object.entries(s!=null?s:{}));for(let n of t){let i=n[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");let o=RA(n[1])?n[1]:[n[1]],r=!1;for(let a of o)a!==void 0&&(e&&!r&&(r=!0,yield[i,null]),yield[i,a])}}var Wa=s=>{let e=new Headers,t=new Set;for(let n of s){let i=new Set;for(let[o,r]of qI(n)){let a=o.toLowerCase();i.has(a)||(e.delete(o),i.add(a)),r===null?(e.delete(o),t.add(a)):(e.append(o,r),t.delete(a))}}return{[p_]:!0,values:e,nulls:t}};var dg=s=>{var e,t,n,i,o,r;if(typeof globalThis.process!="undefined")return(n=(t=(e=globalThis.process.env)===null||e===void 0?void 0:e[s])===null||t===void 0?void 0:t.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno!="undefined")return(r=(o=(i=globalThis.Deno.env)===null||i===void 0?void 0:i.get)===null||o===void 0?void 0:o.call(i,s))===null||r===void 0?void 0:r.trim()};var g_,kd=class s{constructor(e){var t,n,i,o,r,a,l,{baseURL:c=dg("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:d=(t=dg("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:p="v1beta"}=e,g=vd(e,["baseURL","apiKey","apiVersion"]);let m=Object.assign(Object.assign({apiKey:d,apiVersion:p},g),{baseURL:c||"https://generativelanguage.googleapis.com"});this.baseURL=m.baseURL,this.timeout=(n=m.timeout)!==null&&n!==void 0?n:s.DEFAULT_TIMEOUT,this.logger=(i=m.logger)!==null&&i!==void 0?i:console;let y="warn";this.logLevel=y,this.logLevel=(r=(o=DA(m.logLevel,"ClientOptions.logLevel",this))!==null&&o!==void 0?o:DA(dg("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&r!==void 0?r:y,this.fetchOptions=m.fetchOptions,this.maxRetries=(a=m.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(l=m.fetch)!==null&&l!==void 0?l:SI(),this.encoder=II,this._options=m,this.apiKey=d,this.apiVersion=p,this.clientAdapter=m.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){let t=Wa([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return Wa([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Wa([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n!="undefined").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new at(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${qo}`}defaultIdempotencyKey(){return`stainless-node-retry-${dI()}`}makeStatusError(e,t,n,i){return lt.generate(e,t,n,i)}buildURL(e,t,n){let i=!this.baseURLOverridden()&&n||this.baseURL,o=fI(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return mI(r)||(t=Object.assign(Object.assign({},r),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(o.search=this.stringifyQuery(t)),o.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(i=>Object.assign({method:e,path:t},i)))}request(e,t=null){return new nm(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var i,o,r;let a=await e,l=(i=a.maxRetries)!==null&&i!==void 0?i:this.maxRetries;t==null&&(t=l),await this.prepareOptions(a);let{req:c,url:d,timeout:p}=await this.buildRequest(a,{retryCount:l-t});await this.prepareRequest(c,{url:d,options:a});let g="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),m=n===void 0?"":`, retryOf: ${n}`,y=Date.now();if(tt(this).debug(`[${g}] sending request`,ds({retryOfRequestLogID:n,method:a.method,url:d,options:a,headers:c.headers})),!((o=a.signal)===null||o===void 0)&&o.aborted)throw new Ja;let A=new AbortController,_=await this.fetchWithTimeout(d,c,p,A).catch(Zg),E=Date.now();if(_ instanceof globalThis.Error){let S=`retrying, ${t} attempts remaining`;if(!((r=a.signal)===null||r===void 0)&&r.aborted)throw new Ja;let b=Xg(_)||/timed? ?out/i.test(String(_)+("cause"in _?String(_.cause):""));if(t)return tt(this).info(`[${g}] connection ${b?"timed out":"failed"} - ${S}`),tt(this).debug(`[${g}] connection ${b?"timed out":"failed"} (${S})`,ds({retryOfRequestLogID:n,url:d,durationMs:E-y,message:_.message})),this.retryRequest(a,t,n!=null?n:g);throw tt(this).info(`[${g}] connection ${b?"timed out":"failed"} - error; no more retries left`),tt(this).debug(`[${g}] connection ${b?"timed out":"failed"} (error; no more retries left)`,ds({retryOfRequestLogID:n,url:d,durationMs:E-y,message:_.message})),b?new Ad:new Yo({cause:_})}let C=`[${g}${m}] ${c.method} ${d} ${_.ok?"succeeded":"failed"} with status ${_.status} in ${E-y}ms`;if(!_.ok){let S=await this.shouldRetry(_);if(t&&S){let M=`retrying, ${t} attempts remaining`;return await xI(_.body),tt(this).info(`${C} - ${M}`),tt(this).debug(`[${g}] response error (${M})`,ds({retryOfRequestLogID:n,url:_.url,status:_.status,headers:_.headers,durationMs:E-y})),this.retryRequest(a,t,n!=null?n:g,_.headers)}let b=S?"error; no more retries left":"error; not retryable";tt(this).info(`${C} - ${b}`);let x=await _.text().catch(M=>Zg(M).message),P=wI(x),I=P?void 0:x;throw tt(this).debug(`[${g}] response error (${b})`,ds({retryOfRequestLogID:n,url:_.url,status:_.status,headers:_.headers,message:I,durationMs:Date.now()-y})),this.makeStatusError(_.status,P,I,_.headers)}return tt(this).info(C),tt(this).debug(`[${g}] response start`,ds({retryOfRequestLogID:n,url:_.url,status:_.status,headers:_.headers,durationMs:E-y})),{response:_,options:a,controller:A,requestLogID:g,retryOfRequestLogID:n,startTime:y}}async fetchWithTimeout(e,t,n,i){let o=t||{},{signal:r,method:a}=o,l=vd(o,["signal","method"]);r&&r.addEventListener("abort",()=>i.abort());let c=setTimeout(()=>i.abort(),n),d=globalThis.ReadableStream&&l.body instanceof globalThis.ReadableStream||typeof l.body=="object"&&l.body!==null&&Symbol.asyncIterator in l.body,p=Object.assign(Object.assign(Object.assign({signal:i.signal},d?{duplex:"half"}:{}),{method:"GET"}),l);a&&(p.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,p)}finally{clearTimeout(c)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,i){var o;let r,a=i==null?void 0:i.get("retry-after-ms");if(a){let c=parseFloat(a);Number.isNaN(c)||(r=c)}let l=i==null?void 0:i.get("retry-after");if(l&&!r){let c=parseFloat(l);Number.isNaN(c)?r=Date.parse(l)-Date.now():r=c*1e3}if(!(r&&0<=r&&r<60*1e3)){let c=(o=e.maxRetries)!==null&&o!==void 0?o:this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,c)}return await AI(r),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let o=t-e,r=Math.min(.5*Math.pow(2,o),8),a=1-Math.random()*.25;return r*a*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,i,o;let r=Object.assign({},e),{method:a,path:l,query:c,defaultBaseURL:d}=r,p=this.buildURL(l,c,d);"timeout"in r&&vI("timeout",r.timeout),r.timeout=(n=r.timeout)!==null&&n!==void 0?n:this.timeout;let{bodyHeaders:g,body:m}=this.buildBody({options:r}),y=await this.buildHeaders({options:e,method:a,bodyHeaders:g,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:y},r.signal&&{signal:r.signal}),globalThis.ReadableStream&&m instanceof globalThis.ReadableStream&&{duplex:"half"}),m&&{body:m}),(i=this.fetchOptions)!==null&&i!==void 0?i:{}),(o=r.fetchOptions)!==null&&o!==void 0?o:{}),url:p,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:i}){let o={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let r=await this.authHeaders(e),a=Wa([o,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),CI()),this._options.defaultHeaders,n,e.headers,r]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=Wa([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:bI(e)}:this.encoder({body:e,headers:n})}};kd.DEFAULT_TIMEOUT=6e4;var we=class extends kd{constructor(){super(...arguments),this.interactions=new Md(this)}};g_=we;we.GeminiNextGenAPIClient=g_;we.GeminiNextGenAPIClientError=at;we.APIError=lt;we.APIConnectionError=Yo;we.APIConnectionTimeoutError=Ad;we.APIUserAbortError=Ja;we.NotFoundError=Cd;we.ConflictError=Sd;we.RateLimitError=xd;we.BadRequestError=_d;we.AuthenticationError=Td;we.InternalServerError=Id;we.PermissionDeniedError=Ed;we.UnprocessableEntityError=bd;we.toFile=kI;we.Interactions=Md;function zI(s,e){let t={},n=h(s,["name"]);return n!=null&&f(t,["_url","name"],n),t}function WI(s,e){let t={},n=h(s,["name"]);return n!=null&&f(t,["_url","name"],n),t}function KI(s,e){let t={},n=h(s,["sdkHttpResponse"]);return n!=null&&f(t,["sdkHttpResponse"],n),t}function YI(s,e){let t={},n=h(s,["sdkHttpResponse"]);return n!=null&&f(t,["sdkHttpResponse"],n),t}function JI(s,e,t){let n={};if(h(s,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let i=h(s,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&f(e,["displayName"],i),h(s,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let o=h(s,["epochCount"]);e!==void 0&&o!=null&&f(e,["tuningTask","hyperparameters","epochCount"],o);let r=h(s,["learningRateMultiplier"]);if(r!=null&&f(n,["tuningTask","hyperparameters","learningRateMultiplier"],r),h(s,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(h(s,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(h(s,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let a=h(s,["batchSize"]);e!==void 0&&a!=null&&f(e,["tuningTask","hyperparameters","batchSize"],a);let l=h(s,["learningRate"]);if(e!==void 0&&l!=null&&f(e,["tuningTask","hyperparameters","learningRate"],l),h(s,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(h(s,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function XI(s,e,t){let n={},i=h(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let m=h(s,["validationDataset"]);e!==void 0&&m!=null&&f(e,["supervisedTuningSpec"],LA(m))}else if(i==="PREFERENCE_TUNING"){let m=h(s,["validationDataset"]);e!==void 0&&m!=null&&f(e,["preferenceOptimizationSpec"],LA(m))}let o=h(s,["tunedModelDisplayName"]);e!==void 0&&o!=null&&f(e,["tunedModelDisplayName"],o);let r=h(s,["description"]);e!==void 0&&r!=null&&f(e,["description"],r);let a=h(t,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){let m=h(s,["epochCount"]);e!==void 0&&m!=null&&f(e,["supervisedTuningSpec","hyperParameters","epochCount"],m)}else if(a==="PREFERENCE_TUNING"){let m=h(s,["epochCount"]);e!==void 0&&m!=null&&f(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],m)}let l=h(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){let m=h(s,["learningRateMultiplier"]);e!==void 0&&m!=null&&f(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],m)}else if(l==="PREFERENCE_TUNING"){let m=h(s,["learningRateMultiplier"]);e!==void 0&&m!=null&&f(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],m)}let c=h(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){let m=h(s,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&f(e,["supervisedTuningSpec","exportLastCheckpointOnly"],m)}else if(c==="PREFERENCE_TUNING"){let m=h(s,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&f(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],m)}let d=h(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){let m=h(s,["adapterSize"]);e!==void 0&&m!=null&&f(e,["supervisedTuningSpec","hyperParameters","adapterSize"],m)}else if(d==="PREFERENCE_TUNING"){let m=h(s,["adapterSize"]);e!==void 0&&m!=null&&f(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],m)}if(h(s,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(h(s,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let p=h(s,["labels"]);e!==void 0&&p!=null&&f(e,["labels"],p);let g=h(s,["beta"]);return e!==void 0&&g!=null&&f(e,["preferenceOptimizationSpec","hyperParameters","beta"],g),n}function ZI(s,e){let t={},n=h(s,["baseModel"]);n!=null&&f(t,["baseModel"],n);let i=h(s,["preTunedModel"]);i!=null&&f(t,["preTunedModel"],i);let o=h(s,["trainingDataset"]);o!=null&&lR(o);let r=h(s,["config"]);return r!=null&&JI(r,t),t}function QI(s,e){let t={},n=h(s,["baseModel"]);n!=null&&f(t,["baseModel"],n);let i=h(s,["preTunedModel"]);i!=null&&f(t,["preTunedModel"],i);let o=h(s,["trainingDataset"]);o!=null&&cR(o,t,e);let r=h(s,["config"]);return r!=null&&XI(r,t,e),t}function jI(s,e){let t={},n=h(s,["name"]);return n!=null&&f(t,["_url","name"],n),t}function eR(s,e){let t={},n=h(s,["name"]);return n!=null&&f(t,["_url","name"],n),t}function tR(s,e,t){let n={},i=h(s,["pageSize"]);e!==void 0&&i!=null&&f(e,["_query","pageSize"],i);let o=h(s,["pageToken"]);e!==void 0&&o!=null&&f(e,["_query","pageToken"],o);let r=h(s,["filter"]);return e!==void 0&&r!=null&&f(e,["_query","filter"],r),n}function nR(s,e,t){let n={},i=h(s,["pageSize"]);e!==void 0&&i!=null&&f(e,["_query","pageSize"],i);let o=h(s,["pageToken"]);e!==void 0&&o!=null&&f(e,["_query","pageToken"],o);let r=h(s,["filter"]);return e!==void 0&&r!=null&&f(e,["_query","filter"],r),n}function iR(s,e){let t={},n=h(s,["config"]);return n!=null&&tR(n,t),t}function sR(s,e){let t={},n=h(s,["config"]);return n!=null&&nR(n,t),t}function oR(s,e){let t={},n=h(s,["sdkHttpResponse"]);n!=null&&f(t,["sdkHttpResponse"],n);let i=h(s,["nextPageToken"]);i!=null&&f(t,["nextPageToken"],i);let o=h(s,["tunedModels"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>m_(a))),f(t,["tuningJobs"],r)}return t}function rR(s,e){let t={},n=h(s,["sdkHttpResponse"]);n!=null&&f(t,["sdkHttpResponse"],n);let i=h(s,["nextPageToken"]);i!=null&&f(t,["nextPageToken"],i);let o=h(s,["tuningJobs"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>im(a))),f(t,["tuningJobs"],r)}return t}function aR(s,e){let t={},n=h(s,["name"]);n!=null&&f(t,["model"],n);let i=h(s,["name"]);return i!=null&&f(t,["endpoint"],i),t}function lR(s,e){let t={};if(h(s,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(h(s,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=h(s,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>o)),f(t,["examples","examples"],i)}return t}function cR(s,e,t){let n={},i=h(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let r=h(s,["gcsUri"]);e!==void 0&&r!=null&&f(e,["supervisedTuningSpec","trainingDatasetUri"],r)}else if(i==="PREFERENCE_TUNING"){let r=h(s,["gcsUri"]);e!==void 0&&r!=null&&f(e,["preferenceOptimizationSpec","trainingDatasetUri"],r)}let o=h(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let r=h(s,["vertexDatasetResource"]);e!==void 0&&r!=null&&f(e,["supervisedTuningSpec","trainingDatasetUri"],r)}else if(o==="PREFERENCE_TUNING"){let r=h(s,["vertexDatasetResource"]);e!==void 0&&r!=null&&f(e,["preferenceOptimizationSpec","trainingDatasetUri"],r)}if(h(s,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function m_(s,e){let t={},n=h(s,["sdkHttpResponse"]);n!=null&&f(t,["sdkHttpResponse"],n);let i=h(s,["name"]);i!=null&&f(t,["name"],i);let o=h(s,["state"]);o!=null&&f(t,["state"],qA(o));let r=h(s,["createTime"]);r!=null&&f(t,["createTime"],r);let a=h(s,["tuningTask","startTime"]);a!=null&&f(t,["startTime"],a);let l=h(s,["tuningTask","completeTime"]);l!=null&&f(t,["endTime"],l);let c=h(s,["updateTime"]);c!=null&&f(t,["updateTime"],c);let d=h(s,["description"]);d!=null&&f(t,["description"],d);let p=h(s,["baseModel"]);p!=null&&f(t,["baseModel"],p);let g=h(s,["_self"]);return g!=null&&f(t,["tunedModel"],aR(g)),t}function im(s,e){let t={},n=h(s,["sdkHttpResponse"]);n!=null&&f(t,["sdkHttpResponse"],n);let i=h(s,["name"]);i!=null&&f(t,["name"],i);let o=h(s,["state"]);o!=null&&f(t,["state"],qA(o));let r=h(s,["createTime"]);r!=null&&f(t,["createTime"],r);let a=h(s,["startTime"]);a!=null&&f(t,["startTime"],a);let l=h(s,["endTime"]);l!=null&&f(t,["endTime"],l);let c=h(s,["updateTime"]);c!=null&&f(t,["updateTime"],c);let d=h(s,["error"]);d!=null&&f(t,["error"],d);let p=h(s,["description"]);p!=null&&f(t,["description"],p);let g=h(s,["baseModel"]);g!=null&&f(t,["baseModel"],g);let m=h(s,["tunedModel"]);m!=null&&f(t,["tunedModel"],m);let y=h(s,["preTunedModel"]);y!=null&&f(t,["preTunedModel"],y);let A=h(s,["supervisedTuningSpec"]);A!=null&&f(t,["supervisedTuningSpec"],A);let _=h(s,["preferenceOptimizationSpec"]);_!=null&&f(t,["preferenceOptimizationSpec"],_);let E=h(s,["tuningDataStats"]);E!=null&&f(t,["tuningDataStats"],E);let C=h(s,["encryptionSpec"]);C!=null&&f(t,["encryptionSpec"],C);let S=h(s,["partnerModelTuningSpec"]);S!=null&&f(t,["partnerModelTuningSpec"],S);let b=h(s,["customBaseModel"]);b!=null&&f(t,["customBaseModel"],b);let x=h(s,["experiment"]);x!=null&&f(t,["experiment"],x);let P=h(s,["labels"]);P!=null&&f(t,["labels"],P);let I=h(s,["outputUri"]);I!=null&&f(t,["outputUri"],I);let N=h(s,["pipelineJob"]);N!=null&&f(t,["pipelineJob"],N);let M=h(s,["serviceAccount"]);M!=null&&f(t,["serviceAccount"],M);let F=h(s,["tunedModelDisplayName"]);F!=null&&f(t,["tunedModelDisplayName"],F);let U=h(s,["veoTuningSpec"]);return U!=null&&f(t,["veoTuningSpec"],U),t}function uR(s,e){let t={},n=h(s,["sdkHttpResponse"]);n!=null&&f(t,["sdkHttpResponse"],n);let i=h(s,["name"]);i!=null&&f(t,["name"],i);let o=h(s,["metadata"]);o!=null&&f(t,["metadata"],o);let r=h(s,["done"]);r!=null&&f(t,["done"],r);let a=h(s,["error"]);return a!=null&&f(t,["error"],a),t}function LA(s,e){let t={},n=h(s,["gcsUri"]);n!=null&&f(t,["validationDatasetUri"],n);let i=h(s,["vertexDatasetResource"]);return i!=null&&f(t,["validationDatasetUri"],i),t}var sm=class extends Wt{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new $n(On.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var n;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let i={tunedModelName:t.baseModel};!((n=t.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(i.checkpointId=t.config.preTunedModelCheckpointId);let o=Object.assign(Object.assign({},t),{preTunedModel:i});return o.baseModel=void 0,await this.tuneInternal(o)}else{let i=Object.assign({},t);return await this.tuneInternal(i)}else{let i=Object.assign({},t),o=await this.tuneMldevInternal(i),r="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?r=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(r=o.name.split("/operations/")[0]),{name:r,state:fg.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=eR(e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>im(d))}else{let c=jI(e);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>m_(d))}}async listInternal(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=sR(e);return a=D("tuningJobs",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=rR(d),g=new hd;return Object.assign(g,p),g})}else{let c=iR(e);return a=D("tunedModels",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=oR(d),g=new hd;return Object.assign(g,p),g})}}async cancel(e){var t,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=WI(e);return a=D("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=YI(d),g=new fd;return Object.assign(g,p),g})}else{let c=zI(e);return a=D("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=KI(d),g=new fd;return Object.assign(g,p),g})}}async tuneInternal(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=QI(e,e);return o=D("tuningJobs",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>im(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=ZI(e);return o=D("tunedModels",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>uR(l))}}};var om=class{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},dR=1024*1024*8,hR=3,fR=1e3,pR=2,Dd="x-goog-upload-status";async function gR(s,e,t){var n;let i=await y_(s,e,t),o=await(i==null?void 0:i.json());if(((n=i==null?void 0:i.headers)===null||n===void 0?void 0:n[Dd])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function mR(s,e,t){var n;let i=await y_(s,e,t),o=await(i==null?void 0:i.json());if(((n=i==null?void 0:i.headers)===null||n===void 0?void 0:n[Dd])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let r=OA(o),a=new Ig;return Object.assign(a,r),a}async function y_(s,e,t){var n,i;let o=0,r=0,a=new Ya(new Response),l="upload";for(o=s.size;r<o;){let c=Math.min(dR,o-r),d=s.slice(r,r+c);r+c>=o&&(l+=", finalize");let p=0,g=fR;for(;p<hR&&(a=await t.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(r),"Content-Length":String(c)}}}),!(!((n=a==null?void 0:a.headers)===null||n===void 0)&&n[Dd]));)p++,await vR(g),g=g*pR;if(r+=c,((i=a==null?void 0:a.headers)===null||i===void 0?void 0:i[Dd])!=="active")break;if(o<=r)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function yR(s){return{size:s.size,type:s.type}}function vR(s){return new Promise(e=>setTimeout(e,s))}var rm=class{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await gR(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await mR(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await yR(e)}};var am=class{create(e,t,n){return new lm(e,t,n)}},lm=class{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var UA="x-goog-api-key",cm=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(UA)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(UA,this.apiKey)}}};var wR="gl-node/",Fd=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e!=null&&e.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new we({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e==null?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;let n=JE(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let i=new cm(this.apiKey);this.apiClient=new $g({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:wR+"web",uploader:new rm,downloader:new om}),this.models=new zg(this.apiClient),this.live=new Vg(this.apiClient,i,new am),this.batches=new Mg(this.apiClient),this.chats=new kg(this.models,this.apiClient),this.caches=new Ng(this.apiClient),this.files=new Fg(this.apiClient),this.operations=new Wg(this.apiClient),this.authTokens=new Kg(this.apiClient),this.tunings=new sm(this.apiClient),this.fileSearchStores=new Jg(this.apiClient)}};var v_=`\uB108\uB294 \uB098\uC758 \uAC1C\uC778 \uC9C0\uC2DD\uAD00\uB9AC \uC2DC\uC2A4\uD15C\uC5D0\uC11C \uB178\uD2B8\uB97C \uD504\uB85C\uC81D\uD2B8\uBCC4\uB85C \uBD84\uB958\uD558\uB294 \uBE44\uC11C\uB2E4.
\uC544\uB798 \uB178\uD2B8 \uB0B4\uC6A9\uC744 \uC77D\uACE0 \uC5B4\uB5A4 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC18D\uD558\uB294\uC9C0 **\uC2E0\uC911\uD558\uAC8C** \uD310\uB2E8\uD574\uB77C.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uBD84\uB958 \uADDC\uCE59 (\uC911\uC694\uB3C4 \uC21C)

### 1. \uD504\uB85C\uC81D\uD2B8 \uC0B0\uCD9C\uBB3C (contentType: "artifact")
\uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC9C1\uC811 \uC800\uC7A5\uD574\uC57C \uD560 \uAC83:
- \uC9C1\uC811 \uC791\uC131\uD55C \uBB38\uC11C, \uACC4\uD68D\uC11C, \uD68C\uC758\uB85D
- \uD504\uB85C\uC81D\uD2B8\uB97C \uC704\uD574 \uB9CC\uB4E0 \uCF54\uB4DC, \uC124\uACC4\uC11C
- \uD504\uB85C\uC81D\uD2B8 \uC9C4\uD589 \uAD00\uB828 \uBA54\uBAA8

### 2. \uD504\uB85C\uC81D\uD2B8 \uCC38\uACE0\uC790\uB8CC (contentType: "reference")
Library\uC5D0 \uC800\uC7A5\uD558\uB418 \uD504\uB85C\uC81D\uD2B8\uC640 \uB9C1\uD06C\uD574\uC57C \uD560 \uAC83:
- \uC678\uBD80 \uD29C\uD1A0\uB9AC\uC5BC, \uC608\uC81C \uCF54\uB4DC, \uBB38\uC11C
- \uC6F9\uD398\uC774\uC9C0 \uC2A4\uD06C\uB7A9, \uC544\uD2F0\uD074
- \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uC790\uB8CC
- \uC608: "ESP32 \uC608\uC81C" \u2192 \uD30C\uCE20\uD31C\uC5D0 \uC720\uC6A9\uD558\uC9C0\uB9CC Library\uC5D0 \uC800\uC7A5

### 3. \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC (targetType: "library", contentType: "general")
- \uD2B9\uC815 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828 \uC5C6\uB294 \uC77C\uBC18 \uC815\uBCF4
- \uB274\uC2A4, \uACF5\uACE0, \uC77C\uBC18 \uC544\uD2F0\uD074

### 4. archive
- \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83

## \uD310\uB2E8 \uAE30\uC900
- "\uC774\uAC74 \uB0B4\uAC00 \uC9C1\uC811 \uB9CC\uB4E0 \uC0B0\uCD9C\uBB3C\uC778\uAC00?" \u2192 artifact
- "\uC774\uAC74 \uC678\uBD80 \uC790\uB8CC\uC778\uB370 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC720\uC6A9\uD55C\uAC00?" \u2192 reference
- "\uC774\uAC74 \uADF8\uB0E5 \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC\uC778\uAC00?" \u2192 general
- "\uD504\uB85C\uC81D\uD2B8 \uB05D\uB098\uB3C4 \uACC4\uC18D \uCC38\uACE0\uD560 \uC790\uB8CC\uC778\uAC00?" \u2192 reference (Library)

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "targetType": "project \uB610\uB294 library \uB610\uB294 archive",
  "contentType": "artifact \uB610\uB294 reference \uB610\uB294 general",
  "projectName": "\uD504\uB85C\uC81D\uD2B8\uBA85 (project \uB610\uB294 reference\uC77C \uB54C)",
  "isNewProject": true/false,
  "confidence": "high \uB610\uB294 medium \uB610\uB294 low",
  "reason": "\uC774 \uBD84\uB958\uB97C \uC120\uD0DD\uD55C \uC774\uC720 (1\uC904)",
  "title": "\uB178\uD2B8 \uC81C\uBAA9",
  "summary": "2-3\uBB38\uC7A5 \uC694\uC57D",
  "nextAction": "\uB2E4\uC74C \uD589\uB3D9 \uB610\uB294 null"
}
`,w_=`\uB108\uB294 \uC81C\uD154\uCE74\uC2A4\uD150(Zettelkasten) \uBC29\uC2DD\uC758 \uC601\uAD6C \uB178\uD2B8\uB97C \uB9CC\uB4DC\uB294 \uBE44\uC11C\uB2E4.
\uC544\uB798 \uB178\uD2B8\uC5D0\uC11C \uC81C\uD154\uCE74\uC2A4\uD150\uC6A9 \uC601\uAD6C \uB178\uD2B8 \uD6C4\uBCF4 \uC544\uC774\uB514\uC5B4\uB4E4\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uD55C \uB178\uD2B8\uC5D0\uB294 \uD558\uB098\uC758 \uC544\uC774\uB514\uC5B4\uB9CC \uB2F4\uB294\uB2E4 (atomic note)
- \uAC01 \uC544\uC774\uB514\uC5B4\uB294 3-5\uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD55C\uB2E4
- \uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C
- \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC5F0\uACB0\uB420 \uC218 \uC788\uB294 \uAC1C\uB150 2-3\uAC1C\uB97C \uC81C\uC548\uD574\uB77C
- \uC544\uC774\uB514\uC5B4\uB9C8\uB2E4 \uC5F0\uAD00 \uD0A4\uC6CC\uB4DC\uB97C \uD568\uAED8 \uC801\uC5B4\uB77C

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uC544\uC774\uB514\uC5B4\uB97C \uD55C \uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD558\uB294 \uC81C\uBAA9",
    "body": "3-5\uBB38\uC7A5\uC758 \uC124\uBA85",
    "importance": "\uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uAC00? (1\uC904)",
    "relatedConcepts": ["\uAC1C\uB1501", "\uAC1C\uB1502", "\uAC1C\uB1503"],
    "keywords": ["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3"]
  }
]

\uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uC744 \uBC18\uD658\uD574\uB77C.
`,A_=`\uB108\uB294 \uB098\uC758 \uC791\uC5C5 \uC6B0\uC120\uC21C\uC704 \uCF54\uCE58\uB2E4.
\uC544\uB798 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D\uC744 \uBCF4\uACE0, \uC9C0\uAE08 \uB0B4\uAC00 \uC9D1\uC911\uD574\uC57C \uD560 \uC0C1\uC704 3\uAC1C\uB9CC \uACE8\uB77C\uB77C.

## \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uAC01 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uB300\uD574 \uB2E4\uC74C\uC744 \uC81C\uACF5\uD574\uB77C
- title: \uD504\uB85C\uC81D\uD2B8 \uC774\uB984
- why: \uC65C \uC9C0\uAE08 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904 \uC124\uBA85
- next_action: \uC624\uB298 \uB2F9\uC7A5 \uD560 \uC218 \uC788\uB294 \uAC00\uC7A5 \uC791\uC740 \uB2E4\uC74C \uD589\uB3D9

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uD504\uB85C\uC81D\uD2B8 \uC774\uB984",
    "why": "\uC911\uC694\uD55C \uC774\uC720",
    "next_action": "\uB2E4\uC74C \uD589\uB3D9"
  }
]
`,__=`\uC774 \uC774\uBBF8\uC9C0\uC5D0\uC11C \uD14D\uC2A4\uD2B8\uB97C \uCD94\uCD9C\uD574\uB77C.
\uC190\uAE00\uC528, \uC778\uC1C4\uBB3C, \uC2A4\uCE94 \uBB38\uC11C \uB4F1 \uBAA8\uB4E0 \uD615\uD0DC\uC758 \uD14D\uC2A4\uD2B8\uB97C \uC77D\uC5B4\uB77C.

## \uADDC\uCE59
- \uC774\uBBF8\uC9C0\uC5D0 \uBCF4\uC774\uB294 \uBAA8\uB4E0 \uD14D\uC2A4\uD2B8\uB97C \uADF8\uB300\uB85C \uCD94\uCD9C
- \uC6D0\uBCF8\uC758 \uC904\uBC14\uAFC8\uACFC \uAD6C\uC870\uB97C \uCD5C\uB300\uD55C \uC720\uC9C0
- \uD45C\uAC00 \uC788\uC73C\uBA74 \uB9C8\uD06C\uB2E4\uC6B4 \uD45C\uB85C \uBCC0\uD658
- \uC77D\uC744 \uC218 \uC5C6\uB294 \uBD80\uBD84\uC740 [\uBD88\uBA85\uD655] \uC73C\uB85C \uD45C\uC2DC
- \uD14D\uC2A4\uD2B8\uB9CC \uCD9C\uB825\uD558\uACE0 \uB2E4\uB978 \uC124\uBA85\uC740 \uD558\uC9C0 \uB9C8\uB77C
`,T_=`\uB178\uD2B8 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD575\uC2EC \uD0A4\uC6CC\uB4DC 5-10\uAC1C\uB97C \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uAE30\uC220 \uC6A9\uC5B4, \uD504\uB85C\uC81D\uD2B8\uBA85, \uC8FC\uC694 \uAC1C\uB150 \uC704\uC8FC\uB85C \uCD94\uCD9C
- \uB108\uBB34 \uC77C\uBC18\uC801\uC778 \uB2E8\uC5B4 (\uC608: \uBC29\uBC95, \uB0B4\uC6A9, \uC815\uBCF4)\uB294 \uC81C\uC678
- \uD55C\uAE00/\uC601\uC5B4 \uBAA8\uB450 \uAC00\uB2A5
- \uBCF5\uD569 \uBA85\uC0AC\uB294 \uBD84\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C (\uC608: "\uC2A4\uB9C8\uD2B8\uD31C", "API\uD0A4")

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3", ...]
`,E_=`\uC0C8 \uB178\uD2B8\uC640 \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4\uC758 \uAD00\uB828\uC131\uC744 \uBD84\uC11D\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {newTitle}
\uD0A4\uC6CC\uB4DC: {newKeywords}

## \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4
{candidates}

## \uADDC\uCE59
- \uAC01 \uD6C4\uBCF4 \uB178\uD2B8\uC5D0 \uB300\uD574 \uAD00\uB828\uB3C4 \uC810\uC218(0.0~1.0)\uB97C \uB9E4\uACA8\uB77C
- 0.5 \uC774\uC0C1\uC778 \uB178\uD2B8\uB9CC \uBC18\uD658
- \uCD5C\uB300 5\uAC1C\uAE4C\uC9C0\uB9CC \uBC18\uD658
- \uAD00\uB828\uB3C4 \uB192\uC740 \uC21C\uC73C\uB85C \uC815\uB82C
- \uAC01 \uC5F0\uACB0\uC758 "\uC774\uC720"\uB97C \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C (\uC65C \uAD00\uB828\uC788\uB294\uAC00?)
- \uC5F0\uACB0 \uC720\uD615 \uBD84\uB958: \uD655\uC7A5|\uBC18\uBC15|\uC608\uC2DC|\uC804\uC81C|\uC751\uC6A9 \uC911 \uD558\uB098

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
[
  {
    "index": 0,
    "relevance": 0.8,
    "reason": "\uC774 \uB178\uD2B8\uC640 \uAD00\uB828\uC788\uB294 \uAD6C\uCCB4\uC801 \uC774\uC720",
    "type": "\uD655\uC7A5"
  }
]
`,C_=`\uC0C8 \uB178\uD2B8\uAC00 \uC5B4\uB5A4 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828\uC788\uB294\uC9C0 **\uC2E0\uC911\uD558\uAC8C** \uD310\uB2E8\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {noteTitle}
\uD0A4\uC6CC\uB4DC: {noteKeywords}

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- \uB178\uD2B8\uC758 **\uD575\uC2EC \uC8FC\uC81C**\uAC00 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB420 \uB54C\uB9CC \uD504\uB85C\uC81D\uD2B8 \uC120\uD0DD
- \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
- **\uD655\uC2E4\uD558\uC9C0 \uC54A\uC73C\uBA74 "None" \uBC18\uD658** (\uC798\uBABB\uB41C \uBD84\uB958\uBCF4\uB2E4 \uB098\uC74C)
- \uC77C\uBC18\uC801\uC778 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 \u2192 "None"
- \uC0C8\uB85C\uC6B4 \uD504\uB85C\uC81D\uD2B8\uB85C \uBCF4\uC774\uBA74 "NEW: \uD504\uB85C\uC81D\uD2B8\uBA85" \uD615\uC2DD\uC73C\uB85C \uBC18\uD658

## \uCD9C\uB825 \uD615\uC2DD (\uD504\uB85C\uC81D\uD2B8\uBA85\uB9CC \uC751\uB2F5)
\uD504\uB85C\uC81D\uD2B8\uBA85 \uB610\uB294 None \uB610\uB294 NEW: \uC0C8\uD504\uB85C\uC81D\uD2B8\uBA85
`,S_=`\uC720\uD29C\uBE0C \uC601\uC0C1\uC758 \uC790\uB9C9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uC790\uB9C9 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,b_=`\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBCF8\uBB38 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uAE00\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uAD11\uACE0\uB098 \uAD00\uB828 \uC5C6\uB294 \uB0B4\uC6A9\uC740 \uBB34\uC2DC\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,x_=`\uB108\uB294 \uBA54\uBAA8\uB97C \uBD84\uC11D\uD558\uC5EC \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uBCC4\uB85C \uBD84\uB9AC\uD558\uB294 \uBE44\uC11C\uB2E4.
\uD558\uB098\uC758 \uBA54\uBAA8\uC5D0 \uC5EC\uB7EC \uC8FC\uC81C\uB098 \uD504\uB85C\uC81D\uD2B8 \uAD00\uB828 \uB0B4\uC6A9\uC774 \uC11E\uC5EC \uC788\uC744 \uC218 \uC788\uB2E4.
\uAC01\uAC01\uC744 \uB3C5\uB9BD\uC801\uC778 \uB178\uD2B8\uB85C \uBD84\uB9AC\uD574\uB77C.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D (\uCC38\uACE0\uC6A9)
{projects}

## \uBA54\uBAA8 \uB0B4\uC6A9
{content}

## \uBD84\uB9AC \uADDC\uCE59
- \uC11C\uB85C \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uB294 \uBC18\uB4DC\uC2DC \uBD84\uB9AC\uD574\uB77C
- \uD55C \uC904\uC9DC\uB9AC \uBA54\uBAA8\uB3C4 \uC758\uBBF8\uAC00 \uC788\uC73C\uBA74 \uBD84\uB9AC \uB300\uC0C1\uC774\uB2E4
- \uAD00\uB828 \uB0B4\uC6A9\uC740 \uD558\uB098\uB85C \uBB36\uC5B4\uB77C (\uACFC\uB3C4\uD55C \uBD84\uB9AC \uAE08\uC9C0)
- \uAC01 \uC139\uC158\uC5D0 \uC801\uC808\uD55C \uC81C\uBAA9\uC744 \uBD99\uC5EC\uB77C

## \uBD84\uB958 \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- **project**: \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB41C \uB0B4\uC6A9\uB9CC
  - \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
  - \uC608: "\uC2A4\uB9C8\uD2B8\uD31C" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC788\uC5B4\uB3C4 "\uB18D\uC5C5 \uB274\uC2A4"\uB294 library
- **library**: \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 (**\uC560\uB9E4\uD558\uBA74 library**)
- **archive**: \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83
- \uC0C8 \uD504\uB85C\uC81D\uD2B8: \uBA85\uD655\uD55C \uBAA9\uD45C\uAC00 \uC788\uB294 \uC0C8\uB85C\uC6B4 \uC791\uC5C5\uC77C \uB54C\uB9CC isNewProject: true

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uBD84\uB9AC\uB41C \uC139\uC158\uC758 \uC81C\uBAA9",
    "content": "\uD574\uB2F9 \uC139\uC158\uC758 \uC6D0\uBCF8 \uB0B4\uC6A9 (\uC815\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C)",
    "targetType": "project",
    "projectName": "\uC2A4\uB9C8\uD2B8\uD31C",
    "isNewProject": false,
    "keywords": ["\uC13C\uC11C", "\uB370\uC774\uD130", "IoT"],
    "isAtomic": false
  }
]

\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC73C\uBA74 \uC804\uCCB4\uB97C \uD558\uB098\uC758 \uC139\uC158\uC73C\uB85C \uBC18\uD658\uD574\uB77C.
`,I_=`\uC8FC\uC81C\uC5D0 \uC18D\uD55C ZK \uB178\uD2B8\uB4E4\uC744 \uBD84\uC11D\uD558\uC5EC \uAD6C\uC870\uD654\uB41C \uC124\uBA85\uC744 \uC0DD\uC131\uD574\uB77C.

## \uC8FC\uC81C
{topic}

## \uB178\uD2B8 \uBAA9\uB85D
{notes}

## \uADDC\uCE59
- \uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85 \uC791\uC131
- \uAC01 \uB178\uD2B8\uC758 \uC5ED\uD560/\uC704\uCE58 \uC124\uBA85 (\uAE30\uCD08, \uC2EC\uD654, \uC751\uC6A9, \uC608\uC2DC \uC911 \uD558\uB098)
- \uB178\uD2B8 \uAC04 \uAD00\uACC4 \uD45C\uC2DC (\uBC1C\uC804, \uAE30\uBC18, \uAD00\uB828 \uC911 \uD558\uB098)
- \uAD00\uB828 \uC8FC\uC81C 2-3\uAC1C \uC81C\uC548

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "description": "\uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85",
  "notes": [
    {
      "title": "\uB178\uD2B8 \uC81C\uBAA9",
      "role": "\uAE30\uCD08",
      "relations": [{"target": "\uB2E4\uB978\uB178\uD2B8\uC81C\uBAA9", "type": "\uBC1C\uC804"}]
    }
  ],
  "relatedTopics": ["\uAD00\uB828\uC8FC\uC81C1", "\uAD00\uB828\uC8FC\uC81C2"]
}
`,R_=`PDF/\uC774\uBBF8\uC9C0 \uBB38\uC11C \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBB38\uC11C \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uBB38\uC11C\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD398\uC774\uC9C0 \uAD6C\uBD84\uC740 \uBB34\uC2DC\uD558\uACE0 \uC804\uCCB4 \uB0B4\uC6A9\uC744 \uD1B5\uD569\uD574\uC11C \uBD84\uC11D\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uBB38\uC11C \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,P_=`\uD68C\uC758 \uB179\uC74C\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uC758\uB85D\uC744 \uC791\uC131\uD574\uB77C.

## \uADDC\uCE59
1. **\uC804\uC0AC(Transcription)**: \uC74C\uC131\uC744 \uD14D\uC2A4\uD2B8\uB85C \uBCC0\uD658. \uD654\uC790 \uAD6C\uBD84\uC774 \uAC00\uB2A5\uD558\uBA74 "\uD654\uC7901:", "\uD654\uC7902:" \uD615\uC2DD\uC73C\uB85C \uD45C\uC2DC
2. **\uC694\uC57D**: \uD68C\uC758 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
3. **\uC561\uC158 \uC544\uC774\uD15C**: \uB204\uAC00 \uBB34\uC5C7\uC744 \uC5B8\uC81C\uAE4C\uC9C0 \uD560\uC9C0 \uCD94\uCD9C. \uBA85\uC2DC\uB418\uC9C0 \uC54A\uC740 \uD56D\uBAA9\uC740 null
4. **\uACB0\uC815\uC0AC\uD56D**: \uD68C\uC758\uC5D0\uC11C \uACB0\uC815\uB41C \uC0AC\uD56D\uB4E4
5. **\uB2E4\uC74C \uD68C\uC758 \uC548\uAC74**: \uD6C4\uC18D \uB17C\uC758\uAC00 \uD544\uC694\uD55C \uC8FC\uC81C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD68C\uC758 \uC81C\uBAA9 (\uC8FC\uC81C \uAE30\uBC18\uC73C\uB85C \uC0DD\uC131)",
  "transcription": "\uC804\uCCB4 \uB300\uD654 \uB0B4\uC6A9 (\uD654\uC790 \uAD6C\uBD84 \uD3EC\uD568)",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "actionItems": [
    {"task": "\uD560 \uC77C", "assignee": "\uB2F4\uB2F9\uC790 \uB610\uB294 null", "deadline": "\uAE30\uD55C \uB610\uB294 null"}
  ],
  "decisions": ["\uACB0\uC815\uC0AC\uD56D1", "\uACB0\uC815\uC0AC\uD56D2"],
  "nextAgenda": ["\uB2E4\uC74C \uC548\uAC741", "\uB2E4\uC74C \uC548\uAC742"]
}

\uC561\uC158 \uC544\uC774\uD15C, \uACB0\uC815\uC0AC\uD56D, \uB2E4\uC74C \uC548\uAC74\uC774 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uB85C \uBC18\uD658\uD574\uB77C.
`,M_=`\uB108\uB294 \uB098\uC758 \uC0DD\uC0B0\uC131 \uCF54\uCE58\uB2E4.
\uC8FC\uC5B4\uC9C4 \uAE30\uAC04 \uB3D9\uC548\uC758 \uC791\uC5C5 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uACE0 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uB77C.

## \uAE30\uAC04
{period} ({dateRange})

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5 \uB0B4\uC6A9
{projectData}

## \uBD84\uC11D \uADDC\uCE59
1. \uC804\uCCB4 \uC694\uC57D: \uC774 \uAE30\uAC04\uC758 \uC791\uC5C5\uC744 2-3\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
2. \uC8FC\uC694 \uC8FC\uC81C: \uB2E4\uB8EC \uD575\uC2EC \uC8FC\uC81C 3-5\uAC1C \uCD94\uCD9C
3. \uC778\uC0AC\uC774\uD2B8: \uBC1C\uACAC\uD55C \uC810, \uBC30\uC6B4 \uC810, \uD328\uD134 3-5\uAC1C
4. \uB2E4\uC74C \uC561\uC158: \uD6C4\uC18D\uC73C\uB85C \uD574\uC57C \uD560 \uAD6C\uCCB4\uC801\uC778 \uD589\uB3D9 3-5\uAC1C
5. \uC791\uC5C5 \uD328\uD134: \uC791\uC5C5 \uBC29\uC2DD\uC5D0\uC11C \uBC1C\uACAC\uB41C \uD328\uD134 (\uC120\uD0DD)

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "summary": "\uC804\uCCB4 \uC694\uC57D (2-3\uBB38\uC7A5)",
  "mainTopics": ["\uC8FC\uC81C1", "\uC8FC\uC81C2", "\uC8FC\uC81C3"],
  "insights": ["\uC778\uC0AC\uC774\uD2B81", "\uC778\uC0AC\uC774\uD2B82", "\uC778\uC0AC\uC774\uD2B83"],
  "nextActions": ["\uC561\uC1581", "\uC561\uC1582", "\uC561\uC1583"],
  "patterns": "\uC791\uC5C5 \uD328\uD134 \uBD84\uC11D (\uC120\uD0DD, \uC5C6\uC73C\uBA74 null)"
}
`,N_=`\uB178\uD2B8 \uB0B4\uC6A9\uC5D0\uC11C \uC77C\uC815/\uD560\uC77C/\uC57D\uC18D\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uC624\uB298 \uB0A0\uC9DC
{today}

## \uCD94\uCD9C \uADDC\uCE59
- \uB0A0\uC9DC/\uC2DC\uAC04\uC774 \uC5B8\uAE09\uB41C \uBAA8\uB4E0 \uC77C\uC815 \uCD94\uCD9C
- \uC0C1\uB300\uC801 \uB0A0\uC9DC\uB97C \uC808\uB300 \uB0A0\uC9DC\uB85C \uBCC0\uD658:
  - "\uB0B4\uC77C" \u2192 \uC624\uB298 + 1\uC77C
  - "\uBAA8\uB808" \u2192 \uC624\uB298 + 2\uC77C
  - "\uB2E4\uC74C \uC8FC \uC6D4\uC694\uC77C" \u2192 \uB2E4\uC74C \uC8FC \uC6D4\uC694\uC77C \uB0A0\uC9DC
  - "\uC774\uBC88 \uC8FC \uAE08\uC694\uC77C" \u2192 \uC774\uBC88 \uC8FC \uAE08\uC694\uC77C \uB0A0\uC9DC
  - "\uB2E4\uC74C \uB2EC" \u2192 \uB2E4\uC74C \uB2EC 1\uC77C
- \uC2DC\uAC04\uC774 \uC5C6\uC73C\uBA74 time\uC744 null\uB85C
- type \uAD6C\uBD84:
  - "event": \uC57D\uC18D, \uBBF8\uD305, \uD68C\uC758, \uBC1C\uD45C, \uBC29\uBB38 \uB4F1 \uD2B9\uC815 \uC2DC\uC810\uC758 \uD65C\uB3D9
  - "task": \uB9C8\uAC10\uC77C, \uC81C\uCD9C, \uC644\uB8CC\uD574\uC57C \uD560 \uC77C

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4)
[
  {
    "title": "\uC77C\uC815 \uC81C\uBAA9",
    "date": "2026-01-15",
    "time": "14:00",
    "type": "event"
  },
  {
    "title": "\uBCF4\uACE0\uC11C \uC81C\uCD9C",
    "date": "2026-01-17",
    "time": null,
    "type": "task"
  }
]

\uC77C\uC815\uC774 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 [] \uBC18\uD658.
`;var AR=1e3,_R=3,TR=2e3,qe="gemini-3-flash-preview",$d=class{constructor(e){this.lastRequestTime=0;this.minDelayMs=AR;this.ai=new Fd({apiKey:e})}async waitForRateLimit(){let t=Date.now()-this.lastRequestTime;if(t<this.minDelayMs){let n=this.minDelayMs-t;await this.delay(n)}this.lastRequestTime=Date.now()}delay(e){return new Promise(t=>setTimeout(t,e))}async callWithRetry(e,t=_R){await this.waitForRateLimit();for(let n=0;n<=t;n++)try{return await e()}catch(i){if(i instanceof Error&&(i.message.includes("429")||i.message.includes("RESOURCE_EXHAUSTED")||i.message.includes("quota"))&&n<t){let r=TR*Math.pow(2,n);console.log(`Rate limit hit, retrying in ${r/1e3}s... (attempt ${n+1}/${t})`),await this.delay(r),this.minDelayMs=Math.min(this.minDelayMs*1.5,5e3)}else throw i}throw new Error("Max retries exceeded")}async classifyProject(e,t){var a;let n=t.length>0?t.map((l,c)=>`${c+1}. ${l}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",i=v_.replace("{projects}",n).replace("{content}",e),r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:i}))).text)!=null?a:"";return this.parseProjectResponse(r)}async extractZK(e){var o;let t=w_.replace("{content}",e),i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:t}))).text)!=null?o:"";return this.parseZKResponse(i)}async getFocus(e){var o;let t=A_.replace("{projects}",e),i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:t}))).text)!=null?o:"";return this.parseFocusResponse(i)}parseProjectResponse(e){var n;let t=e.match(/\{[\s\S]*\}/);if(!t)throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: JSON \uC5C6\uC74C");try{let i=JSON.parse(t[0]);return{targetType:this.validateTargetType(i.targetType),projectName:i.projectName||void 0,isNewProject:(n=i.isNewProject)!=null?n:!1,title:i.title||"Untitled",summary:i.summary||"",nextAction:i.nextAction||null}}catch(i){throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: "+e)}}parseZKResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{return JSON.parse(t[0]).map(i=>({title:i.title,body:i.body,keywords:i.keywords||[],importance:i.importance||"",relatedConcepts:i.relatedConcepts||[]}))}catch(n){return console.error("ZK \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}parseFocusResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{return JSON.parse(t[0]).map(i=>({title:i.title,why:i.why,nextAction:i.next_action}))}catch(n){return console.error("Focus \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async extractTextFromImage(e,t){var i;return(i=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:[{role:"user",parts:[{text:__},{inlineData:{mimeType:t,data:e}}]}]}))).text)!=null?i:""}async extractTextFromImages(e,t){let n=[];for(let i=0;i<e.length;i++){let o=e[i];t&&t(i+1,e.length);let r=await this.extractTextFromImage(o.base64,o.mimeType);n.push(r),i<e.length-1&&await this.delay(500)}return n}async extractKeywords(e){var o;let t=T_.replace("{content}",e),i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:t}))).text)!=null?o:"";return this.parseKeywordsResponse(i)}async findRelatedNotes(e,t,n){var a;let i=E_.replace("{newTitle}",e).replace("{newKeywords}",t.join(", ")).replace("{candidates}",n),r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:i}))).text)!=null?a:"";return this.parseRelatedNotesResponse(r)}async detectProject(e,t,n){var l;if(n.length===0)return null;let i=C_.replace("{noteTitle}",e).replace("{noteKeywords}",t.join(", ")).replace("{projects}",n.map((c,d)=>`${d+1}. ${c}`).join(`
`)),r=((l=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:i}))).text)!=null?l:"").trim();return r.toLowerCase()==="none"||r===""?null:r.startsWith("NEW:")?r:n.find(c=>r.toLowerCase().includes(c.toLowerCase()))||null}async summarizeContent(e,t){var a;let i=(t==="youtube"?S_:b_).replace("{content}",e),r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:i}))).text)!=null?a:"";return this.parseSummaryResponse(r)}async summarizePDF(e){var o;let t=R_.replace("{content}",e),i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:t}))).text)!=null?o:"";return this.parseSummaryResponse(i)}async analyzeYouTube(e){var o;let t=`\uC774 YouTube \uC601\uC0C1\uC744 \uBD84\uC11D\uD574\uC8FC\uC138\uC694.

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD654\uBA74\uC5D0 \uBCF4\uC774\uB294 \uD14D\uC2A4\uD2B8, \uC2AC\uB77C\uC774\uB4DC, \uCF54\uB4DC \uB4F1\uB3C4 \uCC38\uACE0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:[{role:"user",parts:[{fileData:{mimeType:"video/mp4",fileUri:e}},{text:t}]}]}))).text)!=null?o:"";return this.parseSummaryResponse(i)}async analyzeWebpage(e){var o;let t=`\uB2E4\uC74C \uC6F9\uD398\uC774\uC9C0\uB97C \uBD84\uC11D\uD574\uC8FC\uC138\uC694: ${e}

## \uADDC\uCE59
- \uD398\uC774\uC9C0\uC758 \uD575\uC2EC \uB0B4\uC6A9\uC744 \uC815\uD655\uD788 \uD30C\uC545\uD574\uB77C
- \uACF5\uACE0/\uBAA8\uC9D1\uC774\uBA74: \uB300\uC0C1, \uC870\uAC74, \uAE30\uAC04, \uD61C\uD0DD\uC744 \uAD6C\uCCB4\uC801\uC73C\uB85C
- \uB274\uC2A4/\uAE30\uC0AC\uBA74: \uD575\uC2EC \uC0AC\uC2E4, \uBC30\uACBD, \uC758\uBBF8\uB97C
- \uC81C\uD488/\uC11C\uBE44\uC2A4\uBA74: \uC8FC\uC694 \uAE30\uB2A5, \uAC00\uACA9, \uD2B9\uC9D5\uC744
- \uC77C\uBC18 \uC815\uBCF4\uBA74: \uD575\uC2EC \uBA54\uC2DC\uC9C0\uC640 \uC911\uC694 \uC138\uBD80\uC0AC\uD56D\uC744
- \uC804\uBB38 \uC6A9\uC5B4, \uACE0\uC720\uBA85\uC0AC, \uC22B\uC790\uB294 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD398\uC774\uC9C0 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D (\uAD6C\uCCB4\uC801\uC778 \uC815\uBCF4 \uD3EC\uD568)",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:t,config:{tools:[{urlContext:{}}]}}))).text)!=null?o:"";return this.parseSummaryResponse(i)}parseSummaryResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{title:"Untitled",summary:e.trim(),keyPoints:[]};try{let n=JSON.parse(t[0]);return{title:n.title||"Untitled",summary:n.summary||"",keyPoints:Array.isArray(n.keyPoints)?n.keyPoints:[]}}catch(n){return console.error("\uC694\uC57D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{title:"Untitled",summary:e.trim(),keyPoints:[]}}}parseKeywordsResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(i=>typeof i=="string"):[]}catch(n){return console.error("\uD0A4\uC6CC\uB4DC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}parseRelatedNotesResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(i=>typeof i=="object"&&typeof i.index=="number"&&typeof i.relevance=="number").filter(i=>i.relevance>=.5).sort((i,o)=>o.relevance-i.relevance).slice(0,5).map(i=>({index:i.index,relevance:i.relevance,reason:i.reason||"",type:i.type||""})):[]}catch(n){return console.error("\uAD00\uB828 \uB178\uD2B8 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async generateTopicStructure(e,t){var r;let n=I_.replace("{topic}",e).replace("{notes}",t),o=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:n}))).text)!=null?r:"";return this.parseTopicStructureResponse(o)}parseTopicStructureResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{description:"",notes:[],relatedTopics:[]};try{let n=JSON.parse(t[0]);return{description:n.description||"",notes:Array.isArray(n.notes)?n.notes:[],relatedTopics:Array.isArray(n.relatedTopics)?n.relatedTopics:[]}}catch(n){return console.error("\uC8FC\uC81C \uAD6C\uC870 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{description:"",notes:[],relatedTopics:[]}}}async splitContent(e,t){var a;let n=t.length>0?t.map((l,c)=>`${c+1}. ${l}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",i=x_.replace("{projects}",n).replace("{content}",e),r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:i}))).text)!=null?a:"";return this.parseSplitResponse(r)}parseSplitResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.map(i=>{var o,r;return{title:i.title||"Untitled",content:i.content||"",targetType:this.validateTargetType(i.targetType),project:i.projectName||void 0,isNewProject:(o=i.isNewProject)!=null?o:!1,keywords:Array.isArray(i.keywords)?i.keywords:[],isAtomic:(r=i.isAtomic)!=null?r:!1}}):[]}catch(n){return console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}validateTargetType(e){return["project","library","archive"].includes(e)?e:"library"}async analyzeReview(e,t,n){var p;let o={today:"\uC624\uB298",week:"\uC774\uBC88 \uC8FC",month:"\uC774\uBC88 \uB2EC",custom:"\uC0AC\uC6A9\uC790 \uC9C0\uC815 \uAE30\uAC04"}[e]||"\uAE30\uAC04",r=`${Vt(t.start,"auto")} ~ ${Vt(t.end,"auto")}`,a=n.map(g=>{let m=g.notes.map(y=>`  - ${y.title}${y.summary?`: ${y.summary}`:""}`).join(`
`);return`### ${g.projectName} (${g.noteCount}\uAC1C)
${m}`}).join(`

`),l=M_.replace("{period}",o).replace("{dateRange}",r).replace("{projectData}",a),d=(p=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:l}))).text)!=null?p:"";return this.parseReviewAnalysisResponse(d)}parseReviewAnalysisResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]};try{let n=JSON.parse(t[0]);return{summary:n.summary||"",mainTopics:Array.isArray(n.mainTopics)?n.mainTopics:[],insights:Array.isArray(n.insights)?n.insights:[],nextActions:Array.isArray(n.nextActions)?n.nextActions:[],patterns:n.patterns||void 0}}catch(n){return console.error("\uD68C\uACE0 \uBD84\uC11D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]}}}async analyzeMeeting(e,t,n){var a;console.log("\uD68C\uC758 \uB179\uC74C \uC5C5\uB85C\uB4DC \uC911...",n);let i=await this.ai.files.upload({file:e,config:{mimeType:t}});console.log("\uC5C5\uB85C\uB4DC \uC644\uB8CC:",i.uri);let r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:[{role:"user",parts:[{fileData:{fileUri:i.uri,mimeType:i.mimeType}},{text:P_}]}]}))).text)!=null?a:"";return this.parseMeetingResponse(r,n)}parseMeetingResponse(e,t){let n=e.match(/\{[\s\S]*\}/);if(!n)return{title:"\uD68C\uC758\uB85D",transcription:e.trim(),summary:"",actionItems:[],decisions:[],nextAgenda:[],sourceFile:t};try{let i=JSON.parse(n[0]);return{title:i.title||"\uD68C\uC758\uB85D",transcription:i.transcription||"",summary:i.summary||"",actionItems:Array.isArray(i.actionItems)?i.actionItems.map(o=>({task:o.task||"",assignee:o.assignee||null,deadline:o.deadline||null})):[],decisions:Array.isArray(i.decisions)?i.decisions:[],nextAgenda:Array.isArray(i.nextAgenda)?i.nextAgenda:[],sourceFile:t}}catch(i){return console.error("\uD68C\uC758\uB85D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{title:"\uD68C\uC758\uB85D",transcription:e.trim(),summary:"",actionItems:[],decisions:[],nextAgenda:[],sourceFile:t}}}async detectSchedules(e,t){var r;let n=N_.replace("{content}",e).replace("{today}",t),o=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:qe,contents:n}))).text)!=null?r:"";return this.parseSchedulesResponse(o)}parseSchedulesResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(i=>typeof i=="object"&&typeof i.title=="string"&&typeof i.date=="string"&&(i.type==="event"||i.type==="task")).map(i=>({title:i.title,date:i.date,time:i.time||null,type:i.type})):[]}catch(n){return console.error("\uC77C\uC815 \uAC10\uC9C0 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}};var Wv=require("obsidian");var vP={};var gl={};gl.d=(s,e)=>{for(var t in e)gl.o(e,t)&&!gl.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})};gl.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e);var V=globalThis.pdfjsLib={};gl.d(V,{AbortException:()=>Ln,AnnotationEditorLayer:()=>Pv,AnnotationEditorParamsType:()=>Q,AnnotationEditorType:()=>K,AnnotationEditorUIManager:()=>Go,AnnotationLayer:()=>av,AnnotationMode:()=>Si,ColorPicker:()=>Yh,DOMSVGFactory:()=>xl,DrawLayer:()=>kv,FeatureTest:()=>Be,GlobalWorkerOptions:()=>dn,ImageKind:()=>zd,InvalidPDFException:()=>wl,MissingPDFException:()=>Uo,OPS:()=>Jt,OutputScale:()=>Tl,PDFDataRangeTransport:()=>Lh,PDFDateString:()=>yl,PDFWorker:()=>cr,PasswordResponses:()=>xR,PermissionFlag:()=>bR,PixelsPerInch:()=>cs,RenderingCancelledException:()=>_l,TextLayer:()=>Sl,TouchManager:()=>Sh,UnexpectedResponseException:()=>Ga,Util:()=>$,VerbosityLevel:()=>Lp,XfaLayer:()=>$h,build:()=>gP,createValidAbsoluteUrl:()=>MR,fetchData:()=>Gp,getDocument:()=>dP,getFilenameFromUrl:()=>$R,getPdfFilenameFromUrl:()=>GR,getXfaPageViewport:()=>BR,isDataScheme:()=>Bp,isPdfFile:()=>Ov,noContextMenu:()=>hn,normalizeUnicode:()=>LR,setLayerDimensions:()=>Oo,shadow:()=>Z,stopEvent:()=>Pt,version:()=>pP});var je=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Y_=[1,0,0,1,0,0],_m=[.001,0,0,.001,0,0],ER=1e7,qd=1.35,CR=.35,GP=CR/qd,Rt={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Si={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},SR="pdfjs_internal_editor_",K={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Q={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},bR={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ze={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},zd={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ce={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var Xa={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var Lp={ERRORS:0,WARNINGS:1,INFOS:5},Jt={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},xR={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},Up=Lp.WARNINGS;function IR(s){Number.isInteger(s)&&(Up=s)}function RR(){return Up}function Op(s){Up>=Lp.INFOS&&console.log(`Info: ${s}`)}function Y(s){Up>=Lp.WARNINGS&&console.log(`Warning: ${s}`)}function re(s){throw new Error(s)}function _e(s,e){s||re(e)}function PR(s){switch(s==null?void 0:s.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function MR(s,e=null,t=null){if(!s)return null;try{if(t&&typeof s=="string"){if(t.addDefaultProtocol&&s.startsWith("www.")){let i=s.match(/\./g);(i==null?void 0:i.length)>=2&&(s=`http://${s}`)}if(t.tryConvertEncoding)try{s=FR(s)}catch(i){}}let n=e?new URL(s,e):new URL(s);if(PR(n))return n}catch(n){}return null}function Z(s,e,t,n=!1){return Object.defineProperty(s,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}var us=function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}(),_h=class extends us{constructor(e,t){super(e,"PasswordException"),this.code=t}},ml=class extends us{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},wl=class extends us{constructor(e){super(e,"InvalidPDFException")}},Uo=class extends us{constructor(e){super(e,"MissingPDFException")}},Ga=class extends us{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},Tm=class extends us{constructor(e){super(e,"FormatError")}},Ln=class extends us{constructor(e){super(e,"AbortException")}};function J_(s){(typeof s!="object"||(s==null?void 0:s.length)===void 0)&&re("Invalid argument for bytesToString");let e=s.length,t=8192;if(e<t)return String.fromCharCode.apply(null,s);let n=[];for(let i=0;i<e;i+=t){let o=Math.min(i+t,e),r=s.subarray(i,o);n.push(String.fromCharCode.apply(null,r))}return n.join("")}function $p(s){typeof s!="string"&&re("Invalid argument for stringToBytes");let e=s.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=s.charCodeAt(n)&255;return t}function NR(s){return String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255)}function Lv(s){let e=Object.create(null);for(let[t,n]of s)e[t]=n;return e}function kR(){let s=new Uint8Array(4);return s[0]=1,new Uint32Array(s.buffer,0,1)[0]===1}function DR(){try{return new Function(""),!0}catch(s){return!1}}var Be=class{static get isLittleEndian(){return Z(this,"isLittleEndian",kR())}static get isEvalSupported(){return Z(this,"isEvalSupported",DR())}static get isOffscreenCanvasSupported(){return Z(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas!="undefined")}static get isImageDecoderSupported(){return Z(this,"isImageDecoderSupported",typeof ImageDecoder!="undefined")}static get platform(){return typeof navigator!="undefined"&&typeof(navigator==null?void 0:navigator.platform)=="string"?Z(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):Z(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return Z(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}},mm=Array.from(Array(256).keys(),s=>s.toString(16).padStart(2,"0")),ur,Wd,Nl,Em,$=class{static makeHexColor(e,t,n){return`#${mm[e]}${mm[t]}${mm[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){let n=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[n,i]}static applyInverseTransform(e,t){let n=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,o=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[i,o]}static getAxialAlignedBoundingBox(e,t){let n=this.applyTransform(e,t),i=this.applyTransform(e.slice(2,4),t),o=this.applyTransform([e[0],e[3]],t),r=this.applyTransform([e[2],e[1]],t);return[Math.min(n[0],i[0],o[0],r[0]),Math.min(n[1],i[1],o[1],r[1]),Math.max(n[0],i[0],o[0],r[0]),Math.max(n[1],i[1],o[1],r[1])]}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){let t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],o=e[2]*t[0]+e[3]*t[2],r=e[2]*t[1]+e[3]*t[3],a=(n+r)/2,l=Math.sqrt((n+r)**2-4*(n*r-o*i))/2,c=a+l||1,d=a-l||1;return[Math.sqrt(c),Math.sqrt(d)]}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>i)return null;let o=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),r=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return o>r?null:[n,o,i,r]}static bezierBoundingBox(e,t,n,i,o,r,a,l,c){return c?(c[0]=Math.min(c[0],e,a),c[1]=Math.min(c[1],t,l),c[2]=Math.max(c[2],e,a),c[3]=Math.max(c[3],t,l)):c=[Math.min(e,a),Math.min(t,l),Math.max(e,a),Math.max(t,l)],T(this,Nl,Em).call(this,e,n,o,a,t,i,r,l,3*(-e+3*(n-o)+a),6*(e-2*n+o),3*(n-e),c),T(this,Nl,Em).call(this,e,n,o,a,t,i,r,l,3*(-t+3*(i-r)+l),6*(t-2*i+r),3*(i-t),c),c}};ur=new WeakSet,Wd=function(e,t,n,i,o,r,a,l,c,d){if(c<=0||c>=1)return;let p=1-c,g=c*c,m=g*c,y=p*(p*(p*e+3*c*t)+3*g*n)+m*i,A=p*(p*(p*o+3*c*r)+3*g*a)+m*l;d[0]=Math.min(d[0],y),d[1]=Math.min(d[1],A),d[2]=Math.max(d[2],y),d[3]=Math.max(d[3],A)},Nl=new WeakSet,Em=function(e,t,n,i,o,r,a,l,c,d,p,g){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&T(this,ur,Wd).call(this,e,t,n,i,o,r,a,l,-p/d,g);return}let m=d**2-4*p*c;if(m<0)return;let y=Math.sqrt(m),A=2*c;T(this,ur,Wd).call(this,e,t,n,i,o,r,a,l,(-d+y)/A,g),T(this,ur,Wd).call(this,e,t,n,i,o,r,a,l,(-d-y)/A,g)},v($,ur),v($,Nl);function FR(s){return decodeURIComponent(escape(s))}var ym=null,k_=null;function LR(s){return ym||(ym=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,k_=new Map([["\uFB05","\u017Ft"]])),s.replaceAll(ym,(e,t,n)=>t?t.normalize("NFKC"):k_.get(n))}function UR(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let s=new Uint8Array(32);return crypto.getRandomValues(s),J_(s)}var Uv="pdfjs_internal_id_";function OR(s){return Uint8Array.prototype.toBase64?s.toBase64():btoa(J_(s))}typeof Promise.try!="function"&&(Promise.try=function(s,...e){return new Promise(t=>{t(s(...e))})});var Bn="http://www.w3.org/2000/svg",ms=class ms{};H(ms,"CSS",96),H(ms,"PDF",72),H(ms,"PDF_TO_CSS_UNITS",ms.CSS/ms.PDF);var cs=ms;async function Gp(s,e="text"){if(el(s,document.baseURI)){let t=await fetch(s);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{let i=new XMLHttpRequest;i.open("GET",s,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}n(new Error(i.statusText))}},i.send(null)})}var Al=class s{constructor({viewBox:e,userUnit:t,scale:n,rotation:i,offsetX:o=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=i,this.offsetX=o,this.offsetY=r,n*=t;let l=(e[2]+e[0])/2,c=(e[3]+e[1])/2,d,p,g,m;switch(i%=360,i<0&&(i+=360),i){case 180:d=-1,p=0,g=0,m=1;break;case 90:d=0,p=1,g=1,m=0;break;case 270:d=0,p=-1,g=-1,m=0;break;case 0:d=1,p=0,g=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(g=-g,m=-m);let y,A,_,E;d===0?(y=Math.abs(c-e[1])*n+o,A=Math.abs(l-e[0])*n+r,_=(e[3]-e[1])*n,E=(e[2]-e[0])*n):(y=Math.abs(l-e[0])*n+o,A=Math.abs(c-e[1])*n+r,_=(e[2]-e[0])*n,E=(e[3]-e[1])*n),this.transform=[d*n,p*n,g*n,m*n,y-d*n*l-g*n*c,A-p*n*l-m*n*c],this.width=_,this.height=E}get rawDims(){let{userUnit:e,viewBox:t}=this,n=t.map(i=>i*e);return Z(this,"rawDims",{pageWidth:n[2]-n[0],pageHeight:n[3]-n[1],pageX:n[0],pageY:n[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:i=this.offsetY,dontFlip:o=!1}={}){return new s({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:i,dontFlip:o})}convertToViewportPoint(e,t){return $.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){let t=$.applyTransform([e[0],e[1]],this.transform),n=$.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return $.applyInverseTransform([e,t],this.transform)}},_l=class extends us{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}};function Bp(s){let e=s.length,t=0;for(;t<e&&s[t].trim()==="";)t++;return s.substring(t,t+5).toLowerCase()==="data:"}function Ov(s){return typeof s=="string"&&/\.pdf$/i.test(s)}function $R(s){return[s]=s.split(/[#?]/,1),s.substring(s.lastIndexOf("/")+1)}function GR(s,e="document.pdf"){if(typeof s!="string")return e;if(Bp(s))return Y('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;let t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=t.exec(s),o=n.exec(i[1])||n.exec(i[2])||n.exec(i[3]);if(o&&(o=o[0],o.includes("%")))try{o=n.exec(decodeURIComponent(o))[0]}catch(r){}return o||e}var Th=class{constructor(){H(this,"started",Object.create(null));H(this,"times",[])}time(e){e in this.started&&Y(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Y(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:n}of this.times)t=Math.max(n.length,t);for(let{name:n,start:i,end:o}of this.times)e.push(`${n.padEnd(t)} ${o-i}ms
`);return e.join("")}};function el(s,e){try{let{protocol:t}=e?new URL(s,e):new URL(s);return t==="http:"||t==="https:"}catch(t){return!1}}function hn(s){s.preventDefault()}function Pt(s){s.preventDefault(),s.stopPropagation()}var kl,yl=class{static toDateObject(e){if(!e||typeof e!="string")return null;u(this,kl)||w(this,kl,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let t=u(this,kl).exec(e);if(!t)return null;let n=parseInt(t[1],10),i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let o=parseInt(t[3],10);o=o>=1&&o<=31?o:1;let r=parseInt(t[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;let c=t[7]||"Z",d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let p=parseInt(t[9],10)||0;return p=p>=0&&p<=59?p:0,c==="-"?(r+=d,a+=p):c==="+"&&(r-=d,a-=p),new Date(Date.UTC(n,i,o,r,a,l))}};kl=new WeakMap,v(yl,kl,void 0);function BR(s,{scale:e=1,rotation:t=0}){let{width:n,height:i}=s.attributes.style,o=[0,0,parseInt(n),parseInt(i)];return new Al({viewBox:o,userUnit:1,scale:e,rotation:t})}function $v(s){if(s.startsWith("#")){let e=parseInt(s.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return s.startsWith("rgb(")?s.slice(4,-1).split(",").map(e=>parseInt(e)):s.startsWith("rgba(")?s.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Y(`Not a valid color format: "${s}"`),[0,0,0])}function HR(s){let e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(let t of s.keys()){e.style.color=t;let n=window.getComputedStyle(e).color;s.set(t,$v(n))}e.remove()}function ce(s){let{a:e,b:t,c:n,d:i,e:o,f:r}=s.getTransform();return[e,t,n,i,o,r]}function gn(s){let{a:e,b:t,c:n,d:i,e:o,f:r}=s.getTransform().invertSelf();return[e,t,n,i,o,r]}function Oo(s,e,t=!1,n=!0){if(e instanceof Al){let{pageWidth:i,pageHeight:o}=e.rawDims,{style:r}=s,a=Be.isCSSRoundSupported,l=`var(--scale-factor) * ${i}px`,c=`var(--scale-factor) * ${o}px`,d=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,p=a?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!t||e.rotation%180===0?(r.width=d,r.height=p):(r.width=p,r.height=d)}n&&s.setAttribute("data-main-rotation",e.rotation)}var Tl=class{constructor(){let e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},bi,ws,Xt,As,Dl,Fl,Zh,X_,Qh,Z_,jh,Q_,dr,Kd,ef,j_,Ll,Sm,qn=class qn{constructor(e){v(this,Qh);v(this,jh);v(this,dr);v(this,ef);v(this,Ll);v(this,bi,null);v(this,ws,null);v(this,Xt,void 0);v(this,As,null);v(this,Dl,null);w(this,Xt,e),u(qn,Fl)||w(qn,Fl,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){let e=w(this,bi,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");let t=u(this,Xt)._uiManager._signal;e.addEventListener("contextmenu",hn,{signal:t}),e.addEventListener("pointerdown",T(qn,Zh,X_),{signal:t});let n=w(this,As,document.createElement("div"));n.className="buttons",e.append(n);let i=u(this,Xt).toolbarPosition;if(i){let{style:o}=e,r=u(this,Xt)._uiManager.direction==="ltr"?1-i[0]:i[0];o.insetInlineEnd=`${100*r}%`,o.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return T(this,ef,j_).call(this),e}get div(){return u(this,bi)}hide(){var e;u(this,bi).classList.add("hidden"),(e=u(this,ws))==null||e.hideDropdown()}show(){var e;u(this,bi).classList.remove("hidden"),(e=u(this,Dl))==null||e.shown()}async addAltText(e){let t=await e.render();T(this,dr,Kd).call(this,t),u(this,As).prepend(t,u(this,Ll,Sm)),w(this,Dl,e)}addColorPicker(e){w(this,ws,e);let t=e.renderButton();T(this,dr,Kd).call(this,t),u(this,As).prepend(t,u(this,Ll,Sm))}remove(){var e;u(this,bi).remove(),(e=u(this,ws))==null||e.destroy(),w(this,ws,null)}};bi=new WeakMap,ws=new WeakMap,Xt=new WeakMap,As=new WeakMap,Dl=new WeakMap,Fl=new WeakMap,Zh=new WeakSet,X_=function(e){e.stopPropagation()},Qh=new WeakSet,Z_=function(e){u(this,Xt)._focusEventsAllowed=!1,Pt(e)},jh=new WeakSet,Q_=function(e){u(this,Xt)._focusEventsAllowed=!0,Pt(e)},dr=new WeakSet,Kd=function(e){let t=u(this,Xt)._uiManager._signal;e.addEventListener("focusin",T(this,Qh,Z_).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",T(this,jh,Q_).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",hn,{signal:t})},ef=new WeakSet,j_=function(){let{editorType:e,_uiManager:t}=u(this,Xt),n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",u(qn,Fl)[e]),T(this,dr,Kd).call(this,n),n.addEventListener("click",i=>{t.delete()},{signal:t._signal}),u(this,As).append(n)},Ll=new WeakSet,Sm=function(){let e=document.createElement("div");return e.className="divider",e},v(qn,Zh),v(qn,Fl,null);var Cm=qn,Ul,_s,Ts,tf,eT,nf,tT,sf,nT,bm=class{constructor(e){v(this,tf);v(this,nf);v(this,sf);v(this,Ul,null);v(this,_s,null);v(this,Ts,void 0);w(this,Ts,e)}show(e,t,n){let[i,o]=T(this,nf,tT).call(this,t,n),{style:r}=u(this,_s)||w(this,_s,T(this,tf,eT).call(this));e.append(u(this,_s)),r.insetInlineEnd=`${100*i}%`,r.top=`calc(${100*o}% + var(--editor-toolbar-vert-offset))`}hide(){u(this,_s).remove()}};Ul=new WeakMap,_s=new WeakMap,Ts=new WeakMap,tf=new WeakSet,eT=function(){let e=w(this,_s,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",hn,{signal:u(this,Ts)._signal});let t=w(this,Ul,document.createElement("div"));return t.className="buttons",e.append(t),T(this,sf,nT).call(this),e},nf=new WeakSet,tT=function(e,t){let n=0,i=0;for(let o of e){let r=o.y+o.height;if(r<n)continue;let a=o.x+(t?o.width:0);if(r>n){i=a,n=r;continue}t?a>i&&(i=a):a<i&&(i=a)}return[t?1-i:i,n]},sf=new WeakSet,nT=function(){let e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let n=u(this,Ts)._signal;e.addEventListener("contextmenu",hn,{signal:n}),e.addEventListener("click",()=>{u(this,Ts).highlightSelection("floating_button")},{signal:n}),u(this,Ul).append(e)};function Eh(s,e,t){for(let n of t)e.addEventListener(n,s[n].bind(s))}var of,xm=class{constructor(){v(this,of,0)}get id(){return`${SR}${et(this,of)._++}`}};of=new WeakMap;var hr,Ol,Ye,fr,Yd,Gv=class Gv{constructor(){v(this,fr);v(this,hr,UR());v(this,Ol,0);v(this,Ye,null)}static get _isSVGFittingCanvas(){let e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;let o=i.decode().then(()=>(n.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Z(this,"_isSVGFittingCanvas",o)}async getFromFile(e){let{lastModified:t,name:n,size:i,type:o}=e;return T(this,fr,Yd).call(this,`${t}_${n}_${i}_${o}`,e)}async getFromUrl(e){return T(this,fr,Yd).call(this,e,e)}async getFromBlob(e,t){let n=await t;return T(this,fr,Yd).call(this,e,n)}async getFromId(e){u(this,Ye)||w(this,Ye,new Map);let t=u(this,Ye).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){let{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){u(this,Ye)||w(this,Ye,new Map);let n=u(this,Ye).get(e);if(n!=null&&n.bitmap)return n.refCounter+=1,n;let i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),n={bitmap:i.transferToImageBitmap(),id:`image_${u(this,hr)}_${et(this,Ol)._++}`,refCounter:1,isSvg:!1},u(this,Ye).set(e,n),u(this,Ye).set(n.id,n),n}getSvgUrl(e){let t=u(this,Ye).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;u(this,Ye)||w(this,Ye,new Map);let t=u(this,Ye).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;let{bitmap:n}=t;if(!t.url&&!t.file){let o=new OffscreenCanvas(n.width,n.height);o.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=o.convertToBlob()}(i=n.close)==null||i.call(n),t.bitmap=null}isValidId(e){return e.startsWith(`image_${u(this,hr)}_`)}};hr=new WeakMap,Ol=new WeakMap,Ye=new WeakMap,fr=new WeakSet,Yd=async function(e,t){u(this,Ye)||w(this,Ye,new Map);let n=u(this,Ye).get(e);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${u(this,hr)}_${et(this,Ol)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(n.url=t,i=await Gp(t,"blob")):t instanceof File?i=n.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){let o=Gv._isSVGFittingCanvas,r=new FileReader,a=new Image,l=new Promise((c,d)=>{a.onload=()=>{n.bitmap=a,n.isSvg=!0,c()},r.onload=async()=>{let p=n.svgUrl=r.result;a.src=await o?`${p}#svgView(preserveAspectRatio(none))`:p},a.onerror=r.onerror=d});r.readAsDataURL(i),await l}else n.bitmap=await createImageBitmap(i);n.refCounter=1}catch(i){Y(i),n=null}return u(this,Ye).set(e,n),n&&u(this,Ye).set(n.id,n),n};var Im=Gv,me,xi,$l,de,Rm=class{constructor(e=128){v(this,me,[]);v(this,xi,!1);v(this,$l,void 0);v(this,de,-1);w(this,$l,e)}add({cmd:e,undo:t,post:n,mustExec:i,type:o=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(i&&e(),u(this,xi))return;let l={cmd:e,undo:t,post:n,type:o};if(u(this,de)===-1){u(this,me).length>0&&(u(this,me).length=0),w(this,de,0),u(this,me).push(l);return}if(r&&u(this,me)[u(this,de)].type===o){a&&(l.undo=u(this,me)[u(this,de)].undo),u(this,me)[u(this,de)]=l;return}let c=u(this,de)+1;c===u(this,$l)?u(this,me).splice(0,1):(w(this,de,c),c<u(this,me).length&&u(this,me).splice(c)),u(this,me).push(l)}undo(){if(u(this,de)===-1)return;w(this,xi,!0);let{undo:e,post:t}=u(this,me)[u(this,de)];e(),t==null||t(),w(this,xi,!1),w(this,de,u(this,de)-1)}redo(){if(u(this,de)<u(this,me).length-1){w(this,de,u(this,de)+1),w(this,xi,!0);let{cmd:e,post:t}=u(this,me)[u(this,de)];e(),t==null||t(),w(this,xi,!1)}}hasSomethingToUndo(){return u(this,de)!==-1}hasSomethingToRedo(){return u(this,de)<u(this,me).length-1}cleanType(e){if(u(this,de)!==-1){for(let t=u(this,de);t>=0;t--)if(u(this,me)[t].type!==e){u(this,me).splice(t+1,u(this,de)-t),w(this,de,t);return}u(this,me).length=0,w(this,de,-1)}}destroy(){w(this,me,null)}};me=new WeakMap,xi=new WeakMap,$l=new WeakMap,de=new WeakMap;var rf,iT,$o=class{constructor(e){v(this,rf);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=Be.platform;for(let[n,i,o={}]of e)for(let r of n){let a=r.startsWith("mac+");t&&a?(this.callbacks.set(r.slice(4),{callback:i,options:o}),this.allKeys.add(r.split("+").at(-1))):!t&&!a&&(this.callbacks.set(r,{callback:i,options:o}),this.allKeys.add(r.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;let n=this.callbacks.get(T(this,rf,iT).call(this,t));if(!n)return;let{callback:i,options:{bubbles:o=!1,args:r=[],checker:a=null}}=n;a&&!a(e,t)||(i.bind(e,...r,t)(),o||Pt(t))}};rf=new WeakSet,iT=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let t=this.buffer.join("+");return this.buffer.length=0,t};var af=class af{get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return HR(e),Z(this,"_colors",e)}convert(e){let t=$v(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(let[n,i]of this._colors)if(i.every((o,r)=>o===t[r]))return af._colorsMapping.get(n);return t}getHexCode(e){let t=this._colors.get(e);return t?$.makeHexColor(...t):e}};H(af,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var Pm=af,pr,yt,Se,Fe,gr,Wn,mr,Dt,Ii,Es,yr,Cs,vn,Zt,Ss,Gl,Bl,vr,Hl,wn,Ri,wr,Pi,An,lf,Mi,Vl,Ni,bs,ql,zl,Ie,ie,Kn,xs,Wl,Kl,ki,_n,Yn,Yl,Ft,Ar,Jd,Jl,Mm,cf,sT,uf,oT,_r,Xd,df,rT,hf,aT,ff,lT,Xl,Nm,pf,cT,Zl,km,Ql,Dm,gf,uT,Le,nt,Qt,Hn,mf,dT,yf,hT,jl,Fm,vf,fT,Is,tl,ec,Lm,rr=class rr{constructor(e,t,n,i,o,r,a,l,c,d,p,g,m){v(this,Ar);v(this,Jl);v(this,cf);v(this,uf);v(this,_r);v(this,df);v(this,hf);v(this,ff);v(this,Xl);v(this,pf);v(this,Zl);v(this,Ql);v(this,gf);v(this,Le);v(this,Qt);v(this,mf);v(this,yf);v(this,jl);v(this,vf);v(this,Is);v(this,ec);v(this,pr,new AbortController);v(this,yt,null);v(this,Se,new Map);v(this,Fe,new Map);v(this,gr,null);v(this,Wn,null);v(this,mr,null);v(this,Dt,new Rm);v(this,Ii,null);v(this,Es,null);v(this,yr,0);v(this,Cs,new Set);v(this,vn,null);v(this,Zt,null);v(this,Ss,new Set);H(this,"_editorUndoBar",null);v(this,Gl,!1);v(this,Bl,!1);v(this,vr,!1);v(this,Hl,null);v(this,wn,null);v(this,Ri,null);v(this,wr,null);v(this,Pi,!1);v(this,An,null);v(this,lf,new xm);v(this,Mi,!1);v(this,Vl,!1);v(this,Ni,null);v(this,bs,null);v(this,ql,null);v(this,zl,null);v(this,Ie,K.NONE);v(this,ie,new Set);v(this,Kn,null);v(this,xs,null);v(this,Wl,null);v(this,Kl,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});v(this,ki,[0,0]);v(this,_n,null);v(this,Yn,null);v(this,Yl,null);v(this,Ft,null);let y=this._signal=u(this,pr).signal;w(this,Yn,e),w(this,Yl,t),w(this,gr,n),this._eventBus=i,i._on("editingaction",this.onEditingAction.bind(this),{signal:y}),i._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),i._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),i._on("setpreference",this.onSetPreference.bind(this),{signal:y}),i._on("switchannotationeditorparams",A=>this.updateParams(A.type,A.value),{signal:y}),T(this,df,rT).call(this),T(this,gf,uT).call(this),T(this,Xl,Nm).call(this),w(this,Wn,o.annotationStorage),w(this,Hl,o.filterFactory),w(this,xs,r),w(this,wr,a||null),w(this,Gl,l),w(this,Bl,c),w(this,vr,d),w(this,zl,p||null),this.viewParameters={realScale:cs.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=m!==!1}static get _keyboardManager(){let e=rr.prototype,t=r=>u(r,Yn).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),n=(r,{target:a})=>{if(a instanceof HTMLInputElement){let{type:l}=a;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return Z(this,"_keyboardManager",new $o([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&u(r,Yn).contains(a)&&!r.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&u(r,Yn).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-o,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[o,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-o],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,o],checker:t}]]))}destroy(){var e,t,n,i,o;(e=u(this,Ft))==null||e.resolve(),w(this,Ft,null),(t=u(this,pr))==null||t.abort(),w(this,pr,null),this._signal=null;for(let r of u(this,Fe).values())r.destroy();u(this,Fe).clear(),u(this,Se).clear(),u(this,Ss).clear(),w(this,yt,null),u(this,ie).clear(),u(this,Dt).destroy(),(n=u(this,gr))==null||n.destroy(),(i=u(this,An))==null||i.hide(),w(this,An,null),u(this,wn)&&(clearTimeout(u(this,wn)),w(this,wn,null)),u(this,_n)&&(clearTimeout(u(this,_n)),w(this,_n,null)),(o=this._editorUndoBar)==null||o.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return u(this,zl)}get useNewAltTextFlow(){return u(this,Bl)}get useNewAltTextWhenAddingImage(){return u(this,vr)}get hcmFilter(){return Z(this,"hcmFilter",u(this,xs)?u(this,Hl).addHCMFilter(u(this,xs).foreground,u(this,xs).background):"none")}get direction(){return Z(this,"direction",getComputedStyle(u(this,Yn)).direction)}get highlightColors(){return Z(this,"highlightColors",u(this,wr)?new Map(u(this,wr).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return Z(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),w(this,Es,e)}setMainHighlightColorPicker(e){w(this,ql,e)}editAltText(e,t=!1){var n;(n=u(this,gr))==null||n.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":w(this,vr,t);break}}onPageChanging({pageNumber:e}){w(this,yr,e-1)}focusMainContainer(){u(this,Yn).focus()}findParent(e,t){for(let n of u(this,Fe).values()){let{x:i,y:o,width:r,height:a}=n.div.getBoundingClientRect();if(e>=i&&e<=i+r&&t>=o&&t<=o+a)return n}return null}disableUserSelect(e=!1){u(this,Yl).classList.toggle("noUserSelect",e)}addShouldRescale(e){u(this,Ss).add(e)}removeShouldRescale(e){u(this,Ss).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*cs.PDF_TO_CSS_UNITS;for(let n of u(this,Ss))n.onScaleChanging();(t=u(this,Es))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){let t=document.getSelection();if(!t||t.isCollapsed)return;let{anchorNode:n,anchorOffset:i,focusNode:o,focusOffset:r}=t,a=t.toString(),c=T(this,Ar,Jd).call(this,t).closest(".textLayer"),d=this.getSelectionBoxes(c);if(!d)return;t.empty();let p=T(this,Jl,Mm).call(this,c),g=u(this,Ie)===K.NONE,m=()=>{p==null||p.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:n,anchorOffset:i,focusNode:o,focusOffset:r,text:a}),g&&this.showAllEditors("highlight",!0,!0)};if(g){this.switchToMode(K.HIGHLIGHT,m);return}m()}addToAnnotationStorage(e){!e.isEmpty()&&u(this,Wn)&&!u(this,Wn).has(e.id)&&u(this,Wn).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,u(this,Pi)&&(w(this,Pi,!1),T(this,_r,Xd).call(this,"main_toolbar")),!this.hasSelection)return;let{activeElement:e}=document;for(let t of u(this,ie))if(t.div.contains(e)){w(this,bs,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!u(this,bs))return;let[e,t]=u(this,bs);w(this,bs,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){T(this,Xl,Nm).call(this),T(this,Zl,km).call(this)}removeEditListeners(){T(this,pf,cT).call(this),T(this,Ql,Dm).call(this)}dragOver(e){for(let{type:t}of e.dataTransfer.items)for(let n of u(this,Zt))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(let t of e.dataTransfer.items)for(let n of u(this,Zt))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var n;if(e.preventDefault(),(n=u(this,yt))==null||n.commitOrRemove(),!this.hasSelection)return;let t=[];for(let i of u(this,ie)){let o=i.serialize(!0);o&&t.push(o)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();let{clipboardData:t}=e;for(let o of t.items)for(let r of u(this,Zt))if(r.isHandlingMimeForPasting(o.type)){r.paste(o,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(o){Y(`paste: "${o.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();let i=this.currentLayer;try{let o=[];for(let l of n){let c=await i.deserialize(l);if(!c)return;o.push(c)}let r=()=>{for(let l of o)T(this,jl,Fm).call(this,l);T(this,ec,Lm).call(this,o)},a=()=>{for(let l of o)l.remove()};this.addCommands({cmd:r,undo:a,mustExec:!0})}catch(o){Y(`paste: "${o.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),u(this,Ie)!==K.NONE&&!this.isEditorHandlingKeyboard&&rr._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,u(this,Pi)&&(w(this,Pi,!1),T(this,_r,Xd).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(T(this,hf,aT).call(this),T(this,Zl,km).call(this),T(this,Le,nt).call(this,{isEditing:u(this,Ie)!==K.NONE,isEmpty:T(this,Is,tl).call(this),hasSomethingToUndo:u(this,Dt).hasSomethingToUndo(),hasSomethingToRedo:u(this,Dt).hasSomethingToRedo(),hasSelectedEditor:!1})):(T(this,ff,lT).call(this),T(this,Ql,Dm).call(this),T(this,Le,nt).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!u(this,Zt)){w(this,Zt,e);for(let t of u(this,Zt))T(this,Qt,Hn).call(this,t.defaultPropertiesToUpdate)}}getId(){return u(this,lf).id}get currentLayer(){return u(this,Fe).get(u(this,yr))}getLayer(e){return u(this,Fe).get(e)}get currentPageIndex(){return u(this,yr)}addLayer(e){u(this,Fe).set(e.pageIndex,e),u(this,Mi)?e.enable():e.disable()}removeLayer(e){u(this,Fe).delete(e.pageIndex)}async updateMode(e,t=null,n=!1){var i;if(u(this,Ie)!==e&&!(u(this,Ft)&&(await u(this,Ft).promise,!u(this,Ft)))){if(w(this,Ft,Promise.withResolvers()),w(this,Ie,e),e===K.NONE){this.setEditingState(!1),T(this,yf,hT).call(this),(i=this._editorUndoBar)==null||i.hide(),u(this,Ft).resolve();return}this.setEditingState(!0),await T(this,mf,dT).call(this),this.unselectAll();for(let o of u(this,Fe).values())o.updateMode(e);if(!t){n&&this.addNewEditorFromKeyboard(),u(this,Ft).resolve();return}for(let o of u(this,Se).values())o.annotationElementId===t?(this.setSelected(o),o.enterInEditMode()):o.unselect();u(this,Ft).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==u(this,Ie)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var n;if(u(this,Zt)){switch(e){case Q.CREATE:this.currentLayer.addNewEditor();return;case Q.HIGHLIGHT_DEFAULT_COLOR:(n=u(this,ql))==null||n.updateColor(t);break;case Q.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(u(this,Wl)||w(this,Wl,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(let i of u(this,ie))i.updateParams(e,t);for(let i of u(this,Zt))i.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){var o,r;for(let a of u(this,Se).values())a.editorType===e&&a.show(t);((r=(o=u(this,Wl))==null?void 0:o.get(Q.HIGHLIGHT_SHOW_ALL))!=null?r:!0)!==t&&T(this,Qt,Hn).call(this,[[Q.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(u(this,Vl)!==e){w(this,Vl,e);for(let t of u(this,Fe).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){let t=[];for(let n of u(this,Se).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return u(this,Se).get(e)}addEditor(e){u(this,Se).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(u(this,wn)&&clearTimeout(u(this,wn)),w(this,wn,setTimeout(()=>{this.focusMainContainer(),w(this,wn,null)},0))),u(this,Se).delete(e.id),this.unselect(e),(!e.annotationElementId||!u(this,Cs).has(e.annotationElementId))&&((t=u(this,Wn))==null||t.remove(e.id))}addDeletedAnnotationElement(e){u(this,Cs).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return u(this,Cs).has(e)}removeDeletedAnnotationElement(e){u(this,Cs).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){u(this,yt)!==e&&(w(this,yt,e),e&&T(this,Qt,Hn).call(this,e.propertiesToUpdate))}updateUI(e){u(this,vf,fT)===e&&T(this,Qt,Hn).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){T(this,Qt,Hn).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(u(this,ie).has(e)){u(this,ie).delete(e),e.unselect(),T(this,Le,nt).call(this,{hasSelectedEditor:this.hasSelection});return}u(this,ie).add(e),e.select(),T(this,Qt,Hn).call(this,e.propertiesToUpdate),T(this,Le,nt).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=u(this,Es))==null||t.commitOrRemove();for(let n of u(this,ie))n!==e&&n.unselect();u(this,ie).clear(),u(this,ie).add(e),e.select(),T(this,Qt,Hn).call(this,e.propertiesToUpdate),T(this,Le,nt).call(this,{hasSelectedEditor:!0})}isSelected(e){return u(this,ie).has(e)}get firstSelectedEditor(){return u(this,ie).values().next().value}unselect(e){e.unselect(),u(this,ie).delete(e),T(this,Le,nt).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return u(this,ie).size!==0}get isEnterHandled(){return u(this,ie).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;u(this,Dt).undo(),T(this,Le,nt).call(this,{hasSomethingToUndo:u(this,Dt).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:T(this,Is,tl).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){u(this,Dt).redo(),T(this,Le,nt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:u(this,Dt).hasSomethingToRedo(),isEmpty:T(this,Is,tl).call(this)})}addCommands(e){u(this,Dt).add(e),T(this,Le,nt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:T(this,Is,tl).call(this)})}cleanUndoStack(e){u(this,Dt).cleanType(e)}delete(){var o;this.commitOrRemove();let e=(o=this.currentLayer)==null?void 0:o.endDrawingSession(!0);if(!this.hasSelection&&!e)return;let t=e?[e]:[...u(this,ie)],n=()=>{var r;(r=this._editorUndoBar)==null||r.show(i,t.length===1?t[0].editorType:t.length);for(let a of t)a.remove()},i=()=>{for(let r of t)T(this,jl,Fm).call(this,r)};this.addCommands({cmd:n,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=u(this,yt))==null||e.commitOrRemove()}hasSomethingToControl(){return u(this,yt)||this.hasSelection}selectAll(){for(let e of u(this,ie))e.commit();T(this,ec,Lm).call(this,u(this,Se).values())}unselectAll(){var e;if(!(u(this,yt)&&(u(this,yt).commitOrRemove(),u(this,Ie)!==K.NONE))&&!((e=u(this,Es))!=null&&e.commitOrRemove())&&this.hasSelection){for(let t of u(this,ie))t.unselect();u(this,ie).clear(),T(this,Le,nt).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;u(this,ki)[0]+=e,u(this,ki)[1]+=t;let[i,o]=u(this,ki),r=[...u(this,ie)],a=1e3;u(this,_n)&&clearTimeout(u(this,_n)),w(this,_n,setTimeout(()=>{w(this,_n,null),u(this,ki)[0]=u(this,ki)[1]=0,this.addCommands({cmd:()=>{for(let l of r)u(this,Se).has(l.id)&&l.translateInPage(i,o)},undo:()=>{for(let l of r)u(this,Se).has(l.id)&&l.translateInPage(-i,-o)},mustExec:!1})},a));for(let l of r)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),w(this,vn,new Map);for(let e of u(this,ie))u(this,vn).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!u(this,vn))return!1;this.disableUserSelect(!1);let e=u(this,vn);w(this,vn,null);let t=!1;for(let[{x:i,y:o,pageIndex:r},a]of e)a.newX=i,a.newY=o,a.newPageIndex=r,t||(t=i!==a.savedX||o!==a.savedY||r!==a.savedPageIndex);if(!t)return!1;let n=(i,o,r,a)=>{if(u(this,Se).has(i.id)){let l=u(this,Fe).get(a);l?i._setParentAndPosition(l,o,r):(i.pageIndex=a,i.x=o,i.y=r)}};return this.addCommands({cmd:()=>{for(let[i,{newX:o,newY:r,newPageIndex:a}]of e)n(i,o,r,a)},undo:()=>{for(let[i,{savedX:o,savedY:r,savedPageIndex:a}]of e)n(i,o,r,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(u(this,vn))for(let n of u(this,vn).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){let t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||u(this,ie).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return u(this,yt)===e}getActive(){return u(this,yt)}getMode(){return u(this,Ie)}get imageManager(){return Z(this,"imageManager",new Im)}getSelectionBoxes(e){if(!e)return null;let t=document.getSelection();for(let c=0,d=t.rangeCount;c<d;c++)if(!e.contains(t.getRangeAt(c).commonAncestorContainer))return null;let{x:n,y:i,width:o,height:r}=e.getBoundingClientRect(),a;switch(e.getAttribute("data-main-rotation")){case"90":a=(c,d,p,g)=>({x:(d-i)/r,y:1-(c+p-n)/o,width:g/r,height:p/o});break;case"180":a=(c,d,p,g)=>({x:1-(c+p-n)/o,y:1-(d+g-i)/r,width:p/o,height:g/r});break;case"270":a=(c,d,p,g)=>({x:1-(d+g-i)/r,y:(c-n)/o,width:g/r,height:p/o});break;default:a=(c,d,p,g)=>({x:(c-n)/o,y:(d-i)/r,width:p/o,height:g/r});break}let l=[];for(let c=0,d=t.rangeCount;c<d;c++){let p=t.getRangeAt(c);if(!p.collapsed)for(let{x:g,y:m,width:y,height:A}of p.getClientRects())y===0||A===0||l.push(a(g,m,y,A))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(u(this,mr)||w(this,mr,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=u(this,mr))==null||t.delete(e)}renderAnnotationElement(e){var i;let t=(i=u(this,mr))==null?void 0:i.get(e.data.id);if(!t)return;let n=u(this,Wn).getRawValue(t);n&&(u(this,Ie)===K.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}};pr=new WeakMap,yt=new WeakMap,Se=new WeakMap,Fe=new WeakMap,gr=new WeakMap,Wn=new WeakMap,mr=new WeakMap,Dt=new WeakMap,Ii=new WeakMap,Es=new WeakMap,yr=new WeakMap,Cs=new WeakMap,vn=new WeakMap,Zt=new WeakMap,Ss=new WeakMap,Gl=new WeakMap,Bl=new WeakMap,vr=new WeakMap,Hl=new WeakMap,wn=new WeakMap,Ri=new WeakMap,wr=new WeakMap,Pi=new WeakMap,An=new WeakMap,lf=new WeakMap,Mi=new WeakMap,Vl=new WeakMap,Ni=new WeakMap,bs=new WeakMap,ql=new WeakMap,zl=new WeakMap,Ie=new WeakMap,ie=new WeakMap,Kn=new WeakMap,xs=new WeakMap,Wl=new WeakMap,Kl=new WeakMap,ki=new WeakMap,_n=new WeakMap,Yn=new WeakMap,Yl=new WeakMap,Ft=new WeakMap,Ar=new WeakSet,Jd=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},Jl=new WeakSet,Mm=function(e){let{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(let n of u(this,Fe).values())if(n.hasTextLayer(e))return n;return null},cf=new WeakSet,sT=function(){let e=document.getSelection();if(!e||e.isCollapsed)return;let n=T(this,Ar,Jd).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(n);i&&(u(this,An)||w(this,An,new bm(this)),u(this,An).show(n,i,this.direction==="ltr"))},uf=new WeakSet,oT=function(){var o,r,a;let e=document.getSelection();if(!e||e.isCollapsed){u(this,Kn)&&((o=u(this,An))==null||o.hide(),w(this,Kn,null),T(this,Le,nt).call(this,{hasSelectedText:!1}));return}let{anchorNode:t}=e;if(t===u(this,Kn))return;let i=T(this,Ar,Jd).call(this,e).closest(".textLayer");if(!i){u(this,Kn)&&((r=u(this,An))==null||r.hide(),w(this,Kn,null),T(this,Le,nt).call(this,{hasSelectedText:!1}));return}if((a=u(this,An))==null||a.hide(),w(this,Kn,t),T(this,Le,nt).call(this,{hasSelectedText:!0}),!(u(this,Ie)!==K.HIGHLIGHT&&u(this,Ie)!==K.NONE)&&(u(this,Ie)===K.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),w(this,Pi,this.isShiftKeyDown),!this.isShiftKeyDown)){let l=u(this,Ie)===K.HIGHLIGHT?T(this,Jl,Mm).call(this,i):null;l==null||l.toggleDrawing();let c=new AbortController,d=this.combinedSignal(c),p=g=>{g.type==="pointerup"&&g.button!==0||(c.abort(),l==null||l.toggleDrawing(!0),g.type==="pointerup"&&T(this,_r,Xd).call(this,"main_toolbar"))};window.addEventListener("pointerup",p,{signal:d}),window.addEventListener("blur",p,{signal:d})}},_r=new WeakSet,Xd=function(e=""){u(this,Ie)===K.HIGHLIGHT?this.highlightSelection(e):u(this,Gl)&&T(this,cf,sT).call(this)},df=new WeakSet,rT=function(){document.addEventListener("selectionchange",T(this,uf,oT).bind(this),{signal:this._signal})},hf=new WeakSet,aT=function(){if(u(this,Ri))return;w(this,Ri,new AbortController);let e=this.combinedSignal(u(this,Ri));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},ff=new WeakSet,lT=function(){var e;(e=u(this,Ri))==null||e.abort(),w(this,Ri,null)},Xl=new WeakSet,Nm=function(){if(u(this,Ni))return;w(this,Ni,new AbortController);let e=this.combinedSignal(u(this,Ni));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},pf=new WeakSet,cT=function(){var e;(e=u(this,Ni))==null||e.abort(),w(this,Ni,null)},Zl=new WeakSet,km=function(){if(u(this,Ii))return;w(this,Ii,new AbortController);let e=this.combinedSignal(u(this,Ii));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},Ql=new WeakSet,Dm=function(){var e;(e=u(this,Ii))==null||e.abort(),w(this,Ii,null)},gf=new WeakSet,uT=function(){let e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Le=new WeakSet,nt=function(e){Object.entries(e).some(([n,i])=>u(this,Kl)[n]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(u(this,Kl),e)}),u(this,Ie)===K.HIGHLIGHT&&e.hasSelectedEditor===!1&&T(this,Qt,Hn).call(this,[[Q.HIGHLIGHT_FREE,!0]]))},Qt=new WeakSet,Hn=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},mf=new WeakSet,dT=async function(){if(!u(this,Mi)){w(this,Mi,!0);let e=[];for(let t of u(this,Fe).values())e.push(t.enable());await Promise.all(e);for(let t of u(this,Se).values())t.enable()}},yf=new WeakSet,hT=function(){if(this.unselectAll(),u(this,Mi)){w(this,Mi,!1);for(let e of u(this,Fe).values())e.disable();for(let e of u(this,Se).values())e.disable()}},jl=new WeakSet,Fm=function(e){let t=u(this,Fe).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},vf=new WeakSet,fT=function(){let e=null;for(e of u(this,ie));return e},Is=new WeakSet,tl=function(){if(u(this,Se).size===0)return!0;if(u(this,Se).size===1)for(let e of u(this,Se).values())return e.isEmpty();return!1},ec=new WeakSet,Lm=function(e){for(let t of u(this,ie))t.unselect();u(this,ie).clear();for(let t of e)t.isEmpty()||(u(this,ie).add(t),t.select());T(this,Le,nt).call(this,{hasSelectedEditor:this.hasSelection})},H(rr,"TRANSLATE_SMALL",1),H(rr,"TRANSLATE_BIG",10);var Go=rr,Re,Tn,jt,Tr,En,vt,Er,Cn,ht,Jn,Rs,Sn,Di,Ps,nl,Cr,Zd,it=class it{constructor(e){v(this,Ps);v(this,Cr);v(this,Re,null);v(this,Tn,!1);v(this,jt,null);v(this,Tr,null);v(this,En,null);v(this,vt,null);v(this,Er,!1);v(this,Cn,null);v(this,ht,null);v(this,Jn,null);v(this,Rs,null);v(this,Sn,!1);w(this,ht,e),w(this,Sn,e._uiManager.useNewAltTextFlow),u(it,Di)||w(it,Di,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){var t;(t=it._l10n)!=null||(it._l10n=e)}async render(){let e=w(this,jt,document.createElement("button"));e.className="altText",e.tabIndex="0";let t=w(this,Tr,document.createElement("span"));e.append(t),u(this,Sn)?(e.classList.add("new"),e.setAttribute("data-l10n-id",u(it,Di).missing),t.setAttribute("data-l10n-id",u(it,Di)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let n=u(this,ht)._uiManager._signal;e.addEventListener("contextmenu",hn,{signal:n}),e.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:n});let i=o=>{o.preventDefault(),u(this,ht)._uiManager.editAltText(u(this,ht)),u(this,Sn)&&u(this,ht)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:u(this,Ps,nl)}})};return e.addEventListener("click",i,{capture:!0,signal:n}),e.addEventListener("keydown",o=>{o.target===e&&o.key==="Enter"&&(w(this,Er,!0),i(o))},{signal:n}),await T(this,Cr,Zd).call(this),e}finish(){u(this,jt)&&(u(this,jt).focus({focusVisible:u(this,Er)}),w(this,Er,!1))}isEmpty(){return u(this,Sn)?u(this,Re)===null:!u(this,Re)&&!u(this,Tn)}hasData(){return u(this,Sn)?u(this,Re)!==null||!!u(this,Jn):this.isEmpty()}get guessedText(){return u(this,Jn)}async setGuessedText(e){u(this,Re)===null&&(w(this,Jn,e),w(this,Rs,await it._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),T(this,Cr,Zd).call(this))}toggleAltTextBadge(e=!1){var t;if(!u(this,Sn)||u(this,Re)){(t=u(this,Cn))==null||t.remove(),w(this,Cn,null);return}if(!u(this,Cn)){let n=w(this,Cn,document.createElement("div"));n.className="noAltTextBadge",u(this,ht).div.append(n)}u(this,Cn).classList.toggle("hidden",!e)}serialize(e){let t=u(this,Re);return!e&&u(this,Jn)===t&&(t=u(this,Rs)),{altText:t,decorative:u(this,Tn),guessedText:u(this,Jn),textWithDisclaimer:u(this,Rs)}}get data(){return{altText:u(this,Re),decorative:u(this,Tn)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:i,cancel:o=!1}){n&&(w(this,Jn,n),w(this,Rs,i)),!(u(this,Re)===e&&u(this,Tn)===t)&&(o||(w(this,Re,e),w(this,Tn,t)),T(this,Cr,Zd).call(this))}toggle(e=!1){u(this,jt)&&(!e&&u(this,vt)&&(clearTimeout(u(this,vt)),w(this,vt,null)),u(this,jt).disabled=!e)}shown(){u(this,ht)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:u(this,Ps,nl)}})}destroy(){var e,t;(e=u(this,jt))==null||e.remove(),w(this,jt,null),w(this,Tr,null),w(this,En,null),(t=u(this,Cn))==null||t.remove(),w(this,Cn,null)}};Re=new WeakMap,Tn=new WeakMap,jt=new WeakMap,Tr=new WeakMap,En=new WeakMap,vt=new WeakMap,Er=new WeakMap,Cn=new WeakMap,ht=new WeakMap,Jn=new WeakMap,Rs=new WeakMap,Sn=new WeakMap,Di=new WeakMap,Ps=new WeakSet,nl=function(){return u(this,Re)&&"added"||u(this,Re)===null&&this.guessedText&&"review"||"missing"},Cr=new WeakSet,Zd=async function(){var i,o,r;let e=u(this,jt);if(!e)return;if(u(this,Sn)){if(e.classList.toggle("done",!!u(this,Re)),e.setAttribute("data-l10n-id",u(it,Di)[u(this,Ps,nl)]),(i=u(this,Tr))==null||i.setAttribute("data-l10n-id",u(it,Di)[`${u(this,Ps,nl)}-label`]),!u(this,Re)){(o=u(this,En))==null||o.remove();return}}else{if(!u(this,Re)&&!u(this,Tn)){e.classList.remove("done"),(r=u(this,En))==null||r.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=u(this,En);if(!t){w(this,En,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${u(this,ht).id}`;let a=100,l=u(this,ht)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(u(this,vt)),w(this,vt,null)},{once:!0}),e.addEventListener("mouseenter",()=>{w(this,vt,setTimeout(()=>{w(this,vt,null),u(this,En).classList.add("show"),u(this,ht)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:l}),e.addEventListener("mouseleave",()=>{var c;u(this,vt)&&(clearTimeout(u(this,vt)),w(this,vt,null)),(c=u(this,En))==null||c.classList.remove("show")},{signal:l})}u(this,Tn)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=u(this,Re)),t.parentNode||e.append(t);let n=u(this,ht).getImageForAltText();n==null||n.setAttribute("aria-describedby",t.id)},v(it,Di,null),H(it,"_l10n",null);var Ch=it,tc,Ms,nc,ic,sc,oc,rc,Sr,Xn,Ns,Fi,wf,pT,Af,gT,ac,Um,Bv=class Bv{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:i=null,onPinching:o=null,onPinchEnd:r=null,signal:a}){v(this,wf);v(this,Af);v(this,ac);v(this,tc,void 0);v(this,Ms,!1);v(this,nc,null);v(this,ic,void 0);v(this,sc,void 0);v(this,oc,void 0);v(this,rc,void 0);v(this,Sr,void 0);v(this,Xn,null);v(this,Ns,void 0);v(this,Fi,null);w(this,tc,e),w(this,nc,n),w(this,ic,t),w(this,sc,i),w(this,oc,o),w(this,rc,r),w(this,Ns,new AbortController),w(this,Sr,AbortSignal.any([a,u(this,Ns).signal])),e.addEventListener("touchstart",T(this,wf,pT).bind(this),{passive:!1,signal:u(this,Sr)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return Z(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=u(this,Ns))==null||e.abort(),w(this,Ns,null)}};tc=new WeakMap,Ms=new WeakMap,nc=new WeakMap,ic=new WeakMap,sc=new WeakMap,oc=new WeakMap,rc=new WeakMap,Sr=new WeakMap,Xn=new WeakMap,Ns=new WeakMap,Fi=new WeakMap,wf=new WeakSet,pT=function(e){var i,o,r;if((i=u(this,ic))!=null&&i.call(this)||e.touches.length<2)return;if(!u(this,Fi)){w(this,Fi,new AbortController);let a=AbortSignal.any([u(this,Sr),u(this,Fi).signal]),l=u(this,tc),c={signal:a,passive:!1};l.addEventListener("touchmove",T(this,Af,gT).bind(this),c),l.addEventListener("touchend",T(this,ac,Um).bind(this),c),l.addEventListener("touchcancel",T(this,ac,Um).bind(this),c),(o=u(this,sc))==null||o.call(this)}if(Pt(e),e.touches.length!==2||(r=u(this,nc))!=null&&r.call(this)){w(this,Xn,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),w(this,Xn,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},Af=new WeakSet,gT=function(e){var b;if(!u(this,Xn)||e.touches.length!==2)return;let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);let{screenX:i,screenY:o}=t,{screenX:r,screenY:a}=n,l=u(this,Xn),{touch0X:c,touch0Y:d,touch1X:p,touch1Y:g}=l,m=p-c,y=g-d,A=r-i,_=a-o,E=Math.hypot(A,_)||1,C=Math.hypot(m,y)||1;if(!u(this,Ms)&&Math.abs(C-E)<=Bv.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=o,l.touch1X=r,l.touch1Y=a,e.preventDefault(),!u(this,Ms)){w(this,Ms,!0);return}let S=[(i+r)/2,(o+a)/2];(b=u(this,oc))==null||b.call(this,S,C,E)},ac=new WeakSet,Um=function(e){var t;u(this,Fi).abort(),w(this,Fi,null),(t=u(this,rc))==null||t.call(this),u(this,Xn)&&(e.preventDefault(),w(this,Xn,null),w(this,Ms,!1))};var Sh=Bv,ks,en,ae,br,Li,lc,Ds,Ue,Fs,Zn,Ui,cc,Ls,wt,uc,Us,Qn,bn,xr,Ir,Lt,Os,dc,_f,hc,Om,fc,$m,Rr,Qd,Tf,mT,Ef,yT,pc,Gm,Pr,jd,gc,Bm,Cf,vT,Sf,wT,bf,AT,mc,Hm,xf,_T,yc,Vm,If,TT,Rf,ET,Pf,CT,vc,qm,$s,il,J=class J{constructor(e){v(this,hc);v(this,Rr);v(this,Tf);v(this,Ef);v(this,pc);v(this,Pr);v(this,gc);v(this,Cf);v(this,Sf);v(this,bf);v(this,mc);v(this,xf);v(this,yc);v(this,If);v(this,Rf);v(this,Pf);v(this,vc);v(this,$s);v(this,ks,null);v(this,en,null);v(this,ae,null);v(this,br,!1);v(this,Li,null);v(this,lc,"");v(this,Ds,!1);v(this,Ue,null);v(this,Fs,null);v(this,Zn,null);v(this,Ui,null);v(this,cc,"");v(this,Ls,!1);v(this,wt,null);v(this,uc,!1);v(this,Us,!1);v(this,Qn,!1);v(this,bn,null);v(this,xr,0);v(this,Ir,0);v(this,Lt,null);v(this,Os,null);H(this,"_editToolbar",null);H(this,"_initialOptions",Object.create(null));H(this,"_initialData",null);H(this,"_isVisible",!0);H(this,"_uiManager",null);H(this,"_focusEventsAllowed",!0);v(this,dc,!1);v(this,_f,J._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;let{rotation:t,rawDims:{pageWidth:n,pageHeight:i,pageX:o,pageY:r}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,i],this.pageTranslation=[o,r];let[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){let e=J.prototype._resizeWithKeyboard,t=Go.TRANSLATE_SMALL,n=Go.TRANSLATE_BIG;return Z(this,"_resizerKeyboardManager",new $o([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],J.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return Z(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let t=new zm({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){var i;if((i=J._l10n)!=null||(J._l10n=e),J._l10nResizer||(J._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),J._borderLineWidth!==-1)return;let n=getComputedStyle(document.documentElement);J._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){re("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return u(this,dc)}set _isDraggable(e){var t;w(this,dc,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){let[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=u(this,_f)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):T(this,$s,il).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(u(this,Ls)?w(this,Ls,!1):this.parent.setSelected(this))}focusout(e){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;let t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,i){let[o,r]=this.parentDimensions;[n,i]=this.screenToPageTranslation(n,i),this.x=(e+n)/o,this.y=(t+i)/r,this.fixAndSetPosition()}translate(e,t){T(this,hc,Om).call(this,this.parentDimensions,e,t)}translateInPage(e,t){u(this,wt)||w(this,wt,[this.x,this.y,this.width,this.height]),T(this,hc,Om).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){u(this,wt)||w(this,wt,[this.x,this.y,this.width,this.height]);let{div:n,parentDimensions:[i,o]}=this;if(this.x+=e/i,this.y+=t/o,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:p,y:g}=this.div.getBoundingClientRect();this.parent.findNewParent(this,p,g)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this,[l,c]=this.getBaseTranslation();r+=l,a+=c;let{style:d}=n;d.left=`${(100*r).toFixed(2)}%`,d.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!u(this,wt)&&(u(this,wt)[0]!==this.x||u(this,wt)[1]!==this.y)}get _hasBeenResized(){return!!u(this,wt)&&(u(this,wt)[2]!==this.width||u(this,wt)[3]!==this.height)}getBaseTranslation(){let[e,t]=this.parentDimensions,{_borderLineWidth:n}=J,i=n/e,o=n/t;switch(this.rotation){case 90:return[-i,o];case 180:return[i,o];case 270:return[i,-o];default:return[-i,-o]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){let{div:{style:t},pageDimensions:[n,i]}=this,{x:o,y:r,width:a,height:l}=this;if(a*=n,l*=i,o*=n,r*=i,this._mustFixPosition)switch(e){case 0:o=Math.max(0,Math.min(n-a,o)),r=Math.max(0,Math.min(i-l,r));break;case 90:o=Math.max(0,Math.min(n-l,o)),r=Math.min(i,Math.max(a,r));break;case 180:o=Math.min(n,Math.max(a,o)),r=Math.min(i,Math.max(l,r));break;case 270:o=Math.min(n,Math.max(l,o)),r=Math.max(0,Math.min(i-a,r));break}this.x=o/=n,this.y=r/=i;let[c,d]=this.getBaseTranslation();o+=c,r+=d,t.left=`${(100*o).toFixed(2)}%`,t.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return T(n=J,fc,$m).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return T(n=J,fc,$m).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(e,t){let[n,i]=this.parentDimensions,{style:o}=this.div;o.width=`${(100*e/n).toFixed(2)}%`,u(this,Ds)||(o.height=`${(100*t/i).toFixed(2)}%`)}fixDims(){let{style:e}=this.div,{height:t,width:n}=e,i=n.endsWith("%"),o=!u(this,Ds)&&t.endsWith("%");if(i&&o)return;let[r,a]=this.parentDimensions;i||(e.width=`${(100*parseFloat(n)/r).toFixed(2)}%`),!u(this,Ds)&&!o&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=u(this,ae))==null||e.finish()}async addEditToolbar(){return this._editToolbar||u(this,Us)?this._editToolbar:(this._editToolbar=new Cm(this),this.div.append(this._editToolbar.render()),u(this,ae)&&await this._editToolbar.addAltText(u(this,ae)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=u(this,ae))==null||e.destroy())}addContainer(e){var n;let t=(n=this._editToolbar)==null?void 0:n.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){u(this,ae)||(Ch.initialize(J._l10n),w(this,ae,new Ch(this)),u(this,ks)&&(u(this,ae).data=u(this,ks),w(this,ks,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=u(this,ae))==null?void 0:e.data}set altTextData(e){u(this,ae)&&(u(this,ae).data=e)}get guessedAltText(){var e;return(e=u(this,ae))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=u(this,ae))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=u(this,ae))==null?void 0:t.serialize(e)}hasAltText(){return!!u(this,ae)&&!u(this,ae).isEmpty()}hasAltTextData(){var e,t;return(t=(e=u(this,ae))==null?void 0:e.hasData())!=null?t:!1}render(){var o;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=u(this,br)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),T(this,yc,Vm).call(this);let[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);let[n,i]=this.getInitialTranslation();return this.translate(n,i),Eh(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(u(this,Os)||w(this,Os,new Sh({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:T(this,Cf,vT).bind(this),onPinching:T(this,Sf,wT).bind(this),onPinchEnd:T(this,bf,AT).bind(this),signal:this._uiManager._signal}))),(o=this._uiManager._editorUndoBar)==null||o.hide(),this.div}pointerdown(e){let{isMac:t}=Be.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(w(this,Ls,!0),this._isDraggable){T(this,xf,_T).call(this,e);return}T(this,mc,Hm).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){u(this,bn)&&clearTimeout(u(this,bn)),w(this,bn,setTimeout(()=>{var e;w(this,bn,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){let i=this.parentScale,[o,r]=this.pageDimensions,[a,l]=this.pageTranslation,c=e/i,d=t/i,p=this.x*o,g=this.y*r,m=this.width*o,y=this.height*r;switch(n){case 0:return[p+c+a,r-g-d-y+l,p+c+m+a,r-g-d+l];case 90:return[p+d+a,r-g+c+l,p+d+y+a,r-g+c+m+l];case 180:return[p-c-m+a,r-g+d+l,p-c+a,r-g+d+y+l];case 270:return[p-d-y+a,r-g-c-m+l,p-d+a,r-g-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){let[n,i,o,r]=e,a=o-n,l=r-i;switch(this.rotation){case 0:return[n,t-r,a,l];case 90:return[n,t-i,l,a];case 180:return[o,t-i,a,l];case 270:return[o,t-r,l,a];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){w(this,Us,!0)}disableEditMode(){w(this,Us,!1)}isInEditMode(){return u(this,Us)}shouldGetKeyboardEvents(){return u(this,Qn)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:e,left:t,bottom:n,right:i}=this.getClientDimensions(),{innerHeight:o,innerWidth:r}=window;return t<r&&i>0&&e<o&&n>0}rebuild(){T(this,yc,Vm).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){re("An editor must be serializable")}static async deserialize(e,t,n){let i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n});i.rotation=e.rotation,w(i,ks,e.accessibilityData);let[o,r]=i.pageDimensions,[a,l,c,d]=i.getRectInCurrentCoords(e.rect,r);return i.x=a/o,i.y=l/r,i.width=c/o,i.height=d/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=u(this,Ui))==null||e.abort(),w(this,Ui,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),u(this,bn)&&(clearTimeout(u(this,bn)),w(this,bn,null)),T(this,$s,il).call(this),this.removeEditToolbar(),u(this,Lt)){for(let n of u(this,Lt).values())clearTimeout(n);w(this,Lt,null)}this.parent=null,(t=u(this,Os))==null||t.destroy(),w(this,Os,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(T(this,Tf,mT).call(this),u(this,Ue).classList.remove("hidden"),Eh(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),w(this,Zn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let t=u(this,Ue).children;if(!u(this,en)){w(this,en,Array.from(t));let r=T(this,If,TT).bind(this),a=T(this,Rf,ET).bind(this),l=this._uiManager._signal;for(let c of u(this,en)){let d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",r,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",T(this,Pf,CT).bind(this,d),{signal:l}),c.setAttribute("data-l10n-id",J._l10nResizer[d])}}let n=u(this,en)[0],i=0;for(let r of t){if(r===n)break;i++}let o=(360-this.rotation+this.parentRotation)%360/90*(u(this,en).length/4);if(o!==i){if(o<i)for(let a=0;a<i-o;a++)u(this,Ue).append(u(this,Ue).firstChild);else if(o>i)for(let a=0;a<o-i;a++)u(this,Ue).firstChild.before(u(this,Ue).lastChild);let r=0;for(let a of t){let c=u(this,en)[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",J._l10nResizer[c])}}T(this,vc,qm).call(this,0),w(this,Qn,!0),u(this,Ue).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){u(this,Qn)&&T(this,gc,Bm).call(this,u(this,cc),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){T(this,$s,il).call(this),this.div.focus()}select(){var e,t,n;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,o;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((o=this._editToolbar)==null||o.show())});return}(t=this._editToolbar)==null||t.show(),(n=u(this,ae))==null||n.toggleAltTextBadge(!1)}unselect(){var e,t,n,i,o;(e=u(this,Ue))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(o=u(this,ae))==null||o.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return u(this,uc)}set isEditing(e){w(this,uc,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){w(this,Ds,!0);let n=e/t,{style:i}=this.div;i.aspectRatio=n,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){u(this,Lt)||w(this,Lt,new Map);let{action:n}=e,i=u(this,Lt).get(n);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),u(this,Lt).delete(n),u(this,Lt).size===0&&w(this,Lt,null)},J._telemetryTimeout),u(this,Lt).set(n,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),w(this,br,!1)}disable(){this.div&&(this.div.tabIndex=-1),w(this,br,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){let n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){let{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};ks=new WeakMap,en=new WeakMap,ae=new WeakMap,br=new WeakMap,Li=new WeakMap,lc=new WeakMap,Ds=new WeakMap,Ue=new WeakMap,Fs=new WeakMap,Zn=new WeakMap,Ui=new WeakMap,cc=new WeakMap,Ls=new WeakMap,wt=new WeakMap,uc=new WeakMap,Us=new WeakMap,Qn=new WeakMap,bn=new WeakMap,xr=new WeakMap,Ir=new WeakMap,Lt=new WeakMap,Os=new WeakMap,dc=new WeakMap,_f=new WeakMap,hc=new WeakSet,Om=function([e,t],n,i){[n,i]=this.screenToPageTranslation(n,i),this.x+=n/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},fc=new WeakSet,$m=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Rr=new WeakSet,Qd=function(e){switch(e){case 90:{let[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{let[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},Tf=new WeakSet,mT=function(){if(u(this,Ue))return;w(this,Ue,document.createElement("div")),u(this,Ue).classList.add("resizers");let e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(let n of e){let i=document.createElement("div");u(this,Ue).append(i),i.classList.add("resizer",n),i.setAttribute("data-resizer-name",n),i.addEventListener("pointerdown",T(this,Ef,yT).bind(this,n),{signal:t}),i.addEventListener("contextmenu",hn,{signal:t}),i.tabIndex=-1}this.div.prepend(u(this,Ue))},Ef=new WeakSet,yT=function(e,t){var d;t.preventDefault();let{isMac:n}=Be.platform;if(t.button!==0||t.ctrlKey&&n)return;(d=u(this,ae))==null||d.toggle(!1);let i=this._isDraggable;this._isDraggable=!1,w(this,Fs,[t.screenX,t.screenY]);let o=new AbortController,r=this._uiManager.combinedSignal(o);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",T(this,gc,Bm).bind(this,e),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",Pt,{passive:!1,signal:r}),window.addEventListener("contextmenu",hn,{signal:r}),w(this,Zn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;let c=()=>{var p;o.abort(),this.parent.togglePointerEvents(!0),(p=u(this,ae))==null||p.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=l,T(this,Pr,jd).call(this)};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})},pc=new WeakSet,Gm=function(e,t,n,i){this.width=n,this.height=i,this.x=e,this.y=t;let[o,r]=this.parentDimensions;this.setDims(o*n,r*i),this.fixAndSetPosition(),this._onResized()},Pr=new WeakSet,jd=function(){if(!u(this,Zn))return;let{savedX:e,savedY:t,savedWidth:n,savedHeight:i}=u(this,Zn);w(this,Zn,null);let o=this.x,r=this.y,a=this.width,l=this.height;o===e&&r===t&&a===n&&l===i||this.addCommands({cmd:T(this,pc,Gm).bind(this,o,r,a,l),undo:T(this,pc,Gm).bind(this,e,t,n,i),mustExec:!0})},gc=new WeakSet,Bm=function(e,t){let[n,i]=this.parentDimensions,o=this.x,r=this.y,a=this.width,l=this.height,c=J.MIN_SIZE/n,d=J.MIN_SIZE/i,p=T(this,Rr,Qd).call(this,this.rotation),g=(k,B)=>[p[0]*k+p[2]*B,p[1]*k+p[3]*B],m=T(this,Rr,Qd).call(this,360-this.rotation),y=(k,B)=>[m[0]*k+m[2]*B,m[1]*k+m[3]*B],A,_,E=!1,C=!1;switch(e){case"topLeft":E=!0,A=(k,B)=>[0,0],_=(k,B)=>[k,B];break;case"topMiddle":A=(k,B)=>[k/2,0],_=(k,B)=>[k/2,B];break;case"topRight":E=!0,A=(k,B)=>[k,0],_=(k,B)=>[0,B];break;case"middleRight":C=!0,A=(k,B)=>[k,B/2],_=(k,B)=>[0,B/2];break;case"bottomRight":E=!0,A=(k,B)=>[k,B],_=(k,B)=>[0,0];break;case"bottomMiddle":A=(k,B)=>[k/2,B],_=(k,B)=>[k/2,0];break;case"bottomLeft":E=!0,A=(k,B)=>[0,B],_=(k,B)=>[k,0];break;case"middleLeft":C=!0,A=(k,B)=>[0,B/2],_=(k,B)=>[k,B/2];break}let S=A(a,l),b=_(a,l),x=g(...b),P=J._round(o+x[0]),I=J._round(r+x[1]),N=1,M=1,F,U;if(t.fromKeyboard)({deltaX:F,deltaY:U}=t);else{let{screenX:k,screenY:B}=t,[mt,fn]=u(this,Fs);[F,U]=this.screenToPageTranslation(k-mt,B-fn),u(this,Fs)[0]=k,u(this,Fs)[1]=B}if([F,U]=y(F/n,U/i),E){let k=Math.hypot(a,l);N=M=Math.max(Math.min(Math.hypot(b[0]-S[0]-F,b[1]-S[1]-U)/k,1/a,1/l),c/a,d/l)}else C?N=Math.max(c,Math.min(1,Math.abs(b[0]-S[0]-F)))/a:M=Math.max(d,Math.min(1,Math.abs(b[1]-S[1]-U)))/l;let j=J._round(a*N),z=J._round(l*M);x=g(..._(j,z));let W=P-x[0],xe=I-x[1];u(this,wt)||w(this,wt,[this.x,this.y,this.width,this.height]),this.width=j,this.height=z,this.x=W,this.y=xe,this.setDims(n*j,i*z),this.fixAndSetPosition(),this._onResizing()},Cf=new WeakSet,vT=function(){var e;w(this,Zn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=u(this,ae))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},Sf=new WeakSet,wT=function(e,t,n){let o=.7*(n/t)+1-.7;if(o===1)return;let r=T(this,Rr,Qd).call(this,this.rotation),a=(P,I)=>[r[0]*P+r[2]*I,r[1]*P+r[3]*I],[l,c]=this.parentDimensions,d=this.x,p=this.y,g=this.width,m=this.height,y=J.MIN_SIZE/l,A=J.MIN_SIZE/c;o=Math.max(Math.min(o,1/g,1/m),y/g,A/m);let _=J._round(g*o),E=J._round(m*o);if(_===g&&E===m)return;u(this,wt)||w(this,wt,[d,p,g,m]);let C=a(g/2,m/2),S=J._round(d+C[0]),b=J._round(p+C[1]),x=a(_/2,E/2);this.x=S-x[0],this.y=b-x[1],this.width=_,this.height=E,this.setDims(l*_,c*E),this.fixAndSetPosition(),this._onResizing()},bf=new WeakSet,AT=function(){var e;(e=u(this,ae))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),T(this,Pr,jd).call(this)},mc=new WeakSet,Hm=function(e){let{isMac:t}=Be.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},xf=new WeakSet,_T=function(e){let{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1,i=new AbortController,o=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:o},a=c=>{i.abort(),w(this,Li,null),w(this,Ls,!1),this._uiManager.endDragSession()||T(this,mc,Hm).call(this,c),n&&this._onStopDragging()};t&&(w(this,xr,e.clientX),w(this,Ir,e.clientY),w(this,Li,e.pointerId),w(this,lc,e.pointerType),window.addEventListener("pointermove",c=>{n||(n=!0,this._onStartDragging());let{clientX:d,clientY:p,pointerId:g}=c;if(g!==u(this,Li)){Pt(c);return}let[m,y]=this.screenToPageTranslation(d-u(this,xr),p-u(this,Ir));w(this,xr,d),w(this,Ir,p),this._uiManager.dragSelectedEditors(m,y)},r),window.addEventListener("touchmove",Pt,r),window.addEventListener("pointerdown",c=>{c.pointerType===u(this,lc)&&(u(this,Os)||c.isPrimary)&&a(c),Pt(c)},r));let l=c=>{if(!u(this,Li)||u(this,Li)===c.pointerId){a(c);return}Pt(c)};window.addEventListener("pointerup",l,{signal:o}),window.addEventListener("blur",l,{signal:o})},yc=new WeakSet,Vm=function(){if(u(this,Ui)||!this.div)return;w(this,Ui,new AbortController);let e=this._uiManager.combinedSignal(u(this,Ui));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},If=new WeakSet,TT=function(e){J._resizerKeyboardManager.exec(this,e)},Rf=new WeakSet,ET=function(e){var t;u(this,Qn)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==u(this,Ue)&&T(this,$s,il).call(this)},Pf=new WeakSet,CT=function(e){w(this,cc,u(this,Qn)?e:"")},vc=new WeakSet,qm=function(e){if(u(this,en))for(let t of u(this,en))t.tabIndex=e},$s=new WeakSet,il=function(){w(this,Qn,!1),T(this,vc,qm).call(this,-1),T(this,Pr,jd).call(this)},v(J,fc),H(J,"_l10n",null),H(J,"_l10nResizer",null),H(J,"_borderLineWidth",-1),H(J,"_colorManager",new Pm),H(J,"_zIndex",1),H(J,"_telemetryTimeout",1e3);var fe=J,zm=class extends fe{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},D_=3285377520,kt=4294901760,mn=65535,bh=class{constructor(e){this.h1=e?e&4294967295:D_,this.h2=e?e&4294967295:D_}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let A=0,_=e.length;A<_;A++){let E=e.charCodeAt(A);E<=255?t[n++]=E:(t[n++]=E>>>8,t[n++]=E&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let i=n>>2,o=n-i*4,r=new Uint32Array(t.buffer,0,i),a=0,l=0,c=this.h1,d=this.h2,p=3432918353,g=461845907,m=p&mn,y=g&mn;for(let A=0;A<i;A++)A&1?(a=r[A],a=a*p&kt|a*m&mn,a=a<<15|a>>>17,a=a*g&kt|a*y&mn,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=r[A],l=l*p&kt|l*m&mn,l=l<<15|l>>>17,l=l*g&kt|l*y&mn,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(a=0,o){case 3:a^=t[i*4+2]<<16;case 2:a^=t[i*4+1]<<8;case 1:a^=t[i*4],a=a*p&kt|a*m&mn,a=a<<15|a>>>17,a=a*g&kt|a*y&mn,i&1?c^=a:d^=a}this.h1=c,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&kt|e*36045&mn,t=t*4283543511&kt|((t<<16|e>>>16)*2950163797&kt)>>>16,e^=t>>>1,e=e*444984403&kt|e*60499&mn,t=t*3301882366&kt|((t<<16|e>>>16)*3120437893&kt)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}},Wm=Object.freeze({map:null,hash:"",transfer:void 0}),Gs,Bs,Pe,Mf,ST,El=class{constructor(){v(this,Mf);v(this,Gs,!1);v(this,Bs,null);v(this,Pe,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let n=u(this,Pe).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return u(this,Pe).get(e)}remove(e){if(u(this,Pe).delete(e),u(this,Pe).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let t of u(this,Pe).values())if(t instanceof fe)return;this.onAnnotationEditor(null)}}setValue(e,t){let n=u(this,Pe).get(e),i=!1;if(n!==void 0)for(let[o,r]of Object.entries(t))n[o]!==r&&(i=!0,n[o]=r);else i=!0,u(this,Pe).set(e,t);i&&T(this,Mf,ST).call(this),t instanceof fe&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return u(this,Pe).has(e)}getAll(){return u(this,Pe).size>0?Lv(u(this,Pe)):null}setAll(e){for(let[t,n]of Object.entries(e))this.setValue(t,n)}get size(){return u(this,Pe).size}resetModified(){u(this,Gs)&&(w(this,Gs,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new xh(this)}get serializable(){if(u(this,Pe).size===0)return Wm;let e=new Map,t=new bh,n=[],i=Object.create(null),o=!1;for(let[r,a]of u(this,Pe)){let l=a instanceof fe?a.serialize(!1,i):a;l&&(e.set(r,l),t.update(`${r}:${JSON.stringify(l)}`),o||(o=!!l.bitmap))}if(o)for(let r of e.values())r.bitmap&&n.push(r.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:Wm}get editorStats(){var n;let e=null,t=new Map;for(let i of u(this,Pe).values()){if(!(i instanceof fe))continue;let o=i.telemetryFinalData;if(!o)continue;let{type:r}=o;t.has(r)||t.set(r,Object.getPrototypeOf(i).constructor),e||(e=Object.create(null));let a=e[r]||(e[r]=new Map);for(let[l,c]of Object.entries(o)){if(l==="type")continue;let d=a.get(l);d||(d=new Map,a.set(l,d));let p=(n=d.get(c))!=null?n:0;d.set(c,p+1)}}for(let[i,o]of t)e[i]=o.computeTelemetryFinalData(e[i]);return e}resetModifiedIds(){w(this,Bs,null)}get modifiedIds(){if(u(this,Bs))return u(this,Bs);let e=[];for(let t of u(this,Pe).values())!(t instanceof fe)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return w(this,Bs,{ids:new Set(e),hash:e.join(",")})}};Gs=new WeakMap,Bs=new WeakMap,Pe=new WeakMap,Mf=new WeakSet,ST=function(){u(this,Gs)||(w(this,Gs,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var wc,xh=class extends El{constructor(t){super();v(this,wc,void 0);let{map:n,hash:i,transfer:o}=t.serializable,r=structuredClone(n,o?{transfer:o}:null);w(this,wc,{map:r,hash:i,transfer:o})}get print(){re("Should not call PrintAnnotationStorage.print")}get serializable(){return u(this,wc)}get modifiedIds(){return Z(this,"modifiedIds",{ids:new Set,hash:""})}};wc=new WeakMap;var Mr,Km=class{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){v(this,Mr,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),u(this,Mr).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||u(this,Mr).has(e.loadedName))){if(_e(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:n,src:i,style:o}=e,r=new FontFace(n,i,o);this.addNativeFontFace(r);try{await r.load(),u(this,Mr).add(n),t==null||t(e)}catch(a){Y(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}return}re("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){let n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(i){throw Y(`Failed to load font '${n.family}': '${i}'.`),e.disableFontFace=!0,i}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{let i=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;let e=!!((t=this._document)!=null&&t.fonts);return Z(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(je||typeof navigator!="undefined"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),Z(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(_e(!i.done,"completeRequest() cannot be called twice."),i.done=!0;n.length>0&&n[0].done;){let o=n.shift();setTimeout(o.callback,0)}}let{loadingRequests:n}=this,i={done:!1,complete:t,callback:e};return n.push(i),i}get _loadTestFont(){let e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Z(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(b,x){return b.charCodeAt(x)<<24|b.charCodeAt(x+1)<<16|b.charCodeAt(x+2)<<8|b.charCodeAt(x+3)&255}function i(b,x,P,I){let N=b.substring(0,x),M=b.substring(x+P);return N+I+M}let o,r,a=this._document.createElement("canvas");a.width=1,a.height=1;let l=a.getContext("2d"),c=0;function d(b,x){if(++c>30){Y("Load test font never loaded."),x();return}if(l.font="30px "+b,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){x();return}setTimeout(d.bind(null,b,x))}let p=`lt${Date.now()}${this.loadTestFontId++}`,g=this._loadTestFont;g=i(g,976,p.length,p);let y=16,A=1482184792,_=n(g,y);for(o=0,r=p.length-3;o<r;o+=4)_=_-A+n(p,o)|0;o<p.length&&(_=_-A+n(p+"XXX",o)|0),g=i(g,y,4,NR(_));let E=`url(data:font/opentype;base64,${btoa(g)});`,C=`@font-face {font-family:"${p}";src:${E}}`;this.insertRule(C);let S=this._document.createElement("div");S.style.visibility="hidden",S.style.width=S.style.height="10px",S.style.position="absolute",S.style.top=S.style.left="0px";for(let b of[e.loadedName,p]){let x=this._document.createElement("span");x.textContent="Hi",x.style.fontFamily=b,S.append(x)}this._document.body.append(S),d(p,()=>{S.remove(),t.complete()})}};Mr=new WeakMap;var Ym=class{constructor(e,{disableFontFace:t=!1,fontExtraProperties:n=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(let o in e)this[o]=e[o];this.disableFontFace=t===!0,this.fontExtraProperties=n===!0,this._inspectFont=i}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{let n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;let e=`url(data:${this.mimetype};base64,${OR(this.data)});`,t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(n=this._inspectFont)==null||n.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let n=this.loadedName+"_path_"+t,i;try{i=e.get(n)}catch(r){Y(`getPathGenerator - ignoring character: "${r}".`)}let o=new Path2D(i||"");return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=o}},Gd={DATA:1,ERROR:2},Ae={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function F_(){}function ut(s){if(s instanceof Ln||s instanceof wl||s instanceof Uo||s instanceof _h||s instanceof Ga||s instanceof ml)return s;switch(s instanceof Error||typeof s=="object"&&s!==null||re('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),s.name){case"AbortException":return new Ln(s.message);case"InvalidPDFException":return new wl(s.message);case"MissingPDFException":return new Uo(s.message);case"PasswordException":return new _h(s.message,s.code);case"UnexpectedResponseException":return new Ga(s.message,s.status);case"UnknownErrorException":return new ml(s.message,s.details)}return new ml(s.message,s.toString())}var Nr,Nf,bT,kf,xT,Df,IT,kr,eh,vs=class{constructor(e,t,n){v(this,Nf);v(this,kf);v(this,Df);v(this,kr);v(this,Nr,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",T(this,Nf,bT).bind(this),{signal:u(this,Nr).signal})}on(e,t){let n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){let i=this.callbackId++,o=Promise.withResolvers();this.callbackCapabilities[i]=o;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},n)}catch(r){o.reject(r)}return o.promise}sendWithStream(e,t,n,i){let o=this.streamId++,r=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{let d=Promise.withResolvers();return this.streamControllers[o]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:a,action:e,streamId:o,data:t,desiredSize:c.desiredSize},i),d.promise},pull:c=>{let d=Promise.withResolvers();return this.streamControllers[o].pullCall=d,l.postMessage({sourceName:r,targetName:a,stream:Ae.PULL,streamId:o,desiredSize:c.desiredSize}),d.promise},cancel:c=>{_e(c instanceof Error,"cancel must have a valid reason");let d=Promise.withResolvers();return this.streamControllers[o].cancelCall=d,this.streamControllers[o].isClosed=!0,l.postMessage({sourceName:r,targetName:a,stream:Ae.CANCEL,streamId:o,reason:ut(c)}),d.promise}},n)}destroy(){var e;(e=u(this,Nr))==null||e.abort(),w(this,Nr,null)}};Nr=new WeakMap,Nf=new WeakSet,bT=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){T(this,Df,IT).call(this,e);return}if(e.callback){let n=e.callbackId,i=this.callbackCapabilities[n];if(!i)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===Gd.DATA)i.resolve(e.data);else if(e.callback===Gd.ERROR)i.reject(ut(e.reason));else throw new Error("Unexpected callback case");return}let t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){let n=this.sourceName,i=e.sourceName,o=this.comObj;Promise.try(t,e.data).then(function(r){o.postMessage({sourceName:n,targetName:i,callback:Gd.DATA,callbackId:e.callbackId,data:r})},function(r){o.postMessage({sourceName:n,targetName:i,callback:Gd.ERROR,callbackId:e.callbackId,reason:ut(r)})});return}if(e.streamId){T(this,kf,xT).call(this,e);return}t(e.data)},kf=new WeakSet,xT=function(e){let t=e.streamId,n=this.sourceName,i=e.sourceName,o=this.comObj,r=this,a=this.actionHandler[e.action],l={enqueue(c,d=1,p){if(this.isCancelled)return;let g=this.desiredSize;this.desiredSize-=d,g>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:n,targetName:i,stream:Ae.ENQUEUE,streamId:t,chunk:c},p)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:i,stream:Ae.CLOSE,streamId:t}),delete r.streamSinks[t])},error(c){_e(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:i,stream:Ae.ERROR,streamId:t,reason:ut(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){o.postMessage({sourceName:n,targetName:i,stream:Ae.START_COMPLETE,streamId:t,success:!0})},function(c){o.postMessage({sourceName:n,targetName:i,stream:Ae.START_COMPLETE,streamId:t,reason:ut(c)})})},Df=new WeakSet,IT=function(e){let t=e.streamId,n=this.sourceName,i=e.sourceName,o=this.comObj,r=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case Ae.START_COMPLETE:e.success?r.startCall.resolve():r.startCall.reject(ut(e.reason));break;case Ae.PULL_COMPLETE:e.success?r.pullCall.resolve():r.pullCall.reject(ut(e.reason));break;case Ae.PULL:if(!a){o.postMessage({sourceName:n,targetName:i,stream:Ae.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||F_).then(function(){o.postMessage({sourceName:n,targetName:i,stream:Ae.PULL_COMPLETE,streamId:t,success:!0})},function(c){o.postMessage({sourceName:n,targetName:i,stream:Ae.PULL_COMPLETE,streamId:t,reason:ut(c)})});break;case Ae.ENQUEUE:if(_e(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(e.chunk);break;case Ae.CLOSE:if(_e(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),T(this,kr,eh).call(this,r,t);break;case Ae.ERROR:_e(r,"error should have stream controller"),r.controller.error(ut(e.reason)),T(this,kr,eh).call(this,r,t);break;case Ae.CANCEL_COMPLETE:e.success?r.cancelCall.resolve():r.cancelCall.reject(ut(e.reason)),T(this,kr,eh).call(this,r,t);break;case Ae.CANCEL:if(!a)break;let l=ut(e.reason);Promise.try(a.onCancel||F_,l).then(function(){o.postMessage({sourceName:n,targetName:i,stream:Ae.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){o.postMessage({sourceName:n,targetName:i,stream:Ae.CANCEL_COMPLETE,streamId:t,reason:ut(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},kr=new WeakSet,eh=async function(e,t){var n,i,o;await Promise.allSettled([(n=e.startCall)==null?void 0:n.promise,(i=e.pullCall)==null?void 0:i.promise,(o=e.cancelCall)==null?void 0:o.promise]),delete this.streamControllers[t]};var Ac,Ih=class{constructor({enableHWA:e=!1}){v(this,Ac,!1);w(this,Ac,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");let n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!u(this,Ac)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){re("Abstract method `_createCanvas` called.")}};Ac=new WeakMap;var Jm=class extends Ih{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){let n=this._document.createElement("canvas");return n.width=e,n.height=t,n}},Rh=class{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");let t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){re("Abstract method `_fetch` called.")}},Ph=class extends Rh{async _fetch(e){let t=await Gp(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):$p(t)}},Mh=class{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,i,o){return"none"}destroy(e=!1){}},Hs,Dr,jn,ei,Je,Vs,qs,Me,We,zs,sl,Oi,jo,Fr,th,$i,er,Ff,RT,_c,Zm,Gi,tr,Ws,ol,Ks,rl,Tc,Qm,Ys,al,Xm=class extends Mh{constructor({docId:t,ownerDocument:n=globalThis.document}){super();v(this,Me);v(this,zs);v(this,Oi);v(this,Fr);v(this,$i);v(this,Ff);v(this,_c);v(this,Gi);v(this,Ws);v(this,Ks);v(this,Tc);v(this,Ys);v(this,Hs,void 0);v(this,Dr,void 0);v(this,jn,void 0);v(this,ei,void 0);v(this,Je,void 0);v(this,Vs,void 0);v(this,qs,0);w(this,ei,t),w(this,Je,n)}addFilter(t){if(!t)return"none";let n=u(this,Me,We).get(t);if(n)return n;let[i,o,r]=T(this,Fr,th).call(this,t),a=t.length===1?i:`${i}${o}${r}`;if(n=u(this,Me,We).get(a),n)return u(this,Me,We).set(t,n),n;let l=`g_${u(this,ei)}_transfer_map_${et(this,qs)._++}`,c=T(this,$i,er).call(this,l);u(this,Me,We).set(t,c),u(this,Me,We).set(a,c);let d=T(this,Gi,tr).call(this,l);return T(this,Ks,rl).call(this,i,o,r,d),c}addHCMFilter(t,n){var y;let i=`${t}-${n}`,o="base",r=u(this,zs,sl).get(o);if((r==null?void 0:r.key)===i||(r?((y=r.filter)==null||y.remove(),r.key=i,r.url="none",r.filter=null):(r={key:i,url:"none",filter:null},u(this,zs,sl).set(o,r)),!t||!n))return r.url;let a=T(this,Ys,al).call(this,t);t=$.makeHexColor(...a);let l=T(this,Ys,al).call(this,n);if(n=$.makeHexColor(...l),u(this,Oi,jo).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return r.url;let c=new Array(256);for(let A=0;A<=255;A++){let _=A/255;c[A]=_<=.03928?_/12.92:((_+.055)/1.055)**2.4}let d=c.join(","),p=`g_${u(this,ei)}_hcm_filter`,g=r.filter=T(this,Gi,tr).call(this,p);T(this,Ks,rl).call(this,d,d,d,g),T(this,_c,Zm).call(this,g);let m=(A,_)=>{let E=a[A]/255,C=l[A]/255,S=new Array(_+1);for(let b=0;b<=_;b++)S[b]=E+b/_*(C-E);return S.join(",")};return T(this,Ks,rl).call(this,m(0,5),m(1,5),m(2,5),g),r.url=T(this,$i,er).call(this,p),r.url}addAlphaFilter(t){let n=u(this,Me,We).get(t);if(n)return n;let[i]=T(this,Fr,th).call(this,[t]),o=`alpha_${i}`;if(n=u(this,Me,We).get(o),n)return u(this,Me,We).set(t,n),n;let r=`g_${u(this,ei)}_alpha_map_${et(this,qs)._++}`,a=T(this,$i,er).call(this,r);u(this,Me,We).set(t,a),u(this,Me,We).set(o,a);let l=T(this,Gi,tr).call(this,r);return T(this,Tc,Qm).call(this,i,l),a}addLuminosityFilter(t){let n=u(this,Me,We).get(t||"luminosity");if(n)return n;let i,o;if(t?([i]=T(this,Fr,th).call(this,[t]),o=`luminosity_${i}`):o="luminosity",n=u(this,Me,We).get(o),n)return u(this,Me,We).set(t,n),n;let r=`g_${u(this,ei)}_luminosity_map_${et(this,qs)._++}`,a=T(this,$i,er).call(this,r);u(this,Me,We).set(t,a),u(this,Me,We).set(o,a);let l=T(this,Gi,tr).call(this,r);return T(this,Ff,RT).call(this,l),t&&T(this,Tc,Qm).call(this,i,l),a}addHighlightHCMFilter(t,n,i,o,r){var C;let a=`${n}-${i}-${o}-${r}`,l=u(this,zs,sl).get(t);if((l==null?void 0:l.key)===a||(l?((C=l.filter)==null||C.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},u(this,zs,sl).set(t,l)),!n||!i))return l.url;let[c,d]=[n,i].map(T(this,Ys,al).bind(this)),p=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),g=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[m,y]=[o,r].map(T(this,Ys,al).bind(this));g<p&&([p,g,m,y]=[g,p,y,m]),u(this,Oi,jo).style.color="";let A=(S,b,x)=>{let P=new Array(256),I=(g-p)/x,N=S/255,M=(b-S)/(255*x),F=0;for(let U=0;U<=x;U++){let j=Math.round(p+U*I),z=N+U*M;for(let W=F;W<=j;W++)P[W]=z;F=j+1}for(let U=F;U<256;U++)P[U]=P[F-1];return P.join(",")},_=`g_${u(this,ei)}_hcm_${t}_filter`,E=l.filter=T(this,Gi,tr).call(this,_);return T(this,_c,Zm).call(this,E),T(this,Ks,rl).call(this,A(m[0],y[0],5),A(m[1],y[1],5),A(m[2],y[2],5),E),l.url=T(this,$i,er).call(this,_),l.url}destroy(t=!1){var n,i,o,r;t&&((n=u(this,Vs))!=null&&n.size)||((i=u(this,jn))==null||i.parentNode.parentNode.remove(),w(this,jn,null),(o=u(this,Dr))==null||o.clear(),w(this,Dr,null),(r=u(this,Vs))==null||r.clear(),w(this,Vs,null),w(this,qs,0))}};Hs=new WeakMap,Dr=new WeakMap,jn=new WeakMap,ei=new WeakMap,Je=new WeakMap,Vs=new WeakMap,qs=new WeakMap,Me=new WeakSet,We=function(){return u(this,Dr)||w(this,Dr,new Map)},zs=new WeakSet,sl=function(){return u(this,Vs)||w(this,Vs,new Map)},Oi=new WeakSet,jo=function(){if(!u(this,jn)){let t=u(this,Je).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;let i=u(this,Je).createElementNS(Bn,"svg");i.setAttribute("width",0),i.setAttribute("height",0),w(this,jn,u(this,Je).createElementNS(Bn,"defs")),t.append(i),i.append(u(this,jn)),u(this,Je).body.append(t)}return u(this,jn)},Fr=new WeakSet,th=function(t){if(t.length===1){let c=t[0],d=new Array(256);for(let g=0;g<256;g++)d[g]=c[g]/255;let p=d.join(",");return[p,p,p]}let[n,i,o]=t,r=new Array(256),a=new Array(256),l=new Array(256);for(let c=0;c<256;c++)r[c]=n[c]/255,a[c]=i[c]/255,l[c]=o[c]/255;return[r.join(","),a.join(","),l.join(",")]},$i=new WeakSet,er=function(t){if(u(this,Hs)===void 0){w(this,Hs,"");let n=u(this,Je).URL;n!==u(this,Je).baseURI&&(Bp(n)?Y('#createUrl: ignore "data:"-URL for performance reasons.'):w(this,Hs,n.split("#",1)[0]))}return`url(${u(this,Hs)}#${t})`},Ff=new WeakSet,RT=function(t){let n=u(this,Je).createElementNS(Bn,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},_c=new WeakSet,Zm=function(t){let n=u(this,Je).createElementNS(Bn,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},Gi=new WeakSet,tr=function(t){let n=u(this,Je).createElementNS(Bn,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),u(this,Oi,jo).append(n),n},Ws=new WeakSet,ol=function(t,n,i){let o=u(this,Je).createElementNS(Bn,n);o.setAttribute("type","discrete"),o.setAttribute("tableValues",i),t.append(o)},Ks=new WeakSet,rl=function(t,n,i,o){let r=u(this,Je).createElementNS(Bn,"feComponentTransfer");o.append(r),T(this,Ws,ol).call(this,r,"feFuncR",t),T(this,Ws,ol).call(this,r,"feFuncG",n),T(this,Ws,ol).call(this,r,"feFuncB",i)},Tc=new WeakSet,Qm=function(t,n){let i=u(this,Je).createElementNS(Bn,"feComponentTransfer");n.append(i),T(this,Ws,ol).call(this,i,"feFuncA",t)},Ys=new WeakSet,al=function(t){return u(this,Oi,jo).style.color=t,$v(getComputedStyle(u(this,Oi,jo)).getPropertyValue("color"))};var Nh=class{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");let t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){re("Abstract method `_fetch` called.")}},kh=class extends Nh{async _fetch(e){let t=await Gp(e,"arraybuffer");return new Uint8Array(t)}};je&&Y("Please use the `legacy` build in Node.js environments.");async function PT(s){let t=await process.getBuiltinModule("fs").promises.readFile(s);return new Uint8Array(t)}var jm=class extends Mh{},ey=class extends Ih{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(vP.url)("@napi-rs/canvas").createCanvas(e,t)}},ty=class extends Rh{async _fetch(e){return PT(e)}},ny=class extends Nh{async _fetch(e){return PT(e)}},Qe={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function iy(s,e){if(!e)return;let t=e[2]-e[0],n=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,n),s.clip(i)}var Cl=class{getPattern(){re("Abstract method `getPattern` called.")}},sy=class extends Cl{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,i){let o;if(i===Qe.STROKE||i===Qe.FILL){let r=t.current.getClippedPathBoundingBox(i,ce(e))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,c=t.cachedCanvases.getCanvas("pattern",a,l),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-r[0],-r[1]),n=$.transform(n,[1,0,0,1,r[0],r[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),iy(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),o=e.createPattern(c.canvas,"no-repeat");let p=new DOMMatrix(n);o.setTransform(p)}else iy(e,this._bbox),o=this._createGradient(e);return o}};function vm(s,e,t,n,i,o,r,a){let l=e.coords,c=e.colors,d=s.data,p=s.width*4,g;l[t+1]>l[n+1]&&(g=t,t=n,n=g,g=o,o=r,r=g),l[n+1]>l[i+1]&&(g=n,n=i,i=g,g=r,r=a,a=g),l[t+1]>l[n+1]&&(g=t,t=n,n=g,g=o,o=r,r=g);let m=(l[t]+e.offsetX)*e.scaleX,y=(l[t+1]+e.offsetY)*e.scaleY,A=(l[n]+e.offsetX)*e.scaleX,_=(l[n+1]+e.offsetY)*e.scaleY,E=(l[i]+e.offsetX)*e.scaleX,C=(l[i+1]+e.offsetY)*e.scaleY;if(y>=C)return;let S=c[o],b=c[o+1],x=c[o+2],P=c[r],I=c[r+1],N=c[r+2],M=c[a],F=c[a+1],U=c[a+2],j=Math.round(y),z=Math.round(C),W,xe,k,B,mt,fn,Un,Mt;for(let He=j;He<=z;He++){if(He<_){let ue=He<y?0:(y-He)/(y-_);W=m-(m-A)*ue,xe=S-(S-P)*ue,k=b-(b-I)*ue,B=x-(x-N)*ue}else{let ue;He>C?ue=1:_===C?ue=0:ue=(_-He)/(_-C),W=A-(A-E)*ue,xe=P-(P-M)*ue,k=I-(I-F)*ue,B=N-(N-U)*ue}let Te;He<y?Te=0:He>C?Te=1:Te=(y-He)/(y-C),mt=m-(m-E)*Te,fn=S-(S-M)*Te,Un=b-(b-F)*Te,Mt=x-(x-U)*Te;let Ho=Math.round(Math.min(W,mt)),Va=Math.round(Math.max(W,mt)),Ht=p*He+Ho*4;for(let ue=Ho;ue<=Va;ue++)Te=(W-ue)/(W-mt),Te<0?Te=0:Te>1&&(Te=1),d[Ht++]=xe-(xe-fn)*Te|0,d[Ht++]=k-(k-Un)*Te|0,d[Ht++]=B-(B-Mt)*Te|0,d[Ht++]=255}}function VR(s,e,t){let n=e.coords,i=e.colors,o,r;switch(e.type){case"lattice":let a=e.verticesPerRow,l=Math.floor(n.length/a)-1,c=a-1;for(o=0;o<l;o++){let d=o*a;for(let p=0;p<c;p++,d++)vm(s,t,n[d],n[d+1],n[d+a],i[d],i[d+1],i[d+a]),vm(s,t,n[d+a+1],n[d+1],n[d+a],i[d+a+1],i[d+1],i[d+a])}break;case"triangles":for(o=0,r=n.length;o<r;o+=3)vm(s,t,n[o],n[o+1],n[o+2],i[o],i[o+1],i[o+2]);break;default:throw new Error("illegal figure")}}var oy=class extends Cl{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){let a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,d=Math.ceil(this._bounds[3])-l,p=Math.min(Math.ceil(Math.abs(c*e[0]*1.1)),3e3),g=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),m=c/p,y=d/g,A={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/m,scaleY:1/y},_=p+2*2,E=g+2*2,C=n.getCanvas("mesh",_,E),S=C.context,b=S.createImageData(p,g);if(t){let P=b.data;for(let I=0,N=P.length;I<N;I+=4)P[I]=t[0],P[I+1]=t[1],P[I+2]=t[2],P[I+3]=255}for(let P of this._figures)VR(b,P,A);return S.putImageData(b,2,2),{canvas:C.canvas,offsetX:a-2*m,offsetY:l-2*y,scaleX:m,scaleY:y}}getPattern(e,t,n,i){iy(e,this._bbox);let o;if(i===Qe.SHADING)o=$.singularValueDecompose2dScale(ce(e));else if(o=$.singularValueDecompose2dScale(t.baseTransform),this.matrix){let a=$.singularValueDecompose2dScale(this.matrix);o=[o[0]*a[0],o[1]*a[1]]}let r=this._createMeshCanvas(o,i===Qe.SHADING?null:this._background,t.cachedCanvases);return i!==Qe.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(r.offsetX,r.offsetY),e.scale(r.scaleX,r.scaleY),e.createPattern(r.canvas,"no-repeat")}},ry=class extends Cl{getPattern(){return"hotpink"}};function qR(s){switch(s[0]){case"RadialAxial":return new sy(s);case"Mesh":return new oy(s);case"Dummy":return new ry}throw new Error(`Unknown IR type: ${s[0]}`)}var L_={COLORED:1,UNCOLORED:2},Lf=class Lf{constructor(e,t,n,i,o){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=i,this.baseTransform=o}createPatternCanvas(e){let{bbox:t,operatorList:n,paintType:i,tilingType:o,color:r,canvasGraphicsFactory:a}=this,{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),Op("TilingType: "+o);let d=t[0],p=t[1],g=t[2],m=t[3],y=g-d,A=m-p,_=$.singularValueDecompose2dScale(this.matrix),E=$.singularValueDecompose2dScale(this.baseTransform),C=_[0]*E[0],S=_[1]*E[1],b=y,x=A,P=!1,I=!1,N=Math.ceil(l*C),M=Math.ceil(c*S),F=Math.ceil(y*C),U=Math.ceil(A*S);N>=F?b=l:P=!0,M>=U?x=c:I=!0;let j=this.getSizeAndScale(b,this.ctx.canvas.width,C),z=this.getSizeAndScale(x,this.ctx.canvas.height,S),W=e.cachedCanvases.getCanvas("pattern",j.size,z.size),xe=W.context,k=a.createCanvasGraphics(xe);if(k.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(k,i,r),xe.translate(-j.scale*d,-z.scale*p),k.transform(j.scale,0,0,z.scale,0,0),xe.save(),this.clipBbox(k,d,p,g,m),k.baseTransform=ce(k.ctx),k.executeOperatorList(n),k.endDrawing(),xe.restore(),P||I){let B=W.canvas;P&&(b=l),I&&(x=c);let mt=this.getSizeAndScale(b,this.ctx.canvas.width,C),fn=this.getSizeAndScale(x,this.ctx.canvas.height,S),Un=mt.size,Mt=fn.size,He=e.cachedCanvases.getCanvas("pattern-workaround",Un,Mt),Te=He.context,Ho=P?Math.floor(y/l):0,Va=I?Math.floor(A/c):0;for(let Ht=0;Ht<=Ho;Ht++)for(let ue=0;ue<=Va;ue++)Te.drawImage(B,Un*Ht,Mt*ue,Un,Mt,0,0,Un,Mt);return{canvas:He.canvas,scaleX:mt.scale,scaleY:fn.scale,offsetX:d,offsetY:p}}return{canvas:W.canvas,scaleX:j.scale,scaleY:z.scale,offsetX:d,offsetY:p}}getSizeAndScale(e,t,n){let i=Math.max(Lf.MAX_PATTERN_SIZE,t),o=Math.ceil(e*n);return o>=i?o=i:n=o/e,{scale:n,size:o}}clipBbox(e,t,n,i,o){let r=i-t,a=o-n;e.ctx.rect(t,n,r,a),e.current.updateRectMinMax(ce(e.ctx),[t,n,i,o]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){let i=e.ctx,o=e.current;switch(t){case L_.COLORED:let r=this.ctx;i.fillStyle=r.fillStyle,i.strokeStyle=r.strokeStyle,o.fillColor=r.fillStyle,o.strokeColor=r.strokeStyle;break;case L_.UNCOLORED:let a=$.makeHexColor(n[0],n[1],n[2]);i.fillStyle=a,i.strokeStyle=a,o.fillColor=a,o.strokeColor=a;break;default:throw new Tm(`Unsupported paint type: ${t}`)}}getPattern(e,t,n,i){let o=n;i!==Qe.SHADING&&(o=$.transform(o,t.baseTransform),this.matrix&&(o=$.transform(o,this.matrix)));let r=this.createPatternCanvas(t),a=new DOMMatrix(o);a=a.translate(r.offsetX,r.offsetY),a=a.scale(1/r.scaleX,1/r.scaleY);let l=e.createPattern(r.canvas,"repeat");return l.setTransform(a),l}};H(Lf,"MAX_PATTERN_SIZE",3e3);var ay=Lf;function zR({src:s,srcPos:e=0,dest:t,width:n,height:i,nonBlackColor:o=4294967295,inverseDecode:r=!1}){let a=Be.isLittleEndian?4278190080:255,[l,c]=r?[o,a]:[a,o],d=n>>3,p=n&7,g=s.length;t=new Uint32Array(t.buffer);let m=0;for(let y=0;y<i;y++){for(let _=e+d;e<_;e++){let E=e<g?s[e]:255;t[m++]=E&128?c:l,t[m++]=E&64?c:l,t[m++]=E&32?c:l,t[m++]=E&16?c:l,t[m++]=E&8?c:l,t[m++]=E&4?c:l,t[m++]=E&2?c:l,t[m++]=E&1?c:l}if(p===0)continue;let A=e<g?s[e++]:255;for(let _=0;_<p;_++)t[m++]=A&1<<7-_?c:l}return{srcPos:e,destPos:m}}var U_=16,O_=100,WR=15,$_=10,G_=1e3,gt=16;function KR(s,e){if(s._removeMirroring)throw new Error("Context is already forwarding operations.");s.__originalSave=s.save,s.__originalRestore=s.restore,s.__originalRotate=s.rotate,s.__originalScale=s.scale,s.__originalTranslate=s.translate,s.__originalTransform=s.transform,s.__originalSetTransform=s.setTransform,s.__originalResetTransform=s.resetTransform,s.__originalClip=s.clip,s.__originalMoveTo=s.moveTo,s.__originalLineTo=s.lineTo,s.__originalBezierCurveTo=s.bezierCurveTo,s.__originalRect=s.rect,s.__originalClosePath=s.closePath,s.__originalBeginPath=s.beginPath,s._removeMirroring=()=>{s.save=s.__originalSave,s.restore=s.__originalRestore,s.rotate=s.__originalRotate,s.scale=s.__originalScale,s.translate=s.__originalTranslate,s.transform=s.__originalTransform,s.setTransform=s.__originalSetTransform,s.resetTransform=s.__originalResetTransform,s.clip=s.__originalClip,s.moveTo=s.__originalMoveTo,s.lineTo=s.__originalLineTo,s.bezierCurveTo=s.__originalBezierCurveTo,s.rect=s.__originalRect,s.closePath=s.__originalClosePath,s.beginPath=s.__originalBeginPath,delete s._removeMirroring},s.save=function(){e.save(),this.__originalSave()},s.restore=function(){e.restore(),this.__originalRestore()},s.translate=function(n,i){e.translate(n,i),this.__originalTranslate(n,i)},s.scale=function(n,i){e.scale(n,i),this.__originalScale(n,i)},s.transform=function(n,i,o,r,a,l){e.transform(n,i,o,r,a,l),this.__originalTransform(n,i,o,r,a,l)},s.setTransform=function(n,i,o,r,a,l){e.setTransform(n,i,o,r,a,l),this.__originalSetTransform(n,i,o,r,a,l)},s.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},s.rotate=function(n){e.rotate(n),this.__originalRotate(n)},s.clip=function(n){e.clip(n),this.__originalClip(n)},s.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},s.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},s.bezierCurveTo=function(t,n,i,o,r,a){e.bezierCurveTo(t,n,i,o,r,a),this.__originalBezierCurveTo(t,n,i,o,r,a)},s.rect=function(t,n,i,o){e.rect(t,n,i,o),this.__originalRect(t,n,i,o)},s.closePath=function(){e.closePath(),this.__originalClosePath()},s.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}var ly=class{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,n)):(i=this.canvasFactory.create(t,n),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}};function Bd(s,e,t,n,i,o,r,a,l,c){let[d,p,g,m,y,A]=ce(s);if(p===0&&g===0){let C=r*d+y,S=Math.round(C),b=a*m+A,x=Math.round(b),P=(r+l)*d+y,I=Math.abs(Math.round(P)-S)||1,N=(a+c)*m+A,M=Math.abs(Math.round(N)-x)||1;return s.setTransform(Math.sign(d),0,0,Math.sign(m),S,x),s.drawImage(e,t,n,i,o,0,0,I,M),s.setTransform(d,p,g,m,y,A),[I,M]}if(d===0&&m===0){let C=a*g+y,S=Math.round(C),b=r*p+A,x=Math.round(b),P=(a+c)*g+y,I=Math.abs(Math.round(P)-S)||1,N=(r+l)*p+A,M=Math.abs(Math.round(N)-x)||1;return s.setTransform(0,Math.sign(p),Math.sign(g),0,S,x),s.drawImage(e,t,n,i,o,0,0,M,I),s.setTransform(d,p,g,m,y,A),[M,I]}s.drawImage(e,t,n,i,o,r,a,l,c);let _=Math.hypot(d,p),E=Math.hypot(g,m);return[_*l,E*c]}function YR(s){let{width:e,height:t}=s;if(e>G_||t>G_)return null;let n=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),o=e+1,r=new Uint8Array(o*(t+1)),a,l,c,d=e+7&-8,p=new Uint8Array(d*t),g=0;for(let E of s.data){let C=128;for(;C>0;)p[g++]=E&C?0:255,C>>=1}let m=0;for(g=0,p[g]!==0&&(r[0]=1,++m),l=1;l<e;l++)p[g]!==p[g+1]&&(r[l]=p[g]?2:1,++m),g++;for(p[g]!==0&&(r[l]=2,++m),a=1;a<t;a++){g=a*d,c=a*o,p[g-d]!==p[g]&&(r[c]=p[g]?1:8,++m);let E=(p[g]?4:0)+(p[g-d]?8:0);for(l=1;l<e;l++)E=(E>>2)+(p[g+1]?4:0)+(p[g-d+1]?8:0),i[E]&&(r[c+l]=i[E],++m),g++;if(p[g-d]!==p[g]&&(r[c+l]=p[g]?2:4,++m),m>n)return null}for(g=d*(t-1),c=a*o,p[g]!==0&&(r[c]=8,++m),l=1;l<e;l++)p[g]!==p[g+1]&&(r[c+l]=p[g]?4:8,++m),g++;if(p[g]!==0&&(r[c+l]=4,++m),m>n)return null;let y=new Int32Array([0,o,-1,0,-o,0,0,0,1]),A=new Path2D;for(a=0;m&&a<=t;a++){let E=a*o,C=E+e;for(;E<C&&!r[E];)E++;if(E===C)continue;A.moveTo(E%o,a);let S=E,b=r[E];do{let x=y[b];do E+=x;while(!r[E]);let P=r[E];P!==5&&P!==10?(b=P,r[E]=0):(b=P&51*b>>4,r[E]&=b>>2|b<<2),A.lineTo(E%o,E/o|0),r[E]||--m}while(S!==E);--a}return p=null,r=null,function(E){E.save(),E.scale(1/e,-1/t),E.translate(0,-t),E.fill(A),E.beginPath(),E.restore()}}var Dh=class{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Y_,this.textMatrixScale=1,this.fontMatrix=_m,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=ze.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=$.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(e,t){let n=$.applyTransform(t,e),i=$.applyTransform(t.slice(2),e),o=$.applyTransform([t[0],t[3]],e),r=$.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,n[0],i[0],o[0],r[0]),this.minY=Math.min(this.minY,n[1],i[1],o[1],r[1]),this.maxX=Math.max(this.maxX,n[0],i[0],o[0],r[0]),this.maxY=Math.max(this.maxY,n[1],i[1],o[1],r[1])}updateScalingPathMinMax(e,t){$.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,i,o,r,a,l,c,d){let p=$.bezierBoundingBox(t,n,i,o,r,a,l,c,d);d||this.updateRectMinMax(e,p)}getPathBoundingBox(e=Qe.FILL,t=null){let n=[this.minX,this.minY,this.maxX,this.maxY];if(e===Qe.STROKE){t||re("Stroke bounding box must include transform.");let i=$.singularValueDecompose2dScale(t),o=i[0]*this.lineWidth/2,r=i[1]*this.lineWidth/2;n[0]-=o,n[1]-=r,n[2]+=o,n[3]+=r}return n}updateClipFromPath(){let e=$.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=Qe.FILL,t=null){return $.intersect(this.clipBox,this.getPathBoundingBox(e,t))}};function B_(s,e){if(e instanceof ImageData){s.putImageData(e,0,0);return}let t=e.height,n=e.width,i=t%gt,o=(t-i)/gt,r=i===0?o:o+1,a=s.createImageData(n,gt),l=0,c,d=e.data,p=a.data,g,m,y,A;if(e.kind===zd.GRAYSCALE_1BPP){let _=d.byteLength,E=new Uint32Array(p.buffer,0,p.byteLength>>2),C=E.length,S=n+7>>3,b=4294967295,x=Be.isLittleEndian?4278190080:255;for(g=0;g<r;g++){for(y=g<o?gt:i,c=0,m=0;m<y;m++){let P=_-l,I=0,N=P>S?n:P*8-7,M=N&-8,F=0,U=0;for(;I<M;I+=8)U=d[l++],E[c++]=U&128?b:x,E[c++]=U&64?b:x,E[c++]=U&32?b:x,E[c++]=U&16?b:x,E[c++]=U&8?b:x,E[c++]=U&4?b:x,E[c++]=U&2?b:x,E[c++]=U&1?b:x;for(;I<N;I++)F===0&&(U=d[l++],F=128),E[c++]=U&F?b:x,F>>=1}for(;c<C;)E[c++]=0;s.putImageData(a,0,g*gt)}}else if(e.kind===zd.RGBA_32BPP){for(m=0,A=n*gt*4,g=0;g<o;g++)p.set(d.subarray(l,l+A)),l+=A,s.putImageData(a,0,m),m+=gt;g<r&&(A=n*i*4,p.set(d.subarray(l,l+A)),s.putImageData(a,0,m))}else if(e.kind===zd.RGB_24BPP)for(y=gt,A=n*y,g=0;g<r;g++){for(g>=o&&(y=i,A=n*y),c=0,m=A;m--;)p[c++]=d[l++],p[c++]=d[l++],p[c++]=d[l++],p[c++]=255;s.putImageData(a,0,g*gt)}else throw new Error(`bad image kind: ${e.kind}`)}function H_(s,e){if(e.bitmap){s.drawImage(e.bitmap,0,0);return}let t=e.height,n=e.width,i=t%gt,o=(t-i)/gt,r=i===0?o:o+1,a=s.createImageData(n,gt),l=0,c=e.data,d=a.data;for(let p=0;p<r;p++){let g=p<o?gt:i;({srcPos:l}=zR({src:c,srcPos:l,dest:d,width:n,height:g,nonBlackColor:0})),s.putImageData(a,0,p*gt)}}function Za(s,e){let t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let n of t)s[n]!==void 0&&(e[n]=s[n]);s.setLineDash!==void 0&&(e.setLineDash(s.getLineDash()),e.lineDashOffset=s.lineDashOffset)}function Hd(s){if(s.strokeStyle=s.fillStyle="#000000",s.fillRule="nonzero",s.globalAlpha=1,s.lineWidth=1,s.lineCap="butt",s.lineJoin="miter",s.miterLimit=10,s.globalCompositeOperation="source-over",s.font="10px sans-serif",s.setLineDash!==void 0&&(s.setLineDash([]),s.lineDashOffset=0),!je){let{filter:e}=s;e!=="none"&&e!==""&&(s.filter="none")}}function V_(s,e){if(e)return!0;let t=$.singularValueDecompose2dScale(s);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);let n=Math.fround((globalThis.devicePixelRatio||1)*cs.PDF_TO_CSS_UNITS);return t[0]<=n&&t[1]<=n}var JR=["butt","round","square"],XR=["miter","round","bevel"],ZR={},q_={},Ec,cy,Cc,uy,Sc,dy,Hv=class Hv{constructor(e,t,n,i,o,{optionalContentConfig:r,markedContentStack:a=null},l,c){v(this,Ec);v(this,Cc);v(this,Sc);this.ctx=e,this.current=new Dh(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=i,this.filterFactory=o,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new ly(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:i=null}){let o=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,o,r),this.ctx.fillStyle=a,n){let l=this.cachedCanvases.getCanvas("transparent",o,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...ce(this.compositeCtx))}this.ctx.save(),Hd(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=ce(this.ctx)}executeOperatorList(e,t,n,i){let o=e.argsArray,r=e.fnArray,a=t||0,l=o.length;if(l===a)return a;let c=l-a>$_&&typeof n=="function",d=c?Date.now()+WR:0,p=0,g=this.commonObjs,m=this.objs,y;for(;;){if(i!==void 0&&a===i.nextBreakPoint)return i.breakIt(a,n),a;if(y=r[a],y!==Jt.dependency)this[y].apply(this,o[a]);else for(let A of o[a]){let _=A.startsWith("g_")?g:m;if(!_.has(A))return _.get(A,n),a}if(a++,a===l)return a;if(c&&++p>$_){if(Date.now()>d)return n(),a;p=0}}}endDrawing(){T(this,Ec,cy).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())typeof HTMLCanvasElement!="undefined"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),T(this,Cc,uy).call(this)}_scaleImage(e,t){var g,m;let n=(g=e.width)!=null?g:e.displayWidth,i=(m=e.height)!=null?m:e.displayHeight,o=Math.max(Math.hypot(t[0],t[1]),1),r=Math.max(Math.hypot(t[2],t[3]),1),a=n,l=i,c="prescale1",d,p;for(;o>2&&a>1||r>2&&l>1;){let y=a,A=l;o>2&&a>1&&(y=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),o/=a/y),r>2&&l>1&&(A=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/A),d=this.cachedCanvases.getCanvas(c,y,A),p=d.context,p.clearRect(0,0,y,A),p.drawImage(e,0,0,a,l,0,0,y,A),e=d.canvas,a=y,l=A,c=c==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e){let t=this.ctx,{width:n,height:i}=e,o=this.current.fillColor,r=this.current.patternFill,a=ce(t),l,c,d,p;if((e.bitmap||e.data)&&e.count>1){let N=e.bitmap||e.data.buffer;c=JSON.stringify(r?a:[a.slice(0,4),o]),l=this._cachedBitmapsMap.get(N),l||(l=new Map,this._cachedBitmapsMap.set(N,l));let M=l.get(c);if(M&&!r){let F=Math.round(Math.min(a[0],a[2])+a[4]),U=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:M,offsetX:F,offsetY:U}}d=M}d||(p=this.cachedCanvases.getCanvas("maskCanvas",n,i),H_(p.context,e));let g=$.transform(a,[1/n,0,0,-1/i,0,0]);g=$.transform(g,[1,0,0,1,0,-i]);let[m,y,A,_]=$.getAxialAlignedBoundingBox([0,0,n,i],g),E=Math.round(A-m)||1,C=Math.round(_-y)||1,S=this.cachedCanvases.getCanvas("fillCanvas",E,C),b=S.context,x=m,P=y;b.translate(-x,-P),b.transform(...g),d||(d=this._scaleImage(p.canvas,gn(b)),d=d.img,l&&r&&l.set(c,d)),b.imageSmoothingEnabled=V_(ce(b),e.interpolate),Bd(b,d,0,0,d.width,d.height,0,0,n,i),b.globalCompositeOperation="source-in";let I=$.transform(gn(b),[1,0,0,1,-x,-P]);return b.fillStyle=r?o.getPattern(t,this,I,Qe.FILL):o,b.fillRect(0,0,n,i),l&&!r&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,S.canvas)),{canvas:S.canvas,offsetX:Math.round(x),offsetY:Math.round(P)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=JR[e]}setLineJoin(e){this.ctx.lineJoin=XR[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){let n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx,this.ctx=i.context;let o=this.ctx;o.setTransform(...ce(this.suspendedCtx)),Za(this.suspendedCtx,o),KR(o,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Za(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,i){let o=i[0],r=i[1],a=i[2]-o,l=i[3]-r;a===0||l===0||(this.genericComposeSMask(t.context,n,a,l,t.subtype,t.backdrop,t.transferMap,o,r,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,i,o,r,a,l,c,d,p){let g=e.canvas,m=l-d,y=c-p;if(r){let _=$.makeHexColor(...r);if(m<0||y<0||m+n>g.width||y+i>g.height){let E=this.cachedCanvases.getCanvas("maskExtension",n,i),C=E.context;C.drawImage(g,-m,-y),C.globalCompositeOperation="destination-atop",C.fillStyle=_,C.fillRect(0,0,n,i),C.globalCompositeOperation="source-over",g=E.canvas,m=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);let E=new Path2D;E.rect(m,y,n,i),e.clip(E),e.globalCompositeOperation="destination-atop",e.fillStyle=_,e.fillRect(m,y,n,i),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),o==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):o==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));let A=new Path2D;A.rect(l,c,n,i),t.clip(A),t.globalCompositeOperation="destination-in",t.drawImage(g,m,y,n,i,l,c,n,i),t.restore()}save(){this.inSMaskMode?(Za(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Za(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,i,o,r){this.ctx.transform(e,t,n,i,o,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){let i=this.ctx,o=this.current,r=o.x,a=o.y,l,c,d=ce(i),p=d[0]===0&&d[3]===0||d[1]===0&&d[2]===0,g=p?n.slice(0):null;for(let m=0,y=0,A=e.length;m<A;m++)switch(e[m]|0){case Jt.rectangle:r=t[y++],a=t[y++];let _=t[y++],E=t[y++],C=r+_,S=a+E;i.moveTo(r,a),_===0||E===0?i.lineTo(C,S):(i.lineTo(C,a),i.lineTo(C,S),i.lineTo(r,S)),p||o.updateRectMinMax(d,[r,a,C,S]),i.closePath();break;case Jt.moveTo:r=t[y++],a=t[y++],i.moveTo(r,a),p||o.updatePathMinMax(d,r,a);break;case Jt.lineTo:r=t[y++],a=t[y++],i.lineTo(r,a),p||o.updatePathMinMax(d,r,a);break;case Jt.curveTo:l=r,c=a,r=t[y+4],a=t[y+5],i.bezierCurveTo(t[y],t[y+1],t[y+2],t[y+3],r,a),o.updateCurvePathMinMax(d,l,c,t[y],t[y+1],t[y+2],t[y+3],r,a,g),y+=6;break;case Jt.curveTo2:l=r,c=a,i.bezierCurveTo(r,a,t[y],t[y+1],t[y+2],t[y+3]),o.updateCurvePathMinMax(d,l,c,r,a,t[y],t[y+1],t[y+2],t[y+3],g),r=t[y+2],a=t[y+3],y+=4;break;case Jt.curveTo3:l=r,c=a,r=t[y+2],a=t[y+3],i.bezierCurveTo(t[y],t[y+1],r,a,r,a),o.updateCurvePathMinMax(d,l,c,t[y],t[y+1],r,a,r,a,g),y+=4;break;case Jt.closePath:i.closePath();break}p&&o.updateScalingPathMinMax(d,g),o.setCurrentPoint(r,a)}closePath(){this.ctx.closePath()}stroke(e=!0){let t=this.ctx,n=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof n=="object"&&(n!=null&&n.getPattern)?(t.save(),t.strokeStyle=n.getPattern(t,this,gn(t),Qe.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){let t=this.ctx,n=this.current.fillColor,i=this.current.patternFill,o=!1;i&&(t.save(),t.fillStyle=n.getPattern(t,this,gn(t),Qe.FILL),o=!0);let r=this.current.getClippedPathBoundingBox();this.contentVisible&&r!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),o&&t.restore(),e&&this.consumePath(r)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ZR}eoClip(){this.pendingClip=q_}beginText(){this.current.textMatrix=Y_,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}let n=new Path2D,i=t.getTransform().invertSelf();for(let{transform:o,x:r,y:a,fontSize:l,path:c}of e)n.addPath(c,new DOMMatrix(o).preMultiplySelf(i).translate(r,a).scale(l,-l));t.clip(n),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var d;let n=this.commonObjs.get(e),i=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=n.fontMatrix||_m,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&Y("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;let o=n.loadedName||"sans-serif",r=((d=n.systemFontInfo)==null?void 0:d.css)||`"${o}", ${n.fallbackName}`,a="normal";n.black?a="900":n.bold&&(a="bold");let l=n.italic?"italic":"normal",c=t;t<U_?c=U_:t>O_&&(c=O_),this.current.fontSizeScale=t/c,this.ctx.font=`${l} ${a} ${c}px ${r}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,i,o,r){this.current.textMatrix=[e,t,n,i,o,r],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,i,o){let r=this.ctx,a=this.current,l=a.font,c=a.textRenderingMode,d=a.fontSize/a.fontSizeScale,p=c&ze.FILL_STROKE_MASK,g=!!(c&ze.ADD_TO_PATH_FLAG),m=a.patternFill&&!l.missingFile,y=a.patternStroke&&!l.missingFile,A;if((l.disableFontFace||g||m||y)&&(A=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||m||y){if(r.save(),r.translate(t,n),r.scale(d,-d),p===ze.FILL||p===ze.FILL_STROKE)if(i){let _=r.getTransform();r.setTransform(...i),r.fill(T(this,Sc,dy).call(this,A,_,i))}else r.fill(A);if(p===ze.STROKE||p===ze.FILL_STROKE)if(o){let _=r.getTransform();r.setTransform(...o),r.stroke(T(this,Sc,dy).call(this,A,_,o))}else r.lineWidth/=d,r.stroke(A);r.restore()}else(p===ze.FILL||p===ze.FILL_STROKE)&&r.fillText(e,t,n),(p===ze.STROKE||p===ze.FILL_STROKE)&&r.strokeText(e,t,n);g&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:ce(r),x:t,y:n,fontSize:d,path:A})}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let t=e.getImageData(0,0,10,10).data,n=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){n=!0;break}return Z(this,"isFontSubpixelAAEnabled",n)}showText(e){let t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);let i=t.fontSize;if(i===0)return;let o=this.ctx,r=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,c=t.fontDirection,d=t.textHScale*c,p=e.length,g=n.vertical,m=g?1:-1,y=n.defaultVMetrics,A=i*t.fontMatrix[0],_=t.textRenderingMode===ze.FILL&&!n.disableFontFace&&!t.patternFill;o.save(),o.transform(...t.textMatrix),o.translate(t.x,t.y+t.textRise),c>0?o.scale(d,-1):o.scale(d,1);let E,C;if(t.patternFill){o.save();let I=t.fillColor.getPattern(o,this,gn(o),Qe.FILL);E=ce(o),o.restore(),o.fillStyle=I}if(t.patternStroke){o.save();let I=t.strokeColor.getPattern(o,this,gn(o),Qe.STROKE);C=ce(o),o.restore(),o.strokeStyle=I}let S=t.lineWidth,b=t.textMatrixScale;if(b===0||S===0){let I=t.textRenderingMode&ze.FILL_STROKE_MASK;(I===ze.STROKE||I===ze.FILL_STROKE)&&(S=this.getSinglePixelWidth())}else S/=b;if(r!==1&&(o.scale(r,r),S/=r),o.lineWidth=S,n.isInvalidPDFjsFont){let I=[],N=0;for(let M of e)I.push(M.unicode),N+=M.width;o.fillText(I.join(""),0,0),t.x+=N*A*d,o.restore(),this.compose();return}let x=0,P;for(P=0;P<p;++P){let I=e[P];if(typeof I=="number"){x+=m*I*i/1e3;continue}let N=!1,M=(I.isSpace?l:0)+a,F=I.fontChar,U=I.accent,j,z,W=I.width;if(g){let k=I.vmetric||y,B=-(I.vmetric?k[1]:W*.5)*A,mt=k[2]*A;W=k?-k[0]:W,j=B/r,z=(x+mt)/r}else j=x/r,z=0;if(n.remeasure&&W>0){let k=o.measureText(F).width*1e3/i*r;if(W<k&&this.isFontSubpixelAAEnabled){let B=W/k;N=!0,o.save(),o.scale(B,1),j/=B}else W!==k&&(j+=(W-k)/2e3*i/r)}if(this.contentVisible&&(I.isInFont||n.missingFile)){if(_&&!U)o.fillText(F,j,z);else if(this.paintChar(F,j,z,E,C),U){let k=j+i*U.offset.x/r,B=z-i*U.offset.y/r;this.paintChar(U.fontChar,k,B,E,C)}}let xe=g?W*A-M*c:W*A+M*c;x+=xe,N&&o.restore()}g?t.y-=x:t.x+=x*d,o.restore(),this.compose()}showType3Text(e){let t=this.ctx,n=this.current,i=n.font,o=n.fontSize,r=n.fontDirection,a=i.vertical?1:-1,l=n.charSpacing,c=n.wordSpacing,d=n.textHScale*r,p=n.fontMatrix||_m,g=e.length,m=n.textRenderingMode===ze.INVISIBLE,y,A,_,E;if(!(m||o===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...n.textMatrix),t.translate(n.x,n.y),t.scale(d,r),y=0;y<g;++y){if(A=e[y],typeof A=="number"){E=a*A*o/1e3,this.ctx.translate(E,0),n.x+=E*d;continue}let C=(A.isSpace?c:0)+l,S=i.charProcOperatorList[A.operatorListId];if(!S){Y(`Type3 character "${A.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=A,this.save(),t.scale(o,o),t.transform(...p),this.executeOperatorList(S),this.restore()),_=$.applyTransform([A.width,0],p)[0]*o+C,t.translate(_,0),n.x+=_*d}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,i,o,r){this.ctx.rect(n,i,o-n,r-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){let n=e[1],i=this.baseTransform||ce(this.ctx),o={createCanvasGraphics:r=>new Hv(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new ay(e,n,this.ctx,o,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){this.ctx.strokeStyle=this.current.strokeColor=$.makeHexColor(e,t,n),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,n){this.ctx.fillStyle=this.current.fillColor=$.makeHexColor(e,t,n),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=qR(this.getObject(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;let t=this.ctx;this.save();let n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,gn(t),Qe.SHADING);let i=gn(t);if(i){let{width:o,height:r}=t.canvas,[a,l,c,d]=$.getAxialAlignedBoundingBox([0,0,o,r],i);this.ctx.fillRect(a,l,c-a,d-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){re("Should not call beginInlineImage")}beginImageData(){re("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=ce(this.ctx),t)){let n=t[2]-t[0],i=t[3]-t[1];this.ctx.rect(t[0],t[1],n,i),this.current.updateRectMinMax(ce(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let t=this.ctx;e.isolated||Op("TODO: Support non-isolated groups."),e.knockout&&Y("Knockout groups not supported.");let n=ce(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=$.getAxialAlignedBoundingBox(e.bbox,ce(t)),o=[0,0,t.canvas.width,t.canvas.height];i=$.intersect(i,o)||[0,0,0,0];let r=Math.floor(i[0]),a=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-r,1),c=Math.max(Math.ceil(i[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,c]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);let p=this.cachedCanvases.getCanvas(d,l,c),g=p.context;g.translate(-r,-a),g.transform(...n),e.smask?this.smaskStack.push({canvas:p.canvas,context:g,offsetX:r,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(r,a),t.save()),Za(t,g),this.ctx=g,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;let t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let i=ce(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);let o=$.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],i);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(e,t,n,i,o){if(T(this,Ec,cy).call(this),Hd(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){let r=t[2]-t[0],a=t[3]-t[1];if(o&&this.annotationCanvasMap){n=n.slice(),n[4]-=t[0],n[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=r,t[3]=a;let[l,c]=$.singularValueDecompose2dScale(ce(this.ctx)),{viewportScale:d}=this,p=Math.ceil(r*this.outputScaleX*d),g=Math.ceil(a*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(p,g);let{canvas:m,context:y}=this.annotationCanvas;this.annotationCanvasMap.set(e,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=y,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,a*c),Hd(this.ctx)}else Hd(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],r,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new Dh(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),T(this,Cc,uy).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;let t=e.count;e=this.getObject(e.data,e),e.count=t;let n=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=YR(e)),i.compiled)){i.compiled(n);return}let o=this._createMaskCanvas(e),r=o.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(r,o.offsetX,o.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,i=0,o,r){if(!this.contentVisible)return;e=this.getObject(e.data,e);let a=this.ctx;a.save();let l=ce(a);a.transform(t,n,i,o,0,0);let c=this._createMaskCanvas(e);a.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let d=0,p=r.length;d<p;d+=2){let g=$.transform(l,[t,n,i,o,r[d],r[d+1]]),[m,y]=$.applyTransform([0,0],g);a.drawImage(c.canvas,m,y)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;let t=this.ctx,n=this.current.fillColor,i=this.current.patternFill;for(let o of e){let{data:r,width:a,height:l,transform:c}=o,d=this.cachedCanvases.getCanvas("maskCanvas",a,l),p=d.context;p.save();let g=this.getObject(r,o);H_(p,g),p.globalCompositeOperation="source-in",p.fillStyle=i?n.getPattern(p,this,gn(t),Qe.FILL):n,p.fillRect(0,0,a,l),p.restore(),t.save(),t.transform(...c),t.scale(1,-1),Bd(t,d.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);if(!t){Y("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,n,i){if(!this.contentVisible)return;let o=this.getObject(e);if(!o){Y("Dependent image isn't ready yet");return}let r=o.width,a=o.height,l=[];for(let c=0,d=i.length;c<d;c+=2)l.push({transform:[t,0,0,n,i[c],i[c+1]],x:0,y:0,w:r,h:a});this.paintInlineImageXObjectGroup(o,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;let{bitmap:t,width:n,height:i}=e,o=this.cachedCanvases.getCanvas("inlineImage",n,i),r=o.context;return r.filter=this.current.transferMaps,r.drawImage(t,0,0),r.filter="none",o.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;let t=e.width,n=e.height,i=this.ctx;if(this.save(),!je){let{filter:a}=i;a!=="none"&&a!==""&&(i.filter="none")}i.scale(1/t,-1/n);let o;if(e.bitmap)o=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)o=e;else{let l=this.cachedCanvases.getCanvas("inlineImage",t,n).context;B_(l,e),o=this.applyTransferMapsToCanvas(l)}let r=this._scaleImage(o,gn(i));i.imageSmoothingEnabled=V_(ce(i),e.interpolate),Bd(i,r.img,0,0,r.paintWidth,r.paintHeight,0,-n,t,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;let n=this.ctx,i;if(e.bitmap)i=e.bitmap;else{let o=e.width,r=e.height,l=this.cachedCanvases.getCanvas("inlineImage",o,r).context;B_(l,e),i=this.applyTransferMapsToCanvas(l)}for(let o of t)n.save(),n.transform(...o.transform),n.scale(1,-1),Bd(n,i,o.x,o.y,o.w,o.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);let n=this.ctx;this.pendingClip&&(t||(this.pendingClip===q_?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=ce(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:e}=this.current,{a:t,b:n,c:i,d:o}=this.ctx.getTransform(),r,a;if(n===0&&i===0){let l=Math.abs(t),c=Math.abs(o);if(l===c)if(e===0)r=a=1/l;else{let d=l*e;r=a=d<1?1/d:1}else if(e===0)r=1/l,a=1/c;else{let d=l*e,p=c*e;r=d<1?1/d:1,a=p<1?1/p:1}}else{let l=Math.abs(t*o-n*i),c=Math.hypot(t,n),d=Math.hypot(i,o);if(e===0)r=d/l,a=c/l;else{let p=e*l;r=d>p?d/p:1,a=c>p?c/p:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){let{ctx:t}=this,{lineWidth:n}=this.current,[i,o]=this.getScaleForStroking();if(t.lineWidth=n||1,i===1&&o===1){t.stroke();return}let r=t.getLineDash();if(e&&t.save(),t.scale(i,o),r.length>0){let a=Math.max(i,o);t.setLineDash(r.map(l=>l/a)),t.lineDashOffset/=a}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Ec=new WeakSet,cy=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Cc=new WeakSet,uy=function(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Sc=new WeakSet,dy=function(e,t,n){let i=new Path2D;return i.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),i};var lr=Hv;for(let s in Jt)lr.prototype[s]!==void 0&&(lr.prototype[Jt[s]]=lr.prototype[s]);var bc,xc,dn=class{static get workerPort(){return u(this,bc)}static set workerPort(e){if(!(typeof Worker!="undefined"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");w(this,bc,e)}static get workerSrc(){return u(this,xc)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");w(this,xc,e)}};bc=new WeakMap,xc=new WeakMap,v(dn,bc,null),v(dn,xc,"");var Js,Ic,hy=class{constructor({parsedData:e,rawData:t}){v(this,Js,void 0);v(this,Ic,void 0);w(this,Js,e),w(this,Ic,t)}getRaw(){return u(this,Ic)}get(e){var t;return(t=u(this,Js).get(e))!=null?t:null}getAll(){return Lv(u(this,Js))}has(e){return u(this,Js).has(e)}};Js=new WeakMap,Ic=new WeakMap;var nr=Symbol("INTERNAL"),Rc,Pc,Mc,Lr,fy=class{constructor(e,{name:t,intent:n,usage:i,rbGroups:o}){v(this,Rc,!1);v(this,Pc,!1);v(this,Mc,!1);v(this,Lr,!0);w(this,Rc,!!(e&Rt.DISPLAY)),w(this,Pc,!!(e&Rt.PRINT)),this.name=t,this.intent=n,this.usage=i,this.rbGroups=o}get visible(){if(u(this,Mc))return u(this,Lr);if(!u(this,Lr))return!1;let{print:e,view:t}=this.usage;return u(this,Rc)?(t==null?void 0:t.viewState)!=="OFF":u(this,Pc)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,n=!1){e!==nr&&re("Internal method `_setVisible` called."),w(this,Mc,n),w(this,Lr,t)}};Rc=new WeakMap,Pc=new WeakMap,Mc=new WeakMap,Lr=new WeakMap;var Bi,se,Ur,Or,Nc,gy,py=class{constructor(e,t=Rt.DISPLAY){v(this,Nc);v(this,Bi,null);v(this,se,new Map);v(this,Ur,null);v(this,Or,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,w(this,Or,e.order);for(let n of e.groups)u(this,se).set(n.id,new fy(t,n));if(e.baseState==="OFF")for(let n of u(this,se).values())n._setVisible(nr,!1);for(let n of e.on)u(this,se).get(n)._setVisible(nr,!0);for(let n of e.off)u(this,se).get(n)._setVisible(nr,!1);w(this,Ur,this.getHash())}}isVisible(e){if(u(this,se).size===0)return!0;if(!e)return Op("Optional content group not defined."),!0;if(e.type==="OCG")return u(this,se).has(e.id)?u(this,se).get(e.id).visible:(Y(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return T(this,Nc,gy).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(let t of e.ids){if(!u(this,se).has(t))return Y(`Optional content group not found: ${t}`),!0;if(u(this,se).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(let t of e.ids){if(!u(this,se).has(t))return Y(`Optional content group not found: ${t}`),!0;if(!u(this,se).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(let t of e.ids){if(!u(this,se).has(t))return Y(`Optional content group not found: ${t}`),!0;if(!u(this,se).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(let t of e.ids){if(!u(this,se).has(t))return Y(`Optional content group not found: ${t}`),!0;if(u(this,se).get(t).visible)return!1}return!0}return Y(`Unknown optional content policy ${e.policy}.`),!0}return Y(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){var o;let i=u(this,se).get(e);if(!i){Y(`Optional content group not found: ${e}`);return}if(n&&t&&i.rbGroups.length)for(let r of i.rbGroups)for(let a of r)a!==e&&((o=u(this,se).get(a))==null||o._setVisible(nr,!1,!0));i._setVisible(nr,!!t,!0),w(this,Bi,null)}setOCGState({state:e,preserveRB:t}){let n;for(let i of e){switch(i){case"ON":case"OFF":case"Toggle":n=i;continue}let o=u(this,se).get(i);if(o)switch(n){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!o.visible,t);break}}w(this,Bi,null)}get hasInitialVisibility(){return u(this,Ur)===null||this.getHash()===u(this,Ur)}getOrder(){return u(this,se).size?u(this,Or)?u(this,Or).slice():[...u(this,se).keys()]:null}getGroups(){return u(this,se).size>0?Lv(u(this,se)):null}getGroup(e){return u(this,se).get(e)||null}getHash(){if(u(this,Bi)!==null)return u(this,Bi);let e=new bh;for(let[t,n]of u(this,se))e.update(`${t}:${n.visible}`);return w(this,Bi,e.hexdigest())}};Bi=new WeakMap,se=new WeakMap,Ur=new WeakMap,Or=new WeakMap,Nc=new WeakSet,gy=function(e){let t=e.length;if(t<2)return!0;let n=e[0];for(let i=1;i<t;i++){let o=e[i],r;if(Array.isArray(o))r=T(this,Nc,gy).call(this,o);else if(u(this,se).has(o))r=u(this,se).get(o).visible;else return Y(`Optional content group not found: ${o}`),!0;switch(n){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return n==="And"};var my=class{constructor(e,{disableRange:t=!1,disableStream:n=!1}){_e(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:i,initialData:o,progressiveDone:r,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=a,(o==null?void 0:o.length)>0){let l=o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),e.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){let n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{let i=this._rangeReaders.some(function(o){return o._begin!==e?!1:(o._enqueue(n),!0)});_e(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e,t;return(t=(e=this._fullRequestReader)==null?void 0:e._loaded)!=null?t:0}_onProgress(e){var t,n,i,o;e.total===void 0?(n=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||n.call(t,{loaded:e.loaded}):(o=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||o.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){_e(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new yy(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new vy(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}},yy=class{constructor(e,t,n=!1,i=null){this._stream=e,this._done=n||!1,this._filename=Ov(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(let o of this._queuedChunks)this._loaded+=o.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},vy=class{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function QR(s){let e=!0,t=n("filename\\*","i").exec(s);if(t){t=t[1];let d=a(t);return d=unescape(d),d=l(d),d=c(d),o(d)}if(t=r(s),t){let d=c(t);return o(d)}if(t=n("filename","i").exec(s),t){t=t[1];let d=a(t);return d=c(d),o(d)}function n(d,p){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',p)}function i(d,p){if(d){if(!/^[\x00-\xFF]+$/.test(p))return p;try{let g=new TextDecoder(d,{fatal:!0}),m=$p(p);p=g.decode(m),e=!1}catch(g){}}return p}function o(d){return e&&/[\x80-\xff]/.test(d)&&(d=i("utf-8",d),e&&(d=i("iso-8859-1",d))),d}function r(d){let p=[],g,m=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(g=m.exec(d))!==null;){let[,A,_,E]=g;if(A=parseInt(A,10),A in p){if(A===0)break;continue}p[A]=[_,E]}let y=[];for(let A=0;A<p.length&&A in p;++A){let[_,E]=p[A];E=a(E),_&&(E=unescape(E),A===0&&(E=l(E))),y.push(E)}return y.join("")}function a(d){if(d.startsWith('"')){let p=d.slice(1).split('\\"');for(let g=0;g<p.length;++g){let m=p[g].indexOf('"');m!==-1&&(p[g]=p[g].slice(0,m),p.length=g+1),p[g]=p[g].replaceAll(/\\(.)/g,"$1")}d=p.join('"')}return d}function l(d){let p=d.indexOf("'");if(p===-1)return d;let g=d.slice(0,p),y=d.slice(p+1).replace(/^[^']*'/,"");return i(g,y)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(p,g,m,y){if(m==="q"||m==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(A,_){return String.fromCharCode(parseInt(_,16))}),i(g,y);try{y=atob(y)}catch(A){}return i(g,y)})}return""}function MT(s,e){let t=new Headers;if(!s||!e||typeof e!="object")return t;for(let n in e){let i=e[n];i!==void 0&&t.append(n,i)}return t}function Hp(s){try{return new URL(s).origin}catch(e){}return null}function NT({responseHeaders:s,isHttp:e,rangeChunkSize:t,disableRange:n}){let i={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(s.get("Content-Length"),10);return!Number.isInteger(o)||(i.suggestedLength=o,o<=2*t)||n||!e||s.get("Accept-Ranges")!=="bytes"||(s.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function kT(s){let e=s.get("Content-Disposition");if(e){let t=QR(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch(n){}if(Ov(t))return t}return null}function Vp(s,e){return s===404||s===0&&e.startsWith("file:")?new Uo('Missing PDF "'+e+'".'):new Ga(`Unexpected server response (${s}) while retrieving PDF "${e}".`,s)}function DT(s){return s===200||s===206}function FT(s,e,t){return{method:"GET",headers:s,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function LT(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:(Y(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}var Fh=class{constructor(e){H(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=MT(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return(t=(e=this._fullRequestReader)==null?void 0:e._loaded)!=null?t:0}getFullReader(){return _e(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new wy(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new Ay(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeRequestReaders.slice(0))n.cancel(e)}},wy=class{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;let n=new Headers(e.headers),i=t.url;fetch(i,FT(n,this._withCredentials,this._abortController)).then(o=>{if(e._responseOrigin=Hp(o.url),!DT(o.status))throw Vp(o.status,i);this._reader=o.body.getReader(),this._headersCapability.resolve();let r=o.headers,{allowRangeRequests:a,suggestedLength:l}=NT({responseHeaders:r,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=kT(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Ln("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:LT(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}},Ay=class{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;let i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;let o=new Headers(e.headers);o.append("Range",`bytes=${t}-${n-1}`);let r=i.url;fetch(r,FT(o,this._withCredentials,this._abortController)).then(a=>{let l=Hp(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!DT(a.status))throw Vp(a.status,r);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:LT(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}},wm=200,Am=206;function jR(s){let e=s.response;return typeof e!="string"?e:$p(e).buffer}var _y=class{constructor({url:e,httpHeaders:t,withCredentials:n}){H(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=MT(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){let t=new XMLHttpRequest,n=this.currXhrId++,i=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(let[o,r]of this.headers)t.setRequestHeader(o,r);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=Am):i.expectedStatus=wm,t.responseType="arraybuffer",_e(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var i;let n=this.pendingRequests[e];n&&((i=n.onProgress)==null||i.call(n,t))}onStateChange(e,t){let n=this.pendingRequests[e];if(!n)return;let i=n.xhr;if(i.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){n.onError(i.status);return}let o=i.status||wm;if(!(o===wm&&n.expectedStatus===Am)&&o!==n.expectedStatus){n.onError(i.status);return}let a=jR(i);if(o===Am){let l=i.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?n.onDone({begin:parseInt(c[1],10),chunk:a}):(Y('Missing or invalid "Content-Range" header.'),n.onError(0))}else a?n.onDone({begin:0,chunk:a}):n.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}},Ty=class{constructor(e){this._source=e,this._manager=new _y(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return _e(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Ey(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let n=new Cy(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeRequestReaders.slice(0))n.cancel(e)}},Ey=class{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Hp(t.responseURL);let n=t.getAllResponseHeaders(),i=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{let[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:o,suggestedLength:r}=NT({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});o&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=kT(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Vp(e,this._url),this._headersCapability.reject(this._storedError);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},Cy=class{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;let e=Hp((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){var t;(t=this._storedError)!=null||(this._storedError=Vp(e,this._url));for(let n of this._requests)n.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},eP=/^[a-z][a-z0-9\-+.]+:/i;function tP(s){if(eP.test(s))return new URL(s);let e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(s))}var Sy=class{constructor(e){this.source=e,this.url=tP(e.url),_e(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return(t=(e=this._fullRequestReader)==null?void 0:e._loaded)!=null?t:0}getFullReader(){return _e(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new by(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new xy(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeRequestReaders.slice(0))n.cancel(e)}},by=class{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=new Uo(`Missing PDF "${this._url}".`)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Ln("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},xy=class{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let i=e.source;this._isStreamingSupported=!i.disableStream;let o=process.getBuiltinModule("fs");this._setReadableStream(o.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}},nP=1e5,ct=30,iP=.8,K_,Hi,ft,kc,Dc,Xs,ti,Fc,Lc,Zs,$r,Gr,Vi,Br,Uc,Hr,Qs,Oc,$c,js,eo,Gc,qi,Vr,Uf,UT,Of,OT,Bc,Iy,qr,nh,Hc,Ry,$f,$T,Gf,GT,pe=class pe{constructor({textContentSource:e,container:t,viewport:n}){v(this,Uf);v(this,Of);v(this,Bc);v(this,Hi,Promise.withResolvers());v(this,ft,null);v(this,kc,!1);v(this,Dc,!!((K_=globalThis.FontInspector)!=null&&K_.enabled));v(this,Xs,null);v(this,ti,null);v(this,Fc,0);v(this,Lc,0);v(this,Zs,null);v(this,$r,null);v(this,Gr,0);v(this,Vi,0);v(this,Br,Object.create(null));v(this,Uc,[]);v(this,Hr,null);v(this,Qs,[]);v(this,Oc,new WeakMap);v(this,$c,null);var l;if(e instanceof ReadableStream)w(this,Hr,e);else if(typeof e=="object")w(this,Hr,new ReadableStream({start(c){c.enqueue(e),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');w(this,ft,w(this,$r,t)),w(this,Vi,n.scale*(globalThis.devicePixelRatio||1)),w(this,Gr,n.rotation),w(this,ti,{div:null,properties:null,ctx:null});let{pageWidth:i,pageHeight:o,pageX:r,pageY:a}=n.rawDims;w(this,$c,[1,0,0,-1,-r,a+o]),w(this,Lc,i),w(this,Fc,o),T(l=pe,$f,$T).call(l),Oo(t,n),u(this,Hi).promise.finally(()=>{u(pe,Vr).delete(this),w(this,ti,null),w(this,Br,null)}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:e,isFirefox:t}=Be.platform;return Z(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){let e=()=>{u(this,Zs).read().then(({value:t,done:n})=>{var i;if(n){u(this,Hi).resolve();return}(i=u(this,Xs))!=null||w(this,Xs,t.lang),Object.assign(u(this,Br),t.styles),T(this,Uf,UT).call(this,t.items),e()},u(this,Hi).reject)};return w(this,Zs,u(this,Hr).getReader()),u(pe,Vr).add(this),e(),u(this,Hi).promise}update({viewport:e,onBefore:t=null}){var o;let n=e.scale*(globalThis.devicePixelRatio||1),i=e.rotation;if(i!==u(this,Gr)&&(t==null||t(),w(this,Gr,i),Oo(u(this,$r),{rotation:i})),n!==u(this,Vi)){t==null||t(),w(this,Vi,n);let r={div:null,properties:null,ctx:T(o=pe,qr,nh).call(o,u(this,Xs))};for(let a of u(this,Qs))r.properties=u(this,Oc).get(a),r.div=a,T(this,Bc,Iy).call(this,r)}}cancel(){var t;let e=new Ln("TextLayer task cancelled.");(t=u(this,Zs))==null||t.cancel(e).catch(()=>{}),w(this,Zs,null),u(this,Hi).reject(e)}get textDivs(){return u(this,Qs)}get textContentItemsStr(){return u(this,Uc)}static cleanup(){if(!(u(this,Vr).size>0)){u(this,js).clear();for(let{canvas:e}of u(this,eo).values())e.remove();u(this,eo).clear()}}};Hi=new WeakMap,ft=new WeakMap,kc=new WeakMap,Dc=new WeakMap,Xs=new WeakMap,ti=new WeakMap,Fc=new WeakMap,Lc=new WeakMap,Zs=new WeakMap,$r=new WeakMap,Gr=new WeakMap,Vi=new WeakMap,Br=new WeakMap,Uc=new WeakMap,Hr=new WeakMap,Qs=new WeakMap,Oc=new WeakMap,$c=new WeakMap,js=new WeakMap,eo=new WeakMap,Gc=new WeakMap,qi=new WeakMap,Vr=new WeakMap,Uf=new WeakSet,UT=function(e){var i,o,r;if(u(this,kc))return;(r=(o=u(this,ti)).ctx)!=null||(o.ctx=T(i=pe,qr,nh).call(i,u(this,Xs)));let t=u(this,Qs),n=u(this,Uc);for(let a of e){if(t.length>nP){Y("Ignoring additional textDivs for performance reasons."),w(this,kc,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){let l=u(this,ft);w(this,ft,document.createElement("span")),u(this,ft).classList.add("markedContent"),a.id!==null&&u(this,ft).setAttribute("id",`${a.id}`),l.append(u(this,ft))}else a.type==="endMarkedContent"&&w(this,ft,u(this,ft).parentNode);continue}n.push(a.str),T(this,Of,OT).call(this,a)}},Of=new WeakSet,OT=function(e){var A;let t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};u(this,Qs).push(t);let i=$.transform(u(this,$c),e.transform),o=Math.atan2(i[1],i[0]),r=u(this,Br)[e.fontName];r.vertical&&(o+=Math.PI/2);let a=u(this,Dc)&&r.fontSubstitution||r.fontFamily;a=pe.fontFamilyMap.get(a)||a;let l=Math.hypot(i[2],i[3]),c=l*T(A=pe,Gf,GT).call(A,a,u(this,Xs)),d,p;o===0?(d=i[4],p=i[5]-c):(d=i[4]+c*Math.sin(o),p=i[5]-c*Math.cos(o));let g="calc(var(--scale-factor)*",m=t.style;u(this,ft)===u(this,$r)?(m.left=`${(100*d/u(this,Lc)).toFixed(2)}%`,m.top=`${(100*p/u(this,Fc)).toFixed(2)}%`):(m.left=`${g}${d.toFixed(2)}px)`,m.top=`${g}${p.toFixed(2)}px)`),m.fontSize=`${g}${(u(pe,qi)*l).toFixed(2)}px)`,m.fontFamily=a,n.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,u(this,Dc)&&(t.dataset.fontName=r.fontSubstitutionLoadedName||e.fontName),o!==0&&(n.angle=o*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){let _=Math.abs(e.transform[0]),E=Math.abs(e.transform[3]);_!==E&&Math.max(_,E)/Math.min(_,E)>1.5&&(y=!0)}if(y&&(n.canvasWidth=r.vertical?e.height:e.width),u(this,Oc).set(t,n),u(this,ti).div=t,u(this,ti).properties=n,T(this,Bc,Iy).call(this,u(this,ti)),n.hasText&&u(this,ft).append(t),n.hasEOL){let _=document.createElement("br");_.setAttribute("role","presentation"),u(this,ft).append(_)}},Bc=new WeakSet,Iy=function(e){var a;let{div:t,properties:n,ctx:i}=e,{style:o}=t,r="";if(u(pe,qi)>1&&(r=`scale(${1/u(pe,qi)})`),n.canvasWidth!==0&&n.hasText){let{fontFamily:l}=o,{canvasWidth:c,fontSize:d}=n;T(a=pe,Hc,Ry).call(a,i,d*u(this,Vi),l);let{width:p}=i.measureText(t.textContent);p>0&&(r=`scaleX(${c*u(this,Vi)/p}) ${r}`)}n.angle!==0&&(r=`rotate(${n.angle}deg) ${r}`),r.length>0&&(o.transform=r)},qr=new WeakSet,nh=function(e=null){let t=u(this,eo).get(e||(e=""));if(!t){let n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),u(this,eo).set(e,t),u(this,Gc).set(t,{size:0,family:""})}return t},Hc=new WeakSet,Ry=function(e,t,n){let i=u(this,Gc).get(e);t===i.size&&n===i.family||(e.font=`${t}px ${n}`,i.size=t,i.family=n)},$f=new WeakSet,$T=function(){if(u(this,qi)!==null)return;let e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),w(this,qi,e.getBoundingClientRect().height),e.remove()},Gf=new WeakSet,GT=function(e,t){let n=u(this,js).get(e);if(n)return n;let i=T(this,qr,nh).call(this,t);i.canvas.width=i.canvas.height=ct,T(this,Hc,Ry).call(this,i,ct,e);let o=i.measureText(""),r=o.fontBoundingBoxAscent,a=Math.abs(o.fontBoundingBoxDescent);if(r){let d=r/(r+a);return u(this,js).set(e,d),i.canvas.width=i.canvas.height=0,d}i.strokeStyle="red",i.clearRect(0,0,ct,ct),i.strokeText("g",0,0);let l=i.getImageData(0,0,ct,ct).data;a=0;for(let d=l.length-1-3;d>=0;d-=4)if(l[d]>0){a=Math.ceil(d/4/ct);break}i.clearRect(0,0,ct,ct),i.strokeText("A",0,ct),l=i.getImageData(0,0,ct,ct).data,r=0;for(let d=0,p=l.length;d<p;d+=4)if(l[d]>0){r=ct-Math.floor(d/4/ct);break}i.canvas.width=i.canvas.height=0;let c=r?r/(r+a):iP;return u(this,js).set(e,c),c},v(pe,qr),v(pe,Hc),v(pe,$f),v(pe,Gf),v(pe,js,new Map),v(pe,eo,new Map),v(pe,Gc,new WeakMap),v(pe,qi,null),v(pe,Vr,new Set);var Sl=pe,bl=class s{static textContent(e){let t=[],n={items:t,styles:Object.create(null)};function i(o){var l;if(!o)return;let r=null,a=o.name;if(a==="#text")r=o.value;else if(s.shouldBuildText(a))(l=o==null?void 0:o.attributes)!=null&&l.textContent?r=o.attributes.textContent:o.value&&(r=o.value);else return;if(r!==null&&t.push({str:r}),!!o.children)for(let c of o.children)i(c)}return i(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}},sP=65536,oP=100,rP=5e3,aP=je?ey:Jm,lP=je?ty:Ph,cP=je?jm:Xm,uP=je?ny:kh;function dP(s={}){var Ht,ue;typeof s=="string"||s instanceof URL?s={url:s}:(s instanceof ArrayBuffer||ArrayBuffer.isView(s))&&(s={data:s});let e=new Py,{docId:t}=e,n=s.url?hP(s.url):null,i=s.data?fP(s.data):null,o=s.httpHeaders||null,r=s.withCredentials===!0,a=(Ht=s.password)!=null?Ht:null,l=s.range instanceof Lh?s.range:null,c=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:sP,d=s.worker instanceof cr?s.worker:null,p=s.verbosity,g=typeof s.docBaseUrl=="string"&&!Bp(s.docBaseUrl)?s.docBaseUrl:null,m=typeof s.cMapUrl=="string"?s.cMapUrl:null,y=s.cMapPacked!==!1,A=s.CMapReaderFactory||lP,_=typeof s.standardFontDataUrl=="string"?s.standardFontDataUrl:null,E=s.StandardFontDataFactory||uP,C=s.stopAtErrors!==!0,S=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,b=s.isEvalSupported!==!1,x=typeof s.isOffscreenCanvasSupported=="boolean"?s.isOffscreenCanvasSupported:!je,P=typeof s.isImageDecoderSupported=="boolean"?s.isImageDecoderSupported:!je&&(Be.platform.isFirefox||!globalThis.chrome),I=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,N=typeof s.disableFontFace=="boolean"?s.disableFontFace:je,M=s.fontExtraProperties===!0,F=s.enableXfa===!0,U=s.ownerDocument||globalThis.document,j=s.disableRange===!0,z=s.disableStream===!0,W=s.disableAutoFetch===!0,xe=s.pdfBug===!0,k=s.CanvasFactory||aP,B=s.FilterFactory||cP,mt=s.enableHWA===!0,fn=l?l.length:(ue=s.length)!=null?ue:NaN,Un=typeof s.useSystemFonts=="boolean"?s.useSystemFonts:!je&&!N,Mt=typeof s.useWorkerFetch=="boolean"?s.useWorkerFetch:A===Ph&&E===kh&&m&&_&&el(m,document.baseURI)&&el(_,document.baseURI),He=null;IR(p);let Te={canvasFactory:new k({ownerDocument:U,enableHWA:mt}),filterFactory:new B({docId:t,ownerDocument:U}),cMapReaderFactory:Mt?null:new A({baseUrl:m,isCompressed:y}),standardFontDataFactory:Mt?null:new E({baseUrl:_})};if(!d){let qa={verbosity:p,port:dn.workerPort};d=qa.port?cr.fromPort(qa):new cr(qa),e._worker=d}let Ho={docId:t,apiVersion:"4.10.38",data:i,password:a,disableAutoFetch:W,rangeChunkSize:c,length:fn,docBaseUrl:g,enableXfa:F,evaluatorOptions:{maxImageSize:S,disableFontFace:N,ignoreErrors:C,isEvalSupported:b,isOffscreenCanvasSupported:x,isImageDecoderSupported:P,canvasMaxAreaInBytes:I,fontExtraProperties:M,useSystemFonts:Un,cMapUrl:Mt?m:null,standardFontDataUrl:Mt?_:null}},Va={disableFontFace:N,fontExtraProperties:M,ownerDocument:U,pdfBug:xe,styleElement:He,loadingParams:{disableAutoFetch:W,enableXfa:F}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let qa=d.messageHandler.sendWithPromise("GetDocRequest",Ho,i?[i.buffer]:null),sg;if(l)sg=new my(l,{disableRange:j,disableStream:z});else if(!i){if(!n)throw new Error("getDocument - no `url` parameter provided.");let Vo;if(je)if(el(n)){if(typeof fetch=="undefined"||typeof Response=="undefined"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");Vo=Fh}else Vo=Sy;else Vo=el(n)?Fh:Ty;sg=new Vo({url:n,length:fn,httpHeaders:o,withCredentials:r,rangeChunkSize:c,disableRange:j,disableStream:z})}return qa.then(Vo=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let rw=new vs(t,Vo,d.port),kE=new Dy(rw,e,sg,Va,Te);e._transport=kE,rw.send("Ready",null)})}).catch(e._capability.reject),e}function hP(s){if(s instanceof URL)return s.href;try{return new URL(s,window.location).href}catch(e){if(je&&typeof s=="string")return s}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function fP(s){if(je&&typeof Buffer!="undefined"&&s instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength)return s;if(typeof s=="string")return $p(s);if(s instanceof ArrayBuffer||ArrayBuffer.isView(s)||typeof s=="object"&&!isNaN(s==null?void 0:s.length))return new Uint8Array(s);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function z_(s){return typeof s=="object"&&Number.isInteger(s==null?void 0:s.num)&&s.num>=0&&Number.isInteger(s==null?void 0:s.gen)&&s.gen>=0}var Bf,Hf=class Hf{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${et(Hf,Bf)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,n,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(o){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,o}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}};Bf=new WeakMap,v(Hf,Bf,0);var Py=Hf,Lh=class{constructor(e,t,n=!1,i=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let n of this._progressListeners)n(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){re("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},My=class{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Z(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},zi,ni,Wi,ir,zr,ih,Ny=class{constructor(e,t,n,i=!1){v(this,Wi);v(this,zr);v(this,zi,null);v(this,ni,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=i?new Th:null,this._pdfBug=i,this.commonObjs=n.commonObjs,this.objs=new Uh,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:i=0,dontFlip:o=!1}={}){return new Al({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:i,dontFlip:o})}getAnnotations({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Z(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:i=Si.ENABLE,transform:o=null,background:r=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:p=!1}){var b,x;(b=this._stats)==null||b.time("Overall");let g=this._transport.getRenderingIntent(n,i,d,p),{renderingIntent:m,cacheKey:y}=g;w(this,ni,!1),T(this,zr,ih).call(this),a||(a=this._transport.getOptionalContentConfig(m));let A=this._intentStates.get(y);A||(A=Object.create(null),this._intentStates.set(y,A)),A.streamReaderCancelTimeout&&(clearTimeout(A.streamReaderCancelTimeout),A.streamReaderCancelTimeout=null);let _=!!(m&Rt.PRINT);A.displayReadyCapability||(A.displayReadyCapability=Promise.withResolvers(),A.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(x=this._stats)==null||x.time("Page Request"),this._pumpOperatorList(g));let E=P=>{var I;A.renderTasks.delete(C),(this._maybeCleanupAfterRender||_)&&w(this,ni,!0),T(this,Wi,ir).call(this,!_),P?(C.capability.reject(P),this._abortOperatorList({intentState:A,reason:P instanceof Error?P:new Error(P)})):C.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(I=globalThis.Stats)!=null&&I.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},C=new Uy({callback:E,params:{canvasContext:e,viewport:t,transform:o,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:A.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!_,pdfBug:this._pdfBug,pageColors:c});(A.renderTasks||(A.renderTasks=new Set)).add(C);let S=C.task;return Promise.all([A.displayReadyCapability.promise,a]).then(([P,I])=>{var N;if(this.destroyed){E();return}if((N=this._stats)==null||N.time("Rendering"),!(I.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");C.initializeGraphics({transparency:P,optionalContentConfig:I}),C.operatorListChanged()}).catch(E),S}getOperatorList({intent:e="display",annotationMode:t=Si.ENABLE,printAnnotationStorage:n=null,isEditing:i=!1}={}){var c;function o(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}let r=this._transport.getRenderingIntent(e,t,n,i,!0),a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=o,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>bl.textContent(n));let t=this.streamTextContent(e);return new Promise(function(n,i){function o(){r.read().then(function({value:l,done:c}){var d;if(c){n(a);return}(d=a.lang)!=null||(a.lang=l.lang),Object.assign(a.styles,l.styles),a.items.push(...l.items),o()},i)}let r=t.getReader(),a={items:[],styles:Object.create(null),lang:null};o()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),w(this,ni,!1),T(this,zr,ih).call(this),Promise.all(e)}cleanup(e=!1){w(this,ni,!0);let t=T(this,Wi,ir).call(this,!1);return e&&t&&this._stats&&(this._stats=new Th),t}_startRenderPage(e,t){var i,o;let n=this._intentStates.get(t);n&&((i=this._stats)==null||i.timeEnd("Page Request"),(o=n.displayReadyCapability)==null||o.resolve(e))}_renderPageChunk(e,t){for(let n=0,i=e.length;n<i;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let n of t.renderTasks)n.operatorListChanged();e.lastChunk&&T(this,Wi,ir).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:i}){let{map:o,transfer:r}=n,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:o,modifiedIds:i},r).getReader(),c=this._intentStates.get(t);c.streamReader=l;let d=()=>{l.read().then(({value:p,done:g})=>{if(g){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(p,c),d())},p=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(let g of c.renderTasks)g.operatorListChanged();T(this,Wi,ir).call(this,!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(p);else if(c.opListReadCapability)c.opListReadCapability.reject(p);else throw p}})};d()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof _l){let i=oP;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new Ln(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[i,o]of this._intentStates)if(o===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}};zi=new WeakMap,ni=new WeakMap,Wi=new WeakSet,ir=function(e=!1){if(T(this,zr,ih).call(this),!u(this,ni)||this.destroyed)return!1;if(e)return w(this,zi,setTimeout(()=>{w(this,zi,null),T(this,Wi,ir).call(this,!1)},rP)),!1;for(let{renderTasks:t,operatorList:n}of this._intentStates.values())if(t.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),w(this,ni,!1),!0},zr=new WeakSet,ih=function(){u(this,zi)&&(clearTimeout(u(this,zi)),w(this,zi,null))};var ii,Vf,ky=class{constructor(){v(this,ii,new Map);v(this,Vf,Promise.resolve())}postMessage(e,t){let n={data:structuredClone(e,t?{transfer:t}:null)};u(this,Vf).then(()=>{for(let[i]of u(this,ii))i.call(this,n)})}addEventListener(e,t,n=null){let i=null;if((n==null?void 0:n.signal)instanceof AbortSignal){let{signal:o}=n;if(o.aborted){Y("LoopbackPort - cannot use an `aborted` signal.");return}let r=()=>this.removeEventListener(e,t);i=()=>o.removeEventListener("abort",r),o.addEventListener("abort",r)}u(this,ii).set(t,i)}removeEventListener(e,t){let n=u(this,ii).get(t);n==null||n(),u(this,ii).delete(t)}terminate(){for(let[,e]of u(this,ii))e==null||e();u(this,ii).clear()}};ii=new WeakMap,Vf=new WeakMap;var qf,to,no,Wr,sh,Kr,oh,le=class le{constructor({name:e=null,port:t=null,verbosity:n=RR()}={}){v(this,Wr);var i;if(this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((i=u(le,no))!=null&&i.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(u(le,no)||w(le,no,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new vs("main","worker",e),this._messageHandler.on("ready",function(){}),T(this,Wr,sh).call(this)}_initialize(){if(u(le,to)||u(le,Kr,oh)){this._setupFakeWorker();return}let{workerSrc:e}=le;try{le._isSameOrigin(window.location.href,e)||(e=le._createCDNWrapper(new URL(e,window.location).href));let t=new Worker(e,{type:"module"}),n=new vs("main","worker",t),i=()=>{o.abort(),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},o=new AbortController;t.addEventListener("error",()=>{this._webWorker||i()},{signal:o.signal}),n.on("test",a=>{if(o.abort(),this.destroyed||!a){i();return}this._messageHandler=n,this._port=t,this._webWorker=t,T(this,Wr,sh).call(this)}),n.on("ready",a=>{if(o.abort(),this.destroyed){i();return}try{r()}catch(l){this._setupFakeWorker()}});let r=()=>{let a=new Uint8Array;n.send("test",a,[a.buffer])};r();return}catch(t){Op("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){u(le,to)||(Y("Setting up fake worker."),w(le,to,!0)),le._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let t=new ky;this._port=t;let n=`fake${et(le,qf)._++}`,i=new vs(n+"_worker",n,t);e.setup(i,t),this._messageHandler=new vs(n,n+"_worker",t),T(this,Wr,sh).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,n;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=u(le,no))==null||t.delete(this._port),this._port=null,(n=this._messageHandler)==null||n.destroy(),this._messageHandler=null}static fromPort(e){var n;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");let t=(n=u(this,no))==null?void 0:n.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new le(e)}static get workerSrc(){if(dn.workerSrc)return dn.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Z(this,"_setupFakeWorkerGlobal",(async()=>u(this,Kr,oh)?u(this,Kr,oh):(await import(this.workerSrc)).WorkerMessageHandler)())}};qf=new WeakMap,to=new WeakMap,no=new WeakMap,Wr=new WeakSet,sh=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Kr=new WeakSet,oh=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch(t){return null}},v(le,Kr),v(le,qf,0),v(le,to,!1),v(le,no,void 0),je&&(w(le,to,!0),dn.workerSrc||(dn.workerSrc="./pdf.worker.mjs")),le._isSameOrigin=(e,t)=>{let n;try{if(n=new URL(e),!n.origin||n.origin==="null")return!1}catch(o){return!1}let i=new URL(t,n);return n.origin===i.origin},le._createCDNWrapper=e=>{let t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};var cr=le,si,xn,Yr,Jr,oi,io,ll,Dy=class{constructor(e,t,n,i,o){v(this,io);v(this,si,new Map);v(this,xn,new Map);v(this,Yr,new Map);v(this,Jr,new Map);v(this,oi,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Uh,this.fontLoader=new Km({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=o.canvasFactory,this.filterFactory=o.filterFactory,this.cMapReaderFactory=o.cMapReaderFactory,this.standardFontDataFactory=o.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Z(this,"annotationStorage",new El)}getRenderingIntent(e,t=Si.ENABLE,n=null,i=!1,o=!1){let r=Rt.DISPLAY,a=Wm;switch(e){case"any":r=Rt.ANY;break;case"display":break;case"print":r=Rt.PRINT;break;default:Y(`getRenderingIntent - invalid intent: ${e}`)}let l=r&Rt.PRINT&&n instanceof xh?n:this.annotationStorage;switch(t){case Si.DISABLE:r+=Rt.ANNOTATIONS_DISABLE;break;case Si.ENABLE:break;case Si.ENABLE_FORMS:r+=Rt.ANNOTATIONS_FORMS;break;case Si.ENABLE_STORAGE:r+=Rt.ANNOTATIONS_STORAGE,a=l.serializable;break;default:Y(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(r+=Rt.IS_EDITING),o&&(r+=Rt.OPLIST);let{ids:c,hash:d}=l.modifiedIds,p=[r,a.hash,d];return{renderingIntent:r,cacheKey:p.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=u(this,oi))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let i of u(this,xn).values())e.push(i._destroy());u(this,xn).clear(),u(this,Yr).clear(),u(this,Jr).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,o;this.commonObjs.clear(),this.fontLoader.clear(),u(this,si).clear(),this.filterFactory.destroy(),Sl.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new Ln("Worker was terminated.")),(o=this.messageHandler)==null||o.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,i)=>{_e(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},i.onPull=()=>{this._fullReader.read().then(function({value:o,done:r}){if(r){i.close();return}_e(o instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{this._fullReader.cancel(o),i.ready.catch(r=>{if(!this.destroyed)throw r})}}),e.on("ReaderHeadersReady",async n=>{var a;await this._fullReader.headersReady;let{isStreamingSupported:i,isRangeSupported:o,contentLength:r}=this._fullReader;return(!i||!o)&&(this._lastProgress&&((a=t.onProgress)==null||a.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var c;(c=t.onProgress)==null||c.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:i,isRangeSupported:o,contentLength:r}}),e.on("GetRangeReader",(n,i)=>{_e(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let o=this._networkStream.getRangeReader(n.begin,n.end);if(!o){i.close();return}i.onPull=()=>{o.read().then(function({value:r,done:a}){if(a){i.close();return}_e(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{o.cancel(r),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new My(n,this))}),e.on("DocException",n=>{t._capability.reject(ut(n))}),e.on("PasswordRequest",n=>{w(this,oi,Promise.withResolvers());try{if(!t.onPassword)throw ut(n);let i=o=>{o instanceof Error?u(this,oi).reject(o):u(this,oi).resolve({password:o})};t.onPassword(i,n.code)}catch(i){u(this,oi).reject(i)}return u(this,oi).promise}),e.on("DataLoaded",n=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;u(this,xn).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,i,o])=>{var r;if(this.destroyed||this.commonObjs.has(n))return null;switch(i){case"Font":let{disableFontFace:a,fontExtraProperties:l,pdfBug:c}=this._params;if("error"in o){let m=o.error;Y(`Error during font loading: ${m}`),this.commonObjs.resolve(n,m);break}let d=c&&((r=globalThis.FontInspector)!=null&&r.enabled)?(m,y)=>globalThis.FontInspector.fontAdded(m,y):null,p=new Ym(o,{disableFontFace:a,fontExtraProperties:l,inspectFont:d});this.fontLoader.bind(p).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!l&&p.data&&(p.data=null),this.commonObjs.resolve(n,p)});break;case"CopyLocalImage":let{imageRef:g}=o;_e(g,"The imageRef must be defined.");for(let m of u(this,xn).values())for(let[,y]of m.objs)if((y==null?void 0:y.ref)===g)return y.dataLen?(this.commonObjs.resolve(n,structuredClone(y)),y.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,o);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([n,i,o,r])=>{var l;if(this.destroyed)return;let a=u(this,xn).get(i);if(!a.objs.has(n)){if(a._intentStates.size===0){(l=r==null?void 0:r.bitmap)==null||l.close();return}switch(o){case"Image":a.objs.resolve(n,r),(r==null?void 0:r.dataLen)>ER&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(n,r);break;default:throw new Error(`Got unknown object type ${o}`)}}}),e.on("DocProgress",n=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:n.loaded,total:n.total})}),e.on("FetchBuiltInCMap",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(n)}),e.on("FetchStandardFontData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n,i;this.annotationStorage.size<=0&&Y("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:(i=(n=this._fullReader)==null?void 0:n.filename)!=null?i:null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,n=u(this,Yr).get(t);if(n)return n;let i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");o.refStr&&u(this,Jr).set(o.refStr,e);let r=new Ny(t,o,this,this._params.pdfBug);return u(this,xn).set(t,r),r});return u(this,Yr).set(t,i),i}getPageIndex(e){return z_(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return T(this,io,ll).call(this,"GetFieldObjects")}hasJSActions(){return T(this,io,ll).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return T(this,io,ll).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return T(this,io,ll).call(this,"GetOptionalContentConfig").then(t=>new py(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",t=u(this,si).get(e);if(t)return t;let n=this.messageHandler.sendWithPromise(e,null).then(i=>{var o,r,a,l;return{info:i[0],metadata:i[1]?new hy(i[1]):null,contentDispositionFilename:(r=(o=this._fullReader)==null?void 0:o.filename)!=null?r:null,contentLength:(l=(a=this._fullReader)==null?void 0:a.contentLength)!=null?l:null}});return u(this,si).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(let t of u(this,xn).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),u(this,si).clear(),this.filterFactory.destroy(!0),Sl.cleanup()}}cachedPageNumber(e){var n;if(!z_(e))return null;let t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return(n=u(this,Jr).get(t))!=null?n:null}};si=new WeakMap,xn=new WeakMap,Yr=new WeakMap,Jr=new WeakMap,oi=new WeakMap,io=new WeakSet,ll=function(e,t=null){let n=u(this,si).get(e);if(n)return n;let i=this.messageHandler.sendWithPromise(e,t);return u(this,si).set(e,i),i};var Qa=Symbol("INITIAL_DATA"),At,Vc,Fy,Uh=class{constructor(){v(this,Vc);v(this,At,Object.create(null))}get(e,t=null){if(t){let i=T(this,Vc,Fy).call(this,e);return i.promise.then(()=>t(i.data)),null}let n=u(this,At)[e];if(!n||n.data===Qa)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){let t=u(this,At)[e];return!!t&&t.data!==Qa}delete(e){let t=u(this,At)[e];return!t||t.data===Qa?!1:(delete u(this,At)[e],!0)}resolve(e,t=null){let n=T(this,Vc,Fy).call(this,e);n.data=t,n.resolve()}clear(){var e;for(let t in u(this,At)){let{data:n}=u(this,At)[t];(e=n==null?void 0:n.bitmap)==null||e.close()}w(this,At,Object.create(null))}*[Symbol.iterator](){for(let e in u(this,At)){let{data:t}=u(this,At)[e];t!==Qa&&(yield[e,t])}}};At=new WeakMap,Vc=new WeakSet,Fy=function(e){var t;return(t=u(this,At))[e]||(t[e]={...Promise.withResolvers(),data:Qa})};var Ki,Ly=class{constructor(e){v(this,Ki,null);w(this,Ki,e),this.onContinue=null}get promise(){return u(this,Ki).capability.promise}cancel(e=0){u(this,Ki).cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=u(this,Ki).operatorList;if(!e)return!1;let{annotationCanvasMap:t}=u(this,Ki);return e.form||e.canvas&&(t==null?void 0:t.size)>0}};Ki=new WeakMap;var Yi,so,ys=class ys{constructor({callback:e,params:t,objs:n,commonObjs:i,annotationCanvasMap:o,operatorList:r,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:p=!1,pageColors:g=null}){v(this,Yi,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=i,this.annotationCanvasMap=o,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=p,this.pageColors=g,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window!="undefined",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Ly(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var a,l;if(this.cancelled)return;if(this._canvas){if(u(ys,so).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");u(ys,so).add(this._canvas)}this._pdfBug&&((a=globalThis.StepperManager)!=null&&a.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:n,viewport:i,transform:o,background:r}=this.params;this.gfx=new lr(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:o,viewport:i,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var n;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),u(this,Yi)&&(window.cancelAnimationFrame(u(this,Yi)),w(this,Yi,null)),u(ys,so).delete(this._canvas),this.callback(e||new _l(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?w(this,Yi,window.requestAnimationFrame(()=>{w(this,Yi,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),u(ys,so).delete(this._canvas),this.callback())))}};Yi=new WeakMap,so=new WeakMap,v(ys,so,new WeakSet);var Uy=ys,pP="4.10.38",gP="f9bea397f";function W_(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}function ja(s){return Math.max(0,Math.min(255,255*s))}var Oh=class{static CMYK_G([e,t,n,i]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=ja(e),[e,e,e]}static G_HTML([e]){let t=W_(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(ja)}static RGB_HTML(e){return`#${e.map(W_).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,n+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,n,i]){return[ja(1-Math.min(1,e+i)),ja(1-Math.min(1,n+i)),ja(1-Math.min(1,t+i))]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){let i=1-e,o=1-t,r=1-n,a=Math.min(i,o,r);return["CMYK",i,o,r,a]}},Oy=class{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");let i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),n||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){re("Abstract method `_createSVG` called.")}},xl=class extends Oy{_createSVG(e){return document.createElementNS(Bn,e)}},$h=class{static setupStorage(e,t,n,i,o){let r=i.getValue(t,{value:null});switch(n.name){case"textarea":if(r.value!==null&&(e.textContent=r.value),o==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(r.value===n.attributes.xfaOn?e.setAttribute("checked",!0):r.value===n.attributes.xfaOff&&e.removeAttribute("checked"),o==="print")break;e.addEventListener("change",a=>{i.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&e.setAttribute("value",r.value),o==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})})}break;case"select":if(r.value!==null){e.setAttribute("value",r.value);for(let a of n.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{let l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(t,{value:c})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:i,linkService:o}){let{attributes:r}=t,a=e instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${i}`);for(let[l,c]of Object.entries(r))if(c!=null)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,c)}a&&o.addLinkAttributes(e,r.href,r.newWindow),n&&r.dataId&&this.setupStorage(e,r.dataId,t,n)}static render(e){var p,g;let t=e.annotationStorage,n=e.linkService,i=e.xfaHtml,o=e.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:o,linkService:n});let a=o!=="richText",l=e.div;if(l.append(r),e.viewport){let m=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=m}a&&l.setAttribute("class","xfaLayer xfaFont");let c=[];if(i.children.length===0){if(i.value){let m=document.createTextNode(i.value);r.append(m),a&&bl.shouldBuildText(i.name)&&c.push(m)}return{textDivs:c}}let d=[[i,-1,r]];for(;d.length>0;){let[m,y,A]=d.at(-1);if(y+1===m.children.length){d.pop();continue}let _=m.children[++d.at(-1)[1]];if(_===null)continue;let{name:E}=_;if(E==="#text"){let S=document.createTextNode(_.value);c.push(S),A.append(S);continue}let C=(p=_==null?void 0:_.attributes)!=null&&p.xmlns?document.createElementNS(_.attributes.xmlns,E):document.createElement(E);if(A.append(C),_.attributes&&this.setAttributes({html:C,element:_,storage:t,intent:o,linkService:n}),((g=_.children)==null?void 0:g.length)>0)d.push([_,-1,C]);else if(_.value){let S=document.createTextNode(_.value);a&&bl.shouldBuildText(E)&&c.push(S),C.append(S)}}for(let m of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){let t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}},qu=1e3,mP=9,Bo=new WeakSet;function ls(s){return{width:s[2]-s[0],height:s[3]-s[1]}}var $y=class{static create(e){switch(e.data.annotationType){case Ce.LINK:return new Gh(e);case Ce.TEXT:return new By(e);case Ce.WIDGET:switch(e.data.fieldType){case"Tx":return new Hy(e);case"Btn":return e.data.radioButton?new Bh(e):e.data.checkBox?new qy(e):new zy(e);case"Ch":return new Wy(e);case"Sig":return new Vy(e)}return new Ai(e);case Ce.POPUP:return new Il(e);case Ce.FREETEXT:return new Hh(e);case Ce.LINE:return new Xy(e);case Ce.SQUARE:return new Zy(e);case Ce.CIRCLE:return new Qy(e);case Ce.POLYLINE:return new Vh(e);case Ce.CARET:return new ev(e);case Ce.INK:return new Rl(e);case Ce.POLYGON:return new jy(e);case Ce.HIGHLIGHT:return new qh(e);case Ce.UNDERLINE:return new nv(e);case Ce.SQUIGGLY:return new iv(e);case Ce.STRIKEOUT:return new sv(e);case Ce.STAMP:return new zh(e);case Ce.FILEATTACHMENT:return new ov(e);default:return new ve(e)}}},oo,Xr,Zr,qc,Gy,Vv=class Vv{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:i=!1}={}){v(this,qc);v(this,oo,null);v(this,Xr,!1);v(this,Zr,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:n}){return!!(e!=null&&e.str||t!=null&&t.str||n!=null&&n.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Vv._hasPopupData(this.data)}updateEdited(e){var n;if(!this.container)return;u(this,oo)||w(this,oo,{rect:this.data.rect.slice(0)});let{rect:t}=e;t&&T(this,qc,Gy).call(this,t),(n=u(this,Zr))==null||n.popup.updateEdited(e)}resetEdited(){var e;u(this,oo)&&(T(this,qc,Gy).call(this,u(this,oo).rect),(e=u(this,Zr))==null||e.popup.resetEdited(),w(this,oo,null))}_createContainer(e){let{data:t,parent:{page:n,viewport:i}}=this,o=document.createElement("section");o.setAttribute("data-annotation-id",t.id),this instanceof Ai||(o.tabIndex=qu);let{style:r}=o;if(r.zIndex=this.parent.zIndex++,t.alternativeText&&(o.title=t.alternativeText),t.noRotate&&o.classList.add("norotate"),!t.rect||this instanceof Il){let{rotation:A}=t;return!t.hasOwnCanvas&&A!==0&&this.setRotation(A,o),o}let{width:a,height:l}=ls(t.rect);if(!e&&t.borderStyle.width>0){r.borderWidth=`${t.borderStyle.width}px`;let A=t.borderStyle.horizontalCornerRadius,_=t.borderStyle.verticalCornerRadius;if(A>0||_>0){let C=`calc(${A}px * var(--scale-factor)) / calc(${_}px * var(--scale-factor))`;r.borderRadius=C}else if(this instanceof Bh){let C=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;r.borderRadius=C}switch(t.borderStyle.style){case Xa.SOLID:r.borderStyle="solid";break;case Xa.DASHED:r.borderStyle="dashed";break;case Xa.BEVELED:Y("Unimplemented border style: beveled");break;case Xa.INSET:Y("Unimplemented border style: inset");break;case Xa.UNDERLINE:r.borderBottomStyle="solid";break;default:break}let E=t.borderColor||null;E?(w(this,Xr,!0),r.borderColor=$.makeHexColor(E[0]|0,E[1]|0,E[2]|0)):r.borderWidth=0}let c=$.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:d,pageHeight:p,pageX:g,pageY:m}=i.rawDims;r.left=`${100*(c[0]-g)/d}%`,r.top=`${100*(c[1]-m)/p}%`;let{rotation:y}=t;return t.hasOwnCanvas||y===0?(r.width=`${100*a/d}%`,r.height=`${100*l/p}%`):this.setRotation(y,o),o}setRotation(e,t=this.container){if(!this.data.rect)return;let{pageWidth:n,pageHeight:i}=this.parent.viewport.rawDims,{width:o,height:r}=ls(this.data.rect),a,l;e%180===0?(a=100*o/n,l=100*r/i):(a=100*r/n,l=100*o/i),t.style.width=`${a}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(t,n,i)=>{let o=i.detail[t],r=o[0],a=o.slice(1);i.target.style[n]=Oh[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[n]:Oh[`${r}_rgb`](a)})};return Z(this,"_commonActions",{display:t=>{let{display:n}=t.detail,i=n%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{let{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{let n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){let n=this._commonActions;for(let i of Object.keys(t.detail)){let o=e[i]||n[i];o==null||o(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let n=this._commonActions;for(let[i,o]of Object.entries(t)){let r=n[i];if(r){let a={detail:{[i]:o},target:e};r(a),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:e}=this.data;if(!e)return;let[t,n,i,o]=this.data.rect.map(A=>Math.fround(A));if(e.length===8){let[A,_,E,C]=e.subarray(2,6);if(i===A&&o===_&&t===E&&n===C)return}let{style:r}=this.container,a;if(u(this,Xr)){let{borderColor:A,borderWidth:_}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${A}" stroke-width="${_}">`],this.container.classList.add("hasBorder")}let l=i-t,c=o-n,{svgFactory:d}=this,p=d.createElement("svg");p.classList.add("quadrilateralsContainer"),p.setAttribute("width",0),p.setAttribute("height",0);let g=d.createElement("defs");p.append(g);let m=d.createElement("clipPath"),y=`clippath_${this.data.id}`;m.setAttribute("id",y),m.setAttribute("clipPathUnits","objectBoundingBox"),g.append(m);for(let A=2,_=e.length;A<_;A+=8){let E=e[A],C=e[A+1],S=e[A+2],b=e[A+3],x=d.createElement("rect"),P=(S-t)/l,I=(o-C)/c,N=(E-S)/l,M=(C-b)/c;x.setAttribute("x",P),x.setAttribute("y",I),x.setAttribute("width",N),x.setAttribute("height",M),m.append(x),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${P}" y="${I}" width="${N}" height="${M}"/>`)}u(this,Xr)&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(p),this.container.style.clipPath=`url(#${y})`}_createPopup(){let{data:e}=this,t=w(this,Zr,new Il({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){re("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let n=[];if(this._fieldObjects){let i=this._fieldObjects[e];if(i)for(let{page:o,id:r,exportValues:a}of i){if(o===-1||r===t)continue;let l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${r}"]`);if(c&&!Bo.has(c)){Y(`_getElementsByName - element not allowed: ${r}`);continue}n.push({id:r,exportValue:l,domElement:c})}return n}for(let i of document.getElementsByName(e)){let{exportValue:o}=i,r=i.getAttribute("data-element-id");r!==t&&Bo.has(i)&&n.push({id:r,exportValue:o,domElement:i})}return n}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};oo=new WeakMap,Xr=new WeakMap,Zr=new WeakMap,qc=new WeakSet,Gy=function(e){let{container:{style:t},data:{rect:n,rotation:i},parent:{viewport:{rawDims:{pageWidth:o,pageHeight:r,pageX:a,pageY:l}}}}=this;n==null||n.splice(0,4,...e);let{width:c,height:d}=ls(e);t.left=`${100*(e[0]-a)/o}%`,t.top=`${100*(r-e[3]+l)/r}%`,i===0?(t.width=`${100*c/o}%`,t.height=`${100*d/r}%`):this.setRotation(i)};var ve=Vv,ri,fs,zf,BT,Wf,HT,Gh=class extends ve{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});v(this,ri);v(this,zf);v(this,Wf);this.isTooltipOnly=t.data.isTooltipOnly}render(){let{data:t,linkService:n}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let o=!1;return t.url?(n.addLinkAttributes(i,t.url,t.newWindow),o=!0):t.action?(this._bindNamedAction(i,t.action),o=!0):t.attachment?(T(this,zf,BT).call(this,i,t.attachment,t.attachmentDest),o=!0):t.setOCGState?(T(this,Wf,HT).call(this,i,t.setOCGState),o=!0):t.dest?(this._bindLink(i,t.dest),o=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),o=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),o=!0):this.isTooltipOnly&&!o&&(this._bindLink(i,""),o=!0)),this.container.classList.add("linkAnnotation"),o&&this.container.append(i),this.container}_bindLink(t,n){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&T(this,ri,fs).call(this)}_bindNamedAction(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),T(this,ri,fs).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");let i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let o of Object.keys(n.actions)){let r=i.get(o);r&&(t[r]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:o}}),!1})}t.onclick||(t.onclick=()=>!1),T(this,ri,fs).call(this)}_bindResetFormAction(t,n){let i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),T(this,ri,fs).call(this),!this._fieldObjects){Y('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var p;i==null||i();let{fields:o,refs:r,include:a}=n,l=[];if(o.length!==0||r.length!==0){let g=new Set(r);for(let m of o){let y=this._fieldObjects[m]||[];for(let{id:A}of y)g.add(A)}for(let m of Object.values(this._fieldObjects))for(let y of m)g.has(y.id)===a&&l.push(y)}else for(let g of Object.values(this._fieldObjects))l.push(...g);let c=this.annotationStorage,d=[];for(let g of l){let{id:m}=g;switch(d.push(m),g.type){case"text":{let A=g.defaultValue||"";c.setValue(m,{value:A});break}case"checkbox":case"radiobutton":{let A=g.defaultValue===g.exportValues;c.setValue(m,{value:A});break}case"combobox":case"listbox":{let A=g.defaultValue||"";c.setValue(m,{value:A});break}default:continue}let y=document.querySelector(`[data-element-id="${m}"]`);if(y){if(!Bo.has(y)){Y(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}};ri=new WeakSet,fs=function(){this.container.setAttribute("data-internal-link","")},zf=new WeakSet,BT=function(t,n,i=null){t.href=this.linkService.getAnchorUrl(""),n.description&&(t.title=n.description),t.onclick=()=>{var o;return(o=this.downloadManager)==null||o.openOrDownloadData(n.content,n.filename,i),!1},T(this,ri,fs).call(this)},Wf=new WeakSet,HT=function(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),T(this,ri,fs).call(this)};var By=class extends ve{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}},Ai=class extends ve{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Be.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,i,o){n.includes("mouse")?e.addEventListener(n,r=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:o(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):e.addEventListener(n,r=>{var a;if(n==="blur"){if(!t.focused||!r.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}o&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:o(r)}}))})}_setEventListeners(e,t,n,i){var o,r,a;for(let[l,c]of n)(c==="Action"||(o=this.data.actions)!=null&&o[c])&&((c==="Focus"||c==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,c,i),c==="Focus"&&!((r=this.data.actions)!=null&&r.Blur)?this._setEventListener(e,t,"blur","Blur",null):c==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":$.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||mP,o=e.style,r,a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),d=Math.round(c/(qd*i))||1,p=c/d;r=Math.min(i,l(p/qd))}else{let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(i,l(c/qd))}o.fontSize=`calc(${r}px * var(--scale-factor))`,o.color=$.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(o.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}},Hy=class extends Ai{constructor(e){let t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,i){let o=this.annotationStorage;for(let r of this._getElementsByName(e.name,e.id))r.domElement&&(r.domElement[t]=n),o.setValue(r.id,{[i]:n})}render(){var i,o;let e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){let r=e.getValue(t,{value:this.data.fieldValue}),a=r.value||"",l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&a.length>l&&(a=a.slice(0,l));let c=r.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));let d={userValue:a,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=c!=null?c:a,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",c!=null?c:a),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Bo.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=qu,this._setRequired(n,this.data.required),l&&(n.maxLength=l),n.addEventListener("input",g=>{e.setValue(t,{value:g.target.value}),this.setPropertyOnSiblings(n,"value",g.target.value,"value"),d.formattedValue=null}),n.addEventListener("resetform",g=>{var y;let m=(y=this.data.defaultFieldValue)!=null?y:"";n.value=d.userValue=m,d.formattedValue=null});let p=g=>{let{formattedValue:m}=d;m!=null&&(g.target.value=m),g.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",m=>{var A;if(d.focused)return;let{target:y}=m;d.userValue&&(y.value=d.userValue),d.lastCommittedValue=y.value,d.commitKey=1,(A=this.data.actions)!=null&&A.Focus||(d.focused=!0)}),n.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);let y={value(A){var _;d.userValue=(_=A.detail.value)!=null?_:"",e.setValue(t,{value:d.userValue.toString()}),A.target.value=d.userValue},formattedValue(A){let{formattedValue:_}=A.detail;d.formattedValue=_,_!=null&&A.target!==document.activeElement&&(A.target.value=_),e.setValue(t,{formattedValue:_})},selRange(A){A.target.setSelectionRange(...A.detail.selRange)},charLimit:A=>{var S;let{charLimit:_}=A.detail,{target:E}=A;if(_===0){E.removeAttribute("maxLength");return}E.setAttribute("maxLength",_);let C=d.userValue;!C||C.length<=_||(C=C.slice(0,_),E.value=d.userValue=C,e.setValue(t,{value:C}),(S=this.linkService.eventBus)==null||S.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:C,willCommit:!0,commitKey:1,selStart:E.selectionStart,selEnd:E.selectionEnd}}))}};this._dispatchEventFromSandbox(y,m)}),n.addEventListener("keydown",m=>{var _;d.commitKey=1;let y=-1;if(m.key==="Escape"?y=0:m.key==="Enter"&&!this.data.multiLine?y=2:m.key==="Tab"&&(d.commitKey=3),y===-1)return;let{value:A}=m.target;d.lastCommittedValue!==A&&(d.lastCommittedValue=A,d.userValue=A,(_=this.linkService.eventBus)==null||_.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:A,willCommit:!0,commitKey:y,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});let g=p;p=null,n.addEventListener("blur",m=>{var A,_;if(!d.focused||!m.relatedTarget)return;(A=this.data.actions)!=null&&A.Blur||(d.focused=!1);let{value:y}=m.target;d.userValue=y,d.lastCommittedValue!==y&&((_=this.linkService.eventBus)==null||_.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:d.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}})),g(m)}),(o=this.data.actions)!=null&&o.Keystroke&&n.addEventListener("beforeinput",m=>{var x;d.lastCommittedValue=null;let{data:y,target:A}=m,{value:_,selectionStart:E,selectionEnd:C}=A,S=E,b=C;switch(m.inputType){case"deleteWordBackward":{let P=_.substring(0,E).match(/\w*[^\w]*$/);P&&(S-=P[0].length);break}case"deleteWordForward":{let P=_.substring(E).match(/^[^\w]*\w*/);P&&(b+=P[0].length);break}case"deleteContentBackward":E===C&&(S-=1);break;case"deleteContentForward":E===C&&(b+=1);break}m.preventDefault(),(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,change:y||"",willCommit:!1,selStart:S,selEnd:b}})}),this._setEventListeners(n,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(p&&n.addEventListener("blur",p),this.data.comb){let m=(this.data.rect[2]-this.data.rect[0])/l;n.classList.add("comb"),n.style.letterSpacing=`calc(${m}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},Vy=class extends Ai{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}},qy=class extends Ai{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,n=t.id,i=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(n,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let o=document.createElement("input");return Bo.add(o),o.setAttribute("data-element-id",n),o.disabled=t.readOnly,this._setRequired(o,this.data.required),o.type="checkbox",o.name=t.fieldName,i&&o.setAttribute("checked",!0),o.setAttribute("exportValue",t.exportValue),o.tabIndex=qu,o.addEventListener("change",r=>{let{name:a,checked:l}=r.target;for(let c of this._getElementsByName(a,n)){let d=l&&c.exportValue===t.exportValue;c.domElement&&(c.domElement.checked=d),e.setValue(c.id,{value:d})}e.setValue(n,{value:l})}),o.addEventListener("resetform",r=>{let a=t.defaultFieldValue||"Off";r.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(o.addEventListener("updatefromsandbox",r=>{let a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(n,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}},Bh=class extends Ai{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,t=this.data,n=t.id,i=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(n,{value:i})),i)for(let r of this._getElementsByName(t.fieldName,n))e.setValue(r.id,{value:!1});let o=document.createElement("input");if(Bo.add(o),o.setAttribute("data-element-id",n),o.disabled=t.readOnly,this._setRequired(o,this.data.required),o.type="radio",o.name=t.fieldName,i&&o.setAttribute("checked",!0),o.tabIndex=qu,o.addEventListener("change",r=>{let{name:a,checked:l}=r.target;for(let c of this._getElementsByName(a,n))e.setValue(c.id,{value:!1});e.setValue(n,{value:l})}),o.addEventListener("resetform",r=>{let a=t.defaultFieldValue;r.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){let r=t.buttonValue;o.addEventListener("updatefromsandbox",a=>{let l={value:c=>{let d=r===c.detail.value;for(let p of this._getElementsByName(c.target.name)){let g=d&&p.id===n;p.domElement&&(p.domElement.checked=g),e.setValue(p.id,{value:g})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}},zy=class extends Gh{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}},Wy=class extends Ai{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Bo.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=qu;let o=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",d=>{let p=this.data.defaultFieldValue;for(let g of i.options)g.selected=g.value===p});for(let d of this.data.options){let p=document.createElement("option");p.textContent=d.displayValue,p.value=d.exportValue,n.value.includes(d.exportValue)&&(p.setAttribute("selected",!0),o=!1),i.append(p)}let r=null;if(o){let d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),i.prepend(d),r=()=>{d.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}let a=d=>{let p=d?"value":"textContent",{options:g,multiple:m}=i;return m?Array.prototype.filter.call(g,y=>y.selected).map(y=>y[p]):g.selectedIndex===-1?null:g[g.selectedIndex][p]},l=a(!1),c=d=>{let p=d.target.options;return Array.prototype.map.call(p,g=>({displayValue:g.textContent,exportValue:g.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",d=>{let p={value(g){r==null||r();let m=g.detail.value,y=new Set(Array.isArray(m)?m:[m]);for(let A of i.options)A.selected=y.has(A.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(g){i.multiple=!0},remove(g){let m=i.options,y=g.detail.remove;m[y].selected=!1,i.remove(y),m.length>0&&Array.prototype.findIndex.call(m,_=>_.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:a(!0),items:c(g)}),l=a(!1)},clear(g){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(g){let{index:m,displayValue:y,exportValue:A}=g.detail.insert,_=i.children[m],E=document.createElement("option");E.textContent=y,E.value=A,_?_.before(E):i.append(E),e.setValue(t,{value:a(!0),items:c(g)}),l=a(!1)},items(g){let{items:m}=g.detail;for(;i.length!==0;)i.remove(0);for(let y of m){let{displayValue:A,exportValue:_}=y,E=document.createElement("option");E.textContent=A,E.value=_,i.append(E)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:a(!0),items:c(g)}),l=a(!1)},indices(g){let m=new Set(g.detail.indices);for(let y of g.target.options)y.selected=m.has(y.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(g){g.target.disabled=!g.detail.editable}};this._dispatchEventFromSandbox(p,d)}),i.addEventListener("input",d=>{var m;let p=a(!0),g=a(!1);e.setValue(t,{value:p}),d.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:g,changeEx:p,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):i.addEventListener("input",function(d){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},Il=class extends ve{constructor(e){let{data:t,elements:n}=e;super(e,{isRenderable:ve._hasPopupData(t)}),this.elements=n,this.popup=null}render(){this.container.classList.add("popupAnnotation");let e=this.popup=new Ky({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let n of this.elements)n.popup=e,n.container.ariaHasPopup="dialog",t.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(n=>`${Uv}${n}`).join(",")),this.container}},Qr,Kf,Yf,jr,ro,ge,ai,ea,zc,Wc,ta,li,tn,ci,Kc,ui,Yc,ao,lo,na,rh,Jc,Yy,Jf,VT,Xf,qT,Zf,zT,Qf,WT,ia,ah,sa,lh,Xc,Jy,Ky=class{constructor({container:e,color:t,elements:n,titleObj:i,modificationDate:o,contentsObj:r,richText:a,parent:l,rect:c,parentRect:d,open:p}){v(this,na);v(this,Jc);v(this,Jf);v(this,Xf);v(this,Zf);v(this,Qf);v(this,ia);v(this,sa);v(this,Xc);v(this,Qr,T(this,Zf,zT).bind(this));v(this,Kf,T(this,Xc,Jy).bind(this));v(this,Yf,T(this,sa,lh).bind(this));v(this,jr,T(this,ia,ah).bind(this));v(this,ro,null);v(this,ge,null);v(this,ai,null);v(this,ea,null);v(this,zc,null);v(this,Wc,null);v(this,ta,null);v(this,li,!1);v(this,tn,null);v(this,ci,null);v(this,Kc,null);v(this,ui,null);v(this,Yc,null);v(this,ao,null);v(this,lo,!1);var g;w(this,ge,e),w(this,Yc,i),w(this,ai,r),w(this,ui,a),w(this,Wc,l),w(this,ro,t),w(this,Kc,c),w(this,ta,d),w(this,zc,n),w(this,ea,yl.toDateObject(o)),this.trigger=n.flatMap(m=>m.getElementsToTriggerPopup());for(let m of this.trigger)m.addEventListener("click",u(this,jr)),m.addEventListener("mouseenter",u(this,Yf)),m.addEventListener("mouseleave",u(this,Kf)),m.classList.add("popupTriggerArea");for(let m of n)(g=m.container)==null||g.addEventListener("keydown",u(this,Qr));u(this,ge).hidden=!0,p&&T(this,ia,ah).call(this)}render(){if(u(this,tn))return;let e=w(this,tn,document.createElement("div"));if(e.className="popup",u(this,ro)){let o=e.style.outlineColor=$.makeHexColor(...u(this,ro));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${o} 30%, white)`:e.style.backgroundColor=$.makeHexColor(...u(this,ro).map(a=>Math.floor(.7*(255-a)+a)))}let t=document.createElement("span");t.className="header";let n=document.createElement("h1");if(t.append(n),{dir:n.dir,str:n.textContent}=u(this,Yc),e.append(t),u(this,ea)){let o=document.createElement("span");o.classList.add("popupDate"),o.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),o.setAttribute("data-l10n-args",JSON.stringify({dateObj:u(this,ea).valueOf()})),t.append(o)}let i=u(this,na,rh);if(i)$h.render({xfaHtml:i,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{let o=this._formatContents(u(this,ai));e.append(o)}u(this,ge).append(e)}_formatContents({str:e,dir:t}){let n=document.createElement("p");n.classList.add("popupContent"),n.dir=t;let i=e.split(/(?:\r\n?|\n)/);for(let o=0,r=i.length;o<r;++o){let a=i[o];n.append(document.createTextNode(a)),o<r-1&&n.append(document.createElement("br"))}return n}updateEdited({rect:e,popupContent:t}){var n;u(this,ao)||w(this,ao,{contentsObj:u(this,ai),richText:u(this,ui)}),e&&w(this,ci,null),t&&(w(this,ui,T(this,Xf,qT).call(this,t)),w(this,ai,null)),(n=u(this,tn))==null||n.remove(),w(this,tn,null)}resetEdited(){var e;u(this,ao)&&({contentsObj:et(this,ai)._,richText:et(this,ui)._}=u(this,ao),w(this,ao,null),(e=u(this,tn))==null||e.remove(),w(this,tn,null),w(this,ci,null))}forceHide(){w(this,lo,this.isVisible),u(this,lo)&&(u(this,ge).hidden=!0)}maybeShow(){u(this,lo)&&(u(this,tn)||T(this,sa,lh).call(this),w(this,lo,!1),u(this,ge).hidden=!1)}get isVisible(){return u(this,ge).hidden===!1}};Qr=new WeakMap,Kf=new WeakMap,Yf=new WeakMap,jr=new WeakMap,ro=new WeakMap,ge=new WeakMap,ai=new WeakMap,ea=new WeakMap,zc=new WeakMap,Wc=new WeakMap,ta=new WeakMap,li=new WeakMap,tn=new WeakMap,ci=new WeakMap,Kc=new WeakMap,ui=new WeakMap,Yc=new WeakMap,ao=new WeakMap,lo=new WeakMap,na=new WeakSet,rh=function(){let e=u(this,ui),t=u(this,ai);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&u(this,ui).html||null},Jc=new WeakSet,Yy=function(){var e,t,n;return((n=(t=(e=u(this,na,rh))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.fontSize)||0},Jf=new WeakSet,VT=function(){var e,t,n;return((n=(t=(e=u(this,na,rh))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.color)||null},Xf=new WeakSet,qT=function(e){let t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:u(this,Jf,VT),fontSize:u(this,Jc,Yy)?`calc(${u(this,Jc,Yy)}px * var(--scale-factor))`:""}};for(let o of e.split(`
`))t.push({name:"span",value:o,attributes:i});return n},Zf=new WeakSet,zT=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&u(this,li))&&T(this,ia,ah).call(this)},Qf=new WeakSet,WT=function(){if(u(this,ci)!==null)return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:i,pageY:o}}}=u(this,Wc),r=!!u(this,ta),a=r?u(this,ta):u(this,Kc);for(let y of u(this,zc))if(!a||$.intersect(y.data.rect,a)!==null){a=y.data.rect,r=!0;break}let l=$.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),d=r?a[2]-a[0]+5:0,p=l[0]+d,g=l[1];w(this,ci,[100*(p-i)/t,100*(g-o)/n]);let{style:m}=u(this,ge);m.left=`${u(this,ci)[0]}%`,m.top=`${u(this,ci)[1]}%`},ia=new WeakSet,ah=function(){w(this,li,!u(this,li)),u(this,li)?(T(this,sa,lh).call(this),u(this,ge).addEventListener("click",u(this,jr)),u(this,ge).addEventListener("keydown",u(this,Qr))):(T(this,Xc,Jy).call(this),u(this,ge).removeEventListener("click",u(this,jr)),u(this,ge).removeEventListener("keydown",u(this,Qr)))},sa=new WeakSet,lh=function(){u(this,tn)||this.render(),this.isVisible?u(this,li)&&u(this,ge).classList.add("focused"):(T(this,Qf,WT).call(this),u(this,ge).hidden=!1,u(this,ge).style.zIndex=parseInt(u(this,ge).style.zIndex)+1e3)},Xc=new WeakSet,Jy=function(){u(this,ge).classList.remove("focused"),!(u(this,li)||!this.isVisible)&&(u(this,ge).hidden=!0,u(this,ge).style.zIndex=parseInt(u(this,ge).style.zIndex)-1e3)};var Hh=class extends ve{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=K.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(let t of this.textContent){let n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Zc,Xy=class extends ve{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});v(this,Zc,null)}render(){this.container.classList.add("lineAnnotation");let t=this.data,{width:n,height:i}=ls(t.rect),o=this.svgFactory.create(n,i,!0),r=w(this,Zc,this.svgFactory.createElement("svg:line"));return r.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),r.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),r.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),r.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),r.setAttribute("stroke-width",t.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),o.append(r),this.container.append(o),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Zc)}addHighlightArea(){this.container.classList.add("highlightArea")}};Zc=new WeakMap;var Qc,Zy=class extends ve{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});v(this,Qc,null)}render(){this.container.classList.add("squareAnnotation");let t=this.data,{width:n,height:i}=ls(t.rect),o=this.svgFactory.create(n,i,!0),r=t.borderStyle.width,a=w(this,Qc,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",r/2),a.setAttribute("y",r/2),a.setAttribute("width",n-r),a.setAttribute("height",i-r),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),o.append(a),this.container.append(o),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Qc)}addHighlightArea(){this.container.classList.add("highlightArea")}};Qc=new WeakMap;var jc,Qy=class extends ve{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});v(this,jc,null)}render(){this.container.classList.add("circleAnnotation");let t=this.data,{width:n,height:i}=ls(t.rect),o=this.svgFactory.create(n,i,!0),r=t.borderStyle.width,a=w(this,jc,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",n/2),a.setAttribute("cy",i/2),a.setAttribute("rx",n/2-r/2),a.setAttribute("ry",i/2-r/2),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),o.append(a),this.container.append(o),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,jc)}addHighlightArea(){this.container.classList.add("highlightArea")}};jc=new WeakMap;var eu,Vh=class extends ve{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});v(this,eu,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,vertices:n,borderStyle:i,popupRef:o}}=this;if(!n)return this.container;let{width:r,height:a}=ls(t),l=this.svgFactory.create(r,a,!0),c=[];for(let p=0,g=n.length;p<g;p+=2){let m=n[p]-t[0],y=t[3]-n[p+1];c.push(`${m},${y}`)}c=c.join(" ");let d=w(this,eu,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",c),d.setAttribute("stroke-width",i.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),l.append(d),this.container.append(l),!o&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,eu)}addHighlightArea(){this.container.classList.add("highlightArea")}};eu=new WeakMap;var jy=class extends Vh{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},ev=class extends ve{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},tu,co,nu,tv,Rl=class extends ve{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});v(this,nu);v(this,tu,null);v(this,co,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?K.HIGHLIGHT:K.INK}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,rotation:n,inkLists:i,borderStyle:o,popupRef:r}}=this,{transform:a,width:l,height:c}=T(this,nu,tv).call(this,n,t),d=this.svgFactory.create(l,c,!0),p=w(this,tu,this.svgFactory.createElement("svg:g"));d.append(p),p.setAttribute("stroke-width",o.width||1),p.setAttribute("stroke-linecap","round"),p.setAttribute("stroke-linejoin","round"),p.setAttribute("stroke-miterlimit",10),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),p.setAttribute("transform",a);for(let g=0,m=i.length;g<m;g++){let y=this.svgFactory.createElement(this.svgElementName);u(this,co).push(y),y.setAttribute("points",i[g].join(",")),p.append(y)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);let{thickness:n,points:i,rect:o}=t,r=u(this,tu);if(n>=0&&r.setAttribute("stroke-width",n||1),i)for(let a=0,l=u(this,co).length;a<l;a++)u(this,co)[a].setAttribute("points",i[a].join(","));if(o){let{transform:a,width:l,height:c}=T(this,nu,tv).call(this,this.data.rotation,o);r.parentElement.setAttribute("viewBox",`0 0 ${l} ${c}`),r.setAttribute("transform",a)}}getElementsToTriggerPopup(){return u(this,co)}addHighlightArea(){this.container.classList.add("highlightArea")}};tu=new WeakMap,co=new WeakMap,nu=new WeakSet,tv=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};var qh=class extends ve{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=K.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},nv=class extends ve{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},iv=class extends ve{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},sv=class extends ve{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},zh=class extends ve{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=K.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},iu,su,rv,ov=class extends ve{constructor(t){var i;super(t,{isRenderable:!0});v(this,su);v(this,iu,null);let{file:n}=this.data;this.filename=n.filename,this.content=n.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:t,data:n}=this,i;n.hasAppearance||n.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),i.addEventListener("dblclick",T(this,su,rv).bind(this)),w(this,iu,i);let{isMac:o}=Be.platform;return t.addEventListener("keydown",r=>{r.key==="Enter"&&(o?r.metaKey:r.ctrlKey)&&T(this,su,rv).call(this)}),!n.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return u(this,iu)}addHighlightArea(){this.container.classList.add("highlightArea")}};iu=new WeakMap,su=new WeakSet,rv=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var ou,uo,ho,ru,jf,KT,au,lv,av=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:i,page:o,viewport:r,structTreeLayer:a}){v(this,jf);v(this,au);v(this,ou,null);v(this,uo,null);v(this,ho,new Map);v(this,ru,null);this.div=e,w(this,ou,t),w(this,uo,n),w(this,ru,a||null),this.page=o,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return u(this,ho).size>0}async render(e){var r;let{annotations:t}=e,n=this.div;Oo(n,this.viewport);let i=new Map,o={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new xl,annotationStorage:e.annotationStorage||new El,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let a of t){if(a.noHTML)continue;let l=a.annotationType===Ce.POPUP;if(l){let p=i.get(a.id);if(!p)continue;o.elements=p}else{let{width:p,height:g}=ls(a.rect);if(p<=0||g<=0)continue}o.data=a;let c=$y.create(o);if(!c.isRenderable)continue;if(!l&&a.popupRef){let p=i.get(a.popupRef);p?p.push(c):i.set(a.popupRef,[c])}let d=c.render();a.hidden&&(d.style.visibility="hidden"),await T(this,jf,KT).call(this,d,a.id),c._isEditable&&(u(this,ho).set(c.data.id,c),(r=this._annotationEditorUIManager)==null||r.renderAnnotationElement(c))}T(this,au,lv).call(this)}update({viewport:e}){let t=this.div;this.viewport=e,Oo(t,{rotation:e.rotation}),T(this,au,lv).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(u(this,ho).values())}getEditableAnnotation(e){return u(this,ho).get(e)}};ou=new WeakMap,uo=new WeakMap,ho=new WeakMap,ru=new WeakMap,jf=new WeakSet,KT=async function(e,t){var r,a;let n=e.firstChild||e,i=n.id=`${Uv}${t}`,o=await((r=u(this,ru))==null?void 0:r.getAriaAttributes(i));if(o)for(let[l,c]of o)n.setAttribute(l,c);this.div.append(e),(a=u(this,ou))==null||a.moveElementInDOM(this.div,e,n,!1)},au=new WeakSet,lv=function(){if(!u(this,uo))return;let e=this.div;for(let[t,n]of u(this,uo)){let i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;n.className="annotationContent";let{firstChild:o}=i;o?o.nodeName==="CANVAS"?o.replaceWith(n):o.classList.contains("annotationContent")?o.after(n):o.before(n):i.append(n)}u(this,uo).clear()};var Vd=/\r\n?|\n/g,nn,_t,lu,fo,Tt,ep,YT,tp,JT,np,XT,oa,ch,ra,uh,aa,dh,ip,ZT,cu,uv,sp,QT,oe=class oe extends fe{constructor(t){super({...t,name:"freeTextEditor"});v(this,ep);v(this,tp);v(this,np);v(this,oa);v(this,aa);v(this,ip);v(this,sp);v(this,nn,void 0);v(this,_t,"");v(this,lu,`${this.id}-editor`);v(this,fo,null);v(this,Tt,void 0);w(this,nn,t.color||oe._defaultColor||fe._defaultLineColor),w(this,Tt,t.fontSize||oe._defaultFontSize)}static get _keyboardManager(){let t=oe.prototype,n=r=>r.isEmpty(),i=Go.TRANSLATE_SMALL,o=Go.TRANSLATE_BIG;return Z(this,"_keyboardManager",new $o([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-o,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[o,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-o],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,o],checker:n}]]))}static initialize(t,n){fe.initialize(t,n);let i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case Q.FREETEXT_SIZE:oe._defaultFontSize=n;break;case Q.FREETEXT_COLOR:oe._defaultColor=n;break}}updateParams(t,n){switch(t){case Q.FREETEXT_SIZE:T(this,ep,YT).call(this,n);break;case Q.FREETEXT_COLOR:T(this,tp,JT).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Q.FREETEXT_SIZE,oe._defaultFontSize],[Q.FREETEXT_COLOR,oe._defaultColor||fe._defaultLineColor]]}get propertiesToUpdate(){return[[Q.FREETEXT_SIZE,u(this,Tt)],[Q.FREETEXT_COLOR,u(this,nn)]]}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){let t=this.parentScale;return[-oe._internalPadding*t,-(oe._internalPadding+u(this,Tt))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(K.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),w(this,fo,new AbortController);let t=this._uiManager.combinedSignal(u(this,fo));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",u(this,lu)),this._isDraggable=!0,(t=u(this,fo))==null||t.abort(),w(this,fo,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var n;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let t=u(this,_t),n=w(this,_t,T(this,np,XT).call(this).trimEnd());if(t===n)return;let i=o=>{if(w(this,_t,o),!o){this.remove();return}T(this,aa,dh).call(this),this._uiManager.rebuild(this),T(this,oa,ch).call(this)};this.addCommands({cmd:()=>{i(n)},undo:()=>{i(t)},mustExec:!1}),T(this,oa,ch).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){oe._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,n;this.width&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",u(this,lu)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:i}=this.editorDiv;if(i.fontSize=`calc(${u(this,Tt)}px * var(--scale-factor))`,i.color=u(this,nn),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Eh(this,this.div,["dblclick","keydown"]),this.width){let[o,r]=this.parentDimensions;if(this.annotationElementId){let{position:a}=this._initialData,[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);let[d,p]=this.pageDimensions,[g,m]=this.pageTranslation,y,A;switch(this.rotation){case 0:y=t+(a[0]-g)/d,A=n+this.height-(a[1]-m)/p;break;case 90:y=t+(a[0]-g)/d,A=n-(a[1]-m)/p,[l,c]=[c,-l];break;case 180:y=t-this.width+(a[0]-g)/d,A=n-(a[1]-m)/p,[l,c]=[-l,-c];break;case 270:y=t+(a[0]-g-this.height*p)/d,A=n+(a[1]-m-this.width*d)/p,[l,c]=[-c,l];break}this.setAt(y*o,A*r,l,c)}else this.setAt(t*o,n*r,this.width*o,this.height*r);T(this,aa,dh).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var y,A,_;let n=t.clipboardData||window.clipboardData,{types:i}=n;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();let o=T(y=oe,cu,uv).call(y,n.getData("text")||"").replaceAll(Vd,`
`);if(!o)return;let r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();let a=r.getRangeAt(0);if(!o.includes(`
`)){a.insertNode(document.createTextNode(o)),this.editorDiv.normalize(),r.collapseToStart();return}let{startContainer:l,startOffset:c}=a,d=[],p=[];if(l.nodeType===Node.TEXT_NODE){let E=l.parentElement;if(p.push(l.nodeValue.slice(c).replaceAll(Vd,"")),E!==this.editorDiv){let C=d;for(let S of this.editorDiv.childNodes){if(S===E){C=p;continue}C.push(T(A=oe,ra,uh).call(A,S))}}d.push(l.nodeValue.slice(0,c).replaceAll(Vd,""))}else if(l===this.editorDiv){let E=d,C=0;for(let S of this.editorDiv.childNodes)C++===c&&(E=p),E.push(T(_=oe,ra,uh).call(_,S))}w(this,_t,`${d.join(`
`)}${o}${p.join(`
`)}`),T(this,aa,dh).call(this);let g=new Range,m=d.reduce((E,C)=>E+C.length,0);for(let{firstChild:E}of this.editorDiv.childNodes)if(E.nodeType===Node.TEXT_NODE){let C=E.nodeValue.length;if(m<=C){g.setStart(E,m),g.setEnd(E,m);break}m-=C}r.removeAllRanges(),r.addRange(g)}get contentDiv(){return this.editorDiv}static async deserialize(t,n,i){var a;let o=null;if(t instanceof Hh){let{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:d,rotation:p,id:g,popupRef:m},textContent:y,textPosition:A,parent:{page:{pageNumber:_}}}=t;if(!y||y.length===0)return null;o=t={annotationType:K.FREETEXT,color:Array.from(c),fontSize:l,value:y.join(`
`),position:A,pageIndex:_-1,rect:d.slice(0),rotation:p,id:g,deleted:!1,popupRef:m}}let r=await super.deserialize(t,n,i);return w(r,Tt,t.fontSize),w(r,nn,$.makeHexColor(...t.color)),w(r,_t,T(a=oe,cu,uv).call(a,t.value)),r.annotationElementId=t.id||null,r._initialData=o,r}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let n=oe._internalPadding*this.parentScale,i=this.getRect(n,n),o=fe._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:u(this,nn)),r={annotationType:K.FREETEXT,color:o,fontSize:u(this,Tt),value:T(this,ip,ZT).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?r:this.annotationElementId&&!T(this,sp,QT).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){let n=super.renderAnnotationElement(t);if(this.deleted)return n;let{style:i}=n;i.fontSize=`calc(${u(this,Tt)}px * var(--scale-factor))`,i.color=u(this,nn),n.replaceChildren();for(let r of u(this,_t).split(`
`)){let a=document.createElement("div");a.append(r?document.createTextNode(r):document.createElement("br")),n.append(a)}let o=oe._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(o,o),popupContent:u(this,_t)}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};nn=new WeakMap,_t=new WeakMap,lu=new WeakMap,fo=new WeakMap,Tt=new WeakMap,ep=new WeakSet,YT=function(t){let n=o=>{this.editorDiv.style.fontSize=`calc(${o}px * var(--scale-factor))`,this.translate(0,-(o-u(this,Tt))*this.parentScale),w(this,Tt,o),T(this,oa,ch).call(this)},i=u(this,Tt);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},tp=new WeakSet,JT=function(t){let n=o=>{w(this,nn,this.editorDiv.style.color=o)},i=u(this,nn);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},np=new WeakSet,XT=function(){var i;let t=[];this.editorDiv.normalize();let n=null;for(let o of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&o.nodeName==="BR"||(t.push(T(i=oe,ra,uh).call(i,o)),n=o);return t.join(`
`)},oa=new WeakSet,ch=function(){let[t,n]=this.parentDimensions,i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{let{currentLayer:o,div:r}=this,a=r.style.display,l=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",o.div.append(this.div),i=r.getBoundingClientRect(),r.remove(),r.style.display=a,r.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/n):(this.width=i.height/t,this.height=i.width/n),this.fixAndSetPosition()},ra=new WeakSet,uh=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Vd,"")},aa=new WeakSet,dh=function(){if(this.editorDiv.replaceChildren(),!!u(this,_t))for(let t of u(this,_t).split(`
`)){let n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},ip=new WeakSet,ZT=function(){return u(this,_t).replaceAll("\xA0"," ")},cu=new WeakSet,uv=function(t){return t.replaceAll(" ","\xA0")},sp=new WeakSet,QT=function(t){let{value:n,fontSize:i,color:o,pageIndex:r}=this._initialData;return this._hasBeenMoved||t.value!==n||t.fontSize!==i||t.color.some((a,l)=>a!==o[l])||t.pageIndex!==r},v(oe,ra),v(oe,cu),H(oe,"_freeTextDefaultContent",""),H(oe,"_internalPadding",0),H(oe,"_defaultColor",null),H(oe,"_defaultFontSize",10),H(oe,"_type","freetext"),H(oe,"_editorType",K.FREETEXT);var cv=oe,L=class{toSVGPath(){re("Abstract method `toSVGPath` must be implemented.")}get box(){re("Abstract getter `box` must be implemented.")}serialize(e,t){re("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,i,o,r){r||(r=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)r[a]=t+e[a]*i,r[a+1]=n+e[a+1]*o;return r}static _rescaleAndSwap(e,t,n,i,o,r){r||(r=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)r[a]=t+e[a+1]*i,r[a+1]=n+e[a]*o;return r}static _translate(e,t,n,i){i||(i=new Float32Array(e.length));for(let o=0,r=e.length;o<r;o+=2)i[o]=t+e[o],i[o+1]=n+e[o+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,i,o){switch(o){case 90:return[1-t/n,e/i];case 180:return[1-e/n,1-t/i];case 270:return[t/n,1-e/i];default:return[e/n,t/i]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,i,o,r){return[(e+5*n)/6,(t+5*i)/6,(5*n+o)/6,(5*i+r)/6,(n+o)/2,(i+r)/2]}};H(L,"PRECISION",1e-4);var Et,sn,la,ca,In,X,po,go,uu,du,ua,da,Ji,hu,op,rp,mo,cl,ap,jT,lp,eE,cp,tE,up,nE,dp,iE,hp,sE,zn=class zn{constructor({x:e,y:t},n,i,o,r,a=0){v(this,mo);v(this,ap);v(this,lp);v(this,cp);v(this,up);v(this,dp);v(this,hp);v(this,Et,void 0);v(this,sn,[]);v(this,la,void 0);v(this,ca,void 0);v(this,In,[]);v(this,X,new Float32Array(18));v(this,po,void 0);v(this,go,void 0);v(this,uu,void 0);v(this,du,void 0);v(this,ua,void 0);v(this,da,void 0);v(this,Ji,[]);w(this,Et,n),w(this,da,o*i),w(this,ca,r),u(this,X).set([NaN,NaN,NaN,NaN,e,t],6),w(this,la,a),w(this,du,u(zn,hu)*i),w(this,uu,u(zn,rp)*i),w(this,ua,i),u(this,Ji).push(e,t)}isEmpty(){return isNaN(u(this,X)[8])}add({x:e,y:t}){var M;w(this,po,e),w(this,go,t);let[n,i,o,r]=u(this,Et),[a,l,c,d]=u(this,X).subarray(8,12),p=e-c,g=t-d,m=Math.hypot(p,g);if(m<u(this,uu))return!1;let y=m-u(this,du),A=y/m,_=A*p,E=A*g,C=a,S=l;a=c,l=d,c+=_,d+=E,(M=u(this,Ji))==null||M.push(e,t);let b=-E/y,x=_/y,P=b*u(this,da),I=x*u(this,da);return u(this,X).set(u(this,X).subarray(2,8),0),u(this,X).set([c+P,d+I],4),u(this,X).set(u(this,X).subarray(14,18),12),u(this,X).set([c-P,d-I],16),isNaN(u(this,X)[6])?(u(this,In).length===0&&(u(this,X).set([a+P,l+I],2),u(this,In).push(NaN,NaN,NaN,NaN,(a+P-n)/o,(l+I-i)/r),u(this,X).set([a-P,l-I],14),u(this,sn).push(NaN,NaN,NaN,NaN,(a-P-n)/o,(l-I-i)/r)),u(this,X).set([C,S,a,l,c,d],6),!this.isEmpty()):(u(this,X).set([C,S,a,l,c,d],6),Math.abs(Math.atan2(S-l,C-a)-Math.atan2(E,_))<Math.PI/2?([a,l,c,d]=u(this,X).subarray(2,6),u(this,In).push(NaN,NaN,NaN,NaN,((a+c)/2-n)/o,((l+d)/2-i)/r),[a,l,C,S]=u(this,X).subarray(14,18),u(this,sn).push(NaN,NaN,NaN,NaN,((C+a)/2-n)/o,((S+l)/2-i)/r),!0):([C,S,a,l,c,d]=u(this,X).subarray(0,6),u(this,In).push(((C+5*a)/6-n)/o,((S+5*l)/6-i)/r,((5*a+c)/6-n)/o,((5*l+d)/6-i)/r,((a+c)/2-n)/o,((l+d)/2-i)/r),[c,d,a,l,C,S]=u(this,X).subarray(12,18),u(this,sn).push(((C+5*a)/6-n)/o,((S+5*l)/6-i)/r,((5*a+c)/6-n)/o,((5*l+d)/6-i)/r,((a+c)/2-n)/o,((l+d)/2-i)/r),!0))}toSVGPath(){if(this.isEmpty())return"";let e=u(this,In),t=u(this,sn);if(isNaN(u(this,X)[6])&&!this.isEmpty())return T(this,ap,jT).call(this);let n=[];n.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?n.push(`L${e[i+4]} ${e[i+5]}`):n.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);T(this,cp,tE).call(this,n);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?n.push(`L${t[i+4]} ${t[i+5]}`):n.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return T(this,lp,eE).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,i,o,r){return new Kh(e,t,n,i,o,r)}getOutlines(){var p,g;let e=u(this,In),t=u(this,sn),n=u(this,X),[i,o,r,a]=u(this,Et),l=new Float32Array(((g=(p=u(this,Ji))==null?void 0:p.length)!=null?g:0)+2);for(let m=0,y=l.length-2;m<y;m+=2)l[m]=(u(this,Ji)[m]-i)/r,l[m+1]=(u(this,Ji)[m+1]-o)/a;if(l[l.length-2]=(u(this,po)-i)/r,l[l.length-1]=(u(this,go)-o)/a,isNaN(n[6])&&!this.isEmpty())return T(this,up,nE).call(this,l);let c=new Float32Array(u(this,In).length+24+u(this,sn).length),d=e.length;for(let m=0;m<d;m+=2){if(isNaN(e[m])){c[m]=c[m+1]=NaN;continue}c[m]=e[m],c[m+1]=e[m+1]}d=T(this,hp,sE).call(this,c,d);for(let m=t.length-6;m>=6;m-=6)for(let y=0;y<6;y+=2){if(isNaN(t[m+y])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=t[m+y],c[d+1]=t[m+y+1],d+=2}return T(this,dp,iE).call(this,c,d),this.newFreeDrawOutline(c,l,u(this,Et),u(this,ua),u(this,la),u(this,ca))}};Et=new WeakMap,sn=new WeakMap,la=new WeakMap,ca=new WeakMap,In=new WeakMap,X=new WeakMap,po=new WeakMap,go=new WeakMap,uu=new WeakMap,du=new WeakMap,ua=new WeakMap,da=new WeakMap,Ji=new WeakMap,hu=new WeakMap,op=new WeakMap,rp=new WeakMap,mo=new WeakSet,cl=function(){let e=u(this,X).subarray(4,6),t=u(this,X).subarray(16,18),[n,i,o,r]=u(this,Et);return[(u(this,po)+(e[0]-t[0])/2-n)/o,(u(this,go)+(e[1]-t[1])/2-i)/r,(u(this,po)+(t[0]-e[0])/2-n)/o,(u(this,go)+(t[1]-e[1])/2-i)/r]},ap=new WeakSet,jT=function(){let[e,t,n,i]=u(this,Et),[o,r,a,l]=T(this,mo,cl).call(this);return`M${(u(this,X)[2]-e)/n} ${(u(this,X)[3]-t)/i} L${(u(this,X)[4]-e)/n} ${(u(this,X)[5]-t)/i} L${o} ${r} L${a} ${l} L${(u(this,X)[16]-e)/n} ${(u(this,X)[17]-t)/i} L${(u(this,X)[14]-e)/n} ${(u(this,X)[15]-t)/i} Z`},lp=new WeakSet,eE=function(e){let t=u(this,sn);e.push(`L${t[4]} ${t[5]} Z`)},cp=new WeakSet,tE=function(e){let[t,n,i,o]=u(this,Et),r=u(this,X).subarray(4,6),a=u(this,X).subarray(16,18),[l,c,d,p]=T(this,mo,cl).call(this);e.push(`L${(r[0]-t)/i} ${(r[1]-n)/o} L${l} ${c} L${d} ${p} L${(a[0]-t)/i} ${(a[1]-n)/o}`)},up=new WeakSet,nE=function(e){let t=u(this,X),[n,i,o,r]=u(this,Et),[a,l,c,d]=T(this,mo,cl).call(this),p=new Float32Array(36);return p.set([NaN,NaN,NaN,NaN,(t[2]-n)/o,(t[3]-i)/r,NaN,NaN,NaN,NaN,(t[4]-n)/o,(t[5]-i)/r,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(t[16]-n)/o,(t[17]-i)/r,NaN,NaN,NaN,NaN,(t[14]-n)/o,(t[15]-i)/r],0),this.newFreeDrawOutline(p,e,u(this,Et),u(this,ua),u(this,la),u(this,ca))},dp=new WeakSet,iE=function(e,t){let n=u(this,sn);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},hp=new WeakSet,sE=function(e,t){let n=u(this,X).subarray(4,6),i=u(this,X).subarray(16,18),[o,r,a,l]=u(this,Et),[c,d,p,g]=T(this,mo,cl).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-o)/a,(n[1]-r)/l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,p,g,NaN,NaN,NaN,NaN,(i[0]-o)/a,(i[1]-r)/l],t),t+=24},v(zn,hu,8),v(zn,op,2),v(zn,rp,u(zn,hu)+u(zn,op));var Wh=zn,ha,yo,di,fu,Ct,pu,ye,fp,oE,Kh=class extends L{constructor(t,n,i,o,r,a){super();v(this,fp);v(this,ha,void 0);v(this,yo,new Float32Array(4));v(this,di,void 0);v(this,fu,void 0);v(this,Ct,void 0);v(this,pu,void 0);v(this,ye,void 0);w(this,ye,t),w(this,Ct,n),w(this,ha,i),w(this,pu,o),w(this,di,r),w(this,fu,a),this.lastPoint=[NaN,NaN],T(this,fp,oE).call(this,a);let[l,c,d,p]=u(this,yo);for(let g=0,m=t.length;g<m;g+=2)t[g]=(t[g]-l)/d,t[g+1]=(t[g+1]-c)/p;for(let g=0,m=n.length;g<m;g+=2)n[g]=(n[g]-l)/d,n[g+1]=(n[g+1]-c)/p}toSVGPath(){let t=[`M${u(this,ye)[4]} ${u(this,ye)[5]}`];for(let n=6,i=u(this,ye).length;n<i;n+=6){if(isNaN(u(this,ye)[n])){t.push(`L${u(this,ye)[n+4]} ${u(this,ye)[n+5]}`);continue}t.push(`C${u(this,ye)[n]} ${u(this,ye)[n+1]} ${u(this,ye)[n+2]} ${u(this,ye)[n+3]} ${u(this,ye)[n+4]} ${u(this,ye)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,i,o],r){let a=i-t,l=o-n,c,d;switch(r){case 0:c=L._rescale(u(this,ye),t,o,a,-l),d=L._rescale(u(this,Ct),t,o,a,-l);break;case 90:c=L._rescaleAndSwap(u(this,ye),t,n,a,l),d=L._rescaleAndSwap(u(this,Ct),t,n,a,l);break;case 180:c=L._rescale(u(this,ye),i,n,-a,l),d=L._rescale(u(this,Ct),i,n,-a,l);break;case 270:c=L._rescaleAndSwap(u(this,ye),i,o,-a,-l),d=L._rescaleAndSwap(u(this,Ct),i,o,-a,-l);break}return{outline:Array.from(c),points:[Array.from(d)]}}get box(){return u(this,yo)}newOutliner(t,n,i,o,r,a=0){return new Wh(t,n,i,o,r,a)}getNewOutline(t,n){let[i,o,r,a]=u(this,yo),[l,c,d,p]=u(this,ha),g=r*d,m=a*p,y=i*d+l,A=o*p+c,_=this.newOutliner({x:u(this,Ct)[0]*g+y,y:u(this,Ct)[1]*m+A},u(this,ha),u(this,pu),t,u(this,fu),n!=null?n:u(this,di));for(let E=2;E<u(this,Ct).length;E+=2)_.add({x:u(this,Ct)[E]*g+y,y:u(this,Ct)[E+1]*m+A});return _.getOutlines()}};ha=new WeakMap,yo=new WeakMap,di=new WeakMap,fu=new WeakMap,Ct=new WeakMap,pu=new WeakMap,ye=new WeakMap,fp=new WeakSet,oE=function(t){let n=u(this,ye),i=n[4],o=n[5],r=i,a=o,l=i,c=o,d=i,p=o,g=t?Math.max:Math.min;for(let y=6,A=n.length;y<A;y+=6){if(isNaN(n[y]))r=Math.min(r,n[y+4]),a=Math.min(a,n[y+5]),l=Math.max(l,n[y+4]),c=Math.max(c,n[y+5]),p<n[y+5]?(d=n[y+4],p=n[y+5]):p===n[y+5]&&(d=g(d,n[y+4]));else{let _=$.bezierBoundingBox(i,o,...n.slice(y,y+6));r=Math.min(r,_[0]),a=Math.min(a,_[1]),l=Math.max(l,_[2]),c=Math.max(c,_[3]),p<_[3]?(d=_[2],p=_[3]):p===_[3]&&(d=g(d,_[2]))}i=n[y+4],o=n[y+5]}let m=u(this,yo);m[0]=r-u(this,di),m[1]=a-u(this,di),m[2]=l-r+2*u(this,di),m[3]=c-a+2*u(this,di),this.lastPoint=[d,p]};var gu,mu,Xi,on,pp,rE,fa,hh,gp,aE,mp,lE,yu,dv,Pl=class{constructor(e,t=0,n=0,i=!0){v(this,pp);v(this,fa);v(this,gp);v(this,mp);v(this,yu);v(this,gu,void 0);v(this,mu,void 0);v(this,Xi,[]);v(this,on,[]);let o=1/0,r=-1/0,a=1/0,l=-1/0,d=10**-4;for(let{x:E,y:C,width:S,height:b}of e){let x=Math.floor((E-t)/d)*d,P=Math.ceil((E+S+t)/d)*d,I=Math.floor((C-t)/d)*d,N=Math.ceil((C+b+t)/d)*d,M=[x,I,N,!0],F=[P,I,N,!1];u(this,Xi).push(M,F),o=Math.min(o,x),r=Math.max(r,P),a=Math.min(a,I),l=Math.max(l,N)}let p=r-o+2*n,g=l-a+2*n,m=o-n,y=a-n,A=u(this,Xi).at(i?-1:-2),_=[A[0],A[2]];for(let E of u(this,Xi)){let[C,S,b]=E;E[0]=(C-m)/p,E[1]=(S-y)/g,E[2]=(b-y)/g}w(this,gu,new Float32Array([m,y,p,g])),w(this,mu,_)}getOutlines(){u(this,Xi).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);let e=[];for(let t of u(this,Xi))t[3]?(e.push(...T(this,yu,dv).call(this,t)),T(this,gp,aE).call(this,t)):(T(this,mp,lE).call(this,t),e.push(...T(this,yu,dv).call(this,t)));return T(this,pp,rE).call(this,e)}};gu=new WeakMap,mu=new WeakMap,Xi=new WeakMap,on=new WeakMap,pp=new WeakSet,rE=function(e){let t=[],n=new Set;for(let r of e){let[a,l,c]=r;t.push([a,l,r],[a,c,r])}t.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=t.length;r<a;r+=2){let l=t[r][2],c=t[r+1][2];l.push(c),c.push(l),n.add(l),n.add(c)}let i=[],o;for(;n.size>0;){let r=n.values().next().value,[a,l,c,d,p]=r;n.delete(r);let g=a,m=l;for(o=[a,c],i.push(o);;){let y;if(n.has(d))y=d;else if(n.has(p))y=p;else break;n.delete(y),[a,l,c,d,p]=y,g!==a&&(o.push(g,m,a,m===l?l:c),g=a),m=m===l?c:l}o.push(g,m)}return new hv(i,u(this,gu),u(this,mu))},fa=new WeakSet,hh=function(e){let t=u(this,on),n=0,i=t.length-1;for(;n<=i;){let o=n+i>>1,r=t[o][0];if(r===e)return o;r<e?n=o+1:i=o-1}return i+1},gp=new WeakSet,aE=function([,e,t]){let n=T(this,fa,hh).call(this,e);u(this,on).splice(n,0,[e,t])},mp=new WeakSet,lE=function([,e,t]){let n=T(this,fa,hh).call(this,e);for(let i=n;i<u(this,on).length;i++){let[o,r]=u(this,on)[i];if(o!==e)break;if(o===e&&r===t){u(this,on).splice(i,1);return}}for(let i=n-1;i>=0;i--){let[o,r]=u(this,on)[i];if(o!==e)break;if(o===e&&r===t){u(this,on).splice(i,1);return}}},yu=new WeakSet,dv=function(e){let[t,n,i]=e,o=[[t,n,i]],r=T(this,fa,hh).call(this,i);for(let a=0;a<r;a++){let[l,c]=u(this,on)[a];for(let d=0,p=o.length;d<p;d++){let[,g,m]=o[d];if(!(c<=g||m<=l)){if(g>=l){if(m>c)o[d][1]=c;else{if(p===1)return[];o.splice(d,1),d--,p--}continue}o[d][2]=l,m>c&&o.push([t,c,m])}}}return o};var vu,pa,hv=class extends L{constructor(t,n,i){super();v(this,vu,void 0);v(this,pa,void 0);w(this,pa,t),w(this,vu,n),this.lastPoint=i}toSVGPath(){let t=[];for(let n of u(this,pa)){let[i,o]=n;t.push(`M${i} ${o}`);for(let r=2;r<n.length;r+=2){let a=n[r],l=n[r+1];a===i?(t.push(`V${l}`),o=l):l===o&&(t.push(`H${a}`),i=a)}t.push("Z")}return t.join(" ")}serialize([t,n,i,o],r){let a=[],l=i-t,c=o-n;for(let d of u(this,pa)){let p=new Array(d.length);for(let g=0;g<d.length;g+=2)p[g]=t+d[g]*l,p[g+1]=o-d[g+1]*c;a.push(p)}return a}get box(){return u(this,vu)}get classNamesForOutlining(){return["highlightOutline"]}};vu=new WeakMap,pa=new WeakMap;var Ml=class extends Wh{newFreeDrawOutline(e,t,n,i,o,r){return new fv(e,t,n,i,o,r)}},fv=class extends Kh{newOutliner(e,t,n,i,o,r=0){return new Ml(e,t,n,i,o,r)}},rn,vo,ga,be,wu,ma,Au,_u,Zi,an,ya,Tu,Eu,pv,Cu,gv,Su,mv,hi,ps,yp,cE,Rn,Ci,dt=class dt{constructor({editor:e=null,uiManager:t=null}){v(this,Eu);v(this,Cu);v(this,Su);v(this,hi);v(this,yp);v(this,Rn);v(this,rn,null);v(this,vo,null);v(this,ga,void 0);v(this,be,null);v(this,wu,!1);v(this,ma,!1);v(this,Au,null);v(this,_u,void 0);v(this,Zi,null);v(this,an,null);v(this,ya,void 0);var n;e?(w(this,ma,!1),w(this,ya,Q.HIGHLIGHT_COLOR),w(this,Au,e)):(w(this,ma,!0),w(this,ya,Q.HIGHLIGHT_DEFAULT_COLOR)),w(this,an,(e==null?void 0:e._uiManager)||t),w(this,_u,u(this,an)._eventBus),w(this,ga,(e==null?void 0:e.color)||((n=u(this,an))==null?void 0:n.highlightColors.values().next().value)||"#FFFF98"),u(dt,Tu)||w(dt,Tu,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Z(this,"_keyboardManager",new $o([[["Escape","mac+Escape"],dt.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],dt.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],dt.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],dt.prototype._moveToPrevious],[["Home","mac+Home"],dt.prototype._moveToBeginning],[["End","mac+End"],dt.prototype._moveToEnd]]))}renderButton(){let e=w(this,rn,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);let t=u(this,an)._signal;e.addEventListener("click",T(this,hi,ps).bind(this),{signal:t}),e.addEventListener("keydown",T(this,Su,mv).bind(this),{signal:t});let n=w(this,vo,document.createElement("span"));return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=u(this,ga),e.append(n),e}renderMainDropdown(){let e=w(this,be,T(this,Eu,pv).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===u(this,rn)){T(this,hi,ps).call(this,e);return}let t=e.target.getAttribute("data-color");t&&T(this,Cu,gv).call(this,t,e)}_moveToNext(e){var t,n;if(!u(this,Rn,Ci)){T(this,hi,ps).call(this,e);return}if(e.target===u(this,rn)){(t=u(this,be).firstChild)==null||t.focus();return}(n=e.target.nextSibling)==null||n.focus()}_moveToPrevious(e){var t,n;if(e.target===((t=u(this,be))==null?void 0:t.firstChild)||e.target===u(this,rn)){u(this,Rn,Ci)&&this._hideDropdownFromKeyboard();return}u(this,Rn,Ci)||T(this,hi,ps).call(this,e),(n=e.target.previousSibling)==null||n.focus()}_moveToBeginning(e){var t;if(!u(this,Rn,Ci)){T(this,hi,ps).call(this,e);return}(t=u(this,be).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!u(this,Rn,Ci)){T(this,hi,ps).call(this,e);return}(t=u(this,be).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=u(this,be))==null||e.classList.add("hidden"),(t=u(this,Zi))==null||t.abort(),w(this,Zi,null)}_hideDropdownFromKeyboard(){var e;if(!u(this,ma)){if(!u(this,Rn,Ci)){(e=u(this,Au))==null||e.unselect();return}this.hideDropdown(),u(this,rn).focus({preventScroll:!0,focusVisible:u(this,wu)})}}updateColor(e){if(u(this,vo)&&(u(this,vo).style.backgroundColor=e),!u(this,be))return;let t=u(this,an).highlightColors.values();for(let n of u(this,be).children)n.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=u(this,rn))==null||e.remove(),w(this,rn,null),w(this,vo,null),(t=u(this,be))==null||t.remove(),w(this,be,null)}};rn=new WeakMap,vo=new WeakMap,ga=new WeakMap,be=new WeakMap,wu=new WeakMap,ma=new WeakMap,Au=new WeakMap,_u=new WeakMap,Zi=new WeakMap,an=new WeakMap,ya=new WeakMap,Tu=new WeakMap,Eu=new WeakSet,pv=function(){let e=document.createElement("div"),t=u(this,an)._signal;e.addEventListener("contextmenu",hn,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[n,i]of u(this,an).highlightColors){let o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",i),o.title=n,o.setAttribute("data-l10n-id",u(dt,Tu)[n]);let r=document.createElement("span");o.append(r),r.className="swatch",r.style.backgroundColor=i,o.setAttribute("aria-selected",i===u(this,ga)),o.addEventListener("click",T(this,Cu,gv).bind(this,i),{signal:t}),e.append(o)}return e.addEventListener("keydown",T(this,Su,mv).bind(this),{signal:t}),e},Cu=new WeakSet,gv=function(e,t){t.stopPropagation(),u(this,_u).dispatch("switchannotationeditorparams",{source:this,type:u(this,ya),value:e})},Su=new WeakSet,mv=function(e){dt._keyboardManager.exec(this,e)},hi=new WeakSet,ps=function(e){if(u(this,Rn,Ci)){this.hideDropdown();return}if(w(this,wu,e.detail===0),u(this,Zi)||(w(this,Zi,new AbortController),window.addEventListener("pointerdown",T(this,yp,cE).bind(this),{signal:u(this,an).combinedSignal(u(this,Zi))})),u(this,be)){u(this,be).classList.remove("hidden");return}let t=w(this,be,T(this,Eu,pv).call(this));u(this,rn).append(t)},yp=new WeakSet,cE=function(e){var t;(t=u(this,be))!=null&&t.contains(e.target)||this.hideDropdown()},Rn=new WeakSet,Ci=function(){return u(this,be)&&!u(this,be).classList.contains("hidden")},v(dt,Tu,null);var Yh=dt,va,bu,fi,wo,wa,pt,xu,Iu,Ao,Ut,St,Oe,Aa,pi,Xe,_a,Ot,Ru,Pu,yv,Ta,fh,vp,uE,wp,dE,Ap,hE,Mu,vv,gi,gs,Qi,sr,_p,fE,Ea,ph,_o,ul,Tp,pE,Ep,gE,Cp,mE,Sp,yE,bp,vE,ee=class ee extends fe{constructor(t){super({...t,name:"highlightEditor"});v(this,Pu);v(this,Ta);v(this,vp);v(this,wp);v(this,Ap);v(this,Mu);v(this,gi);v(this,_p);v(this,Ea);v(this,_o);v(this,Tp);v(this,Ep);v(this,bp);v(this,va,null);v(this,bu,0);v(this,fi,void 0);v(this,wo,null);v(this,wa,null);v(this,pt,null);v(this,xu,null);v(this,Iu,0);v(this,Ao,null);v(this,Ut,null);v(this,St,null);v(this,Oe,!1);v(this,Aa,null);v(this,pi,void 0);v(this,Xe,null);v(this,_a,"");v(this,Ot,void 0);v(this,Ru,"");this.color=t.color||ee._defaultColor,w(this,Ot,t.thickness||ee._defaultThickness),w(this,pi,t.opacity||ee._defaultOpacity),w(this,fi,t.boxes||null),w(this,Ru,t.methodOfCreation||""),w(this,_a,t.text||""),this._isDraggable=!1,t.highlightId>-1?(w(this,Oe,!0),T(this,Ta,fh).call(this,t),T(this,gi,gs).call(this)):u(this,fi)&&(w(this,va,t.anchorNode),w(this,bu,t.anchorOffset),w(this,xu,t.focusNode),w(this,Iu,t.focusOffset),T(this,Pu,yv).call(this),T(this,gi,gs).call(this),this.rotate(this.rotation))}static get _keyboardManager(){let t=ee.prototype;return Z(this,"_keyboardManager",new $o([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:u(this,Oe)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:u(this,Ot),methodOfCreation:u(this,Ru)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){var i;fe.initialize(t,n),ee._defaultColor||(ee._defaultColor=((i=n.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,n){switch(t){case Q.HIGHLIGHT_DEFAULT_COLOR:ee._defaultColor=n;break;case Q.HIGHLIGHT_THICKNESS:ee._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return u(this,Aa)}updateParams(t,n){switch(t){case Q.HIGHLIGHT_COLOR:T(this,vp,uE).call(this,n);break;case Q.HIGHLIGHT_THICKNESS:T(this,wp,dE).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Q.HIGHLIGHT_DEFAULT_COLOR,ee._defaultColor],[Q.HIGHLIGHT_THICKNESS,ee._defaultThickness]]}get propertiesToUpdate(){return[[Q.HIGHLIGHT_COLOR,this.color||ee._defaultColor],[Q.HIGHLIGHT_THICKNESS,u(this,Ot)||ee._defaultThickness],[Q.HIGHLIGHT_FREE,u(this,Oe)]]}async addEditToolbar(){let t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(w(this,wa,new Yh({editor:this})),t.addColorPicker(u(this,wa))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(T(this,_o,ul).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,T(this,_o,ul).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){T(this,Mu,vv).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(T(this,gi,gs).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let n=!1;this.parent&&!t?T(this,Mu,vv).call(this):t&&(T(this,gi,gs).call(this,t),n=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var o,r,a;let{drawLayer:n}=this.parent,i;u(this,Oe)?(t=(t-this.rotation+360)%360,i=T(o=ee,Qi,sr).call(o,u(this,Ut).box,t)):i=T(r=ee,Qi,sr).call(r,[this.x,this.y,this.width,this.height],t),n.updateProperties(u(this,St),{bbox:i,root:{"data-main-rotation":t}}),n.updateProperties(u(this,Xe),{bbox:T(a=ee,Qi,sr).call(a,u(this,pt).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;let t=super.render();u(this,_a)&&(t.setAttribute("aria-label",u(this,_a)),t.setAttribute("role","mark")),u(this,Oe)?t.classList.add("free"):this.div.addEventListener("keydown",T(this,_p,fE).bind(this),{signal:this._uiManager._signal});let n=w(this,Ao,document.createElement("div"));t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=u(this,wo);let[i,o]=this.parentDimensions;return this.setDims(this.width*i,this.height*o),Eh(this,u(this,Ao),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(u(this,Xe),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(u(this,Xe),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:T(this,Ea,ph).call(this,!0);break;case 1:case 3:T(this,Ea,ph).call(this,!1);break}}select(){var t;super.select(),u(this,Xe)&&((t=this.parent)==null||t.drawLayer.updateProperties(u(this,Xe),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),u(this,Xe)&&((t=this.parent)==null||t.drawLayer.updateProperties(u(this,Xe),{rootClass:{selected:!1}}),u(this,Oe)||T(this,Ea,ph).call(this,!1))}get _mustFixPosition(){return!u(this,Oe)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(u(this,St),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(u(this,Xe),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:i,x:o,y:r}){let{x:a,y:l,width:c,height:d}=i.getBoundingClientRect(),p=new AbortController,g=t.combinedSignal(p),m=y=>{p.abort(),T(this,Sp,yE).call(this,t,y)};window.addEventListener("blur",m,{signal:g}),window.addEventListener("pointerup",m,{signal:g}),window.addEventListener("pointerdown",Pt,{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",hn,{signal:g}),i.addEventListener("pointermove",T(this,Cp,mE).bind(this,t),{signal:g}),this._freeHighlight=new Ml({x:o,y:r},[a,l,c,d],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,i){var A,_,E,C;let o=null;if(t instanceof qh){let{data:{quadPoints:S,rect:b,rotation:x,id:P,color:I,opacity:N,popupRef:M},parent:{page:{pageNumber:F}}}=t;o=t={annotationType:K.HIGHLIGHT,color:Array.from(I),opacity:N,quadPoints:S,boxes:null,pageIndex:F-1,rect:b.slice(0),rotation:x,id:P,deleted:!1,popupRef:M}}else if(t instanceof Rl){let{data:{inkLists:S,rect:b,rotation:x,id:P,color:I,borderStyle:{rawWidth:N},popupRef:M},parent:{page:{pageNumber:F}}}=t;o=t={annotationType:K.HIGHLIGHT,color:Array.from(I),thickness:N,inkLists:S,boxes:null,pageIndex:F-1,rect:b.slice(0),rotation:x,id:P,deleted:!1,popupRef:M}}let{color:r,quadPoints:a,inkLists:l,opacity:c}=t,d=await super.deserialize(t,n,i);d.color=$.makeHexColor(...r),w(d,pi,c||1),l&&w(d,Ot,t.thickness),d.annotationElementId=t.id||null,d._initialData=o;let[p,g]=d.pageDimensions,[m,y]=d.pageTranslation;if(a){let S=w(d,fi,[]);for(let b=0;b<a.length;b+=8)S.push({x:(a[b]-m)/p,y:1-(a[b+1]-y)/g,width:(a[b+2]-a[b])/p,height:(a[b+1]-a[b+5])/g});T(A=d,Pu,yv).call(A),T(_=d,gi,gs).call(_),d.rotate(d.rotation)}else if(l){w(d,Oe,!0);let S=l[0],b={x:S[0]-m,y:g-(S[1]-y)},x=new Ml(b,[0,0,p,g],1,u(d,Ot)/2,!0,.001);for(let N=0,M=S.length;N<M;N+=2)b.x=S[N]-m,b.y=g-(S[N+1]-y),x.add(b);let{id:P,clipPathId:I}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:x.toSVGPath()}},!0,!0);T(E=d,Ta,fh).call(E,{highlightOutlines:x.getOutlines(),highlightId:P,clipPathId:I}),T(C=d,gi,gs).call(C)}return d}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();let n=this.getRect(0,0),i=fe._colorManager.convert(this.color),o={annotationType:K.HIGHLIGHT,color:i,opacity:u(this,pi),thickness:u(this,Ot),quadPoints:T(this,Tp,pE).call(this),outlines:T(this,Ep,gE).call(this,n),pageIndex:this.pageIndex,rect:n,rotation:T(this,_o,ul).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!T(this,bp,vE).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};va=new WeakMap,bu=new WeakMap,fi=new WeakMap,wo=new WeakMap,wa=new WeakMap,pt=new WeakMap,xu=new WeakMap,Iu=new WeakMap,Ao=new WeakMap,Ut=new WeakMap,St=new WeakMap,Oe=new WeakMap,Aa=new WeakMap,pi=new WeakMap,Xe=new WeakMap,_a=new WeakMap,Ot=new WeakMap,Ru=new WeakMap,Pu=new WeakSet,yv=function(){let t=new Pl(u(this,fi),.001);w(this,Ut,t.getOutlines()),[this.x,this.y,this.width,this.height]=u(this,Ut).box;let n=new Pl(u(this,fi),.0025,.001,this._uiManager.direction==="ltr");w(this,pt,n.getOutlines());let{lastPoint:i}=u(this,pt);w(this,Aa,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},Ta=new WeakSet,fh=function({highlightOutlines:t,highlightId:n,clipPathId:i}){var p,g;if(w(this,Ut,t),w(this,pt,t.getNewOutline(u(this,Ot)/2+1.5,.0025)),n>=0)w(this,St,n),w(this,wo,i),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),w(this,Xe,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:u(this,pt).box,path:{d:u(this,pt).toSVGPath()}},!0));else if(this.parent){let m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(u(this,St),{bbox:T(p=ee,Qi,sr).call(p,u(this,Ut).box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(u(this,Xe),{bbox:T(g=ee,Qi,sr).call(g,u(this,pt).box,m),path:{d:u(this,pt).toSVGPath()}})}let[r,a,l,c]=t.box;switch(this.rotation){case 0:this.x=r,this.y=a,this.width=l,this.height=c;break;case 90:{let[m,y]=this.parentDimensions;this.x=a,this.y=1-r,this.width=l*y/m,this.height=c*m/y;break}case 180:this.x=1-r,this.y=1-a,this.width=l,this.height=c;break;case 270:{let[m,y]=this.parentDimensions;this.x=1-a,this.y=r,this.width=l*y/m,this.height=c*m/y;break}}let{lastPoint:d}=u(this,pt);w(this,Aa,[(d[0]-r)/l,(d[1]-a)/c])},vp=new WeakSet,uE=function(t){let n=(r,a)=>{var l,c;this.color=r,w(this,pi,a),(l=this.parent)==null||l.drawLayer.updateProperties(u(this,St),{root:{fill:r,"fill-opacity":a}}),(c=u(this,wa))==null||c.updateColor(r)},i=this.color,o=u(this,pi);this.addCommands({cmd:n.bind(this,t,ee._defaultOpacity),undo:n.bind(this,i,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},wp=new WeakSet,dE=function(t){let n=u(this,Ot),i=o=>{w(this,Ot,o),T(this,Ap,hE).call(this,o)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},Ap=new WeakSet,hE=function(t){if(!u(this,Oe))return;T(this,Ta,fh).call(this,{highlightOutlines:u(this,Ut).getNewOutline(t/2)}),this.fixAndSetPosition();let[n,i]=this.parentDimensions;this.setDims(this.width*n,this.height*i)},Mu=new WeakSet,vv=function(){u(this,St)===null||!this.parent||(this.parent.drawLayer.remove(u(this,St)),w(this,St,null),this.parent.drawLayer.remove(u(this,Xe)),w(this,Xe,null))},gi=new WeakSet,gs=function(t=this.parent){u(this,St)===null&&({id:et(this,St)._,clipPathId:et(this,wo)._}=t.drawLayer.draw({bbox:u(this,Ut).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":u(this,pi)},rootClass:{highlight:!0,free:u(this,Oe)},path:{d:u(this,Ut).toSVGPath()}},!1,!0),w(this,Xe,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:u(this,Oe)},bbox:u(this,pt).box,path:{d:u(this,pt).toSVGPath()}},u(this,Oe))),u(this,Ao)&&(u(this,Ao).style.clipPath=u(this,wo)))},Qi=new WeakSet,sr=function([t,n,i,o],r){switch(r){case 90:return[1-n-o,t,o,i];case 180:return[1-t-i,1-n-o,i,o];case 270:return[n,1-t-i,o,i]}return[t,n,i,o]},_p=new WeakSet,fE=function(t){ee._keyboardManager.exec(this,t)},Ea=new WeakSet,ph=function(t){if(!u(this,va))return;let n=window.getSelection();t?n.setPosition(u(this,va),u(this,bu)):n.setPosition(u(this,xu),u(this,Iu))},_o=new WeakSet,ul=function(){return u(this,Oe)?this.rotation:0},Tp=new WeakSet,pE=function(){if(u(this,Oe))return null;let[t,n]=this.pageDimensions,[i,o]=this.pageTranslation,r=u(this,fi),a=new Float32Array(r.length*8),l=0;for(let{x:c,y:d,width:p,height:g}of r){let m=c*t+i,y=(1-d)*n+o;a[l]=a[l+4]=m,a[l+1]=a[l+3]=y,a[l+2]=a[l+6]=m+p*t,a[l+5]=a[l+7]=y-g*n,l+=8}return a},Ep=new WeakSet,gE=function(t){return u(this,Ut).serialize(t,T(this,_o,ul).call(this))},Cp=new WeakSet,mE=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},Sp=new WeakSet,yE=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},bp=new WeakSet,vE=function(t){let{color:n}=this._initialData;return t.color.some((i,o)=>i!==n[o])},v(ee,Qi),v(ee,Cp),v(ee,Sp),H(ee,"_defaultColor",null),H(ee,"_defaultOpacity",1),H(ee,"_defaultThickness",12),H(ee,"_type","highlight"),H(ee,"_editorType",K.HIGHLIGHT),H(ee,"_freeHighlightId",-1),H(ee,"_freeHighlight",null),H(ee,"_freeHighlightClipId","");var Jh=ee,To,wv=class{constructor(){v(this,To,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(let[t,n]of Object.entries(e))this.updateProperty(t,n)}updateSVGProperty(e,t){u(this,To)[e]=t}toSVGProperties(){let e=u(this,To);return w(this,To,Object.create(null)),{root:e}}reset(){w(this,To,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){re("Not implemented")}};To=new WeakMap;var bt,Ca,Ne,Eo,Co,ji,es,ts,So,Nu,_v,ku,Tv,Du,Ev,bo,dl,xp,wE,Sa,gh,xo,hl,ns,or,O=class O extends fe{constructor(t){super(t);v(this,Nu);v(this,ku);v(this,Du);v(this,bo);v(this,xp);v(this,Sa);v(this,xo);v(this,ns);v(this,bt,null);v(this,Ca,void 0);H(this,"_drawId",null);w(this,Ca,t.mustBeCommitted||!1),t.drawOutlines&&(T(this,Nu,_v).call(this,t),T(this,bo,dl).call(this))}static _mergeSVGProperties(t,n){let i=new Set(Object.keys(t));for(let[o,r]of Object.entries(n))i.has(o)?Object.assign(t[o],r):t[o]=r;return t}static getDefaultDrawingOptions(t){re("Not implemented")}static get typesMap(){re("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){let i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,n),this._currentParent&&(u(O,Ne).updateProperty(i,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){let i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,n)}static get defaultPropertiesToUpdate(){let t=[],n=this._defaultDrawingOptions;for(let[i,o]of this.typesMap)t.push([i,n[o]]);return t}get propertiesToUpdate(){let t=[],{_drawingOptions:n}=this;for(let[i,o]of this.constructor.typesMap)t.push([i,n[o]]);return t}_updateProperty(t,n,i){let o=this._drawingOptions,r=o[n],a=l=>{var d;o.updateProperty(n,l);let c=u(this,bt).updateProperty(n,l);c&&T(this,xo,hl).call(this,c),(d=this.parent)==null||d.drawLayer.updateProperties(this._drawId,o.toSVGProperties())};this.addCommands({cmd:a.bind(this,i),undo:a.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,O._mergeSVGProperties(u(this,bt).getPathResizingSVGProperties(T(this,Sa,gh).call(this)),{bbox:T(this,ns,or).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,O._mergeSVGProperties(u(this,bt).getPathResizedSVGProperties(T(this,Sa,gh).call(this)),{bbox:T(this,ns,or).call(this)}))}_onTranslating(t,n){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:T(this,ns,or).call(this,t,n)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,O._mergeSVGProperties(u(this,bt).getPathTranslatedSVGProperties(T(this,Sa,gh).call(this),this.parentDimensions),{bbox:T(this,ns,or).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,u(this,Ca)&&(w(this,Ca,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){T(this,Du,Ev).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(T(this,bo,dl).call(this),T(this,xo,hl).call(this,u(this,bt).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),T(this,Du,Ev).call(this)):t&&(this._uiManager.addShouldRescale(this),T(this,bo,dl).call(this,t),n=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,O._mergeSVGProperties({bbox:T(this,ns,or).call(this)},u(this,bt).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&T(this,xo,hl).call(this,u(this,bt).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t=super.render();t.classList.add("draw");let n=document.createElement("div");t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";let[i,o]=this.parentDimensions;return this.setDims(this.width*i,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,n,i,o,r){re("Not implemented")}static startDrawing(t,n,i,o){var _,E;let{target:r,offsetX:a,offsetY:l,pointerId:c,pointerType:d}=o;if(u(O,es)&&u(O,es)!==d)return;let{viewport:{rotation:p}}=t,{width:g,height:m}=r.getBoundingClientRect(),y=w(O,Eo,new AbortController),A=t.combinedSignal(y);if(u(O,ji)||w(O,ji,c),(_=u(O,es))!=null||w(O,es,d),window.addEventListener("pointerup",C=>{var S;u(O,ji)===C.pointerId?this._endDraw(C):(S=u(O,ts))==null||S.delete(C.pointerId)},{signal:A}),window.addEventListener("pointercancel",C=>{var S;u(O,ji)===C.pointerId?this._currentParent.endDrawingSession():(S=u(O,ts))==null||S.delete(C.pointerId)},{signal:A}),window.addEventListener("pointerdown",C=>{u(O,es)===C.pointerType&&((u(O,ts)||w(O,ts,new Set)).add(C.pointerId),u(O,Ne).isCancellable()&&(u(O,Ne).removeLastElement(),u(O,Ne).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:A}),window.addEventListener("contextmenu",hn,{signal:A}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:A}),r.addEventListener("touchmove",C=>{C.timeStamp===u(O,So)&&Pt(C)},{signal:A}),t.toggleDrawing(),(E=n._editorUndoBar)==null||E.hide(),u(O,Ne)){t.drawLayer.updateProperties(this._currentDrawId,u(O,Ne).startNew(a,l,g,m,p));return}n.updateUIForDefaultProperties(this),w(O,Ne,this.createDrawerInstance(a,l,g,m,p)),w(O,Co,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(u(O,Co).toSVGProperties(),u(O,Ne).defaultSVGProperties),!0,!1)}static _drawMove(t){var r;if(w(O,So,-1),!u(O,Ne))return;let{offsetX:n,offsetY:i,pointerId:o}=t;if(u(O,ji)===o){if(((r=u(O,ts))==null?void 0:r.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,u(O,Ne).add(n,i)),w(O,So,t.timeStamp),Pt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,w(O,Ne,null),w(O,Co,null),w(O,es,null),w(O,So,NaN)),u(O,Eo)&&(u(O,Eo).abort(),w(O,Eo,null),w(O,ji,NaN),w(O,ts,null))}static _endDraw(t){let n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),t&&n.drawLayer.updateProperties(this._currentDrawId,u(O,Ne).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){let i=u(O,Ne),o=this._currentDrawId,r=i.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(o,i.setLastElement(r))},undo:()=>{n.drawLayer.updateProperties(o,i.removeLastElement())},mustExec:!1,type:Q.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){let n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(Q.DRAW_STEP),!u(O,Ne).isEmpty()){let{pageDimensions:[i,o],scale:r}=n,a=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:u(O,Ne).getOutlines(i*r,o*r,r,this._INNER_MARGIN),drawingOptions:u(O,Co),mustBeCommitted:!t});return this._cleanup(!0),a}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,i,o,r,a){re("Not implemented")}static async deserialize(t,n,i){var p,g;let{rawDims:{pageWidth:o,pageHeight:r,pageX:a,pageY:l}}=n.viewport,c=this.deserializeDraw(a,l,o,r,this._INNER_MARGIN,t),d=await super.deserialize(t,n,i);return d.createDrawingOptions(t),T(p=d,Nu,_v).call(p,{drawOutlines:c}),T(g=d,bo,dl).call(g),d.onScaleChanging(),d.rotate(),d}serializeDraw(t){let[n,i]=this.pageTranslation,[o,r]=this.pageDimensions;return u(this,bt).serialize([n,i,o,r],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};bt=new WeakMap,Ca=new WeakMap,Ne=new WeakMap,Eo=new WeakMap,Co=new WeakMap,ji=new WeakMap,es=new WeakMap,ts=new WeakMap,So=new WeakMap,Nu=new WeakSet,_v=function({drawOutlines:t,drawId:n,drawingOptions:i}){w(this,bt,t),this._drawingOptions||(this._drawingOptions=i),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=T(this,ku,Tv).call(this,t,this.parent),T(this,xo,hl).call(this,t.box)},ku=new WeakSet,Tv=function(t,n){let{id:i}=n.drawLayer.draw(O._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},Du=new WeakSet,Ev=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},bo=new WeakSet,dl=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=T(this,ku,Tv).call(this,u(this,bt),t)}},xp=new WeakSet,wE=function([t,n,i,o]){let{parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[n,1-t,i*(a/r),o*(r/a)];case 180:return[1-t,1-n,i,o];case 270:return[1-n,t,i*(a/r),o*(r/a)];default:return[t,n,i,o]}},Sa=new WeakSet,gh=function(){let{x:t,y:n,width:i,height:o,parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[1-n,t,i*(r/a),o*(a/r)];case 180:return[1-t,1-n,i,o];case 270:return[n,1-t,i*(r/a),o*(a/r)];default:return[t,n,i,o]}},xo=new WeakSet,hl=function(t){if([this.x,this.y,this.width,this.height]=T(this,xp,wE).call(this,t),this.div){this.fixAndSetPosition();let[n,i]=this.parentDimensions;this.setDims(this.width*n,this.height*i)}this._onResized()},ns=new WeakSet,or=function(){let{x:t,y:n,width:i,height:o,rotation:r,parentRotation:a,parentDimensions:[l,c]}=this;switch((r*4+a)/90){case 1:return[1-n-o,t,o,i];case 2:return[1-t-i,1-n-o,i,o];case 3:return[n,1-t-i,o,i];case 4:return[t,n-i*(l/c),o*(c/l),i*(l/c)];case 5:return[1-n,t,i*(l/c),o*(c/l)];case 6:return[1-t-o*(c/l),1-n,o*(c/l),i*(l/c)];case 7:return[n-i*(l/c),1-t-o*(c/l),i*(l/c),o*(c/l)];case 8:return[t-i,n-o,i,o];case 9:return[1-n,t-i,o,i];case 10:return[1-t,1-n,i,o];case 11:return[n-o,1-t,o,i];case 12:return[t-o*(c/l),n,o*(c/l),i*(l/c)];case 13:return[1-n-i*(l/c),t-o*(c/l),i*(l/c),o*(c/l)];case 14:return[1-t,1-n-i*(l/c),o*(c/l),i*(l/c)];case 15:return[n,1-t,i*(l/c),o*(c/l)];default:return[t,n,i,o]}},H(O,"_currentDrawId",-1),H(O,"_currentParent",null),v(O,Ne,null),v(O,Eo,null),v(O,Co,null),v(O,ji,NaN),v(O,es,null),v(O,ts,null),v(O,So,NaN),H(O,"_INNER_MARGIN",3);var Av=O,Pn,ke,De,Io,ba,st,$e,$t,Ro,Po,Mo,xa,mh,Cv=class{constructor(e,t,n,i,o,r){v(this,xa);v(this,Pn,new Float64Array(6));v(this,ke,void 0);v(this,De,void 0);v(this,Io,void 0);v(this,ba,void 0);v(this,st,void 0);v(this,$e,"");v(this,$t,0);v(this,Ro,new Xh);v(this,Po,void 0);v(this,Mo,void 0);w(this,Po,n),w(this,Mo,i),w(this,Io,o),w(this,ba,r),[e,t]=T(this,xa,mh).call(this,e,t);let a=w(this,ke,[NaN,NaN,NaN,NaN,e,t]);w(this,st,[e,t]),w(this,De,[{line:a,points:u(this,st)}]),u(this,Pn).set(a,0)}updateProperty(e,t){e==="stroke-width"&&w(this,ba,t)}isEmpty(){return!u(this,De)||u(this,De).length===0}isCancellable(){return u(this,st).length<=10}add(e,t){[e,t]=T(this,xa,mh).call(this,e,t);let[n,i,o,r]=u(this,Pn).subarray(2,6),a=e-o,l=t-r;return Math.hypot(u(this,Po)*a,u(this,Mo)*l)<=2?null:(u(this,st).push(e,t),isNaN(n)?(u(this,Pn).set([o,r,e,t],2),u(this,ke).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(u(this,Pn)[0])&&u(this,ke).splice(6,6),u(this,Pn).set([n,i,o,r,e,t],0),u(this,ke).push(...L.createBezierPoints(n,i,o,r,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){let n=this.add(e,t);return n||(u(this,st).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,i,o){w(this,Po,n),w(this,Mo,i),w(this,Io,o),[e,t]=T(this,xa,mh).call(this,e,t);let r=w(this,ke,[NaN,NaN,NaN,NaN,e,t]);w(this,st,[e,t]);let a=u(this,De).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),u(this,De).push({line:r,points:u(this,st)}),u(this,Pn).set(r,0),w(this,$t,0),this.toSVGPath(),null}getLastElement(){return u(this,De).at(-1)}setLastElement(e){return u(this,De)?(u(this,De).push(e),w(this,ke,e.line),w(this,st,e.points),w(this,$t,0),{path:{d:this.toSVGPath()}}):u(this,Ro).setLastElement(e)}removeLastElement(){if(!u(this,De))return u(this,Ro).removeLastElement();u(this,De).pop(),w(this,$e,"");for(let e=0,t=u(this,De).length;e<t;e++){let{line:n,points:i}=u(this,De)[e];w(this,ke,n),w(this,st,i),w(this,$t,0),this.toSVGPath()}return{path:{d:u(this,$e)}}}toSVGPath(){let e=L.svgRound(u(this,ke)[4]),t=L.svgRound(u(this,ke)[5]);if(u(this,st).length===2)return w(this,$e,`${u(this,$e)} M ${e} ${t} Z`),u(this,$e);if(u(this,st).length<=6){let i=u(this,$e).lastIndexOf("M");w(this,$e,`${u(this,$e).slice(0,i)} M ${e} ${t}`),w(this,$t,6)}if(u(this,st).length===4){let i=L.svgRound(u(this,ke)[10]),o=L.svgRound(u(this,ke)[11]);return w(this,$e,`${u(this,$e)} L ${i} ${o}`),w(this,$t,12),u(this,$e)}let n=[];u(this,$t)===0&&(n.push(`M ${e} ${t}`),w(this,$t,6));for(let i=u(this,$t),o=u(this,ke).length;i<o;i+=6){let[r,a,l,c,d,p]=u(this,ke).slice(i,i+6).map(L.svgRound);n.push(`C${r} ${a} ${l} ${c} ${d} ${p}`)}return w(this,$e,u(this,$e)+n.join(" ")),w(this,$t,u(this,ke).length),u(this,$e)}getOutlines(e,t,n,i){let o=u(this,De).at(-1);return o.line=new Float32Array(o.line),o.points=new Float32Array(o.points),u(this,Ro).build(u(this,De),e,t,n,u(this,Io),u(this,ba),i),w(this,Pn,null),w(this,ke,null),w(this,De,null),w(this,$e,null),u(this,Ro)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}};Pn=new WeakMap,ke=new WeakMap,De=new WeakMap,Io=new WeakMap,ba=new WeakMap,st=new WeakMap,$e=new WeakMap,$t=new WeakMap,Ro=new WeakMap,Po=new WeakMap,Mo=new WeakMap,xa=new WeakSet,mh=function(e,t){return L._normalizePoint(e,t,u(this,Po),u(this,Mo),u(this,Io))};var ot,Fu,Lu,xt,Mn,Nn,Ia,Ra,Pa,ln,Vn,Ip,AE,Rp,_E,Pp,TE,qv=class qv extends L{constructor(){super(...arguments);v(this,ln);v(this,Ip);v(this,Rp);v(this,Pp);v(this,ot,void 0);v(this,Fu,0);v(this,Lu,void 0);v(this,xt,void 0);v(this,Mn,void 0);v(this,Nn,void 0);v(this,Ia,void 0);v(this,Ra,void 0);v(this,Pa,void 0)}build(t,n,i,o,r,a,l){w(this,Mn,n),w(this,Nn,i),w(this,Ia,o),w(this,Ra,r),w(this,Pa,a),w(this,Lu,l!=null?l:0),w(this,xt,t),T(this,Rp,_E).call(this)}setLastElement(t){return u(this,xt).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return u(this,xt).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let t=[];for(let{line:n}of u(this,xt)){if(t.push(`M${L.svgRound(n[4])} ${L.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12){t.push(`L${L.svgRound(n[10])} ${L.svgRound(n[11])}`);continue}for(let i=6,o=n.length;i<o;i+=6){let[r,a,l,c,d,p]=n.subarray(i,i+6).map(L.svgRound);t.push(`C${r} ${a} ${l} ${c} ${d} ${p}`)}}return t.join("")}serialize([t,n,i,o],r){let a=[],l=[],[c,d,p,g]=T(this,Ip,AE).call(this),m,y,A,_,E,C,S,b,x;switch(u(this,Ra)){case 0:x=L._rescale,m=t,y=n+o,A=i,_=-o,E=t+c*i,C=n+(1-d-g)*o,S=t+(c+p)*i,b=n+(1-d)*o;break;case 90:x=L._rescaleAndSwap,m=t,y=n,A=i,_=o,E=t+d*i,C=n+c*o,S=t+(d+g)*i,b=n+(c+p)*o;break;case 180:x=L._rescale,m=t+i,y=n,A=-i,_=o,E=t+(1-c-p)*i,C=n+d*o,S=t+(1-c)*i,b=n+(d+g)*o;break;case 270:x=L._rescaleAndSwap,m=t+i,y=n+o,A=-i,_=-o,E=t+(1-d-g)*i,C=n+(1-c-p)*o,S=t+(1-d)*i,b=n+(1-c)*o;break}for(let{line:P,points:I}of u(this,xt))a.push(x(P,m,y,A,_,r?new Array(P.length):null)),l.push(x(I,m,y,A,_,r?new Array(I.length):null));return{lines:a,points:l,rect:[E,C,S,b]}}static deserialize(t,n,i,o,r,{paths:{lines:a,points:l},rotation:c,thickness:d}){let p=[],g,m,y,A,_;switch(c){case 0:_=L._rescale,g=-t/i,m=n/o+1,y=1/i,A=-1/o;break;case 90:_=L._rescaleAndSwap,g=-n/o,m=-t/i,y=1/o,A=1/i;break;case 180:_=L._rescale,g=t/i+1,m=-n/o,y=-1/i,A=1/o;break;case 270:_=L._rescaleAndSwap,g=n/o+1,m=t/i+1,y=-1/o,A=-1/i;break}if(!a){a=[];for(let C of l){let S=C.length;if(S===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1]]));continue}if(S===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1],NaN,NaN,NaN,NaN,C[2],C[3]]));continue}let b=new Float32Array(3*(S-2));a.push(b);let[x,P,I,N]=C.subarray(0,4);b.set([NaN,NaN,NaN,NaN,x,P],0);for(let M=4;M<S;M+=2){let F=C[M],U=C[M+1];b.set(L.createBezierPoints(x,P,I,N,F,U),(M-2)*3),[x,P,I,N]=[I,N,F,U]}}}for(let C=0,S=a.length;C<S;C++)p.push({line:_(a[C].map(b=>b!=null?b:NaN),g,m,y,A),points:_(l[C].map(b=>b!=null?b:NaN),g,m,y,A)});let E=new qv;return E.build(p,i,o,1,c,d,r),E}get box(){return u(this,ot)}updateProperty(t,n){return t==="stroke-width"?T(this,Pp,TE).call(this,n):null}updateParentDimensions([t,n],i){let[o,r]=T(this,ln,Vn).call(this);w(this,Mn,t),w(this,Nn,n),w(this,Ia,i);let[a,l]=T(this,ln,Vn).call(this),c=a-o,d=l-r,p=u(this,ot);return p[0]-=c,p[1]-=d,p[2]+=2*c,p[3]+=2*d,p}updateRotation(t){return w(this,Fu,t),{path:{transform:this.rotationTransform}}}get viewBox(){return u(this,ot).map(L.svgRound).join(" ")}get defaultProperties(){let[t,n]=u(this,ot);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${L.svgRound(t)} ${L.svgRound(n)}`}}}get rotationTransform(){let[,,t,n]=u(this,ot),i=0,o=0,r=0,a=0,l=0,c=0;switch(u(this,Fu)){case 90:o=n/t,r=-t/n,l=t;break;case 180:i=-1,a=-1,l=t,c=n;break;case 270:o=-n/t,r=t/n,c=n;break;default:return""}return`matrix(${i} ${o} ${r} ${a} ${L.svgRound(l)} ${L.svgRound(c)})`}getPathResizingSVGProperties([t,n,i,o]){let[r,a]=T(this,ln,Vn).call(this),[l,c,d,p]=u(this,ot);if(Math.abs(d-r)<=L.PRECISION||Math.abs(p-a)<=L.PRECISION){let _=t+i/2-(l+d/2),E=n+o/2-(c+p/2);return{path:{"transform-origin":`${L.svgRound(t)} ${L.svgRound(n)}`,transform:`${this.rotationTransform} translate(${_} ${E})`}}}let g=(i-2*r)/(d-2*r),m=(o-2*a)/(p-2*a),y=d/i,A=p/o;return{path:{"transform-origin":`${L.svgRound(l)} ${L.svgRound(c)}`,transform:`${this.rotationTransform} scale(${y} ${A}) translate(${L.svgRound(r)} ${L.svgRound(a)}) scale(${g} ${m}) translate(${L.svgRound(-r)} ${L.svgRound(-a)})`}}}getPathResizedSVGProperties([t,n,i,o]){let[r,a]=T(this,ln,Vn).call(this),l=u(this,ot),[c,d,p,g]=l;if(l[0]=t,l[1]=n,l[2]=i,l[3]=o,Math.abs(p-r)<=L.PRECISION||Math.abs(g-a)<=L.PRECISION){let E=t+i/2-(c+p/2),C=n+o/2-(d+g/2);for(let{line:S,points:b}of u(this,xt))L._translate(S,E,C,S),L._translate(b,E,C,b);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${L.svgRound(t)} ${L.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let m=(i-2*r)/(p-2*r),y=(o-2*a)/(g-2*a),A=-m*(c+r)+t+r,_=-y*(d+a)+n+a;if(m!==1||y!==1||A!==0||_!==0)for(let{line:E,points:C}of u(this,xt))L._rescale(E,A,_,m,y,E),L._rescale(C,A,_,m,y,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${L.svgRound(t)} ${L.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],i){let[o,r]=i,a=u(this,ot),l=t-a[0],c=n-a[1];if(u(this,Mn)===o&&u(this,Nn)===r)for(let{line:d,points:p}of u(this,xt))L._translate(d,l,c,d),L._translate(p,l,c,p);else{let d=u(this,Mn)/o,p=u(this,Nn)/r;w(this,Mn,o),w(this,Nn,r);for(let{line:g,points:m}of u(this,xt))L._rescale(g,l,c,d,p,g),L._rescale(m,l,c,d,p,m);a[2]*=d,a[3]*=p}return a[0]=t,a[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${L.svgRound(t)} ${L.svgRound(n)}`}}}get defaultSVGProperties(){let t=u(this,ot);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${L.svgRound(t[0])} ${L.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};ot=new WeakMap,Fu=new WeakMap,Lu=new WeakMap,xt=new WeakMap,Mn=new WeakMap,Nn=new WeakMap,Ia=new WeakMap,Ra=new WeakMap,Pa=new WeakMap,ln=new WeakSet,Vn=function(t=u(this,Pa)){let n=u(this,Lu)+t/2*u(this,Ia);return u(this,Ra)%180===0?[n/u(this,Mn),n/u(this,Nn)]:[n/u(this,Nn),n/u(this,Mn)]},Ip=new WeakSet,AE=function(){let[t,n,i,o]=u(this,ot),[r,a]=T(this,ln,Vn).call(this,0);return[t+r,n+a,i-2*r,o-2*a]},Rp=new WeakSet,_E=function(){let t=w(this,ot,new Float32Array([1/0,1/0,-1/0,-1/0]));for(let{line:o}of u(this,xt)){if(o.length<=12){for(let l=4,c=o.length;l<c;l+=6){let[d,p]=o.subarray(l,l+2);t[0]=Math.min(t[0],d),t[1]=Math.min(t[1],p),t[2]=Math.max(t[2],d),t[3]=Math.max(t[3],p)}continue}let r=o[4],a=o[5];for(let l=6,c=o.length;l<c;l+=6){let[d,p,g,m,y,A]=o.subarray(l,l+6);$.bezierBoundingBox(r,a,d,p,g,m,y,A,t),r=y,a=A}}let[n,i]=T(this,ln,Vn).call(this);t[0]=Math.min(1,Math.max(0,t[0]-n)),t[1]=Math.min(1,Math.max(0,t[1]-i)),t[2]=Math.min(1,Math.max(0,t[2]+n)),t[3]=Math.min(1,Math.max(0,t[3]+i)),t[2]-=t[0],t[3]-=t[1]},Pp=new WeakSet,TE=function(t){let[n,i]=T(this,ln,Vn).call(this);w(this,Pa,t);let[o,r]=T(this,ln,Vn).call(this),[a,l]=[o-n,r-i],c=u(this,ot);return c[0]-=a,c[1]-=l,c[2]+=2*a,c[3]+=2*l,c};var Xh=qv,Ma,zv=class zv extends wv{constructor(t){super();v(this,Ma,void 0);w(this,Ma,t),super.updateProperties({fill:"none",stroke:fe._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,n){t==="stroke-width"&&(n!=null||(n=this["stroke-width"]),n*=u(this,Ma).realScale),super.updateSVGProperty(t,n)}clone(){let t=new zv(u(this,Ma));return t.updateAll(this),t}};Ma=new WeakMap;var Sv=zv,Mp,EE,ar=class ar extends Av{constructor(t){super({...t,name:"inkEditor"});v(this,Mp);this._willKeepAspectRatio=!0}static initialize(t,n){fe.initialize(t,n),this._defaultDrawingOptions=new Sv(n.viewParameters)}static getDefaultDrawingOptions(t){let n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return Z(this,"typesMap",new Map([[Q.INK_THICKNESS,"stroke-width"],[Q.INK_COLOR,"stroke"],[Q.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,i,o,r){return new Cv(t,n,i,o,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,i,o,r,a){return Xh.deserialize(t,n,i,o,r,a)}static async deserialize(t,n,i){let o=null;if(t instanceof Rl){let{data:{inkLists:a,rect:l,rotation:c,id:d,color:p,opacity:g,borderStyle:{rawWidth:m},popupRef:y},parent:{page:{pageNumber:A}}}=t;o=t={annotationType:K.INK,color:Array.from(p),thickness:m,opacity:g,paths:{points:a},boxes:null,pageIndex:A-1,rect:l.slice(0),rotation:c,id:d,deleted:!1,popupRef:y}}let r=await super.deserialize(t,n,i);return r.annotationElementId=t.id||null,r._initialData=o,r}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:t,_drawingOptions:n,parent:i}=this;n.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){let t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:i}){this._drawingOptions=ar.getDefaultDrawingOptions({stroke:$.makeHexColor(...t),"stroke-width":n,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:n,points:i,rect:o}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":a,"stroke-width":l}}=this,c={annotationType:K.INK,color:fe._colorManager.convert(r),opacity:a,thickness:l,paths:{lines:n,points:i},pageIndex:this.pageIndex,rect:o,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?c:this.annotationElementId&&!T(this,Mp,EE).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(t){let{points:n,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:n}),null}};Mp=new WeakSet,EE=function(t){let{color:n,thickness:i,opacity:o,pageIndex:r}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((a,l)=>a!==n[l])||t.thickness!==i||t.opacity!==o||t.pageIndex!==r},H(ar,"_type","ink"),H(ar,"_editorType",K.INK),H(ar,"_defaultDrawingOptions",null);var bv=ar,he,Ge,is,mi,ss,Na,kn,Dn,It,ka,No,fl,ko,pl,Da,yh,Uu,Iv,Fa,vh,Ou,Rv,La,wh,Np,CE,vl=class vl extends fe{constructor(t){super({...t,name:"stampEditor"});v(this,No);v(this,ko);v(this,Da);v(this,Uu);v(this,Fa);v(this,Ou);v(this,La);v(this,Np);v(this,he,null);v(this,Ge,null);v(this,is,null);v(this,mi,null);v(this,ss,null);v(this,Na,"");v(this,kn,null);v(this,Dn,null);v(this,It,!1);v(this,ka,!1);w(this,mi,t.bitmapUrl),w(this,ss,t.bitmapFile)}static initialize(t,n){fe.initialize(t,n)}static get supportedTypes(){return Z(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(n=>`image/${n}`))}static get supportedTypesStr(){return Z(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,n){n.pasteEditor(K.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){var i,o;let n=t.get("hasAltText");return{hasAltText:(i=n.get(!0))!=null?i:0,hasNoAltText:(o=n.get(!1))!=null?o:0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;let{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");let{data:o,width:r,height:a}=t||this.copyCanvas(null,null,!0).imageData,l=await i.guess({name:"altText",request:{data:o,width:r,height:a,channels:o.length/(r*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");let c=l.output;return await this.setGuessedAltText(c),n&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){var t;u(this,Ge)&&(w(this,he,null),this._uiManager.imageManager.deleteId(u(this,Ge)),(t=u(this,kn))==null||t.remove(),w(this,kn,null),u(this,Dn)&&(clearTimeout(u(this,Dn)),w(this,Dn,null))),super.remove()}rebuild(){if(!this.parent){u(this,Ge)&&T(this,Da,yh).call(this);return}super.rebuild(),this.div!==null&&(u(this,Ge)&&u(this,kn)===null&&T(this,Da,yh).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(u(this,is)||u(this,he)||u(this,mi)||u(this,ss)||u(this,Ge))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;if(this.width&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),u(this,he)?T(this,Uu,Iv).call(this):T(this,Da,yh).call(this),this.width&&!this.annotationElementId){let[i,o]=this.parentDimensions;this.setAt(t*i,n*o,this.width*i,this.height*o)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;u(this,Dn)!==null&&clearTimeout(u(this,Dn)),w(this,Dn,setTimeout(()=>{w(this,Dn,null),T(this,Ou,Rv).call(this)},200))}copyCanvas(t,n,i=!1){var m;t||(t=224);let{width:o,height:r}=u(this,he),a=new Tl,l=u(this,he),c=o,d=r,p=null;if(n){if(o>n||r>n){let N=Math.min(n/o,n/r);c=Math.floor(o*N),d=Math.floor(r*N)}p=document.createElement("canvas");let y=p.width=Math.ceil(c*a.sx),A=p.height=Math.ceil(d*a.sy);u(this,It)||(l=T(this,Fa,vh).call(this,y,A));let _=p.getContext("2d");_.filter=this._uiManager.hcmFilter;let E="white",C="#cfcfd8";this._uiManager.hcmFilter!=="none"?C="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(E="#8f8f9d",C="#42414d");let S=15,b=S*a.sx,x=S*a.sy,P=new OffscreenCanvas(b*2,x*2),I=P.getContext("2d");I.fillStyle=E,I.fillRect(0,0,b*2,x*2),I.fillStyle=C,I.fillRect(0,0,b,x),I.fillRect(b,x,b,x),_.fillStyle=_.createPattern(P,"repeat"),_.fillRect(0,0,y,A),_.drawImage(l,0,0,l.width,l.height,0,0,y,A)}let g=null;if(i){let y,A;if(a.symmetric&&l.width<t&&l.height<t)y=l.width,A=l.height;else if(l=u(this,he),o>t||r>t){let C=Math.min(t/o,t/r);y=Math.floor(o*C),A=Math.floor(r*C),u(this,It)||(l=T(this,Fa,vh).call(this,y,A))}let E=new OffscreenCanvas(y,A).getContext("2d",{willReadFrequently:!0});E.drawImage(l,0,0,l.width,l.height,0,0,y,A),g={width:y,height:A,data:E.getImageData(0,0,y,A).data}}return{canvas:p,width:c,height:d,imageData:g}}getImageForAltText(){return u(this,kn)}static async deserialize(t,n,i){var A;let o=null;if(t instanceof zh){let{data:{rect:_,rotation:E,id:C,structParent:S,popupRef:b},container:x,parent:{page:{pageNumber:P}}}=t,I=x.querySelector("canvas"),N=i.imageManager.getFromCanvas(x.id,I);I.remove();let M=((A=await n._structTree.getAriaAttributes(`${Uv}${C}`))==null?void 0:A.get("aria-label"))||"";o=t={annotationType:K.STAMP,bitmapId:N.id,bitmap:N.bitmap,pageIndex:P-1,rect:_.slice(0),rotation:E,id:C,deleted:!1,accessibilityData:{decorative:!1,altText:M},isSvg:!1,structParent:S,popupRef:b}}let r=await super.deserialize(t,n,i),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:d,isSvg:p,accessibilityData:g}=t;d&&i.imageManager.isValidId(d)?(w(r,Ge,d),l&&w(r,he,l)):w(r,mi,c),w(r,It,p);let[m,y]=r.pageDimensions;return r.width=(a[2]-a[0])/m,r.height=(a[3]-a[1])/y,r.annotationElementId=t.id||null,g&&(r.altTextData=g),r._initialData=o,w(r,ka,!!o),r}serialize(t=!1,n=null){var l;if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let i={annotationType:K.STAMP,bitmapId:u(this,Ge),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:u(this,It),structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=T(this,La,wh).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i;let{decorative:o,altText:r}=this.serializeAltText(!1);if(!o&&r&&(i.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){let c=T(this,Np,CE).call(this,i);if(c.isSame)return null;c.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=(l=this._initialData.structParent)!=null?l:-1}if(i.id=this.annotationElementId,n===null)return i;n.stamps||(n.stamps=new Map);let a=u(this,It)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!n.stamps.has(u(this,Ge)))n.stamps.set(u(this,Ge),{area:a,serialized:i}),i.bitmap=T(this,La,wh).call(this,!1);else if(u(this,It)){let c=n.stamps.get(u(this,Ge));a>c.area&&(c.area=a,c.serialized.bitmap.close(),c.serialized.bitmap=T(this,La,wh).call(this,!1))}return i}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};he=new WeakMap,Ge=new WeakMap,is=new WeakMap,mi=new WeakMap,ss=new WeakMap,Na=new WeakMap,kn=new WeakMap,Dn=new WeakMap,It=new WeakMap,ka=new WeakMap,No=new WeakSet,fl=function(t,n=!1){if(!t){this.remove();return}w(this,he,t.bitmap),n||(w(this,Ge,t.id),w(this,It,t.isSvg)),t.file&&w(this,Na,t.file.name),T(this,Uu,Iv).call(this)},ko=new WeakSet,pl=function(){if(w(this,is,null),this._uiManager.enableWaiting(!1),!!u(this,kn)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,he)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,he)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch(t){}}this.div.focus()}},Da=new WeakSet,yh=function(){if(u(this,Ge)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(u(this,Ge)).then(i=>T(this,No,fl).call(this,i,!0)).finally(()=>T(this,ko,pl).call(this));return}if(u(this,mi)){let i=u(this,mi);w(this,mi,null),this._uiManager.enableWaiting(!0),w(this,is,this._uiManager.imageManager.getFromUrl(i).then(o=>T(this,No,fl).call(this,o)).finally(()=>T(this,ko,pl).call(this)));return}if(u(this,ss)){let i=u(this,ss);w(this,ss,null),this._uiManager.enableWaiting(!0),w(this,is,this._uiManager.imageManager.getFromFile(i).then(o=>T(this,No,fl).call(this,o)).finally(()=>T(this,ko,pl).call(this)));return}let t=document.createElement("input");t.type="file",t.accept=vl.supportedTypesStr;let n=this._uiManager._signal;w(this,is,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let o=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),T(this,No,fl).call(this,o)}i()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:n})}).finally(()=>T(this,ko,pl).call(this))),t.click()},Uu=new WeakSet,Iv=function(){var p;let{div:t}=this,{width:n,height:i}=u(this,he),[o,r]=this.pageDimensions,a=.75;if(this.width)n=this.width*o,i=this.height*r;else if(n>a*o||i>a*r){let g=Math.min(a*o/n,a*r/i);n*=g,i*=g}let[l,c]=this.parentDimensions;this.setDims(n*l/o,i*c/r),this._uiManager.enableWaiting(!1);let d=w(this,kn,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=n/o,this.height=i/r,(p=this._initialOptions)!=null&&p.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),T(this,Ou,Rv).call(this),u(this,ka)||(this.parent.addUndoableEditor(this),w(this,ka,!0)),this._reportTelemetry({action:"inserted_image"}),u(this,Na)&&d.setAttribute("aria-label",u(this,Na))},Fa=new WeakSet,vh=function(t,n){let{width:i,height:o}=u(this,he),r=i,a=o,l=u(this,he);for(;r>2*t||a>2*n;){let c=r,d=a;r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),a>2*n&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));let p=new OffscreenCanvas(r,a);p.getContext("2d").drawImage(l,0,0,c,d,0,0,r,a),l=p.transferToImageBitmap()}return l},Ou=new WeakSet,Rv=function(){let[t,n]=this.parentDimensions,{width:i,height:o}=this,r=new Tl,a=Math.ceil(i*t*r.sx),l=Math.ceil(o*n*r.sy),c=u(this,kn);if(!c||c.width===a&&c.height===l)return;c.width=a,c.height=l;let d=u(this,It)?u(this,he):T(this,Fa,vh).call(this,a,l),p=c.getContext("2d");p.filter=this._uiManager.hcmFilter,p.drawImage(d,0,0,d.width,d.height,0,0,a,l)},La=new WeakSet,wh=function(t){if(t){if(u(this,It)){let o=this._uiManager.imageManager.getSvgUrl(u(this,Ge));if(o)return o}let n=document.createElement("canvas");return{width:n.width,height:n.height}=u(this,he),n.getContext("2d").drawImage(u(this,he),0,0),n.toDataURL()}if(u(this,It)){let[n,i]=this.pageDimensions,o=Math.round(this.width*n*cs.PDF_TO_CSS_UNITS),r=Math.round(this.height*i*cs.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(o,r);return a.getContext("2d").drawImage(u(this,he),0,0,u(this,he).width,u(this,he).height,0,0,o,r),a.transferToImageBitmap()}return structuredClone(u(this,he))},Np=new WeakSet,CE=function(t){var a;let{pageIndex:n,accessibilityData:{altText:i}}=this._initialData,o=t.pageIndex===n,r=(((a=t.accessibilityData)==null?void 0:a.alt)||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&o&&r,isSameAltText:r}},H(vl,"_type","stamp"),H(vl,"_editorType",K.STAMP);var xv=vl,Do,Ua,Fn,os,yi,Gt,rs,Oa,Fo,cn,vi,Ze,wi,G,as,kp,SE,Bt,yn,$u,Mv,Gu,Nv,$a,Ah,Yt=class Yt{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:i,accessibilityManager:o,annotationLayer:r,drawLayer:a,textLayer:l,viewport:c,l10n:d}){v(this,kp);v(this,Bt);v(this,$u);v(this,Gu);v(this,$a);v(this,Do,void 0);v(this,Ua,!1);v(this,Fn,null);v(this,os,null);v(this,yi,null);v(this,Gt,new Map);v(this,rs,!1);v(this,Oa,!1);v(this,Fo,!1);v(this,cn,null);v(this,vi,null);v(this,Ze,null);v(this,wi,null);v(this,G,void 0);let p=[...u(Yt,as).values()];if(!Yt._initialized){Yt._initialized=!0;for(let g of p)g.initialize(d,e)}e.registerEditorTypes(p),w(this,G,e),this.pageIndex=t,this.div=n,w(this,Do,o),w(this,Fn,r),this.viewport=c,w(this,Ze,l),this.drawLayer=a,this._structTree=i,u(this,G).addLayer(this)}get isEmpty(){return u(this,Gt).size===0}get isInvisible(){return this.isEmpty&&u(this,G).getMode()===K.NONE}updateToolbar(e){u(this,G).updateToolbar(e)}updateMode(e=u(this,G).getMode()){switch(T(this,$a,Ah).call(this),e){case K.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case K.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case K.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:t}=this.div;for(let n of u(Yt,as).values())t.toggle(`${n._type}Editing`,e===n._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=u(this,Ze))==null?void 0:t.div)}setEditingState(e){u(this,G).setEditingState(e)}addCommands(e){u(this,G).addCommands(e)}cleanUndoStack(e){u(this,G).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=u(this,Fn))==null||t.div.classList.toggle("disabled",!e)}async enable(){w(this,Fo,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);let e=new Set;for(let n of u(this,Gt).values())n.enableEditing(),n.show(!0),n.annotationElementId&&(u(this,G).removeChangedExistingAnnotation(n),e.add(n.annotationElementId));if(!u(this,Fn)){w(this,Fo,!1);return}let t=u(this,Fn).getEditableAnnotations();for(let n of t){if(n.hide(),u(this,G).isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;let i=await this.deserialize(n);i&&(this.addOrRebuild(i),i.enableEditing())}w(this,Fo,!1)}disable(){var i;w(this,Oa,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);let e=new Map,t=new Map;for(let o of u(this,Gt).values())if(o.disableEditing(),!!o.annotationElementId){if(o.serialize()!==null){e.set(o.annotationElementId,o);continue}else t.set(o.annotationElementId,o);(i=this.getEditableAnnotation(o.annotationElementId))==null||i.show(),o.remove()}if(u(this,Fn)){let o=u(this,Fn).getEditableAnnotations();for(let r of o){let{id:a}=r.data;if(u(this,G).isDeletedAnnotationElement(a))continue;let l=t.get(a);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=e.get(a),l&&(u(this,G).addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}T(this,$a,Ah).call(this),this.isEmpty&&(this.div.hidden=!0);let{classList:n}=this.div;for(let o of u(Yt,as).values())n.remove(`${o._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),w(this,Oa,!1)}getEditableAnnotation(e){var t;return((t=u(this,Fn))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){u(this,G).getActive()!==e&&u(this,G).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=u(this,Ze))!=null&&e.div&&!u(this,wi)){w(this,wi,new AbortController);let t=u(this,G).combinedSignal(u(this,wi));u(this,Ze).div.addEventListener("pointerdown",T(this,kp,SE).bind(this),{signal:t}),u(this,Ze).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=u(this,Ze))!=null&&e.div&&u(this,wi)&&(u(this,wi).abort(),w(this,wi,null),u(this,Ze).div.classList.remove("highlighting"))}enableClick(){if(u(this,os))return;w(this,os,new AbortController);let e=u(this,G).combinedSignal(u(this,os));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});let t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=u(this,os))==null||e.abort(),w(this,os,null)}attach(e){u(this,Gt).set(e.id,e);let{annotationElementId:t}=e;t&&u(this,G).isDeletedAnnotationElement(t)&&u(this,G).removeDeletedAnnotationElement(e)}detach(e){var t;u(this,Gt).delete(e.id),(t=u(this,Do))==null||t.removePointerInTextLayer(e.contentDiv),!u(this,Oa)&&e.annotationElementId&&u(this,G).addDeletedAnnotationElement(e)}remove(e){this.detach(e),u(this,G).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(u(this,G).addDeletedAnnotationElement(e.annotationElementId),fe.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),u(this,G).addEditor(e),this.attach(e),!e.isAttachedToDOM){let t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!u(this,Fo)),u(this,G).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var n;if(!e.isAttachedToDOM)return;let{activeElement:t}=document;e.div.contains(t)&&!u(this,yi)&&(e._focusEventsAllowed=!1,w(this,yi,setTimeout(()=>{w(this,yi,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:u(this,G)._signal}),t.focus())},0))),e._structTreeParentId=(n=u(this,Do))==null?void 0:n.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){let t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getNextId(){return u(this,G).getId()}combinedSignal(e){return u(this,G).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=u(this,Bt,yn))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){u(this,G).updateToolbar(e),u(this,G).updateMode(e);let{offsetX:n,offsetY:i}=T(this,Gu,Nv).call(this),o=this.getNextId(),r=T(this,$u,Mv).call(this,{parent:this,id:o,x:n,y:i,uiManager:u(this,G),isCentered:!0,...t});r&&this.add(r)}async deserialize(e){var t,n;return await((n=u(Yt,as).get((t=e.annotationType)!=null?t:e.annotationEditorType))==null?void 0:n.deserialize(e,this,u(this,G)))||null}createAndAddNewEditor(e,t,n={}){let i=this.getNextId(),o=T(this,$u,Mv).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:u(this,G),isCentered:t,...n});return o&&this.add(o),o}addNewEditor(){this.createAndAddNewEditor(T(this,Gu,Nv).call(this),!0)}setSelected(e){u(this,G).setSelected(e)}toggleSelected(e){u(this,G).toggleSelected(e)}unselect(e){u(this,G).unselect(e)}pointerup(e){var n;let{isMac:t}=Be.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&u(this,rs)&&(w(this,rs,!1),!((n=u(this,Bt,yn))!=null&&n.isDrawer&&u(this,Bt,yn).supportMultipleDrawings))){if(!u(this,Ua)){w(this,Ua,!0);return}if(u(this,G).getMode()===K.STAMP){u(this,G).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var i;if(u(this,G).getMode()===K.HIGHLIGHT&&this.enableTextSelection(),u(this,rs)){w(this,rs,!1);return}let{isMac:t}=Be.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(w(this,rs,!0),(i=u(this,Bt,yn))!=null&&i.isDrawer){this.startDrawingSession(e);return}let n=u(this,G).getActive();w(this,Ua,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus(),u(this,cn)){u(this,Bt,yn).startDrawing(this,u(this,G),!1,e);return}u(this,G).setCurrentDrawingSession(this),w(this,cn,new AbortController);let t=u(this,G).combinedSignal(u(this,cn));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(w(this,vi,null),this.commitOrRemove())},{signal:t}),u(this,Bt,yn).startDrawing(this,u(this,G),!1,e)}pause(e){if(e){let{activeElement:t}=document;this.div.contains(t)&&w(this,vi,t);return}u(this,vi)&&setTimeout(()=>{var t;(t=u(this,vi))==null||t.focus(),w(this,vi,null)},0)}endDrawingSession(e=!1){return u(this,cn)?(u(this,G).setCurrentDrawingSession(null),u(this,cn).abort(),w(this,cn,null),w(this,vi,null),u(this,Bt,yn).endDrawing(e)):null}findNewParent(e,t,n){let i=u(this,G).findParent(t,n);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return u(this,cn)?(this.endDrawingSession(),!0):!1}onScaleChanging(){u(this,cn)&&u(this,Bt,yn).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=u(this,G).getActive())==null?void 0:e.parent)===this&&(u(this,G).commitOrRemove(),u(this,G).setActiveEditor(null)),u(this,yi)&&(clearTimeout(u(this,yi)),w(this,yi,null));for(let n of u(this,Gt).values())(t=u(this,Do))==null||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,u(this,Gt).clear(),u(this,G).removeLayer(this)}render({viewport:e}){this.viewport=e,Oo(this.div,e);for(let t of u(this,G).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){u(this,G).commitOrRemove(),T(this,$a,Ah).call(this);let t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,Oo(this.div,{rotation:n}),t!==n)for(let i of u(this,Gt).values())i.rotate(n)}get pageDimensions(){let{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return u(this,G).viewParameters.realScale}};Do=new WeakMap,Ua=new WeakMap,Fn=new WeakMap,os=new WeakMap,yi=new WeakMap,Gt=new WeakMap,rs=new WeakMap,Oa=new WeakMap,Fo=new WeakMap,cn=new WeakMap,vi=new WeakMap,Ze=new WeakMap,wi=new WeakMap,G=new WeakMap,as=new WeakMap,kp=new WeakSet,SE=function(e){u(this,G).unselectAll();let{target:t}=e;if(t===u(this,Ze).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&u(this,Ze).div.contains(t)){let{isMac:n}=Be.platform;if(e.button!==0||e.ctrlKey&&n)return;u(this,G).showAllEditors("highlight",!0,!0),u(this,Ze).div.classList.add("free"),this.toggleDrawing(),Jh.startHighlighting(this,u(this,G).direction==="ltr",{target:u(this,Ze).div,x:e.x,y:e.y}),u(this,Ze).div.addEventListener("pointerup",()=>{u(this,Ze).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:u(this,G)._signal}),e.preventDefault()}},Bt=new WeakSet,yn=function(){return u(Yt,as).get(u(this,G).getMode())},$u=new WeakSet,Mv=function(e){let t=u(this,Bt,yn);return t?new t.prototype.constructor(e):null},Gu=new WeakSet,Nv=function(){let{x:e,y:t,width:n,height:i}=this.div.getBoundingClientRect(),o=Math.max(0,e),r=Math.max(0,t),a=Math.min(window.innerWidth,e+n),l=Math.min(window.innerHeight,t+i),c=(o+a)/2-e,d=(r+l)/2-t,[p,g]=this.viewport.rotation%180===0?[c,d]:[d,c];return{offsetX:p,offsetY:g}},$a=new WeakSet,Ah=function(){for(let e of u(this,Gt).values())e.isEmpty()&&e.remove()},H(Yt,"_initialized",!1),v(Yt,as,new Map([cv,bv,xv,Jh].map(e=>[e._editorType,e])));var Pv=Yt,un,Bu,rt,Lo,Dp,bE,Hu,Dv,Fp,xE,Vu,Fv,Ke=class Ke{constructor({pageIndex:e}){v(this,Hu);v(this,Fp);v(this,Vu);v(this,un,null);v(this,Bu,0);v(this,rt,new Map);v(this,Lo,new Map);this.pageIndex=e}setParent(e){if(!u(this,un)){w(this,un,e);return}if(u(this,un)!==e){if(u(this,rt).size>0)for(let t of u(this,rt).values())t.remove(),e.append(t);w(this,un,e)}}static get _svgFactory(){return Z(this,"_svgFactory",new xl)}draw(e,t=!1,n=!1){let i=et(this,Bu)._++,o=T(this,Hu,Dv).call(this),r=Ke._svgFactory.createElement("defs");o.append(r);let a=Ke._svgFactory.createElement("path");r.append(a);let l=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&u(this,Lo).set(i,a);let c=n?T(this,Fp,xE).call(this,r,l):null,d=Ke._svgFactory.createElement("use");return o.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(o,e),u(this,rt).set(i,o),{id:i,clipPathId:`url(#${c})`}}drawOutline(e,t){let n=et(this,Bu)._++,i=T(this,Hu,Dv).call(this),o=Ke._svgFactory.createElement("defs");i.append(o);let r=Ke._svgFactory.createElement("path");o.append(r);let a=`path_p${this.pageIndex}_${n}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){let p=Ke._svgFactory.createElement("mask");o.append(p),l=`mask_p${this.pageIndex}_${n}`,p.setAttribute("id",l),p.setAttribute("maskUnits","objectBoundingBox");let g=Ke._svgFactory.createElement("rect");p.append(g),g.setAttribute("width","1"),g.setAttribute("height","1"),g.setAttribute("fill","white");let m=Ke._svgFactory.createElement("use");p.append(m),m.setAttribute("href",`#${a}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}let c=Ke._svgFactory.createElement("use");i.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);let d=c.cloneNode();return i.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(i,e),u(this,rt).set(n,i),n}finalizeDraw(e,t){u(this,Lo).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;let{root:n,bbox:i,rootClass:o,path:r}=t,a=typeof e=="number"?u(this,rt).get(e):e;if(a){if(n&&T(this,Vu,Fv).call(this,a,n),i&&T(l=Ke,Dp,bE).call(l,a,i),o){let{classList:c}=a;for(let[d,p]of Object.entries(o))c.toggle(d,p)}if(r){let d=a.firstChild.firstChild;T(this,Vu,Fv).call(this,d,r)}}}updateParent(e,t){if(t===this)return;let n=u(this,rt).get(e);n&&(u(t,un).append(n),u(this,rt).delete(e),u(t,rt).set(e,n))}remove(e){u(this,Lo).delete(e),u(this,un)!==null&&(u(this,rt).get(e).remove(),u(this,rt).delete(e))}destroy(){w(this,un,null);for(let e of u(this,rt).values())e.remove();u(this,rt).clear(),u(this,Lo).clear()}};un=new WeakMap,Bu=new WeakMap,rt=new WeakMap,Lo=new WeakMap,Dp=new WeakSet,bE=function(e,[t,n,i,o]){let{style:r}=e;r.top=`${100*n}%`,r.left=`${100*t}%`,r.width=`${100*i}%`,r.height=`${100*o}%`},Hu=new WeakSet,Dv=function(){let e=Ke._svgFactory.create(1,1,!0);return u(this,un).append(e),e.setAttribute("aria-hidden",!0),e},Fp=new WeakSet,xE=function(e,t){let n=Ke._svgFactory.createElement("clipPath");e.append(n);let i=`clip_${t}`;n.setAttribute("id",i),n.setAttribute("clipPathUnits","objectBoundingBox");let o=Ke._svgFactory.createElement("use");return n.append(o),o.setAttribute("href",`#${t}`),o.classList.add("clip"),i},Vu=new WeakSet,Fv=function(e,t){for(let[n,i]of Object.entries(t))i===null?e.removeAttribute(n):e.setAttribute(n,i)},v(Ke,Dp);var kv=Ke;globalThis.pdfjsTestingUtils={HighlightOutliner:Pl};var BP=V.AbortException,HP=V.AnnotationEditorLayer,VP=V.AnnotationEditorParamsType,qP=V.AnnotationEditorType,zP=V.AnnotationEditorUIManager,WP=V.AnnotationLayer,KP=V.AnnotationMode,YP=V.ColorPicker,JP=V.DOMSVGFactory,XP=V.DrawLayer,ZP=V.FeatureTest,IE=V.GlobalWorkerOptions,QP=V.ImageKind,jP=V.InvalidPDFException,eM=V.MissingPDFException,tM=V.OPS,nM=V.OutputScale,iM=V.PDFDataRangeTransport,sM=V.PDFDateString,oM=V.PDFWorker,rM=V.PasswordResponses,aM=V.PermissionFlag,lM=V.PixelsPerInch,cM=V.RenderingCancelledException,uM=V.TextLayer,dM=V.TouchManager,hM=V.UnexpectedResponseException,fM=V.Util,pM=V.VerbosityLevel,gM=V.XfaLayer,mM=V.build,yM=V.createValidAbsoluteUrl,vM=V.fetchData,qp=V.getDocument,wM=V.getFilenameFromUrl,AM=V.getPdfFilenameFromUrl,_M=V.getXfaPageViewport,TM=V.isDataScheme,EM=V.isPdfFile,CM=V.noContextMenu,SM=V.normalizeUnicode,bM=V.setLayerDimensions,xM=V.shadow,IM=V.stopEvent,RM=V.version;IE.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.mjs";var zp=class{constructor(e=50){this.minTextThreshold=e}async extractText(e){let t=await qp({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,n="";for(let r=1;r<=t.numPages;r++){let c=(await(await t.getPage(r)).getTextContent()).items.map(d=>d.str||"").join(" ");n+=`
## \uD398\uC774\uC9C0 ${r}

${c}
`}let o=n.replace(/\s/g,"").length/t.numPages<this.minTextThreshold;return{text:n,isScanned:o,numPages:t.numPages}}async renderPagesToImages(e,t){let n=await qp({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,i=[],o=t?Math.min(n.numPages,t):n.numPages;for(let r=1;r<=o;r++){let a=await n.getPage(r),l=a.getViewport({scale:2}),c=document.createElement("canvas");c.width=l.width,c.height=l.height;let d=c.getContext("2d");await a.render({canvasContext:d,viewport:l}).promise;let p=c.toDataURL("image/png").split(",")[1];i.push({base64:p,mimeType:"image/png",pageNum:r})}return i}async getPageCount(e){return(await qp({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise).numPages}};var Wp=class{constructor(e,t,n){this.gemini=e,this.settings=t,this.vault=n,this.pdfProcessor=new zp(t.ocrMinTextThreshold),this.dailyUsage=this.loadDailyUsage()}loadDailyUsage(){return{date:pn(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}saveDailyUsage(){}checkDailyLimit(e){let t=pn(this.settings.timezone);this.dailyUsage.date!==t&&(this.dailyUsage={date:t,pagesProcessed:0,filesProcessed:0});let n=this.settings.ocrDailyLimit-this.dailyUsage.pagesProcessed;return{allowed:e<=n,remaining:n}}getFileSizeMB(e){return e.stat.size/(1024*1024)}async checkLimits(e){let t=this.getFileSizeMB(e);if(t>this.settings.ocrMaxFileSizeMB)return{allowed:!1,reason:`\uD30C\uC77C \uD06C\uAE30(${t.toFixed(1)}MB)\uAC00 \uC81C\uD55C(${this.settings.ocrMaxFileSizeMB}MB)\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,fileSize:t};if(e.extension==="pdf"){let i=await this.vault.readBinary(e),o=await this.pdfProcessor.getPageCount(i);if(o>this.settings.ocrMaxPages)return{allowed:!1,reason:`\uD398\uC774\uC9C0 \uC218(${o})\uAC00 \uC81C\uD55C(${this.settings.ocrMaxPages})\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,pageCount:o,fileSize:t};let r=this.checkDailyLimit(o);return r.allowed?{allowed:!0,pageCount:o,fileSize:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${r.remaining})`,pageCount:o,fileSize:t}}let n=this.checkDailyLimit(1);return n.allowed?{allowed:!0,pageCount:1,fileSize:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${n.remaining})`,pageCount:1,fileSize:t}}async processImage(e){let t=await this.vault.readBinary(e),n=this.arrayBufferToBase64(t),i=this.getMimeType(e.extension),o=await this.gemini.extractTextFromImage(n,i);return this.dailyUsage.pagesProcessed+=1,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:o,pages:1,sourceType:"image",sourceFile:e.name}}async processPDF(e,t=!1,n){let i=await this.vault.readBinary(e),o=n||this.settings.ocrMaxPages,r=await this.pdfProcessor.extractText(i);if(!r.isScanned&&!t)return{text:r.text,pages:r.numPages,sourceType:"pdf_text",sourceFile:e.name};let a=Math.min(r.numPages,o);new Wv.Notice(`\uC2A4\uCE94 PDF \uAC10\uC9C0\uB428. OCR \uCC98\uB9AC \uC911... (${a}\uD398\uC774\uC9C0)`);let l=await this.pdfProcessor.renderPagesToImages(i,o),c=await this.gemini.extractTextFromImages(l,(p,g)=>{new Wv.Notice(`OCR \uC9C4\uD589 \uC911: ${p}/${g} \uD398\uC774\uC9C0`,1500)}),d="";for(let p=0;p<c.length;p++)d+=`
## \uD398\uC774\uC9C0 ${p+1}

${c[p]}
`;return this.dailyUsage.pagesProcessed+=c.length,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:d,pages:c.length,sourceType:"pdf_scanned",sourceFile:e.name}}async processFile(e,t){let n=e.extension.toLowerCase();if(["png","jpg","jpeg","webp","gif"].includes(n))return this.processImage(e);if(n==="pdf")return this.processPDF(e,!1,t);throw new Error(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD: ${n}`)}generateMarkdownNote(e){let t=Ee(this.settings.timezone,this.settings.dateFormat),n={image:"\uC774\uBBF8\uC9C0",pdf_text:"PDF (\uD14D\uC2A4\uD2B8)",pdf_scanned:"PDF (\uC2A4\uCE94/OCR)"}[e.sourceType];return`---
type: ocr
source_file: "${e.sourceFile}"
source_type: ${e.sourceType}
pages: ${e.pages}
ocr_at: ${t}
---

# OCR: ${e.sourceFile.replace(/\.[^.]+$/,"")}

> \uC6D0\uBCF8: ${e.sourceFile} | \uCC98\uB9AC \uBC29\uC2DD: ${n} | ${e.pages}\uD398\uC774\uC9C0

${e.text}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}generateSummarizedNote(e,t){let n=Ee(this.settings.timezone,this.settings.dateFormat);return`---
type: ocr
source_file: "${e.sourceFile}"
source_type: ${e.sourceType}
title: "${t.title}"
pages: ${e.pages}
ocr_at: ${n}
---

# ${t.title}

## \uC694\uC57D
${t.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${t.keyPoints.map(i=>`- ${i}`).join(`
`)}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}arrayBufferToBase64(e){let t="",n=new Uint8Array(e);for(let i=0;i<n.byteLength;i++)t+=String.fromCharCode(n[i]);return btoa(t)}getMimeType(e){return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/webp",gif:"image/gif"}[e.toLowerCase()]||"image/png"}getDailyUsage(){return{...this.dailyUsage}}};var Kp=class{constructor(e,t){this.index=new Map;this.app=e,this.gemini=t}async buildIndex(){this.index.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e)try{let n=await this.indexNote(t);n&&this.index.set(t.path,n)}catch(n){console.error(`\uC778\uB371\uC2F1 \uC2E4\uD328: ${t.path}`,n)}console.log(`\uC778\uB371\uC2A4 \uAD6C\uCD95 \uC644\uB8CC: ${this.index.size}\uAC1C \uB178\uD2B8`)}async indexNote(e){let t=this.app.metadataCache.getFileCache(e),n=t==null?void 0:t.frontmatter,i=[];n!=null&&n.keywords&&(i=Array.isArray(n.keywords)?n.keywords:[n.keywords]);let o;if(n!=null&&n.targetType){let l=n.targetType;["project","library","archive"].includes(l)&&(o=l)}let r=(n==null?void 0:n.title)||e.basename,a=n==null?void 0:n.type;return{path:e.path,title:r,keywords:i,category:o,project:n==null?void 0:n.project,type:a}}async updateIndex(e){let t=await this.indexNote(e);t&&this.index.set(e.path,t)}removeFromIndex(e){this.index.delete(e)}async findRelated(e,t,n){let i=await this.gemini.extractKeywords(e);if(i.length===0)return[];let o=this.filterByKeywords(i,n);if(o.length===0)return[];let r=o.map((c,d)=>`${d}. ${c.note.title} (\uD0A4\uC6CC\uB4DC: ${c.note.keywords.join(", ")})`).join(`
`),a=await this.gemini.findRelatedNotes(t,i,r),l=[];for(let c of a)if(c.index>=0&&c.index<o.length){let d=o[c.index];l.push({note:d.note,relevance:c.relevance,matchedKeywords:d.matchedKeywords,reason:c.reason||"",connectionType:c.type||""})}return l}filterByKeywords(e,t){let n=[],i=new Set(e.map(o=>o.toLowerCase()));for(let[o,r]of this.index){if(t&&o===t||r.keywords.length===0)continue;let a=[];for(let l of r.keywords){let c=l.toLowerCase();for(let d of i)if(c===d||c.includes(d)||d.includes(c)){a.push(l);break}}a.length>0&&n.push({note:r,matchedKeywords:a})}return n.sort((o,r)=>r.matchedKeywords.length-o.matchedKeywords.length),n.slice(0,10)}async saveKeywordsToNote(e,t){let n=await this.app.vault.read(e),i=this.updateFrontmatterKeywords(n,t);await this.app.vault.modify(e,i),await this.updateIndex(e)}updateFrontmatterKeywords(e,t){let n=`keywords: [${t.map(o=>`"${o}"`).join(", ")}]`,i=e.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(i){let o=i[1];if(/^keywords:/m.test(o)){let r=o.replace(/^keywords:.*$/m,n);return e.replace(/^---\r?\n[\s\S]*?\r?\n---/,`---
${r}
---`)}else return e.replace(/^---\r?\n([\s\S]*?)\r?\n---/,`---
$1
${n}
---`)}else return`---
${n}
---

${e}`}async addRelatedLinks(e,t){if(t.length===0)return;let n=await this.app.vault.read(e),i=`

---
## \uAD00\uB828 \uB178\uD2B8
${t.map(a=>{let l=a.note.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]] (\uAD00\uB828\uB3C4: ${Math.round(a.relevance*100)}%)`}).join(`
`)}
`,o=/\n---\n##  \n[\s\S]*?(?=\n---\n|$)/,r;o.test(n)?r=n.replace(o,i):r=n+i,await this.app.vault.modify(e,r)}getIndexSize(){return this.index.size}getZettelIndex(){let e=new Map;for(let[t,n]of this.index)n.type==="zettel"&&e.set(t,n);return e}getZettelCount(){return this.getZettelIndex().size}async findRelatedZettels(e,t){if(e.length===0)return[];let n=this.getZettelIndex();if(n.size===0)return[];let i=this.filterZettelsByKeywords(e,n,t);if(i.length===0)return[];let o=i.map((l,c)=>`${c}. ${l.note.title} (\uD0A4\uC6CC\uB4DC: ${l.note.keywords.join(", ")})`).join(`
`),r=await this.gemini.findRelatedNotes("\uC0C8 ZK \uB178\uD2B8",e,o),a=[];for(let l of r)if(l.index>=0&&l.index<i.length){let c=i[l.index];a.push({note:c.note,relevance:l.relevance,matchedKeywords:c.matchedKeywords,reason:l.reason||"",connectionType:l.type||""})}return a}filterZettelsByKeywords(e,t,n){let i=[],o=new Set(e.map(r=>r.toLowerCase()));for(let[r,a]of t){if(n&&r===n||a.keywords.length===0)continue;let l=[];for(let c of a.keywords){let d=c.toLowerCase();for(let p of o)if(d===p||d.includes(p)||p.includes(d)){l.push(c);break}}l.length>0&&i.push({note:a,matchedKeywords:l})}return i.sort((r,a)=>a.matchedKeywords.length-r.matchedKeywords.length),i.slice(0,10)}};var Ba=require("obsidian");function RE(s,e=100){return s.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,e)}var Yp=class{constructor(e,t,n,i){this.projectMOCs=new Map;this.app=e,this.gemini=t,this.projectsFolder=n,this.settings=i}async scanProjectMOCs(){this.projectMOCs.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e){let n=await this.parseProjectMOC(t);n&&this.projectMOCs.set(n.project,n)}console.log(`\uD504\uB85C\uC81D\uD2B8 MOC \uC2A4\uCE94 \uC644\uB8CC: ${this.projectMOCs.size}\uAC1C`)}async parseProjectMOC(e){let t=this.app.metadataCache.getFileCache(e),n=t==null?void 0:t.frontmatter;if(!n||n.type!=="project-moc")return null;let i=n.project||e.basename,o=n.title||e.basename;return{path:e.path,title:o,project:i}}getProjectList(){let e=this.app.vault.getAbstractFileByPath(this.projectsFolder);return e instanceof Ba.TFolder?e.children.filter(t=>t instanceof Ba.TFolder).map(t=>t.name):[]}getMOCCount(){return this.projectMOCs.size}async detectProject(e,t){let n=this.getProjectList();return n.length===0?null:await this.gemini.detectProject(e,t,n)}async addNoteToMOC(e,t,n){let i=this.projectMOCs.get(e);if(!i)return!1;let o=this.app.vault.getAbstractFileByPath(i.path);if(!(o instanceof Ba.TFile))return!1;let r=await this.app.vault.read(o),a=this.app.vault.getAbstractFileByPath(n),c=`[[${a instanceof Ba.TFile?a.basename:RE(t)}]]`;if(r.includes(c))return!0;let d=/^##  \s*$/m,p;return d.test(r)?p=r.replace(/^(##  \s*\n)/m,`$1- ${c}
`):p=r.trimEnd()+`

## \uAD00\uB828 \uB178\uD2B8
- ${c}
`,await this.app.vault.modify(o,p),!0}async createProjectMOC(e,t){this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);let i=RE(e),o=`${t}/${i} MOC.md`;if(this.app.vault.getAbstractFileByPath(o))return null;let a=`---
type: project-moc
project: "${e}"
title: "${e} \uD504\uB85C\uC81D\uD2B8"
created: ${Ee(this.settings.timezone,this.settings.dateFormat)}
---

# ${e} \uD504\uB85C\uC81D\uD2B8

## \uAC1C\uC694


## \uC9C4\uD589 \uC911


## \uAD00\uB828 \uB178\uD2B8

`,l=await this.app.vault.create(o,a);return this.projectMOCs.set(e,{path:l.path,title:`${e} \uD504\uB85C\uC81D\uD2B8`,project:e}),l}hasProject(e){return this.projectMOCs.has(e)}getProjectMOCPath(e){let t=this.projectMOCs.get(e);return(t==null?void 0:t.path)||null}removeFromIndex(e){for(let[t,n]of this.projectMOCs)if(n.path===e){this.projectMOCs.delete(t);break}}};var Kv=require("obsidian");var Jp=class{constructor(e,t,n,i,o){this.app=e,this.relatedNoteFinder=t,this.zettelFolder=n,this.settings=i,this.gemini=o||null}get indexPath(){return`${this.zettelFolder}/ZK Index.md`}async updateIndex(e,t){let n=this.app.vault.getAbstractFileByPath(this.indexPath);n instanceof Kv.TFile?await this.addNoteToIndex(n,e,t):await this.createIndex(e,t)}async createIndex(e,t){let n=Ee(this.settings.timezone,this.settings.dateFormat),i=t[0]||"\uAE30\uD0C0",o=`---
type: zk-index
updated: ${n}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
- [[${e.basename}]]

## \uC8FC\uC81C\uBCC4
### ${i}
- [[${e.basename}]]
`;await this.app.vault.create(this.indexPath,o)}async addNoteToIndex(e,t,n){let i=await this.app.vault.read(e);i=this.updateRecentSection(i,t);let o=n[0]||"\uAE30\uD0C0";i=this.updateTopicSection(i,t,o),i=this.updateTimestamp(i),await this.app.vault.modify(e,i)}updateRecentSection(e,t){let n=/(##  \n)([\s\S]*?)(\n## |\n*$)/,i=e.match(n);if(i){let o=i[2].trim().split(`
`).filter(a=>a.startsWith("- ")),r=`- [[${t.basename}]]`;return o=o.filter(a=>!a.includes(t.basename)),o.unshift(r),o=o.slice(0,10),e.replace(n,`$1${o.join(`
`)}

$3`)}return e}updateTopicSection(e,t,n){let i=`### ${n}`,o=`- [[${t.basename}]]`;if(e.includes(i)){let r=new RegExp(`(### ${this.escapeRegex(n)}
)((?:- \\[\\[.*?\\]\\]
?)*)`),a=e.match(r);if(a)return a[2].includes(t.basename)?e:e.replace(r,`$1$2${o}
`)}else{let r=/(## \n)/;if(r.test(e))return e.replace(r,`$1${i}
${o}

`)}return e}updateTimestamp(e){let t=Ee(this.settings.timezone,this.settings.dateFormat);return e.replace(/^(---\n[\s\S]*?updated: ).*?(\n[\s\S]*?---)/,`$1${t}$2`)}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}async rebuildIndex(){let e=this.relatedNoteFinder.getZettelIndex();if(e.size===0)return;let t=new Map,n=[];for(let[,a]of e){let l=a.keywords[0]||"\uAE30\uD0C0";t.has(l)||t.set(l,[]),t.get(l).push(a);let c=a.path.match(/(\d{13})/),d=a.path.match(/(\d{8})-\d{3}/),p;if(c)p=new Date(parseInt(c[1]));else if(d){let g=d[1];p=new Date(parseInt(g.slice(0,4)),parseInt(g.slice(4,6))-1,parseInt(g.slice(6,8)))}else p=new Date;n.push({note:a,created:p})}n.sort((a,l)=>l.created.getTime()-a.created.getTime());let o=`---
type: zk-index
updated: ${Ee(this.settings.timezone,this.settings.dateFormat)}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
${n.slice(0,10).map(({note:a})=>{let l=a.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]]`}).join(`
`)}

## \uC8FC\uC81C\uBCC4
`;for(let[a,l]of t){let c=null;if(this.gemini&&l.length>=2)try{let d=l.map(p=>`- ${p.title} (\uD0A4\uC6CC\uB4DC: ${p.keywords.join(", ")})`).join(`
`);c=await this.gemini.generateTopicStructure(a,d)}catch(d){console.error(`\uC8FC\uC81C \uAD6C\uC870 \uC0DD\uC131 \uC2E4\uD328: ${a}`,d)}o+=`### ${a}
`,c!=null&&c.description&&(o+=`${c.description}

`),o+=`**\uD575\uC2EC \uB178\uD2B8:**
`;for(let d of l){let p=d.path.split("/"),g=p[p.length-1].replace(/\.md$/,""),m=c==null?void 0:c.notes.find(A=>A.title===d.title),y=m!=null&&m.role?` - ${m.role}`:"";if(o+=`- [[${g}]]${y}
`,m!=null&&m.relations&&m.relations.length>0)for(let A of m.relations){let _=A.type==="\uBC1C\uC804"?"\u2192":A.type==="\uAE30\uBC18"?"\u2190":"\u2194";o+=`  ${_} ${A.target}
`}}c!=null&&c.relatedTopics&&c.relatedTopics.length>0&&(o+=`
**\uAD00\uB828 \uC8FC\uC81C:** ${c.relatedTopics.join(", ")}
`),o+=`
`}let r=this.app.vault.getAbstractFileByPath(this.indexPath);r instanceof Kv.TFile&&await this.app.vault.delete(r),await this.app.vault.create(this.indexPath,o)}};var Ha=require("obsidian");var Xp=class{constructor(e,t,n){this.app=e,this.gemini=t,this.settings=n}async collectNotes(e){let t=e.customRange||za(e.period,this.settings.timezone),n=this.app.vault.getMarkdownFiles(),i=[];for(let o of n){if(this.shouldExclude(o,e))continue;let r=this.getProjectFromPath(o.path);if(e.projectFilter&&r!==e.projectFilter)continue;let a=await this.getNoteDate(o);if(!hw(a,t))continue;let l=await this.extractNoteInfo(o,r,a);i.push(l)}return i.sort((o,r)=>r.modified.getTime()-o.modified.getTime()),i}getBasename(e){let t=e.lastIndexOf("/");return(t>=0?e.substring(t+1):e).replace(/\.md$/,"")}shouldExclude(e,t){let n=[this.settings.archivesFolder,this.settings.zettelFolder],i=t.excludeFolders||n;for(let o of i)if(e.path.startsWith(o))return!0;return!!e.basename.includes("\uD68C\uACE0")}getProjectFromPath(e){let t=this.settings.projectsFolder+"/";if(e.startsWith(t)){let n=e.substring(t.length),i=n.indexOf("/");return i>0?n.substring(0,i):void 0}if(e.startsWith(this.settings.libraryFolder))return"Library";if(e.startsWith(this.settings.inboxFolder))return"Inbox"}async getNoteDate(e){let t=this.app.metadataCache.getFileCache(e),n=t==null?void 0:t.frontmatter;if(n!=null&&n.created){let i=new Date(n.created);if(!isNaN(i.getTime()))return i}return new Date(e.stat.mtime)}async extractNoteInfo(e,t,n){let i=this.app.metadataCache.getFileCache(e),o=i==null?void 0:i.frontmatter,r=[];return o!=null&&o.tags&&(Array.isArray(o.tags)?r.push(...o.tags):r.push(o.tags)),{path:e.path,title:(o==null?void 0:o.title)||e.basename,project:t,created:n,modified:new Date(e.stat.mtime),summary:o==null?void 0:o.summary,tags:r,type:o==null?void 0:o.type}}groupByProject(e){let t=new Map;for(let i of e){let o=i.project||"\uAE30\uD0C0";t.has(o)||t.set(o,[]),t.get(o).push(i)}let n=[];for(let[i,o]of t)n.push({projectName:i,notes:o,noteCount:o.length});return n.sort((i,o)=>o.noteCount-i.noteCount),n}async analyze(e){let t=e.customRange||za(e.period,this.settings.timezone),n=await this.collectNotes(e),i=this.groupByProject(n),o=n.filter(a=>a.type==="zettel").length,r=await this.gemini.analyzeReview(e.period,t,i);return{period:e.period,dateRange:t,totalNotes:n.length,newZKNotes:o,projectGroups:i,analysis:r}}async createReviewNote(e){let t=fw(e.period,new Date,this.settings.timezone),n=`${this.settings.archivesFolder}/Reviews`;await this.ensureFolder(n);let i=`${n}/${t}`,o=this.generateReviewContent(e),r=this.app.vault.getAbstractFileByPath(i);return r instanceof Ha.TFile?(await this.app.vault.modify(r,o),r):await this.app.vault.create(i,o)}async ensureFolder(e){this.app.vault.getAbstractFileByPath(e)instanceof Ha.TFolder||await this.app.vault.createFolder(e)}generateReviewContent(e){let t=new Date,n=rg(t,this.settings.timezone,this.settings.dateFormat),i=`${Vt(e.dateRange.start,this.settings.timezone)} ~ ${Vt(e.dateRange.end,this.settings.timezone)}`,o;switch(e.period){case"today":o=`${Vt(t,this.settings.timezone)} \uC77C\uC77C \uD68C\uACE0`;break;case"week":let l=cg(t);o=`${t.getFullYear()}\uB144 ${l}\uC8FC\uCC28 \uC8FC\uAC04 \uD68C\uACE0`;break;case"month":o=`${t.getFullYear()}\uB144 ${t.getMonth()+1}\uC6D4 \uC6D4\uAC04 \uD68C\uACE0`;break;default:o=`${i} \uD68C\uACE0`}let r=e.projectGroups.map(l=>{let c=l.notes.map(d=>`- [[${this.getBasename(d.path)}]]${d.summary?` - ${d.summary}`:""}`).join(`
`);return`### ${l.projectName} (${l.noteCount}\uAC1C)
${c}`}).join(`

`),a="";if(e.analysis){let{summary:l,mainTopics:c,insights:d,nextActions:p,patterns:g}=e.analysis;a=`
## \uBD84\uC11D \uACB0\uACFC

### \uC694\uC57D
${l}

### \uC8FC\uC694 \uC8FC\uC81C
${c.map(m=>`- ${m}`).join(`
`)}

### \uC778\uC0AC\uC774\uD2B8
${d.map(m=>`- ${m}`).join(`
`)}

### \uB2E4\uC74C \uC561\uC158
${p.map(m=>`- [ ] ${m}`).join(`
`)}
${g?`
### \uC791\uC5C5 \uD328\uD134
${g}`:""}`}return`---
type: review
period: ${e.period}
date_range: ${i}
created: ${n}
tags: [review, ${e.period==="today"?"daily":e.period==="week"?"weekly":"monthly"}]
---

# ${o}

## \uD1B5\uACC4
- \uC791\uC5C5\uD55C \uB178\uD2B8: ${e.totalNotes}\uAC1C
- \uC0C8 ZK \uB178\uD2B8: ${e.newZKNotes}\uAC1C
- \uD65C\uC131 \uD504\uB85C\uC81D\uD2B8: ${e.projectGroups.filter(l=>l.projectName!=="\uAE30\uD0C0"&&l.projectName!=="Library"&&l.projectName!=="Inbox").length}\uAC1C

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5

${r}
${a}
`}getProjectList(){let e=new Set,t=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(t instanceof Ha.TFolder)for(let n of t.children)n instanceof Ha.TFolder&&e.add(n.name);return Array.from(e).sort()}};var Yv=["mp3","wav","m4a","aac","ogg","flac","webm"],wP=2*1024*1024*1024,Zp=class{constructor(e,t,n){this.app=e,this.gemini=t,this.settings=n}isAudioFile(e){return Yv.includes(e.extension.toLowerCase())}getMimeType(e){return{mp3:"audio/mp3",wav:"audio/wav",m4a:"audio/m4a",aac:"audio/aac",ogg:"audio/ogg",flac:"audio/flac",webm:"audio/webm"}[e.toLowerCase()]||"audio/mp3"}async fileToBlob(e,t){let n=await this.app.vault.readBinary(e);return new Blob([n],{type:t})}async processAudio(e){if(e.stat.size>wP)throw new Error("\uD30C\uC77C \uD06C\uAE30\uAC00 2GB\uB97C \uCD08\uACFC\uD569\uB2C8\uB2E4");let t=e.extension.toLowerCase(),n=this.getMimeType(t),i=await this.fileToBlob(e,n);return await this.gemini.analyzeMeeting(i,n,e.name)}generateMarkdownNote(e){let t=Ee(this.settings.timezone,this.settings.dateFormat),n=e.actionItems.length>0?e.actionItems.map(r=>{let a=`- [ ] ${r.task}`;return r.assignee&&(a+=` - @${r.assignee}`),r.deadline&&(a+=` (\uAE30\uD55C: ${r.deadline})`),a}).join(`
`):"- (\uC5C6\uC74C)",i=e.decisions.length>0?e.decisions.map(r=>`- ${r}`).join(`
`):"- (\uC5C6\uC74C)",o=e.nextAgenda.length>0?e.nextAgenda.map(r=>`- ${r}`).join(`
`):"- (\uC5C6\uC74C)";return`---
type: meeting
source_file: "${e.sourceFile}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}

## \uC694\uC57D
${e.summary}

## \uC561\uC158 \uC544\uC774\uD15C
${n}

## \uACB0\uC815\uC0AC\uD56D
${i}

## \uB2E4\uC74C \uD68C\uC758 \uC548\uAC74
${o}

---

<details>
<summary>\uC804\uCCB4 \uB179\uCDE8\uB85D</summary>

${e.transcription}

</details>

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}};var jp=require("obsidian");var Qp=class{constructor(e,t){this.app=e,this.settings=t}async saveToDaily(e){let t=new Map;for(let i of e)t.has(i.date)||t.set(i.date,[]),t.get(i.date).push(i);let n=0;for(let[i,o]of t)await this.appendToDaily(i,o),n+=o.length;return n}async appendToDaily(e,t){let n=this.settings.dailyNotesFolder,i=`${n}/${e}.md`;await this.ensureFolder(n);let o=t.map(a=>this.formatTask(a)).join(`
`),r=this.app.vault.getAbstractFileByPath(i);if(r instanceof jp.TFile){let a=await this.app.vault.read(r),l=this.appendSchedulesToContent(a,o);await this.app.vault.modify(r,l)}else{let a=this.createDailyNoteContent(e,o);await this.app.vault.create(i,a)}}formatTask(e){let t=e.time?`${e.time} `:"",n=e.type==="event"?"\u{1F4C5}":"\u{1F4CB}";return`- [ ] ${t}${e.title} ${n} ${e.date}`}appendSchedulesToContent(e,t){let n="## \uC77C\uC815";if(e.includes(n)){let o=e.indexOf(n),r=e.indexOf(`
## `,o+1);return r>0?e.substring(0,r)+t+`

`+e.substring(r):e+`
`+t}let i=e.indexOf("---",3);if(i>0){let o=e.indexOf(`
`,i)+1;return e.substring(0,o)+`
## \uC77C\uC815
`+t+`
`+e.substring(o)}return`## \uC77C\uC815
`+t+`

`+e}createDailyNoteContent(e,t){return`---
type: daily
date: ${e}
created: ${pn(this.settings.timezone)}
---

# ${e}

## \uC77C\uC815
${t}

## \uBA54\uBAA8

`}async ensureFolder(e){if(!(this.app.vault.getAbstractFileByPath(e)instanceof jp.TFolder))try{await this.app.vault.createFolder(e)}catch(n){}}getToday(){return pn(this.settings.timezone)}};var eg=class{constructor(e,t){this.gemini=e,this.settings=t}extractVideoId(e){let t=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/|youtube\.com\/shorts\/)([a-zA-Z0-9_-]{11})/,/^([a-zA-Z0-9_-]{11})$/];for(let n of t){let i=e.match(n);if(i)return i[1]}return null}isValidYouTubeUrl(e){return this.extractVideoId(e)!==null}async processVideo(e){let t=this.extractVideoId(e);if(!t)throw new Error("\uC720\uD6A8\uD55C YouTube URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let n=`https://www.youtube.com/watch?v=${t}`;console.log("Gemini \uB124\uC774\uD2F0\uBE0C YouTube \uBD84\uC11D \uC2DC\uC791:",n);let i=await this.gemini.analyzeYouTube(n);return{videoId:t,url:n,title:i.title,summary:i.summary,keyPoints:i.keyPoints}}generateMarkdownNote(e){let t=Ee(this.settings.timezone,this.settings.dateFormat),n=`https://www.youtube.com/embed/${e.videoId}`;return`---
type: youtube
source: "${e.url}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}

<div style="resize: both; overflow: hidden; width: 100%; height: 400px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${n}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none;" allowfullscreen></iframe>
</div>

## \uC694\uC57D
${e.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${e.keyPoints.map(i=>`- ${i}`).join(`
`)}
`}};var zu=require("obsidian");var tg=class{constructor(e,t){this.gemini=e,this.settings=t}isValidUrl(e){try{let t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch(t){return!1}}extractMetadata(e,t){let n=l=>{let c=[new RegExp(`<meta[^>]*property=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*property=["']${l}["']`,"i"),new RegExp(`<meta[^>]*name=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*name=["']${l}["']`,"i")];for(let d of c){let p=e.match(d);if(p)return p[1]}return""},i=e.match(/<title[^>]*>([^<]+)<\/title>/i),o=e.match(/<link[^>]*rel=["'](?:shortcut )?icon["'][^>]*href=["']([^"']+)["']/i),r=new URL(t),a=l=>l?l.startsWith("http")?l:l.startsWith("//")?r.protocol+l:l.startsWith("/")?r.origin+l:r.origin+"/"+l:"";return{title:n("og:title")||n("twitter:title")||(i==null?void 0:i[1])||"",description:n("og:description")||n("twitter:description")||n("description")||"",image:a(n("og:image")||n("twitter:image")||""),siteName:n("og:site_name")||r.hostname,favicon:a((o==null?void 0:o[1])||"/favicon.ico")}}extractContent(e){let t=e.match(/<title[^>]*>([^<]+)<\/title>/i),n=e.match(/<meta[^>]*property=["']og:title["'][^>]*content=["']([^"']+)["']/i),i=(n==null?void 0:n[1])||(t==null?void 0:t[1])||"Untitled",o=e.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<nav[^>]*>[\s\S]*?<\/nav>/gi,"").replace(/<header[^>]*>[\s\S]*?<\/header>/gi,"").replace(/<footer[^>]*>[\s\S]*?<\/footer>/gi,"").replace(/<aside[^>]*>[\s\S]*?<\/aside>/gi,""),r="",a=o.match(/<article[^>]*>([\s\S]*?)<\/article>/i),l=o.match(/<main[^>]*>([\s\S]*?)<\/main>/i),c=o.match(/<div[^>]*(?:class|id)=["'][^"']*content[^"']*["'][^>]*>([\s\S]*?)<\/div>/i);if(a)r=a[1];else if(l)r=l[1];else if(c)r=c[1];else{let p=o.match(/<body[^>]*>([\s\S]*?)<\/body>/i);r=(p==null?void 0:p[1])||o}return r=r.replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&[a-z]+;/gi," ").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim(),{title:i.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim(),content:r}}async fetchWithJinaReader(e){var c,d;let t=`https://r.jina.ai/${e}`,i=(await(0,zu.requestUrl)({url:t,method:"GET",headers:{Accept:"text/plain","X-Timeout":"30","X-Wait-For-Selector":"article, .post-content, .se-main-container, #postViewArea"}})).text;i.includes("Warning: This page maybe not yet fully loaded")&&console.log("Jina Reader: \uD398\uC774\uC9C0 \uB85C\uB529 \uACBD\uACE0 \uAC10\uC9C0");let o=i.split(`
`),r="Untitled",a=0;for((c=o[0])!=null&&c.startsWith("# ")?(r=o[0].substring(2).trim(),a=1):(d=o[0])!=null&&d.startsWith("Title: ")&&(r=o[0].substring(7).trim(),a=1);a<o.length;){let p=o[a];if(p!=null&&p.startsWith("URL Source:")||p!=null&&p.startsWith("http")||p!=null&&p.startsWith("Warning:")||p!=null&&p.startsWith("Markdown Content:")||(p==null?void 0:p.trim())==="")a++;else break}let l=o.slice(a).join(`
`).trim();if(l.length<100&&!l.includes(`
`))throw new Error("\uD398\uC774\uC9C0 \uCF58\uD150\uCE20\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4 (JavaScript \uB85C\uB529 \uB300\uAE30 \uC2E4\uD328)");return{title:r,content:l}}async fetchNaverBlog(e){var p;let t=e;if(e.includes("blog.naver.com")){let g=e.match(/blog\.naver\.com\/([^\/]+)\/(\d+)/);g&&(t=`https://m.blog.naver.com/${g[1]}/${g[2]}`)}let i=(await(0,zu.requestUrl)({url:t,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15",Accept:"text/html,application/xhtml+xml","Accept-Language":"ko-KR,ko;q=0.9"}})).text,o=i.match(/<title[^>]*>([^<]+)<\/title>/i),r=((p=o==null?void 0:o[1])==null?void 0:p.replace(/ :  $/,"").trim())||"Untitled",a="",l=i.match(/<div[^>]*class="[^"]*se-main-container[^"]*"[^>]*>([\s\S]*?)<\/div>\s*<\/div>\s*<\/div>/i),c=i.match(/<div[^>]*id="postViewArea"[^>]*>([\s\S]*?)<\/div>/i),d=(l==null?void 0:l[1])||(c==null?void 0:c[1])||"";return d&&(a=d.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim()),{title:r,content:a}}async processUrl(e){if(!this.isValidUrl(e))throw new Error("\uC720\uD6A8\uD55C URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let t;try{let o=(await(0,zu.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text;t=this.extractMetadata(o,e)}catch(i){console.log("\uBA54\uD0C0\uB370\uC774\uD130 \uCD94\uCD9C \uC2E4\uD328:",i)}if(e.includes("blog.naver.com"))return console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, Jina Reader \uC0AC\uC6A9"),await this.processUrlFallback(e,t);try{console.log("URL Context Tool\uB85C \uC6F9\uD398\uC774\uC9C0 \uBD84\uC11D \uC2DC\uB3C4");let i=await this.gemini.analyzeWebpage(e),o=["unable to access","cannot access","could not access","\uC811\uADFC\uD560 \uC218 \uC5C6","\uAC00\uC838\uC62C \uC218 \uC5C6"],r=i.summary.toLowerCase();return o.some(l=>r.includes(l.toLowerCase()))?(console.log("URL Context Tool \uC811\uADFC \uC2E4\uD328 \uAC10\uC9C0, \uD3F4\uBC31 \uC2DC\uB3C4"),await this.processUrlFallback(e,t)):(t&&(t.title=t.title||i.title),{url:e,title:i.title,content:"",summary:i.summary,keyPoints:i.keyPoints,metadata:t})}catch(i){console.log("URL Context Tool \uC2E4\uD328, \uD3F4\uBC31 \uC2DC\uB3C4:",i)}return await this.processUrlFallback(e,t)}async processUrlFallback(e,t){let n,i,o=null;if(!t)try{o=(await(0,zu.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text,t=this.extractMetadata(o,e)}catch(d){console.log("HTML \uAC00\uC838\uC624\uAE30 \uC2E4\uD328:",d)}if(e.includes("blog.naver.com")){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, \uC804\uC6A9 \uCD94\uCD9C \uC2DC\uB3C4");try{let d=await this.fetchNaverBlog(e);if(n=d.title,i=d.content,i.length<100)throw new Error("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uCD94\uCD9C \uC2E4\uD328")}catch(d){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uC804\uC6A9 \uCD94\uCD9C \uC2E4\uD328, Jina Reader \uC2DC\uB3C4:",d);let p=await this.fetchWithJinaReader(e);n=p.title,i=p.content}}else try{console.log("Jina Reader\uB85C \uCF58\uD150\uCE20 \uCD94\uCD9C \uC2DC\uB3C4");let d=await this.fetchWithJinaReader(e);n=d.title,i=d.content}catch(d){if(console.log("Jina Reader \uC2E4\uD328, \uC9C1\uC811 \uCD94\uCD9C\uB85C \uD3F4\uBC31:",d),o){let p=this.extractContent(o);n=p.title,i=p.content}else throw new Error("\uC6F9\uD398\uC774\uC9C0\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4")}if(i.length<50)throw new Error("\uBCF8\uBB38\uC744 \uCD94\uCD9C\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC811\uADFC\uC774 \uC81C\uD55C\uB41C \uD398\uC774\uC9C0\uC77C \uC218 \uC788\uC2B5\uB2C8\uB2E4.");let a=5e4,l=i.length>a?i.slice(0,a)+"...":i,c=await this.gemini.summarizeContent(l,"webpage");return t&&(t.title=t.title||n),{url:e,title:c.title||n,content:l,summary:c.summary,keyPoints:c.keyPoints,metadata:t}}generateMarkdownNote(e){let t=Ee(this.settings.timezone,this.settings.dateFormat),n=e.metadata,i=e.url;e.url.includes("blog.naver.com")&&!e.url.includes("m.blog.naver.com")&&(i=e.url.replace("blog.naver.com","m.blog.naver.com"));let o="";if(n){let r=n.image?`
> ![](${n.image})
>`:"",a=n.description?`
> ${n.description}
>`:"";o=`
> [!bookmark] ${n.siteName||new URL(e.url).hostname}
> **${n.title||e.title}**
>${a}${r}
> \u{1F517} ${e.url}

`}else o=`
> [!bookmark] \uC6F9\uD398\uC774\uC9C0
> **${e.title}**
>
> \u{1F517} ${e.url}

`;return`---
type: webpage
source: "${e.url}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}
${o}
<div style="resize: both; overflow: hidden; width: 100%; height: 600px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${i}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none; color-scheme: light;"></iframe>
</div>

## \uC694\uC57D
${e.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${e.keyPoints.map(r=>`- ${r}`).join(`
`)}
`}};var _i=require("obsidian"),AP="YOUR_CLIENT_ID.apps.googleusercontent.com",_P="YOUR_CLIENT_SECRET",PE="http://127.0.0.1:42813/callback",TP="https://accounts.google.com/o/oauth2/v2/auth",ME="https://oauth2.googleapis.com/token",EP="https://www.googleapis.com/calendar/v3",CP="https://www.googleapis.com/auth/calendar.events",Wu=class{constructor(e,t,n){this.authServer=null;this.app=e,this.settings=t,this.saveSettings=n}isConnected(){return!!this.settings.googleRefreshToken}getClientId(){return this.settings.useOwnApiKey?this.settings.googleClientId:AP}getClientSecret(){return this.settings.useOwnApiKey?this.settings.googleClientSecret:_P}async startOAuth(){let e=this.getClientId();if(!e||e==="YOUR_CLIENT_ID.apps.googleusercontent.com"){new _i.Notice(`Google Calendar Client ID\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.
\uC124\uC815\uC5D0\uC11C Advanced \uBAA8\uB4DC\uB85C \uC9C1\uC811 Client ID\uB97C \uC785\uB825\uD558\uAC70\uB098,
\uD50C\uB7EC\uADF8\uC778 \uC5C5\uB370\uC774\uD2B8\uB97C \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.`,1e4);return}let t=new URLSearchParams({client_id:e,redirect_uri:PE,response_type:"code",scope:CP,access_type:"offline",prompt:"consent"}),n=`${TP}?${t.toString()}`;try{let i=await this.startAuthServer();await this.exchangeCodeForTokens(i),new _i.Notice("Google Calendar \uC5F0\uACB0 \uC644\uB8CC!")}catch(i){console.error("OAuth \uC5D0\uB7EC:",i),new _i.Notice("Google Calendar \uC5F0\uACB0 \uC2E4\uD328: "+i.message)}window.open(n,"_blank")}startAuthServer(){return new Promise((e,t)=>{let n=require("http"),i=setTimeout(()=>{this.stopAuthServer(),t(new Error("\uC778\uC99D \uC2DC\uAC04 \uCD08\uACFC (5\uBD84)"))},5*60*1e3);this.authServer=n.createServer((o,r)=>{let a=new URL(o.url||"","http://127.0.0.1:42813");if(a.pathname==="/callback"){let l=a.searchParams.get("code"),c=a.searchParams.get("error");if(c){r.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),r.end(`
							<html><body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
								<h1>\uC5F0\uACB0 \uC2E4\uD328</h1>
								<p>Google Calendar \uC5F0\uACB0\uC774 \uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p>
								<p>\uC774 \uCC3D\uC744 \uB2EB\uC544\uB3C4 \uB429\uB2C8\uB2E4.</p>
							</body></html>
						`),clearTimeout(i),this.stopAuthServer(),t(new Error(c));return}if(l){r.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),r.end(`
							<html><body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
								<h1>\uC5F0\uACB0 \uC644\uB8CC!</h1>
								<p>Google Calendar\uAC00 \uC5F0\uACB0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p>
								<p>\uC774 \uCC3D\uC744 \uB2EB\uACE0 Obsidian\uC73C\uB85C \uB3CC\uC544\uAC00\uC138\uC694.</p>
							</body></html>
						`),clearTimeout(i),this.stopAuthServer(),e(l);return}}r.writeHead(404),r.end("Not Found")}),this.authServer.listen(42813,"127.0.0.1",()=>{console.log("OAuth \uCF5C\uBC31 \uC11C\uBC84 \uC2DC\uC791: http://127.0.0.1:42813")}),this.authServer.on("error",o=>{clearTimeout(i),t(new Error(`\uC11C\uBC84 \uC2DC\uC791 \uC2E4\uD328: ${o.message}`))})})}stopAuthServer(){this.authServer&&(this.authServer.close(),this.authServer=null)}async exchangeCodeForTokens(e){let n=(await(0,_i.requestUrl)({url:ME,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:this.getClientId(),client_secret:this.getClientSecret(),code:e,grant_type:"authorization_code",redirect_uri:PE}).toString()})).json;if(n.error)throw new Error(n.error_description||n.error);this.settings.googleAccessToken=n.access_token,n.refresh_token&&(this.settings.googleRefreshToken=n.refresh_token),this.settings.googleTokenExpiry=Date.now()+n.expires_in*1e3,await this.saveSettings()}async refreshAccessToken(){if(!this.settings.googleRefreshToken)throw new Error("Refresh token\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC5F0\uACB0\uD574\uC8FC\uC138\uC694.");let t=(await(0,_i.requestUrl)({url:ME,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:this.getClientId(),client_secret:this.getClientSecret(),refresh_token:this.settings.googleRefreshToken,grant_type:"refresh_token"}).toString()})).json;if(t.error)throw t.error==="invalid_grant"?(this.settings.googleRefreshToken="",await this.saveSettings(),new Error("Google \uC5F0\uACB0\uC774 \uB9CC\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC5F0\uACB0\uD574\uC8FC\uC138\uC694.")):new Error(t.error_description||t.error);this.settings.googleAccessToken=t.access_token,this.settings.googleTokenExpiry=Date.now()+t.expires_in*1e3,await this.saveSettings()}async ensureValidToken(){Date.now()>this.settings.googleTokenExpiry-5*60*1e3&&await this.refreshAccessToken()}async createEvent(e){var r;if(!this.isConnected())throw new Error("Google Calendar\uAC00 \uC5F0\uACB0\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");await this.ensureValidToken();let t,n;if(e.time){let a=`${e.date}T${e.time}:00`,l=this.addHour(e.time),c=`${e.date}T${l}:00`;t={dateTime:a,timeZone:this.resolveTimezone()},n={dateTime:c,timeZone:this.resolveTimezone()}}else t={date:e.date},n={date:this.getNextDay(e.date)};let i={summary:e.title,start:t,end:n},o=await(0,_i.requestUrl)({url:`${EP}/calendars/primary/events`,method:"POST",headers:{Authorization:`Bearer ${this.settings.googleAccessToken}`,"Content-Type":"application/json"},body:JSON.stringify(i)});if(o.status>=400){let a=o.json;throw new Error(((r=a.error)==null?void 0:r.message)||"\uC774\uBCA4\uD2B8 \uC0DD\uC131 \uC2E4\uD328")}}async saveSchedules(e){let t=0;for(let n of e)try{await this.createEvent(n),t++}catch(i){console.error("\uC77C\uC815 \uC800\uC7A5 \uC2E4\uD328:",n.title,i)}return t}addHour(e){let[t,n]=e.split(":").map(Number),i=(t+1)%24;return`${String(i).padStart(2,"0")}:${String(n).padStart(2,"0")}`}getNextDay(e){let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}resolveTimezone(){return this.settings.timezone==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:this.settings.timezone}async disconnect(){this.settings.googleAccessToken="",this.settings.googleRefreshToken="",this.settings.googleTokenExpiry=0,await this.saveSettings(),new _i.Notice("Google Calendar \uC5F0\uACB0\uC774 \uD574\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}};var NE=require("obsidian"),ng=class extends NE.Modal{constructor(t,n,i){super(t);this.resolvePromise=null;this.schedules=n,this.settings=i,this.selected=new Set(n.map((o,r)=>r)),this.saveToDaily=!0,this.saveToGoogle=i.googleCalendarEnabled&&!!i.googleRefreshToken}async openAndWait(){return new Promise(t=>{this.resolvePromise=t,this.open()})}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-schedule-modal"),t.createEl("h2",{text:"\uAC10\uC9C0\uB41C \uC77C\uC815"}),t.createEl("p",{text:`${this.schedules.length}\uAC1C\uC758 \uC77C\uC815\uC774 \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uC800\uC7A5\uD560 \uC77C\uC815\uC744 \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let n=t.createDiv({cls:"schedule-list"});n.style.maxHeight="300px",n.style.overflowY="auto",n.style.marginBottom="16px",this.schedules.forEach((y,A)=>{let _=n.createDiv({cls:"schedule-item"});_.style.display="flex",_.style.alignItems="center",_.style.padding="10px 12px",_.style.marginBottom="8px",_.style.border="1px solid var(--background-modifier-border)",_.style.borderRadius="8px",_.style.gap="12px";let E=_.createEl("input",{type:"checkbox",attr:{checked:!0}});E.style.flexShrink="0",E.addEventListener("change",()=>{E.checked?this.selected.add(A):this.selected.delete(A),this.updateSaveButton()});let C=_.createDiv({cls:"schedule-info"});C.style.flex="1",C.style.minWidth="0";let S=C.createEl("div",{text:y.title});S.style.fontWeight="500",S.style.overflow="hidden",S.style.textOverflow="ellipsis",S.style.whiteSpace="nowrap";let b=C.createEl("div");b.style.fontSize="12px",b.style.color="var(--text-muted)";let x=y.type==="event"?"\uC57D\uC18D":"\uD560\uC77C",P=y.type==="event"?"\u{1F4C5}":"\u{1F4CB}",I=y.time||"\uC885\uC77C";b.setText(`${P} ${x} | ${y.date} ${I}`)});let i=t.createDiv({cls:"schedule-destinations"});i.style.padding="12px",i.style.backgroundColor="var(--background-secondary)",i.style.borderRadius="8px",i.style.marginBottom="16px",i.createEl("div",{text:"\uC800\uC7A5 \uC704\uCE58"}).style.fontWeight="500";let o=i.createDiv({cls:"destination-option"});o.style.display="flex",o.style.alignItems="center",o.style.gap="8px",o.style.marginTop="8px";let r=o.createEl("input",{type:"checkbox",attr:{checked:!0}});r.id="save-to-daily",r.addEventListener("change",()=>{this.saveToDaily=r.checked});let a=o.createEl("label",{text:`Daily Notes (${this.settings.dailyNotesFolder}/)`,attr:{for:"save-to-daily"}});a.style.cursor="pointer";let l=i.createDiv({cls:"destination-option"});l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginTop="8px";let c=l.createEl("input",{type:"checkbox",attr:{checked:this.saveToGoogle,disabled:!this.settings.googleCalendarEnabled||!this.settings.googleRefreshToken}});c.id="save-to-google",c.addEventListener("change",()=>{this.saveToGoogle=c.checked});let d=l.createEl("label",{attr:{for:"save-to-google"}});d.style.cursor="pointer",this.settings.googleCalendarEnabled&&this.settings.googleRefreshToken?d.setText("Google Calendar (\uC5F0\uACB0\uB428)"):this.settings.googleCalendarEnabled?(d.setText("Google Calendar (\uC5F0\uACB0 \uD544\uC694)"),d.style.color="var(--text-muted)"):(d.setText("Google Calendar (\uBE44\uD65C\uC131\uD654)"),d.style.color="var(--text-muted)");let p=t.createDiv({cls:"modal-button-container"});p.style.display="flex",p.style.justifyContent="flex-end",p.style.gap="8px",p.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>{this.close(),this.resolvePromise&&this.resolvePromise(null)});let m=p.createEl("button",{text:`${this.selected.size}\uAC1C \uC800\uC7A5`,cls:"mod-cta"});m.id="save-schedule-btn",m.addEventListener("click",()=>{let y=this.schedules.filter((A,_)=>this.selected.has(_));this.close(),this.resolvePromise&&this.resolvePromise({selectedSchedules:y,saveToDaily:this.saveToDaily,saveToGoogle:this.saveToGoogle})})}updateSaveButton(){let t=this.contentEl.querySelector("#save-schedule-btn");t&&t.setText(`${this.selected.size}\uAC1C \uC800\uC7A5`)}onClose(){this.contentEl.empty()}};function Ku(s,e=100){return s.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,e)}var ig=class extends R.Plugin{constructor(){super(...arguments);this.gemini=null;this.ocrProcessor=null;this.relatedNoteFinder=null;this.mocManager=null;this.zkIndexManager=null;this.youtubeExtractor=null;this.webPageExtractor=null;this.reviewManager=null;this.meetingProcessor=null;this.scheduleManager=null;this.googleCalendar=null;this.watcherRegistered=!1;this.pendingFiles=new Map;this.zkDailyCounter=new Map;this.zkLuhmannCounter=0}async onload(){await this.loadSettings(),this.addSettingTab(new Zu(this.app,this)),this.processDebounced=(0,R.debounce)(()=>this.processPendingFiles(),3e3,!0),this.registerCommands(),this.settings.autoWatch&&this.startWatcher(),this.app.workspace.onLayoutReady(()=>{this.initGemini()}),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uB85C\uB4DC\uB428")}onunload(){this.stopWatcher(),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uC5B8\uB85C\uB4DC\uB428")}async loadSettings(){this.settings=Object.assign({},aw,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.initGemini()}async initGemini(){this.settings.geminiApiKey?(this.gemini=new $d(this.settings.geminiApiKey),this.ocrProcessor=new Wp(this.gemini,this.settings,this.app.vault),this.relatedNoteFinder=new Kp(this.app,this.gemini),this.mocManager=new Yp(this.app,this.gemini,this.settings.projectsFolder,this.settings),this.zkIndexManager=new Jp(this.app,this.relatedNoteFinder,this.settings.zettelFolder,this.settings,this.gemini),this.youtubeExtractor=new eg(this.gemini,this.settings),this.webPageExtractor=new tg(this.gemini,this.settings),this.reviewManager=new Xp(this.app,this.gemini,this.settings),this.meetingProcessor=new Zp(this.app,this.gemini,this.settings),this.scheduleManager=new Qp(this.app,this.settings),this.googleCalendar=new Wu(this.app,this.settings,()=>this.saveSettings()),Promise.all([this.relatedNoteFinder.buildIndex(),this.mocManager.scanProjectMOCs()]).then(()=>{var t,n,i;console.log(`\uB178\uD2B8 \uC778\uB371\uC2A4: ${(t=this.relatedNoteFinder)==null?void 0:t.getIndexSize()}\uAC1C, MOC: ${(n=this.mocManager)==null?void 0:n.getMOCCount()}\uAC1C, ZK: ${(i=this.relatedNoteFinder)==null?void 0:i.getZettelCount()}\uAC1C`),this.initializeZKCounters()})):(this.gemini=null,this.ocrProcessor=null,this.relatedNoteFinder=null,this.mocManager=null,this.youtubeExtractor=null,this.webPageExtractor=null,this.reviewManager=null,this.scheduleManager=null,this.googleCalendar=null)}checkApiKey(){return this.gemini?!0:(new R.Notice("Gemini API \uD0A4\uB97C \uC124\uC815\uD574\uC8FC\uC138\uC694"),!1)}truncateContent(t,n=5e5){let i=t.replace(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g,"[\uC774\uBBF8\uC9C0]");return i=i.replace(/!\[[^\]]*\]\(data:[^)]+\)/g,"[\uC774\uBBF8\uC9C0]"),i.length<=n?i:i.slice(0,n)+`

[... \uB0B4\uC6A9\uC774 \uB108\uBB34 \uAE38\uC5B4 \uC77C\uBD80\uB9CC \uBD84\uC11D\uB428 ...]`}registerCommands(){this.addCommand({id:"project-classify",name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkeys:[{modifiers:["Ctrl","Shift"],key:"g"}],callback:()=>this.classifyCurrentFile()}),this.addCommand({id:"zk-extract",name:"ZK \uCD94\uCD9C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"z"}],callback:()=>this.extractZKFromCurrentFile()}),this.addCommand({id:"focus-top3",name:"Focus Top 3",hotkeys:[{modifiers:["Ctrl","Shift"],key:";"}],callback:()=>this.showFocusTop3()}),this.addCommand({id:"process-inbox",name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",callback:()=>this.processInbox()}),this.addCommand({id:"toggle-watch",name:"Watch \uD1A0\uAE00",callback:()=>this.toggleWatch()}),this.addCommand({id:"ocr-extract",name:"OCR \uCD94\uCD9C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"o"}],callback:()=>this.ocrCurrentFile()}),this.addCommand({id:"ocr-inbox",name:"Inbox OCR \uCC98\uB9AC",callback:()=>this.processInboxOCR()}),this.addCommand({id:"smart-process",name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkeys:[{modifiers:["Ctrl","Shift"],key:"s"}],callback:()=>this.smartProcessCurrentFile()}),this.addCommand({id:"create-moc",name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",callback:()=>this.showCreateMOCModal()}),this.addCommand({id:"url-import",name:"URL \uAC00\uC838\uC624\uAE30",hotkeys:[{modifiers:["Ctrl","Shift"],key:"u"}],callback:()=>this.showURLImportModal()}),this.addCommand({id:"rebuild-zk-index",name:"ZK Index \uC7AC\uAD6C\uCD95",callback:()=>this.rebuildZKIndex()}),this.addCommand({id:"smart-split",name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkeys:[{modifiers:["Ctrl","Shift"],key:"d"}],callback:()=>this.smartSplitCurrentFile()}),this.addCommand({id:"link-related-notes",name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkeys:[{modifiers:["Ctrl","Shift"],key:"l"}],callback:()=>this.linkRelatedNotesForCurrentFile()}),this.addCommand({id:"review-mode",name:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC",hotkeys:[{modifiers:["Ctrl","Shift"],key:"r"}],callback:()=>this.showReviewModal()}),this.addCommand({id:"show-command-list",name:"\uBA85\uB839 \uB9AC\uC2A4\uD2B8",callback:()=>this.showCommandListModal()}),this.addRibbonIcon("brain","Zero Friction Brain",()=>{this.showCommandListModal()})}showReviewModal(){if(this.checkApiKey()){if(!this.reviewManager){new R.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new ow(this.app,this.reviewManager,this.settings).open()}}async connectGoogleCalendar(){this.googleCalendar||(this.googleCalendar=new Wu(this.app,this.settings,()=>this.saveSettings())),await this.googleCalendar.startOAuth()}async disconnectGoogleCalendar(){this.googleCalendar&&await this.googleCalendar.disconnect()}async detectAndSaveSchedules(t){if(this.settings.scheduleDetectionEnabled&&!(!this.gemini||!this.scheduleManager))try{let n=pn(this.settings.timezone),i=await this.gemini.detectSchedules(t,n);if(i.length===0)return;let r=await new ng(this.app,i,this.settings).openAndWait();if(!r||r.selectedSchedules.length===0)return;let a=0,l=0;r.saveToDaily&&(a=await this.scheduleManager.saveToDaily(r.selectedSchedules)),r.saveToGoogle&&this.googleCalendar&&this.googleCalendar.isConnected()&&(l=await this.googleCalendar.saveSchedules(r.selectedSchedules));let c=[];a>0&&c.push(`Daily Notes: ${a}\uAC1C`),l>0&&c.push(`Google Calendar: ${l}\uAC1C`),c.length>0&&new R.Notice(`\uC77C\uC815 \uC800\uC7A5\uB428
${c.join(", ")}`)}catch(n){console.error("\uC77C\uC815 \uAC10\uC9C0 \uC2E4\uD328:",n)}}async rebuildZKIndex(){var t;if(!this.zkIndexManager){new R.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new R.Notice("ZK Index \uC7AC\uAD6C\uCD95 \uC911...");try{await this.zkIndexManager.rebuildIndex();let n=((t=this.relatedNoteFinder)==null?void 0:t.getZettelCount())||0;new R.Notice(`ZK Index \uC7AC\uAD6C\uCD95 \uC644\uB8CC: ${n}\uAC1C \uB178\uD2B8`)}catch(n){console.error("ZK Index \uC7AC\uAD6C\uCD95 \uC2E4\uD328:",n),new R.Notice(`\uC7AC\uAD6C\uCD95 \uC2E4\uD328: ${n}`)}}async smartSplitCurrentFile(){var n;if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new R.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(t.extension!=="md"){new R.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uBD84\uB9AC\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4");return}new R.Notice("\uBA54\uBAA8 \uBD84\uC11D \uC911...");try{let i=await this.app.vault.read(t),o=((n=this.mocManager)==null?void 0:n.getProjectList())||[],r=await this.gemini.splitContent(i,o);if(r.length===0){new R.Notice("\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(r.length===1){new R.Notice("\uB2E8\uC77C \uC8FC\uC81C\uB85C \uD310\uB2E8\uB428. \uC77C\uBC18 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958\uB97C \uC0AC\uC6A9\uD558\uC138\uC694.");return}new nw(this.app,r,t,this).open()}catch(i){console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC2E4\uD328:",i),new R.Notice(`\uBD84\uB9AC \uC2E4\uD328: ${i}`)}}async createSplitNotes(t,n){let i=[];for(let r of t){let a=this.getTargetFolder(r.targetType,r.project);if(r.project&&!r.project.startsWith("NEW:")){let g=`${this.settings.projectsFolder}/${r.project}`;this.app.vault.getAbstractFileByPath(g)instanceof R.TFolder&&(a=g)}let l=Ku(r.title),c=`${a}/${l}.md`,d=`---
targetType: ${r.targetType}
keywords: [${r.keywords.join(", ")}]
source: "[[${n.basename}]]"
created: ${Ee(this.settings.timezone,this.settings.dateFormat)}
${r.project?`project: "${r.project}"`:""}
---

# ${r.title}

${r.content}
`;this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a);try{let g=await this.app.vault.create(c,d);if(i.push(r.title),this.relatedNoteFinder&&await this.relatedNoteFinder.updateIndex(g),r.project&&this.mocManager)if(r.project.startsWith("NEW:")){let m=r.project.slice(4).trim();await this.mocManager.createProjectMOC(m,this.settings.projectsFolder)&&await this.mocManager.addNoteToMOC(m,r.title,g.path)}else await this.mocManager.addNoteToMOC(r.project,r.title,g.path)}catch(g){console.error(`\uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328: ${r.title}`,g)}}let o=`${this.settings.archivesFolder}/${n.name}`;try{this.app.vault.getAbstractFileByPath(this.settings.archivesFolder)||await this.app.vault.createFolder(this.settings.archivesFolder),await this.app.fileManager.renameFile(n,o)}catch(r){console.error("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uC2E4\uD328:",r)}new R.Notice(`${i.length}\uAC1C \uB178\uD2B8 \uC0DD\uC131\uB428, \uC6D0\uBCF8\uC740 Archives\uB85C \uC774\uB3D9`)}showCreateMOCModal(){new ew(this.app,this.mocManager,this.settings.projectsFolder).open()}showURLImportModal(){this.checkApiKey()&&new tw(this.app,"URL \uAC00\uC838\uC624\uAE30","\uC720\uD29C\uBE0C \uB610\uB294 \uC6F9\uD398\uC774\uC9C0 URL\uC744 \uC785\uB825\uD558\uC138\uC694 (\uC790\uB3D9 \uAC10\uC9C0)","https://...",async t=>{await this.processURL(t)}).open()}async processURL(t){/(?:youtube\.com|youtu\.be)/.test(t)?await this.processYouTube(t):await this.processWebPage(t)}async processYouTube(t){var n;if(!(!this.youtubeExtractor||!this.gemini)){new R.Notice("\uC720\uD29C\uBE0C \uC601\uC0C1 \uBD84\uC11D \uC911...");try{let i=await this.youtubeExtractor.processVideo(t),o=this.youtubeExtractor.generateMarkdownNote(i),r=Ku(i.title),a=`${r}.md`,l=`${this.settings.inboxFolder}/${a}`,c=await this.app.vault.create(l,o);new R.Notice(`\uC720\uD29C\uBE0C \uB178\uD2B8 \uC0DD\uC131: ${r}`);let d=((n=this.mocManager)==null?void 0:n.getProjectList())||[],p=await this.gemini.classifyProject(o,d);c=await this.applyClassifyResultWithConfirmation(c,p),new R.Notice(`${p.targetType}${p.projectName?` (${p.projectName})`:""}\uB85C \uBD84\uB958\uB428`),this.app.workspace.getLeaf().openFile(c),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(c,o,p.title)}catch(i){console.error("\uC720\uD29C\uBE0C \uCC98\uB9AC \uC624\uB958:",i),new R.Notice(`\uC720\uD29C\uBE0C \uCC98\uB9AC \uC2E4\uD328: ${i}`)}}}async processWebPage(t){var n;if(!(!this.webPageExtractor||!this.gemini)){new R.Notice("\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38 \uCD94\uCD9C \uC911...");try{let i=await this.webPageExtractor.processUrl(t),o=this.webPageExtractor.generateMarkdownNote(i),r=Ku(i.title),a=`${r}.md`,l=`${this.settings.inboxFolder}/${a}`,c=await this.app.vault.create(l,o);new R.Notice(`\uC6F9\uD398\uC774\uC9C0 \uB178\uD2B8 \uC0DD\uC131: ${r}`);let d=((n=this.mocManager)==null?void 0:n.getProjectList())||[],p=await this.gemini.classifyProject(o,d);c=await this.applyClassifyResultWithConfirmation(c,p),new R.Notice(`${p.targetType}${p.projectName?` (${p.projectName})`:""}\uB85C \uBD84\uB958\uB428`),this.app.workspace.getLeaf().openFile(c),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(c,o,p.title)}catch(i){console.error("\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC624\uB958:",i),new R.Notice(`\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC2E4\uD328: ${i}`)}}}async classifyCurrentFile(){var o,r,a;if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new R.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase(),i=["pdf","png","jpg","jpeg","webp","gif"];if(Yv.includes(n)){if(!this.meetingProcessor){new R.Notice("\uD68C\uC758\uB85D \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}new R.Notice("\uD68C\uC758\uB85D \uBD84\uC11D \uC911...");try{let l=await this.meetingProcessor.processAudio(t),c=this.meetingProcessor.generateMarkdownNote(l),d=`\uD68C\uC758\uB85D_${Ku(l.title)}.md`,p=`${this.settings.inboxFolder}/${d}`,g=await this.app.vault.create(p,c);if(this.settings.ocrMoveOriginal){let _=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(_)||await this.app.vault.createFolder(_);let C=`${_}/${t.name}`;await this.app.fileManager.renameFile(t,C)}let m=((o=this.mocManager)==null?void 0:o.getProjectList())||[],y=await this.gemini.classifyProject(c,m),A=await this.applyClassifyResultWithConfirmation(g,y);new R.Notice(`\uD68C\uC758\uB85D \uC0DD\uC131 \uC644\uB8CC: ${y.targetType}${y.projectName?` (${y.projectName})`:""}`),await this.findAndShowRelatedNotes(A,c,l.title),await this.detectAndSaveSchedules(c)}catch(l){console.error("\uD68C\uC758\uB85D \uBD84\uC11D \uC624\uB958:",l),new R.Notice(`\uD68C\uC758\uB85D \uBD84\uC11D \uC2E4\uD328: ${l}`)}return}if(i.includes(n)){if(!this.settings.ocrEnabled){new R.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new R.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let l=await this.ocrProcessor.checkLimits(t);if(!l.allowed){new Yu(this.app,l.reason,t,this).open();return}new R.Notice("\uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let c=await this.ocrProcessor.processFile(t);new R.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let d=await this.gemini.summarizePDF(c.text),p=this.ocrProcessor.generateSummarizedNote(c,d),g=t.basename+"_OCR.md",m=`${this.settings.inboxFolder}/${g}`,y=await this.app.vault.create(m,p);if(this.settings.ocrMoveOriginal){let C=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(C)||await this.app.vault.createFolder(C);let b=`${C}/${t.name}`;await this.app.fileManager.renameFile(t,b)}let A=((r=this.mocManager)==null?void 0:r.getProjectList())||[],_=await this.gemini.classifyProject(p,A),E=await this.applyClassifyResultWithConfirmation(y,_);new R.Notice(`\uC644\uB8CC: OCR(${c.pages}p) \u2192 ${_.targetType}${_.projectName?` (${_.projectName})`:""}`),await this.findAndShowRelatedNotes(E,p,_.title),await this.detectAndSaveSchedules(p)}catch(c){console.error("\uCC98\uB9AC \uC624\uB958:",c),new R.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${c}`)}return}if(n==="md"){new R.Notice("\uBD84\uB958 \uC911...");try{let l=await this.app.vault.read(t),c=this.truncateContent(l),d=((a=this.mocManager)==null?void 0:a.getProjectList())||[],p=await this.gemini.classifyProject(c,d),g=await this.applyClassifyResultWithConfirmation(t,p);new R.Notice(`${p.targetType}${p.projectName?` (${p.projectName})`:""}\uB85C \uBD84\uB958\uB428`),await this.findAndShowRelatedNotes(g,l,p.title),await this.detectAndSaveSchedules(l)}catch(l){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",l),new R.Notice(`\uBD84\uB958 \uC2E4\uD328: ${l}`)}return}new R.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}async linkRelatedNotesForCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new R.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(t.extension!=="md"){new R.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uC9C0\uC6D0\uD569\uB2C8\uB2E4");return}new R.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");try{let n=await this.app.vault.read(t),i=this.truncateContent(n),o=n.match(/^#\s+(.+)$/m),r=(o==null?void 0:o[1])||t.basename;await this.findAndShowRelatedNotes(t,i,r)}catch(n){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",n),new R.Notice(`\uAC80\uC0C9 \uC2E4\uD328: ${n}`)}}showCommandListModal(){new sw(this.app,this).open()}async applyClassifyResult(t,n){let i=await this.app.vault.read(t),o=this.updateFrontmatter(i,{targetType:n.targetType,project:n.projectName||void 0,title:n.title,summary:n.summary,next_action:n.nextAction||void 0,processed_at:Ee(this.settings.timezone,this.settings.dateFormat)});await this.app.vault.modify(t,o);let r=this.getTargetFolder(n.targetType,n.projectName);if(r){this.app.vault.getAbstractFileByPath(r)||await this.app.vault.createFolder(r);let l=`${r}/${t.name}`;await this.app.fileManager.renameFile(t,l);let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof R.TFile)return c}return t}async applyClassifyResultWithConfirmation(t,n){return n.contentType!=="reference"||!n.projectName?this.applyClassifyResult(t,n):new Promise(i=>{new iw(this.app,n,async o=>{let r={...n};o==="library"?(r={...n,targetType:"library"},new R.Notice(`Library\uC5D0 \uC800\uC7A5 + ${n.projectName} \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C`)):r={...n,targetType:"project"};let a=await this.applyClassifyResult(t,r);i(a)}).open()})}async findAndShowRelatedNotes(t,n,i){if(!this.relatedNoteFinder||!this.gemini)return;let o=this.truncateContent(n);try{let r=await this.gemini.extractKeywords(o);r.length>0&&this.relatedNoteFinder&&await this.relatedNoteFinder.saveKeywordsToNote(t,r),this.mocManager&&this.mocManager.getMOCCount()>0&&await this.handleProjectMOC(t,i,r),new R.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");let a=await this.relatedNoteFinder.findRelated(o,i,t.path);a.length>0?new Qv(this.app,a,t,this.relatedNoteFinder).open():r.length>0&&new R.Notice(`\uD0A4\uC6CC\uB4DC ${r.length}\uAC1C \uC800\uC7A5\uB428`)}catch(r){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",r)}}async handleProjectMOC(t,n,i){if(!(!this.mocManager||!this.gemini))try{let o=await this.mocManager.detectProject(n,i);if(!o)return;if(o.startsWith("NEW:")){let a=o.slice(4).trim();new jv(this.app,a,t,n,this.mocManager,this.settings.projectsFolder).open();return}await this.mocManager.addNoteToMOC(o,n,t.path)&&new R.Notice(`\u{1F4C1} ${o} MOC\uC5D0 \uC5F0\uACB0\uB428`)}catch(o){console.error("MOC \uC5F0\uACB0 \uC624\uB958:",o)}}getTargetFolder(t,n){switch(t){case"project":return n?`${this.settings.projectsFolder}/${n}`:this.settings.projectsFolder;case"library":return this.settings.libraryFolder;case"archive":return this.settings.archivesFolder;default:return this.settings.libraryFolder}}updateFrontmatter(t,n){let i=/^---\n([\s\S]*?)\n---\n?/,o=t.match(i),r="",a=t;o&&(r=o[1],a=t.slice(o[0].length));let l=r.split(`
`).filter(p=>p.trim()),c=new Map;for(let p of l){let g=p.indexOf(":");if(g!==-1){let m=p.slice(0,g).trim(),y=p.slice(g+1).trim();c.set(m,y)}}for(let[p,g]of Object.entries(n))if(g!==void 0){let y=/[:\[\]{}#&*!|>'"%@`]/.test(g)&&!g.startsWith('"')?`"${g.replace(/"/g,'\\"')}"`:g;c.set(p,y)}return`---
${Array.from(c.entries()).map(([p,g])=>`${p}: ${g}`).join(`
`)}
---
${a}`}async extractZKFromCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new R.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new R.Notice("ZK \uC544\uC774\uB514\uC5B4 \uCD94\uCD9C \uC911...");try{let n=await this.app.vault.read(t),i=await this.gemini.extractZK(n);if(i.length===0){new R.Notice("\uCD94\uCD9C\uD560 \uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new Jv(this.app,i,t,this).open()}catch(n){console.error("ZK \uCD94\uCD9C \uC624\uB958:",n),new R.Notice(`\uCD94\uCD9C \uC2E4\uD328: ${n}`)}}initializeZKCounters(){if(!this.relatedNoteFinder)return;let t=this.relatedNoteFinder.getZettelIndex();for(let[n]of t){let o=(n.split("/").pop()||"").match(/^(\d{8})-(\d{3})/);if(o){let r=o[1],a=parseInt(o[2],10),l=this.zkDailyCounter.get(r)||0;a>l&&this.zkDailyCounter.set(r,a)}this.zkLuhmannCounter=Math.max(this.zkLuhmannCounter,t.size)}console.log(`ZK \uCE74\uC6B4\uD130 \uCD08\uAE30\uD654: \uB8E8\uB9CC=${this.zkLuhmannCounter}, \uC77C\uBCC4=${this.zkDailyCounter.size}\uAC1C \uB0A0\uC9DC`)}generateZKId(){switch(this.settings.zkIdType){case"timestamp":return Date.now().toString();case"date-sequence":{let n=pn(this.settings.timezone).replace(/-/g,""),i=(this.zkDailyCounter.get(n)||0)+1;return this.zkDailyCounter.set(n,i),`${n}-${i.toString().padStart(3,"0")}`}case"luhmann":return this.zkLuhmannCounter++,this.toLuhmannId(this.zkLuhmannCounter);default:return Date.now().toString()}}toLuhmannId(t){if(t<=0)return"1";let n=[],i=t,o=0;for(;i>0;){if(o%2===0){let r=(i-1)%9+1;n.push(r.toString()),i=Math.floor((i-1)/9)}else{let r=(i-1)%26;n.push(String.fromCharCode(97+r)),i=Math.floor((i-1)/26)}o++}return n.reverse().join("")}async createZKNotes(t,n){var d;let i=this.settings.zettelFolder;this.app.vault.getAbstractFileByPath(i)||await this.app.vault.createFolder(i);let r=[],a=[],l=0;for(let p of t){let m=(await this.relatedNoteFinder.findRelatedZettels(p.keywords)).find(S=>S.relevance>=this.settings.zkMergeThreshold);if(m&&await this.showMergeConfirmModal(p,m)){await this.mergeToExistingZK(m.note.path,p,n),a.push(p.title);continue}let y=this.generateZKId(),A=Ku(p.title),_=`${i}/${y} ${A}.md`,E=`---
type: zettel
source: "[[${n.basename}]]"
keywords: [${p.keywords.join(", ")}]
created: ${Ee(this.settings.timezone,this.settings.dateFormat)}
---

# ${p.title}

## \uD575\uC2EC \uC544\uC774\uB514\uC5B4
${p.body}

## \uC65C \uC911\uC694\uD55C\uAC00?
${p.importance||""}

## \uB9E5\uB77D
- **\uC6D0\uBCF8**: [[${n.basename}]]
- **\uAD00\uB828 \uAC1C\uB150**: ${((d=p.relatedConcepts)==null?void 0:d.join(", "))||""}

---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
- [[${n.basename}]] (\uC6D0\uBCF8)
`;await this.app.vault.create(_,E),r.push(p.title);let C=this.app.vault.getAbstractFileByPath(_);if(C instanceof R.TFile){await this.relatedNoteFinder.updateIndex(C);let S=await this.relatedNoteFinder.findRelatedZettels(p.keywords,_);S.length>0&&(await this.addZKRelatedLinks(C,S),await this.addBacklinksToZettels(C,S),l+=S.length),this.zkIndexManager&&await this.zkIndexManager.updateIndex(C,p.keywords)}await new Promise(S=>setTimeout(S,10))}let c=[];r.length>0&&c.push(`${r.length}\uAC1C \uC0DD\uC131`),a.length>0&&c.push(`${a.length}\uAC1C \uBCD1\uD569`),l>0&&c.push(`${l}\uAC1C \uC5F0\uACB0`),new R.Notice(`ZK \uB178\uD2B8: ${c.join(", ")}`)}showMergeConfirmModal(t,n){return new Promise(i=>{new Xv(this.app,t,n,r=>i(r)).open()})}async mergeToExistingZK(t,n,i){let o=this.app.vault.getAbstractFileByPath(t);if(!(o instanceof R.TFile))return;let r=await this.app.vault.read(o),a=`

---
## \uCD94\uAC00\uB41C \uB0B4\uC6A9 (${new Date().toLocaleDateString()})
*\uC6D0\uBCF8: [[${i.basename}]]*

${n.body}
`,l=/(\n---\n##  )/,c;l.test(r)?c=r.replace(l,`${a}$1`):c=r+a;let d=this.extractKeywordsFromFrontmatter(r),p=[...new Set([...d,...n.keywords])];c=this.updateFrontmatterKeywordsInContent(c,p),await this.app.vault.modify(o,c),await this.relatedNoteFinder.updateIndex(o)}extractKeywordsFromFrontmatter(t){let n=t.match(/^---\n[\s\S]*?keywords:\s*\[(.*?)\][\s\S]*?---/);return n?n[1].split(",").map(i=>i.trim().replace(/^["']|["']$/g,"")).filter(i=>i.length>0):[]}updateFrontmatterKeywordsInContent(t,n){let i=`keywords: [${n.join(", ")}]`;return t.replace(/^(---\n[\s\S]*?)(keywords:\s*\[.*?\])([\s\S]*?---)/,`$1${i}$3`)}async addZKRelatedLinks(t,n){if(n.length===0)return;let i=await this.app.vault.read(t),o=n.map(c=>{let d=c.note.path.split("/"),g=d[d.length-1].replace(/\.md$/,""),m=c.reason?`
  \u2192 ${c.reason}`:"";return`- [[${g}]] (${Math.round(c.relevance*100)}%)${m}`}).join(`
`),r=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,a=i.match(r),l;a?l=i.replace(r,`$1
${o}$2`):l=i+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${o}
`,await this.app.vault.modify(t,l)}async addBacklinksToZettels(t,n){for(let i of n){let o=this.app.vault.getAbstractFileByPath(i.note.path);if(!(o instanceof R.TFile))continue;let r=await this.app.vault.read(o);if(r.includes(`[[${t.basename}]]`))continue;let a=i.reason?`
  \u2192 ${i.reason}`:"",l=`- [[${t.basename}]] (${Math.round(i.relevance*100)}%)${a}`,c=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,d=r.match(c),p;d?p=r.replace(c,`$1
${l}$2`):p=r+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${l}
`,await this.app.vault.modify(o,p)}}async showFocusTop3(){if(this.checkApiKey()){new R.Notice("\uD504\uB85C\uC81D\uD2B8 \uBD84\uC11D \uC911...");try{let t=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(!t||!(t instanceof R.TFolder)){new R.Notice("Projects \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=await this.collectProjectsSummary(t);if(!n){new R.Notice("\uC9C4\uD589 \uC911\uC778 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let i=await this.gemini.getFocus(n);if(i.length===0){new R.Notice("\uCD94\uCC9C\uD560 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new Zv(this.app,i).open()}catch(t){console.error("Focus \uBD84\uC11D \uC624\uB958:",t),new R.Notice(`\uBD84\uC11D \uC2E4\uD328: ${t}`)}}}async collectProjectsSummary(t){let n=[];for(let i of t.children)if(i instanceof R.TFile&&i.extension==="md"){let o=await this.app.vault.read(i),r=this.extractFrontmatter(o),a=r.title||i.basename,l=r.summary||"",c=r.next_action||"";n.push(`- ${a}: ${l} (\uB2E4\uC74C: ${c})`)}return n.join(`
`)}extractFrontmatter(t){let n=/^---\n([\s\S]*?)\n---/,i=t.match(n);if(!i)return{};let o={},r=i[1].split(`
`);for(let a of r){let l=a.indexOf(":");if(l!==-1){let c=a.slice(0,l).trim(),d=a.slice(l+1).trim();o[c]=d}}return o}async processInbox(){var l;if(!this.checkApiKey())return;let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof R.TFolder)){new R.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=0,i=0,o=this.settings.triggerTag,r=[];for(let c of t.children)c instanceof R.TFile&&c.extension==="md"&&(await this.app.vault.read(c)).includes(o)&&r.push(c);if(r.length===0){new R.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new R.Notice(`${r.length}\uAC1C \uD30C\uC77C \uCC98\uB9AC \uC2DC\uC791...`);let a=((l=this.mocManager)==null?void 0:l.getProjectList())||[];for(let c=0;c<r.length;c++){let d=r[c];try{new R.Notice(`\uCC98\uB9AC \uC911: ${c+1}/${r.length} - ${d.name}`,2e3);let p=await this.app.vault.read(d),g=await this.gemini.classifyProject(p,a);await this.applyClassifyResult(d,g),n++}catch(p){console.error(`\uCC98\uB9AC \uC2E4\uD328: ${d.name}`,p),i++}}new R.Notice(`\uC644\uB8CC: ${n}\uAC1C \uCC98\uB9AC, ${i}\uAC1C \uC2E4\uD328`)}toggleWatch(){this.watcherRegistered?(this.stopWatcher(),new R.Notice("Watch \uC911\uC9C0\uB428")):(this.startWatcher(),new R.Notice("Watch \uC2DC\uC791\uB428"))}startWatcher(){this.watcherRegistered||(this.registerEvent(this.app.vault.on("create",t=>{t instanceof R.TFile&&this.onFileChange(t)})),this.registerEvent(this.app.vault.on("modify",t=>{t instanceof R.TFile&&this.onFileChange(t)})),this.registerEvent(this.app.vault.on("delete",t=>{var n,i;t instanceof R.TFile&&((n=this.relatedNoteFinder)==null||n.removeFromIndex(t.path),(i=this.mocManager)==null||i.removeFromIndex(t.path),console.log(`\uC778\uB371\uC2A4\uC5D0\uC11C \uC81C\uAC70: ${t.path}`))})),this.watcherRegistered=!0,console.log("Inbox \uAC10\uC2DC \uC2DC\uC791"))}stopWatcher(){this.watcherRegistered=!1,this.pendingFiles.clear(),console.log("Inbox \uAC10\uC2DC \uC911\uC9C0")}onFileChange(t){this.watcherRegistered&&this.gemini&&t.path.startsWith(this.settings.inboxFolder)&&t.extension==="md"&&(this.pendingFiles.set(t.path,Date.now()),this.processDebounced())}async processPendingFiles(){var o;if(!this.gemini)return;let t=Date.now(),n=this.settings.triggerTag,i=((o=this.mocManager)==null?void 0:o.getProjectList())||[];for(let[r,a]of this.pendingFiles.entries()){if(t-a<3e3)continue;this.pendingFiles.delete(r);let l=this.app.vault.getAbstractFileByPath(r);if(l instanceof R.TFile)try{let c=await this.app.vault.read(l);if(!c.includes(n))continue;let d=await this.gemini.classifyProject(c,i);await this.applyClassifyResult(l,d),new R.Notice(`\uC790\uB3D9 \uBD84\uB958: ${l.name} \u2192 ${d.targetType}${d.projectName?` (${d.projectName})`:""}`)}catch(c){console.error(`\uC790\uB3D9 \uBD84\uB958 \uC2E4\uD328: ${r}`,c)}}}async ocrCurrentFile(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new R.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new R.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.workspace.getActiveFile();if(!t){new R.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase();if(!["png","jpg","jpeg","webp","gif","pdf"].includes(n)){new R.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`);return}let o=await this.ocrProcessor.checkLimits(t);if(!o.allowed){new Yu(this.app,o.reason,t,this).open();return}new R.Notice("OCR \uCC98\uB9AC \uC911...");try{let r=await this.ocrProcessor.processFile(t),a=this.ocrProcessor.generateMarkdownNote(r),l=t.basename+"_OCR.md",c=`${this.settings.inboxFolder}/${l}`;if(await this.app.vault.create(c,a),this.settings.ocrMoveOriginal){let d=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(d)||await this.app.vault.createFolder(d);let g=`${d}/${t.name}`;await this.app.fileManager.renameFile(t,g)}new R.Notice(`OCR \uC644\uB8CC: ${l} \uC0DD\uC131\uB428 (${r.pages}\uD398\uC774\uC9C0)`)}catch(r){console.error("OCR \uC624\uB958:",r),new R.Notice(`OCR \uC2E4\uD328: ${r}`)}}async processInboxOCR(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new R.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new R.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof R.TFolder)){new R.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=["png","jpg","jpeg","webp","gif","pdf"],i=[];for(let a of t.children){if(!(a instanceof R.TFile))continue;let l=a.extension.toLowerCase();if(!n.includes(l))continue;(await this.ocrProcessor.checkLimits(a)).allowed&&i.push(a)}if(i.length===0){new R.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new R.Notice(`${i.length}\uAC1C \uD30C\uC77C OCR \uCC98\uB9AC \uC2DC\uC791...`);let o=0,r=0;for(let a=0;a<i.length;a++){let l=i[a];try{new R.Notice(`OCR \uC911: ${a+1}/${i.length} - ${l.name}`,3e3);let c=await this.ocrProcessor.processFile(l),d=this.ocrProcessor.generateMarkdownNote(c),p=l.basename+"_OCR.md",g=`${this.settings.inboxFolder}/${p}`;if(await this.app.vault.create(g,d),this.settings.ocrMoveOriginal){let m=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(m)||await this.app.vault.createFolder(m);let A=`${m}/${l.name}`;await this.app.fileManager.renameFile(l,A)}o++,a<i.length-1&&await new Promise(m=>setTimeout(m,1e3))}catch(c){console.error(`OCR \uCC98\uB9AC \uC2E4\uD328: ${l.name}`,c),r++}}new R.Notice(`OCR \uC644\uB8CC: ${o}\uAC1C \uCC98\uB9AC, ${r}\uAC1C \uC2E4\uD328`)}async smartProcessCurrentFile(){var o,r;if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new R.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase();if(["pdf","png","jpg","jpeg","webp","gif"].includes(n)){if(!this.settings.ocrEnabled){new R.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new R.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let a=await this.ocrProcessor.checkLimits(t);if(!a.allowed){new Yu(this.app,a.reason,t,this).open();return}new R.Notice("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let l=await this.ocrProcessor.processFile(t);new R.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let c=await this.gemini.summarizePDF(l.text),d=this.ocrProcessor.generateSummarizedNote(l,c),p=t.basename+"_OCR.md",g=`${this.settings.inboxFolder}/${p}`,m=await this.app.vault.create(g,d);if(this.settings.ocrMoveOriginal){let _=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(_)||await this.app.vault.createFolder(_);let C=`${_}/${t.name}`;await this.app.fileManager.renameFile(t,C)}let y=((o=this.mocManager)==null?void 0:o.getProjectList())||[],A=await this.gemini.classifyProject(d,y);await this.applyClassifyResultWithConfirmation(m,A),new R.Notice(`\uC644\uB8CC: OCR(${l.pages}p) \u2192 ${A.targetType}${A.projectName?` (${A.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(l){console.error("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC624\uB958:",l),new R.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${l}`)}}else if(n==="md"){new R.Notice("\uBD84\uB958 \uC911...");try{let a=await this.app.vault.read(t),l=((r=this.mocManager)==null?void 0:r.getProjectList())||[],c=await this.gemini.classifyProject(a,l);await this.applyClassifyResultWithConfirmation(t,c),new R.Notice(`${c.targetType}${c.projectName?` (${c.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(a){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",a),new R.Notice(`\uBD84\uB958 \uC2E4\uD328: ${a}`)}}else new R.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}getOCRDailyUsage(){return this.ocrProcessor?this.ocrProcessor.getDailyUsage():{date:pn(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}},Jv=class extends R.Modal{constructor(e,t,n,i){super(e),this.candidates=t,this.selected=new Set(t.map((o,r)=>r)),this.sourceFile=n,this.plugin=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"ZK \uC544\uC774\uB514\uC5B4 \uC120\uD0DD"}),e.createEl("p",{text:"\uC0DD\uC131\uD560 Zettelkasten \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let t=e.createDiv({cls:"zk-candidate-list"});this.candidates.forEach((r,a)=>{let l=t.createDiv({cls:"zk-candidate-item"}),c=l.createEl("input",{type:"checkbox",attr:{checked:!0}});c.addEventListener("change",()=>{c.checked?this.selected.add(a):this.selected.delete(a)});let d=l.createDiv({cls:"zk-candidate-label"});d.createEl("strong",{text:r.title}),d.createEl("p",{text:r.body,cls:"zk-candidate-body"}),d.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${r.keywords.join(", ")}`,cls:"zk-candidate-keywords"})});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{let r=this.candidates.filter((a,l)=>this.selected.has(l));r.length>0&&await this.plugin.createZKNotes(r,this.sourceFile),this.close()})}onClose(){this.contentEl.empty()}},Xv=class extends R.Modal{constructor(e,t,n,i){super(e),this.candidate=t,this.similarNote=n,this.onResult=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC720\uC0AC\uD55C \uB178\uD2B8 \uBC1C\uACAC"}),e.createEl("p",{text:`\uC0C8 \uC544\uC774\uB514\uC5B4\uC640 ${Math.round(this.similarNote.relevance*100)}% \uC720\uC0AC\uD55C \uB178\uD2B8\uAC00 \uC788\uC2B5\uB2C8\uB2E4.`,cls:"setting-item-description"});let t=e.createDiv({cls:"merge-section"});t.createEl("h4",{text:"\uC0C8 \uC544\uC774\uB514\uC5B4"}),t.createEl("p",{text:this.candidate.title,cls:"merge-title"}),t.createEl("p",{text:this.candidate.body,cls:"merge-body"});let n=e.createDiv({cls:"merge-section"});n.createEl("h4",{text:"\uAE30\uC874 \uB178\uD2B8"}),n.createEl("p",{text:this.similarNote.note.title,cls:"merge-title"}),n.createEl("p",{text:`\uD0A4\uC6CC\uB4DC: ${this.similarNote.note.keywords.join(", ")}`,cls:"merge-keywords"});let i=e.createDiv({cls:"merge-buttons"});i.createEl("button",{text:"\uAE30\uC874 \uB178\uD2B8\uC5D0 \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",()=>{this.onResult(!0),this.close()}),i.createEl("button",{text:"\uC0C8 \uB178\uD2B8 \uC0DD\uC131"}).addEventListener("click",()=>{this.onResult(!1),this.close()})}onClose(){this.contentEl.empty()}},Zv=class extends R.Modal{constructor(e,t){super(e),this.items=t}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC624\uB298 \uC9D1\uC911\uD560 \uD504\uB85C\uC81D\uD2B8 Top 3"});let t=e.createDiv({cls:"focus-list"});this.items.forEach((o,r)=>{let a=t.createDiv({cls:"focus-item"});a.createEl("h3",{text:`${r+1}. ${o.title}`}),a.createEl("p",{text:o.why,cls:"focus-why"}),a.createEl("p",{text:`\u2192 ${o.nextAction}`,cls:"focus-action"})}),e.createDiv({cls:"modal-button-container"}).createEl("button",{text:"\uB2EB\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}},Yu=class extends R.Modal{constructor(e,t,n,i){super(e),this.reason=t,this.file=n,this.plugin=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uD30C\uC77C\uC774 \uB108\uBB34 \uD07D\uB2C8\uB2E4"}),e.createEl("p",{text:this.reason}),e.createEl("p",{text:"\uC124\uC815\uC5D0\uC11C \uC81C\uD55C\uC744 \uC870\uC815\uD558\uAC70\uB098, \uD30C\uC77C\uC744 \uBD84\uD560\uD574\uC11C \uCC98\uB9AC\uD558\uC138\uC694.",cls:"setting-item-description"});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"\uC124\uC815 \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.app.setting.open()})}onClose(){this.contentEl.empty()}},Qv=class extends R.Modal{constructor(e,t,n,i){super(e),this.relatedNotes=t,this.selected=new Set(t.map((o,r)=>r)),this.currentFile=n,this.finder=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uAD00\uB828 \uB178\uD2B8 \uBC1C\uACAC"}),e.createEl("p",{text:"\uC5F0\uACB0\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let t=e.createDiv({cls:"related-notes-list"});this.relatedNotes.forEach((r,a)=>{let l=t.createDiv({cls:"related-note-item"}),c=l.createEl("input",{type:"checkbox",attr:{checked:!0}});c.addEventListener("change",()=>{c.checked?this.selected.add(a):this.selected.delete(a)});let d=l.createDiv({cls:"related-note-label"});d.createEl("strong",{text:r.note.title});let p=Math.round(r.relevance*100);d.createEl("span",{text:` (${p}%)`,cls:"related-note-relevance"}),r.matchedKeywords.length>0&&d.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${r.matchedKeywords.join(", ")}`,cls:"related-note-keywords"})});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uB9C1\uD06C \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",async()=>{let r=this.relatedNotes.filter((a,l)=>this.selected.has(l));r.length>0&&(await this.finder.addRelatedLinks(this.currentFile,r),new R.Notice(`${r.length}\uAC1C \uAD00\uB828 \uB178\uD2B8 \uB9C1\uD06C \uCD94\uAC00\uB428`)),this.close()})}onClose(){this.contentEl.empty()}},jv=class extends R.Modal{constructor(e,t,n,i,o,r){super(e),this.projectName=t,this.noteFile=n,this.noteTitle=i,this.mocManager=o,this.projectsFolder=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 \uAC10\uC9C0"}),e.createEl("p",{text:`"${this.projectName}" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC0C8\uB85C \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`}),e.createEl("p",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8\uC758 MOC(Map of Content)\uB97C \uC0DD\uC131\uD560\uAE4C\uC694?",cls:"setting-item-description"});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"MOC \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{await this.mocManager.createProjectMOC(this.projectName,this.projectsFolder)?(await this.mocManager.addNoteToMOC(this.projectName,this.noteTitle,this.noteFile.path),new R.Notice(`\u{1F4C1} ${this.projectName} MOC \uC0DD\uC131 \uBC0F \uC5F0\uACB0 \uC644\uB8CC`)):new R.Notice("MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4"),this.close()})}onClose(){this.contentEl.empty()}},ew=class extends R.Modal{constructor(e,t,n){super(e),this.mocManager=t,this.projectsFolder=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131"}),e.createEl("p",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 MOC\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4. \uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694.",cls:"setting-item-description"});let t=e.createDiv({cls:"moc-input-container"});if(t.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uC774\uB984:"}),this.inputEl=t.createEl("input",{type:"text",placeholder:"\uC608: \uC2A4\uB9C8\uD2B8\uD31C"}),this.inputEl.style.width="100%",this.inputEl.style.marginTop="8px",this.inputEl.style.padding="8px",this.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&this.createMOC()}),this.mocManager&&this.mocManager.getMOCCount()>0){let r=e.createDiv({cls:"existing-mocs"});r.createEl("h4",{text:"\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 MOC:"});let a=r.createEl("ul");for(let l of this.mocManager.getProjectList())a.createEl("li",{text:l})}let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createMOC()),setTimeout(()=>this.inputEl.focus(),10)}async createMOC(){let e=this.inputEl.value.trim();if(!e){new R.Notice("\uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694");return}if(!this.mocManager){new R.Notice("MOC \uAD00\uB9AC\uC790\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4"),this.close();return}if(this.mocManager.getProjectList().includes(e)){new R.Notice(`"${e}" MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4`);return}let n=await this.mocManager.createProjectMOC(e,this.projectsFolder);n?(new R.Notice(`\u{1F4C1} ${e} MOC \uC0DD\uC131 \uC644\uB8CC`),this.app.workspace.getLeaf().openFile(n)):new R.Notice("MOC \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4"),this.close()}onClose(){this.contentEl.empty()}},tw=class extends R.Modal{constructor(e,t,n,i,o){super(e),this.title=t,this.description=n,this.placeholder=i,this.onSubmit=o}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.title}),e.createEl("p",{text:this.description,cls:"setting-item-description"});let t=e.createDiv({cls:"url-input-container"});this.inputEl=t.createEl("input",{type:"text",placeholder:this.placeholder}),this.inputEl.style.width="100%",this.inputEl.style.padding="8px",navigator.clipboard.readText().then(r=>{r&&(r.startsWith("http://")||r.startsWith("https://"))&&(this.inputEl.value=r)}).catch(()=>{}),this.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&this.submit()});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uAC00\uC838\uC624\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.submit()),setTimeout(()=>this.inputEl.focus(),10)}async submit(){let e=this.inputEl.value.trim();if(!e){new R.Notice("URL\uC744 \uC785\uB825\uD558\uC138\uC694");return}this.close(),await this.onSubmit(e)}onClose(){this.contentEl.empty()}},nw=class extends R.Modal{constructor(e,t,n,i){super(e),this.sections=t,this.selected=new Set(t.map((o,r)=>r)),this.sourceFile=n,this.plugin=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uACB0\uACFC"}),e.createEl("p",{text:`${this.sections.length}\uAC1C\uC758 \uC139\uC158\uC73C\uB85C \uBD84\uB9AC\uB428. \uC0DD\uC131\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let t=e.createDiv({cls:"split-section-list"});this.sections.forEach((r,a)=>{let l=t.createDiv({cls:"split-section-item"});l.style.marginBottom="16px",l.style.padding="12px",l.style.border="1px solid var(--background-modifier-border)",l.style.borderRadius="8px";let c=l.createDiv({cls:"split-section-header"});c.style.display="flex",c.style.alignItems="center",c.style.gap="8px";let d=c.createEl("input",{type:"checkbox",attr:{checked:!0}});d.addEventListener("change",()=>{d.checked?this.selected.add(a):this.selected.delete(a)}),c.createEl("strong",{text:r.title});let p=c.createDiv({cls:"split-section-badges"});p.style.marginLeft="auto",p.style.display="flex",p.style.gap="4px";let g=p.createEl("span",{text:r.targetType,cls:"split-category-badge"});if(g.style.padding="2px 8px",g.style.borderRadius="4px",g.style.fontSize="12px",g.style.backgroundColor=this.getTargetTypeColor(r.targetType),g.style.color="white",r.project){let A=p.createEl("span",{text:r.project.startsWith("NEW:")?`\u2728 ${r.project.slice(4)}`:`\u{1F4C1} ${r.project}`,cls:"split-project-badge"});A.style.padding="2px 8px",A.style.borderRadius="4px",A.style.fontSize="12px",A.style.backgroundColor="var(--interactive-accent)",A.style.color="white"}let m=l.createDiv({cls:"split-section-preview"});m.style.marginTop="8px",m.style.fontSize="13px",m.style.color="var(--text-muted)",m.style.maxHeight="60px",m.style.overflow="hidden",m.style.textOverflow="ellipsis";let y=r.content.length>150?r.content.slice(0,150)+"...":r.content;if(m.setText(y),r.keywords.length>0){let A=l.createDiv({cls:"split-section-keywords"});A.style.marginTop="8px",A.style.fontSize="12px",A.setText(`\uD0A4\uC6CC\uB4DC: ${r.keywords.join(", ")}`)}});let n=e.createDiv({cls:"modal-button-container"});n.style.marginTop="16px",n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:`${this.selected.size}\uAC1C \uB178\uD2B8 \uC0DD\uC131`,cls:"mod-cta"}).addEventListener("click",async()=>{let r=this.sections.filter((a,l)=>this.selected.has(l));r.length>0&&(this.close(),await this.plugin.createSplitNotes(r,this.sourceFile))})}getTargetTypeColor(e){switch(e){case"project":return"#e67e22";case"library":return"#27ae60";case"archive":return"#95a5a6";default:return"#7f8c8d"}}onClose(){this.contentEl.empty()}},iw=class extends R.Modal{constructor(e,t,n){super(e),this.result=t,this.onChoice=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC800\uC7A5 \uC704\uCE58 \uC120\uD0DD"});let t=e.createDiv({cls:"reference-confirm-info"});t.style.marginBottom="16px",t.style.padding="12px",t.style.backgroundColor="var(--background-secondary)",t.style.borderRadius="8px",t.createEl("p",{text:`"${this.result.title}"`,cls:"reference-title"}).style.fontWeight="bold",t.createEl("p",{text:`\uAD00\uB828 \uD504\uB85C\uC81D\uD2B8: ${this.result.projectName}`,cls:"reference-project"}).style.color="var(--text-muted)",t.createEl("p",{text:"\uC774 \uC790\uB8CC\uB294 \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB85C \uBCF4\uC785\uB2C8\uB2E4. \uC5B4\uB514\uC5D0 \uC800\uC7A5\uD560\uAE4C\uC694?",cls:"reference-question"}).style.marginTop="8px";let n=e.createDiv({cls:"reference-options"});n.style.display="flex",n.style.flexDirection="column",n.style.gap="12px";let i=n.createDiv({cls:"reference-option"});i.style.padding="12px",i.style.border="1px solid var(--background-modifier-border)",i.style.borderRadius="8px",i.style.cursor="pointer",i.addEventListener("mouseenter",()=>{i.style.backgroundColor="var(--background-secondary)"}),i.addEventListener("mouseleave",()=>{i.style.backgroundColor=""}),i.createEl("strong",{text:"\u{1F4C1} \uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC800\uC7A5"}),i.createEl("p",{text:`Projects/${this.result.projectName}/ \uC5D0 \uC800\uC7A5`,cls:"option-desc"}).style.color="var(--text-muted)",i.createEl("small",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8 \uC804\uC6A9 \uC790\uB8CC\uB85C \uAD00\uB9AC"}).style.color="var(--text-faint)",i.addEventListener("click",()=>{this.close(),this.onChoice("project")});let o=n.createDiv({cls:"reference-option"});o.style.padding="12px",o.style.border="2px solid var(--interactive-accent)",o.style.borderRadius="8px",o.style.cursor="pointer",o.style.backgroundColor="var(--background-secondary)",o.createEl("strong",{text:"\u{1F4DA} Library\uC5D0 \uC800\uC7A5 + \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C (\uAD8C\uC7A5)"}),o.createEl("p",{text:"Library/ \uC5D0 \uC800\uC7A5\uD558\uACE0 \uD504\uB85C\uC81D\uD2B8\uC640 \uC5F0\uACB0",cls:"option-desc"}).style.color="var(--text-muted)",o.createEl("small",{text:"\uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5"}).style.color="var(--text-faint)",o.addEventListener("click",()=>{this.close(),this.onChoice("library")});let r=e.createDiv({cls:"modal-button-container"});r.style.marginTop="16px",r.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}},sw=class extends R.Modal{constructor(e,t){super(e),this.plugin=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("zfb-command-list-modal");let t=e.createEl("h2",{text:"\u{1F9E0} Zero Friction Brain"});t.style.marginBottom="16px",t.style.textAlign="center";let n=[{name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkey:"Ctrl+Shift+G",icon:"folder",action:()=>this.plugin.classifyCurrentFile()},{name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkey:"Ctrl+Shift+L",icon:"link",action:()=>this.plugin.linkRelatedNotesForCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkey:"Ctrl+Shift+S",icon:"sparkles",action:()=>this.plugin.smartProcessCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkey:"Ctrl+Shift+D",icon:"split",action:()=>this.plugin.smartSplitCurrentFile()},{name:"ZK \uCD94\uCD9C",hotkey:"Ctrl+Shift+Z",icon:"file-plus",action:()=>this.plugin.extractZKFromCurrentFile()},{name:"URL \uAC00\uC838\uC624\uAE30",hotkey:"Ctrl+Shift+U",icon:"globe",action:()=>this.plugin.showURLImportModal()},{name:"Focus Top 3",hotkey:"Ctrl+Shift+;",icon:"target",action:()=>this.plugin.showFocusTop3()},{name:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC",hotkey:"Ctrl+Shift+R",icon:"calendar-check",action:()=>this.plugin.showReviewModal()},{name:"OCR \uCD94\uCD9C",hotkey:"Ctrl+Shift+O",icon:"scan",action:()=>this.plugin.ocrCurrentFile()},{divider:!0},{name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",hotkey:"",icon:"inbox",action:()=>this.plugin.processInbox()},{name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",hotkey:"",icon:"map",action:()=>this.plugin.showCreateMOCModal()},{name:"ZK Index \uC7AC\uAD6C\uCD95",hotkey:"",icon:"refresh-cw",action:()=>this.plugin.rebuildZKIndex()},{name:"Watch \uD1A0\uAE00",hotkey:"",icon:"eye",action:()=>this.plugin.toggleWatch()}],i=e.createDiv({cls:"zfb-command-list"});i.style.display="flex",i.style.flexDirection="column",i.style.gap="4px";for(let a of n){if("divider"in a&&a.divider){let p=i.createEl("hr");p.style.margin="8px 0",p.style.border="none",p.style.borderTop="1px solid var(--background-modifier-border)";continue}let l=i.createDiv({cls:"zfb-command-item"});l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="space-between",l.style.padding="10px 12px",l.style.borderRadius="6px",l.style.cursor="pointer",l.style.transition="background-color 0.1s",l.addEventListener("mouseenter",()=>{l.style.backgroundColor="var(--background-secondary)"}),l.addEventListener("mouseleave",()=>{l.style.backgroundColor=""});let c=l.createDiv();c.style.display="flex",c.style.alignItems="center",c.style.gap="10px";let d=c.createSpan({cls:"zfb-command-icon"});if((0,R.setIcon)(d,a.icon||"command"),d.style.opacity="0.7",c.createSpan({text:a.name}),a.hotkey){let p=l.createSpan({text:a.hotkey,cls:"zfb-command-hotkey"});p.style.fontSize="0.85em",p.style.color="var(--text-muted)",p.style.backgroundColor="var(--background-secondary)",p.style.padding="2px 8px",p.style.borderRadius="4px",p.style.fontFamily="monospace"}l.addEventListener("click",()=>{this.close(),a.action()})}let o=e.createDiv({cls:"zfb-command-footer"});o.style.marginTop="16px",o.style.paddingTop="12px",o.style.borderTop="1px solid var(--background-modifier-border)",o.style.textAlign="center",o.style.color="var(--text-muted)",o.style.fontSize="0.85em",o.createSpan({text:`v${this.plugin.manifest.version} \u2022 `});let r=o.createEl("a",{text:"\uC124\uC815"});r.style.cursor="pointer",r.addEventListener("click",()=>{this.close(),this.app.setting.open(),this.app.setting.openTabById("zero-friction-brain")})}onClose(){this.contentEl.empty()}},ow=class extends R.Modal{constructor(t,n,i){super(t);this.selectedPeriod="week";this.resultContainer=null;this.isLoading=!1;this.reviewManager=n,this.settings=i}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-review-modal"),t.createEl("h2",{text:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC"});let n=t.createDiv({cls:"zfb-review-period-section"});n.createEl("label",{text:"\uAE30\uAC04 \uC120\uD0DD:",cls:"setting-item-name"});let i=n.createDiv({cls:"zfb-period-buttons"});i.style.display="flex",i.style.gap="8px",i.style.marginTop="8px",i.style.marginBottom="16px",[{value:"today",label:"\uC624\uB298"},{value:"week",label:"\uC774\uBC88 \uC8FC"},{value:"month",label:"\uC774\uBC88 \uB2EC"}].forEach(({value:m,label:y})=>{let A=i.createEl("button",{text:y});A.style.padding="8px 16px",A.style.borderRadius="6px",A.style.cursor="pointer",m===this.selectedPeriod&&A.addClass("mod-cta"),A.addEventListener("click",()=>{this.selectedPeriod=m,i.querySelectorAll("button").forEach(_=>_.removeClass("mod-cta")),A.addClass("mod-cta"),this.loadNotes()})});let r=t.createDiv({cls:"zfb-review-filter-section"});r.style.marginBottom="16px",r.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uD544\uD130 (\uC120\uD0DD):",cls:"setting-item-name"});let a=r.createEl("select");a.style.marginLeft="8px",a.style.padding="4px 8px";let l=a.createEl("option",{text:"\uC804\uCCB4",value:""});l.value="",this.reviewManager.getProjectList().forEach(m=>{let y=a.createEl("option",{text:m,value:m});y.value=m}),a.addEventListener("change",()=>{this.projectFilter=a.value||void 0,this.loadNotes()}),this.resultContainer=t.createDiv({cls:"zfb-review-results"}),this.resultContainer.style.marginTop="16px",this.resultContainer.style.maxHeight="400px",this.resultContainer.style.overflowY="auto";let d=t.createDiv({cls:"modal-button-container"});d.style.marginTop="16px",d.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close()),d.createEl("button",{text:"AI \uBD84\uC11D \uBC0F \uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createReviewNote()),this.loadNotes()}async loadNotes(){if(!(!this.resultContainer||this.isLoading)){this.isLoading=!0,this.resultContainer.empty(),this.resultContainer.createEl("p",{text:"\uB178\uD2B8 \uC218\uC9D1 \uC911...",cls:"zfb-loading"});try{let t={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.collectNotes(t),i=this.reviewManager.groupByProject(n);this.renderResults(n,i)}catch(t){console.error("\uB178\uD2B8 \uC218\uC9D1 \uC2E4\uD328:",t),this.resultContainer.empty(),this.resultContainer.createEl("p",{text:`\uC624\uB958: ${t}`,cls:"zfb-error"})}finally{this.isLoading=!1}}}renderResults(t,n){if(!this.resultContainer)return;if(this.resultContainer.empty(),t.length===0){this.resultContainer.createEl("p",{text:"\uD574\uB2F9 \uAE30\uAC04\uC5D0 \uC791\uC5C5\uD55C \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.",cls:"zfb-empty-message"});return}let i=this.resultContainer.createDiv({cls:"zfb-review-summary"});i.style.padding="12px",i.style.backgroundColor="var(--background-secondary)",i.style.borderRadius="8px",i.style.marginBottom="16px";let o=za(this.selectedPeriod,this.settings.timezone);i.createEl("p",{text:`${o.label} \uC791\uC5C5: ${t.length}\uAC1C \uB178\uD2B8, ${n.length}\uAC1C \uD504\uB85C\uC81D\uD2B8/\uC601\uC5ED`});for(let r of n){let a=this.resultContainer.createDiv({cls:"zfb-review-group"});a.style.marginBottom="16px";let l=a.createEl("h4",{text:`\u{1F4C1} ${r.projectName} (${r.noteCount}\uAC1C)`});l.style.marginBottom="8px",l.style.borderBottom="1px solid var(--background-modifier-border)",l.style.paddingBottom="4px";let c=a.createEl("ul");c.style.listStyle="none",c.style.paddingLeft="16px",c.style.margin="0";for(let d of r.notes){let p=c.createEl("li");p.style.display="flex",p.style.justifyContent="space-between",p.style.alignItems="center",p.style.padding="4px 0";let g=p.createEl("a",{text:d.title});g.style.cursor="pointer",g.style.color="var(--text-accent)",g.addEventListener("click",async()=>{this.app.vault.getAbstractFileByPath(d.path)instanceof R.TFile&&await this.app.workspace.openLinkText(d.path,"")});let m=p.createEl("span",{text:pw(d.modified),cls:"zfb-note-time"});m.style.fontSize="0.85em",m.style.color="var(--text-muted)"}}}async createReviewNote(){if(!this.isLoading){this.isLoading=!0,new R.Notice("AI \uBD84\uC11D \uC911...");try{let t={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.analyze(t),i=await this.reviewManager.createReviewNote(n);new R.Notice(`\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131\uB428: ${i.basename}`),await this.app.workspace.openLinkText(i.path,""),this.close()}catch(t){console.error("\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328:",t),new R.Notice(`\uC0DD\uC131 \uC2E4\uD328: ${t}`)}finally{this.isLoading=!1}}}onClose(){this.contentEl.empty()}};
/*! Bundled license information:

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
