/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Vu=Object.defineProperty;var aE=Object.getOwnPropertyDescriptor;var lE=Object.getOwnPropertyNames;var cE=Object.prototype.hasOwnProperty;var uE=(s,t,e)=>t in s?Vu(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var dE=(s,t)=>{for(var e in t)Vu(s,e,{get:t[e],enumerable:!0})},hE=(s,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of lE(t))!cE.call(s,i)&&i!==e&&Vu(s,i,{get:()=>t[i],enumerable:!(n=aE(t,i))||n.enumerable});return s};var fE=s=>hE(Vu({},"__esModule",{value:!0}),s);var H=(s,t,e)=>(uE(s,typeof t!="symbol"?t+"":t,e),e),Yp=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var u=(s,t,e)=>(Yp(s,t,"read from private field"),e?e.call(s):t.get(s)),y=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},v=(s,t,e,n)=>(Yp(s,t,"write to private field"),n?n.call(s,e):t.set(s,e),e);var jt=(s,t,e,n)=>({set _(i){v(s,t,i,e)},get _(){return u(s,t,n)}}),w=(s,t,e)=>(Yp(s,t,"access private method"),e);var WP={};dE(WP,{default:()=>Wp});module.exports=fE(WP);var R=require("obsidian");var q_={geminiApiKey:"",inboxFolder:"00 _Inbox",projectsFolder:"01 Projects",libraryFolder:"02 Library",archivesFolder:"03 Archives",zettelFolder:"10 Zettelkasten",autoWatch:!0,triggerTag:"#\uC644\uB8CC",language:"ko",ocrEnabled:!0,ocrAutoProcess:!1,ocrMoveOriginal:!0,ocrOriginalFolder:"03 Archives/OCR_\uC6D0\uBCF8",ocrMinTextThreshold:50,ocrMaxPages:20,ocrMaxFileSizeMB:10,ocrDailyLimit:50,zkIdType:"date-sequence",zkMergeThreshold:.8,timezone:"auto",dateFormat:"local"};var rt=require("obsidian");var W_=[{value:"auto",label:"\uC790\uB3D9 \uAC10\uC9C0"},{value:"Asia/Seoul",label:"\uD55C\uAD6D (KST, UTC+9)"},{value:"Asia/Tokyo",label:"\uC77C\uBCF8 (JST, UTC+9)"},{value:"Asia/Shanghai",label:"\uC911\uAD6D (CST, UTC+8)"},{value:"America/New_York",label:"\uBBF8\uAD6D \uB3D9\uBD80 (EST/EDT)"},{value:"America/Los_Angeles",label:"\uBBF8\uAD6D \uC11C\uBD80 (PST/PDT)"},{value:"Europe/London",label:"\uC601\uAD6D (GMT/BST)"},{value:"UTC",label:"UTC"}],K_=[{value:"iso",label:"ISO \uD615\uC2DD (2026-01-05T16:24:45+09:00)"},{value:"local",label:"\uB85C\uCEEC \uD615\uC2DD (2026-01-05 16:24:45)"},{value:"friendly",label:"\uCE5C\uADFC\uD55C \uD615\uC2DD (2026\uB144 1\uC6D4 5\uC77C 16:24)"}];function Y_(s){return s==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:s}function pE(s,t,e){let n=Y_(t);switch(e){case"iso":return gE(s,n);case"local":return z_(s,n);case"friendly":return mE(s,n);default:return z_(s,n)}}function gE(s,t){let e={timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",e).formatToParts(s),i=g=>{var m;return((m=n.find(_=>_.type===g))==null?void 0:m.value)||""},o=i("year"),r=i("month"),a=i("day"),l=i("hour"),c=i("minute"),d=i("second"),p=yE(s,t);return`${o}-${r}-${a}T${l}:${c}:${d}${p}`}function z_(s,t){let e={timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",e).formatToParts(s),i=p=>{var g;return((g=n.find(m=>m.type===p))==null?void 0:g.value)||""},o=i("year"),r=i("month"),a=i("day"),l=i("hour"),c=i("minute"),d=i("second");return`${o}-${r}-${a} ${l}:${c}:${d}`}function mE(s,t){let e={timeZone:t,year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};return new Intl.DateTimeFormat("ko-KR",e).format(s)}function yE(s,t){let e=new Date(s.toLocaleString("en-US",{timeZone:"UTC"})),i=(new Date(s.toLocaleString("en-US",{timeZone:t})).getTime()-e.getTime())/(1e3*60);if(i===0)return"Z";let o=i>=0?"+":"-",r=Math.abs(i),a=Math.floor(r/60),l=r%60;return`${o}${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}`}function _E(s,t){let n={timeZone:Y_(t),year:"numeric",month:"2-digit",day:"2-digit"},i=new Intl.DateTimeFormat("en-CA",n).formatToParts(s),o=r=>{var a;return((a=i.find(l=>l.type===r))==null?void 0:a.value)||""};return`${o("year")}-${o("month")}-${o("day")}`}function Ht(s,t){return pE(new Date,s,t)}function Bo(s){return _E(new Date,s)}var qu=class extends rt.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Zero Friction Brain \uC124\uC815"}),t.createEl("h3",{text:"API \uC124\uC815"}),new rt.Setting(t).setName("Gemini API \uD0A4").setDesc(createFragment(n=>{n.appendText("Gemini API \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694. "),n.createEl("a",{text:"API \uD0A4 \uBC1C\uAE09\uBC1B\uAE30",href:"https://aistudio.google.com/apikey"})})).addText(n=>n.setPlaceholder("AIzaSy...").setValue(this.plugin.settings.geminiApiKey).onChange(async i=>{this.plugin.settings.geminiApiKey=i,await this.plugin.saveSettings()})),t.createEl("h3",{text:"\uD3F4\uB354 \uC124\uC815"}),new rt.Setting(t).setName("Inbox \uD3F4\uB354").setDesc("\uC0C8 \uB178\uD2B8\uAC00 \uC800\uC7A5\uB418\uB294 \uD3F4\uB354").addText(n=>n.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.inboxFolder).onChange(async i=>{this.plugin.settings.inboxFolder=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("Projects \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uBCC4 \uD558\uC704 \uD3F4\uB354\uAC00 \uC0DD\uC131\uB429\uB2C8\uB2E4").addText(n=>n.setPlaceholder("01 Projects").setValue(this.plugin.settings.projectsFolder).onChange(async i=>{this.plugin.settings.projectsFolder=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("Library \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uC5D0 \uC18D\uD558\uC9C0 \uC54A\uB294 \uCC38\uACE0 \uC790\uB8CC").addText(n=>n.setPlaceholder("02 Library").setValue(this.plugin.settings.libraryFolder).onChange(async i=>{this.plugin.settings.libraryFolder=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("Archives \uD3F4\uB354").setDesc("\uC644\uB8CC\uB41C \uD504\uB85C\uC81D\uD2B8 (\uD1B5\uC9F8\uB85C \uC774\uB3D9)").addText(n=>n.setPlaceholder("03 Archives").setValue(this.plugin.settings.archivesFolder).onChange(async i=>{this.plugin.settings.archivesFolder=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("Zettelkasten \uD3F4\uB354").setDesc("ZK \uC601\uAD6C \uB178\uD2B8 \uC800\uC7A5 \uC704\uCE58").addText(n=>n.setPlaceholder("10 Zettelkasten").setValue(this.plugin.settings.zettelFolder).onChange(async i=>{this.plugin.settings.zettelFolder=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("\uD3F4\uB354 \uAD6C\uC870 \uC0DD\uC131").setDesc("\uC704\uC5D0 \uC124\uC815\uB41C \uD3F4\uB354\uB4E4\uC744 \uC790\uB3D9\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4").addButton(n=>n.setButtonText("\uD3F4\uB354 \uC0DD\uC131").setCta().onClick(async()=>{await this.createFolderStructure()})),t.createEl("h3",{text:"\uC635\uC158"}),new rt.Setting(t).setName("Inbox \uC790\uB3D9 \uAC10\uC2DC").setDesc("Inbox \uD3F4\uB354\uC758 \uD30C\uC77C\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC2DC\uD558\uC5EC \uBD84\uB958").addToggle(n=>n.setValue(this.plugin.settings.autoWatch).onChange(async i=>{this.plugin.settings.autoWatch=i,await this.plugin.saveSettings(),i?this.plugin.startWatcher():this.plugin.stopWatcher()})),new rt.Setting(t).setName("\uD2B8\uB9AC\uAC70 \uD0DC\uADF8").setDesc("\uC774 \uD0DC\uADF8\uAC00 \uC788\uB294 \uB178\uD2B8\uB9CC \uC790\uB3D9 \uBD84\uB958 (\uC608: #\uC644\uB8CC)").addText(n=>n.setPlaceholder("#\uC644\uB8CC").setValue(this.plugin.settings.triggerTag).onChange(async i=>{this.plugin.settings.triggerTag=i,await this.plugin.saveSettings()})),t.createEl("h3",{text:"OCR \uC124\uC815"}),new rt.Setting(t).setName("OCR \uAE30\uB2A5 \uD65C\uC131\uD654").setDesc("\uC774\uBBF8\uC9C0 \uBC0F PDF\uC5D0\uC11C \uD14D\uC2A4\uD2B8 \uCD94\uCD9C").addToggle(n=>n.setValue(this.plugin.settings.ocrEnabled).onChange(async i=>{this.plugin.settings.ocrEnabled=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("OCR \uD6C4 \uC6D0\uBCF8 \uC774\uB3D9").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC744 \uC9C0\uC815 \uD3F4\uB354\uB85C \uC774\uB3D9").addToggle(n=>n.setValue(this.plugin.settings.ocrMoveOriginal).onChange(async i=>{this.plugin.settings.ocrMoveOriginal=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uD3F4\uB354").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC774 \uC774\uB3D9\uB420 \uD3F4\uB354").addText(n=>n.setPlaceholder("03 Archives/OCR_\uC6D0\uBCF8").setValue(this.plugin.settings.ocrOriginalFolder).onChange(async i=>{this.plugin.settings.ocrOriginalFolder=i,await this.plugin.saveSettings()})),t.createEl("h3",{text:"OCR \uC81C\uD55C (API \uC694\uAE08 \uBCF4\uD638)"}),new rt.Setting(t).setName("\uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").setDesc("\uD55C \uBC88\uC5D0 \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 PDF \uD398\uC774\uC9C0 \uC218").addSlider(n=>n.setLimits(1,100,1).setValue(this.plugin.settings.ocrMaxPages).setDynamicTooltip().onChange(async i=>{this.plugin.settings.ocrMaxPages=i,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (20)").onClick(async()=>{this.plugin.settings.ocrMaxPages=20,await this.plugin.saveSettings(),this.display()})),new rt.Setting(t).setName("\uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30 (MB)").setDesc("\uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30").addSlider(n=>n.setLimits(1,50,1).setValue(this.plugin.settings.ocrMaxFileSizeMB).setDynamicTooltip().onChange(async i=>{this.plugin.settings.ocrMaxFileSizeMB=i,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (10)").onClick(async()=>{this.plugin.settings.ocrMaxFileSizeMB=10,await this.plugin.saveSettings(),this.display()})),new rt.Setting(t).setName("\uC77C\uC77C \uCC98\uB9AC \uD55C\uB3C4 (\uD398\uC774\uC9C0)").setDesc("\uD558\uB8E8\uC5D0 OCR \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").addSlider(n=>n.setLimits(10,500,10).setValue(this.plugin.settings.ocrDailyLimit).setDynamicTooltip().onChange(async i=>{this.plugin.settings.ocrDailyLimit=i,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (50)").onClick(async()=>{this.plugin.settings.ocrDailyLimit=50,await this.plugin.saveSettings(),this.display()})),t.createDiv({cls:"ocr-usage-info"}).createEl("p",{text:`\uC624\uB298 \uC0AC\uC6A9\uB7C9: ${this.plugin.getOCRDailyUsage().pagesProcessed}/${this.plugin.settings.ocrDailyLimit} \uD398\uC774\uC9C0`,cls:"setting-item-description"}),t.createEl("h3",{text:"Zettelkasten \uC124\uC815"}),new rt.Setting(t).setName("ZK \uB178\uD2B8 ID \uD615\uC2DD").setDesc("ZK \uB178\uD2B8 \uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uD560 ID \uD615\uC2DD").addDropdown(n=>n.addOption("timestamp","\uD0C0\uC784\uC2A4\uD0EC\uD504 (1735789200000)").addOption("date-sequence","\uB0A0\uC9DC+\uC21C\uBC88 (20260102-001)").addOption("luhmann","\uB8E8\uB9CC \uC2A4\uD0C0\uC77C (1a1b)").setValue(this.plugin.settings.zkIdType).onChange(async i=>{this.plugin.settings.zkIdType=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("\uC720\uC0AC \uB178\uD2B8 \uBCD1\uD569 \uC784\uACC4\uAC12").setDesc("\uC774 \uAC12 \uC774\uC0C1\uC758 \uC720\uC0AC\uB3C4\uB97C \uAC00\uC9C4 \uB178\uD2B8\uAC00 \uC788\uC73C\uBA74 \uBCD1\uD569 \uC81C\uC548 (0.5~1.0)").addSlider(n=>n.setLimits(.5,1,.05).setValue(this.plugin.settings.zkMergeThreshold).setDynamicTooltip().onChange(async i=>{this.plugin.settings.zkMergeThreshold=i,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (0.8)").onClick(async()=>{this.plugin.settings.zkMergeThreshold=.8,await this.plugin.saveSettings(),this.display()})),t.createEl("h3",{text:"\uC2DC\uAC04\uB300 \uBC0F \uB0A0\uC9DC \uD615\uC2DD"}),new rt.Setting(t).setName("\uC2DC\uAC04\uB300").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504\uC5D0 \uC0AC\uC6A9\uD560 \uC2DC\uAC04\uB300").addDropdown(n=>{W_.forEach(i=>{n.addOption(i.value,i.label)}),n.setValue(this.plugin.settings.timezone).onChange(async i=>{this.plugin.settings.timezone=i,await this.plugin.saveSettings()})}),new rt.Setting(t).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504 \uD45C\uC2DC \uD615\uC2DD").addDropdown(n=>{K_.forEach(i=>{n.addOption(i.value,i.label)}),n.setValue(this.plugin.settings.dateFormat).onChange(async i=>{this.plugin.settings.dateFormat=i,await this.plugin.saveSettings()})})}async createFolderStructure(){let t=[this.plugin.settings.inboxFolder,this.plugin.settings.projectsFolder,this.plugin.settings.libraryFolder,this.plugin.settings.archivesFolder,this.plugin.settings.zettelFolder],e=0,n=0;for(let i of t){if(!i)continue;if(this.app.vault.getAbstractFileByPath(i))n++;else try{await this.app.vault.createFolder(i),e++}catch(r){console.error(`\uD3F4\uB354 \uC0DD\uC131 \uC2E4\uD328: ${i}`,r)}}e>0?new rt.Notice(`${e}\uAC1C \uD3F4\uB354 \uC0DD\uC131\uB428, ${n}\uAC1C \uC774\uBBF8 \uC874\uC7AC`):new rt.Notice(`\uBAA8\uB4E0 \uD3F4\uB354\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4 (${n}\uAC1C)`)}};var vE,AE;function wE(){return{geminiUrl:vE,vertexUrl:AE}}function TE(s,t,e,n){var i,o;if(!(s!=null&&s.baseUrl)){let r=wE();return t?(i=r.vertexUrl)!==null&&i!==void 0?i:e:(o=r.geminiUrl)!==null&&o!==void 0?o:n}return s.baseUrl}var ze=class{};function D(s,t){let e=/\{([^}]+)\}/g;return s.replace(e,(n,i)=>{if(Object.prototype.hasOwnProperty.call(t,i)){let o=t[i];return o!=null?String(o):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function f(s,t,e){for(let o=0;o<t.length-1;o++){let r=t[o];if(r.endsWith("[]")){let a=r.slice(0,-2);if(!(a in s))if(Array.isArray(e))s[a]=Array.from({length:e.length},()=>({}));else throw new Error(`Value must be a list given an array path ${r}`);if(Array.isArray(s[a])){let l=s[a];if(Array.isArray(e))for(let c=0;c<l.length;c++){let d=l[c];f(d,t.slice(o+1),e[c])}else for(let c of l)f(c,t.slice(o+1),e)}return}else if(r.endsWith("[0]")){let a=r.slice(0,-3);a in s||(s[a]=[{}]);let l=s[a];f(l[0],t.slice(o+1),e);return}(!s[r]||typeof s[r]!="object")&&(s[r]={}),s=s[r]}let n=t[t.length-1],i=s[n];if(i!==void 0){if(!e||typeof e=="object"&&Object.keys(e).length===0||e===i)return;if(typeof i=="object"&&typeof e=="object"&&i!==null&&e!==null)Object.assign(i,e);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof e=="object"&&e!==null&&!Array.isArray(e)?Object.assign(s,e):s[n]=e}function h(s,t,e=void 0){try{if(t.length===1&&t[0]==="_self")return s;for(let n=0;n<t.length;n++){if(typeof s!="object"||s===null)return e;let i=t[n];if(i.endsWith("[]")){let o=i.slice(0,-2);if(o in s){let r=s[o];return Array.isArray(r)?r.map(a=>h(a,t.slice(n+1),e)):e}else return e}else s=s[i]}return s}catch(n){if(n instanceof TypeError)return e;throw n}}function EE(s,t){for(let[e,n]of Object.entries(t)){let i=e.split("."),o=n.split("."),r=new Set,a=-1;for(let l=0;l<i.length;l++)if(i[l]==="*"){a=l;break}if(a!==-1&&o.length>a)for(let l=a;l<o.length;l++){let c=o[l];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&r.add(c)}Zp(s,i,o,0,r)}}function Zp(s,t,e,n,i){if(n>=t.length||typeof s!="object"||s===null)return;let o=t[n];if(o.endsWith("[]")){let r=o.slice(0,-2),a=s;if(r in a&&Array.isArray(a[r]))for(let l of a[r])Zp(l,t,e,n+1,i)}else if(o==="*"){if(typeof s=="object"&&s!==null&&!Array.isArray(s)){let r=s,a=Object.keys(r).filter(c=>!c.startsWith("_")&&!i.has(c)),l={};for(let c of a)l[c]=r[c];for(let[c,d]of Object.entries(l)){let p=[];for(let g of e.slice(n))g==="*"?p.push(c):p.push(g);f(r,p,d)}for(let c of a)delete r[c]}}else{let r=s;o in r&&Zp(r[o],t,e,n+1,i)}}function Jg(s){if(typeof s!="string")throw new Error("fromImageBytes must be a string");return s}function CE(s){let t={},e=h(s,["operationName"]);e!=null&&f(t,["operationName"],e);let n=h(s,["resourceName"]);return n!=null&&f(t,["_url","resourceName"],n),t}function SE(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response","generateVideoResponse"]);return r!=null&&f(t,["response"],xE(r)),t}function bE(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response"]);return r!=null&&f(t,["response"],IE(r)),t}function xE(s){let t={},e=h(s,["generatedSamples"]);if(e!=null){let o=e;Array.isArray(o)&&(o=o.map(r=>PE(r))),f(t,["generatedVideos"],o)}let n=h(s,["raiMediaFilteredCount"]);n!=null&&f(t,["raiMediaFilteredCount"],n);let i=h(s,["raiMediaFilteredReasons"]);return i!=null&&f(t,["raiMediaFilteredReasons"],i),t}function IE(s){let t={},e=h(s,["videos"]);if(e!=null){let o=e;Array.isArray(o)&&(o=o.map(r=>RE(r))),f(t,["generatedVideos"],o)}let n=h(s,["raiMediaFilteredCount"]);n!=null&&f(t,["raiMediaFilteredCount"],n);let i=h(s,["raiMediaFilteredReasons"]);return i!=null&&f(t,["raiMediaFilteredReasons"],i),t}function PE(s){let t={},e=h(s,["video"]);return e!=null&&f(t,["video"],LE(e)),t}function RE(s){let t={},e=h(s,["_self"]);return e!=null&&f(t,["video"],UE(e)),t}function ME(s){let t={},e=h(s,["operationName"]);return e!=null&&f(t,["_url","operationName"],e),t}function NE(s){let t={},e=h(s,["operationName"]);return e!=null&&f(t,["_url","operationName"],e),t}function kE(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response"]);return r!=null&&f(t,["response"],DE(r)),t}function DE(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["parent"]);n!=null&&f(t,["parent"],n);let i=h(s,["documentName"]);return i!=null&&f(t,["documentName"],i),t}function _A(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response"]);return r!=null&&f(t,["response"],FE(r)),t}function FE(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["parent"]);n!=null&&f(t,["parent"],n);let i=h(s,["documentName"]);return i!=null&&f(t,["documentName"],i),t}function LE(s){let t={},e=h(s,["uri"]);e!=null&&f(t,["uri"],e);let n=h(s,["encodedVideo"]);n!=null&&f(t,["videoBytes"],Jg(n));let i=h(s,["encoding"]);return i!=null&&f(t,["mimeType"],i),t}function UE(s){let t={},e=h(s,["gcsUri"]);e!=null&&f(t,["uri"],e);let n=h(s,["bytesBase64Encoded"]);n!=null&&f(t,["videoBytes"],Jg(n));let i=h(s,["mimeType"]);return i!=null&&f(t,["mimeType"],i),t}var J_;(function(s){s.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",s.OUTCOME_OK="OUTCOME_OK",s.OUTCOME_FAILED="OUTCOME_FAILED",s.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(J_||(J_={}));var X_;(function(s){s.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",s.PYTHON="PYTHON"})(X_||(X_={}));var Z_;(function(s){s.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",s.SILENT="SILENT",s.WHEN_IDLE="WHEN_IDLE",s.INTERRUPT="INTERRUPT"})(Z_||(Z_={}));var vi;(function(s){s.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",s.STRING="STRING",s.NUMBER="NUMBER",s.INTEGER="INTEGER",s.BOOLEAN="BOOLEAN",s.ARRAY="ARRAY",s.OBJECT="OBJECT",s.NULL="NULL"})(vi||(vi={}));var Q_;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(Q_||(Q_={}));var j_;(function(s){s.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",s.SIMPLE_SEARCH="SIMPLE_SEARCH",s.ELASTIC_SEARCH="ELASTIC_SEARCH"})(j_||(j_={}));var tv;(function(s){s.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",s.NO_AUTH="NO_AUTH",s.API_KEY_AUTH="API_KEY_AUTH",s.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",s.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",s.OAUTH="OAUTH",s.OIDC_AUTH="OIDC_AUTH"})(tv||(tv={}));var ev;(function(s){s.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",s.HTTP_IN_QUERY="HTTP_IN_QUERY",s.HTTP_IN_HEADER="HTTP_IN_HEADER",s.HTTP_IN_PATH="HTTP_IN_PATH",s.HTTP_IN_BODY="HTTP_IN_BODY",s.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(ev||(ev={}));var nv;(function(s){s.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",s.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",s.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",s.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(nv||(nv={}));var iv;(function(s){s.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH",s.MINIMAL="MINIMAL"})(iv||(iv={}));var sv;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",s.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",s.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",s.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",s.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(sv||(sv={}));var ov;(function(s){s.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",s.SEVERITY="SEVERITY",s.PROBABILITY="PROBABILITY"})(ov||(ov={}));var rv;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE",s.OFF="OFF"})(rv||(rv={}));var av;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.OTHER="OTHER",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.SPII="SPII",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.IMAGE_SAFETY="IMAGE_SAFETY",s.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",s.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",s.NO_IMAGE="NO_IMAGE",s.IMAGE_RECITATION="IMAGE_RECITATION",s.IMAGE_OTHER="IMAGE_OTHER"})(av||(av={}));var lv;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})(lv||(lv={}));var cv;(function(s){s.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",s.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",s.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",s.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",s.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(cv||(cv={}));var uv;(function(s){s.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",s.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",s.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",s.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",s.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(uv||(uv={}));var dv;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.IMAGE_SAFETY="IMAGE_SAFETY",s.MODEL_ARMOR="MODEL_ARMOR",s.JAILBREAK="JAILBREAK"})(dv||(dv={}));var hv;(function(s){s.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",s.ON_DEMAND="ON_DEMAND",s.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(hv||(hv={}));var Qu;(function(s){s.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",s.TEXT="TEXT",s.IMAGE="IMAGE",s.AUDIO="AUDIO"})(Qu||(Qu={}));var fv;(function(s){s.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",s.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",s.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",s.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(fv||(fv={}));var pv;(function(s){s.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",s.TUNING_MODE_FULL="TUNING_MODE_FULL",s.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(pv||(pv={}));var gv;(function(s){s.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",s.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",s.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",s.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",s.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",s.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",s.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(gv||(gv={}));var Qp;(function(s){s.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",s.JOB_STATE_QUEUED="JOB_STATE_QUEUED",s.JOB_STATE_PENDING="JOB_STATE_PENDING",s.JOB_STATE_RUNNING="JOB_STATE_RUNNING",s.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",s.JOB_STATE_FAILED="JOB_STATE_FAILED",s.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",s.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",s.JOB_STATE_PAUSED="JOB_STATE_PAUSED",s.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",s.JOB_STATE_UPDATING="JOB_STATE_UPDATING",s.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Qp||(Qp={}));var mv;(function(s){s.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",s.TUNING_TASK_I2V="TUNING_TASK_I2V",s.TUNING_TASK_T2V="TUNING_TASK_T2V",s.TUNING_TASK_R2V="TUNING_TASK_R2V"})(mv||(mv={}));var yv;(function(s){s.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",s.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",s.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",s.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",s.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(yv||(yv={}));var _v;(function(s){s.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",s.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",s.BALANCED="BALANCED",s.PRIORITIZE_COST="PRIORITIZE_COST"})(_v||(_v={}));var vv;(function(s){s.UNSPECIFIED="UNSPECIFIED",s.BLOCKING="BLOCKING",s.NON_BLOCKING="NON_BLOCKING"})(vv||(vv={}));var Av;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(Av||(Av={}));var wv;(function(s){s.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",s.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(wv||(wv={}));var Tv;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE",s.VALIDATED="VALIDATED"})(Tv||(Tv={}));var Ev;(function(s){s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(Ev||(Ev={}));var Cv;(function(s){s.DONT_ALLOW="DONT_ALLOW",s.ALLOW_ADULT="ALLOW_ADULT",s.ALLOW_ALL="ALLOW_ALL"})(Cv||(Cv={}));var Sv;(function(s){s.auto="auto",s.en="en",s.ja="ja",s.ko="ko",s.hi="hi",s.zh="zh",s.pt="pt",s.es="es"})(Sv||(Sv={}));var bv;(function(s){s.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",s.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",s.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",s.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",s.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(bv||(bv={}));var xv;(function(s){s.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",s.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",s.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",s.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(xv||(xv={}));var Iv;(function(s){s.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",s.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",s.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",s.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Iv||(Iv={}));var Pv;(function(s){s.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",s.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",s.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",s.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",s.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",s.EDIT_MODE_STYLE="EDIT_MODE_STYLE",s.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",s.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Pv||(Pv={}));var Rv;(function(s){s.FOREGROUND="FOREGROUND",s.BACKGROUND="BACKGROUND",s.PROMPT="PROMPT",s.SEMANTIC="SEMANTIC",s.INTERACTIVE="INTERACTIVE"})(Rv||(Rv={}));var Mv;(function(s){s.ASSET="ASSET",s.STYLE="STYLE"})(Mv||(Mv={}));var Nv;(function(s){s.INSERT="INSERT",s.REMOVE="REMOVE",s.REMOVE_STATIC="REMOVE_STATIC",s.OUTPAINT="OUTPAINT"})(Nv||(Nv={}));var kv;(function(s){s.OPTIMIZED="OPTIMIZED",s.LOSSLESS="LOSSLESS"})(kv||(kv={}));var Dv;(function(s){s.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",s.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Dv||(Dv={}));var Fv;(function(s){s.STATE_UNSPECIFIED="STATE_UNSPECIFIED",s.STATE_PENDING="STATE_PENDING",s.STATE_ACTIVE="STATE_ACTIVE",s.STATE_FAILED="STATE_FAILED"})(Fv||(Fv={}));var Lv;(function(s){s.STATE_UNSPECIFIED="STATE_UNSPECIFIED",s.PROCESSING="PROCESSING",s.ACTIVE="ACTIVE",s.FAILED="FAILED"})(Lv||(Lv={}));var Uv;(function(s){s.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",s.UPLOADED="UPLOADED",s.GENERATED="GENERATED"})(Uv||(Uv={}));var Ov;(function(s){s.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.RESPONSE_REJECTED="RESPONSE_REJECTED",s.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Ov||(Ov={}));var $v;(function(s){s.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",s.TEXT="TEXT",s.IMAGE="IMAGE",s.VIDEO="VIDEO",s.AUDIO="AUDIO",s.DOCUMENT="DOCUMENT"})($v||($v={}));var Gv;(function(s){s.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",s.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",s.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(Gv||(Gv={}));var Bv;(function(s){s.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",s.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",s.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Bv||(Bv={}));var Hv;(function(s){s.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",s.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",s.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Hv||(Hv={}));var Vv;(function(s){s.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",s.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",s.NO_INTERRUPTION="NO_INTERRUPTION"})(Vv||(Vv={}));var qv;(function(s){s.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",s.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",s.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(qv||(qv={}));var zv;(function(s){s.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",s.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",s.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",s.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",s.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",s.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",s.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",s.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",s.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",s.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",s.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",s.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",s.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(zv||(zv={}));var Wv;(function(s){s.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",s.QUALITY="QUALITY",s.DIVERSITY="DIVERSITY",s.VOCALIZATION="VOCALIZATION"})(Wv||(Wv={}));var Vo;(function(s){s.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",s.PLAY="PLAY",s.PAUSE="PAUSE",s.STOP="STOP",s.RESET_CONTEXT="RESET_CONTEXT"})(Vo||(Vo={}));var qa=class{constructor(t){let e={};for(let n of t.headers.entries())e[n[0]]=n[1];this.headers=e,this.responseInternal=t}json(){return this.responseInternal.json()}};var cs=class{get text(){var t,e,n,i,o,r,a,l;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",d=!1,p=[];for(let g of(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[m,_]of Object.entries(g))m!=="text"&&m!=="thought"&&m!=="thoughtSignature"&&(_!==null||_!==void 0)&&p.push(m);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;d=!0,c+=g.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?c:void 0}get data(){var t,e,n,i,o,r,a,l;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="",d=[];for(let p of(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[g,m]of Object.entries(p))g!=="inlineData"&&(m!==null||m!==void 0)&&d.push(g);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var t,e,n,i,o,r,a,l;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let c=(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var t,e,n,i,o,r,a,l,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let d=(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var t,e,n,i,o,r,a,l,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let d=(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.output}},ju=class{},td=class{},jp=class{},tg=class{},eg=class{},ng=class{},ed=class{},nd=class{},id=class{},ig=class{};var sd=class s{_fromAPIResponse({apiResponse:t,_isVertexAI:e}){let n=new s,i,o=t;return e?i=bE(o):i=SE(o),Object.assign(n,i),n}},od=class{},rd=class{},ad=class{},ld=class{},sg=class{},og=class{},rg=class{};var ag=class s{_fromAPIResponse({apiResponse:t,_isVertexAI:e}){let n=new s,o=kE(t);return Object.assign(n,o),n}},lg=class{},cg=class{},ug=class{};var cd=class{};var dg=class{get text(){var t,e,n;let i="",o=!1,r=[];for(let a of(n=(e=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||e===void 0?void 0:e.parts)!==null&&n!==void 0?n:[]){for(let[l,c]of Object.entries(a))l!=="text"&&l!=="thought"&&c!==null&&r.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;o=!0,i+=a.text}}return r.length>0&&console.warn(`there are non-text parts ${r} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?i:void 0}get data(){var t,e,n;let i="",o=[];for(let r of(n=(e=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||e===void 0?void 0:e.parts)!==null&&n!==void 0?n:[]){for(let[a,l]of Object.entries(r))a!=="inlineData"&&l!==null&&o.push(a);r.inlineData&&typeof r.inlineData.data=="string"&&(i+=atob(r.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}};var hg=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var fg=class s{_fromAPIResponse({apiResponse:t,_isVertexAI:e}){let n=new s,o=_A(t);return Object.assign(n,o),n}};function et(s,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw new Error("invalid model parameter");if(s.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function vA(s,t){let e=et(s,t);return e?e.startsWith("publishers/")&&s.isVertexAI()?`projects/${s.getProject()}/locations/${s.getLocation()}/${e}`:e.startsWith("models/")&&s.isVertexAI()?`projects/${s.getProject()}/locations/${s.getLocation()}/publishers/google/${e}`:e:""}function AA(s){return Array.isArray(s)?s.map(t=>ud(t)):[ud(s)]}function ud(s){if(typeof s=="object"&&s!==null)return s;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof s}`)}function wA(s){let t=ud(s);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function TA(s){let t=ud(s);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function Kv(s){if(s==null)throw new Error("PartUnion is required");if(typeof s=="object")return s;if(typeof s=="string")return{text:s};throw new Error(`Unsupported part type: ${typeof s}`)}function EA(s){if(s==null||Array.isArray(s)&&s.length===0)throw new Error("PartListUnion is required");return Array.isArray(s)?s.map(t=>Kv(t)):[Kv(s)]}function pg(s){return s!=null&&typeof s=="object"&&"parts"in s&&Array.isArray(s.parts)}function Yv(s){return s!=null&&typeof s=="object"&&"functionCall"in s}function Jv(s){return s!=null&&typeof s=="object"&&"functionResponse"in s}function Vt(s){if(s==null)throw new Error("ContentUnion is required");return pg(s)?s:{role:"user",parts:EA(s)}}function Xg(s,t){if(!t)return[];if(s.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let n=Vt(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(s.isVertexAI()){let e=Vt(t);return e.parts&&e.parts.length>0&&e.parts[0].text!==void 0?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>Vt(e)):[Vt(t)]}function Me(s){if(s==null||Array.isArray(s)&&s.length===0)throw new Error("contents are required");if(!Array.isArray(s)){if(Yv(s)||Jv(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Vt(s)]}let t=[],e=[],n=pg(s[0]);for(let i of s){let o=pg(i);if(o!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)t.push(i);else{if(Yv(i)||Jv(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");e.push(i)}}return n||t.push({role:"user",parts:EA(e)}),t}function OE(s,t){s.includes("null")&&(t.nullable=!0);let e=s.filter(n=>n!=="null");if(e.length===1)t.type=Object.values(vi).includes(e[0].toUpperCase())?e[0].toUpperCase():vi.TYPE_UNSPECIFIED;else{t.anyOf=[];for(let n of e)t.anyOf.push({type:Object.values(vi).includes(n.toUpperCase())?n.toUpperCase():vi.TYPE_UNSPECIFIED})}}function qo(s){let t={},e=["items"],n=["anyOf"],i=["properties"];if(s.type&&s.anyOf)throw new Error("type and anyOf cannot be both populated.");let o=s.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(t.nullable=!0,s=o[1]):o[1].type==="null"&&(t.nullable=!0,s=o[0])),s.type instanceof Array&&OE(s.type,t);for(let[r,a]of Object.entries(s))if(a!=null)if(r=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;t.type=Object.values(vi).includes(a.toUpperCase())?a.toUpperCase():vi.TYPE_UNSPECIFIED}else if(e.includes(r))t[r]=qo(a);else if(n.includes(r)){let l=[];for(let c of a){if(c.type=="null"){t.nullable=!0;continue}l.push(qo(c))}t[r]=l}else if(i.includes(r)){let l={};for(let[c,d]of Object.entries(a))l[c]=qo(d);t[r]=l}else{if(r==="additionalProperties")continue;t[r]=a}return t}function Zg(s){return qo(s)}function Qg(s){if(typeof s=="object")return s;if(typeof s=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:s}}};throw new Error(`Unsupported speechConfig type: ${typeof s}`)}function jg(s){if("multiSpeakerVoiceConfig"in s)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return s}function Yo(s){if(s.functionDeclarations)for(let t of s.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=qo(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=qo(t.response));return s}function Jo(s){if(s==null)throw new Error("tools is required");if(!Array.isArray(s))throw new Error("tools is required and must be an array of Tools");let t=[];for(let e of s)t.push(e);return t}function $E(s,t,e,n=1){let i=!t.startsWith(`${e}/`)&&t.split("/").length===n;return s.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${s.getProject()}/${t}`:t.startsWith(`${e}/`)?`projects/${s.getProject()}/locations/${s.getLocation()}/${t}`:i?`projects/${s.getProject()}/locations/${s.getLocation()}/${e}/${t}`:t:i?`${e}/${t}`:t}function On(s,t){if(typeof t!="string")throw new Error("name must be a string");return $E(s,t,"cachedContents")}function CA(s){switch(s){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return s}}function Ai(s){return Jg(s)}function GE(s){return s!=null&&typeof s=="object"&&"name"in s}function BE(s){return s!=null&&typeof s=="object"&&"video"in s}function HE(s){return s!=null&&typeof s=="object"&&"uri"in s}function SA(s){var t;let e;if(GE(s)&&(e=s.name),!(HE(s)&&(e=s.uri,e===void 0))&&!(BE(s)&&(e=(t=s.video)===null||t===void 0?void 0:t.uri,e===void 0))){if(typeof s=="string"&&(e=s),e===void 0)throw new Error("Could not extract file name from the provided input.");if(e.startsWith("https://")){let i=e.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${e}`);e=i[0]}else e.startsWith("files/")&&(e=e.split("files/")[1]);return e}}function bA(s,t){let e;return s.isVertexAI()?e=t?"publishers/google/models":"models":e=t?"models":"tunedModels",e}function xA(s){for(let t of["models","tunedModels","publisherModels"])if(VE(s,t))return s[t];return[]}function VE(s,t){return s!==null&&typeof s=="object"&&t in s}function qE(s,t={}){let e=s,n={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(n.responseJsonSchema=e.outputSchema),t.behavior&&(n.behavior=t.behavior),{functionDeclarations:[n]}}function zE(s,t={}){let e=[],n=new Set;for(let i of s){let o=i.name;if(n.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);n.add(o);let r=qE(i,t);r.functionDeclarations&&e.push(...r.functionDeclarations)}return{functionDeclarations:e}}function IA(s,t){let e;if(typeof t=="string")if(s.isVertexAI())if(t.startsWith("gs://"))e={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))e={format:"bigquery",bigqueryUri:t};else throw new Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))e={fileName:t};else throw new Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(s.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");e={inlinedRequests:t}}else e=t;let n=[e.gcsUri,e.bigqueryUri].filter(Boolean).length,i=[e.inlinedRequests,e.fileName].filter(Boolean).length;if(s.isVertexAI()){if(i>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return e}function WE(s){if(typeof s!="string")return s;let t=s;if(t.startsWith("gs://"))return{format:"jsonl",gcsUri:t};if(t.startsWith("bq://"))return{format:"bigquery",bigqueryUri:t};throw new Error(`Unsupported destination: ${t}`)}function PA(s){if(typeof s!="object"||s===null)return{};let t=s,e=t.inlinedResponses;if(typeof e!="object"||e===null)return s;let i=e.inlinedResponses;if(!Array.isArray(i)||i.length===0)return s;let o=!1;for(let r of i){if(typeof r!="object"||r===null)continue;let l=r.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){o=!0;break}}return o&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),s}function Xo(s,t){let e=t;if(!s.isVertexAI()){if(/batches\/[^/]+$/.test(e))return e.split("/").pop();throw new Error(`Invalid batch job name: ${e}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(e))return e.split("/").pop();if(/^\d+$/.test(e))return e;throw new Error(`Invalid batch job name: ${e}.`)}function RA(s){let t=s;return t==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":t==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":t==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":t==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":t==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":t==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":t==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":t}function KE(s){let t={},e=h(s,["responsesFile"]);e!=null&&f(t,["fileName"],e);let n=h(s,["inlinedResponses","inlinedResponses"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>x0(r))),f(t,["inlinedResponses"],o)}let i=h(s,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["inlinedEmbedContentResponses"],o)}return t}function YE(s){let t={},e=h(s,["predictionsFormat"]);e!=null&&f(t,["format"],e);let n=h(s,["gcsDestination","outputUriPrefix"]);n!=null&&f(t,["gcsUri"],n);let i=h(s,["bigqueryDestination","outputUri"]);return i!=null&&f(t,["bigqueryUri"],i),t}function JE(s){let t={},e=h(s,["format"]);e!=null&&f(t,["predictionsFormat"],e);let n=h(s,["gcsUri"]);n!=null&&f(t,["gcsDestination","outputUriPrefix"],n);let i=h(s,["bigqueryUri"]);if(i!=null&&f(t,["bigqueryDestination","outputUri"],i),h(s,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(h(s,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(h(s,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}function Xu(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata","displayName"]);n!=null&&f(t,["displayName"],n);let i=h(s,["metadata","state"]);i!=null&&f(t,["state"],RA(i));let o=h(s,["metadata","createTime"]);o!=null&&f(t,["createTime"],o);let r=h(s,["metadata","endTime"]);r!=null&&f(t,["endTime"],r);let a=h(s,["metadata","updateTime"]);a!=null&&f(t,["updateTime"],a);let l=h(s,["metadata","model"]);l!=null&&f(t,["model"],l);let c=h(s,["metadata","output"]);return c!=null&&f(t,["dest"],KE(PA(c))),t}function gg(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["displayName"]);n!=null&&f(t,["displayName"],n);let i=h(s,["state"]);i!=null&&f(t,["state"],RA(i));let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["createTime"]);r!=null&&f(t,["createTime"],r);let a=h(s,["startTime"]);a!=null&&f(t,["startTime"],a);let l=h(s,["endTime"]);l!=null&&f(t,["endTime"],l);let c=h(s,["updateTime"]);c!=null&&f(t,["updateTime"],c);let d=h(s,["model"]);d!=null&&f(t,["model"],d);let p=h(s,["inputConfig"]);p!=null&&f(t,["src"],XE(p));let g=h(s,["outputConfig"]);g!=null&&f(t,["dest"],YE(PA(g)));let m=h(s,["completionStats"]);return m!=null&&f(t,["completionStats"],m),t}function XE(s){let t={},e=h(s,["instancesFormat"]);e!=null&&f(t,["format"],e);let n=h(s,["gcsSource","uris"]);n!=null&&f(t,["gcsUri"],n);let i=h(s,["bigquerySource","inputUri"]);return i!=null&&f(t,["bigqueryUri"],i),t}function ZE(s,t){let e={};if(h(t,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(h(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(h(t,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let n=h(t,["fileName"]);n!=null&&f(e,["fileName"],n);let i=h(t,["inlinedRequests"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>b0(s,r))),f(e,["requests","requests"],o)}return e}function QE(s){let t={},e=h(s,["format"]);e!=null&&f(t,["instancesFormat"],e);let n=h(s,["gcsUri"]);n!=null&&f(t,["gcsSource","uris"],n);let i=h(s,["bigqueryUri"]);if(i!=null&&f(t,["bigquerySource","inputUri"],i),h(s,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(h(s,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return t}function jE(s){let t={},e=h(s,["data"]);if(e!=null&&f(t,["data"],e),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function t0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],Xo(s,n)),e}function e0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],Xo(s,n)),e}function n0(s){let t={},e=h(s,["content"]);e!=null&&f(t,["content"],e);let n=h(s,["citationMetadata"]);n!=null&&f(t,["citationMetadata"],i0(n));let i=h(s,["tokenCount"]);i!=null&&f(t,["tokenCount"],i);let o=h(s,["finishReason"]);o!=null&&f(t,["finishReason"],o);let r=h(s,["avgLogprobs"]);r!=null&&f(t,["avgLogprobs"],r);let a=h(s,["groundingMetadata"]);a!=null&&f(t,["groundingMetadata"],a);let l=h(s,["index"]);l!=null&&f(t,["index"],l);let c=h(s,["logprobsResult"]);c!=null&&f(t,["logprobsResult"],c);let d=h(s,["safetyRatings"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(m=>m)),f(t,["safetyRatings"],g)}let p=h(s,["urlContextMetadata"]);return p!=null&&f(t,["urlContextMetadata"],p),t}function i0(s){let t={},e=h(s,["citationSources"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(i=>i)),f(t,["citations"],n)}return t}function MA(s){let t={},e=h(s,["parts"]);if(e!=null){let i=e;Array.isArray(i)&&(i=i.map(o=>D0(o))),f(t,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(t,["role"],n),t}function s0(s,t){let e={},n=h(s,["displayName"]);if(t!==void 0&&n!=null&&f(t,["batch","displayName"],n),h(s,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return e}function o0(s,t){let e={},n=h(s,["displayName"]);t!==void 0&&n!=null&&f(t,["displayName"],n);let i=h(s,["dest"]);return t!==void 0&&i!=null&&f(t,["outputConfig"],JE(WE(i))),e}function Xv(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["src"]);i!=null&&f(e,["batch","inputConfig"],ZE(s,IA(s,i)));let o=h(t,["config"]);return o!=null&&s0(o,e),e}function r0(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["model"],et(s,n));let i=h(t,["src"]);i!=null&&f(e,["inputConfig"],QE(IA(s,i)));let o=h(t,["config"]);return o!=null&&o0(o,e),e}function a0(s,t){let e={},n=h(s,["displayName"]);return t!==void 0&&n!=null&&f(t,["batch","displayName"],n),e}function l0(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["src"]);i!=null&&f(e,["batch","inputConfig"],g0(s,i));let o=h(t,["config"]);return o!=null&&a0(o,e),e}function c0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],Xo(s,n)),e}function u0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],Xo(s,n)),e}function d0(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["name"]);n!=null&&f(t,["name"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);return o!=null&&f(t,["error"],o),t}function h0(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["name"]);n!=null&&f(t,["name"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);return o!=null&&f(t,["error"],o),t}function f0(s,t){let e={},n=h(t,["contents"]);if(n!=null){let o=Xg(s,n);Array.isArray(o)&&(o=o.map(r=>r)),f(e,["requests[]","request","content"],o)}let i=h(t,["config"]);return i!=null&&(f(e,["_self"],p0(i,e)),EE(e,{"requests[].*":"requests[].request.*"})),e}function p0(s,t){let e={},n=h(s,["taskType"]);t!==void 0&&n!=null&&f(t,["requests[]","taskType"],n);let i=h(s,["title"]);t!==void 0&&i!=null&&f(t,["requests[]","title"],i);let o=h(s,["outputDimensionality"]);if(t!==void 0&&o!=null&&f(t,["requests[]","outputDimensionality"],o),h(s,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(h(s,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return e}function g0(s,t){let e={},n=h(t,["fileName"]);n!=null&&f(e,["file_name"],n);let i=h(t,["inlinedRequests"]);return i!=null&&f(e,["requests"],f0(s,i)),e}function m0(s){let t={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let e=h(s,["fileUri"]);e!=null&&f(t,["fileUri"],e);let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function y0(s){let t={},e=h(s,["id"]);e!=null&&f(t,["id"],e);let n=h(s,["args"]);n!=null&&f(t,["args"],n);let i=h(s,["name"]);if(i!=null&&f(t,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function _0(s){let t={},e=h(s,["mode"]);e!=null&&f(t,["mode"],e);let n=h(s,["allowedFunctionNames"]);if(n!=null&&f(t,["allowedFunctionNames"],n),h(s,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function v0(s,t,e){let n={},i=h(t,["systemInstruction"]);e!==void 0&&i!=null&&f(e,["systemInstruction"],MA(Vt(i)));let o=h(t,["temperature"]);o!=null&&f(n,["temperature"],o);let r=h(t,["topP"]);r!=null&&f(n,["topP"],r);let a=h(t,["topK"]);a!=null&&f(n,["topK"],a);let l=h(t,["candidateCount"]);l!=null&&f(n,["candidateCount"],l);let c=h(t,["maxOutputTokens"]);c!=null&&f(n,["maxOutputTokens"],c);let d=h(t,["stopSequences"]);d!=null&&f(n,["stopSequences"],d);let p=h(t,["responseLogprobs"]);p!=null&&f(n,["responseLogprobs"],p);let g=h(t,["logprobs"]);g!=null&&f(n,["logprobs"],g);let m=h(t,["presencePenalty"]);m!=null&&f(n,["presencePenalty"],m);let _=h(t,["frequencyPenalty"]);_!=null&&f(n,["frequencyPenalty"],_);let A=h(t,["seed"]);A!=null&&f(n,["seed"],A);let T=h(t,["responseMimeType"]);T!=null&&f(n,["responseMimeType"],T);let E=h(t,["responseSchema"]);E!=null&&f(n,["responseSchema"],Zg(E));let C=h(t,["responseJsonSchema"]);if(C!=null&&f(n,["responseJsonSchema"],C),h(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(h(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let S=h(t,["safetySettings"]);if(e!==void 0&&S!=null){let z=S;Array.isArray(z)&&(z=z.map(W=>F0(W))),f(e,["safetySettings"],z)}let b=h(t,["tools"]);if(e!==void 0&&b!=null){let z=Jo(b);Array.isArray(z)&&(z=z.map(W=>U0(Yo(W)))),f(e,["tools"],z)}let x=h(t,["toolConfig"]);if(e!==void 0&&x!=null&&f(e,["toolConfig"],L0(x)),h(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let P=h(t,["cachedContent"]);e!==void 0&&P!=null&&f(e,["cachedContent"],On(s,P));let I=h(t,["responseModalities"]);I!=null&&f(n,["responseModalities"],I);let N=h(t,["mediaResolution"]);N!=null&&f(n,["mediaResolution"],N);let M=h(t,["speechConfig"]);if(M!=null&&f(n,["speechConfig"],Qg(M)),h(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=h(t,["thinkingConfig"]);F!=null&&f(n,["thinkingConfig"],F);let U=h(t,["imageConfig"]);U!=null&&f(n,["imageConfig"],S0(U));let j=h(t,["enableEnhancedCivicAnswers"]);return j!=null&&f(n,["enableEnhancedCivicAnswers"],j),n}function A0(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>n0(c))),f(t,["candidates"],l)}let i=h(s,["modelVersion"]);i!=null&&f(t,["modelVersion"],i);let o=h(s,["promptFeedback"]);o!=null&&f(t,["promptFeedback"],o);let r=h(s,["responseId"]);r!=null&&f(t,["responseId"],r);let a=h(s,["usageMetadata"]);return a!=null&&f(t,["usageMetadata"],a),t}function w0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],Xo(s,n)),e}function T0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],Xo(s,n)),e}function E0(s){let t={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let e=h(s,["enableWidget"]);return e!=null&&f(t,["enableWidget"],e),t}function C0(s){let t={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let e=h(s,["timeRangeFilter"]);return e!=null&&f(t,["timeRangeFilter"],e),t}function S0(s){let t={},e=h(s,["aspectRatio"]);e!=null&&f(t,["aspectRatio"],e);let n=h(s,["imageSize"]);if(n!=null&&f(t,["imageSize"],n),h(s,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(h(s,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function b0(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["request","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let a=Me(i);Array.isArray(a)&&(a=a.map(l=>MA(l))),f(e,["request","contents"],a)}let o=h(t,["metadata"]);o!=null&&f(e,["metadata"],o);let r=h(t,["config"]);return r!=null&&f(e,["request","generationConfig"],v0(s,r,h(e,["request"],{}))),e}function x0(s){let t={},e=h(s,["response"]);e!=null&&f(t,["response"],A0(e));let n=h(s,["error"]);return n!=null&&f(t,["error"],n),t}function I0(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);if(t!==void 0&&i!=null&&f(t,["_query","pageToken"],i),h(s,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return e}function P0(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);t!==void 0&&i!=null&&f(t,["_query","pageToken"],i);let o=h(s,["filter"]);return t!==void 0&&o!=null&&f(t,["_query","filter"],o),e}function R0(s){let t={},e=h(s,["config"]);return e!=null&&I0(e,t),t}function M0(s){let t={},e=h(s,["config"]);return e!=null&&P0(e,t),t}function N0(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["operations"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>Xu(r))),f(t,["batchJobs"],o)}return t}function k0(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["batchPredictionJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>gg(r))),f(t,["batchJobs"],o)}return t}function D0(s){let t={},e=h(s,["mediaResolution"]);e!=null&&f(t,["mediaResolution"],e);let n=h(s,["codeExecutionResult"]);n!=null&&f(t,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(t,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(t,["fileData"],m0(o));let r=h(s,["functionCall"]);r!=null&&f(t,["functionCall"],y0(r));let a=h(s,["functionResponse"]);a!=null&&f(t,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(t,["inlineData"],jE(l));let c=h(s,["text"]);c!=null&&f(t,["text"],c);let d=h(s,["thought"]);d!=null&&f(t,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(t,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(t,["videoMetadata"],g),t}function F0(s){let t={},e=h(s,["category"]);if(e!=null&&f(t,["category"],e),h(s,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=h(s,["threshold"]);return n!=null&&f(t,["threshold"],n),t}function L0(s){let t={},e=h(s,["functionCallingConfig"]);e!=null&&f(t,["functionCallingConfig"],_0(e));let n=h(s,["retrievalConfig"]);return n!=null&&f(t,["retrievalConfig"],n),t}function U0(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let d=e;Array.isArray(d)&&(d=d.map(p=>p)),f(t,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(t,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(t,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(t,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(t,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(t,["googleMaps"],E0(a));let l=h(s,["googleSearch"]);l!=null&&f(t,["googleSearch"],C0(l));let c=h(s,["urlContext"]);return c!=null&&f(t,["urlContext"],c),t}var Ln;(function(s){s.PAGED_ITEM_BATCH_JOBS="batchJobs",s.PAGED_ITEM_MODELS="models",s.PAGED_ITEM_TUNING_JOBS="tuningJobs",s.PAGED_ITEM_FILES="files",s.PAGED_ITEM_CACHED_CONTENTS="cachedContents",s.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",s.PAGED_ITEM_DOCUMENTS="documents"})(Ln||(Ln={}));var Un=class{constructor(t,e,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=e,this.init(t,n,i)}init(t,e,n){var i,o;this.nameInternal=t,this.pageInternal=e[this.nameInternal]||[],this.sdkHttpResponseInternal=e==null?void 0:e.sdkHttpResponse,this.idxInternal=0;let r={config:{}};!n||Object.keys(n).length===0?r={config:{}}:typeof n=="object"?r=Object.assign({},n):r=n,r.config&&(r.config.pageToken=e.nextPageToken),this.paramsInternal=r,this.pageInternalSize=(o=(i=r.config)===null||i===void 0?void 0:i.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}};var mg=class extends ze{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new Un(Ln.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(e),e),this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)}}createInlinedGenerateContentRequest(t){let e=Xv(this.apiClient,t),n=e._url,i=D("{model}:batchGenerateContent",n),a=e.batch.inputConfig.requests,l=a.requests,c=[];for(let d of l){let p=Object.assign({},d);if(p.systemInstruction){let g=p.systemInstruction;delete p.systemInstruction;let m=p.request;m.systemInstruction=g,p.request=m}c.push(p)}return a.requests=c,delete e.config,delete e._url,delete e._query,{path:i,body:e}}getGcsUri(t){if(typeof t=="string")return t.startsWith("gs://")?t:void 0;if(!Array.isArray(t)&&t.gcsUri&&t.gcsUri.length>0)return t.gcsUri[0]}getBigqueryUri(t){if(typeof t=="string")return t.startsWith("bq://")?t:void 0;if(!Array.isArray(t))return t.bigqueryUri}formatDestination(t,e){let n=e?Object.assign({},e):{},i=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${i}`),n.dest===void 0){let o=this.getGcsUri(t),r=this.getBigqueryUri(t);if(o)o.endsWith(".jsonl")?n.dest=`${o.slice(0,-6)}/dest`:n.dest=`${o}_dest_${i}`;else if(r)n.dest=`${r}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=r0(this.apiClient,t);return a=D("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>gg(d))}else{let c=Xv(this.apiClient,t);return a=D("{model}:batchGenerateContent",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>Xu(d))}}async createEmbeddingsInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=l0(this.apiClient,t);return o=D("{model}:asyncBatchEmbedContent",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>Xu(l))}}async get(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=T0(this.apiClient,t);return a=D("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>gg(d))}else{let c=w0(this.apiClient,t);return a=D("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>Xu(d))}}async cancel(t){var e,n,i,o;let r="",a={};if(this.apiClient.isVertexAI()){let l=e0(this.apiClient,t);r=D("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal})}else{let l=t0(this.apiClient,t);r=D("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=M0(t);return a=D("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=k0(d),g=new cd;return Object.assign(g,p),g})}else{let c=R0(t);return a=D("batches",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=N0(d),g=new cd;return Object.assign(g,p),g})}}async delete(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=u0(this.apiClient,t);return a=D("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>h0(d))}else{let c=c0(this.apiClient,t);return a=D("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>d0(d))}}};function O0(s){let t={},e=h(s,["data"]);if(e!=null&&f(t,["data"],e),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function Zv(s){let t={},e=h(s,["parts"]);if(e!=null){let i=e;Array.isArray(i)&&(i=i.map(o=>aC(o))),f(t,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(t,["role"],n),t}function $0(s,t){let e={},n=h(s,["ttl"]);t!==void 0&&n!=null&&f(t,["ttl"],n);let i=h(s,["expireTime"]);t!==void 0&&i!=null&&f(t,["expireTime"],i);let o=h(s,["displayName"]);t!==void 0&&o!=null&&f(t,["displayName"],o);let r=h(s,["contents"]);if(t!==void 0&&r!=null){let d=Me(r);Array.isArray(d)&&(d=d.map(p=>Zv(p))),f(t,["contents"],d)}let a=h(s,["systemInstruction"]);t!==void 0&&a!=null&&f(t,["systemInstruction"],Zv(Vt(a)));let l=h(s,["tools"]);if(t!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(p=>cC(p))),f(t,["tools"],d)}let c=h(s,["toolConfig"]);if(t!==void 0&&c!=null&&f(t,["toolConfig"],lC(c)),h(s,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return e}function G0(s,t){let e={},n=h(s,["ttl"]);t!==void 0&&n!=null&&f(t,["ttl"],n);let i=h(s,["expireTime"]);t!==void 0&&i!=null&&f(t,["expireTime"],i);let o=h(s,["displayName"]);t!==void 0&&o!=null&&f(t,["displayName"],o);let r=h(s,["contents"]);if(t!==void 0&&r!=null){let p=Me(r);Array.isArray(p)&&(p=p.map(g=>g)),f(t,["contents"],p)}let a=h(s,["systemInstruction"]);t!==void 0&&a!=null&&f(t,["systemInstruction"],Vt(a));let l=h(s,["tools"]);if(t!==void 0&&l!=null){let p=l;Array.isArray(p)&&(p=p.map(g=>uC(g))),f(t,["tools"],p)}let c=h(s,["toolConfig"]);t!==void 0&&c!=null&&f(t,["toolConfig"],c);let d=h(s,["kmsKeyName"]);return t!==void 0&&d!=null&&f(t,["encryption_spec","kmsKeyName"],d),e}function B0(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["model"],vA(s,n));let i=h(t,["config"]);return i!=null&&$0(i,e),e}function H0(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["model"],vA(s,n));let i=h(t,["config"]);return i!=null&&G0(i,e),e}function V0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],On(s,n)),e}function q0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],On(s,n)),e}function z0(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}function W0(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}function K0(s){let t={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let e=h(s,["fileUri"]);e!=null&&f(t,["fileUri"],e);let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function Y0(s){let t={},e=h(s,["id"]);e!=null&&f(t,["id"],e);let n=h(s,["args"]);n!=null&&f(t,["args"],n);let i=h(s,["name"]);if(i!=null&&f(t,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function J0(s){let t={},e=h(s,["mode"]);e!=null&&f(t,["mode"],e);let n=h(s,["allowedFunctionNames"]);if(n!=null&&f(t,["allowedFunctionNames"],n),h(s,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function X0(s){let t={};if(h(s,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let e=h(s,["description"]);e!=null&&f(t,["description"],e);let n=h(s,["name"]);n!=null&&f(t,["name"],n);let i=h(s,["parameters"]);i!=null&&f(t,["parameters"],i);let o=h(s,["parametersJsonSchema"]);o!=null&&f(t,["parametersJsonSchema"],o);let r=h(s,["response"]);r!=null&&f(t,["response"],r);let a=h(s,["responseJsonSchema"]);return a!=null&&f(t,["responseJsonSchema"],a),t}function Z0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],On(s,n)),e}function Q0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],On(s,n)),e}function j0(s){let t={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let e=h(s,["enableWidget"]);return e!=null&&f(t,["enableWidget"],e),t}function tC(s){let t={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let e=h(s,["timeRangeFilter"]);return e!=null&&f(t,["timeRangeFilter"],e),t}function eC(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);return t!==void 0&&i!=null&&f(t,["_query","pageToken"],i),e}function nC(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);return t!==void 0&&i!=null&&f(t,["_query","pageToken"],i),e}function iC(s){let t={},e=h(s,["config"]);return e!=null&&eC(e,t),t}function sC(s){let t={},e=h(s,["config"]);return e!=null&&nC(e,t),t}function oC(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["cachedContents"],o)}return t}function rC(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["cachedContents"],o)}return t}function aC(s){let t={},e=h(s,["mediaResolution"]);e!=null&&f(t,["mediaResolution"],e);let n=h(s,["codeExecutionResult"]);n!=null&&f(t,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(t,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(t,["fileData"],K0(o));let r=h(s,["functionCall"]);r!=null&&f(t,["functionCall"],Y0(r));let a=h(s,["functionResponse"]);a!=null&&f(t,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(t,["inlineData"],O0(l));let c=h(s,["text"]);c!=null&&f(t,["text"],c);let d=h(s,["thought"]);d!=null&&f(t,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(t,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(t,["videoMetadata"],g),t}function lC(s){let t={},e=h(s,["functionCallingConfig"]);e!=null&&f(t,["functionCallingConfig"],J0(e));let n=h(s,["retrievalConfig"]);return n!=null&&f(t,["retrievalConfig"],n),t}function cC(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let d=e;Array.isArray(d)&&(d=d.map(p=>p)),f(t,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(t,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(t,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(t,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(t,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(t,["googleMaps"],j0(a));let l=h(s,["googleSearch"]);l!=null&&f(t,["googleSearch"],tC(l));let c=h(s,["urlContext"]);return c!=null&&f(t,["urlContext"],c),t}function uC(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let p=e;Array.isArray(p)&&(p=p.map(g=>X0(g))),f(t,["functionDeclarations"],p)}let n=h(s,["retrieval"]);n!=null&&f(t,["retrieval"],n);let i=h(s,["googleSearchRetrieval"]);i!=null&&f(t,["googleSearchRetrieval"],i);let o=h(s,["computerUse"]);if(o!=null&&f(t,["computerUse"],o),h(s,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=h(s,["codeExecution"]);r!=null&&f(t,["codeExecution"],r);let a=h(s,["enterpriseWebSearch"]);a!=null&&f(t,["enterpriseWebSearch"],a);let l=h(s,["googleMaps"]);l!=null&&f(t,["googleMaps"],l);let c=h(s,["googleSearch"]);c!=null&&f(t,["googleSearch"],c);let d=h(s,["urlContext"]);return d!=null&&f(t,["urlContext"],d),t}function dC(s,t){let e={},n=h(s,["ttl"]);t!==void 0&&n!=null&&f(t,["ttl"],n);let i=h(s,["expireTime"]);return t!==void 0&&i!=null&&f(t,["expireTime"],i),e}function hC(s,t){let e={},n=h(s,["ttl"]);t!==void 0&&n!=null&&f(t,["ttl"],n);let i=h(s,["expireTime"]);return t!==void 0&&i!=null&&f(t,["expireTime"],i),e}function fC(s,t){let e={},n=h(t,["name"]);n!=null&&f(e,["_url","name"],On(s,n));let i=h(t,["config"]);return i!=null&&dC(i,e),e}function pC(s,t){let e={},n=h(t,["name"]);n!=null&&f(e,["_url","name"],On(s,n));let i=h(t,["config"]);return i!=null&&hC(i,e),e}var yg=class extends ze{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new Un(Ln.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(e),e)}async create(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=H0(this.apiClient,t);return a=D("cachedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>d)}else{let c=B0(this.apiClient,t);return a=D("cachedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>d)}}async get(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=Q0(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>d)}else{let c=Z0(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>d)}}async delete(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=q0(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=W0(d),g=new ad;return Object.assign(g,p),g})}else{let c=V0(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=z0(d),g=new ad;return Object.assign(g,p),g})}}async update(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=pC(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>d)}else{let c=fC(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>d)}}async listInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=sC(t);return a=D("cachedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=rC(d),g=new ld;return Object.assign(g,p),g})}else{let c=iC(t);return a=D("cachedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=oC(d),g=new ld;return Object.assign(g,p),g})}}};function dd(s,t){var e={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&t.indexOf(n)<0&&(e[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(s);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(s,n[i])&&(e[n[i]]=s[n[i]]);return e}function Qv(s){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&s[t],n=0;if(e)return e.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function q(s){return this instanceof q?(this.v=s,this):new q(s)}function Ve(s,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(s,t||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",r),i[Symbol.asyncIterator]=function(){return this},i;function r(m){return function(_){return Promise.resolve(_).then(m,p)}}function a(m,_){n[m]&&(i[m]=function(A){return new Promise(function(T,E){o.push([m,A,T,E])>1||l(m,A)})},_&&(i[m]=_(i[m])))}function l(m,_){try{c(n[m](_))}catch(A){g(o[0][3],A)}}function c(m){m.value instanceof q?Promise.resolve(m.value.v).then(d,p):g(o[0][2],m)}function d(m){l("next",m)}function p(m){l("throw",m)}function g(m,_){m(_),o.shift(),o.length&&l(o[0][0],o[0][1])}}function qe(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],e;return t?t.call(s):(s=typeof Qv=="function"?Qv(s):s[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(o){e[o]=s[o]&&function(r){return new Promise(function(a,l){r=s[o](r),i(a,l,r.done,r.value)})}}function i(o,r,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},r)}}function gC(s){var t;if(s.candidates==null||s.candidates.length===0)return!1;let e=(t=s.candidates[0])===null||t===void 0?void 0:t.content;return e===void 0?!1:NA(e)}function NA(s){if(s.parts===void 0||s.parts.length===0)return!1;for(let t of s.parts)if(t===void 0||Object.keys(t).length===0)return!1;return!0}function mC(s){if(s.length!==0){for(let t of s)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function jv(s){if(s===void 0||s.length===0)return[];let t=[],e=s.length,n=0;for(;n<e;)if(s[n].role==="user")t.push(s[n]),n++;else{let i=[],o=!0;for(;n<e&&s[n].role==="model";)i.push(s[n]),o&&!NA(s[n])&&(o=!1),n++;o?t.push(...i):t.pop()}return t}var _g=class{constructor(t,e){this.modelsModule=t,this.apiClient=e}create(t){return new vg(this.apiClient,this.modelsModule,t.model,t.config,structuredClone(t.history))}},vg=class{constructor(t,e,n,i={},o=[]){this.apiClient=t,this.modelsModule=e,this.model=n,this.config=i,this.history=o,this.sendPromise=Promise.resolve(),mC(o)}async sendMessage(t){var e;await this.sendPromise;let n=Vt(t.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});return this.sendPromise=(async()=>{var o,r,a;let l=await i,c=(r=(o=l.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content,d=l.automaticFunctionCallingHistory,p=this.getHistory(!0).length,g=[];d!=null&&(g=(a=d.slice(p))!==null&&a!==void 0?a:[]);let m=c?[c]:[];this.recordHistory(n,m,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(t){var e;await this.sendPromise;let n=Vt(t.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});let o=await i;return this.processStreamResponse(o,n)}getHistory(t=!1){let e=t?jv(this.history):this.history;return structuredClone(e)}processStreamResponse(t,e){return Ve(this,arguments,function*(){var i,o,r,a,l,c;let d=[];try{for(var p=!0,g=qe(t),m;m=yield q(g.next()),i=m.done,!i;p=!0){a=m.value,p=!1;let _=a;if(gC(_)){let A=(c=(l=_.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content;A!==void 0&&d.push(A)}yield yield q(_)}}catch(_){o={error:_}}finally{try{!p&&!i&&(r=g.return)&&(yield q(r.call(g)))}finally{if(o)throw o.error}}this.recordHistory(e,d)})}recordHistory(t,e,n){let i=[];e.length>0&&e.every(o=>o.role!==void 0)?i=e:i.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...jv(n)):this.history.push(t),this.history.push(...i)}};var hd=class s extends Error{constructor(t){super(t.message),this.name="ApiError",this.status=t.status,Object.setPrototypeOf(this,s.prototype)}};function yC(s){let t={},e=h(s,["file"]);return e!=null&&f(t,["file"],e),t}function _C(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}function vC(s){let t={},e=h(s,["name"]);return e!=null&&f(t,["_url","file"],SA(e)),t}function AC(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}function wC(s){let t={},e=h(s,["name"]);return e!=null&&f(t,["_url","file"],SA(e)),t}function TC(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);return t!==void 0&&i!=null&&f(t,["_query","pageToken"],i),e}function EC(s){let t={},e=h(s,["config"]);return e!=null&&TC(e,t),t}function CC(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["files"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["files"],o)}return t}var Ag=class extends ze{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new Un(Ln.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(e),e)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(e=>e)}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=EC(t);return o=D("files",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=CC(l),d=new lg;return Object.assign(d,c),d})}}async createInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=yC(t);return o=D("upload/v1beta/files",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=_C(l),d=new cg;return Object.assign(d,c),d})}}async get(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=wC(t);return o=D("files/{file}",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=vC(t);return o=D("files/{file}",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=AC(l),d=new ug;return Object.assign(d,c),d})}}};function Zu(s){let t={},e=h(s,["data"]);if(e!=null&&f(t,["data"],e),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function SC(s){let t={},e=h(s,["parts"]);if(e!=null){let i=e;Array.isArray(i)&&(i=i.map(o=>BC(o))),f(t,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(t,["role"],n),t}function bC(s){let t={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let e=h(s,["fileUri"]);e!=null&&f(t,["fileUri"],e);let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function xC(s){let t={},e=h(s,["id"]);e!=null&&f(t,["id"],e);let n=h(s,["args"]);n!=null&&f(t,["args"],n);let i=h(s,["name"]);if(i!=null&&f(t,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function IC(s){let t={};if(h(s,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let e=h(s,["description"]);e!=null&&f(t,["description"],e);let n=h(s,["name"]);n!=null&&f(t,["name"],n);let i=h(s,["parameters"]);i!=null&&f(t,["parameters"],i);let o=h(s,["parametersJsonSchema"]);o!=null&&f(t,["parametersJsonSchema"],o);let r=h(s,["response"]);r!=null&&f(t,["response"],r);let a=h(s,["responseJsonSchema"]);return a!=null&&f(t,["responseJsonSchema"],a),t}function PC(s){let t={},e=h(s,["modelSelectionConfig"]);e!=null&&f(t,["modelConfig"],e);let n=h(s,["responseJsonSchema"]);n!=null&&f(t,["responseJsonSchema"],n);let i=h(s,["audioTimestamp"]);i!=null&&f(t,["audioTimestamp"],i);let o=h(s,["candidateCount"]);o!=null&&f(t,["candidateCount"],o);let r=h(s,["enableAffectiveDialog"]);r!=null&&f(t,["enableAffectiveDialog"],r);let a=h(s,["frequencyPenalty"]);a!=null&&f(t,["frequencyPenalty"],a);let l=h(s,["logprobs"]);l!=null&&f(t,["logprobs"],l);let c=h(s,["maxOutputTokens"]);c!=null&&f(t,["maxOutputTokens"],c);let d=h(s,["mediaResolution"]);d!=null&&f(t,["mediaResolution"],d);let p=h(s,["presencePenalty"]);p!=null&&f(t,["presencePenalty"],p);let g=h(s,["responseLogprobs"]);g!=null&&f(t,["responseLogprobs"],g);let m=h(s,["responseMimeType"]);m!=null&&f(t,["responseMimeType"],m);let _=h(s,["responseModalities"]);_!=null&&f(t,["responseModalities"],_);let A=h(s,["responseSchema"]);A!=null&&f(t,["responseSchema"],A);let T=h(s,["routingConfig"]);T!=null&&f(t,["routingConfig"],T);let E=h(s,["seed"]);E!=null&&f(t,["seed"],E);let C=h(s,["speechConfig"]);C!=null&&f(t,["speechConfig"],C);let S=h(s,["stopSequences"]);S!=null&&f(t,["stopSequences"],S);let b=h(s,["temperature"]);b!=null&&f(t,["temperature"],b);let x=h(s,["thinkingConfig"]);x!=null&&f(t,["thinkingConfig"],x);let P=h(s,["topK"]);P!=null&&f(t,["topK"],P);let I=h(s,["topP"]);if(I!=null&&f(t,["topP"],I),h(s,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function RC(s){let t={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let e=h(s,["enableWidget"]);return e!=null&&f(t,["enableWidget"],e),t}function MC(s){let t={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let e=h(s,["timeRangeFilter"]);return e!=null&&f(t,["timeRangeFilter"],e),t}function NC(s,t){let e={},n=h(s,["generationConfig"]);t!==void 0&&n!=null&&f(t,["setup","generationConfig"],n);let i=h(s,["responseModalities"]);t!==void 0&&i!=null&&f(t,["setup","generationConfig","responseModalities"],i);let o=h(s,["temperature"]);t!==void 0&&o!=null&&f(t,["setup","generationConfig","temperature"],o);let r=h(s,["topP"]);t!==void 0&&r!=null&&f(t,["setup","generationConfig","topP"],r);let a=h(s,["topK"]);t!==void 0&&a!=null&&f(t,["setup","generationConfig","topK"],a);let l=h(s,["maxOutputTokens"]);t!==void 0&&l!=null&&f(t,["setup","generationConfig","maxOutputTokens"],l);let c=h(s,["mediaResolution"]);t!==void 0&&c!=null&&f(t,["setup","generationConfig","mediaResolution"],c);let d=h(s,["seed"]);t!==void 0&&d!=null&&f(t,["setup","generationConfig","seed"],d);let p=h(s,["speechConfig"]);t!==void 0&&p!=null&&f(t,["setup","generationConfig","speechConfig"],jg(p));let g=h(s,["thinkingConfig"]);t!==void 0&&g!=null&&f(t,["setup","generationConfig","thinkingConfig"],g);let m=h(s,["enableAffectiveDialog"]);t!==void 0&&m!=null&&f(t,["setup","generationConfig","enableAffectiveDialog"],m);let _=h(s,["systemInstruction"]);t!==void 0&&_!=null&&f(t,["setup","systemInstruction"],SC(Vt(_)));let A=h(s,["tools"]);if(t!==void 0&&A!=null){let P=Jo(A);Array.isArray(P)&&(P=P.map(I=>VC(Yo(I)))),f(t,["setup","tools"],P)}let T=h(s,["sessionResumption"]);t!==void 0&&T!=null&&f(t,["setup","sessionResumption"],HC(T));let E=h(s,["inputAudioTranscription"]);t!==void 0&&E!=null&&f(t,["setup","inputAudioTranscription"],E);let C=h(s,["outputAudioTranscription"]);t!==void 0&&C!=null&&f(t,["setup","outputAudioTranscription"],C);let S=h(s,["realtimeInputConfig"]);t!==void 0&&S!=null&&f(t,["setup","realtimeInputConfig"],S);let b=h(s,["contextWindowCompression"]);t!==void 0&&b!=null&&f(t,["setup","contextWindowCompression"],b);let x=h(s,["proactivity"]);if(t!==void 0&&x!=null&&f(t,["setup","proactivity"],x),h(s,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return e}function kC(s,t){let e={},n=h(s,["generationConfig"]);t!==void 0&&n!=null&&f(t,["setup","generationConfig"],PC(n));let i=h(s,["responseModalities"]);t!==void 0&&i!=null&&f(t,["setup","generationConfig","responseModalities"],i);let o=h(s,["temperature"]);t!==void 0&&o!=null&&f(t,["setup","generationConfig","temperature"],o);let r=h(s,["topP"]);t!==void 0&&r!=null&&f(t,["setup","generationConfig","topP"],r);let a=h(s,["topK"]);t!==void 0&&a!=null&&f(t,["setup","generationConfig","topK"],a);let l=h(s,["maxOutputTokens"]);t!==void 0&&l!=null&&f(t,["setup","generationConfig","maxOutputTokens"],l);let c=h(s,["mediaResolution"]);t!==void 0&&c!=null&&f(t,["setup","generationConfig","mediaResolution"],c);let d=h(s,["seed"]);t!==void 0&&d!=null&&f(t,["setup","generationConfig","seed"],d);let p=h(s,["speechConfig"]);t!==void 0&&p!=null&&f(t,["setup","generationConfig","speechConfig"],jg(p));let g=h(s,["thinkingConfig"]);t!==void 0&&g!=null&&f(t,["setup","generationConfig","thinkingConfig"],g);let m=h(s,["enableAffectiveDialog"]);t!==void 0&&m!=null&&f(t,["setup","generationConfig","enableAffectiveDialog"],m);let _=h(s,["systemInstruction"]);t!==void 0&&_!=null&&f(t,["setup","systemInstruction"],Vt(_));let A=h(s,["tools"]);if(t!==void 0&&A!=null){let I=Jo(A);Array.isArray(I)&&(I=I.map(N=>qC(Yo(N)))),f(t,["setup","tools"],I)}let T=h(s,["sessionResumption"]);t!==void 0&&T!=null&&f(t,["setup","sessionResumption"],T);let E=h(s,["inputAudioTranscription"]);t!==void 0&&E!=null&&f(t,["setup","inputAudioTranscription"],E);let C=h(s,["outputAudioTranscription"]);t!==void 0&&C!=null&&f(t,["setup","outputAudioTranscription"],C);let S=h(s,["realtimeInputConfig"]);t!==void 0&&S!=null&&f(t,["setup","realtimeInputConfig"],S);let b=h(s,["contextWindowCompression"]);t!==void 0&&b!=null&&f(t,["setup","contextWindowCompression"],b);let x=h(s,["proactivity"]);t!==void 0&&x!=null&&f(t,["setup","proactivity"],x);let P=h(s,["explicitVadSignal"]);return t!==void 0&&P!=null&&f(t,["setup","explicitVadSignal"],P),e}function DC(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["setup","model"],et(s,n));let i=h(t,["config"]);return i!=null&&f(e,["config"],NC(i,e)),e}function FC(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["setup","model"],et(s,n));let i=h(t,["config"]);return i!=null&&f(e,["config"],kC(i,e)),e}function LC(s){let t={},e=h(s,["musicGenerationConfig"]);return e!=null&&f(t,["musicGenerationConfig"],e),t}function UC(s){let t={},e=h(s,["weightedPrompts"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(i=>i)),f(t,["weightedPrompts"],n)}return t}function OC(s){let t={},e=h(s,["media"]);if(e!=null){let c=AA(e);Array.isArray(c)&&(c=c.map(d=>Zu(d))),f(t,["mediaChunks"],c)}let n=h(s,["audio"]);n!=null&&f(t,["audio"],Zu(TA(n)));let i=h(s,["audioStreamEnd"]);i!=null&&f(t,["audioStreamEnd"],i);let o=h(s,["video"]);o!=null&&f(t,["video"],Zu(wA(o)));let r=h(s,["text"]);r!=null&&f(t,["text"],r);let a=h(s,["activityStart"]);a!=null&&f(t,["activityStart"],a);let l=h(s,["activityEnd"]);return l!=null&&f(t,["activityEnd"],l),t}function $C(s){let t={},e=h(s,["media"]);if(e!=null){let c=AA(e);Array.isArray(c)&&(c=c.map(d=>d)),f(t,["mediaChunks"],c)}let n=h(s,["audio"]);n!=null&&f(t,["audio"],TA(n));let i=h(s,["audioStreamEnd"]);i!=null&&f(t,["audioStreamEnd"],i);let o=h(s,["video"]);o!=null&&f(t,["video"],wA(o));let r=h(s,["text"]);r!=null&&f(t,["text"],r);let a=h(s,["activityStart"]);a!=null&&f(t,["activityStart"],a);let l=h(s,["activityEnd"]);return l!=null&&f(t,["activityEnd"],l),t}function GC(s){let t={},e=h(s,["setupComplete"]);e!=null&&f(t,["setupComplete"],e);let n=h(s,["serverContent"]);n!=null&&f(t,["serverContent"],n);let i=h(s,["toolCall"]);i!=null&&f(t,["toolCall"],i);let o=h(s,["toolCallCancellation"]);o!=null&&f(t,["toolCallCancellation"],o);let r=h(s,["usageMetadata"]);r!=null&&f(t,["usageMetadata"],zC(r));let a=h(s,["goAway"]);a!=null&&f(t,["goAway"],a);let l=h(s,["sessionResumptionUpdate"]);l!=null&&f(t,["sessionResumptionUpdate"],l);let c=h(s,["voiceActivityDetectionSignal"]);return c!=null&&f(t,["voiceActivityDetectionSignal"],c),t}function BC(s){let t={},e=h(s,["mediaResolution"]);e!=null&&f(t,["mediaResolution"],e);let n=h(s,["codeExecutionResult"]);n!=null&&f(t,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(t,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(t,["fileData"],bC(o));let r=h(s,["functionCall"]);r!=null&&f(t,["functionCall"],xC(r));let a=h(s,["functionResponse"]);a!=null&&f(t,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(t,["inlineData"],Zu(l));let c=h(s,["text"]);c!=null&&f(t,["text"],c);let d=h(s,["thought"]);d!=null&&f(t,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(t,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(t,["videoMetadata"],g),t}function HC(s){let t={},e=h(s,["handle"]);if(e!=null&&f(t,["handle"],e),h(s,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function VC(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let d=e;Array.isArray(d)&&(d=d.map(p=>p)),f(t,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(t,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(t,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(t,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(t,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(t,["googleMaps"],RC(a));let l=h(s,["googleSearch"]);l!=null&&f(t,["googleSearch"],MC(l));let c=h(s,["urlContext"]);return c!=null&&f(t,["urlContext"],c),t}function qC(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let p=e;Array.isArray(p)&&(p=p.map(g=>IC(g))),f(t,["functionDeclarations"],p)}let n=h(s,["retrieval"]);n!=null&&f(t,["retrieval"],n);let i=h(s,["googleSearchRetrieval"]);i!=null&&f(t,["googleSearchRetrieval"],i);let o=h(s,["computerUse"]);if(o!=null&&f(t,["computerUse"],o),h(s,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=h(s,["codeExecution"]);r!=null&&f(t,["codeExecution"],r);let a=h(s,["enterpriseWebSearch"]);a!=null&&f(t,["enterpriseWebSearch"],a);let l=h(s,["googleMaps"]);l!=null&&f(t,["googleMaps"],l);let c=h(s,["googleSearch"]);c!=null&&f(t,["googleSearch"],c);let d=h(s,["urlContext"]);return d!=null&&f(t,["urlContext"],d),t}function zC(s){let t={},e=h(s,["promptTokenCount"]);e!=null&&f(t,["promptTokenCount"],e);let n=h(s,["cachedContentTokenCount"]);n!=null&&f(t,["cachedContentTokenCount"],n);let i=h(s,["candidatesTokenCount"]);i!=null&&f(t,["responseTokenCount"],i);let o=h(s,["toolUsePromptTokenCount"]);o!=null&&f(t,["toolUsePromptTokenCount"],o);let r=h(s,["thoughtsTokenCount"]);r!=null&&f(t,["thoughtsTokenCount"],r);let a=h(s,["totalTokenCount"]);a!=null&&f(t,["totalTokenCount"],a);let l=h(s,["promptTokensDetails"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(_=>_)),f(t,["promptTokensDetails"],m)}let c=h(s,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(_=>_)),f(t,["cacheTokensDetails"],m)}let d=h(s,["candidatesTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(_=>_)),f(t,["responseTokensDetails"],m)}let p=h(s,["toolUsePromptTokensDetails"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(_=>_)),f(t,["toolUsePromptTokensDetails"],m)}let g=h(s,["trafficType"]);return g!=null&&f(t,["trafficType"],g),t}function WC(s){let t={},e=h(s,["data"]);if(e!=null&&f(t,["data"],e),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function KC(s){let t={},e=h(s,["content"]);e!=null&&f(t,["content"],e);let n=h(s,["citationMetadata"]);n!=null&&f(t,["citationMetadata"],YC(n));let i=h(s,["tokenCount"]);i!=null&&f(t,["tokenCount"],i);let o=h(s,["finishReason"]);o!=null&&f(t,["finishReason"],o);let r=h(s,["avgLogprobs"]);r!=null&&f(t,["avgLogprobs"],r);let a=h(s,["groundingMetadata"]);a!=null&&f(t,["groundingMetadata"],a);let l=h(s,["index"]);l!=null&&f(t,["index"],l);let c=h(s,["logprobsResult"]);c!=null&&f(t,["logprobsResult"],c);let d=h(s,["safetyRatings"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(m=>m)),f(t,["safetyRatings"],g)}let p=h(s,["urlContextMetadata"]);return p!=null&&f(t,["urlContextMetadata"],p),t}function YC(s){let t={},e=h(s,["citationSources"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(i=>i)),f(t,["citations"],n)}return t}function JC(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let o=Me(i);Array.isArray(o)&&(o=o.map(r=>r)),f(e,["contents"],o)}return e}function XC(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["tokensInfo"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>o)),f(t,["tokensInfo"],i)}return t}function ZC(s){let t={},e=h(s,["values"]);e!=null&&f(t,["values"],e);let n=h(s,["statistics"]);return n!=null&&f(t,["statistics"],QC(n)),t}function QC(s){let t={},e=h(s,["truncated"]);e!=null&&f(t,["truncated"],e);let n=h(s,["token_count"]);return n!=null&&f(t,["tokenCount"],n),t}function Pd(s){let t={},e=h(s,["parts"]);if(e!=null){let i=e;Array.isArray(i)&&(i=i.map(o=>ab(o))),f(t,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(t,["role"],n),t}function jC(s){let t={},e=h(s,["controlType"]);e!=null&&f(t,["controlType"],e);let n=h(s,["enableControlImageComputation"]);return n!=null&&f(t,["computeControl"],n),t}function tS(s){let t={};if(h(s,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(h(s,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(h(s,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function eS(s,t){let e={},n=h(s,["systemInstruction"]);t!==void 0&&n!=null&&f(t,["systemInstruction"],Vt(n));let i=h(s,["tools"]);if(t!==void 0&&i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>LA(a))),f(t,["tools"],r)}let o=h(s,["generationConfig"]);return t!==void 0&&o!=null&&f(t,["generationConfig"],WS(o)),e}function nS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let r=Me(i);Array.isArray(r)&&(r=r.map(a=>Pd(a))),f(e,["contents"],r)}let o=h(t,["config"]);return o!=null&&tS(o),e}function iS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let r=Me(i);Array.isArray(r)&&(r=r.map(a=>a)),f(e,["contents"],r)}let o=h(t,["config"]);return o!=null&&eS(o,e),e}function sS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["totalTokens"]);n!=null&&f(t,["totalTokens"],n);let i=h(s,["cachedContentTokenCount"]);return i!=null&&f(t,["cachedContentTokenCount"],i),t}function oS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["totalTokens"]);return n!=null&&f(t,["totalTokens"],n),t}function rS(s,t){let e={},n=h(t,["model"]);return n!=null&&f(e,["_url","name"],et(s,n)),e}function aS(s,t){let e={},n=h(t,["model"]);return n!=null&&f(e,["_url","name"],et(s,n)),e}function lS(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}function cS(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}function uS(s,t){let e={},n=h(s,["outputGcsUri"]);t!==void 0&&n!=null&&f(t,["parameters","storageUri"],n);let i=h(s,["negativePrompt"]);t!==void 0&&i!=null&&f(t,["parameters","negativePrompt"],i);let o=h(s,["numberOfImages"]);t!==void 0&&o!=null&&f(t,["parameters","sampleCount"],o);let r=h(s,["aspectRatio"]);t!==void 0&&r!=null&&f(t,["parameters","aspectRatio"],r);let a=h(s,["guidanceScale"]);t!==void 0&&a!=null&&f(t,["parameters","guidanceScale"],a);let l=h(s,["seed"]);t!==void 0&&l!=null&&f(t,["parameters","seed"],l);let c=h(s,["safetyFilterLevel"]);t!==void 0&&c!=null&&f(t,["parameters","safetySetting"],c);let d=h(s,["personGeneration"]);t!==void 0&&d!=null&&f(t,["parameters","personGeneration"],d);let p=h(s,["includeSafetyAttributes"]);t!==void 0&&p!=null&&f(t,["parameters","includeSafetyAttributes"],p);let g=h(s,["includeRaiReason"]);t!==void 0&&g!=null&&f(t,["parameters","includeRaiReason"],g);let m=h(s,["language"]);t!==void 0&&m!=null&&f(t,["parameters","language"],m);let _=h(s,["outputMimeType"]);t!==void 0&&_!=null&&f(t,["parameters","outputOptions","mimeType"],_);let A=h(s,["outputCompressionQuality"]);t!==void 0&&A!=null&&f(t,["parameters","outputOptions","compressionQuality"],A);let T=h(s,["addWatermark"]);t!==void 0&&T!=null&&f(t,["parameters","addWatermark"],T);let E=h(s,["labels"]);t!==void 0&&E!=null&&f(t,["labels"],E);let C=h(s,["editMode"]);t!==void 0&&C!=null&&f(t,["parameters","editMode"],C);let S=h(s,["baseSteps"]);return t!==void 0&&S!=null&&f(t,["parameters","editConfig","baseSteps"],S),e}function dS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["prompt"]);i!=null&&f(e,["instances[0]","prompt"],i);let o=h(t,["referenceImages"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>fb(l))),f(e,["instances[0]","referenceImages"],a)}let r=h(t,["config"]);return r!=null&&uS(r,e),e}function hS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Rd(o))),f(t,["generatedImages"],i)}return t}function fS(s,t){let e={},n=h(s,["taskType"]);t!==void 0&&n!=null&&f(t,["requests[]","taskType"],n);let i=h(s,["title"]);t!==void 0&&i!=null&&f(t,["requests[]","title"],i);let o=h(s,["outputDimensionality"]);if(t!==void 0&&o!=null&&f(t,["requests[]","outputDimensionality"],o),h(s,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(h(s,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return e}function pS(s,t){let e={},n=h(s,["taskType"]);t!==void 0&&n!=null&&f(t,["instances[]","task_type"],n);let i=h(s,["title"]);t!==void 0&&i!=null&&f(t,["instances[]","title"],i);let o=h(s,["outputDimensionality"]);t!==void 0&&o!=null&&f(t,["parameters","outputDimensionality"],o);let r=h(s,["mimeType"]);t!==void 0&&r!=null&&f(t,["instances[]","mimeType"],r);let a=h(s,["autoTruncate"]);return t!==void 0&&a!=null&&f(t,["parameters","autoTruncate"],a),e}function gS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let a=Xg(s,i);Array.isArray(a)&&(a=a.map(l=>l)),f(e,["requests[]","content"],a)}let o=h(t,["config"]);o!=null&&fS(o,e);let r=h(t,["model"]);return r!==void 0&&f(e,["requests[]","model"],et(s,r)),e}function mS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let r=Xg(s,i);Array.isArray(r)&&(r=r.map(a=>a)),f(e,["instances[]","content"],r)}let o=h(t,["config"]);return o!=null&&pS(o,e),e}function yS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["embeddings"],o)}let i=h(s,["metadata"]);return i!=null&&f(t,["metadata"],i),t}function _S(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["predictions[]","embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>ZC(r))),f(t,["embeddings"],o)}let i=h(s,["metadata"]);return i!=null&&f(t,["metadata"],i),t}function vS(s){let t={},e=h(s,["endpoint"]);e!=null&&f(t,["name"],e);let n=h(s,["deployedModelId"]);return n!=null&&f(t,["deployedModelId"],n),t}function AS(s){let t={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let e=h(s,["fileUri"]);e!=null&&f(t,["fileUri"],e);let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function wS(s){let t={},e=h(s,["id"]);e!=null&&f(t,["id"],e);let n=h(s,["args"]);n!=null&&f(t,["args"],n);let i=h(s,["name"]);if(i!=null&&f(t,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function TS(s){let t={},e=h(s,["mode"]);e!=null&&f(t,["mode"],e);let n=h(s,["allowedFunctionNames"]);if(n!=null&&f(t,["allowedFunctionNames"],n),h(s,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function ES(s){let t={};if(h(s,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let e=h(s,["description"]);e!=null&&f(t,["description"],e);let n=h(s,["name"]);n!=null&&f(t,["name"],n);let i=h(s,["parameters"]);i!=null&&f(t,["parameters"],i);let o=h(s,["parametersJsonSchema"]);o!=null&&f(t,["parametersJsonSchema"],o);let r=h(s,["response"]);r!=null&&f(t,["response"],r);let a=h(s,["responseJsonSchema"]);return a!=null&&f(t,["responseJsonSchema"],a),t}function CS(s,t,e){let n={},i=h(t,["systemInstruction"]);e!==void 0&&i!=null&&f(e,["systemInstruction"],Pd(Vt(i)));let o=h(t,["temperature"]);o!=null&&f(n,["temperature"],o);let r=h(t,["topP"]);r!=null&&f(n,["topP"],r);let a=h(t,["topK"]);a!=null&&f(n,["topK"],a);let l=h(t,["candidateCount"]);l!=null&&f(n,["candidateCount"],l);let c=h(t,["maxOutputTokens"]);c!=null&&f(n,["maxOutputTokens"],c);let d=h(t,["stopSequences"]);d!=null&&f(n,["stopSequences"],d);let p=h(t,["responseLogprobs"]);p!=null&&f(n,["responseLogprobs"],p);let g=h(t,["logprobs"]);g!=null&&f(n,["logprobs"],g);let m=h(t,["presencePenalty"]);m!=null&&f(n,["presencePenalty"],m);let _=h(t,["frequencyPenalty"]);_!=null&&f(n,["frequencyPenalty"],_);let A=h(t,["seed"]);A!=null&&f(n,["seed"],A);let T=h(t,["responseMimeType"]);T!=null&&f(n,["responseMimeType"],T);let E=h(t,["responseSchema"]);E!=null&&f(n,["responseSchema"],Zg(E));let C=h(t,["responseJsonSchema"]);if(C!=null&&f(n,["responseJsonSchema"],C),h(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(h(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let S=h(t,["safetySettings"]);if(e!==void 0&&S!=null){let z=S;Array.isArray(z)&&(z=z.map(W=>pb(W))),f(e,["safetySettings"],z)}let b=h(t,["tools"]);if(e!==void 0&&b!=null){let z=Jo(b);Array.isArray(z)&&(z=z.map(W=>wb(Yo(W)))),f(e,["tools"],z)}let x=h(t,["toolConfig"]);if(e!==void 0&&x!=null&&f(e,["toolConfig"],Ab(x)),h(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let P=h(t,["cachedContent"]);e!==void 0&&P!=null&&f(e,["cachedContent"],On(s,P));let I=h(t,["responseModalities"]);I!=null&&f(n,["responseModalities"],I);let N=h(t,["mediaResolution"]);N!=null&&f(n,["mediaResolution"],N);let M=h(t,["speechConfig"]);if(M!=null&&f(n,["speechConfig"],Qg(M)),h(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=h(t,["thinkingConfig"]);F!=null&&f(n,["thinkingConfig"],F);let U=h(t,["imageConfig"]);U!=null&&f(n,["imageConfig"],ZS(U));let j=h(t,["enableEnhancedCivicAnswers"]);return j!=null&&f(n,["enableEnhancedCivicAnswers"],j),n}function SS(s,t,e){let n={},i=h(t,["systemInstruction"]);e!==void 0&&i!=null&&f(e,["systemInstruction"],Vt(i));let o=h(t,["temperature"]);o!=null&&f(n,["temperature"],o);let r=h(t,["topP"]);r!=null&&f(n,["topP"],r);let a=h(t,["topK"]);a!=null&&f(n,["topK"],a);let l=h(t,["candidateCount"]);l!=null&&f(n,["candidateCount"],l);let c=h(t,["maxOutputTokens"]);c!=null&&f(n,["maxOutputTokens"],c);let d=h(t,["stopSequences"]);d!=null&&f(n,["stopSequences"],d);let p=h(t,["responseLogprobs"]);p!=null&&f(n,["responseLogprobs"],p);let g=h(t,["logprobs"]);g!=null&&f(n,["logprobs"],g);let m=h(t,["presencePenalty"]);m!=null&&f(n,["presencePenalty"],m);let _=h(t,["frequencyPenalty"]);_!=null&&f(n,["frequencyPenalty"],_);let A=h(t,["seed"]);A!=null&&f(n,["seed"],A);let T=h(t,["responseMimeType"]);T!=null&&f(n,["responseMimeType"],T);let E=h(t,["responseSchema"]);E!=null&&f(n,["responseSchema"],Zg(E));let C=h(t,["responseJsonSchema"]);C!=null&&f(n,["responseJsonSchema"],C);let S=h(t,["routingConfig"]);S!=null&&f(n,["routingConfig"],S);let b=h(t,["modelSelectionConfig"]);b!=null&&f(n,["modelConfig"],b);let x=h(t,["safetySettings"]);if(e!==void 0&&x!=null){let k=x;Array.isArray(k)&&(k=k.map(B=>B)),f(e,["safetySettings"],k)}let P=h(t,["tools"]);if(e!==void 0&&P!=null){let k=Jo(P);Array.isArray(k)&&(k=k.map(B=>LA(Yo(B)))),f(e,["tools"],k)}let I=h(t,["toolConfig"]);e!==void 0&&I!=null&&f(e,["toolConfig"],I);let N=h(t,["labels"]);e!==void 0&&N!=null&&f(e,["labels"],N);let M=h(t,["cachedContent"]);e!==void 0&&M!=null&&f(e,["cachedContent"],On(s,M));let F=h(t,["responseModalities"]);F!=null&&f(n,["responseModalities"],F);let U=h(t,["mediaResolution"]);U!=null&&f(n,["mediaResolution"],U);let j=h(t,["speechConfig"]);j!=null&&f(n,["speechConfig"],Qg(j));let z=h(t,["audioTimestamp"]);z!=null&&f(n,["audioTimestamp"],z);let W=h(t,["thinkingConfig"]);W!=null&&f(n,["thinkingConfig"],W);let bt=h(t,["imageConfig"]);if(bt!=null&&f(n,["imageConfig"],QS(bt)),h(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function tA(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let r=Me(i);Array.isArray(r)&&(r=r.map(a=>Pd(a))),f(e,["contents"],r)}let o=h(t,["config"]);return o!=null&&f(e,["generationConfig"],CS(s,o,e)),e}function eA(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let r=Me(i);Array.isArray(r)&&(r=r.map(a=>a)),f(e,["contents"],r)}let o=h(t,["config"]);return o!=null&&f(e,["generationConfig"],SS(s,o,e)),e}function nA(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>KC(c))),f(t,["candidates"],l)}let i=h(s,["modelVersion"]);i!=null&&f(t,["modelVersion"],i);let o=h(s,["promptFeedback"]);o!=null&&f(t,["promptFeedback"],o);let r=h(s,["responseId"]);r!=null&&f(t,["responseId"],r);let a=h(s,["usageMetadata"]);return a!=null&&f(t,["usageMetadata"],a),t}function iA(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>d)),f(t,["candidates"],c)}let i=h(s,["createTime"]);i!=null&&f(t,["createTime"],i);let o=h(s,["modelVersion"]);o!=null&&f(t,["modelVersion"],o);let r=h(s,["promptFeedback"]);r!=null&&f(t,["promptFeedback"],r);let a=h(s,["responseId"]);a!=null&&f(t,["responseId"],a);let l=h(s,["usageMetadata"]);return l!=null&&f(t,["usageMetadata"],l),t}function bS(s,t){let e={};if(h(s,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(h(s,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let n=h(s,["numberOfImages"]);t!==void 0&&n!=null&&f(t,["parameters","sampleCount"],n);let i=h(s,["aspectRatio"]);t!==void 0&&i!=null&&f(t,["parameters","aspectRatio"],i);let o=h(s,["guidanceScale"]);if(t!==void 0&&o!=null&&f(t,["parameters","guidanceScale"],o),h(s,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let r=h(s,["safetyFilterLevel"]);t!==void 0&&r!=null&&f(t,["parameters","safetySetting"],r);let a=h(s,["personGeneration"]);t!==void 0&&a!=null&&f(t,["parameters","personGeneration"],a);let l=h(s,["includeSafetyAttributes"]);t!==void 0&&l!=null&&f(t,["parameters","includeSafetyAttributes"],l);let c=h(s,["includeRaiReason"]);t!==void 0&&c!=null&&f(t,["parameters","includeRaiReason"],c);let d=h(s,["language"]);t!==void 0&&d!=null&&f(t,["parameters","language"],d);let p=h(s,["outputMimeType"]);t!==void 0&&p!=null&&f(t,["parameters","outputOptions","mimeType"],p);let g=h(s,["outputCompressionQuality"]);if(t!==void 0&&g!=null&&f(t,["parameters","outputOptions","compressionQuality"],g),h(s,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(h(s,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let m=h(s,["imageSize"]);if(t!==void 0&&m!=null&&f(t,["parameters","sampleImageSize"],m),h(s,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return e}function xS(s,t){let e={},n=h(s,["outputGcsUri"]);t!==void 0&&n!=null&&f(t,["parameters","storageUri"],n);let i=h(s,["negativePrompt"]);t!==void 0&&i!=null&&f(t,["parameters","negativePrompt"],i);let o=h(s,["numberOfImages"]);t!==void 0&&o!=null&&f(t,["parameters","sampleCount"],o);let r=h(s,["aspectRatio"]);t!==void 0&&r!=null&&f(t,["parameters","aspectRatio"],r);let a=h(s,["guidanceScale"]);t!==void 0&&a!=null&&f(t,["parameters","guidanceScale"],a);let l=h(s,["seed"]);t!==void 0&&l!=null&&f(t,["parameters","seed"],l);let c=h(s,["safetyFilterLevel"]);t!==void 0&&c!=null&&f(t,["parameters","safetySetting"],c);let d=h(s,["personGeneration"]);t!==void 0&&d!=null&&f(t,["parameters","personGeneration"],d);let p=h(s,["includeSafetyAttributes"]);t!==void 0&&p!=null&&f(t,["parameters","includeSafetyAttributes"],p);let g=h(s,["includeRaiReason"]);t!==void 0&&g!=null&&f(t,["parameters","includeRaiReason"],g);let m=h(s,["language"]);t!==void 0&&m!=null&&f(t,["parameters","language"],m);let _=h(s,["outputMimeType"]);t!==void 0&&_!=null&&f(t,["parameters","outputOptions","mimeType"],_);let A=h(s,["outputCompressionQuality"]);t!==void 0&&A!=null&&f(t,["parameters","outputOptions","compressionQuality"],A);let T=h(s,["addWatermark"]);t!==void 0&&T!=null&&f(t,["parameters","addWatermark"],T);let E=h(s,["labels"]);t!==void 0&&E!=null&&f(t,["labels"],E);let C=h(s,["imageSize"]);t!==void 0&&C!=null&&f(t,["parameters","sampleImageSize"],C);let S=h(s,["enhancePrompt"]);return t!==void 0&&S!=null&&f(t,["parameters","enhancePrompt"],S),e}function IS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["prompt"]);i!=null&&f(e,["instances[0]","prompt"],i);let o=h(t,["config"]);return o!=null&&bS(o,e),e}function PS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["prompt"]);i!=null&&f(e,["instances[0]","prompt"],i);let o=h(t,["config"]);return o!=null&&xS(o,e),e}function RS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>HS(r))),f(t,["generatedImages"],o)}let i=h(s,["positivePromptSafetyAttributes"]);return i!=null&&f(t,["positivePromptSafetyAttributes"],DA(i)),t}function MS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Rd(r))),f(t,["generatedImages"],o)}let i=h(s,["positivePromptSafetyAttributes"]);return i!=null&&f(t,["positivePromptSafetyAttributes"],FA(i)),t}function NS(s,t){let e={},n=h(s,["numberOfVideos"]);if(t!==void 0&&n!=null&&f(t,["parameters","sampleCount"],n),h(s,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(h(s,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let i=h(s,["durationSeconds"]);if(t!==void 0&&i!=null&&f(t,["parameters","durationSeconds"],i),h(s,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=h(s,["aspectRatio"]);t!==void 0&&o!=null&&f(t,["parameters","aspectRatio"],o);let r=h(s,["resolution"]);t!==void 0&&r!=null&&f(t,["parameters","resolution"],r);let a=h(s,["personGeneration"]);if(t!==void 0&&a!=null&&f(t,["parameters","personGeneration"],a),h(s,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let l=h(s,["negativePrompt"]);t!==void 0&&l!=null&&f(t,["parameters","negativePrompt"],l);let c=h(s,["enhancePrompt"]);if(t!==void 0&&c!=null&&f(t,["parameters","enhancePrompt"],c),h(s,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let d=h(s,["lastFrame"]);t!==void 0&&d!=null&&f(t,["instances[0]","lastFrame"],Md(d));let p=h(s,["referenceImages"]);if(t!==void 0&&p!=null){let g=p;Array.isArray(g)&&(g=g.map(m=>Db(m))),f(t,["instances[0]","referenceImages"],g)}if(h(s,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(h(s,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return e}function kS(s,t){let e={},n=h(s,["numberOfVideos"]);t!==void 0&&n!=null&&f(t,["parameters","sampleCount"],n);let i=h(s,["outputGcsUri"]);t!==void 0&&i!=null&&f(t,["parameters","storageUri"],i);let o=h(s,["fps"]);t!==void 0&&o!=null&&f(t,["parameters","fps"],o);let r=h(s,["durationSeconds"]);t!==void 0&&r!=null&&f(t,["parameters","durationSeconds"],r);let a=h(s,["seed"]);t!==void 0&&a!=null&&f(t,["parameters","seed"],a);let l=h(s,["aspectRatio"]);t!==void 0&&l!=null&&f(t,["parameters","aspectRatio"],l);let c=h(s,["resolution"]);t!==void 0&&c!=null&&f(t,["parameters","resolution"],c);let d=h(s,["personGeneration"]);t!==void 0&&d!=null&&f(t,["parameters","personGeneration"],d);let p=h(s,["pubsubTopic"]);t!==void 0&&p!=null&&f(t,["parameters","pubsubTopic"],p);let g=h(s,["negativePrompt"]);t!==void 0&&g!=null&&f(t,["parameters","negativePrompt"],g);let m=h(s,["enhancePrompt"]);t!==void 0&&m!=null&&f(t,["parameters","enhancePrompt"],m);let _=h(s,["generateAudio"]);t!==void 0&&_!=null&&f(t,["parameters","generateAudio"],_);let A=h(s,["lastFrame"]);t!==void 0&&A!=null&&f(t,["instances[0]","lastFrame"],We(A));let T=h(s,["referenceImages"]);if(t!==void 0&&T!=null){let S=T;Array.isArray(S)&&(S=S.map(b=>Fb(b))),f(t,["instances[0]","referenceImages"],S)}let E=h(s,["mask"]);t!==void 0&&E!=null&&f(t,["instances[0]","mask"],kb(E));let C=h(s,["compressionQuality"]);return t!==void 0&&C!=null&&f(t,["parameters","compressionQuality"],C),e}function DS(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response","generateVideoResponse"]);return r!=null&&f(t,["response"],OS(r)),t}function FS(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response"]);return r!=null&&f(t,["response"],$S(r)),t}function LS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["prompt"]);i!=null&&f(e,["instances[0]","prompt"],i);let o=h(t,["image"]);o!=null&&f(e,["instances[0]","image"],Md(o));let r=h(t,["video"]);r!=null&&f(e,["instances[0]","video"],UA(r));let a=h(t,["source"]);a!=null&&GS(a,e);let l=h(t,["config"]);return l!=null&&NS(l,e),e}function US(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["prompt"]);i!=null&&f(e,["instances[0]","prompt"],i);let o=h(t,["image"]);o!=null&&f(e,["instances[0]","image"],We(o));let r=h(t,["video"]);r!=null&&f(e,["instances[0]","video"],OA(r));let a=h(t,["source"]);a!=null&&BS(a,e);let l=h(t,["config"]);return l!=null&&kS(l,e),e}function OS(s){let t={},e=h(s,["generatedSamples"]);if(e!=null){let o=e;Array.isArray(o)&&(o=o.map(r=>qS(r))),f(t,["generatedVideos"],o)}let n=h(s,["raiMediaFilteredCount"]);n!=null&&f(t,["raiMediaFilteredCount"],n);let i=h(s,["raiMediaFilteredReasons"]);return i!=null&&f(t,["raiMediaFilteredReasons"],i),t}function $S(s){let t={},e=h(s,["videos"]);if(e!=null){let o=e;Array.isArray(o)&&(o=o.map(r=>zS(r))),f(t,["generatedVideos"],o)}let n=h(s,["raiMediaFilteredCount"]);n!=null&&f(t,["raiMediaFilteredCount"],n);let i=h(s,["raiMediaFilteredReasons"]);return i!=null&&f(t,["raiMediaFilteredReasons"],i),t}function GS(s,t){let e={},n=h(s,["prompt"]);t!==void 0&&n!=null&&f(t,["instances[0]","prompt"],n);let i=h(s,["image"]);t!==void 0&&i!=null&&f(t,["instances[0]","image"],Md(i));let o=h(s,["video"]);return t!==void 0&&o!=null&&f(t,["instances[0]","video"],UA(o)),e}function BS(s,t){let e={},n=h(s,["prompt"]);t!==void 0&&n!=null&&f(t,["instances[0]","prompt"],n);let i=h(s,["image"]);t!==void 0&&i!=null&&f(t,["instances[0]","image"],We(i));let o=h(s,["video"]);return t!==void 0&&o!=null&&f(t,["instances[0]","video"],OA(o)),e}function HS(s){let t={},e=h(s,["_self"]);e!=null&&f(t,["image"],jS(e));let n=h(s,["raiFilteredReason"]);n!=null&&f(t,["raiFilteredReason"],n);let i=h(s,["_self"]);return i!=null&&f(t,["safetyAttributes"],DA(i)),t}function Rd(s){let t={},e=h(s,["_self"]);e!=null&&f(t,["image"],kA(e));let n=h(s,["raiFilteredReason"]);n!=null&&f(t,["raiFilteredReason"],n);let i=h(s,["_self"]);i!=null&&f(t,["safetyAttributes"],FA(i));let o=h(s,["prompt"]);return o!=null&&f(t,["enhancedPrompt"],o),t}function VS(s){let t={},e=h(s,["_self"]);e!=null&&f(t,["mask"],kA(e));let n=h(s,["labels"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>o)),f(t,["labels"],i)}return t}function qS(s){let t={},e=h(s,["video"]);return e!=null&&f(t,["video"],Mb(e)),t}function zS(s){let t={},e=h(s,["_self"]);return e!=null&&f(t,["video"],Nb(e)),t}function WS(s){let t={},e=h(s,["modelSelectionConfig"]);e!=null&&f(t,["modelConfig"],e);let n=h(s,["responseJsonSchema"]);n!=null&&f(t,["responseJsonSchema"],n);let i=h(s,["audioTimestamp"]);i!=null&&f(t,["audioTimestamp"],i);let o=h(s,["candidateCount"]);o!=null&&f(t,["candidateCount"],o);let r=h(s,["enableAffectiveDialog"]);r!=null&&f(t,["enableAffectiveDialog"],r);let a=h(s,["frequencyPenalty"]);a!=null&&f(t,["frequencyPenalty"],a);let l=h(s,["logprobs"]);l!=null&&f(t,["logprobs"],l);let c=h(s,["maxOutputTokens"]);c!=null&&f(t,["maxOutputTokens"],c);let d=h(s,["mediaResolution"]);d!=null&&f(t,["mediaResolution"],d);let p=h(s,["presencePenalty"]);p!=null&&f(t,["presencePenalty"],p);let g=h(s,["responseLogprobs"]);g!=null&&f(t,["responseLogprobs"],g);let m=h(s,["responseMimeType"]);m!=null&&f(t,["responseMimeType"],m);let _=h(s,["responseModalities"]);_!=null&&f(t,["responseModalities"],_);let A=h(s,["responseSchema"]);A!=null&&f(t,["responseSchema"],A);let T=h(s,["routingConfig"]);T!=null&&f(t,["routingConfig"],T);let E=h(s,["seed"]);E!=null&&f(t,["seed"],E);let C=h(s,["speechConfig"]);C!=null&&f(t,["speechConfig"],C);let S=h(s,["stopSequences"]);S!=null&&f(t,["stopSequences"],S);let b=h(s,["temperature"]);b!=null&&f(t,["temperature"],b);let x=h(s,["thinkingConfig"]);x!=null&&f(t,["thinkingConfig"],x);let P=h(s,["topK"]);P!=null&&f(t,["topK"],P);let I=h(s,["topP"]);if(I!=null&&f(t,["topP"],I),h(s,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function KS(s,t){let e={},n=h(t,["model"]);return n!=null&&f(e,["_url","name"],et(s,n)),e}function YS(s,t){let e={},n=h(t,["model"]);return n!=null&&f(e,["_url","name"],et(s,n)),e}function JS(s){let t={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let e=h(s,["enableWidget"]);return e!=null&&f(t,["enableWidget"],e),t}function XS(s){let t={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let e=h(s,["timeRangeFilter"]);return e!=null&&f(t,["timeRangeFilter"],e),t}function ZS(s){let t={},e=h(s,["aspectRatio"]);e!=null&&f(t,["aspectRatio"],e);let n=h(s,["imageSize"]);if(n!=null&&f(t,["imageSize"],n),h(s,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(h(s,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function QS(s){let t={},e=h(s,["aspectRatio"]);e!=null&&f(t,["aspectRatio"],e);let n=h(s,["imageSize"]);n!=null&&f(t,["imageSize"],n);let i=h(s,["outputMimeType"]);i!=null&&f(t,["imageOutputOptions","mimeType"],i);let o=h(s,["outputCompressionQuality"]);return o!=null&&f(t,["imageOutputOptions","compressionQuality"],o),t}function jS(s){let t={},e=h(s,["bytesBase64Encoded"]);e!=null&&f(t,["imageBytes"],Ai(e));let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function kA(s){let t={},e=h(s,["gcsUri"]);e!=null&&f(t,["gcsUri"],e);let n=h(s,["bytesBase64Encoded"]);n!=null&&f(t,["imageBytes"],Ai(n));let i=h(s,["mimeType"]);return i!=null&&f(t,["mimeType"],i),t}function Md(s){let t={};if(h(s,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let e=h(s,["imageBytes"]);e!=null&&f(t,["bytesBase64Encoded"],Ai(e));let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function We(s){let t={},e=h(s,["gcsUri"]);e!=null&&f(t,["gcsUri"],e);let n=h(s,["imageBytes"]);n!=null&&f(t,["bytesBase64Encoded"],Ai(n));let i=h(s,["mimeType"]);return i!=null&&f(t,["mimeType"],i),t}function tb(s,t,e){let n={},i=h(t,["pageSize"]);e!==void 0&&i!=null&&f(e,["_query","pageSize"],i);let o=h(t,["pageToken"]);e!==void 0&&o!=null&&f(e,["_query","pageToken"],o);let r=h(t,["filter"]);e!==void 0&&r!=null&&f(e,["_query","filter"],r);let a=h(t,["queryBase"]);return e!==void 0&&a!=null&&f(e,["_url","models_url"],bA(s,a)),n}function eb(s,t,e){let n={},i=h(t,["pageSize"]);e!==void 0&&i!=null&&f(e,["_query","pageSize"],i);let o=h(t,["pageToken"]);e!==void 0&&o!=null&&f(e,["_query","pageToken"],o);let r=h(t,["filter"]);e!==void 0&&r!=null&&f(e,["_query","filter"],r);let a=h(t,["queryBase"]);return e!==void 0&&a!=null&&f(e,["_url","models_url"],bA(s,a)),n}function nb(s,t){let e={},n=h(t,["config"]);return n!=null&&tb(s,n,e),e}function ib(s,t){let e={},n=h(t,["config"]);return n!=null&&eb(s,n,e),e}function sb(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["_self"]);if(i!=null){let o=xA(i);Array.isArray(o)&&(o=o.map(r=>wg(r))),f(t,["models"],o)}return t}function ob(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["_self"]);if(i!=null){let o=xA(i);Array.isArray(o)&&(o=o.map(r=>Tg(r))),f(t,["models"],o)}return t}function rb(s){let t={},e=h(s,["maskMode"]);e!=null&&f(t,["maskMode"],e);let n=h(s,["segmentationClasses"]);n!=null&&f(t,["maskClasses"],n);let i=h(s,["maskDilation"]);return i!=null&&f(t,["dilation"],i),t}function wg(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["displayName"]);n!=null&&f(t,["displayName"],n);let i=h(s,["description"]);i!=null&&f(t,["description"],i);let o=h(s,["version"]);o!=null&&f(t,["version"],o);let r=h(s,["_self"]);r!=null&&f(t,["tunedModelInfo"],Tb(r));let a=h(s,["inputTokenLimit"]);a!=null&&f(t,["inputTokenLimit"],a);let l=h(s,["outputTokenLimit"]);l!=null&&f(t,["outputTokenLimit"],l);let c=h(s,["supportedGenerationMethods"]);c!=null&&f(t,["supportedActions"],c);let d=h(s,["temperature"]);d!=null&&f(t,["temperature"],d);let p=h(s,["maxTemperature"]);p!=null&&f(t,["maxTemperature"],p);let g=h(s,["topP"]);g!=null&&f(t,["topP"],g);let m=h(s,["topK"]);m!=null&&f(t,["topK"],m);let _=h(s,["thinking"]);return _!=null&&f(t,["thinking"],_),t}function Tg(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["displayName"]);n!=null&&f(t,["displayName"],n);let i=h(s,["description"]);i!=null&&f(t,["description"],i);let o=h(s,["versionId"]);o!=null&&f(t,["version"],o);let r=h(s,["deployedModels"]);if(r!=null){let p=r;Array.isArray(p)&&(p=p.map(g=>vS(g))),f(t,["endpoints"],p)}let a=h(s,["labels"]);a!=null&&f(t,["labels"],a);let l=h(s,["_self"]);l!=null&&f(t,["tunedModelInfo"],Eb(l));let c=h(s,["defaultCheckpointId"]);c!=null&&f(t,["defaultCheckpointId"],c);let d=h(s,["checkpoints"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(g=>g)),f(t,["checkpoints"],p)}return t}function ab(s){let t={},e=h(s,["mediaResolution"]);e!=null&&f(t,["mediaResolution"],e);let n=h(s,["codeExecutionResult"]);n!=null&&f(t,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(t,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(t,["fileData"],AS(o));let r=h(s,["functionCall"]);r!=null&&f(t,["functionCall"],wS(r));let a=h(s,["functionResponse"]);a!=null&&f(t,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(t,["inlineData"],WC(l));let c=h(s,["text"]);c!=null&&f(t,["text"],c);let d=h(s,["thought"]);d!=null&&f(t,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(t,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(t,["videoMetadata"],g),t}function lb(s){let t={},e=h(s,["productImage"]);return e!=null&&f(t,["image"],We(e)),t}function cb(s,t){let e={},n=h(s,["numberOfImages"]);t!==void 0&&n!=null&&f(t,["parameters","sampleCount"],n);let i=h(s,["baseSteps"]);t!==void 0&&i!=null&&f(t,["parameters","baseSteps"],i);let o=h(s,["outputGcsUri"]);t!==void 0&&o!=null&&f(t,["parameters","storageUri"],o);let r=h(s,["seed"]);t!==void 0&&r!=null&&f(t,["parameters","seed"],r);let a=h(s,["safetyFilterLevel"]);t!==void 0&&a!=null&&f(t,["parameters","safetySetting"],a);let l=h(s,["personGeneration"]);t!==void 0&&l!=null&&f(t,["parameters","personGeneration"],l);let c=h(s,["addWatermark"]);t!==void 0&&c!=null&&f(t,["parameters","addWatermark"],c);let d=h(s,["outputMimeType"]);t!==void 0&&d!=null&&f(t,["parameters","outputOptions","mimeType"],d);let p=h(s,["outputCompressionQuality"]);t!==void 0&&p!=null&&f(t,["parameters","outputOptions","compressionQuality"],p);let g=h(s,["enhancePrompt"]);t!==void 0&&g!=null&&f(t,["parameters","enhancePrompt"],g);let m=h(s,["labels"]);return t!==void 0&&m!=null&&f(t,["labels"],m),e}function ub(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["source"]);i!=null&&hb(i,e);let o=h(t,["config"]);return o!=null&&cb(o,e),e}function db(s){let t={},e=h(s,["predictions"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(i=>Rd(i))),f(t,["generatedImages"],n)}return t}function hb(s,t){let e={},n=h(s,["prompt"]);t!==void 0&&n!=null&&f(t,["instances[0]","prompt"],n);let i=h(s,["personImage"]);t!==void 0&&i!=null&&f(t,["instances[0]","personImage","image"],We(i));let o=h(s,["productImages"]);if(t!==void 0&&o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>lb(a))),f(t,["instances[0]","productImages"],r)}return e}function fb(s){let t={},e=h(s,["referenceImage"]);e!=null&&f(t,["referenceImage"],We(e));let n=h(s,["referenceId"]);n!=null&&f(t,["referenceId"],n);let i=h(s,["referenceType"]);i!=null&&f(t,["referenceType"],i);let o=h(s,["maskImageConfig"]);o!=null&&f(t,["maskImageConfig"],rb(o));let r=h(s,["controlImageConfig"]);r!=null&&f(t,["controlImageConfig"],jC(r));let a=h(s,["styleImageConfig"]);a!=null&&f(t,["styleImageConfig"],a);let l=h(s,["subjectImageConfig"]);return l!=null&&f(t,["subjectImageConfig"],l),t}function DA(s){let t={},e=h(s,["safetyAttributes","categories"]);e!=null&&f(t,["categories"],e);let n=h(s,["safetyAttributes","scores"]);n!=null&&f(t,["scores"],n);let i=h(s,["contentType"]);return i!=null&&f(t,["contentType"],i),t}function FA(s){let t={},e=h(s,["safetyAttributes","categories"]);e!=null&&f(t,["categories"],e);let n=h(s,["safetyAttributes","scores"]);n!=null&&f(t,["scores"],n);let i=h(s,["contentType"]);return i!=null&&f(t,["contentType"],i),t}function pb(s){let t={},e=h(s,["category"]);if(e!=null&&f(t,["category"],e),h(s,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=h(s,["threshold"]);return n!=null&&f(t,["threshold"],n),t}function gb(s){let t={},e=h(s,["image"]);return e!=null&&f(t,["image"],We(e)),t}function mb(s,t){let e={},n=h(s,["mode"]);t!==void 0&&n!=null&&f(t,["parameters","mode"],n);let i=h(s,["maxPredictions"]);t!==void 0&&i!=null&&f(t,["parameters","maxPredictions"],i);let o=h(s,["confidenceThreshold"]);t!==void 0&&o!=null&&f(t,["parameters","confidenceThreshold"],o);let r=h(s,["maskDilation"]);t!==void 0&&r!=null&&f(t,["parameters","maskDilation"],r);let a=h(s,["binaryColorThreshold"]);t!==void 0&&a!=null&&f(t,["parameters","binaryColorThreshold"],a);let l=h(s,["labels"]);return t!==void 0&&l!=null&&f(t,["labels"],l),e}function yb(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["source"]);i!=null&&vb(i,e);let o=h(t,["config"]);return o!=null&&mb(o,e),e}function _b(s){let t={},e=h(s,["predictions"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(i=>VS(i))),f(t,["generatedMasks"],n)}return t}function vb(s,t){let e={},n=h(s,["prompt"]);t!==void 0&&n!=null&&f(t,["instances[0]","prompt"],n);let i=h(s,["image"]);t!==void 0&&i!=null&&f(t,["instances[0]","image"],We(i));let o=h(s,["scribbleImage"]);return t!==void 0&&o!=null&&f(t,["instances[0]","scribble"],gb(o)),e}function Ab(s){let t={},e=h(s,["functionCallingConfig"]);e!=null&&f(t,["functionCallingConfig"],TS(e));let n=h(s,["retrievalConfig"]);return n!=null&&f(t,["retrievalConfig"],n),t}function wb(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let d=e;Array.isArray(d)&&(d=d.map(p=>p)),f(t,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(t,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(t,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(t,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(t,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(t,["googleMaps"],JS(a));let l=h(s,["googleSearch"]);l!=null&&f(t,["googleSearch"],XS(l));let c=h(s,["urlContext"]);return c!=null&&f(t,["urlContext"],c),t}function LA(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let p=e;Array.isArray(p)&&(p=p.map(g=>ES(g))),f(t,["functionDeclarations"],p)}let n=h(s,["retrieval"]);n!=null&&f(t,["retrieval"],n);let i=h(s,["googleSearchRetrieval"]);i!=null&&f(t,["googleSearchRetrieval"],i);let o=h(s,["computerUse"]);if(o!=null&&f(t,["computerUse"],o),h(s,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=h(s,["codeExecution"]);r!=null&&f(t,["codeExecution"],r);let a=h(s,["enterpriseWebSearch"]);a!=null&&f(t,["enterpriseWebSearch"],a);let l=h(s,["googleMaps"]);l!=null&&f(t,["googleMaps"],l);let c=h(s,["googleSearch"]);c!=null&&f(t,["googleSearch"],c);let d=h(s,["urlContext"]);return d!=null&&f(t,["urlContext"],d),t}function Tb(s){let t={},e=h(s,["baseModel"]);e!=null&&f(t,["baseModel"],e);let n=h(s,["createTime"]);n!=null&&f(t,["createTime"],n);let i=h(s,["updateTime"]);return i!=null&&f(t,["updateTime"],i),t}function Eb(s){let t={},e=h(s,["labels","google-vertex-llm-tuning-base-model-id"]);e!=null&&f(t,["baseModel"],e);let n=h(s,["createTime"]);n!=null&&f(t,["createTime"],n);let i=h(s,["updateTime"]);return i!=null&&f(t,["updateTime"],i),t}function Cb(s,t){let e={},n=h(s,["displayName"]);t!==void 0&&n!=null&&f(t,["displayName"],n);let i=h(s,["description"]);t!==void 0&&i!=null&&f(t,["description"],i);let o=h(s,["defaultCheckpointId"]);return t!==void 0&&o!=null&&f(t,["defaultCheckpointId"],o),e}function Sb(s,t){let e={},n=h(s,["displayName"]);t!==void 0&&n!=null&&f(t,["displayName"],n);let i=h(s,["description"]);t!==void 0&&i!=null&&f(t,["description"],i);let o=h(s,["defaultCheckpointId"]);return t!==void 0&&o!=null&&f(t,["defaultCheckpointId"],o),e}function bb(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","name"],et(s,n));let i=h(t,["config"]);return i!=null&&Cb(i,e),e}function xb(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["config"]);return i!=null&&Sb(i,e),e}function Ib(s,t){let e={},n=h(s,["outputGcsUri"]);t!==void 0&&n!=null&&f(t,["parameters","storageUri"],n);let i=h(s,["safetyFilterLevel"]);t!==void 0&&i!=null&&f(t,["parameters","safetySetting"],i);let o=h(s,["personGeneration"]);t!==void 0&&o!=null&&f(t,["parameters","personGeneration"],o);let r=h(s,["includeRaiReason"]);t!==void 0&&r!=null&&f(t,["parameters","includeRaiReason"],r);let a=h(s,["outputMimeType"]);t!==void 0&&a!=null&&f(t,["parameters","outputOptions","mimeType"],a);let l=h(s,["outputCompressionQuality"]);t!==void 0&&l!=null&&f(t,["parameters","outputOptions","compressionQuality"],l);let c=h(s,["enhanceInputImage"]);t!==void 0&&c!=null&&f(t,["parameters","upscaleConfig","enhanceInputImage"],c);let d=h(s,["imagePreservationFactor"]);t!==void 0&&d!=null&&f(t,["parameters","upscaleConfig","imagePreservationFactor"],d);let p=h(s,["labels"]);t!==void 0&&p!=null&&f(t,["labels"],p);let g=h(s,["numberOfImages"]);t!==void 0&&g!=null&&f(t,["parameters","sampleCount"],g);let m=h(s,["mode"]);return t!==void 0&&m!=null&&f(t,["parameters","mode"],m),e}function Pb(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["image"]);i!=null&&f(e,["instances[0]","image"],We(i));let o=h(t,["upscaleFactor"]);o!=null&&f(e,["parameters","upscaleConfig","upscaleFactor"],o);let r=h(t,["config"]);return r!=null&&Ib(r,e),e}function Rb(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Rd(o))),f(t,["generatedImages"],i)}return t}function Mb(s){let t={},e=h(s,["uri"]);e!=null&&f(t,["uri"],e);let n=h(s,["encodedVideo"]);n!=null&&f(t,["videoBytes"],Ai(n));let i=h(s,["encoding"]);return i!=null&&f(t,["mimeType"],i),t}function Nb(s){let t={},e=h(s,["gcsUri"]);e!=null&&f(t,["uri"],e);let n=h(s,["bytesBase64Encoded"]);n!=null&&f(t,["videoBytes"],Ai(n));let i=h(s,["mimeType"]);return i!=null&&f(t,["mimeType"],i),t}function kb(s){let t={},e=h(s,["image"]);e!=null&&f(t,["_self"],We(e));let n=h(s,["maskMode"]);return n!=null&&f(t,["maskMode"],n),t}function Db(s){let t={},e=h(s,["image"]);e!=null&&f(t,["image"],Md(e));let n=h(s,["referenceType"]);return n!=null&&f(t,["referenceType"],n),t}function Fb(s){let t={},e=h(s,["image"]);e!=null&&f(t,["image"],We(e));let n=h(s,["referenceType"]);return n!=null&&f(t,["referenceType"],n),t}function UA(s){let t={},e=h(s,["uri"]);e!=null&&f(t,["uri"],e);let n=h(s,["videoBytes"]);n!=null&&f(t,["encodedVideo"],Ai(n));let i=h(s,["mimeType"]);return i!=null&&f(t,["encoding"],i),t}function OA(s){let t={},e=h(s,["uri"]);e!=null&&f(t,["gcsUri"],e);let n=h(s,["videoBytes"]);n!=null&&f(t,["bytesBase64Encoded"],Ai(n));let i=h(s,["mimeType"]);return i!=null&&f(t,["mimeType"],i),t}function Lb(s,t){let e={},n=h(s,["displayName"]);return t!==void 0&&n!=null&&f(t,["displayName"],n),e}function Ub(s){let t={},e=h(s,["config"]);return e!=null&&Lb(e,t),t}function Ob(s,t){let e={},n=h(s,["force"]);return t!==void 0&&n!=null&&f(t,["_query","force"],n),e}function $b(s){let t={},e=h(s,["name"]);e!=null&&f(t,["_url","name"],e);let n=h(s,["config"]);return n!=null&&Ob(n,t),t}function Gb(s){let t={},e=h(s,["name"]);return e!=null&&f(t,["_url","name"],e),t}function Bb(s,t){let e={},n=h(s,["customMetadata"]);if(t!==void 0&&n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["customMetadata"],o)}let i=h(s,["chunkingConfig"]);return t!==void 0&&i!=null&&f(t,["chunkingConfig"],i),e}function Hb(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response"]);return r!=null&&f(t,["response"],qb(r)),t}function Vb(s){let t={},e=h(s,["fileSearchStoreName"]);e!=null&&f(t,["_url","file_search_store_name"],e);let n=h(s,["fileName"]);n!=null&&f(t,["fileName"],n);let i=h(s,["config"]);return i!=null&&Bb(i,t),t}function qb(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["parent"]);n!=null&&f(t,["parent"],n);let i=h(s,["documentName"]);return i!=null&&f(t,["documentName"],i),t}function zb(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);return t!==void 0&&i!=null&&f(t,["_query","pageToken"],i),e}function Wb(s){let t={},e=h(s,["config"]);return e!=null&&zb(e,t),t}function Kb(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["fileSearchStores"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["fileSearchStores"],o)}return t}function $A(s,t){let e={},n=h(s,["mimeType"]);t!==void 0&&n!=null&&f(t,["mimeType"],n);let i=h(s,["displayName"]);t!==void 0&&i!=null&&f(t,["displayName"],i);let o=h(s,["customMetadata"]);if(t!==void 0&&o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>l)),f(t,["customMetadata"],a)}let r=h(s,["chunkingConfig"]);return t!==void 0&&r!=null&&f(t,["chunkingConfig"],r),e}function Yb(s){let t={},e=h(s,["fileSearchStoreName"]);e!=null&&f(t,["_url","file_search_store_name"],e);let n=h(s,["config"]);return n!=null&&$A(n,t),t}function Jb(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}var Xb="Content-Type",Zb="X-Server-Timeout",Qb="User-Agent",Eg="x-goog-api-client",jb="1.34.0",tx=`google-genai-sdk/${jb}`,ex="v1beta1",nx="v1beta",Cg=class{constructor(t){var e,n;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});let i={};this.clientOptions.vertexai?(i.apiVersion=(e=this.clientOptions.apiVersion)!==null&&e!==void 0?e:ex,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:nx,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,t.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let t=new Headers;return await this.clientOptions.auth.addAuthHeaders(t),t}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let n=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&n.push(t.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let t=this.getBaseUrl(),e=new URL(t);return e.protocol=e.protocol=="http:"?"ws":"wss",e.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,e,n){let i=[this.getRequestUrlInternal(e)];return n&&i.push(this.getBaseResourcePath()),t!==""&&i.push(t),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));let n=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,n);if(t.queryParams)for(let[r,a]of Object.entries(t.queryParams))i.searchParams.append(r,String(a));let o={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=t.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,e,i.toString(),t.abortSignal),this.unaryApiCall(i,o,t.httpMethod)}patchHttpOptions(t,e){let n=JSON.parse(JSON.stringify(t));for(let[i,o]of Object.entries(e))typeof o=="object"?n[i]=Object.assign(Object.assign({},n[i]),o):o!==void 0&&(n[i]=o);return n}async requestStream(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));let n=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,n);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let o={};return o.body=t.body,o=await this.includeExtraHttpOptionsToRequestInit(o,e,i.toString(),t.abortSignal),this.streamApiCall(i,o,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,e,n,i){if(e&&e.timeout||i){let o=new AbortController,r=o.signal;if(e.timeout&&(e==null?void 0:e.timeout)>0){let a=setTimeout(()=>o.abort(),e.timeout);a&&typeof a.unref=="function"&&a.unref()}i&&i.addEventListener("abort",()=>{o.abort()}),t.signal=r}return e&&e.extraBody!==null&&ix(t,e.extraBody),t.headers=await this.getHeadersInternal(e,n),t}async unaryApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await sA(i),new qa(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await sA(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(t){return Ve(this,arguments,function*(){var n;let i=(n=t==null?void 0:t.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let r="",a="data:",l=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:c,value:d}=yield q(i.read());if(c){if(r.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let p=o.decode(d,{stream:!0});try{let _=JSON.parse(p);if("error"in _){let A=JSON.parse(JSON.stringify(_.error)),T=A.status,E=A.code,C=`got status: ${T}. ${JSON.stringify(_)}`;if(E>=400&&E<600)throw new hd({message:C,status:E})}}catch(_){if(_.name==="ApiError")throw _}r+=p;let g=-1,m=0;for(;;){g=-1,m=0;for(let T of l){let E=r.indexOf(T);E!==-1&&(g===-1||E<g)&&(g=E,m=T.length)}if(g===-1)break;let _=r.substring(0,g);r=r.substring(g+m);let A=_.trim();if(A.startsWith(a)){let T=A.substring(a.length).trim();try{let E=new Response(T,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield q(new qa(E))}catch(E){throw new Error(`exception parsing stream chunk ${T}. ${E}`)}}}}}finally{i.releaseLock()}})}async apiCall(t,e){return fetch(t,e).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){let t={},e=tx+" "+this.clientOptions.userAgentExtra;return t[Qb]=e,t[Eg]=e,t[Xb]="application/json",t}async getHeadersInternal(t,e){let n=new Headers;if(t&&t.headers){for(let[i,o]of Object.entries(t.headers))n.append(i,o);t.timeout&&t.timeout>0&&n.append(Zb,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,e),n}getFileName(t){var e;let n="";return typeof t=="string"&&(n=t.replace(/[/\\]+$/,""),n=(e=n.split(/[/\\]/).pop())!==null&&e!==void 0?e:""),n}async uploadFile(t,e){var n;let i={};e!=null&&(i.mimeType=e.mimeType,i.name=e.name,i.displayName=e.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);let o=this.clientOptions.uploader,r=await o.stat(t);i.sizeBytes=String(r.size);let a=(n=e==null?void 0:e.mimeType)!==null&&n!==void 0?n:r.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=a;let l={file:i},c=this.getFileName(t),d=D("upload/v1beta/files",l._url),p=await this.fetchUploadUrl(d,i.sizeBytes,i.mimeType,c,l,e==null?void 0:e.httpOptions);return o.upload(t,p,this)}async uploadFileToFileSearchStore(t,e,n){var i;let o=this.clientOptions.uploader,r=await o.stat(e),a=String(r.size),l=(i=n==null?void 0:n.mimeType)!==null&&i!==void 0?i:r.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let c=`upload/v1beta/${t}:uploadToFileSearchStore`,d=this.getFileName(e),p={};n!=null&&$A(n,p);let g=await this.fetchUploadUrl(c,a,l,d,p,n==null?void 0:n.httpOptions);return o.uploadToFileSearchStore(e,g,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,e,n,i,o,r){var a;let l={};r?l=r:l={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e}`,"X-Goog-Upload-Header-Content-Type":`${n}`},i?{"X-Goog-Upload-File-Name":i}:{})};let c=await this.request({path:t,body:JSON.stringify(o),httpMethod:"POST",httpOptions:l});if(!c||!(c!=null&&c.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let d=(a=c==null?void 0:c.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(d===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return d}};async function sA(s){var t;if(s===void 0)throw new Error("response is undefined");if(!s.ok){let e=s.status,n;!((t=s.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?n=await s.json():n={error:{message:await s.text(),code:s.status,status:s.statusText}};let i=JSON.stringify(n);throw e>=400&&e<600?new hd({message:i,status:e}):new Error(i)}}function ix(s,t){if(!t||Object.keys(t).length===0)return;if(s.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let e={};if(typeof s.body=="string"&&s.body.length>0)try{let o=JSON.parse(s.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))e=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch(o){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(o,r){let a=Object.assign({},o);for(let l in r)if(Object.prototype.hasOwnProperty.call(r,l)){let c=r[l],d=a[l];c&&typeof c=="object"&&!Array.isArray(c)&&d&&typeof d=="object"&&!Array.isArray(d)?a[l]=n(d,c):(d&&c&&typeof d!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof d}, New type: ${typeof c}. Overwriting.`),a[l]=c)}return a}let i=n(e,t);s.body=JSON.stringify(i)}var sx="mcp_used/unknown",ox=!1;function GA(s){for(let t of s)if(rx(t)||typeof t=="object"&&"inputSchema"in t)return!0;return ox}function BA(s){var t;let e=(t=s[Eg])!==null&&t!==void 0?t:"";s[Eg]=(e+` ${sx}`).trimStart()}function rx(s){return s!==null&&typeof s=="object"&&s instanceof Sg}function ax(s){return Ve(this,arguments,function*(e,n=100){let i,o=0;for(;o<n;){let r=yield q(e.listTools({cursor:i}));for(let a of r.tools)yield yield q(a),o++;if(!r.nextCursor)break;i=r.nextCursor}})}var Sg=class s{constructor(t=[],e){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=t,this.config=e}static create(t,e){return new s(t,e)}async initialize(){var t,e,n,i;if(this.mcpTools.length>0)return;let o={},r=[];for(let d of this.mcpClients)try{for(var a=!0,l=(e=void 0,qe(ax(d))),c;c=await l.next(),t=c.done,!t;a=!0){i=c.value,a=!1;let p=i;r.push(p);let g=p.name;if(o[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);o[g]=d}}catch(p){e={error:p}}finally{try{!a&&!t&&(n=l.return)&&await n.call(l)}finally{if(e)throw e.error}}this.mcpTools=r,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),zE(this.mcpTools,this.config)}async callTool(t){await this.initialize();let e=[];for(let n of t)if(n.name in this.functionNameToMcpClient){let i=this.functionNameToMcpClient[n.name],o;this.config.timeout&&(o={timeout:this.config.timeout});let r=await i.callTool({name:n.name,arguments:n.args},void 0,o);e.push({functionResponse:{name:n.name,response:r.isError?{error:r}:r}})}return e}};async function lx(s,t,e){let n=new hg,i;e.data instanceof Blob?i=JSON.parse(await e.data.text()):i=JSON.parse(e.data),Object.assign(n,i),t(n)}var bg=class{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n}async connect(t){var e,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let i=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),r=ux(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${i}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${a}`,c=()=>{},d=new Promise(S=>{c=S}),p=t.callbacks,g=function(){c({})},m=this.apiClient,_={onopen:g,onmessage:S=>{lx(m,p.onmessage,S)},onerror:(e=p==null?void 0:p.onerror)!==null&&e!==void 0?e:function(S){},onclose:(n=p==null?void 0:p.onclose)!==null&&n!==void 0?n:function(S){}},A=this.webSocketFactory.create(l,cx(r),_);A.connect(),await d;let C={setup:{model:et(this.apiClient,t.model)}};return A.send(JSON.stringify(C)),new xg(A,this.apiClient)}},xg=class{constructor(t,e){this.conn=t,this.apiClient=e}async setWeightedPrompts(t){if(!t.weightedPrompts||Object.keys(t.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let e=UC(t);this.conn.send(JSON.stringify({clientContent:e}))}async setMusicGenerationConfig(t){t.musicGenerationConfig||(t.musicGenerationConfig={});let e=LC(t);this.conn.send(JSON.stringify(e))}sendPlaybackControl(t){let e={playbackControl:t};this.conn.send(JSON.stringify(e))}play(){this.sendPlaybackControl(Vo.PLAY)}pause(){this.sendPlaybackControl(Vo.PAUSE)}stop(){this.sendPlaybackControl(Vo.STOP)}resetContext(){this.sendPlaybackControl(Vo.RESET_CONTEXT)}close(){this.conn.close()}};function cx(s){let t={};return s.forEach((e,n)=>{t[n]=e}),t}function ux(s){let t=new Headers;for(let[e,n]of Object.entries(s))t.append(e,n);return t}var dx="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function hx(s,t,e){let n=new dg,i;e.data instanceof Blob?i=await e.data.text():e.data instanceof ArrayBuffer?i=new TextDecoder().decode(e.data):i=e.data;let o=JSON.parse(i);if(s.isVertexAI()){let r=GC(o);Object.assign(n,r)}else Object.assign(n,o);t(n)}var Ig=class{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n,this.music=new bg(this.apiClient,this.auth,this.webSocketFactory)}async connect(t){var e,n,i,o,r,a;if(t.config&&t.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),d,p=this.apiClient.getHeaders();t.config&&t.config.tools&&GA(t.config.tools)&&BA(p);let g=gx(p);if(this.apiClient.isVertexAI())d=`${l}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g,d);else{let M=this.apiClient.getApiKey(),F="BidiGenerateContent",U="key";M!=null&&M.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),F="BidiGenerateContentConstrained",U="access_token"),d=`${l}/ws/google.ai.generativelanguage.${c}.GenerativeService.${F}?${U}=${M}`}let m=()=>{},_=new Promise(M=>{m=M}),A=t.callbacks,T=function(){var M;(M=A==null?void 0:A.onopen)===null||M===void 0||M.call(A),m({})},E=this.apiClient,C={onopen:T,onmessage:M=>{hx(E,A.onmessage,M)},onerror:(e=A==null?void 0:A.onerror)!==null&&e!==void 0?e:function(M){},onclose:(n=A==null?void 0:A.onclose)!==null&&n!==void 0?n:function(M){}},S=this.webSocketFactory.create(d,px(g),C);S.connect(),await _;let b=et(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&b.startsWith("publishers/")){let M=this.apiClient.getProject(),F=this.apiClient.getLocation();b=`projects/${M}/locations/${F}/`+b}let x={};this.apiClient.isVertexAI()&&((i=t.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[Qu.AUDIO]}:t.config.responseModalities=[Qu.AUDIO]),!((o=t.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let P=(a=(r=t.config)===null||r===void 0?void 0:r.tools)!==null&&a!==void 0?a:[],I=[];for(let M of P)if(this.isCallableTool(M)){let F=M;I.push(await F.tool())}else I.push(M);I.length>0&&(t.config.tools=I);let N={model:b,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?x=FC(this.apiClient,N):x=DC(this.apiClient,N),delete x.config,S.send(JSON.stringify(x)),new Pg(S,this.apiClient)}isCallableTool(t){return"callTool"in t&&typeof t.callTool=="function"}},fx={turnComplete:!0},Pg=class{constructor(t,e){this.conn=t,this.apiClient=e}tLiveClientContent(t,e){if(e.turns!==null&&e.turns!==void 0){let n=[];try{n=Me(e.turns),t.isVertexAI()||(n=n.map(i=>Pd(i)))}catch(i){throw new Error(`Failed to parse client content "turns", type: '${typeof e.turns}'`)}return{clientContent:{turns:n,turnComplete:e.turnComplete}}}return{clientContent:{turnComplete:e.turnComplete}}}tLiveClienttToolResponse(t,e){let n=[];if(e.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(e.functionResponses)?n=e.functionResponses:n=[e.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(let o of n){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!t.isVertexAI()&&!("id"in o))throw new Error(dx)}return{toolResponse:{functionResponses:n}}}sendClientContent(t){t=Object.assign(Object.assign({},fx),t);let e=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendRealtimeInput(t){let e={};this.apiClient.isVertexAI()?e={realtimeInput:$C(t)}:e={realtimeInput:OC(t)},this.conn.send(JSON.stringify(e))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");let e=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(e))}close(){this.conn.close()}};function px(s){let t={};return s.forEach((e,n)=>{t[n]=e}),t}function gx(s){let t=new Headers;for(let[e,n]of Object.entries(s))t.append(e,n);return t}var oA=10;function rA(s){var t,e,n;if(!((t=s==null?void 0:s.automaticFunctionCalling)===null||t===void 0)&&t.disable)return!0;let i=!1;for(let r of(e=s==null?void 0:s.tools)!==null&&e!==void 0?e:[])if(zo(r)){i=!0;break}if(!i)return!0;let o=(n=s==null?void 0:s.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function zo(s){return"callTool"in s&&typeof s.callTool=="function"}function mx(s){var t,e,n;return(n=(e=(t=s.config)===null||t===void 0?void 0:t.tools)===null||e===void 0?void 0:e.some(i=>zo(i)))!==null&&n!==void 0?n:!1}function aA(s){var t;let e=[];return!((t=s==null?void 0:s.config)===null||t===void 0)&&t.tools&&s.config.tools.forEach((n,i)=>{if(zo(n))return;let o=n;o.functionDeclarations&&o.functionDeclarations.length>0&&e.push(i)}),e}function lA(s){var t;return!(!((t=s==null?void 0:s.automaticFunctionCalling)===null||t===void 0)&&t.ignoreCallHistory)}var Rg=class extends ze{constructor(t){super(),this.apiClient=t,this.generateContent=async e=>{var n,i,o,r,a;let l=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!mx(e)||rA(e.config))return await this.generateContentInternal(l);let c=aA(e);if(c.length>0){let A=c.map(T=>`tools[${T}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${A}.`)}let d,p,g=Me(l.contents),m=(o=(i=(n=l.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:oA,_=0;for(;_<m&&(d=await this.generateContentInternal(l),!(!d.functionCalls||d.functionCalls.length===0));){let A=d.candidates[0].content,T=[];for(let E of(a=(r=e.config)===null||r===void 0?void 0:r.tools)!==null&&a!==void 0?a:[])if(zo(E)){let S=await E.callTool(d.functionCalls);T.push(...S)}_++,p={role:"user",parts:T},l.contents=Me(l.contents),l.contents.push(A),l.contents.push(p),lA(l.config)&&(g.push(A),g.push(p))}return lA(l.config)&&(d.automaticFunctionCallingHistory=g),d},this.generateContentStream=async e=>{var n,i,o,r,a;if(this.maybeMoveToResponseJsonSchem(e),rA(e.config)){let p=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(p)}let l=aA(e);if(l.length>0){let p=l.map(g=>`tools[${g}]`).join(", ");throw new Error(`Incompatible tools found at ${p}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let c=(o=(i=(n=e==null?void 0:e.config)===null||n===void 0?void 0:n.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||o===void 0?void 0:o.streamFunctionCallArguments,d=(a=(r=e==null?void 0:e.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(c&&!d)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(n=>{var i;let o,r=[];if(n!=null&&n.generatedImages)for(let l of n.generatedImages)l&&(l!=null&&l.safetyAttributes)&&((i=l==null?void 0:l.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?o=l==null?void 0:l.safetyAttributes:r.push(l);let a;return o?a={generatedImages:r,positivePromptSafetyAttributes:o,sdkHttpResponse:n.sdkHttpResponse}:a={generatedImages:r,sdkHttpResponse:n.sdkHttpResponse},a}),this.list=async e=>{var n;let r={config:Object.assign(Object.assign({},{queryBase:!0}),e==null?void 0:e.config)};if(this.apiClient.isVertexAI()&&!r.config.queryBase){if(!((n=r.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");r.config.filter="labels.tune-type:*"}return new Un(Ln.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(r),r)},this.editImage=async e=>{let n={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(n.referenceImages=e.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async e=>{let n={numberOfImages:1,mode:"upscale"};e.config&&(n=Object.assign(Object.assign({},n),e.config));let i={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:n};return await this.upscaleImageInternal(i)},this.generateVideos=async e=>{var n,i,o,r,a,l;if((e.prompt||e.image||e.video)&&e.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=e.video)===null||n===void 0)&&n.uri&&(!((i=e.video)===null||i===void 0)&&i.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:!((r=(o=e.source)===null||o===void 0?void 0:o.video)===null||r===void 0)&&r.uri&&(!((l=(a=e.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(t){t.config&&t.config.responseSchema&&(t.config.responseJsonSchema||Object.keys(t.config.responseSchema).includes("$schema")&&(t.config.responseJsonSchema=t.config.responseSchema,delete t.config.responseSchema))}async processParamsMaybeAddMcpUsage(t){var e,n,i;let o=(e=t.config)===null||e===void 0?void 0:e.tools;if(!o)return t;let r=await Promise.all(o.map(async l=>zo(l)?await l.tool():l)),a={model:t.model,contents:t.contents,config:Object.assign(Object.assign({},t.config),{tools:r})};if(a.config.tools=r,t.config&&t.config.tools&&GA(t.config.tools)){let l=(i=(n=t.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&i!==void 0?i:{},c=Object.assign({},l);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),BA(c),a.config.httpOptions=Object.assign(Object.assign({},t.config.httpOptions),{headers:c})}return a}async initAfcToolsMap(t){var e,n,i;let o=new Map;for(let r of(n=(e=t.config)===null||e===void 0?void 0:e.tools)!==null&&n!==void 0?n:[])if(zo(r)){let a=r,l=await a.tool();for(let c of(i=l.functionDeclarations)!==null&&i!==void 0?i:[]){if(!c.name)throw new Error("Function declaration name is required.");if(o.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);o.set(c.name,a)}}return o}async processAfcStream(t){var e,n,i;let o=(i=(n=(e=t.config)===null||e===void 0?void 0:e.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&i!==void 0?i:oA,r=!1,a=0,l=await this.initAfcToolsMap(t);return function(c,d,p){return Ve(this,arguments,function*(){for(var g,m,_,A,T,E;a<o;){r&&(a++,r=!1);let x=yield q(c.processParamsMaybeAddMcpUsage(p)),P=yield q(c.generateContentStreamInternal(x)),I=[],N=[];try{for(var C=!0,S=(m=void 0,qe(P)),b;b=yield q(S.next()),g=b.done,!g;C=!0){A=b.value,C=!1;let M=A;if(yield yield q(M),M.candidates&&(!((T=M.candidates[0])===null||T===void 0)&&T.content)){N.push(M.candidates[0].content);for(let F of(E=M.candidates[0].content.parts)!==null&&E!==void 0?E:[])if(a<o&&F.functionCall){if(!F.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(F.functionCall.name)){let U=yield q(d.get(F.functionCall.name).callTool([F.functionCall]));I.push(...U)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${F.functionCall.name}`)}}}}catch(M){m={error:M}}finally{try{!C&&!g&&(_=S.return)&&(yield q(_.call(S)))}finally{if(m)throw m.error}}if(I.length>0){r=!0;let M=new cs;M.candidates=[{content:{role:"user",parts:I}}],yield yield q(M);let F=[];F.push(...N),F.push({role:"user",parts:I});let U=Me(p.contents).concat(F);p.contents=U}else break}})}(this,l,t)}async generateContentInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=eA(this.apiClient,t);return a=D("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=iA(d),g=new cs;return Object.assign(g,p),g})}else{let c=tA(this.apiClient,t);return a=D("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=nA(d),g=new cs;return Object.assign(g,p),g})}}async generateContentStreamInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=eA(this.apiClient,t);return a=D("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}),r.then(function(p){return Ve(this,arguments,function*(){var g,m,_,A;try{for(var T=!0,E=qe(p),C;C=yield q(E.next()),g=C.done,!g;T=!0){A=C.value,T=!1;let S=A,b=iA(yield q(S.json()));b.sdkHttpResponse={headers:S.headers};let x=new cs;Object.assign(x,b),yield yield q(x)}}catch(S){m={error:S}}finally{try{!T&&!g&&(_=E.return)&&(yield q(_.call(E)))}finally{if(m)throw m.error}}})})}else{let c=tA(this.apiClient,t);return a=D("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}),r.then(function(p){return Ve(this,arguments,function*(){var g,m,_,A;try{for(var T=!0,E=qe(p),C;C=yield q(E.next()),g=C.done,!g;T=!0){A=C.value,T=!1;let S=A,b=nA(yield q(S.json()));b.sdkHttpResponse={headers:S.headers};let x=new cs;Object.assign(x,b),yield yield q(x)}}catch(S){m={error:S}}finally{try{!T&&!g&&(_=E.return)&&(yield q(_.call(E)))}finally{if(m)throw m.error}}})})}}async embedContent(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=mS(this.apiClient,t);return a=D("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=_S(d),g=new ju;return Object.assign(g,p),g})}else{let c=gS(this.apiClient,t);return a=D("{model}:batchEmbedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=yS(d),g=new ju;return Object.assign(g,p),g})}}async generateImagesInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=PS(this.apiClient,t);return a=D("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=MS(d),g=new td;return Object.assign(g,p),g})}else{let c=IS(this.apiClient,t);return a=D("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=RS(d),g=new td;return Object.assign(g,p),g})}}async editImageInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=dS(this.apiClient,t);return o=D("{model}:predict",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=hS(l),d=new jp;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=Pb(this.apiClient,t);return o=D("{model}:predict",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=Rb(l),d=new tg;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=ub(this.apiClient,t);return o=D("{model}:predict",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=db(l),d=new eg;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=yb(this.apiClient,t);return o=D("{model}:predict",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=_b(l),d=new ng;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=YS(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>Tg(d))}else{let c=KS(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>wg(d))}}async listInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=ib(this.apiClient,t);return a=D("{models_url}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=ob(d),g=new ed;return Object.assign(g,p),g})}else{let c=nb(this.apiClient,t);return a=D("{models_url}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=sb(d),g=new ed;return Object.assign(g,p),g})}}async update(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=xb(this.apiClient,t);return a=D("{model}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>Tg(d))}else{let c=bb(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>wg(d))}}async delete(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=aS(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=cS(d),g=new nd;return Object.assign(g,p),g})}else{let c=rS(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=lS(d),g=new nd;return Object.assign(g,p),g})}}async countTokens(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=iS(this.apiClient,t);return a=D("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=oS(d),g=new id;return Object.assign(g,p),g})}else{let c=nS(this.apiClient,t);return a=D("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=sS(d),g=new id;return Object.assign(g,p),g})}}async computeTokens(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=JC(this.apiClient,t);return o=D("{model}:computeTokens",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=XC(l),d=new ig;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=US(this.apiClient,t);return a=D("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>{let p=FS(d),g=new sd;return Object.assign(g,p),g})}else{let c=LS(this.apiClient,t);return a=D("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>{let p=DS(d),g=new sd;return Object.assign(g,p),g})}}};var Mg=class extends ze{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){let e=t.operation,n=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=e.name.split("/operations/")[0],o;n&&"httpOptions"in n&&(o=n.httpOptions);let r=await this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:i,config:{httpOptions:o}});return e._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:e.name,config:n});return e._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(t){let e=t.operation,n=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=e.name.split("/operations/")[0],o;n&&"httpOptions"in n&&(o=n.httpOptions);let r=await this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:i,config:{httpOptions:o}});return e._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:e.name,config:n});return e._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=NE(t);return a=D("{operationName}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r}else{let c=ME(t);return a=D("{operationName}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r}}async fetchPredictVideosOperationInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=CE(t);return o=D("{resourceName}:fetchPredictOperation",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}};function yx(s){let t={},e=h(s,["data"]);if(e!=null&&f(t,["data"],e),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function _x(s){let t={},e=h(s,["parts"]);if(e!=null){let i=e;Array.isArray(i)&&(i=i.map(o=>xx(o))),f(t,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(t,["role"],n),t}function vx(s,t,e){let n={},i=h(t,["expireTime"]);e!==void 0&&i!=null&&f(e,["expireTime"],i);let o=h(t,["newSessionExpireTime"]);e!==void 0&&o!=null&&f(e,["newSessionExpireTime"],o);let r=h(t,["uses"]);e!==void 0&&r!=null&&f(e,["uses"],r);let a=h(t,["liveConnectConstraints"]);e!==void 0&&a!=null&&f(e,["bidiGenerateContentSetup"],bx(s,a));let l=h(t,["lockAdditionalFields"]);return e!==void 0&&l!=null&&f(e,["fieldMask"],l),n}function Ax(s,t){let e={},n=h(t,["config"]);return n!=null&&f(e,["config"],vx(s,n,e)),e}function wx(s){let t={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let e=h(s,["fileUri"]);e!=null&&f(t,["fileUri"],e);let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function Tx(s){let t={},e=h(s,["id"]);e!=null&&f(t,["id"],e);let n=h(s,["args"]);n!=null&&f(t,["args"],n);let i=h(s,["name"]);if(i!=null&&f(t,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function Ex(s){let t={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let e=h(s,["enableWidget"]);return e!=null&&f(t,["enableWidget"],e),t}function Cx(s){let t={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let e=h(s,["timeRangeFilter"]);return e!=null&&f(t,["timeRangeFilter"],e),t}function Sx(s,t){let e={},n=h(s,["generationConfig"]);t!==void 0&&n!=null&&f(t,["setup","generationConfig"],n);let i=h(s,["responseModalities"]);t!==void 0&&i!=null&&f(t,["setup","generationConfig","responseModalities"],i);let o=h(s,["temperature"]);t!==void 0&&o!=null&&f(t,["setup","generationConfig","temperature"],o);let r=h(s,["topP"]);t!==void 0&&r!=null&&f(t,["setup","generationConfig","topP"],r);let a=h(s,["topK"]);t!==void 0&&a!=null&&f(t,["setup","generationConfig","topK"],a);let l=h(s,["maxOutputTokens"]);t!==void 0&&l!=null&&f(t,["setup","generationConfig","maxOutputTokens"],l);let c=h(s,["mediaResolution"]);t!==void 0&&c!=null&&f(t,["setup","generationConfig","mediaResolution"],c);let d=h(s,["seed"]);t!==void 0&&d!=null&&f(t,["setup","generationConfig","seed"],d);let p=h(s,["speechConfig"]);t!==void 0&&p!=null&&f(t,["setup","generationConfig","speechConfig"],jg(p));let g=h(s,["thinkingConfig"]);t!==void 0&&g!=null&&f(t,["setup","generationConfig","thinkingConfig"],g);let m=h(s,["enableAffectiveDialog"]);t!==void 0&&m!=null&&f(t,["setup","generationConfig","enableAffectiveDialog"],m);let _=h(s,["systemInstruction"]);t!==void 0&&_!=null&&f(t,["setup","systemInstruction"],_x(Vt(_)));let A=h(s,["tools"]);if(t!==void 0&&A!=null){let P=Jo(A);Array.isArray(P)&&(P=P.map(I=>Px(Yo(I)))),f(t,["setup","tools"],P)}let T=h(s,["sessionResumption"]);t!==void 0&&T!=null&&f(t,["setup","sessionResumption"],Ix(T));let E=h(s,["inputAudioTranscription"]);t!==void 0&&E!=null&&f(t,["setup","inputAudioTranscription"],E);let C=h(s,["outputAudioTranscription"]);t!==void 0&&C!=null&&f(t,["setup","outputAudioTranscription"],C);let S=h(s,["realtimeInputConfig"]);t!==void 0&&S!=null&&f(t,["setup","realtimeInputConfig"],S);let b=h(s,["contextWindowCompression"]);t!==void 0&&b!=null&&f(t,["setup","contextWindowCompression"],b);let x=h(s,["proactivity"]);if(t!==void 0&&x!=null&&f(t,["setup","proactivity"],x),h(s,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return e}function bx(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["setup","model"],et(s,n));let i=h(t,["config"]);return i!=null&&f(e,["config"],Sx(i,e)),e}function xx(s){let t={},e=h(s,["mediaResolution"]);e!=null&&f(t,["mediaResolution"],e);let n=h(s,["codeExecutionResult"]);n!=null&&f(t,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(t,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(t,["fileData"],wx(o));let r=h(s,["functionCall"]);r!=null&&f(t,["functionCall"],Tx(r));let a=h(s,["functionResponse"]);a!=null&&f(t,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(t,["inlineData"],yx(l));let c=h(s,["text"]);c!=null&&f(t,["text"],c);let d=h(s,["thought"]);d!=null&&f(t,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(t,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(t,["videoMetadata"],g),t}function Ix(s){let t={},e=h(s,["handle"]);if(e!=null&&f(t,["handle"],e),h(s,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function Px(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let d=e;Array.isArray(d)&&(d=d.map(p=>p)),f(t,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(t,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(t,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(t,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(t,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(t,["googleMaps"],Ex(a));let l=h(s,["googleSearch"]);l!=null&&f(t,["googleSearch"],Cx(l));let c=h(s,["urlContext"]);return c!=null&&f(t,["urlContext"],c),t}function Rx(s){let t=[];for(let e in s)if(Object.prototype.hasOwnProperty.call(s,e)){let n=s[e];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){let i=Object.keys(n).map(o=>`${e}.${o}`);t.push(...i)}else t.push(e)}return t.join(",")}function Mx(s,t){let e=null,n=s.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){let o=n.setup;typeof o=="object"&&o!==null?(s.bidiGenerateContentSetup=o,e=o):delete s.bidiGenerateContentSetup}else n!==void 0&&delete s.bidiGenerateContentSetup;let i=s.fieldMask;if(e){let o=Rx(e);if(Array.isArray(t==null?void 0:t.lockAdditionalFields)&&(t==null?void 0:t.lockAdditionalFields.length)===0)o?s.fieldMask=o:delete s.fieldMask;else if(t!=null&&t.lockAdditionalFields&&t.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){let r=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],a=[];i.length>0&&(a=i.map(c=>r.includes(c)?`generationConfig.${c}`:c));let l=[];o&&l.push(o),a.length>0&&l.push(...a),l.length>0?s.fieldMask=l.join(","):delete s.fieldMask}else delete s.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?s.fieldMask=i.join(","):delete s.fieldMask;return s}var Ng=class extends ze{constructor(t){super(),this.apiClient=t}async create(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let a=Ax(this.apiClient,t);o=D("auth_tokens",a._url),r=a._query,delete a.config,delete a._url,delete a._query;let l=Mx(a,t.config);return i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>c)}}};function Nx(s,t){let e={},n=h(s,["force"]);return t!==void 0&&n!=null&&f(t,["_query","force"],n),e}function kx(s){let t={},e=h(s,["name"]);e!=null&&f(t,["_url","name"],e);let n=h(s,["config"]);return n!=null&&Nx(n,t),t}function Dx(s){let t={},e=h(s,["name"]);return e!=null&&f(t,["_url","name"],e),t}function Fx(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);return t!==void 0&&i!=null&&f(t,["_query","pageToken"],i),e}function Lx(s){let t={},e=h(s,["parent"]);e!=null&&f(t,["_url","parent"],e);let n=h(s,["config"]);return n!=null&&Fx(n,t),t}function Ux(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["documents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["documents"],o)}return t}var kg=class extends ze{constructor(t){super(),this.apiClient=t,this.list=async e=>new Un(Ln.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:e.parent,config:n.config}),await this.listInternal(e),e)}async get(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Dx(t);return o=D("{name}",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(t){var e,n;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let r=kx(t);i=D("{name}",r._url),o=r._query,delete r._url,delete r._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Lx(t);return o=D("{parent}/documents",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=Ux(l),d=new sg;return Object.assign(d,c),d})}}};var Dg=class extends ze{constructor(t,e=new kg(t)){super(),this.apiClient=t,this.documents=e,this.list=async(n={})=>new Un(Ln.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(n),n)}async uploadToFileSearchStore(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(t.fileSearchStoreName,t.file,t.config)}async create(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Ub(t);return o=D("fileSearchStores",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async get(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Gb(t);return o=D("{name}",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(t){var e,n;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let r=$b(t);i=D("{name}",r._url),o=r._query,delete r._url,delete r._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Wb(t);return o=D("fileSearchStores",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=Kb(l),d=new og;return Object.assign(d,c),d})}}async uploadToFileSearchStoreInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Yb(t);return o=D("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=Jb(l),d=new rg;return Object.assign(d,c),d})}}async importFile(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Vb(t);return o=D("{file_search_store_name}:importFile",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=Hb(l),d=new ag;return Object.assign(d,c),d})}}};var HA=function(){let{crypto:s}=globalThis;if(s!=null&&s.randomUUID)return HA=s.randomUUID.bind(s),s.randomUUID();let t=new Uint8Array(1),e=s?()=>s.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^e()&15>>+n/4).toString(16))},Ox=()=>HA();function Fg(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}var Lg=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){let t=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(t.stack=s.stack),s.cause&&!t.cause&&(t.cause=s.cause),s.name&&(t.name=s.name),t}}catch(t){}try{return new Error(JSON.stringify(s))}catch(t){}}return new Error(s)};var re=class extends Error{},ae=class s extends re{constructor(t,e,n,i){super(`${s.makeMessage(t,e,n)}`),this.status=t,this.headers=i,this.error=e}static makeMessage(t,e,n){let i=e!=null&&e.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):n;return t&&i?`${t} ${i}`:t?`${t} status code (no body)`:i||"(no status code or body)"}static generate(t,e,n,i){if(!t||!i)return new Wo({message:n,cause:Lg(e)});let o=e;return t===400?new pd(t,o,n,i):t===401?new gd(t,o,n,i):t===403?new md(t,o,n,i):t===404?new yd(t,o,n,i):t===409?new _d(t,o,n,i):t===422?new vd(t,o,n,i):t===429?new Ad(t,o,n,i):t>=500?new wd(t,o,n,i):new s(t,o,n,i)}},za=class extends ae{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}},Wo=class extends ae{constructor({message:t,cause:e}){super(void 0,void 0,t||"Connection error.",void 0),e&&(this.cause=e)}},fd=class extends Wo{constructor({message:t}={}){super({message:t!=null?t:"Request timed out."})}},pd=class extends ae{},gd=class extends ae{},md=class extends ae{},yd=class extends ae{},_d=class extends ae{},vd=class extends ae{},Ad=class extends ae{},wd=class extends ae{};var $x=/^[a-z][a-z0-9+.-]*:/i,Gx=s=>$x.test(s),Ug=s=>(Ug=Array.isArray,Ug(s)),Bx=Ug,Hx=Bx,cA=Hx;function Vx(s){if(!s)return!0;for(let t in s)return!1;return!0}function qx(s,t){return Object.prototype.hasOwnProperty.call(s,t)}var zx=(s,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new re(`${s} must be an integer`);if(t<0)throw new re(`${s} must be a positive integer`);return t},Wx=s=>{try{return JSON.parse(s)}catch(t){return}};var Kx=s=>new Promise(t=>setTimeout(t,s));var Ho="0.0.1";function Yx(){return typeof Deno!="undefined"&&Deno.build!=null?"deno":typeof EdgeRuntime!="undefined"?"edge":Object.prototype.toString.call(typeof globalThis.process!="undefined"?globalThis.process:0)==="[object process]"?"node":"unknown"}var Jx=()=>{var s,t,e,n,i;let o=Yx();if(o==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ho,"X-Stainless-OS":dA(Deno.build.os),"X-Stainless-Arch":uA(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(s=Deno.version)===null||s===void 0?void 0:s.deno)!==null&&t!==void 0?t:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ho,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(o==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ho,"X-Stainless-OS":dA((e=globalThis.process.platform)!==null&&e!==void 0?e:"unknown"),"X-Stainless-Arch":uA((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!==null&&i!==void 0?i:"unknown"};let r=Xx();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ho,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ho,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Xx(){if(typeof navigator=="undefined"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:t,pattern:e}of s){let n=e.exec(navigator.userAgent);if(n){let i=n[1]||0,o=n[2]||0,r=n[3]||0;return{browser:t,version:`${i}.${o}.${r}`}}}return null}var uA=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",dA=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),zu,Zx=()=>zu!=null?zu:zu=Jx();function Qx(){if(typeof fetch!="undefined")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function VA(...s){let t=globalThis.ReadableStream;if(typeof t=="undefined")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...s)}function jx(s){let t=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return VA({start(){},async pull(e){let{done:n,value:i}=await t.next();n?e.close():e.enqueue(i)},async cancel(){var e;await((e=t.return)===null||e===void 0?void 0:e.call(t))}})}function qA(s){if(s[Symbol.asyncIterator])return s;let t=s.getReader();return{async next(){try{let e=await t.read();return e!=null&&e.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function tI(s){var t,e;if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await((e=(t=s[Symbol.asyncIterator]()).return)===null||e===void 0?void 0:e.call(t));return}let n=s.getReader(),i=n.cancel();n.releaseLock(),await i}var eI=({headers:s,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});var zA=()=>{var s;if(typeof File=="undefined"){let{process:t}=globalThis,e=typeof((s=t==null?void 0:t.versions)===null||s===void 0?void 0:s.node)=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Jp(s,t,e){return zA(),new File(s,t!=null?t:"unknown_file",e)}function nI(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}var iI=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function";var WA=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",sI=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&WA(s),oI=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function rI(s,t,e){if(zA(),s=await s,sI(s))return s instanceof File?s:Jp([await s.arrayBuffer()],s.name);if(oI(s)){let i=await s.blob();return t||(t=new URL(s.url).pathname.split(/[\\/]/).pop()),Jp(await Og(i),t,e)}let n=await Og(s);if(t||(t=nI(s)),!(e!=null&&e.type)){let i=n.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof i=="string"&&(e=Object.assign(Object.assign({},e),{type:i}))}return Jp(n,t,e)}async function Og(s){var t,e,n,i,o;let r=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)r.push(s);else if(WA(s))r.push(s instanceof Blob?s:await s.arrayBuffer());else if(iI(s))try{for(var a=!0,l=qe(s),c;c=await l.next(),t=c.done,!t;a=!0){i=c.value,a=!1;let d=i;r.push(...await Og(d))}}catch(d){e={error:d}}finally{try{!a&&!t&&(n=l.return)&&await n.call(l)}finally{if(e)throw e.error}}else{let d=(o=s==null?void 0:s.constructor)===null||o===void 0?void 0:o.name;throw new Error(`Unexpected data type: ${typeof s}${d?`; constructor: ${d}`:""}${aI(s)}`)}return r}function aI(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(e=>`"${e}"`).join(", ")}]`}var Td=class{constructor(t){this._client=t}};Td._key=[];function KA(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var hA=Object.freeze(Object.create(null)),lI=(s=KA)=>function(e,...n){if(e.length===1)return e[0];let i=!1,o=[],r=e.reduce((d,p,g)=>{var m,_,A;/[?#]/.test(p)&&(i=!0);let T=n[g],E=(i?encodeURIComponent:s)(""+T);return g!==n.length&&(T==null||typeof T=="object"&&T.toString===((A=Object.getPrototypeOf((_=Object.getPrototypeOf((m=T.hasOwnProperty)!==null&&m!==void 0?m:hA))!==null&&_!==void 0?_:hA))===null||A===void 0?void 0:A.toString))&&(E=T+"",o.push({start:d.length+p.length,length:E.length,error:`Value of type ${Object.prototype.toString.call(T).slice(8,-1)} is not a valid path parameter`})),d+p+(g===n.length?"":E)},""),a=r.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,c;for(;(c=l.exec(a))!==null;)o.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(o.sort((d,p)=>d.start-p.start),o.length>0){let d=0,p=o.reduce((g,m)=>{let _=" ".repeat(m.start-d),A="^".repeat(m.length);return d=m.start+m.length,g+_+A},"");throw new re(`Path parameters result in path with invalid segments:
${o.map(g=>g.error).join(`
`)}
${r}
${p}`)}return r},Wu=lI(KA);var Ed=class extends Td{create(t,e){var n;let{api_version:i=this._client.apiVersion}=t,o=dd(t,["api_version"]);if("model"in o&&"agent_config"in o)throw new re("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in o&&"generation_config"in o)throw new re("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Wu`/${i}/interactions`,Object.assign(Object.assign({body:o},e),{stream:(n=t.stream)!==null&&n!==void 0?n:!1}))}delete(t,e={},n){let{api_version:i=this._client.apiVersion}=e!=null?e:{};return this._client.delete(Wu`/${i}/interactions/${t}`,n)}cancel(t,e={},n){let{api_version:i=this._client.apiVersion}=e!=null?e:{};return this._client.post(Wu`/${i}/interactions/${t}/cancel`,n)}get(t,e={},n){var i;let o=e!=null?e:{},{api_version:r=this._client.apiVersion}=o,a=dd(o,["api_version"]);return this._client.get(Wu`/${r}/interactions/${t}`,Object.assign(Object.assign({query:a},n),{stream:(i=e==null?void 0:e.stream)!==null&&i!==void 0?i:!1}))}};Ed._key=Object.freeze(["interactions"]);var Cd=class extends Ed{};function cI(s){let t=0;for(let i of s)t+=i.length;let e=new Uint8Array(t),n=0;for(let i of s)e.set(i,n),n+=i.length;return e}var Ku;function tm(s){let t;return(Ku!=null?Ku:(t=new globalThis.TextEncoder,Ku=t.encode.bind(t)))(s)}var Yu;function fA(s){let t;return(Yu!=null?Yu:(t=new globalThis.TextDecoder,Yu=t.decode.bind(t)))(s)}var Ko=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(t){if(t==null)return[];let e=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?tm(t):t;this.buffer=cI([this.buffer,e]);let n=[],i;for(;(i=uI(this.buffer,this.carriageReturnIndex))!=null;){if(i.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=i.index;continue}if(this.carriageReturnIndex!=null&&(i.index!==this.carriageReturnIndex+1||i.carriage)){n.push(fA(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let o=this.carriageReturnIndex!==null?i.preceding-1:i.preceding,r=fA(this.buffer.subarray(0,o));n.push(r),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}};Ko.NEWLINE_CHARS=new Set([`
`,"\r"]);Ko.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function uI(s,t){for(let i=t!=null?t:0;i<s.length;i++){if(s[i]===10)return{preceding:i,index:i+1,carriage:!1};if(s[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function dI(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}var Sd={off:0,error:200,warn:300,info:400,debug:500},pA=(s,t,e)=>{if(s){if(qx(Sd,s))return s;te(e).warn(`${t} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(Sd))}`)}};function Va(){}function Ju(s,t,e){return!t||Sd[s]>Sd[e]?Va:t[s].bind(t)}var hI={error:Va,warn:Va,info:Va,debug:Va},gA=new WeakMap;function te(s){var t;let e=s.logger,n=(t=s.logLevel)!==null&&t!==void 0?t:"off";if(!e)return hI;let i=gA.get(e);if(i&&i[0]===n)return i[1];let o={error:Ju("error",e,n),warn:Ju("warn",e,n),info:Ju("info",e,n),debug:Ju("debug",e,n)};return gA.set(e,[n,o]),o}var ls=s=>(s.options&&(s.options=Object.assign({},s.options),delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([t,e])=>[t,t.toLowerCase()==="x-goog-api-key"||t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":e]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var $g=class s{constructor(t,e,n){this.iterator=t,this.controller=e,this.client=n}static fromSSEResponse(t,e,n){let i=!1,o=n?te(n):console;function r(){return Ve(this,arguments,function*(){var l,c,d,p;if(i)throw new re("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var m=!0,_=qe(fI(t,e)),A;A=yield q(_.next()),l=A.done,!l;m=!0){p=A.value,m=!1;let T=p;if(!g)if(T.data.startsWith("[DONE]")){g=!0;continue}else try{yield yield q(JSON.parse(T.data))}catch(E){throw o.error("Could not parse message into JSON:",T.data),o.error("From chunk:",T.raw),E}}}catch(T){c={error:T}}finally{try{!m&&!l&&(d=_.return)&&(yield q(d.call(_)))}finally{if(c)throw c.error}}g=!0}catch(T){if(Fg(T))return yield q(void 0);throw T}finally{g||e.abort()}})}return new s(r,e,n)}static fromReadableStream(t,e,n){let i=!1;function o(){return Ve(this,arguments,function*(){var l,c,d,p;let g=new Ko,m=qA(t);try{for(var _=!0,A=qe(m),T;T=yield q(A.next()),l=T.done,!l;_=!0){p=T.value,_=!1;let E=p;for(let C of g.decode(E))yield yield q(C)}}catch(E){c={error:E}}finally{try{!_&&!l&&(d=A.return)&&(yield q(d.call(A)))}finally{if(c)throw c.error}}for(let E of g.flush())yield yield q(E)})}function r(){return Ve(this,arguments,function*(){var l,c,d,p;if(i)throw new re("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var m=!0,_=qe(o()),A;A=yield q(_.next()),l=A.done,!l;m=!0){p=A.value,m=!1;let T=p;g||T&&(yield yield q(JSON.parse(T)))}}catch(T){c={error:T}}finally{try{!m&&!l&&(d=_.return)&&(yield q(d.call(_)))}finally{if(c)throw c.error}}g=!0}catch(T){if(Fg(T))return yield q(void 0);throw T}finally{g||e.abort()}})}return new s(r,e,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let t=[],e=[],n=this.iterator(),i=o=>({next:()=>{if(o.length===0){let r=n.next();t.push(r),e.push(r)}return o.shift()}});return[new s(()=>i(t),this.controller,this.client),new s(()=>i(e),this.controller,this.client)]}toReadableStream(){let t=this,e;return VA({async start(){e=t[Symbol.asyncIterator]()},async pull(n){try{let{value:i,done:o}=await e.next();if(o)return n.close();let r=tm(JSON.stringify(i)+`
`);n.enqueue(r)}catch(i){n.error(i)}},async cancel(){var n;await((n=e.return)===null||n===void 0?void 0:n.call(e))}})}};function fI(s,t){return Ve(this,arguments,function*(){var n,i,o,r;if(!s.body)throw t.abort(),typeof globalThis.navigator!="undefined"&&globalThis.navigator.product==="ReactNative"?new re("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new re("Attempted to iterate over a response with no body");let a=new Gg,l=new Ko,c=qA(s.body);try{for(var d=!0,p=qe(pI(c)),g;g=yield q(p.next()),n=g.done,!n;d=!0){r=g.value,d=!1;let m=r;for(let _ of l.decode(m)){let A=a.decode(_);A&&(yield yield q(A))}}}catch(m){i={error:m}}finally{try{!d&&!n&&(o=p.return)&&(yield q(o.call(p)))}finally{if(i)throw i.error}}for(let m of l.flush()){let _=a.decode(m);_&&(yield yield q(_))}})}function pI(s){return Ve(this,arguments,function*(){var e,n,i,o;let r=new Uint8Array;try{for(var a=!0,l=qe(s),c;c=yield q(l.next()),e=c.done,!e;a=!0){o=c.value,a=!1;let d=o;if(d==null)continue;let p=d instanceof ArrayBuffer?new Uint8Array(d):typeof d=="string"?tm(d):d,g=new Uint8Array(r.length+p.length);g.set(r),g.set(p,r.length),r=g;let m;for(;(m=dI(r))!==-1;)yield yield q(r.slice(0,m)),r=r.slice(m)}}catch(d){n={error:d}}finally{try{!a&&!e&&(i=l.return)&&(yield q(i.call(l)))}finally{if(n)throw n.error}}r.length>0&&(yield yield q(r))})}var Gg=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;let o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(t),t.startsWith(":"))return null;let[e,n,i]=gI(t,":");return i.startsWith(" ")&&(i=i.substring(1)),e==="event"?this.event=i:e==="data"&&this.data.push(i),null}};function gI(s,t){let e=s.indexOf(t);return e!==-1?[s.substring(0,e),t,s.substring(e+t.length)]:[s,"",""]}async function mI(s,t){let{response:e,requestLogID:n,retryOfRequestLogID:i,startTime:o}=t,r=await(async()=>{var a;if(t.options.stream)return te(s).debug("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller,s):$g.fromSSEResponse(e,t.controller,s);if(e.status===204)return null;if(t.options.__binaryResponse)return e;let l=e.headers.get("content-type"),c=(a=l==null?void 0:l.split(";")[0])===null||a===void 0?void 0:a.trim();return(c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))?await e.json():await e.text()})();return te(s).debug(`[${n}] response parsed`,ls({retryOfRequestLogID:i,url:e.url,status:e.status,body:r,durationMs:Date.now()-o})),r}var Bg=class s extends Promise{constructor(t,e,n=mI){super(i=>{i(null)}),this.responsePromise=e,this.parseResponse=n,this.client=t}_thenUnwrap(t){return new s(this.client,this.responsePromise,async(e,n)=>t(await this.parseResponse(e,n),n))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){let[t,e]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:e}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(this.client,t))),this.parsedPromise}then(t,e){return this.parse().then(t,e)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}};var YA=Symbol("brand.privateNullableHeaders");function*yI(s){if(!s)return;if(YA in s){let{values:n,nulls:i}=s;yield*n.entries();for(let o of i)yield[o,null];return}let t=!1,e;s instanceof Headers?e=s.entries():cA(s)?e=s:(t=!0,e=Object.entries(s!=null?s:{}));for(let n of e){let i=n[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");let o=cA(n[1])?n[1]:[n[1]],r=!1;for(let a of o)a!==void 0&&(t&&!r&&(r=!0,yield[i,null]),yield[i,a])}}var Ha=s=>{let t=new Headers,e=new Set;for(let n of s){let i=new Set;for(let[o,r]of yI(n)){let a=o.toLowerCase();i.has(a)||(t.delete(o),i.add(a)),r===null?(t.delete(o),e.add(a)):(t.append(o,r),e.delete(a))}}return{[YA]:!0,values:t,nulls:e}};var Xp=s=>{var t,e,n,i,o,r;if(typeof globalThis.process!="undefined")return(n=(e=(t=globalThis.process.env)===null||t===void 0?void 0:t[s])===null||e===void 0?void 0:e.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno!="undefined")return(r=(o=(i=globalThis.Deno.env)===null||i===void 0?void 0:i.get)===null||o===void 0?void 0:o.call(i,s))===null||r===void 0?void 0:r.trim()};var JA,bd=class s{constructor(t){var e,n,i,o,r,a,l,{baseURL:c=Xp("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:d=(e=Xp("GEMINI_API_KEY"))!==null&&e!==void 0?e:null,apiVersion:p="v1beta"}=t,g=dd(t,["baseURL","apiKey","apiVersion"]);let m=Object.assign(Object.assign({apiKey:d,apiVersion:p},g),{baseURL:c||"https://generativelanguage.googleapis.com"});this.baseURL=m.baseURL,this.timeout=(n=m.timeout)!==null&&n!==void 0?n:s.DEFAULT_TIMEOUT,this.logger=(i=m.logger)!==null&&i!==void 0?i:console;let _="warn";this.logLevel=_,this.logLevel=(r=(o=pA(m.logLevel,"ClientOptions.logLevel",this))!==null&&o!==void 0?o:pA(Xp("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&r!==void 0?r:_,this.fetchOptions=m.fetchOptions,this.maxRetries=(a=m.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(l=m.fetch)!==null&&l!==void 0?l:Qx(),this.encoder=eI,this._options=m,this.apiKey=d,this.apiVersion=p,this.clientAdapter=m.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:e}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!e.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){let e=Ha([t.headers]);if(!(e.values.has("authorization")||e.values.has("x-goog-api-key"))){if(this.apiKey)return Ha([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Ha([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([e,n])=>typeof n!="undefined").map(([e,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(e)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(e)}=`;throw new re(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Ho}`}defaultIdempotencyKey(){return`stainless-node-retry-${Ox()}`}makeStatusError(t,e,n,i){return ae.generate(t,e,n,i)}buildURL(t,e,n){let i=!this.baseURLOverridden()&&n||this.baseURL,o=Gx(t)?new URL(t):new URL(i+(i.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),r=this.defaultQuery();return Vx(r)||(e=Object.assign(Object.assign({},r),e)),typeof e=="object"&&e&&!Array.isArray(e)&&(o.search=this.stringifyQuery(e)),o.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){let e=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${e}`}}async prepareRequest(t,{url:e,options:n}){}get(t,e){return this.methodRequest("get",t,e)}post(t,e){return this.methodRequest("post",t,e)}patch(t,e){return this.methodRequest("patch",t,e)}put(t,e){return this.methodRequest("put",t,e)}delete(t,e){return this.methodRequest("delete",t,e)}methodRequest(t,e,n){return this.request(Promise.resolve(n).then(i=>Object.assign({method:t,path:e},i)))}request(t,e=null){return new Bg(this,this.makeRequest(t,e,void 0))}async makeRequest(t,e,n){var i,o,r;let a=await t,l=(i=a.maxRetries)!==null&&i!==void 0?i:this.maxRetries;e==null&&(e=l),await this.prepareOptions(a);let{req:c,url:d,timeout:p}=await this.buildRequest(a,{retryCount:l-e});await this.prepareRequest(c,{url:d,options:a});let g="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),m=n===void 0?"":`, retryOf: ${n}`,_=Date.now();if(te(this).debug(`[${g}] sending request`,ls({retryOfRequestLogID:n,method:a.method,url:d,options:a,headers:c.headers})),!((o=a.signal)===null||o===void 0)&&o.aborted)throw new za;let A=new AbortController,T=await this.fetchWithTimeout(d,c,p,A).catch(Lg),E=Date.now();if(T instanceof globalThis.Error){let S=`retrying, ${e} attempts remaining`;if(!((r=a.signal)===null||r===void 0)&&r.aborted)throw new za;let b=Fg(T)||/timed? ?out/i.test(String(T)+("cause"in T?String(T.cause):""));if(e)return te(this).info(`[${g}] connection ${b?"timed out":"failed"} - ${S}`),te(this).debug(`[${g}] connection ${b?"timed out":"failed"} (${S})`,ls({retryOfRequestLogID:n,url:d,durationMs:E-_,message:T.message})),this.retryRequest(a,e,n!=null?n:g);throw te(this).info(`[${g}] connection ${b?"timed out":"failed"} - error; no more retries left`),te(this).debug(`[${g}] connection ${b?"timed out":"failed"} (error; no more retries left)`,ls({retryOfRequestLogID:n,url:d,durationMs:E-_,message:T.message})),b?new fd:new Wo({cause:T})}let C=`[${g}${m}] ${c.method} ${d} ${T.ok?"succeeded":"failed"} with status ${T.status} in ${E-_}ms`;if(!T.ok){let S=await this.shouldRetry(T);if(e&&S){let M=`retrying, ${e} attempts remaining`;return await tI(T.body),te(this).info(`${C} - ${M}`),te(this).debug(`[${g}] response error (${M})`,ls({retryOfRequestLogID:n,url:T.url,status:T.status,headers:T.headers,durationMs:E-_})),this.retryRequest(a,e,n!=null?n:g,T.headers)}let b=S?"error; no more retries left":"error; not retryable";te(this).info(`${C} - ${b}`);let x=await T.text().catch(M=>Lg(M).message),P=Wx(x),I=P?void 0:x;throw te(this).debug(`[${g}] response error (${b})`,ls({retryOfRequestLogID:n,url:T.url,status:T.status,headers:T.headers,message:I,durationMs:Date.now()-_})),this.makeStatusError(T.status,P,I,T.headers)}return te(this).info(C),te(this).debug(`[${g}] response start`,ls({retryOfRequestLogID:n,url:T.url,status:T.status,headers:T.headers,durationMs:E-_})),{response:T,options:a,controller:A,requestLogID:g,retryOfRequestLogID:n,startTime:_}}async fetchWithTimeout(t,e,n,i){let o=e||{},{signal:r,method:a}=o,l=dd(o,["signal","method"]);r&&r.addEventListener("abort",()=>i.abort());let c=setTimeout(()=>i.abort(),n),d=globalThis.ReadableStream&&l.body instanceof globalThis.ReadableStream||typeof l.body=="object"&&l.body!==null&&Symbol.asyncIterator in l.body,p=Object.assign(Object.assign(Object.assign({signal:i.signal},d?{duplex:"half"}:{}),{method:"GET"}),l);a&&(p.method=a.toUpperCase());try{return await this.fetch.call(void 0,t,p)}finally{clearTimeout(c)}}async shouldRetry(t){let e=t.headers.get("x-should-retry");return e==="true"?!0:e==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,e,n,i){var o;let r,a=i==null?void 0:i.get("retry-after-ms");if(a){let c=parseFloat(a);Number.isNaN(c)||(r=c)}let l=i==null?void 0:i.get("retry-after");if(l&&!r){let c=parseFloat(l);Number.isNaN(c)?r=Date.parse(l)-Date.now():r=c*1e3}if(!(r&&0<=r&&r<60*1e3)){let c=(o=t.maxRetries)!==null&&o!==void 0?o:this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(e,c)}return await Kx(r),this.makeRequest(t,e-1,n)}calculateDefaultRetryTimeoutMillis(t,e){let o=e-t,r=Math.min(.5*Math.pow(2,o),8),a=1-Math.random()*.25;return r*a*1e3}async buildRequest(t,{retryCount:e=0}={}){var n,i,o;let r=Object.assign({},t),{method:a,path:l,query:c,defaultBaseURL:d}=r,p=this.buildURL(l,c,d);"timeout"in r&&zx("timeout",r.timeout),r.timeout=(n=r.timeout)!==null&&n!==void 0?n:this.timeout;let{bodyHeaders:g,body:m}=this.buildBody({options:r}),_=await this.buildHeaders({options:t,method:a,bodyHeaders:g,retryCount:e});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:_},r.signal&&{signal:r.signal}),globalThis.ReadableStream&&m instanceof globalThis.ReadableStream&&{duplex:"half"}),m&&{body:m}),(i=this.fetchOptions)!==null&&i!==void 0?i:{}),(o=r.fetchOptions)!==null&&o!==void 0?o:{}),url:p,timeout:r.timeout}}async buildHeaders({options:t,method:e,bodyHeaders:n,retryCount:i}){let o={};this.idempotencyHeader&&e!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=t.idempotencyKey);let r=await this.authHeaders(t),a=Ha([o,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),Zx()),this._options.defaultHeaders,n,t.headers,r]);return this.validateHeaders(a),a.values}buildBody({options:{body:t,headers:e}}){if(!t)return{bodyHeaders:void 0,body:void 0};let n=Ha([e]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&n.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:jx(t)}:this.encoder({body:t,headers:n})}};bd.DEFAULT_TIMEOUT=6e4;var vt=class extends bd{constructor(){super(...arguments),this.interactions=new Cd(this)}};JA=vt;vt.GeminiNextGenAPIClient=JA;vt.GeminiNextGenAPIClientError=re;vt.APIError=ae;vt.APIConnectionError=Wo;vt.APIConnectionTimeoutError=fd;vt.APIUserAbortError=za;vt.NotFoundError=yd;vt.ConflictError=_d;vt.RateLimitError=Ad;vt.BadRequestError=pd;vt.AuthenticationError=gd;vt.InternalServerError=wd;vt.PermissionDeniedError=md;vt.UnprocessableEntityError=vd;vt.toFile=rI;vt.Interactions=Cd;function _I(s,t){let e={},n=h(s,["name"]);return n!=null&&f(e,["_url","name"],n),e}function vI(s,t){let e={},n=h(s,["name"]);return n!=null&&f(e,["_url","name"],n),e}function AI(s,t){let e={},n=h(s,["sdkHttpResponse"]);return n!=null&&f(e,["sdkHttpResponse"],n),e}function wI(s,t){let e={},n=h(s,["sdkHttpResponse"]);return n!=null&&f(e,["sdkHttpResponse"],n),e}function TI(s,t,e){let n={};if(h(s,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let i=h(s,["tunedModelDisplayName"]);if(t!==void 0&&i!=null&&f(t,["displayName"],i),h(s,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let o=h(s,["epochCount"]);t!==void 0&&o!=null&&f(t,["tuningTask","hyperparameters","epochCount"],o);let r=h(s,["learningRateMultiplier"]);if(r!=null&&f(n,["tuningTask","hyperparameters","learningRateMultiplier"],r),h(s,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(h(s,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(h(s,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let a=h(s,["batchSize"]);t!==void 0&&a!=null&&f(t,["tuningTask","hyperparameters","batchSize"],a);let l=h(s,["learningRate"]);if(t!==void 0&&l!=null&&f(t,["tuningTask","hyperparameters","learningRate"],l),h(s,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(h(s,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function EI(s,t,e){let n={},i=h(e,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let m=h(s,["validationDataset"]);t!==void 0&&m!=null&&f(t,["supervisedTuningSpec"],mA(m))}else if(i==="PREFERENCE_TUNING"){let m=h(s,["validationDataset"]);t!==void 0&&m!=null&&f(t,["preferenceOptimizationSpec"],mA(m))}let o=h(s,["tunedModelDisplayName"]);t!==void 0&&o!=null&&f(t,["tunedModelDisplayName"],o);let r=h(s,["description"]);t!==void 0&&r!=null&&f(t,["description"],r);let a=h(e,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){let m=h(s,["epochCount"]);t!==void 0&&m!=null&&f(t,["supervisedTuningSpec","hyperParameters","epochCount"],m)}else if(a==="PREFERENCE_TUNING"){let m=h(s,["epochCount"]);t!==void 0&&m!=null&&f(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],m)}let l=h(e,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){let m=h(s,["learningRateMultiplier"]);t!==void 0&&m!=null&&f(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],m)}else if(l==="PREFERENCE_TUNING"){let m=h(s,["learningRateMultiplier"]);t!==void 0&&m!=null&&f(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],m)}let c=h(e,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){let m=h(s,["exportLastCheckpointOnly"]);t!==void 0&&m!=null&&f(t,["supervisedTuningSpec","exportLastCheckpointOnly"],m)}else if(c==="PREFERENCE_TUNING"){let m=h(s,["exportLastCheckpointOnly"]);t!==void 0&&m!=null&&f(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],m)}let d=h(e,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){let m=h(s,["adapterSize"]);t!==void 0&&m!=null&&f(t,["supervisedTuningSpec","hyperParameters","adapterSize"],m)}else if(d==="PREFERENCE_TUNING"){let m=h(s,["adapterSize"]);t!==void 0&&m!=null&&f(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],m)}if(h(s,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(h(s,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let p=h(s,["labels"]);t!==void 0&&p!=null&&f(t,["labels"],p);let g=h(s,["beta"]);return t!==void 0&&g!=null&&f(t,["preferenceOptimizationSpec","hyperParameters","beta"],g),n}function CI(s,t){let e={},n=h(s,["baseModel"]);n!=null&&f(e,["baseModel"],n);let i=h(s,["preTunedModel"]);i!=null&&f(e,["preTunedModel"],i);let o=h(s,["trainingDataset"]);o!=null&&FI(o);let r=h(s,["config"]);return r!=null&&TI(r,e),e}function SI(s,t){let e={},n=h(s,["baseModel"]);n!=null&&f(e,["baseModel"],n);let i=h(s,["preTunedModel"]);i!=null&&f(e,["preTunedModel"],i);let o=h(s,["trainingDataset"]);o!=null&&LI(o,e,t);let r=h(s,["config"]);return r!=null&&EI(r,e,t),e}function bI(s,t){let e={},n=h(s,["name"]);return n!=null&&f(e,["_url","name"],n),e}function xI(s,t){let e={},n=h(s,["name"]);return n!=null&&f(e,["_url","name"],n),e}function II(s,t,e){let n={},i=h(s,["pageSize"]);t!==void 0&&i!=null&&f(t,["_query","pageSize"],i);let o=h(s,["pageToken"]);t!==void 0&&o!=null&&f(t,["_query","pageToken"],o);let r=h(s,["filter"]);return t!==void 0&&r!=null&&f(t,["_query","filter"],r),n}function PI(s,t,e){let n={},i=h(s,["pageSize"]);t!==void 0&&i!=null&&f(t,["_query","pageSize"],i);let o=h(s,["pageToken"]);t!==void 0&&o!=null&&f(t,["_query","pageToken"],o);let r=h(s,["filter"]);return t!==void 0&&r!=null&&f(t,["_query","filter"],r),n}function RI(s,t){let e={},n=h(s,["config"]);return n!=null&&II(n,e),e}function MI(s,t){let e={},n=h(s,["config"]);return n!=null&&PI(n,e),e}function NI(s,t){let e={},n=h(s,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);let i=h(s,["nextPageToken"]);i!=null&&f(e,["nextPageToken"],i);let o=h(s,["tunedModels"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>XA(a))),f(e,["tuningJobs"],r)}return e}function kI(s,t){let e={},n=h(s,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);let i=h(s,["nextPageToken"]);i!=null&&f(e,["nextPageToken"],i);let o=h(s,["tuningJobs"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>Hg(a))),f(e,["tuningJobs"],r)}return e}function DI(s,t){let e={},n=h(s,["name"]);n!=null&&f(e,["model"],n);let i=h(s,["name"]);return i!=null&&f(e,["endpoint"],i),e}function FI(s,t){let e={};if(h(s,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(h(s,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=h(s,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>o)),f(e,["examples","examples"],i)}return e}function LI(s,t,e){let n={},i=h(e,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let r=h(s,["gcsUri"]);t!==void 0&&r!=null&&f(t,["supervisedTuningSpec","trainingDatasetUri"],r)}else if(i==="PREFERENCE_TUNING"){let r=h(s,["gcsUri"]);t!==void 0&&r!=null&&f(t,["preferenceOptimizationSpec","trainingDatasetUri"],r)}let o=h(e,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let r=h(s,["vertexDatasetResource"]);t!==void 0&&r!=null&&f(t,["supervisedTuningSpec","trainingDatasetUri"],r)}else if(o==="PREFERENCE_TUNING"){let r=h(s,["vertexDatasetResource"]);t!==void 0&&r!=null&&f(t,["preferenceOptimizationSpec","trainingDatasetUri"],r)}if(h(s,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function XA(s,t){let e={},n=h(s,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);let i=h(s,["name"]);i!=null&&f(e,["name"],i);let o=h(s,["state"]);o!=null&&f(e,["state"],CA(o));let r=h(s,["createTime"]);r!=null&&f(e,["createTime"],r);let a=h(s,["tuningTask","startTime"]);a!=null&&f(e,["startTime"],a);let l=h(s,["tuningTask","completeTime"]);l!=null&&f(e,["endTime"],l);let c=h(s,["updateTime"]);c!=null&&f(e,["updateTime"],c);let d=h(s,["description"]);d!=null&&f(e,["description"],d);let p=h(s,["baseModel"]);p!=null&&f(e,["baseModel"],p);let g=h(s,["_self"]);return g!=null&&f(e,["tunedModel"],DI(g)),e}function Hg(s,t){let e={},n=h(s,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);let i=h(s,["name"]);i!=null&&f(e,["name"],i);let o=h(s,["state"]);o!=null&&f(e,["state"],CA(o));let r=h(s,["createTime"]);r!=null&&f(e,["createTime"],r);let a=h(s,["startTime"]);a!=null&&f(e,["startTime"],a);let l=h(s,["endTime"]);l!=null&&f(e,["endTime"],l);let c=h(s,["updateTime"]);c!=null&&f(e,["updateTime"],c);let d=h(s,["error"]);d!=null&&f(e,["error"],d);let p=h(s,["description"]);p!=null&&f(e,["description"],p);let g=h(s,["baseModel"]);g!=null&&f(e,["baseModel"],g);let m=h(s,["tunedModel"]);m!=null&&f(e,["tunedModel"],m);let _=h(s,["preTunedModel"]);_!=null&&f(e,["preTunedModel"],_);let A=h(s,["supervisedTuningSpec"]);A!=null&&f(e,["supervisedTuningSpec"],A);let T=h(s,["preferenceOptimizationSpec"]);T!=null&&f(e,["preferenceOptimizationSpec"],T);let E=h(s,["tuningDataStats"]);E!=null&&f(e,["tuningDataStats"],E);let C=h(s,["encryptionSpec"]);C!=null&&f(e,["encryptionSpec"],C);let S=h(s,["partnerModelTuningSpec"]);S!=null&&f(e,["partnerModelTuningSpec"],S);let b=h(s,["customBaseModel"]);b!=null&&f(e,["customBaseModel"],b);let x=h(s,["experiment"]);x!=null&&f(e,["experiment"],x);let P=h(s,["labels"]);P!=null&&f(e,["labels"],P);let I=h(s,["outputUri"]);I!=null&&f(e,["outputUri"],I);let N=h(s,["pipelineJob"]);N!=null&&f(e,["pipelineJob"],N);let M=h(s,["serviceAccount"]);M!=null&&f(e,["serviceAccount"],M);let F=h(s,["tunedModelDisplayName"]);F!=null&&f(e,["tunedModelDisplayName"],F);let U=h(s,["veoTuningSpec"]);return U!=null&&f(e,["veoTuningSpec"],U),e}function UI(s,t){let e={},n=h(s,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);let i=h(s,["name"]);i!=null&&f(e,["name"],i);let o=h(s,["metadata"]);o!=null&&f(e,["metadata"],o);let r=h(s,["done"]);r!=null&&f(e,["done"],r);let a=h(s,["error"]);return a!=null&&f(e,["error"],a),e}function mA(s,t){let e={},n=h(s,["gcsUri"]);n!=null&&f(e,["validationDatasetUri"],n);let i=h(s,["vertexDatasetResource"]);return i!=null&&f(e,["validationDatasetUri"],i),e}var Vg=class extends ze{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new Un(Ln.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(e),e),this.get=async e=>await this.getInternal(e),this.tune=async e=>{var n;if(this.apiClient.isVertexAI())if(e.baseModel.startsWith("projects/")){let i={tunedModelName:e.baseModel};!((n=e.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(i.checkpointId=e.config.preTunedModelCheckpointId);let o=Object.assign(Object.assign({},e),{preTunedModel:i});return o.baseModel=void 0,await this.tuneInternal(o)}else{let i=Object.assign({},e);return await this.tuneInternal(i)}else{let i=Object.assign({},e),o=await this.tuneMldevInternal(i),r="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?r=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(r=o.name.split("/operations/")[0]),{name:r,state:Qp.JOB_STATE_QUEUED}}}}async getInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=xI(t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>Hg(d))}else{let c=bI(t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>XA(d))}}async listInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=MI(t);return a=D("tuningJobs",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=kI(d),g=new od;return Object.assign(g,p),g})}else{let c=RI(t);return a=D("tunedModels",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=NI(d),g=new od;return Object.assign(g,p),g})}}async cancel(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=vI(t);return a=D("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=wI(d),g=new rd;return Object.assign(g,p),g})}else{let c=_I(t);return a=D("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=AI(d),g=new rd;return Object.assign(g,p),g})}}async tuneInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=SI(t,t);return o=D("tuningJobs",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>Hg(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=CI(t);return o=D("tunedModels",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>UI(l))}}};var qg=class{async download(t,e){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},OI=1024*1024*8,$I=3,GI=1e3,BI=2,xd="x-goog-upload-status";async function HI(s,t,e){var n;let i=await ZA(s,t,e),o=await(i==null?void 0:i.json());if(((n=i==null?void 0:i.headers)===null||n===void 0?void 0:n[xd])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function VI(s,t,e){var n;let i=await ZA(s,t,e),o=await(i==null?void 0:i.json());if(((n=i==null?void 0:i.headers)===null||n===void 0?void 0:n[xd])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let r=_A(o),a=new fg;return Object.assign(a,r),a}async function ZA(s,t,e){var n,i;let o=0,r=0,a=new qa(new Response),l="upload";for(o=s.size;r<o;){let c=Math.min(OI,o-r),d=s.slice(r,r+c);r+c>=o&&(l+=", finalize");let p=0,g=GI;for(;p<$I&&(a=await e.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(r),"Content-Length":String(c)}}}),!(!((n=a==null?void 0:a.headers)===null||n===void 0)&&n[xd]));)p++,await zI(g),g=g*BI;if(r+=c,((i=a==null?void 0:a.headers)===null||i===void 0?void 0:i[xd])!=="active")break;if(o<=r)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function qI(s){return{size:s.size,type:s.type}}function zI(s){return new Promise(t=>setTimeout(t,s))}var zg=class{async upload(t,e,n){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await HI(t,e,n)}async uploadToFileSearchStore(t,e,n){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await VI(t,e,n)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await qI(t)}};var Wg=class{create(t,e,n){return new Kg(t,e,n)}},Kg=class{constructor(t,e,n){this.url=t,this.headers=e,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var yA="x-goog-api-key",Yg=class{constructor(t){this.apiKey=t}async addAuthHeaders(t,e){if(t.get(yA)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");t.append(yA,this.apiKey)}}};var WI="gl-node/",Id=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let t=this.httpOptions;t!=null&&t.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let e=new vt({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:t==null?void 0:t.timeout});return this._interactions=e.interactions,this._interactions}constructor(t){var e;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(e=t.vertexai)!==null&&e!==void 0?e:!1,this.apiKey=t.apiKey;let n=TE(t.httpOptions,t.vertexai,void 0,void 0);n&&(t.httpOptions?t.httpOptions.baseUrl=n:t.httpOptions={baseUrl:n}),this.apiVersion=t.apiVersion,this.httpOptions=t.httpOptions;let i=new Yg(this.apiKey);this.apiClient=new Cg({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:WI+"web",uploader:new zg,downloader:new qg}),this.models=new Rg(this.apiClient),this.live=new Ig(this.apiClient,i,new Wg),this.batches=new mg(this.apiClient),this.chats=new _g(this.models,this.apiClient),this.caches=new yg(this.apiClient),this.files=new Ag(this.apiClient),this.operations=new Mg(this.apiClient),this.authTokens=new Ng(this.apiClient),this.tunings=new Vg(this.apiClient),this.fileSearchStores=new Dg(this.apiClient)}};var QA=`\uB108\uB294 \uB098\uC758 \uAC1C\uC778 \uC9C0\uC2DD\uAD00\uB9AC \uC2DC\uC2A4\uD15C\uC5D0\uC11C \uB178\uD2B8\uB97C \uD504\uB85C\uC81D\uD2B8\uBCC4\uB85C \uBD84\uB958\uD558\uB294 \uBE44\uC11C\uB2E4.
\uC544\uB798 \uB178\uD2B8 \uB0B4\uC6A9\uC744 \uC77D\uACE0 \uC5B4\uB5A4 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC18D\uD558\uB294\uC9C0 **\uC2E0\uC911\uD558\uAC8C** \uD310\uB2E8\uD574\uB77C.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uBD84\uB958 \uADDC\uCE59 (\uC911\uC694\uB3C4 \uC21C)

### 1. \uD504\uB85C\uC81D\uD2B8 \uC0B0\uCD9C\uBB3C (contentType: "artifact")
\uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC9C1\uC811 \uC800\uC7A5\uD574\uC57C \uD560 \uAC83:
- \uC9C1\uC811 \uC791\uC131\uD55C \uBB38\uC11C, \uACC4\uD68D\uC11C, \uD68C\uC758\uB85D
- \uD504\uB85C\uC81D\uD2B8\uB97C \uC704\uD574 \uB9CC\uB4E0 \uCF54\uB4DC, \uC124\uACC4\uC11C
- \uD504\uB85C\uC81D\uD2B8 \uC9C4\uD589 \uAD00\uB828 \uBA54\uBAA8

### 2. \uD504\uB85C\uC81D\uD2B8 \uCC38\uACE0\uC790\uB8CC (contentType: "reference")
Library\uC5D0 \uC800\uC7A5\uD558\uB418 \uD504\uB85C\uC81D\uD2B8\uC640 \uB9C1\uD06C\uD574\uC57C \uD560 \uAC83:
- \uC678\uBD80 \uD29C\uD1A0\uB9AC\uC5BC, \uC608\uC81C \uCF54\uB4DC, \uBB38\uC11C
- \uC6F9\uD398\uC774\uC9C0 \uC2A4\uD06C\uB7A9, \uC544\uD2F0\uD074
- \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uC790\uB8CC
- \uC608: "ESP32 \uC608\uC81C" \u2192 \uD30C\uCE20\uD31C\uC5D0 \uC720\uC6A9\uD558\uC9C0\uB9CC Library\uC5D0 \uC800\uC7A5

### 3. \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC (targetType: "library", contentType: "general")
- \uD2B9\uC815 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828 \uC5C6\uB294 \uC77C\uBC18 \uC815\uBCF4
- \uB274\uC2A4, \uACF5\uACE0, \uC77C\uBC18 \uC544\uD2F0\uD074

### 4. archive
- \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83

## \uD310\uB2E8 \uAE30\uC900
- "\uC774\uAC74 \uB0B4\uAC00 \uC9C1\uC811 \uB9CC\uB4E0 \uC0B0\uCD9C\uBB3C\uC778\uAC00?" \u2192 artifact
- "\uC774\uAC74 \uC678\uBD80 \uC790\uB8CC\uC778\uB370 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC720\uC6A9\uD55C\uAC00?" \u2192 reference
- "\uC774\uAC74 \uADF8\uB0E5 \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC\uC778\uAC00?" \u2192 general
- "\uD504\uB85C\uC81D\uD2B8 \uB05D\uB098\uB3C4 \uACC4\uC18D \uCC38\uACE0\uD560 \uC790\uB8CC\uC778\uAC00?" \u2192 reference (Library)

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "targetType": "project \uB610\uB294 library \uB610\uB294 archive",
  "contentType": "artifact \uB610\uB294 reference \uB610\uB294 general",
  "projectName": "\uD504\uB85C\uC81D\uD2B8\uBA85 (project \uB610\uB294 reference\uC77C \uB54C)",
  "isNewProject": true/false,
  "confidence": "high \uB610\uB294 medium \uB610\uB294 low",
  "reason": "\uC774 \uBD84\uB958\uB97C \uC120\uD0DD\uD55C \uC774\uC720 (1\uC904)",
  "title": "\uB178\uD2B8 \uC81C\uBAA9",
  "summary": "2-3\uBB38\uC7A5 \uC694\uC57D",
  "nextAction": "\uB2E4\uC74C \uD589\uB3D9 \uB610\uB294 null"
}
`,jA=`\uB108\uB294 \uC81C\uD154\uCE74\uC2A4\uD150(Zettelkasten) \uBC29\uC2DD\uC758 \uC601\uAD6C \uB178\uD2B8\uB97C \uB9CC\uB4DC\uB294 \uBE44\uC11C\uB2E4.
\uC544\uB798 \uB178\uD2B8\uC5D0\uC11C \uC81C\uD154\uCE74\uC2A4\uD150\uC6A9 \uC601\uAD6C \uB178\uD2B8 \uD6C4\uBCF4 \uC544\uC774\uB514\uC5B4\uB4E4\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uD55C \uB178\uD2B8\uC5D0\uB294 \uD558\uB098\uC758 \uC544\uC774\uB514\uC5B4\uB9CC \uB2F4\uB294\uB2E4 (atomic note)
- \uAC01 \uC544\uC774\uB514\uC5B4\uB294 3-5\uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD55C\uB2E4
- \uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C
- \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC5F0\uACB0\uB420 \uC218 \uC788\uB294 \uAC1C\uB150 2-3\uAC1C\uB97C \uC81C\uC548\uD574\uB77C
- \uC544\uC774\uB514\uC5B4\uB9C8\uB2E4 \uC5F0\uAD00 \uD0A4\uC6CC\uB4DC\uB97C \uD568\uAED8 \uC801\uC5B4\uB77C

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uC544\uC774\uB514\uC5B4\uB97C \uD55C \uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD558\uB294 \uC81C\uBAA9",
    "body": "3-5\uBB38\uC7A5\uC758 \uC124\uBA85",
    "importance": "\uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uAC00? (1\uC904)",
    "relatedConcepts": ["\uAC1C\uB1501", "\uAC1C\uB1502", "\uAC1C\uB1503"],
    "keywords": ["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3"]
  }
]

\uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uC744 \uBC18\uD658\uD574\uB77C.
`,tw=`\uB108\uB294 \uB098\uC758 \uC791\uC5C5 \uC6B0\uC120\uC21C\uC704 \uCF54\uCE58\uB2E4.
\uC544\uB798 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D\uC744 \uBCF4\uACE0, \uC9C0\uAE08 \uB0B4\uAC00 \uC9D1\uC911\uD574\uC57C \uD560 \uC0C1\uC704 3\uAC1C\uB9CC \uACE8\uB77C\uB77C.

## \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uAC01 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uB300\uD574 \uB2E4\uC74C\uC744 \uC81C\uACF5\uD574\uB77C
- title: \uD504\uB85C\uC81D\uD2B8 \uC774\uB984
- why: \uC65C \uC9C0\uAE08 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904 \uC124\uBA85
- next_action: \uC624\uB298 \uB2F9\uC7A5 \uD560 \uC218 \uC788\uB294 \uAC00\uC7A5 \uC791\uC740 \uB2E4\uC74C \uD589\uB3D9

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uD504\uB85C\uC81D\uD2B8 \uC774\uB984",
    "why": "\uC911\uC694\uD55C \uC774\uC720",
    "next_action": "\uB2E4\uC74C \uD589\uB3D9"
  }
]
`,ew=`\uC774 \uC774\uBBF8\uC9C0\uC5D0\uC11C \uD14D\uC2A4\uD2B8\uB97C \uCD94\uCD9C\uD574\uB77C.
\uC190\uAE00\uC528, \uC778\uC1C4\uBB3C, \uC2A4\uCE94 \uBB38\uC11C \uB4F1 \uBAA8\uB4E0 \uD615\uD0DC\uC758 \uD14D\uC2A4\uD2B8\uB97C \uC77D\uC5B4\uB77C.

## \uADDC\uCE59
- \uC774\uBBF8\uC9C0\uC5D0 \uBCF4\uC774\uB294 \uBAA8\uB4E0 \uD14D\uC2A4\uD2B8\uB97C \uADF8\uB300\uB85C \uCD94\uCD9C
- \uC6D0\uBCF8\uC758 \uC904\uBC14\uAFC8\uACFC \uAD6C\uC870\uB97C \uCD5C\uB300\uD55C \uC720\uC9C0
- \uD45C\uAC00 \uC788\uC73C\uBA74 \uB9C8\uD06C\uB2E4\uC6B4 \uD45C\uB85C \uBCC0\uD658
- \uC77D\uC744 \uC218 \uC5C6\uB294 \uBD80\uBD84\uC740 [\uBD88\uBA85\uD655] \uC73C\uB85C \uD45C\uC2DC
- \uD14D\uC2A4\uD2B8\uB9CC \uCD9C\uB825\uD558\uACE0 \uB2E4\uB978 \uC124\uBA85\uC740 \uD558\uC9C0 \uB9C8\uB77C
`,nw=`\uB178\uD2B8 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD575\uC2EC \uD0A4\uC6CC\uB4DC 5-10\uAC1C\uB97C \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uAE30\uC220 \uC6A9\uC5B4, \uD504\uB85C\uC81D\uD2B8\uBA85, \uC8FC\uC694 \uAC1C\uB150 \uC704\uC8FC\uB85C \uCD94\uCD9C
- \uB108\uBB34 \uC77C\uBC18\uC801\uC778 \uB2E8\uC5B4 (\uC608: \uBC29\uBC95, \uB0B4\uC6A9, \uC815\uBCF4)\uB294 \uC81C\uC678
- \uD55C\uAE00/\uC601\uC5B4 \uBAA8\uB450 \uAC00\uB2A5
- \uBCF5\uD569 \uBA85\uC0AC\uB294 \uBD84\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C (\uC608: "\uC2A4\uB9C8\uD2B8\uD31C", "API\uD0A4")

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3", ...]
`,iw=`\uC0C8 \uB178\uD2B8\uC640 \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4\uC758 \uAD00\uB828\uC131\uC744 \uBD84\uC11D\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {newTitle}
\uD0A4\uC6CC\uB4DC: {newKeywords}

## \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4
{candidates}

## \uADDC\uCE59
- \uAC01 \uD6C4\uBCF4 \uB178\uD2B8\uC5D0 \uB300\uD574 \uAD00\uB828\uB3C4 \uC810\uC218(0.0~1.0)\uB97C \uB9E4\uACA8\uB77C
- 0.5 \uC774\uC0C1\uC778 \uB178\uD2B8\uB9CC \uBC18\uD658
- \uCD5C\uB300 5\uAC1C\uAE4C\uC9C0\uB9CC \uBC18\uD658
- \uAD00\uB828\uB3C4 \uB192\uC740 \uC21C\uC73C\uB85C \uC815\uB82C
- \uAC01 \uC5F0\uACB0\uC758 "\uC774\uC720"\uB97C \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C (\uC65C \uAD00\uB828\uC788\uB294\uAC00?)
- \uC5F0\uACB0 \uC720\uD615 \uBD84\uB958: \uD655\uC7A5|\uBC18\uBC15|\uC608\uC2DC|\uC804\uC81C|\uC751\uC6A9 \uC911 \uD558\uB098

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
[
  {
    "index": 0,
    "relevance": 0.8,
    "reason": "\uC774 \uB178\uD2B8\uC640 \uAD00\uB828\uC788\uB294 \uAD6C\uCCB4\uC801 \uC774\uC720",
    "type": "\uD655\uC7A5"
  }
]
`,sw=`\uC0C8 \uB178\uD2B8\uAC00 \uC5B4\uB5A4 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828\uC788\uB294\uC9C0 **\uC2E0\uC911\uD558\uAC8C** \uD310\uB2E8\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {noteTitle}
\uD0A4\uC6CC\uB4DC: {noteKeywords}

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- \uB178\uD2B8\uC758 **\uD575\uC2EC \uC8FC\uC81C**\uAC00 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB420 \uB54C\uB9CC \uD504\uB85C\uC81D\uD2B8 \uC120\uD0DD
- \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
- **\uD655\uC2E4\uD558\uC9C0 \uC54A\uC73C\uBA74 "None" \uBC18\uD658** (\uC798\uBABB\uB41C \uBD84\uB958\uBCF4\uB2E4 \uB098\uC74C)
- \uC77C\uBC18\uC801\uC778 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 \u2192 "None"
- \uC0C8\uB85C\uC6B4 \uD504\uB85C\uC81D\uD2B8\uB85C \uBCF4\uC774\uBA74 "NEW: \uD504\uB85C\uC81D\uD2B8\uBA85" \uD615\uC2DD\uC73C\uB85C \uBC18\uD658

## \uCD9C\uB825 \uD615\uC2DD (\uD504\uB85C\uC81D\uD2B8\uBA85\uB9CC \uC751\uB2F5)
\uD504\uB85C\uC81D\uD2B8\uBA85 \uB610\uB294 None \uB610\uB294 NEW: \uC0C8\uD504\uB85C\uC81D\uD2B8\uBA85
`,ow=`\uC720\uD29C\uBE0C \uC601\uC0C1\uC758 \uC790\uB9C9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uC790\uB9C9 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,rw=`\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBCF8\uBB38 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uAE00\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uAD11\uACE0\uB098 \uAD00\uB828 \uC5C6\uB294 \uB0B4\uC6A9\uC740 \uBB34\uC2DC\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,aw=`\uB108\uB294 \uBA54\uBAA8\uB97C \uBD84\uC11D\uD558\uC5EC \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uBCC4\uB85C \uBD84\uB9AC\uD558\uB294 \uBE44\uC11C\uB2E4.
\uD558\uB098\uC758 \uBA54\uBAA8\uC5D0 \uC5EC\uB7EC \uC8FC\uC81C\uB098 \uD504\uB85C\uC81D\uD2B8 \uAD00\uB828 \uB0B4\uC6A9\uC774 \uC11E\uC5EC \uC788\uC744 \uC218 \uC788\uB2E4.
\uAC01\uAC01\uC744 \uB3C5\uB9BD\uC801\uC778 \uB178\uD2B8\uB85C \uBD84\uB9AC\uD574\uB77C.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D (\uCC38\uACE0\uC6A9)
{projects}

## \uBA54\uBAA8 \uB0B4\uC6A9
{content}

## \uBD84\uB9AC \uADDC\uCE59
- \uC11C\uB85C \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uB294 \uBC18\uB4DC\uC2DC \uBD84\uB9AC\uD574\uB77C
- \uD55C \uC904\uC9DC\uB9AC \uBA54\uBAA8\uB3C4 \uC758\uBBF8\uAC00 \uC788\uC73C\uBA74 \uBD84\uB9AC \uB300\uC0C1\uC774\uB2E4
- \uAD00\uB828 \uB0B4\uC6A9\uC740 \uD558\uB098\uB85C \uBB36\uC5B4\uB77C (\uACFC\uB3C4\uD55C \uBD84\uB9AC \uAE08\uC9C0)
- \uAC01 \uC139\uC158\uC5D0 \uC801\uC808\uD55C \uC81C\uBAA9\uC744 \uBD99\uC5EC\uB77C

## \uBD84\uB958 \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- **project**: \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB41C \uB0B4\uC6A9\uB9CC
  - \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
  - \uC608: "\uC2A4\uB9C8\uD2B8\uD31C" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC788\uC5B4\uB3C4 "\uB18D\uC5C5 \uB274\uC2A4"\uB294 library
- **library**: \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 (**\uC560\uB9E4\uD558\uBA74 library**)
- **archive**: \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83
- \uC0C8 \uD504\uB85C\uC81D\uD2B8: \uBA85\uD655\uD55C \uBAA9\uD45C\uAC00 \uC788\uB294 \uC0C8\uB85C\uC6B4 \uC791\uC5C5\uC77C \uB54C\uB9CC isNewProject: true

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uBD84\uB9AC\uB41C \uC139\uC158\uC758 \uC81C\uBAA9",
    "content": "\uD574\uB2F9 \uC139\uC158\uC758 \uC6D0\uBCF8 \uB0B4\uC6A9 (\uC815\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C)",
    "targetType": "project",
    "projectName": "\uC2A4\uB9C8\uD2B8\uD31C",
    "isNewProject": false,
    "keywords": ["\uC13C\uC11C", "\uB370\uC774\uD130", "IoT"],
    "isAtomic": false
  }
]

\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC73C\uBA74 \uC804\uCCB4\uB97C \uD558\uB098\uC758 \uC139\uC158\uC73C\uB85C \uBC18\uD658\uD574\uB77C.
`,lw=`\uC8FC\uC81C\uC5D0 \uC18D\uD55C ZK \uB178\uD2B8\uB4E4\uC744 \uBD84\uC11D\uD558\uC5EC \uAD6C\uC870\uD654\uB41C \uC124\uBA85\uC744 \uC0DD\uC131\uD574\uB77C.

## \uC8FC\uC81C
{topic}

## \uB178\uD2B8 \uBAA9\uB85D
{notes}

## \uADDC\uCE59
- \uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85 \uC791\uC131
- \uAC01 \uB178\uD2B8\uC758 \uC5ED\uD560/\uC704\uCE58 \uC124\uBA85 (\uAE30\uCD08, \uC2EC\uD654, \uC751\uC6A9, \uC608\uC2DC \uC911 \uD558\uB098)
- \uB178\uD2B8 \uAC04 \uAD00\uACC4 \uD45C\uC2DC (\uBC1C\uC804, \uAE30\uBC18, \uAD00\uB828 \uC911 \uD558\uB098)
- \uAD00\uB828 \uC8FC\uC81C 2-3\uAC1C \uC81C\uC548

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "description": "\uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85",
  "notes": [
    {
      "title": "\uB178\uD2B8 \uC81C\uBAA9",
      "role": "\uAE30\uCD08",
      "relations": [{"target": "\uB2E4\uB978\uB178\uD2B8\uC81C\uBAA9", "type": "\uBC1C\uC804"}]
    }
  ],
  "relatedTopics": ["\uAD00\uB828\uC8FC\uC81C1", "\uAD00\uB828\uC8FC\uC81C2"]
}
`;var KI=1e3,YI=3,JI=2e3,Ne="gemini-3-flash-preview",Nd=class{constructor(t){this.lastRequestTime=0;this.minDelayMs=KI;this.ai=new Id({apiKey:t})}async waitForRateLimit(){let e=Date.now()-this.lastRequestTime;if(e<this.minDelayMs){let n=this.minDelayMs-e;await this.delay(n)}this.lastRequestTime=Date.now()}delay(t){return new Promise(e=>setTimeout(e,t))}async callWithRetry(t,e=YI){await this.waitForRateLimit();for(let n=0;n<=e;n++)try{return await t()}catch(i){if(i instanceof Error&&(i.message.includes("429")||i.message.includes("RESOURCE_EXHAUSTED")||i.message.includes("quota"))&&n<e){let r=JI*Math.pow(2,n);console.log(`Rate limit hit, retrying in ${r/1e3}s... (attempt ${n+1}/${e})`),await this.delay(r),this.minDelayMs=Math.min(this.minDelayMs*1.5,5e3)}else throw i}throw new Error("Max retries exceeded")}async classifyProject(t,e){var a;let n=e.length>0?e.map((l,c)=>`${c+1}. ${l}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",i=QA.replace("{projects}",n).replace("{content}",t),r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Ne,contents:i}))).text)!=null?a:"";return this.parseProjectResponse(r)}async extractZK(t){var o;let e=jA.replace("{content}",t),i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Ne,contents:e}))).text)!=null?o:"";return this.parseZKResponse(i)}async getFocus(t){var o;let e=tw.replace("{projects}",t),i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Ne,contents:e}))).text)!=null?o:"";return this.parseFocusResponse(i)}parseProjectResponse(t){var n;let e=t.match(/\{[\s\S]*\}/);if(!e)throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: JSON \uC5C6\uC74C");try{let i=JSON.parse(e[0]);return{targetType:this.validateTargetType(i.targetType),projectName:i.projectName||void 0,isNewProject:(n=i.isNewProject)!=null?n:!1,title:i.title||"Untitled",summary:i.summary||"",nextAction:i.nextAction||null}}catch(i){throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: "+t)}}parseZKResponse(t){let e=t.match(/\[[\s\S]*\]/);if(!e)return[];try{return JSON.parse(e[0]).map(i=>({title:i.title,body:i.body,keywords:i.keywords||[],importance:i.importance||"",relatedConcepts:i.relatedConcepts||[]}))}catch(n){return console.error("ZK \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),[]}}parseFocusResponse(t){let e=t.match(/\[[\s\S]*\]/);if(!e)return[];try{return JSON.parse(e[0]).map(i=>({title:i.title,why:i.why,nextAction:i.next_action}))}catch(n){return console.error("Focus \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),[]}}async extractTextFromImage(t,e){var i;return(i=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Ne,contents:[{role:"user",parts:[{text:ew},{inlineData:{mimeType:e,data:t}}]}]}))).text)!=null?i:""}async extractTextFromImages(t,e){let n=[];for(let i=0;i<t.length;i++){let o=t[i];e&&e(i+1,t.length);let r=await this.extractTextFromImage(o.base64,o.mimeType);n.push(r),i<t.length-1&&await this.delay(500)}return n}async extractKeywords(t){var o;let e=nw.replace("{content}",t),i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Ne,contents:e}))).text)!=null?o:"";return this.parseKeywordsResponse(i)}async findRelatedNotes(t,e,n){var a;let i=iw.replace("{newTitle}",t).replace("{newKeywords}",e.join(", ")).replace("{candidates}",n),r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Ne,contents:i}))).text)!=null?a:"";return this.parseRelatedNotesResponse(r)}async detectProject(t,e,n){var l;if(n.length===0)return null;let i=sw.replace("{noteTitle}",t).replace("{noteKeywords}",e.join(", ")).replace("{projects}",n.map((c,d)=>`${d+1}. ${c}`).join(`
`)),r=((l=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Ne,contents:i}))).text)!=null?l:"").trim();return r.toLowerCase()==="none"||r===""?null:r.startsWith("NEW:")?r:n.find(c=>r.toLowerCase().includes(c.toLowerCase()))||null}async summarizeContent(t,e){var a;let i=(e==="youtube"?ow:rw).replace("{content}",t),r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Ne,contents:i}))).text)!=null?a:"";return this.parseSummaryResponse(r)}async analyzeYouTube(t){var o;let e=`\uC774 YouTube \uC601\uC0C1\uC744 \uBD84\uC11D\uD574\uC8FC\uC138\uC694.

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD654\uBA74\uC5D0 \uBCF4\uC774\uB294 \uD14D\uC2A4\uD2B8, \uC2AC\uB77C\uC774\uB4DC, \uCF54\uB4DC \uB4F1\uB3C4 \uCC38\uACE0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Ne,contents:[{role:"user",parts:[{fileData:{mimeType:"video/mp4",fileUri:t}},{text:e}]}]}))).text)!=null?o:"";return this.parseSummaryResponse(i)}async analyzeWebpage(t){var o;let e=`\uB2E4\uC74C \uC6F9\uD398\uC774\uC9C0\uB97C \uBD84\uC11D\uD574\uC8FC\uC138\uC694: ${t}

## \uADDC\uCE59
- \uD398\uC774\uC9C0\uC758 \uD575\uC2EC \uB0B4\uC6A9\uC744 \uC815\uD655\uD788 \uD30C\uC545\uD574\uB77C
- \uACF5\uACE0/\uBAA8\uC9D1\uC774\uBA74: \uB300\uC0C1, \uC870\uAC74, \uAE30\uAC04, \uD61C\uD0DD\uC744 \uAD6C\uCCB4\uC801\uC73C\uB85C
- \uB274\uC2A4/\uAE30\uC0AC\uBA74: \uD575\uC2EC \uC0AC\uC2E4, \uBC30\uACBD, \uC758\uBBF8\uB97C
- \uC81C\uD488/\uC11C\uBE44\uC2A4\uBA74: \uC8FC\uC694 \uAE30\uB2A5, \uAC00\uACA9, \uD2B9\uC9D5\uC744
- \uC77C\uBC18 \uC815\uBCF4\uBA74: \uD575\uC2EC \uBA54\uC2DC\uC9C0\uC640 \uC911\uC694 \uC138\uBD80\uC0AC\uD56D\uC744
- \uC804\uBB38 \uC6A9\uC5B4, \uACE0\uC720\uBA85\uC0AC, \uC22B\uC790\uB294 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD398\uC774\uC9C0 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D (\uAD6C\uCCB4\uC801\uC778 \uC815\uBCF4 \uD3EC\uD568)",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Ne,contents:e,config:{tools:[{urlContext:{}}]}}))).text)!=null?o:"";return this.parseSummaryResponse(i)}parseSummaryResponse(t){let e=t.match(/\{[\s\S]*\}/);if(!e)return{title:"Untitled",summary:t.trim(),keyPoints:[]};try{let n=JSON.parse(e[0]);return{title:n.title||"Untitled",summary:n.summary||"",keyPoints:Array.isArray(n.keyPoints)?n.keyPoints:[]}}catch(n){return console.error("\uC694\uC57D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),{title:"Untitled",summary:t.trim(),keyPoints:[]}}}parseKeywordsResponse(t){let e=t.match(/\[[\s\S]*\]/);if(!e)return[];try{let n=JSON.parse(e[0]);return Array.isArray(n)?n.filter(i=>typeof i=="string"):[]}catch(n){return console.error("\uD0A4\uC6CC\uB4DC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),[]}}parseRelatedNotesResponse(t){let e=t.match(/\[[\s\S]*\]/);if(!e)return[];try{let n=JSON.parse(e[0]);return Array.isArray(n)?n.filter(i=>typeof i=="object"&&typeof i.index=="number"&&typeof i.relevance=="number").filter(i=>i.relevance>=.5).sort((i,o)=>o.relevance-i.relevance).slice(0,5).map(i=>({index:i.index,relevance:i.relevance,reason:i.reason||"",type:i.type||""})):[]}catch(n){return console.error("\uAD00\uB828 \uB178\uD2B8 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),[]}}async generateTopicStructure(t,e){var r;let n=lw.replace("{topic}",t).replace("{notes}",e),o=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Ne,contents:n}))).text)!=null?r:"";return this.parseTopicStructureResponse(o)}parseTopicStructureResponse(t){let e=t.match(/\{[\s\S]*\}/);if(!e)return{description:"",notes:[],relatedTopics:[]};try{let n=JSON.parse(e[0]);return{description:n.description||"",notes:Array.isArray(n.notes)?n.notes:[],relatedTopics:Array.isArray(n.relatedTopics)?n.relatedTopics:[]}}catch(n){return console.error("\uC8FC\uC81C \uAD6C\uC870 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),{description:"",notes:[],relatedTopics:[]}}}async splitContent(t,e){var a;let n=e.length>0?e.map((l,c)=>`${c+1}. ${l}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",i=aw.replace("{projects}",n).replace("{content}",t),r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:Ne,contents:i}))).text)!=null?a:"";return this.parseSplitResponse(r)}parseSplitResponse(t){let e=t.match(/\[[\s\S]*\]/);if(!e)return[];try{let n=JSON.parse(e[0]);return Array.isArray(n)?n.map(i=>{var o,r;return{title:i.title||"Untitled",content:i.content||"",targetType:this.validateTargetType(i.targetType),project:i.projectName||void 0,isNewProject:(o=i.isNewProject)!=null?o:!1,keywords:Array.isArray(i.keywords)?i.keywords:[],isAtomic:(r=i.isAtomic)!=null?r:!1}}):[]}catch(n){return console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),[]}}validateTargetType(t){return["project","library","archive"].includes(t)?t:"library"}};var M_=require("obsidian");var zP={};var dl={};dl.d=(s,t)=>{for(var e in t)dl.o(t,e)&&!dl.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:t[e]})};dl.o=(s,t)=>Object.prototype.hasOwnProperty.call(s,t);var V=globalThis.pdfjsLib={};dl.d(V,{AbortException:()=>Dn,AnnotationEditorLayer:()=>g_,AnnotationEditorParamsType:()=>Q,AnnotationEditorType:()=>K,AnnotationEditorUIManager:()=>Uo,AnnotationLayer:()=>Wy,AnnotationMode:()=>Ti,ColorPicker:()=>Bh,DOMSVGFactory:()=>El,DrawLayer:()=>__,FeatureTest:()=>Gt,GlobalWorkerOptions:()=>un,ImageKind:()=>Od,InvalidPDFException:()=>gl,MissingPDFException:()=>Do,OPS:()=>Ye,OutputScale:()=>_l,PDFDataRangeTransport:()=>Ph,PDFDateString:()=>fl,PDFWorker:()=>ar,PasswordResponses:()=>tP,PermissionFlag:()=>jI,PixelsPerInch:()=>rs,RenderingCancelledException:()=>yl,TextLayer:()=>wl,TouchManager:()=>_h,UnexpectedResponseException:()=>Oa,Util:()=>$,VerbosityLevel:()=>Pp,XfaLayer:()=>Nh,build:()=>HP,createValidAbsoluteUrl:()=>sP,fetchData:()=>kp,getDocument:()=>OP,getFilenameFromUrl:()=>hP,getPdfFilenameFromUrl:()=>fP,getXfaPageViewport:()=>pP,isDataScheme:()=>Dp,isPdfFile:()=>E_,noContextMenu:()=>dn,normalizeUnicode:()=>cP,setLayerDimensions:()=>Fo,shadow:()=>Z,stopEvent:()=>Pe,version:()=>BP});var Qt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Cw=[1,0,0,1,0,0],rm=[.001,0,0,.001,0,0],XI=1e7,Ud=1.35,ZI=.35,sR=ZI/Ud,Ie={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ti={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},QI="pdfjs_internal_editor_",K={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Q={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},jI={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},qt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Od={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Et={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var Wa={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var Pp={ERRORS:0,WARNINGS:1,INFOS:5},Ye={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},tP={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},Rp=Pp.WARNINGS;function eP(s){Number.isInteger(s)&&(Rp=s)}function nP(){return Rp}function Mp(s){Rp>=Pp.INFOS&&console.log(`Info: ${s}`)}function Y(s){Rp>=Pp.WARNINGS&&console.log(`Warning: ${s}`)}function ot(s){throw new Error(s)}function wt(s,t){s||ot(t)}function iP(s){switch(s==null?void 0:s.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function sP(s,t=null,e=null){if(!s)return null;try{if(e&&typeof s=="string"){if(e.addDefaultProtocol&&s.startsWith("www.")){let i=s.match(/\./g);(i==null?void 0:i.length)>=2&&(s=`http://${s}`)}if(e.tryConvertEncoding)try{s=lP(s)}catch(i){}}let n=t?new URL(s,t):new URL(s);if(iP(n))return n}catch(n){}return null}function Z(s,t,e,n=!1){return Object.defineProperty(s,t,{value:e,enumerable:!n,configurable:!0,writable:!1}),e}var as=function(){function t(e,n){this.message=e,this.name=n}return t.prototype=new Error,t.constructor=t,t}(),ph=class extends as{constructor(t,e){super(t,"PasswordException"),this.code=e}},hl=class extends as{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}},gl=class extends as{constructor(t){super(t,"InvalidPDFException")}},Do=class extends as{constructor(t){super(t,"MissingPDFException")}},Oa=class extends as{constructor(t,e){super(t,"UnexpectedResponseException"),this.status=e}},am=class extends as{constructor(t){super(t,"FormatError")}},Dn=class extends as{constructor(t){super(t,"AbortException")}};function Sw(s){(typeof s!="object"||(s==null?void 0:s.length)===void 0)&&ot("Invalid argument for bytesToString");let t=s.length,e=8192;if(t<e)return String.fromCharCode.apply(null,s);let n=[];for(let i=0;i<t;i+=e){let o=Math.min(i+e,t),r=s.subarray(i,o);n.push(String.fromCharCode.apply(null,r))}return n.join("")}function Np(s){typeof s!="string"&&ot("Invalid argument for stringToBytes");let t=s.length,e=new Uint8Array(t);for(let n=0;n<t;++n)e[n]=s.charCodeAt(n)&255;return e}function oP(s){return String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255)}function w_(s){let t=Object.create(null);for(let[e,n]of s)t[e]=n;return t}function rP(){let s=new Uint8Array(4);return s[0]=1,new Uint32Array(s.buffer,0,1)[0]===1}function aP(){try{return new Function(""),!0}catch(s){return!1}}var Gt=class{static get isLittleEndian(){return Z(this,"isLittleEndian",rP())}static get isEvalSupported(){return Z(this,"isEvalSupported",aP())}static get isOffscreenCanvasSupported(){return Z(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas!="undefined")}static get isImageDecoderSupported(){return Z(this,"isImageDecoderSupported",typeof ImageDecoder!="undefined")}static get platform(){return typeof navigator!="undefined"&&typeof(navigator==null?void 0:navigator.platform)=="string"?Z(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):Z(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var t,e;return Z(this,"isCSSRoundSupported",(e=(t=globalThis.CSS)==null?void 0:t.supports)==null?void 0:e.call(t,"width: round(1.5px, 1px)"))}},em=Array.from(Array(256).keys(),s=>s.toString(16).padStart(2,"0")),lr,$d,Il,lm,$=class{static makeHexColor(t,e,n){return`#${em[t]}${em[e]}${em[n]}`}static scaleMinMax(t,e){let n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){let n=t[0]*e[0]+t[1]*e[2]+e[4],i=t[0]*e[1]+t[1]*e[3]+e[5];return[n,i]}static applyInverseTransform(t,e){let n=e[0]*e[3]-e[1]*e[2],i=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/n,o=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/n;return[i,o]}static getAxialAlignedBoundingBox(t,e){let n=this.applyTransform(t,e),i=this.applyTransform(t.slice(2,4),e),o=this.applyTransform([t[0],t[3]],e),r=this.applyTransform([t[2],t[1]],e);return[Math.min(n[0],i[0],o[0],r[0]),Math.min(n[1],i[1],o[1],r[1]),Math.max(n[0],i[0],o[0],r[0]),Math.max(n[1],i[1],o[1],r[1])]}static inverseTransform(t){let e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){let e=[t[0],t[2],t[1],t[3]],n=t[0]*e[0]+t[1]*e[2],i=t[0]*e[1]+t[1]*e[3],o=t[2]*e[0]+t[3]*e[2],r=t[2]*e[1]+t[3]*e[3],a=(n+r)/2,l=Math.sqrt((n+r)**2-4*(n*r-o*i))/2,c=a+l||1,d=a-l||1;return[Math.sqrt(c),Math.sqrt(d)]}static normalizeRect(t){let e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){let n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>i)return null;let o=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return o>r?null:[n,o,i,r]}static bezierBoundingBox(t,e,n,i,o,r,a,l,c){return c?(c[0]=Math.min(c[0],t,a),c[1]=Math.min(c[1],e,l),c[2]=Math.max(c[2],t,a),c[3]=Math.max(c[3],e,l)):c=[Math.min(t,a),Math.min(e,l),Math.max(t,a),Math.max(e,l)],w(this,Il,lm).call(this,t,n,o,a,e,i,r,l,3*(-t+3*(n-o)+a),6*(t-2*n+o),3*(n-t),c),w(this,Il,lm).call(this,t,n,o,a,e,i,r,l,3*(-e+3*(i-r)+l),6*(e-2*i+r),3*(i-e),c),c}};lr=new WeakSet,$d=function(t,e,n,i,o,r,a,l,c,d){if(c<=0||c>=1)return;let p=1-c,g=c*c,m=g*c,_=p*(p*(p*t+3*c*e)+3*g*n)+m*i,A=p*(p*(p*o+3*c*r)+3*g*a)+m*l;d[0]=Math.min(d[0],_),d[1]=Math.min(d[1],A),d[2]=Math.max(d[2],_),d[3]=Math.max(d[3],A)},Il=new WeakSet,lm=function(t,e,n,i,o,r,a,l,c,d,p,g){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&w(this,lr,$d).call(this,t,e,n,i,o,r,a,l,-p/d,g);return}let m=d**2-4*p*c;if(m<0)return;let _=Math.sqrt(m),A=2*c;w(this,lr,$d).call(this,t,e,n,i,o,r,a,l,(-d+_)/A,g),w(this,lr,$d).call(this,t,e,n,i,o,r,a,l,(-d-_)/A,g)},y($,lr),y($,Il);function lP(s){return decodeURIComponent(escape(s))}var nm=null,cw=null;function cP(s){return nm||(nm=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,cw=new Map([["\uFB05","\u017Ft"]])),s.replaceAll(nm,(t,e,n)=>e?e.normalize("NFKC"):cw.get(n))}function uP(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let s=new Uint8Array(32);return crypto.getRandomValues(s),Sw(s)}var T_="pdfjs_internal_id_";function dP(s){return Uint8Array.prototype.toBase64?s.toBase64():btoa(Sw(s))}typeof Promise.try!="function"&&(Promise.try=function(s,...t){return new Promise(e=>{e(s(...t))})});var $n="http://www.w3.org/2000/svg",fs=class fs{};H(fs,"CSS",96),H(fs,"PDF",72),H(fs,"PDF_TO_CSS_UNITS",fs.CSS/fs.PDF);var rs=fs;async function kp(s,t="text"){if(Xa(s,document.baseURI)){let e=await fetch(s);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,n)=>{let i=new XMLHttpRequest;i.open("GET",s,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(i.response);return}e(i.responseText);return}n(new Error(i.statusText))}},i.send(null)})}var ml=class s{constructor({viewBox:t,userUnit:e,scale:n,rotation:i,offsetX:o=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=t,this.userUnit=e,this.scale=n,this.rotation=i,this.offsetX=o,this.offsetY=r,n*=e;let l=(t[2]+t[0])/2,c=(t[3]+t[1])/2,d,p,g,m;switch(i%=360,i<0&&(i+=360),i){case 180:d=-1,p=0,g=0,m=1;break;case 90:d=0,p=1,g=1,m=0;break;case 270:d=0,p=-1,g=-1,m=0;break;case 0:d=1,p=0,g=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(g=-g,m=-m);let _,A,T,E;d===0?(_=Math.abs(c-t[1])*n+o,A=Math.abs(l-t[0])*n+r,T=(t[3]-t[1])*n,E=(t[2]-t[0])*n):(_=Math.abs(l-t[0])*n+o,A=Math.abs(c-t[1])*n+r,T=(t[2]-t[0])*n,E=(t[3]-t[1])*n),this.transform=[d*n,p*n,g*n,m*n,_-d*n*l-g*n*c,A-p*n*l-m*n*c],this.width=T,this.height=E}get rawDims(){let{userUnit:t,viewBox:e}=this,n=e.map(i=>i*t);return Z(this,"rawDims",{pageWidth:n[2]-n[0],pageHeight:n[3]-n[1],pageX:n[0],pageY:n[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:n=this.offsetX,offsetY:i=this.offsetY,dontFlip:o=!1}={}){return new s({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:i,dontFlip:o})}convertToViewportPoint(t,e){return $.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){let e=$.applyTransform([t[0],t[1]],this.transform),n=$.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],n[0],n[1]]}convertToPdfPoint(t,e){return $.applyInverseTransform([t,e],this.transform)}},yl=class extends as{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}};function Dp(s){let t=s.length,e=0;for(;e<t&&s[e].trim()==="";)e++;return s.substring(e,e+5).toLowerCase()==="data:"}function E_(s){return typeof s=="string"&&/\.pdf$/i.test(s)}function hP(s){return[s]=s.split(/[#?]/,1),s.substring(s.lastIndexOf("/")+1)}function fP(s,t="document.pdf"){if(typeof s!="string")return t;if(Dp(s))return Y('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;let e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=e.exec(s),o=n.exec(i[1])||n.exec(i[2])||n.exec(i[3]);if(o&&(o=o[0],o.includes("%")))try{o=n.exec(decodeURIComponent(o))[0]}catch(r){}return o||t}var gh=class{constructor(){H(this,"started",Object.create(null));H(this,"times",[])}time(t){t in this.started&&Y(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||Y(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){let t=[],e=0;for(let{name:n}of this.times)e=Math.max(n.length,e);for(let{name:n,start:i,end:o}of this.times)t.push(`${n.padEnd(e)} ${o-i}ms
`);return t.join("")}};function Xa(s,t){try{let{protocol:e}=t?new URL(s,t):new URL(s);return e==="http:"||e==="https:"}catch(e){return!1}}function dn(s){s.preventDefault()}function Pe(s){s.preventDefault(),s.stopPropagation()}var Pl,fl=class{static toDateObject(t){if(!t||typeof t!="string")return null;u(this,Pl)||v(this,Pl,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let e=u(this,Pl).exec(t);if(!e)return null;let n=parseInt(e[1],10),i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let o=parseInt(e[3],10);o=o>=1&&o<=31?o:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;let c=e[7]||"Z",d=parseInt(e[8],10);d=d>=0&&d<=23?d:0;let p=parseInt(e[9],10)||0;return p=p>=0&&p<=59?p:0,c==="-"?(r+=d,a+=p):c==="+"&&(r-=d,a-=p),new Date(Date.UTC(n,i,o,r,a,l))}};Pl=new WeakMap,y(fl,Pl,void 0);function pP(s,{scale:t=1,rotation:e=0}){let{width:n,height:i}=s.attributes.style,o=[0,0,parseInt(n),parseInt(i)];return new ml({viewBox:o,userUnit:1,scale:t,rotation:e})}function C_(s){if(s.startsWith("#")){let t=parseInt(s.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return s.startsWith("rgb(")?s.slice(4,-1).split(",").map(t=>parseInt(t)):s.startsWith("rgba(")?s.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(Y(`Not a valid color format: "${s}"`),[0,0,0])}function gP(s){let t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(let e of s.keys()){t.style.color=e;let n=window.getComputedStyle(t).color;s.set(e,C_(n))}t.remove()}function ct(s){let{a:t,b:e,c:n,d:i,e:o,f:r}=s.getTransform();return[t,e,n,i,o,r]}function fn(s){let{a:t,b:e,c:n,d:i,e:o,f:r}=s.getTransform().invertSelf();return[t,e,n,i,o,r]}function Fo(s,t,e=!1,n=!0){if(t instanceof ml){let{pageWidth:i,pageHeight:o}=t.rawDims,{style:r}=s,a=Gt.isCSSRoundSupported,l=`var(--scale-factor) * ${i}px`,c=`var(--scale-factor) * ${o}px`,d=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,p=a?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!e||t.rotation%180===0?(r.width=d,r.height=p):(r.width=p,r.height=d)}n&&s.setAttribute("data-main-rotation",t.rotation)}var _l=class{constructor(){let t=window.devicePixelRatio||1;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},Ei,ms,Je,ys,Rl,Ml,qh,bw,zh,xw,Wh,Iw,cr,Gd,Kh,Pw,Nl,um,Hn=class Hn{constructor(t){y(this,zh);y(this,Wh);y(this,cr);y(this,Kh);y(this,Nl);y(this,Ei,null);y(this,ms,null);y(this,Je,void 0);y(this,ys,null);y(this,Rl,null);v(this,Je,t),u(Hn,Ml)||v(Hn,Ml,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){let t=v(this,Ei,document.createElement("div"));t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");let e=u(this,Je)._uiManager._signal;t.addEventListener("contextmenu",dn,{signal:e}),t.addEventListener("pointerdown",w(Hn,qh,bw),{signal:e});let n=v(this,ys,document.createElement("div"));n.className="buttons",t.append(n);let i=u(this,Je).toolbarPosition;if(i){let{style:o}=t,r=u(this,Je)._uiManager.direction==="ltr"?1-i[0]:i[0];o.insetInlineEnd=`${100*r}%`,o.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return w(this,Kh,Pw).call(this),t}get div(){return u(this,Ei)}hide(){var t;u(this,Ei).classList.add("hidden"),(t=u(this,ms))==null||t.hideDropdown()}show(){var t;u(this,Ei).classList.remove("hidden"),(t=u(this,Rl))==null||t.shown()}async addAltText(t){let e=await t.render();w(this,cr,Gd).call(this,e),u(this,ys).prepend(e,u(this,Nl,um)),v(this,Rl,t)}addColorPicker(t){v(this,ms,t);let e=t.renderButton();w(this,cr,Gd).call(this,e),u(this,ys).prepend(e,u(this,Nl,um))}remove(){var t;u(this,Ei).remove(),(t=u(this,ms))==null||t.destroy(),v(this,ms,null)}};Ei=new WeakMap,ms=new WeakMap,Je=new WeakMap,ys=new WeakMap,Rl=new WeakMap,Ml=new WeakMap,qh=new WeakSet,bw=function(t){t.stopPropagation()},zh=new WeakSet,xw=function(t){u(this,Je)._focusEventsAllowed=!1,Pe(t)},Wh=new WeakSet,Iw=function(t){u(this,Je)._focusEventsAllowed=!0,Pe(t)},cr=new WeakSet,Gd=function(t){let e=u(this,Je)._uiManager._signal;t.addEventListener("focusin",w(this,zh,xw).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",w(this,Wh,Iw).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",dn,{signal:e})},Kh=new WeakSet,Pw=function(){let{editorType:t,_uiManager:e}=u(this,Je),n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",u(Hn,Ml)[t]),w(this,cr,Gd).call(this,n),n.addEventListener("click",i=>{e.delete()},{signal:e._signal}),u(this,ys).append(n)},Nl=new WeakSet,um=function(){let t=document.createElement("div");return t.className="divider",t},y(Hn,qh),y(Hn,Ml,null);var cm=Hn,kl,_s,vs,Yh,Rw,Jh,Mw,Xh,Nw,dm=class{constructor(t){y(this,Yh);y(this,Jh);y(this,Xh);y(this,kl,null);y(this,_s,null);y(this,vs,void 0);v(this,vs,t)}show(t,e,n){let[i,o]=w(this,Jh,Mw).call(this,e,n),{style:r}=u(this,_s)||v(this,_s,w(this,Yh,Rw).call(this));t.append(u(this,_s)),r.insetInlineEnd=`${100*i}%`,r.top=`calc(${100*o}% + var(--editor-toolbar-vert-offset))`}hide(){u(this,_s).remove()}};kl=new WeakMap,_s=new WeakMap,vs=new WeakMap,Yh=new WeakSet,Rw=function(){let t=v(this,_s,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",dn,{signal:u(this,vs)._signal});let e=v(this,kl,document.createElement("div"));return e.className="buttons",t.append(e),w(this,Xh,Nw).call(this),t},Jh=new WeakSet,Mw=function(t,e){let n=0,i=0;for(let o of t){let r=o.y+o.height;if(r<n)continue;let a=o.x+(e?o.width:0);if(r>n){i=a,n=r;continue}e?a>i&&(i=a):a<i&&(i=a)}return[e?1-i:i,n]},Xh=new WeakSet,Nw=function(){let t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let n=u(this,vs)._signal;t.addEventListener("contextmenu",dn,{signal:n}),t.addEventListener("click",()=>{u(this,vs).highlightSelection("floating_button")},{signal:n}),u(this,kl).append(t)};function mh(s,t,e){for(let n of e)t.addEventListener(n,s[n].bind(s))}var Zh,hm=class{constructor(){y(this,Zh,0)}get id(){return`${QI}${jt(this,Zh)._++}`}};Zh=new WeakMap;var ur,Dl,Kt,dr,Bd,S_=class S_{constructor(){y(this,dr);y(this,ur,uP());y(this,Dl,0);y(this,Kt,null)}static get _isSVGFittingCanvas(){let t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=t;let o=i.decode().then(()=>(n.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Z(this,"_isSVGFittingCanvas",o)}async getFromFile(t){let{lastModified:e,name:n,size:i,type:o}=t;return w(this,dr,Bd).call(this,`${e}_${n}_${i}_${o}`,t)}async getFromUrl(t){return w(this,dr,Bd).call(this,t,t)}async getFromBlob(t,e){let n=await e;return w(this,dr,Bd).call(this,t,n)}async getFromId(t){u(this,Kt)||v(this,Kt,new Map);let e=u(this,Kt).get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){let{blobPromise:n}=e;return delete e.blobPromise,this.getFromBlob(e.id,n)}return this.getFromUrl(e.url)}getFromCanvas(t,e){u(this,Kt)||v(this,Kt,new Map);let n=u(this,Kt).get(t);if(n!=null&&n.bitmap)return n.refCounter+=1,n;let i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),n={bitmap:i.transferToImageBitmap(),id:`image_${u(this,ur)}_${jt(this,Dl)._++}`,refCounter:1,isSvg:!1},u(this,Kt).set(t,n),u(this,Kt).set(n.id,n),n}getSvgUrl(t){let e=u(this,Kt).get(t);return e!=null&&e.isSvg?e.svgUrl:null}deleteId(t){var i;u(this,Kt)||v(this,Kt,new Map);let e=u(this,Kt).get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;let{bitmap:n}=e;if(!e.url&&!e.file){let o=new OffscreenCanvas(n.width,n.height);o.getContext("bitmaprenderer").transferFromImageBitmap(n),e.blobPromise=o.convertToBlob()}(i=n.close)==null||i.call(n),e.bitmap=null}isValidId(t){return t.startsWith(`image_${u(this,ur)}_`)}};ur=new WeakMap,Dl=new WeakMap,Kt=new WeakMap,dr=new WeakSet,Bd=async function(t,e){u(this,Kt)||v(this,Kt,new Map);let n=u(this,Kt).get(t);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${u(this,ur)}_${jt(this,Dl)._++}`,refCounter:0,isSvg:!1});let i;if(typeof e=="string"?(n.url=e,i=await kp(e,"blob")):e instanceof File?i=n.file=e:e instanceof Blob&&(i=e),i.type==="image/svg+xml"){let o=S_._isSVGFittingCanvas,r=new FileReader,a=new Image,l=new Promise((c,d)=>{a.onload=()=>{n.bitmap=a,n.isSvg=!0,c()},r.onload=async()=>{let p=n.svgUrl=r.result;a.src=await o?`${p}#svgView(preserveAspectRatio(none))`:p},a.onerror=r.onerror=d});r.readAsDataURL(i),await l}else n.bitmap=await createImageBitmap(i);n.refCounter=1}catch(i){Y(i),n=null}return u(this,Kt).set(t,n),n&&u(this,Kt).set(n.id,n),n};var fm=S_,mt,Ci,Fl,dt,pm=class{constructor(t=128){y(this,mt,[]);y(this,Ci,!1);y(this,Fl,void 0);y(this,dt,-1);v(this,Fl,t)}add({cmd:t,undo:e,post:n,mustExec:i,type:o=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(i&&t(),u(this,Ci))return;let l={cmd:t,undo:e,post:n,type:o};if(u(this,dt)===-1){u(this,mt).length>0&&(u(this,mt).length=0),v(this,dt,0),u(this,mt).push(l);return}if(r&&u(this,mt)[u(this,dt)].type===o){a&&(l.undo=u(this,mt)[u(this,dt)].undo),u(this,mt)[u(this,dt)]=l;return}let c=u(this,dt)+1;c===u(this,Fl)?u(this,mt).splice(0,1):(v(this,dt,c),c<u(this,mt).length&&u(this,mt).splice(c)),u(this,mt).push(l)}undo(){if(u(this,dt)===-1)return;v(this,Ci,!0);let{undo:t,post:e}=u(this,mt)[u(this,dt)];t(),e==null||e(),v(this,Ci,!1),v(this,dt,u(this,dt)-1)}redo(){if(u(this,dt)<u(this,mt).length-1){v(this,dt,u(this,dt)+1),v(this,Ci,!0);let{cmd:t,post:e}=u(this,mt)[u(this,dt)];t(),e==null||e(),v(this,Ci,!1)}}hasSomethingToUndo(){return u(this,dt)!==-1}hasSomethingToRedo(){return u(this,dt)<u(this,mt).length-1}cleanType(t){if(u(this,dt)!==-1){for(let e=u(this,dt);e>=0;e--)if(u(this,mt)[e].type!==t){u(this,mt).splice(e+1,u(this,dt)-e),v(this,dt,e);return}u(this,mt).length=0,v(this,dt,-1)}}destroy(){v(this,mt,null)}};mt=new WeakMap,Ci=new WeakMap,Fl=new WeakMap,dt=new WeakMap;var Qh,kw,Lo=class{constructor(t){y(this,Qh);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:e}=Gt.platform;for(let[n,i,o={}]of t)for(let r of n){let a=r.startsWith("mac+");e&&a?(this.callbacks.set(r.slice(4),{callback:i,options:o}),this.allKeys.add(r.split("+").at(-1))):!e&&!a&&(this.callbacks.set(r,{callback:i,options:o}),this.allKeys.add(r.split("+").at(-1)))}}exec(t,e){if(!this.allKeys.has(e.key))return;let n=this.callbacks.get(w(this,Qh,kw).call(this,e));if(!n)return;let{callback:i,options:{bubbles:o=!1,args:r=[],checker:a=null}}=n;a&&!a(t,e)||(i.bind(t,...r,e)(),o||Pe(e))}};Qh=new WeakSet,kw=function(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);let e=this.buffer.join("+");return this.buffer.length=0,e};var jh=class jh{get _colors(){let t=new Map([["CanvasText",null],["Canvas",null]]);return gP(t),Z(this,"_colors",t)}convert(t){let e=C_(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(let[n,i]of this._colors)if(i.every((o,r)=>o===e[r]))return jh._colorsMapping.get(n);return e}getHexCode(t){let e=this._colors.get(t);return e?$.makeHexColor(...e):t}};H(jh,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var gm=jh,hr,me,Ct,Dt,fr,qn,pr,De,Si,As,gr,ws,mn,Xe,Ts,Ll,Ul,mr,Ol,yn,bi,yr,xi,_n,tf,Ii,$l,Pi,Es,Gl,Bl,xt,nt,zn,Cs,Hl,Vl,Ri,vn,Wn,ql,Fe,_r,Hd,zl,mm,ef,Dw,nf,Fw,vr,Vd,sf,Lw,of,Uw,rf,Ow,Wl,ym,af,$w,Kl,_m,Yl,vm,lf,Gw,Ft,ee,Ze,Gn,cf,Bw,uf,Hw,Jl,Am,df,Vw,Ss,Za,Xl,wm,sr=class sr{constructor(t,e,n,i,o,r,a,l,c,d,p,g,m){y(this,_r);y(this,zl);y(this,ef);y(this,nf);y(this,vr);y(this,sf);y(this,of);y(this,rf);y(this,Wl);y(this,af);y(this,Kl);y(this,Yl);y(this,lf);y(this,Ft);y(this,Ze);y(this,cf);y(this,uf);y(this,Jl);y(this,df);y(this,Ss);y(this,Xl);y(this,hr,new AbortController);y(this,me,null);y(this,Ct,new Map);y(this,Dt,new Map);y(this,fr,null);y(this,qn,null);y(this,pr,null);y(this,De,new pm);y(this,Si,null);y(this,As,null);y(this,gr,0);y(this,ws,new Set);y(this,mn,null);y(this,Xe,null);y(this,Ts,new Set);H(this,"_editorUndoBar",null);y(this,Ll,!1);y(this,Ul,!1);y(this,mr,!1);y(this,Ol,null);y(this,yn,null);y(this,bi,null);y(this,yr,null);y(this,xi,!1);y(this,_n,null);y(this,tf,new hm);y(this,Ii,!1);y(this,$l,!1);y(this,Pi,null);y(this,Es,null);y(this,Gl,null);y(this,Bl,null);y(this,xt,K.NONE);y(this,nt,new Set);y(this,zn,null);y(this,Cs,null);y(this,Hl,null);y(this,Vl,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});y(this,Ri,[0,0]);y(this,vn,null);y(this,Wn,null);y(this,ql,null);y(this,Fe,null);let _=this._signal=u(this,hr).signal;v(this,Wn,t),v(this,ql,e),v(this,fr,n),this._eventBus=i,i._on("editingaction",this.onEditingAction.bind(this),{signal:_}),i._on("pagechanging",this.onPageChanging.bind(this),{signal:_}),i._on("scalechanging",this.onScaleChanging.bind(this),{signal:_}),i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:_}),i._on("setpreference",this.onSetPreference.bind(this),{signal:_}),i._on("switchannotationeditorparams",A=>this.updateParams(A.type,A.value),{signal:_}),w(this,sf,Lw).call(this),w(this,lf,Gw).call(this),w(this,Wl,ym).call(this),v(this,qn,o.annotationStorage),v(this,Ol,o.filterFactory),v(this,Cs,r),v(this,yr,a||null),v(this,Ll,l),v(this,Ul,c),v(this,mr,d),v(this,Bl,p||null),this.viewParameters={realScale:rs.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=m!==!1}static get _keyboardManager(){let t=sr.prototype,e=r=>u(r,Wn).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),n=(r,{target:a})=>{if(a instanceof HTMLInputElement){let{type:l}=a;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return Z(this,"_keyboardManager",new Lo([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&u(r,Wn).contains(a)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&u(r,Wn).contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-o,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[o,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-o],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,o],checker:e}]]))}destroy(){var t,e,n,i,o;(t=u(this,Fe))==null||t.resolve(),v(this,Fe,null),(e=u(this,hr))==null||e.abort(),v(this,hr,null),this._signal=null;for(let r of u(this,Dt).values())r.destroy();u(this,Dt).clear(),u(this,Ct).clear(),u(this,Ts).clear(),v(this,me,null),u(this,nt).clear(),u(this,De).destroy(),(n=u(this,fr))==null||n.destroy(),(i=u(this,_n))==null||i.hide(),v(this,_n,null),u(this,yn)&&(clearTimeout(u(this,yn)),v(this,yn,null)),u(this,vn)&&(clearTimeout(u(this,vn)),v(this,vn,null)),(o=this._editorUndoBar)==null||o.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return u(this,Bl)}get useNewAltTextFlow(){return u(this,Ul)}get useNewAltTextWhenAddingImage(){return u(this,mr)}get hcmFilter(){return Z(this,"hcmFilter",u(this,Cs)?u(this,Ol).addHCMFilter(u(this,Cs).foreground,u(this,Cs).background):"none")}get direction(){return Z(this,"direction",getComputedStyle(u(this,Wn)).direction)}get highlightColors(){return Z(this,"highlightColors",u(this,yr)?new Map(u(this,yr).split(",").map(t=>t.split("=").map(e=>e.trim()))):null)}get highlightColorNames(){return Z(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),v(this,As,t)}setMainHighlightColorPicker(t){v(this,Gl,t)}editAltText(t,e=!1){var n;(n=u(this,fr))==null||n.editAltText(this,t,e)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":v(this,mr,e);break}}onPageChanging({pageNumber:t}){v(this,gr,t-1)}focusMainContainer(){u(this,Wn).focus()}findParent(t,e){for(let n of u(this,Dt).values()){let{x:i,y:o,width:r,height:a}=n.div.getBoundingClientRect();if(t>=i&&t<=i+r&&e>=o&&e<=o+a)return n}return null}disableUserSelect(t=!1){u(this,ql).classList.toggle("noUserSelect",t)}addShouldRescale(t){u(this,Ts).add(t)}removeShouldRescale(t){u(this,Ts).delete(t)}onScaleChanging({scale:t}){var e;this.commitOrRemove(),this.viewParameters.realScale=t*rs.PDF_TO_CSS_UNITS;for(let n of u(this,Ts))n.onScaleChanging();(e=u(this,As))==null||e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(t=""){let e=document.getSelection();if(!e||e.isCollapsed)return;let{anchorNode:n,anchorOffset:i,focusNode:o,focusOffset:r}=e,a=e.toString(),c=w(this,_r,Hd).call(this,e).closest(".textLayer"),d=this.getSelectionBoxes(c);if(!d)return;e.empty();let p=w(this,zl,mm).call(this,c),g=u(this,xt)===K.NONE,m=()=>{p==null||p.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:d,anchorNode:n,anchorOffset:i,focusNode:o,focusOffset:r,text:a}),g&&this.showAllEditors("highlight",!0,!0)};if(g){this.switchToMode(K.HIGHLIGHT,m);return}m()}addToAnnotationStorage(t){!t.isEmpty()&&u(this,qn)&&!u(this,qn).has(t.id)&&u(this,qn).setValue(t.id,t)}blur(){if(this.isShiftKeyDown=!1,u(this,xi)&&(v(this,xi,!1),w(this,vr,Vd).call(this,"main_toolbar")),!this.hasSelection)return;let{activeElement:t}=document;for(let e of u(this,nt))if(e.div.contains(t)){v(this,Es,[e,t]),e._focusEventsAllowed=!1;break}}focus(){if(!u(this,Es))return;let[t,e]=u(this,Es);v(this,Es,null),e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}addEditListeners(){w(this,Wl,ym).call(this),w(this,Kl,_m).call(this)}removeEditListeners(){w(this,af,$w).call(this),w(this,Yl,vm).call(this)}dragOver(t){for(let{type:e}of t.dataTransfer.items)for(let n of u(this,Xe))if(n.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(let e of t.dataTransfer.items)for(let n of u(this,Xe))if(n.isHandlingMimeForPasting(e.type)){n.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){var n;if(t.preventDefault(),(n=u(this,me))==null||n.commitOrRemove(),!this.hasSelection)return;let e=[];for(let i of u(this,nt)){let o=i.serialize(!0);o&&e.push(o)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();let{clipboardData:e}=t;for(let o of e.items)for(let r of u(this,Xe))if(r.isHandlingMimeForPasting(o.type)){r.paste(o,this.currentLayer);return}let n=e.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(o){Y(`paste: "${o.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();let i=this.currentLayer;try{let o=[];for(let l of n){let c=await i.deserialize(l);if(!c)return;o.push(c)}let r=()=>{for(let l of o)w(this,Jl,Am).call(this,l);w(this,Xl,wm).call(this,o)},a=()=>{for(let l of o)l.remove()};this.addCommands({cmd:r,undo:a,mustExec:!0})}catch(o){Y(`paste: "${o.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),u(this,xt)!==K.NONE&&!this.isEditorHandlingKeyboard&&sr._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,u(this,xi)&&(v(this,xi,!1),w(this,vr,Vd).call(this,"main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(t){t?(w(this,of,Uw).call(this),w(this,Kl,_m).call(this),w(this,Ft,ee).call(this,{isEditing:u(this,xt)!==K.NONE,isEmpty:w(this,Ss,Za).call(this),hasSomethingToUndo:u(this,De).hasSomethingToUndo(),hasSomethingToRedo:u(this,De).hasSomethingToRedo(),hasSelectedEditor:!1})):(w(this,rf,Ow).call(this),w(this,Yl,vm).call(this),w(this,Ft,ee).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!u(this,Xe)){v(this,Xe,t);for(let e of u(this,Xe))w(this,Ze,Gn).call(this,e.defaultPropertiesToUpdate)}}getId(){return u(this,tf).id}get currentLayer(){return u(this,Dt).get(u(this,gr))}getLayer(t){return u(this,Dt).get(t)}get currentPageIndex(){return u(this,gr)}addLayer(t){u(this,Dt).set(t.pageIndex,t),u(this,Ii)?t.enable():t.disable()}removeLayer(t){u(this,Dt).delete(t.pageIndex)}async updateMode(t,e=null,n=!1){var i;if(u(this,xt)!==t&&!(u(this,Fe)&&(await u(this,Fe).promise,!u(this,Fe)))){if(v(this,Fe,Promise.withResolvers()),v(this,xt,t),t===K.NONE){this.setEditingState(!1),w(this,uf,Hw).call(this),(i=this._editorUndoBar)==null||i.hide(),u(this,Fe).resolve();return}this.setEditingState(!0),await w(this,cf,Bw).call(this),this.unselectAll();for(let o of u(this,Dt).values())o.updateMode(t);if(!e){n&&this.addNewEditorFromKeyboard(),u(this,Fe).resolve();return}for(let o of u(this,Ct).values())o.annotationElementId===e?(this.setSelected(o),o.enterInEditMode()):o.unselect();u(this,Fe).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==u(this,xt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){var n;if(u(this,Xe)){switch(t){case Q.CREATE:this.currentLayer.addNewEditor();return;case Q.HIGHLIGHT_DEFAULT_COLOR:(n=u(this,Gl))==null||n.updateColor(e);break;case Q.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(u(this,Hl)||v(this,Hl,new Map)).set(t,e),this.showAllEditors("highlight",e);break}for(let i of u(this,nt))i.updateParams(t,e);for(let i of u(this,Xe))i.updateDefaultParams(t,e)}}showAllEditors(t,e,n=!1){var o,r;for(let a of u(this,Ct).values())a.editorType===t&&a.show(e);((r=(o=u(this,Hl))==null?void 0:o.get(Q.HIGHLIGHT_SHOW_ALL))!=null?r:!0)!==e&&w(this,Ze,Gn).call(this,[[Q.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(u(this,$l)!==t){v(this,$l,t);for(let e of u(this,Dt).values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}getEditors(t){let e=[];for(let n of u(this,Ct).values())n.pageIndex===t&&e.push(n);return e}getEditor(t){return u(this,Ct).get(t)}addEditor(t){u(this,Ct).set(t.id,t)}removeEditor(t){var e;t.div.contains(document.activeElement)&&(u(this,yn)&&clearTimeout(u(this,yn)),v(this,yn,setTimeout(()=>{this.focusMainContainer(),v(this,yn,null)},0))),u(this,Ct).delete(t.id),this.unselect(t),(!t.annotationElementId||!u(this,ws).has(t.annotationElementId))&&((e=u(this,qn))==null||e.remove(t.id))}addDeletedAnnotationElement(t){u(this,ws).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return u(this,ws).has(t)}removeDeletedAnnotationElement(t){u(this,ws).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}setActiveEditor(t){u(this,me)!==t&&(v(this,me,t),t&&w(this,Ze,Gn).call(this,t.propertiesToUpdate))}updateUI(t){u(this,df,Vw)===t&&w(this,Ze,Gn).call(this,t.propertiesToUpdate)}updateUIForDefaultProperties(t){w(this,Ze,Gn).call(this,t.defaultPropertiesToUpdate)}toggleSelected(t){if(u(this,nt).has(t)){u(this,nt).delete(t),t.unselect(),w(this,Ft,ee).call(this,{hasSelectedEditor:this.hasSelection});return}u(this,nt).add(t),t.select(),w(this,Ze,Gn).call(this,t.propertiesToUpdate),w(this,Ft,ee).call(this,{hasSelectedEditor:!0})}setSelected(t){var e;(e=u(this,As))==null||e.commitOrRemove();for(let n of u(this,nt))n!==t&&n.unselect();u(this,nt).clear(),u(this,nt).add(t),t.select(),w(this,Ze,Gn).call(this,t.propertiesToUpdate),w(this,Ft,ee).call(this,{hasSelectedEditor:!0})}isSelected(t){return u(this,nt).has(t)}get firstSelectedEditor(){return u(this,nt).values().next().value}unselect(t){t.unselect(),u(this,nt).delete(t),w(this,Ft,ee).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return u(this,nt).size!==0}get isEnterHandled(){return u(this,nt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var t;u(this,De).undo(),w(this,Ft,ee).call(this,{hasSomethingToUndo:u(this,De).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:w(this,Ss,Za).call(this)}),(t=this._editorUndoBar)==null||t.hide()}redo(){u(this,De).redo(),w(this,Ft,ee).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:u(this,De).hasSomethingToRedo(),isEmpty:w(this,Ss,Za).call(this)})}addCommands(t){u(this,De).add(t),w(this,Ft,ee).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:w(this,Ss,Za).call(this)})}cleanUndoStack(t){u(this,De).cleanType(t)}delete(){var o;this.commitOrRemove();let t=(o=this.currentLayer)==null?void 0:o.endDrawingSession(!0);if(!this.hasSelection&&!t)return;let e=t?[t]:[...u(this,nt)],n=()=>{var r;(r=this._editorUndoBar)==null||r.show(i,e.length===1?e[0].editorType:e.length);for(let a of e)a.remove()},i=()=>{for(let r of e)w(this,Jl,Am).call(this,r)};this.addCommands({cmd:n,undo:i,mustExec:!0})}commitOrRemove(){var t;(t=u(this,me))==null||t.commitOrRemove()}hasSomethingToControl(){return u(this,me)||this.hasSelection}selectAll(){for(let t of u(this,nt))t.commit();w(this,Xl,wm).call(this,u(this,Ct).values())}unselectAll(){var t;if(!(u(this,me)&&(u(this,me).commitOrRemove(),u(this,xt)!==K.NONE))&&!((t=u(this,As))!=null&&t.commitOrRemove())&&this.hasSelection){for(let e of u(this,nt))e.unselect();u(this,nt).clear(),w(this,Ft,ee).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;u(this,Ri)[0]+=t,u(this,Ri)[1]+=e;let[i,o]=u(this,Ri),r=[...u(this,nt)],a=1e3;u(this,vn)&&clearTimeout(u(this,vn)),v(this,vn,setTimeout(()=>{v(this,vn,null),u(this,Ri)[0]=u(this,Ri)[1]=0,this.addCommands({cmd:()=>{for(let l of r)u(this,Ct).has(l.id)&&l.translateInPage(i,o)},undo:()=>{for(let l of r)u(this,Ct).has(l.id)&&l.translateInPage(-i,-o)},mustExec:!1})},a));for(let l of r)l.translateInPage(t,e)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),v(this,mn,new Map);for(let t of u(this,nt))u(this,mn).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!u(this,mn))return!1;this.disableUserSelect(!1);let t=u(this,mn);v(this,mn,null);let e=!1;for(let[{x:i,y:o,pageIndex:r},a]of t)a.newX=i,a.newY=o,a.newPageIndex=r,e||(e=i!==a.savedX||o!==a.savedY||r!==a.savedPageIndex);if(!e)return!1;let n=(i,o,r,a)=>{if(u(this,Ct).has(i.id)){let l=u(this,Dt).get(a);l?i._setParentAndPosition(l,o,r):(i.pageIndex=a,i.x=o,i.y=r)}};return this.addCommands({cmd:()=>{for(let[i,{newX:o,newY:r,newPageIndex:a}]of t)n(i,o,r,a)},undo:()=>{for(let[i,{savedX:o,savedY:r,savedPageIndex:a}]of t)n(i,o,r,a)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(u(this,mn))for(let n of u(this,mn).keys())n.drag(t,e)}rebuild(t){if(t.parent===null){let e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){var t;return((t=this.getActive())==null?void 0:t.shouldGetKeyboardEvents())||u(this,nt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return u(this,me)===t}getActive(){return u(this,me)}getMode(){return u(this,xt)}get imageManager(){return Z(this,"imageManager",new fm)}getSelectionBoxes(t){if(!t)return null;let e=document.getSelection();for(let c=0,d=e.rangeCount;c<d;c++)if(!t.contains(e.getRangeAt(c).commonAncestorContainer))return null;let{x:n,y:i,width:o,height:r}=t.getBoundingClientRect(),a;switch(t.getAttribute("data-main-rotation")){case"90":a=(c,d,p,g)=>({x:(d-i)/r,y:1-(c+p-n)/o,width:g/r,height:p/o});break;case"180":a=(c,d,p,g)=>({x:1-(c+p-n)/o,y:1-(d+g-i)/r,width:p/o,height:g/r});break;case"270":a=(c,d,p,g)=>({x:1-(d+g-i)/r,y:(c-n)/o,width:g/r,height:p/o});break;default:a=(c,d,p,g)=>({x:(c-n)/o,y:(d-i)/r,width:p/o,height:g/r});break}let l=[];for(let c=0,d=e.rangeCount;c<d;c++){let p=e.getRangeAt(c);if(!p.collapsed)for(let{x:g,y:m,width:_,height:A}of p.getClientRects())_===0||A===0||l.push(a(g,m,_,A))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(u(this,pr)||v(this,pr,new Map)).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){var e;(e=u(this,pr))==null||e.delete(t)}renderAnnotationElement(t){var i;let e=(i=u(this,pr))==null?void 0:i.get(t.data.id);if(!e)return;let n=u(this,qn).getRawValue(e);n&&(u(this,xt)===K.NONE&&!n.hasBeenModified||n.renderAnnotationElement(t))}};hr=new WeakMap,me=new WeakMap,Ct=new WeakMap,Dt=new WeakMap,fr=new WeakMap,qn=new WeakMap,pr=new WeakMap,De=new WeakMap,Si=new WeakMap,As=new WeakMap,gr=new WeakMap,ws=new WeakMap,mn=new WeakMap,Xe=new WeakMap,Ts=new WeakMap,Ll=new WeakMap,Ul=new WeakMap,mr=new WeakMap,Ol=new WeakMap,yn=new WeakMap,bi=new WeakMap,yr=new WeakMap,xi=new WeakMap,_n=new WeakMap,tf=new WeakMap,Ii=new WeakMap,$l=new WeakMap,Pi=new WeakMap,Es=new WeakMap,Gl=new WeakMap,Bl=new WeakMap,xt=new WeakMap,nt=new WeakMap,zn=new WeakMap,Cs=new WeakMap,Hl=new WeakMap,Vl=new WeakMap,Ri=new WeakMap,vn=new WeakMap,Wn=new WeakMap,ql=new WeakMap,Fe=new WeakMap,_r=new WeakSet,Hd=function({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t},zl=new WeakSet,mm=function(t){let{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(let n of u(this,Dt).values())if(n.hasTextLayer(t))return n;return null},ef=new WeakSet,Dw=function(){let t=document.getSelection();if(!t||t.isCollapsed)return;let n=w(this,_r,Hd).call(this,t).closest(".textLayer"),i=this.getSelectionBoxes(n);i&&(u(this,_n)||v(this,_n,new dm(this)),u(this,_n).show(n,i,this.direction==="ltr"))},nf=new WeakSet,Fw=function(){var o,r,a;let t=document.getSelection();if(!t||t.isCollapsed){u(this,zn)&&((o=u(this,_n))==null||o.hide(),v(this,zn,null),w(this,Ft,ee).call(this,{hasSelectedText:!1}));return}let{anchorNode:e}=t;if(e===u(this,zn))return;let i=w(this,_r,Hd).call(this,t).closest(".textLayer");if(!i){u(this,zn)&&((r=u(this,_n))==null||r.hide(),v(this,zn,null),w(this,Ft,ee).call(this,{hasSelectedText:!1}));return}if((a=u(this,_n))==null||a.hide(),v(this,zn,e),w(this,Ft,ee).call(this,{hasSelectedText:!0}),!(u(this,xt)!==K.HIGHLIGHT&&u(this,xt)!==K.NONE)&&(u(this,xt)===K.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),v(this,xi,this.isShiftKeyDown),!this.isShiftKeyDown)){let l=u(this,xt)===K.HIGHLIGHT?w(this,zl,mm).call(this,i):null;l==null||l.toggleDrawing();let c=new AbortController,d=this.combinedSignal(c),p=g=>{g.type==="pointerup"&&g.button!==0||(c.abort(),l==null||l.toggleDrawing(!0),g.type==="pointerup"&&w(this,vr,Vd).call(this,"main_toolbar"))};window.addEventListener("pointerup",p,{signal:d}),window.addEventListener("blur",p,{signal:d})}},vr=new WeakSet,Vd=function(t=""){u(this,xt)===K.HIGHLIGHT?this.highlightSelection(t):u(this,Ll)&&w(this,ef,Dw).call(this)},sf=new WeakSet,Lw=function(){document.addEventListener("selectionchange",w(this,nf,Fw).bind(this),{signal:this._signal})},of=new WeakSet,Uw=function(){if(u(this,bi))return;v(this,bi,new AbortController);let t=this.combinedSignal(u(this,bi));window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})},rf=new WeakSet,Ow=function(){var t;(t=u(this,bi))==null||t.abort(),v(this,bi,null)},Wl=new WeakSet,ym=function(){if(u(this,Pi))return;v(this,Pi,new AbortController);let t=this.combinedSignal(u(this,Pi));window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})},af=new WeakSet,$w=function(){var t;(t=u(this,Pi))==null||t.abort(),v(this,Pi,null)},Kl=new WeakSet,_m=function(){if(u(this,Si))return;v(this,Si,new AbortController);let t=this.combinedSignal(u(this,Si));document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})},Yl=new WeakSet,vm=function(){var t;(t=u(this,Si))==null||t.abort(),v(this,Si,null)},lf=new WeakSet,Gw=function(){let t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})},Ft=new WeakSet,ee=function(t){Object.entries(t).some(([n,i])=>u(this,Vl)[n]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(u(this,Vl),t)}),u(this,xt)===K.HIGHLIGHT&&t.hasSelectedEditor===!1&&w(this,Ze,Gn).call(this,[[Q.HIGHLIGHT_FREE,!0]]))},Ze=new WeakSet,Gn=function(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})},cf=new WeakSet,Bw=async function(){if(!u(this,Ii)){v(this,Ii,!0);let t=[];for(let e of u(this,Dt).values())t.push(e.enable());await Promise.all(t);for(let e of u(this,Ct).values())e.enable()}},uf=new WeakSet,Hw=function(){if(this.unselectAll(),u(this,Ii)){v(this,Ii,!1);for(let t of u(this,Dt).values())t.disable();for(let t of u(this,Ct).values())t.disable()}},Jl=new WeakSet,Am=function(t){let e=u(this,Dt).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))},df=new WeakSet,Vw=function(){let t=null;for(t of u(this,nt));return t},Ss=new WeakSet,Za=function(){if(u(this,Ct).size===0)return!0;if(u(this,Ct).size===1)for(let t of u(this,Ct).values())return t.isEmpty();return!1},Xl=new WeakSet,wm=function(t){for(let e of u(this,nt))e.unselect();u(this,nt).clear();for(let e of t)e.isEmpty()||(u(this,nt).add(e),e.select());w(this,Ft,ee).call(this,{hasSelectedEditor:this.hasSelection})},H(sr,"TRANSLATE_SMALL",1),H(sr,"TRANSLATE_BIG",10);var Uo=sr,It,An,Qe,Ar,wn,ye,wr,Tn,de,Kn,bs,En,Mi,xs,Qa,Tr,qd,ne=class ne{constructor(t){y(this,xs);y(this,Tr);y(this,It,null);y(this,An,!1);y(this,Qe,null);y(this,Ar,null);y(this,wn,null);y(this,ye,null);y(this,wr,!1);y(this,Tn,null);y(this,de,null);y(this,Kn,null);y(this,bs,null);y(this,En,!1);v(this,de,t),v(this,En,t._uiManager.useNewAltTextFlow),u(ne,Mi)||v(ne,Mi,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(t){var e;(e=ne._l10n)!=null||(ne._l10n=t)}async render(){let t=v(this,Qe,document.createElement("button"));t.className="altText",t.tabIndex="0";let e=v(this,Ar,document.createElement("span"));t.append(e),u(this,En)?(t.classList.add("new"),t.setAttribute("data-l10n-id",u(ne,Mi).missing),e.setAttribute("data-l10n-id",u(ne,Mi)["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let n=u(this,de)._uiManager._signal;t.addEventListener("contextmenu",dn,{signal:n}),t.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:n});let i=o=>{o.preventDefault(),u(this,de)._uiManager.editAltText(u(this,de)),u(this,En)&&u(this,de)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:u(this,xs,Qa)}})};return t.addEventListener("click",i,{capture:!0,signal:n}),t.addEventListener("keydown",o=>{o.target===t&&o.key==="Enter"&&(v(this,wr,!0),i(o))},{signal:n}),await w(this,Tr,qd).call(this),t}finish(){u(this,Qe)&&(u(this,Qe).focus({focusVisible:u(this,wr)}),v(this,wr,!1))}isEmpty(){return u(this,En)?u(this,It)===null:!u(this,It)&&!u(this,An)}hasData(){return u(this,En)?u(this,It)!==null||!!u(this,Kn):this.isEmpty()}get guessedText(){return u(this,Kn)}async setGuessedText(t){u(this,It)===null&&(v(this,Kn,t),v(this,bs,await ne._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t})),w(this,Tr,qd).call(this))}toggleAltTextBadge(t=!1){var e;if(!u(this,En)||u(this,It)){(e=u(this,Tn))==null||e.remove(),v(this,Tn,null);return}if(!u(this,Tn)){let n=v(this,Tn,document.createElement("div"));n.className="noAltTextBadge",u(this,de).div.append(n)}u(this,Tn).classList.toggle("hidden",!t)}serialize(t){let e=u(this,It);return!t&&u(this,Kn)===e&&(e=u(this,bs)),{altText:e,decorative:u(this,An),guessedText:u(this,Kn),textWithDisclaimer:u(this,bs)}}get data(){return{altText:u(this,It),decorative:u(this,An)}}set data({altText:t,decorative:e,guessedText:n,textWithDisclaimer:i,cancel:o=!1}){n&&(v(this,Kn,n),v(this,bs,i)),!(u(this,It)===t&&u(this,An)===e)&&(o||(v(this,It,t),v(this,An,e)),w(this,Tr,qd).call(this))}toggle(t=!1){u(this,Qe)&&(!t&&u(this,ye)&&(clearTimeout(u(this,ye)),v(this,ye,null)),u(this,Qe).disabled=!t)}shown(){u(this,de)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:u(this,xs,Qa)}})}destroy(){var t,e;(t=u(this,Qe))==null||t.remove(),v(this,Qe,null),v(this,Ar,null),v(this,wn,null),(e=u(this,Tn))==null||e.remove(),v(this,Tn,null)}};It=new WeakMap,An=new WeakMap,Qe=new WeakMap,Ar=new WeakMap,wn=new WeakMap,ye=new WeakMap,wr=new WeakMap,Tn=new WeakMap,de=new WeakMap,Kn=new WeakMap,bs=new WeakMap,En=new WeakMap,Mi=new WeakMap,xs=new WeakSet,Qa=function(){return u(this,It)&&"added"||u(this,It)===null&&this.guessedText&&"review"||"missing"},Tr=new WeakSet,qd=async function(){var i,o,r;let t=u(this,Qe);if(!t)return;if(u(this,En)){if(t.classList.toggle("done",!!u(this,It)),t.setAttribute("data-l10n-id",u(ne,Mi)[u(this,xs,Qa)]),(i=u(this,Ar))==null||i.setAttribute("data-l10n-id",u(ne,Mi)[`${u(this,xs,Qa)}-label`]),!u(this,It)){(o=u(this,wn))==null||o.remove();return}}else{if(!u(this,It)&&!u(this,An)){t.classList.remove("done"),(r=u(this,wn))==null||r.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=u(this,wn);if(!e){v(this,wn,e=document.createElement("span")),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${u(this,de).id}`;let a=100,l=u(this,de)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(u(this,ye)),v(this,ye,null)},{once:!0}),t.addEventListener("mouseenter",()=>{v(this,ye,setTimeout(()=>{v(this,ye,null),u(this,wn).classList.add("show"),u(this,de)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:l}),t.addEventListener("mouseleave",()=>{var c;u(this,ye)&&(clearTimeout(u(this,ye)),v(this,ye,null)),(c=u(this,wn))==null||c.classList.remove("show")},{signal:l})}u(this,An)?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=u(this,It)),e.parentNode||t.append(e);let n=u(this,de).getImageForAltText();n==null||n.setAttribute("aria-describedby",e.id)},y(ne,Mi,null),H(ne,"_l10n",null);var yh=ne,Zl,Is,Ql,jl,tc,ec,nc,Er,Yn,Ps,Ni,hf,qw,ff,zw,ic,Tm,b_=class b_{constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:n=null,onPinchStart:i=null,onPinching:o=null,onPinchEnd:r=null,signal:a}){y(this,hf);y(this,ff);y(this,ic);y(this,Zl,void 0);y(this,Is,!1);y(this,Ql,null);y(this,jl,void 0);y(this,tc,void 0);y(this,ec,void 0);y(this,nc,void 0);y(this,Er,void 0);y(this,Yn,null);y(this,Ps,void 0);y(this,Ni,null);v(this,Zl,t),v(this,Ql,n),v(this,jl,e),v(this,tc,i),v(this,ec,o),v(this,nc,r),v(this,Ps,new AbortController),v(this,Er,AbortSignal.any([a,u(this,Ps).signal])),t.addEventListener("touchstart",w(this,hf,qw).bind(this),{passive:!1,signal:u(this,Er)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return Z(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var t;(t=u(this,Ps))==null||t.abort(),v(this,Ps,null)}};Zl=new WeakMap,Is=new WeakMap,Ql=new WeakMap,jl=new WeakMap,tc=new WeakMap,ec=new WeakMap,nc=new WeakMap,Er=new WeakMap,Yn=new WeakMap,Ps=new WeakMap,Ni=new WeakMap,hf=new WeakSet,qw=function(t){var i,o,r;if((i=u(this,jl))!=null&&i.call(this)||t.touches.length<2)return;if(!u(this,Ni)){v(this,Ni,new AbortController);let a=AbortSignal.any([u(this,Er),u(this,Ni).signal]),l=u(this,Zl),c={signal:a,passive:!1};l.addEventListener("touchmove",w(this,ff,zw).bind(this),c),l.addEventListener("touchend",w(this,ic,Tm).bind(this),c),l.addEventListener("touchcancel",w(this,ic,Tm).bind(this),c),(o=u(this,tc))==null||o.call(this)}if(Pe(t),t.touches.length!==2||(r=u(this,Ql))!=null&&r.call(this)){v(this,Yn,null);return}let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]),v(this,Yn,{touch0X:e.screenX,touch0Y:e.screenY,touch1X:n.screenX,touch1Y:n.screenY})},ff=new WeakSet,zw=function(t){var b;if(!u(this,Yn)||t.touches.length!==2)return;let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]);let{screenX:i,screenY:o}=e,{screenX:r,screenY:a}=n,l=u(this,Yn),{touch0X:c,touch0Y:d,touch1X:p,touch1Y:g}=l,m=p-c,_=g-d,A=r-i,T=a-o,E=Math.hypot(A,T)||1,C=Math.hypot(m,_)||1;if(!u(this,Is)&&Math.abs(C-E)<=b_.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=o,l.touch1X=r,l.touch1Y=a,t.preventDefault(),!u(this,Is)){v(this,Is,!0);return}let S=[(i+r)/2,(o+a)/2];(b=u(this,ec))==null||b.call(this,S,C,E)},ic=new WeakSet,Tm=function(t){var e;u(this,Ni).abort(),v(this,Ni,null),(e=u(this,nc))==null||e.call(this),u(this,Yn)&&(t.preventDefault(),v(this,Yn,null),v(this,Is,!1))};var _h=b_,Rs,je,at,Cr,ki,sc,Ms,Lt,Ns,Jn,Di,oc,ks,_e,rc,Ds,Xn,Cn,Sr,br,Le,Fs,ac,pf,lc,Em,cc,Cm,xr,zd,gf,Ww,mf,Kw,uc,Sm,Ir,Wd,dc,bm,yf,Yw,_f,Jw,vf,Xw,hc,xm,Af,Zw,fc,Im,wf,Qw,Tf,jw,Ef,tT,pc,Pm,Ls,ja,J=class J{constructor(t){y(this,lc);y(this,xr);y(this,gf);y(this,mf);y(this,uc);y(this,Ir);y(this,dc);y(this,yf);y(this,_f);y(this,vf);y(this,hc);y(this,Af);y(this,fc);y(this,wf);y(this,Tf);y(this,Ef);y(this,pc);y(this,Ls);y(this,Rs,null);y(this,je,null);y(this,at,null);y(this,Cr,!1);y(this,ki,null);y(this,sc,"");y(this,Ms,!1);y(this,Lt,null);y(this,Ns,null);y(this,Jn,null);y(this,Di,null);y(this,oc,"");y(this,ks,!1);y(this,_e,null);y(this,rc,!1);y(this,Ds,!1);y(this,Xn,!1);y(this,Cn,null);y(this,Sr,0);y(this,br,0);y(this,Le,null);y(this,Fs,null);H(this,"_editToolbar",null);H(this,"_initialOptions",Object.create(null));H(this,"_initialData",null);H(this,"_isVisible",!0);H(this,"_uiManager",null);H(this,"_focusEventsAllowed",!0);y(this,ac,!1);y(this,pf,J._zIndex++);this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;let{rotation:e,rawDims:{pageWidth:n,pageHeight:i,pageX:o,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,i],this.pageTranslation=[o,r];let[a,l]=this.parentDimensions;this.x=t.x/a,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){let t=J.prototype._resizeWithKeyboard,e=Uo.TRANSLATE_SMALL,n=Uo.TRANSLATE_BIG;return Z(this,"_resizerKeyboardManager",new Lo([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,n]}],[["Escape","mac+Escape"],J.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return Z(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){let e=new Rm({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){var i;if((i=J._l10n)!=null||(J._l10n=t),J._l10nResizer||(J._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),J._borderLineWidth!==-1)return;let n=getComputedStyle(document.documentElement);J._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){ot("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return u(this,ac)}set _isDraggable(t){var e;v(this,ac,t),(e=this.div)==null||e.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){let[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=u(this,pf)}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):w(this,Ls,ja).call(this),this.parent=t}focusin(t){this._focusEventsAllowed&&(u(this,ks)?v(this,ks,!1):this.parent.setSelected(this))}focusout(t){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;let e=t.relatedTarget;e!=null&&e.closest(`#${this.id}`)||(t.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,n,i){let[o,r]=this.parentDimensions;[n,i]=this.screenToPageTranslation(n,i),this.x=(t+n)/o,this.y=(e+i)/r,this.fixAndSetPosition()}translate(t,e){w(this,lc,Em).call(this,this.parentDimensions,t,e)}translateInPage(t,e){u(this,_e)||v(this,_e,[this.x,this.y,this.width,this.height]),w(this,lc,Em).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}drag(t,e){u(this,_e)||v(this,_e,[this.x,this.y,this.width,this.height]);let{div:n,parentDimensions:[i,o]}=this;if(this.x+=t/i,this.y+=e/o,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:p,y:g}=this.div.getBoundingClientRect();this.parent.findNewParent(this,p,g)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this,[l,c]=this.getBaseTranslation();r+=l,a+=c;let{style:d}=n;d.left=`${(100*r).toFixed(2)}%`,d.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),n.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!u(this,_e)&&(u(this,_e)[0]!==this.x||u(this,_e)[1]!==this.y)}get _hasBeenResized(){return!!u(this,_e)&&(u(this,_e)[2]!==this.width||u(this,_e)[3]!==this.height)}getBaseTranslation(){let[t,e]=this.parentDimensions,{_borderLineWidth:n}=J,i=n/t,o=n/e;switch(this.rotation){case 90:return[-i,o];case 180:return[i,o];case 270:return[i,-o];default:return[-i,-o]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){let{div:{style:e},pageDimensions:[n,i]}=this,{x:o,y:r,width:a,height:l}=this;if(a*=n,l*=i,o*=n,r*=i,this._mustFixPosition)switch(t){case 0:o=Math.max(0,Math.min(n-a,o)),r=Math.max(0,Math.min(i-l,r));break;case 90:o=Math.max(0,Math.min(n-l,o)),r=Math.min(i,Math.max(a,r));break;case 180:o=Math.min(n,Math.max(a,o)),r=Math.min(i,Math.max(l,r));break;case 270:o=Math.min(n,Math.max(l,o)),r=Math.max(0,Math.min(i-a,r));break}this.x=o/=n,this.y=r/=i;let[c,d]=this.getBaseTranslation();o+=c,r+=d,e.left=`${(100*o).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(t,e){var n;return w(n=J,cc,Cm).call(n,t,e,this.parentRotation)}pageTranslationToScreen(t,e){var n;return w(n=J,cc,Cm).call(n,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:t,pageDimensions:[e,n]}=this;return[e*t,n*t]}setDims(t,e){let[n,i]=this.parentDimensions,{style:o}=this.div;o.width=`${(100*t/n).toFixed(2)}%`,u(this,Ms)||(o.height=`${(100*e/i).toFixed(2)}%`)}fixDims(){let{style:t}=this.div,{height:e,width:n}=t,i=n.endsWith("%"),o=!u(this,Ms)&&e.endsWith("%");if(i&&o)return;let[r,a]=this.parentDimensions;i||(t.width=`${(100*parseFloat(n)/r).toFixed(2)}%`),!u(this,Ms)&&!o&&(t.height=`${(100*parseFloat(e)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(t){return Math.round(t*1e4)/1e4}_onResizing(){}altTextFinish(){var t;(t=u(this,at))==null||t.finish()}async addEditToolbar(){return this._editToolbar||u(this,Ds)?this._editToolbar:(this._editToolbar=new cm(this),this.div.append(this._editToolbar.render()),u(this,at)&&await this._editToolbar.addAltText(u(this,at)),this._editToolbar)}removeEditToolbar(){var t;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(t=u(this,at))==null||t.destroy())}addContainer(t){var n;let e=(n=this._editToolbar)==null?void 0:n.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){u(this,at)||(yh.initialize(J._l10n),v(this,at,new yh(this)),u(this,Rs)&&(u(this,at).data=u(this,Rs),v(this,Rs,null)),await this.addEditToolbar())}get altTextData(){var t;return(t=u(this,at))==null?void 0:t.data}set altTextData(t){u(this,at)&&(u(this,at).data=t)}get guessedAltText(){var t;return(t=u(this,at))==null?void 0:t.guessedText}async setGuessedAltText(t){var e;await((e=u(this,at))==null?void 0:e.setGuessedText(t))}serializeAltText(t){var e;return(e=u(this,at))==null?void 0:e.serialize(t)}hasAltText(){return!!u(this,at)&&!u(this,at).isEmpty()}hasAltTextData(){var t,e;return(e=(t=u(this,at))==null?void 0:t.hasData())!=null?e:!1}render(){var o;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=u(this,Cr)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),w(this,fc,Im).call(this);let[t,e]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*e/t).toFixed(2)}%`,this.div.style.maxHeight=`${(100*t/e).toFixed(2)}%`);let[n,i]=this.getInitialTranslation();return this.translate(n,i),mh(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(u(this,Fs)||v(this,Fs,new _h({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:w(this,yf,Yw).bind(this),onPinching:w(this,_f,Jw).bind(this),onPinchEnd:w(this,vf,Xw).bind(this),signal:this._uiManager._signal}))),(o=this._uiManager._editorUndoBar)==null||o.hide(),this.div}pointerdown(t){let{isMac:e}=Gt.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(v(this,ks,!0),this._isDraggable){w(this,Af,Zw).call(this,t);return}w(this,hc,xm).call(this,t)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){u(this,Cn)&&clearTimeout(u(this,Cn)),v(this,Cn,setTimeout(()=>{var t;v(this,Cn,null),(t=this.parent)==null||t.moveEditorInDOM(this)},0))}_setParentAndPosition(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,n=this.rotation){let i=this.parentScale,[o,r]=this.pageDimensions,[a,l]=this.pageTranslation,c=t/i,d=e/i,p=this.x*o,g=this.y*r,m=this.width*o,_=this.height*r;switch(n){case 0:return[p+c+a,r-g-d-_+l,p+c+m+a,r-g-d+l];case 90:return[p+d+a,r-g+c+l,p+d+_+a,r-g+c+m+l];case 180:return[p-c-m+a,r-g+d+l,p-c+a,r-g+d+_+l];case 270:return[p-d-_+a,r-g-c-m+l,p-d+a,r-g-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){let[n,i,o,r]=t,a=o-n,l=r-i;switch(this.rotation){case 0:return[n,e-r,a,l];case 90:return[n,e-i,l,a];case 180:return[o,e-i,a,l];case 270:return[o,e-r,l,a];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){v(this,Ds,!0)}disableEditMode(){v(this,Ds,!1)}isInEditMode(){return u(this,Ds)}shouldGetKeyboardEvents(){return u(this,Xn)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:t,left:e,bottom:n,right:i}=this.getClientDimensions(),{innerHeight:o,innerWidth:r}=window;return e<r&&i>0&&t<o&&n>0}rebuild(){w(this,fc,Im).call(this)}rotate(t){}resize(){}serializeDeleted(){var t;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((t=this._initialData)==null?void 0:t.popupRef)||""}}serialize(t=!1,e=null){ot("An editor must be serializable")}static async deserialize(t,e,n){let i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:n});i.rotation=t.rotation,v(i,Rs,t.accessibilityData);let[o,r]=i.pageDimensions,[a,l,c,d]=i.getRectInCurrentCoords(t.rect,r);return i.x=a/o,i.y=l/r,i.width=c/o,i.height=d/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var t,e;if((t=u(this,Di))==null||t.abort(),v(this,Di,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),u(this,Cn)&&(clearTimeout(u(this,Cn)),v(this,Cn,null)),w(this,Ls,ja).call(this),this.removeEditToolbar(),u(this,Le)){for(let n of u(this,Le).values())clearTimeout(n);v(this,Le,null)}this.parent=null,(e=u(this,Fs))==null||e.destroy(),v(this,Fs,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(w(this,gf,Ww).call(this),u(this,Lt).classList.remove("hidden"),mh(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),v(this,Jn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let e=u(this,Lt).children;if(!u(this,je)){v(this,je,Array.from(e));let r=w(this,wf,Qw).bind(this),a=w(this,Tf,jw).bind(this),l=this._uiManager._signal;for(let c of u(this,je)){let d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",r,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",w(this,Ef,tT).bind(this,d),{signal:l}),c.setAttribute("data-l10n-id",J._l10nResizer[d])}}let n=u(this,je)[0],i=0;for(let r of e){if(r===n)break;i++}let o=(360-this.rotation+this.parentRotation)%360/90*(u(this,je).length/4);if(o!==i){if(o<i)for(let a=0;a<i-o;a++)u(this,Lt).append(u(this,Lt).firstChild);else if(o>i)for(let a=0;a<o-i;a++)u(this,Lt).firstChild.before(u(this,Lt).lastChild);let r=0;for(let a of e){let c=u(this,je)[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",J._l10nResizer[c])}}w(this,pc,Pm).call(this,0),v(this,Xn,!0),u(this,Lt).firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){u(this,Xn)&&w(this,dc,bm).call(this,u(this,oc),{deltaX:t,deltaY:e,fromKeyboard:!0})}_stopResizingWithKeyboard(){w(this,Ls,ja).call(this),this.div.focus()}select(){var t,e,n;if(this.makeResizable(),(t=this.div)==null||t.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,o;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((o=this._editToolbar)==null||o.show())});return}(e=this._editToolbar)==null||e.show(),(n=u(this,at))==null||n.toggleAltTextBadge(!1)}unselect(){var t,e,n,i,o;(t=u(this,Lt))==null||t.classList.add("hidden"),(e=this.div)==null||e.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(o=u(this,at))==null||o.toggleAltTextBadge(!0)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return u(this,rc)}set isEditing(t){v(this,rc,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){v(this,Ms,!0);let n=t/e,{style:i}=this.div;i.aspectRatio=n,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){u(this,Le)||v(this,Le,new Map);let{action:n}=t,i=u(this,Le).get(n);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(t),u(this,Le).delete(n),u(this,Le).size===0&&v(this,Le,null)},J._telemetryTimeout),u(this,Le).set(n,i);return}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),v(this,Cr,!1)}disable(){this.div&&(this.div.tabIndex=-1),v(this,Cr,!0)}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){let n=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),n.before(e)}return e}resetAnnotationElement(t){let{firstChild:e}=t.container;(e==null?void 0:e.nodeName)==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}};Rs=new WeakMap,je=new WeakMap,at=new WeakMap,Cr=new WeakMap,ki=new WeakMap,sc=new WeakMap,Ms=new WeakMap,Lt=new WeakMap,Ns=new WeakMap,Jn=new WeakMap,Di=new WeakMap,oc=new WeakMap,ks=new WeakMap,_e=new WeakMap,rc=new WeakMap,Ds=new WeakMap,Xn=new WeakMap,Cn=new WeakMap,Sr=new WeakMap,br=new WeakMap,Le=new WeakMap,Fs=new WeakMap,ac=new WeakMap,pf=new WeakMap,lc=new WeakSet,Em=function([t,e],n,i){[n,i]=this.screenToPageTranslation(n,i),this.x+=n/t,this.y+=i/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},cc=new WeakSet,Cm=function(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}},xr=new WeakSet,zd=function(t){switch(t){case 90:{let[e,n]=this.pageDimensions;return[0,-e/n,n/e,0]}case 180:return[-1,0,0,-1];case 270:{let[e,n]=this.pageDimensions;return[0,e/n,-n/e,0]}default:return[1,0,0,1]}},gf=new WeakSet,Ww=function(){if(u(this,Lt))return;v(this,Lt,document.createElement("div")),u(this,Lt).classList.add("resizers");let t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(let n of t){let i=document.createElement("div");u(this,Lt).append(i),i.classList.add("resizer",n),i.setAttribute("data-resizer-name",n),i.addEventListener("pointerdown",w(this,mf,Kw).bind(this,n),{signal:e}),i.addEventListener("contextmenu",dn,{signal:e}),i.tabIndex=-1}this.div.prepend(u(this,Lt))},mf=new WeakSet,Kw=function(t,e){var d;e.preventDefault();let{isMac:n}=Gt.platform;if(e.button!==0||e.ctrlKey&&n)return;(d=u(this,at))==null||d.toggle(!1);let i=this._isDraggable;this._isDraggable=!1,v(this,Ns,[e.screenX,e.screenY]);let o=new AbortController,r=this._uiManager.combinedSignal(o);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",w(this,dc,bm).bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",Pe,{passive:!1,signal:r}),window.addEventListener("contextmenu",dn,{signal:r}),v(this,Jn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;let c=()=>{var p;o.abort(),this.parent.togglePointerEvents(!0),(p=u(this,at))==null||p.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=l,w(this,Ir,Wd).call(this)};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})},uc=new WeakSet,Sm=function(t,e,n,i){this.width=n,this.height=i,this.x=t,this.y=e;let[o,r]=this.parentDimensions;this.setDims(o*n,r*i),this.fixAndSetPosition(),this._onResized()},Ir=new WeakSet,Wd=function(){if(!u(this,Jn))return;let{savedX:t,savedY:e,savedWidth:n,savedHeight:i}=u(this,Jn);v(this,Jn,null);let o=this.x,r=this.y,a=this.width,l=this.height;o===t&&r===e&&a===n&&l===i||this.addCommands({cmd:w(this,uc,Sm).bind(this,o,r,a,l),undo:w(this,uc,Sm).bind(this,t,e,n,i),mustExec:!0})},dc=new WeakSet,bm=function(t,e){let[n,i]=this.parentDimensions,o=this.x,r=this.y,a=this.width,l=this.height,c=J.MIN_SIZE/n,d=J.MIN_SIZE/i,p=w(this,xr,zd).call(this,this.rotation),g=(k,B)=>[p[0]*k+p[2]*B,p[1]*k+p[3]*B],m=w(this,xr,zd).call(this,360-this.rotation),_=(k,B)=>[m[0]*k+m[2]*B,m[1]*k+m[3]*B],A,T,E=!1,C=!1;switch(t){case"topLeft":E=!0,A=(k,B)=>[0,0],T=(k,B)=>[k,B];break;case"topMiddle":A=(k,B)=>[k/2,0],T=(k,B)=>[k/2,B];break;case"topRight":E=!0,A=(k,B)=>[k,0],T=(k,B)=>[0,B];break;case"middleRight":C=!0,A=(k,B)=>[k,B/2],T=(k,B)=>[0,B/2];break;case"bottomRight":E=!0,A=(k,B)=>[k,B],T=(k,B)=>[0,0];break;case"bottomMiddle":A=(k,B)=>[k/2,B],T=(k,B)=>[k/2,0];break;case"bottomLeft":E=!0,A=(k,B)=>[0,B],T=(k,B)=>[k,0];break;case"middleLeft":C=!0,A=(k,B)=>[0,B/2],T=(k,B)=>[k,B/2];break}let S=A(a,l),b=T(a,l),x=g(...b),P=J._round(o+x[0]),I=J._round(r+x[1]),N=1,M=1,F,U;if(e.fromKeyboard)({deltaX:F,deltaY:U}=e);else{let{screenX:k,screenY:B}=e,[ge,hn]=u(this,Ns);[F,U]=this.screenToPageTranslation(k-ge,B-hn),u(this,Ns)[0]=k,u(this,Ns)[1]=B}if([F,U]=_(F/n,U/i),E){let k=Math.hypot(a,l);N=M=Math.max(Math.min(Math.hypot(b[0]-S[0]-F,b[1]-S[1]-U)/k,1/a,1/l),c/a,d/l)}else C?N=Math.max(c,Math.min(1,Math.abs(b[0]-S[0]-F)))/a:M=Math.max(d,Math.min(1,Math.abs(b[1]-S[1]-U)))/l;let j=J._round(a*N),z=J._round(l*M);x=g(...T(j,z));let W=P-x[0],bt=I-x[1];u(this,_e)||v(this,_e,[this.x,this.y,this.width,this.height]),this.width=j,this.height=z,this.x=W,this.y=bt,this.setDims(n*j,i*z),this.fixAndSetPosition(),this._onResizing()},yf=new WeakSet,Yw=function(){var t;v(this,Jn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(t=u(this,at))==null||t.toggle(!1),this.parent.togglePointerEvents(!1)},_f=new WeakSet,Jw=function(t,e,n){let o=.7*(n/e)+1-.7;if(o===1)return;let r=w(this,xr,zd).call(this,this.rotation),a=(P,I)=>[r[0]*P+r[2]*I,r[1]*P+r[3]*I],[l,c]=this.parentDimensions,d=this.x,p=this.y,g=this.width,m=this.height,_=J.MIN_SIZE/l,A=J.MIN_SIZE/c;o=Math.max(Math.min(o,1/g,1/m),_/g,A/m);let T=J._round(g*o),E=J._round(m*o);if(T===g&&E===m)return;u(this,_e)||v(this,_e,[d,p,g,m]);let C=a(g/2,m/2),S=J._round(d+C[0]),b=J._round(p+C[1]),x=a(T/2,E/2);this.x=S-x[0],this.y=b-x[1],this.width=T,this.height=E,this.setDims(l*T,c*E),this.fixAndSetPosition(),this._onResizing()},vf=new WeakSet,Xw=function(){var t;(t=u(this,at))==null||t.toggle(!0),this.parent.togglePointerEvents(!0),w(this,Ir,Wd).call(this)},hc=new WeakSet,xm=function(t){let{isMac:e}=Gt.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)},Af=new WeakSet,Zw=function(t){let{isSelected:e}=this;this._uiManager.setUpDragSession();let n=!1,i=new AbortController,o=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:o},a=c=>{i.abort(),v(this,ki,null),v(this,ks,!1),this._uiManager.endDragSession()||w(this,hc,xm).call(this,c),n&&this._onStopDragging()};e&&(v(this,Sr,t.clientX),v(this,br,t.clientY),v(this,ki,t.pointerId),v(this,sc,t.pointerType),window.addEventListener("pointermove",c=>{n||(n=!0,this._onStartDragging());let{clientX:d,clientY:p,pointerId:g}=c;if(g!==u(this,ki)){Pe(c);return}let[m,_]=this.screenToPageTranslation(d-u(this,Sr),p-u(this,br));v(this,Sr,d),v(this,br,p),this._uiManager.dragSelectedEditors(m,_)},r),window.addEventListener("touchmove",Pe,r),window.addEventListener("pointerdown",c=>{c.pointerType===u(this,sc)&&(u(this,Fs)||c.isPrimary)&&a(c),Pe(c)},r));let l=c=>{if(!u(this,ki)||u(this,ki)===c.pointerId){a(c);return}Pe(c)};window.addEventListener("pointerup",l,{signal:o}),window.addEventListener("blur",l,{signal:o})},fc=new WeakSet,Im=function(){if(u(this,Di)||!this.div)return;v(this,Di,new AbortController);let t=this._uiManager.combinedSignal(u(this,Di));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})},wf=new WeakSet,Qw=function(t){J._resizerKeyboardManager.exec(this,t)},Tf=new WeakSet,jw=function(t){var e;u(this,Xn)&&((e=t.relatedTarget)==null?void 0:e.parentNode)!==u(this,Lt)&&w(this,Ls,ja).call(this)},Ef=new WeakSet,tT=function(t){v(this,oc,u(this,Xn)?t:"")},pc=new WeakSet,Pm=function(t){if(u(this,je))for(let e of u(this,je))e.tabIndex=t},Ls=new WeakSet,ja=function(){v(this,Xn,!1),w(this,pc,Pm).call(this,-1),w(this,Ir,Wd).call(this)},y(J,cc),H(J,"_l10n",null),H(J,"_l10nResizer",null),H(J,"_borderLineWidth",-1),H(J,"_colorManager",new gm),H(J,"_zIndex",1),H(J,"_telemetryTimeout",1e3);var ft=J,Rm=class extends ft{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},uw=3285377520,ke=4294901760,pn=65535,vh=class{constructor(t){this.h1=t?t&4294967295:uw,this.h2=t?t&4294967295:uw}update(t){let e,n;if(typeof t=="string"){e=new Uint8Array(t.length*2),n=0;for(let A=0,T=t.length;A<T;A++){let E=t.charCodeAt(A);E<=255?e[n++]=E:(e[n++]=E>>>8,e[n++]=E&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),n=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let i=n>>2,o=n-i*4,r=new Uint32Array(e.buffer,0,i),a=0,l=0,c=this.h1,d=this.h2,p=3432918353,g=461845907,m=p&pn,_=g&pn;for(let A=0;A<i;A++)A&1?(a=r[A],a=a*p&ke|a*m&pn,a=a<<15|a>>>17,a=a*g&ke|a*_&pn,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=r[A],l=l*p&ke|l*m&pn,l=l<<15|l>>>17,l=l*g&ke|l*_&pn,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(a=0,o){case 3:a^=e[i*4+2]<<16;case 2:a^=e[i*4+1]<<8;case 1:a^=e[i*4],a=a*p&ke|a*m&pn,a=a<<15|a>>>17,a=a*g&ke|a*_&pn,i&1?c^=a:d^=a}this.h1=c,this.h2=d}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&ke|t*36045&pn,e=e*4283543511&ke|((e<<16|t>>>16)*2950163797&ke)>>>16,t^=e>>>1,t=t*444984403&ke|t*60499&pn,e=e*3301882366&ke|((e<<16|t>>>16)*3120437893&ke)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}},Mm=Object.freeze({map:null,hash:"",transfer:void 0}),Us,Os,Pt,Cf,eT,vl=class{constructor(){y(this,Cf);y(this,Us,!1);y(this,Os,null);y(this,Pt,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){let n=u(this,Pt).get(t);return n===void 0?e:Object.assign(e,n)}getRawValue(t){return u(this,Pt).get(t)}remove(t){if(u(this,Pt).delete(t),u(this,Pt).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let e of u(this,Pt).values())if(e instanceof ft)return;this.onAnnotationEditor(null)}}setValue(t,e){let n=u(this,Pt).get(t),i=!1;if(n!==void 0)for(let[o,r]of Object.entries(e))n[o]!==r&&(i=!0,n[o]=r);else i=!0,u(this,Pt).set(t,e);i&&w(this,Cf,eT).call(this),e instanceof ft&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return u(this,Pt).has(t)}getAll(){return u(this,Pt).size>0?w_(u(this,Pt)):null}setAll(t){for(let[e,n]of Object.entries(t))this.setValue(e,n)}get size(){return u(this,Pt).size}resetModified(){u(this,Us)&&(v(this,Us,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Ah(this)}get serializable(){if(u(this,Pt).size===0)return Mm;let t=new Map,e=new vh,n=[],i=Object.create(null),o=!1;for(let[r,a]of u(this,Pt)){let l=a instanceof ft?a.serialize(!1,i):a;l&&(t.set(r,l),e.update(`${r}:${JSON.stringify(l)}`),o||(o=!!l.bitmap))}if(o)for(let r of t.values())r.bitmap&&n.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:n}:Mm}get editorStats(){var n;let t=null,e=new Map;for(let i of u(this,Pt).values()){if(!(i instanceof ft))continue;let o=i.telemetryFinalData;if(!o)continue;let{type:r}=o;e.has(r)||e.set(r,Object.getPrototypeOf(i).constructor),t||(t=Object.create(null));let a=t[r]||(t[r]=new Map);for(let[l,c]of Object.entries(o)){if(l==="type")continue;let d=a.get(l);d||(d=new Map,a.set(l,d));let p=(n=d.get(c))!=null?n:0;d.set(c,p+1)}}for(let[i,o]of e)t[i]=o.computeTelemetryFinalData(t[i]);return t}resetModifiedIds(){v(this,Os,null)}get modifiedIds(){if(u(this,Os))return u(this,Os);let t=[];for(let e of u(this,Pt).values())!(e instanceof ft)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return v(this,Os,{ids:new Set(t),hash:t.join(",")})}};Us=new WeakMap,Os=new WeakMap,Pt=new WeakMap,Cf=new WeakSet,eT=function(){u(this,Us)||(v(this,Us,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var gc,Ah=class extends vl{constructor(e){super();y(this,gc,void 0);let{map:n,hash:i,transfer:o}=e.serializable,r=structuredClone(n,o?{transfer:o}:null);v(this,gc,{map:r,hash:i,transfer:o})}get print(){ot("Should not call PrintAnnotationStorage.print")}get serializable(){return u(this,gc)}get modifiedIds(){return Z(this,"modifiedIds",{ids:new Set,hash:""})}};gc=new WeakMap;var Pr,Nm=class{constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){y(this,Pr,new Set);this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(let t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),u(this,Pr).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,_inspectFont:e}){if(!(!t||u(this,Pr).has(t.loadedName))){if(wt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:n,src:i,style:o}=t,r=new FontFace(n,i,o);this.addNativeFontFace(r);try{await r.load(),u(this,Pr).add(n),e==null||e(t)}catch(a){Y(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}return}ot("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){let n=t.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(i){throw Y(`Failed to load font '${n.family}': '${i}'.`),t.disableFontFace=!0,i}}return}let e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(n=>{let i=this._queueLoadingCallback(n);this._prepareFontLoadEvent(t,i)})}}get isFontLoadingAPISupported(){var e;let t=!!((e=this._document)!=null&&e.fonts);return Z(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let t=!1;return(Qt||typeof navigator!="undefined"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(t=!0),Z(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(t){function e(){for(wt(!i.done,"completeRequest() cannot be called twice."),i.done=!0;n.length>0&&n[0].done;){let o=n.shift();setTimeout(o.callback,0)}}let{loadingRequests:n}=this,i={done:!1,complete:e,callback:t};return n.push(i),i}get _loadTestFont(){let t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Z(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function n(b,x){return b.charCodeAt(x)<<24|b.charCodeAt(x+1)<<16|b.charCodeAt(x+2)<<8|b.charCodeAt(x+3)&255}function i(b,x,P,I){let N=b.substring(0,x),M=b.substring(x+P);return N+I+M}let o,r,a=this._document.createElement("canvas");a.width=1,a.height=1;let l=a.getContext("2d"),c=0;function d(b,x){if(++c>30){Y("Load test font never loaded."),x();return}if(l.font="30px "+b,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){x();return}setTimeout(d.bind(null,b,x))}let p=`lt${Date.now()}${this.loadTestFontId++}`,g=this._loadTestFont;g=i(g,976,p.length,p);let _=16,A=1482184792,T=n(g,_);for(o=0,r=p.length-3;o<r;o+=4)T=T-A+n(p,o)|0;o<p.length&&(T=T-A+n(p+"XXX",o)|0),g=i(g,_,4,oP(T));let E=`url(data:font/opentype;base64,${btoa(g)});`,C=`@font-face {font-family:"${p}";src:${E}}`;this.insertRule(C);let S=this._document.createElement("div");S.style.visibility="hidden",S.style.width=S.style.height="10px",S.style.position="absolute",S.style.top=S.style.left="0px";for(let b of[t.loadedName,p]){let x=this._document.createElement("span");x.textContent="Hi",x.style.fontFamily=b,S.append(x)}this._document.body.append(S),d(p,()=>{S.remove(),e.complete()})}};Pr=new WeakMap;var km=class{constructor(t,{disableFontFace:e=!1,fontExtraProperties:n=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(let o in t)this[o]=t[o];this.disableFontFace=e===!0,this.fontExtraProperties=n===!0,this._inspectFont=i}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{let n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(e=this._inspectFont)==null||e.call(this,this),t}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;let t=`url(data:${this.mimetype};base64,${dP(this.data)});`,e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${t}}`}return(n=this._inspectFont)==null||n.call(this,this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];let n=this.loadedName+"_path_"+e,i;try{i=t.get(n)}catch(r){Y(`getPathGenerator - ignoring character: "${r}".`)}let o=new Path2D(i||"");return this.fontExtraProperties||t.delete(n),this.compiledGlyphs[e]=o}},kd={DATA:1,ERROR:2},At={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function dw(){}function ce(s){if(s instanceof Dn||s instanceof gl||s instanceof Do||s instanceof ph||s instanceof Oa||s instanceof hl)return s;switch(s instanceof Error||typeof s=="object"&&s!==null||ot('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),s.name){case"AbortException":return new Dn(s.message);case"InvalidPDFException":return new gl(s.message);case"MissingPDFException":return new Do(s.message);case"PasswordException":return new ph(s.message,s.code);case"UnexpectedResponseException":return new Oa(s.message,s.status);case"UnknownErrorException":return new hl(s.message,s.details)}return new hl(s.message,s.toString())}var Rr,Sf,nT,bf,iT,xf,sT,Mr,Kd,gs=class{constructor(t,e,n){y(this,Sf);y(this,bf);y(this,xf);y(this,Mr);y(this,Rr,new AbortController);this.sourceName=t,this.targetName=e,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",w(this,Sf,nT).bind(this),{signal:u(this,Rr).signal})}on(t,e){let n=this.actionHandler;if(n[t])throw new Error(`There is already an actionName called "${t}"`);n[t]=e}send(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}sendWithPromise(t,e,n){let i=this.callbackId++,o=Promise.withResolvers();this.callbackCapabilities[i]=o;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},n)}catch(r){o.reject(r)}return o.promise}sendWithStream(t,e,n,i){let o=this.streamId++,r=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{let d=Promise.withResolvers();return this.streamControllers[o]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:a,action:t,streamId:o,data:e,desiredSize:c.desiredSize},i),d.promise},pull:c=>{let d=Promise.withResolvers();return this.streamControllers[o].pullCall=d,l.postMessage({sourceName:r,targetName:a,stream:At.PULL,streamId:o,desiredSize:c.desiredSize}),d.promise},cancel:c=>{wt(c instanceof Error,"cancel must have a valid reason");let d=Promise.withResolvers();return this.streamControllers[o].cancelCall=d,this.streamControllers[o].isClosed=!0,l.postMessage({sourceName:r,targetName:a,stream:At.CANCEL,streamId:o,reason:ce(c)}),d.promise}},n)}destroy(){var t;(t=u(this,Rr))==null||t.abort(),v(this,Rr,null)}};Rr=new WeakMap,Sf=new WeakSet,nT=function({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){w(this,xf,sT).call(this,t);return}if(t.callback){let n=t.callbackId,i=this.callbackCapabilities[n];if(!i)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],t.callback===kd.DATA)i.resolve(t.data);else if(t.callback===kd.ERROR)i.reject(ce(t.reason));else throw new Error("Unexpected callback case");return}let e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){let n=this.sourceName,i=t.sourceName,o=this.comObj;Promise.try(e,t.data).then(function(r){o.postMessage({sourceName:n,targetName:i,callback:kd.DATA,callbackId:t.callbackId,data:r})},function(r){o.postMessage({sourceName:n,targetName:i,callback:kd.ERROR,callbackId:t.callbackId,reason:ce(r)})});return}if(t.streamId){w(this,bf,iT).call(this,t);return}e(t.data)},bf=new WeakSet,iT=function(t){let e=t.streamId,n=this.sourceName,i=t.sourceName,o=this.comObj,r=this,a=this.actionHandler[t.action],l={enqueue(c,d=1,p){if(this.isCancelled)return;let g=this.desiredSize;this.desiredSize-=d,g>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:n,targetName:i,stream:At.ENQUEUE,streamId:e,chunk:c},p)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:i,stream:At.CLOSE,streamId:e}),delete r.streamSinks[e])},error(c){wt(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:i,stream:At.ERROR,streamId:e,reason:ce(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(a,t.data,l).then(function(){o.postMessage({sourceName:n,targetName:i,stream:At.START_COMPLETE,streamId:e,success:!0})},function(c){o.postMessage({sourceName:n,targetName:i,stream:At.START_COMPLETE,streamId:e,reason:ce(c)})})},xf=new WeakSet,sT=function(t){let e=t.streamId,n=this.sourceName,i=t.sourceName,o=this.comObj,r=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case At.START_COMPLETE:t.success?r.startCall.resolve():r.startCall.reject(ce(t.reason));break;case At.PULL_COMPLETE:t.success?r.pullCall.resolve():r.pullCall.reject(ce(t.reason));break;case At.PULL:if(!a){o.postMessage({sourceName:n,targetName:i,stream:At.PULL_COMPLETE,streamId:e,success:!0});break}a.desiredSize<=0&&t.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=t.desiredSize,Promise.try(a.onPull||dw).then(function(){o.postMessage({sourceName:n,targetName:i,stream:At.PULL_COMPLETE,streamId:e,success:!0})},function(c){o.postMessage({sourceName:n,targetName:i,stream:At.PULL_COMPLETE,streamId:e,reason:ce(c)})});break;case At.ENQUEUE:if(wt(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case At.CLOSE:if(wt(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),w(this,Mr,Kd).call(this,r,e);break;case At.ERROR:wt(r,"error should have stream controller"),r.controller.error(ce(t.reason)),w(this,Mr,Kd).call(this,r,e);break;case At.CANCEL_COMPLETE:t.success?r.cancelCall.resolve():r.cancelCall.reject(ce(t.reason)),w(this,Mr,Kd).call(this,r,e);break;case At.CANCEL:if(!a)break;let l=ce(t.reason);Promise.try(a.onCancel||dw,l).then(function(){o.postMessage({sourceName:n,targetName:i,stream:At.CANCEL_COMPLETE,streamId:e,success:!0})},function(c){o.postMessage({sourceName:n,targetName:i,stream:At.CANCEL_COMPLETE,streamId:e,reason:ce(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}},Mr=new WeakSet,Kd=async function(t,e){var n,i,o;await Promise.allSettled([(n=t.startCall)==null?void 0:n.promise,(i=t.pullCall)==null?void 0:i.promise,(o=t.cancelCall)==null?void 0:o.promise]),delete this.streamControllers[e]};var mc,wh=class{constructor({enableHWA:t=!1}){y(this,mc,!1);v(this,mc,t)}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");let n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!u(this,mc)})}}reset(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){ot("Abstract method `_createCanvas` called.")}};mc=new WeakMap;var Dm=class extends wh{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){let n=this._document.createElement("canvas");return n.width=t,n.height=e,n}},Th=class{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");let e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){ot("Abstract method `_fetch` called.")}},Eh=class extends Th{async _fetch(t){let e=await kp(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Np(e)}},Ch=class{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,n,i,o){return"none"}destroy(t=!1){}},$s,Nr,Zn,Qn,Yt,Gs,Bs,Rt,zt,Hs,tl,Fi,Zo,kr,Yd,Li,Qo,If,oT,yc,Lm,Ui,jo,Vs,el,qs,nl,_c,Um,zs,il,Fm=class extends Ch{constructor({docId:e,ownerDocument:n=globalThis.document}){super();y(this,Rt);y(this,Hs);y(this,Fi);y(this,kr);y(this,Li);y(this,If);y(this,yc);y(this,Ui);y(this,Vs);y(this,qs);y(this,_c);y(this,zs);y(this,$s,void 0);y(this,Nr,void 0);y(this,Zn,void 0);y(this,Qn,void 0);y(this,Yt,void 0);y(this,Gs,void 0);y(this,Bs,0);v(this,Qn,e),v(this,Yt,n)}addFilter(e){if(!e)return"none";let n=u(this,Rt,zt).get(e);if(n)return n;let[i,o,r]=w(this,kr,Yd).call(this,e),a=e.length===1?i:`${i}${o}${r}`;if(n=u(this,Rt,zt).get(a),n)return u(this,Rt,zt).set(e,n),n;let l=`g_${u(this,Qn)}_transfer_map_${jt(this,Bs)._++}`,c=w(this,Li,Qo).call(this,l);u(this,Rt,zt).set(e,c),u(this,Rt,zt).set(a,c);let d=w(this,Ui,jo).call(this,l);return w(this,qs,nl).call(this,i,o,r,d),c}addHCMFilter(e,n){var _;let i=`${e}-${n}`,o="base",r=u(this,Hs,tl).get(o);if((r==null?void 0:r.key)===i||(r?((_=r.filter)==null||_.remove(),r.key=i,r.url="none",r.filter=null):(r={key:i,url:"none",filter:null},u(this,Hs,tl).set(o,r)),!e||!n))return r.url;let a=w(this,zs,il).call(this,e);e=$.makeHexColor(...a);let l=w(this,zs,il).call(this,n);if(n=$.makeHexColor(...l),u(this,Fi,Zo).style.color="",e==="#000000"&&n==="#ffffff"||e===n)return r.url;let c=new Array(256);for(let A=0;A<=255;A++){let T=A/255;c[A]=T<=.03928?T/12.92:((T+.055)/1.055)**2.4}let d=c.join(","),p=`g_${u(this,Qn)}_hcm_filter`,g=r.filter=w(this,Ui,jo).call(this,p);w(this,qs,nl).call(this,d,d,d,g),w(this,yc,Lm).call(this,g);let m=(A,T)=>{let E=a[A]/255,C=l[A]/255,S=new Array(T+1);for(let b=0;b<=T;b++)S[b]=E+b/T*(C-E);return S.join(",")};return w(this,qs,nl).call(this,m(0,5),m(1,5),m(2,5),g),r.url=w(this,Li,Qo).call(this,p),r.url}addAlphaFilter(e){let n=u(this,Rt,zt).get(e);if(n)return n;let[i]=w(this,kr,Yd).call(this,[e]),o=`alpha_${i}`;if(n=u(this,Rt,zt).get(o),n)return u(this,Rt,zt).set(e,n),n;let r=`g_${u(this,Qn)}_alpha_map_${jt(this,Bs)._++}`,a=w(this,Li,Qo).call(this,r);u(this,Rt,zt).set(e,a),u(this,Rt,zt).set(o,a);let l=w(this,Ui,jo).call(this,r);return w(this,_c,Um).call(this,i,l),a}addLuminosityFilter(e){let n=u(this,Rt,zt).get(e||"luminosity");if(n)return n;let i,o;if(e?([i]=w(this,kr,Yd).call(this,[e]),o=`luminosity_${i}`):o="luminosity",n=u(this,Rt,zt).get(o),n)return u(this,Rt,zt).set(e,n),n;let r=`g_${u(this,Qn)}_luminosity_map_${jt(this,Bs)._++}`,a=w(this,Li,Qo).call(this,r);u(this,Rt,zt).set(e,a),u(this,Rt,zt).set(o,a);let l=w(this,Ui,jo).call(this,r);return w(this,If,oT).call(this,l),e&&w(this,_c,Um).call(this,i,l),a}addHighlightHCMFilter(e,n,i,o,r){var C;let a=`${n}-${i}-${o}-${r}`,l=u(this,Hs,tl).get(e);if((l==null?void 0:l.key)===a||(l?((C=l.filter)==null||C.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},u(this,Hs,tl).set(e,l)),!n||!i))return l.url;let[c,d]=[n,i].map(w(this,zs,il).bind(this)),p=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),g=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[m,_]=[o,r].map(w(this,zs,il).bind(this));g<p&&([p,g,m,_]=[g,p,_,m]),u(this,Fi,Zo).style.color="";let A=(S,b,x)=>{let P=new Array(256),I=(g-p)/x,N=S/255,M=(b-S)/(255*x),F=0;for(let U=0;U<=x;U++){let j=Math.round(p+U*I),z=N+U*M;for(let W=F;W<=j;W++)P[W]=z;F=j+1}for(let U=F;U<256;U++)P[U]=P[F-1];return P.join(",")},T=`g_${u(this,Qn)}_hcm_${e}_filter`,E=l.filter=w(this,Ui,jo).call(this,T);return w(this,yc,Lm).call(this,E),w(this,qs,nl).call(this,A(m[0],_[0],5),A(m[1],_[1],5),A(m[2],_[2],5),E),l.url=w(this,Li,Qo).call(this,T),l.url}destroy(e=!1){var n,i,o,r;e&&((n=u(this,Gs))!=null&&n.size)||((i=u(this,Zn))==null||i.parentNode.parentNode.remove(),v(this,Zn,null),(o=u(this,Nr))==null||o.clear(),v(this,Nr,null),(r=u(this,Gs))==null||r.clear(),v(this,Gs,null),v(this,Bs,0))}};$s=new WeakMap,Nr=new WeakMap,Zn=new WeakMap,Qn=new WeakMap,Yt=new WeakMap,Gs=new WeakMap,Bs=new WeakMap,Rt=new WeakSet,zt=function(){return u(this,Nr)||v(this,Nr,new Map)},Hs=new WeakSet,tl=function(){return u(this,Gs)||v(this,Gs,new Map)},Fi=new WeakSet,Zo=function(){if(!u(this,Zn)){let e=u(this,Yt).createElement("div"),{style:n}=e;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;let i=u(this,Yt).createElementNS($n,"svg");i.setAttribute("width",0),i.setAttribute("height",0),v(this,Zn,u(this,Yt).createElementNS($n,"defs")),e.append(i),i.append(u(this,Zn)),u(this,Yt).body.append(e)}return u(this,Zn)},kr=new WeakSet,Yd=function(e){if(e.length===1){let c=e[0],d=new Array(256);for(let g=0;g<256;g++)d[g]=c[g]/255;let p=d.join(",");return[p,p,p]}let[n,i,o]=e,r=new Array(256),a=new Array(256),l=new Array(256);for(let c=0;c<256;c++)r[c]=n[c]/255,a[c]=i[c]/255,l[c]=o[c]/255;return[r.join(","),a.join(","),l.join(",")]},Li=new WeakSet,Qo=function(e){if(u(this,$s)===void 0){v(this,$s,"");let n=u(this,Yt).URL;n!==u(this,Yt).baseURI&&(Dp(n)?Y('#createUrl: ignore "data:"-URL for performance reasons.'):v(this,$s,n.split("#",1)[0]))}return`url(${u(this,$s)}#${e})`},If=new WeakSet,oT=function(e){let n=u(this,Yt).createElementNS($n,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(n)},yc=new WeakSet,Lm=function(e){let n=u(this,Yt).createElementNS($n,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(n)},Ui=new WeakSet,jo=function(e){let n=u(this,Yt).createElementNS($n,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",e),u(this,Fi,Zo).append(n),n},Vs=new WeakSet,el=function(e,n,i){let o=u(this,Yt).createElementNS($n,n);o.setAttribute("type","discrete"),o.setAttribute("tableValues",i),e.append(o)},qs=new WeakSet,nl=function(e,n,i,o){let r=u(this,Yt).createElementNS($n,"feComponentTransfer");o.append(r),w(this,Vs,el).call(this,r,"feFuncR",e),w(this,Vs,el).call(this,r,"feFuncG",n),w(this,Vs,el).call(this,r,"feFuncB",i)},_c=new WeakSet,Um=function(e,n){let i=u(this,Yt).createElementNS($n,"feComponentTransfer");n.append(i),w(this,Vs,el).call(this,i,"feFuncA",e)},zs=new WeakSet,il=function(e){return u(this,Fi,Zo).style.color=e,C_(getComputedStyle(u(this,Fi,Zo)).getPropertyValue("color"))};var Sh=class{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");let e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){ot("Abstract method `_fetch` called.")}},bh=class extends Sh{async _fetch(t){let e=await kp(t,"arraybuffer");return new Uint8Array(e)}};Qt&&Y("Please use the `legacy` build in Node.js environments.");async function rT(s){let e=await process.getBuiltinModule("fs").promises.readFile(s);return new Uint8Array(e)}var Om=class extends Ch{},$m=class extends wh{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(zP.url)("@napi-rs/canvas").createCanvas(t,e)}},Gm=class extends Th{async _fetch(t){return rT(t)}},Bm=class extends Sh{async _fetch(t){return rT(t)}},Zt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Hm(s,t){if(!t)return;let e=t[2]-t[0],n=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],e,n),s.clip(i)}var Al=class{getPattern(){ot("Abstract method `getPattern` called.")}},Vm=class extends Al{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let n of this._colorStops)e.addColorStop(n[0],n[1]);return e}getPattern(t,e,n,i){let o;if(i===Zt.STROKE||i===Zt.FILL){let r=e.current.getClippedPathBoundingBox(i,ct(t))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,c=e.cachedCanvases.getCanvas("pattern",a,l),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-r[0],-r[1]),n=$.transform(n,[1,0,0,1,r[0],r[1]]),d.transform(...e.baseTransform),this.matrix&&d.transform(...this.matrix),Hm(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),o=t.createPattern(c.canvas,"no-repeat");let p=new DOMMatrix(n);o.setTransform(p)}else Hm(t,this._bbox),o=this._createGradient(t);return o}};function im(s,t,e,n,i,o,r,a){let l=t.coords,c=t.colors,d=s.data,p=s.width*4,g;l[e+1]>l[n+1]&&(g=e,e=n,n=g,g=o,o=r,r=g),l[n+1]>l[i+1]&&(g=n,n=i,i=g,g=r,r=a,a=g),l[e+1]>l[n+1]&&(g=e,e=n,n=g,g=o,o=r,r=g);let m=(l[e]+t.offsetX)*t.scaleX,_=(l[e+1]+t.offsetY)*t.scaleY,A=(l[n]+t.offsetX)*t.scaleX,T=(l[n+1]+t.offsetY)*t.scaleY,E=(l[i]+t.offsetX)*t.scaleX,C=(l[i+1]+t.offsetY)*t.scaleY;if(_>=C)return;let S=c[o],b=c[o+1],x=c[o+2],P=c[r],I=c[r+1],N=c[r+2],M=c[a],F=c[a+1],U=c[a+2],j=Math.round(_),z=Math.round(C),W,bt,k,B,ge,hn,Fn,Re;for(let Bt=j;Bt<=z;Bt++){if(Bt<T){let ut=Bt<_?0:(_-Bt)/(_-T);W=m-(m-A)*ut,bt=S-(S-P)*ut,k=b-(b-I)*ut,B=x-(x-N)*ut}else{let ut;Bt>C?ut=1:T===C?ut=0:ut=(T-Bt)/(T-C),W=A-(A-E)*ut,bt=P-(P-M)*ut,k=I-(I-F)*ut,B=N-(N-U)*ut}let Tt;Bt<_?Tt=0:Bt>C?Tt=1:Tt=(_-Bt)/(_-C),ge=m-(m-E)*Tt,hn=S-(S-M)*Tt,Fn=b-(b-F)*Tt,Re=x-(x-U)*Tt;let $o=Math.round(Math.min(W,ge)),Ga=Math.round(Math.max(W,ge)),He=p*Bt+$o*4;for(let ut=$o;ut<=Ga;ut++)Tt=(W-ut)/(W-ge),Tt<0?Tt=0:Tt>1&&(Tt=1),d[He++]=bt-(bt-hn)*Tt|0,d[He++]=k-(k-Fn)*Tt|0,d[He++]=B-(B-Re)*Tt|0,d[He++]=255}}function mP(s,t,e){let n=t.coords,i=t.colors,o,r;switch(t.type){case"lattice":let a=t.verticesPerRow,l=Math.floor(n.length/a)-1,c=a-1;for(o=0;o<l;o++){let d=o*a;for(let p=0;p<c;p++,d++)im(s,e,n[d],n[d+1],n[d+a],i[d],i[d+1],i[d+a]),im(s,e,n[d+a+1],n[d+1],n[d+a],i[d+a+1],i[d+1],i[d+a])}break;case"triangles":for(o=0,r=n.length;o<r;o+=3)im(s,e,n[o],n[o+1],n[o+2],i[o],i[o+1],i[o+2]);break;default:throw new Error("illegal figure")}}var qm=class extends Al{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[7],this._background=t[8],this.matrix=null}_createMeshCanvas(t,e,n){let a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,d=Math.ceil(this._bounds[3])-l,p=Math.min(Math.ceil(Math.abs(c*t[0]*1.1)),3e3),g=Math.min(Math.ceil(Math.abs(d*t[1]*1.1)),3e3),m=c/p,_=d/g,A={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/m,scaleY:1/_},T=p+2*2,E=g+2*2,C=n.getCanvas("mesh",T,E),S=C.context,b=S.createImageData(p,g);if(e){let P=b.data;for(let I=0,N=P.length;I<N;I+=4)P[I]=e[0],P[I+1]=e[1],P[I+2]=e[2],P[I+3]=255}for(let P of this._figures)mP(b,P,A);return S.putImageData(b,2,2),{canvas:C.canvas,offsetX:a-2*m,offsetY:l-2*_,scaleX:m,scaleY:_}}getPattern(t,e,n,i){Hm(t,this._bbox);let o;if(i===Zt.SHADING)o=$.singularValueDecompose2dScale(ct(t));else if(o=$.singularValueDecompose2dScale(e.baseTransform),this.matrix){let a=$.singularValueDecompose2dScale(this.matrix);o=[o[0]*a[0],o[1]*a[1]]}let r=this._createMeshCanvas(o,i===Zt.SHADING?null:this._background,e.cachedCanvases);return i!==Zt.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}},zm=class extends Al{getPattern(){return"hotpink"}};function yP(s){switch(s[0]){case"RadialAxial":return new Vm(s);case"Mesh":return new qm(s);case"Dummy":return new zm}throw new Error(`Unknown IR type: ${s[0]}`)}var hw={COLORED:1,UNCOLORED:2},Pf=class Pf{constructor(t,e,n,i,o){this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=e,this.ctx=n,this.canvasGraphicsFactory=i,this.baseTransform=o}createPatternCanvas(t){let{bbox:e,operatorList:n,paintType:i,tilingType:o,color:r,canvasGraphicsFactory:a}=this,{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),Mp("TilingType: "+o);let d=e[0],p=e[1],g=e[2],m=e[3],_=g-d,A=m-p,T=$.singularValueDecompose2dScale(this.matrix),E=$.singularValueDecompose2dScale(this.baseTransform),C=T[0]*E[0],S=T[1]*E[1],b=_,x=A,P=!1,I=!1,N=Math.ceil(l*C),M=Math.ceil(c*S),F=Math.ceil(_*C),U=Math.ceil(A*S);N>=F?b=l:P=!0,M>=U?x=c:I=!0;let j=this.getSizeAndScale(b,this.ctx.canvas.width,C),z=this.getSizeAndScale(x,this.ctx.canvas.height,S),W=t.cachedCanvases.getCanvas("pattern",j.size,z.size),bt=W.context,k=a.createCanvasGraphics(bt);if(k.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(k,i,r),bt.translate(-j.scale*d,-z.scale*p),k.transform(j.scale,0,0,z.scale,0,0),bt.save(),this.clipBbox(k,d,p,g,m),k.baseTransform=ct(k.ctx),k.executeOperatorList(n),k.endDrawing(),bt.restore(),P||I){let B=W.canvas;P&&(b=l),I&&(x=c);let ge=this.getSizeAndScale(b,this.ctx.canvas.width,C),hn=this.getSizeAndScale(x,this.ctx.canvas.height,S),Fn=ge.size,Re=hn.size,Bt=t.cachedCanvases.getCanvas("pattern-workaround",Fn,Re),Tt=Bt.context,$o=P?Math.floor(_/l):0,Ga=I?Math.floor(A/c):0;for(let He=0;He<=$o;He++)for(let ut=0;ut<=Ga;ut++)Tt.drawImage(B,Fn*He,Re*ut,Fn,Re,0,0,Fn,Re);return{canvas:Bt.canvas,scaleX:ge.scale,scaleY:hn.scale,offsetX:d,offsetY:p}}return{canvas:W.canvas,scaleX:j.scale,scaleY:z.scale,offsetX:d,offsetY:p}}getSizeAndScale(t,e,n){let i=Math.max(Pf.MAX_PATTERN_SIZE,e),o=Math.ceil(t*n);return o>=i?o=i:n=o/t,{scale:n,size:o}}clipBbox(t,e,n,i,o){let r=i-e,a=o-n;t.ctx.rect(e,n,r,a),t.current.updateRectMinMax(ct(t.ctx),[e,n,i,o]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,n){let i=t.ctx,o=t.current;switch(e){case hw.COLORED:let r=this.ctx;i.fillStyle=r.fillStyle,i.strokeStyle=r.strokeStyle,o.fillColor=r.fillStyle,o.strokeColor=r.strokeStyle;break;case hw.UNCOLORED:let a=$.makeHexColor(n[0],n[1],n[2]);i.fillStyle=a,i.strokeStyle=a,o.fillColor=a,o.strokeColor=a;break;default:throw new am(`Unsupported paint type: ${e}`)}}getPattern(t,e,n,i){let o=n;i!==Zt.SHADING&&(o=$.transform(o,e.baseTransform),this.matrix&&(o=$.transform(o,this.matrix)));let r=this.createPatternCanvas(e),a=new DOMMatrix(o);a=a.translate(r.offsetX,r.offsetY),a=a.scale(1/r.scaleX,1/r.scaleY);let l=t.createPattern(r.canvas,"repeat");return l.setTransform(a),l}};H(Pf,"MAX_PATTERN_SIZE",3e3);var Wm=Pf;function _P({src:s,srcPos:t=0,dest:e,width:n,height:i,nonBlackColor:o=4294967295,inverseDecode:r=!1}){let a=Gt.isLittleEndian?4278190080:255,[l,c]=r?[o,a]:[a,o],d=n>>3,p=n&7,g=s.length;e=new Uint32Array(e.buffer);let m=0;for(let _=0;_<i;_++){for(let T=t+d;t<T;t++){let E=t<g?s[t]:255;e[m++]=E&128?c:l,e[m++]=E&64?c:l,e[m++]=E&32?c:l,e[m++]=E&16?c:l,e[m++]=E&8?c:l,e[m++]=E&4?c:l,e[m++]=E&2?c:l,e[m++]=E&1?c:l}if(p===0)continue;let A=t<g?s[t++]:255;for(let T=0;T<p;T++)e[m++]=A&1<<7-T?c:l}return{srcPos:t,destPos:m}}var fw=16,pw=100,vP=15,gw=10,mw=1e3,pe=16;function AP(s,t){if(s._removeMirroring)throw new Error("Context is already forwarding operations.");s.__originalSave=s.save,s.__originalRestore=s.restore,s.__originalRotate=s.rotate,s.__originalScale=s.scale,s.__originalTranslate=s.translate,s.__originalTransform=s.transform,s.__originalSetTransform=s.setTransform,s.__originalResetTransform=s.resetTransform,s.__originalClip=s.clip,s.__originalMoveTo=s.moveTo,s.__originalLineTo=s.lineTo,s.__originalBezierCurveTo=s.bezierCurveTo,s.__originalRect=s.rect,s.__originalClosePath=s.closePath,s.__originalBeginPath=s.beginPath,s._removeMirroring=()=>{s.save=s.__originalSave,s.restore=s.__originalRestore,s.rotate=s.__originalRotate,s.scale=s.__originalScale,s.translate=s.__originalTranslate,s.transform=s.__originalTransform,s.setTransform=s.__originalSetTransform,s.resetTransform=s.__originalResetTransform,s.clip=s.__originalClip,s.moveTo=s.__originalMoveTo,s.lineTo=s.__originalLineTo,s.bezierCurveTo=s.__originalBezierCurveTo,s.rect=s.__originalRect,s.closePath=s.__originalClosePath,s.beginPath=s.__originalBeginPath,delete s._removeMirroring},s.save=function(){t.save(),this.__originalSave()},s.restore=function(){t.restore(),this.__originalRestore()},s.translate=function(n,i){t.translate(n,i),this.__originalTranslate(n,i)},s.scale=function(n,i){t.scale(n,i),this.__originalScale(n,i)},s.transform=function(n,i,o,r,a,l){t.transform(n,i,o,r,a,l),this.__originalTransform(n,i,o,r,a,l)},s.setTransform=function(n,i,o,r,a,l){t.setTransform(n,i,o,r,a,l),this.__originalSetTransform(n,i,o,r,a,l)},s.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},s.rotate=function(n){t.rotate(n),this.__originalRotate(n)},s.clip=function(n){t.clip(n),this.__originalClip(n)},s.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},s.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},s.bezierCurveTo=function(e,n,i,o,r,a){t.bezierCurveTo(e,n,i,o,r,a),this.__originalBezierCurveTo(e,n,i,o,r,a)},s.rect=function(e,n,i,o){t.rect(e,n,i,o),this.__originalRect(e,n,i,o)},s.closePath=function(){t.closePath(),this.__originalClosePath()},s.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}var Km=class{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,n){let i;return this.cache[t]!==void 0?(i=this.cache[t],this.canvasFactory.reset(i,e,n)):(i=this.canvasFactory.create(e,n),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(let t in this.cache){let e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}};function Dd(s,t,e,n,i,o,r,a,l,c){let[d,p,g,m,_,A]=ct(s);if(p===0&&g===0){let C=r*d+_,S=Math.round(C),b=a*m+A,x=Math.round(b),P=(r+l)*d+_,I=Math.abs(Math.round(P)-S)||1,N=(a+c)*m+A,M=Math.abs(Math.round(N)-x)||1;return s.setTransform(Math.sign(d),0,0,Math.sign(m),S,x),s.drawImage(t,e,n,i,o,0,0,I,M),s.setTransform(d,p,g,m,_,A),[I,M]}if(d===0&&m===0){let C=a*g+_,S=Math.round(C),b=r*p+A,x=Math.round(b),P=(a+c)*g+_,I=Math.abs(Math.round(P)-S)||1,N=(r+l)*p+A,M=Math.abs(Math.round(N)-x)||1;return s.setTransform(0,Math.sign(p),Math.sign(g),0,S,x),s.drawImage(t,e,n,i,o,0,0,M,I),s.setTransform(d,p,g,m,_,A),[M,I]}s.drawImage(t,e,n,i,o,r,a,l,c);let T=Math.hypot(d,p),E=Math.hypot(g,m);return[T*l,E*c]}function wP(s){let{width:t,height:e}=s;if(t>mw||e>mw)return null;let n=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),o=t+1,r=new Uint8Array(o*(e+1)),a,l,c,d=t+7&-8,p=new Uint8Array(d*e),g=0;for(let E of s.data){let C=128;for(;C>0;)p[g++]=E&C?0:255,C>>=1}let m=0;for(g=0,p[g]!==0&&(r[0]=1,++m),l=1;l<t;l++)p[g]!==p[g+1]&&(r[l]=p[g]?2:1,++m),g++;for(p[g]!==0&&(r[l]=2,++m),a=1;a<e;a++){g=a*d,c=a*o,p[g-d]!==p[g]&&(r[c]=p[g]?1:8,++m);let E=(p[g]?4:0)+(p[g-d]?8:0);for(l=1;l<t;l++)E=(E>>2)+(p[g+1]?4:0)+(p[g-d+1]?8:0),i[E]&&(r[c+l]=i[E],++m),g++;if(p[g-d]!==p[g]&&(r[c+l]=p[g]?2:4,++m),m>n)return null}for(g=d*(e-1),c=a*o,p[g]!==0&&(r[c]=8,++m),l=1;l<t;l++)p[g]!==p[g+1]&&(r[c+l]=p[g]?4:8,++m),g++;if(p[g]!==0&&(r[c+l]=4,++m),m>n)return null;let _=new Int32Array([0,o,-1,0,-o,0,0,0,1]),A=new Path2D;for(a=0;m&&a<=e;a++){let E=a*o,C=E+t;for(;E<C&&!r[E];)E++;if(E===C)continue;A.moveTo(E%o,a);let S=E,b=r[E];do{let x=_[b];do E+=x;while(!r[E]);let P=r[E];P!==5&&P!==10?(b=P,r[E]=0):(b=P&51*b>>4,r[E]&=b>>2|b<<2),A.lineTo(E%o,E/o|0),r[E]||--m}while(S!==E);--a}return p=null,r=null,function(E){E.save(),E.scale(1/t,-1/e),E.translate(0,-e),E.fill(A),E.beginPath(),E.restore()}}var xh=class{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Cw,this.textMatrixScale=1,this.fontMatrix=rm,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=qt.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){let t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}setCurrentPoint(t,e){this.x=t,this.y=e}updatePathMinMax(t,e,n){[e,n]=$.applyTransform([e,n],t),this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(t,e){let n=$.applyTransform(e,t),i=$.applyTransform(e.slice(2),t),o=$.applyTransform([e[0],e[3]],t),r=$.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,n[0],i[0],o[0],r[0]),this.minY=Math.min(this.minY,n[1],i[1],o[1],r[1]),this.maxX=Math.max(this.maxX,n[0],i[0],o[0],r[0]),this.maxY=Math.max(this.maxY,n[1],i[1],o[1],r[1])}updateScalingPathMinMax(t,e){$.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,n,i,o,r,a,l,c,d){let p=$.bezierBoundingBox(e,n,i,o,r,a,l,c,d);d||this.updateRectMinMax(t,p)}getPathBoundingBox(t=Zt.FILL,e=null){let n=[this.minX,this.minY,this.maxX,this.maxY];if(t===Zt.STROKE){e||ot("Stroke bounding box must include transform.");let i=$.singularValueDecompose2dScale(e),o=i[0]*this.lineWidth/2,r=i[1]*this.lineWidth/2;n[0]-=o,n[1]-=r,n[2]+=o,n[3]+=r}return n}updateClipFromPath(){let t=$.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=Zt.FILL,e=null){return $.intersect(this.clipBox,this.getPathBoundingBox(t,e))}};function yw(s,t){if(t instanceof ImageData){s.putImageData(t,0,0);return}let e=t.height,n=t.width,i=e%pe,o=(e-i)/pe,r=i===0?o:o+1,a=s.createImageData(n,pe),l=0,c,d=t.data,p=a.data,g,m,_,A;if(t.kind===Od.GRAYSCALE_1BPP){let T=d.byteLength,E=new Uint32Array(p.buffer,0,p.byteLength>>2),C=E.length,S=n+7>>3,b=4294967295,x=Gt.isLittleEndian?4278190080:255;for(g=0;g<r;g++){for(_=g<o?pe:i,c=0,m=0;m<_;m++){let P=T-l,I=0,N=P>S?n:P*8-7,M=N&-8,F=0,U=0;for(;I<M;I+=8)U=d[l++],E[c++]=U&128?b:x,E[c++]=U&64?b:x,E[c++]=U&32?b:x,E[c++]=U&16?b:x,E[c++]=U&8?b:x,E[c++]=U&4?b:x,E[c++]=U&2?b:x,E[c++]=U&1?b:x;for(;I<N;I++)F===0&&(U=d[l++],F=128),E[c++]=U&F?b:x,F>>=1}for(;c<C;)E[c++]=0;s.putImageData(a,0,g*pe)}}else if(t.kind===Od.RGBA_32BPP){for(m=0,A=n*pe*4,g=0;g<o;g++)p.set(d.subarray(l,l+A)),l+=A,s.putImageData(a,0,m),m+=pe;g<r&&(A=n*i*4,p.set(d.subarray(l,l+A)),s.putImageData(a,0,m))}else if(t.kind===Od.RGB_24BPP)for(_=pe,A=n*_,g=0;g<r;g++){for(g>=o&&(_=i,A=n*_),c=0,m=A;m--;)p[c++]=d[l++],p[c++]=d[l++],p[c++]=d[l++],p[c++]=255;s.putImageData(a,0,g*pe)}else throw new Error(`bad image kind: ${t.kind}`)}function _w(s,t){if(t.bitmap){s.drawImage(t.bitmap,0,0);return}let e=t.height,n=t.width,i=e%pe,o=(e-i)/pe,r=i===0?o:o+1,a=s.createImageData(n,pe),l=0,c=t.data,d=a.data;for(let p=0;p<r;p++){let g=p<o?pe:i;({srcPos:l}=_P({src:c,srcPos:l,dest:d,width:n,height:g,nonBlackColor:0})),s.putImageData(a,0,p*pe)}}function Ka(s,t){let e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let n of e)s[n]!==void 0&&(t[n]=s[n]);s.setLineDash!==void 0&&(t.setLineDash(s.getLineDash()),t.lineDashOffset=s.lineDashOffset)}function Fd(s){if(s.strokeStyle=s.fillStyle="#000000",s.fillRule="nonzero",s.globalAlpha=1,s.lineWidth=1,s.lineCap="butt",s.lineJoin="miter",s.miterLimit=10,s.globalCompositeOperation="source-over",s.font="10px sans-serif",s.setLineDash!==void 0&&(s.setLineDash([]),s.lineDashOffset=0),!Qt){let{filter:t}=s;t!=="none"&&t!==""&&(s.filter="none")}}function vw(s,t){if(t)return!0;let e=$.singularValueDecompose2dScale(s);e[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]);let n=Math.fround((globalThis.devicePixelRatio||1)*rs.PDF_TO_CSS_UNITS);return e[0]<=n&&e[1]<=n}var TP=["butt","round","square"],EP=["miter","round","bevel"],CP={},Aw={},vc,Ym,Ac,Jm,wc,Xm,x_=class x_{constructor(t,e,n,i,o,{optionalContentConfig:r,markedContentStack:a=null},l,c){y(this,vc);y(this,Ac);y(this,wc);this.ctx=t,this.current=new xh(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=n,this.canvasFactory=i,this.filterFactory=o,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new Km(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:n=!1,background:i=null}){let o=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,o,r),this.ctx.fillStyle=a,n){let l=this.cachedCanvases.getCanvas("transparent",o,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...ct(this.compositeCtx))}this.ctx.save(),Fd(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=ct(this.ctx)}executeOperatorList(t,e,n,i){let o=t.argsArray,r=t.fnArray,a=e||0,l=o.length;if(l===a)return a;let c=l-a>gw&&typeof n=="function",d=c?Date.now()+vP:0,p=0,g=this.commonObjs,m=this.objs,_;for(;;){if(i!==void 0&&a===i.nextBreakPoint)return i.breakIt(a,n),a;if(_=r[a],_!==Ye.dependency)this[_].apply(this,o[a]);else for(let A of o[a]){let T=A.startsWith("g_")?g:m;if(!T.has(A))return T.get(A,n),a}if(a++,a===l)return a;if(c&&++p>gw){if(Date.now()>d)return n(),a;p=0}}}endDrawing(){w(this,vc,Ym).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let t of this._cachedBitmapsMap.values()){for(let e of t.values())typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),w(this,Ac,Jm).call(this)}_scaleImage(t,e){var g,m;let n=(g=t.width)!=null?g:t.displayWidth,i=(m=t.height)!=null?m:t.displayHeight,o=Math.max(Math.hypot(e[0],e[1]),1),r=Math.max(Math.hypot(e[2],e[3]),1),a=n,l=i,c="prescale1",d,p;for(;o>2&&a>1||r>2&&l>1;){let _=a,A=l;o>2&&a>1&&(_=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),o/=a/_),r>2&&l>1&&(A=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/A),d=this.cachedCanvases.getCanvas(c,_,A),p=d.context,p.clearRect(0,0,_,A),p.drawImage(t,0,0,a,l,0,0,_,A),t=d.canvas,a=_,l=A,c=c==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:l}}_createMaskCanvas(t){let e=this.ctx,{width:n,height:i}=t,o=this.current.fillColor,r=this.current.patternFill,a=ct(e),l,c,d,p;if((t.bitmap||t.data)&&t.count>1){let N=t.bitmap||t.data.buffer;c=JSON.stringify(r?a:[a.slice(0,4),o]),l=this._cachedBitmapsMap.get(N),l||(l=new Map,this._cachedBitmapsMap.set(N,l));let M=l.get(c);if(M&&!r){let F=Math.round(Math.min(a[0],a[2])+a[4]),U=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:M,offsetX:F,offsetY:U}}d=M}d||(p=this.cachedCanvases.getCanvas("maskCanvas",n,i),_w(p.context,t));let g=$.transform(a,[1/n,0,0,-1/i,0,0]);g=$.transform(g,[1,0,0,1,0,-i]);let[m,_,A,T]=$.getAxialAlignedBoundingBox([0,0,n,i],g),E=Math.round(A-m)||1,C=Math.round(T-_)||1,S=this.cachedCanvases.getCanvas("fillCanvas",E,C),b=S.context,x=m,P=_;b.translate(-x,-P),b.transform(...g),d||(d=this._scaleImage(p.canvas,fn(b)),d=d.img,l&&r&&l.set(c,d)),b.imageSmoothingEnabled=vw(ct(b),t.interpolate),Dd(b,d,0,0,d.width,d.height,0,0,n,i),b.globalCompositeOperation="source-in";let I=$.transform(fn(b),[1,0,0,1,-x,-P]);return b.fillStyle=r?o.getPattern(e,this,I,Zt.FILL):o,b.fillRect(0,0,n,i),l&&!r&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,S.canvas)),{canvas:S.canvas,offsetX:Math.round(x),offsetY:Math.round(P)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=TP[t]}setLineJoin(t){this.ctx.lineJoin=EP[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){let n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(t),n.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(let[e,n]of t)switch(e){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let t=this.ctx.canvas.width,e=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(n,t,e);this.suspendedCtx=this.ctx,this.ctx=i.context;let o=this.ctx;o.setTransform(...ct(this.suspendedCtx)),Ka(this.suspendedCtx,o),AP(o,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Ka(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,n,i){let o=i[0],r=i[1],a=i[2]-o,l=i[3]-r;a===0||l===0||(this.genericComposeSMask(e.context,n,a,l,e.subtype,e.backdrop,e.transferMap,o,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}genericComposeSMask(t,e,n,i,o,r,a,l,c,d,p){let g=t.canvas,m=l-d,_=c-p;if(r){let T=$.makeHexColor(...r);if(m<0||_<0||m+n>g.width||_+i>g.height){let E=this.cachedCanvases.getCanvas("maskExtension",n,i),C=E.context;C.drawImage(g,-m,-_),C.globalCompositeOperation="destination-atop",C.fillStyle=T,C.fillRect(0,0,n,i),C.globalCompositeOperation="source-over",g=E.canvas,m=_=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);let E=new Path2D;E.rect(m,_,n,i),t.clip(E),t.globalCompositeOperation="destination-atop",t.fillStyle=T,t.fillRect(m,_,n,i),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),o==="Alpha"&&a?e.filter=this.filterFactory.addAlphaFilter(a):o==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(a));let A=new Path2D;A.rect(l,c,n,i),e.clip(A),e.globalCompositeOperation="destination-in",e.drawImage(g,m,_,n,i,l,c,n,i),e.restore()}save(){this.inSMaskMode?(Ka(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Ka(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(t,e,n,i,o,r){this.ctx.transform(t,e,n,i,o,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,n){let i=this.ctx,o=this.current,r=o.x,a=o.y,l,c,d=ct(i),p=d[0]===0&&d[3]===0||d[1]===0&&d[2]===0,g=p?n.slice(0):null;for(let m=0,_=0,A=t.length;m<A;m++)switch(t[m]|0){case Ye.rectangle:r=e[_++],a=e[_++];let T=e[_++],E=e[_++],C=r+T,S=a+E;i.moveTo(r,a),T===0||E===0?i.lineTo(C,S):(i.lineTo(C,a),i.lineTo(C,S),i.lineTo(r,S)),p||o.updateRectMinMax(d,[r,a,C,S]),i.closePath();break;case Ye.moveTo:r=e[_++],a=e[_++],i.moveTo(r,a),p||o.updatePathMinMax(d,r,a);break;case Ye.lineTo:r=e[_++],a=e[_++],i.lineTo(r,a),p||o.updatePathMinMax(d,r,a);break;case Ye.curveTo:l=r,c=a,r=e[_+4],a=e[_+5],i.bezierCurveTo(e[_],e[_+1],e[_+2],e[_+3],r,a),o.updateCurvePathMinMax(d,l,c,e[_],e[_+1],e[_+2],e[_+3],r,a,g),_+=6;break;case Ye.curveTo2:l=r,c=a,i.bezierCurveTo(r,a,e[_],e[_+1],e[_+2],e[_+3]),o.updateCurvePathMinMax(d,l,c,r,a,e[_],e[_+1],e[_+2],e[_+3],g),r=e[_+2],a=e[_+3],_+=4;break;case Ye.curveTo3:l=r,c=a,r=e[_+2],a=e[_+3],i.bezierCurveTo(e[_],e[_+1],r,a,r,a),o.updateCurvePathMinMax(d,l,c,e[_],e[_+1],r,a,r,a,g),_+=4;break;case Ye.closePath:i.closePath();break}p&&o.updateScalingPathMinMax(d,g),o.setCurrentPoint(r,a)}closePath(){this.ctx.closePath()}stroke(t=!0){let e=this.ctx,n=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof n=="object"&&(n!=null&&n.getPattern)?(e.save(),e.strokeStyle=n.getPattern(e,this,fn(e),Zt.STROKE),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(t=!0){let e=this.ctx,n=this.current.fillColor,i=this.current.patternFill,o=!1;i&&(e.save(),e.fillStyle=n.getPattern(e,this,fn(e),Zt.FILL),o=!0);let r=this.current.getClippedPathBoundingBox();this.contentVisible&&r!==null&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),o&&e.restore(),t&&this.consumePath(r)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=CP}eoClip(){this.pendingClip=Aw}beginText(){this.current.textMatrix=Cw,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let t=this.pendingTextPaths,e=this.ctx;if(t===void 0){e.beginPath();return}let n=new Path2D,i=e.getTransform().invertSelf();for(let{transform:o,x:r,y:a,fontSize:l,path:c}of t)n.addPath(c,new DOMMatrix(o).preMultiplySelf(i).translate(r,a).scale(l,-l));e.clip(n),e.beginPath(),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){var d;let n=this.commonObjs.get(t),i=this.current;if(!n)throw new Error(`Can't find font for ${t}`);if(i.fontMatrix=n.fontMatrix||rm,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&Y("Invalid font matrix for font "+t),e<0?(e=-e,i.fontDirection=-1):i.fontDirection=1,this.current.font=n,this.current.fontSize=e,n.isType3Font)return;let o=n.loadedName||"sans-serif",r=((d=n.systemFontInfo)==null?void 0:d.css)||`"${o}", ${n.fallbackName}`,a="normal";n.black?a="900":n.bold&&(a="bold");let l=n.italic?"italic":"normal",c=e;e<fw?c=fw:e>pw&&(c=pw),this.current.fontSizeScale=e/c,this.ctx.font=`${l} ${a} ${c}px ${r}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,n,i,o,r){this.current.textMatrix=[t,e,n,i,o,r],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,n,i,o){let r=this.ctx,a=this.current,l=a.font,c=a.textRenderingMode,d=a.fontSize/a.fontSizeScale,p=c&qt.FILL_STROKE_MASK,g=!!(c&qt.ADD_TO_PATH_FLAG),m=a.patternFill&&!l.missingFile,_=a.patternStroke&&!l.missingFile,A;if((l.disableFontFace||g||m||_)&&(A=l.getPathGenerator(this.commonObjs,t)),l.disableFontFace||m||_){if(r.save(),r.translate(e,n),r.scale(d,-d),p===qt.FILL||p===qt.FILL_STROKE)if(i){let T=r.getTransform();r.setTransform(...i),r.fill(w(this,wc,Xm).call(this,A,T,i))}else r.fill(A);if(p===qt.STROKE||p===qt.FILL_STROKE)if(o){let T=r.getTransform();r.setTransform(...o),r.stroke(w(this,wc,Xm).call(this,A,T,o))}else r.lineWidth/=d,r.stroke(A);r.restore()}else(p===qt.FILL||p===qt.FILL_STROKE)&&r.fillText(t,e,n),(p===qt.STROKE||p===qt.FILL_STROKE)&&r.strokeText(t,e,n);g&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:ct(r),x:e,y:n,fontSize:d,path:A})}get isFontSubpixelAAEnabled(){let{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);let e=t.getImageData(0,0,10,10).data,n=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){n=!0;break}return Z(this,"isFontSubpixelAAEnabled",n)}showText(t){let e=this.current,n=e.font;if(n.isType3Font)return this.showType3Text(t);let i=e.fontSize;if(i===0)return;let o=this.ctx,r=e.fontSizeScale,a=e.charSpacing,l=e.wordSpacing,c=e.fontDirection,d=e.textHScale*c,p=t.length,g=n.vertical,m=g?1:-1,_=n.defaultVMetrics,A=i*e.fontMatrix[0],T=e.textRenderingMode===qt.FILL&&!n.disableFontFace&&!e.patternFill;o.save(),o.transform(...e.textMatrix),o.translate(e.x,e.y+e.textRise),c>0?o.scale(d,-1):o.scale(d,1);let E,C;if(e.patternFill){o.save();let I=e.fillColor.getPattern(o,this,fn(o),Zt.FILL);E=ct(o),o.restore(),o.fillStyle=I}if(e.patternStroke){o.save();let I=e.strokeColor.getPattern(o,this,fn(o),Zt.STROKE);C=ct(o),o.restore(),o.strokeStyle=I}let S=e.lineWidth,b=e.textMatrixScale;if(b===0||S===0){let I=e.textRenderingMode&qt.FILL_STROKE_MASK;(I===qt.STROKE||I===qt.FILL_STROKE)&&(S=this.getSinglePixelWidth())}else S/=b;if(r!==1&&(o.scale(r,r),S/=r),o.lineWidth=S,n.isInvalidPDFjsFont){let I=[],N=0;for(let M of t)I.push(M.unicode),N+=M.width;o.fillText(I.join(""),0,0),e.x+=N*A*d,o.restore(),this.compose();return}let x=0,P;for(P=0;P<p;++P){let I=t[P];if(typeof I=="number"){x+=m*I*i/1e3;continue}let N=!1,M=(I.isSpace?l:0)+a,F=I.fontChar,U=I.accent,j,z,W=I.width;if(g){let k=I.vmetric||_,B=-(I.vmetric?k[1]:W*.5)*A,ge=k[2]*A;W=k?-k[0]:W,j=B/r,z=(x+ge)/r}else j=x/r,z=0;if(n.remeasure&&W>0){let k=o.measureText(F).width*1e3/i*r;if(W<k&&this.isFontSubpixelAAEnabled){let B=W/k;N=!0,o.save(),o.scale(B,1),j/=B}else W!==k&&(j+=(W-k)/2e3*i/r)}if(this.contentVisible&&(I.isInFont||n.missingFile)){if(T&&!U)o.fillText(F,j,z);else if(this.paintChar(F,j,z,E,C),U){let k=j+i*U.offset.x/r,B=z-i*U.offset.y/r;this.paintChar(U.fontChar,k,B,E,C)}}let bt=g?W*A-M*c:W*A+M*c;x+=bt,N&&o.restore()}g?e.y-=x:e.x+=x*d,o.restore(),this.compose()}showType3Text(t){let e=this.ctx,n=this.current,i=n.font,o=n.fontSize,r=n.fontDirection,a=i.vertical?1:-1,l=n.charSpacing,c=n.wordSpacing,d=n.textHScale*r,p=n.fontMatrix||rm,g=t.length,m=n.textRenderingMode===qt.INVISIBLE,_,A,T,E;if(!(m||o===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),e.transform(...n.textMatrix),e.translate(n.x,n.y),e.scale(d,r),_=0;_<g;++_){if(A=t[_],typeof A=="number"){E=a*A*o/1e3,this.ctx.translate(E,0),n.x+=E*d;continue}let C=(A.isSpace?c:0)+l,S=i.charProcOperatorList[A.operatorListId];if(!S){Y(`Type3 character "${A.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=A,this.save(),e.scale(o,o),e.transform(...p),this.executeOperatorList(S),this.restore()),T=$.applyTransform([A.width,0],p)[0]*o+C,e.translate(T,0),n.x+=T*d}e.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,n,i,o,r){this.ctx.rect(n,i,o-n,r-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){let n=t[1],i=this.baseTransform||ct(this.ctx),o={createCanvasGraphics:r=>new x_(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new Wm(t,n,this.ctx,o,i)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,n){this.ctx.strokeStyle=this.current.strokeColor=$.makeHexColor(t,e,n),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e,n){this.ctx.fillStyle=this.current.fillColor=$.makeHexColor(t,e,n),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let n;return this.cachedPatterns.has(t)?n=this.cachedPatterns.get(t):(n=yP(this.getObject(t)),this.cachedPatterns.set(t,n)),e&&(n.matrix=e),n}shadingFill(t){if(!this.contentVisible)return;let e=this.ctx;this.save();let n=this._getPattern(t);e.fillStyle=n.getPattern(e,this,fn(e),Zt.SHADING);let i=fn(e);if(i){let{width:o,height:r}=e.canvas,[a,l,c,d]=$.getAxialAlignedBoundingBox([0,0,o,r],i);this.ctx.fillRect(a,l,c-a,d-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){ot("Should not call beginInlineImage")}beginImageData(){ot("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=ct(this.ctx),e)){let n=e[2]-e[0],i=e[3]-e[1];this.ctx.rect(e[0],e[1],n,i),this.current.updateRectMinMax(ct(this.ctx),e),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let e=this.ctx;t.isolated||Mp("TODO: Support non-isolated groups."),t.knockout&&Y("Knockout groups not supported.");let n=ct(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let i=$.getAxialAlignedBoundingBox(t.bbox,ct(e)),o=[0,0,e.canvas.width,e.canvas.height];i=$.intersect(i,o)||[0,0,0,0];let r=Math.floor(i[0]),a=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-r,1),c=Math.max(Math.ceil(i[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,c]);let d="groupAt"+this.groupLevel;t.smask&&(d+="_smask_"+this.smaskCounter++%2);let p=this.cachedCanvases.getCanvas(d,l,c),g=p.context;g.translate(-r,-a),g.transform(...n),t.smask?this.smaskStack.push({canvas:p.canvas,context:g,offsetX:r,offsetY:a,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(r,a),e.save()),Ka(e,g),this.ctx=g,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;let e=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let i=ct(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);let o=$.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],i);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(t,e,n,i,o){if(w(this,vc,Ym).call(this),Fd(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){let r=e[2]-e[0],a=e[3]-e[1];if(o&&this.annotationCanvasMap){n=n.slice(),n[4]-=e[0],n[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=r,e[3]=a;let[l,c]=$.singularValueDecompose2dScale(ct(this.ctx)),{viewportScale:d}=this,p=Math.ceil(r*this.outputScaleX*d),g=Math.ceil(a*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(p,g);let{canvas:m,context:_}=this.annotationCanvas;this.annotationCanvasMap.set(t,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=_,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,a*c),Fd(this.ctx)}else Fd(this.ctx),this.endPath(),this.ctx.rect(e[0],e[1],r,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new xh(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),w(this,Ac,Jm).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;let e=t.count;t=this.getObject(t.data,t),t.count=e;let n=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=wP(t)),i.compiled)){i.compiled(n);return}let o=this._createMaskCanvas(t),r=o.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(r,o.offsetX,o.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,n=0,i=0,o,r){if(!this.contentVisible)return;t=this.getObject(t.data,t);let a=this.ctx;a.save();let l=ct(a);a.transform(e,n,i,o,0,0);let c=this._createMaskCanvas(t);a.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let d=0,p=r.length;d<p;d+=2){let g=$.transform(l,[e,n,i,o,r[d],r[d+1]]),[m,_]=$.applyTransform([0,0],g);a.drawImage(c.canvas,m,_)}a.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;let e=this.ctx,n=this.current.fillColor,i=this.current.patternFill;for(let o of t){let{data:r,width:a,height:l,transform:c}=o,d=this.cachedCanvases.getCanvas("maskCanvas",a,l),p=d.context;p.save();let g=this.getObject(r,o);_w(p,g),p.globalCompositeOperation="source-in",p.fillStyle=i?n.getPattern(p,this,fn(e),Zt.FILL):n,p.fillRect(0,0,a,l),p.restore(),e.save(),e.transform(...c),e.scale(1,-1),Dd(e,d.canvas,0,0,a,l,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;let e=this.getObject(t);if(!e){Y("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,n,i){if(!this.contentVisible)return;let o=this.getObject(t);if(!o){Y("Dependent image isn't ready yet");return}let r=o.width,a=o.height,l=[];for(let c=0,d=i.length;c<d;c+=2)l.push({transform:[e,0,0,n,i[c],i[c+1]],x:0,y:0,w:r,h:a});this.paintInlineImageXObjectGroup(o,l)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;let{bitmap:e,width:n,height:i}=t,o=this.cachedCanvases.getCanvas("inlineImage",n,i),r=o.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",o.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;let e=t.width,n=t.height,i=this.ctx;if(this.save(),!Qt){let{filter:a}=i;a!=="none"&&a!==""&&(i.filter="none")}i.scale(1/e,-1/n);let o;if(t.bitmap)o=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)o=t;else{let l=this.cachedCanvases.getCanvas("inlineImage",e,n).context;yw(l,t),o=this.applyTransferMapsToCanvas(l)}let r=this._scaleImage(o,fn(i));i.imageSmoothingEnabled=vw(ct(i),t.interpolate),Dd(i,r.img,0,0,r.paintWidth,r.paintHeight,0,-n,e,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;let n=this.ctx,i;if(t.bitmap)i=t.bitmap;else{let o=t.width,r=t.height,l=this.cachedCanvases.getCanvas("inlineImage",o,r).context;yw(l,t),i=this.applyTransferMapsToCanvas(l)}for(let o of e)n.save(),n.transform(...o.transform),n.scale(1,-1),Dd(n,i,o.x,o.y,o.w,o.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){let e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);let n=this.ctx;this.pendingClip&&(e||(this.pendingClip===Aw?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let t=ct(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{let e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:t}=this.current,{a:e,b:n,c:i,d:o}=this.ctx.getTransform(),r,a;if(n===0&&i===0){let l=Math.abs(e),c=Math.abs(o);if(l===c)if(t===0)r=a=1/l;else{let d=l*t;r=a=d<1?1/d:1}else if(t===0)r=1/l,a=1/c;else{let d=l*t,p=c*t;r=d<1?1/d:1,a=p<1?1/p:1}}else{let l=Math.abs(e*o-n*i),c=Math.hypot(e,n),d=Math.hypot(i,o);if(t===0)r=d/l,a=c/l;else{let p=t*l;r=d>p?d/p:1,a=c>p?c/p:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t){let{ctx:e}=this,{lineWidth:n}=this.current,[i,o]=this.getScaleForStroking();if(e.lineWidth=n||1,i===1&&o===1){e.stroke();return}let r=e.getLineDash();if(t&&e.save(),e.scale(i,o),r.length>0){let a=Math.max(i,o);e.setLineDash(r.map(l=>l/a)),e.lineDashOffset/=a}e.stroke(),t&&e.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};vc=new WeakSet,Ym=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Ac=new WeakSet,Jm=function(){if(this.pageColors){let t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){let e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}},wc=new WeakSet,Xm=function(t,e,n){let i=new Path2D;return i.addPath(t,new DOMMatrix(n).invertSelf().multiplySelf(e)),i};var rr=x_;for(let s in Ye)rr.prototype[s]!==void 0&&(rr.prototype[Ye[s]]=rr.prototype[s]);var Tc,Ec,un=class{static get workerPort(){return u(this,Tc)}static set workerPort(t){if(!(typeof Worker!="undefined"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");v(this,Tc,t)}static get workerSrc(){return u(this,Ec)}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");v(this,Ec,t)}};Tc=new WeakMap,Ec=new WeakMap,y(un,Tc,null),y(un,Ec,"");var Ws,Cc,Zm=class{constructor({parsedData:t,rawData:e}){y(this,Ws,void 0);y(this,Cc,void 0);v(this,Ws,t),v(this,Cc,e)}getRaw(){return u(this,Cc)}get(t){var e;return(e=u(this,Ws).get(t))!=null?e:null}getAll(){return w_(u(this,Ws))}has(t){return u(this,Ws).has(t)}};Ws=new WeakMap,Cc=new WeakMap;var tr=Symbol("INTERNAL"),Sc,bc,xc,Dr,Qm=class{constructor(t,{name:e,intent:n,usage:i,rbGroups:o}){y(this,Sc,!1);y(this,bc,!1);y(this,xc,!1);y(this,Dr,!0);v(this,Sc,!!(t&Ie.DISPLAY)),v(this,bc,!!(t&Ie.PRINT)),this.name=e,this.intent=n,this.usage=i,this.rbGroups=o}get visible(){if(u(this,xc))return u(this,Dr);if(!u(this,Dr))return!1;let{print:t,view:e}=this.usage;return u(this,Sc)?(e==null?void 0:e.viewState)!=="OFF":u(this,bc)?(t==null?void 0:t.printState)!=="OFF":!0}_setVisible(t,e,n=!1){t!==tr&&ot("Internal method `_setVisible` called."),v(this,xc,n),v(this,Dr,e)}};Sc=new WeakMap,bc=new WeakMap,xc=new WeakMap,Dr=new WeakMap;var Oi,it,Fr,Lr,Ic,ty,jm=class{constructor(t,e=Ie.DISPLAY){y(this,Ic);y(this,Oi,null);y(this,it,new Map);y(this,Fr,null);y(this,Lr,null);if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,v(this,Lr,t.order);for(let n of t.groups)u(this,it).set(n.id,new Qm(e,n));if(t.baseState==="OFF")for(let n of u(this,it).values())n._setVisible(tr,!1);for(let n of t.on)u(this,it).get(n)._setVisible(tr,!0);for(let n of t.off)u(this,it).get(n)._setVisible(tr,!1);v(this,Fr,this.getHash())}}isVisible(t){if(u(this,it).size===0)return!0;if(!t)return Mp("Optional content group not defined."),!0;if(t.type==="OCG")return u(this,it).has(t.id)?u(this,it).get(t.id).visible:(Y(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return w(this,Ic,ty).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(let e of t.ids){if(!u(this,it).has(e))return Y(`Optional content group not found: ${e}`),!0;if(u(this,it).get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(let e of t.ids){if(!u(this,it).has(e))return Y(`Optional content group not found: ${e}`),!0;if(!u(this,it).get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(let e of t.ids){if(!u(this,it).has(e))return Y(`Optional content group not found: ${e}`),!0;if(!u(this,it).get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(let e of t.ids){if(!u(this,it).has(e))return Y(`Optional content group not found: ${e}`),!0;if(u(this,it).get(e).visible)return!1}return!0}return Y(`Unknown optional content policy ${t.policy}.`),!0}return Y(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,n=!0){var o;let i=u(this,it).get(t);if(!i){Y(`Optional content group not found: ${t}`);return}if(n&&e&&i.rbGroups.length)for(let r of i.rbGroups)for(let a of r)a!==t&&((o=u(this,it).get(a))==null||o._setVisible(tr,!1,!0));i._setVisible(tr,!!e,!0),v(this,Oi,null)}setOCGState({state:t,preserveRB:e}){let n;for(let i of t){switch(i){case"ON":case"OFF":case"Toggle":n=i;continue}let o=u(this,it).get(i);if(o)switch(n){case"ON":this.setVisibility(i,!0,e);break;case"OFF":this.setVisibility(i,!1,e);break;case"Toggle":this.setVisibility(i,!o.visible,e);break}}v(this,Oi,null)}get hasInitialVisibility(){return u(this,Fr)===null||this.getHash()===u(this,Fr)}getOrder(){return u(this,it).size?u(this,Lr)?u(this,Lr).slice():[...u(this,it).keys()]:null}getGroups(){return u(this,it).size>0?w_(u(this,it)):null}getGroup(t){return u(this,it).get(t)||null}getHash(){if(u(this,Oi)!==null)return u(this,Oi);let t=new vh;for(let[e,n]of u(this,it))t.update(`${e}:${n.visible}`);return v(this,Oi,t.hexdigest())}};Oi=new WeakMap,it=new WeakMap,Fr=new WeakMap,Lr=new WeakMap,Ic=new WeakSet,ty=function(t){let e=t.length;if(e<2)return!0;let n=t[0];for(let i=1;i<e;i++){let o=t[i],r;if(Array.isArray(o))r=w(this,Ic,ty).call(this,o);else if(u(this,it).has(o))r=u(this,it).get(o).visible;else return Y(`Optional content group not found: ${o}`),!0;switch(n){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return n==="And"};var ey=class{constructor(t,{disableRange:e=!1,disableStream:n=!1}){wt(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:i,initialData:o,progressiveDone:r,contentDispositionFilename:a}=t;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=a,(o==null?void 0:o.length)>0){let l=o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!n,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),t.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){let n=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{let i=this._rangeReaders.some(function(o){return o._begin!==t?!1:(o._enqueue(n),!0)});wt(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var t,e;return(e=(t=this._fullRequestReader)==null?void 0:t._loaded)!=null?e:0}_onProgress(t){var e,n,i,o;t.total===void 0?(n=(e=this._rangeReaders[0])==null?void 0:e.onProgress)==null||n.call(e,{loaded:t.loaded}):(o=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||o.call(i,{loaded:t.loaded,total:t.total})}_onProgressiveDone(){var t;(t=this._fullRequestReader)==null||t.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){let e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){wt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let t=this._queuedChunks;return this._queuedChunks=null,new ny(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;let n=new iy(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(let n of this._rangeReaders.slice(0))n.cancel(t);this._pdfDataRangeTransport.abort()}},ny=class{constructor(t,e,n=!1,i=null){this._stream=t,this._done=n||!1,this._filename=E_(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(let o of this._queuedChunks)this._loaded+=o.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},iy=class{constructor(t,e,n){this._stream=t,this._begin=e,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function SP(s){let t=!0,e=n("filename\\*","i").exec(s);if(e){e=e[1];let d=a(e);return d=unescape(d),d=l(d),d=c(d),o(d)}if(e=r(s),e){let d=c(e);return o(d)}if(e=n("filename","i").exec(s),e){e=e[1];let d=a(e);return d=c(d),o(d)}function n(d,p){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',p)}function i(d,p){if(d){if(!/^[\x00-\xFF]+$/.test(p))return p;try{let g=new TextDecoder(d,{fatal:!0}),m=Np(p);p=g.decode(m),t=!1}catch(g){}}return p}function o(d){return t&&/[\x80-\xff]/.test(d)&&(d=i("utf-8",d),t&&(d=i("iso-8859-1",d))),d}function r(d){let p=[],g,m=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(g=m.exec(d))!==null;){let[,A,T,E]=g;if(A=parseInt(A,10),A in p){if(A===0)break;continue}p[A]=[T,E]}let _=[];for(let A=0;A<p.length&&A in p;++A){let[T,E]=p[A];E=a(E),T&&(E=unescape(E),A===0&&(E=l(E))),_.push(E)}return _.join("")}function a(d){if(d.startsWith('"')){let p=d.slice(1).split('\\"');for(let g=0;g<p.length;++g){let m=p[g].indexOf('"');m!==-1&&(p[g]=p[g].slice(0,m),p.length=g+1),p[g]=p[g].replaceAll(/\\(.)/g,"$1")}d=p.join('"')}return d}function l(d){let p=d.indexOf("'");if(p===-1)return d;let g=d.slice(0,p),_=d.slice(p+1).replace(/^[^']*'/,"");return i(g,_)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(p,g,m,_){if(m==="q"||m==="Q")return _=_.replaceAll("_"," "),_=_.replaceAll(/=([0-9a-fA-F]{2})/g,function(A,T){return String.fromCharCode(parseInt(T,16))}),i(g,_);try{_=atob(_)}catch(A){}return i(g,_)})}return""}function aT(s,t){let e=new Headers;if(!s||!t||typeof t!="object")return e;for(let n in t){let i=t[n];i!==void 0&&e.append(n,i)}return e}function Fp(s){try{return new URL(s).origin}catch(t){}return null}function lT({responseHeaders:s,isHttp:t,rangeChunkSize:e,disableRange:n}){let i={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(s.get("Content-Length"),10);return!Number.isInteger(o)||(i.suggestedLength=o,o<=2*e)||n||!t||s.get("Accept-Ranges")!=="bytes"||(s.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function cT(s){let t=s.get("Content-Disposition");if(t){let e=SP(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch(n){}if(E_(e))return e}return null}function Lp(s,t){return s===404||s===0&&t.startsWith("file:")?new Do('Missing PDF "'+t+'".'):new Oa(`Unexpected server response (${s}) while retrieving PDF "${t}".`,s)}function uT(s){return s===200||s===206}function dT(s,t,e){return{method:"GET",headers:s,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function hT(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:(Y(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}var Ih=class{constructor(t){H(this,"_responseOrigin",null);this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=aT(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t,e;return(e=(t=this._fullRequestReader)==null?void 0:t._loaded)!=null?e:0}getFullReader(){return wt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new sy(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;let n=new oy(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(let n of this._rangeRequestReaders.slice(0))n.cancel(t)}},sy=class{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;let e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;let n=new Headers(t.headers),i=e.url;fetch(i,dT(n,this._withCredentials,this._abortController)).then(o=>{if(t._responseOrigin=Fp(o.url),!uT(o.status))throw Lp(o.status,i);this._reader=o.body.getReader(),this._headersCapability.resolve();let r=o.headers,{allowRangeRequests:a,suggestedLength:l}=lT({responseHeaders:r,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=cT(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Dn("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;let{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:hT(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}},oy=class{constructor(t,e,n){this._stream=t,this._reader=null,this._loaded=0;let i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;let o=new Headers(t.headers);o.append("Range",`bytes=${e}-${n-1}`);let r=i.url;fetch(r,dT(o,this._withCredentials,this._abortController)).then(a=>{let l=Fp(a.url);if(l!==t._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${t._responseOrigin}".`);if(!uT(a.status))throw Lp(a.status,r);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;let{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:hT(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}},sm=200,om=206;function bP(s){let t=s.response;return typeof t!="string"?t:Np(t).buffer}var ry=class{constructor({url:t,httpHeaders:e,withCredentials:n}){H(this,"_responseOrigin",null);this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=aT(this.isHttp,e),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){let e=new XMLHttpRequest,n=this.currXhrId++,i=this.pendingRequests[n]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(let[o,r]of this.headers)e.setRequestHeader(o,r);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=om):i.expectedStatus=sm,e.responseType="arraybuffer",wt(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),n}onProgress(t,e){var i;let n=this.pendingRequests[t];n&&((i=n.onProgress)==null||i.call(n,e))}onStateChange(t,e){let n=this.pendingRequests[t];if(!n)return;let i=n.xhr;if(i.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),i.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],i.status===0&&this.isHttp){n.onError(i.status);return}let o=i.status||sm;if(!(o===sm&&n.expectedStatus===om)&&o!==n.expectedStatus){n.onError(i.status);return}let a=bP(i);if(o===om){let l=i.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?n.onDone({begin:parseInt(c[1],10),chunk:a}):(Y('Missing or invalid "Content-Range" header.'),n.onError(0))}else a?n.onDone({begin:0,chunk:a}):n.onError(i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){let e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}},ay=class{constructor(t){this._source=t,this._manager=new ry(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){let e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return wt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new ly(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){let n=new cy(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(let n of this._rangeRequestReaders.slice(0))n.cancel(t)}},ly=class{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Fp(e.responseURL);let n=e.getAllResponseHeaders(),i=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{let[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:o,suggestedLength:r}=lT({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});o&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=cT(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Lp(t,this._url),this._headersCapability.reject(this._storedError);for(let e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){var e;(e=this.onProgress)==null||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},cy=class{constructor(t,e,n){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var e;let t=Fp((e=this._manager.getRequestXhr(this._requestId))==null?void 0:e.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var t;(t=this.onClosed)==null||t.call(this,this)}_onDone(t){let e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){var e;(e=this._storedError)!=null||(this._storedError=Lp(t,this._url));for(let n of this._requests)n.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){var e;this.isStreamingSupported||(e=this.onProgress)==null||e.call(this,{loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},xP=/^[a-z][a-z0-9\-+.]+:/i;function IP(s){if(xP.test(s))return new URL(s);let t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(s))}var uy=class{constructor(t){this.source=t,this.url=IP(t.url),wt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t,e;return(e=(t=this._fullRequestReader)==null?void 0:t._loaded)!=null?e:0}getFullReader(){return wt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new dy(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;let n=new hy(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(let n of this._rangeRequestReaders.slice(0))n.cancel(t)}},dy=class{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;let e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=new Do(`Missing PDF "${this._url}".`)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Dn("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},hy=class{constructor(t,e,n){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let i=t.source;this._isStreamingSupported=!i.disableStream;let o=process.getBuiltinModule("fs");this._setReadableStream(o.createReadStream(this._url,{start:e,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}},PP=1e5,le=30,RP=.8,Ew,$i,he,Pc,Rc,Ks,jn,Mc,Nc,Ys,Ur,Or,Gi,$r,kc,Gr,Js,Dc,Fc,Xs,Zs,Lc,Bi,Br,Rf,fT,Mf,pT,Uc,fy,Hr,Jd,Oc,py,Nf,gT,kf,mT,pt=class pt{constructor({textContentSource:t,container:e,viewport:n}){y(this,Rf);y(this,Mf);y(this,Uc);y(this,$i,Promise.withResolvers());y(this,he,null);y(this,Pc,!1);y(this,Rc,!!((Ew=globalThis.FontInspector)!=null&&Ew.enabled));y(this,Ks,null);y(this,jn,null);y(this,Mc,0);y(this,Nc,0);y(this,Ys,null);y(this,Ur,null);y(this,Or,0);y(this,Gi,0);y(this,$r,Object.create(null));y(this,kc,[]);y(this,Gr,null);y(this,Js,[]);y(this,Dc,new WeakMap);y(this,Fc,null);var l;if(t instanceof ReadableStream)v(this,Gr,t);else if(typeof t=="object")v(this,Gr,new ReadableStream({start(c){c.enqueue(t),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');v(this,he,v(this,Ur,e)),v(this,Gi,n.scale*(globalThis.devicePixelRatio||1)),v(this,Or,n.rotation),v(this,jn,{div:null,properties:null,ctx:null});let{pageWidth:i,pageHeight:o,pageX:r,pageY:a}=n.rawDims;v(this,Fc,[1,0,0,-1,-r,a+o]),v(this,Nc,i),v(this,Mc,o),w(l=pt,Nf,gT).call(l),Fo(e,n),u(this,$i).promise.finally(()=>{u(pt,Br).delete(this),v(this,jn,null),v(this,$r,null)}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:t,isFirefox:e}=Gt.platform;return Z(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){let t=()=>{u(this,Ys).read().then(({value:e,done:n})=>{var i;if(n){u(this,$i).resolve();return}(i=u(this,Ks))!=null||v(this,Ks,e.lang),Object.assign(u(this,$r),e.styles),w(this,Rf,fT).call(this,e.items),t()},u(this,$i).reject)};return v(this,Ys,u(this,Gr).getReader()),u(pt,Br).add(this),t(),u(this,$i).promise}update({viewport:t,onBefore:e=null}){var o;let n=t.scale*(globalThis.devicePixelRatio||1),i=t.rotation;if(i!==u(this,Or)&&(e==null||e(),v(this,Or,i),Fo(u(this,Ur),{rotation:i})),n!==u(this,Gi)){e==null||e(),v(this,Gi,n);let r={div:null,properties:null,ctx:w(o=pt,Hr,Jd).call(o,u(this,Ks))};for(let a of u(this,Js))r.properties=u(this,Dc).get(a),r.div=a,w(this,Uc,fy).call(this,r)}}cancel(){var e;let t=new Dn("TextLayer task cancelled.");(e=u(this,Ys))==null||e.cancel(t).catch(()=>{}),v(this,Ys,null),u(this,$i).reject(t)}get textDivs(){return u(this,Js)}get textContentItemsStr(){return u(this,kc)}static cleanup(){if(!(u(this,Br).size>0)){u(this,Xs).clear();for(let{canvas:t}of u(this,Zs).values())t.remove();u(this,Zs).clear()}}};$i=new WeakMap,he=new WeakMap,Pc=new WeakMap,Rc=new WeakMap,Ks=new WeakMap,jn=new WeakMap,Mc=new WeakMap,Nc=new WeakMap,Ys=new WeakMap,Ur=new WeakMap,Or=new WeakMap,Gi=new WeakMap,$r=new WeakMap,kc=new WeakMap,Gr=new WeakMap,Js=new WeakMap,Dc=new WeakMap,Fc=new WeakMap,Xs=new WeakMap,Zs=new WeakMap,Lc=new WeakMap,Bi=new WeakMap,Br=new WeakMap,Rf=new WeakSet,fT=function(t){var i,o,r;if(u(this,Pc))return;(r=(o=u(this,jn)).ctx)!=null||(o.ctx=w(i=pt,Hr,Jd).call(i,u(this,Ks)));let e=u(this,Js),n=u(this,kc);for(let a of t){if(e.length>PP){Y("Ignoring additional textDivs for performance reasons."),v(this,Pc,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){let l=u(this,he);v(this,he,document.createElement("span")),u(this,he).classList.add("markedContent"),a.id!==null&&u(this,he).setAttribute("id",`${a.id}`),l.append(u(this,he))}else a.type==="endMarkedContent"&&v(this,he,u(this,he).parentNode);continue}n.push(a.str),w(this,Mf,pT).call(this,a)}},Mf=new WeakSet,pT=function(t){var A;let e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};u(this,Js).push(e);let i=$.transform(u(this,Fc),t.transform),o=Math.atan2(i[1],i[0]),r=u(this,$r)[t.fontName];r.vertical&&(o+=Math.PI/2);let a=u(this,Rc)&&r.fontSubstitution||r.fontFamily;a=pt.fontFamilyMap.get(a)||a;let l=Math.hypot(i[2],i[3]),c=l*w(A=pt,kf,mT).call(A,a,u(this,Ks)),d,p;o===0?(d=i[4],p=i[5]-c):(d=i[4]+c*Math.sin(o),p=i[5]-c*Math.cos(o));let g="calc(var(--scale-factor)*",m=e.style;u(this,he)===u(this,Ur)?(m.left=`${(100*d/u(this,Nc)).toFixed(2)}%`,m.top=`${(100*p/u(this,Mc)).toFixed(2)}%`):(m.left=`${g}${d.toFixed(2)}px)`,m.top=`${g}${p.toFixed(2)}px)`),m.fontSize=`${g}${(u(pt,Bi)*l).toFixed(2)}px)`,m.fontFamily=a,n.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,u(this,Rc)&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),o!==0&&(n.angle=o*(180/Math.PI));let _=!1;if(t.str.length>1)_=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){let T=Math.abs(t.transform[0]),E=Math.abs(t.transform[3]);T!==E&&Math.max(T,E)/Math.min(T,E)>1.5&&(_=!0)}if(_&&(n.canvasWidth=r.vertical?t.height:t.width),u(this,Dc).set(e,n),u(this,jn).div=e,u(this,jn).properties=n,w(this,Uc,fy).call(this,u(this,jn)),n.hasText&&u(this,he).append(e),n.hasEOL){let T=document.createElement("br");T.setAttribute("role","presentation"),u(this,he).append(T)}},Uc=new WeakSet,fy=function(t){var a;let{div:e,properties:n,ctx:i}=t,{style:o}=e,r="";if(u(pt,Bi)>1&&(r=`scale(${1/u(pt,Bi)})`),n.canvasWidth!==0&&n.hasText){let{fontFamily:l}=o,{canvasWidth:c,fontSize:d}=n;w(a=pt,Oc,py).call(a,i,d*u(this,Gi),l);let{width:p}=i.measureText(e.textContent);p>0&&(r=`scaleX(${c*u(this,Gi)/p}) ${r}`)}n.angle!==0&&(r=`rotate(${n.angle}deg) ${r}`),r.length>0&&(o.transform=r)},Hr=new WeakSet,Jd=function(t=null){let e=u(this,Zs).get(t||(t=""));if(!e){let n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),u(this,Zs).set(t,e),u(this,Lc).set(e,{size:0,family:""})}return e},Oc=new WeakSet,py=function(t,e,n){let i=u(this,Lc).get(t);e===i.size&&n===i.family||(t.font=`${e}px ${n}`,i.size=e,i.family=n)},Nf=new WeakSet,gT=function(){if(u(this,Bi)!==null)return;let t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),v(this,Bi,t.getBoundingClientRect().height),t.remove()},kf=new WeakSet,mT=function(t,e){let n=u(this,Xs).get(t);if(n)return n;let i=w(this,Hr,Jd).call(this,e);i.canvas.width=i.canvas.height=le,w(this,Oc,py).call(this,i,le,t);let o=i.measureText(""),r=o.fontBoundingBoxAscent,a=Math.abs(o.fontBoundingBoxDescent);if(r){let d=r/(r+a);return u(this,Xs).set(t,d),i.canvas.width=i.canvas.height=0,d}i.strokeStyle="red",i.clearRect(0,0,le,le),i.strokeText("g",0,0);let l=i.getImageData(0,0,le,le).data;a=0;for(let d=l.length-1-3;d>=0;d-=4)if(l[d]>0){a=Math.ceil(d/4/le);break}i.clearRect(0,0,le,le),i.strokeText("A",0,le),l=i.getImageData(0,0,le,le).data,r=0;for(let d=0,p=l.length;d<p;d+=4)if(l[d]>0){r=le-Math.floor(d/4/le);break}i.canvas.width=i.canvas.height=0;let c=r?r/(r+a):RP;return u(this,Xs).set(t,c),c},y(pt,Hr),y(pt,Oc),y(pt,Nf),y(pt,kf),y(pt,Xs,new Map),y(pt,Zs,new Map),y(pt,Lc,new WeakMap),y(pt,Bi,null),y(pt,Br,new Set);var wl=pt,Tl=class s{static textContent(t){let e=[],n={items:e,styles:Object.create(null)};function i(o){var l;if(!o)return;let r=null,a=o.name;if(a==="#text")r=o.value;else if(s.shouldBuildText(a))(l=o==null?void 0:o.attributes)!=null&&l.textContent?r=o.attributes.textContent:o.value&&(r=o.value);else return;if(r!==null&&e.push({str:r}),!!o.children)for(let c of o.children)i(c)}return i(t),n}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}},MP=65536,NP=100,kP=5e3,DP=Qt?$m:Dm,FP=Qt?Gm:Eh,LP=Qt?Om:Fm,UP=Qt?Bm:bh;function OP(s={}){var He,ut;typeof s=="string"||s instanceof URL?s={url:s}:(s instanceof ArrayBuffer||ArrayBuffer.isView(s))&&(s={data:s});let t=new gy,{docId:e}=t,n=s.url?$P(s.url):null,i=s.data?GP(s.data):null,o=s.httpHeaders||null,r=s.withCredentials===!0,a=(He=s.password)!=null?He:null,l=s.range instanceof Ph?s.range:null,c=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:MP,d=s.worker instanceof ar?s.worker:null,p=s.verbosity,g=typeof s.docBaseUrl=="string"&&!Dp(s.docBaseUrl)?s.docBaseUrl:null,m=typeof s.cMapUrl=="string"?s.cMapUrl:null,_=s.cMapPacked!==!1,A=s.CMapReaderFactory||FP,T=typeof s.standardFontDataUrl=="string"?s.standardFontDataUrl:null,E=s.StandardFontDataFactory||UP,C=s.stopAtErrors!==!0,S=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,b=s.isEvalSupported!==!1,x=typeof s.isOffscreenCanvasSupported=="boolean"?s.isOffscreenCanvasSupported:!Qt,P=typeof s.isImageDecoderSupported=="boolean"?s.isImageDecoderSupported:!Qt&&(Gt.platform.isFirefox||!globalThis.chrome),I=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,N=typeof s.disableFontFace=="boolean"?s.disableFontFace:Qt,M=s.fontExtraProperties===!0,F=s.enableXfa===!0,U=s.ownerDocument||globalThis.document,j=s.disableRange===!0,z=s.disableStream===!0,W=s.disableAutoFetch===!0,bt=s.pdfBug===!0,k=s.CanvasFactory||DP,B=s.FilterFactory||LP,ge=s.enableHWA===!0,hn=l?l.length:(ut=s.length)!=null?ut:NaN,Fn=typeof s.useSystemFonts=="boolean"?s.useSystemFonts:!Qt&&!N,Re=typeof s.useWorkerFetch=="boolean"?s.useWorkerFetch:A===Eh&&E===bh&&m&&T&&Xa(m,document.baseURI)&&Xa(T,document.baseURI),Bt=null;eP(p);let Tt={canvasFactory:new k({ownerDocument:U,enableHWA:ge}),filterFactory:new B({docId:e,ownerDocument:U}),cMapReaderFactory:Re?null:new A({baseUrl:m,isCompressed:_}),standardFontDataFactory:Re?null:new E({baseUrl:T})};if(!d){let Ba={verbosity:p,port:un.workerPort};d=Ba.port?ar.fromPort(Ba):new ar(Ba),t._worker=d}let $o={docId:e,apiVersion:"4.10.38",data:i,password:a,disableAutoFetch:W,rangeChunkSize:c,length:hn,docBaseUrl:g,enableXfa:F,evaluatorOptions:{maxImageSize:S,disableFontFace:N,ignoreErrors:C,isEvalSupported:b,isOffscreenCanvasSupported:x,isImageDecoderSupported:P,canvasMaxAreaInBytes:I,fontExtraProperties:M,useSystemFonts:Fn,cMapUrl:Re?m:null,standardFontDataUrl:Re?T:null}},Ga={disableFontFace:N,fontExtraProperties:M,ownerDocument:U,pdfBug:bt,styleElement:Bt,loadingParams:{disableAutoFetch:W,enableXfa:F}};return d.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let Ba=d.messageHandler.sendWithPromise("GetDocRequest",$o,i?[i.buffer]:null),Kp;if(l)Kp=new ey(l,{disableRange:j,disableStream:z});else if(!i){if(!n)throw new Error("getDocument - no `url` parameter provided.");let Go;if(Qt)if(Xa(n)){if(typeof fetch=="undefined"||typeof Response=="undefined"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");Go=Ih}else Go=uy;else Go=Xa(n)?Ih:ay;Kp=new Go({url:n,length:hn,httpHeaders:o,withCredentials:r,rangeChunkSize:c,disableRange:j,disableStream:z})}return Ba.then(Go=>{if(t.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let V_=new gs(e,Go,d.port),rE=new vy(V_,t,Kp,Ga,Tt);t._transport=rE,V_.send("Ready",null)})}).catch(t._capability.reject),t}function $P(s){if(s instanceof URL)return s.href;try{return new URL(s,window.location).href}catch(t){if(Qt&&typeof s=="string")return s}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function GP(s){if(Qt&&typeof Buffer!="undefined"&&s instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength)return s;if(typeof s=="string")return Np(s);if(s instanceof ArrayBuffer||ArrayBuffer.isView(s)||typeof s=="object"&&!isNaN(s==null?void 0:s.length))return new Uint8Array(s);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function ww(s){return typeof s=="object"&&Number.isInteger(s==null?void 0:s.num)&&s.num>=0&&Number.isInteger(s==null?void 0:s.gen)&&s.gen>=0}var Df,Ff=class Ff{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${jt(Ff,Df)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var t,e,n,i;this.destroyed=!0;try{(t=this._worker)!=null&&t.port&&(this._worker._pendingDestroy=!0),await((e=this._transport)==null?void 0:e.destroy())}catch(o){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,o}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}};Df=new WeakMap,y(Ff,Df,0);var gy=Ff,Ph=class{constructor(t,e,n=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=n,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(let n of this._rangeListeners)n(t,e)}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(let n of this._progressListeners)n(t,e)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(let e of this._progressiveReadListeners)e(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){ot("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},my=class{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Z(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){let{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},Hi,ti,Vi,er,Vr,Xd,yy=class{constructor(t,e,n,i=!1){y(this,Vi);y(this,Vr);y(this,Hi,null);y(this,ti,!1);this._pageIndex=t,this._pageInfo=e,this._transport=n,this._stats=i?new gh:null,this._pdfBug=i,this.commonObjs=n.commonObjs,this.objs=new Rh,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:n=0,offsetY:i=0,dontFlip:o=!1}={}){return new ml({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:i,dontFlip:o})}getAnnotations({intent:t="display"}={}){let{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Z(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,viewport:e,intent:n="display",annotationMode:i=Ti.ENABLE,transform:o=null,background:r=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:p=!1}){var b,x;(b=this._stats)==null||b.time("Overall");let g=this._transport.getRenderingIntent(n,i,d,p),{renderingIntent:m,cacheKey:_}=g;v(this,ti,!1),w(this,Vr,Xd).call(this),a||(a=this._transport.getOptionalContentConfig(m));let A=this._intentStates.get(_);A||(A=Object.create(null),this._intentStates.set(_,A)),A.streamReaderCancelTimeout&&(clearTimeout(A.streamReaderCancelTimeout),A.streamReaderCancelTimeout=null);let T=!!(m&Ie.PRINT);A.displayReadyCapability||(A.displayReadyCapability=Promise.withResolvers(),A.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(x=this._stats)==null||x.time("Page Request"),this._pumpOperatorList(g));let E=P=>{var I;A.renderTasks.delete(C),(this._maybeCleanupAfterRender||T)&&v(this,ti,!0),w(this,Vi,er).call(this,!T),P?(C.capability.reject(P),this._abortOperatorList({intentState:A,reason:P instanceof Error?P:new Error(P)})):C.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(I=globalThis.Stats)!=null&&I.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},C=new Ty({callback:E,params:{canvasContext:t,viewport:e,transform:o,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:A.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!T,pdfBug:this._pdfBug,pageColors:c});(A.renderTasks||(A.renderTasks=new Set)).add(C);let S=C.task;return Promise.all([A.displayReadyCapability.promise,a]).then(([P,I])=>{var N;if(this.destroyed){E();return}if((N=this._stats)==null||N.time("Rendering"),!(I.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");C.initializeGraphics({transparency:P,optionalContentConfig:I}),C.operatorListChanged()}).catch(E),S}getOperatorList({intent:t="display",annotationMode:e=Ti.ENABLE,printAnnotationStorage:n=null,isEditing:i=!1}={}){var c;function o(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}let r=this._transport.getRenderingIntent(t,e,n,i,!0),a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=o,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>Tl.textContent(n));let e=this.streamTextContent(t);return new Promise(function(n,i){function o(){r.read().then(function({value:l,done:c}){var d;if(c){n(a);return}(d=a.lang)!=null||(a.lang=l.lang),Object.assign(a.styles,l.styles),a.items.push(...l.items),o()},i)}let r=e.getReader(),a={items:[],styles:Object.create(null),lang:null};o()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let t=[];for(let e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(let n of e.renderTasks)t.push(n.completed),n.cancel();return this.objs.clear(),v(this,ti,!1),w(this,Vr,Xd).call(this),Promise.all(t)}cleanup(t=!1){v(this,ti,!0);let e=w(this,Vi,er).call(this,!1);return t&&e&&this._stats&&(this._stats=new gh),e}_startRenderPage(t,e){var i,o;let n=this._intentStates.get(e);n&&((i=this._stats)==null||i.timeEnd("Page Request"),(o=n.displayReadyCapability)==null||o.resolve(t))}_renderPageChunk(t,e){for(let n=0,i=t.length;n<i;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(let n of e.renderTasks)n.operatorListChanged();t.lastChunk&&w(this,Vi,er).call(this,!0)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:n,modifiedIds:i}){let{map:o,transfer:r}=n,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:o,modifiedIds:i},r).getReader(),c=this._intentStates.get(e);c.streamReader=l;let d=()=>{l.read().then(({value:p,done:g})=>{if(g){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(p,c),d())},p=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(let g of c.renderTasks)g.operatorListChanged();w(this,Vi,er).call(this,!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(p);else if(c.opListReadCapability)c.opListReadCapability.reject(p);else throw p}})};d()}_abortOperatorList({intentState:t,reason:e,force:n=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!n){if(t.renderTasks.size>0)return;if(e instanceof yl){let i=NP;e.extraDelay>0&&e.extraDelay<1e3&&(i+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},i);return}}if(t.streamReader.cancel(new Dn(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(let[i,o]of this._intentStates)if(o===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}};Hi=new WeakMap,ti=new WeakMap,Vi=new WeakSet,er=function(t=!1){if(w(this,Vr,Xd).call(this),!u(this,ti)||this.destroyed)return!1;if(t)return v(this,Hi,setTimeout(()=>{v(this,Hi,null),w(this,Vi,er).call(this,!1)},kP)),!1;for(let{renderTasks:e,operatorList:n}of this._intentStates.values())if(e.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),v(this,ti,!1),!0},Vr=new WeakSet,Xd=function(){u(this,Hi)&&(clearTimeout(u(this,Hi)),v(this,Hi,null))};var ei,Lf,_y=class{constructor(){y(this,ei,new Map);y(this,Lf,Promise.resolve())}postMessage(t,e){let n={data:structuredClone(t,e?{transfer:e}:null)};u(this,Lf).then(()=>{for(let[i]of u(this,ei))i.call(this,n)})}addEventListener(t,e,n=null){let i=null;if((n==null?void 0:n.signal)instanceof AbortSignal){let{signal:o}=n;if(o.aborted){Y("LoopbackPort - cannot use an `aborted` signal.");return}let r=()=>this.removeEventListener(t,e);i=()=>o.removeEventListener("abort",r),o.addEventListener("abort",r)}u(this,ei).set(e,i)}removeEventListener(t,e){let n=u(this,ei).get(e);n==null||n(),u(this,ei).delete(e)}terminate(){for(let[,t]of u(this,ei))t==null||t();u(this,ei).clear()}};ei=new WeakMap,Lf=new WeakMap;var Uf,Qs,js,qr,Zd,zr,Qd,lt=class lt{constructor({name:t=null,port:e=null,verbosity:n=nP()}={}){y(this,qr);var i;if(this.name=t,this.destroyed=!1,this.verbosity=n,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if((i=u(lt,js))!=null&&i.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(u(lt,js)||v(lt,js,new WeakMap)).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new gs("main","worker",t),this._messageHandler.on("ready",function(){}),w(this,qr,Zd).call(this)}_initialize(){if(u(lt,Qs)||u(lt,zr,Qd)){this._setupFakeWorker();return}let{workerSrc:t}=lt;try{lt._isSameOrigin(window.location.href,t)||(t=lt._createCDNWrapper(new URL(t,window.location).href));let e=new Worker(t,{type:"module"}),n=new gs("main","worker",e),i=()=>{o.abort(),n.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},o=new AbortController;e.addEventListener("error",()=>{this._webWorker||i()},{signal:o.signal}),n.on("test",a=>{if(o.abort(),this.destroyed||!a){i();return}this._messageHandler=n,this._port=e,this._webWorker=e,w(this,qr,Zd).call(this)}),n.on("ready",a=>{if(o.abort(),this.destroyed){i();return}try{r()}catch(l){this._setupFakeWorker()}});let r=()=>{let a=new Uint8Array;n.send("test",a,[a.buffer])};r();return}catch(e){Mp("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){u(lt,Qs)||(Y("Setting up fake worker."),v(lt,Qs,!0)),lt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let e=new _y;this._port=e;let n=`fake${jt(lt,Uf)._++}`,i=new gs(n+"_worker",n,e);t.setup(i,e),this._messageHandler=new gs(n,n+"_worker",e),w(this,qr,Zd).call(this)}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){var t,e,n;this.destroyed=!0,(t=this._webWorker)==null||t.terminate(),this._webWorker=null,(e=u(lt,js))==null||e.delete(this._port),this._port=null,(n=this._messageHandler)==null||n.destroy(),this._messageHandler=null}static fromPort(t){var n;if(!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");let e=(n=u(this,js))==null?void 0:n.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new lt(t)}static get workerSrc(){if(un.workerSrc)return un.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Z(this,"_setupFakeWorkerGlobal",(async()=>u(this,zr,Qd)?u(this,zr,Qd):(await import(this.workerSrc)).WorkerMessageHandler)())}};Uf=new WeakMap,Qs=new WeakMap,js=new WeakMap,qr=new WeakSet,Zd=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},zr=new WeakSet,Qd=function(){var t;try{return((t=globalThis.pdfjsWorker)==null?void 0:t.WorkerMessageHandler)||null}catch(e){return null}},y(lt,zr),y(lt,Uf,0),y(lt,Qs,!1),y(lt,js,void 0),Qt&&(v(lt,Qs,!0),un.workerSrc||(un.workerSrc="./pdf.worker.mjs")),lt._isSameOrigin=(t,e)=>{let n;try{if(n=new URL(t),!n.origin||n.origin==="null")return!1}catch(o){return!1}let i=new URL(e,n);return n.origin===i.origin},lt._createCDNWrapper=t=>{let e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};var ar=lt,ni,Sn,Wr,Kr,ii,to,sl,vy=class{constructor(t,e,n,i,o){y(this,to);y(this,ni,new Map);y(this,Sn,new Map);y(this,Wr,new Map);y(this,Kr,new Map);y(this,ii,null);this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Rh,this.fontLoader=new Nm({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=o.canvasFactory,this.filterFactory=o.filterFactory,this.cMapReaderFactory=o.cMapReaderFactory,this.standardFontDataFactory=o.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Z(this,"annotationStorage",new vl)}getRenderingIntent(t,e=Ti.ENABLE,n=null,i=!1,o=!1){let r=Ie.DISPLAY,a=Mm;switch(t){case"any":r=Ie.ANY;break;case"display":break;case"print":r=Ie.PRINT;break;default:Y(`getRenderingIntent - invalid intent: ${t}`)}let l=r&Ie.PRINT&&n instanceof Ah?n:this.annotationStorage;switch(e){case Ti.DISABLE:r+=Ie.ANNOTATIONS_DISABLE;break;case Ti.ENABLE:break;case Ti.ENABLE_FORMS:r+=Ie.ANNOTATIONS_FORMS;break;case Ti.ENABLE_STORAGE:r+=Ie.ANNOTATIONS_STORAGE,a=l.serializable;break;default:Y(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(r+=Ie.IS_EDITING),o&&(r+=Ie.OPLIST);let{ids:c,hash:d}=l.modifiedIds,p=[r,a.hash,d];return{renderingIntent:r,cacheKey:p.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=u(this,ii))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));let t=[];for(let i of u(this,Sn).values())t.push(i._destroy());u(this,Sn).clear(),u(this,Wr).clear(),u(this,Kr).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{var i,o;this.commonObjs.clear(),this.fontLoader.clear(),u(this,ni).clear(),this.filterFactory.destroy(),wl.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new Dn("Worker was terminated.")),(o=this.messageHandler)==null||o.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(n,i)=>{wt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},i.onPull=()=>{this._fullReader.read().then(function({value:o,done:r}){if(r){i.close();return}wt(o instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{this._fullReader.cancel(o),i.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("ReaderHeadersReady",async n=>{var a;await this._fullReader.headersReady;let{isStreamingSupported:i,isRangeSupported:o,contentLength:r}=this._fullReader;return(!i||!o)&&(this._lastProgress&&((a=e.onProgress)==null||a.call(e,this._lastProgress)),this._fullReader.onProgress=l=>{var c;(c=e.onProgress)==null||c.call(e,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:i,isRangeSupported:o,contentLength:r}}),t.on("GetRangeReader",(n,i)=>{wt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let o=this._networkStream.getRangeReader(n.begin,n.end);if(!o){i.close();return}i.onPull=()=>{o.read().then(function({value:r,done:a}){if(a){i.close();return}wt(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{o.cancel(r),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,e._capability.resolve(new my(n,this))}),t.on("DocException",n=>{e._capability.reject(ce(n))}),t.on("PasswordRequest",n=>{v(this,ii,Promise.withResolvers());try{if(!e.onPassword)throw ce(n);let i=o=>{o instanceof Error?u(this,ii).reject(o):u(this,ii).resolve({password:o})};e.onPassword(i,n.code)}catch(i){u(this,ii).reject(i)}return u(this,ii).promise}),t.on("DataLoaded",n=>{var i;(i=e.onProgress)==null||i.call(e,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),t.on("StartRenderPage",n=>{if(this.destroyed)return;u(this,Sn).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),t.on("commonobj",([n,i,o])=>{var r;if(this.destroyed||this.commonObjs.has(n))return null;switch(i){case"Font":let{disableFontFace:a,fontExtraProperties:l,pdfBug:c}=this._params;if("error"in o){let m=o.error;Y(`Error during font loading: ${m}`),this.commonObjs.resolve(n,m);break}let d=c&&((r=globalThis.FontInspector)!=null&&r.enabled)?(m,_)=>globalThis.FontInspector.fontAdded(m,_):null,p=new km(o,{disableFontFace:a,fontExtraProperties:l,inspectFont:d});this.fontLoader.bind(p).catch(()=>t.sendWithPromise("FontFallback",{id:n})).finally(()=>{!l&&p.data&&(p.data=null),this.commonObjs.resolve(n,p)});break;case"CopyLocalImage":let{imageRef:g}=o;wt(g,"The imageRef must be defined.");for(let m of u(this,Sn).values())for(let[,_]of m.objs)if((_==null?void 0:_.ref)===g)return _.dataLen?(this.commonObjs.resolve(n,structuredClone(_)),_.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,o);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",([n,i,o,r])=>{var l;if(this.destroyed)return;let a=u(this,Sn).get(i);if(!a.objs.has(n)){if(a._intentStates.size===0){(l=r==null?void 0:r.bitmap)==null||l.close();return}switch(o){case"Image":a.objs.resolve(n,r),(r==null?void 0:r.dataLen)>XI&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(n,r);break;default:throw new Error(`Got unknown object type ${o}`)}}}),t.on("DocProgress",n=>{var i;this.destroyed||(i=e.onProgress)==null||i.call(e,{loaded:n.loaded,total:n.total})}),t.on("FetchBuiltInCMap",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(n)}),t.on("FetchStandardFontData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n,i;this.annotationStorage.size<=0&&Y("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:(i=(n=this._fullReader)==null?void 0:n.filename)!=null?i:null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));let e=t-1,n=u(this,Wr).get(e);if(n)return n;let i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");o.refStr&&u(this,Kr).set(o.refStr,t);let r=new yy(e,o,this,this._params.pdfBug);return u(this,Sn).set(e,r),r});return u(this,Wr).set(e,i),i}getPageIndex(t){return ww(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return w(this,to,sl).call(this,"GetFieldObjects")}hasJSActions(){return w(this,to,sl).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return w(this,to,sl).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return w(this,to,sl).call(this,"GetOptionalContentConfig").then(e=>new jm(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let t="GetMetadata",e=u(this,ni).get(t);if(e)return e;let n=this.messageHandler.sendWithPromise(t,null).then(i=>{var o,r,a,l;return{info:i[0],metadata:i[1]?new Zm(i[1]):null,contentDispositionFilename:(r=(o=this._fullReader)==null?void 0:o.filename)!=null?r:null,contentLength:(l=(a=this._fullReader)==null?void 0:a.contentLength)!=null?l:null}});return u(this,ni).set(t,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(let e of u(this,Sn).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),u(this,ni).clear(),this.filterFactory.destroy(!0),wl.cleanup()}}cachedPageNumber(t){var n;if(!ww(t))return null;let e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return(n=u(this,Kr).get(e))!=null?n:null}};ni=new WeakMap,Sn=new WeakMap,Wr=new WeakMap,Kr=new WeakMap,ii=new WeakMap,to=new WeakSet,sl=function(t,e=null){let n=u(this,ni).get(t);if(n)return n;let i=this.messageHandler.sendWithPromise(t,e);return u(this,ni).set(t,i),i};var Ya=Symbol("INITIAL_DATA"),ve,$c,Ay,Rh=class{constructor(){y(this,$c);y(this,ve,Object.create(null))}get(t,e=null){if(e){let i=w(this,$c,Ay).call(this,t);return i.promise.then(()=>e(i.data)),null}let n=u(this,ve)[t];if(!n||n.data===Ya)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return n.data}has(t){let e=u(this,ve)[t];return!!e&&e.data!==Ya}delete(t){let e=u(this,ve)[t];return!e||e.data===Ya?!1:(delete u(this,ve)[t],!0)}resolve(t,e=null){let n=w(this,$c,Ay).call(this,t);n.data=e,n.resolve()}clear(){var t;for(let e in u(this,ve)){let{data:n}=u(this,ve)[e];(t=n==null?void 0:n.bitmap)==null||t.close()}v(this,ve,Object.create(null))}*[Symbol.iterator](){for(let t in u(this,ve)){let{data:e}=u(this,ve)[t];e!==Ya&&(yield[t,e])}}};ve=new WeakMap,$c=new WeakSet,Ay=function(t){var e;return(e=u(this,ve))[t]||(e[t]={...Promise.withResolvers(),data:Ya})};var qi,wy=class{constructor(t){y(this,qi,null);v(this,qi,t),this.onContinue=null}get promise(){return u(this,qi).capability.promise}cancel(t=0){u(this,qi).cancel(null,t)}get separateAnnots(){let{separateAnnots:t}=u(this,qi).operatorList;if(!t)return!1;let{annotationCanvasMap:e}=u(this,qi);return t.form||t.canvas&&(e==null?void 0:e.size)>0}};qi=new WeakMap;var zi,eo,ps=class ps{constructor({callback:t,params:e,objs:n,commonObjs:i,annotationCanvasMap:o,operatorList:r,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:p=!1,pageColors:g=null}){y(this,zi,null);this.callback=t,this.params=e,this.objs=n,this.commonObjs=i,this.annotationCanvasMap=o,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=p,this.pageColors=g,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window!="undefined",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new wy(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){var a,l;if(this.cancelled)return;if(this._canvas){if(u(ps,eo).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");u(ps,eo).add(this._canvas)}this._pdfBug&&((a=globalThis.StepperManager)!=null&&a.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:n,viewport:i,transform:o,background:r}=this.params;this.gfx=new rr(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:o,viewport:i,transparency:t,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(t=null,e=0){var n;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),u(this,zi)&&(window.cancelAnimationFrame(u(this,zi)),v(this,zi,null)),u(ps,eo).delete(this._canvas),this.callback(t||new yl(`Rendering cancelled, page ${this._pageIndex+1}`,e))}operatorListChanged(){var t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?v(this,zi,window.requestAnimationFrame(()=>{v(this,zi,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),u(ps,eo).delete(this._canvas),this.callback())))}};zi=new WeakMap,eo=new WeakMap,y(ps,eo,new WeakSet);var Ty=ps,BP="4.10.38",HP="f9bea397f";function Tw(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}function Ja(s){return Math.max(0,Math.min(255,255*s))}var Mh=class{static CMYK_G([t,e,n,i]){return["G",1-Math.min(1,.3*t+.59*n+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=Ja(t),[t,t,t]}static G_HTML([t]){let e=Tw(t);return`#${e}${e}${e}`}static RGB_G([t,e,n]){return["G",.3*t+.59*e+.11*n]}static RGB_rgb(t){return t.map(Ja)}static RGB_HTML(t){return`#${t.map(Tw).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,n,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,n+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,n,i]){return[Ja(1-Math.min(1,t+i)),Ja(1-Math.min(1,n+i)),Ja(1-Math.min(1,e+i))]}static CMYK_HTML(t){let e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,n]){let i=1-t,o=1-e,r=1-n,a=Math.min(i,o,r);return["CMYK",i,o,r,a]}},Ey=class{create(t,e,n=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");let i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),n||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){ot("Abstract method `_createSVG` called.")}},El=class extends Ey{_createSVG(t){return document.createElementNS($n,t)}},Nh=class{static setupStorage(t,e,n,i,o){let r=i.getValue(e,{value:null});switch(n.name){case"textarea":if(r.value!==null&&(t.textContent=r.value),o==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(r.value===n.attributes.xfaOn?t.setAttribute("checked",!0):r.value===n.attributes.xfaOff&&t.removeAttribute("checked"),o==="print")break;t.addEventListener("change",a=>{i.setValue(e,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&t.setAttribute("value",r.value),o==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(let a of n.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}t.addEventListener("input",a=>{let l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(e,{value:c})});break}}static setAttributes({html:t,element:e,storage:n=null,intent:i,linkService:o}){let{attributes:r}=e,a=t instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${i}`);for(let[l,c]of Object.entries(r))if(c!=null)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,c)}a&&o.addLinkAttributes(t,r.href,r.newWindow),n&&r.dataId&&this.setupStorage(t,r.dataId,e,n)}static render(t){var p,g;let e=t.annotationStorage,n=t.linkService,i=t.xfaHtml,o=t.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:o,linkService:n});let a=o!=="richText",l=t.div;if(l.append(r),t.viewport){let m=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=m}a&&l.setAttribute("class","xfaLayer xfaFont");let c=[];if(i.children.length===0){if(i.value){let m=document.createTextNode(i.value);r.append(m),a&&Tl.shouldBuildText(i.name)&&c.push(m)}return{textDivs:c}}let d=[[i,-1,r]];for(;d.length>0;){let[m,_,A]=d.at(-1);if(_+1===m.children.length){d.pop();continue}let T=m.children[++d.at(-1)[1]];if(T===null)continue;let{name:E}=T;if(E==="#text"){let S=document.createTextNode(T.value);c.push(S),A.append(S);continue}let C=(p=T==null?void 0:T.attributes)!=null&&p.xmlns?document.createElementNS(T.attributes.xmlns,E):document.createElement(E);if(A.append(C),T.attributes&&this.setAttributes({html:C,element:T,storage:e,intent:o,linkService:n}),((g=T.children)==null?void 0:g.length)>0)d.push([T,-1,C]);else if(T.value){let S=document.createTextNode(T.value);a&&Tl.shouldBuildText(E)&&c.push(S),C.append(S)}}for(let m of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:c}}static update(t){let e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}},Gu=1e3,VP=9,Oo=new WeakSet;function os(s){return{width:s[2]-s[0],height:s[3]-s[1]}}var Cy=class{static create(t){switch(t.data.annotationType){case Et.LINK:return new kh(t);case Et.TEXT:return new by(t);case Et.WIDGET:switch(t.data.fieldType){case"Tx":return new xy(t);case"Btn":return t.data.radioButton?new Dh(t):t.data.checkBox?new Py(t):new Ry(t);case"Ch":return new My(t);case"Sig":return new Iy(t)}return new _i(t);case Et.POPUP:return new Cl(t);case Et.FREETEXT:return new Fh(t);case Et.LINE:return new Fy(t);case Et.SQUARE:return new Ly(t);case Et.CIRCLE:return new Uy(t);case Et.POLYLINE:return new Lh(t);case Et.CARET:return new $y(t);case Et.INK:return new Sl(t);case Et.POLYGON:return new Oy(t);case Et.HIGHLIGHT:return new Uh(t);case Et.UNDERLINE:return new By(t);case Et.SQUIGGLY:return new Hy(t);case Et.STRIKEOUT:return new Vy(t);case Et.STAMP:return new Oh(t);case Et.FILEATTACHMENT:return new qy(t);default:return new _t(t)}}},no,Yr,Jr,Gc,Sy,I_=class I_{constructor(t,{isRenderable:e=!1,ignoreBorder:n=!1,createQuadrilaterals:i=!1}={}){y(this,Gc);y(this,no,null);y(this,Yr,!1);y(this,Jr,null);this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(n)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:n}){return!!(t!=null&&t.str||e!=null&&e.str||n!=null&&n.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return I_._hasPopupData(this.data)}updateEdited(t){var n;if(!this.container)return;u(this,no)||v(this,no,{rect:this.data.rect.slice(0)});let{rect:e}=t;e&&w(this,Gc,Sy).call(this,e),(n=u(this,Jr))==null||n.popup.updateEdited(t)}resetEdited(){var t;u(this,no)&&(w(this,Gc,Sy).call(this,u(this,no).rect),(t=u(this,Jr))==null||t.popup.resetEdited(),v(this,no,null))}_createContainer(t){let{data:e,parent:{page:n,viewport:i}}=this,o=document.createElement("section");o.setAttribute("data-annotation-id",e.id),this instanceof _i||(o.tabIndex=Gu);let{style:r}=o;if(r.zIndex=this.parent.zIndex++,e.alternativeText&&(o.title=e.alternativeText),e.noRotate&&o.classList.add("norotate"),!e.rect||this instanceof Cl){let{rotation:A}=e;return!e.hasOwnCanvas&&A!==0&&this.setRotation(A,o),o}let{width:a,height:l}=os(e.rect);if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;let A=e.borderStyle.horizontalCornerRadius,T=e.borderStyle.verticalCornerRadius;if(A>0||T>0){let C=`calc(${A}px * var(--scale-factor)) / calc(${T}px * var(--scale-factor))`;r.borderRadius=C}else if(this instanceof Dh){let C=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;r.borderRadius=C}switch(e.borderStyle.style){case Wa.SOLID:r.borderStyle="solid";break;case Wa.DASHED:r.borderStyle="dashed";break;case Wa.BEVELED:Y("Unimplemented border style: beveled");break;case Wa.INSET:Y("Unimplemented border style: inset");break;case Wa.UNDERLINE:r.borderBottomStyle="solid";break;default:break}let E=e.borderColor||null;E?(v(this,Yr,!0),r.borderColor=$.makeHexColor(E[0]|0,E[1]|0,E[2]|0)):r.borderWidth=0}let c=$.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]),{pageWidth:d,pageHeight:p,pageX:g,pageY:m}=i.rawDims;r.left=`${100*(c[0]-g)/d}%`,r.top=`${100*(c[1]-m)/p}%`;let{rotation:_}=e;return e.hasOwnCanvas||_===0?(r.width=`${100*a/d}%`,r.height=`${100*l/p}%`):this.setRotation(_,o),o}setRotation(t,e=this.container){if(!this.data.rect)return;let{pageWidth:n,pageHeight:i}=this.parent.viewport.rawDims,{width:o,height:r}=os(this.data.rect),a,l;t%180===0?(a=100*o/n,l=100*r/i):(a=100*r/n,l=100*o/i),e.style.width=`${a}%`,e.style.height=`${l}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){let t=(e,n,i)=>{let o=i.detail[e],r=o[0],a=o.slice(1);i.target.style[n]=Mh[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[n]:Mh[`${r}_rgb`](a)})};return Z(this,"_commonActions",{display:e=>{let{display:n}=e.detail,i=n%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:n===1||n===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{let{hidden:n}=e.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{let n=e.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(t,e){let n=this._commonActions;for(let i of Object.keys(e.detail)){let o=t[i]||n[i];o==null||o(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;let e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;let n=this._commonActions;for(let[i,o]of Object.entries(e)){let r=n[i];if(r){let a={detail:{[i]:o},target:t};r(a),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:t}=this.data;if(!t)return;let[e,n,i,o]=this.data.rect.map(A=>Math.fround(A));if(t.length===8){let[A,T,E,C]=t.subarray(2,6);if(i===A&&o===T&&e===E&&n===C)return}let{style:r}=this.container,a;if(u(this,Yr)){let{borderColor:A,borderWidth:T}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${A}" stroke-width="${T}">`],this.container.classList.add("hasBorder")}let l=i-e,c=o-n,{svgFactory:d}=this,p=d.createElement("svg");p.classList.add("quadrilateralsContainer"),p.setAttribute("width",0),p.setAttribute("height",0);let g=d.createElement("defs");p.append(g);let m=d.createElement("clipPath"),_=`clippath_${this.data.id}`;m.setAttribute("id",_),m.setAttribute("clipPathUnits","objectBoundingBox"),g.append(m);for(let A=2,T=t.length;A<T;A+=8){let E=t[A],C=t[A+1],S=t[A+2],b=t[A+3],x=d.createElement("rect"),P=(S-e)/l,I=(o-C)/c,N=(E-S)/l,M=(C-b)/c;x.setAttribute("x",P),x.setAttribute("y",I),x.setAttribute("width",N),x.setAttribute("height",M),m.append(x),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${P}" y="${I}" width="${N}" height="${M}"/>`)}u(this,Yr)&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(p),this.container.style.clipPath=`url(#${_})`}_createPopup(){let{data:t}=this,e=v(this,Jr,new Cl({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(e.render())}render(){ot("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){let n=[];if(this._fieldObjects){let i=this._fieldObjects[t];if(i)for(let{page:o,id:r,exportValues:a}of i){if(o===-1||r===e)continue;let l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${r}"]`);if(c&&!Oo.has(c)){Y(`_getElementsByName - element not allowed: ${r}`);continue}n.push({id:r,exportValue:l,domElement:c})}return n}for(let i of document.getElementsByName(t)){let{exportValue:o}=i,r=i.getAttribute("data-element-id");r!==e&&Oo.has(i)&&n.push({id:r,exportValue:o,domElement:i})}return n}show(){var t;this.container&&(this.container.hidden=!1),(t=this.popup)==null||t.maybeShow()}hide(){var t;this.container&&(this.container.hidden=!0),(t=this.popup)==null||t.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(let e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}};no=new WeakMap,Yr=new WeakMap,Jr=new WeakMap,Gc=new WeakSet,Sy=function(t){let{container:{style:e},data:{rect:n,rotation:i},parent:{viewport:{rawDims:{pageWidth:o,pageHeight:r,pageX:a,pageY:l}}}}=this;n==null||n.splice(0,4,...t);let{width:c,height:d}=os(t);e.left=`${100*(t[0]-a)/o}%`,e.top=`${100*(r-t[3]+l)/r}%`,i===0?(e.width=`${100*c/o}%`,e.height=`${100*d/r}%`):this.setRotation(i)};var _t=I_,si,us,Of,yT,$f,_T,kh=class extends _t{constructor(e,n=null){super(e,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});y(this,si);y(this,Of);y(this,$f);this.isTooltipOnly=e.data.isTooltipOnly}render(){let{data:e,linkService:n}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let o=!1;return e.url?(n.addLinkAttributes(i,e.url,e.newWindow),o=!0):e.action?(this._bindNamedAction(i,e.action),o=!0):e.attachment?(w(this,Of,yT).call(this,i,e.attachment,e.attachmentDest),o=!0):e.setOCGState?(w(this,$f,_T).call(this,i,e.setOCGState),o=!0):e.dest?(this._bindLink(i,e.dest),o=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),o=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),o=!0):this.isTooltipOnly&&!o&&(this._bindLink(i,""),o=!0)),this.container.classList.add("linkAnnotation"),o&&this.container.append(i),this.container}_bindLink(e,n){e.href=this.linkService.getDestinationHash(n),e.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&w(this,si,us).call(this)}_bindNamedAction(e,n){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(n),!1),w(this,si,us).call(this)}_bindJSAction(e,n){e.href=this.linkService.getAnchorUrl("");let i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let o of Object.keys(n.actions)){let r=i.get(o);r&&(e[r]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:o}}),!1})}e.onclick||(e.onclick=()=>!1),w(this,si,us).call(this)}_bindResetFormAction(e,n){let i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),w(this,si,us).call(this),!this._fieldObjects){Y('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(e.onclick=()=>!1);return}e.onclick=()=>{var p;i==null||i();let{fields:o,refs:r,include:a}=n,l=[];if(o.length!==0||r.length!==0){let g=new Set(r);for(let m of o){let _=this._fieldObjects[m]||[];for(let{id:A}of _)g.add(A)}for(let m of Object.values(this._fieldObjects))for(let _ of m)g.has(_.id)===a&&l.push(_)}else for(let g of Object.values(this._fieldObjects))l.push(...g);let c=this.annotationStorage,d=[];for(let g of l){let{id:m}=g;switch(d.push(m),g.type){case"text":{let A=g.defaultValue||"";c.setValue(m,{value:A});break}case"checkbox":case"radiobutton":{let A=g.defaultValue===g.exportValues;c.setValue(m,{value:A});break}case"combobox":case"listbox":{let A=g.defaultValue||"";c.setValue(m,{value:A});break}default:continue}let _=document.querySelector(`[data-element-id="${m}"]`);if(_){if(!Oo.has(_)){Y(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;_.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}};si=new WeakSet,us=function(){this.container.setAttribute("data-internal-link","")},Of=new WeakSet,yT=function(e,n,i=null){e.href=this.linkService.getAnchorUrl(""),n.description&&(e.title=n.description),e.onclick=()=>{var o;return(o=this.downloadManager)==null||o.openOrDownloadData(n.content,n.filename,i),!1},w(this,si,us).call(this)},$f=new WeakSet,_T=function(e,n){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(n),!1),w(this,si,us).call(this)};var by=class extends _t{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}},_i=class extends _t{render(){return this.container}showElementAndHideCanvas(t){var e;this.data.hasOwnCanvas&&(((e=t.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Gt.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,n,i,o){n.includes("mouse")?t.addEventListener(n,r=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:o(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):t.addEventListener(n,r=>{var a;if(n==="blur"){if(!e.focused||!r.relatedTarget)return;e.focused=!1}else if(n==="focus"){if(e.focused)return;e.focused=!0}o&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:o(r)}}))})}_setEventListeners(t,e,n,i){var o,r,a;for(let[l,c]of n)(c==="Action"||(o=this.data.actions)!=null&&o[c])&&((c==="Focus"||c==="Blur")&&(e||(e={focused:!1})),this._setEventListener(t,e,l,c,i),c==="Focus"&&!((r=this.data.actions)!=null&&r.Blur)?this._setEventListener(t,e,"blur","Blur",null):c==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){let e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":$.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){let e=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||VP,o=t.style,r,a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),d=Math.round(c/(Ud*i))||1,p=c/d;r=Math.min(i,l(p/Ud))}else{let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(i,l(c/Ud))}o.fontSize=`calc(${r}px * var(--scale-factor))`,o.color=$.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(o.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}},xy=class extends _i{constructor(t){let e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,n,i){let o=this.annotationStorage;for(let r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=n),o.setValue(r.id,{[i]:n})}render(){var i,o;let t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){let r=t.getValue(e,{value:this.data.fieldValue}),a=r.value||"",l=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;l&&a.length>l&&(a=a.slice(0,l));let c=r.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));let d={userValue:a,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=c!=null?c:a,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",c!=null?c:a),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Oo.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=Gu,this._setRequired(n,this.data.required),l&&(n.maxLength=l),n.addEventListener("input",g=>{t.setValue(e,{value:g.target.value}),this.setPropertyOnSiblings(n,"value",g.target.value,"value"),d.formattedValue=null}),n.addEventListener("resetform",g=>{var _;let m=(_=this.data.defaultFieldValue)!=null?_:"";n.value=d.userValue=m,d.formattedValue=null});let p=g=>{let{formattedValue:m}=d;m!=null&&(g.target.value=m),g.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",m=>{var A;if(d.focused)return;let{target:_}=m;d.userValue&&(_.value=d.userValue),d.lastCommittedValue=_.value,d.commitKey=1,(A=this.data.actions)!=null&&A.Focus||(d.focused=!0)}),n.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);let _={value(A){var T;d.userValue=(T=A.detail.value)!=null?T:"",t.setValue(e,{value:d.userValue.toString()}),A.target.value=d.userValue},formattedValue(A){let{formattedValue:T}=A.detail;d.formattedValue=T,T!=null&&A.target!==document.activeElement&&(A.target.value=T),t.setValue(e,{formattedValue:T})},selRange(A){A.target.setSelectionRange(...A.detail.selRange)},charLimit:A=>{var S;let{charLimit:T}=A.detail,{target:E}=A;if(T===0){E.removeAttribute("maxLength");return}E.setAttribute("maxLength",T);let C=d.userValue;!C||C.length<=T||(C=C.slice(0,T),E.value=d.userValue=C,t.setValue(e,{value:C}),(S=this.linkService.eventBus)==null||S.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:C,willCommit:!0,commitKey:1,selStart:E.selectionStart,selEnd:E.selectionEnd}}))}};this._dispatchEventFromSandbox(_,m)}),n.addEventListener("keydown",m=>{var T;d.commitKey=1;let _=-1;if(m.key==="Escape"?_=0:m.key==="Enter"&&!this.data.multiLine?_=2:m.key==="Tab"&&(d.commitKey=3),_===-1)return;let{value:A}=m.target;d.lastCommittedValue!==A&&(d.lastCommittedValue=A,d.userValue=A,(T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:A,willCommit:!0,commitKey:_,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});let g=p;p=null,n.addEventListener("blur",m=>{var A,T;if(!d.focused||!m.relatedTarget)return;(A=this.data.actions)!=null&&A.Blur||(d.focused=!1);let{value:_}=m.target;d.userValue=_,d.lastCommittedValue!==_&&((T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:_,willCommit:!0,commitKey:d.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}})),g(m)}),(o=this.data.actions)!=null&&o.Keystroke&&n.addEventListener("beforeinput",m=>{var x;d.lastCommittedValue=null;let{data:_,target:A}=m,{value:T,selectionStart:E,selectionEnd:C}=A,S=E,b=C;switch(m.inputType){case"deleteWordBackward":{let P=T.substring(0,E).match(/\w*[^\w]*$/);P&&(S-=P[0].length);break}case"deleteWordForward":{let P=T.substring(E).match(/^[^\w]*\w*/);P&&(b+=P[0].length);break}case"deleteContentBackward":E===C&&(S-=1);break;case"deleteContentForward":E===C&&(b+=1);break}m.preventDefault(),(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:T,change:_||"",willCommit:!1,selStart:S,selEnd:b}})}),this._setEventListeners(n,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(p&&n.addEventListener("blur",p),this.data.comb){let m=(this.data.rect[2]-this.data.rect[0])/l;n.classList.add("comb"),n.style.letterSpacing=`calc(${m}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},Iy=class extends _i{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}},Py=class extends _i{constructor(t){super(t,{isRenderable:t.renderForms})}render(){let t=this.annotationStorage,e=this.data,n=e.id,i=t.getValue(n,{value:e.exportValue===e.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",t.setValue(n,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let o=document.createElement("input");return Oo.add(o),o.setAttribute("data-element-id",n),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="checkbox",o.name=e.fieldName,i&&o.setAttribute("checked",!0),o.setAttribute("exportValue",e.exportValue),o.tabIndex=Gu,o.addEventListener("change",r=>{let{name:a,checked:l}=r.target;for(let c of this._getElementsByName(a,n)){let d=l&&c.exportValue===e.exportValue;c.domElement&&(c.domElement.checked=d),t.setValue(c.id,{value:d})}t.setValue(n,{value:l})}),o.addEventListener("resetform",r=>{let a=e.defaultFieldValue||"Off";r.target.checked=a===e.exportValue}),this.enableScripting&&this.hasJSActions&&(o.addEventListener("updatefromsandbox",r=>{let a={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(n,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}},Dh=class extends _i{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let t=this.annotationStorage,e=this.data,n=e.id,i=t.getValue(n,{value:e.fieldValue===e.buttonValue}).value;if(typeof i=="string"&&(i=i!==e.buttonValue,t.setValue(n,{value:i})),i)for(let r of this._getElementsByName(e.fieldName,n))t.setValue(r.id,{value:!1});let o=document.createElement("input");if(Oo.add(o),o.setAttribute("data-element-id",n),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="radio",o.name=e.fieldName,i&&o.setAttribute("checked",!0),o.tabIndex=Gu,o.addEventListener("change",r=>{let{name:a,checked:l}=r.target;for(let c of this._getElementsByName(a,n))t.setValue(c.id,{value:!1});t.setValue(n,{value:l})}),o.addEventListener("resetform",r=>{let a=e.defaultFieldValue;r.target.checked=a!=null&&a===e.buttonValue}),this.enableScripting&&this.hasJSActions){let r=e.buttonValue;o.addEventListener("updatefromsandbox",a=>{let l={value:c=>{let d=r===c.detail.value;for(let p of this._getElementsByName(c.target.name)){let g=d&&p.id===n;p.domElement&&(p.domElement.checked=g),t.setValue(p.id,{value:g})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}},Ry=class extends kh{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){let t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");let e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),t}},My=class extends _i{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let t=this.annotationStorage,e=this.data.id,n=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");Oo.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=Gu;let o=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",d=>{let p=this.data.defaultFieldValue;for(let g of i.options)g.selected=g.value===p});for(let d of this.data.options){let p=document.createElement("option");p.textContent=d.displayValue,p.value=d.exportValue,n.value.includes(d.exportValue)&&(p.setAttribute("selected",!0),o=!1),i.append(p)}let r=null;if(o){let d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),i.prepend(d),r=()=>{d.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}let a=d=>{let p=d?"value":"textContent",{options:g,multiple:m}=i;return m?Array.prototype.filter.call(g,_=>_.selected).map(_=>_[p]):g.selectedIndex===-1?null:g[g.selectedIndex][p]},l=a(!1),c=d=>{let p=d.target.options;return Array.prototype.map.call(p,g=>({displayValue:g.textContent,exportValue:g.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",d=>{let p={value(g){r==null||r();let m=g.detail.value,_=new Set(Array.isArray(m)?m:[m]);for(let A of i.options)A.selected=_.has(A.value);t.setValue(e,{value:a(!0)}),l=a(!1)},multipleSelection(g){i.multiple=!0},remove(g){let m=i.options,_=g.detail.remove;m[_].selected=!1,i.remove(_),m.length>0&&Array.prototype.findIndex.call(m,T=>T.selected)===-1&&(m[0].selected=!0),t.setValue(e,{value:a(!0),items:c(g)}),l=a(!1)},clear(g){for(;i.length!==0;)i.remove(0);t.setValue(e,{value:null,items:[]}),l=a(!1)},insert(g){let{index:m,displayValue:_,exportValue:A}=g.detail.insert,T=i.children[m],E=document.createElement("option");E.textContent=_,E.value=A,T?T.before(E):i.append(E),t.setValue(e,{value:a(!0),items:c(g)}),l=a(!1)},items(g){let{items:m}=g.detail;for(;i.length!==0;)i.remove(0);for(let _ of m){let{displayValue:A,exportValue:T}=_,E=document.createElement("option");E.textContent=A,E.value=T,i.append(E)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:a(!0),items:c(g)}),l=a(!1)},indices(g){let m=new Set(g.detail.indices);for(let _ of g.target.options)_.selected=m.has(_.index);t.setValue(e,{value:a(!0)}),l=a(!1)},editable(g){g.target.disabled=!g.detail.editable}};this._dispatchEventFromSandbox(p,d)}),i.addEventListener("input",d=>{var m;let p=a(!0),g=a(!1);t.setValue(e,{value:p}),d.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:g,changeEx:p,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):i.addEventListener("input",function(d){t.setValue(e,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},Cl=class extends _t{constructor(t){let{data:e,elements:n}=t;super(t,{isRenderable:_t._hasPopupData(e)}),this.elements=n,this.popup=null}render(){this.container.classList.add("popupAnnotation");let t=this.popup=new Ny({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(let n of this.elements)n.popup=t,n.container.ariaHasPopup="dialog",e.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(n=>`${T_}${n}`).join(",")),this.container}},Xr,Gf,Bf,Zr,io,gt,oi,Qr,Bc,Hc,jr,ri,tn,ai,Vc,li,qc,so,oo,ta,jd,zc,ky,Hf,vT,Vf,AT,qf,wT,zf,TT,ea,th,na,eh,Wc,Dy,Ny=class{constructor({container:t,color:e,elements:n,titleObj:i,modificationDate:o,contentsObj:r,richText:a,parent:l,rect:c,parentRect:d,open:p}){y(this,ta);y(this,zc);y(this,Hf);y(this,Vf);y(this,qf);y(this,zf);y(this,ea);y(this,na);y(this,Wc);y(this,Xr,w(this,qf,wT).bind(this));y(this,Gf,w(this,Wc,Dy).bind(this));y(this,Bf,w(this,na,eh).bind(this));y(this,Zr,w(this,ea,th).bind(this));y(this,io,null);y(this,gt,null);y(this,oi,null);y(this,Qr,null);y(this,Bc,null);y(this,Hc,null);y(this,jr,null);y(this,ri,!1);y(this,tn,null);y(this,ai,null);y(this,Vc,null);y(this,li,null);y(this,qc,null);y(this,so,null);y(this,oo,!1);var g;v(this,gt,t),v(this,qc,i),v(this,oi,r),v(this,li,a),v(this,Hc,l),v(this,io,e),v(this,Vc,c),v(this,jr,d),v(this,Bc,n),v(this,Qr,fl.toDateObject(o)),this.trigger=n.flatMap(m=>m.getElementsToTriggerPopup());for(let m of this.trigger)m.addEventListener("click",u(this,Zr)),m.addEventListener("mouseenter",u(this,Bf)),m.addEventListener("mouseleave",u(this,Gf)),m.classList.add("popupTriggerArea");for(let m of n)(g=m.container)==null||g.addEventListener("keydown",u(this,Xr));u(this,gt).hidden=!0,p&&w(this,ea,th).call(this)}render(){if(u(this,tn))return;let t=v(this,tn,document.createElement("div"));if(t.className="popup",u(this,io)){let o=t.style.outlineColor=$.makeHexColor(...u(this,io));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?t.style.backgroundColor=`color-mix(in srgb, ${o} 30%, white)`:t.style.backgroundColor=$.makeHexColor(...u(this,io).map(a=>Math.floor(.7*(255-a)+a)))}let e=document.createElement("span");e.className="header";let n=document.createElement("h1");if(e.append(n),{dir:n.dir,str:n.textContent}=u(this,qc),t.append(e),u(this,Qr)){let o=document.createElement("span");o.classList.add("popupDate"),o.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),o.setAttribute("data-l10n-args",JSON.stringify({dateObj:u(this,Qr).valueOf()})),e.append(o)}let i=u(this,ta,jd);if(i)Nh.render({xfaHtml:i,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{let o=this._formatContents(u(this,oi));t.append(o)}u(this,gt).append(t)}_formatContents({str:t,dir:e}){let n=document.createElement("p");n.classList.add("popupContent"),n.dir=e;let i=t.split(/(?:\r\n?|\n)/);for(let o=0,r=i.length;o<r;++o){let a=i[o];n.append(document.createTextNode(a)),o<r-1&&n.append(document.createElement("br"))}return n}updateEdited({rect:t,popupContent:e}){var n;u(this,so)||v(this,so,{contentsObj:u(this,oi),richText:u(this,li)}),t&&v(this,ai,null),e&&(v(this,li,w(this,Vf,AT).call(this,e)),v(this,oi,null)),(n=u(this,tn))==null||n.remove(),v(this,tn,null)}resetEdited(){var t;u(this,so)&&({contentsObj:jt(this,oi)._,richText:jt(this,li)._}=u(this,so),v(this,so,null),(t=u(this,tn))==null||t.remove(),v(this,tn,null),v(this,ai,null))}forceHide(){v(this,oo,this.isVisible),u(this,oo)&&(u(this,gt).hidden=!0)}maybeShow(){u(this,oo)&&(u(this,tn)||w(this,na,eh).call(this),v(this,oo,!1),u(this,gt).hidden=!1)}get isVisible(){return u(this,gt).hidden===!1}};Xr=new WeakMap,Gf=new WeakMap,Bf=new WeakMap,Zr=new WeakMap,io=new WeakMap,gt=new WeakMap,oi=new WeakMap,Qr=new WeakMap,Bc=new WeakMap,Hc=new WeakMap,jr=new WeakMap,ri=new WeakMap,tn=new WeakMap,ai=new WeakMap,Vc=new WeakMap,li=new WeakMap,qc=new WeakMap,so=new WeakMap,oo=new WeakMap,ta=new WeakSet,jd=function(){let t=u(this,li),e=u(this,oi);return t!=null&&t.str&&(!(e!=null&&e.str)||e.str===t.str)&&u(this,li).html||null},zc=new WeakSet,ky=function(){var t,e,n;return((n=(e=(t=u(this,ta,jd))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:n.fontSize)||0},Hf=new WeakSet,vT=function(){var t,e,n;return((n=(e=(t=u(this,ta,jd))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:n.color)||null},Vf=new WeakSet,AT=function(t){let e=[],n={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:u(this,Hf,vT),fontSize:u(this,zc,ky)?`calc(${u(this,zc,ky)}px * var(--scale-factor))`:""}};for(let o of t.split(`
`))e.push({name:"span",value:o,attributes:i});return n},qf=new WeakSet,wT=function(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&u(this,ri))&&w(this,ea,th).call(this)},zf=new WeakSet,TT=function(){if(u(this,ai)!==null)return;let{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:n,pageX:i,pageY:o}}}=u(this,Hc),r=!!u(this,jr),a=r?u(this,jr):u(this,Vc);for(let _ of u(this,Bc))if(!a||$.intersect(_.data.rect,a)!==null){a=_.data.rect,r=!0;break}let l=$.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]),d=r?a[2]-a[0]+5:0,p=l[0]+d,g=l[1];v(this,ai,[100*(p-i)/e,100*(g-o)/n]);let{style:m}=u(this,gt);m.left=`${u(this,ai)[0]}%`,m.top=`${u(this,ai)[1]}%`},ea=new WeakSet,th=function(){v(this,ri,!u(this,ri)),u(this,ri)?(w(this,na,eh).call(this),u(this,gt).addEventListener("click",u(this,Zr)),u(this,gt).addEventListener("keydown",u(this,Xr))):(w(this,Wc,Dy).call(this),u(this,gt).removeEventListener("click",u(this,Zr)),u(this,gt).removeEventListener("keydown",u(this,Xr)))},na=new WeakSet,eh=function(){u(this,tn)||this.render(),this.isVisible?u(this,ri)&&u(this,gt).classList.add("focused"):(w(this,zf,TT).call(this),u(this,gt).hidden=!1,u(this,gt).style.zIndex=parseInt(u(this,gt).style.zIndex)+1e3)},Wc=new WeakSet,Dy=function(){u(this,gt).classList.remove("focused"),!(u(this,ri)||!this.isVisible)&&(u(this,gt).hidden=!0,u(this,gt).style.zIndex=parseInt(u(this,gt).style.zIndex)-1e3)};var Fh=class extends _t{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=K.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(let e of this.textContent){let n=document.createElement("span");n.textContent=e,t.append(n)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Kc,Fy=class extends _t{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,Kc,null)}render(){this.container.classList.add("lineAnnotation");let e=this.data,{width:n,height:i}=os(e.rect),o=this.svgFactory.create(n,i,!0),r=v(this,Kc,this.svgFactory.createElement("svg:line"));return r.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),r.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),r.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),r.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),r.setAttribute("stroke-width",e.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),o.append(r),this.container.append(o),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Kc)}addHighlightArea(){this.container.classList.add("highlightArea")}};Kc=new WeakMap;var Yc,Ly=class extends _t{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,Yc,null)}render(){this.container.classList.add("squareAnnotation");let e=this.data,{width:n,height:i}=os(e.rect),o=this.svgFactory.create(n,i,!0),r=e.borderStyle.width,a=v(this,Yc,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",r/2),a.setAttribute("y",r/2),a.setAttribute("width",n-r),a.setAttribute("height",i-r),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),o.append(a),this.container.append(o),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Yc)}addHighlightArea(){this.container.classList.add("highlightArea")}};Yc=new WeakMap;var Jc,Uy=class extends _t{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,Jc,null)}render(){this.container.classList.add("circleAnnotation");let e=this.data,{width:n,height:i}=os(e.rect),o=this.svgFactory.create(n,i,!0),r=e.borderStyle.width,a=v(this,Jc,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",n/2),a.setAttribute("cy",i/2),a.setAttribute("rx",n/2-r/2),a.setAttribute("ry",i/2-r/2),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),o.append(a),this.container.append(o),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Jc)}addHighlightArea(){this.container.classList.add("highlightArea")}};Jc=new WeakMap;var Xc,Lh=class extends _t{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,Xc,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,vertices:n,borderStyle:i,popupRef:o}}=this;if(!n)return this.container;let{width:r,height:a}=os(e),l=this.svgFactory.create(r,a,!0),c=[];for(let p=0,g=n.length;p<g;p+=2){let m=n[p]-e[0],_=e[3]-n[p+1];c.push(`${m},${_}`)}c=c.join(" ");let d=v(this,Xc,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",c),d.setAttribute("stroke-width",i.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),l.append(d),this.container.append(l),!o&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Xc)}addHighlightArea(){this.container.classList.add("highlightArea")}};Xc=new WeakMap;var Oy=class extends Lh{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},$y=class extends _t{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},Zc,ro,Qc,Gy,Sl=class extends _t{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,Qc);y(this,Zc,null);y(this,ro,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?K.HIGHLIGHT:K.INK}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,rotation:n,inkLists:i,borderStyle:o,popupRef:r}}=this,{transform:a,width:l,height:c}=w(this,Qc,Gy).call(this,n,e),d=this.svgFactory.create(l,c,!0),p=v(this,Zc,this.svgFactory.createElement("svg:g"));d.append(p),p.setAttribute("stroke-width",o.width||1),p.setAttribute("stroke-linecap","round"),p.setAttribute("stroke-linejoin","round"),p.setAttribute("stroke-miterlimit",10),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),p.setAttribute("transform",a);for(let g=0,m=i.length;g<m;g++){let _=this.svgFactory.createElement(this.svgElementName);u(this,ro).push(_),_.setAttribute("points",i[g].join(",")),p.append(_)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);let{thickness:n,points:i,rect:o}=e,r=u(this,Zc);if(n>=0&&r.setAttribute("stroke-width",n||1),i)for(let a=0,l=u(this,ro).length;a<l;a++)u(this,ro)[a].setAttribute("points",i[a].join(","));if(o){let{transform:a,width:l,height:c}=w(this,Qc,Gy).call(this,this.data.rotation,o);r.parentElement.setAttribute("viewBox",`0 0 ${l} ${c}`),r.setAttribute("transform",a)}}getElementsToTriggerPopup(){return u(this,ro)}addHighlightArea(){this.container.classList.add("highlightArea")}};Zc=new WeakMap,ro=new WeakMap,Qc=new WeakSet,Gy=function(e,n){switch(e){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};var Uh=class extends _t{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=K.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},By=class extends _t{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},Hy=class extends _t{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},Vy=class extends _t{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},Oh=class extends _t{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=K.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},jc,tu,zy,qy=class extends _t{constructor(e){var i;super(e,{isRenderable:!0});y(this,tu);y(this,jc,null);let{file:n}=this.data;this.filename=n.filename,this.content=n.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:e,data:n}=this,i;n.hasAppearance||n.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),i.addEventListener("dblclick",w(this,tu,zy).bind(this)),v(this,jc,i);let{isMac:o}=Gt.platform;return e.addEventListener("keydown",r=>{r.key==="Enter"&&(o?r.metaKey:r.ctrlKey)&&w(this,tu,zy).call(this)}),!n.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),e.append(i),e}getElementsToTriggerPopup(){return u(this,jc)}addHighlightArea(){this.container.classList.add("highlightArea")}};jc=new WeakMap,tu=new WeakSet,zy=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.content,this.filename)};var eu,ao,lo,nu,Wf,ET,iu,Ky,Wy=class{constructor({div:t,accessibilityManager:e,annotationCanvasMap:n,annotationEditorUIManager:i,page:o,viewport:r,structTreeLayer:a}){y(this,Wf);y(this,iu);y(this,eu,null);y(this,ao,null);y(this,lo,new Map);y(this,nu,null);this.div=t,v(this,eu,e),v(this,ao,n),v(this,nu,a||null),this.page=o,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return u(this,lo).size>0}async render(t){var r;let{annotations:e}=t,n=this.div;Fo(n,this.viewport);let i=new Map,o={data:null,layer:n,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new El,annotationStorage:t.annotationStorage||new vl,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(let a of e){if(a.noHTML)continue;let l=a.annotationType===Et.POPUP;if(l){let p=i.get(a.id);if(!p)continue;o.elements=p}else{let{width:p,height:g}=os(a.rect);if(p<=0||g<=0)continue}o.data=a;let c=Cy.create(o);if(!c.isRenderable)continue;if(!l&&a.popupRef){let p=i.get(a.popupRef);p?p.push(c):i.set(a.popupRef,[c])}let d=c.render();a.hidden&&(d.style.visibility="hidden"),await w(this,Wf,ET).call(this,d,a.id),c._isEditable&&(u(this,lo).set(c.data.id,c),(r=this._annotationEditorUIManager)==null||r.renderAnnotationElement(c))}w(this,iu,Ky).call(this)}update({viewport:t}){let e=this.div;this.viewport=t,Fo(e,{rotation:t.rotation}),w(this,iu,Ky).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(u(this,lo).values())}getEditableAnnotation(t){return u(this,lo).get(t)}};eu=new WeakMap,ao=new WeakMap,lo=new WeakMap,nu=new WeakMap,Wf=new WeakSet,ET=async function(t,e){var r,a;let n=t.firstChild||t,i=n.id=`${T_}${e}`,o=await((r=u(this,nu))==null?void 0:r.getAriaAttributes(i));if(o)for(let[l,c]of o)n.setAttribute(l,c);this.div.append(t),(a=u(this,eu))==null||a.moveElementInDOM(this.div,t,n,!1)},iu=new WeakSet,Ky=function(){if(!u(this,ao))return;let t=this.div;for(let[e,n]of u(this,ao)){let i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i)continue;n.className="annotationContent";let{firstChild:o}=i;o?o.nodeName==="CANVAS"?o.replaceWith(n):o.classList.contains("annotationContent")?o.after(n):o.before(n):i.append(n)}u(this,ao).clear()};var Ld=/\r\n?|\n/g,en,Ae,su,co,we,Kf,CT,Yf,ST,Jf,bT,ia,nh,sa,ih,oa,sh,Xf,xT,ou,Jy,Zf,IT,st=class st extends ft{constructor(e){super({...e,name:"freeTextEditor"});y(this,Kf);y(this,Yf);y(this,Jf);y(this,ia);y(this,oa);y(this,Xf);y(this,Zf);y(this,en,void 0);y(this,Ae,"");y(this,su,`${this.id}-editor`);y(this,co,null);y(this,we,void 0);v(this,en,e.color||st._defaultColor||ft._defaultLineColor),v(this,we,e.fontSize||st._defaultFontSize)}static get _keyboardManager(){let e=st.prototype,n=r=>r.isEmpty(),i=Uo.TRANSLATE_SMALL,o=Uo.TRANSLATE_BIG;return Z(this,"_keyboardManager",new Lo([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-o,0],checker:n}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[i,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[o,0],checker:n}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-o],checker:n}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,i],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,o],checker:n}]]))}static initialize(e,n){ft.initialize(e,n);let i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,n){switch(e){case Q.FREETEXT_SIZE:st._defaultFontSize=n;break;case Q.FREETEXT_COLOR:st._defaultColor=n;break}}updateParams(e,n){switch(e){case Q.FREETEXT_SIZE:w(this,Kf,CT).call(this,n);break;case Q.FREETEXT_COLOR:w(this,Yf,ST).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Q.FREETEXT_SIZE,st._defaultFontSize],[Q.FREETEXT_COLOR,st._defaultColor||ft._defaultLineColor]]}get propertiesToUpdate(){return[[Q.FREETEXT_SIZE,u(this,we)],[Q.FREETEXT_COLOR,u(this,en)]]}_translateEmpty(e,n){this._uiManager.translateSelectedEditors(e,n,!0)}getInitialTranslation(){let e=this.parentScale;return[-st._internalPadding*e,-(st._internalPadding+u(this,we))*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(K.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),v(this,co,new AbortController);let e=this._uiManager.combinedSignal(u(this,co));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){var e;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",u(this,su)),this._isDraggable=!0,(e=u(this,co))==null||e.abort(),v(this,co,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){var n;this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let e=u(this,Ae),n=v(this,Ae,w(this,Jf,bT).call(this).trimEnd());if(e===n)return;let i=o=>{if(v(this,Ae,o),!o){this.remove();return}w(this,oa,sh).call(this),this._uiManager.rebuild(this),w(this,ia,nh).call(this)};this.addCommands({cmd:()=>{i(n)},undo:()=>{i(e)},mustExec:!1}),w(this,ia,nh).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){st._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,n;this.width&&(e=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",u(this,su)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:i}=this.editorDiv;if(i.fontSize=`calc(${u(this,we)}px * var(--scale-factor))`,i.color=u(this,en),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),mh(this,this.div,["dblclick","keydown"]),this.width){let[o,r]=this.parentDimensions;if(this.annotationElementId){let{position:a}=this._initialData,[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);let[d,p]=this.pageDimensions,[g,m]=this.pageTranslation,_,A;switch(this.rotation){case 0:_=e+(a[0]-g)/d,A=n+this.height-(a[1]-m)/p;break;case 90:_=e+(a[0]-g)/d,A=n-(a[1]-m)/p,[l,c]=[c,-l];break;case 180:_=e-this.width+(a[0]-g)/d,A=n-(a[1]-m)/p,[l,c]=[-l,-c];break;case 270:_=e+(a[0]-g-this.height*p)/d,A=n+(a[1]-m-this.width*d)/p,[l,c]=[-c,l];break}this.setAt(_*o,A*r,l,c)}else this.setAt(e*o,n*r,this.width*o,this.height*r);w(this,oa,sh).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){var _,A,T;let n=e.clipboardData||window.clipboardData,{types:i}=n;if(i.length===1&&i[0]==="text/plain")return;e.preventDefault();let o=w(_=st,ou,Jy).call(_,n.getData("text")||"").replaceAll(Ld,`
`);if(!o)return;let r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();let a=r.getRangeAt(0);if(!o.includes(`
`)){a.insertNode(document.createTextNode(o)),this.editorDiv.normalize(),r.collapseToStart();return}let{startContainer:l,startOffset:c}=a,d=[],p=[];if(l.nodeType===Node.TEXT_NODE){let E=l.parentElement;if(p.push(l.nodeValue.slice(c).replaceAll(Ld,"")),E!==this.editorDiv){let C=d;for(let S of this.editorDiv.childNodes){if(S===E){C=p;continue}C.push(w(A=st,sa,ih).call(A,S))}}d.push(l.nodeValue.slice(0,c).replaceAll(Ld,""))}else if(l===this.editorDiv){let E=d,C=0;for(let S of this.editorDiv.childNodes)C++===c&&(E=p),E.push(w(T=st,sa,ih).call(T,S))}v(this,Ae,`${d.join(`
`)}${o}${p.join(`
`)}`),w(this,oa,sh).call(this);let g=new Range,m=d.reduce((E,C)=>E+C.length,0);for(let{firstChild:E}of this.editorDiv.childNodes)if(E.nodeType===Node.TEXT_NODE){let C=E.nodeValue.length;if(m<=C){g.setStart(E,m),g.setEnd(E,m);break}m-=C}r.removeAllRanges(),r.addRange(g)}get contentDiv(){return this.editorDiv}static async deserialize(e,n,i){var a;let o=null;if(e instanceof Fh){let{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:d,rotation:p,id:g,popupRef:m},textContent:_,textPosition:A,parent:{page:{pageNumber:T}}}=e;if(!_||_.length===0)return null;o=e={annotationType:K.FREETEXT,color:Array.from(c),fontSize:l,value:_.join(`
`),position:A,pageIndex:T-1,rect:d.slice(0),rotation:p,id:g,deleted:!1,popupRef:m}}let r=await super.deserialize(e,n,i);return v(r,we,e.fontSize),v(r,en,$.makeHexColor(...e.color)),v(r,Ae,w(a=st,ou,Jy).call(a,e.value)),r.annotationElementId=e.id||null,r._initialData=o,r}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let n=st._internalPadding*this.parentScale,i=this.getRect(n,n),o=ft._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:u(this,en)),r={annotationType:K.FREETEXT,color:o,fontSize:u(this,we),value:w(this,Xf,xT).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?r:this.annotationElementId&&!w(this,Zf,IT).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(e){let n=super.renderAnnotationElement(e);if(this.deleted)return n;let{style:i}=n;i.fontSize=`calc(${u(this,we)}px * var(--scale-factor))`,i.color=u(this,en),n.replaceChildren();for(let r of u(this,Ae).split(`
`)){let a=document.createElement("div");a.append(r?document.createTextNode(r):document.createElement("br")),n.append(a)}let o=st._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(o,o),popupContent:u(this,Ae)}),n}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}};en=new WeakMap,Ae=new WeakMap,su=new WeakMap,co=new WeakMap,we=new WeakMap,Kf=new WeakSet,CT=function(e){let n=o=>{this.editorDiv.style.fontSize=`calc(${o}px * var(--scale-factor))`,this.translate(0,-(o-u(this,we))*this.parentScale),v(this,we,o),w(this,ia,nh).call(this)},i=u(this,we);this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Yf=new WeakSet,ST=function(e){let n=o=>{v(this,en,this.editorDiv.style.color=o)},i=u(this,en);this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Jf=new WeakSet,bT=function(){var i;let e=[];this.editorDiv.normalize();let n=null;for(let o of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&o.nodeName==="BR"||(e.push(w(i=st,sa,ih).call(i,o)),n=o);return e.join(`
`)},ia=new WeakSet,nh=function(){let[e,n]=this.parentDimensions,i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{let{currentLayer:o,div:r}=this,a=r.style.display,l=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",o.div.append(this.div),i=r.getBoundingClientRect(),r.remove(),r.style.display=a,r.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/e,this.height=i.height/n):(this.width=i.height/e,this.height=i.width/n),this.fixAndSetPosition()},sa=new WeakSet,ih=function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Ld,"")},oa=new WeakSet,sh=function(){if(this.editorDiv.replaceChildren(),!!u(this,Ae))for(let e of u(this,Ae).split(`
`)){let n=document.createElement("div");n.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(n)}},Xf=new WeakSet,xT=function(){return u(this,Ae).replaceAll("\xA0"," ")},ou=new WeakSet,Jy=function(e){return e.replaceAll(" ","\xA0")},Zf=new WeakSet,IT=function(e){let{value:n,fontSize:i,color:o,pageIndex:r}=this._initialData;return this._hasBeenMoved||e.value!==n||e.fontSize!==i||e.color.some((a,l)=>a!==o[l])||e.pageIndex!==r},y(st,sa),y(st,ou),H(st,"_freeTextDefaultContent",""),H(st,"_internalPadding",0),H(st,"_defaultColor",null),H(st,"_defaultFontSize",10),H(st,"_type","freetext"),H(st,"_editorType",K.FREETEXT);var Yy=st,L=class{toSVGPath(){ot("Abstract method `toSVGPath` must be implemented.")}get box(){ot("Abstract getter `box` must be implemented.")}serialize(t,e){ot("Abstract method `serialize` must be implemented.")}static _rescale(t,e,n,i,o,r){r||(r=new Float32Array(t.length));for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a]*i,r[a+1]=n+t[a+1]*o;return r}static _rescaleAndSwap(t,e,n,i,o,r){r||(r=new Float32Array(t.length));for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a+1]*i,r[a+1]=n+t[a]*o;return r}static _translate(t,e,n,i){i||(i=new Float32Array(t.length));for(let o=0,r=t.length;o<r;o+=2)i[o]=e+t[o],i[o+1]=n+t[o+1];return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,n,i,o){switch(o){case 90:return[1-e/n,t/i];case 180:return[1-t/n,1-e/i];case 270:return[e/n,1-t/i];default:return[t/n,e/i]}}static _normalizePagePoint(t,e,n){switch(n){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,n,i,o,r){return[(t+5*n)/6,(e+5*i)/6,(5*n+o)/6,(5*i+r)/6,(n+o)/2,(i+r)/2]}};H(L,"PRECISION",1e-4);var Te,nn,ra,aa,bn,X,uo,ho,ru,au,la,ca,Wi,lu,Qf,jf,fo,ol,tp,PT,ep,RT,np,MT,ip,NT,sp,kT,op,DT,Vn=class Vn{constructor({x:t,y:e},n,i,o,r,a=0){y(this,fo);y(this,tp);y(this,ep);y(this,np);y(this,ip);y(this,sp);y(this,op);y(this,Te,void 0);y(this,nn,[]);y(this,ra,void 0);y(this,aa,void 0);y(this,bn,[]);y(this,X,new Float32Array(18));y(this,uo,void 0);y(this,ho,void 0);y(this,ru,void 0);y(this,au,void 0);y(this,la,void 0);y(this,ca,void 0);y(this,Wi,[]);v(this,Te,n),v(this,ca,o*i),v(this,aa,r),u(this,X).set([NaN,NaN,NaN,NaN,t,e],6),v(this,ra,a),v(this,au,u(Vn,lu)*i),v(this,ru,u(Vn,jf)*i),v(this,la,i),u(this,Wi).push(t,e)}isEmpty(){return isNaN(u(this,X)[8])}add({x:t,y:e}){var M;v(this,uo,t),v(this,ho,e);let[n,i,o,r]=u(this,Te),[a,l,c,d]=u(this,X).subarray(8,12),p=t-c,g=e-d,m=Math.hypot(p,g);if(m<u(this,ru))return!1;let _=m-u(this,au),A=_/m,T=A*p,E=A*g,C=a,S=l;a=c,l=d,c+=T,d+=E,(M=u(this,Wi))==null||M.push(t,e);let b=-E/_,x=T/_,P=b*u(this,ca),I=x*u(this,ca);return u(this,X).set(u(this,X).subarray(2,8),0),u(this,X).set([c+P,d+I],4),u(this,X).set(u(this,X).subarray(14,18),12),u(this,X).set([c-P,d-I],16),isNaN(u(this,X)[6])?(u(this,bn).length===0&&(u(this,X).set([a+P,l+I],2),u(this,bn).push(NaN,NaN,NaN,NaN,(a+P-n)/o,(l+I-i)/r),u(this,X).set([a-P,l-I],14),u(this,nn).push(NaN,NaN,NaN,NaN,(a-P-n)/o,(l-I-i)/r)),u(this,X).set([C,S,a,l,c,d],6),!this.isEmpty()):(u(this,X).set([C,S,a,l,c,d],6),Math.abs(Math.atan2(S-l,C-a)-Math.atan2(E,T))<Math.PI/2?([a,l,c,d]=u(this,X).subarray(2,6),u(this,bn).push(NaN,NaN,NaN,NaN,((a+c)/2-n)/o,((l+d)/2-i)/r),[a,l,C,S]=u(this,X).subarray(14,18),u(this,nn).push(NaN,NaN,NaN,NaN,((C+a)/2-n)/o,((S+l)/2-i)/r),!0):([C,S,a,l,c,d]=u(this,X).subarray(0,6),u(this,bn).push(((C+5*a)/6-n)/o,((S+5*l)/6-i)/r,((5*a+c)/6-n)/o,((5*l+d)/6-i)/r,((a+c)/2-n)/o,((l+d)/2-i)/r),[c,d,a,l,C,S]=u(this,X).subarray(12,18),u(this,nn).push(((C+5*a)/6-n)/o,((S+5*l)/6-i)/r,((5*a+c)/6-n)/o,((5*l+d)/6-i)/r,((a+c)/2-n)/o,((l+d)/2-i)/r),!0))}toSVGPath(){if(this.isEmpty())return"";let t=u(this,bn),e=u(this,nn);if(isNaN(u(this,X)[6])&&!this.isEmpty())return w(this,tp,PT).call(this);let n=[];n.push(`M${t[4]} ${t[5]}`);for(let i=6;i<t.length;i+=6)isNaN(t[i])?n.push(`L${t[i+4]} ${t[i+5]}`):n.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);w(this,np,MT).call(this,n);for(let i=e.length-6;i>=6;i-=6)isNaN(e[i])?n.push(`L${e[i+4]} ${e[i+5]}`):n.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);return w(this,ep,RT).call(this,n),n.join(" ")}newFreeDrawOutline(t,e,n,i,o,r){return new Gh(t,e,n,i,o,r)}getOutlines(){var p,g;let t=u(this,bn),e=u(this,nn),n=u(this,X),[i,o,r,a]=u(this,Te),l=new Float32Array(((g=(p=u(this,Wi))==null?void 0:p.length)!=null?g:0)+2);for(let m=0,_=l.length-2;m<_;m+=2)l[m]=(u(this,Wi)[m]-i)/r,l[m+1]=(u(this,Wi)[m+1]-o)/a;if(l[l.length-2]=(u(this,uo)-i)/r,l[l.length-1]=(u(this,ho)-o)/a,isNaN(n[6])&&!this.isEmpty())return w(this,ip,NT).call(this,l);let c=new Float32Array(u(this,bn).length+24+u(this,nn).length),d=t.length;for(let m=0;m<d;m+=2){if(isNaN(t[m])){c[m]=c[m+1]=NaN;continue}c[m]=t[m],c[m+1]=t[m+1]}d=w(this,op,DT).call(this,c,d);for(let m=e.length-6;m>=6;m-=6)for(let _=0;_<6;_+=2){if(isNaN(e[m+_])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=e[m+_],c[d+1]=e[m+_+1],d+=2}return w(this,sp,kT).call(this,c,d),this.newFreeDrawOutline(c,l,u(this,Te),u(this,la),u(this,ra),u(this,aa))}};Te=new WeakMap,nn=new WeakMap,ra=new WeakMap,aa=new WeakMap,bn=new WeakMap,X=new WeakMap,uo=new WeakMap,ho=new WeakMap,ru=new WeakMap,au=new WeakMap,la=new WeakMap,ca=new WeakMap,Wi=new WeakMap,lu=new WeakMap,Qf=new WeakMap,jf=new WeakMap,fo=new WeakSet,ol=function(){let t=u(this,X).subarray(4,6),e=u(this,X).subarray(16,18),[n,i,o,r]=u(this,Te);return[(u(this,uo)+(t[0]-e[0])/2-n)/o,(u(this,ho)+(t[1]-e[1])/2-i)/r,(u(this,uo)+(e[0]-t[0])/2-n)/o,(u(this,ho)+(e[1]-t[1])/2-i)/r]},tp=new WeakSet,PT=function(){let[t,e,n,i]=u(this,Te),[o,r,a,l]=w(this,fo,ol).call(this);return`M${(u(this,X)[2]-t)/n} ${(u(this,X)[3]-e)/i} L${(u(this,X)[4]-t)/n} ${(u(this,X)[5]-e)/i} L${o} ${r} L${a} ${l} L${(u(this,X)[16]-t)/n} ${(u(this,X)[17]-e)/i} L${(u(this,X)[14]-t)/n} ${(u(this,X)[15]-e)/i} Z`},ep=new WeakSet,RT=function(t){let e=u(this,nn);t.push(`L${e[4]} ${e[5]} Z`)},np=new WeakSet,MT=function(t){let[e,n,i,o]=u(this,Te),r=u(this,X).subarray(4,6),a=u(this,X).subarray(16,18),[l,c,d,p]=w(this,fo,ol).call(this);t.push(`L${(r[0]-e)/i} ${(r[1]-n)/o} L${l} ${c} L${d} ${p} L${(a[0]-e)/i} ${(a[1]-n)/o}`)},ip=new WeakSet,NT=function(t){let e=u(this,X),[n,i,o,r]=u(this,Te),[a,l,c,d]=w(this,fo,ol).call(this),p=new Float32Array(36);return p.set([NaN,NaN,NaN,NaN,(e[2]-n)/o,(e[3]-i)/r,NaN,NaN,NaN,NaN,(e[4]-n)/o,(e[5]-i)/r,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(e[16]-n)/o,(e[17]-i)/r,NaN,NaN,NaN,NaN,(e[14]-n)/o,(e[15]-i)/r],0),this.newFreeDrawOutline(p,t,u(this,Te),u(this,la),u(this,ra),u(this,aa))},sp=new WeakSet,kT=function(t,e){let n=u(this,nn);return t.set([NaN,NaN,NaN,NaN,n[4],n[5]],e),e+=6},op=new WeakSet,DT=function(t,e){let n=u(this,X).subarray(4,6),i=u(this,X).subarray(16,18),[o,r,a,l]=u(this,Te),[c,d,p,g]=w(this,fo,ol).call(this);return t.set([NaN,NaN,NaN,NaN,(n[0]-o)/a,(n[1]-r)/l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,p,g,NaN,NaN,NaN,NaN,(i[0]-o)/a,(i[1]-r)/l],e),e+=24},y(Vn,lu,8),y(Vn,Qf,2),y(Vn,jf,u(Vn,lu)+u(Vn,Qf));var $h=Vn,ua,po,ci,cu,Ee,uu,yt,rp,FT,Gh=class extends L{constructor(e,n,i,o,r,a){super();y(this,rp);y(this,ua,void 0);y(this,po,new Float32Array(4));y(this,ci,void 0);y(this,cu,void 0);y(this,Ee,void 0);y(this,uu,void 0);y(this,yt,void 0);v(this,yt,e),v(this,Ee,n),v(this,ua,i),v(this,uu,o),v(this,ci,r),v(this,cu,a),this.lastPoint=[NaN,NaN],w(this,rp,FT).call(this,a);let[l,c,d,p]=u(this,po);for(let g=0,m=e.length;g<m;g+=2)e[g]=(e[g]-l)/d,e[g+1]=(e[g+1]-c)/p;for(let g=0,m=n.length;g<m;g+=2)n[g]=(n[g]-l)/d,n[g+1]=(n[g+1]-c)/p}toSVGPath(){let e=[`M${u(this,yt)[4]} ${u(this,yt)[5]}`];for(let n=6,i=u(this,yt).length;n<i;n+=6){if(isNaN(u(this,yt)[n])){e.push(`L${u(this,yt)[n+4]} ${u(this,yt)[n+5]}`);continue}e.push(`C${u(this,yt)[n]} ${u(this,yt)[n+1]} ${u(this,yt)[n+2]} ${u(this,yt)[n+3]} ${u(this,yt)[n+4]} ${u(this,yt)[n+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,n,i,o],r){let a=i-e,l=o-n,c,d;switch(r){case 0:c=L._rescale(u(this,yt),e,o,a,-l),d=L._rescale(u(this,Ee),e,o,a,-l);break;case 90:c=L._rescaleAndSwap(u(this,yt),e,n,a,l),d=L._rescaleAndSwap(u(this,Ee),e,n,a,l);break;case 180:c=L._rescale(u(this,yt),i,n,-a,l),d=L._rescale(u(this,Ee),i,n,-a,l);break;case 270:c=L._rescaleAndSwap(u(this,yt),i,o,-a,-l),d=L._rescaleAndSwap(u(this,Ee),i,o,-a,-l);break}return{outline:Array.from(c),points:[Array.from(d)]}}get box(){return u(this,po)}newOutliner(e,n,i,o,r,a=0){return new $h(e,n,i,o,r,a)}getNewOutline(e,n){let[i,o,r,a]=u(this,po),[l,c,d,p]=u(this,ua),g=r*d,m=a*p,_=i*d+l,A=o*p+c,T=this.newOutliner({x:u(this,Ee)[0]*g+_,y:u(this,Ee)[1]*m+A},u(this,ua),u(this,uu),e,u(this,cu),n!=null?n:u(this,ci));for(let E=2;E<u(this,Ee).length;E+=2)T.add({x:u(this,Ee)[E]*g+_,y:u(this,Ee)[E+1]*m+A});return T.getOutlines()}};ua=new WeakMap,po=new WeakMap,ci=new WeakMap,cu=new WeakMap,Ee=new WeakMap,uu=new WeakMap,yt=new WeakMap,rp=new WeakSet,FT=function(e){let n=u(this,yt),i=n[4],o=n[5],r=i,a=o,l=i,c=o,d=i,p=o,g=e?Math.max:Math.min;for(let _=6,A=n.length;_<A;_+=6){if(isNaN(n[_]))r=Math.min(r,n[_+4]),a=Math.min(a,n[_+5]),l=Math.max(l,n[_+4]),c=Math.max(c,n[_+5]),p<n[_+5]?(d=n[_+4],p=n[_+5]):p===n[_+5]&&(d=g(d,n[_+4]));else{let T=$.bezierBoundingBox(i,o,...n.slice(_,_+6));r=Math.min(r,T[0]),a=Math.min(a,T[1]),l=Math.max(l,T[2]),c=Math.max(c,T[3]),p<T[3]?(d=T[2],p=T[3]):p===T[3]&&(d=g(d,T[2]))}i=n[_+4],o=n[_+5]}let m=u(this,po);m[0]=r-u(this,ci),m[1]=a-u(this,ci),m[2]=l-r+2*u(this,ci),m[3]=c-a+2*u(this,ci),this.lastPoint=[d,p]};var du,hu,Ki,sn,ap,LT,da,oh,lp,UT,cp,OT,fu,Xy,bl=class{constructor(t,e=0,n=0,i=!0){y(this,ap);y(this,da);y(this,lp);y(this,cp);y(this,fu);y(this,du,void 0);y(this,hu,void 0);y(this,Ki,[]);y(this,sn,[]);let o=1/0,r=-1/0,a=1/0,l=-1/0,d=10**-4;for(let{x:E,y:C,width:S,height:b}of t){let x=Math.floor((E-e)/d)*d,P=Math.ceil((E+S+e)/d)*d,I=Math.floor((C-e)/d)*d,N=Math.ceil((C+b+e)/d)*d,M=[x,I,N,!0],F=[P,I,N,!1];u(this,Ki).push(M,F),o=Math.min(o,x),r=Math.max(r,P),a=Math.min(a,I),l=Math.max(l,N)}let p=r-o+2*n,g=l-a+2*n,m=o-n,_=a-n,A=u(this,Ki).at(i?-1:-2),T=[A[0],A[2]];for(let E of u(this,Ki)){let[C,S,b]=E;E[0]=(C-m)/p,E[1]=(S-_)/g,E[2]=(b-_)/g}v(this,du,new Float32Array([m,_,p,g])),v(this,hu,T)}getOutlines(){u(this,Ki).sort((e,n)=>e[0]-n[0]||e[1]-n[1]||e[2]-n[2]);let t=[];for(let e of u(this,Ki))e[3]?(t.push(...w(this,fu,Xy).call(this,e)),w(this,lp,UT).call(this,e)):(w(this,cp,OT).call(this,e),t.push(...w(this,fu,Xy).call(this,e)));return w(this,ap,LT).call(this,t)}};du=new WeakMap,hu=new WeakMap,Ki=new WeakMap,sn=new WeakMap,ap=new WeakSet,LT=function(t){let e=[],n=new Set;for(let r of t){let[a,l,c]=r;e.push([a,l,r],[a,c,r])}e.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=e.length;r<a;r+=2){let l=e[r][2],c=e[r+1][2];l.push(c),c.push(l),n.add(l),n.add(c)}let i=[],o;for(;n.size>0;){let r=n.values().next().value,[a,l,c,d,p]=r;n.delete(r);let g=a,m=l;for(o=[a,c],i.push(o);;){let _;if(n.has(d))_=d;else if(n.has(p))_=p;else break;n.delete(_),[a,l,c,d,p]=_,g!==a&&(o.push(g,m,a,m===l?l:c),g=a),m=m===l?c:l}o.push(g,m)}return new Zy(i,u(this,du),u(this,hu))},da=new WeakSet,oh=function(t){let e=u(this,sn),n=0,i=e.length-1;for(;n<=i;){let o=n+i>>1,r=e[o][0];if(r===t)return o;r<t?n=o+1:i=o-1}return i+1},lp=new WeakSet,UT=function([,t,e]){let n=w(this,da,oh).call(this,t);u(this,sn).splice(n,0,[t,e])},cp=new WeakSet,OT=function([,t,e]){let n=w(this,da,oh).call(this,t);for(let i=n;i<u(this,sn).length;i++){let[o,r]=u(this,sn)[i];if(o!==t)break;if(o===t&&r===e){u(this,sn).splice(i,1);return}}for(let i=n-1;i>=0;i--){let[o,r]=u(this,sn)[i];if(o!==t)break;if(o===t&&r===e){u(this,sn).splice(i,1);return}}},fu=new WeakSet,Xy=function(t){let[e,n,i]=t,o=[[e,n,i]],r=w(this,da,oh).call(this,i);for(let a=0;a<r;a++){let[l,c]=u(this,sn)[a];for(let d=0,p=o.length;d<p;d++){let[,g,m]=o[d];if(!(c<=g||m<=l)){if(g>=l){if(m>c)o[d][1]=c;else{if(p===1)return[];o.splice(d,1),d--,p--}continue}o[d][2]=l,m>c&&o.push([e,c,m])}}}return o};var pu,ha,Zy=class extends L{constructor(e,n,i){super();y(this,pu,void 0);y(this,ha,void 0);v(this,ha,e),v(this,pu,n),this.lastPoint=i}toSVGPath(){let e=[];for(let n of u(this,ha)){let[i,o]=n;e.push(`M${i} ${o}`);for(let r=2;r<n.length;r+=2){let a=n[r],l=n[r+1];a===i?(e.push(`V${l}`),o=l):l===o&&(e.push(`H${a}`),i=a)}e.push("Z")}return e.join(" ")}serialize([e,n,i,o],r){let a=[],l=i-e,c=o-n;for(let d of u(this,ha)){let p=new Array(d.length);for(let g=0;g<d.length;g+=2)p[g]=e+d[g]*l,p[g+1]=o-d[g+1]*c;a.push(p)}return a}get box(){return u(this,pu)}get classNamesForOutlining(){return["highlightOutline"]}};pu=new WeakMap,ha=new WeakMap;var xl=class extends $h{newFreeDrawOutline(t,e,n,i,o,r){return new Qy(t,e,n,i,o,r)}},Qy=class extends Gh{newOutliner(t,e,n,i,o,r=0){return new xl(t,e,n,i,o,r)}},on,go,fa,St,gu,pa,mu,yu,Yi,rn,ga,_u,vu,jy,Au,t_,wu,e_,ui,ds,up,$T,xn,wi,ue=class ue{constructor({editor:t=null,uiManager:e=null}){y(this,vu);y(this,Au);y(this,wu);y(this,ui);y(this,up);y(this,xn);y(this,on,null);y(this,go,null);y(this,fa,void 0);y(this,St,null);y(this,gu,!1);y(this,pa,!1);y(this,mu,null);y(this,yu,void 0);y(this,Yi,null);y(this,rn,null);y(this,ga,void 0);var n;t?(v(this,pa,!1),v(this,ga,Q.HIGHLIGHT_COLOR),v(this,mu,t)):(v(this,pa,!0),v(this,ga,Q.HIGHLIGHT_DEFAULT_COLOR)),v(this,rn,(t==null?void 0:t._uiManager)||e),v(this,yu,u(this,rn)._eventBus),v(this,fa,(t==null?void 0:t.color)||((n=u(this,rn))==null?void 0:n.highlightColors.values().next().value)||"#FFFF98"),u(ue,_u)||v(ue,_u,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Z(this,"_keyboardManager",new Lo([[["Escape","mac+Escape"],ue.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ue.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ue.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ue.prototype._moveToPrevious],[["Home","mac+Home"],ue.prototype._moveToBeginning],[["End","mac+End"],ue.prototype._moveToEnd]]))}renderButton(){let t=v(this,on,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);let e=u(this,rn)._signal;t.addEventListener("click",w(this,ui,ds).bind(this),{signal:e}),t.addEventListener("keydown",w(this,wu,e_).bind(this),{signal:e});let n=v(this,go,document.createElement("span"));return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=u(this,fa),t.append(n),t}renderMainDropdown(){let t=v(this,St,w(this,vu,jy).call(this));return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}_colorSelectFromKeyboard(t){if(t.target===u(this,on)){w(this,ui,ds).call(this,t);return}let e=t.target.getAttribute("data-color");e&&w(this,Au,t_).call(this,e,t)}_moveToNext(t){var e,n;if(!u(this,xn,wi)){w(this,ui,ds).call(this,t);return}if(t.target===u(this,on)){(e=u(this,St).firstChild)==null||e.focus();return}(n=t.target.nextSibling)==null||n.focus()}_moveToPrevious(t){var e,n;if(t.target===((e=u(this,St))==null?void 0:e.firstChild)||t.target===u(this,on)){u(this,xn,wi)&&this._hideDropdownFromKeyboard();return}u(this,xn,wi)||w(this,ui,ds).call(this,t),(n=t.target.previousSibling)==null||n.focus()}_moveToBeginning(t){var e;if(!u(this,xn,wi)){w(this,ui,ds).call(this,t);return}(e=u(this,St).firstChild)==null||e.focus()}_moveToEnd(t){var e;if(!u(this,xn,wi)){w(this,ui,ds).call(this,t);return}(e=u(this,St).lastChild)==null||e.focus()}hideDropdown(){var t,e;(t=u(this,St))==null||t.classList.add("hidden"),(e=u(this,Yi))==null||e.abort(),v(this,Yi,null)}_hideDropdownFromKeyboard(){var t;if(!u(this,pa)){if(!u(this,xn,wi)){(t=u(this,mu))==null||t.unselect();return}this.hideDropdown(),u(this,on).focus({preventScroll:!0,focusVisible:u(this,gu)})}}updateColor(t){if(u(this,go)&&(u(this,go).style.backgroundColor=t),!u(this,St))return;let e=u(this,rn).highlightColors.values();for(let n of u(this,St).children)n.setAttribute("aria-selected",e.next().value===t)}destroy(){var t,e;(t=u(this,on))==null||t.remove(),v(this,on,null),v(this,go,null),(e=u(this,St))==null||e.remove(),v(this,St,null)}};on=new WeakMap,go=new WeakMap,fa=new WeakMap,St=new WeakMap,gu=new WeakMap,pa=new WeakMap,mu=new WeakMap,yu=new WeakMap,Yi=new WeakMap,rn=new WeakMap,ga=new WeakMap,_u=new WeakMap,vu=new WeakSet,jy=function(){let t=document.createElement("div"),e=u(this,rn)._signal;t.addEventListener("contextmenu",dn,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[n,i]of u(this,rn).highlightColors){let o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",i),o.title=n,o.setAttribute("data-l10n-id",u(ue,_u)[n]);let r=document.createElement("span");o.append(r),r.className="swatch",r.style.backgroundColor=i,o.setAttribute("aria-selected",i===u(this,fa)),o.addEventListener("click",w(this,Au,t_).bind(this,i),{signal:e}),t.append(o)}return t.addEventListener("keydown",w(this,wu,e_).bind(this),{signal:e}),t},Au=new WeakSet,t_=function(t,e){e.stopPropagation(),u(this,yu).dispatch("switchannotationeditorparams",{source:this,type:u(this,ga),value:t})},wu=new WeakSet,e_=function(t){ue._keyboardManager.exec(this,t)},ui=new WeakSet,ds=function(t){if(u(this,xn,wi)){this.hideDropdown();return}if(v(this,gu,t.detail===0),u(this,Yi)||(v(this,Yi,new AbortController),window.addEventListener("pointerdown",w(this,up,$T).bind(this),{signal:u(this,rn).combinedSignal(u(this,Yi))})),u(this,St)){u(this,St).classList.remove("hidden");return}let e=v(this,St,w(this,vu,jy).call(this));u(this,on).append(e)},up=new WeakSet,$T=function(t){var e;(e=u(this,St))!=null&&e.contains(t.target)||this.hideDropdown()},xn=new WeakSet,wi=function(){return u(this,St)&&!u(this,St).classList.contains("hidden")},y(ue,_u,null);var Bh=ue,ma,Tu,di,mo,ya,fe,Eu,Cu,yo,Ue,Ce,Ut,_a,hi,Jt,va,Oe,Su,bu,n_,Aa,rh,dp,GT,hp,BT,fp,HT,xu,i_,fi,hs,Ji,nr,pp,VT,wa,ah,_o,rl,gp,qT,mp,zT,yp,WT,_p,KT,vp,YT,tt=class tt extends ft{constructor(e){super({...e,name:"highlightEditor"});y(this,bu);y(this,Aa);y(this,dp);y(this,hp);y(this,fp);y(this,xu);y(this,fi);y(this,pp);y(this,wa);y(this,_o);y(this,gp);y(this,mp);y(this,vp);y(this,ma,null);y(this,Tu,0);y(this,di,void 0);y(this,mo,null);y(this,ya,null);y(this,fe,null);y(this,Eu,null);y(this,Cu,0);y(this,yo,null);y(this,Ue,null);y(this,Ce,null);y(this,Ut,!1);y(this,_a,null);y(this,hi,void 0);y(this,Jt,null);y(this,va,"");y(this,Oe,void 0);y(this,Su,"");this.color=e.color||tt._defaultColor,v(this,Oe,e.thickness||tt._defaultThickness),v(this,hi,e.opacity||tt._defaultOpacity),v(this,di,e.boxes||null),v(this,Su,e.methodOfCreation||""),v(this,va,e.text||""),this._isDraggable=!1,e.highlightId>-1?(v(this,Ut,!0),w(this,Aa,rh).call(this,e),w(this,fi,hs).call(this)):u(this,di)&&(v(this,ma,e.anchorNode),v(this,Tu,e.anchorOffset),v(this,Eu,e.focusNode),v(this,Cu,e.focusOffset),w(this,bu,n_).call(this),w(this,fi,hs).call(this),this.rotate(this.rotation))}static get _keyboardManager(){let e=tt.prototype;return Z(this,"_keyboardManager",new Lo([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:u(this,Ut)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:u(this,Oe),methodOfCreation:u(this,Su)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}static initialize(e,n){var i;ft.initialize(e,n),tt._defaultColor||(tt._defaultColor=((i=n.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(e,n){switch(e){case Q.HIGHLIGHT_DEFAULT_COLOR:tt._defaultColor=n;break;case Q.HIGHLIGHT_THICKNESS:tt._defaultThickness=n;break}}translateInPage(e,n){}get toolbarPosition(){return u(this,_a)}updateParams(e,n){switch(e){case Q.HIGHLIGHT_COLOR:w(this,dp,GT).call(this,n);break;case Q.HIGHLIGHT_THICKNESS:w(this,hp,BT).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Q.HIGHLIGHT_DEFAULT_COLOR,tt._defaultColor],[Q.HIGHLIGHT_THICKNESS,tt._defaultThickness]]}get propertiesToUpdate(){return[[Q.HIGHLIGHT_COLOR,this.color||tt._defaultColor],[Q.HIGHLIGHT_THICKNESS,u(this,Oe)||tt._defaultThickness],[Q.HIGHLIGHT_FREE,u(this,Ut)]]}async addEditToolbar(){let e=await super.addEditToolbar();return e?(this._uiManager.highlightColors&&(v(this,ya,new Bh({editor:this})),e.addColorPicker(u(this,ya))),e):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(w(this,_o,rl).call(this))}getBaseTranslation(){return[0,0]}getRect(e,n){return super.getRect(e,n,w(this,_o,rl).call(this))}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){w(this,xu,i_).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(w(this,fi,hs).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var i;let n=!1;this.parent&&!e?w(this,xu,i_).call(this):e&&(w(this,fi,hs).call(this,e),n=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(e),this.show(this._isVisible),n&&this.select()}rotate(e){var o,r,a;let{drawLayer:n}=this.parent,i;u(this,Ut)?(e=(e-this.rotation+360)%360,i=w(o=tt,Ji,nr).call(o,u(this,Ue).box,e)):i=w(r=tt,Ji,nr).call(r,[this.x,this.y,this.width,this.height],e),n.updateProperties(u(this,Ce),{bbox:i,root:{"data-main-rotation":e}}),n.updateProperties(u(this,Jt),{bbox:w(a=tt,Ji,nr).call(a,u(this,fe).box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;let e=super.render();u(this,va)&&(e.setAttribute("aria-label",u(this,va)),e.setAttribute("role","mark")),u(this,Ut)?e.classList.add("free"):this.div.addEventListener("keydown",w(this,pp,VT).bind(this),{signal:this._uiManager._signal});let n=v(this,yo,document.createElement("div"));e.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=u(this,mo);let[i,o]=this.parentDimensions;return this.setDims(this.width*i,this.height*o),mh(this,u(this,yo),["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(u(this,Jt),{rootClass:{hovered:!0}})}pointerleave(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(u(this,Jt),{rootClass:{hovered:!1}})}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:w(this,wa,ah).call(this,!0);break;case 1:case 3:w(this,wa,ah).call(this,!1);break}}select(){var e;super.select(),u(this,Jt)&&((e=this.parent)==null||e.drawLayer.updateProperties(u(this,Jt),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var e;super.unselect(),u(this,Jt)&&((e=this.parent)==null||e.drawLayer.updateProperties(u(this,Jt),{rootClass:{selected:!1}}),u(this,Ut)||w(this,wa,ah).call(this,!1))}get _mustFixPosition(){return!u(this,Ut)}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(u(this,Ce),{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(u(this,Jt),{rootClass:{hidden:!e}}))}static startHighlighting(e,n,{target:i,x:o,y:r}){let{x:a,y:l,width:c,height:d}=i.getBoundingClientRect(),p=new AbortController,g=e.combinedSignal(p),m=_=>{p.abort(),w(this,_p,KT).call(this,e,_)};window.addEventListener("blur",m,{signal:g}),window.addEventListener("pointerup",m,{signal:g}),window.addEventListener("pointerdown",Pe,{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",dn,{signal:g}),i.addEventListener("pointermove",w(this,yp,WT).bind(this,e),{signal:g}),this._freeHighlight=new xl({x:o,y:r},[a,l,c,d],e.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(e,n,i){var A,T,E,C;let o=null;if(e instanceof Uh){let{data:{quadPoints:S,rect:b,rotation:x,id:P,color:I,opacity:N,popupRef:M},parent:{page:{pageNumber:F}}}=e;o=e={annotationType:K.HIGHLIGHT,color:Array.from(I),opacity:N,quadPoints:S,boxes:null,pageIndex:F-1,rect:b.slice(0),rotation:x,id:P,deleted:!1,popupRef:M}}else if(e instanceof Sl){let{data:{inkLists:S,rect:b,rotation:x,id:P,color:I,borderStyle:{rawWidth:N},popupRef:M},parent:{page:{pageNumber:F}}}=e;o=e={annotationType:K.HIGHLIGHT,color:Array.from(I),thickness:N,inkLists:S,boxes:null,pageIndex:F-1,rect:b.slice(0),rotation:x,id:P,deleted:!1,popupRef:M}}let{color:r,quadPoints:a,inkLists:l,opacity:c}=e,d=await super.deserialize(e,n,i);d.color=$.makeHexColor(...r),v(d,hi,c||1),l&&v(d,Oe,e.thickness),d.annotationElementId=e.id||null,d._initialData=o;let[p,g]=d.pageDimensions,[m,_]=d.pageTranslation;if(a){let S=v(d,di,[]);for(let b=0;b<a.length;b+=8)S.push({x:(a[b]-m)/p,y:1-(a[b+1]-_)/g,width:(a[b+2]-a[b])/p,height:(a[b+1]-a[b+5])/g});w(A=d,bu,n_).call(A),w(T=d,fi,hs).call(T),d.rotate(d.rotation)}else if(l){v(d,Ut,!0);let S=l[0],b={x:S[0]-m,y:g-(S[1]-_)},x=new xl(b,[0,0,p,g],1,u(d,Oe)/2,!0,.001);for(let N=0,M=S.length;N<M;N+=2)b.x=S[N]-m,b.y=g-(S[N+1]-_),x.add(b);let{id:P,clipPathId:I}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:x.toSVGPath()}},!0,!0);w(E=d,Aa,rh).call(E,{highlightOutlines:x.getOutlines(),highlightId:P,clipPathId:I}),w(C=d,fi,hs).call(C)}return d}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();let n=this.getRect(0,0),i=ft._colorManager.convert(this.color),o={annotationType:K.HIGHLIGHT,color:i,opacity:u(this,hi),thickness:u(this,Oe),quadPoints:w(this,gp,qT).call(this),outlines:w(this,mp,zT).call(this,n),pageIndex:this.pageIndex,rect:n,rotation:w(this,_o,rl).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!w(this,vp,YT).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};ma=new WeakMap,Tu=new WeakMap,di=new WeakMap,mo=new WeakMap,ya=new WeakMap,fe=new WeakMap,Eu=new WeakMap,Cu=new WeakMap,yo=new WeakMap,Ue=new WeakMap,Ce=new WeakMap,Ut=new WeakMap,_a=new WeakMap,hi=new WeakMap,Jt=new WeakMap,va=new WeakMap,Oe=new WeakMap,Su=new WeakMap,bu=new WeakSet,n_=function(){let e=new bl(u(this,di),.001);v(this,Ue,e.getOutlines()),[this.x,this.y,this.width,this.height]=u(this,Ue).box;let n=new bl(u(this,di),.0025,.001,this._uiManager.direction==="ltr");v(this,fe,n.getOutlines());let{lastPoint:i}=u(this,fe);v(this,_a,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},Aa=new WeakSet,rh=function({highlightOutlines:e,highlightId:n,clipPathId:i}){var p,g;if(v(this,Ue,e),v(this,fe,e.getNewOutline(u(this,Oe)/2+1.5,.0025)),n>=0)v(this,Ce,n),v(this,mo,i),this.parent.drawLayer.finalizeDraw(n,{bbox:e.box,path:{d:e.toSVGPath()}}),v(this,Jt,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:u(this,fe).box,path:{d:u(this,fe).toSVGPath()}},!0));else if(this.parent){let m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(u(this,Ce),{bbox:w(p=tt,Ji,nr).call(p,u(this,Ue).box,(m-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(u(this,Jt),{bbox:w(g=tt,Ji,nr).call(g,u(this,fe).box,m),path:{d:u(this,fe).toSVGPath()}})}let[r,a,l,c]=e.box;switch(this.rotation){case 0:this.x=r,this.y=a,this.width=l,this.height=c;break;case 90:{let[m,_]=this.parentDimensions;this.x=a,this.y=1-r,this.width=l*_/m,this.height=c*m/_;break}case 180:this.x=1-r,this.y=1-a,this.width=l,this.height=c;break;case 270:{let[m,_]=this.parentDimensions;this.x=1-a,this.y=r,this.width=l*_/m,this.height=c*m/_;break}}let{lastPoint:d}=u(this,fe);v(this,_a,[(d[0]-r)/l,(d[1]-a)/c])},dp=new WeakSet,GT=function(e){let n=(r,a)=>{var l,c;this.color=r,v(this,hi,a),(l=this.parent)==null||l.drawLayer.updateProperties(u(this,Ce),{root:{fill:r,"fill-opacity":a}}),(c=u(this,ya))==null||c.updateColor(r)},i=this.color,o=u(this,hi);this.addCommands({cmd:n.bind(this,e,tt._defaultOpacity),undo:n.bind(this,i,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)},hp=new WeakSet,BT=function(e){let n=u(this,Oe),i=o=>{v(this,Oe,o),w(this,fp,HT).call(this,o)};this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)},fp=new WeakSet,HT=function(e){if(!u(this,Ut))return;w(this,Aa,rh).call(this,{highlightOutlines:u(this,Ue).getNewOutline(e/2)}),this.fixAndSetPosition();let[n,i]=this.parentDimensions;this.setDims(this.width*n,this.height*i)},xu=new WeakSet,i_=function(){u(this,Ce)===null||!this.parent||(this.parent.drawLayer.remove(u(this,Ce)),v(this,Ce,null),this.parent.drawLayer.remove(u(this,Jt)),v(this,Jt,null))},fi=new WeakSet,hs=function(e=this.parent){u(this,Ce)===null&&({id:jt(this,Ce)._,clipPathId:jt(this,mo)._}=e.drawLayer.draw({bbox:u(this,Ue).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":u(this,hi)},rootClass:{highlight:!0,free:u(this,Ut)},path:{d:u(this,Ue).toSVGPath()}},!1,!0),v(this,Jt,e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:u(this,Ut)},bbox:u(this,fe).box,path:{d:u(this,fe).toSVGPath()}},u(this,Ut))),u(this,yo)&&(u(this,yo).style.clipPath=u(this,mo)))},Ji=new WeakSet,nr=function([e,n,i,o],r){switch(r){case 90:return[1-n-o,e,o,i];case 180:return[1-e-i,1-n-o,i,o];case 270:return[n,1-e-i,o,i]}return[e,n,i,o]},pp=new WeakSet,VT=function(e){tt._keyboardManager.exec(this,e)},wa=new WeakSet,ah=function(e){if(!u(this,ma))return;let n=window.getSelection();e?n.setPosition(u(this,ma),u(this,Tu)):n.setPosition(u(this,Eu),u(this,Cu))},_o=new WeakSet,rl=function(){return u(this,Ut)?this.rotation:0},gp=new WeakSet,qT=function(){if(u(this,Ut))return null;let[e,n]=this.pageDimensions,[i,o]=this.pageTranslation,r=u(this,di),a=new Float32Array(r.length*8),l=0;for(let{x:c,y:d,width:p,height:g}of r){let m=c*e+i,_=(1-d)*n+o;a[l]=a[l+4]=m,a[l+1]=a[l+3]=_,a[l+2]=a[l+6]=m+p*e,a[l+5]=a[l+7]=_-g*n,l+=8}return a},mp=new WeakSet,zT=function(e){return u(this,Ue).serialize(e,w(this,_o,rl).call(this))},yp=new WeakSet,WT=function(e,n){this._freeHighlight.add(n)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},_p=new WeakSet,KT=function(e,n){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},vp=new WeakSet,YT=function(e){let{color:n}=this._initialData;return e.color.some((i,o)=>i!==n[o])},y(tt,Ji),y(tt,yp),y(tt,_p),H(tt,"_defaultColor",null),H(tt,"_defaultOpacity",1),H(tt,"_defaultThickness",12),H(tt,"_type","highlight"),H(tt,"_editorType",K.HIGHLIGHT),H(tt,"_freeHighlightId",-1),H(tt,"_freeHighlight",null),H(tt,"_freeHighlightClipId","");var Hh=tt,vo,s_=class{constructor(){y(this,vo,Object.create(null))}updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(let[e,n]of Object.entries(t))this.updateProperty(e,n)}updateSVGProperty(t,e){u(this,vo)[t]=e}toSVGProperties(){let t=u(this,vo);return v(this,vo,Object.create(null)),{root:t}}reset(){v(this,vo,Object.create(null))}updateAll(t=this){this.updateProperties(t)}clone(){ot("Not implemented")}};vo=new WeakMap;var Se,Ta,Mt,Ao,wo,Xi,Zi,Qi,To,Iu,r_,Pu,a_,Ru,l_,Eo,al,Ap,JT,Ea,lh,Co,ll,ji,ir,O=class O extends ft{constructor(e){super(e);y(this,Iu);y(this,Pu);y(this,Ru);y(this,Eo);y(this,Ap);y(this,Ea);y(this,Co);y(this,ji);y(this,Se,null);y(this,Ta,void 0);H(this,"_drawId",null);v(this,Ta,e.mustBeCommitted||!1),e.drawOutlines&&(w(this,Iu,r_).call(this,e),w(this,Eo,al).call(this))}static _mergeSVGProperties(e,n){let i=new Set(Object.keys(e));for(let[o,r]of Object.entries(n))i.has(o)?Object.assign(e[o],r):e[o]=r;return e}static getDefaultDrawingOptions(e){ot("Not implemented")}static get typesMap(){ot("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,n){let i=this.typesMap.get(e);i&&this._defaultDrawingOptions.updateProperty(i,n),this._currentParent&&(u(O,Mt).updateProperty(i,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,n){let i=this.constructor.typesMap.get(e);i&&this._updateProperty(e,i,n)}static get defaultPropertiesToUpdate(){let e=[],n=this._defaultDrawingOptions;for(let[i,o]of this.typesMap)e.push([i,n[o]]);return e}get propertiesToUpdate(){let e=[],{_drawingOptions:n}=this;for(let[i,o]of this.constructor.typesMap)e.push([i,n[o]]);return e}_updateProperty(e,n,i){let o=this._drawingOptions,r=o[n],a=l=>{var d;o.updateProperty(n,l);let c=u(this,Se).updateProperty(n,l);c&&w(this,Co,ll).call(this,c),(d=this.parent)==null||d.drawLayer.updateProperties(this._drawId,o.toSVGProperties())};this.addCommands({cmd:a.bind(this,i),undo:a.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,O._mergeSVGProperties(u(this,Se).getPathResizingSVGProperties(w(this,Ea,lh).call(this)),{bbox:w(this,ji,ir).call(this)}))}_onResized(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,O._mergeSVGProperties(u(this,Se).getPathResizedSVGProperties(w(this,Ea,lh).call(this)),{bbox:w(this,ji,ir).call(this)}))}_onTranslating(e,n){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:w(this,ji,ir).call(this,e,n)})}_onTranslated(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,O._mergeSVGProperties(u(this,Se).getPathTranslatedSVGProperties(w(this,Ea,lh).call(this),this.parentDimensions),{bbox:w(this,ji,ir).call(this)}))}_onStartDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,u(this,Ta)&&(v(this,Ta,!1),this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){w(this,Ru,l_).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(w(this,Eo,al).call(this),w(this,Co,ll).call(this,u(this,Se).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var i;let n=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),w(this,Ru,l_).call(this)):e&&(this._uiManager.addShouldRescale(this),w(this,Eo,al).call(this,e),n=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(e),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,O._mergeSVGProperties({bbox:w(this,ji,ir).call(this)},u(this,Se).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&w(this,Co,ll).call(this,u(this,Se).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e=super.render();e.classList.add("draw");let n=document.createElement("div");e.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";let[i,o]=this.parentDimensions;return this.setDims(this.width*i,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),e}static createDrawerInstance(e,n,i,o,r){ot("Not implemented")}static startDrawing(e,n,i,o){var T,E;let{target:r,offsetX:a,offsetY:l,pointerId:c,pointerType:d}=o;if(u(O,Zi)&&u(O,Zi)!==d)return;let{viewport:{rotation:p}}=e,{width:g,height:m}=r.getBoundingClientRect(),_=v(O,Ao,new AbortController),A=e.combinedSignal(_);if(u(O,Xi)||v(O,Xi,c),(T=u(O,Zi))!=null||v(O,Zi,d),window.addEventListener("pointerup",C=>{var S;u(O,Xi)===C.pointerId?this._endDraw(C):(S=u(O,Qi))==null||S.delete(C.pointerId)},{signal:A}),window.addEventListener("pointercancel",C=>{var S;u(O,Xi)===C.pointerId?this._currentParent.endDrawingSession():(S=u(O,Qi))==null||S.delete(C.pointerId)},{signal:A}),window.addEventListener("pointerdown",C=>{u(O,Zi)===C.pointerType&&((u(O,Qi)||v(O,Qi,new Set)).add(C.pointerId),u(O,Mt).isCancellable()&&(u(O,Mt).removeLastElement(),u(O,Mt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:A}),window.addEventListener("contextmenu",dn,{signal:A}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:A}),r.addEventListener("touchmove",C=>{C.timeStamp===u(O,To)&&Pe(C)},{signal:A}),e.toggleDrawing(),(E=n._editorUndoBar)==null||E.hide(),u(O,Mt)){e.drawLayer.updateProperties(this._currentDrawId,u(O,Mt).startNew(a,l,g,m,p));return}n.updateUIForDefaultProperties(this),v(O,Mt,this.createDrawerInstance(a,l,g,m,p)),v(O,wo,this.getDefaultDrawingOptions()),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(u(O,wo).toSVGProperties(),u(O,Mt).defaultSVGProperties),!0,!1)}static _drawMove(e){var r;if(v(O,To,-1),!u(O,Mt))return;let{offsetX:n,offsetY:i,pointerId:o}=e;if(u(O,Xi)===o){if(((r=u(O,Qi))==null?void 0:r.size)>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,u(O,Mt).add(n,i)),v(O,To,e.timeStamp),Pe(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,v(O,Mt,null),v(O,wo,null),v(O,Zi,null),v(O,To,NaN)),u(O,Ao)&&(u(O,Ao).abort(),v(O,Ao,null),v(O,Xi,NaN),v(O,Qi,null))}static _endDraw(e){let n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),e&&n.drawLayer.updateProperties(this._currentDrawId,u(O,Mt).end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){let i=u(O,Mt),o=this._currentDrawId,r=i.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(o,i.setLastElement(r))},undo:()=>{n.drawLayer.updateProperties(o,i.removeLastElement())},mustExec:!1,type:Q.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){let n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(Q.DRAW_STEP),!u(O,Mt).isEmpty()){let{pageDimensions:[i,o],scale:r}=n,a=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:u(O,Mt).getOutlines(i*r,o*r,r,this._INNER_MARGIN),drawingOptions:u(O,wo),mustBeCommitted:!e});return this._cleanup(!0),a}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,n,i,o,r,a){ot("Not implemented")}static async deserialize(e,n,i){var p,g;let{rawDims:{pageWidth:o,pageHeight:r,pageX:a,pageY:l}}=n.viewport,c=this.deserializeDraw(a,l,o,r,this._INNER_MARGIN,e),d=await super.deserialize(e,n,i);return d.createDrawingOptions(e),w(p=d,Iu,r_).call(p,{drawOutlines:c}),w(g=d,Eo,al).call(g),d.onScaleChanging(),d.rotate(),d}serializeDraw(e){let[n,i]=this.pageTranslation,[o,r]=this.pageDimensions;return u(this,Se).serialize([n,i,o,r],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Se=new WeakMap,Ta=new WeakMap,Mt=new WeakMap,Ao=new WeakMap,wo=new WeakMap,Xi=new WeakMap,Zi=new WeakMap,Qi=new WeakMap,To=new WeakMap,Iu=new WeakSet,r_=function({drawOutlines:e,drawId:n,drawingOptions:i}){v(this,Se,e),this._drawingOptions||(this._drawingOptions=i),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,e.defaultProperties)):this._drawId=w(this,Pu,a_).call(this,e,this.parent),w(this,Co,ll).call(this,e.box)},Pu=new WeakSet,a_=function(e,n){let{id:i}=n.drawLayer.draw(O._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return i},Ru=new WeakSet,l_=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Eo=new WeakSet,al=function(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=w(this,Pu,a_).call(this,u(this,Se),e)}},Ap=new WeakSet,JT=function([e,n,i,o]){let{parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[n,1-e,i*(a/r),o*(r/a)];case 180:return[1-e,1-n,i,o];case 270:return[1-n,e,i*(a/r),o*(r/a)];default:return[e,n,i,o]}},Ea=new WeakSet,lh=function(){let{x:e,y:n,width:i,height:o,parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[1-n,e,i*(r/a),o*(a/r)];case 180:return[1-e,1-n,i,o];case 270:return[n,1-e,i*(r/a),o*(a/r)];default:return[e,n,i,o]}},Co=new WeakSet,ll=function(e){if([this.x,this.y,this.width,this.height]=w(this,Ap,JT).call(this,e),this.div){this.fixAndSetPosition();let[n,i]=this.parentDimensions;this.setDims(this.width*n,this.height*i)}this._onResized()},ji=new WeakSet,ir=function(){let{x:e,y:n,width:i,height:o,rotation:r,parentRotation:a,parentDimensions:[l,c]}=this;switch((r*4+a)/90){case 1:return[1-n-o,e,o,i];case 2:return[1-e-i,1-n-o,i,o];case 3:return[n,1-e-i,o,i];case 4:return[e,n-i*(l/c),o*(c/l),i*(l/c)];case 5:return[1-n,e,i*(l/c),o*(c/l)];case 6:return[1-e-o*(c/l),1-n,o*(c/l),i*(l/c)];case 7:return[n-i*(l/c),1-e-o*(c/l),i*(l/c),o*(c/l)];case 8:return[e-i,n-o,i,o];case 9:return[1-n,e-i,o,i];case 10:return[1-e,1-n,i,o];case 11:return[n-o,1-e,o,i];case 12:return[e-o*(c/l),n,o*(c/l),i*(l/c)];case 13:return[1-n-i*(l/c),e-o*(c/l),i*(l/c),o*(c/l)];case 14:return[1-e,1-n-i*(l/c),o*(c/l),i*(l/c)];case 15:return[n,1-e,i*(l/c),o*(c/l)];default:return[e,n,i,o]}},H(O,"_currentDrawId",-1),H(O,"_currentParent",null),y(O,Mt,null),y(O,Ao,null),y(O,wo,null),y(O,Xi,NaN),y(O,Zi,null),y(O,Qi,null),y(O,To,NaN),H(O,"_INNER_MARGIN",3);var o_=O,In,Nt,kt,So,Ca,ie,Ot,$e,bo,xo,Io,Sa,ch,c_=class{constructor(t,e,n,i,o,r){y(this,Sa);y(this,In,new Float64Array(6));y(this,Nt,void 0);y(this,kt,void 0);y(this,So,void 0);y(this,Ca,void 0);y(this,ie,void 0);y(this,Ot,"");y(this,$e,0);y(this,bo,new Vh);y(this,xo,void 0);y(this,Io,void 0);v(this,xo,n),v(this,Io,i),v(this,So,o),v(this,Ca,r),[t,e]=w(this,Sa,ch).call(this,t,e);let a=v(this,Nt,[NaN,NaN,NaN,NaN,t,e]);v(this,ie,[t,e]),v(this,kt,[{line:a,points:u(this,ie)}]),u(this,In).set(a,0)}updateProperty(t,e){t==="stroke-width"&&v(this,Ca,e)}isEmpty(){return!u(this,kt)||u(this,kt).length===0}isCancellable(){return u(this,ie).length<=10}add(t,e){[t,e]=w(this,Sa,ch).call(this,t,e);let[n,i,o,r]=u(this,In).subarray(2,6),a=t-o,l=e-r;return Math.hypot(u(this,xo)*a,u(this,Io)*l)<=2?null:(u(this,ie).push(t,e),isNaN(n)?(u(this,In).set([o,r,t,e],2),u(this,Nt).push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(u(this,In)[0])&&u(this,Nt).splice(6,6),u(this,In).set([n,i,o,r,t,e],0),u(this,Nt).push(...L.createBezierPoints(n,i,o,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){let n=this.add(t,e);return n||(u(this,ie).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,n,i,o){v(this,xo,n),v(this,Io,i),v(this,So,o),[t,e]=w(this,Sa,ch).call(this,t,e);let r=v(this,Nt,[NaN,NaN,NaN,NaN,t,e]);v(this,ie,[t,e]);let a=u(this,kt).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),u(this,kt).push({line:r,points:u(this,ie)}),u(this,In).set(r,0),v(this,$e,0),this.toSVGPath(),null}getLastElement(){return u(this,kt).at(-1)}setLastElement(t){return u(this,kt)?(u(this,kt).push(t),v(this,Nt,t.line),v(this,ie,t.points),v(this,$e,0),{path:{d:this.toSVGPath()}}):u(this,bo).setLastElement(t)}removeLastElement(){if(!u(this,kt))return u(this,bo).removeLastElement();u(this,kt).pop(),v(this,Ot,"");for(let t=0,e=u(this,kt).length;t<e;t++){let{line:n,points:i}=u(this,kt)[t];v(this,Nt,n),v(this,ie,i),v(this,$e,0),this.toSVGPath()}return{path:{d:u(this,Ot)}}}toSVGPath(){let t=L.svgRound(u(this,Nt)[4]),e=L.svgRound(u(this,Nt)[5]);if(u(this,ie).length===2)return v(this,Ot,`${u(this,Ot)} M ${t} ${e} Z`),u(this,Ot);if(u(this,ie).length<=6){let i=u(this,Ot).lastIndexOf("M");v(this,Ot,`${u(this,Ot).slice(0,i)} M ${t} ${e}`),v(this,$e,6)}if(u(this,ie).length===4){let i=L.svgRound(u(this,Nt)[10]),o=L.svgRound(u(this,Nt)[11]);return v(this,Ot,`${u(this,Ot)} L ${i} ${o}`),v(this,$e,12),u(this,Ot)}let n=[];u(this,$e)===0&&(n.push(`M ${t} ${e}`),v(this,$e,6));for(let i=u(this,$e),o=u(this,Nt).length;i<o;i+=6){let[r,a,l,c,d,p]=u(this,Nt).slice(i,i+6).map(L.svgRound);n.push(`C${r} ${a} ${l} ${c} ${d} ${p}`)}return v(this,Ot,u(this,Ot)+n.join(" ")),v(this,$e,u(this,Nt).length),u(this,Ot)}getOutlines(t,e,n,i){let o=u(this,kt).at(-1);return o.line=new Float32Array(o.line),o.points=new Float32Array(o.points),u(this,bo).build(u(this,kt),t,e,n,u(this,So),u(this,Ca),i),v(this,In,null),v(this,Nt,null),v(this,kt,null),v(this,Ot,null),u(this,bo)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}};In=new WeakMap,Nt=new WeakMap,kt=new WeakMap,So=new WeakMap,Ca=new WeakMap,ie=new WeakMap,Ot=new WeakMap,$e=new WeakMap,bo=new WeakMap,xo=new WeakMap,Io=new WeakMap,Sa=new WeakSet,ch=function(t,e){return L._normalizePoint(t,e,u(this,xo),u(this,Io),u(this,So))};var se,Mu,Nu,be,Pn,Rn,ba,xa,Ia,an,Bn,wp,XT,Tp,ZT,Ep,QT,P_=class P_ extends L{constructor(){super(...arguments);y(this,an);y(this,wp);y(this,Tp);y(this,Ep);y(this,se,void 0);y(this,Mu,0);y(this,Nu,void 0);y(this,be,void 0);y(this,Pn,void 0);y(this,Rn,void 0);y(this,ba,void 0);y(this,xa,void 0);y(this,Ia,void 0)}build(e,n,i,o,r,a,l){v(this,Pn,n),v(this,Rn,i),v(this,ba,o),v(this,xa,r),v(this,Ia,a),v(this,Nu,l!=null?l:0),v(this,be,e),w(this,Tp,ZT).call(this)}setLastElement(e){return u(this,be).push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return u(this,be).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let e=[];for(let{line:n}of u(this,be)){if(e.push(`M${L.svgRound(n[4])} ${L.svgRound(n[5])}`),n.length===6){e.push("Z");continue}if(n.length===12){e.push(`L${L.svgRound(n[10])} ${L.svgRound(n[11])}`);continue}for(let i=6,o=n.length;i<o;i+=6){let[r,a,l,c,d,p]=n.subarray(i,i+6).map(L.svgRound);e.push(`C${r} ${a} ${l} ${c} ${d} ${p}`)}}return e.join("")}serialize([e,n,i,o],r){let a=[],l=[],[c,d,p,g]=w(this,wp,XT).call(this),m,_,A,T,E,C,S,b,x;switch(u(this,xa)){case 0:x=L._rescale,m=e,_=n+o,A=i,T=-o,E=e+c*i,C=n+(1-d-g)*o,S=e+(c+p)*i,b=n+(1-d)*o;break;case 90:x=L._rescaleAndSwap,m=e,_=n,A=i,T=o,E=e+d*i,C=n+c*o,S=e+(d+g)*i,b=n+(c+p)*o;break;case 180:x=L._rescale,m=e+i,_=n,A=-i,T=o,E=e+(1-c-p)*i,C=n+d*o,S=e+(1-c)*i,b=n+(d+g)*o;break;case 270:x=L._rescaleAndSwap,m=e+i,_=n+o,A=-i,T=-o,E=e+(1-d-g)*i,C=n+(1-c-p)*o,S=e+(1-d)*i,b=n+(1-c)*o;break}for(let{line:P,points:I}of u(this,be))a.push(x(P,m,_,A,T,r?new Array(P.length):null)),l.push(x(I,m,_,A,T,r?new Array(I.length):null));return{lines:a,points:l,rect:[E,C,S,b]}}static deserialize(e,n,i,o,r,{paths:{lines:a,points:l},rotation:c,thickness:d}){let p=[],g,m,_,A,T;switch(c){case 0:T=L._rescale,g=-e/i,m=n/o+1,_=1/i,A=-1/o;break;case 90:T=L._rescaleAndSwap,g=-n/o,m=-e/i,_=1/o,A=1/i;break;case 180:T=L._rescale,g=e/i+1,m=-n/o,_=-1/i,A=1/o;break;case 270:T=L._rescaleAndSwap,g=n/o+1,m=e/i+1,_=-1/o,A=-1/i;break}if(!a){a=[];for(let C of l){let S=C.length;if(S===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1]]));continue}if(S===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1],NaN,NaN,NaN,NaN,C[2],C[3]]));continue}let b=new Float32Array(3*(S-2));a.push(b);let[x,P,I,N]=C.subarray(0,4);b.set([NaN,NaN,NaN,NaN,x,P],0);for(let M=4;M<S;M+=2){let F=C[M],U=C[M+1];b.set(L.createBezierPoints(x,P,I,N,F,U),(M-2)*3),[x,P,I,N]=[I,N,F,U]}}}for(let C=0,S=a.length;C<S;C++)p.push({line:T(a[C].map(b=>b!=null?b:NaN),g,m,_,A),points:T(l[C].map(b=>b!=null?b:NaN),g,m,_,A)});let E=new P_;return E.build(p,i,o,1,c,d,r),E}get box(){return u(this,se)}updateProperty(e,n){return e==="stroke-width"?w(this,Ep,QT).call(this,n):null}updateParentDimensions([e,n],i){let[o,r]=w(this,an,Bn).call(this);v(this,Pn,e),v(this,Rn,n),v(this,ba,i);let[a,l]=w(this,an,Bn).call(this),c=a-o,d=l-r,p=u(this,se);return p[0]-=c,p[1]-=d,p[2]+=2*c,p[3]+=2*d,p}updateRotation(e){return v(this,Mu,e),{path:{transform:this.rotationTransform}}}get viewBox(){return u(this,se).map(L.svgRound).join(" ")}get defaultProperties(){let[e,n]=u(this,se);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${L.svgRound(e)} ${L.svgRound(n)}`}}}get rotationTransform(){let[,,e,n]=u(this,se),i=0,o=0,r=0,a=0,l=0,c=0;switch(u(this,Mu)){case 90:o=n/e,r=-e/n,l=e;break;case 180:i=-1,a=-1,l=e,c=n;break;case 270:o=-n/e,r=e/n,c=n;break;default:return""}return`matrix(${i} ${o} ${r} ${a} ${L.svgRound(l)} ${L.svgRound(c)})`}getPathResizingSVGProperties([e,n,i,o]){let[r,a]=w(this,an,Bn).call(this),[l,c,d,p]=u(this,se);if(Math.abs(d-r)<=L.PRECISION||Math.abs(p-a)<=L.PRECISION){let T=e+i/2-(l+d/2),E=n+o/2-(c+p/2);return{path:{"transform-origin":`${L.svgRound(e)} ${L.svgRound(n)}`,transform:`${this.rotationTransform} translate(${T} ${E})`}}}let g=(i-2*r)/(d-2*r),m=(o-2*a)/(p-2*a),_=d/i,A=p/o;return{path:{"transform-origin":`${L.svgRound(l)} ${L.svgRound(c)}`,transform:`${this.rotationTransform} scale(${_} ${A}) translate(${L.svgRound(r)} ${L.svgRound(a)}) scale(${g} ${m}) translate(${L.svgRound(-r)} ${L.svgRound(-a)})`}}}getPathResizedSVGProperties([e,n,i,o]){let[r,a]=w(this,an,Bn).call(this),l=u(this,se),[c,d,p,g]=l;if(l[0]=e,l[1]=n,l[2]=i,l[3]=o,Math.abs(p-r)<=L.PRECISION||Math.abs(g-a)<=L.PRECISION){let E=e+i/2-(c+p/2),C=n+o/2-(d+g/2);for(let{line:S,points:b}of u(this,be))L._translate(S,E,C,S),L._translate(b,E,C,b);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${L.svgRound(e)} ${L.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let m=(i-2*r)/(p-2*r),_=(o-2*a)/(g-2*a),A=-m*(c+r)+e+r,T=-_*(d+a)+n+a;if(m!==1||_!==1||A!==0||T!==0)for(let{line:E,points:C}of u(this,be))L._rescale(E,A,T,m,_,E),L._rescale(C,A,T,m,_,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${L.svgRound(e)} ${L.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,n],i){let[o,r]=i,a=u(this,se),l=e-a[0],c=n-a[1];if(u(this,Pn)===o&&u(this,Rn)===r)for(let{line:d,points:p}of u(this,be))L._translate(d,l,c,d),L._translate(p,l,c,p);else{let d=u(this,Pn)/o,p=u(this,Rn)/r;v(this,Pn,o),v(this,Rn,r);for(let{line:g,points:m}of u(this,be))L._rescale(g,l,c,d,p,g),L._rescale(m,l,c,d,p,m);a[2]*=d,a[3]*=p}return a[0]=e,a[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${L.svgRound(e)} ${L.svgRound(n)}`}}}get defaultSVGProperties(){let e=u(this,se);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${L.svgRound(e[0])} ${L.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}};se=new WeakMap,Mu=new WeakMap,Nu=new WeakMap,be=new WeakMap,Pn=new WeakMap,Rn=new WeakMap,ba=new WeakMap,xa=new WeakMap,Ia=new WeakMap,an=new WeakSet,Bn=function(e=u(this,Ia)){let n=u(this,Nu)+e/2*u(this,ba);return u(this,xa)%180===0?[n/u(this,Pn),n/u(this,Rn)]:[n/u(this,Rn),n/u(this,Pn)]},wp=new WeakSet,XT=function(){let[e,n,i,o]=u(this,se),[r,a]=w(this,an,Bn).call(this,0);return[e+r,n+a,i-2*r,o-2*a]},Tp=new WeakSet,ZT=function(){let e=v(this,se,new Float32Array([1/0,1/0,-1/0,-1/0]));for(let{line:o}of u(this,be)){if(o.length<=12){for(let l=4,c=o.length;l<c;l+=6){let[d,p]=o.subarray(l,l+2);e[0]=Math.min(e[0],d),e[1]=Math.min(e[1],p),e[2]=Math.max(e[2],d),e[3]=Math.max(e[3],p)}continue}let r=o[4],a=o[5];for(let l=6,c=o.length;l<c;l+=6){let[d,p,g,m,_,A]=o.subarray(l,l+6);$.bezierBoundingBox(r,a,d,p,g,m,_,A,e),r=_,a=A}}let[n,i]=w(this,an,Bn).call(this);e[0]=Math.min(1,Math.max(0,e[0]-n)),e[1]=Math.min(1,Math.max(0,e[1]-i)),e[2]=Math.min(1,Math.max(0,e[2]+n)),e[3]=Math.min(1,Math.max(0,e[3]+i)),e[2]-=e[0],e[3]-=e[1]},Ep=new WeakSet,QT=function(e){let[n,i]=w(this,an,Bn).call(this);v(this,Ia,e);let[o,r]=w(this,an,Bn).call(this),[a,l]=[o-n,r-i],c=u(this,se);return c[0]-=a,c[1]-=l,c[2]+=2*a,c[3]+=2*l,c};var Vh=P_,Pa,R_=class R_ extends s_{constructor(e){super();y(this,Pa,void 0);v(this,Pa,e),super.updateProperties({fill:"none",stroke:ft._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,n){e==="stroke-width"&&(n!=null||(n=this["stroke-width"]),n*=u(this,Pa).realScale),super.updateSVGProperty(e,n)}clone(){let e=new R_(u(this,Pa));return e.updateAll(this),e}};Pa=new WeakMap;var u_=R_,Cp,jT,or=class or extends o_{constructor(e){super({...e,name:"inkEditor"});y(this,Cp);this._willKeepAspectRatio=!0}static initialize(e,n){ft.initialize(e,n),this._defaultDrawingOptions=new u_(n.viewParameters)}static getDefaultDrawingOptions(e){let n=this._defaultDrawingOptions.clone();return n.updateProperties(e),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return Z(this,"typesMap",new Map([[Q.INK_THICKNESS,"stroke-width"],[Q.INK_COLOR,"stroke"],[Q.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,n,i,o,r){return new c_(e,n,i,o,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,n,i,o,r,a){return Vh.deserialize(e,n,i,o,r,a)}static async deserialize(e,n,i){let o=null;if(e instanceof Sl){let{data:{inkLists:a,rect:l,rotation:c,id:d,color:p,opacity:g,borderStyle:{rawWidth:m},popupRef:_},parent:{page:{pageNumber:A}}}=e;o=e={annotationType:K.INK,color:Array.from(p),thickness:m,opacity:g,paths:{points:a},boxes:null,pageIndex:A-1,rect:l.slice(0),rotation:c,id:d,deleted:!1,popupRef:_}}let r=await super.deserialize(e,n,i);return r.annotationElementId=e.id||null,r._initialData=o,r}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:e,_drawingOptions:n,parent:i}=this;n.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(e,n.toSVGProperties())}static onScaleChangingWhenDrawing(){let e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:n,opacity:i}){this._drawingOptions=or.getDefaultDrawingOptions({stroke:$.makeHexColor(...e),"stroke-width":n,"stroke-opacity":i})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:n,points:i,rect:o}=this.serializeDraw(e),{_drawingOptions:{stroke:r,"stroke-opacity":a,"stroke-width":l}}=this,c={annotationType:K.INK,color:ft._colorManager.convert(r),opacity:a,thickness:l,paths:{lines:n,points:i},pageIndex:this.pageIndex,rect:o,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?c:this.annotationElementId&&!w(this,Cp,jT).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(e){let{points:n,rect:i}=this.serializeDraw(!1);return e.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:n}),null}};Cp=new WeakSet,jT=function(e){let{color:n,thickness:i,opacity:o,pageIndex:r}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((a,l)=>a!==n[l])||e.thickness!==i||e.opacity!==o||e.pageIndex!==r},H(or,"_type","ink"),H(or,"_editorType",K.INK),H(or,"_defaultDrawingOptions",null);var d_=or,ht,$t,ts,pi,es,Ra,Mn,Nn,xe,Ma,Po,cl,Ro,ul,Na,uh,ku,f_,ka,dh,Du,p_,Da,hh,Sp,tE,pl=class pl extends ft{constructor(e){super({...e,name:"stampEditor"});y(this,Po);y(this,Ro);y(this,Na);y(this,ku);y(this,ka);y(this,Du);y(this,Da);y(this,Sp);y(this,ht,null);y(this,$t,null);y(this,ts,null);y(this,pi,null);y(this,es,null);y(this,Ra,"");y(this,Mn,null);y(this,Nn,null);y(this,xe,!1);y(this,Ma,!1);v(this,pi,e.bitmapUrl),v(this,es,e.bitmapFile)}static initialize(e,n){ft.initialize(e,n)}static get supportedTypes(){return Z(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(n=>`image/${n}`))}static get supportedTypesStr(){return Z(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,n){n.pasteEditor(K.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var e;return{type:"stamp",hasAltText:!!((e=this.altTextData)!=null&&e.altText)}}static computeTelemetryFinalData(e){var i,o;let n=e.get("hasAltText");return{hasAltText:(i=n.get(!0))!=null?i:0,hasNoAltText:(o=n.get(!1))!=null?o:0}}async mlGuessAltText(e=null,n=!0){if(this.hasAltTextData())return null;let{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");let{data:o,width:r,height:a}=e||this.copyCanvas(null,null,!0).imageData,l=await i.guess({name:"altText",request:{data:o,width:r,height:a,channels:o.length/(r*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");let c=l.output;return await this.setGuessedAltText(c),n&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){var e;u(this,$t)&&(v(this,ht,null),this._uiManager.imageManager.deleteId(u(this,$t)),(e=u(this,Mn))==null||e.remove(),v(this,Mn,null),u(this,Nn)&&(clearTimeout(u(this,Nn)),v(this,Nn,null))),super.remove()}rebuild(){if(!this.parent){u(this,$t)&&w(this,Na,uh).call(this);return}super.rebuild(),this.div!==null&&(u(this,$t)&&u(this,Mn)===null&&w(this,Na,uh).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(u(this,ts)||u(this,ht)||u(this,pi)||u(this,es)||u(this,$t))}get isResizable(){return!0}render(){if(this.div)return this.div;let e,n;if(this.width&&(e=this.x,n=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),u(this,ht)?w(this,ku,f_).call(this):w(this,Na,uh).call(this),this.width&&!this.annotationElementId){let[i,o]=this.parentDimensions;this.setAt(e*i,n*o,this.width*i,this.height*o)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;u(this,Nn)!==null&&clearTimeout(u(this,Nn)),v(this,Nn,setTimeout(()=>{v(this,Nn,null),w(this,Du,p_).call(this)},200))}copyCanvas(e,n,i=!1){var m;e||(e=224);let{width:o,height:r}=u(this,ht),a=new _l,l=u(this,ht),c=o,d=r,p=null;if(n){if(o>n||r>n){let N=Math.min(n/o,n/r);c=Math.floor(o*N),d=Math.floor(r*N)}p=document.createElement("canvas");let _=p.width=Math.ceil(c*a.sx),A=p.height=Math.ceil(d*a.sy);u(this,xe)||(l=w(this,ka,dh).call(this,_,A));let T=p.getContext("2d");T.filter=this._uiManager.hcmFilter;let E="white",C="#cfcfd8";this._uiManager.hcmFilter!=="none"?C="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(E="#8f8f9d",C="#42414d");let S=15,b=S*a.sx,x=S*a.sy,P=new OffscreenCanvas(b*2,x*2),I=P.getContext("2d");I.fillStyle=E,I.fillRect(0,0,b*2,x*2),I.fillStyle=C,I.fillRect(0,0,b,x),I.fillRect(b,x,b,x),T.fillStyle=T.createPattern(P,"repeat"),T.fillRect(0,0,_,A),T.drawImage(l,0,0,l.width,l.height,0,0,_,A)}let g=null;if(i){let _,A;if(a.symmetric&&l.width<e&&l.height<e)_=l.width,A=l.height;else if(l=u(this,ht),o>e||r>e){let C=Math.min(e/o,e/r);_=Math.floor(o*C),A=Math.floor(r*C),u(this,xe)||(l=w(this,ka,dh).call(this,_,A))}let E=new OffscreenCanvas(_,A).getContext("2d",{willReadFrequently:!0});E.drawImage(l,0,0,l.width,l.height,0,0,_,A),g={width:_,height:A,data:E.getImageData(0,0,_,A).data}}return{canvas:p,width:c,height:d,imageData:g}}getImageForAltText(){return u(this,Mn)}static async deserialize(e,n,i){var A;let o=null;if(e instanceof Oh){let{data:{rect:T,rotation:E,id:C,structParent:S,popupRef:b},container:x,parent:{page:{pageNumber:P}}}=e,I=x.querySelector("canvas"),N=i.imageManager.getFromCanvas(x.id,I);I.remove();let M=((A=await n._structTree.getAriaAttributes(`${T_}${C}`))==null?void 0:A.get("aria-label"))||"";o=e={annotationType:K.STAMP,bitmapId:N.id,bitmap:N.bitmap,pageIndex:P-1,rect:T.slice(0),rotation:E,id:C,deleted:!1,accessibilityData:{decorative:!1,altText:M},isSvg:!1,structParent:S,popupRef:b}}let r=await super.deserialize(e,n,i),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:d,isSvg:p,accessibilityData:g}=e;d&&i.imageManager.isValidId(d)?(v(r,$t,d),l&&v(r,ht,l)):v(r,pi,c),v(r,xe,p);let[m,_]=r.pageDimensions;return r.width=(a[2]-a[0])/m,r.height=(a[3]-a[1])/_,r.annotationElementId=e.id||null,g&&(r.altTextData=g),r._initialData=o,v(r,Ma,!!o),r}serialize(e=!1,n=null){var l;if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let i={annotationType:K.STAMP,bitmapId:u(this,$t),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:u(this,xe),structTreeParentId:this._structTreeParentId};if(e)return i.bitmapUrl=w(this,Da,hh).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i;let{decorative:o,altText:r}=this.serializeAltText(!1);if(!o&&r&&(i.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){let c=w(this,Sp,tE).call(this,i);if(c.isSame)return null;c.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=(l=this._initialData.structParent)!=null?l:-1}if(i.id=this.annotationElementId,n===null)return i;n.stamps||(n.stamps=new Map);let a=u(this,xe)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!n.stamps.has(u(this,$t)))n.stamps.set(u(this,$t),{area:a,serialized:i}),i.bitmap=w(this,Da,hh).call(this,!1);else if(u(this,xe)){let c=n.stamps.get(u(this,$t));a>c.area&&(c.area=a,c.serialized.bitmap.close(),c.serialized.bitmap=w(this,Da,hh).call(this,!1))}return i}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}};ht=new WeakMap,$t=new WeakMap,ts=new WeakMap,pi=new WeakMap,es=new WeakMap,Ra=new WeakMap,Mn=new WeakMap,Nn=new WeakMap,xe=new WeakMap,Ma=new WeakMap,Po=new WeakSet,cl=function(e,n=!1){if(!e){this.remove();return}v(this,ht,e.bitmap),n||(v(this,$t,e.id),v(this,xe,e.isSvg)),e.file&&v(this,Ra,e.file.name),w(this,ku,f_).call(this)},Ro=new WeakSet,ul=function(){if(v(this,ts,null),this._uiManager.enableWaiting(!1),!!u(this,Mn)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,ht)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,ht)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch(e){}}this.div.focus()}},Na=new WeakSet,uh=function(){if(u(this,$t)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(u(this,$t)).then(i=>w(this,Po,cl).call(this,i,!0)).finally(()=>w(this,Ro,ul).call(this));return}if(u(this,pi)){let i=u(this,pi);v(this,pi,null),this._uiManager.enableWaiting(!0),v(this,ts,this._uiManager.imageManager.getFromUrl(i).then(o=>w(this,Po,cl).call(this,o)).finally(()=>w(this,Ro,ul).call(this)));return}if(u(this,es)){let i=u(this,es);v(this,es,null),this._uiManager.enableWaiting(!0),v(this,ts,this._uiManager.imageManager.getFromFile(i).then(o=>w(this,Po,cl).call(this,o)).finally(()=>w(this,Ro,ul).call(this)));return}let e=document.createElement("input");e.type="file",e.accept=pl.supportedTypesStr;let n=this._uiManager._signal;v(this,ts,new Promise(i=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let o=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),w(this,Po,cl).call(this,o)}i()},{signal:n}),e.addEventListener("cancel",()=>{this.remove(),i()},{signal:n})}).finally(()=>w(this,Ro,ul).call(this))),e.click()},ku=new WeakSet,f_=function(){var p;let{div:e}=this,{width:n,height:i}=u(this,ht),[o,r]=this.pageDimensions,a=.75;if(this.width)n=this.width*o,i=this.height*r;else if(n>a*o||i>a*r){let g=Math.min(a*o/n,a*r/i);n*=g,i*=g}let[l,c]=this.parentDimensions;this.setDims(n*l/o,i*c/r),this._uiManager.enableWaiting(!1);let d=v(this,Mn,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=n/o,this.height=i/r,(p=this._initialOptions)!=null&&p.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),w(this,Du,p_).call(this),u(this,Ma)||(this.parent.addUndoableEditor(this),v(this,Ma,!0)),this._reportTelemetry({action:"inserted_image"}),u(this,Ra)&&d.setAttribute("aria-label",u(this,Ra))},ka=new WeakSet,dh=function(e,n){let{width:i,height:o}=u(this,ht),r=i,a=o,l=u(this,ht);for(;r>2*e||a>2*n;){let c=r,d=a;r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),a>2*n&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));let p=new OffscreenCanvas(r,a);p.getContext("2d").drawImage(l,0,0,c,d,0,0,r,a),l=p.transferToImageBitmap()}return l},Du=new WeakSet,p_=function(){let[e,n]=this.parentDimensions,{width:i,height:o}=this,r=new _l,a=Math.ceil(i*e*r.sx),l=Math.ceil(o*n*r.sy),c=u(this,Mn);if(!c||c.width===a&&c.height===l)return;c.width=a,c.height=l;let d=u(this,xe)?u(this,ht):w(this,ka,dh).call(this,a,l),p=c.getContext("2d");p.filter=this._uiManager.hcmFilter,p.drawImage(d,0,0,d.width,d.height,0,0,a,l)},Da=new WeakSet,hh=function(e){if(e){if(u(this,xe)){let o=this._uiManager.imageManager.getSvgUrl(u(this,$t));if(o)return o}let n=document.createElement("canvas");return{width:n.width,height:n.height}=u(this,ht),n.getContext("2d").drawImage(u(this,ht),0,0),n.toDataURL()}if(u(this,xe)){let[n,i]=this.pageDimensions,o=Math.round(this.width*n*rs.PDF_TO_CSS_UNITS),r=Math.round(this.height*i*rs.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(o,r);return a.getContext("2d").drawImage(u(this,ht),0,0,u(this,ht).width,u(this,ht).height,0,0,o,r),a.transferToImageBitmap()}return structuredClone(u(this,ht))},Sp=new WeakSet,tE=function(e){var a;let{pageIndex:n,accessibilityData:{altText:i}}=this._initialData,o=e.pageIndex===n,r=(((a=e.accessibilityData)==null?void 0:a.alt)||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&o&&r,isSameAltText:r}},H(pl,"_type","stamp"),H(pl,"_editorType",K.STAMP);var h_=pl,Mo,Fa,kn,ns,gi,Ge,is,La,No,ln,mi,Xt,yi,G,ss,bp,eE,Be,gn,Fu,m_,Lu,y_,Ua,fh,Ke=class Ke{constructor({uiManager:t,pageIndex:e,div:n,structTreeLayer:i,accessibilityManager:o,annotationLayer:r,drawLayer:a,textLayer:l,viewport:c,l10n:d}){y(this,bp);y(this,Be);y(this,Fu);y(this,Lu);y(this,Ua);y(this,Mo,void 0);y(this,Fa,!1);y(this,kn,null);y(this,ns,null);y(this,gi,null);y(this,Ge,new Map);y(this,is,!1);y(this,La,!1);y(this,No,!1);y(this,ln,null);y(this,mi,null);y(this,Xt,null);y(this,yi,null);y(this,G,void 0);let p=[...u(Ke,ss).values()];if(!Ke._initialized){Ke._initialized=!0;for(let g of p)g.initialize(d,t)}t.registerEditorTypes(p),v(this,G,t),this.pageIndex=e,this.div=n,v(this,Mo,o),v(this,kn,r),this.viewport=c,v(this,Xt,l),this.drawLayer=a,this._structTree=i,u(this,G).addLayer(this)}get isEmpty(){return u(this,Ge).size===0}get isInvisible(){return this.isEmpty&&u(this,G).getMode()===K.NONE}updateToolbar(t){u(this,G).updateToolbar(t)}updateMode(t=u(this,G).getMode()){switch(w(this,Ua,fh).call(this),t){case K.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case K.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case K.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:e}=this.div;for(let n of u(Ke,ss).values())e.toggle(`${n._type}Editing`,t===n._editorType);this.div.hidden=!1}hasTextLayer(t){var e;return t===((e=u(this,Xt))==null?void 0:e.div)}setEditingState(t){u(this,G).setEditingState(t)}addCommands(t){u(this,G).addCommands(t)}cleanUndoStack(t){u(this,G).cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){var e;(e=u(this,kn))==null||e.div.classList.toggle("disabled",!t)}async enable(){v(this,No,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);let t=new Set;for(let n of u(this,Ge).values())n.enableEditing(),n.show(!0),n.annotationElementId&&(u(this,G).removeChangedExistingAnnotation(n),t.add(n.annotationElementId));if(!u(this,kn)){v(this,No,!1);return}let e=u(this,kn).getEditableAnnotations();for(let n of e){if(n.hide(),u(this,G).isDeletedAnnotationElement(n.data.id)||t.has(n.data.id))continue;let i=await this.deserialize(n);i&&(this.addOrRebuild(i),i.enableEditing())}v(this,No,!1)}disable(){var i;v(this,La,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);let t=new Map,e=new Map;for(let o of u(this,Ge).values())if(o.disableEditing(),!!o.annotationElementId){if(o.serialize()!==null){t.set(o.annotationElementId,o);continue}else e.set(o.annotationElementId,o);(i=this.getEditableAnnotation(o.annotationElementId))==null||i.show(),o.remove()}if(u(this,kn)){let o=u(this,kn).getEditableAnnotations();for(let r of o){let{id:a}=r.data;if(u(this,G).isDeletedAnnotationElement(a))continue;let l=e.get(a);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=t.get(a),l&&(u(this,G).addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}w(this,Ua,fh).call(this),this.isEmpty&&(this.div.hidden=!0);let{classList:n}=this.div;for(let o of u(Ke,ss).values())n.remove(`${o._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),v(this,La,!1)}getEditableAnnotation(t){var e;return((e=u(this,kn))==null?void 0:e.getEditableAnnotation(t))||null}setActiveEditor(t){u(this,G).getActive()!==t&&u(this,G).setActiveEditor(t)}enableTextSelection(){var t;if(this.div.tabIndex=-1,(t=u(this,Xt))!=null&&t.div&&!u(this,yi)){v(this,yi,new AbortController);let e=u(this,G).combinedSignal(u(this,yi));u(this,Xt).div.addEventListener("pointerdown",w(this,bp,eE).bind(this),{signal:e}),u(this,Xt).div.classList.add("highlighting")}}disableTextSelection(){var t;this.div.tabIndex=0,(t=u(this,Xt))!=null&&t.div&&u(this,yi)&&(u(this,yi).abort(),v(this,yi,null),u(this,Xt).div.classList.remove("highlighting"))}enableClick(){if(u(this,ns))return;v(this,ns,new AbortController);let t=u(this,G).combinedSignal(u(this,ns));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});let e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){var t;(t=u(this,ns))==null||t.abort(),v(this,ns,null)}attach(t){u(this,Ge).set(t.id,t);let{annotationElementId:e}=t;e&&u(this,G).isDeletedAnnotationElement(e)&&u(this,G).removeDeletedAnnotationElement(t)}detach(t){var e;u(this,Ge).delete(t.id),(e=u(this,Mo))==null||e.removePointerInTextLayer(t.contentDiv),!u(this,La)&&t.annotationElementId&&u(this,G).addDeletedAnnotationElement(t)}remove(t){this.detach(t),u(this,G).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(u(this,G).addDeletedAnnotationElement(t.annotationElementId),ft.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),(e=t.parent)==null||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),u(this,G).addEditor(t),this.attach(t),!t.isAttachedToDOM){let e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!u(this,No)),u(this,G).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){var n;if(!t.isAttachedToDOM)return;let{activeElement:e}=document;t.div.contains(e)&&!u(this,gi)&&(t._focusEventsAllowed=!1,v(this,gi,setTimeout(()=>{v(this,gi,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:u(this,G)._signal}),e.focus())},0))),t._structTreeParentId=(n=u(this,Mo))==null?void 0:n.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){let e=()=>t._uiManager.rebuild(t),n=()=>{t.remove()};this.addCommands({cmd:e,undo:n,mustExec:!1})}getNextId(){return u(this,G).getId()}combinedSignal(t){return u(this,G).combinedSignal(t)}canCreateNewEmptyEditor(){var t;return(t=u(this,Be,gn))==null?void 0:t.canCreateNewEmptyEditor()}pasteEditor(t,e){u(this,G).updateToolbar(t),u(this,G).updateMode(t);let{offsetX:n,offsetY:i}=w(this,Lu,y_).call(this),o=this.getNextId(),r=w(this,Fu,m_).call(this,{parent:this,id:o,x:n,y:i,uiManager:u(this,G),isCentered:!0,...e});r&&this.add(r)}async deserialize(t){var e,n;return await((n=u(Ke,ss).get((e=t.annotationType)!=null?e:t.annotationEditorType))==null?void 0:n.deserialize(t,this,u(this,G)))||null}createAndAddNewEditor(t,e,n={}){let i=this.getNextId(),o=w(this,Fu,m_).call(this,{parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:u(this,G),isCentered:e,...n});return o&&this.add(o),o}addNewEditor(){this.createAndAddNewEditor(w(this,Lu,y_).call(this),!0)}setSelected(t){u(this,G).setSelected(t)}toggleSelected(t){u(this,G).toggleSelected(t)}unselect(t){u(this,G).unselect(t)}pointerup(t){var n;let{isMac:e}=Gt.platform;if(!(t.button!==0||t.ctrlKey&&e)&&t.target===this.div&&u(this,is)&&(v(this,is,!1),!((n=u(this,Be,gn))!=null&&n.isDrawer&&u(this,Be,gn).supportMultipleDrawings))){if(!u(this,Fa)){v(this,Fa,!0);return}if(u(this,G).getMode()===K.STAMP){u(this,G).unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){var i;if(u(this,G).getMode()===K.HIGHLIGHT&&this.enableTextSelection(),u(this,is)){v(this,is,!1);return}let{isMac:e}=Gt.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(v(this,is,!0),(i=u(this,Be,gn))!=null&&i.isDrawer){this.startDrawingSession(t);return}let n=u(this,G).getActive();v(this,Fa,!n||n.isEmpty())}startDrawingSession(t){if(this.div.focus(),u(this,ln)){u(this,Be,gn).startDrawing(this,u(this,G),!1,t);return}u(this,G).setCurrentDrawingSession(this),v(this,ln,new AbortController);let e=u(this,G).combinedSignal(u(this,ln));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(v(this,mi,null),this.commitOrRemove())},{signal:e}),u(this,Be,gn).startDrawing(this,u(this,G),!1,t)}pause(t){if(t){let{activeElement:e}=document;this.div.contains(e)&&v(this,mi,e);return}u(this,mi)&&setTimeout(()=>{var e;(e=u(this,mi))==null||e.focus(),v(this,mi,null)},0)}endDrawingSession(t=!1){return u(this,ln)?(u(this,G).setCurrentDrawingSession(null),u(this,ln).abort(),v(this,ln,null),v(this,mi,null),u(this,Be,gn).endDrawing(t)):null}findNewParent(t,e,n){let i=u(this,G).findParent(e,n);return i===null||i===this?!1:(i.changeParent(t),!0)}commitOrRemove(){return u(this,ln)?(this.endDrawingSession(),!0):!1}onScaleChanging(){u(this,ln)&&u(this,Be,gn).onScaleChangingWhenDrawing(this)}destroy(){var t,e;this.commitOrRemove(),((t=u(this,G).getActive())==null?void 0:t.parent)===this&&(u(this,G).commitOrRemove(),u(this,G).setActiveEditor(null)),u(this,gi)&&(clearTimeout(u(this,gi)),v(this,gi,null));for(let n of u(this,Ge).values())(e=u(this,Mo))==null||e.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,u(this,Ge).clear(),u(this,G).removeLayer(this)}render({viewport:t}){this.viewport=t,Fo(this.div,t);for(let e of u(this,G).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){u(this,G).commitOrRemove(),w(this,Ua,fh).call(this);let e=this.viewport.rotation,n=t.rotation;if(this.viewport=t,Fo(this.div,{rotation:n}),e!==n)for(let i of u(this,Ge).values())i.rotate(n)}get pageDimensions(){let{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return u(this,G).viewParameters.realScale}};Mo=new WeakMap,Fa=new WeakMap,kn=new WeakMap,ns=new WeakMap,gi=new WeakMap,Ge=new WeakMap,is=new WeakMap,La=new WeakMap,No=new WeakMap,ln=new WeakMap,mi=new WeakMap,Xt=new WeakMap,yi=new WeakMap,G=new WeakMap,ss=new WeakMap,bp=new WeakSet,eE=function(t){u(this,G).unselectAll();let{target:e}=t;if(e===u(this,Xt).div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&u(this,Xt).div.contains(e)){let{isMac:n}=Gt.platform;if(t.button!==0||t.ctrlKey&&n)return;u(this,G).showAllEditors("highlight",!0,!0),u(this,Xt).div.classList.add("free"),this.toggleDrawing(),Hh.startHighlighting(this,u(this,G).direction==="ltr",{target:u(this,Xt).div,x:t.x,y:t.y}),u(this,Xt).div.addEventListener("pointerup",()=>{u(this,Xt).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:u(this,G)._signal}),t.preventDefault()}},Be=new WeakSet,gn=function(){return u(Ke,ss).get(u(this,G).getMode())},Fu=new WeakSet,m_=function(t){let e=u(this,Be,gn);return e?new e.prototype.constructor(t):null},Lu=new WeakSet,y_=function(){let{x:t,y:e,width:n,height:i}=this.div.getBoundingClientRect(),o=Math.max(0,t),r=Math.max(0,e),a=Math.min(window.innerWidth,t+n),l=Math.min(window.innerHeight,e+i),c=(o+a)/2-t,d=(r+l)/2-e,[p,g]=this.viewport.rotation%180===0?[c,d]:[d,c];return{offsetX:p,offsetY:g}},Ua=new WeakSet,fh=function(){for(let t of u(this,Ge).values())t.isEmpty()&&t.remove()},H(Ke,"_initialized",!1),y(Ke,ss,new Map([Yy,d_,h_,Hh].map(t=>[t._editorType,t])));var g_=Ke,cn,Uu,oe,ko,xp,nE,Ou,v_,Ip,iE,$u,A_,Wt=class Wt{constructor({pageIndex:t}){y(this,Ou);y(this,Ip);y(this,$u);y(this,cn,null);y(this,Uu,0);y(this,oe,new Map);y(this,ko,new Map);this.pageIndex=t}setParent(t){if(!u(this,cn)){v(this,cn,t);return}if(u(this,cn)!==t){if(u(this,oe).size>0)for(let e of u(this,oe).values())e.remove(),t.append(e);v(this,cn,t)}}static get _svgFactory(){return Z(this,"_svgFactory",new El)}draw(t,e=!1,n=!1){let i=jt(this,Uu)._++,o=w(this,Ou,v_).call(this),r=Wt._svgFactory.createElement("defs");o.append(r);let a=Wt._svgFactory.createElement("path");r.append(a);let l=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),e&&u(this,ko).set(i,a);let c=n?w(this,Ip,iE).call(this,r,l):null,d=Wt._svgFactory.createElement("use");return o.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(o,t),u(this,oe).set(i,o),{id:i,clipPathId:`url(#${c})`}}drawOutline(t,e){let n=jt(this,Uu)._++,i=w(this,Ou,v_).call(this),o=Wt._svgFactory.createElement("defs");i.append(o);let r=Wt._svgFactory.createElement("path");o.append(r);let a=`path_p${this.pageIndex}_${n}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){let p=Wt._svgFactory.createElement("mask");o.append(p),l=`mask_p${this.pageIndex}_${n}`,p.setAttribute("id",l),p.setAttribute("maskUnits","objectBoundingBox");let g=Wt._svgFactory.createElement("rect");p.append(g),g.setAttribute("width","1"),g.setAttribute("height","1"),g.setAttribute("fill","white");let m=Wt._svgFactory.createElement("use");p.append(m),m.setAttribute("href",`#${a}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}let c=Wt._svgFactory.createElement("use");i.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);let d=c.cloneNode();return i.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(i,t),u(this,oe).set(n,i),n}finalizeDraw(t,e){u(this,ko).delete(t),this.updateProperties(t,e)}updateProperties(t,e){var l;if(!e)return;let{root:n,bbox:i,rootClass:o,path:r}=e,a=typeof t=="number"?u(this,oe).get(t):t;if(a){if(n&&w(this,$u,A_).call(this,a,n),i&&w(l=Wt,xp,nE).call(l,a,i),o){let{classList:c}=a;for(let[d,p]of Object.entries(o))c.toggle(d,p)}if(r){let d=a.firstChild.firstChild;w(this,$u,A_).call(this,d,r)}}}updateParent(t,e){if(e===this)return;let n=u(this,oe).get(t);n&&(u(e,cn).append(n),u(this,oe).delete(t),u(e,oe).set(t,n))}remove(t){u(this,ko).delete(t),u(this,cn)!==null&&(u(this,oe).get(t).remove(),u(this,oe).delete(t))}destroy(){v(this,cn,null);for(let t of u(this,oe).values())t.remove();u(this,oe).clear(),u(this,ko).clear()}};cn=new WeakMap,Uu=new WeakMap,oe=new WeakMap,ko=new WeakMap,xp=new WeakSet,nE=function(t,[e,n,i,o]){let{style:r}=t;r.top=`${100*n}%`,r.left=`${100*e}%`,r.width=`${100*i}%`,r.height=`${100*o}%`},Ou=new WeakSet,v_=function(){let t=Wt._svgFactory.create(1,1,!0);return u(this,cn).append(t),t.setAttribute("aria-hidden",!0),t},Ip=new WeakSet,iE=function(t,e){let n=Wt._svgFactory.createElement("clipPath");t.append(n);let i=`clip_${e}`;n.setAttribute("id",i),n.setAttribute("clipPathUnits","objectBoundingBox");let o=Wt._svgFactory.createElement("use");return n.append(o),o.setAttribute("href",`#${e}`),o.classList.add("clip"),i},$u=new WeakSet,A_=function(t,e){for(let[n,i]of Object.entries(e))i===null?t.removeAttribute(n):t.setAttribute(n,i)},y(Wt,xp);var __=Wt;globalThis.pdfjsTestingUtils={HighlightOutliner:bl};var oR=V.AbortException,rR=V.AnnotationEditorLayer,aR=V.AnnotationEditorParamsType,lR=V.AnnotationEditorType,cR=V.AnnotationEditorUIManager,uR=V.AnnotationLayer,dR=V.AnnotationMode,hR=V.ColorPicker,fR=V.DOMSVGFactory,pR=V.DrawLayer,gR=V.FeatureTest,sE=V.GlobalWorkerOptions,mR=V.ImageKind,yR=V.InvalidPDFException,_R=V.MissingPDFException,vR=V.OPS,AR=V.OutputScale,wR=V.PDFDataRangeTransport,TR=V.PDFDateString,ER=V.PDFWorker,CR=V.PasswordResponses,SR=V.PermissionFlag,bR=V.PixelsPerInch,xR=V.RenderingCancelledException,IR=V.TextLayer,PR=V.TouchManager,RR=V.UnexpectedResponseException,MR=V.Util,NR=V.VerbosityLevel,kR=V.XfaLayer,DR=V.build,FR=V.createValidAbsoluteUrl,LR=V.fetchData,Up=V.getDocument,UR=V.getFilenameFromUrl,OR=V.getPdfFilenameFromUrl,$R=V.getXfaPageViewport,GR=V.isDataScheme,BR=V.isPdfFile,HR=V.noContextMenu,VR=V.normalizeUnicode,qR=V.setLayerDimensions,zR=V.shadow,WR=V.stopEvent,KR=V.version;sE.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.mjs";var Op=class{constructor(t=50){this.minTextThreshold=t}async extractText(t){let e=await Up({data:t,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,n="";for(let r=1;r<=e.numPages;r++){let c=(await(await e.getPage(r)).getTextContent()).items.map(d=>d.str||"").join(" ");n+=`
## \uD398\uC774\uC9C0 ${r}

${c}
`}let o=n.replace(/\s/g,"").length/e.numPages<this.minTextThreshold;return{text:n,isScanned:o,numPages:e.numPages}}async renderPagesToImages(t,e){let n=await Up({data:t,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,i=[],o=e?Math.min(n.numPages,e):n.numPages;for(let r=1;r<=o;r++){let a=await n.getPage(r),l=a.getViewport({scale:2}),c=document.createElement("canvas");c.width=l.width,c.height=l.height;let d=c.getContext("2d");await a.render({canvasContext:d,viewport:l}).promise;let p=c.toDataURL("image/png").split(",")[1];i.push({base64:p,mimeType:"image/png",pageNum:r})}return i}async getPageCount(t){return(await Up({data:t,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise).numPages}};var $p=class{constructor(t,e,n){this.gemini=t,this.settings=e,this.vault=n,this.pdfProcessor=new Op(e.ocrMinTextThreshold),this.dailyUsage=this.loadDailyUsage()}loadDailyUsage(){return{date:Bo(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}saveDailyUsage(){}checkDailyLimit(t){let e=Bo(this.settings.timezone);this.dailyUsage.date!==e&&(this.dailyUsage={date:e,pagesProcessed:0,filesProcessed:0});let n=this.settings.ocrDailyLimit-this.dailyUsage.pagesProcessed;return{allowed:t<=n,remaining:n}}getFileSizeMB(t){return t.stat.size/(1024*1024)}async checkLimits(t){let e=this.getFileSizeMB(t);if(e>this.settings.ocrMaxFileSizeMB)return{allowed:!1,reason:`\uD30C\uC77C \uD06C\uAE30(${e.toFixed(1)}MB)\uAC00 \uC81C\uD55C(${this.settings.ocrMaxFileSizeMB}MB)\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,fileSize:e};if(t.extension==="pdf"){let i=await this.vault.readBinary(t),o=await this.pdfProcessor.getPageCount(i);if(o>this.settings.ocrMaxPages)return{allowed:!1,reason:`\uD398\uC774\uC9C0 \uC218(${o})\uAC00 \uC81C\uD55C(${this.settings.ocrMaxPages})\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,pageCount:o,fileSize:e};let r=this.checkDailyLimit(o);return r.allowed?{allowed:!0,pageCount:o,fileSize:e}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${r.remaining})`,pageCount:o,fileSize:e}}let n=this.checkDailyLimit(1);return n.allowed?{allowed:!0,pageCount:1,fileSize:e}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${n.remaining})`,pageCount:1,fileSize:e}}async processImage(t){let e=await this.vault.readBinary(t),n=this.arrayBufferToBase64(e),i=this.getMimeType(t.extension),o=await this.gemini.extractTextFromImage(n,i);return this.dailyUsage.pagesProcessed+=1,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:o,pages:1,sourceType:"image",sourceFile:t.name}}async processPDF(t,e=!1,n){let i=await this.vault.readBinary(t),o=n||this.settings.ocrMaxPages,r=await this.pdfProcessor.extractText(i);if(!r.isScanned&&!e)return{text:r.text,pages:r.numPages,sourceType:"pdf_text",sourceFile:t.name};let a=Math.min(r.numPages,o);new M_.Notice(`\uC2A4\uCE94 PDF \uAC10\uC9C0\uB428. OCR \uCC98\uB9AC \uC911... (${a}\uD398\uC774\uC9C0)`);let l=await this.pdfProcessor.renderPagesToImages(i,o),c=await this.gemini.extractTextFromImages(l,(p,g)=>{new M_.Notice(`OCR \uC9C4\uD589 \uC911: ${p}/${g} \uD398\uC774\uC9C0`,1500)}),d="";for(let p=0;p<c.length;p++)d+=`
## \uD398\uC774\uC9C0 ${p+1}

${c[p]}
`;return this.dailyUsage.pagesProcessed+=c.length,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:d,pages:c.length,sourceType:"pdf_scanned",sourceFile:t.name}}async processFile(t,e){let n=t.extension.toLowerCase();if(["png","jpg","jpeg","webp","gif"].includes(n))return this.processImage(t);if(n==="pdf")return this.processPDF(t,!1,e);throw new Error(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD: ${n}`)}generateMarkdownNote(t){let e=Ht(this.settings.timezone,this.settings.dateFormat),n={image:"\uC774\uBBF8\uC9C0",pdf_text:"PDF (\uD14D\uC2A4\uD2B8)",pdf_scanned:"PDF (\uC2A4\uCE94/OCR)"}[t.sourceType];return`---
type: ocr
source_file: "${t.sourceFile}"
source_type: ${t.sourceType}
pages: ${t.pages}
ocr_at: ${e}
---

# OCR: ${t.sourceFile.replace(/\.[^.]+$/,"")}

> \uC6D0\uBCF8: ${t.sourceFile} | \uCC98\uB9AC \uBC29\uC2DD: ${n} | ${t.pages}\uD398\uC774\uC9C0

${t.text}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${t.sourceFile}]]
`}arrayBufferToBase64(t){let e="",n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}getMimeType(t){return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/webp",gif:"image/gif"}[t.toLowerCase()]||"image/png"}getDailyUsage(){return{...this.dailyUsage}}};var Gp=class{constructor(t,e){this.index=new Map;this.app=t,this.gemini=e}async buildIndex(){this.index.clear();let t=this.app.vault.getMarkdownFiles();for(let e of t)try{let n=await this.indexNote(e);n&&this.index.set(e.path,n)}catch(n){console.error(`\uC778\uB371\uC2F1 \uC2E4\uD328: ${e.path}`,n)}console.log(`\uC778\uB371\uC2A4 \uAD6C\uCD95 \uC644\uB8CC: ${this.index.size}\uAC1C \uB178\uD2B8`)}async indexNote(t){let e=this.app.metadataCache.getFileCache(t),n=e==null?void 0:e.frontmatter,i=[];n!=null&&n.keywords&&(i=Array.isArray(n.keywords)?n.keywords:[n.keywords]);let o;if(n!=null&&n.targetType){let l=n.targetType;["project","library","archive"].includes(l)&&(o=l)}let r=(n==null?void 0:n.title)||t.basename,a=n==null?void 0:n.type;return{path:t.path,title:r,keywords:i,category:o,project:n==null?void 0:n.project,type:a}}async updateIndex(t){let e=await this.indexNote(t);e&&this.index.set(t.path,e)}removeFromIndex(t){this.index.delete(t)}async findRelated(t,e,n){let i=await this.gemini.extractKeywords(t);if(i.length===0)return[];let o=this.filterByKeywords(i,n);if(o.length===0)return[];let r=o.map((c,d)=>`${d}. ${c.note.title} (\uD0A4\uC6CC\uB4DC: ${c.note.keywords.join(", ")})`).join(`
`),a=await this.gemini.findRelatedNotes(e,i,r),l=[];for(let c of a)if(c.index>=0&&c.index<o.length){let d=o[c.index];l.push({note:d.note,relevance:c.relevance,matchedKeywords:d.matchedKeywords,reason:c.reason||"",connectionType:c.type||""})}return l}filterByKeywords(t,e){let n=[],i=new Set(t.map(o=>o.toLowerCase()));for(let[o,r]of this.index){if(e&&o===e||r.keywords.length===0)continue;let a=[];for(let l of r.keywords){let c=l.toLowerCase();for(let d of i)if(c===d||c.includes(d)||d.includes(c)){a.push(l);break}}a.length>0&&n.push({note:r,matchedKeywords:a})}return n.sort((o,r)=>r.matchedKeywords.length-o.matchedKeywords.length),n.slice(0,10)}async saveKeywordsToNote(t,e){let n=await this.app.vault.read(t),i=this.updateFrontmatterKeywords(n,e);await this.app.vault.modify(t,i),await this.updateIndex(t)}updateFrontmatterKeywords(t,e){let n=`keywords: [${e.map(o=>`"${o}"`).join(", ")}]`,i=t.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(i){let o=i[1];if(/^keywords:/m.test(o)){let r=o.replace(/^keywords:.*$/m,n);return t.replace(/^---\r?\n[\s\S]*?\r?\n---/,`---
${r}
---`)}else return t.replace(/^---\r?\n([\s\S]*?)\r?\n---/,`---
$1
${n}
---`)}else return`---
${n}
---

${t}`}async addRelatedLinks(t,e){if(e.length===0)return;let n=await this.app.vault.read(t),i=`

---
## \uAD00\uB828 \uB178\uD2B8
${e.map(a=>{let l=a.note.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]] (\uAD00\uB828\uB3C4: ${Math.round(a.relevance*100)}%)`}).join(`
`)}
`,o=/\n---\n##  \n[\s\S]*?(?=\n---\n|$)/,r;o.test(n)?r=n.replace(o,i):r=n+i,await this.app.vault.modify(t,r)}getIndexSize(){return this.index.size}getZettelIndex(){let t=new Map;for(let[e,n]of this.index)n.type==="zettel"&&t.set(e,n);return t}getZettelCount(){return this.getZettelIndex().size}async findRelatedZettels(t,e){if(t.length===0)return[];let n=this.getZettelIndex();if(n.size===0)return[];let i=this.filterZettelsByKeywords(t,n,e);if(i.length===0)return[];let o=i.map((l,c)=>`${c}. ${l.note.title} (\uD0A4\uC6CC\uB4DC: ${l.note.keywords.join(", ")})`).join(`
`),r=await this.gemini.findRelatedNotes("\uC0C8 ZK \uB178\uD2B8",t,o),a=[];for(let l of r)if(l.index>=0&&l.index<i.length){let c=i[l.index];a.push({note:c.note,relevance:l.relevance,matchedKeywords:c.matchedKeywords,reason:l.reason||"",connectionType:l.type||""})}return a}filterZettelsByKeywords(t,e,n){let i=[],o=new Set(t.map(r=>r.toLowerCase()));for(let[r,a]of e){if(n&&r===n||a.keywords.length===0)continue;let l=[];for(let c of a.keywords){let d=c.toLowerCase();for(let p of o)if(d===p||d.includes(p)||p.includes(d)){l.push(c);break}}l.length>0&&i.push({note:a,matchedKeywords:l})}return i.sort((r,a)=>a.matchedKeywords.length-r.matchedKeywords.length),i.slice(0,10)}};var $a=require("obsidian");function oE(s,t=100){return s.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,t)}var Bp=class{constructor(t,e,n,i){this.projectMOCs=new Map;this.app=t,this.gemini=e,this.projectsFolder=n,this.settings=i}async scanProjectMOCs(){this.projectMOCs.clear();let t=this.app.vault.getMarkdownFiles();for(let e of t){let n=await this.parseProjectMOC(e);n&&this.projectMOCs.set(n.project,n)}console.log(`\uD504\uB85C\uC81D\uD2B8 MOC \uC2A4\uCE94 \uC644\uB8CC: ${this.projectMOCs.size}\uAC1C`)}async parseProjectMOC(t){let e=this.app.metadataCache.getFileCache(t),n=e==null?void 0:e.frontmatter;if(!n||n.type!=="project-moc")return null;let i=n.project||t.basename,o=n.title||t.basename;return{path:t.path,title:o,project:i}}getProjectList(){let t=this.app.vault.getAbstractFileByPath(this.projectsFolder);return t instanceof $a.TFolder?t.children.filter(e=>e instanceof $a.TFolder).map(e=>e.name):[]}getMOCCount(){return this.projectMOCs.size}async detectProject(t,e){let n=this.getProjectList();return n.length===0?null:await this.gemini.detectProject(t,e,n)}async addNoteToMOC(t,e,n){let i=this.projectMOCs.get(t);if(!i)return!1;let o=this.app.vault.getAbstractFileByPath(i.path);if(!(o instanceof $a.TFile))return!1;let r=await this.app.vault.read(o),a=this.app.vault.getAbstractFileByPath(n),c=`[[${a instanceof $a.TFile?a.basename:oE(e)}]]`;if(r.includes(c))return!0;let d=/^##  \s*$/m,p;return d.test(r)?p=r.replace(/^(##  \s*\n)/m,`$1- ${c}
`):p=r.trimEnd()+`

## \uAD00\uB828 \uB178\uD2B8
- ${c}
`,await this.app.vault.modify(o,p),!0}async createProjectMOC(t,e){this.app.vault.getAbstractFileByPath(e)||await this.app.vault.createFolder(e);let i=oE(t),o=`${e}/${i} MOC.md`;if(this.app.vault.getAbstractFileByPath(o))return null;let a=`---
type: project-moc
project: "${t}"
title: "${t} \uD504\uB85C\uC81D\uD2B8"
created: ${Ht(this.settings.timezone,this.settings.dateFormat)}
---

# ${t} \uD504\uB85C\uC81D\uD2B8

## \uAC1C\uC694


## \uC9C4\uD589 \uC911


## \uAD00\uB828 \uB178\uD2B8

`,l=await this.app.vault.create(o,a);return this.projectMOCs.set(t,{path:l.path,title:`${t} \uD504\uB85C\uC81D\uD2B8`,project:t}),l}hasProject(t){return this.projectMOCs.has(t)}getProjectMOCPath(t){let e=this.projectMOCs.get(t);return(e==null?void 0:e.path)||null}removeFromIndex(t){for(let[e,n]of this.projectMOCs)if(n.path===t){this.projectMOCs.delete(e);break}}};var N_=require("obsidian");var Hp=class{constructor(t,e,n,i,o){this.app=t,this.relatedNoteFinder=e,this.zettelFolder=n,this.settings=i,this.gemini=o||null}get indexPath(){return`${this.zettelFolder}/ZK Index.md`}async updateIndex(t,e){let n=this.app.vault.getAbstractFileByPath(this.indexPath);n instanceof N_.TFile?await this.addNoteToIndex(n,t,e):await this.createIndex(t,e)}async createIndex(t,e){let n=Ht(this.settings.timezone,this.settings.dateFormat),i=e[0]||"\uAE30\uD0C0",o=`---
type: zk-index
updated: ${n}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
- [[${t.basename}]]

## \uC8FC\uC81C\uBCC4
### ${i}
- [[${t.basename}]]
`;await this.app.vault.create(this.indexPath,o)}async addNoteToIndex(t,e,n){let i=await this.app.vault.read(t);i=this.updateRecentSection(i,e);let o=n[0]||"\uAE30\uD0C0";i=this.updateTopicSection(i,e,o),i=this.updateTimestamp(i),await this.app.vault.modify(t,i)}updateRecentSection(t,e){let n=/(##  \n)([\s\S]*?)(\n## |\n*$)/,i=t.match(n);if(i){let o=i[2].trim().split(`
`).filter(a=>a.startsWith("- ")),r=`- [[${e.basename}]]`;return o=o.filter(a=>!a.includes(e.basename)),o.unshift(r),o=o.slice(0,10),t.replace(n,`$1${o.join(`
`)}

$3`)}return t}updateTopicSection(t,e,n){let i=`### ${n}`,o=`- [[${e.basename}]]`;if(t.includes(i)){let r=new RegExp(`(### ${this.escapeRegex(n)}
)((?:- \\[\\[.*?\\]\\]
?)*)`),a=t.match(r);if(a)return a[2].includes(e.basename)?t:t.replace(r,`$1$2${o}
`)}else{let r=/(## \n)/;if(r.test(t))return t.replace(r,`$1${i}
${o}

`)}return t}updateTimestamp(t){let e=Ht(this.settings.timezone,this.settings.dateFormat);return t.replace(/^(---\n[\s\S]*?updated: ).*?(\n[\s\S]*?---)/,`$1${e}$2`)}escapeRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}async rebuildIndex(){let t=this.relatedNoteFinder.getZettelIndex();if(t.size===0)return;let e=new Map,n=[];for(let[,a]of t){let l=a.keywords[0]||"\uAE30\uD0C0";e.has(l)||e.set(l,[]),e.get(l).push(a);let c=a.path.match(/(\d{13})/),d=a.path.match(/(\d{8})-\d{3}/),p;if(c)p=new Date(parseInt(c[1]));else if(d){let g=d[1];p=new Date(parseInt(g.slice(0,4)),parseInt(g.slice(4,6))-1,parseInt(g.slice(6,8)))}else p=new Date;n.push({note:a,created:p})}n.sort((a,l)=>l.created.getTime()-a.created.getTime());let o=`---
type: zk-index
updated: ${Ht(this.settings.timezone,this.settings.dateFormat)}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
${n.slice(0,10).map(({note:a})=>{let l=a.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]]`}).join(`
`)}

## \uC8FC\uC81C\uBCC4
`;for(let[a,l]of e){let c=null;if(this.gemini&&l.length>=2)try{let d=l.map(p=>`- ${p.title} (\uD0A4\uC6CC\uB4DC: ${p.keywords.join(", ")})`).join(`
`);c=await this.gemini.generateTopicStructure(a,d)}catch(d){console.error(`\uC8FC\uC81C \uAD6C\uC870 \uC0DD\uC131 \uC2E4\uD328: ${a}`,d)}o+=`### ${a}
`,c!=null&&c.description&&(o+=`${c.description}

`),o+=`**\uD575\uC2EC \uB178\uD2B8:**
`;for(let d of l){let p=d.path.split("/"),g=p[p.length-1].replace(/\.md$/,""),m=c==null?void 0:c.notes.find(A=>A.title===d.title),_=m!=null&&m.role?` - ${m.role}`:"";if(o+=`- [[${g}]]${_}
`,m!=null&&m.relations&&m.relations.length>0)for(let A of m.relations){let T=A.type==="\uBC1C\uC804"?"\u2192":A.type==="\uAE30\uBC18"?"\u2190":"\u2194";o+=`  ${T} ${A.target}
`}}c!=null&&c.relatedTopics&&c.relatedTopics.length>0&&(o+=`
**\uAD00\uB828 \uC8FC\uC81C:** ${c.relatedTopics.join(", ")}
`),o+=`
`}let r=this.app.vault.getAbstractFileByPath(this.indexPath);r instanceof N_.TFile&&await this.app.vault.delete(r),await this.app.vault.create(this.indexPath,o)}};var Vp=class{constructor(t,e){this.gemini=t,this.settings=e}extractVideoId(t){let e=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/)([a-zA-Z0-9_-]{11})/,/^([a-zA-Z0-9_-]{11})$/];for(let n of e){let i=t.match(n);if(i)return i[1]}return null}isValidYouTubeUrl(t){return this.extractVideoId(t)!==null}async processVideo(t){let e=this.extractVideoId(t);if(!e)throw new Error("\uC720\uD6A8\uD55C YouTube URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let n=`https://www.youtube.com/watch?v=${e}`;console.log("Gemini \uB124\uC774\uD2F0\uBE0C YouTube \uBD84\uC11D \uC2DC\uC791:",n);let i=await this.gemini.analyzeYouTube(n);return{videoId:e,url:n,title:i.title,summary:i.summary,keyPoints:i.keyPoints}}generateMarkdownNote(t){let e=Ht(this.settings.timezone,this.settings.dateFormat),n=`https://www.youtube.com/embed/${t.videoId}`;return`---
type: youtube
source: "${t.url}"
title: "${t.title.replace(/"/g,'\\"')}"
created: ${e}
---

# ${t.title}

<div style="resize: both; overflow: hidden; width: 100%; height: 400px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${n}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none;" allowfullscreen></iframe>
</div>

## \uC694\uC57D
${t.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${t.keyPoints.map(i=>`- ${i}`).join(`
`)}
`}};var Bu=require("obsidian");var qp=class{constructor(t,e){this.gemini=t,this.settings=e}isValidUrl(t){try{let e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch(e){return!1}}extractMetadata(t,e){let n=l=>{let c=[new RegExp(`<meta[^>]*property=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*property=["']${l}["']`,"i"),new RegExp(`<meta[^>]*name=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*name=["']${l}["']`,"i")];for(let d of c){let p=t.match(d);if(p)return p[1]}return""},i=t.match(/<title[^>]*>([^<]+)<\/title>/i),o=t.match(/<link[^>]*rel=["'](?:shortcut )?icon["'][^>]*href=["']([^"']+)["']/i),r=new URL(e),a=l=>l?l.startsWith("http")?l:l.startsWith("//")?r.protocol+l:l.startsWith("/")?r.origin+l:r.origin+"/"+l:"";return{title:n("og:title")||n("twitter:title")||(i==null?void 0:i[1])||"",description:n("og:description")||n("twitter:description")||n("description")||"",image:a(n("og:image")||n("twitter:image")||""),siteName:n("og:site_name")||r.hostname,favicon:a((o==null?void 0:o[1])||"/favicon.ico")}}extractContent(t){let e=t.match(/<title[^>]*>([^<]+)<\/title>/i),n=t.match(/<meta[^>]*property=["']og:title["'][^>]*content=["']([^"']+)["']/i),i=(n==null?void 0:n[1])||(e==null?void 0:e[1])||"Untitled",o=t.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<nav[^>]*>[\s\S]*?<\/nav>/gi,"").replace(/<header[^>]*>[\s\S]*?<\/header>/gi,"").replace(/<footer[^>]*>[\s\S]*?<\/footer>/gi,"").replace(/<aside[^>]*>[\s\S]*?<\/aside>/gi,""),r="",a=o.match(/<article[^>]*>([\s\S]*?)<\/article>/i),l=o.match(/<main[^>]*>([\s\S]*?)<\/main>/i),c=o.match(/<div[^>]*(?:class|id)=["'][^"']*content[^"']*["'][^>]*>([\s\S]*?)<\/div>/i);if(a)r=a[1];else if(l)r=l[1];else if(c)r=c[1];else{let p=o.match(/<body[^>]*>([\s\S]*?)<\/body>/i);r=(p==null?void 0:p[1])||o}return r=r.replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&[a-z]+;/gi," ").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim(),{title:i.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim(),content:r}}async fetchWithJinaReader(t){var c,d;let e=`https://r.jina.ai/${t}`,i=(await(0,Bu.requestUrl)({url:e,method:"GET",headers:{Accept:"text/plain","X-Timeout":"30","X-Wait-For-Selector":"article, .post-content, .se-main-container, #postViewArea"}})).text;i.includes("Warning: This page maybe not yet fully loaded")&&console.log("Jina Reader: \uD398\uC774\uC9C0 \uB85C\uB529 \uACBD\uACE0 \uAC10\uC9C0");let o=i.split(`
`),r="Untitled",a=0;for((c=o[0])!=null&&c.startsWith("# ")?(r=o[0].substring(2).trim(),a=1):(d=o[0])!=null&&d.startsWith("Title: ")&&(r=o[0].substring(7).trim(),a=1);a<o.length;){let p=o[a];if(p!=null&&p.startsWith("URL Source:")||p!=null&&p.startsWith("http")||p!=null&&p.startsWith("Warning:")||p!=null&&p.startsWith("Markdown Content:")||(p==null?void 0:p.trim())==="")a++;else break}let l=o.slice(a).join(`
`).trim();if(l.length<100&&!l.includes(`
`))throw new Error("\uD398\uC774\uC9C0 \uCF58\uD150\uCE20\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4 (JavaScript \uB85C\uB529 \uB300\uAE30 \uC2E4\uD328)");return{title:r,content:l}}async fetchNaverBlog(t){var p;let e=t;if(t.includes("blog.naver.com")){let g=t.match(/blog\.naver\.com\/([^\/]+)\/(\d+)/);g&&(e=`https://m.blog.naver.com/${g[1]}/${g[2]}`)}let i=(await(0,Bu.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15",Accept:"text/html,application/xhtml+xml","Accept-Language":"ko-KR,ko;q=0.9"}})).text,o=i.match(/<title[^>]*>([^<]+)<\/title>/i),r=((p=o==null?void 0:o[1])==null?void 0:p.replace(/ :  $/,"").trim())||"Untitled",a="",l=i.match(/<div[^>]*class="[^"]*se-main-container[^"]*"[^>]*>([\s\S]*?)<\/div>\s*<\/div>\s*<\/div>/i),c=i.match(/<div[^>]*id="postViewArea"[^>]*>([\s\S]*?)<\/div>/i),d=(l==null?void 0:l[1])||(c==null?void 0:c[1])||"";return d&&(a=d.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim()),{title:r,content:a}}async processUrl(t){if(!this.isValidUrl(t))throw new Error("\uC720\uD6A8\uD55C URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let e;try{let o=(await(0,Bu.requestUrl)({url:t,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text;e=this.extractMetadata(o,t)}catch(i){console.log("\uBA54\uD0C0\uB370\uC774\uD130 \uCD94\uCD9C \uC2E4\uD328:",i)}if(t.includes("blog.naver.com"))return console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, Jina Reader \uC0AC\uC6A9"),await this.processUrlFallback(t,e);try{console.log("URL Context Tool\uB85C \uC6F9\uD398\uC774\uC9C0 \uBD84\uC11D \uC2DC\uB3C4");let i=await this.gemini.analyzeWebpage(t),o=["unable to access","cannot access","could not access","\uC811\uADFC\uD560 \uC218 \uC5C6","\uAC00\uC838\uC62C \uC218 \uC5C6"],r=i.summary.toLowerCase();return o.some(l=>r.includes(l.toLowerCase()))?(console.log("URL Context Tool \uC811\uADFC \uC2E4\uD328 \uAC10\uC9C0, \uD3F4\uBC31 \uC2DC\uB3C4"),await this.processUrlFallback(t,e)):(e&&(e.title=e.title||i.title),{url:t,title:i.title,content:"",summary:i.summary,keyPoints:i.keyPoints,metadata:e})}catch(i){console.log("URL Context Tool \uC2E4\uD328, \uD3F4\uBC31 \uC2DC\uB3C4:",i)}return await this.processUrlFallback(t,e)}async processUrlFallback(t,e){let n,i,o=null;if(!e)try{o=(await(0,Bu.requestUrl)({url:t,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text,e=this.extractMetadata(o,t)}catch(d){console.log("HTML \uAC00\uC838\uC624\uAE30 \uC2E4\uD328:",d)}if(t.includes("blog.naver.com")){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, \uC804\uC6A9 \uCD94\uCD9C \uC2DC\uB3C4");try{let d=await this.fetchNaverBlog(t);if(n=d.title,i=d.content,i.length<100)throw new Error("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uCD94\uCD9C \uC2E4\uD328")}catch(d){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uC804\uC6A9 \uCD94\uCD9C \uC2E4\uD328, Jina Reader \uC2DC\uB3C4:",d);let p=await this.fetchWithJinaReader(t);n=p.title,i=p.content}}else try{console.log("Jina Reader\uB85C \uCF58\uD150\uCE20 \uCD94\uCD9C \uC2DC\uB3C4");let d=await this.fetchWithJinaReader(t);n=d.title,i=d.content}catch(d){if(console.log("Jina Reader \uC2E4\uD328, \uC9C1\uC811 \uCD94\uCD9C\uB85C \uD3F4\uBC31:",d),o){let p=this.extractContent(o);n=p.title,i=p.content}else throw new Error("\uC6F9\uD398\uC774\uC9C0\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4")}if(i.length<50)throw new Error("\uBCF8\uBB38\uC744 \uCD94\uCD9C\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC811\uADFC\uC774 \uC81C\uD55C\uB41C \uD398\uC774\uC9C0\uC77C \uC218 \uC788\uC2B5\uB2C8\uB2E4.");let a=5e4,l=i.length>a?i.slice(0,a)+"...":i,c=await this.gemini.summarizeContent(l,"webpage");return e&&(e.title=e.title||n),{url:t,title:c.title||n,content:l,summary:c.summary,keyPoints:c.keyPoints,metadata:e}}generateMarkdownNote(t){let e=Ht(this.settings.timezone,this.settings.dateFormat),n=t.metadata,i=t.url;t.url.includes("blog.naver.com")&&!t.url.includes("m.blog.naver.com")&&(i=t.url.replace("blog.naver.com","m.blog.naver.com"));let o="";if(n){let r=n.image?`
> ![](${n.image})
>`:"",a=n.description?`
> ${n.description}
>`:"";o=`
> [!bookmark] ${n.siteName||new URL(t.url).hostname}
> **${n.title||t.title}**
>${a}${r}
> \u{1F517} ${t.url}

`}else o=`
> [!bookmark] \uC6F9\uD398\uC774\uC9C0
> **${t.title}**
>
> \u{1F517} ${t.url}

`;return`---
type: webpage
source: "${t.url}"
title: "${t.title.replace(/"/g,'\\"')}"
created: ${e}
---

# ${t.title}
${o}
<div style="resize: both; overflow: hidden; width: 100%; height: 600px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${i}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none; color-scheme: light;"></iframe>
</div>

## \uC694\uC57D
${t.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${t.keyPoints.map(r=>`- ${r}`).join(`
`)}
`}};function zp(s,t=100){return s.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,t)}var Wp=class extends R.Plugin{constructor(){super(...arguments);this.gemini=null;this.ocrProcessor=null;this.relatedNoteFinder=null;this.mocManager=null;this.zkIndexManager=null;this.youtubeExtractor=null;this.webPageExtractor=null;this.watcherRegistered=!1;this.pendingFiles=new Map;this.zkDailyCounter=new Map;this.zkLuhmannCounter=0}async onload(){await this.loadSettings(),this.addSettingTab(new qu(this.app,this)),this.processDebounced=(0,R.debounce)(()=>this.processPendingFiles(),3e3,!0),this.registerCommands(),this.settings.autoWatch&&this.startWatcher(),this.app.workspace.onLayoutReady(()=>{this.initGemini()}),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uB85C\uB4DC\uB428")}onunload(){this.stopWatcher(),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uC5B8\uB85C\uB4DC\uB428")}async loadSettings(){this.settings=Object.assign({},q_,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.initGemini()}async initGemini(){this.settings.geminiApiKey?(this.gemini=new Nd(this.settings.geminiApiKey),this.ocrProcessor=new $p(this.gemini,this.settings,this.app.vault),this.relatedNoteFinder=new Gp(this.app,this.gemini),this.mocManager=new Bp(this.app,this.gemini,this.settings.projectsFolder,this.settings),this.zkIndexManager=new Hp(this.app,this.relatedNoteFinder,this.settings.zettelFolder,this.settings,this.gemini),this.youtubeExtractor=new Vp(this.gemini,this.settings),this.webPageExtractor=new qp(this.gemini,this.settings),Promise.all([this.relatedNoteFinder.buildIndex(),this.mocManager.scanProjectMOCs()]).then(()=>{var e,n,i;console.log(`\uB178\uD2B8 \uC778\uB371\uC2A4: ${(e=this.relatedNoteFinder)==null?void 0:e.getIndexSize()}\uAC1C, MOC: ${(n=this.mocManager)==null?void 0:n.getMOCCount()}\uAC1C, ZK: ${(i=this.relatedNoteFinder)==null?void 0:i.getZettelCount()}\uAC1C`),this.initializeZKCounters()})):(this.gemini=null,this.ocrProcessor=null,this.relatedNoteFinder=null,this.mocManager=null,this.youtubeExtractor=null,this.webPageExtractor=null)}checkApiKey(){return this.gemini?!0:(new R.Notice("Gemini API \uD0A4\uB97C \uC124\uC815\uD574\uC8FC\uC138\uC694"),!1)}truncateContent(e,n=5e5){let i=e.replace(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g,"[\uC774\uBBF8\uC9C0]");return i=i.replace(/!\[[^\]]*\]\(data:[^)]+\)/g,"[\uC774\uBBF8\uC9C0]"),i.length<=n?i:i.slice(0,n)+`

[... \uB0B4\uC6A9\uC774 \uB108\uBB34 \uAE38\uC5B4 \uC77C\uBD80\uB9CC \uBD84\uC11D\uB428 ...]`}registerCommands(){this.addCommand({id:"project-classify",name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkeys:[{modifiers:["Ctrl","Shift"],key:"g"}],callback:()=>this.classifyCurrentFile()}),this.addCommand({id:"zk-extract",name:"ZK \uCD94\uCD9C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"z"}],callback:()=>this.extractZKFromCurrentFile()}),this.addCommand({id:"focus-top3",name:"Focus Top 3",hotkeys:[{modifiers:["Ctrl","Shift"],key:";"}],callback:()=>this.showFocusTop3()}),this.addCommand({id:"process-inbox",name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",callback:()=>this.processInbox()}),this.addCommand({id:"toggle-watch",name:"Watch \uD1A0\uAE00",callback:()=>this.toggleWatch()}),this.addCommand({id:"ocr-extract",name:"OCR \uCD94\uCD9C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"o"}],callback:()=>this.ocrCurrentFile()}),this.addCommand({id:"ocr-inbox",name:"Inbox OCR \uCC98\uB9AC",callback:()=>this.processInboxOCR()}),this.addCommand({id:"smart-process",name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkeys:[{modifiers:["Ctrl","Shift"],key:"s"}],callback:()=>this.smartProcessCurrentFile()}),this.addCommand({id:"create-moc",name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",callback:()=>this.showCreateMOCModal()}),this.addCommand({id:"url-import",name:"URL \uAC00\uC838\uC624\uAE30",hotkeys:[{modifiers:["Ctrl","Shift"],key:"u"}],callback:()=>this.showURLImportModal()}),this.addCommand({id:"rebuild-zk-index",name:"ZK Index \uC7AC\uAD6C\uCD95",callback:()=>this.rebuildZKIndex()}),this.addCommand({id:"smart-split",name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkeys:[{modifiers:["Ctrl","Shift"],key:"d"}],callback:()=>this.smartSplitCurrentFile()}),this.addCommand({id:"link-related-notes",name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkeys:[{modifiers:["Ctrl","Shift"],key:"l"}],callback:()=>this.linkRelatedNotesForCurrentFile()}),this.addCommand({id:"show-command-list",name:"\uBA85\uB839 \uB9AC\uC2A4\uD2B8",callback:()=>this.showCommandListModal()}),this.addRibbonIcon("brain","Zero Friction Brain",()=>{this.showCommandListModal()})}async rebuildZKIndex(){var e;if(!this.zkIndexManager){new R.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new R.Notice("ZK Index \uC7AC\uAD6C\uCD95 \uC911...");try{await this.zkIndexManager.rebuildIndex();let n=((e=this.relatedNoteFinder)==null?void 0:e.getZettelCount())||0;new R.Notice(`ZK Index \uC7AC\uAD6C\uCD95 \uC644\uB8CC: ${n}\uAC1C \uB178\uD2B8`)}catch(n){console.error("ZK Index \uC7AC\uAD6C\uCD95 \uC2E4\uD328:",n),new R.Notice(`\uC7AC\uAD6C\uCD95 \uC2E4\uD328: ${n}`)}}async smartSplitCurrentFile(){var n;if(!this.checkApiKey())return;let e=this.app.workspace.getActiveFile();if(!e){new R.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(e.extension!=="md"){new R.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uBD84\uB9AC\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4");return}new R.Notice("\uBA54\uBAA8 \uBD84\uC11D \uC911...");try{let i=await this.app.vault.read(e),o=((n=this.mocManager)==null?void 0:n.getProjectList())||[],r=await this.gemini.splitContent(i,o);if(r.length===0){new R.Notice("\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(r.length===1){new R.Notice("\uB2E8\uC77C \uC8FC\uC81C\uB85C \uD310\uB2E8\uB428. \uC77C\uBC18 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958\uB97C \uC0AC\uC6A9\uD558\uC138\uC694.");return}new G_(this.app,r,e,this).open()}catch(i){console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC2E4\uD328:",i),new R.Notice(`\uBD84\uB9AC \uC2E4\uD328: ${i}`)}}async createSplitNotes(e,n){let i=[];for(let r of e){let a=this.getTargetFolder(r.targetType,r.project);if(r.project&&!r.project.startsWith("NEW:")){let g=`${this.settings.projectsFolder}/${r.project}`;this.app.vault.getAbstractFileByPath(g)instanceof R.TFolder&&(a=g)}let l=zp(r.title),c=`${a}/${l}.md`,d=`---
targetType: ${r.targetType}
keywords: [${r.keywords.join(", ")}]
source: "[[${n.basename}]]"
created: ${Ht(this.settings.timezone,this.settings.dateFormat)}
${r.project?`project: "${r.project}"`:""}
---

# ${r.title}

${r.content}
`;this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a);try{let g=await this.app.vault.create(c,d);if(i.push(r.title),this.relatedNoteFinder&&await this.relatedNoteFinder.updateIndex(g),r.project&&this.mocManager)if(r.project.startsWith("NEW:")){let m=r.project.slice(4).trim();await this.mocManager.createProjectMOC(m,this.settings.projectsFolder)&&await this.mocManager.addNoteToMOC(m,r.title,g.path)}else await this.mocManager.addNoteToMOC(r.project,r.title,g.path)}catch(g){console.error(`\uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328: ${r.title}`,g)}}let o=`${this.settings.archivesFolder}/${n.name}`;try{this.app.vault.getAbstractFileByPath(this.settings.archivesFolder)||await this.app.vault.createFolder(this.settings.archivesFolder),await this.app.fileManager.renameFile(n,o)}catch(r){console.error("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uC2E4\uD328:",r)}new R.Notice(`${i.length}\uAC1C \uB178\uD2B8 \uC0DD\uC131\uB428, \uC6D0\uBCF8\uC740 Archives\uB85C \uC774\uB3D9`)}showCreateMOCModal(){new O_(this.app,this.mocManager,this.settings.projectsFolder).open()}showURLImportModal(){this.checkApiKey()&&new $_(this.app,"URL \uAC00\uC838\uC624\uAE30","\uC720\uD29C\uBE0C \uB610\uB294 \uC6F9\uD398\uC774\uC9C0 URL\uC744 \uC785\uB825\uD558\uC138\uC694 (\uC790\uB3D9 \uAC10\uC9C0)","https://...",async e=>{await this.processURL(e)}).open()}async processURL(e){/(?:youtube\.com|youtu\.be)/.test(e)?await this.processYouTube(e):await this.processWebPage(e)}async processYouTube(e){var n;if(!(!this.youtubeExtractor||!this.gemini)){new R.Notice("\uC720\uD29C\uBE0C \uC601\uC0C1 \uBD84\uC11D \uC911...");try{let i=await this.youtubeExtractor.processVideo(e),o=this.youtubeExtractor.generateMarkdownNote(i),r=zp(i.title),a=`${r}.md`,l=`${this.settings.inboxFolder}/${a}`,c=await this.app.vault.create(l,o);new R.Notice(`\uC720\uD29C\uBE0C \uB178\uD2B8 \uC0DD\uC131: ${r}`);let d=((n=this.mocManager)==null?void 0:n.getProjectList())||[],p=await this.gemini.classifyProject(o,d);c=await this.applyClassifyResultWithConfirmation(c,p),new R.Notice(`${p.targetType}${p.projectName?` (${p.projectName})`:""}\uB85C \uBD84\uB958\uB428`),this.app.workspace.getLeaf().openFile(c),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(c,o,p.title)}catch(i){console.error("\uC720\uD29C\uBE0C \uCC98\uB9AC \uC624\uB958:",i),new R.Notice(`\uC720\uD29C\uBE0C \uCC98\uB9AC \uC2E4\uD328: ${i}`)}}}async processWebPage(e){var n;if(!(!this.webPageExtractor||!this.gemini)){new R.Notice("\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38 \uCD94\uCD9C \uC911...");try{let i=await this.webPageExtractor.processUrl(e),o=this.webPageExtractor.generateMarkdownNote(i),r=zp(i.title),a=`${r}.md`,l=`${this.settings.inboxFolder}/${a}`,c=await this.app.vault.create(l,o);new R.Notice(`\uC6F9\uD398\uC774\uC9C0 \uB178\uD2B8 \uC0DD\uC131: ${r}`);let d=((n=this.mocManager)==null?void 0:n.getProjectList())||[],p=await this.gemini.classifyProject(o,d);c=await this.applyClassifyResultWithConfirmation(c,p),new R.Notice(`${p.targetType}${p.projectName?` (${p.projectName})`:""}\uB85C \uBD84\uB958\uB428`),this.app.workspace.getLeaf().openFile(c),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(c,o,p.title)}catch(i){console.error("\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC624\uB958:",i),new R.Notice(`\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC2E4\uD328: ${i}`)}}}async classifyCurrentFile(){var o,r;if(!this.checkApiKey())return;let e=this.app.workspace.getActiveFile();if(!e){new R.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=e.extension.toLowerCase();if(["pdf","png","jpg","jpeg","webp","gif"].includes(n)){if(!this.settings.ocrEnabled){new R.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new R.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let a=await this.ocrProcessor.checkLimits(e);if(!a.allowed){new Hu(this.app,a.reason,e,this).open();return}new R.Notice("\uCC98\uB9AC \uC911: OCR \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let l=await this.ocrProcessor.processFile(e),c=this.ocrProcessor.generateMarkdownNote(l),d=e.basename+"_OCR.md",p=`${this.settings.inboxFolder}/${d}`,g=await this.app.vault.create(p,c);if(this.settings.ocrMoveOriginal){let T=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(T)||await this.app.vault.createFolder(T);let C=`${T}/${e.name}`;await this.app.fileManager.renameFile(e,C)}let m=((o=this.mocManager)==null?void 0:o.getProjectList())||[],_=await this.gemini.classifyProject(c,m),A=await this.applyClassifyResultWithConfirmation(g,_);new R.Notice(`\uC644\uB8CC: OCR(${l.pages}p) \u2192 ${_.targetType}${_.projectName?` (${_.projectName})`:""}`),await this.findAndShowRelatedNotes(A,c,_.title)}catch(l){console.error("\uCC98\uB9AC \uC624\uB958:",l),new R.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${l}`)}return}if(n==="md"){new R.Notice("\uBD84\uB958 \uC911...");try{let a=await this.app.vault.read(e),l=this.truncateContent(a),c=((r=this.mocManager)==null?void 0:r.getProjectList())||[],d=await this.gemini.classifyProject(l,c),p=await this.applyClassifyResultWithConfirmation(e,d);new R.Notice(`${d.targetType}${d.projectName?` (${d.projectName})`:""}\uB85C \uBD84\uB958\uB428`),await this.findAndShowRelatedNotes(p,a,d.title)}catch(a){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",a),new R.Notice(`\uBD84\uB958 \uC2E4\uD328: ${a}`)}return}new R.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}async linkRelatedNotesForCurrentFile(){if(!this.checkApiKey())return;let e=this.app.workspace.getActiveFile();if(!e){new R.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(e.extension!=="md"){new R.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uC9C0\uC6D0\uD569\uB2C8\uB2E4");return}new R.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");try{let n=await this.app.vault.read(e),i=this.truncateContent(n),o=n.match(/^#\s+(.+)$/m),r=(o==null?void 0:o[1])||e.basename;await this.findAndShowRelatedNotes(e,i,r)}catch(n){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",n),new R.Notice(`\uAC80\uC0C9 \uC2E4\uD328: ${n}`)}}showCommandListModal(){new H_(this.app,this).open()}async applyClassifyResult(e,n){let i=await this.app.vault.read(e),o=this.updateFrontmatter(i,{targetType:n.targetType,project:n.projectName||void 0,title:n.title,summary:n.summary,next_action:n.nextAction||void 0,processed_at:Ht(this.settings.timezone,this.settings.dateFormat)});await this.app.vault.modify(e,o);let r=this.getTargetFolder(n.targetType,n.projectName);if(r){this.app.vault.getAbstractFileByPath(r)||await this.app.vault.createFolder(r);let l=`${r}/${e.name}`;await this.app.fileManager.renameFile(e,l);let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof R.TFile)return c}return e}async applyClassifyResultWithConfirmation(e,n){return n.contentType!=="reference"||!n.projectName?this.applyClassifyResult(e,n):new Promise(i=>{new B_(this.app,n,async o=>{let r={...n};o==="library"?(r={...n,targetType:"library"},new R.Notice(`Library\uC5D0 \uC800\uC7A5 + ${n.projectName} \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C`)):r={...n,targetType:"project"};let a=await this.applyClassifyResult(e,r);i(a)}).open()})}async findAndShowRelatedNotes(e,n,i){if(!this.relatedNoteFinder||!this.gemini)return;let o=this.truncateContent(n);try{let r=await this.gemini.extractKeywords(o);r.length>0&&this.relatedNoteFinder&&await this.relatedNoteFinder.saveKeywordsToNote(e,r),this.mocManager&&this.mocManager.getMOCCount()>0&&await this.handleProjectMOC(e,i,r),new R.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");let a=await this.relatedNoteFinder.findRelated(o,i,e.path);a.length>0?new L_(this.app,a,e,this.relatedNoteFinder).open():r.length>0&&new R.Notice(`\uD0A4\uC6CC\uB4DC ${r.length}\uAC1C \uC800\uC7A5\uB428`)}catch(r){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",r)}}async handleProjectMOC(e,n,i){if(!(!this.mocManager||!this.gemini))try{let o=await this.mocManager.detectProject(n,i);if(!o)return;if(o.startsWith("NEW:")){let a=o.slice(4).trim();new U_(this.app,a,e,n,this.mocManager,this.settings.projectsFolder).open();return}await this.mocManager.addNoteToMOC(o,n,e.path)&&new R.Notice(`\u{1F4C1} ${o} MOC\uC5D0 \uC5F0\uACB0\uB428`)}catch(o){console.error("MOC \uC5F0\uACB0 \uC624\uB958:",o)}}getTargetFolder(e,n){switch(e){case"project":return n?`${this.settings.projectsFolder}/${n}`:this.settings.projectsFolder;case"library":return this.settings.libraryFolder;case"archive":return this.settings.archivesFolder;default:return this.settings.libraryFolder}}updateFrontmatter(e,n){let i=/^---\n([\s\S]*?)\n---\n?/,o=e.match(i),r="",a=e;o&&(r=o[1],a=e.slice(o[0].length));let l=r.split(`
`).filter(p=>p.trim()),c=new Map;for(let p of l){let g=p.indexOf(":");if(g!==-1){let m=p.slice(0,g).trim(),_=p.slice(g+1).trim();c.set(m,_)}}for(let[p,g]of Object.entries(n))if(g!==void 0){let _=/[:\[\]{}#&*!|>'"%@`]/.test(g)&&!g.startsWith('"')?`"${g.replace(/"/g,'\\"')}"`:g;c.set(p,_)}return`---
${Array.from(c.entries()).map(([p,g])=>`${p}: ${g}`).join(`
`)}
---
${a}`}async extractZKFromCurrentFile(){if(!this.checkApiKey())return;let e=this.app.workspace.getActiveFile();if(!e){new R.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new R.Notice("ZK \uC544\uC774\uB514\uC5B4 \uCD94\uCD9C \uC911...");try{let n=await this.app.vault.read(e),i=await this.gemini.extractZK(n);if(i.length===0){new R.Notice("\uCD94\uCD9C\uD560 \uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new k_(this.app,i,e,this).open()}catch(n){console.error("ZK \uCD94\uCD9C \uC624\uB958:",n),new R.Notice(`\uCD94\uCD9C \uC2E4\uD328: ${n}`)}}initializeZKCounters(){if(!this.relatedNoteFinder)return;let e=this.relatedNoteFinder.getZettelIndex();for(let[n]of e){let o=(n.split("/").pop()||"").match(/^(\d{8})-(\d{3})/);if(o){let r=o[1],a=parseInt(o[2],10),l=this.zkDailyCounter.get(r)||0;a>l&&this.zkDailyCounter.set(r,a)}this.zkLuhmannCounter=Math.max(this.zkLuhmannCounter,e.size)}console.log(`ZK \uCE74\uC6B4\uD130 \uCD08\uAE30\uD654: \uB8E8\uB9CC=${this.zkLuhmannCounter}, \uC77C\uBCC4=${this.zkDailyCounter.size}\uAC1C \uB0A0\uC9DC`)}generateZKId(){switch(this.settings.zkIdType){case"timestamp":return Date.now().toString();case"date-sequence":{let n=Bo(this.settings.timezone).replace(/-/g,""),i=(this.zkDailyCounter.get(n)||0)+1;return this.zkDailyCounter.set(n,i),`${n}-${i.toString().padStart(3,"0")}`}case"luhmann":return this.zkLuhmannCounter++,this.toLuhmannId(this.zkLuhmannCounter);default:return Date.now().toString()}}toLuhmannId(e){if(e<=0)return"1";let n=[],i=e,o=0;for(;i>0;){if(o%2===0){let r=(i-1)%9+1;n.push(r.toString()),i=Math.floor((i-1)/9)}else{let r=(i-1)%26;n.push(String.fromCharCode(97+r)),i=Math.floor((i-1)/26)}o++}return n.reverse().join("")}async createZKNotes(e,n){var d;let i=this.settings.zettelFolder;this.app.vault.getAbstractFileByPath(i)||await this.app.vault.createFolder(i);let r=[],a=[],l=0;for(let p of e){let m=(await this.relatedNoteFinder.findRelatedZettels(p.keywords)).find(S=>S.relevance>=this.settings.zkMergeThreshold);if(m&&await this.showMergeConfirmModal(p,m)){await this.mergeToExistingZK(m.note.path,p,n),a.push(p.title);continue}let _=this.generateZKId(),A=zp(p.title),T=`${i}/${_} ${A}.md`,E=`---
type: zettel
source: "[[${n.basename}]]"
keywords: [${p.keywords.join(", ")}]
created: ${Ht(this.settings.timezone,this.settings.dateFormat)}
---

# ${p.title}

## \uD575\uC2EC \uC544\uC774\uB514\uC5B4
${p.body}

## \uC65C \uC911\uC694\uD55C\uAC00?
${p.importance||""}

## \uB9E5\uB77D
- **\uC6D0\uBCF8**: [[${n.basename}]]
- **\uAD00\uB828 \uAC1C\uB150**: ${((d=p.relatedConcepts)==null?void 0:d.join(", "))||""}

---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
- [[${n.basename}]] (\uC6D0\uBCF8)
`;await this.app.vault.create(T,E),r.push(p.title);let C=this.app.vault.getAbstractFileByPath(T);if(C instanceof R.TFile){await this.relatedNoteFinder.updateIndex(C);let S=await this.relatedNoteFinder.findRelatedZettels(p.keywords,T);S.length>0&&(await this.addZKRelatedLinks(C,S),await this.addBacklinksToZettels(C,S),l+=S.length),this.zkIndexManager&&await this.zkIndexManager.updateIndex(C,p.keywords)}await new Promise(S=>setTimeout(S,10))}let c=[];r.length>0&&c.push(`${r.length}\uAC1C \uC0DD\uC131`),a.length>0&&c.push(`${a.length}\uAC1C \uBCD1\uD569`),l>0&&c.push(`${l}\uAC1C \uC5F0\uACB0`),new R.Notice(`ZK \uB178\uD2B8: ${c.join(", ")}`)}showMergeConfirmModal(e,n){return new Promise(i=>{new D_(this.app,e,n,r=>i(r)).open()})}async mergeToExistingZK(e,n,i){let o=this.app.vault.getAbstractFileByPath(e);if(!(o instanceof R.TFile))return;let r=await this.app.vault.read(o),a=`

---
## \uCD94\uAC00\uB41C \uB0B4\uC6A9 (${new Date().toLocaleDateString()})
*\uC6D0\uBCF8: [[${i.basename}]]*

${n.body}
`,l=/(\n---\n##  )/,c;l.test(r)?c=r.replace(l,`${a}$1`):c=r+a;let d=this.extractKeywordsFromFrontmatter(r),p=[...new Set([...d,...n.keywords])];c=this.updateFrontmatterKeywordsInContent(c,p),await this.app.vault.modify(o,c),await this.relatedNoteFinder.updateIndex(o)}extractKeywordsFromFrontmatter(e){let n=e.match(/^---\n[\s\S]*?keywords:\s*\[(.*?)\][\s\S]*?---/);return n?n[1].split(",").map(i=>i.trim().replace(/^["']|["']$/g,"")).filter(i=>i.length>0):[]}updateFrontmatterKeywordsInContent(e,n){let i=`keywords: [${n.join(", ")}]`;return e.replace(/^(---\n[\s\S]*?)(keywords:\s*\[.*?\])([\s\S]*?---)/,`$1${i}$3`)}async addZKRelatedLinks(e,n){if(n.length===0)return;let i=await this.app.vault.read(e),o=n.map(c=>{let d=c.note.path.split("/"),g=d[d.length-1].replace(/\.md$/,""),m=c.reason?`
  \u2192 ${c.reason}`:"";return`- [[${g}]] (${Math.round(c.relevance*100)}%)${m}`}).join(`
`),r=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,a=i.match(r),l;a?l=i.replace(r,`$1
${o}$2`):l=i+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${o}
`,await this.app.vault.modify(e,l)}async addBacklinksToZettels(e,n){for(let i of n){let o=this.app.vault.getAbstractFileByPath(i.note.path);if(!(o instanceof R.TFile))continue;let r=await this.app.vault.read(o);if(r.includes(`[[${e.basename}]]`))continue;let a=i.reason?`
  \u2192 ${i.reason}`:"",l=`- [[${e.basename}]] (${Math.round(i.relevance*100)}%)${a}`,c=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,d=r.match(c),p;d?p=r.replace(c,`$1
${l}$2`):p=r+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${l}
`,await this.app.vault.modify(o,p)}}async showFocusTop3(){if(this.checkApiKey()){new R.Notice("\uD504\uB85C\uC81D\uD2B8 \uBD84\uC11D \uC911...");try{let e=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(!e||!(e instanceof R.TFolder)){new R.Notice("Projects \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=await this.collectProjectsSummary(e);if(!n){new R.Notice("\uC9C4\uD589 \uC911\uC778 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let i=await this.gemini.getFocus(n);if(i.length===0){new R.Notice("\uCD94\uCC9C\uD560 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new F_(this.app,i).open()}catch(e){console.error("Focus \uBD84\uC11D \uC624\uB958:",e),new R.Notice(`\uBD84\uC11D \uC2E4\uD328: ${e}`)}}}async collectProjectsSummary(e){let n=[];for(let i of e.children)if(i instanceof R.TFile&&i.extension==="md"){let o=await this.app.vault.read(i),r=this.extractFrontmatter(o),a=r.title||i.basename,l=r.summary||"",c=r.next_action||"";n.push(`- ${a}: ${l} (\uB2E4\uC74C: ${c})`)}return n.join(`
`)}extractFrontmatter(e){let n=/^---\n([\s\S]*?)\n---/,i=e.match(n);if(!i)return{};let o={},r=i[1].split(`
`);for(let a of r){let l=a.indexOf(":");if(l!==-1){let c=a.slice(0,l).trim(),d=a.slice(l+1).trim();o[c]=d}}return o}async processInbox(){var l;if(!this.checkApiKey())return;let e=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!e||!(e instanceof R.TFolder)){new R.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=0,i=0,o=this.settings.triggerTag,r=[];for(let c of e.children)c instanceof R.TFile&&c.extension==="md"&&(await this.app.vault.read(c)).includes(o)&&r.push(c);if(r.length===0){new R.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new R.Notice(`${r.length}\uAC1C \uD30C\uC77C \uCC98\uB9AC \uC2DC\uC791...`);let a=((l=this.mocManager)==null?void 0:l.getProjectList())||[];for(let c=0;c<r.length;c++){let d=r[c];try{new R.Notice(`\uCC98\uB9AC \uC911: ${c+1}/${r.length} - ${d.name}`,2e3);let p=await this.app.vault.read(d),g=await this.gemini.classifyProject(p,a);await this.applyClassifyResult(d,g),n++}catch(p){console.error(`\uCC98\uB9AC \uC2E4\uD328: ${d.name}`,p),i++}}new R.Notice(`\uC644\uB8CC: ${n}\uAC1C \uCC98\uB9AC, ${i}\uAC1C \uC2E4\uD328`)}toggleWatch(){this.watcherRegistered?(this.stopWatcher(),new R.Notice("Watch \uC911\uC9C0\uB428")):(this.startWatcher(),new R.Notice("Watch \uC2DC\uC791\uB428"))}startWatcher(){this.watcherRegistered||(this.registerEvent(this.app.vault.on("create",e=>{e instanceof R.TFile&&this.onFileChange(e)})),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof R.TFile&&this.onFileChange(e)})),this.registerEvent(this.app.vault.on("delete",e=>{var n,i;e instanceof R.TFile&&((n=this.relatedNoteFinder)==null||n.removeFromIndex(e.path),(i=this.mocManager)==null||i.removeFromIndex(e.path),console.log(`\uC778\uB371\uC2A4\uC5D0\uC11C \uC81C\uAC70: ${e.path}`))})),this.watcherRegistered=!0,console.log("Inbox \uAC10\uC2DC \uC2DC\uC791"))}stopWatcher(){this.watcherRegistered=!1,this.pendingFiles.clear(),console.log("Inbox \uAC10\uC2DC \uC911\uC9C0")}onFileChange(e){this.watcherRegistered&&this.gemini&&e.path.startsWith(this.settings.inboxFolder)&&e.extension==="md"&&(this.pendingFiles.set(e.path,Date.now()),this.processDebounced())}async processPendingFiles(){var o;if(!this.gemini)return;let e=Date.now(),n=this.settings.triggerTag,i=((o=this.mocManager)==null?void 0:o.getProjectList())||[];for(let[r,a]of this.pendingFiles.entries()){if(e-a<3e3)continue;this.pendingFiles.delete(r);let l=this.app.vault.getAbstractFileByPath(r);if(l instanceof R.TFile)try{let c=await this.app.vault.read(l);if(!c.includes(n))continue;let d=await this.gemini.classifyProject(c,i);await this.applyClassifyResult(l,d),new R.Notice(`\uC790\uB3D9 \uBD84\uB958: ${l.name} \u2192 ${d.targetType}${d.projectName?` (${d.projectName})`:""}`)}catch(c){console.error(`\uC790\uB3D9 \uBD84\uB958 \uC2E4\uD328: ${r}`,c)}}}async ocrCurrentFile(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new R.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new R.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let e=this.app.workspace.getActiveFile();if(!e){new R.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=e.extension.toLowerCase();if(!["png","jpg","jpeg","webp","gif","pdf"].includes(n)){new R.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`);return}let o=await this.ocrProcessor.checkLimits(e);if(!o.allowed){new Hu(this.app,o.reason,e,this).open();return}new R.Notice("OCR \uCC98\uB9AC \uC911...");try{let r=await this.ocrProcessor.processFile(e),a=this.ocrProcessor.generateMarkdownNote(r),l=e.basename+"_OCR.md",c=`${this.settings.inboxFolder}/${l}`;if(await this.app.vault.create(c,a),this.settings.ocrMoveOriginal){let d=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(d)||await this.app.vault.createFolder(d);let g=`${d}/${e.name}`;await this.app.fileManager.renameFile(e,g)}new R.Notice(`OCR \uC644\uB8CC: ${l} \uC0DD\uC131\uB428 (${r.pages}\uD398\uC774\uC9C0)`)}catch(r){console.error("OCR \uC624\uB958:",r),new R.Notice(`OCR \uC2E4\uD328: ${r}`)}}async processInboxOCR(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new R.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new R.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let e=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!e||!(e instanceof R.TFolder)){new R.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=["png","jpg","jpeg","webp","gif","pdf"],i=[];for(let a of e.children){if(!(a instanceof R.TFile))continue;let l=a.extension.toLowerCase();if(!n.includes(l))continue;(await this.ocrProcessor.checkLimits(a)).allowed&&i.push(a)}if(i.length===0){new R.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new R.Notice(`${i.length}\uAC1C \uD30C\uC77C OCR \uCC98\uB9AC \uC2DC\uC791...`);let o=0,r=0;for(let a=0;a<i.length;a++){let l=i[a];try{new R.Notice(`OCR \uC911: ${a+1}/${i.length} - ${l.name}`,3e3);let c=await this.ocrProcessor.processFile(l),d=this.ocrProcessor.generateMarkdownNote(c),p=l.basename+"_OCR.md",g=`${this.settings.inboxFolder}/${p}`;if(await this.app.vault.create(g,d),this.settings.ocrMoveOriginal){let m=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(m)||await this.app.vault.createFolder(m);let A=`${m}/${l.name}`;await this.app.fileManager.renameFile(l,A)}o++,a<i.length-1&&await new Promise(m=>setTimeout(m,1e3))}catch(c){console.error(`OCR \uCC98\uB9AC \uC2E4\uD328: ${l.name}`,c),r++}}new R.Notice(`OCR \uC644\uB8CC: ${o}\uAC1C \uCC98\uB9AC, ${r}\uAC1C \uC2E4\uD328`)}async smartProcessCurrentFile(){var o,r;if(!this.checkApiKey())return;let e=this.app.workspace.getActiveFile();if(!e){new R.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=e.extension.toLowerCase();if(["pdf","png","jpg","jpeg","webp","gif"].includes(n)){if(!this.settings.ocrEnabled){new R.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new R.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let a=await this.ocrProcessor.checkLimits(e);if(!a.allowed){new Hu(this.app,a.reason,e,this).open();return}new R.Notice("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC911: OCR \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let l=await this.ocrProcessor.processFile(e),c=this.ocrProcessor.generateMarkdownNote(l),d=e.basename+"_OCR.md",p=`${this.settings.inboxFolder}/${d}`,g=await this.app.vault.create(p,c);if(this.settings.ocrMoveOriginal){let A=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(A)||await this.app.vault.createFolder(A);let E=`${A}/${e.name}`;await this.app.fileManager.renameFile(e,E)}let m=((o=this.mocManager)==null?void 0:o.getProjectList())||[],_=await this.gemini.classifyProject(c,m);await this.applyClassifyResultWithConfirmation(g,_),new R.Notice(`\uC644\uB8CC: OCR(${l.pages}p) \u2192 ${_.targetType}${_.projectName?` (${_.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(l){console.error("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC624\uB958:",l),new R.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${l}`)}}else if(n==="md"){new R.Notice("\uBD84\uB958 \uC911...");try{let a=await this.app.vault.read(e),l=((r=this.mocManager)==null?void 0:r.getProjectList())||[],c=await this.gemini.classifyProject(a,l);await this.applyClassifyResultWithConfirmation(e,c),new R.Notice(`${c.targetType}${c.projectName?` (${c.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(a){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",a),new R.Notice(`\uBD84\uB958 \uC2E4\uD328: ${a}`)}}else new R.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}getOCRDailyUsage(){return this.ocrProcessor?this.ocrProcessor.getDailyUsage():{date:Bo(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}},k_=class extends R.Modal{constructor(t,e,n,i){super(t),this.candidates=e,this.selected=new Set(e.map((o,r)=>r)),this.sourceFile=n,this.plugin=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"ZK \uC544\uC774\uB514\uC5B4 \uC120\uD0DD"}),t.createEl("p",{text:"\uC0DD\uC131\uD560 Zettelkasten \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let e=t.createDiv({cls:"zk-candidate-list"});this.candidates.forEach((r,a)=>{let l=e.createDiv({cls:"zk-candidate-item"}),c=l.createEl("input",{type:"checkbox",attr:{checked:!0}});c.addEventListener("change",()=>{c.checked?this.selected.add(a):this.selected.delete(a)});let d=l.createDiv({cls:"zk-candidate-label"});d.createEl("strong",{text:r.title}),d.createEl("p",{text:r.body,cls:"zk-candidate-body"}),d.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${r.keywords.join(", ")}`,cls:"zk-candidate-keywords"})});let n=t.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{let r=this.candidates.filter((a,l)=>this.selected.has(l));r.length>0&&await this.plugin.createZKNotes(r,this.sourceFile),this.close()})}onClose(){this.contentEl.empty()}},D_=class extends R.Modal{constructor(t,e,n,i){super(t),this.candidate=e,this.similarNote=n,this.onResult=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC720\uC0AC\uD55C \uB178\uD2B8 \uBC1C\uACAC"}),t.createEl("p",{text:`\uC0C8 \uC544\uC774\uB514\uC5B4\uC640 ${Math.round(this.similarNote.relevance*100)}% \uC720\uC0AC\uD55C \uB178\uD2B8\uAC00 \uC788\uC2B5\uB2C8\uB2E4.`,cls:"setting-item-description"});let e=t.createDiv({cls:"merge-section"});e.createEl("h4",{text:"\uC0C8 \uC544\uC774\uB514\uC5B4"}),e.createEl("p",{text:this.candidate.title,cls:"merge-title"}),e.createEl("p",{text:this.candidate.body,cls:"merge-body"});let n=t.createDiv({cls:"merge-section"});n.createEl("h4",{text:"\uAE30\uC874 \uB178\uD2B8"}),n.createEl("p",{text:this.similarNote.note.title,cls:"merge-title"}),n.createEl("p",{text:`\uD0A4\uC6CC\uB4DC: ${this.similarNote.note.keywords.join(", ")}`,cls:"merge-keywords"});let i=t.createDiv({cls:"merge-buttons"});i.createEl("button",{text:"\uAE30\uC874 \uB178\uD2B8\uC5D0 \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",()=>{this.onResult(!0),this.close()}),i.createEl("button",{text:"\uC0C8 \uB178\uD2B8 \uC0DD\uC131"}).addEventListener("click",()=>{this.onResult(!1),this.close()})}onClose(){this.contentEl.empty()}},F_=class extends R.Modal{constructor(t,e){super(t),this.items=e}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC624\uB298 \uC9D1\uC911\uD560 \uD504\uB85C\uC81D\uD2B8 Top 3"});let e=t.createDiv({cls:"focus-list"});this.items.forEach((o,r)=>{let a=e.createDiv({cls:"focus-item"});a.createEl("h3",{text:`${r+1}. ${o.title}`}),a.createEl("p",{text:o.why,cls:"focus-why"}),a.createEl("p",{text:`\u2192 ${o.nextAction}`,cls:"focus-action"})}),t.createDiv({cls:"modal-button-container"}).createEl("button",{text:"\uB2EB\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}},Hu=class extends R.Modal{constructor(t,e,n,i){super(t),this.reason=e,this.file=n,this.plugin=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uD30C\uC77C\uC774 \uB108\uBB34 \uD07D\uB2C8\uB2E4"}),t.createEl("p",{text:this.reason}),t.createEl("p",{text:"\uC124\uC815\uC5D0\uC11C \uC81C\uD55C\uC744 \uC870\uC815\uD558\uAC70\uB098, \uD30C\uC77C\uC744 \uBD84\uD560\uD574\uC11C \uCC98\uB9AC\uD558\uC138\uC694.",cls:"setting-item-description"});let e=t.createDiv({cls:"modal-button-container"});e.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),e.createEl("button",{text:"\uC124\uC815 \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.app.setting.open()})}onClose(){this.contentEl.empty()}},L_=class extends R.Modal{constructor(t,e,n,i){super(t),this.relatedNotes=e,this.selected=new Set(e.map((o,r)=>r)),this.currentFile=n,this.finder=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uAD00\uB828 \uB178\uD2B8 \uBC1C\uACAC"}),t.createEl("p",{text:"\uC5F0\uACB0\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let e=t.createDiv({cls:"related-notes-list"});this.relatedNotes.forEach((r,a)=>{let l=e.createDiv({cls:"related-note-item"}),c=l.createEl("input",{type:"checkbox",attr:{checked:!0}});c.addEventListener("change",()=>{c.checked?this.selected.add(a):this.selected.delete(a)});let d=l.createDiv({cls:"related-note-label"});d.createEl("strong",{text:r.note.title});let p=Math.round(r.relevance*100);d.createEl("span",{text:` (${p}%)`,cls:"related-note-relevance"}),r.matchedKeywords.length>0&&d.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${r.matchedKeywords.join(", ")}`,cls:"related-note-keywords"})});let n=t.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uB9C1\uD06C \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",async()=>{let r=this.relatedNotes.filter((a,l)=>this.selected.has(l));r.length>0&&(await this.finder.addRelatedLinks(this.currentFile,r),new R.Notice(`${r.length}\uAC1C \uAD00\uB828 \uB178\uD2B8 \uB9C1\uD06C \uCD94\uAC00\uB428`)),this.close()})}onClose(){this.contentEl.empty()}},U_=class extends R.Modal{constructor(t,e,n,i,o,r){super(t),this.projectName=e,this.noteFile=n,this.noteTitle=i,this.mocManager=o,this.projectsFolder=r}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 \uAC10\uC9C0"}),t.createEl("p",{text:`"${this.projectName}" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC0C8\uB85C \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`}),t.createEl("p",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8\uC758 MOC(Map of Content)\uB97C \uC0DD\uC131\uD560\uAE4C\uC694?",cls:"setting-item-description"});let e=t.createDiv({cls:"modal-button-container"});e.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>this.close()),e.createEl("button",{text:"MOC \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{await this.mocManager.createProjectMOC(this.projectName,this.projectsFolder)?(await this.mocManager.addNoteToMOC(this.projectName,this.noteTitle,this.noteFile.path),new R.Notice(`\u{1F4C1} ${this.projectName} MOC \uC0DD\uC131 \uBC0F \uC5F0\uACB0 \uC644\uB8CC`)):new R.Notice("MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4"),this.close()})}onClose(){this.contentEl.empty()}},O_=class extends R.Modal{constructor(t,e,n){super(t),this.mocManager=e,this.projectsFolder=n}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131"}),t.createEl("p",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 MOC\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4. \uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694.",cls:"setting-item-description"});let e=t.createDiv({cls:"moc-input-container"});if(e.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uC774\uB984:"}),this.inputEl=e.createEl("input",{type:"text",placeholder:"\uC608: \uC2A4\uB9C8\uD2B8\uD31C"}),this.inputEl.style.width="100%",this.inputEl.style.marginTop="8px",this.inputEl.style.padding="8px",this.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&this.createMOC()}),this.mocManager&&this.mocManager.getMOCCount()>0){let r=t.createDiv({cls:"existing-mocs"});r.createEl("h4",{text:"\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 MOC:"});let a=r.createEl("ul");for(let l of this.mocManager.getProjectList())a.createEl("li",{text:l})}let n=t.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createMOC()),setTimeout(()=>this.inputEl.focus(),10)}async createMOC(){let t=this.inputEl.value.trim();if(!t){new R.Notice("\uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694");return}if(!this.mocManager){new R.Notice("MOC \uAD00\uB9AC\uC790\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4"),this.close();return}if(this.mocManager.getProjectList().includes(t)){new R.Notice(`"${t}" MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4`);return}let n=await this.mocManager.createProjectMOC(t,this.projectsFolder);n?(new R.Notice(`\u{1F4C1} ${t} MOC \uC0DD\uC131 \uC644\uB8CC`),this.app.workspace.getLeaf().openFile(n)):new R.Notice("MOC \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4"),this.close()}onClose(){this.contentEl.empty()}},$_=class extends R.Modal{constructor(t,e,n,i,o){super(t),this.title=e,this.description=n,this.placeholder=i,this.onSubmit=o}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.title}),t.createEl("p",{text:this.description,cls:"setting-item-description"});let e=t.createDiv({cls:"url-input-container"});this.inputEl=e.createEl("input",{type:"text",placeholder:this.placeholder}),this.inputEl.style.width="100%",this.inputEl.style.padding="8px",navigator.clipboard.readText().then(r=>{r&&(r.startsWith("http://")||r.startsWith("https://"))&&(this.inputEl.value=r)}).catch(()=>{}),this.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&this.submit()});let n=t.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uAC00\uC838\uC624\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.submit()),setTimeout(()=>this.inputEl.focus(),10)}async submit(){let t=this.inputEl.value.trim();if(!t){new R.Notice("URL\uC744 \uC785\uB825\uD558\uC138\uC694");return}this.close(),await this.onSubmit(t)}onClose(){this.contentEl.empty()}},G_=class extends R.Modal{constructor(t,e,n,i){super(t),this.sections=e,this.selected=new Set(e.map((o,r)=>r)),this.sourceFile=n,this.plugin=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uACB0\uACFC"}),t.createEl("p",{text:`${this.sections.length}\uAC1C\uC758 \uC139\uC158\uC73C\uB85C \uBD84\uB9AC\uB428. \uC0DD\uC131\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let e=t.createDiv({cls:"split-section-list"});this.sections.forEach((r,a)=>{let l=e.createDiv({cls:"split-section-item"});l.style.marginBottom="16px",l.style.padding="12px",l.style.border="1px solid var(--background-modifier-border)",l.style.borderRadius="8px";let c=l.createDiv({cls:"split-section-header"});c.style.display="flex",c.style.alignItems="center",c.style.gap="8px";let d=c.createEl("input",{type:"checkbox",attr:{checked:!0}});d.addEventListener("change",()=>{d.checked?this.selected.add(a):this.selected.delete(a)}),c.createEl("strong",{text:r.title});let p=c.createDiv({cls:"split-section-badges"});p.style.marginLeft="auto",p.style.display="flex",p.style.gap="4px";let g=p.createEl("span",{text:r.targetType,cls:"split-category-badge"});if(g.style.padding="2px 8px",g.style.borderRadius="4px",g.style.fontSize="12px",g.style.backgroundColor=this.getTargetTypeColor(r.targetType),g.style.color="white",r.project){let A=p.createEl("span",{text:r.project.startsWith("NEW:")?`\u2728 ${r.project.slice(4)}`:`\u{1F4C1} ${r.project}`,cls:"split-project-badge"});A.style.padding="2px 8px",A.style.borderRadius="4px",A.style.fontSize="12px",A.style.backgroundColor="var(--interactive-accent)",A.style.color="white"}let m=l.createDiv({cls:"split-section-preview"});m.style.marginTop="8px",m.style.fontSize="13px",m.style.color="var(--text-muted)",m.style.maxHeight="60px",m.style.overflow="hidden",m.style.textOverflow="ellipsis";let _=r.content.length>150?r.content.slice(0,150)+"...":r.content;if(m.setText(_),r.keywords.length>0){let A=l.createDiv({cls:"split-section-keywords"});A.style.marginTop="8px",A.style.fontSize="12px",A.setText(`\uD0A4\uC6CC\uB4DC: ${r.keywords.join(", ")}`)}});let n=t.createDiv({cls:"modal-button-container"});n.style.marginTop="16px",n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:`${this.selected.size}\uAC1C \uB178\uD2B8 \uC0DD\uC131`,cls:"mod-cta"}).addEventListener("click",async()=>{let r=this.sections.filter((a,l)=>this.selected.has(l));r.length>0&&(this.close(),await this.plugin.createSplitNotes(r,this.sourceFile))})}getTargetTypeColor(t){switch(t){case"project":return"#e67e22";case"library":return"#27ae60";case"archive":return"#95a5a6";default:return"#7f8c8d"}}onClose(){this.contentEl.empty()}},B_=class extends R.Modal{constructor(t,e,n){super(t),this.result=e,this.onChoice=n}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC800\uC7A5 \uC704\uCE58 \uC120\uD0DD"});let e=t.createDiv({cls:"reference-confirm-info"});e.style.marginBottom="16px",e.style.padding="12px",e.style.backgroundColor="var(--background-secondary)",e.style.borderRadius="8px",e.createEl("p",{text:`"${this.result.title}"`,cls:"reference-title"}).style.fontWeight="bold",e.createEl("p",{text:`\uAD00\uB828 \uD504\uB85C\uC81D\uD2B8: ${this.result.projectName}`,cls:"reference-project"}).style.color="var(--text-muted)",e.createEl("p",{text:"\uC774 \uC790\uB8CC\uB294 \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB85C \uBCF4\uC785\uB2C8\uB2E4. \uC5B4\uB514\uC5D0 \uC800\uC7A5\uD560\uAE4C\uC694?",cls:"reference-question"}).style.marginTop="8px";let n=t.createDiv({cls:"reference-options"});n.style.display="flex",n.style.flexDirection="column",n.style.gap="12px";let i=n.createDiv({cls:"reference-option"});i.style.padding="12px",i.style.border="1px solid var(--background-modifier-border)",i.style.borderRadius="8px",i.style.cursor="pointer",i.addEventListener("mouseenter",()=>{i.style.backgroundColor="var(--background-secondary)"}),i.addEventListener("mouseleave",()=>{i.style.backgroundColor=""}),i.createEl("strong",{text:"\u{1F4C1} \uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC800\uC7A5"}),i.createEl("p",{text:`Projects/${this.result.projectName}/ \uC5D0 \uC800\uC7A5`,cls:"option-desc"}).style.color="var(--text-muted)",i.createEl("small",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8 \uC804\uC6A9 \uC790\uB8CC\uB85C \uAD00\uB9AC"}).style.color="var(--text-faint)",i.addEventListener("click",()=>{this.close(),this.onChoice("project")});let o=n.createDiv({cls:"reference-option"});o.style.padding="12px",o.style.border="2px solid var(--interactive-accent)",o.style.borderRadius="8px",o.style.cursor="pointer",o.style.backgroundColor="var(--background-secondary)",o.createEl("strong",{text:"\u{1F4DA} Library\uC5D0 \uC800\uC7A5 + \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C (\uAD8C\uC7A5)"}),o.createEl("p",{text:"Library/ \uC5D0 \uC800\uC7A5\uD558\uACE0 \uD504\uB85C\uC81D\uD2B8\uC640 \uC5F0\uACB0",cls:"option-desc"}).style.color="var(--text-muted)",o.createEl("small",{text:"\uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5"}).style.color="var(--text-faint)",o.addEventListener("click",()=>{this.close(),this.onChoice("library")});let r=t.createDiv({cls:"modal-button-container"});r.style.marginTop="16px",r.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}},H_=class extends R.Modal{constructor(t,e){super(t),this.plugin=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-command-list-modal");let e=t.createEl("h2",{text:"\u{1F9E0} Zero Friction Brain"});e.style.marginBottom="16px",e.style.textAlign="center";let n=[{name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkey:"Ctrl+Shift+G",icon:"folder",action:()=>this.plugin.classifyCurrentFile()},{name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkey:"Ctrl+Shift+L",icon:"link",action:()=>this.plugin.linkRelatedNotesForCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkey:"Ctrl+Shift+S",icon:"sparkles",action:()=>this.plugin.smartProcessCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkey:"Ctrl+Shift+D",icon:"split",action:()=>this.plugin.smartSplitCurrentFile()},{name:"ZK \uCD94\uCD9C",hotkey:"Ctrl+Shift+Z",icon:"file-plus",action:()=>this.plugin.extractZKFromCurrentFile()},{name:"URL \uAC00\uC838\uC624\uAE30",hotkey:"Ctrl+Shift+U",icon:"globe",action:()=>this.plugin.showURLImportModal()},{name:"Focus Top 3",hotkey:"Ctrl+Shift+;",icon:"target",action:()=>this.plugin.showFocusTop3()},{name:"OCR \uCD94\uCD9C",hotkey:"Ctrl+Shift+O",icon:"scan",action:()=>this.plugin.ocrCurrentFile()},{divider:!0},{name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",hotkey:"",icon:"inbox",action:()=>this.plugin.processInbox()},{name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",hotkey:"",icon:"map",action:()=>this.plugin.showCreateMOCModal()},{name:"ZK Index \uC7AC\uAD6C\uCD95",hotkey:"",icon:"refresh-cw",action:()=>this.plugin.rebuildZKIndex()},{name:"Watch \uD1A0\uAE00",hotkey:"",icon:"eye",action:()=>this.plugin.toggleWatch()}],i=t.createDiv({cls:"zfb-command-list"});i.style.display="flex",i.style.flexDirection="column",i.style.gap="4px";for(let a of n){if("divider"in a&&a.divider){let p=i.createEl("hr");p.style.margin="8px 0",p.style.border="none",p.style.borderTop="1px solid var(--background-modifier-border)";continue}let l=i.createDiv({cls:"zfb-command-item"});l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="space-between",l.style.padding="10px 12px",l.style.borderRadius="6px",l.style.cursor="pointer",l.style.transition="background-color 0.1s",l.addEventListener("mouseenter",()=>{l.style.backgroundColor="var(--background-secondary)"}),l.addEventListener("mouseleave",()=>{l.style.backgroundColor=""});let c=l.createDiv();c.style.display="flex",c.style.alignItems="center",c.style.gap="10px";let d=c.createSpan({cls:"zfb-command-icon"});if((0,R.setIcon)(d,a.icon||"command"),d.style.opacity="0.7",c.createSpan({text:a.name}),a.hotkey){let p=l.createSpan({text:a.hotkey,cls:"zfb-command-hotkey"});p.style.fontSize="0.85em",p.style.color="var(--text-muted)",p.style.backgroundColor="var(--background-secondary)",p.style.padding="2px 8px",p.style.borderRadius="4px",p.style.fontFamily="monospace"}l.addEventListener("click",()=>{this.close(),a.action()})}let o=t.createDiv({cls:"zfb-command-footer"});o.style.marginTop="16px",o.style.paddingTop="12px",o.style.borderTop="1px solid var(--background-modifier-border)",o.style.textAlign="center",o.style.color="var(--text-muted)",o.style.fontSize="0.85em",o.createSpan({text:`v${this.plugin.manifest.version} \u2022 `});let r=o.createEl("a",{text:"\uC124\uC815"});r.style.cursor="pointer",r.addEventListener("click",()=>{this.close(),this.app.setting.open(),this.app.setting.openTabById("zero-friction-brain")})}onClose(){this.contentEl.empty()}};
/*! Bundled license information:

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
