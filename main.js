/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Wu=Object.defineProperty;var TE=Object.getOwnPropertyDescriptor;var EE=Object.getOwnPropertyNames;var CE=Object.prototype.hasOwnProperty;var SE=(s,t,e)=>t in s?Wu(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var bE=(s,t)=>{for(var e in t)Wu(s,e,{get:t[e],enumerable:!0})},xE=(s,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of EE(t))!CE.call(s,i)&&i!==e&&Wu(s,i,{get:()=>t[i],enumerable:!(n=TE(t,i))||n.enumerable});return s};var IE=s=>xE(Wu({},"__esModule",{value:!0}),s);var H=(s,t,e)=>(SE(s,typeof t!="symbol"?t+"":t,e),e),jp=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var u=(s,t,e)=>(jp(s,t,"read from private field"),e?e.call(s):t.get(s)),y=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},_=(s,t,e,n)=>(jp(s,t,"write to private field"),n?n.call(s,e):t.set(s,e),e);var jt=(s,t,e,n)=>({set _(i){_(s,t,i,e)},get _(){return u(s,t,n)}}),w=(s,t,e)=>(jp(s,t,"access private method"),e);var aP={};bE(aP,{default:()=>Zp});module.exports=IE(aP);var P=require("obsidian");var t_={geminiApiKey:"",inboxFolder:"00 _Inbox",projectsFolder:"01 Projects",libraryFolder:"02 Library",archivesFolder:"03 Archives",zettelFolder:"10 Zettelkasten",autoWatch:!0,triggerTag:"#\uC644\uB8CC",language:"ko",ocrEnabled:!0,ocrAutoProcess:!1,ocrMoveOriginal:!0,ocrOriginalFolder:"03 Archives/OCR_\uC6D0\uBCF8",ocrMinTextThreshold:50,ocrMaxPages:20,ocrMaxFileSizeMB:10,ocrDailyLimit:50,zkIdType:"date-sequence",zkMergeThreshold:.8,timezone:"auto",dateFormat:"local"};var rt=require("obsidian");var i_=[{value:"auto",label:"\uC790\uB3D9 \uAC10\uC9C0"},{value:"Asia/Seoul",label:"\uD55C\uAD6D (KST, UTC+9)"},{value:"Asia/Tokyo",label:"\uC77C\uBCF8 (JST, UTC+9)"},{value:"Asia/Shanghai",label:"\uC911\uAD6D (CST, UTC+8)"},{value:"America/New_York",label:"\uBBF8\uAD6D \uB3D9\uBD80 (EST/EDT)"},{value:"America/Los_Angeles",label:"\uBBF8\uAD6D \uC11C\uBD80 (PST/PDT)"},{value:"Europe/London",label:"\uC601\uAD6D (GMT/BST)"},{value:"UTC",label:"UTC"}],s_=[{value:"iso",label:"ISO \uD615\uC2DD (2026-01-05T16:24:45+09:00)"},{value:"local",label:"\uB85C\uCEEC \uD615\uC2DD (2026-01-05 16:24:45)"},{value:"friendly",label:"\uCE5C\uADFC\uD55C \uD615\uC2DD (2026\uB144 1\uC6D4 5\uC77C 16:24)"}];function Ku(s){return s==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:s}function tg(s,t,e){let n=Ku(t);switch(e){case"iso":return RE(s,n);case"local":return e_(s,n);case"friendly":return PE(s,n);default:return e_(s,n)}}function RE(s,t){let e={timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",e).formatToParts(s),i=g=>{var m;return((m=n.find(v=>v.type===g))==null?void 0:m.value)||""},o=i("year"),r=i("month"),a=i("day"),l=i("hour"),c=i("minute"),d=i("second"),p=ME(s,t);return`${o}-${r}-${a}T${l}:${c}:${d}${p}`}function e_(s,t){let e={timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",e).formatToParts(s),i=p=>{var g;return((g=n.find(m=>m.type===p))==null?void 0:g.value)||""},o=i("year"),r=i("month"),a=i("day"),l=i("hour"),c=i("minute"),d=i("second");return`${o}-${r}-${a} ${l}:${c}:${d}`}function PE(s,t){let e={timeZone:t,year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};return new Intl.DateTimeFormat("ko-KR",e).format(s)}function ME(s,t){let e=new Date(s.toLocaleString("en-US",{timeZone:"UTC"})),i=(new Date(s.toLocaleString("en-US",{timeZone:t})).getTime()-e.getTime())/(1e3*60);if(i===0)return"Z";let o=i>=0?"+":"-",r=Math.abs(i),a=Math.floor(r/60),l=r%60;return`${o}${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}`}function Ve(s,t){let n={timeZone:Ku(t),year:"numeric",month:"2-digit",day:"2-digit"},i=new Intl.DateTimeFormat("en-CA",n).formatToParts(s),o=r=>{var a;return((a=i.find(l=>l.type===r))==null?void 0:a.value)||""};return`${o("year")}-${o("month")}-${o("day")}`}function Dt(s,t){return tg(new Date,s,t)}function Ho(s){return Ve(new Date,s)}function qa(s,t){let e=Ku(t),n=new Date;switch(s){case"today":return n_(n,e);case"week":return NE(n,e);case"month":return kE(n,e);default:return n_(n,e)}}function n_(s,t){let e=eg(s,t),n=ng(s,t);return{start:e,end:n,label:"\uC624\uB298"}}function NE(s,t){let e=s.getDay(),n=e===0?6:e-1,i=new Date(s);i.setDate(i.getDate()-n);let o=new Date(i);return o.setDate(o.getDate()+6),{start:eg(i,t),end:ng(o,t),label:"\uC774\uBC88 \uC8FC"}}function kE(s,t){let e=new Date(s.getFullYear(),s.getMonth(),1),n=new Date(s.getFullYear(),s.getMonth()+1,0);return{start:eg(e,t),end:ng(n,t),label:"\uC774\uBC88 \uB2EC"}}function eg(s,t){let e=new Date(s);return e.setHours(0,0,0,0),e}function ng(s,t){let e=new Date(s);return e.setHours(23,59,59,999),e}function o_(s,t){return s>=t.start&&s<=t.end}function ig(s){let t=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())),e=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-e);let n=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t.getTime()-n.getTime())/864e5+1)/7)}function r_(s,t,e){let n=Ku(e);switch(s){case"today":return`${Ve(t,n)} \uC77C\uC77C \uD68C\uACE0.md`;case"week":let i=ig(t);return`${t.getFullYear()}-W${String(i).padStart(2,"0")} \uC8FC\uAC04 \uD68C\uACE0.md`;case"month":return`${Ve(t,n).substring(0,7)} \uC6D4\uAC04 \uD68C\uACE0.md`;default:return`${Ve(t,n)} \uD68C\uACE0.md`}}function a_(s){let e=new Date().getTime()-s.getTime(),n=Math.floor(e/(1e3*60)),i=Math.floor(e/(1e3*60*60)),o=Math.floor(e/(1e3*60*60*24));return n<1?"\uBC29\uAE08 \uC804":n<60?`${n}\uBD84 \uC804`:i<24?`${i}\uC2DC\uAC04 \uC804`:o===1?"\uC5B4\uC81C":o<7?`${o}\uC77C \uC804`:o<30?`${Math.floor(o/7)}\uC8FC \uC804`:`${Math.floor(o/30)}\uAC1C\uC6D4 \uC804`}var Yu=class extends rt.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Zero Friction Brain \uC124\uC815"}),t.createEl("h3",{text:"API \uC124\uC815"}),new rt.Setting(t).setName("Gemini API \uD0A4").setDesc(createFragment(n=>{n.appendText("Gemini API \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694. "),n.createEl("a",{text:"API \uD0A4 \uBC1C\uAE09\uBC1B\uAE30",href:"https://aistudio.google.com/apikey"})})).addText(n=>n.setPlaceholder("AIzaSy...").setValue(this.plugin.settings.geminiApiKey).onChange(async i=>{this.plugin.settings.geminiApiKey=i,await this.plugin.saveSettings()})),t.createEl("h3",{text:"\uD3F4\uB354 \uC124\uC815"}),new rt.Setting(t).setName("Inbox \uD3F4\uB354").setDesc("\uC0C8 \uB178\uD2B8\uAC00 \uC800\uC7A5\uB418\uB294 \uD3F4\uB354").addText(n=>n.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.inboxFolder).onChange(async i=>{this.plugin.settings.inboxFolder=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("Projects \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uBCC4 \uD558\uC704 \uD3F4\uB354\uAC00 \uC0DD\uC131\uB429\uB2C8\uB2E4").addText(n=>n.setPlaceholder("01 Projects").setValue(this.plugin.settings.projectsFolder).onChange(async i=>{this.plugin.settings.projectsFolder=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("Library \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uC5D0 \uC18D\uD558\uC9C0 \uC54A\uB294 \uCC38\uACE0 \uC790\uB8CC").addText(n=>n.setPlaceholder("02 Library").setValue(this.plugin.settings.libraryFolder).onChange(async i=>{this.plugin.settings.libraryFolder=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("Archives \uD3F4\uB354").setDesc("\uC644\uB8CC\uB41C \uD504\uB85C\uC81D\uD2B8 (\uD1B5\uC9F8\uB85C \uC774\uB3D9)").addText(n=>n.setPlaceholder("03 Archives").setValue(this.plugin.settings.archivesFolder).onChange(async i=>{this.plugin.settings.archivesFolder=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("Zettelkasten \uD3F4\uB354").setDesc("ZK \uC601\uAD6C \uB178\uD2B8 \uC800\uC7A5 \uC704\uCE58").addText(n=>n.setPlaceholder("10 Zettelkasten").setValue(this.plugin.settings.zettelFolder).onChange(async i=>{this.plugin.settings.zettelFolder=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("\uD3F4\uB354 \uAD6C\uC870 \uC0DD\uC131").setDesc("\uC704\uC5D0 \uC124\uC815\uB41C \uD3F4\uB354\uB4E4\uC744 \uC790\uB3D9\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4").addButton(n=>n.setButtonText("\uD3F4\uB354 \uC0DD\uC131").setCta().onClick(async()=>{await this.createFolderStructure()})),t.createEl("h3",{text:"\uC635\uC158"}),new rt.Setting(t).setName("Inbox \uC790\uB3D9 \uAC10\uC2DC").setDesc("Inbox \uD3F4\uB354\uC758 \uD30C\uC77C\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC2DC\uD558\uC5EC \uBD84\uB958").addToggle(n=>n.setValue(this.plugin.settings.autoWatch).onChange(async i=>{this.plugin.settings.autoWatch=i,await this.plugin.saveSettings(),i?this.plugin.startWatcher():this.plugin.stopWatcher()})),new rt.Setting(t).setName("\uD2B8\uB9AC\uAC70 \uD0DC\uADF8").setDesc("\uC774 \uD0DC\uADF8\uAC00 \uC788\uB294 \uB178\uD2B8\uB9CC \uC790\uB3D9 \uBD84\uB958 (\uC608: #\uC644\uB8CC)").addText(n=>n.setPlaceholder("#\uC644\uB8CC").setValue(this.plugin.settings.triggerTag).onChange(async i=>{this.plugin.settings.triggerTag=i,await this.plugin.saveSettings()})),t.createEl("h3",{text:"OCR \uC124\uC815"}),new rt.Setting(t).setName("OCR \uAE30\uB2A5 \uD65C\uC131\uD654").setDesc("\uC774\uBBF8\uC9C0 \uBC0F PDF\uC5D0\uC11C \uD14D\uC2A4\uD2B8 \uCD94\uCD9C").addToggle(n=>n.setValue(this.plugin.settings.ocrEnabled).onChange(async i=>{this.plugin.settings.ocrEnabled=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("OCR \uD6C4 \uC6D0\uBCF8 \uC774\uB3D9").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC744 \uC9C0\uC815 \uD3F4\uB354\uB85C \uC774\uB3D9").addToggle(n=>n.setValue(this.plugin.settings.ocrMoveOriginal).onChange(async i=>{this.plugin.settings.ocrMoveOriginal=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uD3F4\uB354").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC774 \uC774\uB3D9\uB420 \uD3F4\uB354").addText(n=>n.setPlaceholder("03 Archives/OCR_\uC6D0\uBCF8").setValue(this.plugin.settings.ocrOriginalFolder).onChange(async i=>{this.plugin.settings.ocrOriginalFolder=i,await this.plugin.saveSettings()})),t.createEl("h3",{text:"OCR \uC81C\uD55C (API \uC694\uAE08 \uBCF4\uD638)"}),new rt.Setting(t).setName("\uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").setDesc("\uD55C \uBC88\uC5D0 \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 PDF \uD398\uC774\uC9C0 \uC218").addSlider(n=>n.setLimits(1,100,1).setValue(this.plugin.settings.ocrMaxPages).setDynamicTooltip().onChange(async i=>{this.plugin.settings.ocrMaxPages=i,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (20)").onClick(async()=>{this.plugin.settings.ocrMaxPages=20,await this.plugin.saveSettings(),this.display()})),new rt.Setting(t).setName("\uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30 (MB)").setDesc("\uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30").addSlider(n=>n.setLimits(1,50,1).setValue(this.plugin.settings.ocrMaxFileSizeMB).setDynamicTooltip().onChange(async i=>{this.plugin.settings.ocrMaxFileSizeMB=i,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (10)").onClick(async()=>{this.plugin.settings.ocrMaxFileSizeMB=10,await this.plugin.saveSettings(),this.display()})),new rt.Setting(t).setName("\uC77C\uC77C \uCC98\uB9AC \uD55C\uB3C4 (\uD398\uC774\uC9C0)").setDesc("\uD558\uB8E8\uC5D0 OCR \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").addSlider(n=>n.setLimits(10,500,10).setValue(this.plugin.settings.ocrDailyLimit).setDynamicTooltip().onChange(async i=>{this.plugin.settings.ocrDailyLimit=i,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (50)").onClick(async()=>{this.plugin.settings.ocrDailyLimit=50,await this.plugin.saveSettings(),this.display()})),t.createDiv({cls:"ocr-usage-info"}).createEl("p",{text:`\uC624\uB298 \uC0AC\uC6A9\uB7C9: ${this.plugin.getOCRDailyUsage().pagesProcessed}/${this.plugin.settings.ocrDailyLimit} \uD398\uC774\uC9C0`,cls:"setting-item-description"}),t.createEl("h3",{text:"Zettelkasten \uC124\uC815"}),new rt.Setting(t).setName("ZK \uB178\uD2B8 ID \uD615\uC2DD").setDesc("ZK \uB178\uD2B8 \uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uD560 ID \uD615\uC2DD").addDropdown(n=>n.addOption("timestamp","\uD0C0\uC784\uC2A4\uD0EC\uD504 (1735789200000)").addOption("date-sequence","\uB0A0\uC9DC+\uC21C\uBC88 (20260102-001)").addOption("luhmann","\uB8E8\uB9CC \uC2A4\uD0C0\uC77C (1a1b)").setValue(this.plugin.settings.zkIdType).onChange(async i=>{this.plugin.settings.zkIdType=i,await this.plugin.saveSettings()})),new rt.Setting(t).setName("\uC720\uC0AC \uB178\uD2B8 \uBCD1\uD569 \uC784\uACC4\uAC12").setDesc("\uC774 \uAC12 \uC774\uC0C1\uC758 \uC720\uC0AC\uB3C4\uB97C \uAC00\uC9C4 \uB178\uD2B8\uAC00 \uC788\uC73C\uBA74 \uBCD1\uD569 \uC81C\uC548 (0.5~1.0)").addSlider(n=>n.setLimits(.5,1,.05).setValue(this.plugin.settings.zkMergeThreshold).setDynamicTooltip().onChange(async i=>{this.plugin.settings.zkMergeThreshold=i,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (0.8)").onClick(async()=>{this.plugin.settings.zkMergeThreshold=.8,await this.plugin.saveSettings(),this.display()})),t.createEl("h3",{text:"\uC2DC\uAC04\uB300 \uBC0F \uB0A0\uC9DC \uD615\uC2DD"}),new rt.Setting(t).setName("\uC2DC\uAC04\uB300").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504\uC5D0 \uC0AC\uC6A9\uD560 \uC2DC\uAC04\uB300").addDropdown(n=>{i_.forEach(i=>{n.addOption(i.value,i.label)}),n.setValue(this.plugin.settings.timezone).onChange(async i=>{this.plugin.settings.timezone=i,await this.plugin.saveSettings()})}),new rt.Setting(t).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504 \uD45C\uC2DC \uD615\uC2DD").addDropdown(n=>{s_.forEach(i=>{n.addOption(i.value,i.label)}),n.setValue(this.plugin.settings.dateFormat).onChange(async i=>{this.plugin.settings.dateFormat=i,await this.plugin.saveSettings()})})}async createFolderStructure(){let t=[this.plugin.settings.inboxFolder,this.plugin.settings.projectsFolder,this.plugin.settings.libraryFolder,this.plugin.settings.archivesFolder,this.plugin.settings.zettelFolder],e=0,n=0;for(let i of t){if(!i)continue;if(this.app.vault.getAbstractFileByPath(i))n++;else try{await this.app.vault.createFolder(i),e++}catch(r){console.error(`\uD3F4\uB354 \uC0DD\uC131 \uC2E4\uD328: ${i}`,r)}}e>0?new rt.Notice(`${e}\uAC1C \uD3F4\uB354 \uC0DD\uC131\uB428, ${n}\uAC1C \uC774\uBBF8 \uC874\uC7AC`):new rt.Notice(`\uBAA8\uB4E0 \uD3F4\uB354\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4 (${n}\uAC1C)`)}};var DE,FE;function LE(){return{geminiUrl:DE,vertexUrl:FE}}function UE(s,t,e,n){var i,o;if(!(s!=null&&s.baseUrl)){let r=LE();return t?(i=r.vertexUrl)!==null&&i!==void 0?i:e:(o=r.geminiUrl)!==null&&o!==void 0?o:n}return s.baseUrl}var We=class{};function D(s,t){let e=/\{([^}]+)\}/g;return s.replace(e,(n,i)=>{if(Object.prototype.hasOwnProperty.call(t,i)){let o=t[i];return o!=null?String(o):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function f(s,t,e){for(let o=0;o<t.length-1;o++){let r=t[o];if(r.endsWith("[]")){let a=r.slice(0,-2);if(!(a in s))if(Array.isArray(e))s[a]=Array.from({length:e.length},()=>({}));else throw new Error(`Value must be a list given an array path ${r}`);if(Array.isArray(s[a])){let l=s[a];if(Array.isArray(e))for(let c=0;c<l.length;c++){let d=l[c];f(d,t.slice(o+1),e[c])}else for(let c of l)f(c,t.slice(o+1),e)}return}else if(r.endsWith("[0]")){let a=r.slice(0,-3);a in s||(s[a]=[{}]);let l=s[a];f(l[0],t.slice(o+1),e);return}(!s[r]||typeof s[r]!="object")&&(s[r]={}),s=s[r]}let n=t[t.length-1],i=s[n];if(i!==void 0){if(!e||typeof e=="object"&&Object.keys(e).length===0||e===i)return;if(typeof i=="object"&&typeof e=="object"&&i!==null&&e!==null)Object.assign(i,e);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof e=="object"&&e!==null&&!Array.isArray(e)?Object.assign(s,e):s[n]=e}function h(s,t,e=void 0){try{if(t.length===1&&t[0]==="_self")return s;for(let n=0;n<t.length;n++){if(typeof s!="object"||s===null)return e;let i=t[n];if(i.endsWith("[]")){let o=i.slice(0,-2);if(o in s){let r=s[o];return Array.isArray(r)?r.map(a=>h(a,t.slice(n+1),e)):e}else return e}else s=s[i]}return s}catch(n){if(n instanceof TypeError)return e;throw n}}function OE(s,t){for(let[e,n]of Object.entries(t)){let i=e.split("."),o=n.split("."),r=new Set,a=-1;for(let l=0;l<i.length;l++)if(i[l]==="*"){a=l;break}if(a!==-1&&o.length>a)for(let l=a;l<o.length;l++){let c=o[l];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&r.add(c)}rg(s,i,o,0,r)}}function rg(s,t,e,n,i){if(n>=t.length||typeof s!="object"||s===null)return;let o=t[n];if(o.endsWith("[]")){let r=o.slice(0,-2),a=s;if(r in a&&Array.isArray(a[r]))for(let l of a[r])rg(l,t,e,n+1,i)}else if(o==="*"){if(typeof s=="object"&&s!==null&&!Array.isArray(s)){let r=s,a=Object.keys(r).filter(c=>!c.startsWith("_")&&!i.has(c)),l={};for(let c of a)l[c]=r[c];for(let[c,d]of Object.entries(l)){let p=[];for(let g of e.slice(n))g==="*"?p.push(c):p.push(g);f(r,p,d)}for(let c of a)delete r[c]}}else{let r=s;o in r&&rg(r[o],t,e,n+1,i)}}function sm(s){if(typeof s!="string")throw new Error("fromImageBytes must be a string");return s}function $E(s){let t={},e=h(s,["operationName"]);e!=null&&f(t,["operationName"],e);let n=h(s,["resourceName"]);return n!=null&&f(t,["_url","resourceName"],n),t}function GE(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response","generateVideoResponse"]);return r!=null&&f(t,["response"],HE(r)),t}function BE(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response"]);return r!=null&&f(t,["response"],VE(r)),t}function HE(s){let t={},e=h(s,["generatedSamples"]);if(e!=null){let o=e;Array.isArray(o)&&(o=o.map(r=>qE(r))),f(t,["generatedVideos"],o)}let n=h(s,["raiMediaFilteredCount"]);n!=null&&f(t,["raiMediaFilteredCount"],n);let i=h(s,["raiMediaFilteredReasons"]);return i!=null&&f(t,["raiMediaFilteredReasons"],i),t}function VE(s){let t={},e=h(s,["videos"]);if(e!=null){let o=e;Array.isArray(o)&&(o=o.map(r=>zE(r))),f(t,["generatedVideos"],o)}let n=h(s,["raiMediaFilteredCount"]);n!=null&&f(t,["raiMediaFilteredCount"],n);let i=h(s,["raiMediaFilteredReasons"]);return i!=null&&f(t,["raiMediaFilteredReasons"],i),t}function qE(s){let t={},e=h(s,["video"]);return e!=null&&f(t,["video"],ZE(e)),t}function zE(s){let t={},e=h(s,["_self"]);return e!=null&&f(t,["video"],QE(e)),t}function WE(s){let t={},e=h(s,["operationName"]);return e!=null&&f(t,["_url","operationName"],e),t}function KE(s){let t={},e=h(s,["operationName"]);return e!=null&&f(t,["_url","operationName"],e),t}function YE(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response"]);return r!=null&&f(t,["response"],JE(r)),t}function JE(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["parent"]);n!=null&&f(t,["parent"],n);let i=h(s,["documentName"]);return i!=null&&f(t,["documentName"],i),t}function MA(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response"]);return r!=null&&f(t,["response"],XE(r)),t}function XE(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["parent"]);n!=null&&f(t,["parent"],n);let i=h(s,["documentName"]);return i!=null&&f(t,["documentName"],i),t}function ZE(s){let t={},e=h(s,["uri"]);e!=null&&f(t,["uri"],e);let n=h(s,["encodedVideo"]);n!=null&&f(t,["videoBytes"],sm(n));let i=h(s,["encoding"]);return i!=null&&f(t,["mimeType"],i),t}function QE(s){let t={},e=h(s,["gcsUri"]);e!=null&&f(t,["uri"],e);let n=h(s,["bytesBase64Encoded"]);n!=null&&f(t,["videoBytes"],sm(n));let i=h(s,["mimeType"]);return i!=null&&f(t,["mimeType"],i),t}var l_;(function(s){s.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",s.OUTCOME_OK="OUTCOME_OK",s.OUTCOME_FAILED="OUTCOME_FAILED",s.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(l_||(l_={}));var c_;(function(s){s.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",s.PYTHON="PYTHON"})(c_||(c_={}));var u_;(function(s){s.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",s.SILENT="SILENT",s.WHEN_IDLE="WHEN_IDLE",s.INTERRUPT="INTERRUPT"})(u_||(u_={}));var Ai;(function(s){s.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",s.STRING="STRING",s.NUMBER="NUMBER",s.INTEGER="INTEGER",s.BOOLEAN="BOOLEAN",s.ARRAY="ARRAY",s.OBJECT="OBJECT",s.NULL="NULL"})(Ai||(Ai={}));var d_;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(d_||(d_={}));var h_;(function(s){s.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",s.SIMPLE_SEARCH="SIMPLE_SEARCH",s.ELASTIC_SEARCH="ELASTIC_SEARCH"})(h_||(h_={}));var f_;(function(s){s.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",s.NO_AUTH="NO_AUTH",s.API_KEY_AUTH="API_KEY_AUTH",s.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",s.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",s.OAUTH="OAUTH",s.OIDC_AUTH="OIDC_AUTH"})(f_||(f_={}));var p_;(function(s){s.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",s.HTTP_IN_QUERY="HTTP_IN_QUERY",s.HTTP_IN_HEADER="HTTP_IN_HEADER",s.HTTP_IN_PATH="HTTP_IN_PATH",s.HTTP_IN_BODY="HTTP_IN_BODY",s.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(p_||(p_={}));var g_;(function(s){s.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",s.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",s.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",s.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(g_||(g_={}));var m_;(function(s){s.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH",s.MINIMAL="MINIMAL"})(m_||(m_={}));var y_;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",s.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",s.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",s.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",s.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(y_||(y_={}));var v_;(function(s){s.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",s.SEVERITY="SEVERITY",s.PROBABILITY="PROBABILITY"})(v_||(v_={}));var __;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE",s.OFF="OFF"})(__||(__={}));var A_;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.OTHER="OTHER",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.SPII="SPII",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.IMAGE_SAFETY="IMAGE_SAFETY",s.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",s.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",s.NO_IMAGE="NO_IMAGE",s.IMAGE_RECITATION="IMAGE_RECITATION",s.IMAGE_OTHER="IMAGE_OTHER"})(A_||(A_={}));var w_;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})(w_||(w_={}));var T_;(function(s){s.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",s.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",s.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",s.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",s.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(T_||(T_={}));var E_;(function(s){s.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",s.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",s.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",s.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",s.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(E_||(E_={}));var C_;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.IMAGE_SAFETY="IMAGE_SAFETY",s.MODEL_ARMOR="MODEL_ARMOR",s.JAILBREAK="JAILBREAK"})(C_||(C_={}));var S_;(function(s){s.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",s.ON_DEMAND="ON_DEMAND",s.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(S_||(S_={}));var nd;(function(s){s.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",s.TEXT="TEXT",s.IMAGE="IMAGE",s.AUDIO="AUDIO"})(nd||(nd={}));var b_;(function(s){s.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",s.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",s.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",s.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(b_||(b_={}));var x_;(function(s){s.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",s.TUNING_MODE_FULL="TUNING_MODE_FULL",s.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(x_||(x_={}));var I_;(function(s){s.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",s.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",s.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",s.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",s.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",s.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",s.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(I_||(I_={}));var ag;(function(s){s.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",s.JOB_STATE_QUEUED="JOB_STATE_QUEUED",s.JOB_STATE_PENDING="JOB_STATE_PENDING",s.JOB_STATE_RUNNING="JOB_STATE_RUNNING",s.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",s.JOB_STATE_FAILED="JOB_STATE_FAILED",s.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",s.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",s.JOB_STATE_PAUSED="JOB_STATE_PAUSED",s.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",s.JOB_STATE_UPDATING="JOB_STATE_UPDATING",s.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(ag||(ag={}));var R_;(function(s){s.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",s.TUNING_TASK_I2V="TUNING_TASK_I2V",s.TUNING_TASK_T2V="TUNING_TASK_T2V",s.TUNING_TASK_R2V="TUNING_TASK_R2V"})(R_||(R_={}));var P_;(function(s){s.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",s.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",s.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",s.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",s.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(P_||(P_={}));var M_;(function(s){s.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",s.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",s.BALANCED="BALANCED",s.PRIORITIZE_COST="PRIORITIZE_COST"})(M_||(M_={}));var N_;(function(s){s.UNSPECIFIED="UNSPECIFIED",s.BLOCKING="BLOCKING",s.NON_BLOCKING="NON_BLOCKING"})(N_||(N_={}));var k_;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(k_||(k_={}));var D_;(function(s){s.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",s.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(D_||(D_={}));var F_;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE",s.VALIDATED="VALIDATED"})(F_||(F_={}));var L_;(function(s){s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(L_||(L_={}));var U_;(function(s){s.DONT_ALLOW="DONT_ALLOW",s.ALLOW_ADULT="ALLOW_ADULT",s.ALLOW_ALL="ALLOW_ALL"})(U_||(U_={}));var O_;(function(s){s.auto="auto",s.en="en",s.ja="ja",s.ko="ko",s.hi="hi",s.zh="zh",s.pt="pt",s.es="es"})(O_||(O_={}));var $_;(function(s){s.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",s.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",s.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",s.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",s.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})($_||($_={}));var G_;(function(s){s.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",s.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",s.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",s.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(G_||(G_={}));var B_;(function(s){s.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",s.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",s.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",s.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(B_||(B_={}));var H_;(function(s){s.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",s.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",s.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",s.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",s.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",s.EDIT_MODE_STYLE="EDIT_MODE_STYLE",s.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",s.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(H_||(H_={}));var V_;(function(s){s.FOREGROUND="FOREGROUND",s.BACKGROUND="BACKGROUND",s.PROMPT="PROMPT",s.SEMANTIC="SEMANTIC",s.INTERACTIVE="INTERACTIVE"})(V_||(V_={}));var q_;(function(s){s.ASSET="ASSET",s.STYLE="STYLE"})(q_||(q_={}));var z_;(function(s){s.INSERT="INSERT",s.REMOVE="REMOVE",s.REMOVE_STATIC="REMOVE_STATIC",s.OUTPAINT="OUTPAINT"})(z_||(z_={}));var W_;(function(s){s.OPTIMIZED="OPTIMIZED",s.LOSSLESS="LOSSLESS"})(W_||(W_={}));var K_;(function(s){s.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",s.PREFERENCE_TUNING="PREFERENCE_TUNING"})(K_||(K_={}));var Y_;(function(s){s.STATE_UNSPECIFIED="STATE_UNSPECIFIED",s.STATE_PENDING="STATE_PENDING",s.STATE_ACTIVE="STATE_ACTIVE",s.STATE_FAILED="STATE_FAILED"})(Y_||(Y_={}));var J_;(function(s){s.STATE_UNSPECIFIED="STATE_UNSPECIFIED",s.PROCESSING="PROCESSING",s.ACTIVE="ACTIVE",s.FAILED="FAILED"})(J_||(J_={}));var X_;(function(s){s.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",s.UPLOADED="UPLOADED",s.GENERATED="GENERATED"})(X_||(X_={}));var Z_;(function(s){s.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.RESPONSE_REJECTED="RESPONSE_REJECTED",s.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Z_||(Z_={}));var Q_;(function(s){s.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",s.TEXT="TEXT",s.IMAGE="IMAGE",s.VIDEO="VIDEO",s.AUDIO="AUDIO",s.DOCUMENT="DOCUMENT"})(Q_||(Q_={}));var j_;(function(s){s.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",s.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",s.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(j_||(j_={}));var tA;(function(s){s.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",s.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",s.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(tA||(tA={}));var eA;(function(s){s.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",s.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",s.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(eA||(eA={}));var nA;(function(s){s.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",s.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",s.NO_INTERRUPTION="NO_INTERRUPTION"})(nA||(nA={}));var iA;(function(s){s.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",s.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",s.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(iA||(iA={}));var sA;(function(s){s.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",s.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",s.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",s.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",s.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",s.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",s.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",s.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",s.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",s.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",s.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",s.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",s.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(sA||(sA={}));var oA;(function(s){s.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",s.QUALITY="QUALITY",s.DIVERSITY="DIVERSITY",s.VOCALIZATION="VOCALIZATION"})(oA||(oA={}));var qo;(function(s){s.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",s.PLAY="PLAY",s.PAUSE="PAUSE",s.STOP="STOP",s.RESET_CONTEXT="RESET_CONTEXT"})(qo||(qo={}));var Ka=class{constructor(t){let e={};for(let n of t.headers.entries())e[n[0]]=n[1];this.headers=e,this.responseInternal=t}json(){return this.responseInternal.json()}};var us=class{get text(){var t,e,n,i,o,r,a,l;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",d=!1,p=[];for(let g of(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[m,v]of Object.entries(g))m!=="text"&&m!=="thought"&&m!=="thoughtSignature"&&(v!==null||v!==void 0)&&p.push(m);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;d=!0,c+=g.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?c:void 0}get data(){var t,e,n,i,o,r,a,l;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="",d=[];for(let p of(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[g,m]of Object.entries(p))g!=="inlineData"&&(m!==null||m!==void 0)&&d.push(g);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var t,e,n,i,o,r,a,l;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let c=(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var t,e,n,i,o,r,a,l,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let d=(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var t,e,n,i,o,r,a,l,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let d=(l=(a=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.output}},id=class{},sd=class{},lg=class{},cg=class{},ug=class{},dg=class{},od=class{},rd=class{},ad=class{},hg=class{};var ld=class s{_fromAPIResponse({apiResponse:t,_isVertexAI:e}){let n=new s,i,o=t;return e?i=BE(o):i=GE(o),Object.assign(n,i),n}},cd=class{},ud=class{},dd=class{},hd=class{},fg=class{},pg=class{},gg=class{};var mg=class s{_fromAPIResponse({apiResponse:t,_isVertexAI:e}){let n=new s,o=YE(t);return Object.assign(n,o),n}},yg=class{},vg=class{},_g=class{};var fd=class{};var Ag=class{get text(){var t,e,n;let i="",o=!1,r=[];for(let a of(n=(e=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||e===void 0?void 0:e.parts)!==null&&n!==void 0?n:[]){for(let[l,c]of Object.entries(a))l!=="text"&&l!=="thought"&&c!==null&&r.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;o=!0,i+=a.text}}return r.length>0&&console.warn(`there are non-text parts ${r} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?i:void 0}get data(){var t,e,n;let i="",o=[];for(let r of(n=(e=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||e===void 0?void 0:e.parts)!==null&&n!==void 0?n:[]){for(let[a,l]of Object.entries(r))a!=="inlineData"&&l!==null&&o.push(a);r.inlineData&&typeof r.inlineData.data=="string"&&(i+=atob(r.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}};var wg=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var Tg=class s{_fromAPIResponse({apiResponse:t,_isVertexAI:e}){let n=new s,o=MA(t);return Object.assign(n,o),n}};function et(s,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw new Error("invalid model parameter");if(s.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function NA(s,t){let e=et(s,t);return e?e.startsWith("publishers/")&&s.isVertexAI()?`projects/${s.getProject()}/locations/${s.getLocation()}/${e}`:e.startsWith("models/")&&s.isVertexAI()?`projects/${s.getProject()}/locations/${s.getLocation()}/publishers/google/${e}`:e:""}function kA(s){return Array.isArray(s)?s.map(t=>pd(t)):[pd(s)]}function pd(s){if(typeof s=="object"&&s!==null)return s;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof s}`)}function DA(s){let t=pd(s);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function FA(s){let t=pd(s);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function rA(s){if(s==null)throw new Error("PartUnion is required");if(typeof s=="object")return s;if(typeof s=="string")return{text:s};throw new Error(`Unsupported part type: ${typeof s}`)}function LA(s){if(s==null||Array.isArray(s)&&s.length===0)throw new Error("PartListUnion is required");return Array.isArray(s)?s.map(t=>rA(t)):[rA(s)]}function Eg(s){return s!=null&&typeof s=="object"&&"parts"in s&&Array.isArray(s.parts)}function aA(s){return s!=null&&typeof s=="object"&&"functionCall"in s}function lA(s){return s!=null&&typeof s=="object"&&"functionResponse"in s}function Vt(s){if(s==null)throw new Error("ContentUnion is required");return Eg(s)?s:{role:"user",parts:LA(s)}}function om(s,t){if(!t)return[];if(s.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let n=Vt(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(s.isVertexAI()){let e=Vt(t);return e.parts&&e.parts.length>0&&e.parts[0].text!==void 0?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>Vt(e)):[Vt(t)]}function Ne(s){if(s==null||Array.isArray(s)&&s.length===0)throw new Error("contents are required");if(!Array.isArray(s)){if(aA(s)||lA(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Vt(s)]}let t=[],e=[],n=Eg(s[0]);for(let i of s){let o=Eg(i);if(o!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)t.push(i);else{if(aA(i)||lA(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");e.push(i)}}return n||t.push({role:"user",parts:LA(e)}),t}function jE(s,t){s.includes("null")&&(t.nullable=!0);let e=s.filter(n=>n!=="null");if(e.length===1)t.type=Object.values(Ai).includes(e[0].toUpperCase())?e[0].toUpperCase():Ai.TYPE_UNSPECIFIED;else{t.anyOf=[];for(let n of e)t.anyOf.push({type:Object.values(Ai).includes(n.toUpperCase())?n.toUpperCase():Ai.TYPE_UNSPECIFIED})}}function zo(s){let t={},e=["items"],n=["anyOf"],i=["properties"];if(s.type&&s.anyOf)throw new Error("type and anyOf cannot be both populated.");let o=s.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(t.nullable=!0,s=o[1]):o[1].type==="null"&&(t.nullable=!0,s=o[0])),s.type instanceof Array&&jE(s.type,t);for(let[r,a]of Object.entries(s))if(a!=null)if(r=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;t.type=Object.values(Ai).includes(a.toUpperCase())?a.toUpperCase():Ai.TYPE_UNSPECIFIED}else if(e.includes(r))t[r]=zo(a);else if(n.includes(r)){let l=[];for(let c of a){if(c.type=="null"){t.nullable=!0;continue}l.push(zo(c))}t[r]=l}else if(i.includes(r)){let l={};for(let[c,d]of Object.entries(a))l[c]=zo(d);t[r]=l}else{if(r==="additionalProperties")continue;t[r]=a}return t}function rm(s){return zo(s)}function am(s){if(typeof s=="object")return s;if(typeof s=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:s}}};throw new Error(`Unsupported speechConfig type: ${typeof s}`)}function lm(s){if("multiSpeakerVoiceConfig"in s)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return s}function Jo(s){if(s.functionDeclarations)for(let t of s.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=zo(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=zo(t.response));return s}function Xo(s){if(s==null)throw new Error("tools is required");if(!Array.isArray(s))throw new Error("tools is required and must be an array of Tools");let t=[];for(let e of s)t.push(e);return t}function t0(s,t,e,n=1){let i=!t.startsWith(`${e}/`)&&t.split("/").length===n;return s.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${s.getProject()}/${t}`:t.startsWith(`${e}/`)?`projects/${s.getProject()}/locations/${s.getLocation()}/${t}`:i?`projects/${s.getProject()}/locations/${s.getLocation()}/${e}/${t}`:t:i?`${e}/${t}`:t}function $n(s,t){if(typeof t!="string")throw new Error("name must be a string");return t0(s,t,"cachedContents")}function UA(s){switch(s){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return s}}function wi(s){return sm(s)}function e0(s){return s!=null&&typeof s=="object"&&"name"in s}function n0(s){return s!=null&&typeof s=="object"&&"video"in s}function i0(s){return s!=null&&typeof s=="object"&&"uri"in s}function OA(s){var t;let e;if(e0(s)&&(e=s.name),!(i0(s)&&(e=s.uri,e===void 0))&&!(n0(s)&&(e=(t=s.video)===null||t===void 0?void 0:t.uri,e===void 0))){if(typeof s=="string"&&(e=s),e===void 0)throw new Error("Could not extract file name from the provided input.");if(e.startsWith("https://")){let i=e.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${e}`);e=i[0]}else e.startsWith("files/")&&(e=e.split("files/")[1]);return e}}function $A(s,t){let e;return s.isVertexAI()?e=t?"publishers/google/models":"models":e=t?"models":"tunedModels",e}function GA(s){for(let t of["models","tunedModels","publisherModels"])if(s0(s,t))return s[t];return[]}function s0(s,t){return s!==null&&typeof s=="object"&&t in s}function o0(s,t={}){let e=s,n={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(n.responseJsonSchema=e.outputSchema),t.behavior&&(n.behavior=t.behavior),{functionDeclarations:[n]}}function r0(s,t={}){let e=[],n=new Set;for(let i of s){let o=i.name;if(n.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);n.add(o);let r=o0(i,t);r.functionDeclarations&&e.push(...r.functionDeclarations)}return{functionDeclarations:e}}function BA(s,t){let e;if(typeof t=="string")if(s.isVertexAI())if(t.startsWith("gs://"))e={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))e={format:"bigquery",bigqueryUri:t};else throw new Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))e={fileName:t};else throw new Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(s.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");e={inlinedRequests:t}}else e=t;let n=[e.gcsUri,e.bigqueryUri].filter(Boolean).length,i=[e.inlinedRequests,e.fileName].filter(Boolean).length;if(s.isVertexAI()){if(i>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return e}function a0(s){if(typeof s!="string")return s;let t=s;if(t.startsWith("gs://"))return{format:"jsonl",gcsUri:t};if(t.startsWith("bq://"))return{format:"bigquery",bigqueryUri:t};throw new Error(`Unsupported destination: ${t}`)}function HA(s){if(typeof s!="object"||s===null)return{};let t=s,e=t.inlinedResponses;if(typeof e!="object"||e===null)return s;let i=e.inlinedResponses;if(!Array.isArray(i)||i.length===0)return s;let o=!1;for(let r of i){if(typeof r!="object"||r===null)continue;let l=r.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){o=!0;break}}return o&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),s}function Zo(s,t){let e=t;if(!s.isVertexAI()){if(/batches\/[^/]+$/.test(e))return e.split("/").pop();throw new Error(`Invalid batch job name: ${e}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(e))return e.split("/").pop();if(/^\d+$/.test(e))return e;throw new Error(`Invalid batch job name: ${e}.`)}function VA(s){let t=s;return t==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":t==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":t==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":t==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":t==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":t==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":t==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":t}function l0(s){let t={},e=h(s,["responsesFile"]);e!=null&&f(t,["fileName"],e);let n=h(s,["inlinedResponses","inlinedResponses"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>H0(r))),f(t,["inlinedResponses"],o)}let i=h(s,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["inlinedEmbedContentResponses"],o)}return t}function c0(s){let t={},e=h(s,["predictionsFormat"]);e!=null&&f(t,["format"],e);let n=h(s,["gcsDestination","outputUriPrefix"]);n!=null&&f(t,["gcsUri"],n);let i=h(s,["bigqueryDestination","outputUri"]);return i!=null&&f(t,["bigqueryUri"],i),t}function u0(s){let t={},e=h(s,["format"]);e!=null&&f(t,["predictionsFormat"],e);let n=h(s,["gcsUri"]);n!=null&&f(t,["gcsDestination","outputUriPrefix"],n);let i=h(s,["bigqueryUri"]);if(i!=null&&f(t,["bigqueryDestination","outputUri"],i),h(s,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(h(s,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(h(s,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}function td(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata","displayName"]);n!=null&&f(t,["displayName"],n);let i=h(s,["metadata","state"]);i!=null&&f(t,["state"],VA(i));let o=h(s,["metadata","createTime"]);o!=null&&f(t,["createTime"],o);let r=h(s,["metadata","endTime"]);r!=null&&f(t,["endTime"],r);let a=h(s,["metadata","updateTime"]);a!=null&&f(t,["updateTime"],a);let l=h(s,["metadata","model"]);l!=null&&f(t,["model"],l);let c=h(s,["metadata","output"]);return c!=null&&f(t,["dest"],l0(HA(c))),t}function Cg(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["displayName"]);n!=null&&f(t,["displayName"],n);let i=h(s,["state"]);i!=null&&f(t,["state"],VA(i));let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["createTime"]);r!=null&&f(t,["createTime"],r);let a=h(s,["startTime"]);a!=null&&f(t,["startTime"],a);let l=h(s,["endTime"]);l!=null&&f(t,["endTime"],l);let c=h(s,["updateTime"]);c!=null&&f(t,["updateTime"],c);let d=h(s,["model"]);d!=null&&f(t,["model"],d);let p=h(s,["inputConfig"]);p!=null&&f(t,["src"],d0(p));let g=h(s,["outputConfig"]);g!=null&&f(t,["dest"],c0(HA(g)));let m=h(s,["completionStats"]);return m!=null&&f(t,["completionStats"],m),t}function d0(s){let t={},e=h(s,["instancesFormat"]);e!=null&&f(t,["format"],e);let n=h(s,["gcsSource","uris"]);n!=null&&f(t,["gcsUri"],n);let i=h(s,["bigquerySource","inputUri"]);return i!=null&&f(t,["bigqueryUri"],i),t}function h0(s,t){let e={};if(h(t,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(h(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(h(t,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let n=h(t,["fileName"]);n!=null&&f(e,["fileName"],n);let i=h(t,["inlinedRequests"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>B0(s,r))),f(e,["requests","requests"],o)}return e}function f0(s){let t={},e=h(s,["format"]);e!=null&&f(t,["instancesFormat"],e);let n=h(s,["gcsUri"]);n!=null&&f(t,["gcsSource","uris"],n);let i=h(s,["bigqueryUri"]);if(i!=null&&f(t,["bigquerySource","inputUri"],i),h(s,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(h(s,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return t}function p0(s){let t={},e=h(s,["data"]);if(e!=null&&f(t,["data"],e),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function g0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],Zo(s,n)),e}function m0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],Zo(s,n)),e}function y0(s){let t={},e=h(s,["content"]);e!=null&&f(t,["content"],e);let n=h(s,["citationMetadata"]);n!=null&&f(t,["citationMetadata"],v0(n));let i=h(s,["tokenCount"]);i!=null&&f(t,["tokenCount"],i);let o=h(s,["finishReason"]);o!=null&&f(t,["finishReason"],o);let r=h(s,["avgLogprobs"]);r!=null&&f(t,["avgLogprobs"],r);let a=h(s,["groundingMetadata"]);a!=null&&f(t,["groundingMetadata"],a);let l=h(s,["index"]);l!=null&&f(t,["index"],l);let c=h(s,["logprobsResult"]);c!=null&&f(t,["logprobsResult"],c);let d=h(s,["safetyRatings"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(m=>m)),f(t,["safetyRatings"],g)}let p=h(s,["urlContextMetadata"]);return p!=null&&f(t,["urlContextMetadata"],p),t}function v0(s){let t={},e=h(s,["citationSources"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(i=>i)),f(t,["citations"],n)}return t}function qA(s){let t={},e=h(s,["parts"]);if(e!=null){let i=e;Array.isArray(i)&&(i=i.map(o=>J0(o))),f(t,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(t,["role"],n),t}function _0(s,t){let e={},n=h(s,["displayName"]);if(t!==void 0&&n!=null&&f(t,["batch","displayName"],n),h(s,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return e}function A0(s,t){let e={},n=h(s,["displayName"]);t!==void 0&&n!=null&&f(t,["displayName"],n);let i=h(s,["dest"]);return t!==void 0&&i!=null&&f(t,["outputConfig"],u0(a0(i))),e}function cA(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["src"]);i!=null&&f(e,["batch","inputConfig"],h0(s,BA(s,i)));let o=h(t,["config"]);return o!=null&&_0(o,e),e}function w0(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["model"],et(s,n));let i=h(t,["src"]);i!=null&&f(e,["inputConfig"],f0(BA(s,i)));let o=h(t,["config"]);return o!=null&&A0(o,e),e}function T0(s,t){let e={},n=h(s,["displayName"]);return t!==void 0&&n!=null&&f(t,["batch","displayName"],n),e}function E0(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["src"]);i!=null&&f(e,["batch","inputConfig"],P0(s,i));let o=h(t,["config"]);return o!=null&&T0(o,e),e}function C0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],Zo(s,n)),e}function S0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],Zo(s,n)),e}function b0(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["name"]);n!=null&&f(t,["name"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);return o!=null&&f(t,["error"],o),t}function x0(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["name"]);n!=null&&f(t,["name"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);return o!=null&&f(t,["error"],o),t}function I0(s,t){let e={},n=h(t,["contents"]);if(n!=null){let o=om(s,n);Array.isArray(o)&&(o=o.map(r=>r)),f(e,["requests[]","request","content"],o)}let i=h(t,["config"]);return i!=null&&(f(e,["_self"],R0(i,e)),OE(e,{"requests[].*":"requests[].request.*"})),e}function R0(s,t){let e={},n=h(s,["taskType"]);t!==void 0&&n!=null&&f(t,["requests[]","taskType"],n);let i=h(s,["title"]);t!==void 0&&i!=null&&f(t,["requests[]","title"],i);let o=h(s,["outputDimensionality"]);if(t!==void 0&&o!=null&&f(t,["requests[]","outputDimensionality"],o),h(s,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(h(s,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return e}function P0(s,t){let e={},n=h(t,["fileName"]);n!=null&&f(e,["file_name"],n);let i=h(t,["inlinedRequests"]);return i!=null&&f(e,["requests"],I0(s,i)),e}function M0(s){let t={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let e=h(s,["fileUri"]);e!=null&&f(t,["fileUri"],e);let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function N0(s){let t={},e=h(s,["id"]);e!=null&&f(t,["id"],e);let n=h(s,["args"]);n!=null&&f(t,["args"],n);let i=h(s,["name"]);if(i!=null&&f(t,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function k0(s){let t={},e=h(s,["mode"]);e!=null&&f(t,["mode"],e);let n=h(s,["allowedFunctionNames"]);if(n!=null&&f(t,["allowedFunctionNames"],n),h(s,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function D0(s,t,e){let n={},i=h(t,["systemInstruction"]);e!==void 0&&i!=null&&f(e,["systemInstruction"],qA(Vt(i)));let o=h(t,["temperature"]);o!=null&&f(n,["temperature"],o);let r=h(t,["topP"]);r!=null&&f(n,["topP"],r);let a=h(t,["topK"]);a!=null&&f(n,["topK"],a);let l=h(t,["candidateCount"]);l!=null&&f(n,["candidateCount"],l);let c=h(t,["maxOutputTokens"]);c!=null&&f(n,["maxOutputTokens"],c);let d=h(t,["stopSequences"]);d!=null&&f(n,["stopSequences"],d);let p=h(t,["responseLogprobs"]);p!=null&&f(n,["responseLogprobs"],p);let g=h(t,["logprobs"]);g!=null&&f(n,["logprobs"],g);let m=h(t,["presencePenalty"]);m!=null&&f(n,["presencePenalty"],m);let v=h(t,["frequencyPenalty"]);v!=null&&f(n,["frequencyPenalty"],v);let A=h(t,["seed"]);A!=null&&f(n,["seed"],A);let T=h(t,["responseMimeType"]);T!=null&&f(n,["responseMimeType"],T);let E=h(t,["responseSchema"]);E!=null&&f(n,["responseSchema"],rm(E));let C=h(t,["responseJsonSchema"]);if(C!=null&&f(n,["responseJsonSchema"],C),h(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(h(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let S=h(t,["safetySettings"]);if(e!==void 0&&S!=null){let z=S;Array.isArray(z)&&(z=z.map(W=>X0(W))),f(e,["safetySettings"],z)}let b=h(t,["tools"]);if(e!==void 0&&b!=null){let z=Xo(b);Array.isArray(z)&&(z=z.map(W=>Q0(Jo(W)))),f(e,["tools"],z)}let x=h(t,["toolConfig"]);if(e!==void 0&&x!=null&&f(e,["toolConfig"],Z0(x)),h(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let R=h(t,["cachedContent"]);e!==void 0&&R!=null&&f(e,["cachedContent"],$n(s,R));let I=h(t,["responseModalities"]);I!=null&&f(n,["responseModalities"],I);let N=h(t,["mediaResolution"]);N!=null&&f(n,["mediaResolution"],N);let M=h(t,["speechConfig"]);if(M!=null&&f(n,["speechConfig"],am(M)),h(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=h(t,["thinkingConfig"]);F!=null&&f(n,["thinkingConfig"],F);let U=h(t,["imageConfig"]);U!=null&&f(n,["imageConfig"],G0(U));let j=h(t,["enableEnhancedCivicAnswers"]);return j!=null&&f(n,["enableEnhancedCivicAnswers"],j),n}function F0(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>y0(c))),f(t,["candidates"],l)}let i=h(s,["modelVersion"]);i!=null&&f(t,["modelVersion"],i);let o=h(s,["promptFeedback"]);o!=null&&f(t,["promptFeedback"],o);let r=h(s,["responseId"]);r!=null&&f(t,["responseId"],r);let a=h(s,["usageMetadata"]);return a!=null&&f(t,["usageMetadata"],a),t}function L0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],Zo(s,n)),e}function U0(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],Zo(s,n)),e}function O0(s){let t={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let e=h(s,["enableWidget"]);return e!=null&&f(t,["enableWidget"],e),t}function $0(s){let t={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let e=h(s,["timeRangeFilter"]);return e!=null&&f(t,["timeRangeFilter"],e),t}function G0(s){let t={},e=h(s,["aspectRatio"]);e!=null&&f(t,["aspectRatio"],e);let n=h(s,["imageSize"]);if(n!=null&&f(t,["imageSize"],n),h(s,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(h(s,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function B0(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["request","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let a=Ne(i);Array.isArray(a)&&(a=a.map(l=>qA(l))),f(e,["request","contents"],a)}let o=h(t,["metadata"]);o!=null&&f(e,["metadata"],o);let r=h(t,["config"]);return r!=null&&f(e,["request","generationConfig"],D0(s,r,h(e,["request"],{}))),e}function H0(s){let t={},e=h(s,["response"]);e!=null&&f(t,["response"],F0(e));let n=h(s,["error"]);return n!=null&&f(t,["error"],n),t}function V0(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);if(t!==void 0&&i!=null&&f(t,["_query","pageToken"],i),h(s,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return e}function q0(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);t!==void 0&&i!=null&&f(t,["_query","pageToken"],i);let o=h(s,["filter"]);return t!==void 0&&o!=null&&f(t,["_query","filter"],o),e}function z0(s){let t={},e=h(s,["config"]);return e!=null&&V0(e,t),t}function W0(s){let t={},e=h(s,["config"]);return e!=null&&q0(e,t),t}function K0(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["operations"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>td(r))),f(t,["batchJobs"],o)}return t}function Y0(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["batchPredictionJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>Cg(r))),f(t,["batchJobs"],o)}return t}function J0(s){let t={},e=h(s,["mediaResolution"]);e!=null&&f(t,["mediaResolution"],e);let n=h(s,["codeExecutionResult"]);n!=null&&f(t,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(t,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(t,["fileData"],M0(o));let r=h(s,["functionCall"]);r!=null&&f(t,["functionCall"],N0(r));let a=h(s,["functionResponse"]);a!=null&&f(t,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(t,["inlineData"],p0(l));let c=h(s,["text"]);c!=null&&f(t,["text"],c);let d=h(s,["thought"]);d!=null&&f(t,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(t,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(t,["videoMetadata"],g),t}function X0(s){let t={},e=h(s,["category"]);if(e!=null&&f(t,["category"],e),h(s,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=h(s,["threshold"]);return n!=null&&f(t,["threshold"],n),t}function Z0(s){let t={},e=h(s,["functionCallingConfig"]);e!=null&&f(t,["functionCallingConfig"],k0(e));let n=h(s,["retrievalConfig"]);return n!=null&&f(t,["retrievalConfig"],n),t}function Q0(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let d=e;Array.isArray(d)&&(d=d.map(p=>p)),f(t,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(t,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(t,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(t,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(t,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(t,["googleMaps"],O0(a));let l=h(s,["googleSearch"]);l!=null&&f(t,["googleSearch"],$0(l));let c=h(s,["urlContext"]);return c!=null&&f(t,["urlContext"],c),t}var Un;(function(s){s.PAGED_ITEM_BATCH_JOBS="batchJobs",s.PAGED_ITEM_MODELS="models",s.PAGED_ITEM_TUNING_JOBS="tuningJobs",s.PAGED_ITEM_FILES="files",s.PAGED_ITEM_CACHED_CONTENTS="cachedContents",s.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",s.PAGED_ITEM_DOCUMENTS="documents"})(Un||(Un={}));var On=class{constructor(t,e,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=e,this.init(t,n,i)}init(t,e,n){var i,o;this.nameInternal=t,this.pageInternal=e[this.nameInternal]||[],this.sdkHttpResponseInternal=e==null?void 0:e.sdkHttpResponse,this.idxInternal=0;let r={config:{}};!n||Object.keys(n).length===0?r={config:{}}:typeof n=="object"?r=Object.assign({},n):r=n,r.config&&(r.config.pageToken=e.nextPageToken),this.paramsInternal=r,this.pageInternalSize=(o=(i=r.config)===null||i===void 0?void 0:i.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}};var Sg=class extends We{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new On(Un.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(e),e),this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)}}createInlinedGenerateContentRequest(t){let e=cA(this.apiClient,t),n=e._url,i=D("{model}:batchGenerateContent",n),a=e.batch.inputConfig.requests,l=a.requests,c=[];for(let d of l){let p=Object.assign({},d);if(p.systemInstruction){let g=p.systemInstruction;delete p.systemInstruction;let m=p.request;m.systemInstruction=g,p.request=m}c.push(p)}return a.requests=c,delete e.config,delete e._url,delete e._query,{path:i,body:e}}getGcsUri(t){if(typeof t=="string")return t.startsWith("gs://")?t:void 0;if(!Array.isArray(t)&&t.gcsUri&&t.gcsUri.length>0)return t.gcsUri[0]}getBigqueryUri(t){if(typeof t=="string")return t.startsWith("bq://")?t:void 0;if(!Array.isArray(t))return t.bigqueryUri}formatDestination(t,e){let n=e?Object.assign({},e):{},i=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${i}`),n.dest===void 0){let o=this.getGcsUri(t),r=this.getBigqueryUri(t);if(o)o.endsWith(".jsonl")?n.dest=`${o.slice(0,-6)}/dest`:n.dest=`${o}_dest_${i}`;else if(r)n.dest=`${r}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=w0(this.apiClient,t);return a=D("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>Cg(d))}else{let c=cA(this.apiClient,t);return a=D("{model}:batchGenerateContent",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>td(d))}}async createEmbeddingsInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=E0(this.apiClient,t);return o=D("{model}:asyncBatchEmbedContent",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>td(l))}}async get(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=U0(this.apiClient,t);return a=D("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>Cg(d))}else{let c=L0(this.apiClient,t);return a=D("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>td(d))}}async cancel(t){var e,n,i,o;let r="",a={};if(this.apiClient.isVertexAI()){let l=m0(this.apiClient,t);r=D("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal})}else{let l=g0(this.apiClient,t);r=D("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=W0(t);return a=D("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=Y0(d),g=new fd;return Object.assign(g,p),g})}else{let c=z0(t);return a=D("batches",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=K0(d),g=new fd;return Object.assign(g,p),g})}}async delete(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=S0(this.apiClient,t);return a=D("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>x0(d))}else{let c=C0(this.apiClient,t);return a=D("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>b0(d))}}};function j0(s){let t={},e=h(s,["data"]);if(e!=null&&f(t,["data"],e),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function uA(s){let t={},e=h(s,["parts"]);if(e!=null){let i=e;Array.isArray(i)&&(i=i.map(o=>TC(o))),f(t,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(t,["role"],n),t}function tC(s,t){let e={},n=h(s,["ttl"]);t!==void 0&&n!=null&&f(t,["ttl"],n);let i=h(s,["expireTime"]);t!==void 0&&i!=null&&f(t,["expireTime"],i);let o=h(s,["displayName"]);t!==void 0&&o!=null&&f(t,["displayName"],o);let r=h(s,["contents"]);if(t!==void 0&&r!=null){let d=Ne(r);Array.isArray(d)&&(d=d.map(p=>uA(p))),f(t,["contents"],d)}let a=h(s,["systemInstruction"]);t!==void 0&&a!=null&&f(t,["systemInstruction"],uA(Vt(a)));let l=h(s,["tools"]);if(t!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(p=>CC(p))),f(t,["tools"],d)}let c=h(s,["toolConfig"]);if(t!==void 0&&c!=null&&f(t,["toolConfig"],EC(c)),h(s,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return e}function eC(s,t){let e={},n=h(s,["ttl"]);t!==void 0&&n!=null&&f(t,["ttl"],n);let i=h(s,["expireTime"]);t!==void 0&&i!=null&&f(t,["expireTime"],i);let o=h(s,["displayName"]);t!==void 0&&o!=null&&f(t,["displayName"],o);let r=h(s,["contents"]);if(t!==void 0&&r!=null){let p=Ne(r);Array.isArray(p)&&(p=p.map(g=>g)),f(t,["contents"],p)}let a=h(s,["systemInstruction"]);t!==void 0&&a!=null&&f(t,["systemInstruction"],Vt(a));let l=h(s,["tools"]);if(t!==void 0&&l!=null){let p=l;Array.isArray(p)&&(p=p.map(g=>SC(g))),f(t,["tools"],p)}let c=h(s,["toolConfig"]);t!==void 0&&c!=null&&f(t,["toolConfig"],c);let d=h(s,["kmsKeyName"]);return t!==void 0&&d!=null&&f(t,["encryption_spec","kmsKeyName"],d),e}function nC(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["model"],NA(s,n));let i=h(t,["config"]);return i!=null&&tC(i,e),e}function iC(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["model"],NA(s,n));let i=h(t,["config"]);return i!=null&&eC(i,e),e}function sC(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],$n(s,n)),e}function oC(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],$n(s,n)),e}function rC(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}function aC(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}function lC(s){let t={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let e=h(s,["fileUri"]);e!=null&&f(t,["fileUri"],e);let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function cC(s){let t={},e=h(s,["id"]);e!=null&&f(t,["id"],e);let n=h(s,["args"]);n!=null&&f(t,["args"],n);let i=h(s,["name"]);if(i!=null&&f(t,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function uC(s){let t={},e=h(s,["mode"]);e!=null&&f(t,["mode"],e);let n=h(s,["allowedFunctionNames"]);if(n!=null&&f(t,["allowedFunctionNames"],n),h(s,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function dC(s){let t={};if(h(s,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let e=h(s,["description"]);e!=null&&f(t,["description"],e);let n=h(s,["name"]);n!=null&&f(t,["name"],n);let i=h(s,["parameters"]);i!=null&&f(t,["parameters"],i);let o=h(s,["parametersJsonSchema"]);o!=null&&f(t,["parametersJsonSchema"],o);let r=h(s,["response"]);r!=null&&f(t,["response"],r);let a=h(s,["responseJsonSchema"]);return a!=null&&f(t,["responseJsonSchema"],a),t}function hC(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],$n(s,n)),e}function fC(s,t){let e={},n=h(t,["name"]);return n!=null&&f(e,["_url","name"],$n(s,n)),e}function pC(s){let t={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let e=h(s,["enableWidget"]);return e!=null&&f(t,["enableWidget"],e),t}function gC(s){let t={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let e=h(s,["timeRangeFilter"]);return e!=null&&f(t,["timeRangeFilter"],e),t}function mC(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);return t!==void 0&&i!=null&&f(t,["_query","pageToken"],i),e}function yC(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);return t!==void 0&&i!=null&&f(t,["_query","pageToken"],i),e}function vC(s){let t={},e=h(s,["config"]);return e!=null&&mC(e,t),t}function _C(s){let t={},e=h(s,["config"]);return e!=null&&yC(e,t),t}function AC(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["cachedContents"],o)}return t}function wC(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["cachedContents"],o)}return t}function TC(s){let t={},e=h(s,["mediaResolution"]);e!=null&&f(t,["mediaResolution"],e);let n=h(s,["codeExecutionResult"]);n!=null&&f(t,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(t,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(t,["fileData"],lC(o));let r=h(s,["functionCall"]);r!=null&&f(t,["functionCall"],cC(r));let a=h(s,["functionResponse"]);a!=null&&f(t,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(t,["inlineData"],j0(l));let c=h(s,["text"]);c!=null&&f(t,["text"],c);let d=h(s,["thought"]);d!=null&&f(t,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(t,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(t,["videoMetadata"],g),t}function EC(s){let t={},e=h(s,["functionCallingConfig"]);e!=null&&f(t,["functionCallingConfig"],uC(e));let n=h(s,["retrievalConfig"]);return n!=null&&f(t,["retrievalConfig"],n),t}function CC(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let d=e;Array.isArray(d)&&(d=d.map(p=>p)),f(t,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(t,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(t,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(t,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(t,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(t,["googleMaps"],pC(a));let l=h(s,["googleSearch"]);l!=null&&f(t,["googleSearch"],gC(l));let c=h(s,["urlContext"]);return c!=null&&f(t,["urlContext"],c),t}function SC(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let p=e;Array.isArray(p)&&(p=p.map(g=>dC(g))),f(t,["functionDeclarations"],p)}let n=h(s,["retrieval"]);n!=null&&f(t,["retrieval"],n);let i=h(s,["googleSearchRetrieval"]);i!=null&&f(t,["googleSearchRetrieval"],i);let o=h(s,["computerUse"]);if(o!=null&&f(t,["computerUse"],o),h(s,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=h(s,["codeExecution"]);r!=null&&f(t,["codeExecution"],r);let a=h(s,["enterpriseWebSearch"]);a!=null&&f(t,["enterpriseWebSearch"],a);let l=h(s,["googleMaps"]);l!=null&&f(t,["googleMaps"],l);let c=h(s,["googleSearch"]);c!=null&&f(t,["googleSearch"],c);let d=h(s,["urlContext"]);return d!=null&&f(t,["urlContext"],d),t}function bC(s,t){let e={},n=h(s,["ttl"]);t!==void 0&&n!=null&&f(t,["ttl"],n);let i=h(s,["expireTime"]);return t!==void 0&&i!=null&&f(t,["expireTime"],i),e}function xC(s,t){let e={},n=h(s,["ttl"]);t!==void 0&&n!=null&&f(t,["ttl"],n);let i=h(s,["expireTime"]);return t!==void 0&&i!=null&&f(t,["expireTime"],i),e}function IC(s,t){let e={},n=h(t,["name"]);n!=null&&f(e,["_url","name"],$n(s,n));let i=h(t,["config"]);return i!=null&&bC(i,e),e}function RC(s,t){let e={},n=h(t,["name"]);n!=null&&f(e,["_url","name"],$n(s,n));let i=h(t,["config"]);return i!=null&&xC(i,e),e}var bg=class extends We{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new On(Un.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(e),e)}async create(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=iC(this.apiClient,t);return a=D("cachedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>d)}else{let c=nC(this.apiClient,t);return a=D("cachedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>d)}}async get(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=fC(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>d)}else{let c=hC(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>d)}}async delete(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=oC(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=aC(d),g=new dd;return Object.assign(g,p),g})}else{let c=sC(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=rC(d),g=new dd;return Object.assign(g,p),g})}}async update(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=RC(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>d)}else{let c=IC(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>d)}}async listInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=_C(t);return a=D("cachedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=wC(d),g=new hd;return Object.assign(g,p),g})}else{let c=vC(t);return a=D("cachedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=AC(d),g=new hd;return Object.assign(g,p),g})}}};function gd(s,t){var e={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&t.indexOf(n)<0&&(e[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(s);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(s,n[i])&&(e[n[i]]=s[n[i]]);return e}function dA(s){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&s[t],n=0;if(e)return e.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function q(s){return this instanceof q?(this.v=s,this):new q(s)}function qe(s,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(s,t||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",r),i[Symbol.asyncIterator]=function(){return this},i;function r(m){return function(v){return Promise.resolve(v).then(m,p)}}function a(m,v){n[m]&&(i[m]=function(A){return new Promise(function(T,E){o.push([m,A,T,E])>1||l(m,A)})},v&&(i[m]=v(i[m])))}function l(m,v){try{c(n[m](v))}catch(A){g(o[0][3],A)}}function c(m){m.value instanceof q?Promise.resolve(m.value.v).then(d,p):g(o[0][2],m)}function d(m){l("next",m)}function p(m){l("throw",m)}function g(m,v){m(v),o.shift(),o.length&&l(o[0][0],o[0][1])}}function ze(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],e;return t?t.call(s):(s=typeof dA=="function"?dA(s):s[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(o){e[o]=s[o]&&function(r){return new Promise(function(a,l){r=s[o](r),i(a,l,r.done,r.value)})}}function i(o,r,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},r)}}function PC(s){var t;if(s.candidates==null||s.candidates.length===0)return!1;let e=(t=s.candidates[0])===null||t===void 0?void 0:t.content;return e===void 0?!1:zA(e)}function zA(s){if(s.parts===void 0||s.parts.length===0)return!1;for(let t of s.parts)if(t===void 0||Object.keys(t).length===0)return!1;return!0}function MC(s){if(s.length!==0){for(let t of s)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function hA(s){if(s===void 0||s.length===0)return[];let t=[],e=s.length,n=0;for(;n<e;)if(s[n].role==="user")t.push(s[n]),n++;else{let i=[],o=!0;for(;n<e&&s[n].role==="model";)i.push(s[n]),o&&!zA(s[n])&&(o=!1),n++;o?t.push(...i):t.pop()}return t}var xg=class{constructor(t,e){this.modelsModule=t,this.apiClient=e}create(t){return new Ig(this.apiClient,this.modelsModule,t.model,t.config,structuredClone(t.history))}},Ig=class{constructor(t,e,n,i={},o=[]){this.apiClient=t,this.modelsModule=e,this.model=n,this.config=i,this.history=o,this.sendPromise=Promise.resolve(),MC(o)}async sendMessage(t){var e;await this.sendPromise;let n=Vt(t.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});return this.sendPromise=(async()=>{var o,r,a;let l=await i,c=(r=(o=l.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content,d=l.automaticFunctionCallingHistory,p=this.getHistory(!0).length,g=[];d!=null&&(g=(a=d.slice(p))!==null&&a!==void 0?a:[]);let m=c?[c]:[];this.recordHistory(n,m,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(t){var e;await this.sendPromise;let n=Vt(t.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});let o=await i;return this.processStreamResponse(o,n)}getHistory(t=!1){let e=t?hA(this.history):this.history;return structuredClone(e)}processStreamResponse(t,e){return qe(this,arguments,function*(){var i,o,r,a,l,c;let d=[];try{for(var p=!0,g=ze(t),m;m=yield q(g.next()),i=m.done,!i;p=!0){a=m.value,p=!1;let v=a;if(PC(v)){let A=(c=(l=v.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content;A!==void 0&&d.push(A)}yield yield q(v)}}catch(v){o={error:v}}finally{try{!p&&!i&&(r=g.return)&&(yield q(r.call(g)))}finally{if(o)throw o.error}}this.recordHistory(e,d)})}recordHistory(t,e,n){let i=[];e.length>0&&e.every(o=>o.role!==void 0)?i=e:i.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...hA(n)):this.history.push(t),this.history.push(...i)}};var md=class s extends Error{constructor(t){super(t.message),this.name="ApiError",this.status=t.status,Object.setPrototypeOf(this,s.prototype)}};function NC(s){let t={},e=h(s,["file"]);return e!=null&&f(t,["file"],e),t}function kC(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}function DC(s){let t={},e=h(s,["name"]);return e!=null&&f(t,["_url","file"],OA(e)),t}function FC(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}function LC(s){let t={},e=h(s,["name"]);return e!=null&&f(t,["_url","file"],OA(e)),t}function UC(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);return t!==void 0&&i!=null&&f(t,["_query","pageToken"],i),e}function OC(s){let t={},e=h(s,["config"]);return e!=null&&UC(e,t),t}function $C(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["files"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["files"],o)}return t}var Rg=class extends We{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new On(Un.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(e),e)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(e=>e)}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=OC(t);return o=D("files",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=$C(l),d=new yg;return Object.assign(d,c),d})}}async createInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=NC(t);return o=D("upload/v1beta/files",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=kC(l),d=new vg;return Object.assign(d,c),d})}}async get(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=LC(t);return o=D("files/{file}",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=DC(t);return o=D("files/{file}",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=FC(l),d=new _g;return Object.assign(d,c),d})}}};function ed(s){let t={},e=h(s,["data"]);if(e!=null&&f(t,["data"],e),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function GC(s){let t={},e=h(s,["parts"]);if(e!=null){let i=e;Array.isArray(i)&&(i=i.map(o=>nS(o))),f(t,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(t,["role"],n),t}function BC(s){let t={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let e=h(s,["fileUri"]);e!=null&&f(t,["fileUri"],e);let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function HC(s){let t={},e=h(s,["id"]);e!=null&&f(t,["id"],e);let n=h(s,["args"]);n!=null&&f(t,["args"],n);let i=h(s,["name"]);if(i!=null&&f(t,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function VC(s){let t={};if(h(s,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let e=h(s,["description"]);e!=null&&f(t,["description"],e);let n=h(s,["name"]);n!=null&&f(t,["name"],n);let i=h(s,["parameters"]);i!=null&&f(t,["parameters"],i);let o=h(s,["parametersJsonSchema"]);o!=null&&f(t,["parametersJsonSchema"],o);let r=h(s,["response"]);r!=null&&f(t,["response"],r);let a=h(s,["responseJsonSchema"]);return a!=null&&f(t,["responseJsonSchema"],a),t}function qC(s){let t={},e=h(s,["modelSelectionConfig"]);e!=null&&f(t,["modelConfig"],e);let n=h(s,["responseJsonSchema"]);n!=null&&f(t,["responseJsonSchema"],n);let i=h(s,["audioTimestamp"]);i!=null&&f(t,["audioTimestamp"],i);let o=h(s,["candidateCount"]);o!=null&&f(t,["candidateCount"],o);let r=h(s,["enableAffectiveDialog"]);r!=null&&f(t,["enableAffectiveDialog"],r);let a=h(s,["frequencyPenalty"]);a!=null&&f(t,["frequencyPenalty"],a);let l=h(s,["logprobs"]);l!=null&&f(t,["logprobs"],l);let c=h(s,["maxOutputTokens"]);c!=null&&f(t,["maxOutputTokens"],c);let d=h(s,["mediaResolution"]);d!=null&&f(t,["mediaResolution"],d);let p=h(s,["presencePenalty"]);p!=null&&f(t,["presencePenalty"],p);let g=h(s,["responseLogprobs"]);g!=null&&f(t,["responseLogprobs"],g);let m=h(s,["responseMimeType"]);m!=null&&f(t,["responseMimeType"],m);let v=h(s,["responseModalities"]);v!=null&&f(t,["responseModalities"],v);let A=h(s,["responseSchema"]);A!=null&&f(t,["responseSchema"],A);let T=h(s,["routingConfig"]);T!=null&&f(t,["routingConfig"],T);let E=h(s,["seed"]);E!=null&&f(t,["seed"],E);let C=h(s,["speechConfig"]);C!=null&&f(t,["speechConfig"],C);let S=h(s,["stopSequences"]);S!=null&&f(t,["stopSequences"],S);let b=h(s,["temperature"]);b!=null&&f(t,["temperature"],b);let x=h(s,["thinkingConfig"]);x!=null&&f(t,["thinkingConfig"],x);let R=h(s,["topK"]);R!=null&&f(t,["topK"],R);let I=h(s,["topP"]);if(I!=null&&f(t,["topP"],I),h(s,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function zC(s){let t={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let e=h(s,["enableWidget"]);return e!=null&&f(t,["enableWidget"],e),t}function WC(s){let t={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let e=h(s,["timeRangeFilter"]);return e!=null&&f(t,["timeRangeFilter"],e),t}function KC(s,t){let e={},n=h(s,["generationConfig"]);t!==void 0&&n!=null&&f(t,["setup","generationConfig"],n);let i=h(s,["responseModalities"]);t!==void 0&&i!=null&&f(t,["setup","generationConfig","responseModalities"],i);let o=h(s,["temperature"]);t!==void 0&&o!=null&&f(t,["setup","generationConfig","temperature"],o);let r=h(s,["topP"]);t!==void 0&&r!=null&&f(t,["setup","generationConfig","topP"],r);let a=h(s,["topK"]);t!==void 0&&a!=null&&f(t,["setup","generationConfig","topK"],a);let l=h(s,["maxOutputTokens"]);t!==void 0&&l!=null&&f(t,["setup","generationConfig","maxOutputTokens"],l);let c=h(s,["mediaResolution"]);t!==void 0&&c!=null&&f(t,["setup","generationConfig","mediaResolution"],c);let d=h(s,["seed"]);t!==void 0&&d!=null&&f(t,["setup","generationConfig","seed"],d);let p=h(s,["speechConfig"]);t!==void 0&&p!=null&&f(t,["setup","generationConfig","speechConfig"],lm(p));let g=h(s,["thinkingConfig"]);t!==void 0&&g!=null&&f(t,["setup","generationConfig","thinkingConfig"],g);let m=h(s,["enableAffectiveDialog"]);t!==void 0&&m!=null&&f(t,["setup","generationConfig","enableAffectiveDialog"],m);let v=h(s,["systemInstruction"]);t!==void 0&&v!=null&&f(t,["setup","systemInstruction"],GC(Vt(v)));let A=h(s,["tools"]);if(t!==void 0&&A!=null){let R=Xo(A);Array.isArray(R)&&(R=R.map(I=>sS(Jo(I)))),f(t,["setup","tools"],R)}let T=h(s,["sessionResumption"]);t!==void 0&&T!=null&&f(t,["setup","sessionResumption"],iS(T));let E=h(s,["inputAudioTranscription"]);t!==void 0&&E!=null&&f(t,["setup","inputAudioTranscription"],E);let C=h(s,["outputAudioTranscription"]);t!==void 0&&C!=null&&f(t,["setup","outputAudioTranscription"],C);let S=h(s,["realtimeInputConfig"]);t!==void 0&&S!=null&&f(t,["setup","realtimeInputConfig"],S);let b=h(s,["contextWindowCompression"]);t!==void 0&&b!=null&&f(t,["setup","contextWindowCompression"],b);let x=h(s,["proactivity"]);if(t!==void 0&&x!=null&&f(t,["setup","proactivity"],x),h(s,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return e}function YC(s,t){let e={},n=h(s,["generationConfig"]);t!==void 0&&n!=null&&f(t,["setup","generationConfig"],qC(n));let i=h(s,["responseModalities"]);t!==void 0&&i!=null&&f(t,["setup","generationConfig","responseModalities"],i);let o=h(s,["temperature"]);t!==void 0&&o!=null&&f(t,["setup","generationConfig","temperature"],o);let r=h(s,["topP"]);t!==void 0&&r!=null&&f(t,["setup","generationConfig","topP"],r);let a=h(s,["topK"]);t!==void 0&&a!=null&&f(t,["setup","generationConfig","topK"],a);let l=h(s,["maxOutputTokens"]);t!==void 0&&l!=null&&f(t,["setup","generationConfig","maxOutputTokens"],l);let c=h(s,["mediaResolution"]);t!==void 0&&c!=null&&f(t,["setup","generationConfig","mediaResolution"],c);let d=h(s,["seed"]);t!==void 0&&d!=null&&f(t,["setup","generationConfig","seed"],d);let p=h(s,["speechConfig"]);t!==void 0&&p!=null&&f(t,["setup","generationConfig","speechConfig"],lm(p));let g=h(s,["thinkingConfig"]);t!==void 0&&g!=null&&f(t,["setup","generationConfig","thinkingConfig"],g);let m=h(s,["enableAffectiveDialog"]);t!==void 0&&m!=null&&f(t,["setup","generationConfig","enableAffectiveDialog"],m);let v=h(s,["systemInstruction"]);t!==void 0&&v!=null&&f(t,["setup","systemInstruction"],Vt(v));let A=h(s,["tools"]);if(t!==void 0&&A!=null){let I=Xo(A);Array.isArray(I)&&(I=I.map(N=>oS(Jo(N)))),f(t,["setup","tools"],I)}let T=h(s,["sessionResumption"]);t!==void 0&&T!=null&&f(t,["setup","sessionResumption"],T);let E=h(s,["inputAudioTranscription"]);t!==void 0&&E!=null&&f(t,["setup","inputAudioTranscription"],E);let C=h(s,["outputAudioTranscription"]);t!==void 0&&C!=null&&f(t,["setup","outputAudioTranscription"],C);let S=h(s,["realtimeInputConfig"]);t!==void 0&&S!=null&&f(t,["setup","realtimeInputConfig"],S);let b=h(s,["contextWindowCompression"]);t!==void 0&&b!=null&&f(t,["setup","contextWindowCompression"],b);let x=h(s,["proactivity"]);t!==void 0&&x!=null&&f(t,["setup","proactivity"],x);let R=h(s,["explicitVadSignal"]);return t!==void 0&&R!=null&&f(t,["setup","explicitVadSignal"],R),e}function JC(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["setup","model"],et(s,n));let i=h(t,["config"]);return i!=null&&f(e,["config"],KC(i,e)),e}function XC(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["setup","model"],et(s,n));let i=h(t,["config"]);return i!=null&&f(e,["config"],YC(i,e)),e}function ZC(s){let t={},e=h(s,["musicGenerationConfig"]);return e!=null&&f(t,["musicGenerationConfig"],e),t}function QC(s){let t={},e=h(s,["weightedPrompts"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(i=>i)),f(t,["weightedPrompts"],n)}return t}function jC(s){let t={},e=h(s,["media"]);if(e!=null){let c=kA(e);Array.isArray(c)&&(c=c.map(d=>ed(d))),f(t,["mediaChunks"],c)}let n=h(s,["audio"]);n!=null&&f(t,["audio"],ed(FA(n)));let i=h(s,["audioStreamEnd"]);i!=null&&f(t,["audioStreamEnd"],i);let o=h(s,["video"]);o!=null&&f(t,["video"],ed(DA(o)));let r=h(s,["text"]);r!=null&&f(t,["text"],r);let a=h(s,["activityStart"]);a!=null&&f(t,["activityStart"],a);let l=h(s,["activityEnd"]);return l!=null&&f(t,["activityEnd"],l),t}function tS(s){let t={},e=h(s,["media"]);if(e!=null){let c=kA(e);Array.isArray(c)&&(c=c.map(d=>d)),f(t,["mediaChunks"],c)}let n=h(s,["audio"]);n!=null&&f(t,["audio"],FA(n));let i=h(s,["audioStreamEnd"]);i!=null&&f(t,["audioStreamEnd"],i);let o=h(s,["video"]);o!=null&&f(t,["video"],DA(o));let r=h(s,["text"]);r!=null&&f(t,["text"],r);let a=h(s,["activityStart"]);a!=null&&f(t,["activityStart"],a);let l=h(s,["activityEnd"]);return l!=null&&f(t,["activityEnd"],l),t}function eS(s){let t={},e=h(s,["setupComplete"]);e!=null&&f(t,["setupComplete"],e);let n=h(s,["serverContent"]);n!=null&&f(t,["serverContent"],n);let i=h(s,["toolCall"]);i!=null&&f(t,["toolCall"],i);let o=h(s,["toolCallCancellation"]);o!=null&&f(t,["toolCallCancellation"],o);let r=h(s,["usageMetadata"]);r!=null&&f(t,["usageMetadata"],rS(r));let a=h(s,["goAway"]);a!=null&&f(t,["goAway"],a);let l=h(s,["sessionResumptionUpdate"]);l!=null&&f(t,["sessionResumptionUpdate"],l);let c=h(s,["voiceActivityDetectionSignal"]);return c!=null&&f(t,["voiceActivityDetectionSignal"],c),t}function nS(s){let t={},e=h(s,["mediaResolution"]);e!=null&&f(t,["mediaResolution"],e);let n=h(s,["codeExecutionResult"]);n!=null&&f(t,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(t,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(t,["fileData"],BC(o));let r=h(s,["functionCall"]);r!=null&&f(t,["functionCall"],HC(r));let a=h(s,["functionResponse"]);a!=null&&f(t,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(t,["inlineData"],ed(l));let c=h(s,["text"]);c!=null&&f(t,["text"],c);let d=h(s,["thought"]);d!=null&&f(t,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(t,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(t,["videoMetadata"],g),t}function iS(s){let t={},e=h(s,["handle"]);if(e!=null&&f(t,["handle"],e),h(s,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function sS(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let d=e;Array.isArray(d)&&(d=d.map(p=>p)),f(t,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(t,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(t,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(t,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(t,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(t,["googleMaps"],zC(a));let l=h(s,["googleSearch"]);l!=null&&f(t,["googleSearch"],WC(l));let c=h(s,["urlContext"]);return c!=null&&f(t,["urlContext"],c),t}function oS(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let p=e;Array.isArray(p)&&(p=p.map(g=>VC(g))),f(t,["functionDeclarations"],p)}let n=h(s,["retrieval"]);n!=null&&f(t,["retrieval"],n);let i=h(s,["googleSearchRetrieval"]);i!=null&&f(t,["googleSearchRetrieval"],i);let o=h(s,["computerUse"]);if(o!=null&&f(t,["computerUse"],o),h(s,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=h(s,["codeExecution"]);r!=null&&f(t,["codeExecution"],r);let a=h(s,["enterpriseWebSearch"]);a!=null&&f(t,["enterpriseWebSearch"],a);let l=h(s,["googleMaps"]);l!=null&&f(t,["googleMaps"],l);let c=h(s,["googleSearch"]);c!=null&&f(t,["googleSearch"],c);let d=h(s,["urlContext"]);return d!=null&&f(t,["urlContext"],d),t}function rS(s){let t={},e=h(s,["promptTokenCount"]);e!=null&&f(t,["promptTokenCount"],e);let n=h(s,["cachedContentTokenCount"]);n!=null&&f(t,["cachedContentTokenCount"],n);let i=h(s,["candidatesTokenCount"]);i!=null&&f(t,["responseTokenCount"],i);let o=h(s,["toolUsePromptTokenCount"]);o!=null&&f(t,["toolUsePromptTokenCount"],o);let r=h(s,["thoughtsTokenCount"]);r!=null&&f(t,["thoughtsTokenCount"],r);let a=h(s,["totalTokenCount"]);a!=null&&f(t,["totalTokenCount"],a);let l=h(s,["promptTokensDetails"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(v=>v)),f(t,["promptTokensDetails"],m)}let c=h(s,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(v=>v)),f(t,["cacheTokensDetails"],m)}let d=h(s,["candidatesTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(v=>v)),f(t,["responseTokensDetails"],m)}let p=h(s,["toolUsePromptTokensDetails"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(v=>v)),f(t,["toolUsePromptTokensDetails"],m)}let g=h(s,["trafficType"]);return g!=null&&f(t,["trafficType"],g),t}function aS(s){let t={},e=h(s,["data"]);if(e!=null&&f(t,["data"],e),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function lS(s){let t={},e=h(s,["content"]);e!=null&&f(t,["content"],e);let n=h(s,["citationMetadata"]);n!=null&&f(t,["citationMetadata"],cS(n));let i=h(s,["tokenCount"]);i!=null&&f(t,["tokenCount"],i);let o=h(s,["finishReason"]);o!=null&&f(t,["finishReason"],o);let r=h(s,["avgLogprobs"]);r!=null&&f(t,["avgLogprobs"],r);let a=h(s,["groundingMetadata"]);a!=null&&f(t,["groundingMetadata"],a);let l=h(s,["index"]);l!=null&&f(t,["index"],l);let c=h(s,["logprobsResult"]);c!=null&&f(t,["logprobsResult"],c);let d=h(s,["safetyRatings"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(m=>m)),f(t,["safetyRatings"],g)}let p=h(s,["urlContextMetadata"]);return p!=null&&f(t,["urlContextMetadata"],p),t}function cS(s){let t={},e=h(s,["citationSources"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(i=>i)),f(t,["citations"],n)}return t}function uS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let o=Ne(i);Array.isArray(o)&&(o=o.map(r=>r)),f(e,["contents"],o)}return e}function dS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["tokensInfo"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>o)),f(t,["tokensInfo"],i)}return t}function hS(s){let t={},e=h(s,["values"]);e!=null&&f(t,["values"],e);let n=h(s,["statistics"]);return n!=null&&f(t,["statistics"],fS(n)),t}function fS(s){let t={},e=h(s,["truncated"]);e!=null&&f(t,["truncated"],e);let n=h(s,["token_count"]);return n!=null&&f(t,["tokenCount"],n),t}function kd(s){let t={},e=h(s,["parts"]);if(e!=null){let i=e;Array.isArray(i)&&(i=i.map(o=>Tb(o))),f(t,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(t,["role"],n),t}function pS(s){let t={},e=h(s,["controlType"]);e!=null&&f(t,["controlType"],e);let n=h(s,["enableControlImageComputation"]);return n!=null&&f(t,["computeControl"],n),t}function gS(s){let t={};if(h(s,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(h(s,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(h(s,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function mS(s,t){let e={},n=h(s,["systemInstruction"]);t!==void 0&&n!=null&&f(t,["systemInstruction"],Vt(n));let i=h(s,["tools"]);if(t!==void 0&&i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>JA(a))),f(t,["tools"],r)}let o=h(s,["generationConfig"]);return t!==void 0&&o!=null&&f(t,["generationConfig"],ab(o)),e}function yS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let r=Ne(i);Array.isArray(r)&&(r=r.map(a=>kd(a))),f(e,["contents"],r)}let o=h(t,["config"]);return o!=null&&gS(o),e}function vS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let r=Ne(i);Array.isArray(r)&&(r=r.map(a=>a)),f(e,["contents"],r)}let o=h(t,["config"]);return o!=null&&mS(o,e),e}function _S(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["totalTokens"]);n!=null&&f(t,["totalTokens"],n);let i=h(s,["cachedContentTokenCount"]);return i!=null&&f(t,["cachedContentTokenCount"],i),t}function AS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["totalTokens"]);return n!=null&&f(t,["totalTokens"],n),t}function wS(s,t){let e={},n=h(t,["model"]);return n!=null&&f(e,["_url","name"],et(s,n)),e}function TS(s,t){let e={},n=h(t,["model"]);return n!=null&&f(e,["_url","name"],et(s,n)),e}function ES(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}function CS(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}function SS(s,t){let e={},n=h(s,["outputGcsUri"]);t!==void 0&&n!=null&&f(t,["parameters","storageUri"],n);let i=h(s,["negativePrompt"]);t!==void 0&&i!=null&&f(t,["parameters","negativePrompt"],i);let o=h(s,["numberOfImages"]);t!==void 0&&o!=null&&f(t,["parameters","sampleCount"],o);let r=h(s,["aspectRatio"]);t!==void 0&&r!=null&&f(t,["parameters","aspectRatio"],r);let a=h(s,["guidanceScale"]);t!==void 0&&a!=null&&f(t,["parameters","guidanceScale"],a);let l=h(s,["seed"]);t!==void 0&&l!=null&&f(t,["parameters","seed"],l);let c=h(s,["safetyFilterLevel"]);t!==void 0&&c!=null&&f(t,["parameters","safetySetting"],c);let d=h(s,["personGeneration"]);t!==void 0&&d!=null&&f(t,["parameters","personGeneration"],d);let p=h(s,["includeSafetyAttributes"]);t!==void 0&&p!=null&&f(t,["parameters","includeSafetyAttributes"],p);let g=h(s,["includeRaiReason"]);t!==void 0&&g!=null&&f(t,["parameters","includeRaiReason"],g);let m=h(s,["language"]);t!==void 0&&m!=null&&f(t,["parameters","language"],m);let v=h(s,["outputMimeType"]);t!==void 0&&v!=null&&f(t,["parameters","outputOptions","mimeType"],v);let A=h(s,["outputCompressionQuality"]);t!==void 0&&A!=null&&f(t,["parameters","outputOptions","compressionQuality"],A);let T=h(s,["addWatermark"]);t!==void 0&&T!=null&&f(t,["parameters","addWatermark"],T);let E=h(s,["labels"]);t!==void 0&&E!=null&&f(t,["labels"],E);let C=h(s,["editMode"]);t!==void 0&&C!=null&&f(t,["parameters","editMode"],C);let S=h(s,["baseSteps"]);return t!==void 0&&S!=null&&f(t,["parameters","editConfig","baseSteps"],S),e}function bS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["prompt"]);i!=null&&f(e,["instances[0]","prompt"],i);let o=h(t,["referenceImages"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>Ib(l))),f(e,["instances[0]","referenceImages"],a)}let r=h(t,["config"]);return r!=null&&SS(r,e),e}function xS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Dd(o))),f(t,["generatedImages"],i)}return t}function IS(s,t){let e={},n=h(s,["taskType"]);t!==void 0&&n!=null&&f(t,["requests[]","taskType"],n);let i=h(s,["title"]);t!==void 0&&i!=null&&f(t,["requests[]","title"],i);let o=h(s,["outputDimensionality"]);if(t!==void 0&&o!=null&&f(t,["requests[]","outputDimensionality"],o),h(s,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(h(s,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return e}function RS(s,t){let e={},n=h(s,["taskType"]);t!==void 0&&n!=null&&f(t,["instances[]","task_type"],n);let i=h(s,["title"]);t!==void 0&&i!=null&&f(t,["instances[]","title"],i);let o=h(s,["outputDimensionality"]);t!==void 0&&o!=null&&f(t,["parameters","outputDimensionality"],o);let r=h(s,["mimeType"]);t!==void 0&&r!=null&&f(t,["instances[]","mimeType"],r);let a=h(s,["autoTruncate"]);return t!==void 0&&a!=null&&f(t,["parameters","autoTruncate"],a),e}function PS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let a=om(s,i);Array.isArray(a)&&(a=a.map(l=>l)),f(e,["requests[]","content"],a)}let o=h(t,["config"]);o!=null&&IS(o,e);let r=h(t,["model"]);return r!==void 0&&f(e,["requests[]","model"],et(s,r)),e}function MS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let r=om(s,i);Array.isArray(r)&&(r=r.map(a=>a)),f(e,["instances[]","content"],r)}let o=h(t,["config"]);return o!=null&&RS(o,e),e}function NS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["embeddings"],o)}let i=h(s,["metadata"]);return i!=null&&f(t,["metadata"],i),t}function kS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["predictions[]","embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>hS(r))),f(t,["embeddings"],o)}let i=h(s,["metadata"]);return i!=null&&f(t,["metadata"],i),t}function DS(s){let t={},e=h(s,["endpoint"]);e!=null&&f(t,["name"],e);let n=h(s,["deployedModelId"]);return n!=null&&f(t,["deployedModelId"],n),t}function FS(s){let t={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let e=h(s,["fileUri"]);e!=null&&f(t,["fileUri"],e);let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function LS(s){let t={},e=h(s,["id"]);e!=null&&f(t,["id"],e);let n=h(s,["args"]);n!=null&&f(t,["args"],n);let i=h(s,["name"]);if(i!=null&&f(t,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function US(s){let t={},e=h(s,["mode"]);e!=null&&f(t,["mode"],e);let n=h(s,["allowedFunctionNames"]);if(n!=null&&f(t,["allowedFunctionNames"],n),h(s,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function OS(s){let t={};if(h(s,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let e=h(s,["description"]);e!=null&&f(t,["description"],e);let n=h(s,["name"]);n!=null&&f(t,["name"],n);let i=h(s,["parameters"]);i!=null&&f(t,["parameters"],i);let o=h(s,["parametersJsonSchema"]);o!=null&&f(t,["parametersJsonSchema"],o);let r=h(s,["response"]);r!=null&&f(t,["response"],r);let a=h(s,["responseJsonSchema"]);return a!=null&&f(t,["responseJsonSchema"],a),t}function $S(s,t,e){let n={},i=h(t,["systemInstruction"]);e!==void 0&&i!=null&&f(e,["systemInstruction"],kd(Vt(i)));let o=h(t,["temperature"]);o!=null&&f(n,["temperature"],o);let r=h(t,["topP"]);r!=null&&f(n,["topP"],r);let a=h(t,["topK"]);a!=null&&f(n,["topK"],a);let l=h(t,["candidateCount"]);l!=null&&f(n,["candidateCount"],l);let c=h(t,["maxOutputTokens"]);c!=null&&f(n,["maxOutputTokens"],c);let d=h(t,["stopSequences"]);d!=null&&f(n,["stopSequences"],d);let p=h(t,["responseLogprobs"]);p!=null&&f(n,["responseLogprobs"],p);let g=h(t,["logprobs"]);g!=null&&f(n,["logprobs"],g);let m=h(t,["presencePenalty"]);m!=null&&f(n,["presencePenalty"],m);let v=h(t,["frequencyPenalty"]);v!=null&&f(n,["frequencyPenalty"],v);let A=h(t,["seed"]);A!=null&&f(n,["seed"],A);let T=h(t,["responseMimeType"]);T!=null&&f(n,["responseMimeType"],T);let E=h(t,["responseSchema"]);E!=null&&f(n,["responseSchema"],rm(E));let C=h(t,["responseJsonSchema"]);if(C!=null&&f(n,["responseJsonSchema"],C),h(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(h(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let S=h(t,["safetySettings"]);if(e!==void 0&&S!=null){let z=S;Array.isArray(z)&&(z=z.map(W=>Rb(W))),f(e,["safetySettings"],z)}let b=h(t,["tools"]);if(e!==void 0&&b!=null){let z=Xo(b);Array.isArray(z)&&(z=z.map(W=>Lb(Jo(W)))),f(e,["tools"],z)}let x=h(t,["toolConfig"]);if(e!==void 0&&x!=null&&f(e,["toolConfig"],Fb(x)),h(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let R=h(t,["cachedContent"]);e!==void 0&&R!=null&&f(e,["cachedContent"],$n(s,R));let I=h(t,["responseModalities"]);I!=null&&f(n,["responseModalities"],I);let N=h(t,["mediaResolution"]);N!=null&&f(n,["mediaResolution"],N);let M=h(t,["speechConfig"]);if(M!=null&&f(n,["speechConfig"],am(M)),h(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=h(t,["thinkingConfig"]);F!=null&&f(n,["thinkingConfig"],F);let U=h(t,["imageConfig"]);U!=null&&f(n,["imageConfig"],hb(U));let j=h(t,["enableEnhancedCivicAnswers"]);return j!=null&&f(n,["enableEnhancedCivicAnswers"],j),n}function GS(s,t,e){let n={},i=h(t,["systemInstruction"]);e!==void 0&&i!=null&&f(e,["systemInstruction"],Vt(i));let o=h(t,["temperature"]);o!=null&&f(n,["temperature"],o);let r=h(t,["topP"]);r!=null&&f(n,["topP"],r);let a=h(t,["topK"]);a!=null&&f(n,["topK"],a);let l=h(t,["candidateCount"]);l!=null&&f(n,["candidateCount"],l);let c=h(t,["maxOutputTokens"]);c!=null&&f(n,["maxOutputTokens"],c);let d=h(t,["stopSequences"]);d!=null&&f(n,["stopSequences"],d);let p=h(t,["responseLogprobs"]);p!=null&&f(n,["responseLogprobs"],p);let g=h(t,["logprobs"]);g!=null&&f(n,["logprobs"],g);let m=h(t,["presencePenalty"]);m!=null&&f(n,["presencePenalty"],m);let v=h(t,["frequencyPenalty"]);v!=null&&f(n,["frequencyPenalty"],v);let A=h(t,["seed"]);A!=null&&f(n,["seed"],A);let T=h(t,["responseMimeType"]);T!=null&&f(n,["responseMimeType"],T);let E=h(t,["responseSchema"]);E!=null&&f(n,["responseSchema"],rm(E));let C=h(t,["responseJsonSchema"]);C!=null&&f(n,["responseJsonSchema"],C);let S=h(t,["routingConfig"]);S!=null&&f(n,["routingConfig"],S);let b=h(t,["modelSelectionConfig"]);b!=null&&f(n,["modelConfig"],b);let x=h(t,["safetySettings"]);if(e!==void 0&&x!=null){let k=x;Array.isArray(k)&&(k=k.map(B=>B)),f(e,["safetySettings"],k)}let R=h(t,["tools"]);if(e!==void 0&&R!=null){let k=Xo(R);Array.isArray(k)&&(k=k.map(B=>JA(Jo(B)))),f(e,["tools"],k)}let I=h(t,["toolConfig"]);e!==void 0&&I!=null&&f(e,["toolConfig"],I);let N=h(t,["labels"]);e!==void 0&&N!=null&&f(e,["labels"],N);let M=h(t,["cachedContent"]);e!==void 0&&M!=null&&f(e,["cachedContent"],$n(s,M));let F=h(t,["responseModalities"]);F!=null&&f(n,["responseModalities"],F);let U=h(t,["mediaResolution"]);U!=null&&f(n,["mediaResolution"],U);let j=h(t,["speechConfig"]);j!=null&&f(n,["speechConfig"],am(j));let z=h(t,["audioTimestamp"]);z!=null&&f(n,["audioTimestamp"],z);let W=h(t,["thinkingConfig"]);W!=null&&f(n,["thinkingConfig"],W);let bt=h(t,["imageConfig"]);if(bt!=null&&f(n,["imageConfig"],fb(bt)),h(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function fA(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let r=Ne(i);Array.isArray(r)&&(r=r.map(a=>kd(a))),f(e,["contents"],r)}let o=h(t,["config"]);return o!=null&&f(e,["generationConfig"],$S(s,o,e)),e}function pA(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["contents"]);if(i!=null){let r=Ne(i);Array.isArray(r)&&(r=r.map(a=>a)),f(e,["contents"],r)}let o=h(t,["config"]);return o!=null&&f(e,["generationConfig"],GS(s,o,e)),e}function gA(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>lS(c))),f(t,["candidates"],l)}let i=h(s,["modelVersion"]);i!=null&&f(t,["modelVersion"],i);let o=h(s,["promptFeedback"]);o!=null&&f(t,["promptFeedback"],o);let r=h(s,["responseId"]);r!=null&&f(t,["responseId"],r);let a=h(s,["usageMetadata"]);return a!=null&&f(t,["usageMetadata"],a),t}function mA(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>d)),f(t,["candidates"],c)}let i=h(s,["createTime"]);i!=null&&f(t,["createTime"],i);let o=h(s,["modelVersion"]);o!=null&&f(t,["modelVersion"],o);let r=h(s,["promptFeedback"]);r!=null&&f(t,["promptFeedback"],r);let a=h(s,["responseId"]);a!=null&&f(t,["responseId"],a);let l=h(s,["usageMetadata"]);return l!=null&&f(t,["usageMetadata"],l),t}function BS(s,t){let e={};if(h(s,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(h(s,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let n=h(s,["numberOfImages"]);t!==void 0&&n!=null&&f(t,["parameters","sampleCount"],n);let i=h(s,["aspectRatio"]);t!==void 0&&i!=null&&f(t,["parameters","aspectRatio"],i);let o=h(s,["guidanceScale"]);if(t!==void 0&&o!=null&&f(t,["parameters","guidanceScale"],o),h(s,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let r=h(s,["safetyFilterLevel"]);t!==void 0&&r!=null&&f(t,["parameters","safetySetting"],r);let a=h(s,["personGeneration"]);t!==void 0&&a!=null&&f(t,["parameters","personGeneration"],a);let l=h(s,["includeSafetyAttributes"]);t!==void 0&&l!=null&&f(t,["parameters","includeSafetyAttributes"],l);let c=h(s,["includeRaiReason"]);t!==void 0&&c!=null&&f(t,["parameters","includeRaiReason"],c);let d=h(s,["language"]);t!==void 0&&d!=null&&f(t,["parameters","language"],d);let p=h(s,["outputMimeType"]);t!==void 0&&p!=null&&f(t,["parameters","outputOptions","mimeType"],p);let g=h(s,["outputCompressionQuality"]);if(t!==void 0&&g!=null&&f(t,["parameters","outputOptions","compressionQuality"],g),h(s,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(h(s,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let m=h(s,["imageSize"]);if(t!==void 0&&m!=null&&f(t,["parameters","sampleImageSize"],m),h(s,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return e}function HS(s,t){let e={},n=h(s,["outputGcsUri"]);t!==void 0&&n!=null&&f(t,["parameters","storageUri"],n);let i=h(s,["negativePrompt"]);t!==void 0&&i!=null&&f(t,["parameters","negativePrompt"],i);let o=h(s,["numberOfImages"]);t!==void 0&&o!=null&&f(t,["parameters","sampleCount"],o);let r=h(s,["aspectRatio"]);t!==void 0&&r!=null&&f(t,["parameters","aspectRatio"],r);let a=h(s,["guidanceScale"]);t!==void 0&&a!=null&&f(t,["parameters","guidanceScale"],a);let l=h(s,["seed"]);t!==void 0&&l!=null&&f(t,["parameters","seed"],l);let c=h(s,["safetyFilterLevel"]);t!==void 0&&c!=null&&f(t,["parameters","safetySetting"],c);let d=h(s,["personGeneration"]);t!==void 0&&d!=null&&f(t,["parameters","personGeneration"],d);let p=h(s,["includeSafetyAttributes"]);t!==void 0&&p!=null&&f(t,["parameters","includeSafetyAttributes"],p);let g=h(s,["includeRaiReason"]);t!==void 0&&g!=null&&f(t,["parameters","includeRaiReason"],g);let m=h(s,["language"]);t!==void 0&&m!=null&&f(t,["parameters","language"],m);let v=h(s,["outputMimeType"]);t!==void 0&&v!=null&&f(t,["parameters","outputOptions","mimeType"],v);let A=h(s,["outputCompressionQuality"]);t!==void 0&&A!=null&&f(t,["parameters","outputOptions","compressionQuality"],A);let T=h(s,["addWatermark"]);t!==void 0&&T!=null&&f(t,["parameters","addWatermark"],T);let E=h(s,["labels"]);t!==void 0&&E!=null&&f(t,["labels"],E);let C=h(s,["imageSize"]);t!==void 0&&C!=null&&f(t,["parameters","sampleImageSize"],C);let S=h(s,["enhancePrompt"]);return t!==void 0&&S!=null&&f(t,["parameters","enhancePrompt"],S),e}function VS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["prompt"]);i!=null&&f(e,["instances[0]","prompt"],i);let o=h(t,["config"]);return o!=null&&BS(o,e),e}function qS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["prompt"]);i!=null&&f(e,["instances[0]","prompt"],i);let o=h(t,["config"]);return o!=null&&HS(o,e),e}function zS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>ib(r))),f(t,["generatedImages"],o)}let i=h(s,["positivePromptSafetyAttributes"]);return i!=null&&f(t,["positivePromptSafetyAttributes"],KA(i)),t}function WS(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Dd(r))),f(t,["generatedImages"],o)}let i=h(s,["positivePromptSafetyAttributes"]);return i!=null&&f(t,["positivePromptSafetyAttributes"],YA(i)),t}function KS(s,t){let e={},n=h(s,["numberOfVideos"]);if(t!==void 0&&n!=null&&f(t,["parameters","sampleCount"],n),h(s,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(h(s,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let i=h(s,["durationSeconds"]);if(t!==void 0&&i!=null&&f(t,["parameters","durationSeconds"],i),h(s,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=h(s,["aspectRatio"]);t!==void 0&&o!=null&&f(t,["parameters","aspectRatio"],o);let r=h(s,["resolution"]);t!==void 0&&r!=null&&f(t,["parameters","resolution"],r);let a=h(s,["personGeneration"]);if(t!==void 0&&a!=null&&f(t,["parameters","personGeneration"],a),h(s,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let l=h(s,["negativePrompt"]);t!==void 0&&l!=null&&f(t,["parameters","negativePrompt"],l);let c=h(s,["enhancePrompt"]);if(t!==void 0&&c!=null&&f(t,["parameters","enhancePrompt"],c),h(s,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let d=h(s,["lastFrame"]);t!==void 0&&d!=null&&f(t,["instances[0]","lastFrame"],Fd(d));let p=h(s,["referenceImages"]);if(t!==void 0&&p!=null){let g=p;Array.isArray(g)&&(g=g.map(m=>Jb(m))),f(t,["instances[0]","referenceImages"],g)}if(h(s,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(h(s,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return e}function YS(s,t){let e={},n=h(s,["numberOfVideos"]);t!==void 0&&n!=null&&f(t,["parameters","sampleCount"],n);let i=h(s,["outputGcsUri"]);t!==void 0&&i!=null&&f(t,["parameters","storageUri"],i);let o=h(s,["fps"]);t!==void 0&&o!=null&&f(t,["parameters","fps"],o);let r=h(s,["durationSeconds"]);t!==void 0&&r!=null&&f(t,["parameters","durationSeconds"],r);let a=h(s,["seed"]);t!==void 0&&a!=null&&f(t,["parameters","seed"],a);let l=h(s,["aspectRatio"]);t!==void 0&&l!=null&&f(t,["parameters","aspectRatio"],l);let c=h(s,["resolution"]);t!==void 0&&c!=null&&f(t,["parameters","resolution"],c);let d=h(s,["personGeneration"]);t!==void 0&&d!=null&&f(t,["parameters","personGeneration"],d);let p=h(s,["pubsubTopic"]);t!==void 0&&p!=null&&f(t,["parameters","pubsubTopic"],p);let g=h(s,["negativePrompt"]);t!==void 0&&g!=null&&f(t,["parameters","negativePrompt"],g);let m=h(s,["enhancePrompt"]);t!==void 0&&m!=null&&f(t,["parameters","enhancePrompt"],m);let v=h(s,["generateAudio"]);t!==void 0&&v!=null&&f(t,["parameters","generateAudio"],v);let A=h(s,["lastFrame"]);t!==void 0&&A!=null&&f(t,["instances[0]","lastFrame"],Ke(A));let T=h(s,["referenceImages"]);if(t!==void 0&&T!=null){let S=T;Array.isArray(S)&&(S=S.map(b=>Xb(b))),f(t,["instances[0]","referenceImages"],S)}let E=h(s,["mask"]);t!==void 0&&E!=null&&f(t,["instances[0]","mask"],Yb(E));let C=h(s,["compressionQuality"]);return t!==void 0&&C!=null&&f(t,["parameters","compressionQuality"],C),e}function JS(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response","generateVideoResponse"]);return r!=null&&f(t,["response"],jS(r)),t}function XS(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response"]);return r!=null&&f(t,["response"],tb(r)),t}function ZS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["prompt"]);i!=null&&f(e,["instances[0]","prompt"],i);let o=h(t,["image"]);o!=null&&f(e,["instances[0]","image"],Fd(o));let r=h(t,["video"]);r!=null&&f(e,["instances[0]","video"],XA(r));let a=h(t,["source"]);a!=null&&eb(a,e);let l=h(t,["config"]);return l!=null&&KS(l,e),e}function QS(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["prompt"]);i!=null&&f(e,["instances[0]","prompt"],i);let o=h(t,["image"]);o!=null&&f(e,["instances[0]","image"],Ke(o));let r=h(t,["video"]);r!=null&&f(e,["instances[0]","video"],ZA(r));let a=h(t,["source"]);a!=null&&nb(a,e);let l=h(t,["config"]);return l!=null&&YS(l,e),e}function jS(s){let t={},e=h(s,["generatedSamples"]);if(e!=null){let o=e;Array.isArray(o)&&(o=o.map(r=>ob(r))),f(t,["generatedVideos"],o)}let n=h(s,["raiMediaFilteredCount"]);n!=null&&f(t,["raiMediaFilteredCount"],n);let i=h(s,["raiMediaFilteredReasons"]);return i!=null&&f(t,["raiMediaFilteredReasons"],i),t}function tb(s){let t={},e=h(s,["videos"]);if(e!=null){let o=e;Array.isArray(o)&&(o=o.map(r=>rb(r))),f(t,["generatedVideos"],o)}let n=h(s,["raiMediaFilteredCount"]);n!=null&&f(t,["raiMediaFilteredCount"],n);let i=h(s,["raiMediaFilteredReasons"]);return i!=null&&f(t,["raiMediaFilteredReasons"],i),t}function eb(s,t){let e={},n=h(s,["prompt"]);t!==void 0&&n!=null&&f(t,["instances[0]","prompt"],n);let i=h(s,["image"]);t!==void 0&&i!=null&&f(t,["instances[0]","image"],Fd(i));let o=h(s,["video"]);return t!==void 0&&o!=null&&f(t,["instances[0]","video"],XA(o)),e}function nb(s,t){let e={},n=h(s,["prompt"]);t!==void 0&&n!=null&&f(t,["instances[0]","prompt"],n);let i=h(s,["image"]);t!==void 0&&i!=null&&f(t,["instances[0]","image"],Ke(i));let o=h(s,["video"]);return t!==void 0&&o!=null&&f(t,["instances[0]","video"],ZA(o)),e}function ib(s){let t={},e=h(s,["_self"]);e!=null&&f(t,["image"],pb(e));let n=h(s,["raiFilteredReason"]);n!=null&&f(t,["raiFilteredReason"],n);let i=h(s,["_self"]);return i!=null&&f(t,["safetyAttributes"],KA(i)),t}function Dd(s){let t={},e=h(s,["_self"]);e!=null&&f(t,["image"],WA(e));let n=h(s,["raiFilteredReason"]);n!=null&&f(t,["raiFilteredReason"],n);let i=h(s,["_self"]);i!=null&&f(t,["safetyAttributes"],YA(i));let o=h(s,["prompt"]);return o!=null&&f(t,["enhancedPrompt"],o),t}function sb(s){let t={},e=h(s,["_self"]);e!=null&&f(t,["mask"],WA(e));let n=h(s,["labels"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>o)),f(t,["labels"],i)}return t}function ob(s){let t={},e=h(s,["video"]);return e!=null&&f(t,["video"],Wb(e)),t}function rb(s){let t={},e=h(s,["_self"]);return e!=null&&f(t,["video"],Kb(e)),t}function ab(s){let t={},e=h(s,["modelSelectionConfig"]);e!=null&&f(t,["modelConfig"],e);let n=h(s,["responseJsonSchema"]);n!=null&&f(t,["responseJsonSchema"],n);let i=h(s,["audioTimestamp"]);i!=null&&f(t,["audioTimestamp"],i);let o=h(s,["candidateCount"]);o!=null&&f(t,["candidateCount"],o);let r=h(s,["enableAffectiveDialog"]);r!=null&&f(t,["enableAffectiveDialog"],r);let a=h(s,["frequencyPenalty"]);a!=null&&f(t,["frequencyPenalty"],a);let l=h(s,["logprobs"]);l!=null&&f(t,["logprobs"],l);let c=h(s,["maxOutputTokens"]);c!=null&&f(t,["maxOutputTokens"],c);let d=h(s,["mediaResolution"]);d!=null&&f(t,["mediaResolution"],d);let p=h(s,["presencePenalty"]);p!=null&&f(t,["presencePenalty"],p);let g=h(s,["responseLogprobs"]);g!=null&&f(t,["responseLogprobs"],g);let m=h(s,["responseMimeType"]);m!=null&&f(t,["responseMimeType"],m);let v=h(s,["responseModalities"]);v!=null&&f(t,["responseModalities"],v);let A=h(s,["responseSchema"]);A!=null&&f(t,["responseSchema"],A);let T=h(s,["routingConfig"]);T!=null&&f(t,["routingConfig"],T);let E=h(s,["seed"]);E!=null&&f(t,["seed"],E);let C=h(s,["speechConfig"]);C!=null&&f(t,["speechConfig"],C);let S=h(s,["stopSequences"]);S!=null&&f(t,["stopSequences"],S);let b=h(s,["temperature"]);b!=null&&f(t,["temperature"],b);let x=h(s,["thinkingConfig"]);x!=null&&f(t,["thinkingConfig"],x);let R=h(s,["topK"]);R!=null&&f(t,["topK"],R);let I=h(s,["topP"]);if(I!=null&&f(t,["topP"],I),h(s,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function lb(s,t){let e={},n=h(t,["model"]);return n!=null&&f(e,["_url","name"],et(s,n)),e}function cb(s,t){let e={},n=h(t,["model"]);return n!=null&&f(e,["_url","name"],et(s,n)),e}function ub(s){let t={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let e=h(s,["enableWidget"]);return e!=null&&f(t,["enableWidget"],e),t}function db(s){let t={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let e=h(s,["timeRangeFilter"]);return e!=null&&f(t,["timeRangeFilter"],e),t}function hb(s){let t={},e=h(s,["aspectRatio"]);e!=null&&f(t,["aspectRatio"],e);let n=h(s,["imageSize"]);if(n!=null&&f(t,["imageSize"],n),h(s,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(h(s,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function fb(s){let t={},e=h(s,["aspectRatio"]);e!=null&&f(t,["aspectRatio"],e);let n=h(s,["imageSize"]);n!=null&&f(t,["imageSize"],n);let i=h(s,["outputMimeType"]);i!=null&&f(t,["imageOutputOptions","mimeType"],i);let o=h(s,["outputCompressionQuality"]);return o!=null&&f(t,["imageOutputOptions","compressionQuality"],o),t}function pb(s){let t={},e=h(s,["bytesBase64Encoded"]);e!=null&&f(t,["imageBytes"],wi(e));let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function WA(s){let t={},e=h(s,["gcsUri"]);e!=null&&f(t,["gcsUri"],e);let n=h(s,["bytesBase64Encoded"]);n!=null&&f(t,["imageBytes"],wi(n));let i=h(s,["mimeType"]);return i!=null&&f(t,["mimeType"],i),t}function Fd(s){let t={};if(h(s,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let e=h(s,["imageBytes"]);e!=null&&f(t,["bytesBase64Encoded"],wi(e));let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function Ke(s){let t={},e=h(s,["gcsUri"]);e!=null&&f(t,["gcsUri"],e);let n=h(s,["imageBytes"]);n!=null&&f(t,["bytesBase64Encoded"],wi(n));let i=h(s,["mimeType"]);return i!=null&&f(t,["mimeType"],i),t}function gb(s,t,e){let n={},i=h(t,["pageSize"]);e!==void 0&&i!=null&&f(e,["_query","pageSize"],i);let o=h(t,["pageToken"]);e!==void 0&&o!=null&&f(e,["_query","pageToken"],o);let r=h(t,["filter"]);e!==void 0&&r!=null&&f(e,["_query","filter"],r);let a=h(t,["queryBase"]);return e!==void 0&&a!=null&&f(e,["_url","models_url"],$A(s,a)),n}function mb(s,t,e){let n={},i=h(t,["pageSize"]);e!==void 0&&i!=null&&f(e,["_query","pageSize"],i);let o=h(t,["pageToken"]);e!==void 0&&o!=null&&f(e,["_query","pageToken"],o);let r=h(t,["filter"]);e!==void 0&&r!=null&&f(e,["_query","filter"],r);let a=h(t,["queryBase"]);return e!==void 0&&a!=null&&f(e,["_url","models_url"],$A(s,a)),n}function yb(s,t){let e={},n=h(t,["config"]);return n!=null&&gb(s,n,e),e}function vb(s,t){let e={},n=h(t,["config"]);return n!=null&&mb(s,n,e),e}function _b(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["_self"]);if(i!=null){let o=GA(i);Array.isArray(o)&&(o=o.map(r=>Pg(r))),f(t,["models"],o)}return t}function Ab(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["_self"]);if(i!=null){let o=GA(i);Array.isArray(o)&&(o=o.map(r=>Mg(r))),f(t,["models"],o)}return t}function wb(s){let t={},e=h(s,["maskMode"]);e!=null&&f(t,["maskMode"],e);let n=h(s,["segmentationClasses"]);n!=null&&f(t,["maskClasses"],n);let i=h(s,["maskDilation"]);return i!=null&&f(t,["dilation"],i),t}function Pg(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["displayName"]);n!=null&&f(t,["displayName"],n);let i=h(s,["description"]);i!=null&&f(t,["description"],i);let o=h(s,["version"]);o!=null&&f(t,["version"],o);let r=h(s,["_self"]);r!=null&&f(t,["tunedModelInfo"],Ub(r));let a=h(s,["inputTokenLimit"]);a!=null&&f(t,["inputTokenLimit"],a);let l=h(s,["outputTokenLimit"]);l!=null&&f(t,["outputTokenLimit"],l);let c=h(s,["supportedGenerationMethods"]);c!=null&&f(t,["supportedActions"],c);let d=h(s,["temperature"]);d!=null&&f(t,["temperature"],d);let p=h(s,["maxTemperature"]);p!=null&&f(t,["maxTemperature"],p);let g=h(s,["topP"]);g!=null&&f(t,["topP"],g);let m=h(s,["topK"]);m!=null&&f(t,["topK"],m);let v=h(s,["thinking"]);return v!=null&&f(t,["thinking"],v),t}function Mg(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["displayName"]);n!=null&&f(t,["displayName"],n);let i=h(s,["description"]);i!=null&&f(t,["description"],i);let o=h(s,["versionId"]);o!=null&&f(t,["version"],o);let r=h(s,["deployedModels"]);if(r!=null){let p=r;Array.isArray(p)&&(p=p.map(g=>DS(g))),f(t,["endpoints"],p)}let a=h(s,["labels"]);a!=null&&f(t,["labels"],a);let l=h(s,["_self"]);l!=null&&f(t,["tunedModelInfo"],Ob(l));let c=h(s,["defaultCheckpointId"]);c!=null&&f(t,["defaultCheckpointId"],c);let d=h(s,["checkpoints"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(g=>g)),f(t,["checkpoints"],p)}return t}function Tb(s){let t={},e=h(s,["mediaResolution"]);e!=null&&f(t,["mediaResolution"],e);let n=h(s,["codeExecutionResult"]);n!=null&&f(t,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(t,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(t,["fileData"],FS(o));let r=h(s,["functionCall"]);r!=null&&f(t,["functionCall"],LS(r));let a=h(s,["functionResponse"]);a!=null&&f(t,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(t,["inlineData"],aS(l));let c=h(s,["text"]);c!=null&&f(t,["text"],c);let d=h(s,["thought"]);d!=null&&f(t,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(t,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(t,["videoMetadata"],g),t}function Eb(s){let t={},e=h(s,["productImage"]);return e!=null&&f(t,["image"],Ke(e)),t}function Cb(s,t){let e={},n=h(s,["numberOfImages"]);t!==void 0&&n!=null&&f(t,["parameters","sampleCount"],n);let i=h(s,["baseSteps"]);t!==void 0&&i!=null&&f(t,["parameters","baseSteps"],i);let o=h(s,["outputGcsUri"]);t!==void 0&&o!=null&&f(t,["parameters","storageUri"],o);let r=h(s,["seed"]);t!==void 0&&r!=null&&f(t,["parameters","seed"],r);let a=h(s,["safetyFilterLevel"]);t!==void 0&&a!=null&&f(t,["parameters","safetySetting"],a);let l=h(s,["personGeneration"]);t!==void 0&&l!=null&&f(t,["parameters","personGeneration"],l);let c=h(s,["addWatermark"]);t!==void 0&&c!=null&&f(t,["parameters","addWatermark"],c);let d=h(s,["outputMimeType"]);t!==void 0&&d!=null&&f(t,["parameters","outputOptions","mimeType"],d);let p=h(s,["outputCompressionQuality"]);t!==void 0&&p!=null&&f(t,["parameters","outputOptions","compressionQuality"],p);let g=h(s,["enhancePrompt"]);t!==void 0&&g!=null&&f(t,["parameters","enhancePrompt"],g);let m=h(s,["labels"]);return t!==void 0&&m!=null&&f(t,["labels"],m),e}function Sb(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["source"]);i!=null&&xb(i,e);let o=h(t,["config"]);return o!=null&&Cb(o,e),e}function bb(s){let t={},e=h(s,["predictions"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(i=>Dd(i))),f(t,["generatedImages"],n)}return t}function xb(s,t){let e={},n=h(s,["prompt"]);t!==void 0&&n!=null&&f(t,["instances[0]","prompt"],n);let i=h(s,["personImage"]);t!==void 0&&i!=null&&f(t,["instances[0]","personImage","image"],Ke(i));let o=h(s,["productImages"]);if(t!==void 0&&o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>Eb(a))),f(t,["instances[0]","productImages"],r)}return e}function Ib(s){let t={},e=h(s,["referenceImage"]);e!=null&&f(t,["referenceImage"],Ke(e));let n=h(s,["referenceId"]);n!=null&&f(t,["referenceId"],n);let i=h(s,["referenceType"]);i!=null&&f(t,["referenceType"],i);let o=h(s,["maskImageConfig"]);o!=null&&f(t,["maskImageConfig"],wb(o));let r=h(s,["controlImageConfig"]);r!=null&&f(t,["controlImageConfig"],pS(r));let a=h(s,["styleImageConfig"]);a!=null&&f(t,["styleImageConfig"],a);let l=h(s,["subjectImageConfig"]);return l!=null&&f(t,["subjectImageConfig"],l),t}function KA(s){let t={},e=h(s,["safetyAttributes","categories"]);e!=null&&f(t,["categories"],e);let n=h(s,["safetyAttributes","scores"]);n!=null&&f(t,["scores"],n);let i=h(s,["contentType"]);return i!=null&&f(t,["contentType"],i),t}function YA(s){let t={},e=h(s,["safetyAttributes","categories"]);e!=null&&f(t,["categories"],e);let n=h(s,["safetyAttributes","scores"]);n!=null&&f(t,["scores"],n);let i=h(s,["contentType"]);return i!=null&&f(t,["contentType"],i),t}function Rb(s){let t={},e=h(s,["category"]);if(e!=null&&f(t,["category"],e),h(s,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=h(s,["threshold"]);return n!=null&&f(t,["threshold"],n),t}function Pb(s){let t={},e=h(s,["image"]);return e!=null&&f(t,["image"],Ke(e)),t}function Mb(s,t){let e={},n=h(s,["mode"]);t!==void 0&&n!=null&&f(t,["parameters","mode"],n);let i=h(s,["maxPredictions"]);t!==void 0&&i!=null&&f(t,["parameters","maxPredictions"],i);let o=h(s,["confidenceThreshold"]);t!==void 0&&o!=null&&f(t,["parameters","confidenceThreshold"],o);let r=h(s,["maskDilation"]);t!==void 0&&r!=null&&f(t,["parameters","maskDilation"],r);let a=h(s,["binaryColorThreshold"]);t!==void 0&&a!=null&&f(t,["parameters","binaryColorThreshold"],a);let l=h(s,["labels"]);return t!==void 0&&l!=null&&f(t,["labels"],l),e}function Nb(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["source"]);i!=null&&Db(i,e);let o=h(t,["config"]);return o!=null&&Mb(o,e),e}function kb(s){let t={},e=h(s,["predictions"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(i=>sb(i))),f(t,["generatedMasks"],n)}return t}function Db(s,t){let e={},n=h(s,["prompt"]);t!==void 0&&n!=null&&f(t,["instances[0]","prompt"],n);let i=h(s,["image"]);t!==void 0&&i!=null&&f(t,["instances[0]","image"],Ke(i));let o=h(s,["scribbleImage"]);return t!==void 0&&o!=null&&f(t,["instances[0]","scribble"],Pb(o)),e}function Fb(s){let t={},e=h(s,["functionCallingConfig"]);e!=null&&f(t,["functionCallingConfig"],US(e));let n=h(s,["retrievalConfig"]);return n!=null&&f(t,["retrievalConfig"],n),t}function Lb(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let d=e;Array.isArray(d)&&(d=d.map(p=>p)),f(t,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(t,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(t,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(t,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(t,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(t,["googleMaps"],ub(a));let l=h(s,["googleSearch"]);l!=null&&f(t,["googleSearch"],db(l));let c=h(s,["urlContext"]);return c!=null&&f(t,["urlContext"],c),t}function JA(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let p=e;Array.isArray(p)&&(p=p.map(g=>OS(g))),f(t,["functionDeclarations"],p)}let n=h(s,["retrieval"]);n!=null&&f(t,["retrieval"],n);let i=h(s,["googleSearchRetrieval"]);i!=null&&f(t,["googleSearchRetrieval"],i);let o=h(s,["computerUse"]);if(o!=null&&f(t,["computerUse"],o),h(s,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=h(s,["codeExecution"]);r!=null&&f(t,["codeExecution"],r);let a=h(s,["enterpriseWebSearch"]);a!=null&&f(t,["enterpriseWebSearch"],a);let l=h(s,["googleMaps"]);l!=null&&f(t,["googleMaps"],l);let c=h(s,["googleSearch"]);c!=null&&f(t,["googleSearch"],c);let d=h(s,["urlContext"]);return d!=null&&f(t,["urlContext"],d),t}function Ub(s){let t={},e=h(s,["baseModel"]);e!=null&&f(t,["baseModel"],e);let n=h(s,["createTime"]);n!=null&&f(t,["createTime"],n);let i=h(s,["updateTime"]);return i!=null&&f(t,["updateTime"],i),t}function Ob(s){let t={},e=h(s,["labels","google-vertex-llm-tuning-base-model-id"]);e!=null&&f(t,["baseModel"],e);let n=h(s,["createTime"]);n!=null&&f(t,["createTime"],n);let i=h(s,["updateTime"]);return i!=null&&f(t,["updateTime"],i),t}function $b(s,t){let e={},n=h(s,["displayName"]);t!==void 0&&n!=null&&f(t,["displayName"],n);let i=h(s,["description"]);t!==void 0&&i!=null&&f(t,["description"],i);let o=h(s,["defaultCheckpointId"]);return t!==void 0&&o!=null&&f(t,["defaultCheckpointId"],o),e}function Gb(s,t){let e={},n=h(s,["displayName"]);t!==void 0&&n!=null&&f(t,["displayName"],n);let i=h(s,["description"]);t!==void 0&&i!=null&&f(t,["description"],i);let o=h(s,["defaultCheckpointId"]);return t!==void 0&&o!=null&&f(t,["defaultCheckpointId"],o),e}function Bb(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","name"],et(s,n));let i=h(t,["config"]);return i!=null&&$b(i,e),e}function Hb(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["config"]);return i!=null&&Gb(i,e),e}function Vb(s,t){let e={},n=h(s,["outputGcsUri"]);t!==void 0&&n!=null&&f(t,["parameters","storageUri"],n);let i=h(s,["safetyFilterLevel"]);t!==void 0&&i!=null&&f(t,["parameters","safetySetting"],i);let o=h(s,["personGeneration"]);t!==void 0&&o!=null&&f(t,["parameters","personGeneration"],o);let r=h(s,["includeRaiReason"]);t!==void 0&&r!=null&&f(t,["parameters","includeRaiReason"],r);let a=h(s,["outputMimeType"]);t!==void 0&&a!=null&&f(t,["parameters","outputOptions","mimeType"],a);let l=h(s,["outputCompressionQuality"]);t!==void 0&&l!=null&&f(t,["parameters","outputOptions","compressionQuality"],l);let c=h(s,["enhanceInputImage"]);t!==void 0&&c!=null&&f(t,["parameters","upscaleConfig","enhanceInputImage"],c);let d=h(s,["imagePreservationFactor"]);t!==void 0&&d!=null&&f(t,["parameters","upscaleConfig","imagePreservationFactor"],d);let p=h(s,["labels"]);t!==void 0&&p!=null&&f(t,["labels"],p);let g=h(s,["numberOfImages"]);t!==void 0&&g!=null&&f(t,["parameters","sampleCount"],g);let m=h(s,["mode"]);return t!==void 0&&m!=null&&f(t,["parameters","mode"],m),e}function qb(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["_url","model"],et(s,n));let i=h(t,["image"]);i!=null&&f(e,["instances[0]","image"],Ke(i));let o=h(t,["upscaleFactor"]);o!=null&&f(e,["parameters","upscaleConfig","upscaleFactor"],o);let r=h(t,["config"]);return r!=null&&Vb(r,e),e}function zb(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Dd(o))),f(t,["generatedImages"],i)}return t}function Wb(s){let t={},e=h(s,["uri"]);e!=null&&f(t,["uri"],e);let n=h(s,["encodedVideo"]);n!=null&&f(t,["videoBytes"],wi(n));let i=h(s,["encoding"]);return i!=null&&f(t,["mimeType"],i),t}function Kb(s){let t={},e=h(s,["gcsUri"]);e!=null&&f(t,["uri"],e);let n=h(s,["bytesBase64Encoded"]);n!=null&&f(t,["videoBytes"],wi(n));let i=h(s,["mimeType"]);return i!=null&&f(t,["mimeType"],i),t}function Yb(s){let t={},e=h(s,["image"]);e!=null&&f(t,["_self"],Ke(e));let n=h(s,["maskMode"]);return n!=null&&f(t,["maskMode"],n),t}function Jb(s){let t={},e=h(s,["image"]);e!=null&&f(t,["image"],Fd(e));let n=h(s,["referenceType"]);return n!=null&&f(t,["referenceType"],n),t}function Xb(s){let t={},e=h(s,["image"]);e!=null&&f(t,["image"],Ke(e));let n=h(s,["referenceType"]);return n!=null&&f(t,["referenceType"],n),t}function XA(s){let t={},e=h(s,["uri"]);e!=null&&f(t,["uri"],e);let n=h(s,["videoBytes"]);n!=null&&f(t,["encodedVideo"],wi(n));let i=h(s,["mimeType"]);return i!=null&&f(t,["encoding"],i),t}function ZA(s){let t={},e=h(s,["uri"]);e!=null&&f(t,["gcsUri"],e);let n=h(s,["videoBytes"]);n!=null&&f(t,["bytesBase64Encoded"],wi(n));let i=h(s,["mimeType"]);return i!=null&&f(t,["mimeType"],i),t}function Zb(s,t){let e={},n=h(s,["displayName"]);return t!==void 0&&n!=null&&f(t,["displayName"],n),e}function Qb(s){let t={},e=h(s,["config"]);return e!=null&&Zb(e,t),t}function jb(s,t){let e={},n=h(s,["force"]);return t!==void 0&&n!=null&&f(t,["_query","force"],n),e}function tx(s){let t={},e=h(s,["name"]);e!=null&&f(t,["_url","name"],e);let n=h(s,["config"]);return n!=null&&jb(n,t),t}function ex(s){let t={},e=h(s,["name"]);return e!=null&&f(t,["_url","name"],e),t}function nx(s,t){let e={},n=h(s,["customMetadata"]);if(t!==void 0&&n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["customMetadata"],o)}let i=h(s,["chunkingConfig"]);return t!==void 0&&i!=null&&f(t,["chunkingConfig"],i),e}function ix(s){let t={},e=h(s,["name"]);e!=null&&f(t,["name"],e);let n=h(s,["metadata"]);n!=null&&f(t,["metadata"],n);let i=h(s,["done"]);i!=null&&f(t,["done"],i);let o=h(s,["error"]);o!=null&&f(t,["error"],o);let r=h(s,["response"]);return r!=null&&f(t,["response"],ox(r)),t}function sx(s){let t={},e=h(s,["fileSearchStoreName"]);e!=null&&f(t,["_url","file_search_store_name"],e);let n=h(s,["fileName"]);n!=null&&f(t,["fileName"],n);let i=h(s,["config"]);return i!=null&&nx(i,t),t}function ox(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["parent"]);n!=null&&f(t,["parent"],n);let i=h(s,["documentName"]);return i!=null&&f(t,["documentName"],i),t}function rx(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);return t!==void 0&&i!=null&&f(t,["_query","pageToken"],i),e}function ax(s){let t={},e=h(s,["config"]);return e!=null&&rx(e,t),t}function lx(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["fileSearchStores"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["fileSearchStores"],o)}return t}function QA(s,t){let e={},n=h(s,["mimeType"]);t!==void 0&&n!=null&&f(t,["mimeType"],n);let i=h(s,["displayName"]);t!==void 0&&i!=null&&f(t,["displayName"],i);let o=h(s,["customMetadata"]);if(t!==void 0&&o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>l)),f(t,["customMetadata"],a)}let r=h(s,["chunkingConfig"]);return t!==void 0&&r!=null&&f(t,["chunkingConfig"],r),e}function cx(s){let t={},e=h(s,["fileSearchStoreName"]);e!=null&&f(t,["_url","file_search_store_name"],e);let n=h(s,["config"]);return n!=null&&QA(n,t),t}function ux(s){let t={},e=h(s,["sdkHttpResponse"]);return e!=null&&f(t,["sdkHttpResponse"],e),t}var dx="Content-Type",hx="X-Server-Timeout",fx="User-Agent",Ng="x-goog-api-client",px="1.34.0",gx=`google-genai-sdk/${px}`,mx="v1beta1",yx="v1beta",kg=class{constructor(t){var e,n;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});let i={};this.clientOptions.vertexai?(i.apiVersion=(e=this.clientOptions.apiVersion)!==null&&e!==void 0?e:mx,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:yx,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,t.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let t=new Headers;return await this.clientOptions.auth.addAuthHeaders(t),t}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let n=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&n.push(t.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let t=this.getBaseUrl(),e=new URL(t);return e.protocol=e.protocol=="http:"?"ws":"wss",e.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,e,n){let i=[this.getRequestUrlInternal(e)];return n&&i.push(this.getBaseResourcePath()),t!==""&&i.push(t),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));let n=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,n);if(t.queryParams)for(let[r,a]of Object.entries(t.queryParams))i.searchParams.append(r,String(a));let o={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=t.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,e,i.toString(),t.abortSignal),this.unaryApiCall(i,o,t.httpMethod)}patchHttpOptions(t,e){let n=JSON.parse(JSON.stringify(t));for(let[i,o]of Object.entries(e))typeof o=="object"?n[i]=Object.assign(Object.assign({},n[i]),o):o!==void 0&&(n[i]=o);return n}async requestStream(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));let n=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,n);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let o={};return o.body=t.body,o=await this.includeExtraHttpOptionsToRequestInit(o,e,i.toString(),t.abortSignal),this.streamApiCall(i,o,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,e,n,i){if(e&&e.timeout||i){let o=new AbortController,r=o.signal;if(e.timeout&&(e==null?void 0:e.timeout)>0){let a=setTimeout(()=>o.abort(),e.timeout);a&&typeof a.unref=="function"&&a.unref()}i&&i.addEventListener("abort",()=>{o.abort()}),t.signal=r}return e&&e.extraBody!==null&&vx(t,e.extraBody),t.headers=await this.getHeadersInternal(e,n),t}async unaryApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await yA(i),new Ka(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await yA(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(t){return qe(this,arguments,function*(){var n;let i=(n=t==null?void 0:t.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let r="",a="data:",l=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:c,value:d}=yield q(i.read());if(c){if(r.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let p=o.decode(d,{stream:!0});try{let v=JSON.parse(p);if("error"in v){let A=JSON.parse(JSON.stringify(v.error)),T=A.status,E=A.code,C=`got status: ${T}. ${JSON.stringify(v)}`;if(E>=400&&E<600)throw new md({message:C,status:E})}}catch(v){if(v.name==="ApiError")throw v}r+=p;let g=-1,m=0;for(;;){g=-1,m=0;for(let T of l){let E=r.indexOf(T);E!==-1&&(g===-1||E<g)&&(g=E,m=T.length)}if(g===-1)break;let v=r.substring(0,g);r=r.substring(g+m);let A=v.trim();if(A.startsWith(a)){let T=A.substring(a.length).trim();try{let E=new Response(T,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield q(new Ka(E))}catch(E){throw new Error(`exception parsing stream chunk ${T}. ${E}`)}}}}}finally{i.releaseLock()}})}async apiCall(t,e){return fetch(t,e).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){let t={},e=gx+" "+this.clientOptions.userAgentExtra;return t[fx]=e,t[Ng]=e,t[dx]="application/json",t}async getHeadersInternal(t,e){let n=new Headers;if(t&&t.headers){for(let[i,o]of Object.entries(t.headers))n.append(i,o);t.timeout&&t.timeout>0&&n.append(hx,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,e),n}getFileName(t){var e;let n="";return typeof t=="string"&&(n=t.replace(/[/\\]+$/,""),n=(e=n.split(/[/\\]/).pop())!==null&&e!==void 0?e:""),n}async uploadFile(t,e){var n;let i={};e!=null&&(i.mimeType=e.mimeType,i.name=e.name,i.displayName=e.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);let o=this.clientOptions.uploader,r=await o.stat(t);i.sizeBytes=String(r.size);let a=(n=e==null?void 0:e.mimeType)!==null&&n!==void 0?n:r.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=a;let l={file:i},c=this.getFileName(t),d=D("upload/v1beta/files",l._url),p=await this.fetchUploadUrl(d,i.sizeBytes,i.mimeType,c,l,e==null?void 0:e.httpOptions);return o.upload(t,p,this)}async uploadFileToFileSearchStore(t,e,n){var i;let o=this.clientOptions.uploader,r=await o.stat(e),a=String(r.size),l=(i=n==null?void 0:n.mimeType)!==null&&i!==void 0?i:r.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let c=`upload/v1beta/${t}:uploadToFileSearchStore`,d=this.getFileName(e),p={};n!=null&&QA(n,p);let g=await this.fetchUploadUrl(c,a,l,d,p,n==null?void 0:n.httpOptions);return o.uploadToFileSearchStore(e,g,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,e,n,i,o,r){var a;let l={};r?l=r:l={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e}`,"X-Goog-Upload-Header-Content-Type":`${n}`},i?{"X-Goog-Upload-File-Name":i}:{})};let c=await this.request({path:t,body:JSON.stringify(o),httpMethod:"POST",httpOptions:l});if(!c||!(c!=null&&c.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let d=(a=c==null?void 0:c.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(d===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return d}};async function yA(s){var t;if(s===void 0)throw new Error("response is undefined");if(!s.ok){let e=s.status,n;!((t=s.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?n=await s.json():n={error:{message:await s.text(),code:s.status,status:s.statusText}};let i=JSON.stringify(n);throw e>=400&&e<600?new md({message:i,status:e}):new Error(i)}}function vx(s,t){if(!t||Object.keys(t).length===0)return;if(s.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let e={};if(typeof s.body=="string"&&s.body.length>0)try{let o=JSON.parse(s.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))e=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch(o){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(o,r){let a=Object.assign({},o);for(let l in r)if(Object.prototype.hasOwnProperty.call(r,l)){let c=r[l],d=a[l];c&&typeof c=="object"&&!Array.isArray(c)&&d&&typeof d=="object"&&!Array.isArray(d)?a[l]=n(d,c):(d&&c&&typeof d!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof d}, New type: ${typeof c}. Overwriting.`),a[l]=c)}return a}let i=n(e,t);s.body=JSON.stringify(i)}var _x="mcp_used/unknown",Ax=!1;function jA(s){for(let t of s)if(wx(t)||typeof t=="object"&&"inputSchema"in t)return!0;return Ax}function tw(s){var t;let e=(t=s[Ng])!==null&&t!==void 0?t:"";s[Ng]=(e+` ${_x}`).trimStart()}function wx(s){return s!==null&&typeof s=="object"&&s instanceof Dg}function Tx(s){return qe(this,arguments,function*(e,n=100){let i,o=0;for(;o<n;){let r=yield q(e.listTools({cursor:i}));for(let a of r.tools)yield yield q(a),o++;if(!r.nextCursor)break;i=r.nextCursor}})}var Dg=class s{constructor(t=[],e){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=t,this.config=e}static create(t,e){return new s(t,e)}async initialize(){var t,e,n,i;if(this.mcpTools.length>0)return;let o={},r=[];for(let d of this.mcpClients)try{for(var a=!0,l=(e=void 0,ze(Tx(d))),c;c=await l.next(),t=c.done,!t;a=!0){i=c.value,a=!1;let p=i;r.push(p);let g=p.name;if(o[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);o[g]=d}}catch(p){e={error:p}}finally{try{!a&&!t&&(n=l.return)&&await n.call(l)}finally{if(e)throw e.error}}this.mcpTools=r,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),r0(this.mcpTools,this.config)}async callTool(t){await this.initialize();let e=[];for(let n of t)if(n.name in this.functionNameToMcpClient){let i=this.functionNameToMcpClient[n.name],o;this.config.timeout&&(o={timeout:this.config.timeout});let r=await i.callTool({name:n.name,arguments:n.args},void 0,o);e.push({functionResponse:{name:n.name,response:r.isError?{error:r}:r}})}return e}};async function Ex(s,t,e){let n=new wg,i;e.data instanceof Blob?i=JSON.parse(await e.data.text()):i=JSON.parse(e.data),Object.assign(n,i),t(n)}var Fg=class{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n}async connect(t){var e,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let i=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),r=Sx(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${i}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${a}`,c=()=>{},d=new Promise(S=>{c=S}),p=t.callbacks,g=function(){c({})},m=this.apiClient,v={onopen:g,onmessage:S=>{Ex(m,p.onmessage,S)},onerror:(e=p==null?void 0:p.onerror)!==null&&e!==void 0?e:function(S){},onclose:(n=p==null?void 0:p.onclose)!==null&&n!==void 0?n:function(S){}},A=this.webSocketFactory.create(l,Cx(r),v);A.connect(),await d;let C={setup:{model:et(this.apiClient,t.model)}};return A.send(JSON.stringify(C)),new Lg(A,this.apiClient)}},Lg=class{constructor(t,e){this.conn=t,this.apiClient=e}async setWeightedPrompts(t){if(!t.weightedPrompts||Object.keys(t.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let e=QC(t);this.conn.send(JSON.stringify({clientContent:e}))}async setMusicGenerationConfig(t){t.musicGenerationConfig||(t.musicGenerationConfig={});let e=ZC(t);this.conn.send(JSON.stringify(e))}sendPlaybackControl(t){let e={playbackControl:t};this.conn.send(JSON.stringify(e))}play(){this.sendPlaybackControl(qo.PLAY)}pause(){this.sendPlaybackControl(qo.PAUSE)}stop(){this.sendPlaybackControl(qo.STOP)}resetContext(){this.sendPlaybackControl(qo.RESET_CONTEXT)}close(){this.conn.close()}};function Cx(s){let t={};return s.forEach((e,n)=>{t[n]=e}),t}function Sx(s){let t=new Headers;for(let[e,n]of Object.entries(s))t.append(e,n);return t}var bx="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function xx(s,t,e){let n=new Ag,i;e.data instanceof Blob?i=await e.data.text():e.data instanceof ArrayBuffer?i=new TextDecoder().decode(e.data):i=e.data;let o=JSON.parse(i);if(s.isVertexAI()){let r=eS(o);Object.assign(n,r)}else Object.assign(n,o);t(n)}var Ug=class{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n,this.music=new Fg(this.apiClient,this.auth,this.webSocketFactory)}async connect(t){var e,n,i,o,r,a;if(t.config&&t.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),d,p=this.apiClient.getHeaders();t.config&&t.config.tools&&jA(t.config.tools)&&tw(p);let g=Px(p);if(this.apiClient.isVertexAI())d=`${l}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g,d);else{let M=this.apiClient.getApiKey(),F="BidiGenerateContent",U="key";M!=null&&M.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),F="BidiGenerateContentConstrained",U="access_token"),d=`${l}/ws/google.ai.generativelanguage.${c}.GenerativeService.${F}?${U}=${M}`}let m=()=>{},v=new Promise(M=>{m=M}),A=t.callbacks,T=function(){var M;(M=A==null?void 0:A.onopen)===null||M===void 0||M.call(A),m({})},E=this.apiClient,C={onopen:T,onmessage:M=>{xx(E,A.onmessage,M)},onerror:(e=A==null?void 0:A.onerror)!==null&&e!==void 0?e:function(M){},onclose:(n=A==null?void 0:A.onclose)!==null&&n!==void 0?n:function(M){}},S=this.webSocketFactory.create(d,Rx(g),C);S.connect(),await v;let b=et(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&b.startsWith("publishers/")){let M=this.apiClient.getProject(),F=this.apiClient.getLocation();b=`projects/${M}/locations/${F}/`+b}let x={};this.apiClient.isVertexAI()&&((i=t.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[nd.AUDIO]}:t.config.responseModalities=[nd.AUDIO]),!((o=t.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let R=(a=(r=t.config)===null||r===void 0?void 0:r.tools)!==null&&a!==void 0?a:[],I=[];for(let M of R)if(this.isCallableTool(M)){let F=M;I.push(await F.tool())}else I.push(M);I.length>0&&(t.config.tools=I);let N={model:b,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?x=XC(this.apiClient,N):x=JC(this.apiClient,N),delete x.config,S.send(JSON.stringify(x)),new Og(S,this.apiClient)}isCallableTool(t){return"callTool"in t&&typeof t.callTool=="function"}},Ix={turnComplete:!0},Og=class{constructor(t,e){this.conn=t,this.apiClient=e}tLiveClientContent(t,e){if(e.turns!==null&&e.turns!==void 0){let n=[];try{n=Ne(e.turns),t.isVertexAI()||(n=n.map(i=>kd(i)))}catch(i){throw new Error(`Failed to parse client content "turns", type: '${typeof e.turns}'`)}return{clientContent:{turns:n,turnComplete:e.turnComplete}}}return{clientContent:{turnComplete:e.turnComplete}}}tLiveClienttToolResponse(t,e){let n=[];if(e.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(e.functionResponses)?n=e.functionResponses:n=[e.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(let o of n){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!t.isVertexAI()&&!("id"in o))throw new Error(bx)}return{toolResponse:{functionResponses:n}}}sendClientContent(t){t=Object.assign(Object.assign({},Ix),t);let e=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendRealtimeInput(t){let e={};this.apiClient.isVertexAI()?e={realtimeInput:tS(t)}:e={realtimeInput:jC(t)},this.conn.send(JSON.stringify(e))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");let e=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(e))}close(){this.conn.close()}};function Rx(s){let t={};return s.forEach((e,n)=>{t[n]=e}),t}function Px(s){let t=new Headers;for(let[e,n]of Object.entries(s))t.append(e,n);return t}var vA=10;function _A(s){var t,e,n;if(!((t=s==null?void 0:s.automaticFunctionCalling)===null||t===void 0)&&t.disable)return!0;let i=!1;for(let r of(e=s==null?void 0:s.tools)!==null&&e!==void 0?e:[])if(Wo(r)){i=!0;break}if(!i)return!0;let o=(n=s==null?void 0:s.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function Wo(s){return"callTool"in s&&typeof s.callTool=="function"}function Mx(s){var t,e,n;return(n=(e=(t=s.config)===null||t===void 0?void 0:t.tools)===null||e===void 0?void 0:e.some(i=>Wo(i)))!==null&&n!==void 0?n:!1}function AA(s){var t;let e=[];return!((t=s==null?void 0:s.config)===null||t===void 0)&&t.tools&&s.config.tools.forEach((n,i)=>{if(Wo(n))return;let o=n;o.functionDeclarations&&o.functionDeclarations.length>0&&e.push(i)}),e}function wA(s){var t;return!(!((t=s==null?void 0:s.automaticFunctionCalling)===null||t===void 0)&&t.ignoreCallHistory)}var $g=class extends We{constructor(t){super(),this.apiClient=t,this.generateContent=async e=>{var n,i,o,r,a;let l=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!Mx(e)||_A(e.config))return await this.generateContentInternal(l);let c=AA(e);if(c.length>0){let A=c.map(T=>`tools[${T}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${A}.`)}let d,p,g=Ne(l.contents),m=(o=(i=(n=l.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:vA,v=0;for(;v<m&&(d=await this.generateContentInternal(l),!(!d.functionCalls||d.functionCalls.length===0));){let A=d.candidates[0].content,T=[];for(let E of(a=(r=e.config)===null||r===void 0?void 0:r.tools)!==null&&a!==void 0?a:[])if(Wo(E)){let S=await E.callTool(d.functionCalls);T.push(...S)}v++,p={role:"user",parts:T},l.contents=Ne(l.contents),l.contents.push(A),l.contents.push(p),wA(l.config)&&(g.push(A),g.push(p))}return wA(l.config)&&(d.automaticFunctionCallingHistory=g),d},this.generateContentStream=async e=>{var n,i,o,r,a;if(this.maybeMoveToResponseJsonSchem(e),_A(e.config)){let p=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(p)}let l=AA(e);if(l.length>0){let p=l.map(g=>`tools[${g}]`).join(", ");throw new Error(`Incompatible tools found at ${p}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let c=(o=(i=(n=e==null?void 0:e.config)===null||n===void 0?void 0:n.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||o===void 0?void 0:o.streamFunctionCallArguments,d=(a=(r=e==null?void 0:e.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(c&&!d)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(n=>{var i;let o,r=[];if(n!=null&&n.generatedImages)for(let l of n.generatedImages)l&&(l!=null&&l.safetyAttributes)&&((i=l==null?void 0:l.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?o=l==null?void 0:l.safetyAttributes:r.push(l);let a;return o?a={generatedImages:r,positivePromptSafetyAttributes:o,sdkHttpResponse:n.sdkHttpResponse}:a={generatedImages:r,sdkHttpResponse:n.sdkHttpResponse},a}),this.list=async e=>{var n;let r={config:Object.assign(Object.assign({},{queryBase:!0}),e==null?void 0:e.config)};if(this.apiClient.isVertexAI()&&!r.config.queryBase){if(!((n=r.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");r.config.filter="labels.tune-type:*"}return new On(Un.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(r),r)},this.editImage=async e=>{let n={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(n.referenceImages=e.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async e=>{let n={numberOfImages:1,mode:"upscale"};e.config&&(n=Object.assign(Object.assign({},n),e.config));let i={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:n};return await this.upscaleImageInternal(i)},this.generateVideos=async e=>{var n,i,o,r,a,l;if((e.prompt||e.image||e.video)&&e.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=e.video)===null||n===void 0)&&n.uri&&(!((i=e.video)===null||i===void 0)&&i.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:!((r=(o=e.source)===null||o===void 0?void 0:o.video)===null||r===void 0)&&r.uri&&(!((l=(a=e.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(t){t.config&&t.config.responseSchema&&(t.config.responseJsonSchema||Object.keys(t.config.responseSchema).includes("$schema")&&(t.config.responseJsonSchema=t.config.responseSchema,delete t.config.responseSchema))}async processParamsMaybeAddMcpUsage(t){var e,n,i;let o=(e=t.config)===null||e===void 0?void 0:e.tools;if(!o)return t;let r=await Promise.all(o.map(async l=>Wo(l)?await l.tool():l)),a={model:t.model,contents:t.contents,config:Object.assign(Object.assign({},t.config),{tools:r})};if(a.config.tools=r,t.config&&t.config.tools&&jA(t.config.tools)){let l=(i=(n=t.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&i!==void 0?i:{},c=Object.assign({},l);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),tw(c),a.config.httpOptions=Object.assign(Object.assign({},t.config.httpOptions),{headers:c})}return a}async initAfcToolsMap(t){var e,n,i;let o=new Map;for(let r of(n=(e=t.config)===null||e===void 0?void 0:e.tools)!==null&&n!==void 0?n:[])if(Wo(r)){let a=r,l=await a.tool();for(let c of(i=l.functionDeclarations)!==null&&i!==void 0?i:[]){if(!c.name)throw new Error("Function declaration name is required.");if(o.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);o.set(c.name,a)}}return o}async processAfcStream(t){var e,n,i;let o=(i=(n=(e=t.config)===null||e===void 0?void 0:e.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&i!==void 0?i:vA,r=!1,a=0,l=await this.initAfcToolsMap(t);return function(c,d,p){return qe(this,arguments,function*(){for(var g,m,v,A,T,E;a<o;){r&&(a++,r=!1);let x=yield q(c.processParamsMaybeAddMcpUsage(p)),R=yield q(c.generateContentStreamInternal(x)),I=[],N=[];try{for(var C=!0,S=(m=void 0,ze(R)),b;b=yield q(S.next()),g=b.done,!g;C=!0){A=b.value,C=!1;let M=A;if(yield yield q(M),M.candidates&&(!((T=M.candidates[0])===null||T===void 0)&&T.content)){N.push(M.candidates[0].content);for(let F of(E=M.candidates[0].content.parts)!==null&&E!==void 0?E:[])if(a<o&&F.functionCall){if(!F.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(F.functionCall.name)){let U=yield q(d.get(F.functionCall.name).callTool([F.functionCall]));I.push(...U)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${F.functionCall.name}`)}}}}catch(M){m={error:M}}finally{try{!C&&!g&&(v=S.return)&&(yield q(v.call(S)))}finally{if(m)throw m.error}}if(I.length>0){r=!0;let M=new us;M.candidates=[{content:{role:"user",parts:I}}],yield yield q(M);let F=[];F.push(...N),F.push({role:"user",parts:I});let U=Ne(p.contents).concat(F);p.contents=U}else break}})}(this,l,t)}async generateContentInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=pA(this.apiClient,t);return a=D("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=mA(d),g=new us;return Object.assign(g,p),g})}else{let c=fA(this.apiClient,t);return a=D("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=gA(d),g=new us;return Object.assign(g,p),g})}}async generateContentStreamInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=pA(this.apiClient,t);return a=D("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}),r.then(function(p){return qe(this,arguments,function*(){var g,m,v,A;try{for(var T=!0,E=ze(p),C;C=yield q(E.next()),g=C.done,!g;T=!0){A=C.value,T=!1;let S=A,b=mA(yield q(S.json()));b.sdkHttpResponse={headers:S.headers};let x=new us;Object.assign(x,b),yield yield q(x)}}catch(S){m={error:S}}finally{try{!T&&!g&&(v=E.return)&&(yield q(v.call(E)))}finally{if(m)throw m.error}}})})}else{let c=fA(this.apiClient,t);return a=D("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}),r.then(function(p){return qe(this,arguments,function*(){var g,m,v,A;try{for(var T=!0,E=ze(p),C;C=yield q(E.next()),g=C.done,!g;T=!0){A=C.value,T=!1;let S=A,b=gA(yield q(S.json()));b.sdkHttpResponse={headers:S.headers};let x=new us;Object.assign(x,b),yield yield q(x)}}catch(S){m={error:S}}finally{try{!T&&!g&&(v=E.return)&&(yield q(v.call(E)))}finally{if(m)throw m.error}}})})}}async embedContent(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=MS(this.apiClient,t);return a=D("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=kS(d),g=new id;return Object.assign(g,p),g})}else{let c=PS(this.apiClient,t);return a=D("{model}:batchEmbedContents",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=NS(d),g=new id;return Object.assign(g,p),g})}}async generateImagesInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=qS(this.apiClient,t);return a=D("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=WS(d),g=new sd;return Object.assign(g,p),g})}else{let c=VS(this.apiClient,t);return a=D("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=zS(d),g=new sd;return Object.assign(g,p),g})}}async editImageInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=bS(this.apiClient,t);return o=D("{model}:predict",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=xS(l),d=new lg;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=qb(this.apiClient,t);return o=D("{model}:predict",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=zb(l),d=new cg;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=Sb(this.apiClient,t);return o=D("{model}:predict",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=bb(l),d=new ug;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=Nb(this.apiClient,t);return o=D("{model}:predict",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=kb(l),d=new dg;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=cb(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>Mg(d))}else{let c=lb(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>Pg(d))}}async listInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=vb(this.apiClient,t);return a=D("{models_url}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=Ab(d),g=new od;return Object.assign(g,p),g})}else{let c=yb(this.apiClient,t);return a=D("{models_url}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=_b(d),g=new od;return Object.assign(g,p),g})}}async update(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=Hb(this.apiClient,t);return a=D("{model}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>Mg(d))}else{let c=Bb(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>Pg(d))}}async delete(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=TS(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=CS(d),g=new rd;return Object.assign(g,p),g})}else{let c=wS(this.apiClient,t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=ES(d),g=new rd;return Object.assign(g,p),g})}}async countTokens(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=vS(this.apiClient,t);return a=D("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=AS(d),g=new ad;return Object.assign(g,p),g})}else{let c=yS(this.apiClient,t);return a=D("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=_S(d),g=new ad;return Object.assign(g,p),g})}}async computeTokens(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=uS(this.apiClient,t);return o=D("{model}:computeTokens",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>{let c=dS(l),d=new hg;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=QS(this.apiClient,t);return a=D("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>{let p=XS(d),g=new ld;return Object.assign(g,p),g})}else{let c=ZS(this.apiClient,t);return a=D("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r.then(d=>{let p=JS(d),g=new ld;return Object.assign(g,p),g})}}};var Gg=class extends We{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){let e=t.operation,n=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=e.name.split("/operations/")[0],o;n&&"httpOptions"in n&&(o=n.httpOptions);let r=await this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:i,config:{httpOptions:o}});return e._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:e.name,config:n});return e._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(t){let e=t.operation,n=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=e.name.split("/operations/")[0],o;n&&"httpOptions"in n&&(o=n.httpOptions);let r=await this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:i,config:{httpOptions:o}});return e._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:e.name,config:n});return e._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=KE(t);return a=D("{operationName}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r}else{let c=WE(t);return a=D("{operationName}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),r}}async fetchPredictVideosOperationInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=$E(t);return o=D("{resourceName}:fetchPredictOperation",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}};function Nx(s){let t={},e=h(s,["data"]);if(e!=null&&f(t,["data"],e),h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function kx(s){let t={},e=h(s,["parts"]);if(e!=null){let i=e;Array.isArray(i)&&(i=i.map(o=>Hx(o))),f(t,["parts"],i)}let n=h(s,["role"]);return n!=null&&f(t,["role"],n),t}function Dx(s,t,e){let n={},i=h(t,["expireTime"]);e!==void 0&&i!=null&&f(e,["expireTime"],i);let o=h(t,["newSessionExpireTime"]);e!==void 0&&o!=null&&f(e,["newSessionExpireTime"],o);let r=h(t,["uses"]);e!==void 0&&r!=null&&f(e,["uses"],r);let a=h(t,["liveConnectConstraints"]);e!==void 0&&a!=null&&f(e,["bidiGenerateContentSetup"],Bx(s,a));let l=h(t,["lockAdditionalFields"]);return e!==void 0&&l!=null&&f(e,["fieldMask"],l),n}function Fx(s,t){let e={},n=h(t,["config"]);return n!=null&&f(e,["config"],Dx(s,n,e)),e}function Lx(s){let t={};if(h(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let e=h(s,["fileUri"]);e!=null&&f(t,["fileUri"],e);let n=h(s,["mimeType"]);return n!=null&&f(t,["mimeType"],n),t}function Ux(s){let t={},e=h(s,["id"]);e!=null&&f(t,["id"],e);let n=h(s,["args"]);n!=null&&f(t,["args"],n);let i=h(s,["name"]);if(i!=null&&f(t,["name"],i),h(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function Ox(s){let t={};if(h(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let e=h(s,["enableWidget"]);return e!=null&&f(t,["enableWidget"],e),t}function $x(s){let t={};if(h(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let e=h(s,["timeRangeFilter"]);return e!=null&&f(t,["timeRangeFilter"],e),t}function Gx(s,t){let e={},n=h(s,["generationConfig"]);t!==void 0&&n!=null&&f(t,["setup","generationConfig"],n);let i=h(s,["responseModalities"]);t!==void 0&&i!=null&&f(t,["setup","generationConfig","responseModalities"],i);let o=h(s,["temperature"]);t!==void 0&&o!=null&&f(t,["setup","generationConfig","temperature"],o);let r=h(s,["topP"]);t!==void 0&&r!=null&&f(t,["setup","generationConfig","topP"],r);let a=h(s,["topK"]);t!==void 0&&a!=null&&f(t,["setup","generationConfig","topK"],a);let l=h(s,["maxOutputTokens"]);t!==void 0&&l!=null&&f(t,["setup","generationConfig","maxOutputTokens"],l);let c=h(s,["mediaResolution"]);t!==void 0&&c!=null&&f(t,["setup","generationConfig","mediaResolution"],c);let d=h(s,["seed"]);t!==void 0&&d!=null&&f(t,["setup","generationConfig","seed"],d);let p=h(s,["speechConfig"]);t!==void 0&&p!=null&&f(t,["setup","generationConfig","speechConfig"],lm(p));let g=h(s,["thinkingConfig"]);t!==void 0&&g!=null&&f(t,["setup","generationConfig","thinkingConfig"],g);let m=h(s,["enableAffectiveDialog"]);t!==void 0&&m!=null&&f(t,["setup","generationConfig","enableAffectiveDialog"],m);let v=h(s,["systemInstruction"]);t!==void 0&&v!=null&&f(t,["setup","systemInstruction"],kx(Vt(v)));let A=h(s,["tools"]);if(t!==void 0&&A!=null){let R=Xo(A);Array.isArray(R)&&(R=R.map(I=>qx(Jo(I)))),f(t,["setup","tools"],R)}let T=h(s,["sessionResumption"]);t!==void 0&&T!=null&&f(t,["setup","sessionResumption"],Vx(T));let E=h(s,["inputAudioTranscription"]);t!==void 0&&E!=null&&f(t,["setup","inputAudioTranscription"],E);let C=h(s,["outputAudioTranscription"]);t!==void 0&&C!=null&&f(t,["setup","outputAudioTranscription"],C);let S=h(s,["realtimeInputConfig"]);t!==void 0&&S!=null&&f(t,["setup","realtimeInputConfig"],S);let b=h(s,["contextWindowCompression"]);t!==void 0&&b!=null&&f(t,["setup","contextWindowCompression"],b);let x=h(s,["proactivity"]);if(t!==void 0&&x!=null&&f(t,["setup","proactivity"],x),h(s,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return e}function Bx(s,t){let e={},n=h(t,["model"]);n!=null&&f(e,["setup","model"],et(s,n));let i=h(t,["config"]);return i!=null&&f(e,["config"],Gx(i,e)),e}function Hx(s){let t={},e=h(s,["mediaResolution"]);e!=null&&f(t,["mediaResolution"],e);let n=h(s,["codeExecutionResult"]);n!=null&&f(t,["codeExecutionResult"],n);let i=h(s,["executableCode"]);i!=null&&f(t,["executableCode"],i);let o=h(s,["fileData"]);o!=null&&f(t,["fileData"],Lx(o));let r=h(s,["functionCall"]);r!=null&&f(t,["functionCall"],Ux(r));let a=h(s,["functionResponse"]);a!=null&&f(t,["functionResponse"],a);let l=h(s,["inlineData"]);l!=null&&f(t,["inlineData"],Nx(l));let c=h(s,["text"]);c!=null&&f(t,["text"],c);let d=h(s,["thought"]);d!=null&&f(t,["thought"],d);let p=h(s,["thoughtSignature"]);p!=null&&f(t,["thoughtSignature"],p);let g=h(s,["videoMetadata"]);return g!=null&&f(t,["videoMetadata"],g),t}function Vx(s){let t={},e=h(s,["handle"]);if(e!=null&&f(t,["handle"],e),h(s,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function qx(s){let t={},e=h(s,["functionDeclarations"]);if(e!=null){let d=e;Array.isArray(d)&&(d=d.map(p=>p)),f(t,["functionDeclarations"],d)}if(h(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=h(s,["googleSearchRetrieval"]);n!=null&&f(t,["googleSearchRetrieval"],n);let i=h(s,["computerUse"]);i!=null&&f(t,["computerUse"],i);let o=h(s,["fileSearch"]);o!=null&&f(t,["fileSearch"],o);let r=h(s,["codeExecution"]);if(r!=null&&f(t,["codeExecution"],r),h(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=h(s,["googleMaps"]);a!=null&&f(t,["googleMaps"],Ox(a));let l=h(s,["googleSearch"]);l!=null&&f(t,["googleSearch"],$x(l));let c=h(s,["urlContext"]);return c!=null&&f(t,["urlContext"],c),t}function zx(s){let t=[];for(let e in s)if(Object.prototype.hasOwnProperty.call(s,e)){let n=s[e];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){let i=Object.keys(n).map(o=>`${e}.${o}`);t.push(...i)}else t.push(e)}return t.join(",")}function Wx(s,t){let e=null,n=s.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){let o=n.setup;typeof o=="object"&&o!==null?(s.bidiGenerateContentSetup=o,e=o):delete s.bidiGenerateContentSetup}else n!==void 0&&delete s.bidiGenerateContentSetup;let i=s.fieldMask;if(e){let o=zx(e);if(Array.isArray(t==null?void 0:t.lockAdditionalFields)&&(t==null?void 0:t.lockAdditionalFields.length)===0)o?s.fieldMask=o:delete s.fieldMask;else if(t!=null&&t.lockAdditionalFields&&t.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){let r=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],a=[];i.length>0&&(a=i.map(c=>r.includes(c)?`generationConfig.${c}`:c));let l=[];o&&l.push(o),a.length>0&&l.push(...a),l.length>0?s.fieldMask=l.join(","):delete s.fieldMask}else delete s.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?s.fieldMask=i.join(","):delete s.fieldMask;return s}var Bg=class extends We{constructor(t){super(),this.apiClient=t}async create(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let a=Fx(this.apiClient,t);o=D("auth_tokens",a._url),r=a._query,delete a.config,delete a._url,delete a._query;let l=Wx(a,t.config);return i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>c)}}};function Kx(s,t){let e={},n=h(s,["force"]);return t!==void 0&&n!=null&&f(t,["_query","force"],n),e}function Yx(s){let t={},e=h(s,["name"]);e!=null&&f(t,["_url","name"],e);let n=h(s,["config"]);return n!=null&&Kx(n,t),t}function Jx(s){let t={},e=h(s,["name"]);return e!=null&&f(t,["_url","name"],e),t}function Xx(s,t){let e={},n=h(s,["pageSize"]);t!==void 0&&n!=null&&f(t,["_query","pageSize"],n);let i=h(s,["pageToken"]);return t!==void 0&&i!=null&&f(t,["_query","pageToken"],i),e}function Zx(s){let t={},e=h(s,["parent"]);e!=null&&f(t,["_url","parent"],e);let n=h(s,["config"]);return n!=null&&Xx(n,t),t}function Qx(s){let t={},e=h(s,["sdkHttpResponse"]);e!=null&&f(t,["sdkHttpResponse"],e);let n=h(s,["nextPageToken"]);n!=null&&f(t,["nextPageToken"],n);let i=h(s,["documents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>r)),f(t,["documents"],o)}return t}var Hg=class extends We{constructor(t){super(),this.apiClient=t,this.list=async e=>new On(Un.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:e.parent,config:n.config}),await this.listInternal(e),e)}async get(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Jx(t);return o=D("{name}",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(t){var e,n;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let r=Yx(t);i=D("{name}",r._url),o=r._query,delete r._url,delete r._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Zx(t);return o=D("{parent}/documents",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=Qx(l),d=new fg;return Object.assign(d,c),d})}}};var Vg=class extends We{constructor(t,e=new Hg(t)){super(),this.apiClient=t,this.documents=e,this.list=async(n={})=>new On(Un.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(n),n)}async uploadToFileSearchStore(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(t.fileSearchStoreName,t.file,t.config)}async create(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Qb(t);return o=D("fileSearchStores",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async get(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=ex(t);return o=D("{name}",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(t){var e,n;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let r=tx(t);i=D("{name}",r._url),o=r._query,delete r._url,delete r._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=ax(t);return o=D("fileSearchStores",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=lx(l),d=new pg;return Object.assign(d,c),d})}}async uploadToFileSearchStoreInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=cx(t);return o=D("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=ux(l),d=new gg;return Object.assign(d,c),d})}}async importFile(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=sx(t);return o=D("{file_search_store_name}:importFile",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),i.then(l=>{let c=ix(l),d=new mg;return Object.assign(d,c),d})}}};var ew=function(){let{crypto:s}=globalThis;if(s!=null&&s.randomUUID)return ew=s.randomUUID.bind(s),s.randomUUID();let t=new Uint8Array(1),e=s?()=>s.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^e()&15>>+n/4).toString(16))},jx=()=>ew();function qg(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}var zg=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){let t=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(t.stack=s.stack),s.cause&&!t.cause&&(t.cause=s.cause),s.name&&(t.name=s.name),t}}catch(t){}try{return new Error(JSON.stringify(s))}catch(t){}}return new Error(s)};var re=class extends Error{},ae=class s extends re{constructor(t,e,n,i){super(`${s.makeMessage(t,e,n)}`),this.status=t,this.headers=i,this.error=e}static makeMessage(t,e,n){let i=e!=null&&e.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):n;return t&&i?`${t} ${i}`:t?`${t} status code (no body)`:i||"(no status code or body)"}static generate(t,e,n,i){if(!t||!i)return new Ko({message:n,cause:zg(e)});let o=e;return t===400?new vd(t,o,n,i):t===401?new _d(t,o,n,i):t===403?new Ad(t,o,n,i):t===404?new wd(t,o,n,i):t===409?new Td(t,o,n,i):t===422?new Ed(t,o,n,i):t===429?new Cd(t,o,n,i):t>=500?new Sd(t,o,n,i):new s(t,o,n,i)}},Ya=class extends ae{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}},Ko=class extends ae{constructor({message:t,cause:e}){super(void 0,void 0,t||"Connection error.",void 0),e&&(this.cause=e)}},yd=class extends Ko{constructor({message:t}={}){super({message:t!=null?t:"Request timed out."})}},vd=class extends ae{},_d=class extends ae{},Ad=class extends ae{},wd=class extends ae{},Td=class extends ae{},Ed=class extends ae{},Cd=class extends ae{},Sd=class extends ae{};var tI=/^[a-z][a-z0-9+.-]*:/i,eI=s=>tI.test(s),Wg=s=>(Wg=Array.isArray,Wg(s)),nI=Wg,iI=nI,TA=iI;function sI(s){if(!s)return!0;for(let t in s)return!1;return!0}function oI(s,t){return Object.prototype.hasOwnProperty.call(s,t)}var rI=(s,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new re(`${s} must be an integer`);if(t<0)throw new re(`${s} must be a positive integer`);return t},aI=s=>{try{return JSON.parse(s)}catch(t){return}};var lI=s=>new Promise(t=>setTimeout(t,s));var Vo="0.0.1";function cI(){return typeof Deno!="undefined"&&Deno.build!=null?"deno":typeof EdgeRuntime!="undefined"?"edge":Object.prototype.toString.call(typeof globalThis.process!="undefined"?globalThis.process:0)==="[object process]"?"node":"unknown"}var uI=()=>{var s,t,e,n,i;let o=cI();if(o==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vo,"X-Stainless-OS":CA(Deno.build.os),"X-Stainless-Arch":EA(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(s=Deno.version)===null||s===void 0?void 0:s.deno)!==null&&t!==void 0?t:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(o==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vo,"X-Stainless-OS":CA((e=globalThis.process.platform)!==null&&e!==void 0?e:"unknown"),"X-Stainless-Arch":EA((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!==null&&i!==void 0?i:"unknown"};let r=dI();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function dI(){if(typeof navigator=="undefined"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:t,pattern:e}of s){let n=e.exec(navigator.userAgent);if(n){let i=n[1]||0,o=n[2]||0,r=n[3]||0;return{browser:t,version:`${i}.${o}.${r}`}}}return null}var EA=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",CA=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),Ju,hI=()=>Ju!=null?Ju:Ju=uI();function fI(){if(typeof fetch!="undefined")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function nw(...s){let t=globalThis.ReadableStream;if(typeof t=="undefined")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...s)}function pI(s){let t=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return nw({start(){},async pull(e){let{done:n,value:i}=await t.next();n?e.close():e.enqueue(i)},async cancel(){var e;await((e=t.return)===null||e===void 0?void 0:e.call(t))}})}function iw(s){if(s[Symbol.asyncIterator])return s;let t=s.getReader();return{async next(){try{let e=await t.read();return e!=null&&e.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function gI(s){var t,e;if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await((e=(t=s[Symbol.asyncIterator]()).return)===null||e===void 0?void 0:e.call(t));return}let n=s.getReader(),i=n.cancel();n.releaseLock(),await i}var mI=({headers:s,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});var sw=()=>{var s;if(typeof File=="undefined"){let{process:t}=globalThis,e=typeof((s=t==null?void 0:t.versions)===null||s===void 0?void 0:s.node)=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function sg(s,t,e){return sw(),new File(s,t!=null?t:"unknown_file",e)}function yI(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}var vI=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function";var ow=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",_I=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&ow(s),AI=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function wI(s,t,e){if(sw(),s=await s,_I(s))return s instanceof File?s:sg([await s.arrayBuffer()],s.name);if(AI(s)){let i=await s.blob();return t||(t=new URL(s.url).pathname.split(/[\\/]/).pop()),sg(await Kg(i),t,e)}let n=await Kg(s);if(t||(t=yI(s)),!(e!=null&&e.type)){let i=n.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof i=="string"&&(e=Object.assign(Object.assign({},e),{type:i}))}return sg(n,t,e)}async function Kg(s){var t,e,n,i,o;let r=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)r.push(s);else if(ow(s))r.push(s instanceof Blob?s:await s.arrayBuffer());else if(vI(s))try{for(var a=!0,l=ze(s),c;c=await l.next(),t=c.done,!t;a=!0){i=c.value,a=!1;let d=i;r.push(...await Kg(d))}}catch(d){e={error:d}}finally{try{!a&&!t&&(n=l.return)&&await n.call(l)}finally{if(e)throw e.error}}else{let d=(o=s==null?void 0:s.constructor)===null||o===void 0?void 0:o.name;throw new Error(`Unexpected data type: ${typeof s}${d?`; constructor: ${d}`:""}${TI(s)}`)}return r}function TI(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(e=>`"${e}"`).join(", ")}]`}var bd=class{constructor(t){this._client=t}};bd._key=[];function rw(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var SA=Object.freeze(Object.create(null)),EI=(s=rw)=>function(e,...n){if(e.length===1)return e[0];let i=!1,o=[],r=e.reduce((d,p,g)=>{var m,v,A;/[?#]/.test(p)&&(i=!0);let T=n[g],E=(i?encodeURIComponent:s)(""+T);return g!==n.length&&(T==null||typeof T=="object"&&T.toString===((A=Object.getPrototypeOf((v=Object.getPrototypeOf((m=T.hasOwnProperty)!==null&&m!==void 0?m:SA))!==null&&v!==void 0?v:SA))===null||A===void 0?void 0:A.toString))&&(E=T+"",o.push({start:d.length+p.length,length:E.length,error:`Value of type ${Object.prototype.toString.call(T).slice(8,-1)} is not a valid path parameter`})),d+p+(g===n.length?"":E)},""),a=r.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,c;for(;(c=l.exec(a))!==null;)o.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(o.sort((d,p)=>d.start-p.start),o.length>0){let d=0,p=o.reduce((g,m)=>{let v=" ".repeat(m.start-d),A="^".repeat(m.length);return d=m.start+m.length,g+v+A},"");throw new re(`Path parameters result in path with invalid segments:
${o.map(g=>g.error).join(`
`)}
${r}
${p}`)}return r},Xu=EI(rw);var xd=class extends bd{create(t,e){var n;let{api_version:i=this._client.apiVersion}=t,o=gd(t,["api_version"]);if("model"in o&&"agent_config"in o)throw new re("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in o&&"generation_config"in o)throw new re("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Xu`/${i}/interactions`,Object.assign(Object.assign({body:o},e),{stream:(n=t.stream)!==null&&n!==void 0?n:!1}))}delete(t,e={},n){let{api_version:i=this._client.apiVersion}=e!=null?e:{};return this._client.delete(Xu`/${i}/interactions/${t}`,n)}cancel(t,e={},n){let{api_version:i=this._client.apiVersion}=e!=null?e:{};return this._client.post(Xu`/${i}/interactions/${t}/cancel`,n)}get(t,e={},n){var i;let o=e!=null?e:{},{api_version:r=this._client.apiVersion}=o,a=gd(o,["api_version"]);return this._client.get(Xu`/${r}/interactions/${t}`,Object.assign(Object.assign({query:a},n),{stream:(i=e==null?void 0:e.stream)!==null&&i!==void 0?i:!1}))}};xd._key=Object.freeze(["interactions"]);var Id=class extends xd{};function CI(s){let t=0;for(let i of s)t+=i.length;let e=new Uint8Array(t),n=0;for(let i of s)e.set(i,n),n+=i.length;return e}var Zu;function cm(s){let t;return(Zu!=null?Zu:(t=new globalThis.TextEncoder,Zu=t.encode.bind(t)))(s)}var Qu;function bA(s){let t;return(Qu!=null?Qu:(t=new globalThis.TextDecoder,Qu=t.decode.bind(t)))(s)}var Yo=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(t){if(t==null)return[];let e=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?cm(t):t;this.buffer=CI([this.buffer,e]);let n=[],i;for(;(i=SI(this.buffer,this.carriageReturnIndex))!=null;){if(i.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=i.index;continue}if(this.carriageReturnIndex!=null&&(i.index!==this.carriageReturnIndex+1||i.carriage)){n.push(bA(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let o=this.carriageReturnIndex!==null?i.preceding-1:i.preceding,r=bA(this.buffer.subarray(0,o));n.push(r),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}};Yo.NEWLINE_CHARS=new Set([`
`,"\r"]);Yo.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function SI(s,t){for(let i=t!=null?t:0;i<s.length;i++){if(s[i]===10)return{preceding:i,index:i+1,carriage:!1};if(s[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function bI(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}var Rd={off:0,error:200,warn:300,info:400,debug:500},xA=(s,t,e)=>{if(s){if(oI(Rd,s))return s;te(e).warn(`${t} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(Rd))}`)}};function Wa(){}function ju(s,t,e){return!t||Rd[s]>Rd[e]?Wa:t[s].bind(t)}var xI={error:Wa,warn:Wa,info:Wa,debug:Wa},IA=new WeakMap;function te(s){var t;let e=s.logger,n=(t=s.logLevel)!==null&&t!==void 0?t:"off";if(!e)return xI;let i=IA.get(e);if(i&&i[0]===n)return i[1];let o={error:ju("error",e,n),warn:ju("warn",e,n),info:ju("info",e,n),debug:ju("debug",e,n)};return IA.set(e,[n,o]),o}var cs=s=>(s.options&&(s.options=Object.assign({},s.options),delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([t,e])=>[t,t.toLowerCase()==="x-goog-api-key"||t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":e]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var Yg=class s{constructor(t,e,n){this.iterator=t,this.controller=e,this.client=n}static fromSSEResponse(t,e,n){let i=!1,o=n?te(n):console;function r(){return qe(this,arguments,function*(){var l,c,d,p;if(i)throw new re("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var m=!0,v=ze(II(t,e)),A;A=yield q(v.next()),l=A.done,!l;m=!0){p=A.value,m=!1;let T=p;if(!g)if(T.data.startsWith("[DONE]")){g=!0;continue}else try{yield yield q(JSON.parse(T.data))}catch(E){throw o.error("Could not parse message into JSON:",T.data),o.error("From chunk:",T.raw),E}}}catch(T){c={error:T}}finally{try{!m&&!l&&(d=v.return)&&(yield q(d.call(v)))}finally{if(c)throw c.error}}g=!0}catch(T){if(qg(T))return yield q(void 0);throw T}finally{g||e.abort()}})}return new s(r,e,n)}static fromReadableStream(t,e,n){let i=!1;function o(){return qe(this,arguments,function*(){var l,c,d,p;let g=new Yo,m=iw(t);try{for(var v=!0,A=ze(m),T;T=yield q(A.next()),l=T.done,!l;v=!0){p=T.value,v=!1;let E=p;for(let C of g.decode(E))yield yield q(C)}}catch(E){c={error:E}}finally{try{!v&&!l&&(d=A.return)&&(yield q(d.call(A)))}finally{if(c)throw c.error}}for(let E of g.flush())yield yield q(E)})}function r(){return qe(this,arguments,function*(){var l,c,d,p;if(i)throw new re("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var m=!0,v=ze(o()),A;A=yield q(v.next()),l=A.done,!l;m=!0){p=A.value,m=!1;let T=p;g||T&&(yield yield q(JSON.parse(T)))}}catch(T){c={error:T}}finally{try{!m&&!l&&(d=v.return)&&(yield q(d.call(v)))}finally{if(c)throw c.error}}g=!0}catch(T){if(qg(T))return yield q(void 0);throw T}finally{g||e.abort()}})}return new s(r,e,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let t=[],e=[],n=this.iterator(),i=o=>({next:()=>{if(o.length===0){let r=n.next();t.push(r),e.push(r)}return o.shift()}});return[new s(()=>i(t),this.controller,this.client),new s(()=>i(e),this.controller,this.client)]}toReadableStream(){let t=this,e;return nw({async start(){e=t[Symbol.asyncIterator]()},async pull(n){try{let{value:i,done:o}=await e.next();if(o)return n.close();let r=cm(JSON.stringify(i)+`
`);n.enqueue(r)}catch(i){n.error(i)}},async cancel(){var n;await((n=e.return)===null||n===void 0?void 0:n.call(e))}})}};function II(s,t){return qe(this,arguments,function*(){var n,i,o,r;if(!s.body)throw t.abort(),typeof globalThis.navigator!="undefined"&&globalThis.navigator.product==="ReactNative"?new re("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new re("Attempted to iterate over a response with no body");let a=new Jg,l=new Yo,c=iw(s.body);try{for(var d=!0,p=ze(RI(c)),g;g=yield q(p.next()),n=g.done,!n;d=!0){r=g.value,d=!1;let m=r;for(let v of l.decode(m)){let A=a.decode(v);A&&(yield yield q(A))}}}catch(m){i={error:m}}finally{try{!d&&!n&&(o=p.return)&&(yield q(o.call(p)))}finally{if(i)throw i.error}}for(let m of l.flush()){let v=a.decode(m);v&&(yield yield q(v))}})}function RI(s){return qe(this,arguments,function*(){var e,n,i,o;let r=new Uint8Array;try{for(var a=!0,l=ze(s),c;c=yield q(l.next()),e=c.done,!e;a=!0){o=c.value,a=!1;let d=o;if(d==null)continue;let p=d instanceof ArrayBuffer?new Uint8Array(d):typeof d=="string"?cm(d):d,g=new Uint8Array(r.length+p.length);g.set(r),g.set(p,r.length),r=g;let m;for(;(m=bI(r))!==-1;)yield yield q(r.slice(0,m)),r=r.slice(m)}}catch(d){n={error:d}}finally{try{!a&&!e&&(i=l.return)&&(yield q(i.call(l)))}finally{if(n)throw n.error}}r.length>0&&(yield yield q(r))})}var Jg=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;let o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(t),t.startsWith(":"))return null;let[e,n,i]=PI(t,":");return i.startsWith(" ")&&(i=i.substring(1)),e==="event"?this.event=i:e==="data"&&this.data.push(i),null}};function PI(s,t){let e=s.indexOf(t);return e!==-1?[s.substring(0,e),t,s.substring(e+t.length)]:[s,"",""]}async function MI(s,t){let{response:e,requestLogID:n,retryOfRequestLogID:i,startTime:o}=t,r=await(async()=>{var a;if(t.options.stream)return te(s).debug("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller,s):Yg.fromSSEResponse(e,t.controller,s);if(e.status===204)return null;if(t.options.__binaryResponse)return e;let l=e.headers.get("content-type"),c=(a=l==null?void 0:l.split(";")[0])===null||a===void 0?void 0:a.trim();return(c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))?await e.json():await e.text()})();return te(s).debug(`[${n}] response parsed`,cs({retryOfRequestLogID:i,url:e.url,status:e.status,body:r,durationMs:Date.now()-o})),r}var Xg=class s extends Promise{constructor(t,e,n=MI){super(i=>{i(null)}),this.responsePromise=e,this.parseResponse=n,this.client=t}_thenUnwrap(t){return new s(this.client,this.responsePromise,async(e,n)=>t(await this.parseResponse(e,n),n))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){let[t,e]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:e}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(this.client,t))),this.parsedPromise}then(t,e){return this.parse().then(t,e)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}};var aw=Symbol("brand.privateNullableHeaders");function*NI(s){if(!s)return;if(aw in s){let{values:n,nulls:i}=s;yield*n.entries();for(let o of i)yield[o,null];return}let t=!1,e;s instanceof Headers?e=s.entries():TA(s)?e=s:(t=!0,e=Object.entries(s!=null?s:{}));for(let n of e){let i=n[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");let o=TA(n[1])?n[1]:[n[1]],r=!1;for(let a of o)a!==void 0&&(t&&!r&&(r=!0,yield[i,null]),yield[i,a])}}var za=s=>{let t=new Headers,e=new Set;for(let n of s){let i=new Set;for(let[o,r]of NI(n)){let a=o.toLowerCase();i.has(a)||(t.delete(o),i.add(a)),r===null?(t.delete(o),e.add(a)):(t.append(o,r),e.delete(a))}}return{[aw]:!0,values:t,nulls:e}};var og=s=>{var t,e,n,i,o,r;if(typeof globalThis.process!="undefined")return(n=(e=(t=globalThis.process.env)===null||t===void 0?void 0:t[s])===null||e===void 0?void 0:e.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno!="undefined")return(r=(o=(i=globalThis.Deno.env)===null||i===void 0?void 0:i.get)===null||o===void 0?void 0:o.call(i,s))===null||r===void 0?void 0:r.trim()};var lw,Pd=class s{constructor(t){var e,n,i,o,r,a,l,{baseURL:c=og("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:d=(e=og("GEMINI_API_KEY"))!==null&&e!==void 0?e:null,apiVersion:p="v1beta"}=t,g=gd(t,["baseURL","apiKey","apiVersion"]);let m=Object.assign(Object.assign({apiKey:d,apiVersion:p},g),{baseURL:c||"https://generativelanguage.googleapis.com"});this.baseURL=m.baseURL,this.timeout=(n=m.timeout)!==null&&n!==void 0?n:s.DEFAULT_TIMEOUT,this.logger=(i=m.logger)!==null&&i!==void 0?i:console;let v="warn";this.logLevel=v,this.logLevel=(r=(o=xA(m.logLevel,"ClientOptions.logLevel",this))!==null&&o!==void 0?o:xA(og("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&r!==void 0?r:v,this.fetchOptions=m.fetchOptions,this.maxRetries=(a=m.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(l=m.fetch)!==null&&l!==void 0?l:fI(),this.encoder=mI,this._options=m,this.apiKey=d,this.apiVersion=p,this.clientAdapter=m.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:e}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!e.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){let e=za([t.headers]);if(!(e.values.has("authorization")||e.values.has("x-goog-api-key"))){if(this.apiKey)return za([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return za([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([e,n])=>typeof n!="undefined").map(([e,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(e)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(e)}=`;throw new re(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Vo}`}defaultIdempotencyKey(){return`stainless-node-retry-${jx()}`}makeStatusError(t,e,n,i){return ae.generate(t,e,n,i)}buildURL(t,e,n){let i=!this.baseURLOverridden()&&n||this.baseURL,o=eI(t)?new URL(t):new URL(i+(i.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),r=this.defaultQuery();return sI(r)||(e=Object.assign(Object.assign({},r),e)),typeof e=="object"&&e&&!Array.isArray(e)&&(o.search=this.stringifyQuery(e)),o.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){let e=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${e}`}}async prepareRequest(t,{url:e,options:n}){}get(t,e){return this.methodRequest("get",t,e)}post(t,e){return this.methodRequest("post",t,e)}patch(t,e){return this.methodRequest("patch",t,e)}put(t,e){return this.methodRequest("put",t,e)}delete(t,e){return this.methodRequest("delete",t,e)}methodRequest(t,e,n){return this.request(Promise.resolve(n).then(i=>Object.assign({method:t,path:e},i)))}request(t,e=null){return new Xg(this,this.makeRequest(t,e,void 0))}async makeRequest(t,e,n){var i,o,r;let a=await t,l=(i=a.maxRetries)!==null&&i!==void 0?i:this.maxRetries;e==null&&(e=l),await this.prepareOptions(a);let{req:c,url:d,timeout:p}=await this.buildRequest(a,{retryCount:l-e});await this.prepareRequest(c,{url:d,options:a});let g="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),m=n===void 0?"":`, retryOf: ${n}`,v=Date.now();if(te(this).debug(`[${g}] sending request`,cs({retryOfRequestLogID:n,method:a.method,url:d,options:a,headers:c.headers})),!((o=a.signal)===null||o===void 0)&&o.aborted)throw new Ya;let A=new AbortController,T=await this.fetchWithTimeout(d,c,p,A).catch(zg),E=Date.now();if(T instanceof globalThis.Error){let S=`retrying, ${e} attempts remaining`;if(!((r=a.signal)===null||r===void 0)&&r.aborted)throw new Ya;let b=qg(T)||/timed? ?out/i.test(String(T)+("cause"in T?String(T.cause):""));if(e)return te(this).info(`[${g}] connection ${b?"timed out":"failed"} - ${S}`),te(this).debug(`[${g}] connection ${b?"timed out":"failed"} (${S})`,cs({retryOfRequestLogID:n,url:d,durationMs:E-v,message:T.message})),this.retryRequest(a,e,n!=null?n:g);throw te(this).info(`[${g}] connection ${b?"timed out":"failed"} - error; no more retries left`),te(this).debug(`[${g}] connection ${b?"timed out":"failed"} (error; no more retries left)`,cs({retryOfRequestLogID:n,url:d,durationMs:E-v,message:T.message})),b?new yd:new Ko({cause:T})}let C=`[${g}${m}] ${c.method} ${d} ${T.ok?"succeeded":"failed"} with status ${T.status} in ${E-v}ms`;if(!T.ok){let S=await this.shouldRetry(T);if(e&&S){let M=`retrying, ${e} attempts remaining`;return await gI(T.body),te(this).info(`${C} - ${M}`),te(this).debug(`[${g}] response error (${M})`,cs({retryOfRequestLogID:n,url:T.url,status:T.status,headers:T.headers,durationMs:E-v})),this.retryRequest(a,e,n!=null?n:g,T.headers)}let b=S?"error; no more retries left":"error; not retryable";te(this).info(`${C} - ${b}`);let x=await T.text().catch(M=>zg(M).message),R=aI(x),I=R?void 0:x;throw te(this).debug(`[${g}] response error (${b})`,cs({retryOfRequestLogID:n,url:T.url,status:T.status,headers:T.headers,message:I,durationMs:Date.now()-v})),this.makeStatusError(T.status,R,I,T.headers)}return te(this).info(C),te(this).debug(`[${g}] response start`,cs({retryOfRequestLogID:n,url:T.url,status:T.status,headers:T.headers,durationMs:E-v})),{response:T,options:a,controller:A,requestLogID:g,retryOfRequestLogID:n,startTime:v}}async fetchWithTimeout(t,e,n,i){let o=e||{},{signal:r,method:a}=o,l=gd(o,["signal","method"]);r&&r.addEventListener("abort",()=>i.abort());let c=setTimeout(()=>i.abort(),n),d=globalThis.ReadableStream&&l.body instanceof globalThis.ReadableStream||typeof l.body=="object"&&l.body!==null&&Symbol.asyncIterator in l.body,p=Object.assign(Object.assign(Object.assign({signal:i.signal},d?{duplex:"half"}:{}),{method:"GET"}),l);a&&(p.method=a.toUpperCase());try{return await this.fetch.call(void 0,t,p)}finally{clearTimeout(c)}}async shouldRetry(t){let e=t.headers.get("x-should-retry");return e==="true"?!0:e==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,e,n,i){var o;let r,a=i==null?void 0:i.get("retry-after-ms");if(a){let c=parseFloat(a);Number.isNaN(c)||(r=c)}let l=i==null?void 0:i.get("retry-after");if(l&&!r){let c=parseFloat(l);Number.isNaN(c)?r=Date.parse(l)-Date.now():r=c*1e3}if(!(r&&0<=r&&r<60*1e3)){let c=(o=t.maxRetries)!==null&&o!==void 0?o:this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(e,c)}return await lI(r),this.makeRequest(t,e-1,n)}calculateDefaultRetryTimeoutMillis(t,e){let o=e-t,r=Math.min(.5*Math.pow(2,o),8),a=1-Math.random()*.25;return r*a*1e3}async buildRequest(t,{retryCount:e=0}={}){var n,i,o;let r=Object.assign({},t),{method:a,path:l,query:c,defaultBaseURL:d}=r,p=this.buildURL(l,c,d);"timeout"in r&&rI("timeout",r.timeout),r.timeout=(n=r.timeout)!==null&&n!==void 0?n:this.timeout;let{bodyHeaders:g,body:m}=this.buildBody({options:r}),v=await this.buildHeaders({options:t,method:a,bodyHeaders:g,retryCount:e});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:v},r.signal&&{signal:r.signal}),globalThis.ReadableStream&&m instanceof globalThis.ReadableStream&&{duplex:"half"}),m&&{body:m}),(i=this.fetchOptions)!==null&&i!==void 0?i:{}),(o=r.fetchOptions)!==null&&o!==void 0?o:{}),url:p,timeout:r.timeout}}async buildHeaders({options:t,method:e,bodyHeaders:n,retryCount:i}){let o={};this.idempotencyHeader&&e!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=t.idempotencyKey);let r=await this.authHeaders(t),a=za([o,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),hI()),this._options.defaultHeaders,n,t.headers,r]);return this.validateHeaders(a),a.values}buildBody({options:{body:t,headers:e}}){if(!t)return{bodyHeaders:void 0,body:void 0};let n=za([e]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&n.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:pI(t)}:this.encoder({body:t,headers:n})}};Pd.DEFAULT_TIMEOUT=6e4;var _t=class extends Pd{constructor(){super(...arguments),this.interactions=new Id(this)}};lw=_t;_t.GeminiNextGenAPIClient=lw;_t.GeminiNextGenAPIClientError=re;_t.APIError=ae;_t.APIConnectionError=Ko;_t.APIConnectionTimeoutError=yd;_t.APIUserAbortError=Ya;_t.NotFoundError=wd;_t.ConflictError=Td;_t.RateLimitError=Cd;_t.BadRequestError=vd;_t.AuthenticationError=_d;_t.InternalServerError=Sd;_t.PermissionDeniedError=Ad;_t.UnprocessableEntityError=Ed;_t.toFile=wI;_t.Interactions=Id;function kI(s,t){let e={},n=h(s,["name"]);return n!=null&&f(e,["_url","name"],n),e}function DI(s,t){let e={},n=h(s,["name"]);return n!=null&&f(e,["_url","name"],n),e}function FI(s,t){let e={},n=h(s,["sdkHttpResponse"]);return n!=null&&f(e,["sdkHttpResponse"],n),e}function LI(s,t){let e={},n=h(s,["sdkHttpResponse"]);return n!=null&&f(e,["sdkHttpResponse"],n),e}function UI(s,t,e){let n={};if(h(s,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let i=h(s,["tunedModelDisplayName"]);if(t!==void 0&&i!=null&&f(t,["displayName"],i),h(s,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let o=h(s,["epochCount"]);t!==void 0&&o!=null&&f(t,["tuningTask","hyperparameters","epochCount"],o);let r=h(s,["learningRateMultiplier"]);if(r!=null&&f(n,["tuningTask","hyperparameters","learningRateMultiplier"],r),h(s,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(h(s,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(h(s,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let a=h(s,["batchSize"]);t!==void 0&&a!=null&&f(t,["tuningTask","hyperparameters","batchSize"],a);let l=h(s,["learningRate"]);if(t!==void 0&&l!=null&&f(t,["tuningTask","hyperparameters","learningRate"],l),h(s,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(h(s,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function OI(s,t,e){let n={},i=h(e,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let m=h(s,["validationDataset"]);t!==void 0&&m!=null&&f(t,["supervisedTuningSpec"],RA(m))}else if(i==="PREFERENCE_TUNING"){let m=h(s,["validationDataset"]);t!==void 0&&m!=null&&f(t,["preferenceOptimizationSpec"],RA(m))}let o=h(s,["tunedModelDisplayName"]);t!==void 0&&o!=null&&f(t,["tunedModelDisplayName"],o);let r=h(s,["description"]);t!==void 0&&r!=null&&f(t,["description"],r);let a=h(e,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){let m=h(s,["epochCount"]);t!==void 0&&m!=null&&f(t,["supervisedTuningSpec","hyperParameters","epochCount"],m)}else if(a==="PREFERENCE_TUNING"){let m=h(s,["epochCount"]);t!==void 0&&m!=null&&f(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],m)}let l=h(e,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){let m=h(s,["learningRateMultiplier"]);t!==void 0&&m!=null&&f(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],m)}else if(l==="PREFERENCE_TUNING"){let m=h(s,["learningRateMultiplier"]);t!==void 0&&m!=null&&f(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],m)}let c=h(e,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){let m=h(s,["exportLastCheckpointOnly"]);t!==void 0&&m!=null&&f(t,["supervisedTuningSpec","exportLastCheckpointOnly"],m)}else if(c==="PREFERENCE_TUNING"){let m=h(s,["exportLastCheckpointOnly"]);t!==void 0&&m!=null&&f(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],m)}let d=h(e,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){let m=h(s,["adapterSize"]);t!==void 0&&m!=null&&f(t,["supervisedTuningSpec","hyperParameters","adapterSize"],m)}else if(d==="PREFERENCE_TUNING"){let m=h(s,["adapterSize"]);t!==void 0&&m!=null&&f(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],m)}if(h(s,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(h(s,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let p=h(s,["labels"]);t!==void 0&&p!=null&&f(t,["labels"],p);let g=h(s,["beta"]);return t!==void 0&&g!=null&&f(t,["preferenceOptimizationSpec","hyperParameters","beta"],g),n}function $I(s,t){let e={},n=h(s,["baseModel"]);n!=null&&f(e,["baseModel"],n);let i=h(s,["preTunedModel"]);i!=null&&f(e,["preTunedModel"],i);let o=h(s,["trainingDataset"]);o!=null&&XI(o);let r=h(s,["config"]);return r!=null&&UI(r,e),e}function GI(s,t){let e={},n=h(s,["baseModel"]);n!=null&&f(e,["baseModel"],n);let i=h(s,["preTunedModel"]);i!=null&&f(e,["preTunedModel"],i);let o=h(s,["trainingDataset"]);o!=null&&ZI(o,e,t);let r=h(s,["config"]);return r!=null&&OI(r,e,t),e}function BI(s,t){let e={},n=h(s,["name"]);return n!=null&&f(e,["_url","name"],n),e}function HI(s,t){let e={},n=h(s,["name"]);return n!=null&&f(e,["_url","name"],n),e}function VI(s,t,e){let n={},i=h(s,["pageSize"]);t!==void 0&&i!=null&&f(t,["_query","pageSize"],i);let o=h(s,["pageToken"]);t!==void 0&&o!=null&&f(t,["_query","pageToken"],o);let r=h(s,["filter"]);return t!==void 0&&r!=null&&f(t,["_query","filter"],r),n}function qI(s,t,e){let n={},i=h(s,["pageSize"]);t!==void 0&&i!=null&&f(t,["_query","pageSize"],i);let o=h(s,["pageToken"]);t!==void 0&&o!=null&&f(t,["_query","pageToken"],o);let r=h(s,["filter"]);return t!==void 0&&r!=null&&f(t,["_query","filter"],r),n}function zI(s,t){let e={},n=h(s,["config"]);return n!=null&&VI(n,e),e}function WI(s,t){let e={},n=h(s,["config"]);return n!=null&&qI(n,e),e}function KI(s,t){let e={},n=h(s,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);let i=h(s,["nextPageToken"]);i!=null&&f(e,["nextPageToken"],i);let o=h(s,["tunedModels"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>cw(a))),f(e,["tuningJobs"],r)}return e}function YI(s,t){let e={},n=h(s,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);let i=h(s,["nextPageToken"]);i!=null&&f(e,["nextPageToken"],i);let o=h(s,["tuningJobs"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>Zg(a))),f(e,["tuningJobs"],r)}return e}function JI(s,t){let e={},n=h(s,["name"]);n!=null&&f(e,["model"],n);let i=h(s,["name"]);return i!=null&&f(e,["endpoint"],i),e}function XI(s,t){let e={};if(h(s,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(h(s,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=h(s,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>o)),f(e,["examples","examples"],i)}return e}function ZI(s,t,e){let n={},i=h(e,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let r=h(s,["gcsUri"]);t!==void 0&&r!=null&&f(t,["supervisedTuningSpec","trainingDatasetUri"],r)}else if(i==="PREFERENCE_TUNING"){let r=h(s,["gcsUri"]);t!==void 0&&r!=null&&f(t,["preferenceOptimizationSpec","trainingDatasetUri"],r)}let o=h(e,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let r=h(s,["vertexDatasetResource"]);t!==void 0&&r!=null&&f(t,["supervisedTuningSpec","trainingDatasetUri"],r)}else if(o==="PREFERENCE_TUNING"){let r=h(s,["vertexDatasetResource"]);t!==void 0&&r!=null&&f(t,["preferenceOptimizationSpec","trainingDatasetUri"],r)}if(h(s,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function cw(s,t){let e={},n=h(s,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);let i=h(s,["name"]);i!=null&&f(e,["name"],i);let o=h(s,["state"]);o!=null&&f(e,["state"],UA(o));let r=h(s,["createTime"]);r!=null&&f(e,["createTime"],r);let a=h(s,["tuningTask","startTime"]);a!=null&&f(e,["startTime"],a);let l=h(s,["tuningTask","completeTime"]);l!=null&&f(e,["endTime"],l);let c=h(s,["updateTime"]);c!=null&&f(e,["updateTime"],c);let d=h(s,["description"]);d!=null&&f(e,["description"],d);let p=h(s,["baseModel"]);p!=null&&f(e,["baseModel"],p);let g=h(s,["_self"]);return g!=null&&f(e,["tunedModel"],JI(g)),e}function Zg(s,t){let e={},n=h(s,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);let i=h(s,["name"]);i!=null&&f(e,["name"],i);let o=h(s,["state"]);o!=null&&f(e,["state"],UA(o));let r=h(s,["createTime"]);r!=null&&f(e,["createTime"],r);let a=h(s,["startTime"]);a!=null&&f(e,["startTime"],a);let l=h(s,["endTime"]);l!=null&&f(e,["endTime"],l);let c=h(s,["updateTime"]);c!=null&&f(e,["updateTime"],c);let d=h(s,["error"]);d!=null&&f(e,["error"],d);let p=h(s,["description"]);p!=null&&f(e,["description"],p);let g=h(s,["baseModel"]);g!=null&&f(e,["baseModel"],g);let m=h(s,["tunedModel"]);m!=null&&f(e,["tunedModel"],m);let v=h(s,["preTunedModel"]);v!=null&&f(e,["preTunedModel"],v);let A=h(s,["supervisedTuningSpec"]);A!=null&&f(e,["supervisedTuningSpec"],A);let T=h(s,["preferenceOptimizationSpec"]);T!=null&&f(e,["preferenceOptimizationSpec"],T);let E=h(s,["tuningDataStats"]);E!=null&&f(e,["tuningDataStats"],E);let C=h(s,["encryptionSpec"]);C!=null&&f(e,["encryptionSpec"],C);let S=h(s,["partnerModelTuningSpec"]);S!=null&&f(e,["partnerModelTuningSpec"],S);let b=h(s,["customBaseModel"]);b!=null&&f(e,["customBaseModel"],b);let x=h(s,["experiment"]);x!=null&&f(e,["experiment"],x);let R=h(s,["labels"]);R!=null&&f(e,["labels"],R);let I=h(s,["outputUri"]);I!=null&&f(e,["outputUri"],I);let N=h(s,["pipelineJob"]);N!=null&&f(e,["pipelineJob"],N);let M=h(s,["serviceAccount"]);M!=null&&f(e,["serviceAccount"],M);let F=h(s,["tunedModelDisplayName"]);F!=null&&f(e,["tunedModelDisplayName"],F);let U=h(s,["veoTuningSpec"]);return U!=null&&f(e,["veoTuningSpec"],U),e}function QI(s,t){let e={},n=h(s,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);let i=h(s,["name"]);i!=null&&f(e,["name"],i);let o=h(s,["metadata"]);o!=null&&f(e,["metadata"],o);let r=h(s,["done"]);r!=null&&f(e,["done"],r);let a=h(s,["error"]);return a!=null&&f(e,["error"],a),e}function RA(s,t){let e={},n=h(s,["gcsUri"]);n!=null&&f(e,["validationDatasetUri"],n);let i=h(s,["vertexDatasetResource"]);return i!=null&&f(e,["validationDatasetUri"],i),e}var Qg=class extends We{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new On(Un.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(e),e),this.get=async e=>await this.getInternal(e),this.tune=async e=>{var n;if(this.apiClient.isVertexAI())if(e.baseModel.startsWith("projects/")){let i={tunedModelName:e.baseModel};!((n=e.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(i.checkpointId=e.config.preTunedModelCheckpointId);let o=Object.assign(Object.assign({},e),{preTunedModel:i});return o.baseModel=void 0,await this.tuneInternal(o)}else{let i=Object.assign({},e);return await this.tuneInternal(i)}else{let i=Object.assign({},e),o=await this.tuneMldevInternal(i),r="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?r=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(r=o.name.split("/operations/")[0]),{name:r,state:ag.JOB_STATE_QUEUED}}}}async getInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=HI(t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>Zg(d))}else{let c=BI(t);return a=D("{name}",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>cw(d))}}async listInternal(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=WI(t);return a=D("tuningJobs",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=YI(d),g=new cd;return Object.assign(g,p),g})}else{let c=zI(t);return a=D("tunedModels",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=KI(d),g=new cd;return Object.assign(g,p),g})}}async cancel(t){var e,n,i,o;let r,a="",l={};if(this.apiClient.isVertexAI()){let c=DI(t);return a=D("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=LI(d),g=new ud;return Object.assign(g,p),g})}else{let c=kI(t);return a=D("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:d.headers},g})),r.then(d=>{let p=FI(d),g=new ud;return Object.assign(g,p),g})}}async tuneInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI()){let a=GI(t,t);return o=D("tuningJobs",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>Zg(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var e,n;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=$I(t);return o=D("tunedModels",a._url),r=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),i.then(l=>QI(l))}}};var jg=class{async download(t,e){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},jI=1024*1024*8,tR=3,eR=1e3,nR=2,Md="x-goog-upload-status";async function iR(s,t,e){var n;let i=await uw(s,t,e),o=await(i==null?void 0:i.json());if(((n=i==null?void 0:i.headers)===null||n===void 0?void 0:n[Md])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function sR(s,t,e){var n;let i=await uw(s,t,e),o=await(i==null?void 0:i.json());if(((n=i==null?void 0:i.headers)===null||n===void 0?void 0:n[Md])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let r=MA(o),a=new Tg;return Object.assign(a,r),a}async function uw(s,t,e){var n,i;let o=0,r=0,a=new Ka(new Response),l="upload";for(o=s.size;r<o;){let c=Math.min(jI,o-r),d=s.slice(r,r+c);r+c>=o&&(l+=", finalize");let p=0,g=eR;for(;p<tR&&(a=await e.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(r),"Content-Length":String(c)}}}),!(!((n=a==null?void 0:a.headers)===null||n===void 0)&&n[Md]));)p++,await rR(g),g=g*nR;if(r+=c,((i=a==null?void 0:a.headers)===null||i===void 0?void 0:i[Md])!=="active")break;if(o<=r)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function oR(s){return{size:s.size,type:s.type}}function rR(s){return new Promise(t=>setTimeout(t,s))}var tm=class{async upload(t,e,n){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await iR(t,e,n)}async uploadToFileSearchStore(t,e,n){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await sR(t,e,n)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await oR(t)}};var em=class{create(t,e,n){return new nm(t,e,n)}},nm=class{constructor(t,e,n){this.url=t,this.headers=e,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var PA="x-goog-api-key",im=class{constructor(t){this.apiKey=t}async addAuthHeaders(t,e){if(t.get(PA)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");t.append(PA,this.apiKey)}}};var aR="gl-node/",Nd=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let t=this.httpOptions;t!=null&&t.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let e=new _t({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:t==null?void 0:t.timeout});return this._interactions=e.interactions,this._interactions}constructor(t){var e;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(e=t.vertexai)!==null&&e!==void 0?e:!1,this.apiKey=t.apiKey;let n=UE(t.httpOptions,t.vertexai,void 0,void 0);n&&(t.httpOptions?t.httpOptions.baseUrl=n:t.httpOptions={baseUrl:n}),this.apiVersion=t.apiVersion,this.httpOptions=t.httpOptions;let i=new im(this.apiKey);this.apiClient=new kg({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:aR+"web",uploader:new tm,downloader:new jg}),this.models=new $g(this.apiClient),this.live=new Ug(this.apiClient,i,new em),this.batches=new Sg(this.apiClient),this.chats=new xg(this.models,this.apiClient),this.caches=new bg(this.apiClient),this.files=new Rg(this.apiClient),this.operations=new Gg(this.apiClient),this.authTokens=new Bg(this.apiClient),this.tunings=new Qg(this.apiClient),this.fileSearchStores=new Vg(this.apiClient)}};var dw=`\uB108\uB294 \uB098\uC758 \uAC1C\uC778 \uC9C0\uC2DD\uAD00\uB9AC \uC2DC\uC2A4\uD15C\uC5D0\uC11C \uB178\uD2B8\uB97C \uD504\uB85C\uC81D\uD2B8\uBCC4\uB85C \uBD84\uB958\uD558\uB294 \uBE44\uC11C\uB2E4.
\uC544\uB798 \uB178\uD2B8 \uB0B4\uC6A9\uC744 \uC77D\uACE0 \uC5B4\uB5A4 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC18D\uD558\uB294\uC9C0 **\uC2E0\uC911\uD558\uAC8C** \uD310\uB2E8\uD574\uB77C.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uBD84\uB958 \uADDC\uCE59 (\uC911\uC694\uB3C4 \uC21C)

### 1. \uD504\uB85C\uC81D\uD2B8 \uC0B0\uCD9C\uBB3C (contentType: "artifact")
\uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC9C1\uC811 \uC800\uC7A5\uD574\uC57C \uD560 \uAC83:
- \uC9C1\uC811 \uC791\uC131\uD55C \uBB38\uC11C, \uACC4\uD68D\uC11C, \uD68C\uC758\uB85D
- \uD504\uB85C\uC81D\uD2B8\uB97C \uC704\uD574 \uB9CC\uB4E0 \uCF54\uB4DC, \uC124\uACC4\uC11C
- \uD504\uB85C\uC81D\uD2B8 \uC9C4\uD589 \uAD00\uB828 \uBA54\uBAA8

### 2. \uD504\uB85C\uC81D\uD2B8 \uCC38\uACE0\uC790\uB8CC (contentType: "reference")
Library\uC5D0 \uC800\uC7A5\uD558\uB418 \uD504\uB85C\uC81D\uD2B8\uC640 \uB9C1\uD06C\uD574\uC57C \uD560 \uAC83:
- \uC678\uBD80 \uD29C\uD1A0\uB9AC\uC5BC, \uC608\uC81C \uCF54\uB4DC, \uBB38\uC11C
- \uC6F9\uD398\uC774\uC9C0 \uC2A4\uD06C\uB7A9, \uC544\uD2F0\uD074
- \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uC790\uB8CC
- \uC608: "ESP32 \uC608\uC81C" \u2192 \uD30C\uCE20\uD31C\uC5D0 \uC720\uC6A9\uD558\uC9C0\uB9CC Library\uC5D0 \uC800\uC7A5

### 3. \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC (targetType: "library", contentType: "general")
- \uD2B9\uC815 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828 \uC5C6\uB294 \uC77C\uBC18 \uC815\uBCF4
- \uB274\uC2A4, \uACF5\uACE0, \uC77C\uBC18 \uC544\uD2F0\uD074

### 4. archive
- \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83

## \uD310\uB2E8 \uAE30\uC900
- "\uC774\uAC74 \uB0B4\uAC00 \uC9C1\uC811 \uB9CC\uB4E0 \uC0B0\uCD9C\uBB3C\uC778\uAC00?" \u2192 artifact
- "\uC774\uAC74 \uC678\uBD80 \uC790\uB8CC\uC778\uB370 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC720\uC6A9\uD55C\uAC00?" \u2192 reference
- "\uC774\uAC74 \uADF8\uB0E5 \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC\uC778\uAC00?" \u2192 general
- "\uD504\uB85C\uC81D\uD2B8 \uB05D\uB098\uB3C4 \uACC4\uC18D \uCC38\uACE0\uD560 \uC790\uB8CC\uC778\uAC00?" \u2192 reference (Library)

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "targetType": "project \uB610\uB294 library \uB610\uB294 archive",
  "contentType": "artifact \uB610\uB294 reference \uB610\uB294 general",
  "projectName": "\uD504\uB85C\uC81D\uD2B8\uBA85 (project \uB610\uB294 reference\uC77C \uB54C)",
  "isNewProject": true/false,
  "confidence": "high \uB610\uB294 medium \uB610\uB294 low",
  "reason": "\uC774 \uBD84\uB958\uB97C \uC120\uD0DD\uD55C \uC774\uC720 (1\uC904)",
  "title": "\uB178\uD2B8 \uC81C\uBAA9",
  "summary": "2-3\uBB38\uC7A5 \uC694\uC57D",
  "nextAction": "\uB2E4\uC74C \uD589\uB3D9 \uB610\uB294 null"
}
`,hw=`\uB108\uB294 \uC81C\uD154\uCE74\uC2A4\uD150(Zettelkasten) \uBC29\uC2DD\uC758 \uC601\uAD6C \uB178\uD2B8\uB97C \uB9CC\uB4DC\uB294 \uBE44\uC11C\uB2E4.
\uC544\uB798 \uB178\uD2B8\uC5D0\uC11C \uC81C\uD154\uCE74\uC2A4\uD150\uC6A9 \uC601\uAD6C \uB178\uD2B8 \uD6C4\uBCF4 \uC544\uC774\uB514\uC5B4\uB4E4\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uD55C \uB178\uD2B8\uC5D0\uB294 \uD558\uB098\uC758 \uC544\uC774\uB514\uC5B4\uB9CC \uB2F4\uB294\uB2E4 (atomic note)
- \uAC01 \uC544\uC774\uB514\uC5B4\uB294 3-5\uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD55C\uB2E4
- \uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C
- \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC5F0\uACB0\uB420 \uC218 \uC788\uB294 \uAC1C\uB150 2-3\uAC1C\uB97C \uC81C\uC548\uD574\uB77C
- \uC544\uC774\uB514\uC5B4\uB9C8\uB2E4 \uC5F0\uAD00 \uD0A4\uC6CC\uB4DC\uB97C \uD568\uAED8 \uC801\uC5B4\uB77C

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uC544\uC774\uB514\uC5B4\uB97C \uD55C \uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD558\uB294 \uC81C\uBAA9",
    "body": "3-5\uBB38\uC7A5\uC758 \uC124\uBA85",
    "importance": "\uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uAC00? (1\uC904)",
    "relatedConcepts": ["\uAC1C\uB1501", "\uAC1C\uB1502", "\uAC1C\uB1503"],
    "keywords": ["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3"]
  }
]

\uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uC744 \uBC18\uD658\uD574\uB77C.
`,fw=`\uB108\uB294 \uB098\uC758 \uC791\uC5C5 \uC6B0\uC120\uC21C\uC704 \uCF54\uCE58\uB2E4.
\uC544\uB798 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D\uC744 \uBCF4\uACE0, \uC9C0\uAE08 \uB0B4\uAC00 \uC9D1\uC911\uD574\uC57C \uD560 \uC0C1\uC704 3\uAC1C\uB9CC \uACE8\uB77C\uB77C.

## \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uAC01 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uB300\uD574 \uB2E4\uC74C\uC744 \uC81C\uACF5\uD574\uB77C
- title: \uD504\uB85C\uC81D\uD2B8 \uC774\uB984
- why: \uC65C \uC9C0\uAE08 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904 \uC124\uBA85
- next_action: \uC624\uB298 \uB2F9\uC7A5 \uD560 \uC218 \uC788\uB294 \uAC00\uC7A5 \uC791\uC740 \uB2E4\uC74C \uD589\uB3D9

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uD504\uB85C\uC81D\uD2B8 \uC774\uB984",
    "why": "\uC911\uC694\uD55C \uC774\uC720",
    "next_action": "\uB2E4\uC74C \uD589\uB3D9"
  }
]
`,pw=`\uC774 \uC774\uBBF8\uC9C0\uC5D0\uC11C \uD14D\uC2A4\uD2B8\uB97C \uCD94\uCD9C\uD574\uB77C.
\uC190\uAE00\uC528, \uC778\uC1C4\uBB3C, \uC2A4\uCE94 \uBB38\uC11C \uB4F1 \uBAA8\uB4E0 \uD615\uD0DC\uC758 \uD14D\uC2A4\uD2B8\uB97C \uC77D\uC5B4\uB77C.

## \uADDC\uCE59
- \uC774\uBBF8\uC9C0\uC5D0 \uBCF4\uC774\uB294 \uBAA8\uB4E0 \uD14D\uC2A4\uD2B8\uB97C \uADF8\uB300\uB85C \uCD94\uCD9C
- \uC6D0\uBCF8\uC758 \uC904\uBC14\uAFC8\uACFC \uAD6C\uC870\uB97C \uCD5C\uB300\uD55C \uC720\uC9C0
- \uD45C\uAC00 \uC788\uC73C\uBA74 \uB9C8\uD06C\uB2E4\uC6B4 \uD45C\uB85C \uBCC0\uD658
- \uC77D\uC744 \uC218 \uC5C6\uB294 \uBD80\uBD84\uC740 [\uBD88\uBA85\uD655] \uC73C\uB85C \uD45C\uC2DC
- \uD14D\uC2A4\uD2B8\uB9CC \uCD9C\uB825\uD558\uACE0 \uB2E4\uB978 \uC124\uBA85\uC740 \uD558\uC9C0 \uB9C8\uB77C
`,gw=`\uB178\uD2B8 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD575\uC2EC \uD0A4\uC6CC\uB4DC 5-10\uAC1C\uB97C \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uAE30\uC220 \uC6A9\uC5B4, \uD504\uB85C\uC81D\uD2B8\uBA85, \uC8FC\uC694 \uAC1C\uB150 \uC704\uC8FC\uB85C \uCD94\uCD9C
- \uB108\uBB34 \uC77C\uBC18\uC801\uC778 \uB2E8\uC5B4 (\uC608: \uBC29\uBC95, \uB0B4\uC6A9, \uC815\uBCF4)\uB294 \uC81C\uC678
- \uD55C\uAE00/\uC601\uC5B4 \uBAA8\uB450 \uAC00\uB2A5
- \uBCF5\uD569 \uBA85\uC0AC\uB294 \uBD84\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C (\uC608: "\uC2A4\uB9C8\uD2B8\uD31C", "API\uD0A4")

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3", ...]
`,mw=`\uC0C8 \uB178\uD2B8\uC640 \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4\uC758 \uAD00\uB828\uC131\uC744 \uBD84\uC11D\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {newTitle}
\uD0A4\uC6CC\uB4DC: {newKeywords}

## \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4
{candidates}

## \uADDC\uCE59
- \uAC01 \uD6C4\uBCF4 \uB178\uD2B8\uC5D0 \uB300\uD574 \uAD00\uB828\uB3C4 \uC810\uC218(0.0~1.0)\uB97C \uB9E4\uACA8\uB77C
- 0.5 \uC774\uC0C1\uC778 \uB178\uD2B8\uB9CC \uBC18\uD658
- \uCD5C\uB300 5\uAC1C\uAE4C\uC9C0\uB9CC \uBC18\uD658
- \uAD00\uB828\uB3C4 \uB192\uC740 \uC21C\uC73C\uB85C \uC815\uB82C
- \uAC01 \uC5F0\uACB0\uC758 "\uC774\uC720"\uB97C \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C (\uC65C \uAD00\uB828\uC788\uB294\uAC00?)
- \uC5F0\uACB0 \uC720\uD615 \uBD84\uB958: \uD655\uC7A5|\uBC18\uBC15|\uC608\uC2DC|\uC804\uC81C|\uC751\uC6A9 \uC911 \uD558\uB098

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
[
  {
    "index": 0,
    "relevance": 0.8,
    "reason": "\uC774 \uB178\uD2B8\uC640 \uAD00\uB828\uC788\uB294 \uAD6C\uCCB4\uC801 \uC774\uC720",
    "type": "\uD655\uC7A5"
  }
]
`,yw=`\uC0C8 \uB178\uD2B8\uAC00 \uC5B4\uB5A4 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828\uC788\uB294\uC9C0 **\uC2E0\uC911\uD558\uAC8C** \uD310\uB2E8\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {noteTitle}
\uD0A4\uC6CC\uB4DC: {noteKeywords}

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- \uB178\uD2B8\uC758 **\uD575\uC2EC \uC8FC\uC81C**\uAC00 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB420 \uB54C\uB9CC \uD504\uB85C\uC81D\uD2B8 \uC120\uD0DD
- \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
- **\uD655\uC2E4\uD558\uC9C0 \uC54A\uC73C\uBA74 "None" \uBC18\uD658** (\uC798\uBABB\uB41C \uBD84\uB958\uBCF4\uB2E4 \uB098\uC74C)
- \uC77C\uBC18\uC801\uC778 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 \u2192 "None"
- \uC0C8\uB85C\uC6B4 \uD504\uB85C\uC81D\uD2B8\uB85C \uBCF4\uC774\uBA74 "NEW: \uD504\uB85C\uC81D\uD2B8\uBA85" \uD615\uC2DD\uC73C\uB85C \uBC18\uD658

## \uCD9C\uB825 \uD615\uC2DD (\uD504\uB85C\uC81D\uD2B8\uBA85\uB9CC \uC751\uB2F5)
\uD504\uB85C\uC81D\uD2B8\uBA85 \uB610\uB294 None \uB610\uB294 NEW: \uC0C8\uD504\uB85C\uC81D\uD2B8\uBA85
`,vw=`\uC720\uD29C\uBE0C \uC601\uC0C1\uC758 \uC790\uB9C9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uC790\uB9C9 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,_w=`\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBCF8\uBB38 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uAE00\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uAD11\uACE0\uB098 \uAD00\uB828 \uC5C6\uB294 \uB0B4\uC6A9\uC740 \uBB34\uC2DC\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,Aw=`\uB108\uB294 \uBA54\uBAA8\uB97C \uBD84\uC11D\uD558\uC5EC \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uBCC4\uB85C \uBD84\uB9AC\uD558\uB294 \uBE44\uC11C\uB2E4.
\uD558\uB098\uC758 \uBA54\uBAA8\uC5D0 \uC5EC\uB7EC \uC8FC\uC81C\uB098 \uD504\uB85C\uC81D\uD2B8 \uAD00\uB828 \uB0B4\uC6A9\uC774 \uC11E\uC5EC \uC788\uC744 \uC218 \uC788\uB2E4.
\uAC01\uAC01\uC744 \uB3C5\uB9BD\uC801\uC778 \uB178\uD2B8\uB85C \uBD84\uB9AC\uD574\uB77C.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D (\uCC38\uACE0\uC6A9)
{projects}

## \uBA54\uBAA8 \uB0B4\uC6A9
{content}

## \uBD84\uB9AC \uADDC\uCE59
- \uC11C\uB85C \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uB294 \uBC18\uB4DC\uC2DC \uBD84\uB9AC\uD574\uB77C
- \uD55C \uC904\uC9DC\uB9AC \uBA54\uBAA8\uB3C4 \uC758\uBBF8\uAC00 \uC788\uC73C\uBA74 \uBD84\uB9AC \uB300\uC0C1\uC774\uB2E4
- \uAD00\uB828 \uB0B4\uC6A9\uC740 \uD558\uB098\uB85C \uBB36\uC5B4\uB77C (\uACFC\uB3C4\uD55C \uBD84\uB9AC \uAE08\uC9C0)
- \uAC01 \uC139\uC158\uC5D0 \uC801\uC808\uD55C \uC81C\uBAA9\uC744 \uBD99\uC5EC\uB77C

## \uBD84\uB958 \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- **project**: \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB41C \uB0B4\uC6A9\uB9CC
  - \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
  - \uC608: "\uC2A4\uB9C8\uD2B8\uD31C" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC788\uC5B4\uB3C4 "\uB18D\uC5C5 \uB274\uC2A4"\uB294 library
- **library**: \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 (**\uC560\uB9E4\uD558\uBA74 library**)
- **archive**: \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83
- \uC0C8 \uD504\uB85C\uC81D\uD2B8: \uBA85\uD655\uD55C \uBAA9\uD45C\uAC00 \uC788\uB294 \uC0C8\uB85C\uC6B4 \uC791\uC5C5\uC77C \uB54C\uB9CC isNewProject: true

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uBD84\uB9AC\uB41C \uC139\uC158\uC758 \uC81C\uBAA9",
    "content": "\uD574\uB2F9 \uC139\uC158\uC758 \uC6D0\uBCF8 \uB0B4\uC6A9 (\uC815\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C)",
    "targetType": "project",
    "projectName": "\uC2A4\uB9C8\uD2B8\uD31C",
    "isNewProject": false,
    "keywords": ["\uC13C\uC11C", "\uB370\uC774\uD130", "IoT"],
    "isAtomic": false
  }
]

\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC73C\uBA74 \uC804\uCCB4\uB97C \uD558\uB098\uC758 \uC139\uC158\uC73C\uB85C \uBC18\uD658\uD574\uB77C.
`,ww=`\uC8FC\uC81C\uC5D0 \uC18D\uD55C ZK \uB178\uD2B8\uB4E4\uC744 \uBD84\uC11D\uD558\uC5EC \uAD6C\uC870\uD654\uB41C \uC124\uBA85\uC744 \uC0DD\uC131\uD574\uB77C.

## \uC8FC\uC81C
{topic}

## \uB178\uD2B8 \uBAA9\uB85D
{notes}

## \uADDC\uCE59
- \uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85 \uC791\uC131
- \uAC01 \uB178\uD2B8\uC758 \uC5ED\uD560/\uC704\uCE58 \uC124\uBA85 (\uAE30\uCD08, \uC2EC\uD654, \uC751\uC6A9, \uC608\uC2DC \uC911 \uD558\uB098)
- \uB178\uD2B8 \uAC04 \uAD00\uACC4 \uD45C\uC2DC (\uBC1C\uC804, \uAE30\uBC18, \uAD00\uB828 \uC911 \uD558\uB098)
- \uAD00\uB828 \uC8FC\uC81C 2-3\uAC1C \uC81C\uC548

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "description": "\uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85",
  "notes": [
    {
      "title": "\uB178\uD2B8 \uC81C\uBAA9",
      "role": "\uAE30\uCD08",
      "relations": [{"target": "\uB2E4\uB978\uB178\uD2B8\uC81C\uBAA9", "type": "\uBC1C\uC804"}]
    }
  ],
  "relatedTopics": ["\uAD00\uB828\uC8FC\uC81C1", "\uAD00\uB828\uC8FC\uC81C2"]
}
`,Tw=`PDF/\uC774\uBBF8\uC9C0 \uBB38\uC11C \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBB38\uC11C \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uBB38\uC11C\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD398\uC774\uC9C0 \uAD6C\uBD84\uC740 \uBB34\uC2DC\uD558\uACE0 \uC804\uCCB4 \uB0B4\uC6A9\uC744 \uD1B5\uD569\uD574\uC11C \uBD84\uC11D\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uBB38\uC11C \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,Ew=`\uB108\uB294 \uB098\uC758 \uC0DD\uC0B0\uC131 \uCF54\uCE58\uB2E4.
\uC8FC\uC5B4\uC9C4 \uAE30\uAC04 \uB3D9\uC548\uC758 \uC791\uC5C5 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uACE0 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uB77C.

## \uAE30\uAC04
{period} ({dateRange})

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5 \uB0B4\uC6A9
{projectData}

## \uBD84\uC11D \uADDC\uCE59
1. \uC804\uCCB4 \uC694\uC57D: \uC774 \uAE30\uAC04\uC758 \uC791\uC5C5\uC744 2-3\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
2. \uC8FC\uC694 \uC8FC\uC81C: \uB2E4\uB8EC \uD575\uC2EC \uC8FC\uC81C 3-5\uAC1C \uCD94\uCD9C
3. \uC778\uC0AC\uC774\uD2B8: \uBC1C\uACAC\uD55C \uC810, \uBC30\uC6B4 \uC810, \uD328\uD134 3-5\uAC1C
4. \uB2E4\uC74C \uC561\uC158: \uD6C4\uC18D\uC73C\uB85C \uD574\uC57C \uD560 \uAD6C\uCCB4\uC801\uC778 \uD589\uB3D9 3-5\uAC1C
5. \uC791\uC5C5 \uD328\uD134: \uC791\uC5C5 \uBC29\uC2DD\uC5D0\uC11C \uBC1C\uACAC\uB41C \uD328\uD134 (\uC120\uD0DD)

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "summary": "\uC804\uCCB4 \uC694\uC57D (2-3\uBB38\uC7A5)",
  "mainTopics": ["\uC8FC\uC81C1", "\uC8FC\uC81C2", "\uC8FC\uC81C3"],
  "insights": ["\uC778\uC0AC\uC774\uD2B81", "\uC778\uC0AC\uC774\uD2B82", "\uC778\uC0AC\uC774\uD2B83"],
  "nextActions": ["\uC561\uC1581", "\uC561\uC1582", "\uC561\uC1583"],
  "patterns": "\uC791\uC5C5 \uD328\uD134 \uBD84\uC11D (\uC120\uD0DD, \uC5C6\uC73C\uBA74 null)"
}
`;var lR=1e3,cR=3,uR=2e3,le="gemini-3-flash-preview",Ld=class{constructor(t){this.lastRequestTime=0;this.minDelayMs=lR;this.ai=new Nd({apiKey:t})}async waitForRateLimit(){let e=Date.now()-this.lastRequestTime;if(e<this.minDelayMs){let n=this.minDelayMs-e;await this.delay(n)}this.lastRequestTime=Date.now()}delay(t){return new Promise(e=>setTimeout(e,t))}async callWithRetry(t,e=cR){await this.waitForRateLimit();for(let n=0;n<=e;n++)try{return await t()}catch(i){if(i instanceof Error&&(i.message.includes("429")||i.message.includes("RESOURCE_EXHAUSTED")||i.message.includes("quota"))&&n<e){let r=uR*Math.pow(2,n);console.log(`Rate limit hit, retrying in ${r/1e3}s... (attempt ${n+1}/${e})`),await this.delay(r),this.minDelayMs=Math.min(this.minDelayMs*1.5,5e3)}else throw i}throw new Error("Max retries exceeded")}async classifyProject(t,e){var a;let n=e.length>0?e.map((l,c)=>`${c+1}. ${l}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",i=dw.replace("{projects}",n).replace("{content}",t),r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:i}))).text)!=null?a:"";return this.parseProjectResponse(r)}async extractZK(t){var o;let e=hw.replace("{content}",t),i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:e}))).text)!=null?o:"";return this.parseZKResponse(i)}async getFocus(t){var o;let e=fw.replace("{projects}",t),i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:e}))).text)!=null?o:"";return this.parseFocusResponse(i)}parseProjectResponse(t){var n;let e=t.match(/\{[\s\S]*\}/);if(!e)throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: JSON \uC5C6\uC74C");try{let i=JSON.parse(e[0]);return{targetType:this.validateTargetType(i.targetType),projectName:i.projectName||void 0,isNewProject:(n=i.isNewProject)!=null?n:!1,title:i.title||"Untitled",summary:i.summary||"",nextAction:i.nextAction||null}}catch(i){throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: "+t)}}parseZKResponse(t){let e=t.match(/\[[\s\S]*\]/);if(!e)return[];try{return JSON.parse(e[0]).map(i=>({title:i.title,body:i.body,keywords:i.keywords||[],importance:i.importance||"",relatedConcepts:i.relatedConcepts||[]}))}catch(n){return console.error("ZK \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),[]}}parseFocusResponse(t){let e=t.match(/\[[\s\S]*\]/);if(!e)return[];try{return JSON.parse(e[0]).map(i=>({title:i.title,why:i.why,nextAction:i.next_action}))}catch(n){return console.error("Focus \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),[]}}async extractTextFromImage(t,e){var i;return(i=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:[{role:"user",parts:[{text:pw},{inlineData:{mimeType:e,data:t}}]}]}))).text)!=null?i:""}async extractTextFromImages(t,e){let n=[];for(let i=0;i<t.length;i++){let o=t[i];e&&e(i+1,t.length);let r=await this.extractTextFromImage(o.base64,o.mimeType);n.push(r),i<t.length-1&&await this.delay(500)}return n}async extractKeywords(t){var o;let e=gw.replace("{content}",t),i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:e}))).text)!=null?o:"";return this.parseKeywordsResponse(i)}async findRelatedNotes(t,e,n){var a;let i=mw.replace("{newTitle}",t).replace("{newKeywords}",e.join(", ")).replace("{candidates}",n),r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:i}))).text)!=null?a:"";return this.parseRelatedNotesResponse(r)}async detectProject(t,e,n){var l;if(n.length===0)return null;let i=yw.replace("{noteTitle}",t).replace("{noteKeywords}",e.join(", ")).replace("{projects}",n.map((c,d)=>`${d+1}. ${c}`).join(`
`)),r=((l=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:i}))).text)!=null?l:"").trim();return r.toLowerCase()==="none"||r===""?null:r.startsWith("NEW:")?r:n.find(c=>r.toLowerCase().includes(c.toLowerCase()))||null}async summarizeContent(t,e){var a;let i=(e==="youtube"?vw:_w).replace("{content}",t),r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:i}))).text)!=null?a:"";return this.parseSummaryResponse(r)}async summarizePDF(t){var o;let e=Tw.replace("{content}",t),i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:e}))).text)!=null?o:"";return this.parseSummaryResponse(i)}async analyzeYouTube(t){var o;let e=`\uC774 YouTube \uC601\uC0C1\uC744 \uBD84\uC11D\uD574\uC8FC\uC138\uC694.

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD654\uBA74\uC5D0 \uBCF4\uC774\uB294 \uD14D\uC2A4\uD2B8, \uC2AC\uB77C\uC774\uB4DC, \uCF54\uB4DC \uB4F1\uB3C4 \uCC38\uACE0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:[{role:"user",parts:[{fileData:{mimeType:"video/mp4",fileUri:t}},{text:e}]}]}))).text)!=null?o:"";return this.parseSummaryResponse(i)}async analyzeWebpage(t){var o;let e=`\uB2E4\uC74C \uC6F9\uD398\uC774\uC9C0\uB97C \uBD84\uC11D\uD574\uC8FC\uC138\uC694: ${t}

## \uADDC\uCE59
- \uD398\uC774\uC9C0\uC758 \uD575\uC2EC \uB0B4\uC6A9\uC744 \uC815\uD655\uD788 \uD30C\uC545\uD574\uB77C
- \uACF5\uACE0/\uBAA8\uC9D1\uC774\uBA74: \uB300\uC0C1, \uC870\uAC74, \uAE30\uAC04, \uD61C\uD0DD\uC744 \uAD6C\uCCB4\uC801\uC73C\uB85C
- \uB274\uC2A4/\uAE30\uC0AC\uBA74: \uD575\uC2EC \uC0AC\uC2E4, \uBC30\uACBD, \uC758\uBBF8\uB97C
- \uC81C\uD488/\uC11C\uBE44\uC2A4\uBA74: \uC8FC\uC694 \uAE30\uB2A5, \uAC00\uACA9, \uD2B9\uC9D5\uC744
- \uC77C\uBC18 \uC815\uBCF4\uBA74: \uD575\uC2EC \uBA54\uC2DC\uC9C0\uC640 \uC911\uC694 \uC138\uBD80\uC0AC\uD56D\uC744
- \uC804\uBB38 \uC6A9\uC5B4, \uACE0\uC720\uBA85\uC0AC, \uC22B\uC790\uB294 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD398\uC774\uC9C0 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D (\uAD6C\uCCB4\uC801\uC778 \uC815\uBCF4 \uD3EC\uD568)",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,i=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:e,config:{tools:[{urlContext:{}}]}}))).text)!=null?o:"";return this.parseSummaryResponse(i)}parseSummaryResponse(t){let e=t.match(/\{[\s\S]*\}/);if(!e)return{title:"Untitled",summary:t.trim(),keyPoints:[]};try{let n=JSON.parse(e[0]);return{title:n.title||"Untitled",summary:n.summary||"",keyPoints:Array.isArray(n.keyPoints)?n.keyPoints:[]}}catch(n){return console.error("\uC694\uC57D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),{title:"Untitled",summary:t.trim(),keyPoints:[]}}}parseKeywordsResponse(t){let e=t.match(/\[[\s\S]*\]/);if(!e)return[];try{let n=JSON.parse(e[0]);return Array.isArray(n)?n.filter(i=>typeof i=="string"):[]}catch(n){return console.error("\uD0A4\uC6CC\uB4DC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),[]}}parseRelatedNotesResponse(t){let e=t.match(/\[[\s\S]*\]/);if(!e)return[];try{let n=JSON.parse(e[0]);return Array.isArray(n)?n.filter(i=>typeof i=="object"&&typeof i.index=="number"&&typeof i.relevance=="number").filter(i=>i.relevance>=.5).sort((i,o)=>o.relevance-i.relevance).slice(0,5).map(i=>({index:i.index,relevance:i.relevance,reason:i.reason||"",type:i.type||""})):[]}catch(n){return console.error("\uAD00\uB828 \uB178\uD2B8 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),[]}}async generateTopicStructure(t,e){var r;let n=ww.replace("{topic}",t).replace("{notes}",e),o=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:n}))).text)!=null?r:"";return this.parseTopicStructureResponse(o)}parseTopicStructureResponse(t){let e=t.match(/\{[\s\S]*\}/);if(!e)return{description:"",notes:[],relatedTopics:[]};try{let n=JSON.parse(e[0]);return{description:n.description||"",notes:Array.isArray(n.notes)?n.notes:[],relatedTopics:Array.isArray(n.relatedTopics)?n.relatedTopics:[]}}catch(n){return console.error("\uC8FC\uC81C \uAD6C\uC870 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),{description:"",notes:[],relatedTopics:[]}}}async splitContent(t,e){var a;let n=e.length>0?e.map((l,c)=>`${c+1}. ${l}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",i=Aw.replace("{projects}",n).replace("{content}",t),r=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:i}))).text)!=null?a:"";return this.parseSplitResponse(r)}parseSplitResponse(t){let e=t.match(/\[[\s\S]*\]/);if(!e)return[];try{let n=JSON.parse(e[0]);return Array.isArray(n)?n.map(i=>{var o,r;return{title:i.title||"Untitled",content:i.content||"",targetType:this.validateTargetType(i.targetType),project:i.projectName||void 0,isNewProject:(o=i.isNewProject)!=null?o:!1,keywords:Array.isArray(i.keywords)?i.keywords:[],isAtomic:(r=i.isAtomic)!=null?r:!1}}):[]}catch(n){return console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),[]}}validateTargetType(t){return["project","library","archive"].includes(t)?t:"library"}async analyzeReview(t,e,n){var p;let o={today:"\uC624\uB298",week:"\uC774\uBC88 \uC8FC",month:"\uC774\uBC88 \uB2EC",custom:"\uC0AC\uC6A9\uC790 \uC9C0\uC815 \uAE30\uAC04"}[t]||"\uAE30\uAC04",r=`${Ve(e.start,"auto")} ~ ${Ve(e.end,"auto")}`,a=n.map(g=>{let m=g.notes.map(v=>`  - ${v.title}${v.summary?`: ${v.summary}`:""}`).join(`
`);return`### ${g.projectName} (${g.noteCount}\uAC1C)
${m}`}).join(`

`),l=Ew.replace("{period}",o).replace("{dateRange}",r).replace("{projectData}",a),d=(p=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:l}))).text)!=null?p:"";return this.parseReviewAnalysisResponse(d)}parseReviewAnalysisResponse(t){let e=t.match(/\{[\s\S]*\}/);if(!e)return{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]};try{let n=JSON.parse(e[0]);return{summary:n.summary||"",mainTopics:Array.isArray(n.mainTopics)?n.mainTopics:[],insights:Array.isArray(n.insights)?n.insights:[],nextActions:Array.isArray(n.nextActions)?n.nextActions:[],patterns:n.patterns||void 0}}catch(n){return console.error("\uD68C\uACE0 \uBD84\uC11D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",t),{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]}}}};var Gv=require("obsidian");var rP={};var pl={};pl.d=(s,t)=>{for(var e in t)pl.o(t,e)&&!pl.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:t[e]})};pl.o=(s,t)=>Object.prototype.hasOwnProperty.call(s,t);var V=globalThis.pdfjsLib={};pl.d(V,{AbortException:()=>Fn,AnnotationEditorLayer:()=>Cv,AnnotationEditorParamsType:()=>Q,AnnotationEditorType:()=>K,AnnotationEditorUIManager:()=>Oo,AnnotationLayer:()=>ev,AnnotationMode:()=>Ei,ColorPicker:()=>zh,DOMSVGFactory:()=>bl,DrawLayer:()=>xv,FeatureTest:()=>Bt,GlobalWorkerOptions:()=>dn,ImageKind:()=>Hd,InvalidPDFException:()=>vl,MissingPDFException:()=>Fo,OPS:()=>Je,OutputScale:()=>wl,PDFDataRangeTransport:()=>kh,PDFDateString:()=>ml,PDFWorker:()=>lr,PasswordResponses:()=>gR,PermissionFlag:()=>pR,PixelsPerInch:()=>as,RenderingCancelledException:()=>Al,TextLayer:()=>Cl,TouchManager:()=>Th,UnexpectedResponseException:()=>$a,Util:()=>$,VerbosityLevel:()=>kp,XfaLayer:()=>Lh,build:()=>iP,createValidAbsoluteUrl:()=>_R,fetchData:()=>Up,getDocument:()=>jR,getFilenameFromUrl:()=>xR,getPdfFilenameFromUrl:()=>IR,getXfaPageViewport:()=>RR,isDataScheme:()=>Op,isPdfFile:()=>Nv,noContextMenu:()=>hn,normalizeUnicode:()=>CR,setLayerDimensions:()=>Lo,shadow:()=>Z,stopEvent:()=>Pe,version:()=>nP});var Qt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),$w=[1,0,0,1,0,0],gm=[.001,0,0,.001,0,0],dR=1e7,Bd=1.35,hR=.35,TP=hR/Bd,Re={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ei={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},fR="pdfjs_internal_editor_",K={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Q={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},pR={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},qt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Hd={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Et={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var Ja={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var kp={ERRORS:0,WARNINGS:1,INFOS:5},Je={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},gR={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},Dp=kp.WARNINGS;function mR(s){Number.isInteger(s)&&(Dp=s)}function yR(){return Dp}function Fp(s){Dp>=kp.INFOS&&console.log(`Info: ${s}`)}function Y(s){Dp>=kp.WARNINGS&&console.log(`Warning: ${s}`)}function ot(s){throw new Error(s)}function wt(s,t){s||ot(t)}function vR(s){switch(s==null?void 0:s.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function _R(s,t=null,e=null){if(!s)return null;try{if(e&&typeof s=="string"){if(e.addDefaultProtocol&&s.startsWith("www.")){let i=s.match(/\./g);(i==null?void 0:i.length)>=2&&(s=`http://${s}`)}if(e.tryConvertEncoding)try{s=ER(s)}catch(i){}}let n=t?new URL(s,t):new URL(s);if(vR(n))return n}catch(n){}return null}function Z(s,t,e,n=!1){return Object.defineProperty(s,t,{value:e,enumerable:!n,configurable:!0,writable:!1}),e}var ls=function(){function t(e,n){this.message=e,this.name=n}return t.prototype=new Error,t.constructor=t,t}(),vh=class extends ls{constructor(t,e){super(t,"PasswordException"),this.code=e}},gl=class extends ls{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}},vl=class extends ls{constructor(t){super(t,"InvalidPDFException")}},Fo=class extends ls{constructor(t){super(t,"MissingPDFException")}},$a=class extends ls{constructor(t,e){super(t,"UnexpectedResponseException"),this.status=e}},mm=class extends ls{constructor(t){super(t,"FormatError")}},Fn=class extends ls{constructor(t){super(t,"AbortException")}};function Gw(s){(typeof s!="object"||(s==null?void 0:s.length)===void 0)&&ot("Invalid argument for bytesToString");let t=s.length,e=8192;if(t<e)return String.fromCharCode.apply(null,s);let n=[];for(let i=0;i<t;i+=e){let o=Math.min(i+e,t),r=s.subarray(i,o);n.push(String.fromCharCode.apply(null,r))}return n.join("")}function Lp(s){typeof s!="string"&&ot("Invalid argument for stringToBytes");let t=s.length,e=new Uint8Array(t);for(let n=0;n<t;++n)e[n]=s.charCodeAt(n)&255;return e}function AR(s){return String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255)}function Pv(s){let t=Object.create(null);for(let[e,n]of s)t[e]=n;return t}function wR(){let s=new Uint8Array(4);return s[0]=1,new Uint32Array(s.buffer,0,1)[0]===1}function TR(){try{return new Function(""),!0}catch(s){return!1}}var Bt=class{static get isLittleEndian(){return Z(this,"isLittleEndian",wR())}static get isEvalSupported(){return Z(this,"isEvalSupported",TR())}static get isOffscreenCanvasSupported(){return Z(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas!="undefined")}static get isImageDecoderSupported(){return Z(this,"isImageDecoderSupported",typeof ImageDecoder!="undefined")}static get platform(){return typeof navigator!="undefined"&&typeof(navigator==null?void 0:navigator.platform)=="string"?Z(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):Z(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var t,e;return Z(this,"isCSSRoundSupported",(e=(t=globalThis.CSS)==null?void 0:t.supports)==null?void 0:e.call(t,"width: round(1.5px, 1px)"))}},um=Array.from(Array(256).keys(),s=>s.toString(16).padStart(2,"0")),cr,Vd,Ml,ym,$=class{static makeHexColor(t,e,n){return`#${um[t]}${um[e]}${um[n]}`}static scaleMinMax(t,e){let n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){let n=t[0]*e[0]+t[1]*e[2]+e[4],i=t[0]*e[1]+t[1]*e[3]+e[5];return[n,i]}static applyInverseTransform(t,e){let n=e[0]*e[3]-e[1]*e[2],i=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/n,o=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/n;return[i,o]}static getAxialAlignedBoundingBox(t,e){let n=this.applyTransform(t,e),i=this.applyTransform(t.slice(2,4),e),o=this.applyTransform([t[0],t[3]],e),r=this.applyTransform([t[2],t[1]],e);return[Math.min(n[0],i[0],o[0],r[0]),Math.min(n[1],i[1],o[1],r[1]),Math.max(n[0],i[0],o[0],r[0]),Math.max(n[1],i[1],o[1],r[1])]}static inverseTransform(t){let e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){let e=[t[0],t[2],t[1],t[3]],n=t[0]*e[0]+t[1]*e[2],i=t[0]*e[1]+t[1]*e[3],o=t[2]*e[0]+t[3]*e[2],r=t[2]*e[1]+t[3]*e[3],a=(n+r)/2,l=Math.sqrt((n+r)**2-4*(n*r-o*i))/2,c=a+l||1,d=a-l||1;return[Math.sqrt(c),Math.sqrt(d)]}static normalizeRect(t){let e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){let n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>i)return null;let o=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return o>r?null:[n,o,i,r]}static bezierBoundingBox(t,e,n,i,o,r,a,l,c){return c?(c[0]=Math.min(c[0],t,a),c[1]=Math.min(c[1],e,l),c[2]=Math.max(c[2],t,a),c[3]=Math.max(c[3],e,l)):c=[Math.min(t,a),Math.min(e,l),Math.max(t,a),Math.max(e,l)],w(this,Ml,ym).call(this,t,n,o,a,e,i,r,l,3*(-t+3*(n-o)+a),6*(t-2*n+o),3*(n-t),c),w(this,Ml,ym).call(this,t,n,o,a,e,i,r,l,3*(-e+3*(i-r)+l),6*(e-2*i+r),3*(i-e),c),c}};cr=new WeakSet,Vd=function(t,e,n,i,o,r,a,l,c,d){if(c<=0||c>=1)return;let p=1-c,g=c*c,m=g*c,v=p*(p*(p*t+3*c*e)+3*g*n)+m*i,A=p*(p*(p*o+3*c*r)+3*g*a)+m*l;d[0]=Math.min(d[0],v),d[1]=Math.min(d[1],A),d[2]=Math.max(d[2],v),d[3]=Math.max(d[3],A)},Ml=new WeakSet,ym=function(t,e,n,i,o,r,a,l,c,d,p,g){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&w(this,cr,Vd).call(this,t,e,n,i,o,r,a,l,-p/d,g);return}let m=d**2-4*p*c;if(m<0)return;let v=Math.sqrt(m),A=2*c;w(this,cr,Vd).call(this,t,e,n,i,o,r,a,l,(-d+v)/A,g),w(this,cr,Vd).call(this,t,e,n,i,o,r,a,l,(-d-v)/A,g)},y($,cr),y($,Ml);function ER(s){return decodeURIComponent(escape(s))}var dm=null,Cw=null;function CR(s){return dm||(dm=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Cw=new Map([["\uFB05","\u017Ft"]])),s.replaceAll(dm,(t,e,n)=>e?e.normalize("NFKC"):Cw.get(n))}function SR(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let s=new Uint8Array(32);return crypto.getRandomValues(s),Gw(s)}var Mv="pdfjs_internal_id_";function bR(s){return Uint8Array.prototype.toBase64?s.toBase64():btoa(Gw(s))}typeof Promise.try!="function"&&(Promise.try=function(s,...t){return new Promise(e=>{e(s(...t))})});var Gn="http://www.w3.org/2000/svg",ps=class ps{};H(ps,"CSS",96),H(ps,"PDF",72),H(ps,"PDF_TO_CSS_UNITS",ps.CSS/ps.PDF);var as=ps;async function Up(s,t="text"){if(ja(s,document.baseURI)){let e=await fetch(s);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,n)=>{let i=new XMLHttpRequest;i.open("GET",s,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(i.response);return}e(i.responseText);return}n(new Error(i.statusText))}},i.send(null)})}var _l=class s{constructor({viewBox:t,userUnit:e,scale:n,rotation:i,offsetX:o=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=t,this.userUnit=e,this.scale=n,this.rotation=i,this.offsetX=o,this.offsetY=r,n*=e;let l=(t[2]+t[0])/2,c=(t[3]+t[1])/2,d,p,g,m;switch(i%=360,i<0&&(i+=360),i){case 180:d=-1,p=0,g=0,m=1;break;case 90:d=0,p=1,g=1,m=0;break;case 270:d=0,p=-1,g=-1,m=0;break;case 0:d=1,p=0,g=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(g=-g,m=-m);let v,A,T,E;d===0?(v=Math.abs(c-t[1])*n+o,A=Math.abs(l-t[0])*n+r,T=(t[3]-t[1])*n,E=(t[2]-t[0])*n):(v=Math.abs(l-t[0])*n+o,A=Math.abs(c-t[1])*n+r,T=(t[2]-t[0])*n,E=(t[3]-t[1])*n),this.transform=[d*n,p*n,g*n,m*n,v-d*n*l-g*n*c,A-p*n*l-m*n*c],this.width=T,this.height=E}get rawDims(){let{userUnit:t,viewBox:e}=this,n=e.map(i=>i*t);return Z(this,"rawDims",{pageWidth:n[2]-n[0],pageHeight:n[3]-n[1],pageX:n[0],pageY:n[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:n=this.offsetX,offsetY:i=this.offsetY,dontFlip:o=!1}={}){return new s({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:i,dontFlip:o})}convertToViewportPoint(t,e){return $.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){let e=$.applyTransform([t[0],t[1]],this.transform),n=$.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],n[0],n[1]]}convertToPdfPoint(t,e){return $.applyInverseTransform([t,e],this.transform)}},Al=class extends ls{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}};function Op(s){let t=s.length,e=0;for(;e<t&&s[e].trim()==="";)e++;return s.substring(e,e+5).toLowerCase()==="data:"}function Nv(s){return typeof s=="string"&&/\.pdf$/i.test(s)}function xR(s){return[s]=s.split(/[#?]/,1),s.substring(s.lastIndexOf("/")+1)}function IR(s,t="document.pdf"){if(typeof s!="string")return t;if(Op(s))return Y('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;let e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=e.exec(s),o=n.exec(i[1])||n.exec(i[2])||n.exec(i[3]);if(o&&(o=o[0],o.includes("%")))try{o=n.exec(decodeURIComponent(o))[0]}catch(r){}return o||t}var _h=class{constructor(){H(this,"started",Object.create(null));H(this,"times",[])}time(t){t in this.started&&Y(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||Y(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){let t=[],e=0;for(let{name:n}of this.times)e=Math.max(n.length,e);for(let{name:n,start:i,end:o}of this.times)t.push(`${n.padEnd(e)} ${o-i}ms
`);return t.join("")}};function ja(s,t){try{let{protocol:e}=t?new URL(s,t):new URL(s);return e==="http:"||e==="https:"}catch(e){return!1}}function hn(s){s.preventDefault()}function Pe(s){s.preventDefault(),s.stopPropagation()}var Nl,ml=class{static toDateObject(t){if(!t||typeof t!="string")return null;u(this,Nl)||_(this,Nl,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let e=u(this,Nl).exec(t);if(!e)return null;let n=parseInt(e[1],10),i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let o=parseInt(e[3],10);o=o>=1&&o<=31?o:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;let c=e[7]||"Z",d=parseInt(e[8],10);d=d>=0&&d<=23?d:0;let p=parseInt(e[9],10)||0;return p=p>=0&&p<=59?p:0,c==="-"?(r+=d,a+=p):c==="+"&&(r-=d,a-=p),new Date(Date.UTC(n,i,o,r,a,l))}};Nl=new WeakMap,y(ml,Nl,void 0);function RR(s,{scale:t=1,rotation:e=0}){let{width:n,height:i}=s.attributes.style,o=[0,0,parseInt(n),parseInt(i)];return new _l({viewBox:o,userUnit:1,scale:t,rotation:e})}function kv(s){if(s.startsWith("#")){let t=parseInt(s.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return s.startsWith("rgb(")?s.slice(4,-1).split(",").map(t=>parseInt(t)):s.startsWith("rgba(")?s.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(Y(`Not a valid color format: "${s}"`),[0,0,0])}function PR(s){let t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(let e of s.keys()){t.style.color=e;let n=window.getComputedStyle(t).color;s.set(e,kv(n))}t.remove()}function ct(s){let{a:t,b:e,c:n,d:i,e:o,f:r}=s.getTransform();return[t,e,n,i,o,r]}function pn(s){let{a:t,b:e,c:n,d:i,e:o,f:r}=s.getTransform().invertSelf();return[t,e,n,i,o,r]}function Lo(s,t,e=!1,n=!0){if(t instanceof _l){let{pageWidth:i,pageHeight:o}=t.rawDims,{style:r}=s,a=Bt.isCSSRoundSupported,l=`var(--scale-factor) * ${i}px`,c=`var(--scale-factor) * ${o}px`,d=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,p=a?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!e||t.rotation%180===0?(r.width=d,r.height=p):(r.width=p,r.height=d)}n&&s.setAttribute("data-main-rotation",t.rotation)}var wl=class{constructor(){let t=window.devicePixelRatio||1;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},Ci,ys,Xe,vs,kl,Dl,Yh,Bw,Jh,Hw,Xh,Vw,ur,qd,Zh,qw,Fl,_m,Vn=class Vn{constructor(t){y(this,Jh);y(this,Xh);y(this,ur);y(this,Zh);y(this,Fl);y(this,Ci,null);y(this,ys,null);y(this,Xe,void 0);y(this,vs,null);y(this,kl,null);_(this,Xe,t),u(Vn,Dl)||_(Vn,Dl,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){let t=_(this,Ci,document.createElement("div"));t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");let e=u(this,Xe)._uiManager._signal;t.addEventListener("contextmenu",hn,{signal:e}),t.addEventListener("pointerdown",w(Vn,Yh,Bw),{signal:e});let n=_(this,vs,document.createElement("div"));n.className="buttons",t.append(n);let i=u(this,Xe).toolbarPosition;if(i){let{style:o}=t,r=u(this,Xe)._uiManager.direction==="ltr"?1-i[0]:i[0];o.insetInlineEnd=`${100*r}%`,o.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return w(this,Zh,qw).call(this),t}get div(){return u(this,Ci)}hide(){var t;u(this,Ci).classList.add("hidden"),(t=u(this,ys))==null||t.hideDropdown()}show(){var t;u(this,Ci).classList.remove("hidden"),(t=u(this,kl))==null||t.shown()}async addAltText(t){let e=await t.render();w(this,ur,qd).call(this,e),u(this,vs).prepend(e,u(this,Fl,_m)),_(this,kl,t)}addColorPicker(t){_(this,ys,t);let e=t.renderButton();w(this,ur,qd).call(this,e),u(this,vs).prepend(e,u(this,Fl,_m))}remove(){var t;u(this,Ci).remove(),(t=u(this,ys))==null||t.destroy(),_(this,ys,null)}};Ci=new WeakMap,ys=new WeakMap,Xe=new WeakMap,vs=new WeakMap,kl=new WeakMap,Dl=new WeakMap,Yh=new WeakSet,Bw=function(t){t.stopPropagation()},Jh=new WeakSet,Hw=function(t){u(this,Xe)._focusEventsAllowed=!1,Pe(t)},Xh=new WeakSet,Vw=function(t){u(this,Xe)._focusEventsAllowed=!0,Pe(t)},ur=new WeakSet,qd=function(t){let e=u(this,Xe)._uiManager._signal;t.addEventListener("focusin",w(this,Jh,Hw).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",w(this,Xh,Vw).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",hn,{signal:e})},Zh=new WeakSet,qw=function(){let{editorType:t,_uiManager:e}=u(this,Xe),n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",u(Vn,Dl)[t]),w(this,ur,qd).call(this,n),n.addEventListener("click",i=>{e.delete()},{signal:e._signal}),u(this,vs).append(n)},Fl=new WeakSet,_m=function(){let t=document.createElement("div");return t.className="divider",t},y(Vn,Yh),y(Vn,Dl,null);var vm=Vn,Ll,_s,As,Qh,zw,jh,Ww,tf,Kw,Am=class{constructor(t){y(this,Qh);y(this,jh);y(this,tf);y(this,Ll,null);y(this,_s,null);y(this,As,void 0);_(this,As,t)}show(t,e,n){let[i,o]=w(this,jh,Ww).call(this,e,n),{style:r}=u(this,_s)||_(this,_s,w(this,Qh,zw).call(this));t.append(u(this,_s)),r.insetInlineEnd=`${100*i}%`,r.top=`calc(${100*o}% + var(--editor-toolbar-vert-offset))`}hide(){u(this,_s).remove()}};Ll=new WeakMap,_s=new WeakMap,As=new WeakMap,Qh=new WeakSet,zw=function(){let t=_(this,_s,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",hn,{signal:u(this,As)._signal});let e=_(this,Ll,document.createElement("div"));return e.className="buttons",t.append(e),w(this,tf,Kw).call(this),t},jh=new WeakSet,Ww=function(t,e){let n=0,i=0;for(let o of t){let r=o.y+o.height;if(r<n)continue;let a=o.x+(e?o.width:0);if(r>n){i=a,n=r;continue}e?a>i&&(i=a):a<i&&(i=a)}return[e?1-i:i,n]},tf=new WeakSet,Kw=function(){let t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let n=u(this,As)._signal;t.addEventListener("contextmenu",hn,{signal:n}),t.addEventListener("click",()=>{u(this,As).highlightSelection("floating_button")},{signal:n}),u(this,Ll).append(t)};function Ah(s,t,e){for(let n of e)t.addEventListener(n,s[n].bind(s))}var ef,wm=class{constructor(){y(this,ef,0)}get id(){return`${fR}${jt(this,ef)._++}`}};ef=new WeakMap;var dr,Ul,Kt,hr,zd,Dv=class Dv{constructor(){y(this,hr);y(this,dr,SR());y(this,Ul,0);y(this,Kt,null)}static get _isSVGFittingCanvas(){let t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=t;let o=i.decode().then(()=>(n.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Z(this,"_isSVGFittingCanvas",o)}async getFromFile(t){let{lastModified:e,name:n,size:i,type:o}=t;return w(this,hr,zd).call(this,`${e}_${n}_${i}_${o}`,t)}async getFromUrl(t){return w(this,hr,zd).call(this,t,t)}async getFromBlob(t,e){let n=await e;return w(this,hr,zd).call(this,t,n)}async getFromId(t){u(this,Kt)||_(this,Kt,new Map);let e=u(this,Kt).get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){let{blobPromise:n}=e;return delete e.blobPromise,this.getFromBlob(e.id,n)}return this.getFromUrl(e.url)}getFromCanvas(t,e){u(this,Kt)||_(this,Kt,new Map);let n=u(this,Kt).get(t);if(n!=null&&n.bitmap)return n.refCounter+=1,n;let i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),n={bitmap:i.transferToImageBitmap(),id:`image_${u(this,dr)}_${jt(this,Ul)._++}`,refCounter:1,isSvg:!1},u(this,Kt).set(t,n),u(this,Kt).set(n.id,n),n}getSvgUrl(t){let e=u(this,Kt).get(t);return e!=null&&e.isSvg?e.svgUrl:null}deleteId(t){var i;u(this,Kt)||_(this,Kt,new Map);let e=u(this,Kt).get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;let{bitmap:n}=e;if(!e.url&&!e.file){let o=new OffscreenCanvas(n.width,n.height);o.getContext("bitmaprenderer").transferFromImageBitmap(n),e.blobPromise=o.convertToBlob()}(i=n.close)==null||i.call(n),e.bitmap=null}isValidId(t){return t.startsWith(`image_${u(this,dr)}_`)}};dr=new WeakMap,Ul=new WeakMap,Kt=new WeakMap,hr=new WeakSet,zd=async function(t,e){u(this,Kt)||_(this,Kt,new Map);let n=u(this,Kt).get(t);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${u(this,dr)}_${jt(this,Ul)._++}`,refCounter:0,isSvg:!1});let i;if(typeof e=="string"?(n.url=e,i=await Up(e,"blob")):e instanceof File?i=n.file=e:e instanceof Blob&&(i=e),i.type==="image/svg+xml"){let o=Dv._isSVGFittingCanvas,r=new FileReader,a=new Image,l=new Promise((c,d)=>{a.onload=()=>{n.bitmap=a,n.isSvg=!0,c()},r.onload=async()=>{let p=n.svgUrl=r.result;a.src=await o?`${p}#svgView(preserveAspectRatio(none))`:p},a.onerror=r.onerror=d});r.readAsDataURL(i),await l}else n.bitmap=await createImageBitmap(i);n.refCounter=1}catch(i){Y(i),n=null}return u(this,Kt).set(t,n),n&&u(this,Kt).set(n.id,n),n};var Tm=Dv,mt,Si,Ol,dt,Em=class{constructor(t=128){y(this,mt,[]);y(this,Si,!1);y(this,Ol,void 0);y(this,dt,-1);_(this,Ol,t)}add({cmd:t,undo:e,post:n,mustExec:i,type:o=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(i&&t(),u(this,Si))return;let l={cmd:t,undo:e,post:n,type:o};if(u(this,dt)===-1){u(this,mt).length>0&&(u(this,mt).length=0),_(this,dt,0),u(this,mt).push(l);return}if(r&&u(this,mt)[u(this,dt)].type===o){a&&(l.undo=u(this,mt)[u(this,dt)].undo),u(this,mt)[u(this,dt)]=l;return}let c=u(this,dt)+1;c===u(this,Ol)?u(this,mt).splice(0,1):(_(this,dt,c),c<u(this,mt).length&&u(this,mt).splice(c)),u(this,mt).push(l)}undo(){if(u(this,dt)===-1)return;_(this,Si,!0);let{undo:t,post:e}=u(this,mt)[u(this,dt)];t(),e==null||e(),_(this,Si,!1),_(this,dt,u(this,dt)-1)}redo(){if(u(this,dt)<u(this,mt).length-1){_(this,dt,u(this,dt)+1),_(this,Si,!0);let{cmd:t,post:e}=u(this,mt)[u(this,dt)];t(),e==null||e(),_(this,Si,!1)}}hasSomethingToUndo(){return u(this,dt)!==-1}hasSomethingToRedo(){return u(this,dt)<u(this,mt).length-1}cleanType(t){if(u(this,dt)!==-1){for(let e=u(this,dt);e>=0;e--)if(u(this,mt)[e].type!==t){u(this,mt).splice(e+1,u(this,dt)-e),_(this,dt,e);return}u(this,mt).length=0,_(this,dt,-1)}}destroy(){_(this,mt,null)}};mt=new WeakMap,Si=new WeakMap,Ol=new WeakMap,dt=new WeakMap;var nf,Yw,Uo=class{constructor(t){y(this,nf);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:e}=Bt.platform;for(let[n,i,o={}]of t)for(let r of n){let a=r.startsWith("mac+");e&&a?(this.callbacks.set(r.slice(4),{callback:i,options:o}),this.allKeys.add(r.split("+").at(-1))):!e&&!a&&(this.callbacks.set(r,{callback:i,options:o}),this.allKeys.add(r.split("+").at(-1)))}}exec(t,e){if(!this.allKeys.has(e.key))return;let n=this.callbacks.get(w(this,nf,Yw).call(this,e));if(!n)return;let{callback:i,options:{bubbles:o=!1,args:r=[],checker:a=null}}=n;a&&!a(t,e)||(i.bind(t,...r,e)(),o||Pe(e))}};nf=new WeakSet,Yw=function(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);let e=this.buffer.join("+");return this.buffer.length=0,e};var sf=class sf{get _colors(){let t=new Map([["CanvasText",null],["Canvas",null]]);return PR(t),Z(this,"_colors",t)}convert(t){let e=kv(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(let[n,i]of this._colors)if(i.every((o,r)=>o===e[r]))return sf._colorsMapping.get(n);return e}getHexCode(t){let e=this._colors.get(t);return e?$.makeHexColor(...e):t}};H(sf,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var Cm=sf,fr,ye,Ct,Ft,pr,zn,gr,De,bi,ws,mr,Ts,yn,Ze,Es,$l,Gl,yr,Bl,vn,xi,vr,Ii,_n,of,Ri,Hl,Pi,Cs,Vl,ql,xt,nt,Wn,Ss,zl,Wl,Mi,An,Kn,Kl,Fe,_r,Wd,Yl,Sm,rf,Jw,af,Xw,Ar,Kd,lf,Zw,cf,Qw,uf,jw,Jl,bm,df,tT,Xl,xm,Zl,Im,hf,eT,Lt,ee,Qe,Bn,ff,nT,pf,iT,Ql,Rm,gf,sT,bs,tl,jl,Pm,or=class or{constructor(t,e,n,i,o,r,a,l,c,d,p,g,m){y(this,_r);y(this,Yl);y(this,rf);y(this,af);y(this,Ar);y(this,lf);y(this,cf);y(this,uf);y(this,Jl);y(this,df);y(this,Xl);y(this,Zl);y(this,hf);y(this,Lt);y(this,Qe);y(this,ff);y(this,pf);y(this,Ql);y(this,gf);y(this,bs);y(this,jl);y(this,fr,new AbortController);y(this,ye,null);y(this,Ct,new Map);y(this,Ft,new Map);y(this,pr,null);y(this,zn,null);y(this,gr,null);y(this,De,new Em);y(this,bi,null);y(this,ws,null);y(this,mr,0);y(this,Ts,new Set);y(this,yn,null);y(this,Ze,null);y(this,Es,new Set);H(this,"_editorUndoBar",null);y(this,$l,!1);y(this,Gl,!1);y(this,yr,!1);y(this,Bl,null);y(this,vn,null);y(this,xi,null);y(this,vr,null);y(this,Ii,!1);y(this,_n,null);y(this,of,new wm);y(this,Ri,!1);y(this,Hl,!1);y(this,Pi,null);y(this,Cs,null);y(this,Vl,null);y(this,ql,null);y(this,xt,K.NONE);y(this,nt,new Set);y(this,Wn,null);y(this,Ss,null);y(this,zl,null);y(this,Wl,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});y(this,Mi,[0,0]);y(this,An,null);y(this,Kn,null);y(this,Kl,null);y(this,Fe,null);let v=this._signal=u(this,fr).signal;_(this,Kn,t),_(this,Kl,e),_(this,pr,n),this._eventBus=i,i._on("editingaction",this.onEditingAction.bind(this),{signal:v}),i._on("pagechanging",this.onPageChanging.bind(this),{signal:v}),i._on("scalechanging",this.onScaleChanging.bind(this),{signal:v}),i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:v}),i._on("setpreference",this.onSetPreference.bind(this),{signal:v}),i._on("switchannotationeditorparams",A=>this.updateParams(A.type,A.value),{signal:v}),w(this,lf,Zw).call(this),w(this,hf,eT).call(this),w(this,Jl,bm).call(this),_(this,zn,o.annotationStorage),_(this,Bl,o.filterFactory),_(this,Ss,r),_(this,vr,a||null),_(this,$l,l),_(this,Gl,c),_(this,yr,d),_(this,ql,p||null),this.viewParameters={realScale:as.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=m!==!1}static get _keyboardManager(){let t=or.prototype,e=r=>u(r,Kn).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),n=(r,{target:a})=>{if(a instanceof HTMLInputElement){let{type:l}=a;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return Z(this,"_keyboardManager",new Uo([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&u(r,Kn).contains(a)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&u(r,Kn).contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-o,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[o,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-o],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,o],checker:e}]]))}destroy(){var t,e,n,i,o;(t=u(this,Fe))==null||t.resolve(),_(this,Fe,null),(e=u(this,fr))==null||e.abort(),_(this,fr,null),this._signal=null;for(let r of u(this,Ft).values())r.destroy();u(this,Ft).clear(),u(this,Ct).clear(),u(this,Es).clear(),_(this,ye,null),u(this,nt).clear(),u(this,De).destroy(),(n=u(this,pr))==null||n.destroy(),(i=u(this,_n))==null||i.hide(),_(this,_n,null),u(this,vn)&&(clearTimeout(u(this,vn)),_(this,vn,null)),u(this,An)&&(clearTimeout(u(this,An)),_(this,An,null)),(o=this._editorUndoBar)==null||o.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return u(this,ql)}get useNewAltTextFlow(){return u(this,Gl)}get useNewAltTextWhenAddingImage(){return u(this,yr)}get hcmFilter(){return Z(this,"hcmFilter",u(this,Ss)?u(this,Bl).addHCMFilter(u(this,Ss).foreground,u(this,Ss).background):"none")}get direction(){return Z(this,"direction",getComputedStyle(u(this,Kn)).direction)}get highlightColors(){return Z(this,"highlightColors",u(this,vr)?new Map(u(this,vr).split(",").map(t=>t.split("=").map(e=>e.trim()))):null)}get highlightColorNames(){return Z(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),_(this,ws,t)}setMainHighlightColorPicker(t){_(this,Vl,t)}editAltText(t,e=!1){var n;(n=u(this,pr))==null||n.editAltText(this,t,e)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":_(this,yr,e);break}}onPageChanging({pageNumber:t}){_(this,mr,t-1)}focusMainContainer(){u(this,Kn).focus()}findParent(t,e){for(let n of u(this,Ft).values()){let{x:i,y:o,width:r,height:a}=n.div.getBoundingClientRect();if(t>=i&&t<=i+r&&e>=o&&e<=o+a)return n}return null}disableUserSelect(t=!1){u(this,Kl).classList.toggle("noUserSelect",t)}addShouldRescale(t){u(this,Es).add(t)}removeShouldRescale(t){u(this,Es).delete(t)}onScaleChanging({scale:t}){var e;this.commitOrRemove(),this.viewParameters.realScale=t*as.PDF_TO_CSS_UNITS;for(let n of u(this,Es))n.onScaleChanging();(e=u(this,ws))==null||e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(t=""){let e=document.getSelection();if(!e||e.isCollapsed)return;let{anchorNode:n,anchorOffset:i,focusNode:o,focusOffset:r}=e,a=e.toString(),c=w(this,_r,Wd).call(this,e).closest(".textLayer"),d=this.getSelectionBoxes(c);if(!d)return;e.empty();let p=w(this,Yl,Sm).call(this,c),g=u(this,xt)===K.NONE,m=()=>{p==null||p.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:d,anchorNode:n,anchorOffset:i,focusNode:o,focusOffset:r,text:a}),g&&this.showAllEditors("highlight",!0,!0)};if(g){this.switchToMode(K.HIGHLIGHT,m);return}m()}addToAnnotationStorage(t){!t.isEmpty()&&u(this,zn)&&!u(this,zn).has(t.id)&&u(this,zn).setValue(t.id,t)}blur(){if(this.isShiftKeyDown=!1,u(this,Ii)&&(_(this,Ii,!1),w(this,Ar,Kd).call(this,"main_toolbar")),!this.hasSelection)return;let{activeElement:t}=document;for(let e of u(this,nt))if(e.div.contains(t)){_(this,Cs,[e,t]),e._focusEventsAllowed=!1;break}}focus(){if(!u(this,Cs))return;let[t,e]=u(this,Cs);_(this,Cs,null),e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}addEditListeners(){w(this,Jl,bm).call(this),w(this,Xl,xm).call(this)}removeEditListeners(){w(this,df,tT).call(this),w(this,Zl,Im).call(this)}dragOver(t){for(let{type:e}of t.dataTransfer.items)for(let n of u(this,Ze))if(n.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(let e of t.dataTransfer.items)for(let n of u(this,Ze))if(n.isHandlingMimeForPasting(e.type)){n.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){var n;if(t.preventDefault(),(n=u(this,ye))==null||n.commitOrRemove(),!this.hasSelection)return;let e=[];for(let i of u(this,nt)){let o=i.serialize(!0);o&&e.push(o)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();let{clipboardData:e}=t;for(let o of e.items)for(let r of u(this,Ze))if(r.isHandlingMimeForPasting(o.type)){r.paste(o,this.currentLayer);return}let n=e.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(o){Y(`paste: "${o.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();let i=this.currentLayer;try{let o=[];for(let l of n){let c=await i.deserialize(l);if(!c)return;o.push(c)}let r=()=>{for(let l of o)w(this,Ql,Rm).call(this,l);w(this,jl,Pm).call(this,o)},a=()=>{for(let l of o)l.remove()};this.addCommands({cmd:r,undo:a,mustExec:!0})}catch(o){Y(`paste: "${o.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),u(this,xt)!==K.NONE&&!this.isEditorHandlingKeyboard&&or._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,u(this,Ii)&&(_(this,Ii,!1),w(this,Ar,Kd).call(this,"main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(t){t?(w(this,cf,Qw).call(this),w(this,Xl,xm).call(this),w(this,Lt,ee).call(this,{isEditing:u(this,xt)!==K.NONE,isEmpty:w(this,bs,tl).call(this),hasSomethingToUndo:u(this,De).hasSomethingToUndo(),hasSomethingToRedo:u(this,De).hasSomethingToRedo(),hasSelectedEditor:!1})):(w(this,uf,jw).call(this),w(this,Zl,Im).call(this),w(this,Lt,ee).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!u(this,Ze)){_(this,Ze,t);for(let e of u(this,Ze))w(this,Qe,Bn).call(this,e.defaultPropertiesToUpdate)}}getId(){return u(this,of).id}get currentLayer(){return u(this,Ft).get(u(this,mr))}getLayer(t){return u(this,Ft).get(t)}get currentPageIndex(){return u(this,mr)}addLayer(t){u(this,Ft).set(t.pageIndex,t),u(this,Ri)?t.enable():t.disable()}removeLayer(t){u(this,Ft).delete(t.pageIndex)}async updateMode(t,e=null,n=!1){var i;if(u(this,xt)!==t&&!(u(this,Fe)&&(await u(this,Fe).promise,!u(this,Fe)))){if(_(this,Fe,Promise.withResolvers()),_(this,xt,t),t===K.NONE){this.setEditingState(!1),w(this,pf,iT).call(this),(i=this._editorUndoBar)==null||i.hide(),u(this,Fe).resolve();return}this.setEditingState(!0),await w(this,ff,nT).call(this),this.unselectAll();for(let o of u(this,Ft).values())o.updateMode(t);if(!e){n&&this.addNewEditorFromKeyboard(),u(this,Fe).resolve();return}for(let o of u(this,Ct).values())o.annotationElementId===e?(this.setSelected(o),o.enterInEditMode()):o.unselect();u(this,Fe).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==u(this,xt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){var n;if(u(this,Ze)){switch(t){case Q.CREATE:this.currentLayer.addNewEditor();return;case Q.HIGHLIGHT_DEFAULT_COLOR:(n=u(this,Vl))==null||n.updateColor(e);break;case Q.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(u(this,zl)||_(this,zl,new Map)).set(t,e),this.showAllEditors("highlight",e);break}for(let i of u(this,nt))i.updateParams(t,e);for(let i of u(this,Ze))i.updateDefaultParams(t,e)}}showAllEditors(t,e,n=!1){var o,r;for(let a of u(this,Ct).values())a.editorType===t&&a.show(e);((r=(o=u(this,zl))==null?void 0:o.get(Q.HIGHLIGHT_SHOW_ALL))!=null?r:!0)!==e&&w(this,Qe,Bn).call(this,[[Q.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(u(this,Hl)!==t){_(this,Hl,t);for(let e of u(this,Ft).values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}getEditors(t){let e=[];for(let n of u(this,Ct).values())n.pageIndex===t&&e.push(n);return e}getEditor(t){return u(this,Ct).get(t)}addEditor(t){u(this,Ct).set(t.id,t)}removeEditor(t){var e;t.div.contains(document.activeElement)&&(u(this,vn)&&clearTimeout(u(this,vn)),_(this,vn,setTimeout(()=>{this.focusMainContainer(),_(this,vn,null)},0))),u(this,Ct).delete(t.id),this.unselect(t),(!t.annotationElementId||!u(this,Ts).has(t.annotationElementId))&&((e=u(this,zn))==null||e.remove(t.id))}addDeletedAnnotationElement(t){u(this,Ts).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return u(this,Ts).has(t)}removeDeletedAnnotationElement(t){u(this,Ts).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}setActiveEditor(t){u(this,ye)!==t&&(_(this,ye,t),t&&w(this,Qe,Bn).call(this,t.propertiesToUpdate))}updateUI(t){u(this,gf,sT)===t&&w(this,Qe,Bn).call(this,t.propertiesToUpdate)}updateUIForDefaultProperties(t){w(this,Qe,Bn).call(this,t.defaultPropertiesToUpdate)}toggleSelected(t){if(u(this,nt).has(t)){u(this,nt).delete(t),t.unselect(),w(this,Lt,ee).call(this,{hasSelectedEditor:this.hasSelection});return}u(this,nt).add(t),t.select(),w(this,Qe,Bn).call(this,t.propertiesToUpdate),w(this,Lt,ee).call(this,{hasSelectedEditor:!0})}setSelected(t){var e;(e=u(this,ws))==null||e.commitOrRemove();for(let n of u(this,nt))n!==t&&n.unselect();u(this,nt).clear(),u(this,nt).add(t),t.select(),w(this,Qe,Bn).call(this,t.propertiesToUpdate),w(this,Lt,ee).call(this,{hasSelectedEditor:!0})}isSelected(t){return u(this,nt).has(t)}get firstSelectedEditor(){return u(this,nt).values().next().value}unselect(t){t.unselect(),u(this,nt).delete(t),w(this,Lt,ee).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return u(this,nt).size!==0}get isEnterHandled(){return u(this,nt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var t;u(this,De).undo(),w(this,Lt,ee).call(this,{hasSomethingToUndo:u(this,De).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:w(this,bs,tl).call(this)}),(t=this._editorUndoBar)==null||t.hide()}redo(){u(this,De).redo(),w(this,Lt,ee).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:u(this,De).hasSomethingToRedo(),isEmpty:w(this,bs,tl).call(this)})}addCommands(t){u(this,De).add(t),w(this,Lt,ee).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:w(this,bs,tl).call(this)})}cleanUndoStack(t){u(this,De).cleanType(t)}delete(){var o;this.commitOrRemove();let t=(o=this.currentLayer)==null?void 0:o.endDrawingSession(!0);if(!this.hasSelection&&!t)return;let e=t?[t]:[...u(this,nt)],n=()=>{var r;(r=this._editorUndoBar)==null||r.show(i,e.length===1?e[0].editorType:e.length);for(let a of e)a.remove()},i=()=>{for(let r of e)w(this,Ql,Rm).call(this,r)};this.addCommands({cmd:n,undo:i,mustExec:!0})}commitOrRemove(){var t;(t=u(this,ye))==null||t.commitOrRemove()}hasSomethingToControl(){return u(this,ye)||this.hasSelection}selectAll(){for(let t of u(this,nt))t.commit();w(this,jl,Pm).call(this,u(this,Ct).values())}unselectAll(){var t;if(!(u(this,ye)&&(u(this,ye).commitOrRemove(),u(this,xt)!==K.NONE))&&!((t=u(this,ws))!=null&&t.commitOrRemove())&&this.hasSelection){for(let e of u(this,nt))e.unselect();u(this,nt).clear(),w(this,Lt,ee).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;u(this,Mi)[0]+=t,u(this,Mi)[1]+=e;let[i,o]=u(this,Mi),r=[...u(this,nt)],a=1e3;u(this,An)&&clearTimeout(u(this,An)),_(this,An,setTimeout(()=>{_(this,An,null),u(this,Mi)[0]=u(this,Mi)[1]=0,this.addCommands({cmd:()=>{for(let l of r)u(this,Ct).has(l.id)&&l.translateInPage(i,o)},undo:()=>{for(let l of r)u(this,Ct).has(l.id)&&l.translateInPage(-i,-o)},mustExec:!1})},a));for(let l of r)l.translateInPage(t,e)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),_(this,yn,new Map);for(let t of u(this,nt))u(this,yn).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!u(this,yn))return!1;this.disableUserSelect(!1);let t=u(this,yn);_(this,yn,null);let e=!1;for(let[{x:i,y:o,pageIndex:r},a]of t)a.newX=i,a.newY=o,a.newPageIndex=r,e||(e=i!==a.savedX||o!==a.savedY||r!==a.savedPageIndex);if(!e)return!1;let n=(i,o,r,a)=>{if(u(this,Ct).has(i.id)){let l=u(this,Ft).get(a);l?i._setParentAndPosition(l,o,r):(i.pageIndex=a,i.x=o,i.y=r)}};return this.addCommands({cmd:()=>{for(let[i,{newX:o,newY:r,newPageIndex:a}]of t)n(i,o,r,a)},undo:()=>{for(let[i,{savedX:o,savedY:r,savedPageIndex:a}]of t)n(i,o,r,a)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(u(this,yn))for(let n of u(this,yn).keys())n.drag(t,e)}rebuild(t){if(t.parent===null){let e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){var t;return((t=this.getActive())==null?void 0:t.shouldGetKeyboardEvents())||u(this,nt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return u(this,ye)===t}getActive(){return u(this,ye)}getMode(){return u(this,xt)}get imageManager(){return Z(this,"imageManager",new Tm)}getSelectionBoxes(t){if(!t)return null;let e=document.getSelection();for(let c=0,d=e.rangeCount;c<d;c++)if(!t.contains(e.getRangeAt(c).commonAncestorContainer))return null;let{x:n,y:i,width:o,height:r}=t.getBoundingClientRect(),a;switch(t.getAttribute("data-main-rotation")){case"90":a=(c,d,p,g)=>({x:(d-i)/r,y:1-(c+p-n)/o,width:g/r,height:p/o});break;case"180":a=(c,d,p,g)=>({x:1-(c+p-n)/o,y:1-(d+g-i)/r,width:p/o,height:g/r});break;case"270":a=(c,d,p,g)=>({x:1-(d+g-i)/r,y:(c-n)/o,width:g/r,height:p/o});break;default:a=(c,d,p,g)=>({x:(c-n)/o,y:(d-i)/r,width:p/o,height:g/r});break}let l=[];for(let c=0,d=e.rangeCount;c<d;c++){let p=e.getRangeAt(c);if(!p.collapsed)for(let{x:g,y:m,width:v,height:A}of p.getClientRects())v===0||A===0||l.push(a(g,m,v,A))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(u(this,gr)||_(this,gr,new Map)).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){var e;(e=u(this,gr))==null||e.delete(t)}renderAnnotationElement(t){var i;let e=(i=u(this,gr))==null?void 0:i.get(t.data.id);if(!e)return;let n=u(this,zn).getRawValue(e);n&&(u(this,xt)===K.NONE&&!n.hasBeenModified||n.renderAnnotationElement(t))}};fr=new WeakMap,ye=new WeakMap,Ct=new WeakMap,Ft=new WeakMap,pr=new WeakMap,zn=new WeakMap,gr=new WeakMap,De=new WeakMap,bi=new WeakMap,ws=new WeakMap,mr=new WeakMap,Ts=new WeakMap,yn=new WeakMap,Ze=new WeakMap,Es=new WeakMap,$l=new WeakMap,Gl=new WeakMap,yr=new WeakMap,Bl=new WeakMap,vn=new WeakMap,xi=new WeakMap,vr=new WeakMap,Ii=new WeakMap,_n=new WeakMap,of=new WeakMap,Ri=new WeakMap,Hl=new WeakMap,Pi=new WeakMap,Cs=new WeakMap,Vl=new WeakMap,ql=new WeakMap,xt=new WeakMap,nt=new WeakMap,Wn=new WeakMap,Ss=new WeakMap,zl=new WeakMap,Wl=new WeakMap,Mi=new WeakMap,An=new WeakMap,Kn=new WeakMap,Kl=new WeakMap,Fe=new WeakMap,_r=new WeakSet,Wd=function({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t},Yl=new WeakSet,Sm=function(t){let{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(let n of u(this,Ft).values())if(n.hasTextLayer(t))return n;return null},rf=new WeakSet,Jw=function(){let t=document.getSelection();if(!t||t.isCollapsed)return;let n=w(this,_r,Wd).call(this,t).closest(".textLayer"),i=this.getSelectionBoxes(n);i&&(u(this,_n)||_(this,_n,new Am(this)),u(this,_n).show(n,i,this.direction==="ltr"))},af=new WeakSet,Xw=function(){var o,r,a;let t=document.getSelection();if(!t||t.isCollapsed){u(this,Wn)&&((o=u(this,_n))==null||o.hide(),_(this,Wn,null),w(this,Lt,ee).call(this,{hasSelectedText:!1}));return}let{anchorNode:e}=t;if(e===u(this,Wn))return;let i=w(this,_r,Wd).call(this,t).closest(".textLayer");if(!i){u(this,Wn)&&((r=u(this,_n))==null||r.hide(),_(this,Wn,null),w(this,Lt,ee).call(this,{hasSelectedText:!1}));return}if((a=u(this,_n))==null||a.hide(),_(this,Wn,e),w(this,Lt,ee).call(this,{hasSelectedText:!0}),!(u(this,xt)!==K.HIGHLIGHT&&u(this,xt)!==K.NONE)&&(u(this,xt)===K.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),_(this,Ii,this.isShiftKeyDown),!this.isShiftKeyDown)){let l=u(this,xt)===K.HIGHLIGHT?w(this,Yl,Sm).call(this,i):null;l==null||l.toggleDrawing();let c=new AbortController,d=this.combinedSignal(c),p=g=>{g.type==="pointerup"&&g.button!==0||(c.abort(),l==null||l.toggleDrawing(!0),g.type==="pointerup"&&w(this,Ar,Kd).call(this,"main_toolbar"))};window.addEventListener("pointerup",p,{signal:d}),window.addEventListener("blur",p,{signal:d})}},Ar=new WeakSet,Kd=function(t=""){u(this,xt)===K.HIGHLIGHT?this.highlightSelection(t):u(this,$l)&&w(this,rf,Jw).call(this)},lf=new WeakSet,Zw=function(){document.addEventListener("selectionchange",w(this,af,Xw).bind(this),{signal:this._signal})},cf=new WeakSet,Qw=function(){if(u(this,xi))return;_(this,xi,new AbortController);let t=this.combinedSignal(u(this,xi));window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})},uf=new WeakSet,jw=function(){var t;(t=u(this,xi))==null||t.abort(),_(this,xi,null)},Jl=new WeakSet,bm=function(){if(u(this,Pi))return;_(this,Pi,new AbortController);let t=this.combinedSignal(u(this,Pi));window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})},df=new WeakSet,tT=function(){var t;(t=u(this,Pi))==null||t.abort(),_(this,Pi,null)},Xl=new WeakSet,xm=function(){if(u(this,bi))return;_(this,bi,new AbortController);let t=this.combinedSignal(u(this,bi));document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})},Zl=new WeakSet,Im=function(){var t;(t=u(this,bi))==null||t.abort(),_(this,bi,null)},hf=new WeakSet,eT=function(){let t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})},Lt=new WeakSet,ee=function(t){Object.entries(t).some(([n,i])=>u(this,Wl)[n]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(u(this,Wl),t)}),u(this,xt)===K.HIGHLIGHT&&t.hasSelectedEditor===!1&&w(this,Qe,Bn).call(this,[[Q.HIGHLIGHT_FREE,!0]]))},Qe=new WeakSet,Bn=function(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})},ff=new WeakSet,nT=async function(){if(!u(this,Ri)){_(this,Ri,!0);let t=[];for(let e of u(this,Ft).values())t.push(e.enable());await Promise.all(t);for(let e of u(this,Ct).values())e.enable()}},pf=new WeakSet,iT=function(){if(this.unselectAll(),u(this,Ri)){_(this,Ri,!1);for(let t of u(this,Ft).values())t.disable();for(let t of u(this,Ct).values())t.disable()}},Ql=new WeakSet,Rm=function(t){let e=u(this,Ft).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))},gf=new WeakSet,sT=function(){let t=null;for(t of u(this,nt));return t},bs=new WeakSet,tl=function(){if(u(this,Ct).size===0)return!0;if(u(this,Ct).size===1)for(let t of u(this,Ct).values())return t.isEmpty();return!1},jl=new WeakSet,Pm=function(t){for(let e of u(this,nt))e.unselect();u(this,nt).clear();for(let e of t)e.isEmpty()||(u(this,nt).add(e),e.select());w(this,Lt,ee).call(this,{hasSelectedEditor:this.hasSelection})},H(or,"TRANSLATE_SMALL",1),H(or,"TRANSLATE_BIG",10);var Oo=or,It,wn,je,wr,Tn,ve,Tr,En,he,Yn,xs,Cn,Ni,Is,el,Er,Yd,ne=class ne{constructor(t){y(this,Is);y(this,Er);y(this,It,null);y(this,wn,!1);y(this,je,null);y(this,wr,null);y(this,Tn,null);y(this,ve,null);y(this,Tr,!1);y(this,En,null);y(this,he,null);y(this,Yn,null);y(this,xs,null);y(this,Cn,!1);_(this,he,t),_(this,Cn,t._uiManager.useNewAltTextFlow),u(ne,Ni)||_(ne,Ni,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(t){var e;(e=ne._l10n)!=null||(ne._l10n=t)}async render(){let t=_(this,je,document.createElement("button"));t.className="altText",t.tabIndex="0";let e=_(this,wr,document.createElement("span"));t.append(e),u(this,Cn)?(t.classList.add("new"),t.setAttribute("data-l10n-id",u(ne,Ni).missing),e.setAttribute("data-l10n-id",u(ne,Ni)["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let n=u(this,he)._uiManager._signal;t.addEventListener("contextmenu",hn,{signal:n}),t.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:n});let i=o=>{o.preventDefault(),u(this,he)._uiManager.editAltText(u(this,he)),u(this,Cn)&&u(this,he)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:u(this,Is,el)}})};return t.addEventListener("click",i,{capture:!0,signal:n}),t.addEventListener("keydown",o=>{o.target===t&&o.key==="Enter"&&(_(this,Tr,!0),i(o))},{signal:n}),await w(this,Er,Yd).call(this),t}finish(){u(this,je)&&(u(this,je).focus({focusVisible:u(this,Tr)}),_(this,Tr,!1))}isEmpty(){return u(this,Cn)?u(this,It)===null:!u(this,It)&&!u(this,wn)}hasData(){return u(this,Cn)?u(this,It)!==null||!!u(this,Yn):this.isEmpty()}get guessedText(){return u(this,Yn)}async setGuessedText(t){u(this,It)===null&&(_(this,Yn,t),_(this,xs,await ne._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t})),w(this,Er,Yd).call(this))}toggleAltTextBadge(t=!1){var e;if(!u(this,Cn)||u(this,It)){(e=u(this,En))==null||e.remove(),_(this,En,null);return}if(!u(this,En)){let n=_(this,En,document.createElement("div"));n.className="noAltTextBadge",u(this,he).div.append(n)}u(this,En).classList.toggle("hidden",!t)}serialize(t){let e=u(this,It);return!t&&u(this,Yn)===e&&(e=u(this,xs)),{altText:e,decorative:u(this,wn),guessedText:u(this,Yn),textWithDisclaimer:u(this,xs)}}get data(){return{altText:u(this,It),decorative:u(this,wn)}}set data({altText:t,decorative:e,guessedText:n,textWithDisclaimer:i,cancel:o=!1}){n&&(_(this,Yn,n),_(this,xs,i)),!(u(this,It)===t&&u(this,wn)===e)&&(o||(_(this,It,t),_(this,wn,e)),w(this,Er,Yd).call(this))}toggle(t=!1){u(this,je)&&(!t&&u(this,ve)&&(clearTimeout(u(this,ve)),_(this,ve,null)),u(this,je).disabled=!t)}shown(){u(this,he)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:u(this,Is,el)}})}destroy(){var t,e;(t=u(this,je))==null||t.remove(),_(this,je,null),_(this,wr,null),_(this,Tn,null),(e=u(this,En))==null||e.remove(),_(this,En,null)}};It=new WeakMap,wn=new WeakMap,je=new WeakMap,wr=new WeakMap,Tn=new WeakMap,ve=new WeakMap,Tr=new WeakMap,En=new WeakMap,he=new WeakMap,Yn=new WeakMap,xs=new WeakMap,Cn=new WeakMap,Ni=new WeakMap,Is=new WeakSet,el=function(){return u(this,It)&&"added"||u(this,It)===null&&this.guessedText&&"review"||"missing"},Er=new WeakSet,Yd=async function(){var i,o,r;let t=u(this,je);if(!t)return;if(u(this,Cn)){if(t.classList.toggle("done",!!u(this,It)),t.setAttribute("data-l10n-id",u(ne,Ni)[u(this,Is,el)]),(i=u(this,wr))==null||i.setAttribute("data-l10n-id",u(ne,Ni)[`${u(this,Is,el)}-label`]),!u(this,It)){(o=u(this,Tn))==null||o.remove();return}}else{if(!u(this,It)&&!u(this,wn)){t.classList.remove("done"),(r=u(this,Tn))==null||r.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=u(this,Tn);if(!e){_(this,Tn,e=document.createElement("span")),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${u(this,he).id}`;let a=100,l=u(this,he)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(u(this,ve)),_(this,ve,null)},{once:!0}),t.addEventListener("mouseenter",()=>{_(this,ve,setTimeout(()=>{_(this,ve,null),u(this,Tn).classList.add("show"),u(this,he)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:l}),t.addEventListener("mouseleave",()=>{var c;u(this,ve)&&(clearTimeout(u(this,ve)),_(this,ve,null)),(c=u(this,Tn))==null||c.classList.remove("show")},{signal:l})}u(this,wn)?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=u(this,It)),e.parentNode||t.append(e);let n=u(this,he).getImageForAltText();n==null||n.setAttribute("aria-describedby",e.id)},y(ne,Ni,null),H(ne,"_l10n",null);var wh=ne,tc,Rs,ec,nc,ic,sc,oc,Cr,Jn,Ps,ki,mf,oT,yf,rT,rc,Mm,Fv=class Fv{constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:n=null,onPinchStart:i=null,onPinching:o=null,onPinchEnd:r=null,signal:a}){y(this,mf);y(this,yf);y(this,rc);y(this,tc,void 0);y(this,Rs,!1);y(this,ec,null);y(this,nc,void 0);y(this,ic,void 0);y(this,sc,void 0);y(this,oc,void 0);y(this,Cr,void 0);y(this,Jn,null);y(this,Ps,void 0);y(this,ki,null);_(this,tc,t),_(this,ec,n),_(this,nc,e),_(this,ic,i),_(this,sc,o),_(this,oc,r),_(this,Ps,new AbortController),_(this,Cr,AbortSignal.any([a,u(this,Ps).signal])),t.addEventListener("touchstart",w(this,mf,oT).bind(this),{passive:!1,signal:u(this,Cr)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return Z(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var t;(t=u(this,Ps))==null||t.abort(),_(this,Ps,null)}};tc=new WeakMap,Rs=new WeakMap,ec=new WeakMap,nc=new WeakMap,ic=new WeakMap,sc=new WeakMap,oc=new WeakMap,Cr=new WeakMap,Jn=new WeakMap,Ps=new WeakMap,ki=new WeakMap,mf=new WeakSet,oT=function(t){var i,o,r;if((i=u(this,nc))!=null&&i.call(this)||t.touches.length<2)return;if(!u(this,ki)){_(this,ki,new AbortController);let a=AbortSignal.any([u(this,Cr),u(this,ki).signal]),l=u(this,tc),c={signal:a,passive:!1};l.addEventListener("touchmove",w(this,yf,rT).bind(this),c),l.addEventListener("touchend",w(this,rc,Mm).bind(this),c),l.addEventListener("touchcancel",w(this,rc,Mm).bind(this),c),(o=u(this,ic))==null||o.call(this)}if(Pe(t),t.touches.length!==2||(r=u(this,ec))!=null&&r.call(this)){_(this,Jn,null);return}let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]),_(this,Jn,{touch0X:e.screenX,touch0Y:e.screenY,touch1X:n.screenX,touch1Y:n.screenY})},yf=new WeakSet,rT=function(t){var b;if(!u(this,Jn)||t.touches.length!==2)return;let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]);let{screenX:i,screenY:o}=e,{screenX:r,screenY:a}=n,l=u(this,Jn),{touch0X:c,touch0Y:d,touch1X:p,touch1Y:g}=l,m=p-c,v=g-d,A=r-i,T=a-o,E=Math.hypot(A,T)||1,C=Math.hypot(m,v)||1;if(!u(this,Rs)&&Math.abs(C-E)<=Fv.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=o,l.touch1X=r,l.touch1Y=a,t.preventDefault(),!u(this,Rs)){_(this,Rs,!0);return}let S=[(i+r)/2,(o+a)/2];(b=u(this,sc))==null||b.call(this,S,C,E)},rc=new WeakSet,Mm=function(t){var e;u(this,ki).abort(),_(this,ki,null),(e=u(this,oc))==null||e.call(this),u(this,Jn)&&(t.preventDefault(),_(this,Jn,null),_(this,Rs,!1))};var Th=Fv,Ms,tn,at,Sr,Di,ac,Ns,Ut,ks,Xn,Fi,lc,Ds,_e,cc,Fs,Zn,Sn,br,xr,Le,Ls,uc,vf,dc,Nm,hc,km,Ir,Jd,_f,aT,Af,lT,fc,Dm,Rr,Xd,pc,Fm,wf,cT,Tf,uT,Ef,dT,gc,Lm,Cf,hT,mc,Um,Sf,fT,bf,pT,xf,gT,yc,Om,Us,nl,J=class J{constructor(t){y(this,dc);y(this,Ir);y(this,_f);y(this,Af);y(this,fc);y(this,Rr);y(this,pc);y(this,wf);y(this,Tf);y(this,Ef);y(this,gc);y(this,Cf);y(this,mc);y(this,Sf);y(this,bf);y(this,xf);y(this,yc);y(this,Us);y(this,Ms,null);y(this,tn,null);y(this,at,null);y(this,Sr,!1);y(this,Di,null);y(this,ac,"");y(this,Ns,!1);y(this,Ut,null);y(this,ks,null);y(this,Xn,null);y(this,Fi,null);y(this,lc,"");y(this,Ds,!1);y(this,_e,null);y(this,cc,!1);y(this,Fs,!1);y(this,Zn,!1);y(this,Sn,null);y(this,br,0);y(this,xr,0);y(this,Le,null);y(this,Ls,null);H(this,"_editToolbar",null);H(this,"_initialOptions",Object.create(null));H(this,"_initialData",null);H(this,"_isVisible",!0);H(this,"_uiManager",null);H(this,"_focusEventsAllowed",!0);y(this,uc,!1);y(this,vf,J._zIndex++);this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;let{rotation:e,rawDims:{pageWidth:n,pageHeight:i,pageX:o,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,i],this.pageTranslation=[o,r];let[a,l]=this.parentDimensions;this.x=t.x/a,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){let t=J.prototype._resizeWithKeyboard,e=Oo.TRANSLATE_SMALL,n=Oo.TRANSLATE_BIG;return Z(this,"_resizerKeyboardManager",new Uo([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,n]}],[["Escape","mac+Escape"],J.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return Z(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){let e=new $m({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){var i;if((i=J._l10n)!=null||(J._l10n=t),J._l10nResizer||(J._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),J._borderLineWidth!==-1)return;let n=getComputedStyle(document.documentElement);J._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){ot("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return u(this,uc)}set _isDraggable(t){var e;_(this,uc,t),(e=this.div)==null||e.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){let[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=u(this,vf)}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):w(this,Us,nl).call(this),this.parent=t}focusin(t){this._focusEventsAllowed&&(u(this,Ds)?_(this,Ds,!1):this.parent.setSelected(this))}focusout(t){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;let e=t.relatedTarget;e!=null&&e.closest(`#${this.id}`)||(t.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,n,i){let[o,r]=this.parentDimensions;[n,i]=this.screenToPageTranslation(n,i),this.x=(t+n)/o,this.y=(e+i)/r,this.fixAndSetPosition()}translate(t,e){w(this,dc,Nm).call(this,this.parentDimensions,t,e)}translateInPage(t,e){u(this,_e)||_(this,_e,[this.x,this.y,this.width,this.height]),w(this,dc,Nm).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}drag(t,e){u(this,_e)||_(this,_e,[this.x,this.y,this.width,this.height]);let{div:n,parentDimensions:[i,o]}=this;if(this.x+=t/i,this.y+=e/o,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:p,y:g}=this.div.getBoundingClientRect();this.parent.findNewParent(this,p,g)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this,[l,c]=this.getBaseTranslation();r+=l,a+=c;let{style:d}=n;d.left=`${(100*r).toFixed(2)}%`,d.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),n.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!u(this,_e)&&(u(this,_e)[0]!==this.x||u(this,_e)[1]!==this.y)}get _hasBeenResized(){return!!u(this,_e)&&(u(this,_e)[2]!==this.width||u(this,_e)[3]!==this.height)}getBaseTranslation(){let[t,e]=this.parentDimensions,{_borderLineWidth:n}=J,i=n/t,o=n/e;switch(this.rotation){case 90:return[-i,o];case 180:return[i,o];case 270:return[i,-o];default:return[-i,-o]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){let{div:{style:e},pageDimensions:[n,i]}=this,{x:o,y:r,width:a,height:l}=this;if(a*=n,l*=i,o*=n,r*=i,this._mustFixPosition)switch(t){case 0:o=Math.max(0,Math.min(n-a,o)),r=Math.max(0,Math.min(i-l,r));break;case 90:o=Math.max(0,Math.min(n-l,o)),r=Math.min(i,Math.max(a,r));break;case 180:o=Math.min(n,Math.max(a,o)),r=Math.min(i,Math.max(l,r));break;case 270:o=Math.min(n,Math.max(l,o)),r=Math.max(0,Math.min(i-a,r));break}this.x=o/=n,this.y=r/=i;let[c,d]=this.getBaseTranslation();o+=c,r+=d,e.left=`${(100*o).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(t,e){var n;return w(n=J,hc,km).call(n,t,e,this.parentRotation)}pageTranslationToScreen(t,e){var n;return w(n=J,hc,km).call(n,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:t,pageDimensions:[e,n]}=this;return[e*t,n*t]}setDims(t,e){let[n,i]=this.parentDimensions,{style:o}=this.div;o.width=`${(100*t/n).toFixed(2)}%`,u(this,Ns)||(o.height=`${(100*e/i).toFixed(2)}%`)}fixDims(){let{style:t}=this.div,{height:e,width:n}=t,i=n.endsWith("%"),o=!u(this,Ns)&&e.endsWith("%");if(i&&o)return;let[r,a]=this.parentDimensions;i||(t.width=`${(100*parseFloat(n)/r).toFixed(2)}%`),!u(this,Ns)&&!o&&(t.height=`${(100*parseFloat(e)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(t){return Math.round(t*1e4)/1e4}_onResizing(){}altTextFinish(){var t;(t=u(this,at))==null||t.finish()}async addEditToolbar(){return this._editToolbar||u(this,Fs)?this._editToolbar:(this._editToolbar=new vm(this),this.div.append(this._editToolbar.render()),u(this,at)&&await this._editToolbar.addAltText(u(this,at)),this._editToolbar)}removeEditToolbar(){var t;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(t=u(this,at))==null||t.destroy())}addContainer(t){var n;let e=(n=this._editToolbar)==null?void 0:n.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){u(this,at)||(wh.initialize(J._l10n),_(this,at,new wh(this)),u(this,Ms)&&(u(this,at).data=u(this,Ms),_(this,Ms,null)),await this.addEditToolbar())}get altTextData(){var t;return(t=u(this,at))==null?void 0:t.data}set altTextData(t){u(this,at)&&(u(this,at).data=t)}get guessedAltText(){var t;return(t=u(this,at))==null?void 0:t.guessedText}async setGuessedAltText(t){var e;await((e=u(this,at))==null?void 0:e.setGuessedText(t))}serializeAltText(t){var e;return(e=u(this,at))==null?void 0:e.serialize(t)}hasAltText(){return!!u(this,at)&&!u(this,at).isEmpty()}hasAltTextData(){var t,e;return(e=(t=u(this,at))==null?void 0:t.hasData())!=null?e:!1}render(){var o;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=u(this,Sr)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),w(this,mc,Um).call(this);let[t,e]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*e/t).toFixed(2)}%`,this.div.style.maxHeight=`${(100*t/e).toFixed(2)}%`);let[n,i]=this.getInitialTranslation();return this.translate(n,i),Ah(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(u(this,Ls)||_(this,Ls,new Th({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:w(this,wf,cT).bind(this),onPinching:w(this,Tf,uT).bind(this),onPinchEnd:w(this,Ef,dT).bind(this),signal:this._uiManager._signal}))),(o=this._uiManager._editorUndoBar)==null||o.hide(),this.div}pointerdown(t){let{isMac:e}=Bt.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(_(this,Ds,!0),this._isDraggable){w(this,Cf,hT).call(this,t);return}w(this,gc,Lm).call(this,t)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){u(this,Sn)&&clearTimeout(u(this,Sn)),_(this,Sn,setTimeout(()=>{var t;_(this,Sn,null),(t=this.parent)==null||t.moveEditorInDOM(this)},0))}_setParentAndPosition(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,n=this.rotation){let i=this.parentScale,[o,r]=this.pageDimensions,[a,l]=this.pageTranslation,c=t/i,d=e/i,p=this.x*o,g=this.y*r,m=this.width*o,v=this.height*r;switch(n){case 0:return[p+c+a,r-g-d-v+l,p+c+m+a,r-g-d+l];case 90:return[p+d+a,r-g+c+l,p+d+v+a,r-g+c+m+l];case 180:return[p-c-m+a,r-g+d+l,p-c+a,r-g+d+v+l];case 270:return[p-d-v+a,r-g-c-m+l,p-d+a,r-g-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){let[n,i,o,r]=t,a=o-n,l=r-i;switch(this.rotation){case 0:return[n,e-r,a,l];case 90:return[n,e-i,l,a];case 180:return[o,e-i,a,l];case 270:return[o,e-r,l,a];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){_(this,Fs,!0)}disableEditMode(){_(this,Fs,!1)}isInEditMode(){return u(this,Fs)}shouldGetKeyboardEvents(){return u(this,Zn)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:t,left:e,bottom:n,right:i}=this.getClientDimensions(),{innerHeight:o,innerWidth:r}=window;return e<r&&i>0&&t<o&&n>0}rebuild(){w(this,mc,Um).call(this)}rotate(t){}resize(){}serializeDeleted(){var t;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((t=this._initialData)==null?void 0:t.popupRef)||""}}serialize(t=!1,e=null){ot("An editor must be serializable")}static async deserialize(t,e,n){let i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:n});i.rotation=t.rotation,_(i,Ms,t.accessibilityData);let[o,r]=i.pageDimensions,[a,l,c,d]=i.getRectInCurrentCoords(t.rect,r);return i.x=a/o,i.y=l/r,i.width=c/o,i.height=d/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var t,e;if((t=u(this,Fi))==null||t.abort(),_(this,Fi,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),u(this,Sn)&&(clearTimeout(u(this,Sn)),_(this,Sn,null)),w(this,Us,nl).call(this),this.removeEditToolbar(),u(this,Le)){for(let n of u(this,Le).values())clearTimeout(n);_(this,Le,null)}this.parent=null,(e=u(this,Ls))==null||e.destroy(),_(this,Ls,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(w(this,_f,aT).call(this),u(this,Ut).classList.remove("hidden"),Ah(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),_(this,Xn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let e=u(this,Ut).children;if(!u(this,tn)){_(this,tn,Array.from(e));let r=w(this,Sf,fT).bind(this),a=w(this,bf,pT).bind(this),l=this._uiManager._signal;for(let c of u(this,tn)){let d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",r,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",w(this,xf,gT).bind(this,d),{signal:l}),c.setAttribute("data-l10n-id",J._l10nResizer[d])}}let n=u(this,tn)[0],i=0;for(let r of e){if(r===n)break;i++}let o=(360-this.rotation+this.parentRotation)%360/90*(u(this,tn).length/4);if(o!==i){if(o<i)for(let a=0;a<i-o;a++)u(this,Ut).append(u(this,Ut).firstChild);else if(o>i)for(let a=0;a<o-i;a++)u(this,Ut).firstChild.before(u(this,Ut).lastChild);let r=0;for(let a of e){let c=u(this,tn)[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",J._l10nResizer[c])}}w(this,yc,Om).call(this,0),_(this,Zn,!0),u(this,Ut).firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){u(this,Zn)&&w(this,pc,Fm).call(this,u(this,lc),{deltaX:t,deltaY:e,fromKeyboard:!0})}_stopResizingWithKeyboard(){w(this,Us,nl).call(this),this.div.focus()}select(){var t,e,n;if(this.makeResizable(),(t=this.div)==null||t.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,o;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((o=this._editToolbar)==null||o.show())});return}(e=this._editToolbar)==null||e.show(),(n=u(this,at))==null||n.toggleAltTextBadge(!1)}unselect(){var t,e,n,i,o;(t=u(this,Ut))==null||t.classList.add("hidden"),(e=this.div)==null||e.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(o=u(this,at))==null||o.toggleAltTextBadge(!0)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return u(this,cc)}set isEditing(t){_(this,cc,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){_(this,Ns,!0);let n=t/e,{style:i}=this.div;i.aspectRatio=n,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){u(this,Le)||_(this,Le,new Map);let{action:n}=t,i=u(this,Le).get(n);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(t),u(this,Le).delete(n),u(this,Le).size===0&&_(this,Le,null)},J._telemetryTimeout),u(this,Le).set(n,i);return}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),_(this,Sr,!1)}disable(){this.div&&(this.div.tabIndex=-1),_(this,Sr,!0)}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){let n=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),n.before(e)}return e}resetAnnotationElement(t){let{firstChild:e}=t.container;(e==null?void 0:e.nodeName)==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}};Ms=new WeakMap,tn=new WeakMap,at=new WeakMap,Sr=new WeakMap,Di=new WeakMap,ac=new WeakMap,Ns=new WeakMap,Ut=new WeakMap,ks=new WeakMap,Xn=new WeakMap,Fi=new WeakMap,lc=new WeakMap,Ds=new WeakMap,_e=new WeakMap,cc=new WeakMap,Fs=new WeakMap,Zn=new WeakMap,Sn=new WeakMap,br=new WeakMap,xr=new WeakMap,Le=new WeakMap,Ls=new WeakMap,uc=new WeakMap,vf=new WeakMap,dc=new WeakSet,Nm=function([t,e],n,i){[n,i]=this.screenToPageTranslation(n,i),this.x+=n/t,this.y+=i/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},hc=new WeakSet,km=function(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}},Ir=new WeakSet,Jd=function(t){switch(t){case 90:{let[e,n]=this.pageDimensions;return[0,-e/n,n/e,0]}case 180:return[-1,0,0,-1];case 270:{let[e,n]=this.pageDimensions;return[0,e/n,-n/e,0]}default:return[1,0,0,1]}},_f=new WeakSet,aT=function(){if(u(this,Ut))return;_(this,Ut,document.createElement("div")),u(this,Ut).classList.add("resizers");let t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(let n of t){let i=document.createElement("div");u(this,Ut).append(i),i.classList.add("resizer",n),i.setAttribute("data-resizer-name",n),i.addEventListener("pointerdown",w(this,Af,lT).bind(this,n),{signal:e}),i.addEventListener("contextmenu",hn,{signal:e}),i.tabIndex=-1}this.div.prepend(u(this,Ut))},Af=new WeakSet,lT=function(t,e){var d;e.preventDefault();let{isMac:n}=Bt.platform;if(e.button!==0||e.ctrlKey&&n)return;(d=u(this,at))==null||d.toggle(!1);let i=this._isDraggable;this._isDraggable=!1,_(this,ks,[e.screenX,e.screenY]);let o=new AbortController,r=this._uiManager.combinedSignal(o);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",w(this,pc,Fm).bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",Pe,{passive:!1,signal:r}),window.addEventListener("contextmenu",hn,{signal:r}),_(this,Xn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;let c=()=>{var p;o.abort(),this.parent.togglePointerEvents(!0),(p=u(this,at))==null||p.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=l,w(this,Rr,Xd).call(this)};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})},fc=new WeakSet,Dm=function(t,e,n,i){this.width=n,this.height=i,this.x=t,this.y=e;let[o,r]=this.parentDimensions;this.setDims(o*n,r*i),this.fixAndSetPosition(),this._onResized()},Rr=new WeakSet,Xd=function(){if(!u(this,Xn))return;let{savedX:t,savedY:e,savedWidth:n,savedHeight:i}=u(this,Xn);_(this,Xn,null);let o=this.x,r=this.y,a=this.width,l=this.height;o===t&&r===e&&a===n&&l===i||this.addCommands({cmd:w(this,fc,Dm).bind(this,o,r,a,l),undo:w(this,fc,Dm).bind(this,t,e,n,i),mustExec:!0})},pc=new WeakSet,Fm=function(t,e){let[n,i]=this.parentDimensions,o=this.x,r=this.y,a=this.width,l=this.height,c=J.MIN_SIZE/n,d=J.MIN_SIZE/i,p=w(this,Ir,Jd).call(this,this.rotation),g=(k,B)=>[p[0]*k+p[2]*B,p[1]*k+p[3]*B],m=w(this,Ir,Jd).call(this,360-this.rotation),v=(k,B)=>[m[0]*k+m[2]*B,m[1]*k+m[3]*B],A,T,E=!1,C=!1;switch(t){case"topLeft":E=!0,A=(k,B)=>[0,0],T=(k,B)=>[k,B];break;case"topMiddle":A=(k,B)=>[k/2,0],T=(k,B)=>[k/2,B];break;case"topRight":E=!0,A=(k,B)=>[k,0],T=(k,B)=>[0,B];break;case"middleRight":C=!0,A=(k,B)=>[k,B/2],T=(k,B)=>[0,B/2];break;case"bottomRight":E=!0,A=(k,B)=>[k,B],T=(k,B)=>[0,0];break;case"bottomMiddle":A=(k,B)=>[k/2,B],T=(k,B)=>[k/2,0];break;case"bottomLeft":E=!0,A=(k,B)=>[0,B],T=(k,B)=>[k,0];break;case"middleLeft":C=!0,A=(k,B)=>[0,B/2],T=(k,B)=>[k,B/2];break}let S=A(a,l),b=T(a,l),x=g(...b),R=J._round(o+x[0]),I=J._round(r+x[1]),N=1,M=1,F,U;if(e.fromKeyboard)({deltaX:F,deltaY:U}=e);else{let{screenX:k,screenY:B}=e,[me,fn]=u(this,ks);[F,U]=this.screenToPageTranslation(k-me,B-fn),u(this,ks)[0]=k,u(this,ks)[1]=B}if([F,U]=v(F/n,U/i),E){let k=Math.hypot(a,l);N=M=Math.max(Math.min(Math.hypot(b[0]-S[0]-F,b[1]-S[1]-U)/k,1/a,1/l),c/a,d/l)}else C?N=Math.max(c,Math.min(1,Math.abs(b[0]-S[0]-F)))/a:M=Math.max(d,Math.min(1,Math.abs(b[1]-S[1]-U)))/l;let j=J._round(a*N),z=J._round(l*M);x=g(...T(j,z));let W=R-x[0],bt=I-x[1];u(this,_e)||_(this,_e,[this.x,this.y,this.width,this.height]),this.width=j,this.height=z,this.x=W,this.y=bt,this.setDims(n*j,i*z),this.fixAndSetPosition(),this._onResizing()},wf=new WeakSet,cT=function(){var t;_(this,Xn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(t=u(this,at))==null||t.toggle(!1),this.parent.togglePointerEvents(!1)},Tf=new WeakSet,uT=function(t,e,n){let o=.7*(n/e)+1-.7;if(o===1)return;let r=w(this,Ir,Jd).call(this,this.rotation),a=(R,I)=>[r[0]*R+r[2]*I,r[1]*R+r[3]*I],[l,c]=this.parentDimensions,d=this.x,p=this.y,g=this.width,m=this.height,v=J.MIN_SIZE/l,A=J.MIN_SIZE/c;o=Math.max(Math.min(o,1/g,1/m),v/g,A/m);let T=J._round(g*o),E=J._round(m*o);if(T===g&&E===m)return;u(this,_e)||_(this,_e,[d,p,g,m]);let C=a(g/2,m/2),S=J._round(d+C[0]),b=J._round(p+C[1]),x=a(T/2,E/2);this.x=S-x[0],this.y=b-x[1],this.width=T,this.height=E,this.setDims(l*T,c*E),this.fixAndSetPosition(),this._onResizing()},Ef=new WeakSet,dT=function(){var t;(t=u(this,at))==null||t.toggle(!0),this.parent.togglePointerEvents(!0),w(this,Rr,Xd).call(this)},gc=new WeakSet,Lm=function(t){let{isMac:e}=Bt.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)},Cf=new WeakSet,hT=function(t){let{isSelected:e}=this;this._uiManager.setUpDragSession();let n=!1,i=new AbortController,o=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:o},a=c=>{i.abort(),_(this,Di,null),_(this,Ds,!1),this._uiManager.endDragSession()||w(this,gc,Lm).call(this,c),n&&this._onStopDragging()};e&&(_(this,br,t.clientX),_(this,xr,t.clientY),_(this,Di,t.pointerId),_(this,ac,t.pointerType),window.addEventListener("pointermove",c=>{n||(n=!0,this._onStartDragging());let{clientX:d,clientY:p,pointerId:g}=c;if(g!==u(this,Di)){Pe(c);return}let[m,v]=this.screenToPageTranslation(d-u(this,br),p-u(this,xr));_(this,br,d),_(this,xr,p),this._uiManager.dragSelectedEditors(m,v)},r),window.addEventListener("touchmove",Pe,r),window.addEventListener("pointerdown",c=>{c.pointerType===u(this,ac)&&(u(this,Ls)||c.isPrimary)&&a(c),Pe(c)},r));let l=c=>{if(!u(this,Di)||u(this,Di)===c.pointerId){a(c);return}Pe(c)};window.addEventListener("pointerup",l,{signal:o}),window.addEventListener("blur",l,{signal:o})},mc=new WeakSet,Um=function(){if(u(this,Fi)||!this.div)return;_(this,Fi,new AbortController);let t=this._uiManager.combinedSignal(u(this,Fi));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})},Sf=new WeakSet,fT=function(t){J._resizerKeyboardManager.exec(this,t)},bf=new WeakSet,pT=function(t){var e;u(this,Zn)&&((e=t.relatedTarget)==null?void 0:e.parentNode)!==u(this,Ut)&&w(this,Us,nl).call(this)},xf=new WeakSet,gT=function(t){_(this,lc,u(this,Zn)?t:"")},yc=new WeakSet,Om=function(t){if(u(this,tn))for(let e of u(this,tn))e.tabIndex=t},Us=new WeakSet,nl=function(){_(this,Zn,!1),w(this,yc,Om).call(this,-1),w(this,Rr,Xd).call(this)},y(J,hc),H(J,"_l10n",null),H(J,"_l10nResizer",null),H(J,"_borderLineWidth",-1),H(J,"_colorManager",new Cm),H(J,"_zIndex",1),H(J,"_telemetryTimeout",1e3);var ft=J,$m=class extends ft{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},Sw=3285377520,ke=4294901760,gn=65535,Eh=class{constructor(t){this.h1=t?t&4294967295:Sw,this.h2=t?t&4294967295:Sw}update(t){let e,n;if(typeof t=="string"){e=new Uint8Array(t.length*2),n=0;for(let A=0,T=t.length;A<T;A++){let E=t.charCodeAt(A);E<=255?e[n++]=E:(e[n++]=E>>>8,e[n++]=E&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),n=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let i=n>>2,o=n-i*4,r=new Uint32Array(e.buffer,0,i),a=0,l=0,c=this.h1,d=this.h2,p=3432918353,g=461845907,m=p&gn,v=g&gn;for(let A=0;A<i;A++)A&1?(a=r[A],a=a*p&ke|a*m&gn,a=a<<15|a>>>17,a=a*g&ke|a*v&gn,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=r[A],l=l*p&ke|l*m&gn,l=l<<15|l>>>17,l=l*g&ke|l*v&gn,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(a=0,o){case 3:a^=e[i*4+2]<<16;case 2:a^=e[i*4+1]<<8;case 1:a^=e[i*4],a=a*p&ke|a*m&gn,a=a<<15|a>>>17,a=a*g&ke|a*v&gn,i&1?c^=a:d^=a}this.h1=c,this.h2=d}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&ke|t*36045&gn,e=e*4283543511&ke|((e<<16|t>>>16)*2950163797&ke)>>>16,t^=e>>>1,t=t*444984403&ke|t*60499&gn,e=e*3301882366&ke|((e<<16|t>>>16)*3120437893&ke)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}},Gm=Object.freeze({map:null,hash:"",transfer:void 0}),Os,$s,Rt,If,mT,Tl=class{constructor(){y(this,If);y(this,Os,!1);y(this,$s,null);y(this,Rt,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){let n=u(this,Rt).get(t);return n===void 0?e:Object.assign(e,n)}getRawValue(t){return u(this,Rt).get(t)}remove(t){if(u(this,Rt).delete(t),u(this,Rt).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let e of u(this,Rt).values())if(e instanceof ft)return;this.onAnnotationEditor(null)}}setValue(t,e){let n=u(this,Rt).get(t),i=!1;if(n!==void 0)for(let[o,r]of Object.entries(e))n[o]!==r&&(i=!0,n[o]=r);else i=!0,u(this,Rt).set(t,e);i&&w(this,If,mT).call(this),e instanceof ft&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return u(this,Rt).has(t)}getAll(){return u(this,Rt).size>0?Pv(u(this,Rt)):null}setAll(t){for(let[e,n]of Object.entries(t))this.setValue(e,n)}get size(){return u(this,Rt).size}resetModified(){u(this,Os)&&(_(this,Os,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Ch(this)}get serializable(){if(u(this,Rt).size===0)return Gm;let t=new Map,e=new Eh,n=[],i=Object.create(null),o=!1;for(let[r,a]of u(this,Rt)){let l=a instanceof ft?a.serialize(!1,i):a;l&&(t.set(r,l),e.update(`${r}:${JSON.stringify(l)}`),o||(o=!!l.bitmap))}if(o)for(let r of t.values())r.bitmap&&n.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:n}:Gm}get editorStats(){var n;let t=null,e=new Map;for(let i of u(this,Rt).values()){if(!(i instanceof ft))continue;let o=i.telemetryFinalData;if(!o)continue;let{type:r}=o;e.has(r)||e.set(r,Object.getPrototypeOf(i).constructor),t||(t=Object.create(null));let a=t[r]||(t[r]=new Map);for(let[l,c]of Object.entries(o)){if(l==="type")continue;let d=a.get(l);d||(d=new Map,a.set(l,d));let p=(n=d.get(c))!=null?n:0;d.set(c,p+1)}}for(let[i,o]of e)t[i]=o.computeTelemetryFinalData(t[i]);return t}resetModifiedIds(){_(this,$s,null)}get modifiedIds(){if(u(this,$s))return u(this,$s);let t=[];for(let e of u(this,Rt).values())!(e instanceof ft)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return _(this,$s,{ids:new Set(t),hash:t.join(",")})}};Os=new WeakMap,$s=new WeakMap,Rt=new WeakMap,If=new WeakSet,mT=function(){u(this,Os)||(_(this,Os,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var vc,Ch=class extends Tl{constructor(e){super();y(this,vc,void 0);let{map:n,hash:i,transfer:o}=e.serializable,r=structuredClone(n,o?{transfer:o}:null);_(this,vc,{map:r,hash:i,transfer:o})}get print(){ot("Should not call PrintAnnotationStorage.print")}get serializable(){return u(this,vc)}get modifiedIds(){return Z(this,"modifiedIds",{ids:new Set,hash:""})}};vc=new WeakMap;var Pr,Bm=class{constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){y(this,Pr,new Set);this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(let t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),u(this,Pr).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,_inspectFont:e}){if(!(!t||u(this,Pr).has(t.loadedName))){if(wt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:n,src:i,style:o}=t,r=new FontFace(n,i,o);this.addNativeFontFace(r);try{await r.load(),u(this,Pr).add(n),e==null||e(t)}catch(a){Y(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}return}ot("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){let n=t.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(i){throw Y(`Failed to load font '${n.family}': '${i}'.`),t.disableFontFace=!0,i}}return}let e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(n=>{let i=this._queueLoadingCallback(n);this._prepareFontLoadEvent(t,i)})}}get isFontLoadingAPISupported(){var e;let t=!!((e=this._document)!=null&&e.fonts);return Z(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let t=!1;return(Qt||typeof navigator!="undefined"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(t=!0),Z(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(t){function e(){for(wt(!i.done,"completeRequest() cannot be called twice."),i.done=!0;n.length>0&&n[0].done;){let o=n.shift();setTimeout(o.callback,0)}}let{loadingRequests:n}=this,i={done:!1,complete:e,callback:t};return n.push(i),i}get _loadTestFont(){let t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Z(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function n(b,x){return b.charCodeAt(x)<<24|b.charCodeAt(x+1)<<16|b.charCodeAt(x+2)<<8|b.charCodeAt(x+3)&255}function i(b,x,R,I){let N=b.substring(0,x),M=b.substring(x+R);return N+I+M}let o,r,a=this._document.createElement("canvas");a.width=1,a.height=1;let l=a.getContext("2d"),c=0;function d(b,x){if(++c>30){Y("Load test font never loaded."),x();return}if(l.font="30px "+b,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){x();return}setTimeout(d.bind(null,b,x))}let p=`lt${Date.now()}${this.loadTestFontId++}`,g=this._loadTestFont;g=i(g,976,p.length,p);let v=16,A=1482184792,T=n(g,v);for(o=0,r=p.length-3;o<r;o+=4)T=T-A+n(p,o)|0;o<p.length&&(T=T-A+n(p+"XXX",o)|0),g=i(g,v,4,AR(T));let E=`url(data:font/opentype;base64,${btoa(g)});`,C=`@font-face {font-family:"${p}";src:${E}}`;this.insertRule(C);let S=this._document.createElement("div");S.style.visibility="hidden",S.style.width=S.style.height="10px",S.style.position="absolute",S.style.top=S.style.left="0px";for(let b of[t.loadedName,p]){let x=this._document.createElement("span");x.textContent="Hi",x.style.fontFamily=b,S.append(x)}this._document.body.append(S),d(p,()=>{S.remove(),e.complete()})}};Pr=new WeakMap;var Hm=class{constructor(t,{disableFontFace:e=!1,fontExtraProperties:n=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(let o in t)this[o]=t[o];this.disableFontFace=e===!0,this.fontExtraProperties=n===!0,this._inspectFont=i}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{let n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(e=this._inspectFont)==null||e.call(this,this),t}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;let t=`url(data:${this.mimetype};base64,${bR(this.data)});`,e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${t}}`}return(n=this._inspectFont)==null||n.call(this,this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];let n=this.loadedName+"_path_"+e,i;try{i=t.get(n)}catch(r){Y(`getPathGenerator - ignoring character: "${r}".`)}let o=new Path2D(i||"");return this.fontExtraProperties||t.delete(n),this.compiledGlyphs[e]=o}},Ud={DATA:1,ERROR:2},At={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function bw(){}function ue(s){if(s instanceof Fn||s instanceof vl||s instanceof Fo||s instanceof vh||s instanceof $a||s instanceof gl)return s;switch(s instanceof Error||typeof s=="object"&&s!==null||ot('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),s.name){case"AbortException":return new Fn(s.message);case"InvalidPDFException":return new vl(s.message);case"MissingPDFException":return new Fo(s.message);case"PasswordException":return new vh(s.message,s.code);case"UnexpectedResponseException":return new $a(s.message,s.status);case"UnknownErrorException":return new gl(s.message,s.details)}return new gl(s.message,s.toString())}var Mr,Rf,yT,Pf,vT,Mf,_T,Nr,Zd,ms=class{constructor(t,e,n){y(this,Rf);y(this,Pf);y(this,Mf);y(this,Nr);y(this,Mr,new AbortController);this.sourceName=t,this.targetName=e,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",w(this,Rf,yT).bind(this),{signal:u(this,Mr).signal})}on(t,e){let n=this.actionHandler;if(n[t])throw new Error(`There is already an actionName called "${t}"`);n[t]=e}send(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}sendWithPromise(t,e,n){let i=this.callbackId++,o=Promise.withResolvers();this.callbackCapabilities[i]=o;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},n)}catch(r){o.reject(r)}return o.promise}sendWithStream(t,e,n,i){let o=this.streamId++,r=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{let d=Promise.withResolvers();return this.streamControllers[o]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:a,action:t,streamId:o,data:e,desiredSize:c.desiredSize},i),d.promise},pull:c=>{let d=Promise.withResolvers();return this.streamControllers[o].pullCall=d,l.postMessage({sourceName:r,targetName:a,stream:At.PULL,streamId:o,desiredSize:c.desiredSize}),d.promise},cancel:c=>{wt(c instanceof Error,"cancel must have a valid reason");let d=Promise.withResolvers();return this.streamControllers[o].cancelCall=d,this.streamControllers[o].isClosed=!0,l.postMessage({sourceName:r,targetName:a,stream:At.CANCEL,streamId:o,reason:ue(c)}),d.promise}},n)}destroy(){var t;(t=u(this,Mr))==null||t.abort(),_(this,Mr,null)}};Mr=new WeakMap,Rf=new WeakSet,yT=function({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){w(this,Mf,_T).call(this,t);return}if(t.callback){let n=t.callbackId,i=this.callbackCapabilities[n];if(!i)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],t.callback===Ud.DATA)i.resolve(t.data);else if(t.callback===Ud.ERROR)i.reject(ue(t.reason));else throw new Error("Unexpected callback case");return}let e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){let n=this.sourceName,i=t.sourceName,o=this.comObj;Promise.try(e,t.data).then(function(r){o.postMessage({sourceName:n,targetName:i,callback:Ud.DATA,callbackId:t.callbackId,data:r})},function(r){o.postMessage({sourceName:n,targetName:i,callback:Ud.ERROR,callbackId:t.callbackId,reason:ue(r)})});return}if(t.streamId){w(this,Pf,vT).call(this,t);return}e(t.data)},Pf=new WeakSet,vT=function(t){let e=t.streamId,n=this.sourceName,i=t.sourceName,o=this.comObj,r=this,a=this.actionHandler[t.action],l={enqueue(c,d=1,p){if(this.isCancelled)return;let g=this.desiredSize;this.desiredSize-=d,g>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:n,targetName:i,stream:At.ENQUEUE,streamId:e,chunk:c},p)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:i,stream:At.CLOSE,streamId:e}),delete r.streamSinks[e])},error(c){wt(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:i,stream:At.ERROR,streamId:e,reason:ue(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(a,t.data,l).then(function(){o.postMessage({sourceName:n,targetName:i,stream:At.START_COMPLETE,streamId:e,success:!0})},function(c){o.postMessage({sourceName:n,targetName:i,stream:At.START_COMPLETE,streamId:e,reason:ue(c)})})},Mf=new WeakSet,_T=function(t){let e=t.streamId,n=this.sourceName,i=t.sourceName,o=this.comObj,r=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case At.START_COMPLETE:t.success?r.startCall.resolve():r.startCall.reject(ue(t.reason));break;case At.PULL_COMPLETE:t.success?r.pullCall.resolve():r.pullCall.reject(ue(t.reason));break;case At.PULL:if(!a){o.postMessage({sourceName:n,targetName:i,stream:At.PULL_COMPLETE,streamId:e,success:!0});break}a.desiredSize<=0&&t.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=t.desiredSize,Promise.try(a.onPull||bw).then(function(){o.postMessage({sourceName:n,targetName:i,stream:At.PULL_COMPLETE,streamId:e,success:!0})},function(c){o.postMessage({sourceName:n,targetName:i,stream:At.PULL_COMPLETE,streamId:e,reason:ue(c)})});break;case At.ENQUEUE:if(wt(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case At.CLOSE:if(wt(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),w(this,Nr,Zd).call(this,r,e);break;case At.ERROR:wt(r,"error should have stream controller"),r.controller.error(ue(t.reason)),w(this,Nr,Zd).call(this,r,e);break;case At.CANCEL_COMPLETE:t.success?r.cancelCall.resolve():r.cancelCall.reject(ue(t.reason)),w(this,Nr,Zd).call(this,r,e);break;case At.CANCEL:if(!a)break;let l=ue(t.reason);Promise.try(a.onCancel||bw,l).then(function(){o.postMessage({sourceName:n,targetName:i,stream:At.CANCEL_COMPLETE,streamId:e,success:!0})},function(c){o.postMessage({sourceName:n,targetName:i,stream:At.CANCEL_COMPLETE,streamId:e,reason:ue(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}},Nr=new WeakSet,Zd=async function(t,e){var n,i,o;await Promise.allSettled([(n=t.startCall)==null?void 0:n.promise,(i=t.pullCall)==null?void 0:i.promise,(o=t.cancelCall)==null?void 0:o.promise]),delete this.streamControllers[e]};var _c,Sh=class{constructor({enableHWA:t=!1}){y(this,_c,!1);_(this,_c,t)}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");let n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!u(this,_c)})}}reset(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){ot("Abstract method `_createCanvas` called.")}};_c=new WeakMap;var Vm=class extends Sh{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){let n=this._document.createElement("canvas");return n.width=t,n.height=e,n}},bh=class{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");let e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){ot("Abstract method `_fetch` called.")}},xh=class extends bh{async _fetch(t){let e=await Up(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Lp(e)}},Ih=class{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,n,i,o){return"none"}destroy(t=!1){}},Gs,kr,Qn,jn,Yt,Bs,Hs,Pt,zt,Vs,il,Li,Qo,Dr,Qd,Ui,jo,Nf,AT,Ac,zm,Oi,tr,qs,sl,zs,ol,wc,Wm,Ws,rl,qm=class extends Ih{constructor({docId:e,ownerDocument:n=globalThis.document}){super();y(this,Pt);y(this,Vs);y(this,Li);y(this,Dr);y(this,Ui);y(this,Nf);y(this,Ac);y(this,Oi);y(this,qs);y(this,zs);y(this,wc);y(this,Ws);y(this,Gs,void 0);y(this,kr,void 0);y(this,Qn,void 0);y(this,jn,void 0);y(this,Yt,void 0);y(this,Bs,void 0);y(this,Hs,0);_(this,jn,e),_(this,Yt,n)}addFilter(e){if(!e)return"none";let n=u(this,Pt,zt).get(e);if(n)return n;let[i,o,r]=w(this,Dr,Qd).call(this,e),a=e.length===1?i:`${i}${o}${r}`;if(n=u(this,Pt,zt).get(a),n)return u(this,Pt,zt).set(e,n),n;let l=`g_${u(this,jn)}_transfer_map_${jt(this,Hs)._++}`,c=w(this,Ui,jo).call(this,l);u(this,Pt,zt).set(e,c),u(this,Pt,zt).set(a,c);let d=w(this,Oi,tr).call(this,l);return w(this,zs,ol).call(this,i,o,r,d),c}addHCMFilter(e,n){var v;let i=`${e}-${n}`,o="base",r=u(this,Vs,il).get(o);if((r==null?void 0:r.key)===i||(r?((v=r.filter)==null||v.remove(),r.key=i,r.url="none",r.filter=null):(r={key:i,url:"none",filter:null},u(this,Vs,il).set(o,r)),!e||!n))return r.url;let a=w(this,Ws,rl).call(this,e);e=$.makeHexColor(...a);let l=w(this,Ws,rl).call(this,n);if(n=$.makeHexColor(...l),u(this,Li,Qo).style.color="",e==="#000000"&&n==="#ffffff"||e===n)return r.url;let c=new Array(256);for(let A=0;A<=255;A++){let T=A/255;c[A]=T<=.03928?T/12.92:((T+.055)/1.055)**2.4}let d=c.join(","),p=`g_${u(this,jn)}_hcm_filter`,g=r.filter=w(this,Oi,tr).call(this,p);w(this,zs,ol).call(this,d,d,d,g),w(this,Ac,zm).call(this,g);let m=(A,T)=>{let E=a[A]/255,C=l[A]/255,S=new Array(T+1);for(let b=0;b<=T;b++)S[b]=E+b/T*(C-E);return S.join(",")};return w(this,zs,ol).call(this,m(0,5),m(1,5),m(2,5),g),r.url=w(this,Ui,jo).call(this,p),r.url}addAlphaFilter(e){let n=u(this,Pt,zt).get(e);if(n)return n;let[i]=w(this,Dr,Qd).call(this,[e]),o=`alpha_${i}`;if(n=u(this,Pt,zt).get(o),n)return u(this,Pt,zt).set(e,n),n;let r=`g_${u(this,jn)}_alpha_map_${jt(this,Hs)._++}`,a=w(this,Ui,jo).call(this,r);u(this,Pt,zt).set(e,a),u(this,Pt,zt).set(o,a);let l=w(this,Oi,tr).call(this,r);return w(this,wc,Wm).call(this,i,l),a}addLuminosityFilter(e){let n=u(this,Pt,zt).get(e||"luminosity");if(n)return n;let i,o;if(e?([i]=w(this,Dr,Qd).call(this,[e]),o=`luminosity_${i}`):o="luminosity",n=u(this,Pt,zt).get(o),n)return u(this,Pt,zt).set(e,n),n;let r=`g_${u(this,jn)}_luminosity_map_${jt(this,Hs)._++}`,a=w(this,Ui,jo).call(this,r);u(this,Pt,zt).set(e,a),u(this,Pt,zt).set(o,a);let l=w(this,Oi,tr).call(this,r);return w(this,Nf,AT).call(this,l),e&&w(this,wc,Wm).call(this,i,l),a}addHighlightHCMFilter(e,n,i,o,r){var C;let a=`${n}-${i}-${o}-${r}`,l=u(this,Vs,il).get(e);if((l==null?void 0:l.key)===a||(l?((C=l.filter)==null||C.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},u(this,Vs,il).set(e,l)),!n||!i))return l.url;let[c,d]=[n,i].map(w(this,Ws,rl).bind(this)),p=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),g=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[m,v]=[o,r].map(w(this,Ws,rl).bind(this));g<p&&([p,g,m,v]=[g,p,v,m]),u(this,Li,Qo).style.color="";let A=(S,b,x)=>{let R=new Array(256),I=(g-p)/x,N=S/255,M=(b-S)/(255*x),F=0;for(let U=0;U<=x;U++){let j=Math.round(p+U*I),z=N+U*M;for(let W=F;W<=j;W++)R[W]=z;F=j+1}for(let U=F;U<256;U++)R[U]=R[F-1];return R.join(",")},T=`g_${u(this,jn)}_hcm_${e}_filter`,E=l.filter=w(this,Oi,tr).call(this,T);return w(this,Ac,zm).call(this,E),w(this,zs,ol).call(this,A(m[0],v[0],5),A(m[1],v[1],5),A(m[2],v[2],5),E),l.url=w(this,Ui,jo).call(this,T),l.url}destroy(e=!1){var n,i,o,r;e&&((n=u(this,Bs))!=null&&n.size)||((i=u(this,Qn))==null||i.parentNode.parentNode.remove(),_(this,Qn,null),(o=u(this,kr))==null||o.clear(),_(this,kr,null),(r=u(this,Bs))==null||r.clear(),_(this,Bs,null),_(this,Hs,0))}};Gs=new WeakMap,kr=new WeakMap,Qn=new WeakMap,jn=new WeakMap,Yt=new WeakMap,Bs=new WeakMap,Hs=new WeakMap,Pt=new WeakSet,zt=function(){return u(this,kr)||_(this,kr,new Map)},Vs=new WeakSet,il=function(){return u(this,Bs)||_(this,Bs,new Map)},Li=new WeakSet,Qo=function(){if(!u(this,Qn)){let e=u(this,Yt).createElement("div"),{style:n}=e;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;let i=u(this,Yt).createElementNS(Gn,"svg");i.setAttribute("width",0),i.setAttribute("height",0),_(this,Qn,u(this,Yt).createElementNS(Gn,"defs")),e.append(i),i.append(u(this,Qn)),u(this,Yt).body.append(e)}return u(this,Qn)},Dr=new WeakSet,Qd=function(e){if(e.length===1){let c=e[0],d=new Array(256);for(let g=0;g<256;g++)d[g]=c[g]/255;let p=d.join(",");return[p,p,p]}let[n,i,o]=e,r=new Array(256),a=new Array(256),l=new Array(256);for(let c=0;c<256;c++)r[c]=n[c]/255,a[c]=i[c]/255,l[c]=o[c]/255;return[r.join(","),a.join(","),l.join(",")]},Ui=new WeakSet,jo=function(e){if(u(this,Gs)===void 0){_(this,Gs,"");let n=u(this,Yt).URL;n!==u(this,Yt).baseURI&&(Op(n)?Y('#createUrl: ignore "data:"-URL for performance reasons.'):_(this,Gs,n.split("#",1)[0]))}return`url(${u(this,Gs)}#${e})`},Nf=new WeakSet,AT=function(e){let n=u(this,Yt).createElementNS(Gn,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(n)},Ac=new WeakSet,zm=function(e){let n=u(this,Yt).createElementNS(Gn,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(n)},Oi=new WeakSet,tr=function(e){let n=u(this,Yt).createElementNS(Gn,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",e),u(this,Li,Qo).append(n),n},qs=new WeakSet,sl=function(e,n,i){let o=u(this,Yt).createElementNS(Gn,n);o.setAttribute("type","discrete"),o.setAttribute("tableValues",i),e.append(o)},zs=new WeakSet,ol=function(e,n,i,o){let r=u(this,Yt).createElementNS(Gn,"feComponentTransfer");o.append(r),w(this,qs,sl).call(this,r,"feFuncR",e),w(this,qs,sl).call(this,r,"feFuncG",n),w(this,qs,sl).call(this,r,"feFuncB",i)},wc=new WeakSet,Wm=function(e,n){let i=u(this,Yt).createElementNS(Gn,"feComponentTransfer");n.append(i),w(this,qs,sl).call(this,i,"feFuncA",e)},Ws=new WeakSet,rl=function(e){return u(this,Li,Qo).style.color=e,kv(getComputedStyle(u(this,Li,Qo)).getPropertyValue("color"))};var Rh=class{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");let e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){ot("Abstract method `_fetch` called.")}},Ph=class extends Rh{async _fetch(t){let e=await Up(t,"arraybuffer");return new Uint8Array(e)}};Qt&&Y("Please use the `legacy` build in Node.js environments.");async function wT(s){let e=await process.getBuiltinModule("fs").promises.readFile(s);return new Uint8Array(e)}var Km=class extends Ih{},Ym=class extends Sh{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(rP.url)("@napi-rs/canvas").createCanvas(t,e)}},Jm=class extends bh{async _fetch(t){return wT(t)}},Xm=class extends Rh{async _fetch(t){return wT(t)}},Zt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Zm(s,t){if(!t)return;let e=t[2]-t[0],n=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],e,n),s.clip(i)}var El=class{getPattern(){ot("Abstract method `getPattern` called.")}},Qm=class extends El{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let n of this._colorStops)e.addColorStop(n[0],n[1]);return e}getPattern(t,e,n,i){let o;if(i===Zt.STROKE||i===Zt.FILL){let r=e.current.getClippedPathBoundingBox(i,ct(t))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,c=e.cachedCanvases.getCanvas("pattern",a,l),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-r[0],-r[1]),n=$.transform(n,[1,0,0,1,r[0],r[1]]),d.transform(...e.baseTransform),this.matrix&&d.transform(...this.matrix),Zm(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),o=t.createPattern(c.canvas,"no-repeat");let p=new DOMMatrix(n);o.setTransform(p)}else Zm(t,this._bbox),o=this._createGradient(t);return o}};function hm(s,t,e,n,i,o,r,a){let l=t.coords,c=t.colors,d=s.data,p=s.width*4,g;l[e+1]>l[n+1]&&(g=e,e=n,n=g,g=o,o=r,r=g),l[n+1]>l[i+1]&&(g=n,n=i,i=g,g=r,r=a,a=g),l[e+1]>l[n+1]&&(g=e,e=n,n=g,g=o,o=r,r=g);let m=(l[e]+t.offsetX)*t.scaleX,v=(l[e+1]+t.offsetY)*t.scaleY,A=(l[n]+t.offsetX)*t.scaleX,T=(l[n+1]+t.offsetY)*t.scaleY,E=(l[i]+t.offsetX)*t.scaleX,C=(l[i+1]+t.offsetY)*t.scaleY;if(v>=C)return;let S=c[o],b=c[o+1],x=c[o+2],R=c[r],I=c[r+1],N=c[r+2],M=c[a],F=c[a+1],U=c[a+2],j=Math.round(v),z=Math.round(C),W,bt,k,B,me,fn,Ln,Me;for(let Ht=j;Ht<=z;Ht++){if(Ht<T){let ut=Ht<v?0:(v-Ht)/(v-T);W=m-(m-A)*ut,bt=S-(S-R)*ut,k=b-(b-I)*ut,B=x-(x-N)*ut}else{let ut;Ht>C?ut=1:T===C?ut=0:ut=(T-Ht)/(T-C),W=A-(A-E)*ut,bt=R-(R-M)*ut,k=I-(I-F)*ut,B=N-(N-U)*ut}let Tt;Ht<v?Tt=0:Ht>C?Tt=1:Tt=(v-Ht)/(v-C),me=m-(m-E)*Tt,fn=S-(S-M)*Tt,Ln=b-(b-F)*Tt,Me=x-(x-U)*Tt;let Go=Math.round(Math.min(W,me)),Ha=Math.round(Math.max(W,me)),He=p*Ht+Go*4;for(let ut=Go;ut<=Ha;ut++)Tt=(W-ut)/(W-me),Tt<0?Tt=0:Tt>1&&(Tt=1),d[He++]=bt-(bt-fn)*Tt|0,d[He++]=k-(k-Ln)*Tt|0,d[He++]=B-(B-Me)*Tt|0,d[He++]=255}}function MR(s,t,e){let n=t.coords,i=t.colors,o,r;switch(t.type){case"lattice":let a=t.verticesPerRow,l=Math.floor(n.length/a)-1,c=a-1;for(o=0;o<l;o++){let d=o*a;for(let p=0;p<c;p++,d++)hm(s,e,n[d],n[d+1],n[d+a],i[d],i[d+1],i[d+a]),hm(s,e,n[d+a+1],n[d+1],n[d+a],i[d+a+1],i[d+1],i[d+a])}break;case"triangles":for(o=0,r=n.length;o<r;o+=3)hm(s,e,n[o],n[o+1],n[o+2],i[o],i[o+1],i[o+2]);break;default:throw new Error("illegal figure")}}var jm=class extends El{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[7],this._background=t[8],this.matrix=null}_createMeshCanvas(t,e,n){let a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,d=Math.ceil(this._bounds[3])-l,p=Math.min(Math.ceil(Math.abs(c*t[0]*1.1)),3e3),g=Math.min(Math.ceil(Math.abs(d*t[1]*1.1)),3e3),m=c/p,v=d/g,A={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/m,scaleY:1/v},T=p+2*2,E=g+2*2,C=n.getCanvas("mesh",T,E),S=C.context,b=S.createImageData(p,g);if(e){let R=b.data;for(let I=0,N=R.length;I<N;I+=4)R[I]=e[0],R[I+1]=e[1],R[I+2]=e[2],R[I+3]=255}for(let R of this._figures)MR(b,R,A);return S.putImageData(b,2,2),{canvas:C.canvas,offsetX:a-2*m,offsetY:l-2*v,scaleX:m,scaleY:v}}getPattern(t,e,n,i){Zm(t,this._bbox);let o;if(i===Zt.SHADING)o=$.singularValueDecompose2dScale(ct(t));else if(o=$.singularValueDecompose2dScale(e.baseTransform),this.matrix){let a=$.singularValueDecompose2dScale(this.matrix);o=[o[0]*a[0],o[1]*a[1]]}let r=this._createMeshCanvas(o,i===Zt.SHADING?null:this._background,e.cachedCanvases);return i!==Zt.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}},ty=class extends El{getPattern(){return"hotpink"}};function NR(s){switch(s[0]){case"RadialAxial":return new Qm(s);case"Mesh":return new jm(s);case"Dummy":return new ty}throw new Error(`Unknown IR type: ${s[0]}`)}var xw={COLORED:1,UNCOLORED:2},kf=class kf{constructor(t,e,n,i,o){this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=e,this.ctx=n,this.canvasGraphicsFactory=i,this.baseTransform=o}createPatternCanvas(t){let{bbox:e,operatorList:n,paintType:i,tilingType:o,color:r,canvasGraphicsFactory:a}=this,{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),Fp("TilingType: "+o);let d=e[0],p=e[1],g=e[2],m=e[3],v=g-d,A=m-p,T=$.singularValueDecompose2dScale(this.matrix),E=$.singularValueDecompose2dScale(this.baseTransform),C=T[0]*E[0],S=T[1]*E[1],b=v,x=A,R=!1,I=!1,N=Math.ceil(l*C),M=Math.ceil(c*S),F=Math.ceil(v*C),U=Math.ceil(A*S);N>=F?b=l:R=!0,M>=U?x=c:I=!0;let j=this.getSizeAndScale(b,this.ctx.canvas.width,C),z=this.getSizeAndScale(x,this.ctx.canvas.height,S),W=t.cachedCanvases.getCanvas("pattern",j.size,z.size),bt=W.context,k=a.createCanvasGraphics(bt);if(k.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(k,i,r),bt.translate(-j.scale*d,-z.scale*p),k.transform(j.scale,0,0,z.scale,0,0),bt.save(),this.clipBbox(k,d,p,g,m),k.baseTransform=ct(k.ctx),k.executeOperatorList(n),k.endDrawing(),bt.restore(),R||I){let B=W.canvas;R&&(b=l),I&&(x=c);let me=this.getSizeAndScale(b,this.ctx.canvas.width,C),fn=this.getSizeAndScale(x,this.ctx.canvas.height,S),Ln=me.size,Me=fn.size,Ht=t.cachedCanvases.getCanvas("pattern-workaround",Ln,Me),Tt=Ht.context,Go=R?Math.floor(v/l):0,Ha=I?Math.floor(A/c):0;for(let He=0;He<=Go;He++)for(let ut=0;ut<=Ha;ut++)Tt.drawImage(B,Ln*He,Me*ut,Ln,Me,0,0,Ln,Me);return{canvas:Ht.canvas,scaleX:me.scale,scaleY:fn.scale,offsetX:d,offsetY:p}}return{canvas:W.canvas,scaleX:j.scale,scaleY:z.scale,offsetX:d,offsetY:p}}getSizeAndScale(t,e,n){let i=Math.max(kf.MAX_PATTERN_SIZE,e),o=Math.ceil(t*n);return o>=i?o=i:n=o/t,{scale:n,size:o}}clipBbox(t,e,n,i,o){let r=i-e,a=o-n;t.ctx.rect(e,n,r,a),t.current.updateRectMinMax(ct(t.ctx),[e,n,i,o]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,n){let i=t.ctx,o=t.current;switch(e){case xw.COLORED:let r=this.ctx;i.fillStyle=r.fillStyle,i.strokeStyle=r.strokeStyle,o.fillColor=r.fillStyle,o.strokeColor=r.strokeStyle;break;case xw.UNCOLORED:let a=$.makeHexColor(n[0],n[1],n[2]);i.fillStyle=a,i.strokeStyle=a,o.fillColor=a,o.strokeColor=a;break;default:throw new mm(`Unsupported paint type: ${e}`)}}getPattern(t,e,n,i){let o=n;i!==Zt.SHADING&&(o=$.transform(o,e.baseTransform),this.matrix&&(o=$.transform(o,this.matrix)));let r=this.createPatternCanvas(e),a=new DOMMatrix(o);a=a.translate(r.offsetX,r.offsetY),a=a.scale(1/r.scaleX,1/r.scaleY);let l=t.createPattern(r.canvas,"repeat");return l.setTransform(a),l}};H(kf,"MAX_PATTERN_SIZE",3e3);var ey=kf;function kR({src:s,srcPos:t=0,dest:e,width:n,height:i,nonBlackColor:o=4294967295,inverseDecode:r=!1}){let a=Bt.isLittleEndian?4278190080:255,[l,c]=r?[o,a]:[a,o],d=n>>3,p=n&7,g=s.length;e=new Uint32Array(e.buffer);let m=0;for(let v=0;v<i;v++){for(let T=t+d;t<T;t++){let E=t<g?s[t]:255;e[m++]=E&128?c:l,e[m++]=E&64?c:l,e[m++]=E&32?c:l,e[m++]=E&16?c:l,e[m++]=E&8?c:l,e[m++]=E&4?c:l,e[m++]=E&2?c:l,e[m++]=E&1?c:l}if(p===0)continue;let A=t<g?s[t++]:255;for(let T=0;T<p;T++)e[m++]=A&1<<7-T?c:l}return{srcPos:t,destPos:m}}var Iw=16,Rw=100,DR=15,Pw=10,Mw=1e3,ge=16;function FR(s,t){if(s._removeMirroring)throw new Error("Context is already forwarding operations.");s.__originalSave=s.save,s.__originalRestore=s.restore,s.__originalRotate=s.rotate,s.__originalScale=s.scale,s.__originalTranslate=s.translate,s.__originalTransform=s.transform,s.__originalSetTransform=s.setTransform,s.__originalResetTransform=s.resetTransform,s.__originalClip=s.clip,s.__originalMoveTo=s.moveTo,s.__originalLineTo=s.lineTo,s.__originalBezierCurveTo=s.bezierCurveTo,s.__originalRect=s.rect,s.__originalClosePath=s.closePath,s.__originalBeginPath=s.beginPath,s._removeMirroring=()=>{s.save=s.__originalSave,s.restore=s.__originalRestore,s.rotate=s.__originalRotate,s.scale=s.__originalScale,s.translate=s.__originalTranslate,s.transform=s.__originalTransform,s.setTransform=s.__originalSetTransform,s.resetTransform=s.__originalResetTransform,s.clip=s.__originalClip,s.moveTo=s.__originalMoveTo,s.lineTo=s.__originalLineTo,s.bezierCurveTo=s.__originalBezierCurveTo,s.rect=s.__originalRect,s.closePath=s.__originalClosePath,s.beginPath=s.__originalBeginPath,delete s._removeMirroring},s.save=function(){t.save(),this.__originalSave()},s.restore=function(){t.restore(),this.__originalRestore()},s.translate=function(n,i){t.translate(n,i),this.__originalTranslate(n,i)},s.scale=function(n,i){t.scale(n,i),this.__originalScale(n,i)},s.transform=function(n,i,o,r,a,l){t.transform(n,i,o,r,a,l),this.__originalTransform(n,i,o,r,a,l)},s.setTransform=function(n,i,o,r,a,l){t.setTransform(n,i,o,r,a,l),this.__originalSetTransform(n,i,o,r,a,l)},s.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},s.rotate=function(n){t.rotate(n),this.__originalRotate(n)},s.clip=function(n){t.clip(n),this.__originalClip(n)},s.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},s.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},s.bezierCurveTo=function(e,n,i,o,r,a){t.bezierCurveTo(e,n,i,o,r,a),this.__originalBezierCurveTo(e,n,i,o,r,a)},s.rect=function(e,n,i,o){t.rect(e,n,i,o),this.__originalRect(e,n,i,o)},s.closePath=function(){t.closePath(),this.__originalClosePath()},s.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}var ny=class{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,n){let i;return this.cache[t]!==void 0?(i=this.cache[t],this.canvasFactory.reset(i,e,n)):(i=this.canvasFactory.create(e,n),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(let t in this.cache){let e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}};function Od(s,t,e,n,i,o,r,a,l,c){let[d,p,g,m,v,A]=ct(s);if(p===0&&g===0){let C=r*d+v,S=Math.round(C),b=a*m+A,x=Math.round(b),R=(r+l)*d+v,I=Math.abs(Math.round(R)-S)||1,N=(a+c)*m+A,M=Math.abs(Math.round(N)-x)||1;return s.setTransform(Math.sign(d),0,0,Math.sign(m),S,x),s.drawImage(t,e,n,i,o,0,0,I,M),s.setTransform(d,p,g,m,v,A),[I,M]}if(d===0&&m===0){let C=a*g+v,S=Math.round(C),b=r*p+A,x=Math.round(b),R=(a+c)*g+v,I=Math.abs(Math.round(R)-S)||1,N=(r+l)*p+A,M=Math.abs(Math.round(N)-x)||1;return s.setTransform(0,Math.sign(p),Math.sign(g),0,S,x),s.drawImage(t,e,n,i,o,0,0,M,I),s.setTransform(d,p,g,m,v,A),[M,I]}s.drawImage(t,e,n,i,o,r,a,l,c);let T=Math.hypot(d,p),E=Math.hypot(g,m);return[T*l,E*c]}function LR(s){let{width:t,height:e}=s;if(t>Mw||e>Mw)return null;let n=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),o=t+1,r=new Uint8Array(o*(e+1)),a,l,c,d=t+7&-8,p=new Uint8Array(d*e),g=0;for(let E of s.data){let C=128;for(;C>0;)p[g++]=E&C?0:255,C>>=1}let m=0;for(g=0,p[g]!==0&&(r[0]=1,++m),l=1;l<t;l++)p[g]!==p[g+1]&&(r[l]=p[g]?2:1,++m),g++;for(p[g]!==0&&(r[l]=2,++m),a=1;a<e;a++){g=a*d,c=a*o,p[g-d]!==p[g]&&(r[c]=p[g]?1:8,++m);let E=(p[g]?4:0)+(p[g-d]?8:0);for(l=1;l<t;l++)E=(E>>2)+(p[g+1]?4:0)+(p[g-d+1]?8:0),i[E]&&(r[c+l]=i[E],++m),g++;if(p[g-d]!==p[g]&&(r[c+l]=p[g]?2:4,++m),m>n)return null}for(g=d*(e-1),c=a*o,p[g]!==0&&(r[c]=8,++m),l=1;l<t;l++)p[g]!==p[g+1]&&(r[c+l]=p[g]?4:8,++m),g++;if(p[g]!==0&&(r[c+l]=4,++m),m>n)return null;let v=new Int32Array([0,o,-1,0,-o,0,0,0,1]),A=new Path2D;for(a=0;m&&a<=e;a++){let E=a*o,C=E+t;for(;E<C&&!r[E];)E++;if(E===C)continue;A.moveTo(E%o,a);let S=E,b=r[E];do{let x=v[b];do E+=x;while(!r[E]);let R=r[E];R!==5&&R!==10?(b=R,r[E]=0):(b=R&51*b>>4,r[E]&=b>>2|b<<2),A.lineTo(E%o,E/o|0),r[E]||--m}while(S!==E);--a}return p=null,r=null,function(E){E.save(),E.scale(1/t,-1/e),E.translate(0,-e),E.fill(A),E.beginPath(),E.restore()}}var Mh=class{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=$w,this.textMatrixScale=1,this.fontMatrix=gm,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=qt.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){let t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}setCurrentPoint(t,e){this.x=t,this.y=e}updatePathMinMax(t,e,n){[e,n]=$.applyTransform([e,n],t),this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(t,e){let n=$.applyTransform(e,t),i=$.applyTransform(e.slice(2),t),o=$.applyTransform([e[0],e[3]],t),r=$.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,n[0],i[0],o[0],r[0]),this.minY=Math.min(this.minY,n[1],i[1],o[1],r[1]),this.maxX=Math.max(this.maxX,n[0],i[0],o[0],r[0]),this.maxY=Math.max(this.maxY,n[1],i[1],o[1],r[1])}updateScalingPathMinMax(t,e){$.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,n,i,o,r,a,l,c,d){let p=$.bezierBoundingBox(e,n,i,o,r,a,l,c,d);d||this.updateRectMinMax(t,p)}getPathBoundingBox(t=Zt.FILL,e=null){let n=[this.minX,this.minY,this.maxX,this.maxY];if(t===Zt.STROKE){e||ot("Stroke bounding box must include transform.");let i=$.singularValueDecompose2dScale(e),o=i[0]*this.lineWidth/2,r=i[1]*this.lineWidth/2;n[0]-=o,n[1]-=r,n[2]+=o,n[3]+=r}return n}updateClipFromPath(){let t=$.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=Zt.FILL,e=null){return $.intersect(this.clipBox,this.getPathBoundingBox(t,e))}};function Nw(s,t){if(t instanceof ImageData){s.putImageData(t,0,0);return}let e=t.height,n=t.width,i=e%ge,o=(e-i)/ge,r=i===0?o:o+1,a=s.createImageData(n,ge),l=0,c,d=t.data,p=a.data,g,m,v,A;if(t.kind===Hd.GRAYSCALE_1BPP){let T=d.byteLength,E=new Uint32Array(p.buffer,0,p.byteLength>>2),C=E.length,S=n+7>>3,b=4294967295,x=Bt.isLittleEndian?4278190080:255;for(g=0;g<r;g++){for(v=g<o?ge:i,c=0,m=0;m<v;m++){let R=T-l,I=0,N=R>S?n:R*8-7,M=N&-8,F=0,U=0;for(;I<M;I+=8)U=d[l++],E[c++]=U&128?b:x,E[c++]=U&64?b:x,E[c++]=U&32?b:x,E[c++]=U&16?b:x,E[c++]=U&8?b:x,E[c++]=U&4?b:x,E[c++]=U&2?b:x,E[c++]=U&1?b:x;for(;I<N;I++)F===0&&(U=d[l++],F=128),E[c++]=U&F?b:x,F>>=1}for(;c<C;)E[c++]=0;s.putImageData(a,0,g*ge)}}else if(t.kind===Hd.RGBA_32BPP){for(m=0,A=n*ge*4,g=0;g<o;g++)p.set(d.subarray(l,l+A)),l+=A,s.putImageData(a,0,m),m+=ge;g<r&&(A=n*i*4,p.set(d.subarray(l,l+A)),s.putImageData(a,0,m))}else if(t.kind===Hd.RGB_24BPP)for(v=ge,A=n*v,g=0;g<r;g++){for(g>=o&&(v=i,A=n*v),c=0,m=A;m--;)p[c++]=d[l++],p[c++]=d[l++],p[c++]=d[l++],p[c++]=255;s.putImageData(a,0,g*ge)}else throw new Error(`bad image kind: ${t.kind}`)}function kw(s,t){if(t.bitmap){s.drawImage(t.bitmap,0,0);return}let e=t.height,n=t.width,i=e%ge,o=(e-i)/ge,r=i===0?o:o+1,a=s.createImageData(n,ge),l=0,c=t.data,d=a.data;for(let p=0;p<r;p++){let g=p<o?ge:i;({srcPos:l}=kR({src:c,srcPos:l,dest:d,width:n,height:g,nonBlackColor:0})),s.putImageData(a,0,p*ge)}}function Xa(s,t){let e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let n of e)s[n]!==void 0&&(t[n]=s[n]);s.setLineDash!==void 0&&(t.setLineDash(s.getLineDash()),t.lineDashOffset=s.lineDashOffset)}function $d(s){if(s.strokeStyle=s.fillStyle="#000000",s.fillRule="nonzero",s.globalAlpha=1,s.lineWidth=1,s.lineCap="butt",s.lineJoin="miter",s.miterLimit=10,s.globalCompositeOperation="source-over",s.font="10px sans-serif",s.setLineDash!==void 0&&(s.setLineDash([]),s.lineDashOffset=0),!Qt){let{filter:t}=s;t!=="none"&&t!==""&&(s.filter="none")}}function Dw(s,t){if(t)return!0;let e=$.singularValueDecompose2dScale(s);e[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]);let n=Math.fround((globalThis.devicePixelRatio||1)*as.PDF_TO_CSS_UNITS);return e[0]<=n&&e[1]<=n}var UR=["butt","round","square"],OR=["miter","round","bevel"],$R={},Fw={},Tc,iy,Ec,sy,Cc,oy,Lv=class Lv{constructor(t,e,n,i,o,{optionalContentConfig:r,markedContentStack:a=null},l,c){y(this,Tc);y(this,Ec);y(this,Cc);this.ctx=t,this.current=new Mh(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=n,this.canvasFactory=i,this.filterFactory=o,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new ny(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:n=!1,background:i=null}){let o=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,o,r),this.ctx.fillStyle=a,n){let l=this.cachedCanvases.getCanvas("transparent",o,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...ct(this.compositeCtx))}this.ctx.save(),$d(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=ct(this.ctx)}executeOperatorList(t,e,n,i){let o=t.argsArray,r=t.fnArray,a=e||0,l=o.length;if(l===a)return a;let c=l-a>Pw&&typeof n=="function",d=c?Date.now()+DR:0,p=0,g=this.commonObjs,m=this.objs,v;for(;;){if(i!==void 0&&a===i.nextBreakPoint)return i.breakIt(a,n),a;if(v=r[a],v!==Je.dependency)this[v].apply(this,o[a]);else for(let A of o[a]){let T=A.startsWith("g_")?g:m;if(!T.has(A))return T.get(A,n),a}if(a++,a===l)return a;if(c&&++p>Pw){if(Date.now()>d)return n(),a;p=0}}}endDrawing(){w(this,Tc,iy).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let t of this._cachedBitmapsMap.values()){for(let e of t.values())typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),w(this,Ec,sy).call(this)}_scaleImage(t,e){var g,m;let n=(g=t.width)!=null?g:t.displayWidth,i=(m=t.height)!=null?m:t.displayHeight,o=Math.max(Math.hypot(e[0],e[1]),1),r=Math.max(Math.hypot(e[2],e[3]),1),a=n,l=i,c="prescale1",d,p;for(;o>2&&a>1||r>2&&l>1;){let v=a,A=l;o>2&&a>1&&(v=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),o/=a/v),r>2&&l>1&&(A=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/A),d=this.cachedCanvases.getCanvas(c,v,A),p=d.context,p.clearRect(0,0,v,A),p.drawImage(t,0,0,a,l,0,0,v,A),t=d.canvas,a=v,l=A,c=c==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:l}}_createMaskCanvas(t){let e=this.ctx,{width:n,height:i}=t,o=this.current.fillColor,r=this.current.patternFill,a=ct(e),l,c,d,p;if((t.bitmap||t.data)&&t.count>1){let N=t.bitmap||t.data.buffer;c=JSON.stringify(r?a:[a.slice(0,4),o]),l=this._cachedBitmapsMap.get(N),l||(l=new Map,this._cachedBitmapsMap.set(N,l));let M=l.get(c);if(M&&!r){let F=Math.round(Math.min(a[0],a[2])+a[4]),U=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:M,offsetX:F,offsetY:U}}d=M}d||(p=this.cachedCanvases.getCanvas("maskCanvas",n,i),kw(p.context,t));let g=$.transform(a,[1/n,0,0,-1/i,0,0]);g=$.transform(g,[1,0,0,1,0,-i]);let[m,v,A,T]=$.getAxialAlignedBoundingBox([0,0,n,i],g),E=Math.round(A-m)||1,C=Math.round(T-v)||1,S=this.cachedCanvases.getCanvas("fillCanvas",E,C),b=S.context,x=m,R=v;b.translate(-x,-R),b.transform(...g),d||(d=this._scaleImage(p.canvas,pn(b)),d=d.img,l&&r&&l.set(c,d)),b.imageSmoothingEnabled=Dw(ct(b),t.interpolate),Od(b,d,0,0,d.width,d.height,0,0,n,i),b.globalCompositeOperation="source-in";let I=$.transform(pn(b),[1,0,0,1,-x,-R]);return b.fillStyle=r?o.getPattern(e,this,I,Zt.FILL):o,b.fillRect(0,0,n,i),l&&!r&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,S.canvas)),{canvas:S.canvas,offsetX:Math.round(x),offsetY:Math.round(R)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=UR[t]}setLineJoin(t){this.ctx.lineJoin=OR[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){let n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(t),n.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(let[e,n]of t)switch(e){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let t=this.ctx.canvas.width,e=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(n,t,e);this.suspendedCtx=this.ctx,this.ctx=i.context;let o=this.ctx;o.setTransform(...ct(this.suspendedCtx)),Xa(this.suspendedCtx,o),FR(o,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Xa(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,n,i){let o=i[0],r=i[1],a=i[2]-o,l=i[3]-r;a===0||l===0||(this.genericComposeSMask(e.context,n,a,l,e.subtype,e.backdrop,e.transferMap,o,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}genericComposeSMask(t,e,n,i,o,r,a,l,c,d,p){let g=t.canvas,m=l-d,v=c-p;if(r){let T=$.makeHexColor(...r);if(m<0||v<0||m+n>g.width||v+i>g.height){let E=this.cachedCanvases.getCanvas("maskExtension",n,i),C=E.context;C.drawImage(g,-m,-v),C.globalCompositeOperation="destination-atop",C.fillStyle=T,C.fillRect(0,0,n,i),C.globalCompositeOperation="source-over",g=E.canvas,m=v=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);let E=new Path2D;E.rect(m,v,n,i),t.clip(E),t.globalCompositeOperation="destination-atop",t.fillStyle=T,t.fillRect(m,v,n,i),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),o==="Alpha"&&a?e.filter=this.filterFactory.addAlphaFilter(a):o==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(a));let A=new Path2D;A.rect(l,c,n,i),e.clip(A),e.globalCompositeOperation="destination-in",e.drawImage(g,m,v,n,i,l,c,n,i),e.restore()}save(){this.inSMaskMode?(Xa(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Xa(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(t,e,n,i,o,r){this.ctx.transform(t,e,n,i,o,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,n){let i=this.ctx,o=this.current,r=o.x,a=o.y,l,c,d=ct(i),p=d[0]===0&&d[3]===0||d[1]===0&&d[2]===0,g=p?n.slice(0):null;for(let m=0,v=0,A=t.length;m<A;m++)switch(t[m]|0){case Je.rectangle:r=e[v++],a=e[v++];let T=e[v++],E=e[v++],C=r+T,S=a+E;i.moveTo(r,a),T===0||E===0?i.lineTo(C,S):(i.lineTo(C,a),i.lineTo(C,S),i.lineTo(r,S)),p||o.updateRectMinMax(d,[r,a,C,S]),i.closePath();break;case Je.moveTo:r=e[v++],a=e[v++],i.moveTo(r,a),p||o.updatePathMinMax(d,r,a);break;case Je.lineTo:r=e[v++],a=e[v++],i.lineTo(r,a),p||o.updatePathMinMax(d,r,a);break;case Je.curveTo:l=r,c=a,r=e[v+4],a=e[v+5],i.bezierCurveTo(e[v],e[v+1],e[v+2],e[v+3],r,a),o.updateCurvePathMinMax(d,l,c,e[v],e[v+1],e[v+2],e[v+3],r,a,g),v+=6;break;case Je.curveTo2:l=r,c=a,i.bezierCurveTo(r,a,e[v],e[v+1],e[v+2],e[v+3]),o.updateCurvePathMinMax(d,l,c,r,a,e[v],e[v+1],e[v+2],e[v+3],g),r=e[v+2],a=e[v+3],v+=4;break;case Je.curveTo3:l=r,c=a,r=e[v+2],a=e[v+3],i.bezierCurveTo(e[v],e[v+1],r,a,r,a),o.updateCurvePathMinMax(d,l,c,e[v],e[v+1],r,a,r,a,g),v+=4;break;case Je.closePath:i.closePath();break}p&&o.updateScalingPathMinMax(d,g),o.setCurrentPoint(r,a)}closePath(){this.ctx.closePath()}stroke(t=!0){let e=this.ctx,n=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof n=="object"&&(n!=null&&n.getPattern)?(e.save(),e.strokeStyle=n.getPattern(e,this,pn(e),Zt.STROKE),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(t=!0){let e=this.ctx,n=this.current.fillColor,i=this.current.patternFill,o=!1;i&&(e.save(),e.fillStyle=n.getPattern(e,this,pn(e),Zt.FILL),o=!0);let r=this.current.getClippedPathBoundingBox();this.contentVisible&&r!==null&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),o&&e.restore(),t&&this.consumePath(r)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=$R}eoClip(){this.pendingClip=Fw}beginText(){this.current.textMatrix=$w,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let t=this.pendingTextPaths,e=this.ctx;if(t===void 0){e.beginPath();return}let n=new Path2D,i=e.getTransform().invertSelf();for(let{transform:o,x:r,y:a,fontSize:l,path:c}of t)n.addPath(c,new DOMMatrix(o).preMultiplySelf(i).translate(r,a).scale(l,-l));e.clip(n),e.beginPath(),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){var d;let n=this.commonObjs.get(t),i=this.current;if(!n)throw new Error(`Can't find font for ${t}`);if(i.fontMatrix=n.fontMatrix||gm,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&Y("Invalid font matrix for font "+t),e<0?(e=-e,i.fontDirection=-1):i.fontDirection=1,this.current.font=n,this.current.fontSize=e,n.isType3Font)return;let o=n.loadedName||"sans-serif",r=((d=n.systemFontInfo)==null?void 0:d.css)||`"${o}", ${n.fallbackName}`,a="normal";n.black?a="900":n.bold&&(a="bold");let l=n.italic?"italic":"normal",c=e;e<Iw?c=Iw:e>Rw&&(c=Rw),this.current.fontSizeScale=e/c,this.ctx.font=`${l} ${a} ${c}px ${r}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,n,i,o,r){this.current.textMatrix=[t,e,n,i,o,r],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,n,i,o){let r=this.ctx,a=this.current,l=a.font,c=a.textRenderingMode,d=a.fontSize/a.fontSizeScale,p=c&qt.FILL_STROKE_MASK,g=!!(c&qt.ADD_TO_PATH_FLAG),m=a.patternFill&&!l.missingFile,v=a.patternStroke&&!l.missingFile,A;if((l.disableFontFace||g||m||v)&&(A=l.getPathGenerator(this.commonObjs,t)),l.disableFontFace||m||v){if(r.save(),r.translate(e,n),r.scale(d,-d),p===qt.FILL||p===qt.FILL_STROKE)if(i){let T=r.getTransform();r.setTransform(...i),r.fill(w(this,Cc,oy).call(this,A,T,i))}else r.fill(A);if(p===qt.STROKE||p===qt.FILL_STROKE)if(o){let T=r.getTransform();r.setTransform(...o),r.stroke(w(this,Cc,oy).call(this,A,T,o))}else r.lineWidth/=d,r.stroke(A);r.restore()}else(p===qt.FILL||p===qt.FILL_STROKE)&&r.fillText(t,e,n),(p===qt.STROKE||p===qt.FILL_STROKE)&&r.strokeText(t,e,n);g&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:ct(r),x:e,y:n,fontSize:d,path:A})}get isFontSubpixelAAEnabled(){let{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);let e=t.getImageData(0,0,10,10).data,n=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){n=!0;break}return Z(this,"isFontSubpixelAAEnabled",n)}showText(t){let e=this.current,n=e.font;if(n.isType3Font)return this.showType3Text(t);let i=e.fontSize;if(i===0)return;let o=this.ctx,r=e.fontSizeScale,a=e.charSpacing,l=e.wordSpacing,c=e.fontDirection,d=e.textHScale*c,p=t.length,g=n.vertical,m=g?1:-1,v=n.defaultVMetrics,A=i*e.fontMatrix[0],T=e.textRenderingMode===qt.FILL&&!n.disableFontFace&&!e.patternFill;o.save(),o.transform(...e.textMatrix),o.translate(e.x,e.y+e.textRise),c>0?o.scale(d,-1):o.scale(d,1);let E,C;if(e.patternFill){o.save();let I=e.fillColor.getPattern(o,this,pn(o),Zt.FILL);E=ct(o),o.restore(),o.fillStyle=I}if(e.patternStroke){o.save();let I=e.strokeColor.getPattern(o,this,pn(o),Zt.STROKE);C=ct(o),o.restore(),o.strokeStyle=I}let S=e.lineWidth,b=e.textMatrixScale;if(b===0||S===0){let I=e.textRenderingMode&qt.FILL_STROKE_MASK;(I===qt.STROKE||I===qt.FILL_STROKE)&&(S=this.getSinglePixelWidth())}else S/=b;if(r!==1&&(o.scale(r,r),S/=r),o.lineWidth=S,n.isInvalidPDFjsFont){let I=[],N=0;for(let M of t)I.push(M.unicode),N+=M.width;o.fillText(I.join(""),0,0),e.x+=N*A*d,o.restore(),this.compose();return}let x=0,R;for(R=0;R<p;++R){let I=t[R];if(typeof I=="number"){x+=m*I*i/1e3;continue}let N=!1,M=(I.isSpace?l:0)+a,F=I.fontChar,U=I.accent,j,z,W=I.width;if(g){let k=I.vmetric||v,B=-(I.vmetric?k[1]:W*.5)*A,me=k[2]*A;W=k?-k[0]:W,j=B/r,z=(x+me)/r}else j=x/r,z=0;if(n.remeasure&&W>0){let k=o.measureText(F).width*1e3/i*r;if(W<k&&this.isFontSubpixelAAEnabled){let B=W/k;N=!0,o.save(),o.scale(B,1),j/=B}else W!==k&&(j+=(W-k)/2e3*i/r)}if(this.contentVisible&&(I.isInFont||n.missingFile)){if(T&&!U)o.fillText(F,j,z);else if(this.paintChar(F,j,z,E,C),U){let k=j+i*U.offset.x/r,B=z-i*U.offset.y/r;this.paintChar(U.fontChar,k,B,E,C)}}let bt=g?W*A-M*c:W*A+M*c;x+=bt,N&&o.restore()}g?e.y-=x:e.x+=x*d,o.restore(),this.compose()}showType3Text(t){let e=this.ctx,n=this.current,i=n.font,o=n.fontSize,r=n.fontDirection,a=i.vertical?1:-1,l=n.charSpacing,c=n.wordSpacing,d=n.textHScale*r,p=n.fontMatrix||gm,g=t.length,m=n.textRenderingMode===qt.INVISIBLE,v,A,T,E;if(!(m||o===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),e.transform(...n.textMatrix),e.translate(n.x,n.y),e.scale(d,r),v=0;v<g;++v){if(A=t[v],typeof A=="number"){E=a*A*o/1e3,this.ctx.translate(E,0),n.x+=E*d;continue}let C=(A.isSpace?c:0)+l,S=i.charProcOperatorList[A.operatorListId];if(!S){Y(`Type3 character "${A.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=A,this.save(),e.scale(o,o),e.transform(...p),this.executeOperatorList(S),this.restore()),T=$.applyTransform([A.width,0],p)[0]*o+C,e.translate(T,0),n.x+=T*d}e.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,n,i,o,r){this.ctx.rect(n,i,o-n,r-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){let n=t[1],i=this.baseTransform||ct(this.ctx),o={createCanvasGraphics:r=>new Lv(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new ey(t,n,this.ctx,o,i)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,n){this.ctx.strokeStyle=this.current.strokeColor=$.makeHexColor(t,e,n),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e,n){this.ctx.fillStyle=this.current.fillColor=$.makeHexColor(t,e,n),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let n;return this.cachedPatterns.has(t)?n=this.cachedPatterns.get(t):(n=NR(this.getObject(t)),this.cachedPatterns.set(t,n)),e&&(n.matrix=e),n}shadingFill(t){if(!this.contentVisible)return;let e=this.ctx;this.save();let n=this._getPattern(t);e.fillStyle=n.getPattern(e,this,pn(e),Zt.SHADING);let i=pn(e);if(i){let{width:o,height:r}=e.canvas,[a,l,c,d]=$.getAxialAlignedBoundingBox([0,0,o,r],i);this.ctx.fillRect(a,l,c-a,d-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){ot("Should not call beginInlineImage")}beginImageData(){ot("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=ct(this.ctx),e)){let n=e[2]-e[0],i=e[3]-e[1];this.ctx.rect(e[0],e[1],n,i),this.current.updateRectMinMax(ct(this.ctx),e),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let e=this.ctx;t.isolated||Fp("TODO: Support non-isolated groups."),t.knockout&&Y("Knockout groups not supported.");let n=ct(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let i=$.getAxialAlignedBoundingBox(t.bbox,ct(e)),o=[0,0,e.canvas.width,e.canvas.height];i=$.intersect(i,o)||[0,0,0,0];let r=Math.floor(i[0]),a=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-r,1),c=Math.max(Math.ceil(i[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,c]);let d="groupAt"+this.groupLevel;t.smask&&(d+="_smask_"+this.smaskCounter++%2);let p=this.cachedCanvases.getCanvas(d,l,c),g=p.context;g.translate(-r,-a),g.transform(...n),t.smask?this.smaskStack.push({canvas:p.canvas,context:g,offsetX:r,offsetY:a,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(r,a),e.save()),Xa(e,g),this.ctx=g,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;let e=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let i=ct(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);let o=$.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],i);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(t,e,n,i,o){if(w(this,Tc,iy).call(this),$d(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){let r=e[2]-e[0],a=e[3]-e[1];if(o&&this.annotationCanvasMap){n=n.slice(),n[4]-=e[0],n[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=r,e[3]=a;let[l,c]=$.singularValueDecompose2dScale(ct(this.ctx)),{viewportScale:d}=this,p=Math.ceil(r*this.outputScaleX*d),g=Math.ceil(a*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(p,g);let{canvas:m,context:v}=this.annotationCanvas;this.annotationCanvasMap.set(t,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=v,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,a*c),$d(this.ctx)}else $d(this.ctx),this.endPath(),this.ctx.rect(e[0],e[1],r,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new Mh(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),w(this,Ec,sy).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;let e=t.count;t=this.getObject(t.data,t),t.count=e;let n=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=LR(t)),i.compiled)){i.compiled(n);return}let o=this._createMaskCanvas(t),r=o.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(r,o.offsetX,o.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,n=0,i=0,o,r){if(!this.contentVisible)return;t=this.getObject(t.data,t);let a=this.ctx;a.save();let l=ct(a);a.transform(e,n,i,o,0,0);let c=this._createMaskCanvas(t);a.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let d=0,p=r.length;d<p;d+=2){let g=$.transform(l,[e,n,i,o,r[d],r[d+1]]),[m,v]=$.applyTransform([0,0],g);a.drawImage(c.canvas,m,v)}a.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;let e=this.ctx,n=this.current.fillColor,i=this.current.patternFill;for(let o of t){let{data:r,width:a,height:l,transform:c}=o,d=this.cachedCanvases.getCanvas("maskCanvas",a,l),p=d.context;p.save();let g=this.getObject(r,o);kw(p,g),p.globalCompositeOperation="source-in",p.fillStyle=i?n.getPattern(p,this,pn(e),Zt.FILL):n,p.fillRect(0,0,a,l),p.restore(),e.save(),e.transform(...c),e.scale(1,-1),Od(e,d.canvas,0,0,a,l,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;let e=this.getObject(t);if(!e){Y("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,n,i){if(!this.contentVisible)return;let o=this.getObject(t);if(!o){Y("Dependent image isn't ready yet");return}let r=o.width,a=o.height,l=[];for(let c=0,d=i.length;c<d;c+=2)l.push({transform:[e,0,0,n,i[c],i[c+1]],x:0,y:0,w:r,h:a});this.paintInlineImageXObjectGroup(o,l)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;let{bitmap:e,width:n,height:i}=t,o=this.cachedCanvases.getCanvas("inlineImage",n,i),r=o.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",o.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;let e=t.width,n=t.height,i=this.ctx;if(this.save(),!Qt){let{filter:a}=i;a!=="none"&&a!==""&&(i.filter="none")}i.scale(1/e,-1/n);let o;if(t.bitmap)o=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)o=t;else{let l=this.cachedCanvases.getCanvas("inlineImage",e,n).context;Nw(l,t),o=this.applyTransferMapsToCanvas(l)}let r=this._scaleImage(o,pn(i));i.imageSmoothingEnabled=Dw(ct(i),t.interpolate),Od(i,r.img,0,0,r.paintWidth,r.paintHeight,0,-n,e,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;let n=this.ctx,i;if(t.bitmap)i=t.bitmap;else{let o=t.width,r=t.height,l=this.cachedCanvases.getCanvas("inlineImage",o,r).context;Nw(l,t),i=this.applyTransferMapsToCanvas(l)}for(let o of e)n.save(),n.transform(...o.transform),n.scale(1,-1),Od(n,i,o.x,o.y,o.w,o.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){let e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);let n=this.ctx;this.pendingClip&&(e||(this.pendingClip===Fw?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let t=ct(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{let e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:t}=this.current,{a:e,b:n,c:i,d:o}=this.ctx.getTransform(),r,a;if(n===0&&i===0){let l=Math.abs(e),c=Math.abs(o);if(l===c)if(t===0)r=a=1/l;else{let d=l*t;r=a=d<1?1/d:1}else if(t===0)r=1/l,a=1/c;else{let d=l*t,p=c*t;r=d<1?1/d:1,a=p<1?1/p:1}}else{let l=Math.abs(e*o-n*i),c=Math.hypot(e,n),d=Math.hypot(i,o);if(t===0)r=d/l,a=c/l;else{let p=t*l;r=d>p?d/p:1,a=c>p?c/p:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t){let{ctx:e}=this,{lineWidth:n}=this.current,[i,o]=this.getScaleForStroking();if(e.lineWidth=n||1,i===1&&o===1){e.stroke();return}let r=e.getLineDash();if(t&&e.save(),e.scale(i,o),r.length>0){let a=Math.max(i,o);e.setLineDash(r.map(l=>l/a)),e.lineDashOffset/=a}e.stroke(),t&&e.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};Tc=new WeakSet,iy=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Ec=new WeakSet,sy=function(){if(this.pageColors){let t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){let e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}},Cc=new WeakSet,oy=function(t,e,n){let i=new Path2D;return i.addPath(t,new DOMMatrix(n).invertSelf().multiplySelf(e)),i};var ar=Lv;for(let s in Je)ar.prototype[s]!==void 0&&(ar.prototype[Je[s]]=ar.prototype[s]);var Sc,bc,dn=class{static get workerPort(){return u(this,Sc)}static set workerPort(t){if(!(typeof Worker!="undefined"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");_(this,Sc,t)}static get workerSrc(){return u(this,bc)}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");_(this,bc,t)}};Sc=new WeakMap,bc=new WeakMap,y(dn,Sc,null),y(dn,bc,"");var Ks,xc,ry=class{constructor({parsedData:t,rawData:e}){y(this,Ks,void 0);y(this,xc,void 0);_(this,Ks,t),_(this,xc,e)}getRaw(){return u(this,xc)}get(t){var e;return(e=u(this,Ks).get(t))!=null?e:null}getAll(){return Pv(u(this,Ks))}has(t){return u(this,Ks).has(t)}};Ks=new WeakMap,xc=new WeakMap;var er=Symbol("INTERNAL"),Ic,Rc,Pc,Fr,ay=class{constructor(t,{name:e,intent:n,usage:i,rbGroups:o}){y(this,Ic,!1);y(this,Rc,!1);y(this,Pc,!1);y(this,Fr,!0);_(this,Ic,!!(t&Re.DISPLAY)),_(this,Rc,!!(t&Re.PRINT)),this.name=e,this.intent=n,this.usage=i,this.rbGroups=o}get visible(){if(u(this,Pc))return u(this,Fr);if(!u(this,Fr))return!1;let{print:t,view:e}=this.usage;return u(this,Ic)?(e==null?void 0:e.viewState)!=="OFF":u(this,Rc)?(t==null?void 0:t.printState)!=="OFF":!0}_setVisible(t,e,n=!1){t!==er&&ot("Internal method `_setVisible` called."),_(this,Pc,n),_(this,Fr,e)}};Ic=new WeakMap,Rc=new WeakMap,Pc=new WeakMap,Fr=new WeakMap;var $i,it,Lr,Ur,Mc,cy,ly=class{constructor(t,e=Re.DISPLAY){y(this,Mc);y(this,$i,null);y(this,it,new Map);y(this,Lr,null);y(this,Ur,null);if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,_(this,Ur,t.order);for(let n of t.groups)u(this,it).set(n.id,new ay(e,n));if(t.baseState==="OFF")for(let n of u(this,it).values())n._setVisible(er,!1);for(let n of t.on)u(this,it).get(n)._setVisible(er,!0);for(let n of t.off)u(this,it).get(n)._setVisible(er,!1);_(this,Lr,this.getHash())}}isVisible(t){if(u(this,it).size===0)return!0;if(!t)return Fp("Optional content group not defined."),!0;if(t.type==="OCG")return u(this,it).has(t.id)?u(this,it).get(t.id).visible:(Y(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return w(this,Mc,cy).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(let e of t.ids){if(!u(this,it).has(e))return Y(`Optional content group not found: ${e}`),!0;if(u(this,it).get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(let e of t.ids){if(!u(this,it).has(e))return Y(`Optional content group not found: ${e}`),!0;if(!u(this,it).get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(let e of t.ids){if(!u(this,it).has(e))return Y(`Optional content group not found: ${e}`),!0;if(!u(this,it).get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(let e of t.ids){if(!u(this,it).has(e))return Y(`Optional content group not found: ${e}`),!0;if(u(this,it).get(e).visible)return!1}return!0}return Y(`Unknown optional content policy ${t.policy}.`),!0}return Y(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,n=!0){var o;let i=u(this,it).get(t);if(!i){Y(`Optional content group not found: ${t}`);return}if(n&&e&&i.rbGroups.length)for(let r of i.rbGroups)for(let a of r)a!==t&&((o=u(this,it).get(a))==null||o._setVisible(er,!1,!0));i._setVisible(er,!!e,!0),_(this,$i,null)}setOCGState({state:t,preserveRB:e}){let n;for(let i of t){switch(i){case"ON":case"OFF":case"Toggle":n=i;continue}let o=u(this,it).get(i);if(o)switch(n){case"ON":this.setVisibility(i,!0,e);break;case"OFF":this.setVisibility(i,!1,e);break;case"Toggle":this.setVisibility(i,!o.visible,e);break}}_(this,$i,null)}get hasInitialVisibility(){return u(this,Lr)===null||this.getHash()===u(this,Lr)}getOrder(){return u(this,it).size?u(this,Ur)?u(this,Ur).slice():[...u(this,it).keys()]:null}getGroups(){return u(this,it).size>0?Pv(u(this,it)):null}getGroup(t){return u(this,it).get(t)||null}getHash(){if(u(this,$i)!==null)return u(this,$i);let t=new Eh;for(let[e,n]of u(this,it))t.update(`${e}:${n.visible}`);return _(this,$i,t.hexdigest())}};$i=new WeakMap,it=new WeakMap,Lr=new WeakMap,Ur=new WeakMap,Mc=new WeakSet,cy=function(t){let e=t.length;if(e<2)return!0;let n=t[0];for(let i=1;i<e;i++){let o=t[i],r;if(Array.isArray(o))r=w(this,Mc,cy).call(this,o);else if(u(this,it).has(o))r=u(this,it).get(o).visible;else return Y(`Optional content group not found: ${o}`),!0;switch(n){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return n==="And"};var uy=class{constructor(t,{disableRange:e=!1,disableStream:n=!1}){wt(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:i,initialData:o,progressiveDone:r,contentDispositionFilename:a}=t;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=a,(o==null?void 0:o.length)>0){let l=o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!n,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),t.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){let n=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{let i=this._rangeReaders.some(function(o){return o._begin!==t?!1:(o._enqueue(n),!0)});wt(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var t,e;return(e=(t=this._fullRequestReader)==null?void 0:t._loaded)!=null?e:0}_onProgress(t){var e,n,i,o;t.total===void 0?(n=(e=this._rangeReaders[0])==null?void 0:e.onProgress)==null||n.call(e,{loaded:t.loaded}):(o=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||o.call(i,{loaded:t.loaded,total:t.total})}_onProgressiveDone(){var t;(t=this._fullRequestReader)==null||t.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){let e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){wt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let t=this._queuedChunks;return this._queuedChunks=null,new dy(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;let n=new hy(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(let n of this._rangeReaders.slice(0))n.cancel(t);this._pdfDataRangeTransport.abort()}},dy=class{constructor(t,e,n=!1,i=null){this._stream=t,this._done=n||!1,this._filename=Nv(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(let o of this._queuedChunks)this._loaded+=o.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},hy=class{constructor(t,e,n){this._stream=t,this._begin=e,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function GR(s){let t=!0,e=n("filename\\*","i").exec(s);if(e){e=e[1];let d=a(e);return d=unescape(d),d=l(d),d=c(d),o(d)}if(e=r(s),e){let d=c(e);return o(d)}if(e=n("filename","i").exec(s),e){e=e[1];let d=a(e);return d=c(d),o(d)}function n(d,p){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',p)}function i(d,p){if(d){if(!/^[\x00-\xFF]+$/.test(p))return p;try{let g=new TextDecoder(d,{fatal:!0}),m=Lp(p);p=g.decode(m),t=!1}catch(g){}}return p}function o(d){return t&&/[\x80-\xff]/.test(d)&&(d=i("utf-8",d),t&&(d=i("iso-8859-1",d))),d}function r(d){let p=[],g,m=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(g=m.exec(d))!==null;){let[,A,T,E]=g;if(A=parseInt(A,10),A in p){if(A===0)break;continue}p[A]=[T,E]}let v=[];for(let A=0;A<p.length&&A in p;++A){let[T,E]=p[A];E=a(E),T&&(E=unescape(E),A===0&&(E=l(E))),v.push(E)}return v.join("")}function a(d){if(d.startsWith('"')){let p=d.slice(1).split('\\"');for(let g=0;g<p.length;++g){let m=p[g].indexOf('"');m!==-1&&(p[g]=p[g].slice(0,m),p.length=g+1),p[g]=p[g].replaceAll(/\\(.)/g,"$1")}d=p.join('"')}return d}function l(d){let p=d.indexOf("'");if(p===-1)return d;let g=d.slice(0,p),v=d.slice(p+1).replace(/^[^']*'/,"");return i(g,v)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(p,g,m,v){if(m==="q"||m==="Q")return v=v.replaceAll("_"," "),v=v.replaceAll(/=([0-9a-fA-F]{2})/g,function(A,T){return String.fromCharCode(parseInt(T,16))}),i(g,v);try{v=atob(v)}catch(A){}return i(g,v)})}return""}function TT(s,t){let e=new Headers;if(!s||!t||typeof t!="object")return e;for(let n in t){let i=t[n];i!==void 0&&e.append(n,i)}return e}function $p(s){try{return new URL(s).origin}catch(t){}return null}function ET({responseHeaders:s,isHttp:t,rangeChunkSize:e,disableRange:n}){let i={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(s.get("Content-Length"),10);return!Number.isInteger(o)||(i.suggestedLength=o,o<=2*e)||n||!t||s.get("Accept-Ranges")!=="bytes"||(s.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function CT(s){let t=s.get("Content-Disposition");if(t){let e=GR(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch(n){}if(Nv(e))return e}return null}function Gp(s,t){return s===404||s===0&&t.startsWith("file:")?new Fo('Missing PDF "'+t+'".'):new $a(`Unexpected server response (${s}) while retrieving PDF "${t}".`,s)}function ST(s){return s===200||s===206}function bT(s,t,e){return{method:"GET",headers:s,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function xT(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:(Y(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}var Nh=class{constructor(t){H(this,"_responseOrigin",null);this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=TT(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t,e;return(e=(t=this._fullRequestReader)==null?void 0:t._loaded)!=null?e:0}getFullReader(){return wt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new fy(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;let n=new py(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(let n of this._rangeRequestReaders.slice(0))n.cancel(t)}},fy=class{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;let e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;let n=new Headers(t.headers),i=e.url;fetch(i,bT(n,this._withCredentials,this._abortController)).then(o=>{if(t._responseOrigin=$p(o.url),!ST(o.status))throw Gp(o.status,i);this._reader=o.body.getReader(),this._headersCapability.resolve();let r=o.headers,{allowRangeRequests:a,suggestedLength:l}=ET({responseHeaders:r,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=CT(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Fn("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;let{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:xT(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}},py=class{constructor(t,e,n){this._stream=t,this._reader=null,this._loaded=0;let i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;let o=new Headers(t.headers);o.append("Range",`bytes=${e}-${n-1}`);let r=i.url;fetch(r,bT(o,this._withCredentials,this._abortController)).then(a=>{let l=$p(a.url);if(l!==t._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${t._responseOrigin}".`);if(!ST(a.status))throw Gp(a.status,r);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;let{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:xT(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}},fm=200,pm=206;function BR(s){let t=s.response;return typeof t!="string"?t:Lp(t).buffer}var gy=class{constructor({url:t,httpHeaders:e,withCredentials:n}){H(this,"_responseOrigin",null);this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=TT(this.isHttp,e),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){let e=new XMLHttpRequest,n=this.currXhrId++,i=this.pendingRequests[n]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(let[o,r]of this.headers)e.setRequestHeader(o,r);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=pm):i.expectedStatus=fm,e.responseType="arraybuffer",wt(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),n}onProgress(t,e){var i;let n=this.pendingRequests[t];n&&((i=n.onProgress)==null||i.call(n,e))}onStateChange(t,e){let n=this.pendingRequests[t];if(!n)return;let i=n.xhr;if(i.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),i.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],i.status===0&&this.isHttp){n.onError(i.status);return}let o=i.status||fm;if(!(o===fm&&n.expectedStatus===pm)&&o!==n.expectedStatus){n.onError(i.status);return}let a=BR(i);if(o===pm){let l=i.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?n.onDone({begin:parseInt(c[1],10),chunk:a}):(Y('Missing or invalid "Content-Range" header.'),n.onError(0))}else a?n.onDone({begin:0,chunk:a}):n.onError(i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){let e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}},my=class{constructor(t){this._source=t,this._manager=new gy(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){let e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return wt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new yy(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){let n=new vy(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(let n of this._rangeRequestReaders.slice(0))n.cancel(t)}},yy=class{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=$p(e.responseURL);let n=e.getAllResponseHeaders(),i=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{let[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:o,suggestedLength:r}=ET({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});o&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=CT(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Gp(t,this._url),this._headersCapability.reject(this._storedError);for(let e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){var e;(e=this.onProgress)==null||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},vy=class{constructor(t,e,n){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var e;let t=$p((e=this._manager.getRequestXhr(this._requestId))==null?void 0:e.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var t;(t=this.onClosed)==null||t.call(this,this)}_onDone(t){let e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){var e;(e=this._storedError)!=null||(this._storedError=Gp(t,this._url));for(let n of this._requests)n.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){var e;this.isStreamingSupported||(e=this.onProgress)==null||e.call(this,{loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},HR=/^[a-z][a-z0-9\-+.]+:/i;function VR(s){if(HR.test(s))return new URL(s);let t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(s))}var _y=class{constructor(t){this.source=t,this.url=VR(t.url),wt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t,e;return(e=(t=this._fullRequestReader)==null?void 0:t._loaded)!=null?e:0}getFullReader(){return wt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Ay(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;let n=new wy(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(let n of this._rangeRequestReaders.slice(0))n.cancel(t)}},Ay=class{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;let e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=new Fo(`Missing PDF "${this._url}".`)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Fn("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},wy=class{constructor(t,e,n){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let i=t.source;this._isStreamingSupported=!i.disableStream;let o=process.getBuiltinModule("fs");this._setReadableStream(o.createReadStream(this._url,{start:e,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}},qR=1e5,ce=30,zR=.8,Ow,Gi,fe,Nc,kc,Ys,ti,Dc,Fc,Js,Or,$r,Bi,Gr,Lc,Br,Xs,Uc,Oc,Zs,Qs,$c,Hi,Hr,Df,IT,Ff,RT,Gc,Ty,Vr,jd,Bc,Ey,Lf,PT,Uf,MT,pt=class pt{constructor({textContentSource:t,container:e,viewport:n}){y(this,Df);y(this,Ff);y(this,Gc);y(this,Gi,Promise.withResolvers());y(this,fe,null);y(this,Nc,!1);y(this,kc,!!((Ow=globalThis.FontInspector)!=null&&Ow.enabled));y(this,Ys,null);y(this,ti,null);y(this,Dc,0);y(this,Fc,0);y(this,Js,null);y(this,Or,null);y(this,$r,0);y(this,Bi,0);y(this,Gr,Object.create(null));y(this,Lc,[]);y(this,Br,null);y(this,Xs,[]);y(this,Uc,new WeakMap);y(this,Oc,null);var l;if(t instanceof ReadableStream)_(this,Br,t);else if(typeof t=="object")_(this,Br,new ReadableStream({start(c){c.enqueue(t),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');_(this,fe,_(this,Or,e)),_(this,Bi,n.scale*(globalThis.devicePixelRatio||1)),_(this,$r,n.rotation),_(this,ti,{div:null,properties:null,ctx:null});let{pageWidth:i,pageHeight:o,pageX:r,pageY:a}=n.rawDims;_(this,Oc,[1,0,0,-1,-r,a+o]),_(this,Fc,i),_(this,Dc,o),w(l=pt,Lf,PT).call(l),Lo(e,n),u(this,Gi).promise.finally(()=>{u(pt,Hr).delete(this),_(this,ti,null),_(this,Gr,null)}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:t,isFirefox:e}=Bt.platform;return Z(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){let t=()=>{u(this,Js).read().then(({value:e,done:n})=>{var i;if(n){u(this,Gi).resolve();return}(i=u(this,Ys))!=null||_(this,Ys,e.lang),Object.assign(u(this,Gr),e.styles),w(this,Df,IT).call(this,e.items),t()},u(this,Gi).reject)};return _(this,Js,u(this,Br).getReader()),u(pt,Hr).add(this),t(),u(this,Gi).promise}update({viewport:t,onBefore:e=null}){var o;let n=t.scale*(globalThis.devicePixelRatio||1),i=t.rotation;if(i!==u(this,$r)&&(e==null||e(),_(this,$r,i),Lo(u(this,Or),{rotation:i})),n!==u(this,Bi)){e==null||e(),_(this,Bi,n);let r={div:null,properties:null,ctx:w(o=pt,Vr,jd).call(o,u(this,Ys))};for(let a of u(this,Xs))r.properties=u(this,Uc).get(a),r.div=a,w(this,Gc,Ty).call(this,r)}}cancel(){var e;let t=new Fn("TextLayer task cancelled.");(e=u(this,Js))==null||e.cancel(t).catch(()=>{}),_(this,Js,null),u(this,Gi).reject(t)}get textDivs(){return u(this,Xs)}get textContentItemsStr(){return u(this,Lc)}static cleanup(){if(!(u(this,Hr).size>0)){u(this,Zs).clear();for(let{canvas:t}of u(this,Qs).values())t.remove();u(this,Qs).clear()}}};Gi=new WeakMap,fe=new WeakMap,Nc=new WeakMap,kc=new WeakMap,Ys=new WeakMap,ti=new WeakMap,Dc=new WeakMap,Fc=new WeakMap,Js=new WeakMap,Or=new WeakMap,$r=new WeakMap,Bi=new WeakMap,Gr=new WeakMap,Lc=new WeakMap,Br=new WeakMap,Xs=new WeakMap,Uc=new WeakMap,Oc=new WeakMap,Zs=new WeakMap,Qs=new WeakMap,$c=new WeakMap,Hi=new WeakMap,Hr=new WeakMap,Df=new WeakSet,IT=function(t){var i,o,r;if(u(this,Nc))return;(r=(o=u(this,ti)).ctx)!=null||(o.ctx=w(i=pt,Vr,jd).call(i,u(this,Ys)));let e=u(this,Xs),n=u(this,Lc);for(let a of t){if(e.length>qR){Y("Ignoring additional textDivs for performance reasons."),_(this,Nc,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){let l=u(this,fe);_(this,fe,document.createElement("span")),u(this,fe).classList.add("markedContent"),a.id!==null&&u(this,fe).setAttribute("id",`${a.id}`),l.append(u(this,fe))}else a.type==="endMarkedContent"&&_(this,fe,u(this,fe).parentNode);continue}n.push(a.str),w(this,Ff,RT).call(this,a)}},Ff=new WeakSet,RT=function(t){var A;let e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};u(this,Xs).push(e);let i=$.transform(u(this,Oc),t.transform),o=Math.atan2(i[1],i[0]),r=u(this,Gr)[t.fontName];r.vertical&&(o+=Math.PI/2);let a=u(this,kc)&&r.fontSubstitution||r.fontFamily;a=pt.fontFamilyMap.get(a)||a;let l=Math.hypot(i[2],i[3]),c=l*w(A=pt,Uf,MT).call(A,a,u(this,Ys)),d,p;o===0?(d=i[4],p=i[5]-c):(d=i[4]+c*Math.sin(o),p=i[5]-c*Math.cos(o));let g="calc(var(--scale-factor)*",m=e.style;u(this,fe)===u(this,Or)?(m.left=`${(100*d/u(this,Fc)).toFixed(2)}%`,m.top=`${(100*p/u(this,Dc)).toFixed(2)}%`):(m.left=`${g}${d.toFixed(2)}px)`,m.top=`${g}${p.toFixed(2)}px)`),m.fontSize=`${g}${(u(pt,Hi)*l).toFixed(2)}px)`,m.fontFamily=a,n.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,u(this,kc)&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),o!==0&&(n.angle=o*(180/Math.PI));let v=!1;if(t.str.length>1)v=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){let T=Math.abs(t.transform[0]),E=Math.abs(t.transform[3]);T!==E&&Math.max(T,E)/Math.min(T,E)>1.5&&(v=!0)}if(v&&(n.canvasWidth=r.vertical?t.height:t.width),u(this,Uc).set(e,n),u(this,ti).div=e,u(this,ti).properties=n,w(this,Gc,Ty).call(this,u(this,ti)),n.hasText&&u(this,fe).append(e),n.hasEOL){let T=document.createElement("br");T.setAttribute("role","presentation"),u(this,fe).append(T)}},Gc=new WeakSet,Ty=function(t){var a;let{div:e,properties:n,ctx:i}=t,{style:o}=e,r="";if(u(pt,Hi)>1&&(r=`scale(${1/u(pt,Hi)})`),n.canvasWidth!==0&&n.hasText){let{fontFamily:l}=o,{canvasWidth:c,fontSize:d}=n;w(a=pt,Bc,Ey).call(a,i,d*u(this,Bi),l);let{width:p}=i.measureText(e.textContent);p>0&&(r=`scaleX(${c*u(this,Bi)/p}) ${r}`)}n.angle!==0&&(r=`rotate(${n.angle}deg) ${r}`),r.length>0&&(o.transform=r)},Vr=new WeakSet,jd=function(t=null){let e=u(this,Qs).get(t||(t=""));if(!e){let n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),u(this,Qs).set(t,e),u(this,$c).set(e,{size:0,family:""})}return e},Bc=new WeakSet,Ey=function(t,e,n){let i=u(this,$c).get(t);e===i.size&&n===i.family||(t.font=`${e}px ${n}`,i.size=e,i.family=n)},Lf=new WeakSet,PT=function(){if(u(this,Hi)!==null)return;let t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),_(this,Hi,t.getBoundingClientRect().height),t.remove()},Uf=new WeakSet,MT=function(t,e){let n=u(this,Zs).get(t);if(n)return n;let i=w(this,Vr,jd).call(this,e);i.canvas.width=i.canvas.height=ce,w(this,Bc,Ey).call(this,i,ce,t);let o=i.measureText(""),r=o.fontBoundingBoxAscent,a=Math.abs(o.fontBoundingBoxDescent);if(r){let d=r/(r+a);return u(this,Zs).set(t,d),i.canvas.width=i.canvas.height=0,d}i.strokeStyle="red",i.clearRect(0,0,ce,ce),i.strokeText("g",0,0);let l=i.getImageData(0,0,ce,ce).data;a=0;for(let d=l.length-1-3;d>=0;d-=4)if(l[d]>0){a=Math.ceil(d/4/ce);break}i.clearRect(0,0,ce,ce),i.strokeText("A",0,ce),l=i.getImageData(0,0,ce,ce).data,r=0;for(let d=0,p=l.length;d<p;d+=4)if(l[d]>0){r=ce-Math.floor(d/4/ce);break}i.canvas.width=i.canvas.height=0;let c=r?r/(r+a):zR;return u(this,Zs).set(t,c),c},y(pt,Vr),y(pt,Bc),y(pt,Lf),y(pt,Uf),y(pt,Zs,new Map),y(pt,Qs,new Map),y(pt,$c,new WeakMap),y(pt,Hi,null),y(pt,Hr,new Set);var Cl=pt,Sl=class s{static textContent(t){let e=[],n={items:e,styles:Object.create(null)};function i(o){var l;if(!o)return;let r=null,a=o.name;if(a==="#text")r=o.value;else if(s.shouldBuildText(a))(l=o==null?void 0:o.attributes)!=null&&l.textContent?r=o.attributes.textContent:o.value&&(r=o.value);else return;if(r!==null&&e.push({str:r}),!!o.children)for(let c of o.children)i(c)}return i(t),n}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}},WR=65536,KR=100,YR=5e3,JR=Qt?Ym:Vm,XR=Qt?Jm:xh,ZR=Qt?Km:qm,QR=Qt?Xm:Ph;function jR(s={}){var He,ut;typeof s=="string"||s instanceof URL?s={url:s}:(s instanceof ArrayBuffer||ArrayBuffer.isView(s))&&(s={data:s});let t=new Cy,{docId:e}=t,n=s.url?tP(s.url):null,i=s.data?eP(s.data):null,o=s.httpHeaders||null,r=s.withCredentials===!0,a=(He=s.password)!=null?He:null,l=s.range instanceof kh?s.range:null,c=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:WR,d=s.worker instanceof lr?s.worker:null,p=s.verbosity,g=typeof s.docBaseUrl=="string"&&!Op(s.docBaseUrl)?s.docBaseUrl:null,m=typeof s.cMapUrl=="string"?s.cMapUrl:null,v=s.cMapPacked!==!1,A=s.CMapReaderFactory||XR,T=typeof s.standardFontDataUrl=="string"?s.standardFontDataUrl:null,E=s.StandardFontDataFactory||QR,C=s.stopAtErrors!==!0,S=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,b=s.isEvalSupported!==!1,x=typeof s.isOffscreenCanvasSupported=="boolean"?s.isOffscreenCanvasSupported:!Qt,R=typeof s.isImageDecoderSupported=="boolean"?s.isImageDecoderSupported:!Qt&&(Bt.platform.isFirefox||!globalThis.chrome),I=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,N=typeof s.disableFontFace=="boolean"?s.disableFontFace:Qt,M=s.fontExtraProperties===!0,F=s.enableXfa===!0,U=s.ownerDocument||globalThis.document,j=s.disableRange===!0,z=s.disableStream===!0,W=s.disableAutoFetch===!0,bt=s.pdfBug===!0,k=s.CanvasFactory||JR,B=s.FilterFactory||ZR,me=s.enableHWA===!0,fn=l?l.length:(ut=s.length)!=null?ut:NaN,Ln=typeof s.useSystemFonts=="boolean"?s.useSystemFonts:!Qt&&!N,Me=typeof s.useWorkerFetch=="boolean"?s.useWorkerFetch:A===xh&&E===Ph&&m&&T&&ja(m,document.baseURI)&&ja(T,document.baseURI),Ht=null;mR(p);let Tt={canvasFactory:new k({ownerDocument:U,enableHWA:me}),filterFactory:new B({docId:e,ownerDocument:U}),cMapReaderFactory:Me?null:new A({baseUrl:m,isCompressed:v}),standardFontDataFactory:Me?null:new E({baseUrl:T})};if(!d){let Va={verbosity:p,port:dn.workerPort};d=Va.port?lr.fromPort(Va):new lr(Va),t._worker=d}let Go={docId:e,apiVersion:"4.10.38",data:i,password:a,disableAutoFetch:W,rangeChunkSize:c,length:fn,docBaseUrl:g,enableXfa:F,evaluatorOptions:{maxImageSize:S,disableFontFace:N,ignoreErrors:C,isEvalSupported:b,isOffscreenCanvasSupported:x,isImageDecoderSupported:R,canvasMaxAreaInBytes:I,fontExtraProperties:M,useSystemFonts:Ln,cMapUrl:Me?m:null,standardFontDataUrl:Me?T:null}},Ha={disableFontFace:N,fontExtraProperties:M,ownerDocument:U,pdfBug:bt,styleElement:Ht,loadingParams:{disableAutoFetch:W,enableXfa:F}};return d.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let Va=d.messageHandler.sendWithPromise("GetDocRequest",Go,i?[i.buffer]:null),Qp;if(l)Qp=new uy(l,{disableRange:j,disableStream:z});else if(!i){if(!n)throw new Error("getDocument - no `url` parameter provided.");let Bo;if(Qt)if(ja(n)){if(typeof fetch=="undefined"||typeof Response=="undefined"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");Bo=Nh}else Bo=_y;else Bo=ja(n)?Nh:my;Qp=new Bo({url:n,length:fn,httpHeaders:o,withCredentials:r,rangeChunkSize:c,disableRange:j,disableStream:z})}return Va.then(Bo=>{if(t.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let jv=new ms(e,Bo,d.port),wE=new Iy(jv,t,Qp,Ha,Tt);t._transport=wE,jv.send("Ready",null)})}).catch(t._capability.reject),t}function tP(s){if(s instanceof URL)return s.href;try{return new URL(s,window.location).href}catch(t){if(Qt&&typeof s=="string")return s}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function eP(s){if(Qt&&typeof Buffer!="undefined"&&s instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength)return s;if(typeof s=="string")return Lp(s);if(s instanceof ArrayBuffer||ArrayBuffer.isView(s)||typeof s=="object"&&!isNaN(s==null?void 0:s.length))return new Uint8Array(s);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Lw(s){return typeof s=="object"&&Number.isInteger(s==null?void 0:s.num)&&s.num>=0&&Number.isInteger(s==null?void 0:s.gen)&&s.gen>=0}var Of,$f=class $f{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${jt($f,Of)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var t,e,n,i;this.destroyed=!0;try{(t=this._worker)!=null&&t.port&&(this._worker._pendingDestroy=!0),await((e=this._transport)==null?void 0:e.destroy())}catch(o){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,o}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}};Of=new WeakMap,y($f,Of,0);var Cy=$f,kh=class{constructor(t,e,n=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=n,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(let n of this._rangeListeners)n(t,e)}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(let n of this._progressListeners)n(t,e)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(let e of this._progressiveReadListeners)e(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){ot("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},Sy=class{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Z(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){let{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},Vi,ei,qi,nr,qr,th,by=class{constructor(t,e,n,i=!1){y(this,qi);y(this,qr);y(this,Vi,null);y(this,ei,!1);this._pageIndex=t,this._pageInfo=e,this._transport=n,this._stats=i?new _h:null,this._pdfBug=i,this.commonObjs=n.commonObjs,this.objs=new Dh,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:n=0,offsetY:i=0,dontFlip:o=!1}={}){return new _l({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:i,dontFlip:o})}getAnnotations({intent:t="display"}={}){let{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Z(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,viewport:e,intent:n="display",annotationMode:i=Ei.ENABLE,transform:o=null,background:r=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:p=!1}){var b,x;(b=this._stats)==null||b.time("Overall");let g=this._transport.getRenderingIntent(n,i,d,p),{renderingIntent:m,cacheKey:v}=g;_(this,ei,!1),w(this,qr,th).call(this),a||(a=this._transport.getOptionalContentConfig(m));let A=this._intentStates.get(v);A||(A=Object.create(null),this._intentStates.set(v,A)),A.streamReaderCancelTimeout&&(clearTimeout(A.streamReaderCancelTimeout),A.streamReaderCancelTimeout=null);let T=!!(m&Re.PRINT);A.displayReadyCapability||(A.displayReadyCapability=Promise.withResolvers(),A.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(x=this._stats)==null||x.time("Page Request"),this._pumpOperatorList(g));let E=R=>{var I;A.renderTasks.delete(C),(this._maybeCleanupAfterRender||T)&&_(this,ei,!0),w(this,qi,nr).call(this,!T),R?(C.capability.reject(R),this._abortOperatorList({intentState:A,reason:R instanceof Error?R:new Error(R)})):C.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(I=globalThis.Stats)!=null&&I.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},C=new My({callback:E,params:{canvasContext:t,viewport:e,transform:o,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:A.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!T,pdfBug:this._pdfBug,pageColors:c});(A.renderTasks||(A.renderTasks=new Set)).add(C);let S=C.task;return Promise.all([A.displayReadyCapability.promise,a]).then(([R,I])=>{var N;if(this.destroyed){E();return}if((N=this._stats)==null||N.time("Rendering"),!(I.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");C.initializeGraphics({transparency:R,optionalContentConfig:I}),C.operatorListChanged()}).catch(E),S}getOperatorList({intent:t="display",annotationMode:e=Ei.ENABLE,printAnnotationStorage:n=null,isEditing:i=!1}={}){var c;function o(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}let r=this._transport.getRenderingIntent(t,e,n,i,!0),a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=o,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>Sl.textContent(n));let e=this.streamTextContent(t);return new Promise(function(n,i){function o(){r.read().then(function({value:l,done:c}){var d;if(c){n(a);return}(d=a.lang)!=null||(a.lang=l.lang),Object.assign(a.styles,l.styles),a.items.push(...l.items),o()},i)}let r=e.getReader(),a={items:[],styles:Object.create(null),lang:null};o()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let t=[];for(let e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(let n of e.renderTasks)t.push(n.completed),n.cancel();return this.objs.clear(),_(this,ei,!1),w(this,qr,th).call(this),Promise.all(t)}cleanup(t=!1){_(this,ei,!0);let e=w(this,qi,nr).call(this,!1);return t&&e&&this._stats&&(this._stats=new _h),e}_startRenderPage(t,e){var i,o;let n=this._intentStates.get(e);n&&((i=this._stats)==null||i.timeEnd("Page Request"),(o=n.displayReadyCapability)==null||o.resolve(t))}_renderPageChunk(t,e){for(let n=0,i=t.length;n<i;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(let n of e.renderTasks)n.operatorListChanged();t.lastChunk&&w(this,qi,nr).call(this,!0)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:n,modifiedIds:i}){let{map:o,transfer:r}=n,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:o,modifiedIds:i},r).getReader(),c=this._intentStates.get(e);c.streamReader=l;let d=()=>{l.read().then(({value:p,done:g})=>{if(g){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(p,c),d())},p=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(let g of c.renderTasks)g.operatorListChanged();w(this,qi,nr).call(this,!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(p);else if(c.opListReadCapability)c.opListReadCapability.reject(p);else throw p}})};d()}_abortOperatorList({intentState:t,reason:e,force:n=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!n){if(t.renderTasks.size>0)return;if(e instanceof Al){let i=KR;e.extraDelay>0&&e.extraDelay<1e3&&(i+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},i);return}}if(t.streamReader.cancel(new Fn(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(let[i,o]of this._intentStates)if(o===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}};Vi=new WeakMap,ei=new WeakMap,qi=new WeakSet,nr=function(t=!1){if(w(this,qr,th).call(this),!u(this,ei)||this.destroyed)return!1;if(t)return _(this,Vi,setTimeout(()=>{_(this,Vi,null),w(this,qi,nr).call(this,!1)},YR)),!1;for(let{renderTasks:e,operatorList:n}of this._intentStates.values())if(e.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),_(this,ei,!1),!0},qr=new WeakSet,th=function(){u(this,Vi)&&(clearTimeout(u(this,Vi)),_(this,Vi,null))};var ni,Gf,xy=class{constructor(){y(this,ni,new Map);y(this,Gf,Promise.resolve())}postMessage(t,e){let n={data:structuredClone(t,e?{transfer:e}:null)};u(this,Gf).then(()=>{for(let[i]of u(this,ni))i.call(this,n)})}addEventListener(t,e,n=null){let i=null;if((n==null?void 0:n.signal)instanceof AbortSignal){let{signal:o}=n;if(o.aborted){Y("LoopbackPort - cannot use an `aborted` signal.");return}let r=()=>this.removeEventListener(t,e);i=()=>o.removeEventListener("abort",r),o.addEventListener("abort",r)}u(this,ni).set(e,i)}removeEventListener(t,e){let n=u(this,ni).get(e);n==null||n(),u(this,ni).delete(e)}terminate(){for(let[,t]of u(this,ni))t==null||t();u(this,ni).clear()}};ni=new WeakMap,Gf=new WeakMap;var Bf,js,to,zr,eh,Wr,nh,lt=class lt{constructor({name:t=null,port:e=null,verbosity:n=yR()}={}){y(this,zr);var i;if(this.name=t,this.destroyed=!1,this.verbosity=n,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if((i=u(lt,to))!=null&&i.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(u(lt,to)||_(lt,to,new WeakMap)).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new ms("main","worker",t),this._messageHandler.on("ready",function(){}),w(this,zr,eh).call(this)}_initialize(){if(u(lt,js)||u(lt,Wr,nh)){this._setupFakeWorker();return}let{workerSrc:t}=lt;try{lt._isSameOrigin(window.location.href,t)||(t=lt._createCDNWrapper(new URL(t,window.location).href));let e=new Worker(t,{type:"module"}),n=new ms("main","worker",e),i=()=>{o.abort(),n.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},o=new AbortController;e.addEventListener("error",()=>{this._webWorker||i()},{signal:o.signal}),n.on("test",a=>{if(o.abort(),this.destroyed||!a){i();return}this._messageHandler=n,this._port=e,this._webWorker=e,w(this,zr,eh).call(this)}),n.on("ready",a=>{if(o.abort(),this.destroyed){i();return}try{r()}catch(l){this._setupFakeWorker()}});let r=()=>{let a=new Uint8Array;n.send("test",a,[a.buffer])};r();return}catch(e){Fp("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){u(lt,js)||(Y("Setting up fake worker."),_(lt,js,!0)),lt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let e=new xy;this._port=e;let n=`fake${jt(lt,Bf)._++}`,i=new ms(n+"_worker",n,e);t.setup(i,e),this._messageHandler=new ms(n,n+"_worker",e),w(this,zr,eh).call(this)}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){var t,e,n;this.destroyed=!0,(t=this._webWorker)==null||t.terminate(),this._webWorker=null,(e=u(lt,to))==null||e.delete(this._port),this._port=null,(n=this._messageHandler)==null||n.destroy(),this._messageHandler=null}static fromPort(t){var n;if(!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");let e=(n=u(this,to))==null?void 0:n.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new lt(t)}static get workerSrc(){if(dn.workerSrc)return dn.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Z(this,"_setupFakeWorkerGlobal",(async()=>u(this,Wr,nh)?u(this,Wr,nh):(await import(this.workerSrc)).WorkerMessageHandler)())}};Bf=new WeakMap,js=new WeakMap,to=new WeakMap,zr=new WeakSet,eh=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Wr=new WeakSet,nh=function(){var t;try{return((t=globalThis.pdfjsWorker)==null?void 0:t.WorkerMessageHandler)||null}catch(e){return null}},y(lt,Wr),y(lt,Bf,0),y(lt,js,!1),y(lt,to,void 0),Qt&&(_(lt,js,!0),dn.workerSrc||(dn.workerSrc="./pdf.worker.mjs")),lt._isSameOrigin=(t,e)=>{let n;try{if(n=new URL(t),!n.origin||n.origin==="null")return!1}catch(o){return!1}let i=new URL(e,n);return n.origin===i.origin},lt._createCDNWrapper=t=>{let e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};var lr=lt,ii,bn,Kr,Yr,si,eo,al,Iy=class{constructor(t,e,n,i,o){y(this,eo);y(this,ii,new Map);y(this,bn,new Map);y(this,Kr,new Map);y(this,Yr,new Map);y(this,si,null);this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Dh,this.fontLoader=new Bm({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=o.canvasFactory,this.filterFactory=o.filterFactory,this.cMapReaderFactory=o.cMapReaderFactory,this.standardFontDataFactory=o.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Z(this,"annotationStorage",new Tl)}getRenderingIntent(t,e=Ei.ENABLE,n=null,i=!1,o=!1){let r=Re.DISPLAY,a=Gm;switch(t){case"any":r=Re.ANY;break;case"display":break;case"print":r=Re.PRINT;break;default:Y(`getRenderingIntent - invalid intent: ${t}`)}let l=r&Re.PRINT&&n instanceof Ch?n:this.annotationStorage;switch(e){case Ei.DISABLE:r+=Re.ANNOTATIONS_DISABLE;break;case Ei.ENABLE:break;case Ei.ENABLE_FORMS:r+=Re.ANNOTATIONS_FORMS;break;case Ei.ENABLE_STORAGE:r+=Re.ANNOTATIONS_STORAGE,a=l.serializable;break;default:Y(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(r+=Re.IS_EDITING),o&&(r+=Re.OPLIST);let{ids:c,hash:d}=l.modifiedIds,p=[r,a.hash,d];return{renderingIntent:r,cacheKey:p.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=u(this,si))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));let t=[];for(let i of u(this,bn).values())t.push(i._destroy());u(this,bn).clear(),u(this,Kr).clear(),u(this,Yr).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{var i,o;this.commonObjs.clear(),this.fontLoader.clear(),u(this,ii).clear(),this.filterFactory.destroy(),Cl.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new Fn("Worker was terminated.")),(o=this.messageHandler)==null||o.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(n,i)=>{wt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},i.onPull=()=>{this._fullReader.read().then(function({value:o,done:r}){if(r){i.close();return}wt(o instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{this._fullReader.cancel(o),i.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("ReaderHeadersReady",async n=>{var a;await this._fullReader.headersReady;let{isStreamingSupported:i,isRangeSupported:o,contentLength:r}=this._fullReader;return(!i||!o)&&(this._lastProgress&&((a=e.onProgress)==null||a.call(e,this._lastProgress)),this._fullReader.onProgress=l=>{var c;(c=e.onProgress)==null||c.call(e,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:i,isRangeSupported:o,contentLength:r}}),t.on("GetRangeReader",(n,i)=>{wt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let o=this._networkStream.getRangeReader(n.begin,n.end);if(!o){i.close();return}i.onPull=()=>{o.read().then(function({value:r,done:a}){if(a){i.close();return}wt(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{o.cancel(r),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,e._capability.resolve(new Sy(n,this))}),t.on("DocException",n=>{e._capability.reject(ue(n))}),t.on("PasswordRequest",n=>{_(this,si,Promise.withResolvers());try{if(!e.onPassword)throw ue(n);let i=o=>{o instanceof Error?u(this,si).reject(o):u(this,si).resolve({password:o})};e.onPassword(i,n.code)}catch(i){u(this,si).reject(i)}return u(this,si).promise}),t.on("DataLoaded",n=>{var i;(i=e.onProgress)==null||i.call(e,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),t.on("StartRenderPage",n=>{if(this.destroyed)return;u(this,bn).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),t.on("commonobj",([n,i,o])=>{var r;if(this.destroyed||this.commonObjs.has(n))return null;switch(i){case"Font":let{disableFontFace:a,fontExtraProperties:l,pdfBug:c}=this._params;if("error"in o){let m=o.error;Y(`Error during font loading: ${m}`),this.commonObjs.resolve(n,m);break}let d=c&&((r=globalThis.FontInspector)!=null&&r.enabled)?(m,v)=>globalThis.FontInspector.fontAdded(m,v):null,p=new Hm(o,{disableFontFace:a,fontExtraProperties:l,inspectFont:d});this.fontLoader.bind(p).catch(()=>t.sendWithPromise("FontFallback",{id:n})).finally(()=>{!l&&p.data&&(p.data=null),this.commonObjs.resolve(n,p)});break;case"CopyLocalImage":let{imageRef:g}=o;wt(g,"The imageRef must be defined.");for(let m of u(this,bn).values())for(let[,v]of m.objs)if((v==null?void 0:v.ref)===g)return v.dataLen?(this.commonObjs.resolve(n,structuredClone(v)),v.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,o);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",([n,i,o,r])=>{var l;if(this.destroyed)return;let a=u(this,bn).get(i);if(!a.objs.has(n)){if(a._intentStates.size===0){(l=r==null?void 0:r.bitmap)==null||l.close();return}switch(o){case"Image":a.objs.resolve(n,r),(r==null?void 0:r.dataLen)>dR&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(n,r);break;default:throw new Error(`Got unknown object type ${o}`)}}}),t.on("DocProgress",n=>{var i;this.destroyed||(i=e.onProgress)==null||i.call(e,{loaded:n.loaded,total:n.total})}),t.on("FetchBuiltInCMap",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(n)}),t.on("FetchStandardFontData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n,i;this.annotationStorage.size<=0&&Y("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:(i=(n=this._fullReader)==null?void 0:n.filename)!=null?i:null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));let e=t-1,n=u(this,Kr).get(e);if(n)return n;let i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");o.refStr&&u(this,Yr).set(o.refStr,t);let r=new by(e,o,this,this._params.pdfBug);return u(this,bn).set(e,r),r});return u(this,Kr).set(e,i),i}getPageIndex(t){return Lw(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return w(this,eo,al).call(this,"GetFieldObjects")}hasJSActions(){return w(this,eo,al).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return w(this,eo,al).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return w(this,eo,al).call(this,"GetOptionalContentConfig").then(e=>new ly(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let t="GetMetadata",e=u(this,ii).get(t);if(e)return e;let n=this.messageHandler.sendWithPromise(t,null).then(i=>{var o,r,a,l;return{info:i[0],metadata:i[1]?new ry(i[1]):null,contentDispositionFilename:(r=(o=this._fullReader)==null?void 0:o.filename)!=null?r:null,contentLength:(l=(a=this._fullReader)==null?void 0:a.contentLength)!=null?l:null}});return u(this,ii).set(t,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(let e of u(this,bn).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),u(this,ii).clear(),this.filterFactory.destroy(!0),Cl.cleanup()}}cachedPageNumber(t){var n;if(!Lw(t))return null;let e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return(n=u(this,Yr).get(e))!=null?n:null}};ii=new WeakMap,bn=new WeakMap,Kr=new WeakMap,Yr=new WeakMap,si=new WeakMap,eo=new WeakSet,al=function(t,e=null){let n=u(this,ii).get(t);if(n)return n;let i=this.messageHandler.sendWithPromise(t,e);return u(this,ii).set(t,i),i};var Za=Symbol("INITIAL_DATA"),Ae,Hc,Ry,Dh=class{constructor(){y(this,Hc);y(this,Ae,Object.create(null))}get(t,e=null){if(e){let i=w(this,Hc,Ry).call(this,t);return i.promise.then(()=>e(i.data)),null}let n=u(this,Ae)[t];if(!n||n.data===Za)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return n.data}has(t){let e=u(this,Ae)[t];return!!e&&e.data!==Za}delete(t){let e=u(this,Ae)[t];return!e||e.data===Za?!1:(delete u(this,Ae)[t],!0)}resolve(t,e=null){let n=w(this,Hc,Ry).call(this,t);n.data=e,n.resolve()}clear(){var t;for(let e in u(this,Ae)){let{data:n}=u(this,Ae)[e];(t=n==null?void 0:n.bitmap)==null||t.close()}_(this,Ae,Object.create(null))}*[Symbol.iterator](){for(let t in u(this,Ae)){let{data:e}=u(this,Ae)[t];e!==Za&&(yield[t,e])}}};Ae=new WeakMap,Hc=new WeakSet,Ry=function(t){var e;return(e=u(this,Ae))[t]||(e[t]={...Promise.withResolvers(),data:Za})};var zi,Py=class{constructor(t){y(this,zi,null);_(this,zi,t),this.onContinue=null}get promise(){return u(this,zi).capability.promise}cancel(t=0){u(this,zi).cancel(null,t)}get separateAnnots(){let{separateAnnots:t}=u(this,zi).operatorList;if(!t)return!1;let{annotationCanvasMap:e}=u(this,zi);return t.form||t.canvas&&(e==null?void 0:e.size)>0}};zi=new WeakMap;var Wi,no,gs=class gs{constructor({callback:t,params:e,objs:n,commonObjs:i,annotationCanvasMap:o,operatorList:r,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:p=!1,pageColors:g=null}){y(this,Wi,null);this.callback=t,this.params=e,this.objs=n,this.commonObjs=i,this.annotationCanvasMap=o,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=p,this.pageColors=g,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window!="undefined",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Py(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){var a,l;if(this.cancelled)return;if(this._canvas){if(u(gs,no).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");u(gs,no).add(this._canvas)}this._pdfBug&&((a=globalThis.StepperManager)!=null&&a.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:n,viewport:i,transform:o,background:r}=this.params;this.gfx=new ar(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:o,viewport:i,transparency:t,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(t=null,e=0){var n;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),u(this,Wi)&&(window.cancelAnimationFrame(u(this,Wi)),_(this,Wi,null)),u(gs,no).delete(this._canvas),this.callback(t||new Al(`Rendering cancelled, page ${this._pageIndex+1}`,e))}operatorListChanged(){var t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?_(this,Wi,window.requestAnimationFrame(()=>{_(this,Wi,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),u(gs,no).delete(this._canvas),this.callback())))}};Wi=new WeakMap,no=new WeakMap,y(gs,no,new WeakSet);var My=gs,nP="4.10.38",iP="f9bea397f";function Uw(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}function Qa(s){return Math.max(0,Math.min(255,255*s))}var Fh=class{static CMYK_G([t,e,n,i]){return["G",1-Math.min(1,.3*t+.59*n+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=Qa(t),[t,t,t]}static G_HTML([t]){let e=Uw(t);return`#${e}${e}${e}`}static RGB_G([t,e,n]){return["G",.3*t+.59*e+.11*n]}static RGB_rgb(t){return t.map(Qa)}static RGB_HTML(t){return`#${t.map(Uw).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,n,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,n+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,n,i]){return[Qa(1-Math.min(1,t+i)),Qa(1-Math.min(1,n+i)),Qa(1-Math.min(1,e+i))]}static CMYK_HTML(t){let e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,n]){let i=1-t,o=1-e,r=1-n,a=Math.min(i,o,r);return["CMYK",i,o,r,a]}},Ny=class{create(t,e,n=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");let i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),n||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){ot("Abstract method `_createSVG` called.")}},bl=class extends Ny{_createSVG(t){return document.createElementNS(Gn,t)}},Lh=class{static setupStorage(t,e,n,i,o){let r=i.getValue(e,{value:null});switch(n.name){case"textarea":if(r.value!==null&&(t.textContent=r.value),o==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(r.value===n.attributes.xfaOn?t.setAttribute("checked",!0):r.value===n.attributes.xfaOff&&t.removeAttribute("checked"),o==="print")break;t.addEventListener("change",a=>{i.setValue(e,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&t.setAttribute("value",r.value),o==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(let a of n.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}t.addEventListener("input",a=>{let l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(e,{value:c})});break}}static setAttributes({html:t,element:e,storage:n=null,intent:i,linkService:o}){let{attributes:r}=e,a=t instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${i}`);for(let[l,c]of Object.entries(r))if(c!=null)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,c)}a&&o.addLinkAttributes(t,r.href,r.newWindow),n&&r.dataId&&this.setupStorage(t,r.dataId,e,n)}static render(t){var p,g;let e=t.annotationStorage,n=t.linkService,i=t.xfaHtml,o=t.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:o,linkService:n});let a=o!=="richText",l=t.div;if(l.append(r),t.viewport){let m=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=m}a&&l.setAttribute("class","xfaLayer xfaFont");let c=[];if(i.children.length===0){if(i.value){let m=document.createTextNode(i.value);r.append(m),a&&Sl.shouldBuildText(i.name)&&c.push(m)}return{textDivs:c}}let d=[[i,-1,r]];for(;d.length>0;){let[m,v,A]=d.at(-1);if(v+1===m.children.length){d.pop();continue}let T=m.children[++d.at(-1)[1]];if(T===null)continue;let{name:E}=T;if(E==="#text"){let S=document.createTextNode(T.value);c.push(S),A.append(S);continue}let C=(p=T==null?void 0:T.attributes)!=null&&p.xmlns?document.createElementNS(T.attributes.xmlns,E):document.createElement(E);if(A.append(C),T.attributes&&this.setAttributes({html:C,element:T,storage:e,intent:o,linkService:n}),((g=T.children)==null?void 0:g.length)>0)d.push([T,-1,C]);else if(T.value){let S=document.createTextNode(T.value);a&&Sl.shouldBuildText(E)&&c.push(S),C.append(S)}}for(let m of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:c}}static update(t){let e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}},Vu=1e3,sP=9,$o=new WeakSet;function rs(s){return{width:s[2]-s[0],height:s[3]-s[1]}}var ky=class{static create(t){switch(t.data.annotationType){case Et.LINK:return new Uh(t);case Et.TEXT:return new Fy(t);case Et.WIDGET:switch(t.data.fieldType){case"Tx":return new Ly(t);case"Btn":return t.data.radioButton?new Oh(t):t.data.checkBox?new Oy(t):new $y(t);case"Ch":return new Gy(t);case"Sig":return new Uy(t)}return new _i(t);case Et.POPUP:return new xl(t);case Et.FREETEXT:return new $h(t);case Et.LINE:return new qy(t);case Et.SQUARE:return new zy(t);case Et.CIRCLE:return new Wy(t);case Et.POLYLINE:return new Gh(t);case Et.CARET:return new Yy(t);case Et.INK:return new Il(t);case Et.POLYGON:return new Ky(t);case Et.HIGHLIGHT:return new Bh(t);case Et.UNDERLINE:return new Xy(t);case Et.SQUIGGLY:return new Zy(t);case Et.STRIKEOUT:return new Qy(t);case Et.STAMP:return new Hh(t);case Et.FILEATTACHMENT:return new jy(t);default:return new vt(t)}}},io,Jr,Xr,Vc,Dy,Uv=class Uv{constructor(t,{isRenderable:e=!1,ignoreBorder:n=!1,createQuadrilaterals:i=!1}={}){y(this,Vc);y(this,io,null);y(this,Jr,!1);y(this,Xr,null);this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(n)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:n}){return!!(t!=null&&t.str||e!=null&&e.str||n!=null&&n.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Uv._hasPopupData(this.data)}updateEdited(t){var n;if(!this.container)return;u(this,io)||_(this,io,{rect:this.data.rect.slice(0)});let{rect:e}=t;e&&w(this,Vc,Dy).call(this,e),(n=u(this,Xr))==null||n.popup.updateEdited(t)}resetEdited(){var t;u(this,io)&&(w(this,Vc,Dy).call(this,u(this,io).rect),(t=u(this,Xr))==null||t.popup.resetEdited(),_(this,io,null))}_createContainer(t){let{data:e,parent:{page:n,viewport:i}}=this,o=document.createElement("section");o.setAttribute("data-annotation-id",e.id),this instanceof _i||(o.tabIndex=Vu);let{style:r}=o;if(r.zIndex=this.parent.zIndex++,e.alternativeText&&(o.title=e.alternativeText),e.noRotate&&o.classList.add("norotate"),!e.rect||this instanceof xl){let{rotation:A}=e;return!e.hasOwnCanvas&&A!==0&&this.setRotation(A,o),o}let{width:a,height:l}=rs(e.rect);if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;let A=e.borderStyle.horizontalCornerRadius,T=e.borderStyle.verticalCornerRadius;if(A>0||T>0){let C=`calc(${A}px * var(--scale-factor)) / calc(${T}px * var(--scale-factor))`;r.borderRadius=C}else if(this instanceof Oh){let C=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;r.borderRadius=C}switch(e.borderStyle.style){case Ja.SOLID:r.borderStyle="solid";break;case Ja.DASHED:r.borderStyle="dashed";break;case Ja.BEVELED:Y("Unimplemented border style: beveled");break;case Ja.INSET:Y("Unimplemented border style: inset");break;case Ja.UNDERLINE:r.borderBottomStyle="solid";break;default:break}let E=e.borderColor||null;E?(_(this,Jr,!0),r.borderColor=$.makeHexColor(E[0]|0,E[1]|0,E[2]|0)):r.borderWidth=0}let c=$.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]),{pageWidth:d,pageHeight:p,pageX:g,pageY:m}=i.rawDims;r.left=`${100*(c[0]-g)/d}%`,r.top=`${100*(c[1]-m)/p}%`;let{rotation:v}=e;return e.hasOwnCanvas||v===0?(r.width=`${100*a/d}%`,r.height=`${100*l/p}%`):this.setRotation(v,o),o}setRotation(t,e=this.container){if(!this.data.rect)return;let{pageWidth:n,pageHeight:i}=this.parent.viewport.rawDims,{width:o,height:r}=rs(this.data.rect),a,l;t%180===0?(a=100*o/n,l=100*r/i):(a=100*r/n,l=100*o/i),e.style.width=`${a}%`,e.style.height=`${l}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){let t=(e,n,i)=>{let o=i.detail[e],r=o[0],a=o.slice(1);i.target.style[n]=Fh[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[n]:Fh[`${r}_rgb`](a)})};return Z(this,"_commonActions",{display:e=>{let{display:n}=e.detail,i=n%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:n===1||n===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{let{hidden:n}=e.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{let n=e.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(t,e){let n=this._commonActions;for(let i of Object.keys(e.detail)){let o=t[i]||n[i];o==null||o(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;let e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;let n=this._commonActions;for(let[i,o]of Object.entries(e)){let r=n[i];if(r){let a={detail:{[i]:o},target:t};r(a),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:t}=this.data;if(!t)return;let[e,n,i,o]=this.data.rect.map(A=>Math.fround(A));if(t.length===8){let[A,T,E,C]=t.subarray(2,6);if(i===A&&o===T&&e===E&&n===C)return}let{style:r}=this.container,a;if(u(this,Jr)){let{borderColor:A,borderWidth:T}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${A}" stroke-width="${T}">`],this.container.classList.add("hasBorder")}let l=i-e,c=o-n,{svgFactory:d}=this,p=d.createElement("svg");p.classList.add("quadrilateralsContainer"),p.setAttribute("width",0),p.setAttribute("height",0);let g=d.createElement("defs");p.append(g);let m=d.createElement("clipPath"),v=`clippath_${this.data.id}`;m.setAttribute("id",v),m.setAttribute("clipPathUnits","objectBoundingBox"),g.append(m);for(let A=2,T=t.length;A<T;A+=8){let E=t[A],C=t[A+1],S=t[A+2],b=t[A+3],x=d.createElement("rect"),R=(S-e)/l,I=(o-C)/c,N=(E-S)/l,M=(C-b)/c;x.setAttribute("x",R),x.setAttribute("y",I),x.setAttribute("width",N),x.setAttribute("height",M),m.append(x),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${R}" y="${I}" width="${N}" height="${M}"/>`)}u(this,Jr)&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(p),this.container.style.clipPath=`url(#${v})`}_createPopup(){let{data:t}=this,e=_(this,Xr,new xl({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(e.render())}render(){ot("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){let n=[];if(this._fieldObjects){let i=this._fieldObjects[t];if(i)for(let{page:o,id:r,exportValues:a}of i){if(o===-1||r===e)continue;let l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${r}"]`);if(c&&!$o.has(c)){Y(`_getElementsByName - element not allowed: ${r}`);continue}n.push({id:r,exportValue:l,domElement:c})}return n}for(let i of document.getElementsByName(t)){let{exportValue:o}=i,r=i.getAttribute("data-element-id");r!==e&&$o.has(i)&&n.push({id:r,exportValue:o,domElement:i})}return n}show(){var t;this.container&&(this.container.hidden=!1),(t=this.popup)==null||t.maybeShow()}hide(){var t;this.container&&(this.container.hidden=!0),(t=this.popup)==null||t.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(let e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}};io=new WeakMap,Jr=new WeakMap,Xr=new WeakMap,Vc=new WeakSet,Dy=function(t){let{container:{style:e},data:{rect:n,rotation:i},parent:{viewport:{rawDims:{pageWidth:o,pageHeight:r,pageX:a,pageY:l}}}}=this;n==null||n.splice(0,4,...t);let{width:c,height:d}=rs(t);e.left=`${100*(t[0]-a)/o}%`,e.top=`${100*(r-t[3]+l)/r}%`,i===0?(e.width=`${100*c/o}%`,e.height=`${100*d/r}%`):this.setRotation(i)};var vt=Uv,oi,ds,Hf,NT,Vf,kT,Uh=class extends vt{constructor(e,n=null){super(e,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});y(this,oi);y(this,Hf);y(this,Vf);this.isTooltipOnly=e.data.isTooltipOnly}render(){let{data:e,linkService:n}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let o=!1;return e.url?(n.addLinkAttributes(i,e.url,e.newWindow),o=!0):e.action?(this._bindNamedAction(i,e.action),o=!0):e.attachment?(w(this,Hf,NT).call(this,i,e.attachment,e.attachmentDest),o=!0):e.setOCGState?(w(this,Vf,kT).call(this,i,e.setOCGState),o=!0):e.dest?(this._bindLink(i,e.dest),o=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),o=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),o=!0):this.isTooltipOnly&&!o&&(this._bindLink(i,""),o=!0)),this.container.classList.add("linkAnnotation"),o&&this.container.append(i),this.container}_bindLink(e,n){e.href=this.linkService.getDestinationHash(n),e.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&w(this,oi,ds).call(this)}_bindNamedAction(e,n){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(n),!1),w(this,oi,ds).call(this)}_bindJSAction(e,n){e.href=this.linkService.getAnchorUrl("");let i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let o of Object.keys(n.actions)){let r=i.get(o);r&&(e[r]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:o}}),!1})}e.onclick||(e.onclick=()=>!1),w(this,oi,ds).call(this)}_bindResetFormAction(e,n){let i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),w(this,oi,ds).call(this),!this._fieldObjects){Y('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(e.onclick=()=>!1);return}e.onclick=()=>{var p;i==null||i();let{fields:o,refs:r,include:a}=n,l=[];if(o.length!==0||r.length!==0){let g=new Set(r);for(let m of o){let v=this._fieldObjects[m]||[];for(let{id:A}of v)g.add(A)}for(let m of Object.values(this._fieldObjects))for(let v of m)g.has(v.id)===a&&l.push(v)}else for(let g of Object.values(this._fieldObjects))l.push(...g);let c=this.annotationStorage,d=[];for(let g of l){let{id:m}=g;switch(d.push(m),g.type){case"text":{let A=g.defaultValue||"";c.setValue(m,{value:A});break}case"checkbox":case"radiobutton":{let A=g.defaultValue===g.exportValues;c.setValue(m,{value:A});break}case"combobox":case"listbox":{let A=g.defaultValue||"";c.setValue(m,{value:A});break}default:continue}let v=document.querySelector(`[data-element-id="${m}"]`);if(v){if(!$o.has(v)){Y(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;v.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}};oi=new WeakSet,ds=function(){this.container.setAttribute("data-internal-link","")},Hf=new WeakSet,NT=function(e,n,i=null){e.href=this.linkService.getAnchorUrl(""),n.description&&(e.title=n.description),e.onclick=()=>{var o;return(o=this.downloadManager)==null||o.openOrDownloadData(n.content,n.filename,i),!1},w(this,oi,ds).call(this)},Vf=new WeakSet,kT=function(e,n){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(n),!1),w(this,oi,ds).call(this)};var Fy=class extends vt{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}},_i=class extends vt{render(){return this.container}showElementAndHideCanvas(t){var e;this.data.hasOwnCanvas&&(((e=t.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Bt.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,n,i,o){n.includes("mouse")?t.addEventListener(n,r=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:o(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):t.addEventListener(n,r=>{var a;if(n==="blur"){if(!e.focused||!r.relatedTarget)return;e.focused=!1}else if(n==="focus"){if(e.focused)return;e.focused=!0}o&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:o(r)}}))})}_setEventListeners(t,e,n,i){var o,r,a;for(let[l,c]of n)(c==="Action"||(o=this.data.actions)!=null&&o[c])&&((c==="Focus"||c==="Blur")&&(e||(e={focused:!1})),this._setEventListener(t,e,l,c,i),c==="Focus"&&!((r=this.data.actions)!=null&&r.Blur)?this._setEventListener(t,e,"blur","Blur",null):c==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){let e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":$.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){let e=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||sP,o=t.style,r,a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),d=Math.round(c/(Bd*i))||1,p=c/d;r=Math.min(i,l(p/Bd))}else{let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(i,l(c/Bd))}o.fontSize=`calc(${r}px * var(--scale-factor))`,o.color=$.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(o.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}},Ly=class extends _i{constructor(t){let e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,n,i){let o=this.annotationStorage;for(let r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=n),o.setValue(r.id,{[i]:n})}render(){var i,o;let t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){let r=t.getValue(e,{value:this.data.fieldValue}),a=r.value||"",l=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;l&&a.length>l&&(a=a.slice(0,l));let c=r.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));let d={userValue:a,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=c!=null?c:a,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",c!=null?c:a),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),$o.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=Vu,this._setRequired(n,this.data.required),l&&(n.maxLength=l),n.addEventListener("input",g=>{t.setValue(e,{value:g.target.value}),this.setPropertyOnSiblings(n,"value",g.target.value,"value"),d.formattedValue=null}),n.addEventListener("resetform",g=>{var v;let m=(v=this.data.defaultFieldValue)!=null?v:"";n.value=d.userValue=m,d.formattedValue=null});let p=g=>{let{formattedValue:m}=d;m!=null&&(g.target.value=m),g.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",m=>{var A;if(d.focused)return;let{target:v}=m;d.userValue&&(v.value=d.userValue),d.lastCommittedValue=v.value,d.commitKey=1,(A=this.data.actions)!=null&&A.Focus||(d.focused=!0)}),n.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);let v={value(A){var T;d.userValue=(T=A.detail.value)!=null?T:"",t.setValue(e,{value:d.userValue.toString()}),A.target.value=d.userValue},formattedValue(A){let{formattedValue:T}=A.detail;d.formattedValue=T,T!=null&&A.target!==document.activeElement&&(A.target.value=T),t.setValue(e,{formattedValue:T})},selRange(A){A.target.setSelectionRange(...A.detail.selRange)},charLimit:A=>{var S;let{charLimit:T}=A.detail,{target:E}=A;if(T===0){E.removeAttribute("maxLength");return}E.setAttribute("maxLength",T);let C=d.userValue;!C||C.length<=T||(C=C.slice(0,T),E.value=d.userValue=C,t.setValue(e,{value:C}),(S=this.linkService.eventBus)==null||S.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:C,willCommit:!0,commitKey:1,selStart:E.selectionStart,selEnd:E.selectionEnd}}))}};this._dispatchEventFromSandbox(v,m)}),n.addEventListener("keydown",m=>{var T;d.commitKey=1;let v=-1;if(m.key==="Escape"?v=0:m.key==="Enter"&&!this.data.multiLine?v=2:m.key==="Tab"&&(d.commitKey=3),v===-1)return;let{value:A}=m.target;d.lastCommittedValue!==A&&(d.lastCommittedValue=A,d.userValue=A,(T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:A,willCommit:!0,commitKey:v,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});let g=p;p=null,n.addEventListener("blur",m=>{var A,T;if(!d.focused||!m.relatedTarget)return;(A=this.data.actions)!=null&&A.Blur||(d.focused=!1);let{value:v}=m.target;d.userValue=v,d.lastCommittedValue!==v&&((T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:v,willCommit:!0,commitKey:d.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}})),g(m)}),(o=this.data.actions)!=null&&o.Keystroke&&n.addEventListener("beforeinput",m=>{var x;d.lastCommittedValue=null;let{data:v,target:A}=m,{value:T,selectionStart:E,selectionEnd:C}=A,S=E,b=C;switch(m.inputType){case"deleteWordBackward":{let R=T.substring(0,E).match(/\w*[^\w]*$/);R&&(S-=R[0].length);break}case"deleteWordForward":{let R=T.substring(E).match(/^[^\w]*\w*/);R&&(b+=R[0].length);break}case"deleteContentBackward":E===C&&(S-=1);break;case"deleteContentForward":E===C&&(b+=1);break}m.preventDefault(),(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:T,change:v||"",willCommit:!1,selStart:S,selEnd:b}})}),this._setEventListeners(n,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(p&&n.addEventListener("blur",p),this.data.comb){let m=(this.data.rect[2]-this.data.rect[0])/l;n.classList.add("comb"),n.style.letterSpacing=`calc(${m}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},Uy=class extends _i{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}},Oy=class extends _i{constructor(t){super(t,{isRenderable:t.renderForms})}render(){let t=this.annotationStorage,e=this.data,n=e.id,i=t.getValue(n,{value:e.exportValue===e.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",t.setValue(n,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let o=document.createElement("input");return $o.add(o),o.setAttribute("data-element-id",n),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="checkbox",o.name=e.fieldName,i&&o.setAttribute("checked",!0),o.setAttribute("exportValue",e.exportValue),o.tabIndex=Vu,o.addEventListener("change",r=>{let{name:a,checked:l}=r.target;for(let c of this._getElementsByName(a,n)){let d=l&&c.exportValue===e.exportValue;c.domElement&&(c.domElement.checked=d),t.setValue(c.id,{value:d})}t.setValue(n,{value:l})}),o.addEventListener("resetform",r=>{let a=e.defaultFieldValue||"Off";r.target.checked=a===e.exportValue}),this.enableScripting&&this.hasJSActions&&(o.addEventListener("updatefromsandbox",r=>{let a={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(n,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}},Oh=class extends _i{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let t=this.annotationStorage,e=this.data,n=e.id,i=t.getValue(n,{value:e.fieldValue===e.buttonValue}).value;if(typeof i=="string"&&(i=i!==e.buttonValue,t.setValue(n,{value:i})),i)for(let r of this._getElementsByName(e.fieldName,n))t.setValue(r.id,{value:!1});let o=document.createElement("input");if($o.add(o),o.setAttribute("data-element-id",n),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="radio",o.name=e.fieldName,i&&o.setAttribute("checked",!0),o.tabIndex=Vu,o.addEventListener("change",r=>{let{name:a,checked:l}=r.target;for(let c of this._getElementsByName(a,n))t.setValue(c.id,{value:!1});t.setValue(n,{value:l})}),o.addEventListener("resetform",r=>{let a=e.defaultFieldValue;r.target.checked=a!=null&&a===e.buttonValue}),this.enableScripting&&this.hasJSActions){let r=e.buttonValue;o.addEventListener("updatefromsandbox",a=>{let l={value:c=>{let d=r===c.detail.value;for(let p of this._getElementsByName(c.target.name)){let g=d&&p.id===n;p.domElement&&(p.domElement.checked=g),t.setValue(p.id,{value:g})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}},$y=class extends Uh{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){let t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");let e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),t}},Gy=class extends _i{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let t=this.annotationStorage,e=this.data.id,n=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");$o.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=Vu;let o=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",d=>{let p=this.data.defaultFieldValue;for(let g of i.options)g.selected=g.value===p});for(let d of this.data.options){let p=document.createElement("option");p.textContent=d.displayValue,p.value=d.exportValue,n.value.includes(d.exportValue)&&(p.setAttribute("selected",!0),o=!1),i.append(p)}let r=null;if(o){let d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),i.prepend(d),r=()=>{d.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}let a=d=>{let p=d?"value":"textContent",{options:g,multiple:m}=i;return m?Array.prototype.filter.call(g,v=>v.selected).map(v=>v[p]):g.selectedIndex===-1?null:g[g.selectedIndex][p]},l=a(!1),c=d=>{let p=d.target.options;return Array.prototype.map.call(p,g=>({displayValue:g.textContent,exportValue:g.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",d=>{let p={value(g){r==null||r();let m=g.detail.value,v=new Set(Array.isArray(m)?m:[m]);for(let A of i.options)A.selected=v.has(A.value);t.setValue(e,{value:a(!0)}),l=a(!1)},multipleSelection(g){i.multiple=!0},remove(g){let m=i.options,v=g.detail.remove;m[v].selected=!1,i.remove(v),m.length>0&&Array.prototype.findIndex.call(m,T=>T.selected)===-1&&(m[0].selected=!0),t.setValue(e,{value:a(!0),items:c(g)}),l=a(!1)},clear(g){for(;i.length!==0;)i.remove(0);t.setValue(e,{value:null,items:[]}),l=a(!1)},insert(g){let{index:m,displayValue:v,exportValue:A}=g.detail.insert,T=i.children[m],E=document.createElement("option");E.textContent=v,E.value=A,T?T.before(E):i.append(E),t.setValue(e,{value:a(!0),items:c(g)}),l=a(!1)},items(g){let{items:m}=g.detail;for(;i.length!==0;)i.remove(0);for(let v of m){let{displayValue:A,exportValue:T}=v,E=document.createElement("option");E.textContent=A,E.value=T,i.append(E)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:a(!0),items:c(g)}),l=a(!1)},indices(g){let m=new Set(g.detail.indices);for(let v of g.target.options)v.selected=m.has(v.index);t.setValue(e,{value:a(!0)}),l=a(!1)},editable(g){g.target.disabled=!g.detail.editable}};this._dispatchEventFromSandbox(p,d)}),i.addEventListener("input",d=>{var m;let p=a(!0),g=a(!1);t.setValue(e,{value:p}),d.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:g,changeEx:p,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):i.addEventListener("input",function(d){t.setValue(e,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},xl=class extends vt{constructor(t){let{data:e,elements:n}=t;super(t,{isRenderable:vt._hasPopupData(e)}),this.elements=n,this.popup=null}render(){this.container.classList.add("popupAnnotation");let t=this.popup=new By({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(let n of this.elements)n.popup=t,n.container.ariaHasPopup="dialog",e.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(n=>`${Mv}${n}`).join(",")),this.container}},Zr,qf,zf,Qr,so,gt,ri,jr,qc,zc,ta,ai,en,li,Wc,ci,Kc,oo,ro,ea,ih,Yc,Hy,Wf,DT,Kf,FT,Yf,LT,Jf,UT,na,sh,ia,oh,Jc,Vy,By=class{constructor({container:t,color:e,elements:n,titleObj:i,modificationDate:o,contentsObj:r,richText:a,parent:l,rect:c,parentRect:d,open:p}){y(this,ea);y(this,Yc);y(this,Wf);y(this,Kf);y(this,Yf);y(this,Jf);y(this,na);y(this,ia);y(this,Jc);y(this,Zr,w(this,Yf,LT).bind(this));y(this,qf,w(this,Jc,Vy).bind(this));y(this,zf,w(this,ia,oh).bind(this));y(this,Qr,w(this,na,sh).bind(this));y(this,so,null);y(this,gt,null);y(this,ri,null);y(this,jr,null);y(this,qc,null);y(this,zc,null);y(this,ta,null);y(this,ai,!1);y(this,en,null);y(this,li,null);y(this,Wc,null);y(this,ci,null);y(this,Kc,null);y(this,oo,null);y(this,ro,!1);var g;_(this,gt,t),_(this,Kc,i),_(this,ri,r),_(this,ci,a),_(this,zc,l),_(this,so,e),_(this,Wc,c),_(this,ta,d),_(this,qc,n),_(this,jr,ml.toDateObject(o)),this.trigger=n.flatMap(m=>m.getElementsToTriggerPopup());for(let m of this.trigger)m.addEventListener("click",u(this,Qr)),m.addEventListener("mouseenter",u(this,zf)),m.addEventListener("mouseleave",u(this,qf)),m.classList.add("popupTriggerArea");for(let m of n)(g=m.container)==null||g.addEventListener("keydown",u(this,Zr));u(this,gt).hidden=!0,p&&w(this,na,sh).call(this)}render(){if(u(this,en))return;let t=_(this,en,document.createElement("div"));if(t.className="popup",u(this,so)){let o=t.style.outlineColor=$.makeHexColor(...u(this,so));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?t.style.backgroundColor=`color-mix(in srgb, ${o} 30%, white)`:t.style.backgroundColor=$.makeHexColor(...u(this,so).map(a=>Math.floor(.7*(255-a)+a)))}let e=document.createElement("span");e.className="header";let n=document.createElement("h1");if(e.append(n),{dir:n.dir,str:n.textContent}=u(this,Kc),t.append(e),u(this,jr)){let o=document.createElement("span");o.classList.add("popupDate"),o.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),o.setAttribute("data-l10n-args",JSON.stringify({dateObj:u(this,jr).valueOf()})),e.append(o)}let i=u(this,ea,ih);if(i)Lh.render({xfaHtml:i,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{let o=this._formatContents(u(this,ri));t.append(o)}u(this,gt).append(t)}_formatContents({str:t,dir:e}){let n=document.createElement("p");n.classList.add("popupContent"),n.dir=e;let i=t.split(/(?:\r\n?|\n)/);for(let o=0,r=i.length;o<r;++o){let a=i[o];n.append(document.createTextNode(a)),o<r-1&&n.append(document.createElement("br"))}return n}updateEdited({rect:t,popupContent:e}){var n;u(this,oo)||_(this,oo,{contentsObj:u(this,ri),richText:u(this,ci)}),t&&_(this,li,null),e&&(_(this,ci,w(this,Kf,FT).call(this,e)),_(this,ri,null)),(n=u(this,en))==null||n.remove(),_(this,en,null)}resetEdited(){var t;u(this,oo)&&({contentsObj:jt(this,ri)._,richText:jt(this,ci)._}=u(this,oo),_(this,oo,null),(t=u(this,en))==null||t.remove(),_(this,en,null),_(this,li,null))}forceHide(){_(this,ro,this.isVisible),u(this,ro)&&(u(this,gt).hidden=!0)}maybeShow(){u(this,ro)&&(u(this,en)||w(this,ia,oh).call(this),_(this,ro,!1),u(this,gt).hidden=!1)}get isVisible(){return u(this,gt).hidden===!1}};Zr=new WeakMap,qf=new WeakMap,zf=new WeakMap,Qr=new WeakMap,so=new WeakMap,gt=new WeakMap,ri=new WeakMap,jr=new WeakMap,qc=new WeakMap,zc=new WeakMap,ta=new WeakMap,ai=new WeakMap,en=new WeakMap,li=new WeakMap,Wc=new WeakMap,ci=new WeakMap,Kc=new WeakMap,oo=new WeakMap,ro=new WeakMap,ea=new WeakSet,ih=function(){let t=u(this,ci),e=u(this,ri);return t!=null&&t.str&&(!(e!=null&&e.str)||e.str===t.str)&&u(this,ci).html||null},Yc=new WeakSet,Hy=function(){var t,e,n;return((n=(e=(t=u(this,ea,ih))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:n.fontSize)||0},Wf=new WeakSet,DT=function(){var t,e,n;return((n=(e=(t=u(this,ea,ih))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:n.color)||null},Kf=new WeakSet,FT=function(t){let e=[],n={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:u(this,Wf,DT),fontSize:u(this,Yc,Hy)?`calc(${u(this,Yc,Hy)}px * var(--scale-factor))`:""}};for(let o of t.split(`
`))e.push({name:"span",value:o,attributes:i});return n},Yf=new WeakSet,LT=function(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&u(this,ai))&&w(this,na,sh).call(this)},Jf=new WeakSet,UT=function(){if(u(this,li)!==null)return;let{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:n,pageX:i,pageY:o}}}=u(this,zc),r=!!u(this,ta),a=r?u(this,ta):u(this,Wc);for(let v of u(this,qc))if(!a||$.intersect(v.data.rect,a)!==null){a=v.data.rect,r=!0;break}let l=$.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]),d=r?a[2]-a[0]+5:0,p=l[0]+d,g=l[1];_(this,li,[100*(p-i)/e,100*(g-o)/n]);let{style:m}=u(this,gt);m.left=`${u(this,li)[0]}%`,m.top=`${u(this,li)[1]}%`},na=new WeakSet,sh=function(){_(this,ai,!u(this,ai)),u(this,ai)?(w(this,ia,oh).call(this),u(this,gt).addEventListener("click",u(this,Qr)),u(this,gt).addEventListener("keydown",u(this,Zr))):(w(this,Jc,Vy).call(this),u(this,gt).removeEventListener("click",u(this,Qr)),u(this,gt).removeEventListener("keydown",u(this,Zr)))},ia=new WeakSet,oh=function(){u(this,en)||this.render(),this.isVisible?u(this,ai)&&u(this,gt).classList.add("focused"):(w(this,Jf,UT).call(this),u(this,gt).hidden=!1,u(this,gt).style.zIndex=parseInt(u(this,gt).style.zIndex)+1e3)},Jc=new WeakSet,Vy=function(){u(this,gt).classList.remove("focused"),!(u(this,ai)||!this.isVisible)&&(u(this,gt).hidden=!0,u(this,gt).style.zIndex=parseInt(u(this,gt).style.zIndex)-1e3)};var $h=class extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=K.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(let e of this.textContent){let n=document.createElement("span");n.textContent=e,t.append(n)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Xc,qy=class extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,Xc,null)}render(){this.container.classList.add("lineAnnotation");let e=this.data,{width:n,height:i}=rs(e.rect),o=this.svgFactory.create(n,i,!0),r=_(this,Xc,this.svgFactory.createElement("svg:line"));return r.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),r.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),r.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),r.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),r.setAttribute("stroke-width",e.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),o.append(r),this.container.append(o),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Xc)}addHighlightArea(){this.container.classList.add("highlightArea")}};Xc=new WeakMap;var Zc,zy=class extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,Zc,null)}render(){this.container.classList.add("squareAnnotation");let e=this.data,{width:n,height:i}=rs(e.rect),o=this.svgFactory.create(n,i,!0),r=e.borderStyle.width,a=_(this,Zc,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",r/2),a.setAttribute("y",r/2),a.setAttribute("width",n-r),a.setAttribute("height",i-r),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),o.append(a),this.container.append(o),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Zc)}addHighlightArea(){this.container.classList.add("highlightArea")}};Zc=new WeakMap;var Qc,Wy=class extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,Qc,null)}render(){this.container.classList.add("circleAnnotation");let e=this.data,{width:n,height:i}=rs(e.rect),o=this.svgFactory.create(n,i,!0),r=e.borderStyle.width,a=_(this,Qc,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",n/2),a.setAttribute("cy",i/2),a.setAttribute("rx",n/2-r/2),a.setAttribute("ry",i/2-r/2),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),o.append(a),this.container.append(o),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Qc)}addHighlightArea(){this.container.classList.add("highlightArea")}};Qc=new WeakMap;var jc,Gh=class extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,jc,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,vertices:n,borderStyle:i,popupRef:o}}=this;if(!n)return this.container;let{width:r,height:a}=rs(e),l=this.svgFactory.create(r,a,!0),c=[];for(let p=0,g=n.length;p<g;p+=2){let m=n[p]-e[0],v=e[3]-n[p+1];c.push(`${m},${v}`)}c=c.join(" ");let d=_(this,jc,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",c),d.setAttribute("stroke-width",i.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),l.append(d),this.container.append(l),!o&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,jc)}addHighlightArea(){this.container.classList.add("highlightArea")}};jc=new WeakMap;var Ky=class extends Gh{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},Yy=class extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},tu,ao,eu,Jy,Il=class extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,eu);y(this,tu,null);y(this,ao,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?K.HIGHLIGHT:K.INK}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,rotation:n,inkLists:i,borderStyle:o,popupRef:r}}=this,{transform:a,width:l,height:c}=w(this,eu,Jy).call(this,n,e),d=this.svgFactory.create(l,c,!0),p=_(this,tu,this.svgFactory.createElement("svg:g"));d.append(p),p.setAttribute("stroke-width",o.width||1),p.setAttribute("stroke-linecap","round"),p.setAttribute("stroke-linejoin","round"),p.setAttribute("stroke-miterlimit",10),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),p.setAttribute("transform",a);for(let g=0,m=i.length;g<m;g++){let v=this.svgFactory.createElement(this.svgElementName);u(this,ao).push(v),v.setAttribute("points",i[g].join(",")),p.append(v)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);let{thickness:n,points:i,rect:o}=e,r=u(this,tu);if(n>=0&&r.setAttribute("stroke-width",n||1),i)for(let a=0,l=u(this,ao).length;a<l;a++)u(this,ao)[a].setAttribute("points",i[a].join(","));if(o){let{transform:a,width:l,height:c}=w(this,eu,Jy).call(this,this.data.rotation,o);r.parentElement.setAttribute("viewBox",`0 0 ${l} ${c}`),r.setAttribute("transform",a)}}getElementsToTriggerPopup(){return u(this,ao)}addHighlightArea(){this.container.classList.add("highlightArea")}};tu=new WeakMap,ao=new WeakMap,eu=new WeakSet,Jy=function(e,n){switch(e){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};var Bh=class extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=K.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},Xy=class extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},Zy=class extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},Qy=class extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},Hh=class extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=K.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},nu,iu,tv,jy=class extends vt{constructor(e){var i;super(e,{isRenderable:!0});y(this,iu);y(this,nu,null);let{file:n}=this.data;this.filename=n.filename,this.content=n.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:e,data:n}=this,i;n.hasAppearance||n.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),i.addEventListener("dblclick",w(this,iu,tv).bind(this)),_(this,nu,i);let{isMac:o}=Bt.platform;return e.addEventListener("keydown",r=>{r.key==="Enter"&&(o?r.metaKey:r.ctrlKey)&&w(this,iu,tv).call(this)}),!n.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),e.append(i),e}getElementsToTriggerPopup(){return u(this,nu)}addHighlightArea(){this.container.classList.add("highlightArea")}};nu=new WeakMap,iu=new WeakSet,tv=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.content,this.filename)};var su,lo,co,ou,Xf,OT,ru,nv,ev=class{constructor({div:t,accessibilityManager:e,annotationCanvasMap:n,annotationEditorUIManager:i,page:o,viewport:r,structTreeLayer:a}){y(this,Xf);y(this,ru);y(this,su,null);y(this,lo,null);y(this,co,new Map);y(this,ou,null);this.div=t,_(this,su,e),_(this,lo,n),_(this,ou,a||null),this.page=o,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return u(this,co).size>0}async render(t){var r;let{annotations:e}=t,n=this.div;Lo(n,this.viewport);let i=new Map,o={data:null,layer:n,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new bl,annotationStorage:t.annotationStorage||new Tl,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(let a of e){if(a.noHTML)continue;let l=a.annotationType===Et.POPUP;if(l){let p=i.get(a.id);if(!p)continue;o.elements=p}else{let{width:p,height:g}=rs(a.rect);if(p<=0||g<=0)continue}o.data=a;let c=ky.create(o);if(!c.isRenderable)continue;if(!l&&a.popupRef){let p=i.get(a.popupRef);p?p.push(c):i.set(a.popupRef,[c])}let d=c.render();a.hidden&&(d.style.visibility="hidden"),await w(this,Xf,OT).call(this,d,a.id),c._isEditable&&(u(this,co).set(c.data.id,c),(r=this._annotationEditorUIManager)==null||r.renderAnnotationElement(c))}w(this,ru,nv).call(this)}update({viewport:t}){let e=this.div;this.viewport=t,Lo(e,{rotation:t.rotation}),w(this,ru,nv).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(u(this,co).values())}getEditableAnnotation(t){return u(this,co).get(t)}};su=new WeakMap,lo=new WeakMap,co=new WeakMap,ou=new WeakMap,Xf=new WeakSet,OT=async function(t,e){var r,a;let n=t.firstChild||t,i=n.id=`${Mv}${e}`,o=await((r=u(this,ou))==null?void 0:r.getAriaAttributes(i));if(o)for(let[l,c]of o)n.setAttribute(l,c);this.div.append(t),(a=u(this,su))==null||a.moveElementInDOM(this.div,t,n,!1)},ru=new WeakSet,nv=function(){if(!u(this,lo))return;let t=this.div;for(let[e,n]of u(this,lo)){let i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i)continue;n.className="annotationContent";let{firstChild:o}=i;o?o.nodeName==="CANVAS"?o.replaceWith(n):o.classList.contains("annotationContent")?o.after(n):o.before(n):i.append(n)}u(this,lo).clear()};var Gd=/\r\n?|\n/g,nn,we,au,uo,Te,Zf,$T,Qf,GT,jf,BT,sa,rh,oa,ah,ra,lh,tp,HT,lu,sv,ep,VT,st=class st extends ft{constructor(e){super({...e,name:"freeTextEditor"});y(this,Zf);y(this,Qf);y(this,jf);y(this,sa);y(this,ra);y(this,tp);y(this,ep);y(this,nn,void 0);y(this,we,"");y(this,au,`${this.id}-editor`);y(this,uo,null);y(this,Te,void 0);_(this,nn,e.color||st._defaultColor||ft._defaultLineColor),_(this,Te,e.fontSize||st._defaultFontSize)}static get _keyboardManager(){let e=st.prototype,n=r=>r.isEmpty(),i=Oo.TRANSLATE_SMALL,o=Oo.TRANSLATE_BIG;return Z(this,"_keyboardManager",new Uo([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-o,0],checker:n}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[i,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[o,0],checker:n}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-o],checker:n}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,i],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,o],checker:n}]]))}static initialize(e,n){ft.initialize(e,n);let i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,n){switch(e){case Q.FREETEXT_SIZE:st._defaultFontSize=n;break;case Q.FREETEXT_COLOR:st._defaultColor=n;break}}updateParams(e,n){switch(e){case Q.FREETEXT_SIZE:w(this,Zf,$T).call(this,n);break;case Q.FREETEXT_COLOR:w(this,Qf,GT).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Q.FREETEXT_SIZE,st._defaultFontSize],[Q.FREETEXT_COLOR,st._defaultColor||ft._defaultLineColor]]}get propertiesToUpdate(){return[[Q.FREETEXT_SIZE,u(this,Te)],[Q.FREETEXT_COLOR,u(this,nn)]]}_translateEmpty(e,n){this._uiManager.translateSelectedEditors(e,n,!0)}getInitialTranslation(){let e=this.parentScale;return[-st._internalPadding*e,-(st._internalPadding+u(this,Te))*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(K.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),_(this,uo,new AbortController);let e=this._uiManager.combinedSignal(u(this,uo));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){var e;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",u(this,au)),this._isDraggable=!0,(e=u(this,uo))==null||e.abort(),_(this,uo,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){var n;this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let e=u(this,we),n=_(this,we,w(this,jf,BT).call(this).trimEnd());if(e===n)return;let i=o=>{if(_(this,we,o),!o){this.remove();return}w(this,ra,lh).call(this),this._uiManager.rebuild(this),w(this,sa,rh).call(this)};this.addCommands({cmd:()=>{i(n)},undo:()=>{i(e)},mustExec:!1}),w(this,sa,rh).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){st._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,n;this.width&&(e=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",u(this,au)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:i}=this.editorDiv;if(i.fontSize=`calc(${u(this,Te)}px * var(--scale-factor))`,i.color=u(this,nn),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Ah(this,this.div,["dblclick","keydown"]),this.width){let[o,r]=this.parentDimensions;if(this.annotationElementId){let{position:a}=this._initialData,[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);let[d,p]=this.pageDimensions,[g,m]=this.pageTranslation,v,A;switch(this.rotation){case 0:v=e+(a[0]-g)/d,A=n+this.height-(a[1]-m)/p;break;case 90:v=e+(a[0]-g)/d,A=n-(a[1]-m)/p,[l,c]=[c,-l];break;case 180:v=e-this.width+(a[0]-g)/d,A=n-(a[1]-m)/p,[l,c]=[-l,-c];break;case 270:v=e+(a[0]-g-this.height*p)/d,A=n+(a[1]-m-this.width*d)/p,[l,c]=[-c,l];break}this.setAt(v*o,A*r,l,c)}else this.setAt(e*o,n*r,this.width*o,this.height*r);w(this,ra,lh).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){var v,A,T;let n=e.clipboardData||window.clipboardData,{types:i}=n;if(i.length===1&&i[0]==="text/plain")return;e.preventDefault();let o=w(v=st,lu,sv).call(v,n.getData("text")||"").replaceAll(Gd,`
`);if(!o)return;let r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();let a=r.getRangeAt(0);if(!o.includes(`
`)){a.insertNode(document.createTextNode(o)),this.editorDiv.normalize(),r.collapseToStart();return}let{startContainer:l,startOffset:c}=a,d=[],p=[];if(l.nodeType===Node.TEXT_NODE){let E=l.parentElement;if(p.push(l.nodeValue.slice(c).replaceAll(Gd,"")),E!==this.editorDiv){let C=d;for(let S of this.editorDiv.childNodes){if(S===E){C=p;continue}C.push(w(A=st,oa,ah).call(A,S))}}d.push(l.nodeValue.slice(0,c).replaceAll(Gd,""))}else if(l===this.editorDiv){let E=d,C=0;for(let S of this.editorDiv.childNodes)C++===c&&(E=p),E.push(w(T=st,oa,ah).call(T,S))}_(this,we,`${d.join(`
`)}${o}${p.join(`
`)}`),w(this,ra,lh).call(this);let g=new Range,m=d.reduce((E,C)=>E+C.length,0);for(let{firstChild:E}of this.editorDiv.childNodes)if(E.nodeType===Node.TEXT_NODE){let C=E.nodeValue.length;if(m<=C){g.setStart(E,m),g.setEnd(E,m);break}m-=C}r.removeAllRanges(),r.addRange(g)}get contentDiv(){return this.editorDiv}static async deserialize(e,n,i){var a;let o=null;if(e instanceof $h){let{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:d,rotation:p,id:g,popupRef:m},textContent:v,textPosition:A,parent:{page:{pageNumber:T}}}=e;if(!v||v.length===0)return null;o=e={annotationType:K.FREETEXT,color:Array.from(c),fontSize:l,value:v.join(`
`),position:A,pageIndex:T-1,rect:d.slice(0),rotation:p,id:g,deleted:!1,popupRef:m}}let r=await super.deserialize(e,n,i);return _(r,Te,e.fontSize),_(r,nn,$.makeHexColor(...e.color)),_(r,we,w(a=st,lu,sv).call(a,e.value)),r.annotationElementId=e.id||null,r._initialData=o,r}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let n=st._internalPadding*this.parentScale,i=this.getRect(n,n),o=ft._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:u(this,nn)),r={annotationType:K.FREETEXT,color:o,fontSize:u(this,Te),value:w(this,tp,HT).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?r:this.annotationElementId&&!w(this,ep,VT).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(e){let n=super.renderAnnotationElement(e);if(this.deleted)return n;let{style:i}=n;i.fontSize=`calc(${u(this,Te)}px * var(--scale-factor))`,i.color=u(this,nn),n.replaceChildren();for(let r of u(this,we).split(`
`)){let a=document.createElement("div");a.append(r?document.createTextNode(r):document.createElement("br")),n.append(a)}let o=st._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(o,o),popupContent:u(this,we)}),n}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}};nn=new WeakMap,we=new WeakMap,au=new WeakMap,uo=new WeakMap,Te=new WeakMap,Zf=new WeakSet,$T=function(e){let n=o=>{this.editorDiv.style.fontSize=`calc(${o}px * var(--scale-factor))`,this.translate(0,-(o-u(this,Te))*this.parentScale),_(this,Te,o),w(this,sa,rh).call(this)},i=u(this,Te);this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Qf=new WeakSet,GT=function(e){let n=o=>{_(this,nn,this.editorDiv.style.color=o)},i=u(this,nn);this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},jf=new WeakSet,BT=function(){var i;let e=[];this.editorDiv.normalize();let n=null;for(let o of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&o.nodeName==="BR"||(e.push(w(i=st,oa,ah).call(i,o)),n=o);return e.join(`
`)},sa=new WeakSet,rh=function(){let[e,n]=this.parentDimensions,i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{let{currentLayer:o,div:r}=this,a=r.style.display,l=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",o.div.append(this.div),i=r.getBoundingClientRect(),r.remove(),r.style.display=a,r.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/e,this.height=i.height/n):(this.width=i.height/e,this.height=i.width/n),this.fixAndSetPosition()},oa=new WeakSet,ah=function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Gd,"")},ra=new WeakSet,lh=function(){if(this.editorDiv.replaceChildren(),!!u(this,we))for(let e of u(this,we).split(`
`)){let n=document.createElement("div");n.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(n)}},tp=new WeakSet,HT=function(){return u(this,we).replaceAll("\xA0"," ")},lu=new WeakSet,sv=function(e){return e.replaceAll(" ","\xA0")},ep=new WeakSet,VT=function(e){let{value:n,fontSize:i,color:o,pageIndex:r}=this._initialData;return this._hasBeenMoved||e.value!==n||e.fontSize!==i||e.color.some((a,l)=>a!==o[l])||e.pageIndex!==r},y(st,oa),y(st,lu),H(st,"_freeTextDefaultContent",""),H(st,"_internalPadding",0),H(st,"_defaultColor",null),H(st,"_defaultFontSize",10),H(st,"_type","freetext"),H(st,"_editorType",K.FREETEXT);var iv=st,L=class{toSVGPath(){ot("Abstract method `toSVGPath` must be implemented.")}get box(){ot("Abstract getter `box` must be implemented.")}serialize(t,e){ot("Abstract method `serialize` must be implemented.")}static _rescale(t,e,n,i,o,r){r||(r=new Float32Array(t.length));for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a]*i,r[a+1]=n+t[a+1]*o;return r}static _rescaleAndSwap(t,e,n,i,o,r){r||(r=new Float32Array(t.length));for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a+1]*i,r[a+1]=n+t[a]*o;return r}static _translate(t,e,n,i){i||(i=new Float32Array(t.length));for(let o=0,r=t.length;o<r;o+=2)i[o]=e+t[o],i[o+1]=n+t[o+1];return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,n,i,o){switch(o){case 90:return[1-e/n,t/i];case 180:return[1-t/n,1-e/i];case 270:return[e/n,1-t/i];default:return[t/n,e/i]}}static _normalizePagePoint(t,e,n){switch(n){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,n,i,o,r){return[(t+5*n)/6,(e+5*i)/6,(5*n+o)/6,(5*i+r)/6,(n+o)/2,(i+r)/2]}};H(L,"PRECISION",1e-4);var Ee,sn,aa,la,xn,X,ho,fo,cu,uu,ca,ua,Ki,du,np,ip,po,ll,sp,qT,op,zT,rp,WT,ap,KT,lp,YT,cp,JT,qn=class qn{constructor({x:t,y:e},n,i,o,r,a=0){y(this,po);y(this,sp);y(this,op);y(this,rp);y(this,ap);y(this,lp);y(this,cp);y(this,Ee,void 0);y(this,sn,[]);y(this,aa,void 0);y(this,la,void 0);y(this,xn,[]);y(this,X,new Float32Array(18));y(this,ho,void 0);y(this,fo,void 0);y(this,cu,void 0);y(this,uu,void 0);y(this,ca,void 0);y(this,ua,void 0);y(this,Ki,[]);_(this,Ee,n),_(this,ua,o*i),_(this,la,r),u(this,X).set([NaN,NaN,NaN,NaN,t,e],6),_(this,aa,a),_(this,uu,u(qn,du)*i),_(this,cu,u(qn,ip)*i),_(this,ca,i),u(this,Ki).push(t,e)}isEmpty(){return isNaN(u(this,X)[8])}add({x:t,y:e}){var M;_(this,ho,t),_(this,fo,e);let[n,i,o,r]=u(this,Ee),[a,l,c,d]=u(this,X).subarray(8,12),p=t-c,g=e-d,m=Math.hypot(p,g);if(m<u(this,cu))return!1;let v=m-u(this,uu),A=v/m,T=A*p,E=A*g,C=a,S=l;a=c,l=d,c+=T,d+=E,(M=u(this,Ki))==null||M.push(t,e);let b=-E/v,x=T/v,R=b*u(this,ua),I=x*u(this,ua);return u(this,X).set(u(this,X).subarray(2,8),0),u(this,X).set([c+R,d+I],4),u(this,X).set(u(this,X).subarray(14,18),12),u(this,X).set([c-R,d-I],16),isNaN(u(this,X)[6])?(u(this,xn).length===0&&(u(this,X).set([a+R,l+I],2),u(this,xn).push(NaN,NaN,NaN,NaN,(a+R-n)/o,(l+I-i)/r),u(this,X).set([a-R,l-I],14),u(this,sn).push(NaN,NaN,NaN,NaN,(a-R-n)/o,(l-I-i)/r)),u(this,X).set([C,S,a,l,c,d],6),!this.isEmpty()):(u(this,X).set([C,S,a,l,c,d],6),Math.abs(Math.atan2(S-l,C-a)-Math.atan2(E,T))<Math.PI/2?([a,l,c,d]=u(this,X).subarray(2,6),u(this,xn).push(NaN,NaN,NaN,NaN,((a+c)/2-n)/o,((l+d)/2-i)/r),[a,l,C,S]=u(this,X).subarray(14,18),u(this,sn).push(NaN,NaN,NaN,NaN,((C+a)/2-n)/o,((S+l)/2-i)/r),!0):([C,S,a,l,c,d]=u(this,X).subarray(0,6),u(this,xn).push(((C+5*a)/6-n)/o,((S+5*l)/6-i)/r,((5*a+c)/6-n)/o,((5*l+d)/6-i)/r,((a+c)/2-n)/o,((l+d)/2-i)/r),[c,d,a,l,C,S]=u(this,X).subarray(12,18),u(this,sn).push(((C+5*a)/6-n)/o,((S+5*l)/6-i)/r,((5*a+c)/6-n)/o,((5*l+d)/6-i)/r,((a+c)/2-n)/o,((l+d)/2-i)/r),!0))}toSVGPath(){if(this.isEmpty())return"";let t=u(this,xn),e=u(this,sn);if(isNaN(u(this,X)[6])&&!this.isEmpty())return w(this,sp,qT).call(this);let n=[];n.push(`M${t[4]} ${t[5]}`);for(let i=6;i<t.length;i+=6)isNaN(t[i])?n.push(`L${t[i+4]} ${t[i+5]}`):n.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);w(this,rp,WT).call(this,n);for(let i=e.length-6;i>=6;i-=6)isNaN(e[i])?n.push(`L${e[i+4]} ${e[i+5]}`):n.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);return w(this,op,zT).call(this,n),n.join(" ")}newFreeDrawOutline(t,e,n,i,o,r){return new qh(t,e,n,i,o,r)}getOutlines(){var p,g;let t=u(this,xn),e=u(this,sn),n=u(this,X),[i,o,r,a]=u(this,Ee),l=new Float32Array(((g=(p=u(this,Ki))==null?void 0:p.length)!=null?g:0)+2);for(let m=0,v=l.length-2;m<v;m+=2)l[m]=(u(this,Ki)[m]-i)/r,l[m+1]=(u(this,Ki)[m+1]-o)/a;if(l[l.length-2]=(u(this,ho)-i)/r,l[l.length-1]=(u(this,fo)-o)/a,isNaN(n[6])&&!this.isEmpty())return w(this,ap,KT).call(this,l);let c=new Float32Array(u(this,xn).length+24+u(this,sn).length),d=t.length;for(let m=0;m<d;m+=2){if(isNaN(t[m])){c[m]=c[m+1]=NaN;continue}c[m]=t[m],c[m+1]=t[m+1]}d=w(this,cp,JT).call(this,c,d);for(let m=e.length-6;m>=6;m-=6)for(let v=0;v<6;v+=2){if(isNaN(e[m+v])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=e[m+v],c[d+1]=e[m+v+1],d+=2}return w(this,lp,YT).call(this,c,d),this.newFreeDrawOutline(c,l,u(this,Ee),u(this,ca),u(this,aa),u(this,la))}};Ee=new WeakMap,sn=new WeakMap,aa=new WeakMap,la=new WeakMap,xn=new WeakMap,X=new WeakMap,ho=new WeakMap,fo=new WeakMap,cu=new WeakMap,uu=new WeakMap,ca=new WeakMap,ua=new WeakMap,Ki=new WeakMap,du=new WeakMap,np=new WeakMap,ip=new WeakMap,po=new WeakSet,ll=function(){let t=u(this,X).subarray(4,6),e=u(this,X).subarray(16,18),[n,i,o,r]=u(this,Ee);return[(u(this,ho)+(t[0]-e[0])/2-n)/o,(u(this,fo)+(t[1]-e[1])/2-i)/r,(u(this,ho)+(e[0]-t[0])/2-n)/o,(u(this,fo)+(e[1]-t[1])/2-i)/r]},sp=new WeakSet,qT=function(){let[t,e,n,i]=u(this,Ee),[o,r,a,l]=w(this,po,ll).call(this);return`M${(u(this,X)[2]-t)/n} ${(u(this,X)[3]-e)/i} L${(u(this,X)[4]-t)/n} ${(u(this,X)[5]-e)/i} L${o} ${r} L${a} ${l} L${(u(this,X)[16]-t)/n} ${(u(this,X)[17]-e)/i} L${(u(this,X)[14]-t)/n} ${(u(this,X)[15]-e)/i} Z`},op=new WeakSet,zT=function(t){let e=u(this,sn);t.push(`L${e[4]} ${e[5]} Z`)},rp=new WeakSet,WT=function(t){let[e,n,i,o]=u(this,Ee),r=u(this,X).subarray(4,6),a=u(this,X).subarray(16,18),[l,c,d,p]=w(this,po,ll).call(this);t.push(`L${(r[0]-e)/i} ${(r[1]-n)/o} L${l} ${c} L${d} ${p} L${(a[0]-e)/i} ${(a[1]-n)/o}`)},ap=new WeakSet,KT=function(t){let e=u(this,X),[n,i,o,r]=u(this,Ee),[a,l,c,d]=w(this,po,ll).call(this),p=new Float32Array(36);return p.set([NaN,NaN,NaN,NaN,(e[2]-n)/o,(e[3]-i)/r,NaN,NaN,NaN,NaN,(e[4]-n)/o,(e[5]-i)/r,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(e[16]-n)/o,(e[17]-i)/r,NaN,NaN,NaN,NaN,(e[14]-n)/o,(e[15]-i)/r],0),this.newFreeDrawOutline(p,t,u(this,Ee),u(this,ca),u(this,aa),u(this,la))},lp=new WeakSet,YT=function(t,e){let n=u(this,sn);return t.set([NaN,NaN,NaN,NaN,n[4],n[5]],e),e+=6},cp=new WeakSet,JT=function(t,e){let n=u(this,X).subarray(4,6),i=u(this,X).subarray(16,18),[o,r,a,l]=u(this,Ee),[c,d,p,g]=w(this,po,ll).call(this);return t.set([NaN,NaN,NaN,NaN,(n[0]-o)/a,(n[1]-r)/l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,p,g,NaN,NaN,NaN,NaN,(i[0]-o)/a,(i[1]-r)/l],e),e+=24},y(qn,du,8),y(qn,np,2),y(qn,ip,u(qn,du)+u(qn,np));var Vh=qn,da,go,ui,hu,Ce,fu,yt,up,XT,qh=class extends L{constructor(e,n,i,o,r,a){super();y(this,up);y(this,da,void 0);y(this,go,new Float32Array(4));y(this,ui,void 0);y(this,hu,void 0);y(this,Ce,void 0);y(this,fu,void 0);y(this,yt,void 0);_(this,yt,e),_(this,Ce,n),_(this,da,i),_(this,fu,o),_(this,ui,r),_(this,hu,a),this.lastPoint=[NaN,NaN],w(this,up,XT).call(this,a);let[l,c,d,p]=u(this,go);for(let g=0,m=e.length;g<m;g+=2)e[g]=(e[g]-l)/d,e[g+1]=(e[g+1]-c)/p;for(let g=0,m=n.length;g<m;g+=2)n[g]=(n[g]-l)/d,n[g+1]=(n[g+1]-c)/p}toSVGPath(){let e=[`M${u(this,yt)[4]} ${u(this,yt)[5]}`];for(let n=6,i=u(this,yt).length;n<i;n+=6){if(isNaN(u(this,yt)[n])){e.push(`L${u(this,yt)[n+4]} ${u(this,yt)[n+5]}`);continue}e.push(`C${u(this,yt)[n]} ${u(this,yt)[n+1]} ${u(this,yt)[n+2]} ${u(this,yt)[n+3]} ${u(this,yt)[n+4]} ${u(this,yt)[n+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,n,i,o],r){let a=i-e,l=o-n,c,d;switch(r){case 0:c=L._rescale(u(this,yt),e,o,a,-l),d=L._rescale(u(this,Ce),e,o,a,-l);break;case 90:c=L._rescaleAndSwap(u(this,yt),e,n,a,l),d=L._rescaleAndSwap(u(this,Ce),e,n,a,l);break;case 180:c=L._rescale(u(this,yt),i,n,-a,l),d=L._rescale(u(this,Ce),i,n,-a,l);break;case 270:c=L._rescaleAndSwap(u(this,yt),i,o,-a,-l),d=L._rescaleAndSwap(u(this,Ce),i,o,-a,-l);break}return{outline:Array.from(c),points:[Array.from(d)]}}get box(){return u(this,go)}newOutliner(e,n,i,o,r,a=0){return new Vh(e,n,i,o,r,a)}getNewOutline(e,n){let[i,o,r,a]=u(this,go),[l,c,d,p]=u(this,da),g=r*d,m=a*p,v=i*d+l,A=o*p+c,T=this.newOutliner({x:u(this,Ce)[0]*g+v,y:u(this,Ce)[1]*m+A},u(this,da),u(this,fu),e,u(this,hu),n!=null?n:u(this,ui));for(let E=2;E<u(this,Ce).length;E+=2)T.add({x:u(this,Ce)[E]*g+v,y:u(this,Ce)[E+1]*m+A});return T.getOutlines()}};da=new WeakMap,go=new WeakMap,ui=new WeakMap,hu=new WeakMap,Ce=new WeakMap,fu=new WeakMap,yt=new WeakMap,up=new WeakSet,XT=function(e){let n=u(this,yt),i=n[4],o=n[5],r=i,a=o,l=i,c=o,d=i,p=o,g=e?Math.max:Math.min;for(let v=6,A=n.length;v<A;v+=6){if(isNaN(n[v]))r=Math.min(r,n[v+4]),a=Math.min(a,n[v+5]),l=Math.max(l,n[v+4]),c=Math.max(c,n[v+5]),p<n[v+5]?(d=n[v+4],p=n[v+5]):p===n[v+5]&&(d=g(d,n[v+4]));else{let T=$.bezierBoundingBox(i,o,...n.slice(v,v+6));r=Math.min(r,T[0]),a=Math.min(a,T[1]),l=Math.max(l,T[2]),c=Math.max(c,T[3]),p<T[3]?(d=T[2],p=T[3]):p===T[3]&&(d=g(d,T[2]))}i=n[v+4],o=n[v+5]}let m=u(this,go);m[0]=r-u(this,ui),m[1]=a-u(this,ui),m[2]=l-r+2*u(this,ui),m[3]=c-a+2*u(this,ui),this.lastPoint=[d,p]};var pu,gu,Yi,on,dp,ZT,ha,ch,hp,QT,fp,jT,mu,ov,Rl=class{constructor(t,e=0,n=0,i=!0){y(this,dp);y(this,ha);y(this,hp);y(this,fp);y(this,mu);y(this,pu,void 0);y(this,gu,void 0);y(this,Yi,[]);y(this,on,[]);let o=1/0,r=-1/0,a=1/0,l=-1/0,d=10**-4;for(let{x:E,y:C,width:S,height:b}of t){let x=Math.floor((E-e)/d)*d,R=Math.ceil((E+S+e)/d)*d,I=Math.floor((C-e)/d)*d,N=Math.ceil((C+b+e)/d)*d,M=[x,I,N,!0],F=[R,I,N,!1];u(this,Yi).push(M,F),o=Math.min(o,x),r=Math.max(r,R),a=Math.min(a,I),l=Math.max(l,N)}let p=r-o+2*n,g=l-a+2*n,m=o-n,v=a-n,A=u(this,Yi).at(i?-1:-2),T=[A[0],A[2]];for(let E of u(this,Yi)){let[C,S,b]=E;E[0]=(C-m)/p,E[1]=(S-v)/g,E[2]=(b-v)/g}_(this,pu,new Float32Array([m,v,p,g])),_(this,gu,T)}getOutlines(){u(this,Yi).sort((e,n)=>e[0]-n[0]||e[1]-n[1]||e[2]-n[2]);let t=[];for(let e of u(this,Yi))e[3]?(t.push(...w(this,mu,ov).call(this,e)),w(this,hp,QT).call(this,e)):(w(this,fp,jT).call(this,e),t.push(...w(this,mu,ov).call(this,e)));return w(this,dp,ZT).call(this,t)}};pu=new WeakMap,gu=new WeakMap,Yi=new WeakMap,on=new WeakMap,dp=new WeakSet,ZT=function(t){let e=[],n=new Set;for(let r of t){let[a,l,c]=r;e.push([a,l,r],[a,c,r])}e.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=e.length;r<a;r+=2){let l=e[r][2],c=e[r+1][2];l.push(c),c.push(l),n.add(l),n.add(c)}let i=[],o;for(;n.size>0;){let r=n.values().next().value,[a,l,c,d,p]=r;n.delete(r);let g=a,m=l;for(o=[a,c],i.push(o);;){let v;if(n.has(d))v=d;else if(n.has(p))v=p;else break;n.delete(v),[a,l,c,d,p]=v,g!==a&&(o.push(g,m,a,m===l?l:c),g=a),m=m===l?c:l}o.push(g,m)}return new rv(i,u(this,pu),u(this,gu))},ha=new WeakSet,ch=function(t){let e=u(this,on),n=0,i=e.length-1;for(;n<=i;){let o=n+i>>1,r=e[o][0];if(r===t)return o;r<t?n=o+1:i=o-1}return i+1},hp=new WeakSet,QT=function([,t,e]){let n=w(this,ha,ch).call(this,t);u(this,on).splice(n,0,[t,e])},fp=new WeakSet,jT=function([,t,e]){let n=w(this,ha,ch).call(this,t);for(let i=n;i<u(this,on).length;i++){let[o,r]=u(this,on)[i];if(o!==t)break;if(o===t&&r===e){u(this,on).splice(i,1);return}}for(let i=n-1;i>=0;i--){let[o,r]=u(this,on)[i];if(o!==t)break;if(o===t&&r===e){u(this,on).splice(i,1);return}}},mu=new WeakSet,ov=function(t){let[e,n,i]=t,o=[[e,n,i]],r=w(this,ha,ch).call(this,i);for(let a=0;a<r;a++){let[l,c]=u(this,on)[a];for(let d=0,p=o.length;d<p;d++){let[,g,m]=o[d];if(!(c<=g||m<=l)){if(g>=l){if(m>c)o[d][1]=c;else{if(p===1)return[];o.splice(d,1),d--,p--}continue}o[d][2]=l,m>c&&o.push([e,c,m])}}}return o};var yu,fa,rv=class extends L{constructor(e,n,i){super();y(this,yu,void 0);y(this,fa,void 0);_(this,fa,e),_(this,yu,n),this.lastPoint=i}toSVGPath(){let e=[];for(let n of u(this,fa)){let[i,o]=n;e.push(`M${i} ${o}`);for(let r=2;r<n.length;r+=2){let a=n[r],l=n[r+1];a===i?(e.push(`V${l}`),o=l):l===o&&(e.push(`H${a}`),i=a)}e.push("Z")}return e.join(" ")}serialize([e,n,i,o],r){let a=[],l=i-e,c=o-n;for(let d of u(this,fa)){let p=new Array(d.length);for(let g=0;g<d.length;g+=2)p[g]=e+d[g]*l,p[g+1]=o-d[g+1]*c;a.push(p)}return a}get box(){return u(this,yu)}get classNamesForOutlining(){return["highlightOutline"]}};yu=new WeakMap,fa=new WeakMap;var Pl=class extends Vh{newFreeDrawOutline(t,e,n,i,o,r){return new av(t,e,n,i,o,r)}},av=class extends qh{newOutliner(t,e,n,i,o,r=0){return new Pl(t,e,n,i,o,r)}},rn,mo,pa,St,vu,ga,_u,Au,Ji,an,ma,wu,Tu,lv,Eu,cv,Cu,uv,di,hs,pp,tE,In,Ti,de=class de{constructor({editor:t=null,uiManager:e=null}){y(this,Tu);y(this,Eu);y(this,Cu);y(this,di);y(this,pp);y(this,In);y(this,rn,null);y(this,mo,null);y(this,pa,void 0);y(this,St,null);y(this,vu,!1);y(this,ga,!1);y(this,_u,null);y(this,Au,void 0);y(this,Ji,null);y(this,an,null);y(this,ma,void 0);var n;t?(_(this,ga,!1),_(this,ma,Q.HIGHLIGHT_COLOR),_(this,_u,t)):(_(this,ga,!0),_(this,ma,Q.HIGHLIGHT_DEFAULT_COLOR)),_(this,an,(t==null?void 0:t._uiManager)||e),_(this,Au,u(this,an)._eventBus),_(this,pa,(t==null?void 0:t.color)||((n=u(this,an))==null?void 0:n.highlightColors.values().next().value)||"#FFFF98"),u(de,wu)||_(de,wu,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Z(this,"_keyboardManager",new Uo([[["Escape","mac+Escape"],de.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],de.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],de.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],de.prototype._moveToPrevious],[["Home","mac+Home"],de.prototype._moveToBeginning],[["End","mac+End"],de.prototype._moveToEnd]]))}renderButton(){let t=_(this,rn,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);let e=u(this,an)._signal;t.addEventListener("click",w(this,di,hs).bind(this),{signal:e}),t.addEventListener("keydown",w(this,Cu,uv).bind(this),{signal:e});let n=_(this,mo,document.createElement("span"));return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=u(this,pa),t.append(n),t}renderMainDropdown(){let t=_(this,St,w(this,Tu,lv).call(this));return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}_colorSelectFromKeyboard(t){if(t.target===u(this,rn)){w(this,di,hs).call(this,t);return}let e=t.target.getAttribute("data-color");e&&w(this,Eu,cv).call(this,e,t)}_moveToNext(t){var e,n;if(!u(this,In,Ti)){w(this,di,hs).call(this,t);return}if(t.target===u(this,rn)){(e=u(this,St).firstChild)==null||e.focus();return}(n=t.target.nextSibling)==null||n.focus()}_moveToPrevious(t){var e,n;if(t.target===((e=u(this,St))==null?void 0:e.firstChild)||t.target===u(this,rn)){u(this,In,Ti)&&this._hideDropdownFromKeyboard();return}u(this,In,Ti)||w(this,di,hs).call(this,t),(n=t.target.previousSibling)==null||n.focus()}_moveToBeginning(t){var e;if(!u(this,In,Ti)){w(this,di,hs).call(this,t);return}(e=u(this,St).firstChild)==null||e.focus()}_moveToEnd(t){var e;if(!u(this,In,Ti)){w(this,di,hs).call(this,t);return}(e=u(this,St).lastChild)==null||e.focus()}hideDropdown(){var t,e;(t=u(this,St))==null||t.classList.add("hidden"),(e=u(this,Ji))==null||e.abort(),_(this,Ji,null)}_hideDropdownFromKeyboard(){var t;if(!u(this,ga)){if(!u(this,In,Ti)){(t=u(this,_u))==null||t.unselect();return}this.hideDropdown(),u(this,rn).focus({preventScroll:!0,focusVisible:u(this,vu)})}}updateColor(t){if(u(this,mo)&&(u(this,mo).style.backgroundColor=t),!u(this,St))return;let e=u(this,an).highlightColors.values();for(let n of u(this,St).children)n.setAttribute("aria-selected",e.next().value===t)}destroy(){var t,e;(t=u(this,rn))==null||t.remove(),_(this,rn,null),_(this,mo,null),(e=u(this,St))==null||e.remove(),_(this,St,null)}};rn=new WeakMap,mo=new WeakMap,pa=new WeakMap,St=new WeakMap,vu=new WeakMap,ga=new WeakMap,_u=new WeakMap,Au=new WeakMap,Ji=new WeakMap,an=new WeakMap,ma=new WeakMap,wu=new WeakMap,Tu=new WeakSet,lv=function(){let t=document.createElement("div"),e=u(this,an)._signal;t.addEventListener("contextmenu",hn,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[n,i]of u(this,an).highlightColors){let o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",i),o.title=n,o.setAttribute("data-l10n-id",u(de,wu)[n]);let r=document.createElement("span");o.append(r),r.className="swatch",r.style.backgroundColor=i,o.setAttribute("aria-selected",i===u(this,pa)),o.addEventListener("click",w(this,Eu,cv).bind(this,i),{signal:e}),t.append(o)}return t.addEventListener("keydown",w(this,Cu,uv).bind(this),{signal:e}),t},Eu=new WeakSet,cv=function(t,e){e.stopPropagation(),u(this,Au).dispatch("switchannotationeditorparams",{source:this,type:u(this,ma),value:t})},Cu=new WeakSet,uv=function(t){de._keyboardManager.exec(this,t)},di=new WeakSet,hs=function(t){if(u(this,In,Ti)){this.hideDropdown();return}if(_(this,vu,t.detail===0),u(this,Ji)||(_(this,Ji,new AbortController),window.addEventListener("pointerdown",w(this,pp,tE).bind(this),{signal:u(this,an).combinedSignal(u(this,Ji))})),u(this,St)){u(this,St).classList.remove("hidden");return}let e=_(this,St,w(this,Tu,lv).call(this));u(this,rn).append(e)},pp=new WeakSet,tE=function(t){var e;(e=u(this,St))!=null&&e.contains(t.target)||this.hideDropdown()},In=new WeakSet,Ti=function(){return u(this,St)&&!u(this,St).classList.contains("hidden")},y(de,wu,null);var zh=de,ya,Su,hi,yo,va,pe,bu,xu,vo,Ue,Se,Ot,_a,fi,Jt,Aa,Oe,Iu,Ru,dv,wa,uh,gp,eE,mp,nE,yp,iE,Pu,hv,pi,fs,Xi,ir,vp,sE,Ta,dh,_o,cl,_p,oE,Ap,rE,wp,aE,Tp,lE,Ep,cE,tt=class tt extends ft{constructor(e){super({...e,name:"highlightEditor"});y(this,Ru);y(this,wa);y(this,gp);y(this,mp);y(this,yp);y(this,Pu);y(this,pi);y(this,vp);y(this,Ta);y(this,_o);y(this,_p);y(this,Ap);y(this,Ep);y(this,ya,null);y(this,Su,0);y(this,hi,void 0);y(this,yo,null);y(this,va,null);y(this,pe,null);y(this,bu,null);y(this,xu,0);y(this,vo,null);y(this,Ue,null);y(this,Se,null);y(this,Ot,!1);y(this,_a,null);y(this,fi,void 0);y(this,Jt,null);y(this,Aa,"");y(this,Oe,void 0);y(this,Iu,"");this.color=e.color||tt._defaultColor,_(this,Oe,e.thickness||tt._defaultThickness),_(this,fi,e.opacity||tt._defaultOpacity),_(this,hi,e.boxes||null),_(this,Iu,e.methodOfCreation||""),_(this,Aa,e.text||""),this._isDraggable=!1,e.highlightId>-1?(_(this,Ot,!0),w(this,wa,uh).call(this,e),w(this,pi,fs).call(this)):u(this,hi)&&(_(this,ya,e.anchorNode),_(this,Su,e.anchorOffset),_(this,bu,e.focusNode),_(this,xu,e.focusOffset),w(this,Ru,dv).call(this),w(this,pi,fs).call(this),this.rotate(this.rotation))}static get _keyboardManager(){let e=tt.prototype;return Z(this,"_keyboardManager",new Uo([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:u(this,Ot)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:u(this,Oe),methodOfCreation:u(this,Iu)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}static initialize(e,n){var i;ft.initialize(e,n),tt._defaultColor||(tt._defaultColor=((i=n.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(e,n){switch(e){case Q.HIGHLIGHT_DEFAULT_COLOR:tt._defaultColor=n;break;case Q.HIGHLIGHT_THICKNESS:tt._defaultThickness=n;break}}translateInPage(e,n){}get toolbarPosition(){return u(this,_a)}updateParams(e,n){switch(e){case Q.HIGHLIGHT_COLOR:w(this,gp,eE).call(this,n);break;case Q.HIGHLIGHT_THICKNESS:w(this,mp,nE).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Q.HIGHLIGHT_DEFAULT_COLOR,tt._defaultColor],[Q.HIGHLIGHT_THICKNESS,tt._defaultThickness]]}get propertiesToUpdate(){return[[Q.HIGHLIGHT_COLOR,this.color||tt._defaultColor],[Q.HIGHLIGHT_THICKNESS,u(this,Oe)||tt._defaultThickness],[Q.HIGHLIGHT_FREE,u(this,Ot)]]}async addEditToolbar(){let e=await super.addEditToolbar();return e?(this._uiManager.highlightColors&&(_(this,va,new zh({editor:this})),e.addColorPicker(u(this,va))),e):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(w(this,_o,cl).call(this))}getBaseTranslation(){return[0,0]}getRect(e,n){return super.getRect(e,n,w(this,_o,cl).call(this))}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){w(this,Pu,hv).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(w(this,pi,fs).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var i;let n=!1;this.parent&&!e?w(this,Pu,hv).call(this):e&&(w(this,pi,fs).call(this,e),n=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(e),this.show(this._isVisible),n&&this.select()}rotate(e){var o,r,a;let{drawLayer:n}=this.parent,i;u(this,Ot)?(e=(e-this.rotation+360)%360,i=w(o=tt,Xi,ir).call(o,u(this,Ue).box,e)):i=w(r=tt,Xi,ir).call(r,[this.x,this.y,this.width,this.height],e),n.updateProperties(u(this,Se),{bbox:i,root:{"data-main-rotation":e}}),n.updateProperties(u(this,Jt),{bbox:w(a=tt,Xi,ir).call(a,u(this,pe).box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;let e=super.render();u(this,Aa)&&(e.setAttribute("aria-label",u(this,Aa)),e.setAttribute("role","mark")),u(this,Ot)?e.classList.add("free"):this.div.addEventListener("keydown",w(this,vp,sE).bind(this),{signal:this._uiManager._signal});let n=_(this,vo,document.createElement("div"));e.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=u(this,yo);let[i,o]=this.parentDimensions;return this.setDims(this.width*i,this.height*o),Ah(this,u(this,vo),["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(u(this,Jt),{rootClass:{hovered:!0}})}pointerleave(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(u(this,Jt),{rootClass:{hovered:!1}})}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:w(this,Ta,dh).call(this,!0);break;case 1:case 3:w(this,Ta,dh).call(this,!1);break}}select(){var e;super.select(),u(this,Jt)&&((e=this.parent)==null||e.drawLayer.updateProperties(u(this,Jt),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var e;super.unselect(),u(this,Jt)&&((e=this.parent)==null||e.drawLayer.updateProperties(u(this,Jt),{rootClass:{selected:!1}}),u(this,Ot)||w(this,Ta,dh).call(this,!1))}get _mustFixPosition(){return!u(this,Ot)}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(u(this,Se),{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(u(this,Jt),{rootClass:{hidden:!e}}))}static startHighlighting(e,n,{target:i,x:o,y:r}){let{x:a,y:l,width:c,height:d}=i.getBoundingClientRect(),p=new AbortController,g=e.combinedSignal(p),m=v=>{p.abort(),w(this,Tp,lE).call(this,e,v)};window.addEventListener("blur",m,{signal:g}),window.addEventListener("pointerup",m,{signal:g}),window.addEventListener("pointerdown",Pe,{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",hn,{signal:g}),i.addEventListener("pointermove",w(this,wp,aE).bind(this,e),{signal:g}),this._freeHighlight=new Pl({x:o,y:r},[a,l,c,d],e.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(e,n,i){var A,T,E,C;let o=null;if(e instanceof Bh){let{data:{quadPoints:S,rect:b,rotation:x,id:R,color:I,opacity:N,popupRef:M},parent:{page:{pageNumber:F}}}=e;o=e={annotationType:K.HIGHLIGHT,color:Array.from(I),opacity:N,quadPoints:S,boxes:null,pageIndex:F-1,rect:b.slice(0),rotation:x,id:R,deleted:!1,popupRef:M}}else if(e instanceof Il){let{data:{inkLists:S,rect:b,rotation:x,id:R,color:I,borderStyle:{rawWidth:N},popupRef:M},parent:{page:{pageNumber:F}}}=e;o=e={annotationType:K.HIGHLIGHT,color:Array.from(I),thickness:N,inkLists:S,boxes:null,pageIndex:F-1,rect:b.slice(0),rotation:x,id:R,deleted:!1,popupRef:M}}let{color:r,quadPoints:a,inkLists:l,opacity:c}=e,d=await super.deserialize(e,n,i);d.color=$.makeHexColor(...r),_(d,fi,c||1),l&&_(d,Oe,e.thickness),d.annotationElementId=e.id||null,d._initialData=o;let[p,g]=d.pageDimensions,[m,v]=d.pageTranslation;if(a){let S=_(d,hi,[]);for(let b=0;b<a.length;b+=8)S.push({x:(a[b]-m)/p,y:1-(a[b+1]-v)/g,width:(a[b+2]-a[b])/p,height:(a[b+1]-a[b+5])/g});w(A=d,Ru,dv).call(A),w(T=d,pi,fs).call(T),d.rotate(d.rotation)}else if(l){_(d,Ot,!0);let S=l[0],b={x:S[0]-m,y:g-(S[1]-v)},x=new Pl(b,[0,0,p,g],1,u(d,Oe)/2,!0,.001);for(let N=0,M=S.length;N<M;N+=2)b.x=S[N]-m,b.y=g-(S[N+1]-v),x.add(b);let{id:R,clipPathId:I}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:x.toSVGPath()}},!0,!0);w(E=d,wa,uh).call(E,{highlightOutlines:x.getOutlines(),highlightId:R,clipPathId:I}),w(C=d,pi,fs).call(C)}return d}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();let n=this.getRect(0,0),i=ft._colorManager.convert(this.color),o={annotationType:K.HIGHLIGHT,color:i,opacity:u(this,fi),thickness:u(this,Oe),quadPoints:w(this,_p,oE).call(this),outlines:w(this,Ap,rE).call(this,n),pageIndex:this.pageIndex,rect:n,rotation:w(this,_o,cl).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!w(this,Ep,cE).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};ya=new WeakMap,Su=new WeakMap,hi=new WeakMap,yo=new WeakMap,va=new WeakMap,pe=new WeakMap,bu=new WeakMap,xu=new WeakMap,vo=new WeakMap,Ue=new WeakMap,Se=new WeakMap,Ot=new WeakMap,_a=new WeakMap,fi=new WeakMap,Jt=new WeakMap,Aa=new WeakMap,Oe=new WeakMap,Iu=new WeakMap,Ru=new WeakSet,dv=function(){let e=new Rl(u(this,hi),.001);_(this,Ue,e.getOutlines()),[this.x,this.y,this.width,this.height]=u(this,Ue).box;let n=new Rl(u(this,hi),.0025,.001,this._uiManager.direction==="ltr");_(this,pe,n.getOutlines());let{lastPoint:i}=u(this,pe);_(this,_a,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},wa=new WeakSet,uh=function({highlightOutlines:e,highlightId:n,clipPathId:i}){var p,g;if(_(this,Ue,e),_(this,pe,e.getNewOutline(u(this,Oe)/2+1.5,.0025)),n>=0)_(this,Se,n),_(this,yo,i),this.parent.drawLayer.finalizeDraw(n,{bbox:e.box,path:{d:e.toSVGPath()}}),_(this,Jt,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:u(this,pe).box,path:{d:u(this,pe).toSVGPath()}},!0));else if(this.parent){let m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(u(this,Se),{bbox:w(p=tt,Xi,ir).call(p,u(this,Ue).box,(m-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(u(this,Jt),{bbox:w(g=tt,Xi,ir).call(g,u(this,pe).box,m),path:{d:u(this,pe).toSVGPath()}})}let[r,a,l,c]=e.box;switch(this.rotation){case 0:this.x=r,this.y=a,this.width=l,this.height=c;break;case 90:{let[m,v]=this.parentDimensions;this.x=a,this.y=1-r,this.width=l*v/m,this.height=c*m/v;break}case 180:this.x=1-r,this.y=1-a,this.width=l,this.height=c;break;case 270:{let[m,v]=this.parentDimensions;this.x=1-a,this.y=r,this.width=l*v/m,this.height=c*m/v;break}}let{lastPoint:d}=u(this,pe);_(this,_a,[(d[0]-r)/l,(d[1]-a)/c])},gp=new WeakSet,eE=function(e){let n=(r,a)=>{var l,c;this.color=r,_(this,fi,a),(l=this.parent)==null||l.drawLayer.updateProperties(u(this,Se),{root:{fill:r,"fill-opacity":a}}),(c=u(this,va))==null||c.updateColor(r)},i=this.color,o=u(this,fi);this.addCommands({cmd:n.bind(this,e,tt._defaultOpacity),undo:n.bind(this,i,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)},mp=new WeakSet,nE=function(e){let n=u(this,Oe),i=o=>{_(this,Oe,o),w(this,yp,iE).call(this,o)};this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)},yp=new WeakSet,iE=function(e){if(!u(this,Ot))return;w(this,wa,uh).call(this,{highlightOutlines:u(this,Ue).getNewOutline(e/2)}),this.fixAndSetPosition();let[n,i]=this.parentDimensions;this.setDims(this.width*n,this.height*i)},Pu=new WeakSet,hv=function(){u(this,Se)===null||!this.parent||(this.parent.drawLayer.remove(u(this,Se)),_(this,Se,null),this.parent.drawLayer.remove(u(this,Jt)),_(this,Jt,null))},pi=new WeakSet,fs=function(e=this.parent){u(this,Se)===null&&({id:jt(this,Se)._,clipPathId:jt(this,yo)._}=e.drawLayer.draw({bbox:u(this,Ue).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":u(this,fi)},rootClass:{highlight:!0,free:u(this,Ot)},path:{d:u(this,Ue).toSVGPath()}},!1,!0),_(this,Jt,e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:u(this,Ot)},bbox:u(this,pe).box,path:{d:u(this,pe).toSVGPath()}},u(this,Ot))),u(this,vo)&&(u(this,vo).style.clipPath=u(this,yo)))},Xi=new WeakSet,ir=function([e,n,i,o],r){switch(r){case 90:return[1-n-o,e,o,i];case 180:return[1-e-i,1-n-o,i,o];case 270:return[n,1-e-i,o,i]}return[e,n,i,o]},vp=new WeakSet,sE=function(e){tt._keyboardManager.exec(this,e)},Ta=new WeakSet,dh=function(e){if(!u(this,ya))return;let n=window.getSelection();e?n.setPosition(u(this,ya),u(this,Su)):n.setPosition(u(this,bu),u(this,xu))},_o=new WeakSet,cl=function(){return u(this,Ot)?this.rotation:0},_p=new WeakSet,oE=function(){if(u(this,Ot))return null;let[e,n]=this.pageDimensions,[i,o]=this.pageTranslation,r=u(this,hi),a=new Float32Array(r.length*8),l=0;for(let{x:c,y:d,width:p,height:g}of r){let m=c*e+i,v=(1-d)*n+o;a[l]=a[l+4]=m,a[l+1]=a[l+3]=v,a[l+2]=a[l+6]=m+p*e,a[l+5]=a[l+7]=v-g*n,l+=8}return a},Ap=new WeakSet,rE=function(e){return u(this,Ue).serialize(e,w(this,_o,cl).call(this))},wp=new WeakSet,aE=function(e,n){this._freeHighlight.add(n)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},Tp=new WeakSet,lE=function(e,n){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Ep=new WeakSet,cE=function(e){let{color:n}=this._initialData;return e.color.some((i,o)=>i!==n[o])},y(tt,Xi),y(tt,wp),y(tt,Tp),H(tt,"_defaultColor",null),H(tt,"_defaultOpacity",1),H(tt,"_defaultThickness",12),H(tt,"_type","highlight"),H(tt,"_editorType",K.HIGHLIGHT),H(tt,"_freeHighlightId",-1),H(tt,"_freeHighlight",null),H(tt,"_freeHighlightClipId","");var Wh=tt,Ao,fv=class{constructor(){y(this,Ao,Object.create(null))}updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(let[e,n]of Object.entries(t))this.updateProperty(e,n)}updateSVGProperty(t,e){u(this,Ao)[t]=e}toSVGProperties(){let t=u(this,Ao);return _(this,Ao,Object.create(null)),{root:t}}reset(){_(this,Ao,Object.create(null))}updateAll(t=this){this.updateProperties(t)}clone(){ot("Not implemented")}};Ao=new WeakMap;var be,Ea,Mt,wo,To,Zi,Qi,ji,Eo,Mu,gv,Nu,mv,ku,yv,Co,ul,Cp,uE,Ca,hh,So,dl,ts,sr,O=class O extends ft{constructor(e){super(e);y(this,Mu);y(this,Nu);y(this,ku);y(this,Co);y(this,Cp);y(this,Ca);y(this,So);y(this,ts);y(this,be,null);y(this,Ea,void 0);H(this,"_drawId",null);_(this,Ea,e.mustBeCommitted||!1),e.drawOutlines&&(w(this,Mu,gv).call(this,e),w(this,Co,ul).call(this))}static _mergeSVGProperties(e,n){let i=new Set(Object.keys(e));for(let[o,r]of Object.entries(n))i.has(o)?Object.assign(e[o],r):e[o]=r;return e}static getDefaultDrawingOptions(e){ot("Not implemented")}static get typesMap(){ot("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,n){let i=this.typesMap.get(e);i&&this._defaultDrawingOptions.updateProperty(i,n),this._currentParent&&(u(O,Mt).updateProperty(i,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,n){let i=this.constructor.typesMap.get(e);i&&this._updateProperty(e,i,n)}static get defaultPropertiesToUpdate(){let e=[],n=this._defaultDrawingOptions;for(let[i,o]of this.typesMap)e.push([i,n[o]]);return e}get propertiesToUpdate(){let e=[],{_drawingOptions:n}=this;for(let[i,o]of this.constructor.typesMap)e.push([i,n[o]]);return e}_updateProperty(e,n,i){let o=this._drawingOptions,r=o[n],a=l=>{var d;o.updateProperty(n,l);let c=u(this,be).updateProperty(n,l);c&&w(this,So,dl).call(this,c),(d=this.parent)==null||d.drawLayer.updateProperties(this._drawId,o.toSVGProperties())};this.addCommands({cmd:a.bind(this,i),undo:a.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,O._mergeSVGProperties(u(this,be).getPathResizingSVGProperties(w(this,Ca,hh).call(this)),{bbox:w(this,ts,sr).call(this)}))}_onResized(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,O._mergeSVGProperties(u(this,be).getPathResizedSVGProperties(w(this,Ca,hh).call(this)),{bbox:w(this,ts,sr).call(this)}))}_onTranslating(e,n){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:w(this,ts,sr).call(this,e,n)})}_onTranslated(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,O._mergeSVGProperties(u(this,be).getPathTranslatedSVGProperties(w(this,Ca,hh).call(this),this.parentDimensions),{bbox:w(this,ts,sr).call(this)}))}_onStartDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,u(this,Ea)&&(_(this,Ea,!1),this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){w(this,ku,yv).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(w(this,Co,ul).call(this),w(this,So,dl).call(this,u(this,be).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var i;let n=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),w(this,ku,yv).call(this)):e&&(this._uiManager.addShouldRescale(this),w(this,Co,ul).call(this,e),n=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(e),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,O._mergeSVGProperties({bbox:w(this,ts,sr).call(this)},u(this,be).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&w(this,So,dl).call(this,u(this,be).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e=super.render();e.classList.add("draw");let n=document.createElement("div");e.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";let[i,o]=this.parentDimensions;return this.setDims(this.width*i,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),e}static createDrawerInstance(e,n,i,o,r){ot("Not implemented")}static startDrawing(e,n,i,o){var T,E;let{target:r,offsetX:a,offsetY:l,pointerId:c,pointerType:d}=o;if(u(O,Qi)&&u(O,Qi)!==d)return;let{viewport:{rotation:p}}=e,{width:g,height:m}=r.getBoundingClientRect(),v=_(O,wo,new AbortController),A=e.combinedSignal(v);if(u(O,Zi)||_(O,Zi,c),(T=u(O,Qi))!=null||_(O,Qi,d),window.addEventListener("pointerup",C=>{var S;u(O,Zi)===C.pointerId?this._endDraw(C):(S=u(O,ji))==null||S.delete(C.pointerId)},{signal:A}),window.addEventListener("pointercancel",C=>{var S;u(O,Zi)===C.pointerId?this._currentParent.endDrawingSession():(S=u(O,ji))==null||S.delete(C.pointerId)},{signal:A}),window.addEventListener("pointerdown",C=>{u(O,Qi)===C.pointerType&&((u(O,ji)||_(O,ji,new Set)).add(C.pointerId),u(O,Mt).isCancellable()&&(u(O,Mt).removeLastElement(),u(O,Mt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:A}),window.addEventListener("contextmenu",hn,{signal:A}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:A}),r.addEventListener("touchmove",C=>{C.timeStamp===u(O,Eo)&&Pe(C)},{signal:A}),e.toggleDrawing(),(E=n._editorUndoBar)==null||E.hide(),u(O,Mt)){e.drawLayer.updateProperties(this._currentDrawId,u(O,Mt).startNew(a,l,g,m,p));return}n.updateUIForDefaultProperties(this),_(O,Mt,this.createDrawerInstance(a,l,g,m,p)),_(O,To,this.getDefaultDrawingOptions()),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(u(O,To).toSVGProperties(),u(O,Mt).defaultSVGProperties),!0,!1)}static _drawMove(e){var r;if(_(O,Eo,-1),!u(O,Mt))return;let{offsetX:n,offsetY:i,pointerId:o}=e;if(u(O,Zi)===o){if(((r=u(O,ji))==null?void 0:r.size)>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,u(O,Mt).add(n,i)),_(O,Eo,e.timeStamp),Pe(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,_(O,Mt,null),_(O,To,null),_(O,Qi,null),_(O,Eo,NaN)),u(O,wo)&&(u(O,wo).abort(),_(O,wo,null),_(O,Zi,NaN),_(O,ji,null))}static _endDraw(e){let n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),e&&n.drawLayer.updateProperties(this._currentDrawId,u(O,Mt).end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){let i=u(O,Mt),o=this._currentDrawId,r=i.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(o,i.setLastElement(r))},undo:()=>{n.drawLayer.updateProperties(o,i.removeLastElement())},mustExec:!1,type:Q.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){let n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(Q.DRAW_STEP),!u(O,Mt).isEmpty()){let{pageDimensions:[i,o],scale:r}=n,a=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:u(O,Mt).getOutlines(i*r,o*r,r,this._INNER_MARGIN),drawingOptions:u(O,To),mustBeCommitted:!e});return this._cleanup(!0),a}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,n,i,o,r,a){ot("Not implemented")}static async deserialize(e,n,i){var p,g;let{rawDims:{pageWidth:o,pageHeight:r,pageX:a,pageY:l}}=n.viewport,c=this.deserializeDraw(a,l,o,r,this._INNER_MARGIN,e),d=await super.deserialize(e,n,i);return d.createDrawingOptions(e),w(p=d,Mu,gv).call(p,{drawOutlines:c}),w(g=d,Co,ul).call(g),d.onScaleChanging(),d.rotate(),d}serializeDraw(e){let[n,i]=this.pageTranslation,[o,r]=this.pageDimensions;return u(this,be).serialize([n,i,o,r],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};be=new WeakMap,Ea=new WeakMap,Mt=new WeakMap,wo=new WeakMap,To=new WeakMap,Zi=new WeakMap,Qi=new WeakMap,ji=new WeakMap,Eo=new WeakMap,Mu=new WeakSet,gv=function({drawOutlines:e,drawId:n,drawingOptions:i}){_(this,be,e),this._drawingOptions||(this._drawingOptions=i),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,e.defaultProperties)):this._drawId=w(this,Nu,mv).call(this,e,this.parent),w(this,So,dl).call(this,e.box)},Nu=new WeakSet,mv=function(e,n){let{id:i}=n.drawLayer.draw(O._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return i},ku=new WeakSet,yv=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Co=new WeakSet,ul=function(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=w(this,Nu,mv).call(this,u(this,be),e)}},Cp=new WeakSet,uE=function([e,n,i,o]){let{parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[n,1-e,i*(a/r),o*(r/a)];case 180:return[1-e,1-n,i,o];case 270:return[1-n,e,i*(a/r),o*(r/a)];default:return[e,n,i,o]}},Ca=new WeakSet,hh=function(){let{x:e,y:n,width:i,height:o,parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[1-n,e,i*(r/a),o*(a/r)];case 180:return[1-e,1-n,i,o];case 270:return[n,1-e,i*(r/a),o*(a/r)];default:return[e,n,i,o]}},So=new WeakSet,dl=function(e){if([this.x,this.y,this.width,this.height]=w(this,Cp,uE).call(this,e),this.div){this.fixAndSetPosition();let[n,i]=this.parentDimensions;this.setDims(this.width*n,this.height*i)}this._onResized()},ts=new WeakSet,sr=function(){let{x:e,y:n,width:i,height:o,rotation:r,parentRotation:a,parentDimensions:[l,c]}=this;switch((r*4+a)/90){case 1:return[1-n-o,e,o,i];case 2:return[1-e-i,1-n-o,i,o];case 3:return[n,1-e-i,o,i];case 4:return[e,n-i*(l/c),o*(c/l),i*(l/c)];case 5:return[1-n,e,i*(l/c),o*(c/l)];case 6:return[1-e-o*(c/l),1-n,o*(c/l),i*(l/c)];case 7:return[n-i*(l/c),1-e-o*(c/l),i*(l/c),o*(c/l)];case 8:return[e-i,n-o,i,o];case 9:return[1-n,e-i,o,i];case 10:return[1-e,1-n,i,o];case 11:return[n-o,1-e,o,i];case 12:return[e-o*(c/l),n,o*(c/l),i*(l/c)];case 13:return[1-n-i*(l/c),e-o*(c/l),i*(l/c),o*(c/l)];case 14:return[1-e,1-n-i*(l/c),o*(c/l),i*(l/c)];case 15:return[n,1-e,i*(l/c),o*(c/l)];default:return[e,n,i,o]}},H(O,"_currentDrawId",-1),H(O,"_currentParent",null),y(O,Mt,null),y(O,wo,null),y(O,To,null),y(O,Zi,NaN),y(O,Qi,null),y(O,ji,null),y(O,Eo,NaN),H(O,"_INNER_MARGIN",3);var pv=O,Rn,Nt,kt,bo,Sa,ie,$t,$e,xo,Io,Ro,ba,fh,vv=class{constructor(t,e,n,i,o,r){y(this,ba);y(this,Rn,new Float64Array(6));y(this,Nt,void 0);y(this,kt,void 0);y(this,bo,void 0);y(this,Sa,void 0);y(this,ie,void 0);y(this,$t,"");y(this,$e,0);y(this,xo,new Kh);y(this,Io,void 0);y(this,Ro,void 0);_(this,Io,n),_(this,Ro,i),_(this,bo,o),_(this,Sa,r),[t,e]=w(this,ba,fh).call(this,t,e);let a=_(this,Nt,[NaN,NaN,NaN,NaN,t,e]);_(this,ie,[t,e]),_(this,kt,[{line:a,points:u(this,ie)}]),u(this,Rn).set(a,0)}updateProperty(t,e){t==="stroke-width"&&_(this,Sa,e)}isEmpty(){return!u(this,kt)||u(this,kt).length===0}isCancellable(){return u(this,ie).length<=10}add(t,e){[t,e]=w(this,ba,fh).call(this,t,e);let[n,i,o,r]=u(this,Rn).subarray(2,6),a=t-o,l=e-r;return Math.hypot(u(this,Io)*a,u(this,Ro)*l)<=2?null:(u(this,ie).push(t,e),isNaN(n)?(u(this,Rn).set([o,r,t,e],2),u(this,Nt).push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(u(this,Rn)[0])&&u(this,Nt).splice(6,6),u(this,Rn).set([n,i,o,r,t,e],0),u(this,Nt).push(...L.createBezierPoints(n,i,o,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){let n=this.add(t,e);return n||(u(this,ie).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,n,i,o){_(this,Io,n),_(this,Ro,i),_(this,bo,o),[t,e]=w(this,ba,fh).call(this,t,e);let r=_(this,Nt,[NaN,NaN,NaN,NaN,t,e]);_(this,ie,[t,e]);let a=u(this,kt).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),u(this,kt).push({line:r,points:u(this,ie)}),u(this,Rn).set(r,0),_(this,$e,0),this.toSVGPath(),null}getLastElement(){return u(this,kt).at(-1)}setLastElement(t){return u(this,kt)?(u(this,kt).push(t),_(this,Nt,t.line),_(this,ie,t.points),_(this,$e,0),{path:{d:this.toSVGPath()}}):u(this,xo).setLastElement(t)}removeLastElement(){if(!u(this,kt))return u(this,xo).removeLastElement();u(this,kt).pop(),_(this,$t,"");for(let t=0,e=u(this,kt).length;t<e;t++){let{line:n,points:i}=u(this,kt)[t];_(this,Nt,n),_(this,ie,i),_(this,$e,0),this.toSVGPath()}return{path:{d:u(this,$t)}}}toSVGPath(){let t=L.svgRound(u(this,Nt)[4]),e=L.svgRound(u(this,Nt)[5]);if(u(this,ie).length===2)return _(this,$t,`${u(this,$t)} M ${t} ${e} Z`),u(this,$t);if(u(this,ie).length<=6){let i=u(this,$t).lastIndexOf("M");_(this,$t,`${u(this,$t).slice(0,i)} M ${t} ${e}`),_(this,$e,6)}if(u(this,ie).length===4){let i=L.svgRound(u(this,Nt)[10]),o=L.svgRound(u(this,Nt)[11]);return _(this,$t,`${u(this,$t)} L ${i} ${o}`),_(this,$e,12),u(this,$t)}let n=[];u(this,$e)===0&&(n.push(`M ${t} ${e}`),_(this,$e,6));for(let i=u(this,$e),o=u(this,Nt).length;i<o;i+=6){let[r,a,l,c,d,p]=u(this,Nt).slice(i,i+6).map(L.svgRound);n.push(`C${r} ${a} ${l} ${c} ${d} ${p}`)}return _(this,$t,u(this,$t)+n.join(" ")),_(this,$e,u(this,Nt).length),u(this,$t)}getOutlines(t,e,n,i){let o=u(this,kt).at(-1);return o.line=new Float32Array(o.line),o.points=new Float32Array(o.points),u(this,xo).build(u(this,kt),t,e,n,u(this,bo),u(this,Sa),i),_(this,Rn,null),_(this,Nt,null),_(this,kt,null),_(this,$t,null),u(this,xo)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}};Rn=new WeakMap,Nt=new WeakMap,kt=new WeakMap,bo=new WeakMap,Sa=new WeakMap,ie=new WeakMap,$t=new WeakMap,$e=new WeakMap,xo=new WeakMap,Io=new WeakMap,Ro=new WeakMap,ba=new WeakSet,fh=function(t,e){return L._normalizePoint(t,e,u(this,Io),u(this,Ro),u(this,bo))};var se,Du,Fu,xe,Pn,Mn,xa,Ia,Ra,ln,Hn,Sp,dE,bp,hE,xp,fE,Ov=class Ov extends L{constructor(){super(...arguments);y(this,ln);y(this,Sp);y(this,bp);y(this,xp);y(this,se,void 0);y(this,Du,0);y(this,Fu,void 0);y(this,xe,void 0);y(this,Pn,void 0);y(this,Mn,void 0);y(this,xa,void 0);y(this,Ia,void 0);y(this,Ra,void 0)}build(e,n,i,o,r,a,l){_(this,Pn,n),_(this,Mn,i),_(this,xa,o),_(this,Ia,r),_(this,Ra,a),_(this,Fu,l!=null?l:0),_(this,xe,e),w(this,bp,hE).call(this)}setLastElement(e){return u(this,xe).push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return u(this,xe).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let e=[];for(let{line:n}of u(this,xe)){if(e.push(`M${L.svgRound(n[4])} ${L.svgRound(n[5])}`),n.length===6){e.push("Z");continue}if(n.length===12){e.push(`L${L.svgRound(n[10])} ${L.svgRound(n[11])}`);continue}for(let i=6,o=n.length;i<o;i+=6){let[r,a,l,c,d,p]=n.subarray(i,i+6).map(L.svgRound);e.push(`C${r} ${a} ${l} ${c} ${d} ${p}`)}}return e.join("")}serialize([e,n,i,o],r){let a=[],l=[],[c,d,p,g]=w(this,Sp,dE).call(this),m,v,A,T,E,C,S,b,x;switch(u(this,Ia)){case 0:x=L._rescale,m=e,v=n+o,A=i,T=-o,E=e+c*i,C=n+(1-d-g)*o,S=e+(c+p)*i,b=n+(1-d)*o;break;case 90:x=L._rescaleAndSwap,m=e,v=n,A=i,T=o,E=e+d*i,C=n+c*o,S=e+(d+g)*i,b=n+(c+p)*o;break;case 180:x=L._rescale,m=e+i,v=n,A=-i,T=o,E=e+(1-c-p)*i,C=n+d*o,S=e+(1-c)*i,b=n+(d+g)*o;break;case 270:x=L._rescaleAndSwap,m=e+i,v=n+o,A=-i,T=-o,E=e+(1-d-g)*i,C=n+(1-c-p)*o,S=e+(1-d)*i,b=n+(1-c)*o;break}for(let{line:R,points:I}of u(this,xe))a.push(x(R,m,v,A,T,r?new Array(R.length):null)),l.push(x(I,m,v,A,T,r?new Array(I.length):null));return{lines:a,points:l,rect:[E,C,S,b]}}static deserialize(e,n,i,o,r,{paths:{lines:a,points:l},rotation:c,thickness:d}){let p=[],g,m,v,A,T;switch(c){case 0:T=L._rescale,g=-e/i,m=n/o+1,v=1/i,A=-1/o;break;case 90:T=L._rescaleAndSwap,g=-n/o,m=-e/i,v=1/o,A=1/i;break;case 180:T=L._rescale,g=e/i+1,m=-n/o,v=-1/i,A=1/o;break;case 270:T=L._rescaleAndSwap,g=n/o+1,m=e/i+1,v=-1/o,A=-1/i;break}if(!a){a=[];for(let C of l){let S=C.length;if(S===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1]]));continue}if(S===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1],NaN,NaN,NaN,NaN,C[2],C[3]]));continue}let b=new Float32Array(3*(S-2));a.push(b);let[x,R,I,N]=C.subarray(0,4);b.set([NaN,NaN,NaN,NaN,x,R],0);for(let M=4;M<S;M+=2){let F=C[M],U=C[M+1];b.set(L.createBezierPoints(x,R,I,N,F,U),(M-2)*3),[x,R,I,N]=[I,N,F,U]}}}for(let C=0,S=a.length;C<S;C++)p.push({line:T(a[C].map(b=>b!=null?b:NaN),g,m,v,A),points:T(l[C].map(b=>b!=null?b:NaN),g,m,v,A)});let E=new Ov;return E.build(p,i,o,1,c,d,r),E}get box(){return u(this,se)}updateProperty(e,n){return e==="stroke-width"?w(this,xp,fE).call(this,n):null}updateParentDimensions([e,n],i){let[o,r]=w(this,ln,Hn).call(this);_(this,Pn,e),_(this,Mn,n),_(this,xa,i);let[a,l]=w(this,ln,Hn).call(this),c=a-o,d=l-r,p=u(this,se);return p[0]-=c,p[1]-=d,p[2]+=2*c,p[3]+=2*d,p}updateRotation(e){return _(this,Du,e),{path:{transform:this.rotationTransform}}}get viewBox(){return u(this,se).map(L.svgRound).join(" ")}get defaultProperties(){let[e,n]=u(this,se);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${L.svgRound(e)} ${L.svgRound(n)}`}}}get rotationTransform(){let[,,e,n]=u(this,se),i=0,o=0,r=0,a=0,l=0,c=0;switch(u(this,Du)){case 90:o=n/e,r=-e/n,l=e;break;case 180:i=-1,a=-1,l=e,c=n;break;case 270:o=-n/e,r=e/n,c=n;break;default:return""}return`matrix(${i} ${o} ${r} ${a} ${L.svgRound(l)} ${L.svgRound(c)})`}getPathResizingSVGProperties([e,n,i,o]){let[r,a]=w(this,ln,Hn).call(this),[l,c,d,p]=u(this,se);if(Math.abs(d-r)<=L.PRECISION||Math.abs(p-a)<=L.PRECISION){let T=e+i/2-(l+d/2),E=n+o/2-(c+p/2);return{path:{"transform-origin":`${L.svgRound(e)} ${L.svgRound(n)}`,transform:`${this.rotationTransform} translate(${T} ${E})`}}}let g=(i-2*r)/(d-2*r),m=(o-2*a)/(p-2*a),v=d/i,A=p/o;return{path:{"transform-origin":`${L.svgRound(l)} ${L.svgRound(c)}`,transform:`${this.rotationTransform} scale(${v} ${A}) translate(${L.svgRound(r)} ${L.svgRound(a)}) scale(${g} ${m}) translate(${L.svgRound(-r)} ${L.svgRound(-a)})`}}}getPathResizedSVGProperties([e,n,i,o]){let[r,a]=w(this,ln,Hn).call(this),l=u(this,se),[c,d,p,g]=l;if(l[0]=e,l[1]=n,l[2]=i,l[3]=o,Math.abs(p-r)<=L.PRECISION||Math.abs(g-a)<=L.PRECISION){let E=e+i/2-(c+p/2),C=n+o/2-(d+g/2);for(let{line:S,points:b}of u(this,xe))L._translate(S,E,C,S),L._translate(b,E,C,b);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${L.svgRound(e)} ${L.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let m=(i-2*r)/(p-2*r),v=(o-2*a)/(g-2*a),A=-m*(c+r)+e+r,T=-v*(d+a)+n+a;if(m!==1||v!==1||A!==0||T!==0)for(let{line:E,points:C}of u(this,xe))L._rescale(E,A,T,m,v,E),L._rescale(C,A,T,m,v,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${L.svgRound(e)} ${L.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,n],i){let[o,r]=i,a=u(this,se),l=e-a[0],c=n-a[1];if(u(this,Pn)===o&&u(this,Mn)===r)for(let{line:d,points:p}of u(this,xe))L._translate(d,l,c,d),L._translate(p,l,c,p);else{let d=u(this,Pn)/o,p=u(this,Mn)/r;_(this,Pn,o),_(this,Mn,r);for(let{line:g,points:m}of u(this,xe))L._rescale(g,l,c,d,p,g),L._rescale(m,l,c,d,p,m);a[2]*=d,a[3]*=p}return a[0]=e,a[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${L.svgRound(e)} ${L.svgRound(n)}`}}}get defaultSVGProperties(){let e=u(this,se);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${L.svgRound(e[0])} ${L.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}};se=new WeakMap,Du=new WeakMap,Fu=new WeakMap,xe=new WeakMap,Pn=new WeakMap,Mn=new WeakMap,xa=new WeakMap,Ia=new WeakMap,Ra=new WeakMap,ln=new WeakSet,Hn=function(e=u(this,Ra)){let n=u(this,Fu)+e/2*u(this,xa);return u(this,Ia)%180===0?[n/u(this,Pn),n/u(this,Mn)]:[n/u(this,Mn),n/u(this,Pn)]},Sp=new WeakSet,dE=function(){let[e,n,i,o]=u(this,se),[r,a]=w(this,ln,Hn).call(this,0);return[e+r,n+a,i-2*r,o-2*a]},bp=new WeakSet,hE=function(){let e=_(this,se,new Float32Array([1/0,1/0,-1/0,-1/0]));for(let{line:o}of u(this,xe)){if(o.length<=12){for(let l=4,c=o.length;l<c;l+=6){let[d,p]=o.subarray(l,l+2);e[0]=Math.min(e[0],d),e[1]=Math.min(e[1],p),e[2]=Math.max(e[2],d),e[3]=Math.max(e[3],p)}continue}let r=o[4],a=o[5];for(let l=6,c=o.length;l<c;l+=6){let[d,p,g,m,v,A]=o.subarray(l,l+6);$.bezierBoundingBox(r,a,d,p,g,m,v,A,e),r=v,a=A}}let[n,i]=w(this,ln,Hn).call(this);e[0]=Math.min(1,Math.max(0,e[0]-n)),e[1]=Math.min(1,Math.max(0,e[1]-i)),e[2]=Math.min(1,Math.max(0,e[2]+n)),e[3]=Math.min(1,Math.max(0,e[3]+i)),e[2]-=e[0],e[3]-=e[1]},xp=new WeakSet,fE=function(e){let[n,i]=w(this,ln,Hn).call(this);_(this,Ra,e);let[o,r]=w(this,ln,Hn).call(this),[a,l]=[o-n,r-i],c=u(this,se);return c[0]-=a,c[1]-=l,c[2]+=2*a,c[3]+=2*l,c};var Kh=Ov,Pa,$v=class $v extends fv{constructor(e){super();y(this,Pa,void 0);_(this,Pa,e),super.updateProperties({fill:"none",stroke:ft._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,n){e==="stroke-width"&&(n!=null||(n=this["stroke-width"]),n*=u(this,Pa).realScale),super.updateSVGProperty(e,n)}clone(){let e=new $v(u(this,Pa));return e.updateAll(this),e}};Pa=new WeakMap;var _v=$v,Ip,pE,rr=class rr extends pv{constructor(e){super({...e,name:"inkEditor"});y(this,Ip);this._willKeepAspectRatio=!0}static initialize(e,n){ft.initialize(e,n),this._defaultDrawingOptions=new _v(n.viewParameters)}static getDefaultDrawingOptions(e){let n=this._defaultDrawingOptions.clone();return n.updateProperties(e),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return Z(this,"typesMap",new Map([[Q.INK_THICKNESS,"stroke-width"],[Q.INK_COLOR,"stroke"],[Q.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,n,i,o,r){return new vv(e,n,i,o,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,n,i,o,r,a){return Kh.deserialize(e,n,i,o,r,a)}static async deserialize(e,n,i){let o=null;if(e instanceof Il){let{data:{inkLists:a,rect:l,rotation:c,id:d,color:p,opacity:g,borderStyle:{rawWidth:m},popupRef:v},parent:{page:{pageNumber:A}}}=e;o=e={annotationType:K.INK,color:Array.from(p),thickness:m,opacity:g,paths:{points:a},boxes:null,pageIndex:A-1,rect:l.slice(0),rotation:c,id:d,deleted:!1,popupRef:v}}let r=await super.deserialize(e,n,i);return r.annotationElementId=e.id||null,r._initialData=o,r}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:e,_drawingOptions:n,parent:i}=this;n.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(e,n.toSVGProperties())}static onScaleChangingWhenDrawing(){let e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:n,opacity:i}){this._drawingOptions=rr.getDefaultDrawingOptions({stroke:$.makeHexColor(...e),"stroke-width":n,"stroke-opacity":i})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:n,points:i,rect:o}=this.serializeDraw(e),{_drawingOptions:{stroke:r,"stroke-opacity":a,"stroke-width":l}}=this,c={annotationType:K.INK,color:ft._colorManager.convert(r),opacity:a,thickness:l,paths:{lines:n,points:i},pageIndex:this.pageIndex,rect:o,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?c:this.annotationElementId&&!w(this,Ip,pE).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(e){let{points:n,rect:i}=this.serializeDraw(!1);return e.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:n}),null}};Ip=new WeakSet,pE=function(e){let{color:n,thickness:i,opacity:o,pageIndex:r}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((a,l)=>a!==n[l])||e.thickness!==i||e.opacity!==o||e.pageIndex!==r},H(rr,"_type","ink"),H(rr,"_editorType",K.INK),H(rr,"_defaultDrawingOptions",null);var Av=rr,ht,Gt,es,gi,ns,Ma,Nn,kn,Ie,Na,Po,hl,Mo,fl,ka,ph,Lu,Tv,Da,gh,Uu,Ev,Fa,mh,Rp,gE,yl=class yl extends ft{constructor(e){super({...e,name:"stampEditor"});y(this,Po);y(this,Mo);y(this,ka);y(this,Lu);y(this,Da);y(this,Uu);y(this,Fa);y(this,Rp);y(this,ht,null);y(this,Gt,null);y(this,es,null);y(this,gi,null);y(this,ns,null);y(this,Ma,"");y(this,Nn,null);y(this,kn,null);y(this,Ie,!1);y(this,Na,!1);_(this,gi,e.bitmapUrl),_(this,ns,e.bitmapFile)}static initialize(e,n){ft.initialize(e,n)}static get supportedTypes(){return Z(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(n=>`image/${n}`))}static get supportedTypesStr(){return Z(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,n){n.pasteEditor(K.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var e;return{type:"stamp",hasAltText:!!((e=this.altTextData)!=null&&e.altText)}}static computeTelemetryFinalData(e){var i,o;let n=e.get("hasAltText");return{hasAltText:(i=n.get(!0))!=null?i:0,hasNoAltText:(o=n.get(!1))!=null?o:0}}async mlGuessAltText(e=null,n=!0){if(this.hasAltTextData())return null;let{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");let{data:o,width:r,height:a}=e||this.copyCanvas(null,null,!0).imageData,l=await i.guess({name:"altText",request:{data:o,width:r,height:a,channels:o.length/(r*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");let c=l.output;return await this.setGuessedAltText(c),n&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){var e;u(this,Gt)&&(_(this,ht,null),this._uiManager.imageManager.deleteId(u(this,Gt)),(e=u(this,Nn))==null||e.remove(),_(this,Nn,null),u(this,kn)&&(clearTimeout(u(this,kn)),_(this,kn,null))),super.remove()}rebuild(){if(!this.parent){u(this,Gt)&&w(this,ka,ph).call(this);return}super.rebuild(),this.div!==null&&(u(this,Gt)&&u(this,Nn)===null&&w(this,ka,ph).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(u(this,es)||u(this,ht)||u(this,gi)||u(this,ns)||u(this,Gt))}get isResizable(){return!0}render(){if(this.div)return this.div;let e,n;if(this.width&&(e=this.x,n=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),u(this,ht)?w(this,Lu,Tv).call(this):w(this,ka,ph).call(this),this.width&&!this.annotationElementId){let[i,o]=this.parentDimensions;this.setAt(e*i,n*o,this.width*i,this.height*o)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;u(this,kn)!==null&&clearTimeout(u(this,kn)),_(this,kn,setTimeout(()=>{_(this,kn,null),w(this,Uu,Ev).call(this)},200))}copyCanvas(e,n,i=!1){var m;e||(e=224);let{width:o,height:r}=u(this,ht),a=new wl,l=u(this,ht),c=o,d=r,p=null;if(n){if(o>n||r>n){let N=Math.min(n/o,n/r);c=Math.floor(o*N),d=Math.floor(r*N)}p=document.createElement("canvas");let v=p.width=Math.ceil(c*a.sx),A=p.height=Math.ceil(d*a.sy);u(this,Ie)||(l=w(this,Da,gh).call(this,v,A));let T=p.getContext("2d");T.filter=this._uiManager.hcmFilter;let E="white",C="#cfcfd8";this._uiManager.hcmFilter!=="none"?C="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(E="#8f8f9d",C="#42414d");let S=15,b=S*a.sx,x=S*a.sy,R=new OffscreenCanvas(b*2,x*2),I=R.getContext("2d");I.fillStyle=E,I.fillRect(0,0,b*2,x*2),I.fillStyle=C,I.fillRect(0,0,b,x),I.fillRect(b,x,b,x),T.fillStyle=T.createPattern(R,"repeat"),T.fillRect(0,0,v,A),T.drawImage(l,0,0,l.width,l.height,0,0,v,A)}let g=null;if(i){let v,A;if(a.symmetric&&l.width<e&&l.height<e)v=l.width,A=l.height;else if(l=u(this,ht),o>e||r>e){let C=Math.min(e/o,e/r);v=Math.floor(o*C),A=Math.floor(r*C),u(this,Ie)||(l=w(this,Da,gh).call(this,v,A))}let E=new OffscreenCanvas(v,A).getContext("2d",{willReadFrequently:!0});E.drawImage(l,0,0,l.width,l.height,0,0,v,A),g={width:v,height:A,data:E.getImageData(0,0,v,A).data}}return{canvas:p,width:c,height:d,imageData:g}}getImageForAltText(){return u(this,Nn)}static async deserialize(e,n,i){var A;let o=null;if(e instanceof Hh){let{data:{rect:T,rotation:E,id:C,structParent:S,popupRef:b},container:x,parent:{page:{pageNumber:R}}}=e,I=x.querySelector("canvas"),N=i.imageManager.getFromCanvas(x.id,I);I.remove();let M=((A=await n._structTree.getAriaAttributes(`${Mv}${C}`))==null?void 0:A.get("aria-label"))||"";o=e={annotationType:K.STAMP,bitmapId:N.id,bitmap:N.bitmap,pageIndex:R-1,rect:T.slice(0),rotation:E,id:C,deleted:!1,accessibilityData:{decorative:!1,altText:M},isSvg:!1,structParent:S,popupRef:b}}let r=await super.deserialize(e,n,i),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:d,isSvg:p,accessibilityData:g}=e;d&&i.imageManager.isValidId(d)?(_(r,Gt,d),l&&_(r,ht,l)):_(r,gi,c),_(r,Ie,p);let[m,v]=r.pageDimensions;return r.width=(a[2]-a[0])/m,r.height=(a[3]-a[1])/v,r.annotationElementId=e.id||null,g&&(r.altTextData=g),r._initialData=o,_(r,Na,!!o),r}serialize(e=!1,n=null){var l;if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let i={annotationType:K.STAMP,bitmapId:u(this,Gt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:u(this,Ie),structTreeParentId:this._structTreeParentId};if(e)return i.bitmapUrl=w(this,Fa,mh).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i;let{decorative:o,altText:r}=this.serializeAltText(!1);if(!o&&r&&(i.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){let c=w(this,Rp,gE).call(this,i);if(c.isSame)return null;c.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=(l=this._initialData.structParent)!=null?l:-1}if(i.id=this.annotationElementId,n===null)return i;n.stamps||(n.stamps=new Map);let a=u(this,Ie)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!n.stamps.has(u(this,Gt)))n.stamps.set(u(this,Gt),{area:a,serialized:i}),i.bitmap=w(this,Fa,mh).call(this,!1);else if(u(this,Ie)){let c=n.stamps.get(u(this,Gt));a>c.area&&(c.area=a,c.serialized.bitmap.close(),c.serialized.bitmap=w(this,Fa,mh).call(this,!1))}return i}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}};ht=new WeakMap,Gt=new WeakMap,es=new WeakMap,gi=new WeakMap,ns=new WeakMap,Ma=new WeakMap,Nn=new WeakMap,kn=new WeakMap,Ie=new WeakMap,Na=new WeakMap,Po=new WeakSet,hl=function(e,n=!1){if(!e){this.remove();return}_(this,ht,e.bitmap),n||(_(this,Gt,e.id),_(this,Ie,e.isSvg)),e.file&&_(this,Ma,e.file.name),w(this,Lu,Tv).call(this)},Mo=new WeakSet,fl=function(){if(_(this,es,null),this._uiManager.enableWaiting(!1),!!u(this,Nn)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,ht)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,ht)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch(e){}}this.div.focus()}},ka=new WeakSet,ph=function(){if(u(this,Gt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(u(this,Gt)).then(i=>w(this,Po,hl).call(this,i,!0)).finally(()=>w(this,Mo,fl).call(this));return}if(u(this,gi)){let i=u(this,gi);_(this,gi,null),this._uiManager.enableWaiting(!0),_(this,es,this._uiManager.imageManager.getFromUrl(i).then(o=>w(this,Po,hl).call(this,o)).finally(()=>w(this,Mo,fl).call(this)));return}if(u(this,ns)){let i=u(this,ns);_(this,ns,null),this._uiManager.enableWaiting(!0),_(this,es,this._uiManager.imageManager.getFromFile(i).then(o=>w(this,Po,hl).call(this,o)).finally(()=>w(this,Mo,fl).call(this)));return}let e=document.createElement("input");e.type="file",e.accept=yl.supportedTypesStr;let n=this._uiManager._signal;_(this,es,new Promise(i=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let o=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),w(this,Po,hl).call(this,o)}i()},{signal:n}),e.addEventListener("cancel",()=>{this.remove(),i()},{signal:n})}).finally(()=>w(this,Mo,fl).call(this))),e.click()},Lu=new WeakSet,Tv=function(){var p;let{div:e}=this,{width:n,height:i}=u(this,ht),[o,r]=this.pageDimensions,a=.75;if(this.width)n=this.width*o,i=this.height*r;else if(n>a*o||i>a*r){let g=Math.min(a*o/n,a*r/i);n*=g,i*=g}let[l,c]=this.parentDimensions;this.setDims(n*l/o,i*c/r),this._uiManager.enableWaiting(!1);let d=_(this,Nn,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=n/o,this.height=i/r,(p=this._initialOptions)!=null&&p.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),w(this,Uu,Ev).call(this),u(this,Na)||(this.parent.addUndoableEditor(this),_(this,Na,!0)),this._reportTelemetry({action:"inserted_image"}),u(this,Ma)&&d.setAttribute("aria-label",u(this,Ma))},Da=new WeakSet,gh=function(e,n){let{width:i,height:o}=u(this,ht),r=i,a=o,l=u(this,ht);for(;r>2*e||a>2*n;){let c=r,d=a;r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),a>2*n&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));let p=new OffscreenCanvas(r,a);p.getContext("2d").drawImage(l,0,0,c,d,0,0,r,a),l=p.transferToImageBitmap()}return l},Uu=new WeakSet,Ev=function(){let[e,n]=this.parentDimensions,{width:i,height:o}=this,r=new wl,a=Math.ceil(i*e*r.sx),l=Math.ceil(o*n*r.sy),c=u(this,Nn);if(!c||c.width===a&&c.height===l)return;c.width=a,c.height=l;let d=u(this,Ie)?u(this,ht):w(this,Da,gh).call(this,a,l),p=c.getContext("2d");p.filter=this._uiManager.hcmFilter,p.drawImage(d,0,0,d.width,d.height,0,0,a,l)},Fa=new WeakSet,mh=function(e){if(e){if(u(this,Ie)){let o=this._uiManager.imageManager.getSvgUrl(u(this,Gt));if(o)return o}let n=document.createElement("canvas");return{width:n.width,height:n.height}=u(this,ht),n.getContext("2d").drawImage(u(this,ht),0,0),n.toDataURL()}if(u(this,Ie)){let[n,i]=this.pageDimensions,o=Math.round(this.width*n*as.PDF_TO_CSS_UNITS),r=Math.round(this.height*i*as.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(o,r);return a.getContext("2d").drawImage(u(this,ht),0,0,u(this,ht).width,u(this,ht).height,0,0,o,r),a.transferToImageBitmap()}return structuredClone(u(this,ht))},Rp=new WeakSet,gE=function(e){var a;let{pageIndex:n,accessibilityData:{altText:i}}=this._initialData,o=e.pageIndex===n,r=(((a=e.accessibilityData)==null?void 0:a.alt)||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&o&&r,isSameAltText:r}},H(yl,"_type","stamp"),H(yl,"_editorType",K.STAMP);var wv=yl,No,La,Dn,is,mi,Ge,ss,Ua,ko,cn,yi,Xt,vi,G,os,Pp,mE,Be,mn,Ou,Sv,$u,bv,Oa,yh,Ye=class Ye{constructor({uiManager:t,pageIndex:e,div:n,structTreeLayer:i,accessibilityManager:o,annotationLayer:r,drawLayer:a,textLayer:l,viewport:c,l10n:d}){y(this,Pp);y(this,Be);y(this,Ou);y(this,$u);y(this,Oa);y(this,No,void 0);y(this,La,!1);y(this,Dn,null);y(this,is,null);y(this,mi,null);y(this,Ge,new Map);y(this,ss,!1);y(this,Ua,!1);y(this,ko,!1);y(this,cn,null);y(this,yi,null);y(this,Xt,null);y(this,vi,null);y(this,G,void 0);let p=[...u(Ye,os).values()];if(!Ye._initialized){Ye._initialized=!0;for(let g of p)g.initialize(d,t)}t.registerEditorTypes(p),_(this,G,t),this.pageIndex=e,this.div=n,_(this,No,o),_(this,Dn,r),this.viewport=c,_(this,Xt,l),this.drawLayer=a,this._structTree=i,u(this,G).addLayer(this)}get isEmpty(){return u(this,Ge).size===0}get isInvisible(){return this.isEmpty&&u(this,G).getMode()===K.NONE}updateToolbar(t){u(this,G).updateToolbar(t)}updateMode(t=u(this,G).getMode()){switch(w(this,Oa,yh).call(this),t){case K.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case K.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case K.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:e}=this.div;for(let n of u(Ye,os).values())e.toggle(`${n._type}Editing`,t===n._editorType);this.div.hidden=!1}hasTextLayer(t){var e;return t===((e=u(this,Xt))==null?void 0:e.div)}setEditingState(t){u(this,G).setEditingState(t)}addCommands(t){u(this,G).addCommands(t)}cleanUndoStack(t){u(this,G).cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){var e;(e=u(this,Dn))==null||e.div.classList.toggle("disabled",!t)}async enable(){_(this,ko,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);let t=new Set;for(let n of u(this,Ge).values())n.enableEditing(),n.show(!0),n.annotationElementId&&(u(this,G).removeChangedExistingAnnotation(n),t.add(n.annotationElementId));if(!u(this,Dn)){_(this,ko,!1);return}let e=u(this,Dn).getEditableAnnotations();for(let n of e){if(n.hide(),u(this,G).isDeletedAnnotationElement(n.data.id)||t.has(n.data.id))continue;let i=await this.deserialize(n);i&&(this.addOrRebuild(i),i.enableEditing())}_(this,ko,!1)}disable(){var i;_(this,Ua,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);let t=new Map,e=new Map;for(let o of u(this,Ge).values())if(o.disableEditing(),!!o.annotationElementId){if(o.serialize()!==null){t.set(o.annotationElementId,o);continue}else e.set(o.annotationElementId,o);(i=this.getEditableAnnotation(o.annotationElementId))==null||i.show(),o.remove()}if(u(this,Dn)){let o=u(this,Dn).getEditableAnnotations();for(let r of o){let{id:a}=r.data;if(u(this,G).isDeletedAnnotationElement(a))continue;let l=e.get(a);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=t.get(a),l&&(u(this,G).addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}w(this,Oa,yh).call(this),this.isEmpty&&(this.div.hidden=!0);let{classList:n}=this.div;for(let o of u(Ye,os).values())n.remove(`${o._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),_(this,Ua,!1)}getEditableAnnotation(t){var e;return((e=u(this,Dn))==null?void 0:e.getEditableAnnotation(t))||null}setActiveEditor(t){u(this,G).getActive()!==t&&u(this,G).setActiveEditor(t)}enableTextSelection(){var t;if(this.div.tabIndex=-1,(t=u(this,Xt))!=null&&t.div&&!u(this,vi)){_(this,vi,new AbortController);let e=u(this,G).combinedSignal(u(this,vi));u(this,Xt).div.addEventListener("pointerdown",w(this,Pp,mE).bind(this),{signal:e}),u(this,Xt).div.classList.add("highlighting")}}disableTextSelection(){var t;this.div.tabIndex=0,(t=u(this,Xt))!=null&&t.div&&u(this,vi)&&(u(this,vi).abort(),_(this,vi,null),u(this,Xt).div.classList.remove("highlighting"))}enableClick(){if(u(this,is))return;_(this,is,new AbortController);let t=u(this,G).combinedSignal(u(this,is));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});let e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){var t;(t=u(this,is))==null||t.abort(),_(this,is,null)}attach(t){u(this,Ge).set(t.id,t);let{annotationElementId:e}=t;e&&u(this,G).isDeletedAnnotationElement(e)&&u(this,G).removeDeletedAnnotationElement(t)}detach(t){var e;u(this,Ge).delete(t.id),(e=u(this,No))==null||e.removePointerInTextLayer(t.contentDiv),!u(this,Ua)&&t.annotationElementId&&u(this,G).addDeletedAnnotationElement(t)}remove(t){this.detach(t),u(this,G).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(u(this,G).addDeletedAnnotationElement(t.annotationElementId),ft.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),(e=t.parent)==null||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),u(this,G).addEditor(t),this.attach(t),!t.isAttachedToDOM){let e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!u(this,ko)),u(this,G).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){var n;if(!t.isAttachedToDOM)return;let{activeElement:e}=document;t.div.contains(e)&&!u(this,mi)&&(t._focusEventsAllowed=!1,_(this,mi,setTimeout(()=>{_(this,mi,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:u(this,G)._signal}),e.focus())},0))),t._structTreeParentId=(n=u(this,No))==null?void 0:n.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){let e=()=>t._uiManager.rebuild(t),n=()=>{t.remove()};this.addCommands({cmd:e,undo:n,mustExec:!1})}getNextId(){return u(this,G).getId()}combinedSignal(t){return u(this,G).combinedSignal(t)}canCreateNewEmptyEditor(){var t;return(t=u(this,Be,mn))==null?void 0:t.canCreateNewEmptyEditor()}pasteEditor(t,e){u(this,G).updateToolbar(t),u(this,G).updateMode(t);let{offsetX:n,offsetY:i}=w(this,$u,bv).call(this),o=this.getNextId(),r=w(this,Ou,Sv).call(this,{parent:this,id:o,x:n,y:i,uiManager:u(this,G),isCentered:!0,...e});r&&this.add(r)}async deserialize(t){var e,n;return await((n=u(Ye,os).get((e=t.annotationType)!=null?e:t.annotationEditorType))==null?void 0:n.deserialize(t,this,u(this,G)))||null}createAndAddNewEditor(t,e,n={}){let i=this.getNextId(),o=w(this,Ou,Sv).call(this,{parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:u(this,G),isCentered:e,...n});return o&&this.add(o),o}addNewEditor(){this.createAndAddNewEditor(w(this,$u,bv).call(this),!0)}setSelected(t){u(this,G).setSelected(t)}toggleSelected(t){u(this,G).toggleSelected(t)}unselect(t){u(this,G).unselect(t)}pointerup(t){var n;let{isMac:e}=Bt.platform;if(!(t.button!==0||t.ctrlKey&&e)&&t.target===this.div&&u(this,ss)&&(_(this,ss,!1),!((n=u(this,Be,mn))!=null&&n.isDrawer&&u(this,Be,mn).supportMultipleDrawings))){if(!u(this,La)){_(this,La,!0);return}if(u(this,G).getMode()===K.STAMP){u(this,G).unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){var i;if(u(this,G).getMode()===K.HIGHLIGHT&&this.enableTextSelection(),u(this,ss)){_(this,ss,!1);return}let{isMac:e}=Bt.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(_(this,ss,!0),(i=u(this,Be,mn))!=null&&i.isDrawer){this.startDrawingSession(t);return}let n=u(this,G).getActive();_(this,La,!n||n.isEmpty())}startDrawingSession(t){if(this.div.focus(),u(this,cn)){u(this,Be,mn).startDrawing(this,u(this,G),!1,t);return}u(this,G).setCurrentDrawingSession(this),_(this,cn,new AbortController);let e=u(this,G).combinedSignal(u(this,cn));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(_(this,yi,null),this.commitOrRemove())},{signal:e}),u(this,Be,mn).startDrawing(this,u(this,G),!1,t)}pause(t){if(t){let{activeElement:e}=document;this.div.contains(e)&&_(this,yi,e);return}u(this,yi)&&setTimeout(()=>{var e;(e=u(this,yi))==null||e.focus(),_(this,yi,null)},0)}endDrawingSession(t=!1){return u(this,cn)?(u(this,G).setCurrentDrawingSession(null),u(this,cn).abort(),_(this,cn,null),_(this,yi,null),u(this,Be,mn).endDrawing(t)):null}findNewParent(t,e,n){let i=u(this,G).findParent(e,n);return i===null||i===this?!1:(i.changeParent(t),!0)}commitOrRemove(){return u(this,cn)?(this.endDrawingSession(),!0):!1}onScaleChanging(){u(this,cn)&&u(this,Be,mn).onScaleChangingWhenDrawing(this)}destroy(){var t,e;this.commitOrRemove(),((t=u(this,G).getActive())==null?void 0:t.parent)===this&&(u(this,G).commitOrRemove(),u(this,G).setActiveEditor(null)),u(this,mi)&&(clearTimeout(u(this,mi)),_(this,mi,null));for(let n of u(this,Ge).values())(e=u(this,No))==null||e.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,u(this,Ge).clear(),u(this,G).removeLayer(this)}render({viewport:t}){this.viewport=t,Lo(this.div,t);for(let e of u(this,G).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){u(this,G).commitOrRemove(),w(this,Oa,yh).call(this);let e=this.viewport.rotation,n=t.rotation;if(this.viewport=t,Lo(this.div,{rotation:n}),e!==n)for(let i of u(this,Ge).values())i.rotate(n)}get pageDimensions(){let{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return u(this,G).viewParameters.realScale}};No=new WeakMap,La=new WeakMap,Dn=new WeakMap,is=new WeakMap,mi=new WeakMap,Ge=new WeakMap,ss=new WeakMap,Ua=new WeakMap,ko=new WeakMap,cn=new WeakMap,yi=new WeakMap,Xt=new WeakMap,vi=new WeakMap,G=new WeakMap,os=new WeakMap,Pp=new WeakSet,mE=function(t){u(this,G).unselectAll();let{target:e}=t;if(e===u(this,Xt).div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&u(this,Xt).div.contains(e)){let{isMac:n}=Bt.platform;if(t.button!==0||t.ctrlKey&&n)return;u(this,G).showAllEditors("highlight",!0,!0),u(this,Xt).div.classList.add("free"),this.toggleDrawing(),Wh.startHighlighting(this,u(this,G).direction==="ltr",{target:u(this,Xt).div,x:t.x,y:t.y}),u(this,Xt).div.addEventListener("pointerup",()=>{u(this,Xt).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:u(this,G)._signal}),t.preventDefault()}},Be=new WeakSet,mn=function(){return u(Ye,os).get(u(this,G).getMode())},Ou=new WeakSet,Sv=function(t){let e=u(this,Be,mn);return e?new e.prototype.constructor(t):null},$u=new WeakSet,bv=function(){let{x:t,y:e,width:n,height:i}=this.div.getBoundingClientRect(),o=Math.max(0,t),r=Math.max(0,e),a=Math.min(window.innerWidth,t+n),l=Math.min(window.innerHeight,e+i),c=(o+a)/2-t,d=(r+l)/2-e,[p,g]=this.viewport.rotation%180===0?[c,d]:[d,c];return{offsetX:p,offsetY:g}},Oa=new WeakSet,yh=function(){for(let t of u(this,Ge).values())t.isEmpty()&&t.remove()},H(Ye,"_initialized",!1),y(Ye,os,new Map([iv,Av,wv,Wh].map(t=>[t._editorType,t])));var Cv=Ye,un,Gu,oe,Do,Mp,yE,Bu,Iv,Np,vE,Hu,Rv,Wt=class Wt{constructor({pageIndex:t}){y(this,Bu);y(this,Np);y(this,Hu);y(this,un,null);y(this,Gu,0);y(this,oe,new Map);y(this,Do,new Map);this.pageIndex=t}setParent(t){if(!u(this,un)){_(this,un,t);return}if(u(this,un)!==t){if(u(this,oe).size>0)for(let e of u(this,oe).values())e.remove(),t.append(e);_(this,un,t)}}static get _svgFactory(){return Z(this,"_svgFactory",new bl)}draw(t,e=!1,n=!1){let i=jt(this,Gu)._++,o=w(this,Bu,Iv).call(this),r=Wt._svgFactory.createElement("defs");o.append(r);let a=Wt._svgFactory.createElement("path");r.append(a);let l=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),e&&u(this,Do).set(i,a);let c=n?w(this,Np,vE).call(this,r,l):null,d=Wt._svgFactory.createElement("use");return o.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(o,t),u(this,oe).set(i,o),{id:i,clipPathId:`url(#${c})`}}drawOutline(t,e){let n=jt(this,Gu)._++,i=w(this,Bu,Iv).call(this),o=Wt._svgFactory.createElement("defs");i.append(o);let r=Wt._svgFactory.createElement("path");o.append(r);let a=`path_p${this.pageIndex}_${n}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){let p=Wt._svgFactory.createElement("mask");o.append(p),l=`mask_p${this.pageIndex}_${n}`,p.setAttribute("id",l),p.setAttribute("maskUnits","objectBoundingBox");let g=Wt._svgFactory.createElement("rect");p.append(g),g.setAttribute("width","1"),g.setAttribute("height","1"),g.setAttribute("fill","white");let m=Wt._svgFactory.createElement("use");p.append(m),m.setAttribute("href",`#${a}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}let c=Wt._svgFactory.createElement("use");i.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);let d=c.cloneNode();return i.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(i,t),u(this,oe).set(n,i),n}finalizeDraw(t,e){u(this,Do).delete(t),this.updateProperties(t,e)}updateProperties(t,e){var l;if(!e)return;let{root:n,bbox:i,rootClass:o,path:r}=e,a=typeof t=="number"?u(this,oe).get(t):t;if(a){if(n&&w(this,Hu,Rv).call(this,a,n),i&&w(l=Wt,Mp,yE).call(l,a,i),o){let{classList:c}=a;for(let[d,p]of Object.entries(o))c.toggle(d,p)}if(r){let d=a.firstChild.firstChild;w(this,Hu,Rv).call(this,d,r)}}}updateParent(t,e){if(e===this)return;let n=u(this,oe).get(t);n&&(u(e,un).append(n),u(this,oe).delete(t),u(e,oe).set(t,n))}remove(t){u(this,Do).delete(t),u(this,un)!==null&&(u(this,oe).get(t).remove(),u(this,oe).delete(t))}destroy(){_(this,un,null);for(let t of u(this,oe).values())t.remove();u(this,oe).clear(),u(this,Do).clear()}};un=new WeakMap,Gu=new WeakMap,oe=new WeakMap,Do=new WeakMap,Mp=new WeakSet,yE=function(t,[e,n,i,o]){let{style:r}=t;r.top=`${100*n}%`,r.left=`${100*e}%`,r.width=`${100*i}%`,r.height=`${100*o}%`},Bu=new WeakSet,Iv=function(){let t=Wt._svgFactory.create(1,1,!0);return u(this,un).append(t),t.setAttribute("aria-hidden",!0),t},Np=new WeakSet,vE=function(t,e){let n=Wt._svgFactory.createElement("clipPath");t.append(n);let i=`clip_${e}`;n.setAttribute("id",i),n.setAttribute("clipPathUnits","objectBoundingBox");let o=Wt._svgFactory.createElement("use");return n.append(o),o.setAttribute("href",`#${e}`),o.classList.add("clip"),i},Hu=new WeakSet,Rv=function(t,e){for(let[n,i]of Object.entries(e))i===null?t.removeAttribute(n):t.setAttribute(n,i)},y(Wt,Mp);var xv=Wt;globalThis.pdfjsTestingUtils={HighlightOutliner:Rl};var EP=V.AbortException,CP=V.AnnotationEditorLayer,SP=V.AnnotationEditorParamsType,bP=V.AnnotationEditorType,xP=V.AnnotationEditorUIManager,IP=V.AnnotationLayer,RP=V.AnnotationMode,PP=V.ColorPicker,MP=V.DOMSVGFactory,NP=V.DrawLayer,kP=V.FeatureTest,_E=V.GlobalWorkerOptions,DP=V.ImageKind,FP=V.InvalidPDFException,LP=V.MissingPDFException,UP=V.OPS,OP=V.OutputScale,$P=V.PDFDataRangeTransport,GP=V.PDFDateString,BP=V.PDFWorker,HP=V.PasswordResponses,VP=V.PermissionFlag,qP=V.PixelsPerInch,zP=V.RenderingCancelledException,WP=V.TextLayer,KP=V.TouchManager,YP=V.UnexpectedResponseException,JP=V.Util,XP=V.VerbosityLevel,ZP=V.XfaLayer,QP=V.build,jP=V.createValidAbsoluteUrl,tM=V.fetchData,Bp=V.getDocument,eM=V.getFilenameFromUrl,nM=V.getPdfFilenameFromUrl,iM=V.getXfaPageViewport,sM=V.isDataScheme,oM=V.isPdfFile,rM=V.noContextMenu,aM=V.normalizeUnicode,lM=V.setLayerDimensions,cM=V.shadow,uM=V.stopEvent,dM=V.version;_E.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.mjs";var Hp=class{constructor(t=50){this.minTextThreshold=t}async extractText(t){let e=await Bp({data:t,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,n="";for(let r=1;r<=e.numPages;r++){let c=(await(await e.getPage(r)).getTextContent()).items.map(d=>d.str||"").join(" ");n+=`
## \uD398\uC774\uC9C0 ${r}

${c}
`}let o=n.replace(/\s/g,"").length/e.numPages<this.minTextThreshold;return{text:n,isScanned:o,numPages:e.numPages}}async renderPagesToImages(t,e){let n=await Bp({data:t,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,i=[],o=e?Math.min(n.numPages,e):n.numPages;for(let r=1;r<=o;r++){let a=await n.getPage(r),l=a.getViewport({scale:2}),c=document.createElement("canvas");c.width=l.width,c.height=l.height;let d=c.getContext("2d");await a.render({canvasContext:d,viewport:l}).promise;let p=c.toDataURL("image/png").split(",")[1];i.push({base64:p,mimeType:"image/png",pageNum:r})}return i}async getPageCount(t){return(await Bp({data:t,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise).numPages}};var Vp=class{constructor(t,e,n){this.gemini=t,this.settings=e,this.vault=n,this.pdfProcessor=new Hp(e.ocrMinTextThreshold),this.dailyUsage=this.loadDailyUsage()}loadDailyUsage(){return{date:Ho(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}saveDailyUsage(){}checkDailyLimit(t){let e=Ho(this.settings.timezone);this.dailyUsage.date!==e&&(this.dailyUsage={date:e,pagesProcessed:0,filesProcessed:0});let n=this.settings.ocrDailyLimit-this.dailyUsage.pagesProcessed;return{allowed:t<=n,remaining:n}}getFileSizeMB(t){return t.stat.size/(1024*1024)}async checkLimits(t){let e=this.getFileSizeMB(t);if(e>this.settings.ocrMaxFileSizeMB)return{allowed:!1,reason:`\uD30C\uC77C \uD06C\uAE30(${e.toFixed(1)}MB)\uAC00 \uC81C\uD55C(${this.settings.ocrMaxFileSizeMB}MB)\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,fileSize:e};if(t.extension==="pdf"){let i=await this.vault.readBinary(t),o=await this.pdfProcessor.getPageCount(i);if(o>this.settings.ocrMaxPages)return{allowed:!1,reason:`\uD398\uC774\uC9C0 \uC218(${o})\uAC00 \uC81C\uD55C(${this.settings.ocrMaxPages})\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,pageCount:o,fileSize:e};let r=this.checkDailyLimit(o);return r.allowed?{allowed:!0,pageCount:o,fileSize:e}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${r.remaining})`,pageCount:o,fileSize:e}}let n=this.checkDailyLimit(1);return n.allowed?{allowed:!0,pageCount:1,fileSize:e}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${n.remaining})`,pageCount:1,fileSize:e}}async processImage(t){let e=await this.vault.readBinary(t),n=this.arrayBufferToBase64(e),i=this.getMimeType(t.extension),o=await this.gemini.extractTextFromImage(n,i);return this.dailyUsage.pagesProcessed+=1,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:o,pages:1,sourceType:"image",sourceFile:t.name}}async processPDF(t,e=!1,n){let i=await this.vault.readBinary(t),o=n||this.settings.ocrMaxPages,r=await this.pdfProcessor.extractText(i);if(!r.isScanned&&!e)return{text:r.text,pages:r.numPages,sourceType:"pdf_text",sourceFile:t.name};let a=Math.min(r.numPages,o);new Gv.Notice(`\uC2A4\uCE94 PDF \uAC10\uC9C0\uB428. OCR \uCC98\uB9AC \uC911... (${a}\uD398\uC774\uC9C0)`);let l=await this.pdfProcessor.renderPagesToImages(i,o),c=await this.gemini.extractTextFromImages(l,(p,g)=>{new Gv.Notice(`OCR \uC9C4\uD589 \uC911: ${p}/${g} \uD398\uC774\uC9C0`,1500)}),d="";for(let p=0;p<c.length;p++)d+=`
## \uD398\uC774\uC9C0 ${p+1}

${c[p]}
`;return this.dailyUsage.pagesProcessed+=c.length,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:d,pages:c.length,sourceType:"pdf_scanned",sourceFile:t.name}}async processFile(t,e){let n=t.extension.toLowerCase();if(["png","jpg","jpeg","webp","gif"].includes(n))return this.processImage(t);if(n==="pdf")return this.processPDF(t,!1,e);throw new Error(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD: ${n}`)}generateMarkdownNote(t){let e=Dt(this.settings.timezone,this.settings.dateFormat),n={image:"\uC774\uBBF8\uC9C0",pdf_text:"PDF (\uD14D\uC2A4\uD2B8)",pdf_scanned:"PDF (\uC2A4\uCE94/OCR)"}[t.sourceType];return`---
type: ocr
source_file: "${t.sourceFile}"
source_type: ${t.sourceType}
pages: ${t.pages}
ocr_at: ${e}
---

# OCR: ${t.sourceFile.replace(/\.[^.]+$/,"")}

> \uC6D0\uBCF8: ${t.sourceFile} | \uCC98\uB9AC \uBC29\uC2DD: ${n} | ${t.pages}\uD398\uC774\uC9C0

${t.text}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${t.sourceFile}]]
`}generateSummarizedNote(t,e){let n=Dt(this.settings.timezone,this.settings.dateFormat);return`---
type: ocr
source_file: "${t.sourceFile}"
source_type: ${t.sourceType}
title: "${e.title}"
pages: ${t.pages}
ocr_at: ${n}
---

# ${e.title}

## \uC694\uC57D
${e.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${e.keyPoints.map(i=>`- ${i}`).join(`
`)}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${t.sourceFile}]]
`}arrayBufferToBase64(t){let e="",n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}getMimeType(t){return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/webp",gif:"image/gif"}[t.toLowerCase()]||"image/png"}getDailyUsage(){return{...this.dailyUsage}}};var qp=class{constructor(t,e){this.index=new Map;this.app=t,this.gemini=e}async buildIndex(){this.index.clear();let t=this.app.vault.getMarkdownFiles();for(let e of t)try{let n=await this.indexNote(e);n&&this.index.set(e.path,n)}catch(n){console.error(`\uC778\uB371\uC2F1 \uC2E4\uD328: ${e.path}`,n)}console.log(`\uC778\uB371\uC2A4 \uAD6C\uCD95 \uC644\uB8CC: ${this.index.size}\uAC1C \uB178\uD2B8`)}async indexNote(t){let e=this.app.metadataCache.getFileCache(t),n=e==null?void 0:e.frontmatter,i=[];n!=null&&n.keywords&&(i=Array.isArray(n.keywords)?n.keywords:[n.keywords]);let o;if(n!=null&&n.targetType){let l=n.targetType;["project","library","archive"].includes(l)&&(o=l)}let r=(n==null?void 0:n.title)||t.basename,a=n==null?void 0:n.type;return{path:t.path,title:r,keywords:i,category:o,project:n==null?void 0:n.project,type:a}}async updateIndex(t){let e=await this.indexNote(t);e&&this.index.set(t.path,e)}removeFromIndex(t){this.index.delete(t)}async findRelated(t,e,n){let i=await this.gemini.extractKeywords(t);if(i.length===0)return[];let o=this.filterByKeywords(i,n);if(o.length===0)return[];let r=o.map((c,d)=>`${d}. ${c.note.title} (\uD0A4\uC6CC\uB4DC: ${c.note.keywords.join(", ")})`).join(`
`),a=await this.gemini.findRelatedNotes(e,i,r),l=[];for(let c of a)if(c.index>=0&&c.index<o.length){let d=o[c.index];l.push({note:d.note,relevance:c.relevance,matchedKeywords:d.matchedKeywords,reason:c.reason||"",connectionType:c.type||""})}return l}filterByKeywords(t,e){let n=[],i=new Set(t.map(o=>o.toLowerCase()));for(let[o,r]of this.index){if(e&&o===e||r.keywords.length===0)continue;let a=[];for(let l of r.keywords){let c=l.toLowerCase();for(let d of i)if(c===d||c.includes(d)||d.includes(c)){a.push(l);break}}a.length>0&&n.push({note:r,matchedKeywords:a})}return n.sort((o,r)=>r.matchedKeywords.length-o.matchedKeywords.length),n.slice(0,10)}async saveKeywordsToNote(t,e){let n=await this.app.vault.read(t),i=this.updateFrontmatterKeywords(n,e);await this.app.vault.modify(t,i),await this.updateIndex(t)}updateFrontmatterKeywords(t,e){let n=`keywords: [${e.map(o=>`"${o}"`).join(", ")}]`,i=t.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(i){let o=i[1];if(/^keywords:/m.test(o)){let r=o.replace(/^keywords:.*$/m,n);return t.replace(/^---\r?\n[\s\S]*?\r?\n---/,`---
${r}
---`)}else return t.replace(/^---\r?\n([\s\S]*?)\r?\n---/,`---
$1
${n}
---`)}else return`---
${n}
---

${t}`}async addRelatedLinks(t,e){if(e.length===0)return;let n=await this.app.vault.read(t),i=`

---
## \uAD00\uB828 \uB178\uD2B8
${e.map(a=>{let l=a.note.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]] (\uAD00\uB828\uB3C4: ${Math.round(a.relevance*100)}%)`}).join(`
`)}
`,o=/\n---\n##  \n[\s\S]*?(?=\n---\n|$)/,r;o.test(n)?r=n.replace(o,i):r=n+i,await this.app.vault.modify(t,r)}getIndexSize(){return this.index.size}getZettelIndex(){let t=new Map;for(let[e,n]of this.index)n.type==="zettel"&&t.set(e,n);return t}getZettelCount(){return this.getZettelIndex().size}async findRelatedZettels(t,e){if(t.length===0)return[];let n=this.getZettelIndex();if(n.size===0)return[];let i=this.filterZettelsByKeywords(t,n,e);if(i.length===0)return[];let o=i.map((l,c)=>`${c}. ${l.note.title} (\uD0A4\uC6CC\uB4DC: ${l.note.keywords.join(", ")})`).join(`
`),r=await this.gemini.findRelatedNotes("\uC0C8 ZK \uB178\uD2B8",t,o),a=[];for(let l of r)if(l.index>=0&&l.index<i.length){let c=i[l.index];a.push({note:c.note,relevance:l.relevance,matchedKeywords:c.matchedKeywords,reason:l.reason||"",connectionType:l.type||""})}return a}filterZettelsByKeywords(t,e,n){let i=[],o=new Set(t.map(r=>r.toLowerCase()));for(let[r,a]of e){if(n&&r===n||a.keywords.length===0)continue;let l=[];for(let c of a.keywords){let d=c.toLowerCase();for(let p of o)if(d===p||d.includes(p)||p.includes(d)){l.push(c);break}}l.length>0&&i.push({note:a,matchedKeywords:l})}return i.sort((r,a)=>a.matchedKeywords.length-r.matchedKeywords.length),i.slice(0,10)}};var Ga=require("obsidian");function AE(s,t=100){return s.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,t)}var zp=class{constructor(t,e,n,i){this.projectMOCs=new Map;this.app=t,this.gemini=e,this.projectsFolder=n,this.settings=i}async scanProjectMOCs(){this.projectMOCs.clear();let t=this.app.vault.getMarkdownFiles();for(let e of t){let n=await this.parseProjectMOC(e);n&&this.projectMOCs.set(n.project,n)}console.log(`\uD504\uB85C\uC81D\uD2B8 MOC \uC2A4\uCE94 \uC644\uB8CC: ${this.projectMOCs.size}\uAC1C`)}async parseProjectMOC(t){let e=this.app.metadataCache.getFileCache(t),n=e==null?void 0:e.frontmatter;if(!n||n.type!=="project-moc")return null;let i=n.project||t.basename,o=n.title||t.basename;return{path:t.path,title:o,project:i}}getProjectList(){let t=this.app.vault.getAbstractFileByPath(this.projectsFolder);return t instanceof Ga.TFolder?t.children.filter(e=>e instanceof Ga.TFolder).map(e=>e.name):[]}getMOCCount(){return this.projectMOCs.size}async detectProject(t,e){let n=this.getProjectList();return n.length===0?null:await this.gemini.detectProject(t,e,n)}async addNoteToMOC(t,e,n){let i=this.projectMOCs.get(t);if(!i)return!1;let o=this.app.vault.getAbstractFileByPath(i.path);if(!(o instanceof Ga.TFile))return!1;let r=await this.app.vault.read(o),a=this.app.vault.getAbstractFileByPath(n),c=`[[${a instanceof Ga.TFile?a.basename:AE(e)}]]`;if(r.includes(c))return!0;let d=/^##  \s*$/m,p;return d.test(r)?p=r.replace(/^(##  \s*\n)/m,`$1- ${c}
`):p=r.trimEnd()+`

## \uAD00\uB828 \uB178\uD2B8
- ${c}
`,await this.app.vault.modify(o,p),!0}async createProjectMOC(t,e){this.app.vault.getAbstractFileByPath(e)||await this.app.vault.createFolder(e);let i=AE(t),o=`${e}/${i} MOC.md`;if(this.app.vault.getAbstractFileByPath(o))return null;let a=`---
type: project-moc
project: "${t}"
title: "${t} \uD504\uB85C\uC81D\uD2B8"
created: ${Dt(this.settings.timezone,this.settings.dateFormat)}
---

# ${t} \uD504\uB85C\uC81D\uD2B8

## \uAC1C\uC694


## \uC9C4\uD589 \uC911


## \uAD00\uB828 \uB178\uD2B8

`,l=await this.app.vault.create(o,a);return this.projectMOCs.set(t,{path:l.path,title:`${t} \uD504\uB85C\uC81D\uD2B8`,project:t}),l}hasProject(t){return this.projectMOCs.has(t)}getProjectMOCPath(t){let e=this.projectMOCs.get(t);return(e==null?void 0:e.path)||null}removeFromIndex(t){for(let[e,n]of this.projectMOCs)if(n.path===t){this.projectMOCs.delete(e);break}}};var Bv=require("obsidian");var Wp=class{constructor(t,e,n,i,o){this.app=t,this.relatedNoteFinder=e,this.zettelFolder=n,this.settings=i,this.gemini=o||null}get indexPath(){return`${this.zettelFolder}/ZK Index.md`}async updateIndex(t,e){let n=this.app.vault.getAbstractFileByPath(this.indexPath);n instanceof Bv.TFile?await this.addNoteToIndex(n,t,e):await this.createIndex(t,e)}async createIndex(t,e){let n=Dt(this.settings.timezone,this.settings.dateFormat),i=e[0]||"\uAE30\uD0C0",o=`---
type: zk-index
updated: ${n}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
- [[${t.basename}]]

## \uC8FC\uC81C\uBCC4
### ${i}
- [[${t.basename}]]
`;await this.app.vault.create(this.indexPath,o)}async addNoteToIndex(t,e,n){let i=await this.app.vault.read(t);i=this.updateRecentSection(i,e);let o=n[0]||"\uAE30\uD0C0";i=this.updateTopicSection(i,e,o),i=this.updateTimestamp(i),await this.app.vault.modify(t,i)}updateRecentSection(t,e){let n=/(##  \n)([\s\S]*?)(\n## |\n*$)/,i=t.match(n);if(i){let o=i[2].trim().split(`
`).filter(a=>a.startsWith("- ")),r=`- [[${e.basename}]]`;return o=o.filter(a=>!a.includes(e.basename)),o.unshift(r),o=o.slice(0,10),t.replace(n,`$1${o.join(`
`)}

$3`)}return t}updateTopicSection(t,e,n){let i=`### ${n}`,o=`- [[${e.basename}]]`;if(t.includes(i)){let r=new RegExp(`(### ${this.escapeRegex(n)}
)((?:- \\[\\[.*?\\]\\]
?)*)`),a=t.match(r);if(a)return a[2].includes(e.basename)?t:t.replace(r,`$1$2${o}
`)}else{let r=/(## \n)/;if(r.test(t))return t.replace(r,`$1${i}
${o}

`)}return t}updateTimestamp(t){let e=Dt(this.settings.timezone,this.settings.dateFormat);return t.replace(/^(---\n[\s\S]*?updated: ).*?(\n[\s\S]*?---)/,`$1${e}$2`)}escapeRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}async rebuildIndex(){let t=this.relatedNoteFinder.getZettelIndex();if(t.size===0)return;let e=new Map,n=[];for(let[,a]of t){let l=a.keywords[0]||"\uAE30\uD0C0";e.has(l)||e.set(l,[]),e.get(l).push(a);let c=a.path.match(/(\d{13})/),d=a.path.match(/(\d{8})-\d{3}/),p;if(c)p=new Date(parseInt(c[1]));else if(d){let g=d[1];p=new Date(parseInt(g.slice(0,4)),parseInt(g.slice(4,6))-1,parseInt(g.slice(6,8)))}else p=new Date;n.push({note:a,created:p})}n.sort((a,l)=>l.created.getTime()-a.created.getTime());let o=`---
type: zk-index
updated: ${Dt(this.settings.timezone,this.settings.dateFormat)}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
${n.slice(0,10).map(({note:a})=>{let l=a.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]]`}).join(`
`)}

## \uC8FC\uC81C\uBCC4
`;for(let[a,l]of e){let c=null;if(this.gemini&&l.length>=2)try{let d=l.map(p=>`- ${p.title} (\uD0A4\uC6CC\uB4DC: ${p.keywords.join(", ")})`).join(`
`);c=await this.gemini.generateTopicStructure(a,d)}catch(d){console.error(`\uC8FC\uC81C \uAD6C\uC870 \uC0DD\uC131 \uC2E4\uD328: ${a}`,d)}o+=`### ${a}
`,c!=null&&c.description&&(o+=`${c.description}

`),o+=`**\uD575\uC2EC \uB178\uD2B8:**
`;for(let d of l){let p=d.path.split("/"),g=p[p.length-1].replace(/\.md$/,""),m=c==null?void 0:c.notes.find(A=>A.title===d.title),v=m!=null&&m.role?` - ${m.role}`:"";if(o+=`- [[${g}]]${v}
`,m!=null&&m.relations&&m.relations.length>0)for(let A of m.relations){let T=A.type==="\uBC1C\uC804"?"\u2192":A.type==="\uAE30\uBC18"?"\u2190":"\u2194";o+=`  ${T} ${A.target}
`}}c!=null&&c.relatedTopics&&c.relatedTopics.length>0&&(o+=`
**\uAD00\uB828 \uC8FC\uC81C:** ${c.relatedTopics.join(", ")}
`),o+=`
`}let r=this.app.vault.getAbstractFileByPath(this.indexPath);r instanceof Bv.TFile&&await this.app.vault.delete(r),await this.app.vault.create(this.indexPath,o)}};var Ba=require("obsidian");var Kp=class{constructor(t,e,n){this.app=t,this.gemini=e,this.settings=n}async collectNotes(t){let e=t.customRange||qa(t.period,this.settings.timezone),n=this.app.vault.getMarkdownFiles(),i=[];for(let o of n){if(this.shouldExclude(o,t))continue;let r=this.getProjectFromPath(o.path);if(t.projectFilter&&r!==t.projectFilter)continue;let a=await this.getNoteDate(o);if(!o_(a,e))continue;let l=await this.extractNoteInfo(o,r,a);i.push(l)}return i.sort((o,r)=>r.modified.getTime()-o.modified.getTime()),i}getBasename(t){let e=t.lastIndexOf("/");return(e>=0?t.substring(e+1):t).replace(/\.md$/,"")}shouldExclude(t,e){let n=[this.settings.archivesFolder,this.settings.zettelFolder],i=e.excludeFolders||n;for(let o of i)if(t.path.startsWith(o))return!0;return!!t.basename.includes("\uD68C\uACE0")}getProjectFromPath(t){let e=this.settings.projectsFolder+"/";if(t.startsWith(e)){let n=t.substring(e.length),i=n.indexOf("/");return i>0?n.substring(0,i):void 0}if(t.startsWith(this.settings.libraryFolder))return"Library";if(t.startsWith(this.settings.inboxFolder))return"Inbox"}async getNoteDate(t){let e=this.app.metadataCache.getFileCache(t),n=e==null?void 0:e.frontmatter;if(n!=null&&n.created){let i=new Date(n.created);if(!isNaN(i.getTime()))return i}return new Date(t.stat.mtime)}async extractNoteInfo(t,e,n){let i=this.app.metadataCache.getFileCache(t),o=i==null?void 0:i.frontmatter,r=[];return o!=null&&o.tags&&(Array.isArray(o.tags)?r.push(...o.tags):r.push(o.tags)),{path:t.path,title:(o==null?void 0:o.title)||t.basename,project:e,created:n,modified:new Date(t.stat.mtime),summary:o==null?void 0:o.summary,tags:r,type:o==null?void 0:o.type}}groupByProject(t){let e=new Map;for(let i of t){let o=i.project||"\uAE30\uD0C0";e.has(o)||e.set(o,[]),e.get(o).push(i)}let n=[];for(let[i,o]of e)n.push({projectName:i,notes:o,noteCount:o.length});return n.sort((i,o)=>o.noteCount-i.noteCount),n}async analyze(t){let e=t.customRange||qa(t.period,this.settings.timezone),n=await this.collectNotes(t),i=this.groupByProject(n),o=n.filter(a=>a.type==="zettel").length,r=await this.gemini.analyzeReview(t.period,e,i);return{period:t.period,dateRange:e,totalNotes:n.length,newZKNotes:o,projectGroups:i,analysis:r}}async createReviewNote(t){let e=r_(t.period,new Date,this.settings.timezone),n=`${this.settings.archivesFolder}/Reviews`;await this.ensureFolder(n);let i=`${n}/${e}`,o=this.generateReviewContent(t),r=this.app.vault.getAbstractFileByPath(i);return r instanceof Ba.TFile?(await this.app.vault.modify(r,o),r):await this.app.vault.create(i,o)}async ensureFolder(t){this.app.vault.getAbstractFileByPath(t)instanceof Ba.TFolder||await this.app.vault.createFolder(t)}generateReviewContent(t){let e=new Date,n=tg(e,this.settings.timezone,this.settings.dateFormat),i=`${Ve(t.dateRange.start,this.settings.timezone)} ~ ${Ve(t.dateRange.end,this.settings.timezone)}`,o;switch(t.period){case"today":o=`${Ve(e,this.settings.timezone)} \uC77C\uC77C \uD68C\uACE0`;break;case"week":let l=ig(e);o=`${e.getFullYear()}\uB144 ${l}\uC8FC\uCC28 \uC8FC\uAC04 \uD68C\uACE0`;break;case"month":o=`${e.getFullYear()}\uB144 ${e.getMonth()+1}\uC6D4 \uC6D4\uAC04 \uD68C\uACE0`;break;default:o=`${i} \uD68C\uACE0`}let r=t.projectGroups.map(l=>{let c=l.notes.map(d=>`- [[${this.getBasename(d.path)}]]${d.summary?` - ${d.summary}`:""}`).join(`
`);return`### ${l.projectName} (${l.noteCount}\uAC1C)
${c}`}).join(`

`),a="";if(t.analysis){let{summary:l,mainTopics:c,insights:d,nextActions:p,patterns:g}=t.analysis;a=`
## \uBD84\uC11D \uACB0\uACFC

### \uC694\uC57D
${l}

### \uC8FC\uC694 \uC8FC\uC81C
${c.map(m=>`- ${m}`).join(`
`)}

### \uC778\uC0AC\uC774\uD2B8
${d.map(m=>`- ${m}`).join(`
`)}

### \uB2E4\uC74C \uC561\uC158
${p.map(m=>`- [ ] ${m}`).join(`
`)}
${g?`
### \uC791\uC5C5 \uD328\uD134
${g}`:""}`}return`---
type: review
period: ${t.period}
date_range: ${i}
created: ${n}
tags: [review, ${t.period==="today"?"daily":t.period==="week"?"weekly":"monthly"}]
---

# ${o}

## \uD1B5\uACC4
- \uC791\uC5C5\uD55C \uB178\uD2B8: ${t.totalNotes}\uAC1C
- \uC0C8 ZK \uB178\uD2B8: ${t.newZKNotes}\uAC1C
- \uD65C\uC131 \uD504\uB85C\uC81D\uD2B8: ${t.projectGroups.filter(l=>l.projectName!=="\uAE30\uD0C0"&&l.projectName!=="Library"&&l.projectName!=="Inbox").length}\uAC1C

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5

${r}
${a}
`}getProjectList(){let t=new Set,e=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(e instanceof Ba.TFolder)for(let n of e.children)n instanceof Ba.TFolder&&t.add(n.name);return Array.from(t).sort()}};var Yp=class{constructor(t,e){this.gemini=t,this.settings=e}extractVideoId(t){let e=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/)([a-zA-Z0-9_-]{11})/,/^([a-zA-Z0-9_-]{11})$/];for(let n of e){let i=t.match(n);if(i)return i[1]}return null}isValidYouTubeUrl(t){return this.extractVideoId(t)!==null}async processVideo(t){let e=this.extractVideoId(t);if(!e)throw new Error("\uC720\uD6A8\uD55C YouTube URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let n=`https://www.youtube.com/watch?v=${e}`;console.log("Gemini \uB124\uC774\uD2F0\uBE0C YouTube \uBD84\uC11D \uC2DC\uC791:",n);let i=await this.gemini.analyzeYouTube(n);return{videoId:e,url:n,title:i.title,summary:i.summary,keyPoints:i.keyPoints}}generateMarkdownNote(t){let e=Dt(this.settings.timezone,this.settings.dateFormat),n=`https://www.youtube.com/embed/${t.videoId}`;return`---
type: youtube
source: "${t.url}"
title: "${t.title.replace(/"/g,'\\"')}"
created: ${e}
---

# ${t.title}

<div style="resize: both; overflow: hidden; width: 100%; height: 400px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${n}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none;" allowfullscreen></iframe>
</div>

## \uC694\uC57D
${t.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${t.keyPoints.map(i=>`- ${i}`).join(`
`)}
`}};var qu=require("obsidian");var Jp=class{constructor(t,e){this.gemini=t,this.settings=e}isValidUrl(t){try{let e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch(e){return!1}}extractMetadata(t,e){let n=l=>{let c=[new RegExp(`<meta[^>]*property=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*property=["']${l}["']`,"i"),new RegExp(`<meta[^>]*name=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*name=["']${l}["']`,"i")];for(let d of c){let p=t.match(d);if(p)return p[1]}return""},i=t.match(/<title[^>]*>([^<]+)<\/title>/i),o=t.match(/<link[^>]*rel=["'](?:shortcut )?icon["'][^>]*href=["']([^"']+)["']/i),r=new URL(e),a=l=>l?l.startsWith("http")?l:l.startsWith("//")?r.protocol+l:l.startsWith("/")?r.origin+l:r.origin+"/"+l:"";return{title:n("og:title")||n("twitter:title")||(i==null?void 0:i[1])||"",description:n("og:description")||n("twitter:description")||n("description")||"",image:a(n("og:image")||n("twitter:image")||""),siteName:n("og:site_name")||r.hostname,favicon:a((o==null?void 0:o[1])||"/favicon.ico")}}extractContent(t){let e=t.match(/<title[^>]*>([^<]+)<\/title>/i),n=t.match(/<meta[^>]*property=["']og:title["'][^>]*content=["']([^"']+)["']/i),i=(n==null?void 0:n[1])||(e==null?void 0:e[1])||"Untitled",o=t.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<nav[^>]*>[\s\S]*?<\/nav>/gi,"").replace(/<header[^>]*>[\s\S]*?<\/header>/gi,"").replace(/<footer[^>]*>[\s\S]*?<\/footer>/gi,"").replace(/<aside[^>]*>[\s\S]*?<\/aside>/gi,""),r="",a=o.match(/<article[^>]*>([\s\S]*?)<\/article>/i),l=o.match(/<main[^>]*>([\s\S]*?)<\/main>/i),c=o.match(/<div[^>]*(?:class|id)=["'][^"']*content[^"']*["'][^>]*>([\s\S]*?)<\/div>/i);if(a)r=a[1];else if(l)r=l[1];else if(c)r=c[1];else{let p=o.match(/<body[^>]*>([\s\S]*?)<\/body>/i);r=(p==null?void 0:p[1])||o}return r=r.replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&[a-z]+;/gi," ").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim(),{title:i.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim(),content:r}}async fetchWithJinaReader(t){var c,d;let e=`https://r.jina.ai/${t}`,i=(await(0,qu.requestUrl)({url:e,method:"GET",headers:{Accept:"text/plain","X-Timeout":"30","X-Wait-For-Selector":"article, .post-content, .se-main-container, #postViewArea"}})).text;i.includes("Warning: This page maybe not yet fully loaded")&&console.log("Jina Reader: \uD398\uC774\uC9C0 \uB85C\uB529 \uACBD\uACE0 \uAC10\uC9C0");let o=i.split(`
`),r="Untitled",a=0;for((c=o[0])!=null&&c.startsWith("# ")?(r=o[0].substring(2).trim(),a=1):(d=o[0])!=null&&d.startsWith("Title: ")&&(r=o[0].substring(7).trim(),a=1);a<o.length;){let p=o[a];if(p!=null&&p.startsWith("URL Source:")||p!=null&&p.startsWith("http")||p!=null&&p.startsWith("Warning:")||p!=null&&p.startsWith("Markdown Content:")||(p==null?void 0:p.trim())==="")a++;else break}let l=o.slice(a).join(`
`).trim();if(l.length<100&&!l.includes(`
`))throw new Error("\uD398\uC774\uC9C0 \uCF58\uD150\uCE20\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4 (JavaScript \uB85C\uB529 \uB300\uAE30 \uC2E4\uD328)");return{title:r,content:l}}async fetchNaverBlog(t){var p;let e=t;if(t.includes("blog.naver.com")){let g=t.match(/blog\.naver\.com\/([^\/]+)\/(\d+)/);g&&(e=`https://m.blog.naver.com/${g[1]}/${g[2]}`)}let i=(await(0,qu.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15",Accept:"text/html,application/xhtml+xml","Accept-Language":"ko-KR,ko;q=0.9"}})).text,o=i.match(/<title[^>]*>([^<]+)<\/title>/i),r=((p=o==null?void 0:o[1])==null?void 0:p.replace(/ :  $/,"").trim())||"Untitled",a="",l=i.match(/<div[^>]*class="[^"]*se-main-container[^"]*"[^>]*>([\s\S]*?)<\/div>\s*<\/div>\s*<\/div>/i),c=i.match(/<div[^>]*id="postViewArea"[^>]*>([\s\S]*?)<\/div>/i),d=(l==null?void 0:l[1])||(c==null?void 0:c[1])||"";return d&&(a=d.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim()),{title:r,content:a}}async processUrl(t){if(!this.isValidUrl(t))throw new Error("\uC720\uD6A8\uD55C URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let e;try{let o=(await(0,qu.requestUrl)({url:t,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text;e=this.extractMetadata(o,t)}catch(i){console.log("\uBA54\uD0C0\uB370\uC774\uD130 \uCD94\uCD9C \uC2E4\uD328:",i)}if(t.includes("blog.naver.com"))return console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, Jina Reader \uC0AC\uC6A9"),await this.processUrlFallback(t,e);try{console.log("URL Context Tool\uB85C \uC6F9\uD398\uC774\uC9C0 \uBD84\uC11D \uC2DC\uB3C4");let i=await this.gemini.analyzeWebpage(t),o=["unable to access","cannot access","could not access","\uC811\uADFC\uD560 \uC218 \uC5C6","\uAC00\uC838\uC62C \uC218 \uC5C6"],r=i.summary.toLowerCase();return o.some(l=>r.includes(l.toLowerCase()))?(console.log("URL Context Tool \uC811\uADFC \uC2E4\uD328 \uAC10\uC9C0, \uD3F4\uBC31 \uC2DC\uB3C4"),await this.processUrlFallback(t,e)):(e&&(e.title=e.title||i.title),{url:t,title:i.title,content:"",summary:i.summary,keyPoints:i.keyPoints,metadata:e})}catch(i){console.log("URL Context Tool \uC2E4\uD328, \uD3F4\uBC31 \uC2DC\uB3C4:",i)}return await this.processUrlFallback(t,e)}async processUrlFallback(t,e){let n,i,o=null;if(!e)try{o=(await(0,qu.requestUrl)({url:t,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text,e=this.extractMetadata(o,t)}catch(d){console.log("HTML \uAC00\uC838\uC624\uAE30 \uC2E4\uD328:",d)}if(t.includes("blog.naver.com")){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, \uC804\uC6A9 \uCD94\uCD9C \uC2DC\uB3C4");try{let d=await this.fetchNaverBlog(t);if(n=d.title,i=d.content,i.length<100)throw new Error("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uCD94\uCD9C \uC2E4\uD328")}catch(d){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uC804\uC6A9 \uCD94\uCD9C \uC2E4\uD328, Jina Reader \uC2DC\uB3C4:",d);let p=await this.fetchWithJinaReader(t);n=p.title,i=p.content}}else try{console.log("Jina Reader\uB85C \uCF58\uD150\uCE20 \uCD94\uCD9C \uC2DC\uB3C4");let d=await this.fetchWithJinaReader(t);n=d.title,i=d.content}catch(d){if(console.log("Jina Reader \uC2E4\uD328, \uC9C1\uC811 \uCD94\uCD9C\uB85C \uD3F4\uBC31:",d),o){let p=this.extractContent(o);n=p.title,i=p.content}else throw new Error("\uC6F9\uD398\uC774\uC9C0\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4")}if(i.length<50)throw new Error("\uBCF8\uBB38\uC744 \uCD94\uCD9C\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC811\uADFC\uC774 \uC81C\uD55C\uB41C \uD398\uC774\uC9C0\uC77C \uC218 \uC788\uC2B5\uB2C8\uB2E4.");let a=5e4,l=i.length>a?i.slice(0,a)+"...":i,c=await this.gemini.summarizeContent(l,"webpage");return e&&(e.title=e.title||n),{url:t,title:c.title||n,content:l,summary:c.summary,keyPoints:c.keyPoints,metadata:e}}generateMarkdownNote(t){let e=Dt(this.settings.timezone,this.settings.dateFormat),n=t.metadata,i=t.url;t.url.includes("blog.naver.com")&&!t.url.includes("m.blog.naver.com")&&(i=t.url.replace("blog.naver.com","m.blog.naver.com"));let o="";if(n){let r=n.image?`
> ![](${n.image})
>`:"",a=n.description?`
> ${n.description}
>`:"";o=`
> [!bookmark] ${n.siteName||new URL(t.url).hostname}
> **${n.title||t.title}**
>${a}${r}
> \u{1F517} ${t.url}

`}else o=`
> [!bookmark] \uC6F9\uD398\uC774\uC9C0
> **${t.title}**
>
> \u{1F517} ${t.url}

`;return`---
type: webpage
source: "${t.url}"
title: "${t.title.replace(/"/g,'\\"')}"
created: ${e}
---

# ${t.title}
${o}
<div style="resize: both; overflow: hidden; width: 100%; height: 600px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${i}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none; color-scheme: light;"></iframe>
</div>

## \uC694\uC57D
${t.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${t.keyPoints.map(r=>`- ${r}`).join(`
`)}
`}};function Xp(s,t=100){return s.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,t)}var Zp=class extends P.Plugin{constructor(){super(...arguments);this.gemini=null;this.ocrProcessor=null;this.relatedNoteFinder=null;this.mocManager=null;this.zkIndexManager=null;this.youtubeExtractor=null;this.webPageExtractor=null;this.reviewManager=null;this.watcherRegistered=!1;this.pendingFiles=new Map;this.zkDailyCounter=new Map;this.zkLuhmannCounter=0}async onload(){await this.loadSettings(),this.addSettingTab(new Yu(this.app,this)),this.processDebounced=(0,P.debounce)(()=>this.processPendingFiles(),3e3,!0),this.registerCommands(),this.settings.autoWatch&&this.startWatcher(),this.app.workspace.onLayoutReady(()=>{this.initGemini()}),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uB85C\uB4DC\uB428")}onunload(){this.stopWatcher(),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uC5B8\uB85C\uB4DC\uB428")}async loadSettings(){this.settings=Object.assign({},t_,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.initGemini()}async initGemini(){this.settings.geminiApiKey?(this.gemini=new Ld(this.settings.geminiApiKey),this.ocrProcessor=new Vp(this.gemini,this.settings,this.app.vault),this.relatedNoteFinder=new qp(this.app,this.gemini),this.mocManager=new zp(this.app,this.gemini,this.settings.projectsFolder,this.settings),this.zkIndexManager=new Wp(this.app,this.relatedNoteFinder,this.settings.zettelFolder,this.settings,this.gemini),this.youtubeExtractor=new Yp(this.gemini,this.settings),this.webPageExtractor=new Jp(this.gemini,this.settings),this.reviewManager=new Kp(this.app,this.gemini,this.settings),Promise.all([this.relatedNoteFinder.buildIndex(),this.mocManager.scanProjectMOCs()]).then(()=>{var e,n,i;console.log(`\uB178\uD2B8 \uC778\uB371\uC2A4: ${(e=this.relatedNoteFinder)==null?void 0:e.getIndexSize()}\uAC1C, MOC: ${(n=this.mocManager)==null?void 0:n.getMOCCount()}\uAC1C, ZK: ${(i=this.relatedNoteFinder)==null?void 0:i.getZettelCount()}\uAC1C`),this.initializeZKCounters()})):(this.gemini=null,this.ocrProcessor=null,this.relatedNoteFinder=null,this.mocManager=null,this.youtubeExtractor=null,this.webPageExtractor=null,this.reviewManager=null)}checkApiKey(){return this.gemini?!0:(new P.Notice("Gemini API \uD0A4\uB97C \uC124\uC815\uD574\uC8FC\uC138\uC694"),!1)}truncateContent(e,n=5e5){let i=e.replace(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g,"[\uC774\uBBF8\uC9C0]");return i=i.replace(/!\[[^\]]*\]\(data:[^)]+\)/g,"[\uC774\uBBF8\uC9C0]"),i.length<=n?i:i.slice(0,n)+`

[... \uB0B4\uC6A9\uC774 \uB108\uBB34 \uAE38\uC5B4 \uC77C\uBD80\uB9CC \uBD84\uC11D\uB428 ...]`}registerCommands(){this.addCommand({id:"project-classify",name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkeys:[{modifiers:["Ctrl","Shift"],key:"g"}],callback:()=>this.classifyCurrentFile()}),this.addCommand({id:"zk-extract",name:"ZK \uCD94\uCD9C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"z"}],callback:()=>this.extractZKFromCurrentFile()}),this.addCommand({id:"focus-top3",name:"Focus Top 3",hotkeys:[{modifiers:["Ctrl","Shift"],key:";"}],callback:()=>this.showFocusTop3()}),this.addCommand({id:"process-inbox",name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",callback:()=>this.processInbox()}),this.addCommand({id:"toggle-watch",name:"Watch \uD1A0\uAE00",callback:()=>this.toggleWatch()}),this.addCommand({id:"ocr-extract",name:"OCR \uCD94\uCD9C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"o"}],callback:()=>this.ocrCurrentFile()}),this.addCommand({id:"ocr-inbox",name:"Inbox OCR \uCC98\uB9AC",callback:()=>this.processInboxOCR()}),this.addCommand({id:"smart-process",name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkeys:[{modifiers:["Ctrl","Shift"],key:"s"}],callback:()=>this.smartProcessCurrentFile()}),this.addCommand({id:"create-moc",name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",callback:()=>this.showCreateMOCModal()}),this.addCommand({id:"url-import",name:"URL \uAC00\uC838\uC624\uAE30",hotkeys:[{modifiers:["Ctrl","Shift"],key:"u"}],callback:()=>this.showURLImportModal()}),this.addCommand({id:"rebuild-zk-index",name:"ZK Index \uC7AC\uAD6C\uCD95",callback:()=>this.rebuildZKIndex()}),this.addCommand({id:"smart-split",name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkeys:[{modifiers:["Ctrl","Shift"],key:"d"}],callback:()=>this.smartSplitCurrentFile()}),this.addCommand({id:"link-related-notes",name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkeys:[{modifiers:["Ctrl","Shift"],key:"l"}],callback:()=>this.linkRelatedNotesForCurrentFile()}),this.addCommand({id:"review-mode",name:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC",hotkeys:[{modifiers:["Ctrl","Shift"],key:"r"}],callback:()=>this.showReviewModal()}),this.addCommand({id:"show-command-list",name:"\uBA85\uB839 \uB9AC\uC2A4\uD2B8",callback:()=>this.showCommandListModal()}),this.addRibbonIcon("brain","Zero Friction Brain",()=>{this.showCommandListModal()})}showReviewModal(){if(this.checkApiKey()){if(!this.reviewManager){new P.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new Qv(this.app,this.reviewManager,this.settings).open()}}async rebuildZKIndex(){var e;if(!this.zkIndexManager){new P.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new P.Notice("ZK Index \uC7AC\uAD6C\uCD95 \uC911...");try{await this.zkIndexManager.rebuildIndex();let n=((e=this.relatedNoteFinder)==null?void 0:e.getZettelCount())||0;new P.Notice(`ZK Index \uC7AC\uAD6C\uCD95 \uC644\uB8CC: ${n}\uAC1C \uB178\uD2B8`)}catch(n){console.error("ZK Index \uC7AC\uAD6C\uCD95 \uC2E4\uD328:",n),new P.Notice(`\uC7AC\uAD6C\uCD95 \uC2E4\uD328: ${n}`)}}async smartSplitCurrentFile(){var n;if(!this.checkApiKey())return;let e=this.app.workspace.getActiveFile();if(!e){new P.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(e.extension!=="md"){new P.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uBD84\uB9AC\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4");return}new P.Notice("\uBA54\uBAA8 \uBD84\uC11D \uC911...");try{let i=await this.app.vault.read(e),o=((n=this.mocManager)==null?void 0:n.getProjectList())||[],r=await this.gemini.splitContent(i,o);if(r.length===0){new P.Notice("\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(r.length===1){new P.Notice("\uB2E8\uC77C \uC8FC\uC81C\uB85C \uD310\uB2E8\uB428. \uC77C\uBC18 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958\uB97C \uC0AC\uC6A9\uD558\uC138\uC694.");return}new Jv(this.app,r,e,this).open()}catch(i){console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC2E4\uD328:",i),new P.Notice(`\uBD84\uB9AC \uC2E4\uD328: ${i}`)}}async createSplitNotes(e,n){let i=[];for(let r of e){let a=this.getTargetFolder(r.targetType,r.project);if(r.project&&!r.project.startsWith("NEW:")){let g=`${this.settings.projectsFolder}/${r.project}`;this.app.vault.getAbstractFileByPath(g)instanceof P.TFolder&&(a=g)}let l=Xp(r.title),c=`${a}/${l}.md`,d=`---
targetType: ${r.targetType}
keywords: [${r.keywords.join(", ")}]
source: "[[${n.basename}]]"
created: ${Dt(this.settings.timezone,this.settings.dateFormat)}
${r.project?`project: "${r.project}"`:""}
---

# ${r.title}

${r.content}
`;this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a);try{let g=await this.app.vault.create(c,d);if(i.push(r.title),this.relatedNoteFinder&&await this.relatedNoteFinder.updateIndex(g),r.project&&this.mocManager)if(r.project.startsWith("NEW:")){let m=r.project.slice(4).trim();await this.mocManager.createProjectMOC(m,this.settings.projectsFolder)&&await this.mocManager.addNoteToMOC(m,r.title,g.path)}else await this.mocManager.addNoteToMOC(r.project,r.title,g.path)}catch(g){console.error(`\uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328: ${r.title}`,g)}}let o=`${this.settings.archivesFolder}/${n.name}`;try{this.app.vault.getAbstractFileByPath(this.settings.archivesFolder)||await this.app.vault.createFolder(this.settings.archivesFolder),await this.app.fileManager.renameFile(n,o)}catch(r){console.error("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uC2E4\uD328:",r)}new P.Notice(`${i.length}\uAC1C \uB178\uD2B8 \uC0DD\uC131\uB428, \uC6D0\uBCF8\uC740 Archives\uB85C \uC774\uB3D9`)}showCreateMOCModal(){new Kv(this.app,this.mocManager,this.settings.projectsFolder).open()}showURLImportModal(){this.checkApiKey()&&new Yv(this.app,"URL \uAC00\uC838\uC624\uAE30","\uC720\uD29C\uBE0C \uB610\uB294 \uC6F9\uD398\uC774\uC9C0 URL\uC744 \uC785\uB825\uD558\uC138\uC694 (\uC790\uB3D9 \uAC10\uC9C0)","https://...",async e=>{await this.processURL(e)}).open()}async processURL(e){/(?:youtube\.com|youtu\.be)/.test(e)?await this.processYouTube(e):await this.processWebPage(e)}async processYouTube(e){var n;if(!(!this.youtubeExtractor||!this.gemini)){new P.Notice("\uC720\uD29C\uBE0C \uC601\uC0C1 \uBD84\uC11D \uC911...");try{let i=await this.youtubeExtractor.processVideo(e),o=this.youtubeExtractor.generateMarkdownNote(i),r=Xp(i.title),a=`${r}.md`,l=`${this.settings.inboxFolder}/${a}`,c=await this.app.vault.create(l,o);new P.Notice(`\uC720\uD29C\uBE0C \uB178\uD2B8 \uC0DD\uC131: ${r}`);let d=((n=this.mocManager)==null?void 0:n.getProjectList())||[],p=await this.gemini.classifyProject(o,d);c=await this.applyClassifyResultWithConfirmation(c,p),new P.Notice(`${p.targetType}${p.projectName?` (${p.projectName})`:""}\uB85C \uBD84\uB958\uB428`),this.app.workspace.getLeaf().openFile(c),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(c,o,p.title)}catch(i){console.error("\uC720\uD29C\uBE0C \uCC98\uB9AC \uC624\uB958:",i),new P.Notice(`\uC720\uD29C\uBE0C \uCC98\uB9AC \uC2E4\uD328: ${i}`)}}}async processWebPage(e){var n;if(!(!this.webPageExtractor||!this.gemini)){new P.Notice("\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38 \uCD94\uCD9C \uC911...");try{let i=await this.webPageExtractor.processUrl(e),o=this.webPageExtractor.generateMarkdownNote(i),r=Xp(i.title),a=`${r}.md`,l=`${this.settings.inboxFolder}/${a}`,c=await this.app.vault.create(l,o);new P.Notice(`\uC6F9\uD398\uC774\uC9C0 \uB178\uD2B8 \uC0DD\uC131: ${r}`);let d=((n=this.mocManager)==null?void 0:n.getProjectList())||[],p=await this.gemini.classifyProject(o,d);c=await this.applyClassifyResultWithConfirmation(c,p),new P.Notice(`${p.targetType}${p.projectName?` (${p.projectName})`:""}\uB85C \uBD84\uB958\uB428`),this.app.workspace.getLeaf().openFile(c),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(c,o,p.title)}catch(i){console.error("\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC624\uB958:",i),new P.Notice(`\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC2E4\uD328: ${i}`)}}}async classifyCurrentFile(){var o,r;if(!this.checkApiKey())return;let e=this.app.workspace.getActiveFile();if(!e){new P.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=e.extension.toLowerCase();if(["pdf","png","jpg","jpeg","webp","gif"].includes(n)){if(!this.settings.ocrEnabled){new P.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new P.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let a=await this.ocrProcessor.checkLimits(e);if(!a.allowed){new zu(this.app,a.reason,e,this).open();return}new P.Notice("\uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let l=await this.ocrProcessor.processFile(e);new P.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let c=await this.gemini.summarizePDF(l.text),d=this.ocrProcessor.generateSummarizedNote(l,c),p=e.basename+"_OCR.md",g=`${this.settings.inboxFolder}/${p}`,m=await this.app.vault.create(g,d);if(this.settings.ocrMoveOriginal){let E=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(E)||await this.app.vault.createFolder(E);let S=`${E}/${e.name}`;await this.app.fileManager.renameFile(e,S)}let v=((o=this.mocManager)==null?void 0:o.getProjectList())||[],A=await this.gemini.classifyProject(d,v),T=await this.applyClassifyResultWithConfirmation(m,A);new P.Notice(`\uC644\uB8CC: OCR(${l.pages}p) \u2192 ${A.targetType}${A.projectName?` (${A.projectName})`:""}`),await this.findAndShowRelatedNotes(T,d,A.title)}catch(l){console.error("\uCC98\uB9AC \uC624\uB958:",l),new P.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${l}`)}return}if(n==="md"){new P.Notice("\uBD84\uB958 \uC911...");try{let a=await this.app.vault.read(e),l=this.truncateContent(a),c=((r=this.mocManager)==null?void 0:r.getProjectList())||[],d=await this.gemini.classifyProject(l,c),p=await this.applyClassifyResultWithConfirmation(e,d);new P.Notice(`${d.targetType}${d.projectName?` (${d.projectName})`:""}\uB85C \uBD84\uB958\uB428`),await this.findAndShowRelatedNotes(p,a,d.title)}catch(a){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",a),new P.Notice(`\uBD84\uB958 \uC2E4\uD328: ${a}`)}return}new P.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}async linkRelatedNotesForCurrentFile(){if(!this.checkApiKey())return;let e=this.app.workspace.getActiveFile();if(!e){new P.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(e.extension!=="md"){new P.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uC9C0\uC6D0\uD569\uB2C8\uB2E4");return}new P.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");try{let n=await this.app.vault.read(e),i=this.truncateContent(n),o=n.match(/^#\s+(.+)$/m),r=(o==null?void 0:o[1])||e.basename;await this.findAndShowRelatedNotes(e,i,r)}catch(n){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",n),new P.Notice(`\uAC80\uC0C9 \uC2E4\uD328: ${n}`)}}showCommandListModal(){new Zv(this.app,this).open()}async applyClassifyResult(e,n){let i=await this.app.vault.read(e),o=this.updateFrontmatter(i,{targetType:n.targetType,project:n.projectName||void 0,title:n.title,summary:n.summary,next_action:n.nextAction||void 0,processed_at:Dt(this.settings.timezone,this.settings.dateFormat)});await this.app.vault.modify(e,o);let r=this.getTargetFolder(n.targetType,n.projectName);if(r){this.app.vault.getAbstractFileByPath(r)||await this.app.vault.createFolder(r);let l=`${r}/${e.name}`;await this.app.fileManager.renameFile(e,l);let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof P.TFile)return c}return e}async applyClassifyResultWithConfirmation(e,n){return n.contentType!=="reference"||!n.projectName?this.applyClassifyResult(e,n):new Promise(i=>{new Xv(this.app,n,async o=>{let r={...n};o==="library"?(r={...n,targetType:"library"},new P.Notice(`Library\uC5D0 \uC800\uC7A5 + ${n.projectName} \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C`)):r={...n,targetType:"project"};let a=await this.applyClassifyResult(e,r);i(a)}).open()})}async findAndShowRelatedNotes(e,n,i){if(!this.relatedNoteFinder||!this.gemini)return;let o=this.truncateContent(n);try{let r=await this.gemini.extractKeywords(o);r.length>0&&this.relatedNoteFinder&&await this.relatedNoteFinder.saveKeywordsToNote(e,r),this.mocManager&&this.mocManager.getMOCCount()>0&&await this.handleProjectMOC(e,i,r),new P.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");let a=await this.relatedNoteFinder.findRelated(o,i,e.path);a.length>0?new zv(this.app,a,e,this.relatedNoteFinder).open():r.length>0&&new P.Notice(`\uD0A4\uC6CC\uB4DC ${r.length}\uAC1C \uC800\uC7A5\uB428`)}catch(r){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",r)}}async handleProjectMOC(e,n,i){if(!(!this.mocManager||!this.gemini))try{let o=await this.mocManager.detectProject(n,i);if(!o)return;if(o.startsWith("NEW:")){let a=o.slice(4).trim();new Wv(this.app,a,e,n,this.mocManager,this.settings.projectsFolder).open();return}await this.mocManager.addNoteToMOC(o,n,e.path)&&new P.Notice(`\u{1F4C1} ${o} MOC\uC5D0 \uC5F0\uACB0\uB428`)}catch(o){console.error("MOC \uC5F0\uACB0 \uC624\uB958:",o)}}getTargetFolder(e,n){switch(e){case"project":return n?`${this.settings.projectsFolder}/${n}`:this.settings.projectsFolder;case"library":return this.settings.libraryFolder;case"archive":return this.settings.archivesFolder;default:return this.settings.libraryFolder}}updateFrontmatter(e,n){let i=/^---\n([\s\S]*?)\n---\n?/,o=e.match(i),r="",a=e;o&&(r=o[1],a=e.slice(o[0].length));let l=r.split(`
`).filter(p=>p.trim()),c=new Map;for(let p of l){let g=p.indexOf(":");if(g!==-1){let m=p.slice(0,g).trim(),v=p.slice(g+1).trim();c.set(m,v)}}for(let[p,g]of Object.entries(n))if(g!==void 0){let v=/[:\[\]{}#&*!|>'"%@`]/.test(g)&&!g.startsWith('"')?`"${g.replace(/"/g,'\\"')}"`:g;c.set(p,v)}return`---
${Array.from(c.entries()).map(([p,g])=>`${p}: ${g}`).join(`
`)}
---
${a}`}async extractZKFromCurrentFile(){if(!this.checkApiKey())return;let e=this.app.workspace.getActiveFile();if(!e){new P.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new P.Notice("ZK \uC544\uC774\uB514\uC5B4 \uCD94\uCD9C \uC911...");try{let n=await this.app.vault.read(e),i=await this.gemini.extractZK(n);if(i.length===0){new P.Notice("\uCD94\uCD9C\uD560 \uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new Hv(this.app,i,e,this).open()}catch(n){console.error("ZK \uCD94\uCD9C \uC624\uB958:",n),new P.Notice(`\uCD94\uCD9C \uC2E4\uD328: ${n}`)}}initializeZKCounters(){if(!this.relatedNoteFinder)return;let e=this.relatedNoteFinder.getZettelIndex();for(let[n]of e){let o=(n.split("/").pop()||"").match(/^(\d{8})-(\d{3})/);if(o){let r=o[1],a=parseInt(o[2],10),l=this.zkDailyCounter.get(r)||0;a>l&&this.zkDailyCounter.set(r,a)}this.zkLuhmannCounter=Math.max(this.zkLuhmannCounter,e.size)}console.log(`ZK \uCE74\uC6B4\uD130 \uCD08\uAE30\uD654: \uB8E8\uB9CC=${this.zkLuhmannCounter}, \uC77C\uBCC4=${this.zkDailyCounter.size}\uAC1C \uB0A0\uC9DC`)}generateZKId(){switch(this.settings.zkIdType){case"timestamp":return Date.now().toString();case"date-sequence":{let n=Ho(this.settings.timezone).replace(/-/g,""),i=(this.zkDailyCounter.get(n)||0)+1;return this.zkDailyCounter.set(n,i),`${n}-${i.toString().padStart(3,"0")}`}case"luhmann":return this.zkLuhmannCounter++,this.toLuhmannId(this.zkLuhmannCounter);default:return Date.now().toString()}}toLuhmannId(e){if(e<=0)return"1";let n=[],i=e,o=0;for(;i>0;){if(o%2===0){let r=(i-1)%9+1;n.push(r.toString()),i=Math.floor((i-1)/9)}else{let r=(i-1)%26;n.push(String.fromCharCode(97+r)),i=Math.floor((i-1)/26)}o++}return n.reverse().join("")}async createZKNotes(e,n){var d;let i=this.settings.zettelFolder;this.app.vault.getAbstractFileByPath(i)||await this.app.vault.createFolder(i);let r=[],a=[],l=0;for(let p of e){let m=(await this.relatedNoteFinder.findRelatedZettels(p.keywords)).find(S=>S.relevance>=this.settings.zkMergeThreshold);if(m&&await this.showMergeConfirmModal(p,m)){await this.mergeToExistingZK(m.note.path,p,n),a.push(p.title);continue}let v=this.generateZKId(),A=Xp(p.title),T=`${i}/${v} ${A}.md`,E=`---
type: zettel
source: "[[${n.basename}]]"
keywords: [${p.keywords.join(", ")}]
created: ${Dt(this.settings.timezone,this.settings.dateFormat)}
---

# ${p.title}

## \uD575\uC2EC \uC544\uC774\uB514\uC5B4
${p.body}

## \uC65C \uC911\uC694\uD55C\uAC00?
${p.importance||""}

## \uB9E5\uB77D
- **\uC6D0\uBCF8**: [[${n.basename}]]
- **\uAD00\uB828 \uAC1C\uB150**: ${((d=p.relatedConcepts)==null?void 0:d.join(", "))||""}

---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
- [[${n.basename}]] (\uC6D0\uBCF8)
`;await this.app.vault.create(T,E),r.push(p.title);let C=this.app.vault.getAbstractFileByPath(T);if(C instanceof P.TFile){await this.relatedNoteFinder.updateIndex(C);let S=await this.relatedNoteFinder.findRelatedZettels(p.keywords,T);S.length>0&&(await this.addZKRelatedLinks(C,S),await this.addBacklinksToZettels(C,S),l+=S.length),this.zkIndexManager&&await this.zkIndexManager.updateIndex(C,p.keywords)}await new Promise(S=>setTimeout(S,10))}let c=[];r.length>0&&c.push(`${r.length}\uAC1C \uC0DD\uC131`),a.length>0&&c.push(`${a.length}\uAC1C \uBCD1\uD569`),l>0&&c.push(`${l}\uAC1C \uC5F0\uACB0`),new P.Notice(`ZK \uB178\uD2B8: ${c.join(", ")}`)}showMergeConfirmModal(e,n){return new Promise(i=>{new Vv(this.app,e,n,r=>i(r)).open()})}async mergeToExistingZK(e,n,i){let o=this.app.vault.getAbstractFileByPath(e);if(!(o instanceof P.TFile))return;let r=await this.app.vault.read(o),a=`

---
## \uCD94\uAC00\uB41C \uB0B4\uC6A9 (${new Date().toLocaleDateString()})
*\uC6D0\uBCF8: [[${i.basename}]]*

${n.body}
`,l=/(\n---\n##  )/,c;l.test(r)?c=r.replace(l,`${a}$1`):c=r+a;let d=this.extractKeywordsFromFrontmatter(r),p=[...new Set([...d,...n.keywords])];c=this.updateFrontmatterKeywordsInContent(c,p),await this.app.vault.modify(o,c),await this.relatedNoteFinder.updateIndex(o)}extractKeywordsFromFrontmatter(e){let n=e.match(/^---\n[\s\S]*?keywords:\s*\[(.*?)\][\s\S]*?---/);return n?n[1].split(",").map(i=>i.trim().replace(/^["']|["']$/g,"")).filter(i=>i.length>0):[]}updateFrontmatterKeywordsInContent(e,n){let i=`keywords: [${n.join(", ")}]`;return e.replace(/^(---\n[\s\S]*?)(keywords:\s*\[.*?\])([\s\S]*?---)/,`$1${i}$3`)}async addZKRelatedLinks(e,n){if(n.length===0)return;let i=await this.app.vault.read(e),o=n.map(c=>{let d=c.note.path.split("/"),g=d[d.length-1].replace(/\.md$/,""),m=c.reason?`
  \u2192 ${c.reason}`:"";return`- [[${g}]] (${Math.round(c.relevance*100)}%)${m}`}).join(`
`),r=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,a=i.match(r),l;a?l=i.replace(r,`$1
${o}$2`):l=i+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${o}
`,await this.app.vault.modify(e,l)}async addBacklinksToZettels(e,n){for(let i of n){let o=this.app.vault.getAbstractFileByPath(i.note.path);if(!(o instanceof P.TFile))continue;let r=await this.app.vault.read(o);if(r.includes(`[[${e.basename}]]`))continue;let a=i.reason?`
  \u2192 ${i.reason}`:"",l=`- [[${e.basename}]] (${Math.round(i.relevance*100)}%)${a}`,c=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,d=r.match(c),p;d?p=r.replace(c,`$1
${l}$2`):p=r+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${l}
`,await this.app.vault.modify(o,p)}}async showFocusTop3(){if(this.checkApiKey()){new P.Notice("\uD504\uB85C\uC81D\uD2B8 \uBD84\uC11D \uC911...");try{let e=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(!e||!(e instanceof P.TFolder)){new P.Notice("Projects \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=await this.collectProjectsSummary(e);if(!n){new P.Notice("\uC9C4\uD589 \uC911\uC778 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let i=await this.gemini.getFocus(n);if(i.length===0){new P.Notice("\uCD94\uCC9C\uD560 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new qv(this.app,i).open()}catch(e){console.error("Focus \uBD84\uC11D \uC624\uB958:",e),new P.Notice(`\uBD84\uC11D \uC2E4\uD328: ${e}`)}}}async collectProjectsSummary(e){let n=[];for(let i of e.children)if(i instanceof P.TFile&&i.extension==="md"){let o=await this.app.vault.read(i),r=this.extractFrontmatter(o),a=r.title||i.basename,l=r.summary||"",c=r.next_action||"";n.push(`- ${a}: ${l} (\uB2E4\uC74C: ${c})`)}return n.join(`
`)}extractFrontmatter(e){let n=/^---\n([\s\S]*?)\n---/,i=e.match(n);if(!i)return{};let o={},r=i[1].split(`
`);for(let a of r){let l=a.indexOf(":");if(l!==-1){let c=a.slice(0,l).trim(),d=a.slice(l+1).trim();o[c]=d}}return o}async processInbox(){var l;if(!this.checkApiKey())return;let e=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!e||!(e instanceof P.TFolder)){new P.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=0,i=0,o=this.settings.triggerTag,r=[];for(let c of e.children)c instanceof P.TFile&&c.extension==="md"&&(await this.app.vault.read(c)).includes(o)&&r.push(c);if(r.length===0){new P.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new P.Notice(`${r.length}\uAC1C \uD30C\uC77C \uCC98\uB9AC \uC2DC\uC791...`);let a=((l=this.mocManager)==null?void 0:l.getProjectList())||[];for(let c=0;c<r.length;c++){let d=r[c];try{new P.Notice(`\uCC98\uB9AC \uC911: ${c+1}/${r.length} - ${d.name}`,2e3);let p=await this.app.vault.read(d),g=await this.gemini.classifyProject(p,a);await this.applyClassifyResult(d,g),n++}catch(p){console.error(`\uCC98\uB9AC \uC2E4\uD328: ${d.name}`,p),i++}}new P.Notice(`\uC644\uB8CC: ${n}\uAC1C \uCC98\uB9AC, ${i}\uAC1C \uC2E4\uD328`)}toggleWatch(){this.watcherRegistered?(this.stopWatcher(),new P.Notice("Watch \uC911\uC9C0\uB428")):(this.startWatcher(),new P.Notice("Watch \uC2DC\uC791\uB428"))}startWatcher(){this.watcherRegistered||(this.registerEvent(this.app.vault.on("create",e=>{e instanceof P.TFile&&this.onFileChange(e)})),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof P.TFile&&this.onFileChange(e)})),this.registerEvent(this.app.vault.on("delete",e=>{var n,i;e instanceof P.TFile&&((n=this.relatedNoteFinder)==null||n.removeFromIndex(e.path),(i=this.mocManager)==null||i.removeFromIndex(e.path),console.log(`\uC778\uB371\uC2A4\uC5D0\uC11C \uC81C\uAC70: ${e.path}`))})),this.watcherRegistered=!0,console.log("Inbox \uAC10\uC2DC \uC2DC\uC791"))}stopWatcher(){this.watcherRegistered=!1,this.pendingFiles.clear(),console.log("Inbox \uAC10\uC2DC \uC911\uC9C0")}onFileChange(e){this.watcherRegistered&&this.gemini&&e.path.startsWith(this.settings.inboxFolder)&&e.extension==="md"&&(this.pendingFiles.set(e.path,Date.now()),this.processDebounced())}async processPendingFiles(){var o;if(!this.gemini)return;let e=Date.now(),n=this.settings.triggerTag,i=((o=this.mocManager)==null?void 0:o.getProjectList())||[];for(let[r,a]of this.pendingFiles.entries()){if(e-a<3e3)continue;this.pendingFiles.delete(r);let l=this.app.vault.getAbstractFileByPath(r);if(l instanceof P.TFile)try{let c=await this.app.vault.read(l);if(!c.includes(n))continue;let d=await this.gemini.classifyProject(c,i);await this.applyClassifyResult(l,d),new P.Notice(`\uC790\uB3D9 \uBD84\uB958: ${l.name} \u2192 ${d.targetType}${d.projectName?` (${d.projectName})`:""}`)}catch(c){console.error(`\uC790\uB3D9 \uBD84\uB958 \uC2E4\uD328: ${r}`,c)}}}async ocrCurrentFile(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new P.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new P.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let e=this.app.workspace.getActiveFile();if(!e){new P.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=e.extension.toLowerCase();if(!["png","jpg","jpeg","webp","gif","pdf"].includes(n)){new P.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`);return}let o=await this.ocrProcessor.checkLimits(e);if(!o.allowed){new zu(this.app,o.reason,e,this).open();return}new P.Notice("OCR \uCC98\uB9AC \uC911...");try{let r=await this.ocrProcessor.processFile(e),a=this.ocrProcessor.generateMarkdownNote(r),l=e.basename+"_OCR.md",c=`${this.settings.inboxFolder}/${l}`;if(await this.app.vault.create(c,a),this.settings.ocrMoveOriginal){let d=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(d)||await this.app.vault.createFolder(d);let g=`${d}/${e.name}`;await this.app.fileManager.renameFile(e,g)}new P.Notice(`OCR \uC644\uB8CC: ${l} \uC0DD\uC131\uB428 (${r.pages}\uD398\uC774\uC9C0)`)}catch(r){console.error("OCR \uC624\uB958:",r),new P.Notice(`OCR \uC2E4\uD328: ${r}`)}}async processInboxOCR(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new P.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new P.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let e=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!e||!(e instanceof P.TFolder)){new P.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=["png","jpg","jpeg","webp","gif","pdf"],i=[];for(let a of e.children){if(!(a instanceof P.TFile))continue;let l=a.extension.toLowerCase();if(!n.includes(l))continue;(await this.ocrProcessor.checkLimits(a)).allowed&&i.push(a)}if(i.length===0){new P.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new P.Notice(`${i.length}\uAC1C \uD30C\uC77C OCR \uCC98\uB9AC \uC2DC\uC791...`);let o=0,r=0;for(let a=0;a<i.length;a++){let l=i[a];try{new P.Notice(`OCR \uC911: ${a+1}/${i.length} - ${l.name}`,3e3);let c=await this.ocrProcessor.processFile(l),d=this.ocrProcessor.generateMarkdownNote(c),p=l.basename+"_OCR.md",g=`${this.settings.inboxFolder}/${p}`;if(await this.app.vault.create(g,d),this.settings.ocrMoveOriginal){let m=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(m)||await this.app.vault.createFolder(m);let A=`${m}/${l.name}`;await this.app.fileManager.renameFile(l,A)}o++,a<i.length-1&&await new Promise(m=>setTimeout(m,1e3))}catch(c){console.error(`OCR \uCC98\uB9AC \uC2E4\uD328: ${l.name}`,c),r++}}new P.Notice(`OCR \uC644\uB8CC: ${o}\uAC1C \uCC98\uB9AC, ${r}\uAC1C \uC2E4\uD328`)}async smartProcessCurrentFile(){var o,r;if(!this.checkApiKey())return;let e=this.app.workspace.getActiveFile();if(!e){new P.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=e.extension.toLowerCase();if(["pdf","png","jpg","jpeg","webp","gif"].includes(n)){if(!this.settings.ocrEnabled){new P.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new P.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let a=await this.ocrProcessor.checkLimits(e);if(!a.allowed){new zu(this.app,a.reason,e,this).open();return}new P.Notice("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let l=await this.ocrProcessor.processFile(e);new P.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let c=await this.gemini.summarizePDF(l.text),d=this.ocrProcessor.generateSummarizedNote(l,c),p=e.basename+"_OCR.md",g=`${this.settings.inboxFolder}/${p}`,m=await this.app.vault.create(g,d);if(this.settings.ocrMoveOriginal){let T=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(T)||await this.app.vault.createFolder(T);let C=`${T}/${e.name}`;await this.app.fileManager.renameFile(e,C)}let v=((o=this.mocManager)==null?void 0:o.getProjectList())||[],A=await this.gemini.classifyProject(d,v);await this.applyClassifyResultWithConfirmation(m,A),new P.Notice(`\uC644\uB8CC: OCR(${l.pages}p) \u2192 ${A.targetType}${A.projectName?` (${A.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(l){console.error("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC624\uB958:",l),new P.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${l}`)}}else if(n==="md"){new P.Notice("\uBD84\uB958 \uC911...");try{let a=await this.app.vault.read(e),l=((r=this.mocManager)==null?void 0:r.getProjectList())||[],c=await this.gemini.classifyProject(a,l);await this.applyClassifyResultWithConfirmation(e,c),new P.Notice(`${c.targetType}${c.projectName?` (${c.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(a){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",a),new P.Notice(`\uBD84\uB958 \uC2E4\uD328: ${a}`)}}else new P.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}getOCRDailyUsage(){return this.ocrProcessor?this.ocrProcessor.getDailyUsage():{date:Ho(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}},Hv=class extends P.Modal{constructor(t,e,n,i){super(t),this.candidates=e,this.selected=new Set(e.map((o,r)=>r)),this.sourceFile=n,this.plugin=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"ZK \uC544\uC774\uB514\uC5B4 \uC120\uD0DD"}),t.createEl("p",{text:"\uC0DD\uC131\uD560 Zettelkasten \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let e=t.createDiv({cls:"zk-candidate-list"});this.candidates.forEach((r,a)=>{let l=e.createDiv({cls:"zk-candidate-item"}),c=l.createEl("input",{type:"checkbox",attr:{checked:!0}});c.addEventListener("change",()=>{c.checked?this.selected.add(a):this.selected.delete(a)});let d=l.createDiv({cls:"zk-candidate-label"});d.createEl("strong",{text:r.title}),d.createEl("p",{text:r.body,cls:"zk-candidate-body"}),d.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${r.keywords.join(", ")}`,cls:"zk-candidate-keywords"})});let n=t.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{let r=this.candidates.filter((a,l)=>this.selected.has(l));r.length>0&&await this.plugin.createZKNotes(r,this.sourceFile),this.close()})}onClose(){this.contentEl.empty()}},Vv=class extends P.Modal{constructor(t,e,n,i){super(t),this.candidate=e,this.similarNote=n,this.onResult=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC720\uC0AC\uD55C \uB178\uD2B8 \uBC1C\uACAC"}),t.createEl("p",{text:`\uC0C8 \uC544\uC774\uB514\uC5B4\uC640 ${Math.round(this.similarNote.relevance*100)}% \uC720\uC0AC\uD55C \uB178\uD2B8\uAC00 \uC788\uC2B5\uB2C8\uB2E4.`,cls:"setting-item-description"});let e=t.createDiv({cls:"merge-section"});e.createEl("h4",{text:"\uC0C8 \uC544\uC774\uB514\uC5B4"}),e.createEl("p",{text:this.candidate.title,cls:"merge-title"}),e.createEl("p",{text:this.candidate.body,cls:"merge-body"});let n=t.createDiv({cls:"merge-section"});n.createEl("h4",{text:"\uAE30\uC874 \uB178\uD2B8"}),n.createEl("p",{text:this.similarNote.note.title,cls:"merge-title"}),n.createEl("p",{text:`\uD0A4\uC6CC\uB4DC: ${this.similarNote.note.keywords.join(", ")}`,cls:"merge-keywords"});let i=t.createDiv({cls:"merge-buttons"});i.createEl("button",{text:"\uAE30\uC874 \uB178\uD2B8\uC5D0 \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",()=>{this.onResult(!0),this.close()}),i.createEl("button",{text:"\uC0C8 \uB178\uD2B8 \uC0DD\uC131"}).addEventListener("click",()=>{this.onResult(!1),this.close()})}onClose(){this.contentEl.empty()}},qv=class extends P.Modal{constructor(t,e){super(t),this.items=e}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC624\uB298 \uC9D1\uC911\uD560 \uD504\uB85C\uC81D\uD2B8 Top 3"});let e=t.createDiv({cls:"focus-list"});this.items.forEach((o,r)=>{let a=e.createDiv({cls:"focus-item"});a.createEl("h3",{text:`${r+1}. ${o.title}`}),a.createEl("p",{text:o.why,cls:"focus-why"}),a.createEl("p",{text:`\u2192 ${o.nextAction}`,cls:"focus-action"})}),t.createDiv({cls:"modal-button-container"}).createEl("button",{text:"\uB2EB\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}},zu=class extends P.Modal{constructor(t,e,n,i){super(t),this.reason=e,this.file=n,this.plugin=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uD30C\uC77C\uC774 \uB108\uBB34 \uD07D\uB2C8\uB2E4"}),t.createEl("p",{text:this.reason}),t.createEl("p",{text:"\uC124\uC815\uC5D0\uC11C \uC81C\uD55C\uC744 \uC870\uC815\uD558\uAC70\uB098, \uD30C\uC77C\uC744 \uBD84\uD560\uD574\uC11C \uCC98\uB9AC\uD558\uC138\uC694.",cls:"setting-item-description"});let e=t.createDiv({cls:"modal-button-container"});e.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),e.createEl("button",{text:"\uC124\uC815 \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.app.setting.open()})}onClose(){this.contentEl.empty()}},zv=class extends P.Modal{constructor(t,e,n,i){super(t),this.relatedNotes=e,this.selected=new Set(e.map((o,r)=>r)),this.currentFile=n,this.finder=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uAD00\uB828 \uB178\uD2B8 \uBC1C\uACAC"}),t.createEl("p",{text:"\uC5F0\uACB0\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let e=t.createDiv({cls:"related-notes-list"});this.relatedNotes.forEach((r,a)=>{let l=e.createDiv({cls:"related-note-item"}),c=l.createEl("input",{type:"checkbox",attr:{checked:!0}});c.addEventListener("change",()=>{c.checked?this.selected.add(a):this.selected.delete(a)});let d=l.createDiv({cls:"related-note-label"});d.createEl("strong",{text:r.note.title});let p=Math.round(r.relevance*100);d.createEl("span",{text:` (${p}%)`,cls:"related-note-relevance"}),r.matchedKeywords.length>0&&d.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${r.matchedKeywords.join(", ")}`,cls:"related-note-keywords"})});let n=t.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uB9C1\uD06C \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",async()=>{let r=this.relatedNotes.filter((a,l)=>this.selected.has(l));r.length>0&&(await this.finder.addRelatedLinks(this.currentFile,r),new P.Notice(`${r.length}\uAC1C \uAD00\uB828 \uB178\uD2B8 \uB9C1\uD06C \uCD94\uAC00\uB428`)),this.close()})}onClose(){this.contentEl.empty()}},Wv=class extends P.Modal{constructor(t,e,n,i,o,r){super(t),this.projectName=e,this.noteFile=n,this.noteTitle=i,this.mocManager=o,this.projectsFolder=r}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 \uAC10\uC9C0"}),t.createEl("p",{text:`"${this.projectName}" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC0C8\uB85C \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`}),t.createEl("p",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8\uC758 MOC(Map of Content)\uB97C \uC0DD\uC131\uD560\uAE4C\uC694?",cls:"setting-item-description"});let e=t.createDiv({cls:"modal-button-container"});e.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>this.close()),e.createEl("button",{text:"MOC \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{await this.mocManager.createProjectMOC(this.projectName,this.projectsFolder)?(await this.mocManager.addNoteToMOC(this.projectName,this.noteTitle,this.noteFile.path),new P.Notice(`\u{1F4C1} ${this.projectName} MOC \uC0DD\uC131 \uBC0F \uC5F0\uACB0 \uC644\uB8CC`)):new P.Notice("MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4"),this.close()})}onClose(){this.contentEl.empty()}},Kv=class extends P.Modal{constructor(t,e,n){super(t),this.mocManager=e,this.projectsFolder=n}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131"}),t.createEl("p",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 MOC\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4. \uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694.",cls:"setting-item-description"});let e=t.createDiv({cls:"moc-input-container"});if(e.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uC774\uB984:"}),this.inputEl=e.createEl("input",{type:"text",placeholder:"\uC608: \uC2A4\uB9C8\uD2B8\uD31C"}),this.inputEl.style.width="100%",this.inputEl.style.marginTop="8px",this.inputEl.style.padding="8px",this.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&this.createMOC()}),this.mocManager&&this.mocManager.getMOCCount()>0){let r=t.createDiv({cls:"existing-mocs"});r.createEl("h4",{text:"\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 MOC:"});let a=r.createEl("ul");for(let l of this.mocManager.getProjectList())a.createEl("li",{text:l})}let n=t.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createMOC()),setTimeout(()=>this.inputEl.focus(),10)}async createMOC(){let t=this.inputEl.value.trim();if(!t){new P.Notice("\uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694");return}if(!this.mocManager){new P.Notice("MOC \uAD00\uB9AC\uC790\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4"),this.close();return}if(this.mocManager.getProjectList().includes(t)){new P.Notice(`"${t}" MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4`);return}let n=await this.mocManager.createProjectMOC(t,this.projectsFolder);n?(new P.Notice(`\u{1F4C1} ${t} MOC \uC0DD\uC131 \uC644\uB8CC`),this.app.workspace.getLeaf().openFile(n)):new P.Notice("MOC \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4"),this.close()}onClose(){this.contentEl.empty()}},Yv=class extends P.Modal{constructor(t,e,n,i,o){super(t),this.title=e,this.description=n,this.placeholder=i,this.onSubmit=o}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.title}),t.createEl("p",{text:this.description,cls:"setting-item-description"});let e=t.createDiv({cls:"url-input-container"});this.inputEl=e.createEl("input",{type:"text",placeholder:this.placeholder}),this.inputEl.style.width="100%",this.inputEl.style.padding="8px",navigator.clipboard.readText().then(r=>{r&&(r.startsWith("http://")||r.startsWith("https://"))&&(this.inputEl.value=r)}).catch(()=>{}),this.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&this.submit()});let n=t.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uAC00\uC838\uC624\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.submit()),setTimeout(()=>this.inputEl.focus(),10)}async submit(){let t=this.inputEl.value.trim();if(!t){new P.Notice("URL\uC744 \uC785\uB825\uD558\uC138\uC694");return}this.close(),await this.onSubmit(t)}onClose(){this.contentEl.empty()}},Jv=class extends P.Modal{constructor(t,e,n,i){super(t),this.sections=e,this.selected=new Set(e.map((o,r)=>r)),this.sourceFile=n,this.plugin=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uACB0\uACFC"}),t.createEl("p",{text:`${this.sections.length}\uAC1C\uC758 \uC139\uC158\uC73C\uB85C \uBD84\uB9AC\uB428. \uC0DD\uC131\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let e=t.createDiv({cls:"split-section-list"});this.sections.forEach((r,a)=>{let l=e.createDiv({cls:"split-section-item"});l.style.marginBottom="16px",l.style.padding="12px",l.style.border="1px solid var(--background-modifier-border)",l.style.borderRadius="8px";let c=l.createDiv({cls:"split-section-header"});c.style.display="flex",c.style.alignItems="center",c.style.gap="8px";let d=c.createEl("input",{type:"checkbox",attr:{checked:!0}});d.addEventListener("change",()=>{d.checked?this.selected.add(a):this.selected.delete(a)}),c.createEl("strong",{text:r.title});let p=c.createDiv({cls:"split-section-badges"});p.style.marginLeft="auto",p.style.display="flex",p.style.gap="4px";let g=p.createEl("span",{text:r.targetType,cls:"split-category-badge"});if(g.style.padding="2px 8px",g.style.borderRadius="4px",g.style.fontSize="12px",g.style.backgroundColor=this.getTargetTypeColor(r.targetType),g.style.color="white",r.project){let A=p.createEl("span",{text:r.project.startsWith("NEW:")?`\u2728 ${r.project.slice(4)}`:`\u{1F4C1} ${r.project}`,cls:"split-project-badge"});A.style.padding="2px 8px",A.style.borderRadius="4px",A.style.fontSize="12px",A.style.backgroundColor="var(--interactive-accent)",A.style.color="white"}let m=l.createDiv({cls:"split-section-preview"});m.style.marginTop="8px",m.style.fontSize="13px",m.style.color="var(--text-muted)",m.style.maxHeight="60px",m.style.overflow="hidden",m.style.textOverflow="ellipsis";let v=r.content.length>150?r.content.slice(0,150)+"...":r.content;if(m.setText(v),r.keywords.length>0){let A=l.createDiv({cls:"split-section-keywords"});A.style.marginTop="8px",A.style.fontSize="12px",A.setText(`\uD0A4\uC6CC\uB4DC: ${r.keywords.join(", ")}`)}});let n=t.createDiv({cls:"modal-button-container"});n.style.marginTop="16px",n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:`${this.selected.size}\uAC1C \uB178\uD2B8 \uC0DD\uC131`,cls:"mod-cta"}).addEventListener("click",async()=>{let r=this.sections.filter((a,l)=>this.selected.has(l));r.length>0&&(this.close(),await this.plugin.createSplitNotes(r,this.sourceFile))})}getTargetTypeColor(t){switch(t){case"project":return"#e67e22";case"library":return"#27ae60";case"archive":return"#95a5a6";default:return"#7f8c8d"}}onClose(){this.contentEl.empty()}},Xv=class extends P.Modal{constructor(t,e,n){super(t),this.result=e,this.onChoice=n}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC800\uC7A5 \uC704\uCE58 \uC120\uD0DD"});let e=t.createDiv({cls:"reference-confirm-info"});e.style.marginBottom="16px",e.style.padding="12px",e.style.backgroundColor="var(--background-secondary)",e.style.borderRadius="8px",e.createEl("p",{text:`"${this.result.title}"`,cls:"reference-title"}).style.fontWeight="bold",e.createEl("p",{text:`\uAD00\uB828 \uD504\uB85C\uC81D\uD2B8: ${this.result.projectName}`,cls:"reference-project"}).style.color="var(--text-muted)",e.createEl("p",{text:"\uC774 \uC790\uB8CC\uB294 \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB85C \uBCF4\uC785\uB2C8\uB2E4. \uC5B4\uB514\uC5D0 \uC800\uC7A5\uD560\uAE4C\uC694?",cls:"reference-question"}).style.marginTop="8px";let n=t.createDiv({cls:"reference-options"});n.style.display="flex",n.style.flexDirection="column",n.style.gap="12px";let i=n.createDiv({cls:"reference-option"});i.style.padding="12px",i.style.border="1px solid var(--background-modifier-border)",i.style.borderRadius="8px",i.style.cursor="pointer",i.addEventListener("mouseenter",()=>{i.style.backgroundColor="var(--background-secondary)"}),i.addEventListener("mouseleave",()=>{i.style.backgroundColor=""}),i.createEl("strong",{text:"\u{1F4C1} \uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC800\uC7A5"}),i.createEl("p",{text:`Projects/${this.result.projectName}/ \uC5D0 \uC800\uC7A5`,cls:"option-desc"}).style.color="var(--text-muted)",i.createEl("small",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8 \uC804\uC6A9 \uC790\uB8CC\uB85C \uAD00\uB9AC"}).style.color="var(--text-faint)",i.addEventListener("click",()=>{this.close(),this.onChoice("project")});let o=n.createDiv({cls:"reference-option"});o.style.padding="12px",o.style.border="2px solid var(--interactive-accent)",o.style.borderRadius="8px",o.style.cursor="pointer",o.style.backgroundColor="var(--background-secondary)",o.createEl("strong",{text:"\u{1F4DA} Library\uC5D0 \uC800\uC7A5 + \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C (\uAD8C\uC7A5)"}),o.createEl("p",{text:"Library/ \uC5D0 \uC800\uC7A5\uD558\uACE0 \uD504\uB85C\uC81D\uD2B8\uC640 \uC5F0\uACB0",cls:"option-desc"}).style.color="var(--text-muted)",o.createEl("small",{text:"\uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5"}).style.color="var(--text-faint)",o.addEventListener("click",()=>{this.close(),this.onChoice("library")});let r=t.createDiv({cls:"modal-button-container"});r.style.marginTop="16px",r.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}},Zv=class extends P.Modal{constructor(t,e){super(t),this.plugin=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-command-list-modal");let e=t.createEl("h2",{text:"\u{1F9E0} Zero Friction Brain"});e.style.marginBottom="16px",e.style.textAlign="center";let n=[{name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkey:"Ctrl+Shift+G",icon:"folder",action:()=>this.plugin.classifyCurrentFile()},{name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkey:"Ctrl+Shift+L",icon:"link",action:()=>this.plugin.linkRelatedNotesForCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkey:"Ctrl+Shift+S",icon:"sparkles",action:()=>this.plugin.smartProcessCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkey:"Ctrl+Shift+D",icon:"split",action:()=>this.plugin.smartSplitCurrentFile()},{name:"ZK \uCD94\uCD9C",hotkey:"Ctrl+Shift+Z",icon:"file-plus",action:()=>this.plugin.extractZKFromCurrentFile()},{name:"URL \uAC00\uC838\uC624\uAE30",hotkey:"Ctrl+Shift+U",icon:"globe",action:()=>this.plugin.showURLImportModal()},{name:"Focus Top 3",hotkey:"Ctrl+Shift+;",icon:"target",action:()=>this.plugin.showFocusTop3()},{name:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC",hotkey:"Ctrl+Shift+R",icon:"calendar-check",action:()=>this.plugin.showReviewModal()},{name:"OCR \uCD94\uCD9C",hotkey:"Ctrl+Shift+O",icon:"scan",action:()=>this.plugin.ocrCurrentFile()},{divider:!0},{name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",hotkey:"",icon:"inbox",action:()=>this.plugin.processInbox()},{name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",hotkey:"",icon:"map",action:()=>this.plugin.showCreateMOCModal()},{name:"ZK Index \uC7AC\uAD6C\uCD95",hotkey:"",icon:"refresh-cw",action:()=>this.plugin.rebuildZKIndex()},{name:"Watch \uD1A0\uAE00",hotkey:"",icon:"eye",action:()=>this.plugin.toggleWatch()}],i=t.createDiv({cls:"zfb-command-list"});i.style.display="flex",i.style.flexDirection="column",i.style.gap="4px";for(let a of n){if("divider"in a&&a.divider){let p=i.createEl("hr");p.style.margin="8px 0",p.style.border="none",p.style.borderTop="1px solid var(--background-modifier-border)";continue}let l=i.createDiv({cls:"zfb-command-item"});l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="space-between",l.style.padding="10px 12px",l.style.borderRadius="6px",l.style.cursor="pointer",l.style.transition="background-color 0.1s",l.addEventListener("mouseenter",()=>{l.style.backgroundColor="var(--background-secondary)"}),l.addEventListener("mouseleave",()=>{l.style.backgroundColor=""});let c=l.createDiv();c.style.display="flex",c.style.alignItems="center",c.style.gap="10px";let d=c.createSpan({cls:"zfb-command-icon"});if((0,P.setIcon)(d,a.icon||"command"),d.style.opacity="0.7",c.createSpan({text:a.name}),a.hotkey){let p=l.createSpan({text:a.hotkey,cls:"zfb-command-hotkey"});p.style.fontSize="0.85em",p.style.color="var(--text-muted)",p.style.backgroundColor="var(--background-secondary)",p.style.padding="2px 8px",p.style.borderRadius="4px",p.style.fontFamily="monospace"}l.addEventListener("click",()=>{this.close(),a.action()})}let o=t.createDiv({cls:"zfb-command-footer"});o.style.marginTop="16px",o.style.paddingTop="12px",o.style.borderTop="1px solid var(--background-modifier-border)",o.style.textAlign="center",o.style.color="var(--text-muted)",o.style.fontSize="0.85em",o.createSpan({text:`v${this.plugin.manifest.version} \u2022 `});let r=o.createEl("a",{text:"\uC124\uC815"});r.style.cursor="pointer",r.addEventListener("click",()=>{this.close(),this.app.setting.open(),this.app.setting.openTabById("zero-friction-brain")})}onClose(){this.contentEl.empty()}},Qv=class extends P.Modal{constructor(e,n,i){super(e);this.selectedPeriod="week";this.resultContainer=null;this.isLoading=!1;this.reviewManager=n,this.settings=i}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("zfb-review-modal"),e.createEl("h2",{text:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC"});let n=e.createDiv({cls:"zfb-review-period-section"});n.createEl("label",{text:"\uAE30\uAC04 \uC120\uD0DD:",cls:"setting-item-name"});let i=n.createDiv({cls:"zfb-period-buttons"});i.style.display="flex",i.style.gap="8px",i.style.marginTop="8px",i.style.marginBottom="16px",[{value:"today",label:"\uC624\uB298"},{value:"week",label:"\uC774\uBC88 \uC8FC"},{value:"month",label:"\uC774\uBC88 \uB2EC"}].forEach(({value:m,label:v})=>{let A=i.createEl("button",{text:v});A.style.padding="8px 16px",A.style.borderRadius="6px",A.style.cursor="pointer",m===this.selectedPeriod&&A.addClass("mod-cta"),A.addEventListener("click",()=>{this.selectedPeriod=m,i.querySelectorAll("button").forEach(T=>T.removeClass("mod-cta")),A.addClass("mod-cta"),this.loadNotes()})});let r=e.createDiv({cls:"zfb-review-filter-section"});r.style.marginBottom="16px",r.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uD544\uD130 (\uC120\uD0DD):",cls:"setting-item-name"});let a=r.createEl("select");a.style.marginLeft="8px",a.style.padding="4px 8px";let l=a.createEl("option",{text:"\uC804\uCCB4",value:""});l.value="",this.reviewManager.getProjectList().forEach(m=>{let v=a.createEl("option",{text:m,value:m});v.value=m}),a.addEventListener("change",()=>{this.projectFilter=a.value||void 0,this.loadNotes()}),this.resultContainer=e.createDiv({cls:"zfb-review-results"}),this.resultContainer.style.marginTop="16px",this.resultContainer.style.maxHeight="400px",this.resultContainer.style.overflowY="auto";let d=e.createDiv({cls:"modal-button-container"});d.style.marginTop="16px",d.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close()),d.createEl("button",{text:"AI \uBD84\uC11D \uBC0F \uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createReviewNote()),this.loadNotes()}async loadNotes(){if(!(!this.resultContainer||this.isLoading)){this.isLoading=!0,this.resultContainer.empty(),this.resultContainer.createEl("p",{text:"\uB178\uD2B8 \uC218\uC9D1 \uC911...",cls:"zfb-loading"});try{let e={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.collectNotes(e),i=this.reviewManager.groupByProject(n);this.renderResults(n,i)}catch(e){console.error("\uB178\uD2B8 \uC218\uC9D1 \uC2E4\uD328:",e),this.resultContainer.empty(),this.resultContainer.createEl("p",{text:`\uC624\uB958: ${e}`,cls:"zfb-error"})}finally{this.isLoading=!1}}}renderResults(e,n){if(!this.resultContainer)return;if(this.resultContainer.empty(),e.length===0){this.resultContainer.createEl("p",{text:"\uD574\uB2F9 \uAE30\uAC04\uC5D0 \uC791\uC5C5\uD55C \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.",cls:"zfb-empty-message"});return}let i=this.resultContainer.createDiv({cls:"zfb-review-summary"});i.style.padding="12px",i.style.backgroundColor="var(--background-secondary)",i.style.borderRadius="8px",i.style.marginBottom="16px";let o=qa(this.selectedPeriod,this.settings.timezone);i.createEl("p",{text:`${o.label} \uC791\uC5C5: ${e.length}\uAC1C \uB178\uD2B8, ${n.length}\uAC1C \uD504\uB85C\uC81D\uD2B8/\uC601\uC5ED`});for(let r of n){let a=this.resultContainer.createDiv({cls:"zfb-review-group"});a.style.marginBottom="16px";let l=a.createEl("h4",{text:`\u{1F4C1} ${r.projectName} (${r.noteCount}\uAC1C)`});l.style.marginBottom="8px",l.style.borderBottom="1px solid var(--background-modifier-border)",l.style.paddingBottom="4px";let c=a.createEl("ul");c.style.listStyle="none",c.style.paddingLeft="16px",c.style.margin="0";for(let d of r.notes){let p=c.createEl("li");p.style.display="flex",p.style.justifyContent="space-between",p.style.alignItems="center",p.style.padding="4px 0";let g=p.createEl("a",{text:d.title});g.style.cursor="pointer",g.style.color="var(--text-accent)",g.addEventListener("click",async()=>{this.app.vault.getAbstractFileByPath(d.path)instanceof P.TFile&&await this.app.workspace.openLinkText(d.path,"")});let m=p.createEl("span",{text:a_(d.modified),cls:"zfb-note-time"});m.style.fontSize="0.85em",m.style.color="var(--text-muted)"}}}async createReviewNote(){if(!this.isLoading){this.isLoading=!0,new P.Notice("AI \uBD84\uC11D \uC911...");try{let e={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.analyze(e),i=await this.reviewManager.createReviewNote(n);new P.Notice(`\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131\uB428: ${i.basename}`),await this.app.workspace.openLinkText(i.path,""),this.close()}catch(e){console.error("\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328:",e),new P.Notice(`\uC0DD\uC131 \uC2E4\uD328: ${e}`)}finally{this.isLoading=!1}}}onClose(){this.contentEl.empty()}};
/*! Bundled license information:

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
