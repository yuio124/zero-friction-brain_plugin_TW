/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Lf=Object.defineProperty;var yP=Object.getOwnPropertyDescriptor;var vP=Object.getOwnPropertyNames;var bP=Object.prototype.hasOwnProperty;var EP=(i,e,t)=>e in i?Lf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var wP=(i,e)=>{for(var t in e)Lf(i,t,{get:e[t],enumerable:!0})},AP=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of vP(e))!bP.call(i,s)&&s!==t&&Lf(i,s,{get:()=>e[s],enumerable:!(n=yP(e,s))||n.enumerable});return i};var SP=i=>AP(Lf({},"__esModule",{value:!0}),i);var W=(i,e,t)=>(EP(i,typeof e!="symbol"?e+"":e,t),t),tb=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var u=(i,e,t)=>(tb(i,e,"read from private field"),t?t.call(i):e.get(i)),b=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},w=(i,e,t,n)=>(tb(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t);var vt=(i,e,t,n)=>({set _(s){w(i,e,s,t)},get _(){return u(i,e,n)}}),S=(i,e,t)=>(tb(i,e,"access private method"),t);var XG={};wP(XG,{default:()=>Qv});module.exports=SP(XG);var M=require("obsidian");var uC={geminiApiKey:"",inboxFolder:"00 _Inbox",projectsFolder:"01 Projects",libraryFolder:"02 Library",archivesFolder:"03 Archives",zettelFolder:"10 Zettelkasten",autoWatch:!0,triggerTag:"#\uC644\uB8CC",language:"ko",ocrEnabled:!0,ocrAutoProcess:!1,ocrMoveOriginal:!0,ocrOriginalFolder:"03 Archives/OCR_\uC6D0\uBCF8",ocrMinTextThreshold:50,ocrMaxPages:20,ocrMaxFileSizeMB:10,ocrDailyLimit:50,zkIdType:"date-sequence",zkMergeThreshold:.8,timezone:"auto",dateFormat:"local",scheduleDetectionEnabled:!0,dailyNotesFolder:"00 _Inbox",googleCalendarEnabled:!1,useOwnApiKey:!1,googleClientId:"",googleClientSecret:"",googleAccessToken:"",googleRefreshToken:"",googleTokenExpiry:0,calendarEnabled:!0,calendarDefaultView:"month",calendarFirstDayOfWeek:0,showMiniCalendar:!0,embeddingEnabled:!1,embeddingSimilarityThreshold:.7},nb={version:1,feedback:{referenceLocation:{toLibrary:0,toProject:0,preference:"neutral"},scheduleDetection:{accepted:0,rejected:0,falsePositivePatterns:[]},projectClassification:{corrections:[]}},restructure:{accepted:0,rejected:0,preferredFormats:[],preference:"neutral"},embedding:{acceptedPairs:[],rejectedPairs:[],similarityThresholdAdjustment:0},rag:{frequentQuestions:[],preferredNotes:[],feedbackOnAnswers:{helpful:0,notHelpful:0}}},Of={version:1,entries:[],preferences:nb,lastUpdated:new Date().toISOString()};var Y=require("obsidian");var pC=[{value:"auto",label:"\uC790\uB3D9 \uAC10\uC9C0"},{value:"Asia/Seoul",label:"\uD55C\uAD6D (KST, UTC+9)"},{value:"Asia/Tokyo",label:"\uC77C\uBCF8 (JST, UTC+9)"},{value:"Asia/Shanghai",label:"\uC911\uAD6D (CST, UTC+8)"},{value:"America/New_York",label:"\uBBF8\uAD6D \uB3D9\uBD80 (EST/EDT)"},{value:"America/Los_Angeles",label:"\uBBF8\uAD6D \uC11C\uBD80 (PST/PDT)"},{value:"Europe/London",label:"\uC601\uAD6D (GMT/BST)"},{value:"UTC",label:"UTC"}],gC=[{value:"iso",label:"ISO \uD615\uC2DD (2026-01-05T16:24:45+09:00)"},{value:"local",label:"\uB85C\uCEEC \uD615\uC2DD (2026-01-05 16:24:45)"},{value:"friendly",label:"\uCE5C\uADFC\uD55C \uD615\uC2DD (2026\uB144 1\uC6D4 5\uC77C 16:24)"}];function Uf(i){return i==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:i}function ib(i,e,t){let n=Uf(e);switch(t){case"iso":return _P(i,n);case"local":return hC(i,n);case"friendly":return CP(i,n);default:return hC(i,n)}}function _P(i,e){let t={timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",t).formatToParts(i),s=p=>{var m;return((m=n.find(y=>y.type===p))==null?void 0:m.value)||""},r=s("year"),o=s("month"),a=s("day"),l=s("hour"),c=s("minute"),d=s("second"),h=TP(i,e);return`${r}-${o}-${a}T${l}:${c}:${d}${h}`}function hC(i,e){let t={timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",t).formatToParts(i),s=h=>{var p;return((p=n.find(m=>m.type===h))==null?void 0:p.value)||""},r=s("year"),o=s("month"),a=s("day"),l=s("hour"),c=s("minute"),d=s("second");return`${r}-${o}-${a} ${l}:${c}:${d}`}function CP(i,e){let t={timeZone:e,year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};return new Intl.DateTimeFormat("ko-KR",t).format(i)}function TP(i,e){let t=new Date(i.toLocaleString("en-US",{timeZone:"UTC"})),s=(new Date(i.toLocaleString("en-US",{timeZone:e})).getTime()-t.getTime())/(1e3*60);if(s===0)return"Z";let r=s>=0?"+":"-",o=Math.abs(s),a=Math.floor(o/60),l=o%60;return`${r}${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}`}function Le(i,e){let n={timeZone:Uf(e),year:"numeric",month:"2-digit",day:"2-digit"},s=new Intl.DateTimeFormat("en-CA",n).formatToParts(i),r=o=>{var a;return((a=s.find(l=>l.type===o))==null?void 0:a.value)||""};return`${r("year")}-${r("month")}-${r("day")}`}function Oe(i,e){return ib(new Date,i,e)}function Yn(i){return Le(new Date,i)}function Uc(i,e){let t=Uf(e),n=new Date;switch(i){case"today":return fC(n,t);case"week":return xP(n,t);case"month":return RP(n,t);default:return fC(n,t)}}function fC(i,e){let t=sb(i,e),n=rb(i,e);return{start:t,end:n,label:"\uC624\uB298"}}function xP(i,e){let t=i.getDay(),n=t===0?6:t-1,s=new Date(i);s.setDate(s.getDate()-n);let r=new Date(s);return r.setDate(r.getDate()+6),{start:sb(s,e),end:rb(r,e),label:"\uC774\uBC88 \uC8FC"}}function RP(i,e){let t=new Date(i.getFullYear(),i.getMonth(),1),n=new Date(i.getFullYear(),i.getMonth()+1,0);return{start:sb(t,e),end:rb(n,e),label:"\uC774\uBC88 \uB2EC"}}function sb(i,e){let t=new Date(i);return t.setHours(0,0,0,0),t}function rb(i,e){let t=new Date(i);return t.setHours(23,59,59,999),t}function mC(i,e){return i>=e.start&&i<=e.end}function ob(i){let e=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);let n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e.getTime()-n.getTime())/864e5+1)/7)}function yC(i,e,t){let n=Uf(t);switch(i){case"today":return`${Le(e,n)} \uC77C\uC77C \uD68C\uACE0.md`;case"week":let s=ob(e);return`${e.getFullYear()}-W${String(s).padStart(2,"0")} \uC8FC\uAC04 \uD68C\uACE0.md`;case"month":return`${Le(e,n).substring(0,7)} \uC6D4\uAC04 \uD68C\uACE0.md`;default:return`${Le(e,n)} \uD68C\uACE0.md`}}function vC(i){let t=new Date().getTime()-i.getTime(),n=Math.floor(t/(1e3*60)),s=Math.floor(t/(1e3*60*60)),r=Math.floor(t/(1e3*60*60*24));return n<1?"\uBC29\uAE08 \uC804":n<60?`${n}\uBD84 \uC804`:s<24?`${s}\uC2DC\uAC04 \uC804`:r===1?"\uC5B4\uC81C":r<7?`${r}\uC77C \uC804`:r<30?`${Math.floor(r/7)}\uC8FC \uC804`:`${Math.floor(r/30)}\uAC1C\uC6D4 \uC804`}var Hf=class extends Y.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"Zero Friction Brain \uC124\uC815"}),e.createEl("h3",{text:"API \uC124\uC815"}),new Y.Setting(e).setName("Gemini API \uD0A4").setDesc(createFragment(n=>{n.appendText("Gemini API \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694. "),n.createEl("a",{text:"API \uD0A4 \uBC1C\uAE09\uBC1B\uAE30",href:"https://aistudio.google.com/apikey"})})).addText(n=>n.setPlaceholder("AIzaSy...").setValue(this.plugin.settings.geminiApiKey).onChange(async s=>{this.plugin.settings.geminiApiKey=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:"\uD3F4\uB354 \uC124\uC815"}),new Y.Setting(e).setName("Inbox \uD3F4\uB354").setDesc("\uC0C8 \uB178\uD2B8\uAC00 \uC800\uC7A5\uB418\uB294 \uD3F4\uB354").addText(n=>n.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.inboxFolder).onChange(async s=>{this.plugin.settings.inboxFolder=s,await this.plugin.saveSettings()})),new Y.Setting(e).setName("Projects \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uBCC4 \uD558\uC704 \uD3F4\uB354\uAC00 \uC0DD\uC131\uB429\uB2C8\uB2E4").addText(n=>n.setPlaceholder("01 Projects").setValue(this.plugin.settings.projectsFolder).onChange(async s=>{this.plugin.settings.projectsFolder=s,await this.plugin.saveSettings()})),new Y.Setting(e).setName("Library \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uC5D0 \uC18D\uD558\uC9C0 \uC54A\uB294 \uCC38\uACE0 \uC790\uB8CC").addText(n=>n.setPlaceholder("02 Library").setValue(this.plugin.settings.libraryFolder).onChange(async s=>{this.plugin.settings.libraryFolder=s,await this.plugin.saveSettings()})),new Y.Setting(e).setName("Archives \uD3F4\uB354").setDesc("\uC644\uB8CC\uB41C \uD504\uB85C\uC81D\uD2B8 (\uD1B5\uC9F8\uB85C \uC774\uB3D9)").addText(n=>n.setPlaceholder("03 Archives").setValue(this.plugin.settings.archivesFolder).onChange(async s=>{this.plugin.settings.archivesFolder=s,await this.plugin.saveSettings()})),new Y.Setting(e).setName("Zettelkasten \uD3F4\uB354").setDesc("ZK \uC601\uAD6C \uB178\uD2B8 \uC800\uC7A5 \uC704\uCE58").addText(n=>n.setPlaceholder("10 Zettelkasten").setValue(this.plugin.settings.zettelFolder).onChange(async s=>{this.plugin.settings.zettelFolder=s,await this.plugin.saveSettings()})),new Y.Setting(e).setName("\uD3F4\uB354 \uAD6C\uC870 \uC0DD\uC131").setDesc("\uC704\uC5D0 \uC124\uC815\uB41C \uD3F4\uB354\uB4E4\uC744 \uC790\uB3D9\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4").addButton(n=>n.setButtonText("\uD3F4\uB354 \uC0DD\uC131").setCta().onClick(async()=>{await this.createFolderStructure()})),e.createEl("h3",{text:"\uC635\uC158"}),new Y.Setting(e).setName("Inbox \uC790\uB3D9 \uAC10\uC2DC").setDesc("Inbox \uD3F4\uB354\uC758 \uD30C\uC77C\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC2DC\uD558\uC5EC \uBD84\uB958").addToggle(n=>n.setValue(this.plugin.settings.autoWatch).onChange(async s=>{this.plugin.settings.autoWatch=s,await this.plugin.saveSettings(),s?this.plugin.startWatcher():this.plugin.stopWatcher()})),new Y.Setting(e).setName("\uD2B8\uB9AC\uAC70 \uD0DC\uADF8").setDesc("\uC774 \uD0DC\uADF8\uAC00 \uC788\uB294 \uB178\uD2B8\uB9CC \uC790\uB3D9 \uBD84\uB958 (\uC608: #\uC644\uB8CC)").addText(n=>n.setPlaceholder("#\uC644\uB8CC").setValue(this.plugin.settings.triggerTag).onChange(async s=>{this.plugin.settings.triggerTag=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:"OCR \uC124\uC815"}),new Y.Setting(e).setName("OCR \uAE30\uB2A5 \uD65C\uC131\uD654").setDesc("\uC774\uBBF8\uC9C0 \uBC0F PDF\uC5D0\uC11C \uD14D\uC2A4\uD2B8 \uCD94\uCD9C").addToggle(n=>n.setValue(this.plugin.settings.ocrEnabled).onChange(async s=>{this.plugin.settings.ocrEnabled=s,await this.plugin.saveSettings()})),new Y.Setting(e).setName("OCR \uD6C4 \uC6D0\uBCF8 \uC774\uB3D9").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC744 \uC9C0\uC815 \uD3F4\uB354\uB85C \uC774\uB3D9").addToggle(n=>n.setValue(this.plugin.settings.ocrMoveOriginal).onChange(async s=>{this.plugin.settings.ocrMoveOriginal=s,await this.plugin.saveSettings()})),new Y.Setting(e).setName("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uD3F4\uB354").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC774 \uC774\uB3D9\uB420 \uD3F4\uB354").addText(n=>n.setPlaceholder("03 Archives/OCR_\uC6D0\uBCF8").setValue(this.plugin.settings.ocrOriginalFolder).onChange(async s=>{this.plugin.settings.ocrOriginalFolder=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:"OCR \uC81C\uD55C (API \uC694\uAE08 \uBCF4\uD638)"}),new Y.Setting(e).setName("\uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").setDesc("\uD55C \uBC88\uC5D0 \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 PDF \uD398\uC774\uC9C0 \uC218").addSlider(n=>n.setLimits(1,100,1).setValue(this.plugin.settings.ocrMaxPages).setDynamicTooltip().onChange(async s=>{this.plugin.settings.ocrMaxPages=s,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (20)").onClick(async()=>{this.plugin.settings.ocrMaxPages=20,await this.plugin.saveSettings(),this.display()})),new Y.Setting(e).setName("\uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30 (MB)").setDesc("\uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30").addSlider(n=>n.setLimits(1,50,1).setValue(this.plugin.settings.ocrMaxFileSizeMB).setDynamicTooltip().onChange(async s=>{this.plugin.settings.ocrMaxFileSizeMB=s,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (10)").onClick(async()=>{this.plugin.settings.ocrMaxFileSizeMB=10,await this.plugin.saveSettings(),this.display()})),new Y.Setting(e).setName("\uC77C\uC77C \uCC98\uB9AC \uD55C\uB3C4 (\uD398\uC774\uC9C0)").setDesc("\uD558\uB8E8\uC5D0 OCR \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").addSlider(n=>n.setLimits(10,500,10).setValue(this.plugin.settings.ocrDailyLimit).setDynamicTooltip().onChange(async s=>{this.plugin.settings.ocrDailyLimit=s,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (50)").onClick(async()=>{this.plugin.settings.ocrDailyLimit=50,await this.plugin.saveSettings(),this.display()})),e.createDiv({cls:"ocr-usage-info"}).createEl("p",{text:`\uC624\uB298 \uC0AC\uC6A9\uB7C9: ${this.plugin.getOCRDailyUsage().pagesProcessed}/${this.plugin.settings.ocrDailyLimit} \uD398\uC774\uC9C0`,cls:"setting-item-description"}),e.createEl("h3",{text:"Zettelkasten \uC124\uC815"}),new Y.Setting(e).setName("ZK \uB178\uD2B8 ID \uD615\uC2DD").setDesc("ZK \uB178\uD2B8 \uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uD560 ID \uD615\uC2DD").addDropdown(n=>n.addOption("timestamp","\uD0C0\uC784\uC2A4\uD0EC\uD504 (1735789200000)").addOption("date-sequence","\uB0A0\uC9DC+\uC21C\uBC88 (20260102-001)").addOption("luhmann","\uB8E8\uB9CC \uC2A4\uD0C0\uC77C (1a1b)").setValue(this.plugin.settings.zkIdType).onChange(async s=>{this.plugin.settings.zkIdType=s,await this.plugin.saveSettings()})),new Y.Setting(e).setName("\uC720\uC0AC \uB178\uD2B8 \uBCD1\uD569 \uC784\uACC4\uAC12").setDesc("\uC774 \uAC12 \uC774\uC0C1\uC758 \uC720\uC0AC\uB3C4\uB97C \uAC00\uC9C4 \uB178\uD2B8\uAC00 \uC788\uC73C\uBA74 \uBCD1\uD569 \uC81C\uC548 (0.5~1.0)").addSlider(n=>n.setLimits(.5,1,.05).setValue(this.plugin.settings.zkMergeThreshold).setDynamicTooltip().onChange(async s=>{this.plugin.settings.zkMergeThreshold=s,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (0.8)").onClick(async()=>{this.plugin.settings.zkMergeThreshold=.8,await this.plugin.saveSettings(),this.display()})),e.createEl("h3",{text:"\uC2DC\uAC04\uB300 \uBC0F \uB0A0\uC9DC \uD615\uC2DD"}),new Y.Setting(e).setName("\uC2DC\uAC04\uB300").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504\uC5D0 \uC0AC\uC6A9\uD560 \uC2DC\uAC04\uB300").addDropdown(n=>{pC.forEach(s=>{n.addOption(s.value,s.label)}),n.setValue(this.plugin.settings.timezone).onChange(async s=>{this.plugin.settings.timezone=s,await this.plugin.saveSettings()})}),new Y.Setting(e).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504 \uD45C\uC2DC \uD615\uC2DD").addDropdown(n=>{gC.forEach(s=>{n.addOption(s.value,s.label)}),n.setValue(this.plugin.settings.dateFormat).onChange(async s=>{this.plugin.settings.dateFormat=s,await this.plugin.saveSettings()})}),e.createEl("h3",{text:"\uC77C\uC815 \uAC10\uC9C0"}),new Y.Setting(e).setName("\uC77C\uC815 \uC790\uB3D9 \uAC10\uC9C0").setDesc("\uB178\uD2B8 \uBD84\uB958 \uC2DC \uC77C\uC815/\uD560\uC77C/\uC57D\uC18D\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC9C0").addToggle(n=>n.setValue(this.plugin.settings.scheduleDetectionEnabled).onChange(async s=>{this.plugin.settings.scheduleDetectionEnabled=s,await this.plugin.saveSettings()})),new Y.Setting(e).setName("Daily Notes \uD3F4\uB354").setDesc("\uC77C\uC815\uC774 \uC800\uC7A5\uB420 Daily Notes \uD3F4\uB354").addText(n=>n.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.dailyNotesFolder).onChange(async s=>{this.plugin.settings.dailyNotesFolder=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Google Calendar \uC5F0\uB3D9"}),new Y.Setting(e).setName("Google Calendar \uD65C\uC131\uD654").setDesc("\uC77C\uC815\uC744 Google Calendar\uC5D0\uB3C4 \uC800\uC7A5\uD569\uB2C8\uB2E4").addToggle(n=>n.setValue(this.plugin.settings.googleCalendarEnabled).onChange(async s=>{this.plugin.settings.googleCalendarEnabled=s,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.googleCalendarEnabled){let n=!!this.plugin.settings.googleRefreshToken,s=n?"\uC5F0\uACB0\uB428 \u2713":"\uC5F0\uACB0 \uC548\uB428";if(new Y.Setting(e).setName("Google \uACC4\uC815").setDesc(s).addButton(r=>r.setButtonText(n?"\uC7AC\uC5F0\uACB0":"\uC5F0\uACB0\uD558\uAE30").setCta().onClick(async()=>{await this.plugin.connectGoogleCalendar()})).addButton(r=>(n&&r.setButtonText("\uC5F0\uACB0 \uD574\uC81C").onClick(async()=>{await this.plugin.disconnectGoogleCalendar(),this.display()}),r)),new Y.Setting(e).setName("\uC790\uCCB4 API \uD0A4 \uC0AC\uC6A9 (Advanced)").setDesc("\uC9C1\uC811 Google Cloud Console\uC5D0\uC11C \uC0DD\uC131\uD55C Client ID\uB97C \uC0AC\uC6A9\uD569\uB2C8\uB2E4").addToggle(r=>r.setValue(this.plugin.settings.useOwnApiKey).onChange(async o=>{this.plugin.settings.useOwnApiKey=o,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.useOwnApiKey){new Y.Setting(e).setName("Google Client ID").setDesc("Google Cloud Console\uC5D0\uC11C \uC0DD\uC131\uD55C OAuth 2.0 Client ID").addText(o=>o.setPlaceholder("xxxxx.apps.googleusercontent.com").setValue(this.plugin.settings.googleClientId).onChange(async a=>{this.plugin.settings.googleClientId=a,await this.plugin.saveSettings()})),new Y.Setting(e).setName("Google Client Secret").setDesc("OAuth 2.0 Client Secret").addText(o=>o.setPlaceholder("GOCSPX-...").setValue(this.plugin.settings.googleClientSecret).onChange(async a=>{this.plugin.settings.googleClientSecret=a,await this.plugin.saveSettings()}));let r=e.createDiv({cls:"setting-item-description"});r.createEl("p",{text:"Google Cloud Console\uC5D0\uC11C OAuth 2.0 \uD074\uB77C\uC774\uC5B8\uD2B8 ID\uB97C \uC0DD\uC131\uD558\uC138\uC694:"}),r.createEl("a",{text:"Google Cloud Console \uC5F4\uAE30",href:"https://console.cloud.google.com/apis/credentials"}),r.createEl("p",{text:"\uB9AC\uB514\uB809\uC158 URI: http://127.0.0.1:42813/callback",cls:"setting-item-description"}).style.fontFamily="monospace"}}if(e.createEl("h3",{text:"\uCE98\uB9B0\uB354 \uBDF0"}),new Y.Setting(e).setName("\uCE98\uB9B0\uB354 \uBDF0 \uD65C\uC131\uD654").setDesc("\uB178\uD2B8, \uC77C\uC815, \uD68C\uC758\uB85D\uC744 \uCE98\uB9B0\uB354\uB85C \uD655\uC778\uD569\uB2C8\uB2E4").addToggle(n=>n.setValue(this.plugin.settings.calendarEnabled).onChange(async s=>{this.plugin.settings.calendarEnabled=s,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.calendarEnabled&&(new Y.Setting(e).setName("\uAE30\uBCF8 \uBDF0").setDesc("\uCE98\uB9B0\uB354\uB97C \uC5F4 \uB54C \uAE30\uBCF8\uC73C\uB85C \uD45C\uC2DC\uD560 \uBDF0").addDropdown(n=>n.addOption("month","\uC6D4\uAC04").addOption("week","\uC8FC\uAC04").addOption("day","\uC77C\uAC04").addOption("list","\uBAA9\uB85D").setValue(this.plugin.settings.calendarDefaultView).onChange(async s=>{this.plugin.settings.calendarDefaultView=s,await this.plugin.saveSettings()})),new Y.Setting(e).setName("\uC8FC \uC2DC\uC791\uC77C").setDesc("\uCE98\uB9B0\uB354\uC758 \uCCAB \uBC88\uC9F8 \uC694\uC77C").addDropdown(n=>n.addOption("0","\uC77C\uC694\uC77C").addOption("1","\uC6D4\uC694\uC77C").setValue(String(this.plugin.settings.calendarFirstDayOfWeek)).onChange(async s=>{this.plugin.settings.calendarFirstDayOfWeek=parseInt(s),await this.plugin.saveSettings()})),new Y.Setting(e).setName("\uC0AC\uC774\uB4DC\uBC14 \uBBF8\uB2C8 \uCE98\uB9B0\uB354").setDesc("\uC624\uB978\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uBBF8\uB2C8 \uCE98\uB9B0\uB354\uB97C \uD45C\uC2DC\uD569\uB2C8\uB2E4").addToggle(n=>n.setValue(this.plugin.settings.showMiniCalendar).onChange(async s=>{this.plugin.settings.showMiniCalendar=s,await this.plugin.saveSettings(),s&&await this.plugin.toggleMiniCalendar()})),new Y.Setting(e).setName("\uCE98\uB9B0\uB354 \uC5F4\uAE30").setDesc("Ctrl+Shift+C \uB610\uB294 \uB9AC\uBCF8 \uC544\uC774\uCF58\uC73C\uB85C\uB3C4 \uC5F4 \uC218 \uC788\uC2B5\uB2C8\uB2E4").addButton(n=>n.setButtonText("\uCE98\uB9B0\uB354 \uC5F4\uAE30").setCta().onClick(async()=>{await this.plugin.openCalendarView()}))),e.createEl("h3",{text:"Embedding \uAE30\uBC18 \uAC80\uC0C9 (Beta)"}),new Y.Setting(e).setName("Embedding \uD65C\uC131\uD654").setDesc(createFragment(n=>{n.appendText("\uD0A4\uC6CC\uB4DC \uB300\uC2E0 \uC758\uBBF8 \uAE30\uBC18 \uC720\uC0AC\uB3C4\uB85C \uAD00\uB828 \uB178\uD2B8\uB97C \uCC3E\uC2B5\uB2C8\uB2E4. "),n.createEl("br"),n.appendText("\uD65C\uC131\uD654 \uC2DC \uBAA8\uB4E0 \uB178\uD2B8\uC758 \uC784\uBCA0\uB529\uC744 \uC0DD\uC131\uD569\uB2C8\uB2E4 (\uC2DC\uAC04\uC774 \uAC78\uB9B4 \uC218 \uC788\uC74C).")})).addToggle(n=>n.setValue(this.plugin.settings.embeddingEnabled).onChange(async s=>{this.plugin.settings.embeddingEnabled=s,await this.plugin.saveSettings(),this.display(),s&&(new Y.Notice("Embedding \uC778\uB371\uC2A4 \uAD6C\uCD95\uC744 \uC2DC\uC791\uD569\uB2C8\uB2E4..."),this.plugin.embeddingManager&&(await this.plugin.embeddingManager.buildFullIndex((r,o,a)=>{(r%10===0||r===o)&&new Y.Notice(`Embedding: ${r}/${o}`)}),new Y.Notice("Embedding \uC778\uB371\uC2A4 \uAD6C\uCD95 \uC644\uB8CC!")))})),this.plugin.settings.embeddingEnabled){if(new Y.Setting(e).setName("\uC720\uC0AC\uB3C4 \uC784\uACC4\uAC12").setDesc("\uC774 \uAC12 \uC774\uC0C1\uC758 \uC720\uC0AC\uB3C4\uB97C \uAC00\uC9C4 \uB178\uD2B8\uB9CC \uCD94\uCC9C\uD569\uB2C8\uB2E4 (0.5~0.95)").addSlider(n=>n.setLimits(.5,.95,.05).setValue(this.plugin.settings.embeddingSimilarityThreshold).setDynamicTooltip().onChange(async s=>{this.plugin.settings.embeddingSimilarityThreshold=s,await this.plugin.saveSettings()})).addExtraButton(n=>n.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (0.7)").onClick(async()=>{this.plugin.settings.embeddingSimilarityThreshold=.7,await this.plugin.saveSettings(),this.display()})),this.plugin.embeddingManager){let n=this.plugin.embeddingManager.getStats(),s=e.createDiv({cls:"embedding-stats-info"});s.createEl("p",{text:`\uC778\uB371\uC2F1\uB41C \uB178\uD2B8: ${n.totalNotes}\uAC1C`,cls:"setting-item-description"}),n.lastFullScan&&s.createEl("p",{text:`\uB9C8\uC9C0\uB9C9 \uC804\uCCB4 \uC2A4\uCE94: ${new Date(n.lastFullScan).toLocaleString()}`,cls:"setting-item-description"})}new Y.Setting(e).setName("\uC778\uB371\uC2A4 \uC7AC\uAD6C\uCD95").setDesc("\uBAA8\uB4E0 \uB178\uD2B8\uC758 \uC784\uBCA0\uB529\uC744 \uB2E4\uC2DC \uC0DD\uC131\uD569\uB2C8\uB2E4 (\uC2DC\uAC04\uC774 \uAC78\uB9B4 \uC218 \uC788\uC74C)").addButton(n=>n.setButtonText("\uC7AC\uAD6C\uCD95").onClick(async()=>{if(this.plugin.embeddingManager){new Y.Notice("Embedding \uC778\uB371\uC2A4 \uC7AC\uAD6C\uCD95 \uC2DC\uC791..."),await this.plugin.embeddingManager.clearIndex();let s=await this.plugin.embeddingManager.buildFullIndex((r,o)=>{(r%10===0||r===o)&&new Y.Notice(`Embedding: ${r}/${o}`)});new Y.Notice(`\uC7AC\uAD6C\uCD95 \uC644\uB8CC! \uC131\uACF5: ${s.success}, \uC2A4\uD0B5: ${s.skipped}, \uC2E4\uD328: ${s.failed}`),this.display()}})),new Y.Setting(e).setName("\uACE0\uC544 \uC784\uBCA0\uB529 \uC815\uB9AC").setDesc("\uC0AD\uC81C\uB41C \uB178\uD2B8\uC758 \uC784\uBCA0\uB529\uC744 \uC815\uB9AC\uD569\uB2C8\uB2E4").addButton(n=>n.setButtonText("\uC815\uB9AC").onClick(async()=>{if(this.plugin.embeddingManager){let s=await this.plugin.embeddingManager.cleanupOrphanedEmbeddings();new Y.Notice(`${s}\uAC1C\uC758 \uACE0\uC544 \uC784\uBCA0\uB529\uC774 \uC815\uB9AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4`),this.display()}}))}}async createFolderStructure(){let e=[this.plugin.settings.inboxFolder,this.plugin.settings.projectsFolder,this.plugin.settings.libraryFolder,this.plugin.settings.archivesFolder,this.plugin.settings.zettelFolder],t=0,n=0;for(let s of e){if(!s)continue;if(this.app.vault.getAbstractFileByPath(s))n++;else try{await this.app.vault.createFolder(s),t++}catch(o){console.error(`\uD3F4\uB354 \uC0DD\uC131 \uC2E4\uD328: ${s}`,o)}}t>0?new Y.Notice(`${t}\uAC1C \uD3F4\uB354 \uC0DD\uC131\uB428, ${n}\uAC1C \uC774\uBBF8 \uC874\uC7AC`):new Y.Notice(`\uBAA8\uB4E0 \uD3F4\uB354\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4 (${n}\uAC1C)`)}};var IP,DP;function PP(){return{geminiUrl:IP,vertexUrl:DP}}function MP(i,e,t,n){var s,r;if(!(i!=null&&i.baseUrl)){let o=PP();return e?(s=o.vertexUrl)!==null&&s!==void 0?s:t:(r=o.geminiUrl)!==null&&r!==void 0?r:n}return i.baseUrl}var Sn=class{};function O(i,e){let t=/\{([^}]+)\}/g;return i.replace(t,(n,s)=>{if(Object.prototype.hasOwnProperty.call(e,s)){let r=e[s];return r!=null?String(r):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function g(i,e,t){for(let r=0;r<e.length-1;r++){let o=e[r];if(o.endsWith("[]")){let a=o.slice(0,-2);if(!(a in i))if(Array.isArray(t))i[a]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(i[a])){let l=i[a];if(Array.isArray(t))for(let c=0;c<l.length;c++){let d=l[c];g(d,e.slice(r+1),t[c])}else for(let c of l)g(c,e.slice(r+1),t)}return}else if(o.endsWith("[0]")){let a=o.slice(0,-3);a in i||(i[a]=[{}]);let l=i[a];g(l[0],e.slice(r+1),t);return}(!i[o]||typeof i[o]!="object")&&(i[o]={}),i=i[o]}let n=e[e.length-1],s=i[n];if(s!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===s)return;if(typeof s=="object"&&typeof t=="object"&&s!==null&&t!==null)Object.assign(s,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(i,t):i[n]=t}function f(i,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return i;for(let n=0;n<e.length;n++){if(typeof i!="object"||i===null)return t;let s=e[n];if(s.endsWith("[]")){let r=s.slice(0,-2);if(r in i){let o=i[r];return Array.isArray(o)?o.map(a=>f(a,e.slice(n+1),t)):t}else return t}else i=i[s]}return i}catch(n){if(n instanceof TypeError)return t;throw n}}function kP(i,e){for(let[t,n]of Object.entries(e)){let s=t.split("."),r=n.split("."),o=new Set,a=-1;for(let l=0;l<s.length;l++)if(s[l]==="*"){a=l;break}if(a!==-1&&r.length>a)for(let l=a;l<r.length;l++){let c=r[l];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&o.add(c)}cb(i,s,r,0,o)}}function cb(i,e,t,n,s){if(n>=e.length||typeof i!="object"||i===null)return;let r=e[n];if(r.endsWith("[]")){let o=r.slice(0,-2),a=i;if(o in a&&Array.isArray(a[o]))for(let l of a[o])cb(l,e,t,n+1,s)}else if(r==="*"){if(typeof i=="object"&&i!==null&&!Array.isArray(i)){let o=i,a=Object.keys(o).filter(c=>!c.startsWith("_")&&!s.has(c)),l={};for(let c of a)l[c]=o[c];for(let[c,d]of Object.entries(l)){let h=[];for(let p of t.slice(n))p==="*"?h.push(c):h.push(p);g(o,h,d)}for(let c of a)delete o[c]}}else{let o=i;r in o&&cb(o[r],e,t,n+1,s)}}function aE(i){if(typeof i!="string")throw new Error("fromImageBytes must be a string");return i}function NP(i){let e={},t=f(i,["operationName"]);t!=null&&g(e,["operationName"],t);let n=f(i,["resourceName"]);return n!=null&&g(e,["_url","resourceName"],n),e}function FP(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response","generateVideoResponse"]);return o!=null&&g(e,["response"],OP(o)),e}function LP(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],UP(o)),e}function OP(i){let e={},t=f(i,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>HP(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function UP(i){let e={},t=f(i,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>BP(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function HP(i){let e={},t=f(i,["video"]);return t!=null&&g(e,["video"],WP(t)),e}function BP(i){let e={},t=f(i,["_self"]);return t!=null&&g(e,["video"],YP(t)),e}function VP(i){let e={},t=f(i,["operationName"]);return t!=null&&g(e,["_url","operationName"],t),e}function GP(i){let e={},t=f(i,["operationName"]);return t!=null&&g(e,["_url","operationName"],t),e}function $P(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],zP(o)),e}function zP(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["parent"]);n!=null&&g(e,["parent"],n);let s=f(i,["documentName"]);return s!=null&&g(e,["documentName"],s),e}function GT(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],qP(o)),e}function qP(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["parent"]);n!=null&&g(e,["parent"],n);let s=f(i,["documentName"]);return s!=null&&g(e,["documentName"],s),e}function WP(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["uri"],t);let n=f(i,["encodedVideo"]);n!=null&&g(e,["videoBytes"],aE(n));let s=f(i,["encoding"]);return s!=null&&g(e,["mimeType"],s),e}function YP(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["uri"],t);let n=f(i,["bytesBase64Encoded"]);n!=null&&g(e,["videoBytes"],aE(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}var bC;(function(i){i.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",i.OUTCOME_OK="OUTCOME_OK",i.OUTCOME_FAILED="OUTCOME_FAILED",i.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(bC||(bC={}));var EC;(function(i){i.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",i.PYTHON="PYTHON"})(EC||(EC={}));var wC;(function(i){i.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",i.SILENT="SILENT",i.WHEN_IDLE="WHEN_IDLE",i.INTERRUPT="INTERRUPT"})(wC||(wC={}));var ys;(function(i){i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.STRING="STRING",i.NUMBER="NUMBER",i.INTEGER="INTEGER",i.BOOLEAN="BOOLEAN",i.ARRAY="ARRAY",i.OBJECT="OBJECT",i.NULL="NULL"})(ys||(ys={}));var AC;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(AC||(AC={}));var SC;(function(i){i.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",i.SIMPLE_SEARCH="SIMPLE_SEARCH",i.ELASTIC_SEARCH="ELASTIC_SEARCH"})(SC||(SC={}));var _C;(function(i){i.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",i.NO_AUTH="NO_AUTH",i.API_KEY_AUTH="API_KEY_AUTH",i.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",i.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",i.OAUTH="OAUTH",i.OIDC_AUTH="OIDC_AUTH"})(_C||(_C={}));var CC;(function(i){i.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",i.HTTP_IN_QUERY="HTTP_IN_QUERY",i.HTTP_IN_HEADER="HTTP_IN_HEADER",i.HTTP_IN_PATH="HTTP_IN_PATH",i.HTTP_IN_BODY="HTTP_IN_BODY",i.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(CC||(CC={}));var TC;(function(i){i.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",i.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",i.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",i.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(TC||(TC={}));var xC;(function(i){i.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH",i.MINIMAL="MINIMAL"})(xC||(xC={}));var RC;(function(i){i.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",i.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",i.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",i.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",i.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",i.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",i.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",i.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",i.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(RC||(RC={}));var IC;(function(i){i.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",i.SEVERITY="SEVERITY",i.PROBABILITY="PROBABILITY"})(IC||(IC={}));var DC;(function(i){i.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",i.OFF="OFF"})(DC||(DC={}));var PC;(function(i){i.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",i.STOP="STOP",i.MAX_TOKENS="MAX_TOKENS",i.SAFETY="SAFETY",i.RECITATION="RECITATION",i.LANGUAGE="LANGUAGE",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.SPII="SPII",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.IMAGE_SAFETY="IMAGE_SAFETY",i.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",i.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",i.NO_IMAGE="NO_IMAGE",i.IMAGE_RECITATION="IMAGE_RECITATION",i.IMAGE_OTHER="IMAGE_OTHER"})(PC||(PC={}));var MC;(function(i){i.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH"})(MC||(MC={}));var kC;(function(i){i.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",i.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",i.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",i.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",i.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(kC||(kC={}));var NC;(function(i){i.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",i.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",i.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",i.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",i.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(NC||(NC={}));var FC;(function(i){i.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",i.SAFETY="SAFETY",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.IMAGE_SAFETY="IMAGE_SAFETY",i.MODEL_ARMOR="MODEL_ARMOR",i.JAILBREAK="JAILBREAK"})(FC||(FC={}));var LC;(function(i){i.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",i.ON_DEMAND="ON_DEMAND",i.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(LC||(LC={}));var Yf;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.AUDIO="AUDIO"})(Yf||(Yf={}));var OC;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(OC||(OC={}));var UC;(function(i){i.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",i.TUNING_MODE_FULL="TUNING_MODE_FULL",i.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(UC||(UC={}));var HC;(function(i){i.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",i.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",i.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",i.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",i.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",i.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",i.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(HC||(HC={}));var db;(function(i){i.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",i.JOB_STATE_QUEUED="JOB_STATE_QUEUED",i.JOB_STATE_PENDING="JOB_STATE_PENDING",i.JOB_STATE_RUNNING="JOB_STATE_RUNNING",i.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",i.JOB_STATE_FAILED="JOB_STATE_FAILED",i.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",i.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",i.JOB_STATE_PAUSED="JOB_STATE_PAUSED",i.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",i.JOB_STATE_UPDATING="JOB_STATE_UPDATING",i.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(db||(db={}));var BC;(function(i){i.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",i.TUNING_TASK_I2V="TUNING_TASK_I2V",i.TUNING_TASK_T2V="TUNING_TASK_T2V",i.TUNING_TASK_R2V="TUNING_TASK_R2V"})(BC||(BC={}));var VC;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",i.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(VC||(VC={}));var GC;(function(i){i.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",i.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",i.BALANCED="BALANCED",i.PRIORITIZE_COST="PRIORITIZE_COST"})(GC||(GC={}));var $C;(function(i){i.UNSPECIFIED="UNSPECIFIED",i.BLOCKING="BLOCKING",i.NON_BLOCKING="NON_BLOCKING"})($C||($C={}));var zC;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(zC||(zC={}));var qC;(function(i){i.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",i.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(qC||(qC={}));var WC;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.AUTO="AUTO",i.ANY="ANY",i.NONE="NONE",i.VALIDATED="VALIDATED"})(WC||(WC={}));var YC;(function(i){i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE"})(YC||(YC={}));var KC;(function(i){i.DONT_ALLOW="DONT_ALLOW",i.ALLOW_ADULT="ALLOW_ADULT",i.ALLOW_ALL="ALLOW_ALL"})(KC||(KC={}));var XC;(function(i){i.auto="auto",i.en="en",i.ja="ja",i.ko="ko",i.hi="hi",i.zh="zh",i.pt="pt",i.es="es"})(XC||(XC={}));var JC;(function(i){i.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",i.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",i.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",i.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",i.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(JC||(JC={}));var ZC;(function(i){i.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",i.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",i.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",i.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(ZC||(ZC={}));var jC;(function(i){i.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",i.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",i.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",i.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(jC||(jC={}));var QC;(function(i){i.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",i.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",i.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",i.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",i.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",i.EDIT_MODE_STYLE="EDIT_MODE_STYLE",i.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",i.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(QC||(QC={}));var eT;(function(i){i.FOREGROUND="FOREGROUND",i.BACKGROUND="BACKGROUND",i.PROMPT="PROMPT",i.SEMANTIC="SEMANTIC",i.INTERACTIVE="INTERACTIVE"})(eT||(eT={}));var tT;(function(i){i.ASSET="ASSET",i.STYLE="STYLE"})(tT||(tT={}));var nT;(function(i){i.INSERT="INSERT",i.REMOVE="REMOVE",i.REMOVE_STATIC="REMOVE_STATIC",i.OUTPAINT="OUTPAINT"})(nT||(nT={}));var iT;(function(i){i.OPTIMIZED="OPTIMIZED",i.LOSSLESS="LOSSLESS"})(iT||(iT={}));var sT;(function(i){i.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",i.PREFERENCE_TUNING="PREFERENCE_TUNING"})(sT||(sT={}));var rT;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.STATE_PENDING="STATE_PENDING",i.STATE_ACTIVE="STATE_ACTIVE",i.STATE_FAILED="STATE_FAILED"})(rT||(rT={}));var oT;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.PROCESSING="PROCESSING",i.ACTIVE="ACTIVE",i.FAILED="FAILED"})(oT||(oT={}));var aT;(function(i){i.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",i.UPLOADED="UPLOADED",i.GENERATED="GENERATED"})(aT||(aT={}));var lT;(function(i){i.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.RESPONSE_REJECTED="RESPONSE_REJECTED",i.NEED_MORE_INPUT="NEED_MORE_INPUT"})(lT||(lT={}));var cT;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.VIDEO="VIDEO",i.AUDIO="AUDIO",i.DOCUMENT="DOCUMENT"})(cT||(cT={}));var dT;(function(i){i.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",i.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",i.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(dT||(dT={}));var uT;(function(i){i.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",i.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",i.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(uT||(uT={}));var hT;(function(i){i.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",i.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",i.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(hT||(hT={}));var fT;(function(i){i.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",i.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",i.NO_INTERRUPTION="NO_INTERRUPTION"})(fT||(fT={}));var pT;(function(i){i.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",i.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",i.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(pT||(pT={}));var gT;(function(i){i.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",i.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",i.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",i.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",i.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",i.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",i.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",i.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",i.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",i.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",i.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",i.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",i.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(gT||(gT={}));var mT;(function(i){i.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",i.QUALITY="QUALITY",i.DIVERSITY="DIVERSITY",i.VOCALIZATION="VOCALIZATION"})(mT||(mT={}));var ba;(function(i){i.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",i.PLAY="PLAY",i.PAUSE="PAUSE",i.STOP="STOP",i.RESET_CONTEXT="RESET_CONTEXT"})(ba||(ba={}));var Vc=class{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var wr=class{get text(){var e,t,n,s,r,o,a,l;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",d=!1,h=[];for(let p of(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[m,y]of Object.entries(p))m!=="text"&&m!=="thought"&&m!=="thoughtSignature"&&(y!==null||y!==void 0)&&h.push(m);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;d=!0,c+=p.text}}return h.length>0&&console.warn(`there are non-text parts ${h} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?c:void 0}get data(){var e,t,n,s,r,o,a,l;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="",d=[];for(let h of(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[p,m]of Object.entries(h))p!=="inlineData"&&(m!==null||m!==void 0)&&d.push(p);h.inlineData&&typeof h.inlineData.data=="string"&&(c+=atob(h.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,t,n,s,r,o,a,l;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let c=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,t,n,s,r,o,a,l,c;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let d=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(h=>h.executableCode).map(h=>h.executableCode).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,t,n,s,r,o,a,l,c;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let d=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(h=>h.codeExecutionResult).map(h=>h.codeExecutionResult).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.output}},Kf=class{},Xf=class{},ub=class{},hb=class{},fb=class{},pb=class{},Jf=class{},Zf=class{},jf=class{},gb=class{};var Qf=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,s,r=e;return t?s=LP(r):s=FP(r),Object.assign(n,s),n}},ep=class{},tp=class{},np=class{},ip=class{},mb=class{},yb=class{},vb=class{};var bb=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,r=$P(e);return Object.assign(n,r),n}},Eb=class{},wb=class{},Ab=class{};var sp=class{};var Sb=class{get text(){var e,t,n;let s="",r=!1,o=[];for(let a of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[l,c]of Object.entries(a))l!=="text"&&l!=="thought"&&c!==null&&o.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;r=!0,s+=a.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?s:void 0}get data(){var e,t,n;let s="",r=[];for(let o of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[a,l]of Object.entries(o))a!=="inlineData"&&l!==null&&r.push(a);o.inlineData&&typeof o.inlineData.data=="string"&&(s+=atob(o.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}};var _b=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var Cb=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,r=GT(e);return Object.assign(n,r),n}};function ce(i,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(i.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function $T(i,e){let t=ce(i,e);return t?t.startsWith("publishers/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}`:t.startsWith("models/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/publishers/google/${t}`:t:""}function zT(i){return Array.isArray(i)?i.map(e=>rp(e)):[rp(i)]}function rp(i){if(typeof i=="object"&&i!==null)return i;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof i}`)}function qT(i){let e=rp(i);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function WT(i){let e=rp(i);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function yT(i){if(i==null)throw new Error("PartUnion is required");if(typeof i=="object")return i;if(typeof i=="string")return{text:i};throw new Error(`Unsupported part type: ${typeof i}`)}function YT(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("PartListUnion is required");return Array.isArray(i)?i.map(e=>yT(e)):[yT(i)]}function Tb(i){return i!=null&&typeof i=="object"&&"parts"in i&&Array.isArray(i.parts)}function vT(i){return i!=null&&typeof i=="object"&&"functionCall"in i}function bT(i){return i!=null&&typeof i=="object"&&"functionResponse"in i}function ot(i){if(i==null)throw new Error("ContentUnion is required");return Tb(i)?i:{role:"user",parts:YT(i)}}function lE(i,e){if(!e)return[];if(i.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let n=ot(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(i.isVertexAI()){let t=ot(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>ot(t)):[ot(e)]}function on(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("contents are required");if(!Array.isArray(i)){if(vT(i)||bT(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[ot(i)]}let e=[],t=[],n=Tb(i[0]);for(let s of i){let r=Tb(s);if(r!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(s);else{if(vT(s)||bT(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(s)}}return n||e.push({role:"user",parts:YT(t)}),e}function KP(i,e){i.includes("null")&&(e.nullable=!0);let t=i.filter(n=>n!=="null");if(t.length===1)e.type=Object.values(ys).includes(t[0].toUpperCase())?t[0].toUpperCase():ys.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let n of t)e.anyOf.push({type:Object.values(ys).includes(n.toUpperCase())?n.toUpperCase():ys.TYPE_UNSPECIFIED})}}function Ea(i){let e={},t=["items"],n=["anyOf"],s=["properties"];if(i.type&&i.anyOf)throw new Error("type and anyOf cannot be both populated.");let r=i.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,i=r[1]):r[1].type==="null"&&(e.nullable=!0,i=r[0])),i.type instanceof Array&&KP(i.type,e);for(let[o,a]of Object.entries(i))if(a!=null)if(o=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(ys).includes(a.toUpperCase())?a.toUpperCase():ys.TYPE_UNSPECIFIED}else if(t.includes(o))e[o]=Ea(a);else if(n.includes(o)){let l=[];for(let c of a){if(c.type=="null"){e.nullable=!0;continue}l.push(Ea(c))}e[o]=l}else if(s.includes(o)){let l={};for(let[c,d]of Object.entries(a))l[c]=Ea(d);e[o]=l}else{if(o==="additionalProperties")continue;e[o]=a}return e}function cE(i){return Ea(i)}function dE(i){if(typeof i=="object")return i;if(typeof i=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:i}}};throw new Error(`Unsupported speechConfig type: ${typeof i}`)}function uE(i){if("multiSpeakerVoiceConfig"in i)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return i}function _a(i){if(i.functionDeclarations)for(let e of i.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Ea(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Ea(e.response));return i}function Ca(i){if(i==null)throw new Error("tools is required");if(!Array.isArray(i))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of i)e.push(t);return e}function XP(i,e,t,n=1){let s=!e.startsWith(`${t}/`)&&e.split("/").length===n;return i.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${i.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}`:s?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}/${e}`:e:s?`${t}/${e}`:e}function Ii(i,e){if(typeof e!="string")throw new Error("name must be a string");return XP(i,e,"cachedContents")}function KT(i){switch(i){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return i}}function vs(i){return aE(i)}function JP(i){return i!=null&&typeof i=="object"&&"name"in i}function ZP(i){return i!=null&&typeof i=="object"&&"video"in i}function jP(i){return i!=null&&typeof i=="object"&&"uri"in i}function XT(i){var e;let t;if(JP(i)&&(t=i.name),!(jP(i)&&(t=i.uri,t===void 0))&&!(ZP(i)&&(t=(e=i.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof i=="string"&&(t=i),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let s=t.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${t}`);t=s[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function JT(i,e){let t;return i.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function ZT(i){for(let e of["models","tunedModels","publisherModels"])if(QP(i,e))return i[e];return[]}function QP(i,e){return i!==null&&typeof i=="object"&&e in i}function eM(i,e={}){let t=i,n={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(n.responseJsonSchema=t.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function tM(i,e={}){let t=[],n=new Set;for(let s of i){let r=s.name;if(n.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);n.add(r);let o=eM(s,e);o.functionDeclarations&&t.push(...o.functionDeclarations)}return{functionDeclarations:t}}function jT(i,e){let t;if(typeof e=="string")if(i.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(i.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let n=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,s=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(i.isVertexAI()){if(s>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||s!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function nM(i){if(typeof i!="string")return i;let e=i;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function QT(i){if(typeof i!="object"||i===null)return{};let e=i,t=e.inlinedResponses;if(typeof t!="object"||t===null)return i;let s=t.inlinedResponses;if(!Array.isArray(s)||s.length===0)return i;let r=!1;for(let o of s){if(typeof o!="object"||o===null)continue;let l=o.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),i}function Ta(i,e){let t=e;if(!i.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function e0(i){let e=i;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function iM(i){let e={},t=f(i,["responsesFile"]);t!=null&&g(e,["fileName"],t);let n=f(i,["inlinedResponses","inlinedResponses"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>OM(o))),g(e,["inlinedResponses"],r)}let s=f(i,["inlinedEmbedContentResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["inlinedEmbedContentResponses"],r)}return e}function sM(i){let e={},t=f(i,["predictionsFormat"]);t!=null&&g(e,["format"],t);let n=f(i,["gcsDestination","outputUriPrefix"]);n!=null&&g(e,["gcsUri"],n);let s=f(i,["bigqueryDestination","outputUri"]);return s!=null&&g(e,["bigqueryUri"],s),e}function rM(i){let e={},t=f(i,["format"]);t!=null&&g(e,["predictionsFormat"],t);let n=f(i,["gcsUri"]);n!=null&&g(e,["gcsDestination","outputUriPrefix"],n);let s=f(i,["bigqueryUri"]);if(s!=null&&g(e,["bigqueryDestination","outputUri"],s),f(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(i,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(f(i,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function qf(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata","displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["metadata","state"]);s!=null&&g(e,["state"],e0(s));let r=f(i,["metadata","createTime"]);r!=null&&g(e,["createTime"],r);let o=f(i,["metadata","endTime"]);o!=null&&g(e,["endTime"],o);let a=f(i,["metadata","updateTime"]);a!=null&&g(e,["updateTime"],a);let l=f(i,["metadata","model"]);l!=null&&g(e,["model"],l);let c=f(i,["metadata","output"]);return c!=null&&g(e,["dest"],iM(QT(c))),e}function xb(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["state"]);s!=null&&g(e,["state"],e0(s));let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["createTime"]);o!=null&&g(e,["createTime"],o);let a=f(i,["startTime"]);a!=null&&g(e,["startTime"],a);let l=f(i,["endTime"]);l!=null&&g(e,["endTime"],l);let c=f(i,["updateTime"]);c!=null&&g(e,["updateTime"],c);let d=f(i,["model"]);d!=null&&g(e,["model"],d);let h=f(i,["inputConfig"]);h!=null&&g(e,["src"],oM(h));let p=f(i,["outputConfig"]);p!=null&&g(e,["dest"],sM(QT(p)));let m=f(i,["completionStats"]);return m!=null&&g(e,["completionStats"],m),e}function oM(i){let e={},t=f(i,["instancesFormat"]);t!=null&&g(e,["format"],t);let n=f(i,["gcsSource","uris"]);n!=null&&g(e,["gcsUri"],n);let s=f(i,["bigquerySource","inputUri"]);return s!=null&&g(e,["bigqueryUri"],s),e}function aM(i,e){let t={};if(f(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(f(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let n=f(e,["fileName"]);n!=null&&g(t,["fileName"],n);let s=f(e,["inlinedRequests"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>LM(i,o))),g(t,["requests","requests"],r)}return t}function lM(i){let e={},t=f(i,["format"]);t!=null&&g(e,["instancesFormat"],t);let n=f(i,["gcsUri"]);n!=null&&g(e,["gcsSource","uris"],n);let s=f(i,["bigqueryUri"]);if(s!=null&&g(e,["bigquerySource","inputUri"],s),f(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(i,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function cM(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function dM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ta(i,n)),t}function uM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ta(i,n)),t}function hM(i){let e={},t=f(i,["content"]);t!=null&&g(e,["content"],t);let n=f(i,["citationMetadata"]);n!=null&&g(e,["citationMetadata"],fM(n));let s=f(i,["tokenCount"]);s!=null&&g(e,["tokenCount"],s);let r=f(i,["finishReason"]);r!=null&&g(e,["finishReason"],r);let o=f(i,["avgLogprobs"]);o!=null&&g(e,["avgLogprobs"],o);let a=f(i,["groundingMetadata"]);a!=null&&g(e,["groundingMetadata"],a);let l=f(i,["index"]);l!=null&&g(e,["index"],l);let c=f(i,["logprobsResult"]);c!=null&&g(e,["logprobsResult"],c);let d=f(i,["safetyRatings"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>m)),g(e,["safetyRatings"],p)}let h=f(i,["urlContextMetadata"]);return h!=null&&g(e,["urlContextMetadata"],h),e}function fM(i){let e={},t=f(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),g(e,["citations"],n)}return e}function t0(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>zM(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function pM(i,e){let t={},n=f(i,["displayName"]);if(e!==void 0&&n!=null&&g(e,["batch","displayName"],n),f(i,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function gM(i,e){let t={},n=f(i,["displayName"]);e!==void 0&&n!=null&&g(e,["displayName"],n);let s=f(i,["dest"]);return e!==void 0&&s!=null&&g(e,["outputConfig"],rM(nM(s))),t}function ET(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["src"]);s!=null&&g(t,["batch","inputConfig"],aM(i,jT(i,s)));let r=f(e,["config"]);return r!=null&&pM(r,t),t}function mM(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["model"],ce(i,n));let s=f(e,["src"]);s!=null&&g(t,["inputConfig"],lM(jT(i,s)));let r=f(e,["config"]);return r!=null&&gM(r,t),t}function yM(i,e){let t={},n=f(i,["displayName"]);return e!==void 0&&n!=null&&g(e,["batch","displayName"],n),t}function vM(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["src"]);s!=null&&g(t,["batch","inputConfig"],CM(i,s));let r=f(e,["config"]);return r!=null&&yM(r,t),t}function bM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ta(i,n)),t}function EM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ta(i,n)),t}function wM(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);return r!=null&&g(e,["error"],r),e}function AM(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);return r!=null&&g(e,["error"],r),e}function SM(i,e){let t={},n=f(e,["contents"]);if(n!=null){let r=lE(i,n);Array.isArray(r)&&(r=r.map(o=>o)),g(t,["requests[]","request","content"],r)}let s=f(e,["config"]);return s!=null&&(g(t,["_self"],_M(s,t)),kP(t,{"requests[].*":"requests[].request.*"})),t}function _M(i,e){let t={},n=f(i,["taskType"]);e!==void 0&&n!=null&&g(e,["requests[]","taskType"],n);let s=f(i,["title"]);e!==void 0&&s!=null&&g(e,["requests[]","title"],s);let r=f(i,["outputDimensionality"]);if(e!==void 0&&r!=null&&g(e,["requests[]","outputDimensionality"],r),f(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function CM(i,e){let t={},n=f(e,["fileName"]);n!=null&&g(t,["file_name"],n);let s=f(e,["inlinedRequests"]);return s!=null&&g(t,["requests"],SM(i,s)),t}function TM(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function xM(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function RM(i){let e={},t=f(i,["mode"]);t!=null&&g(e,["mode"],t);let n=f(i,["allowedFunctionNames"]);if(n!=null&&g(e,["allowedFunctionNames"],n),f(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function IM(i,e,t){let n={},s=f(e,["systemInstruction"]);t!==void 0&&s!=null&&g(t,["systemInstruction"],t0(ot(s)));let r=f(e,["temperature"]);r!=null&&g(n,["temperature"],r);let o=f(e,["topP"]);o!=null&&g(n,["topP"],o);let a=f(e,["topK"]);a!=null&&g(n,["topK"],a);let l=f(e,["candidateCount"]);l!=null&&g(n,["candidateCount"],l);let c=f(e,["maxOutputTokens"]);c!=null&&g(n,["maxOutputTokens"],c);let d=f(e,["stopSequences"]);d!=null&&g(n,["stopSequences"],d);let h=f(e,["responseLogprobs"]);h!=null&&g(n,["responseLogprobs"],h);let p=f(e,["logprobs"]);p!=null&&g(n,["logprobs"],p);let m=f(e,["presencePenalty"]);m!=null&&g(n,["presencePenalty"],m);let y=f(e,["frequencyPenalty"]);y!=null&&g(n,["frequencyPenalty"],y);let v=f(e,["seed"]);v!=null&&g(n,["seed"],v);let E=f(e,["responseMimeType"]);E!=null&&g(n,["responseMimeType"],E);let A=f(e,["responseSchema"]);A!=null&&g(n,["responseSchema"],cE(A));let _=f(e,["responseJsonSchema"]);if(_!=null&&g(n,["responseJsonSchema"],_),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let C=f(e,["safetySettings"]);if(t!==void 0&&C!=null){let J=C;Array.isArray(J)&&(J=J.map(Z=>qM(Z))),g(t,["safetySettings"],J)}let T=f(e,["tools"]);if(t!==void 0&&T!=null){let J=Ca(T);Array.isArray(J)&&(J=J.map(Z=>YM(_a(Z)))),g(t,["tools"],J)}let R=f(e,["toolConfig"]);if(t!==void 0&&R!=null&&g(t,["toolConfig"],WM(R)),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let I=f(e,["cachedContent"]);t!==void 0&&I!=null&&g(t,["cachedContent"],Ii(i,I));let D=f(e,["responseModalities"]);D!=null&&g(n,["responseModalities"],D);let k=f(e,["mediaResolution"]);k!=null&&g(n,["mediaResolution"],k);let N=f(e,["speechConfig"]);if(N!=null&&g(n,["speechConfig"],dE(N)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=f(e,["thinkingConfig"]);F!=null&&g(n,["thinkingConfig"],F);let U=f(e,["imageConfig"]);U!=null&&g(n,["imageConfig"],FM(U));let re=f(e,["enableEnhancedCivicAnswers"]);return re!=null&&g(n,["enableEnhancedCivicAnswers"],re),n}function DM(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>hM(c))),g(e,["candidates"],l)}let s=f(i,["modelVersion"]);s!=null&&g(e,["modelVersion"],s);let r=f(i,["promptFeedback"]);r!=null&&g(e,["promptFeedback"],r);let o=f(i,["responseId"]);o!=null&&g(e,["responseId"],o);let a=f(i,["usageMetadata"]);return a!=null&&g(e,["usageMetadata"],a),e}function PM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ta(i,n)),t}function MM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ta(i,n)),t}function kM(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function NM(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function FM(i){let e={},t=f(i,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);let n=f(i,["imageSize"]);if(n!=null&&g(e,["imageSize"],n),f(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function LM(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["request","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let a=on(s);Array.isArray(a)&&(a=a.map(l=>t0(l))),g(t,["request","contents"],a)}let r=f(e,["metadata"]);r!=null&&g(t,["metadata"],r);let o=f(e,["config"]);return o!=null&&g(t,["request","generationConfig"],IM(i,o,f(t,["request"],{}))),t}function OM(i){let e={},t=f(i,["response"]);t!=null&&g(e,["response"],DM(t));let n=f(i,["error"]);return n!=null&&g(e,["error"],n),e}function UM(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);if(e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),f(i,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function HM(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);e!==void 0&&s!=null&&g(e,["_query","pageToken"],s);let r=f(i,["filter"]);return e!==void 0&&r!=null&&g(e,["_query","filter"],r),t}function BM(i){let e={},t=f(i,["config"]);return t!=null&&UM(t,e),e}function VM(i){let e={},t=f(i,["config"]);return t!=null&&HM(t,e),e}function GM(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["operations"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>qf(o))),g(e,["batchJobs"],r)}return e}function $M(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["batchPredictionJobs"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>xb(o))),g(e,["batchJobs"],r)}return e}function zM(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],TM(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],xM(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],cM(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function qM(i){let e={},t=f(i,["category"]);if(t!=null&&g(e,["category"],t),f(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=f(i,["threshold"]);return n!=null&&g(e,["threshold"],n),e}function WM(i){let e={},t=f(i,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],RM(t));let n=f(i,["retrievalConfig"]);return n!=null&&g(e,["retrievalConfig"],n),e}function YM(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],kM(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],NM(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}var xi;(function(i){i.PAGED_ITEM_BATCH_JOBS="batchJobs",i.PAGED_ITEM_MODELS="models",i.PAGED_ITEM_TUNING_JOBS="tuningJobs",i.PAGED_ITEM_FILES="files",i.PAGED_ITEM_CACHED_CONTENTS="cachedContents",i.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",i.PAGED_ITEM_DOCUMENTS="documents"})(xi||(xi={}));var Ri=class{constructor(e,t,n,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,s)}init(e,t,n){var s,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};!n||Object.keys(n).length===0?o={config:{}}:typeof n=="object"?o=Object.assign({},n):o=n,o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(r=(s=o.config)===null||s===void 0?void 0:s.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var Rb=class extends Sn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ri(xi.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){let t=ET(this.apiClient,e),n=t._url,s=O("{model}:batchGenerateContent",n),a=t.batch.inputConfig.requests,l=a.requests,c=[];for(let d of l){let h=Object.assign({},d);if(h.systemInstruction){let p=h.systemInstruction;delete h.systemInstruction;let m=h.request;m.systemInstruction=p,h.request=m}c.push(h)}return a.requests=c,delete t.config,delete t._url,delete t._query,{path:s,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},s=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${s}`),n.dest===void 0){let r=this.getGcsUri(e),o=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?n.dest=`${r.slice(0,-6)}/dest`:n.dest=`${r}_dest_${s}`;else if(o)n.dest=`${o}_dest_${s}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=mM(this.apiClient,e);return a=O("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>xb(d))}else{let c=ET(this.apiClient,e);return a=O("{model}:batchGenerateContent",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>qf(d))}}async createEmbeddingsInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=vM(this.apiClient,e);return r=O("{model}:asyncBatchEmbedContent",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>qf(l))}}async get(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=MM(this.apiClient,e);return a=O("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>xb(d))}else{let c=PM(this.apiClient,e);return a=O("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>qf(d))}}async cancel(e){var t,n,s,r;let o="",a={};if(this.apiClient.isVertexAI()){let l=uM(this.apiClient,e);o=O("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{let l=dM(this.apiClient,e);o=O("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=VM(e);return a=O("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=$M(d),p=new sp;return Object.assign(p,h),p})}else{let c=BM(e);return a=O("batches",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=GM(d),p=new sp;return Object.assign(p,h),p})}}async delete(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=EM(this.apiClient,e);return a=O("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>AM(d))}else{let c=bM(this.apiClient,e);return a=O("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>wM(d))}}};function KM(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function wT(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>yk(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function XM(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);e!==void 0&&s!=null&&g(e,["expireTime"],s);let r=f(i,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);let o=f(i,["contents"]);if(e!==void 0&&o!=null){let d=on(o);Array.isArray(d)&&(d=d.map(h=>wT(h))),g(e,["contents"],d)}let a=f(i,["systemInstruction"]);e!==void 0&&a!=null&&g(e,["systemInstruction"],wT(ot(a)));let l=f(i,["tools"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(h=>bk(h))),g(e,["tools"],d)}let c=f(i,["toolConfig"]);if(e!==void 0&&c!=null&&g(e,["toolConfig"],vk(c)),f(i,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function JM(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);e!==void 0&&s!=null&&g(e,["expireTime"],s);let r=f(i,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);let o=f(i,["contents"]);if(e!==void 0&&o!=null){let h=on(o);Array.isArray(h)&&(h=h.map(p=>p)),g(e,["contents"],h)}let a=f(i,["systemInstruction"]);e!==void 0&&a!=null&&g(e,["systemInstruction"],ot(a));let l=f(i,["tools"]);if(e!==void 0&&l!=null){let h=l;Array.isArray(h)&&(h=h.map(p=>Ek(p))),g(e,["tools"],h)}let c=f(i,["toolConfig"]);e!==void 0&&c!=null&&g(e,["toolConfig"],c);let d=f(i,["kmsKeyName"]);return e!==void 0&&d!=null&&g(e,["encryption_spec","kmsKeyName"],d),t}function ZM(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["model"],$T(i,n));let s=f(e,["config"]);return s!=null&&XM(s,t),t}function jM(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["model"],$T(i,n));let s=f(e,["config"]);return s!=null&&JM(s,t),t}function QM(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ii(i,n)),t}function ek(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ii(i,n)),t}function tk(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function nk(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function ik(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function sk(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function rk(i){let e={},t=f(i,["mode"]);t!=null&&g(e,["mode"],t);let n=f(i,["allowedFunctionNames"]);if(n!=null&&g(e,["allowedFunctionNames"],n),f(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function ok(i){let e={};if(f(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=f(i,["description"]);t!=null&&g(e,["description"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["parameters"]);s!=null&&g(e,["parameters"],s);let r=f(i,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);let o=f(i,["response"]);o!=null&&g(e,["response"],o);let a=f(i,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function ak(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ii(i,n)),t}function lk(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Ii(i,n)),t}function ck(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function dk(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function uk(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function hk(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function fk(i){let e={},t=f(i,["config"]);return t!=null&&uk(t,e),e}function pk(i){let e={},t=f(i,["config"]);return t!=null&&hk(t,e),e}function gk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["cachedContents"],r)}return e}function mk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["cachedContents"],r)}return e}function yk(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],ik(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],sk(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],KM(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function vk(i){let e={},t=f(i,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],rk(t));let n=f(i,["retrievalConfig"]);return n!=null&&g(e,["retrievalConfig"],n),e}function bk(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],ck(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],dk(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function Ek(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(p=>ok(p))),g(e,["functionDeclarations"],h)}let n=f(i,["retrieval"]);n!=null&&g(e,["retrieval"],n);let s=f(i,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);let r=f(i,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=f(i,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);let a=f(i,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);let l=f(i,["googleMaps"]);l!=null&&g(e,["googleMaps"],l);let c=f(i,["googleSearch"]);c!=null&&g(e,["googleSearch"],c);let d=f(i,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function wk(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);return e!==void 0&&s!=null&&g(e,["expireTime"],s),t}function Ak(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);return e!==void 0&&s!=null&&g(e,["expireTime"],s),t}function Sk(i,e){let t={},n=f(e,["name"]);n!=null&&g(t,["_url","name"],Ii(i,n));let s=f(e,["config"]);return s!=null&&wk(s,t),t}function _k(i,e){let t={},n=f(e,["name"]);n!=null&&g(t,["_url","name"],Ii(i,n));let s=f(e,["config"]);return s!=null&&Ak(s,t),t}var Ib=class extends Sn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ri(xi.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=jM(this.apiClient,e);return a=O("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let c=ZM(this.apiClient,e);return a=O("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async get(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=lk(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let c=ak(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async delete(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=ek(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=nk(d),p=new np;return Object.assign(p,h),p})}else{let c=QM(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=tk(d),p=new np;return Object.assign(p,h),p})}}async update(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=_k(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let c=Sk(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=pk(e);return a=O("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=mk(d),p=new ip;return Object.assign(p,h),p})}else{let c=fk(e);return a=O("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=gk(d),p=new ip;return Object.assign(p,h),p})}}};function op(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t}function AT(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function X(i){return this instanceof X?(this.v=i,this):new X(i)}function wn(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),s,r=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(m){return function(y){return Promise.resolve(y).then(m,h)}}function a(m,y){n[m]&&(s[m]=function(v){return new Promise(function(E,A){r.push([m,v,E,A])>1||l(m,v)})},y&&(s[m]=y(s[m])))}function l(m,y){try{c(n[m](y))}catch(v){p(r[0][3],v)}}function c(m){m.value instanceof X?Promise.resolve(m.value.v).then(d,h):p(r[0][2],m)}function d(m){l("next",m)}function h(m){l("throw",m)}function p(m,y){m(y),r.shift(),r.length&&l(r[0][0],r[0][1])}}function An(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof AT=="function"?AT(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=i[r]&&function(o){return new Promise(function(a,l){o=i[r](o),s(a,l,o.done,o.value)})}}function s(r,o,a,l){Promise.resolve(l).then(function(c){r({value:c,done:a})},o)}}function Ck(i){var e;if(i.candidates==null||i.candidates.length===0)return!1;let t=(e=i.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:n0(t)}function n0(i){if(i.parts===void 0||i.parts.length===0)return!1;for(let e of i.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function Tk(i){if(i.length!==0){for(let e of i)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function ST(i){if(i===void 0||i.length===0)return[];let e=[],t=i.length,n=0;for(;n<t;)if(i[n].role==="user")e.push(i[n]),n++;else{let s=[],r=!0;for(;n<t&&i[n].role==="model";)s.push(i[n]),r&&!n0(i[n])&&(r=!1),n++;r?e.push(...s):e.pop()}return e}var Db=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Pb(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},Pb=class{constructor(e,t,n,s={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=s,this.history=r,this.sendPromise=Promise.resolve(),Tk(r)}async sendMessage(e){var t;await this.sendPromise;let n=ot(e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,o,a;let l=await s,c=(o=(r=l.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content,d=l.automaticFunctionCallingHistory,h=this.getHistory(!0).length,p=[];d!=null&&(p=(a=d.slice(h))!==null&&a!==void 0?a:[]);let m=c?[c]:[];this.recordHistory(n,m,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(e){var t;await this.sendPromise;let n=ot(e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});let r=await s;return this.processStreamResponse(r,n)}getHistory(e=!1){let t=e?ST(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return wn(this,arguments,function*(){var s,r,o,a,l,c;let d=[];try{for(var h=!0,p=An(e),m;m=yield X(p.next()),s=m.done,!s;h=!0){a=m.value,h=!1;let y=a;if(Ck(y)){let v=(c=(l=y.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content;v!==void 0&&d.push(v)}yield yield X(y)}}catch(y){r={error:y}}finally{try{!h&&!s&&(o=p.return)&&(yield X(o.call(p)))}finally{if(r)throw r.error}}this.recordHistory(t,d)})}recordHistory(e,t,n){let s=[];t.length>0&&t.every(r=>r.role!==void 0)?s=t:s.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...ST(n)):this.history.push(e),this.history.push(...s)}};var ap=class i extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,i.prototype)}};function xk(i){let e={},t=f(i,["file"]);return t!=null&&g(e,["file"],t),e}function Rk(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function Ik(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","file"],XT(t)),e}function Dk(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function Pk(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","file"],XT(t)),e}function Mk(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function kk(i){let e={},t=f(i,["config"]);return t!=null&&Mk(t,e),e}function Nk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["files"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["files"],r)}return e}var Mb=class extends Sn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ri(xi.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=kk(e);return r=O("files",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=Nk(l),d=new Eb;return Object.assign(d,c),d})}}async createInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=xk(e);return r=O("upload/v1beta/files",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=Rk(l),d=new wb;return Object.assign(d,c),d})}}async get(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Pk(e);return r=O("files/{file}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Ik(e);return r=O("files/{file}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=Dk(l),d=new Ab;return Object.assign(d,c),d})}}};function Wf(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function Fk(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>Zk(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function Lk(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function Ok(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Uk(i){let e={};if(f(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=f(i,["description"]);t!=null&&g(e,["description"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["parameters"]);s!=null&&g(e,["parameters"],s);let r=f(i,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);let o=f(i,["response"]);o!=null&&g(e,["response"],o);let a=f(i,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function Hk(i){let e={},t=f(i,["modelSelectionConfig"]);t!=null&&g(e,["modelConfig"],t);let n=f(i,["responseJsonSchema"]);n!=null&&g(e,["responseJsonSchema"],n);let s=f(i,["audioTimestamp"]);s!=null&&g(e,["audioTimestamp"],s);let r=f(i,["candidateCount"]);r!=null&&g(e,["candidateCount"],r);let o=f(i,["enableAffectiveDialog"]);o!=null&&g(e,["enableAffectiveDialog"],o);let a=f(i,["frequencyPenalty"]);a!=null&&g(e,["frequencyPenalty"],a);let l=f(i,["logprobs"]);l!=null&&g(e,["logprobs"],l);let c=f(i,["maxOutputTokens"]);c!=null&&g(e,["maxOutputTokens"],c);let d=f(i,["mediaResolution"]);d!=null&&g(e,["mediaResolution"],d);let h=f(i,["presencePenalty"]);h!=null&&g(e,["presencePenalty"],h);let p=f(i,["responseLogprobs"]);p!=null&&g(e,["responseLogprobs"],p);let m=f(i,["responseMimeType"]);m!=null&&g(e,["responseMimeType"],m);let y=f(i,["responseModalities"]);y!=null&&g(e,["responseModalities"],y);let v=f(i,["responseSchema"]);v!=null&&g(e,["responseSchema"],v);let E=f(i,["routingConfig"]);E!=null&&g(e,["routingConfig"],E);let A=f(i,["seed"]);A!=null&&g(e,["seed"],A);let _=f(i,["speechConfig"]);_!=null&&g(e,["speechConfig"],_);let C=f(i,["stopSequences"]);C!=null&&g(e,["stopSequences"],C);let T=f(i,["temperature"]);T!=null&&g(e,["temperature"],T);let R=f(i,["thinkingConfig"]);R!=null&&g(e,["thinkingConfig"],R);let I=f(i,["topK"]);I!=null&&g(e,["topK"],I);let D=f(i,["topP"]);if(D!=null&&g(e,["topP"],D),f(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Bk(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function Vk(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function Gk(i,e){let t={},n=f(i,["generationConfig"]);e!==void 0&&n!=null&&g(e,["setup","generationConfig"],n);let s=f(i,["responseModalities"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig","responseModalities"],s);let r=f(i,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);let o=f(i,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);let a=f(i,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);let l=f(i,["maxOutputTokens"]);e!==void 0&&l!=null&&g(e,["setup","generationConfig","maxOutputTokens"],l);let c=f(i,["mediaResolution"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","mediaResolution"],c);let d=f(i,["seed"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","seed"],d);let h=f(i,["speechConfig"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","speechConfig"],uE(h));let p=f(i,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);let m=f(i,["enableAffectiveDialog"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=f(i,["systemInstruction"]);e!==void 0&&y!=null&&g(e,["setup","systemInstruction"],Fk(ot(y)));let v=f(i,["tools"]);if(e!==void 0&&v!=null){let I=Ca(v);Array.isArray(I)&&(I=I.map(D=>Qk(_a(D)))),g(e,["setup","tools"],I)}let E=f(i,["sessionResumption"]);e!==void 0&&E!=null&&g(e,["setup","sessionResumption"],jk(E));let A=f(i,["inputAudioTranscription"]);e!==void 0&&A!=null&&g(e,["setup","inputAudioTranscription"],A);let _=f(i,["outputAudioTranscription"]);e!==void 0&&_!=null&&g(e,["setup","outputAudioTranscription"],_);let C=f(i,["realtimeInputConfig"]);e!==void 0&&C!=null&&g(e,["setup","realtimeInputConfig"],C);let T=f(i,["contextWindowCompression"]);e!==void 0&&T!=null&&g(e,["setup","contextWindowCompression"],T);let R=f(i,["proactivity"]);if(e!==void 0&&R!=null&&g(e,["setup","proactivity"],R),f(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function $k(i,e){let t={},n=f(i,["generationConfig"]);e!==void 0&&n!=null&&g(e,["setup","generationConfig"],Hk(n));let s=f(i,["responseModalities"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig","responseModalities"],s);let r=f(i,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);let o=f(i,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);let a=f(i,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);let l=f(i,["maxOutputTokens"]);e!==void 0&&l!=null&&g(e,["setup","generationConfig","maxOutputTokens"],l);let c=f(i,["mediaResolution"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","mediaResolution"],c);let d=f(i,["seed"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","seed"],d);let h=f(i,["speechConfig"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","speechConfig"],uE(h));let p=f(i,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);let m=f(i,["enableAffectiveDialog"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=f(i,["systemInstruction"]);e!==void 0&&y!=null&&g(e,["setup","systemInstruction"],ot(y));let v=f(i,["tools"]);if(e!==void 0&&v!=null){let D=Ca(v);Array.isArray(D)&&(D=D.map(k=>eN(_a(k)))),g(e,["setup","tools"],D)}let E=f(i,["sessionResumption"]);e!==void 0&&E!=null&&g(e,["setup","sessionResumption"],E);let A=f(i,["inputAudioTranscription"]);e!==void 0&&A!=null&&g(e,["setup","inputAudioTranscription"],A);let _=f(i,["outputAudioTranscription"]);e!==void 0&&_!=null&&g(e,["setup","outputAudioTranscription"],_);let C=f(i,["realtimeInputConfig"]);e!==void 0&&C!=null&&g(e,["setup","realtimeInputConfig"],C);let T=f(i,["contextWindowCompression"]);e!==void 0&&T!=null&&g(e,["setup","contextWindowCompression"],T);let R=f(i,["proactivity"]);e!==void 0&&R!=null&&g(e,["setup","proactivity"],R);let I=f(i,["explicitVadSignal"]);return e!==void 0&&I!=null&&g(e,["setup","explicitVadSignal"],I),t}function zk(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["setup","model"],ce(i,n));let s=f(e,["config"]);return s!=null&&g(t,["config"],Gk(s,t)),t}function qk(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["setup","model"],ce(i,n));let s=f(e,["config"]);return s!=null&&g(t,["config"],$k(s,t)),t}function Wk(i){let e={},t=f(i,["musicGenerationConfig"]);return t!=null&&g(e,["musicGenerationConfig"],t),e}function Yk(i){let e={},t=f(i,["weightedPrompts"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),g(e,["weightedPrompts"],n)}return e}function Kk(i){let e={},t=f(i,["media"]);if(t!=null){let c=zT(t);Array.isArray(c)&&(c=c.map(d=>Wf(d))),g(e,["mediaChunks"],c)}let n=f(i,["audio"]);n!=null&&g(e,["audio"],Wf(WT(n)));let s=f(i,["audioStreamEnd"]);s!=null&&g(e,["audioStreamEnd"],s);let r=f(i,["video"]);r!=null&&g(e,["video"],Wf(qT(r)));let o=f(i,["text"]);o!=null&&g(e,["text"],o);let a=f(i,["activityStart"]);a!=null&&g(e,["activityStart"],a);let l=f(i,["activityEnd"]);return l!=null&&g(e,["activityEnd"],l),e}function Xk(i){let e={},t=f(i,["media"]);if(t!=null){let c=zT(t);Array.isArray(c)&&(c=c.map(d=>d)),g(e,["mediaChunks"],c)}let n=f(i,["audio"]);n!=null&&g(e,["audio"],WT(n));let s=f(i,["audioStreamEnd"]);s!=null&&g(e,["audioStreamEnd"],s);let r=f(i,["video"]);r!=null&&g(e,["video"],qT(r));let o=f(i,["text"]);o!=null&&g(e,["text"],o);let a=f(i,["activityStart"]);a!=null&&g(e,["activityStart"],a);let l=f(i,["activityEnd"]);return l!=null&&g(e,["activityEnd"],l),e}function Jk(i){let e={},t=f(i,["setupComplete"]);t!=null&&g(e,["setupComplete"],t);let n=f(i,["serverContent"]);n!=null&&g(e,["serverContent"],n);let s=f(i,["toolCall"]);s!=null&&g(e,["toolCall"],s);let r=f(i,["toolCallCancellation"]);r!=null&&g(e,["toolCallCancellation"],r);let o=f(i,["usageMetadata"]);o!=null&&g(e,["usageMetadata"],tN(o));let a=f(i,["goAway"]);a!=null&&g(e,["goAway"],a);let l=f(i,["sessionResumptionUpdate"]);l!=null&&g(e,["sessionResumptionUpdate"],l);let c=f(i,["voiceActivityDetectionSignal"]);return c!=null&&g(e,["voiceActivityDetectionSignal"],c),e}function Zk(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],Lk(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],Ok(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],Wf(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function jk(i){let e={},t=f(i,["handle"]);if(t!=null&&g(e,["handle"],t),f(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Qk(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],Bk(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],Vk(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function eN(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(p=>Uk(p))),g(e,["functionDeclarations"],h)}let n=f(i,["retrieval"]);n!=null&&g(e,["retrieval"],n);let s=f(i,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);let r=f(i,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=f(i,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);let a=f(i,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);let l=f(i,["googleMaps"]);l!=null&&g(e,["googleMaps"],l);let c=f(i,["googleSearch"]);c!=null&&g(e,["googleSearch"],c);let d=f(i,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function tN(i){let e={},t=f(i,["promptTokenCount"]);t!=null&&g(e,["promptTokenCount"],t);let n=f(i,["cachedContentTokenCount"]);n!=null&&g(e,["cachedContentTokenCount"],n);let s=f(i,["candidatesTokenCount"]);s!=null&&g(e,["responseTokenCount"],s);let r=f(i,["toolUsePromptTokenCount"]);r!=null&&g(e,["toolUsePromptTokenCount"],r);let o=f(i,["thoughtsTokenCount"]);o!=null&&g(e,["thoughtsTokenCount"],o);let a=f(i,["totalTokenCount"]);a!=null&&g(e,["totalTokenCount"],a);let l=f(i,["promptTokensDetails"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["promptTokensDetails"],m)}let c=f(i,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["cacheTokensDetails"],m)}let d=f(i,["candidatesTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["responseTokensDetails"],m)}let h=f(i,["toolUsePromptTokensDetails"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["toolUsePromptTokensDetails"],m)}let p=f(i,["trafficType"]);return p!=null&&g(e,["trafficType"],p),e}function nN(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function iN(i){let e={},t=f(i,["content"]);t!=null&&g(e,["content"],t);let n=f(i,["citationMetadata"]);n!=null&&g(e,["citationMetadata"],sN(n));let s=f(i,["tokenCount"]);s!=null&&g(e,["tokenCount"],s);let r=f(i,["finishReason"]);r!=null&&g(e,["finishReason"],r);let o=f(i,["avgLogprobs"]);o!=null&&g(e,["avgLogprobs"],o);let a=f(i,["groundingMetadata"]);a!=null&&g(e,["groundingMetadata"],a);let l=f(i,["index"]);l!=null&&g(e,["index"],l);let c=f(i,["logprobsResult"]);c!=null&&g(e,["logprobsResult"],c);let d=f(i,["safetyRatings"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>m)),g(e,["safetyRatings"],p)}let h=f(i,["urlContextMetadata"]);return h!=null&&g(e,["urlContextMetadata"],h),e}function sN(i){let e={},t=f(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),g(e,["citations"],n)}return e}function rN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let r=on(s);Array.isArray(r)&&(r=r.map(o=>o)),g(t,["contents"],r)}return t}function oN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["tokensInfo"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),g(e,["tokensInfo"],s)}return e}function aN(i){let e={},t=f(i,["values"]);t!=null&&g(e,["values"],t);let n=f(i,["statistics"]);return n!=null&&g(e,["statistics"],lN(n)),e}function lN(i){let e={},t=f(i,["truncated"]);t!=null&&g(e,["truncated"],t);let n=f(i,["token_count"]);return n!=null&&g(e,["tokenCount"],n),e}function _p(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>yF(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function cN(i){let e={},t=f(i,["controlType"]);t!=null&&g(e,["controlType"],t);let n=f(i,["enableControlImageComputation"]);return n!=null&&g(e,["computeControl"],n),e}function dN(i){let e={};if(f(i,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(f(i,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(f(i,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function uN(i,e){let t={},n=f(i,["systemInstruction"]);e!==void 0&&n!=null&&g(e,["systemInstruction"],ot(n));let s=f(i,["tools"]);if(e!==void 0&&s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>o0(a))),g(e,["tools"],o)}let r=f(i,["generationConfig"]);return e!==void 0&&r!=null&&g(e,["generationConfig"],nF(r)),t}function hN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=on(s);Array.isArray(o)&&(o=o.map(a=>_p(a))),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&dN(r),t}function fN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=on(s);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&uN(r,t),t}function pN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["totalTokens"]);n!=null&&g(e,["totalTokens"],n);let s=f(i,["cachedContentTokenCount"]);return s!=null&&g(e,["cachedContentTokenCount"],s),e}function gN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["totalTokens"]);return n!=null&&g(e,["totalTokens"],n),e}function mN(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],ce(i,n)),t}function yN(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],ce(i,n)),t}function vN(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function bN(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function EN(i,e){let t={},n=f(i,["outputGcsUri"]);e!==void 0&&n!=null&&g(e,["parameters","storageUri"],n);let s=f(i,["negativePrompt"]);e!==void 0&&s!=null&&g(e,["parameters","negativePrompt"],s);let r=f(i,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);let o=f(i,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);let a=f(i,["guidanceScale"]);e!==void 0&&a!=null&&g(e,["parameters","guidanceScale"],a);let l=f(i,["seed"]);e!==void 0&&l!=null&&g(e,["parameters","seed"],l);let c=f(i,["safetyFilterLevel"]);e!==void 0&&c!=null&&g(e,["parameters","safetySetting"],c);let d=f(i,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);let h=f(i,["includeSafetyAttributes"]);e!==void 0&&h!=null&&g(e,["parameters","includeSafetyAttributes"],h);let p=f(i,["includeRaiReason"]);e!==void 0&&p!=null&&g(e,["parameters","includeRaiReason"],p);let m=f(i,["language"]);e!==void 0&&m!=null&&g(e,["parameters","language"],m);let y=f(i,["outputMimeType"]);e!==void 0&&y!=null&&g(e,["parameters","outputOptions","mimeType"],y);let v=f(i,["outputCompressionQuality"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","compressionQuality"],v);let E=f(i,["addWatermark"]);e!==void 0&&E!=null&&g(e,["parameters","addWatermark"],E);let A=f(i,["labels"]);e!==void 0&&A!=null&&g(e,["labels"],A);let _=f(i,["editMode"]);e!==void 0&&_!=null&&g(e,["parameters","editMode"],_);let C=f(i,["baseSteps"]);return e!==void 0&&C!=null&&g(e,["parameters","editConfig","baseSteps"],C),t}function wN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["referenceImages"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>SF(l))),g(t,["instances[0]","referenceImages"],a)}let o=f(e,["config"]);return o!=null&&EN(o,t),t}function AN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>Cp(r))),g(e,["generatedImages"],s)}return e}function SN(i,e){let t={},n=f(i,["taskType"]);e!==void 0&&n!=null&&g(e,["requests[]","taskType"],n);let s=f(i,["title"]);e!==void 0&&s!=null&&g(e,["requests[]","title"],s);let r=f(i,["outputDimensionality"]);if(e!==void 0&&r!=null&&g(e,["requests[]","outputDimensionality"],r),f(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function _N(i,e){let t={},n=f(i,["taskType"]);e!==void 0&&n!=null&&g(e,["instances[]","task_type"],n);let s=f(i,["title"]);e!==void 0&&s!=null&&g(e,["instances[]","title"],s);let r=f(i,["outputDimensionality"]);e!==void 0&&r!=null&&g(e,["parameters","outputDimensionality"],r);let o=f(i,["mimeType"]);e!==void 0&&o!=null&&g(e,["instances[]","mimeType"],o);let a=f(i,["autoTruncate"]);return e!==void 0&&a!=null&&g(e,["parameters","autoTruncate"],a),t}function CN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let a=lE(i,s);Array.isArray(a)&&(a=a.map(l=>l)),g(t,["requests[]","content"],a)}let r=f(e,["config"]);r!=null&&SN(r,t);let o=f(e,["model"]);return o!==void 0&&g(t,["requests[]","model"],ce(i,o)),t}function TN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=lE(i,s);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["instances[]","content"],o)}let r=f(e,["config"]);return r!=null&&_N(r,t),t}function xN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["embeddings"],r)}let s=f(i,["metadata"]);return s!=null&&g(e,["metadata"],s),e}function RN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions[]","embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>aN(o))),g(e,["embeddings"],r)}let s=f(i,["metadata"]);return s!=null&&g(e,["metadata"],s),e}function IN(i){let e={},t=f(i,["endpoint"]);t!=null&&g(e,["name"],t);let n=f(i,["deployedModelId"]);return n!=null&&g(e,["deployedModelId"],n),e}function DN(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function PN(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function MN(i){let e={},t=f(i,["mode"]);t!=null&&g(e,["mode"],t);let n=f(i,["allowedFunctionNames"]);if(n!=null&&g(e,["allowedFunctionNames"],n),f(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function kN(i){let e={};if(f(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=f(i,["description"]);t!=null&&g(e,["description"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["parameters"]);s!=null&&g(e,["parameters"],s);let r=f(i,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);let o=f(i,["response"]);o!=null&&g(e,["response"],o);let a=f(i,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function NN(i,e,t){let n={},s=f(e,["systemInstruction"]);t!==void 0&&s!=null&&g(t,["systemInstruction"],_p(ot(s)));let r=f(e,["temperature"]);r!=null&&g(n,["temperature"],r);let o=f(e,["topP"]);o!=null&&g(n,["topP"],o);let a=f(e,["topK"]);a!=null&&g(n,["topK"],a);let l=f(e,["candidateCount"]);l!=null&&g(n,["candidateCount"],l);let c=f(e,["maxOutputTokens"]);c!=null&&g(n,["maxOutputTokens"],c);let d=f(e,["stopSequences"]);d!=null&&g(n,["stopSequences"],d);let h=f(e,["responseLogprobs"]);h!=null&&g(n,["responseLogprobs"],h);let p=f(e,["logprobs"]);p!=null&&g(n,["logprobs"],p);let m=f(e,["presencePenalty"]);m!=null&&g(n,["presencePenalty"],m);let y=f(e,["frequencyPenalty"]);y!=null&&g(n,["frequencyPenalty"],y);let v=f(e,["seed"]);v!=null&&g(n,["seed"],v);let E=f(e,["responseMimeType"]);E!=null&&g(n,["responseMimeType"],E);let A=f(e,["responseSchema"]);A!=null&&g(n,["responseSchema"],cE(A));let _=f(e,["responseJsonSchema"]);if(_!=null&&g(n,["responseJsonSchema"],_),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let C=f(e,["safetySettings"]);if(t!==void 0&&C!=null){let J=C;Array.isArray(J)&&(J=J.map(Z=>_F(Z))),g(t,["safetySettings"],J)}let T=f(e,["tools"]);if(t!==void 0&&T!=null){let J=Ca(T);Array.isArray(J)&&(J=J.map(Z=>PF(_a(Z)))),g(t,["tools"],J)}let R=f(e,["toolConfig"]);if(t!==void 0&&R!=null&&g(t,["toolConfig"],DF(R)),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let I=f(e,["cachedContent"]);t!==void 0&&I!=null&&g(t,["cachedContent"],Ii(i,I));let D=f(e,["responseModalities"]);D!=null&&g(n,["responseModalities"],D);let k=f(e,["mediaResolution"]);k!=null&&g(n,["mediaResolution"],k);let N=f(e,["speechConfig"]);if(N!=null&&g(n,["speechConfig"],dE(N)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=f(e,["thinkingConfig"]);F!=null&&g(n,["thinkingConfig"],F);let U=f(e,["imageConfig"]);U!=null&&g(n,["imageConfig"],aF(U));let re=f(e,["enableEnhancedCivicAnswers"]);return re!=null&&g(n,["enableEnhancedCivicAnswers"],re),n}function FN(i,e,t){let n={},s=f(e,["systemInstruction"]);t!==void 0&&s!=null&&g(t,["systemInstruction"],ot(s));let r=f(e,["temperature"]);r!=null&&g(n,["temperature"],r);let o=f(e,["topP"]);o!=null&&g(n,["topP"],o);let a=f(e,["topK"]);a!=null&&g(n,["topK"],a);let l=f(e,["candidateCount"]);l!=null&&g(n,["candidateCount"],l);let c=f(e,["maxOutputTokens"]);c!=null&&g(n,["maxOutputTokens"],c);let d=f(e,["stopSequences"]);d!=null&&g(n,["stopSequences"],d);let h=f(e,["responseLogprobs"]);h!=null&&g(n,["responseLogprobs"],h);let p=f(e,["logprobs"]);p!=null&&g(n,["logprobs"],p);let m=f(e,["presencePenalty"]);m!=null&&g(n,["presencePenalty"],m);let y=f(e,["frequencyPenalty"]);y!=null&&g(n,["frequencyPenalty"],y);let v=f(e,["seed"]);v!=null&&g(n,["seed"],v);let E=f(e,["responseMimeType"]);E!=null&&g(n,["responseMimeType"],E);let A=f(e,["responseSchema"]);A!=null&&g(n,["responseSchema"],cE(A));let _=f(e,["responseJsonSchema"]);_!=null&&g(n,["responseJsonSchema"],_);let C=f(e,["routingConfig"]);C!=null&&g(n,["routingConfig"],C);let T=f(e,["modelSelectionConfig"]);T!=null&&g(n,["modelConfig"],T);let R=f(e,["safetySettings"]);if(t!==void 0&&R!=null){let L=R;Array.isArray(L)&&(L=L.map(q=>q)),g(t,["safetySettings"],L)}let I=f(e,["tools"]);if(t!==void 0&&I!=null){let L=Ca(I);Array.isArray(L)&&(L=L.map(q=>o0(_a(q)))),g(t,["tools"],L)}let D=f(e,["toolConfig"]);t!==void 0&&D!=null&&g(t,["toolConfig"],D);let k=f(e,["labels"]);t!==void 0&&k!=null&&g(t,["labels"],k);let N=f(e,["cachedContent"]);t!==void 0&&N!=null&&g(t,["cachedContent"],Ii(i,N));let F=f(e,["responseModalities"]);F!=null&&g(n,["responseModalities"],F);let U=f(e,["mediaResolution"]);U!=null&&g(n,["mediaResolution"],U);let re=f(e,["speechConfig"]);re!=null&&g(n,["speechConfig"],dE(re));let J=f(e,["audioTimestamp"]);J!=null&&g(n,["audioTimestamp"],J);let Z=f(e,["thinkingConfig"]);Z!=null&&g(n,["thinkingConfig"],Z);let Ge=f(e,["imageConfig"]);if(Ge!=null&&g(n,["imageConfig"],lF(Ge)),f(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function _T(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=on(s);Array.isArray(o)&&(o=o.map(a=>_p(a))),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&g(t,["generationConfig"],NN(i,r,t)),t}function CT(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["contents"]);if(s!=null){let o=on(s);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&g(t,["generationConfig"],FN(i,r,t)),t}function TT(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>iN(c))),g(e,["candidates"],l)}let s=f(i,["modelVersion"]);s!=null&&g(e,["modelVersion"],s);let r=f(i,["promptFeedback"]);r!=null&&g(e,["promptFeedback"],r);let o=f(i,["responseId"]);o!=null&&g(e,["responseId"],o);let a=f(i,["usageMetadata"]);return a!=null&&g(e,["usageMetadata"],a),e}function xT(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>d)),g(e,["candidates"],c)}let s=f(i,["createTime"]);s!=null&&g(e,["createTime"],s);let r=f(i,["modelVersion"]);r!=null&&g(e,["modelVersion"],r);let o=f(i,["promptFeedback"]);o!=null&&g(e,["promptFeedback"],o);let a=f(i,["responseId"]);a!=null&&g(e,["responseId"],a);let l=f(i,["usageMetadata"]);return l!=null&&g(e,["usageMetadata"],l),e}function LN(i,e){let t={};if(f(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(i,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let n=f(i,["numberOfImages"]);e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n);let s=f(i,["aspectRatio"]);e!==void 0&&s!=null&&g(e,["parameters","aspectRatio"],s);let r=f(i,["guidanceScale"]);if(e!==void 0&&r!=null&&g(e,["parameters","guidanceScale"],r),f(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=f(i,["safetyFilterLevel"]);e!==void 0&&o!=null&&g(e,["parameters","safetySetting"],o);let a=f(i,["personGeneration"]);e!==void 0&&a!=null&&g(e,["parameters","personGeneration"],a);let l=f(i,["includeSafetyAttributes"]);e!==void 0&&l!=null&&g(e,["parameters","includeSafetyAttributes"],l);let c=f(i,["includeRaiReason"]);e!==void 0&&c!=null&&g(e,["parameters","includeRaiReason"],c);let d=f(i,["language"]);e!==void 0&&d!=null&&g(e,["parameters","language"],d);let h=f(i,["outputMimeType"]);e!==void 0&&h!=null&&g(e,["parameters","outputOptions","mimeType"],h);let p=f(i,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&g(e,["parameters","outputOptions","compressionQuality"],p),f(i,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(f(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let m=f(i,["imageSize"]);if(e!==void 0&&m!=null&&g(e,["parameters","sampleImageSize"],m),f(i,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function ON(i,e){let t={},n=f(i,["outputGcsUri"]);e!==void 0&&n!=null&&g(e,["parameters","storageUri"],n);let s=f(i,["negativePrompt"]);e!==void 0&&s!=null&&g(e,["parameters","negativePrompt"],s);let r=f(i,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);let o=f(i,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);let a=f(i,["guidanceScale"]);e!==void 0&&a!=null&&g(e,["parameters","guidanceScale"],a);let l=f(i,["seed"]);e!==void 0&&l!=null&&g(e,["parameters","seed"],l);let c=f(i,["safetyFilterLevel"]);e!==void 0&&c!=null&&g(e,["parameters","safetySetting"],c);let d=f(i,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);let h=f(i,["includeSafetyAttributes"]);e!==void 0&&h!=null&&g(e,["parameters","includeSafetyAttributes"],h);let p=f(i,["includeRaiReason"]);e!==void 0&&p!=null&&g(e,["parameters","includeRaiReason"],p);let m=f(i,["language"]);e!==void 0&&m!=null&&g(e,["parameters","language"],m);let y=f(i,["outputMimeType"]);e!==void 0&&y!=null&&g(e,["parameters","outputOptions","mimeType"],y);let v=f(i,["outputCompressionQuality"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","compressionQuality"],v);let E=f(i,["addWatermark"]);e!==void 0&&E!=null&&g(e,["parameters","addWatermark"],E);let A=f(i,["labels"]);e!==void 0&&A!=null&&g(e,["labels"],A);let _=f(i,["imageSize"]);e!==void 0&&_!=null&&g(e,["parameters","sampleImageSize"],_);let C=f(i,["enhancePrompt"]);return e!==void 0&&C!=null&&g(e,["parameters","enhancePrompt"],C),t}function UN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["config"]);return r!=null&&LN(r,t),t}function HN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["config"]);return r!=null&&ON(r,t),t}function BN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>jN(o))),g(e,["generatedImages"],r)}let s=f(i,["positivePromptSafetyAttributes"]);return s!=null&&g(e,["positivePromptSafetyAttributes"],s0(s)),e}function VN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Cp(o))),g(e,["generatedImages"],r)}let s=f(i,["positivePromptSafetyAttributes"]);return s!=null&&g(e,["positivePromptSafetyAttributes"],r0(s)),e}function GN(i,e){let t={},n=f(i,["numberOfVideos"]);if(e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n),f(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(i,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let s=f(i,["durationSeconds"]);if(e!==void 0&&s!=null&&g(e,["parameters","durationSeconds"],s),f(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let r=f(i,["aspectRatio"]);e!==void 0&&r!=null&&g(e,["parameters","aspectRatio"],r);let o=f(i,["resolution"]);e!==void 0&&o!=null&&g(e,["parameters","resolution"],o);let a=f(i,["personGeneration"]);if(e!==void 0&&a!=null&&g(e,["parameters","personGeneration"],a),f(i,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let l=f(i,["negativePrompt"]);e!==void 0&&l!=null&&g(e,["parameters","negativePrompt"],l);let c=f(i,["enhancePrompt"]);if(e!==void 0&&c!=null&&g(e,["parameters","enhancePrompt"],c),f(i,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let d=f(i,["lastFrame"]);e!==void 0&&d!=null&&g(e,["instances[0]","lastFrame"],Tp(d));let h=f(i,["referenceImages"]);if(e!==void 0&&h!=null){let p=h;Array.isArray(p)&&(p=p.map(m=>zF(m))),g(e,["instances[0]","referenceImages"],p)}if(f(i,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(f(i,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function $N(i,e){let t={},n=f(i,["numberOfVideos"]);e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n);let s=f(i,["outputGcsUri"]);e!==void 0&&s!=null&&g(e,["parameters","storageUri"],s);let r=f(i,["fps"]);e!==void 0&&r!=null&&g(e,["parameters","fps"],r);let o=f(i,["durationSeconds"]);e!==void 0&&o!=null&&g(e,["parameters","durationSeconds"],o);let a=f(i,["seed"]);e!==void 0&&a!=null&&g(e,["parameters","seed"],a);let l=f(i,["aspectRatio"]);e!==void 0&&l!=null&&g(e,["parameters","aspectRatio"],l);let c=f(i,["resolution"]);e!==void 0&&c!=null&&g(e,["parameters","resolution"],c);let d=f(i,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);let h=f(i,["pubsubTopic"]);e!==void 0&&h!=null&&g(e,["parameters","pubsubTopic"],h);let p=f(i,["negativePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","negativePrompt"],p);let m=f(i,["enhancePrompt"]);e!==void 0&&m!=null&&g(e,["parameters","enhancePrompt"],m);let y=f(i,["generateAudio"]);e!==void 0&&y!=null&&g(e,["parameters","generateAudio"],y);let v=f(i,["lastFrame"]);e!==void 0&&v!=null&&g(e,["instances[0]","lastFrame"],_n(v));let E=f(i,["referenceImages"]);if(e!==void 0&&E!=null){let C=E;Array.isArray(C)&&(C=C.map(T=>qF(T))),g(e,["instances[0]","referenceImages"],C)}let A=f(i,["mask"]);e!==void 0&&A!=null&&g(e,["instances[0]","mask"],$F(A));let _=f(i,["compressionQuality"]);return e!==void 0&&_!=null&&g(e,["parameters","compressionQuality"],_),t}function zN(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response","generateVideoResponse"]);return o!=null&&g(e,["response"],KN(o)),e}function qN(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],XN(o)),e}function WN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["image"]);r!=null&&g(t,["instances[0]","image"],Tp(r));let o=f(e,["video"]);o!=null&&g(t,["instances[0]","video"],a0(o));let a=f(e,["source"]);a!=null&&JN(a,t);let l=f(e,["config"]);return l!=null&&GN(l,t),t}function YN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["image"]);r!=null&&g(t,["instances[0]","image"],_n(r));let o=f(e,["video"]);o!=null&&g(t,["instances[0]","video"],l0(o));let a=f(e,["source"]);a!=null&&ZN(a,t);let l=f(e,["config"]);return l!=null&&$N(l,t),t}function KN(i){let e={},t=f(i,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>eF(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function XN(i){let e={},t=f(i,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>tF(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function JN(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["image"]);e!==void 0&&s!=null&&g(e,["instances[0]","image"],Tp(s));let r=f(i,["video"]);return e!==void 0&&r!=null&&g(e,["instances[0]","video"],a0(r)),t}function ZN(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["image"]);e!==void 0&&s!=null&&g(e,["instances[0]","image"],_n(s));let r=f(i,["video"]);return e!==void 0&&r!=null&&g(e,["instances[0]","video"],l0(r)),t}function jN(i){let e={},t=f(i,["_self"]);t!=null&&g(e,["image"],cF(t));let n=f(i,["raiFilteredReason"]);n!=null&&g(e,["raiFilteredReason"],n);let s=f(i,["_self"]);return s!=null&&g(e,["safetyAttributes"],s0(s)),e}function Cp(i){let e={},t=f(i,["_self"]);t!=null&&g(e,["image"],i0(t));let n=f(i,["raiFilteredReason"]);n!=null&&g(e,["raiFilteredReason"],n);let s=f(i,["_self"]);s!=null&&g(e,["safetyAttributes"],r0(s));let r=f(i,["prompt"]);return r!=null&&g(e,["enhancedPrompt"],r),e}function QN(i){let e={},t=f(i,["_self"]);t!=null&&g(e,["mask"],i0(t));let n=f(i,["labels"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),g(e,["labels"],s)}return e}function eF(i){let e={},t=f(i,["video"]);return t!=null&&g(e,["video"],VF(t)),e}function tF(i){let e={},t=f(i,["_self"]);return t!=null&&g(e,["video"],GF(t)),e}function nF(i){let e={},t=f(i,["modelSelectionConfig"]);t!=null&&g(e,["modelConfig"],t);let n=f(i,["responseJsonSchema"]);n!=null&&g(e,["responseJsonSchema"],n);let s=f(i,["audioTimestamp"]);s!=null&&g(e,["audioTimestamp"],s);let r=f(i,["candidateCount"]);r!=null&&g(e,["candidateCount"],r);let o=f(i,["enableAffectiveDialog"]);o!=null&&g(e,["enableAffectiveDialog"],o);let a=f(i,["frequencyPenalty"]);a!=null&&g(e,["frequencyPenalty"],a);let l=f(i,["logprobs"]);l!=null&&g(e,["logprobs"],l);let c=f(i,["maxOutputTokens"]);c!=null&&g(e,["maxOutputTokens"],c);let d=f(i,["mediaResolution"]);d!=null&&g(e,["mediaResolution"],d);let h=f(i,["presencePenalty"]);h!=null&&g(e,["presencePenalty"],h);let p=f(i,["responseLogprobs"]);p!=null&&g(e,["responseLogprobs"],p);let m=f(i,["responseMimeType"]);m!=null&&g(e,["responseMimeType"],m);let y=f(i,["responseModalities"]);y!=null&&g(e,["responseModalities"],y);let v=f(i,["responseSchema"]);v!=null&&g(e,["responseSchema"],v);let E=f(i,["routingConfig"]);E!=null&&g(e,["routingConfig"],E);let A=f(i,["seed"]);A!=null&&g(e,["seed"],A);let _=f(i,["speechConfig"]);_!=null&&g(e,["speechConfig"],_);let C=f(i,["stopSequences"]);C!=null&&g(e,["stopSequences"],C);let T=f(i,["temperature"]);T!=null&&g(e,["temperature"],T);let R=f(i,["thinkingConfig"]);R!=null&&g(e,["thinkingConfig"],R);let I=f(i,["topK"]);I!=null&&g(e,["topK"],I);let D=f(i,["topP"]);if(D!=null&&g(e,["topP"],D),f(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function iF(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],ce(i,n)),t}function sF(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],ce(i,n)),t}function rF(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function oF(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function aF(i){let e={},t=f(i,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);let n=f(i,["imageSize"]);if(n!=null&&g(e,["imageSize"],n),f(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function lF(i){let e={},t=f(i,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);let n=f(i,["imageSize"]);n!=null&&g(e,["imageSize"],n);let s=f(i,["outputMimeType"]);s!=null&&g(e,["imageOutputOptions","mimeType"],s);let r=f(i,["outputCompressionQuality"]);return r!=null&&g(e,["imageOutputOptions","compressionQuality"],r),e}function cF(i){let e={},t=f(i,["bytesBase64Encoded"]);t!=null&&g(e,["imageBytes"],vs(t));let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function i0(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["gcsUri"],t);let n=f(i,["bytesBase64Encoded"]);n!=null&&g(e,["imageBytes"],vs(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function Tp(i){let e={};if(f(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=f(i,["imageBytes"]);t!=null&&g(e,["bytesBase64Encoded"],vs(t));let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function _n(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["gcsUri"],t);let n=f(i,["imageBytes"]);n!=null&&g(e,["bytesBase64Encoded"],vs(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function dF(i,e,t){let n={},s=f(e,["pageSize"]);t!==void 0&&s!=null&&g(t,["_query","pageSize"],s);let r=f(e,["pageToken"]);t!==void 0&&r!=null&&g(t,["_query","pageToken"],r);let o=f(e,["filter"]);t!==void 0&&o!=null&&g(t,["_query","filter"],o);let a=f(e,["queryBase"]);return t!==void 0&&a!=null&&g(t,["_url","models_url"],JT(i,a)),n}function uF(i,e,t){let n={},s=f(e,["pageSize"]);t!==void 0&&s!=null&&g(t,["_query","pageSize"],s);let r=f(e,["pageToken"]);t!==void 0&&r!=null&&g(t,["_query","pageToken"],r);let o=f(e,["filter"]);t!==void 0&&o!=null&&g(t,["_query","filter"],o);let a=f(e,["queryBase"]);return t!==void 0&&a!=null&&g(t,["_url","models_url"],JT(i,a)),n}function hF(i,e){let t={},n=f(e,["config"]);return n!=null&&dF(i,n,t),t}function fF(i,e){let t={},n=f(e,["config"]);return n!=null&&uF(i,n,t),t}function pF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["_self"]);if(s!=null){let r=ZT(s);Array.isArray(r)&&(r=r.map(o=>kb(o))),g(e,["models"],r)}return e}function gF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["_self"]);if(s!=null){let r=ZT(s);Array.isArray(r)&&(r=r.map(o=>Nb(o))),g(e,["models"],r)}return e}function mF(i){let e={},t=f(i,["maskMode"]);t!=null&&g(e,["maskMode"],t);let n=f(i,["segmentationClasses"]);n!=null&&g(e,["maskClasses"],n);let s=f(i,["maskDilation"]);return s!=null&&g(e,["dilation"],s),e}function kb(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);s!=null&&g(e,["description"],s);let r=f(i,["version"]);r!=null&&g(e,["version"],r);let o=f(i,["_self"]);o!=null&&g(e,["tunedModelInfo"],MF(o));let a=f(i,["inputTokenLimit"]);a!=null&&g(e,["inputTokenLimit"],a);let l=f(i,["outputTokenLimit"]);l!=null&&g(e,["outputTokenLimit"],l);let c=f(i,["supportedGenerationMethods"]);c!=null&&g(e,["supportedActions"],c);let d=f(i,["temperature"]);d!=null&&g(e,["temperature"],d);let h=f(i,["maxTemperature"]);h!=null&&g(e,["maxTemperature"],h);let p=f(i,["topP"]);p!=null&&g(e,["topP"],p);let m=f(i,["topK"]);m!=null&&g(e,["topK"],m);let y=f(i,["thinking"]);return y!=null&&g(e,["thinking"],y),e}function Nb(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);s!=null&&g(e,["description"],s);let r=f(i,["versionId"]);r!=null&&g(e,["version"],r);let o=f(i,["deployedModels"]);if(o!=null){let h=o;Array.isArray(h)&&(h=h.map(p=>IN(p))),g(e,["endpoints"],h)}let a=f(i,["labels"]);a!=null&&g(e,["labels"],a);let l=f(i,["_self"]);l!=null&&g(e,["tunedModelInfo"],kF(l));let c=f(i,["defaultCheckpointId"]);c!=null&&g(e,["defaultCheckpointId"],c);let d=f(i,["checkpoints"]);if(d!=null){let h=d;Array.isArray(h)&&(h=h.map(p=>p)),g(e,["checkpoints"],h)}return e}function yF(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],DN(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],PN(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],nN(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function vF(i){let e={},t=f(i,["productImage"]);return t!=null&&g(e,["image"],_n(t)),e}function bF(i,e){let t={},n=f(i,["numberOfImages"]);e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n);let s=f(i,["baseSteps"]);e!==void 0&&s!=null&&g(e,["parameters","baseSteps"],s);let r=f(i,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);let o=f(i,["seed"]);e!==void 0&&o!=null&&g(e,["parameters","seed"],o);let a=f(i,["safetyFilterLevel"]);e!==void 0&&a!=null&&g(e,["parameters","safetySetting"],a);let l=f(i,["personGeneration"]);e!==void 0&&l!=null&&g(e,["parameters","personGeneration"],l);let c=f(i,["addWatermark"]);e!==void 0&&c!=null&&g(e,["parameters","addWatermark"],c);let d=f(i,["outputMimeType"]);e!==void 0&&d!=null&&g(e,["parameters","outputOptions","mimeType"],d);let h=f(i,["outputCompressionQuality"]);e!==void 0&&h!=null&&g(e,["parameters","outputOptions","compressionQuality"],h);let p=f(i,["enhancePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","enhancePrompt"],p);let m=f(i,["labels"]);return e!==void 0&&m!=null&&g(e,["labels"],m),t}function EF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["source"]);s!=null&&AF(s,t);let r=f(e,["config"]);return r!=null&&bF(r,t),t}function wF(i){let e={},t=f(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>Cp(s))),g(e,["generatedImages"],n)}return e}function AF(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["personImage"]);e!==void 0&&s!=null&&g(e,["instances[0]","personImage","image"],_n(s));let r=f(i,["productImages"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>vF(a))),g(e,["instances[0]","productImages"],o)}return t}function SF(i){let e={},t=f(i,["referenceImage"]);t!=null&&g(e,["referenceImage"],_n(t));let n=f(i,["referenceId"]);n!=null&&g(e,["referenceId"],n);let s=f(i,["referenceType"]);s!=null&&g(e,["referenceType"],s);let r=f(i,["maskImageConfig"]);r!=null&&g(e,["maskImageConfig"],mF(r));let o=f(i,["controlImageConfig"]);o!=null&&g(e,["controlImageConfig"],cN(o));let a=f(i,["styleImageConfig"]);a!=null&&g(e,["styleImageConfig"],a);let l=f(i,["subjectImageConfig"]);return l!=null&&g(e,["subjectImageConfig"],l),e}function s0(i){let e={},t=f(i,["safetyAttributes","categories"]);t!=null&&g(e,["categories"],t);let n=f(i,["safetyAttributes","scores"]);n!=null&&g(e,["scores"],n);let s=f(i,["contentType"]);return s!=null&&g(e,["contentType"],s),e}function r0(i){let e={},t=f(i,["safetyAttributes","categories"]);t!=null&&g(e,["categories"],t);let n=f(i,["safetyAttributes","scores"]);n!=null&&g(e,["scores"],n);let s=f(i,["contentType"]);return s!=null&&g(e,["contentType"],s),e}function _F(i){let e={},t=f(i,["category"]);if(t!=null&&g(e,["category"],t),f(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=f(i,["threshold"]);return n!=null&&g(e,["threshold"],n),e}function CF(i){let e={},t=f(i,["image"]);return t!=null&&g(e,["image"],_n(t)),e}function TF(i,e){let t={},n=f(i,["mode"]);e!==void 0&&n!=null&&g(e,["parameters","mode"],n);let s=f(i,["maxPredictions"]);e!==void 0&&s!=null&&g(e,["parameters","maxPredictions"],s);let r=f(i,["confidenceThreshold"]);e!==void 0&&r!=null&&g(e,["parameters","confidenceThreshold"],r);let o=f(i,["maskDilation"]);e!==void 0&&o!=null&&g(e,["parameters","maskDilation"],o);let a=f(i,["binaryColorThreshold"]);e!==void 0&&a!=null&&g(e,["parameters","binaryColorThreshold"],a);let l=f(i,["labels"]);return e!==void 0&&l!=null&&g(e,["labels"],l),t}function xF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["source"]);s!=null&&IF(s,t);let r=f(e,["config"]);return r!=null&&TF(r,t),t}function RF(i){let e={},t=f(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>QN(s))),g(e,["generatedMasks"],n)}return e}function IF(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["image"]);e!==void 0&&s!=null&&g(e,["instances[0]","image"],_n(s));let r=f(i,["scribbleImage"]);return e!==void 0&&r!=null&&g(e,["instances[0]","scribble"],CF(r)),t}function DF(i){let e={},t=f(i,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],MN(t));let n=f(i,["retrievalConfig"]);return n!=null&&g(e,["retrievalConfig"],n),e}function PF(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],rF(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],oF(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function o0(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(p=>kN(p))),g(e,["functionDeclarations"],h)}let n=f(i,["retrieval"]);n!=null&&g(e,["retrieval"],n);let s=f(i,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);let r=f(i,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=f(i,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);let a=f(i,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);let l=f(i,["googleMaps"]);l!=null&&g(e,["googleMaps"],l);let c=f(i,["googleSearch"]);c!=null&&g(e,["googleSearch"],c);let d=f(i,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function MF(i){let e={},t=f(i,["baseModel"]);t!=null&&g(e,["baseModel"],t);let n=f(i,["createTime"]);n!=null&&g(e,["createTime"],n);let s=f(i,["updateTime"]);return s!=null&&g(e,["updateTime"],s),e}function kF(i){let e={},t=f(i,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&g(e,["baseModel"],t);let n=f(i,["createTime"]);n!=null&&g(e,["createTime"],n);let s=f(i,["updateTime"]);return s!=null&&g(e,["updateTime"],s),e}function NF(i,e){let t={},n=f(i,["displayName"]);e!==void 0&&n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);e!==void 0&&s!=null&&g(e,["description"],s);let r=f(i,["defaultCheckpointId"]);return e!==void 0&&r!=null&&g(e,["defaultCheckpointId"],r),t}function FF(i,e){let t={},n=f(i,["displayName"]);e!==void 0&&n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);e!==void 0&&s!=null&&g(e,["description"],s);let r=f(i,["defaultCheckpointId"]);return e!==void 0&&r!=null&&g(e,["defaultCheckpointId"],r),t}function LF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","name"],ce(i,n));let s=f(e,["config"]);return s!=null&&NF(s,t),t}function OF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["config"]);return s!=null&&FF(s,t),t}function UF(i,e){let t={},n=f(i,["outputGcsUri"]);e!==void 0&&n!=null&&g(e,["parameters","storageUri"],n);let s=f(i,["safetyFilterLevel"]);e!==void 0&&s!=null&&g(e,["parameters","safetySetting"],s);let r=f(i,["personGeneration"]);e!==void 0&&r!=null&&g(e,["parameters","personGeneration"],r);let o=f(i,["includeRaiReason"]);e!==void 0&&o!=null&&g(e,["parameters","includeRaiReason"],o);let a=f(i,["outputMimeType"]);e!==void 0&&a!=null&&g(e,["parameters","outputOptions","mimeType"],a);let l=f(i,["outputCompressionQuality"]);e!==void 0&&l!=null&&g(e,["parameters","outputOptions","compressionQuality"],l);let c=f(i,["enhanceInputImage"]);e!==void 0&&c!=null&&g(e,["parameters","upscaleConfig","enhanceInputImage"],c);let d=f(i,["imagePreservationFactor"]);e!==void 0&&d!=null&&g(e,["parameters","upscaleConfig","imagePreservationFactor"],d);let h=f(i,["labels"]);e!==void 0&&h!=null&&g(e,["labels"],h);let p=f(i,["numberOfImages"]);e!==void 0&&p!=null&&g(e,["parameters","sampleCount"],p);let m=f(i,["mode"]);return e!==void 0&&m!=null&&g(e,["parameters","mode"],m),t}function HF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],ce(i,n));let s=f(e,["image"]);s!=null&&g(t,["instances[0]","image"],_n(s));let r=f(e,["upscaleFactor"]);r!=null&&g(t,["parameters","upscaleConfig","upscaleFactor"],r);let o=f(e,["config"]);return o!=null&&UF(o,t),t}function BF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>Cp(r))),g(e,["generatedImages"],s)}return e}function VF(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["uri"],t);let n=f(i,["encodedVideo"]);n!=null&&g(e,["videoBytes"],vs(n));let s=f(i,["encoding"]);return s!=null&&g(e,["mimeType"],s),e}function GF(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["uri"],t);let n=f(i,["bytesBase64Encoded"]);n!=null&&g(e,["videoBytes"],vs(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function $F(i){let e={},t=f(i,["image"]);t!=null&&g(e,["_self"],_n(t));let n=f(i,["maskMode"]);return n!=null&&g(e,["maskMode"],n),e}function zF(i){let e={},t=f(i,["image"]);t!=null&&g(e,["image"],Tp(t));let n=f(i,["referenceType"]);return n!=null&&g(e,["referenceType"],n),e}function qF(i){let e={},t=f(i,["image"]);t!=null&&g(e,["image"],_n(t));let n=f(i,["referenceType"]);return n!=null&&g(e,["referenceType"],n),e}function a0(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["uri"],t);let n=f(i,["videoBytes"]);n!=null&&g(e,["encodedVideo"],vs(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["encoding"],s),e}function l0(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["gcsUri"],t);let n=f(i,["videoBytes"]);n!=null&&g(e,["bytesBase64Encoded"],vs(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function WF(i,e){let t={},n=f(i,["displayName"]);return e!==void 0&&n!=null&&g(e,["displayName"],n),t}function YF(i){let e={},t=f(i,["config"]);return t!=null&&WF(t,e),e}function KF(i,e){let t={},n=f(i,["force"]);return e!==void 0&&n!=null&&g(e,["_query","force"],n),t}function XF(i){let e={},t=f(i,["name"]);t!=null&&g(e,["_url","name"],t);let n=f(i,["config"]);return n!=null&&KF(n,e),e}function JF(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","name"],t),e}function ZF(i,e){let t={},n=f(i,["customMetadata"]);if(e!==void 0&&n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["customMetadata"],r)}let s=f(i,["chunkingConfig"]);return e!==void 0&&s!=null&&g(e,["chunkingConfig"],s),t}function jF(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],eL(o)),e}function QF(i){let e={},t=f(i,["fileSearchStoreName"]);t!=null&&g(e,["_url","file_search_store_name"],t);let n=f(i,["fileName"]);n!=null&&g(e,["fileName"],n);let s=f(i,["config"]);return s!=null&&ZF(s,e),e}function eL(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["parent"]);n!=null&&g(e,["parent"],n);let s=f(i,["documentName"]);return s!=null&&g(e,["documentName"],s),e}function tL(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function nL(i){let e={},t=f(i,["config"]);return t!=null&&tL(t,e),e}function iL(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["fileSearchStores"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["fileSearchStores"],r)}return e}function c0(i,e){let t={},n=f(i,["mimeType"]);e!==void 0&&n!=null&&g(e,["mimeType"],n);let s=f(i,["displayName"]);e!==void 0&&s!=null&&g(e,["displayName"],s);let r=f(i,["customMetadata"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>l)),g(e,["customMetadata"],a)}let o=f(i,["chunkingConfig"]);return e!==void 0&&o!=null&&g(e,["chunkingConfig"],o),t}function sL(i){let e={},t=f(i,["fileSearchStoreName"]);t!=null&&g(e,["_url","file_search_store_name"],t);let n=f(i,["config"]);return n!=null&&c0(n,e),e}function rL(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}var oL="Content-Type",aL="X-Server-Timeout",lL="User-Agent",Fb="x-goog-api-client",cL="1.34.0",dL=`google-genai-sdk/${cL}`,uL="v1beta1",hL="v1beta",Lb=class{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let s={};this.clientOptions.vertexai?(s.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:uL,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:hL,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let s=[this.getRequestUrlInternal(t)];return n&&s.push(this.getBaseResourcePath()),e!==""&&s.push(e),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[o,a]of Object.entries(e.queryParams))s.searchParams.append(o,String(a));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.unaryApiCall(s,r,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[s,r]of Object.entries(t))typeof r=="object"?n[s]=Object.assign(Object.assign({},n[s]),r):r!==void 0&&(n[s]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.streamApiCall(s,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,s){if(t&&t.timeout||s){let r=new AbortController,o=r.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){let a=setTimeout(()=>r.abort(),t.timeout);a&&typeof a.unref=="function"&&a.unref()}s&&s.addEventListener("abort",()=>{r.abort()}),e.signal=o}return t&&t.extraBody!==null&&fL(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await RT(s),new Vc(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await RT(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(e){return wn(this,arguments,function*(){var n;let s=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let o="",a="data:",l=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:c,value:d}=yield X(s.read());if(c){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let h=r.decode(d,{stream:!0});try{let y=JSON.parse(h);if("error"in y){let v=JSON.parse(JSON.stringify(y.error)),E=v.status,A=v.code,_=`got status: ${E}. ${JSON.stringify(y)}`;if(A>=400&&A<600)throw new ap({message:_,status:A})}}catch(y){if(y.name==="ApiError")throw y}o+=h;let p=-1,m=0;for(;;){p=-1,m=0;for(let E of l){let A=o.indexOf(E);A!==-1&&(p===-1||A<p)&&(p=A,m=E.length)}if(p===-1)break;let y=o.substring(0,p);o=o.substring(p+m);let v=y.trim();if(v.startsWith(a)){let E=v.substring(a.length).trim();try{let A=new Response(E,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield X(new Vc(A))}catch(A){throw new Error(`exception parsing stream chunk ${E}. ${A}`)}}}}}finally{s.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){let e={},t=dL+" "+this.clientOptions.userAgentExtra;return e[lL]=t,e[Fb]=t,e[oL]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[s,r]of Object.entries(e.headers))n.append(s,r);e.timeout&&e.timeout>0&&n.append(aL,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(t=n.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),n}async uploadFile(e,t){var n;let s={};t!=null&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);let r=this.clientOptions.uploader,o=await r.stat(e);s.sizeBytes=String(o.size);let a=(n=t==null?void 0:t.mimeType)!==null&&n!==void 0?n:o.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=a;let l={file:s},c=this.getFileName(e),d=O("upload/v1beta/files",l._url),h=await this.fetchUploadUrl(d,s.sizeBytes,s.mimeType,c,l,t==null?void 0:t.httpOptions);return r.upload(e,h,this)}async uploadFileToFileSearchStore(e,t,n){var s;let r=this.clientOptions.uploader,o=await r.stat(t),a=String(o.size),l=(s=n==null?void 0:n.mimeType)!==null&&s!==void 0?s:o.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let c=`upload/v1beta/${e}:uploadToFileSearchStore`,d=this.getFileName(t),h={};n!=null&&c0(n,h);let p=await this.fetchUploadUrl(c,a,l,d,h,n==null?void 0:n.httpOptions);return r.uploadToFileSearchStore(t,p,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,s,r,o){var a;let l={};o?l=o:l={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},s?{"X-Goog-Upload-File-Name":s}:{})};let c=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:l});if(!c||!(c!=null&&c.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let d=(a=c==null?void 0:c.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(d===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return d}};async function RT(i){var e;if(i===void 0)throw new Error("response is undefined");if(!i.ok){let t=i.status,n;!((e=i.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await i.json():n={error:{message:await i.text(),code:i.status,status:i.statusText}};let s=JSON.stringify(n);throw t>=400&&t<600?new ap({message:s,status:t}):new Error(s)}}function fL(i,e){if(!e||Object.keys(e).length===0)return;if(i.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof i.body=="string"&&i.body.length>0)try{let r=JSON.parse(i.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))t=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch(r){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(r,o){let a=Object.assign({},r);for(let l in o)if(Object.prototype.hasOwnProperty.call(o,l)){let c=o[l],d=a[l];c&&typeof c=="object"&&!Array.isArray(c)&&d&&typeof d=="object"&&!Array.isArray(d)?a[l]=n(d,c):(d&&c&&typeof d!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof d}, New type: ${typeof c}. Overwriting.`),a[l]=c)}return a}let s=n(t,e);i.body=JSON.stringify(s)}var pL="mcp_used/unknown",gL=!1;function d0(i){for(let e of i)if(mL(e)||typeof e=="object"&&"inputSchema"in e)return!0;return gL}function u0(i){var e;let t=(e=i[Fb])!==null&&e!==void 0?e:"";i[Fb]=(t+` ${pL}`).trimStart()}function mL(i){return i!==null&&typeof i=="object"&&i instanceof Ob}function yL(i){return wn(this,arguments,function*(t,n=100){let s,r=0;for(;r<n;){let o=yield X(t.listTools({cursor:s}));for(let a of o.tools)yield yield X(a),r++;if(!o.nextCursor)break;s=o.nextCursor}})}var Ob=class i{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new i(e,t)}async initialize(){var e,t,n,s;if(this.mcpTools.length>0)return;let r={},o=[];for(let d of this.mcpClients)try{for(var a=!0,l=(t=void 0,An(yL(d))),c;c=await l.next(),e=c.done,!e;a=!0){s=c.value,a=!1;let h=s;o.push(h);let p=h.name;if(r[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);r[p]=d}}catch(h){t={error:h}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),tM(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let s=this.functionNameToMcpClient[n.name],r;this.config.timeout&&(r={timeout:this.config.timeout});let o=await s.callTool({name:n.name,arguments:n.args},void 0,r);t.push({functionResponse:{name:n.name,response:o.isError?{error:o}:o}})}return t}};async function vL(i,e,t){let n=new _b,s;t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data),Object.assign(n,s),e(n)}var Ub=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let s=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),o=EL(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${s}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${a}`,c=()=>{},d=new Promise(C=>{c=C}),h=e.callbacks,p=function(){c({})},m=this.apiClient,y={onopen:p,onmessage:C=>{vL(m,h.onmessage,C)},onerror:(t=h==null?void 0:h.onerror)!==null&&t!==void 0?t:function(C){},onclose:(n=h==null?void 0:h.onclose)!==null&&n!==void 0?n:function(C){}},v=this.webSocketFactory.create(l,bL(o),y);v.connect(),await d;let _={setup:{model:ce(this.apiClient,e.model)}};return v.send(JSON.stringify(_)),new Hb(v,this.apiClient)}},Hb=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=Yk(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=Wk(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(ba.PLAY)}pause(){this.sendPlaybackControl(ba.PAUSE)}stop(){this.sendPlaybackControl(ba.STOP)}resetContext(){this.sendPlaybackControl(ba.RESET_CONTEXT)}close(){this.conn.close()}};function bL(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function EL(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var wL="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function AL(i,e,t){let n=new Sb,s;t.data instanceof Blob?s=await t.data.text():t.data instanceof ArrayBuffer?s=new TextDecoder().decode(t.data):s=t.data;let r=JSON.parse(s);if(i.isVertexAI()){let o=Jk(r);Object.assign(n,o)}else Object.assign(n,r);e(n)}var Bb=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new Ub(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,s,r,o,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),d,h=this.apiClient.getHeaders();e.config&&e.config.tools&&d0(e.config.tools)&&u0(h);let p=CL(h);if(this.apiClient.isVertexAI())d=`${l}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p,d);else{let N=this.apiClient.getApiKey(),F="BidiGenerateContent",U="key";N!=null&&N.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),F="BidiGenerateContentConstrained",U="access_token"),d=`${l}/ws/google.ai.generativelanguage.${c}.GenerativeService.${F}?${U}=${N}`}let m=()=>{},y=new Promise(N=>{m=N}),v=e.callbacks,E=function(){var N;(N=v==null?void 0:v.onopen)===null||N===void 0||N.call(v),m({})},A=this.apiClient,_={onopen:E,onmessage:N=>{AL(A,v.onmessage,N)},onerror:(t=v==null?void 0:v.onerror)!==null&&t!==void 0?t:function(N){},onclose:(n=v==null?void 0:v.onclose)!==null&&n!==void 0?n:function(N){}},C=this.webSocketFactory.create(d,_L(p),_);C.connect(),await y;let T=ce(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&T.startsWith("publishers/")){let N=this.apiClient.getProject(),F=this.apiClient.getLocation();T=`projects/${N}/locations/${F}/`+T}let R={};this.apiClient.isVertexAI()&&((s=e.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Yf.AUDIO]}:e.config.responseModalities=[Yf.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let I=(a=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[],D=[];for(let N of I)if(this.isCallableTool(N)){let F=N;D.push(await F.tool())}else D.push(N);D.length>0&&(e.config.tools=D);let k={model:T,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?R=qk(this.apiClient,k):R=zk(this.apiClient,k),delete R.config,C.send(JSON.stringify(R)),new Vb(C,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},SL={turnComplete:!0},Vb=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=on(t.turns),e.isVertexAI()||(n=n.map(s=>_p(s)))}catch(s){throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(let r of n){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(wL)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},SL),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:Xk(e)}:t={realtimeInput:Kk(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function _L(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function CL(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var IT=10;function DT(i){var e,t,n;if(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let s=!1;for(let o of(t=i==null?void 0:i.tools)!==null&&t!==void 0?t:[])if(wa(o)){s=!0;break}if(!s)return!0;let r=(n=i==null?void 0:i.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function wa(i){return"callTool"in i&&typeof i.callTool=="function"}function TL(i){var e,t,n;return(n=(t=(e=i.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>wa(s)))!==null&&n!==void 0?n:!1}function PT(i){var e;let t=[];return!((e=i==null?void 0:i.config)===null||e===void 0)&&e.tools&&i.config.tools.forEach((n,s)=>{if(wa(n))return;let r=n;r.functionDeclarations&&r.functionDeclarations.length>0&&t.push(s)}),t}function MT(i){var e;return!(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var Gb=class extends Sn{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,s,r,o,a;let l=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!TL(t)||DT(t.config))return await this.generateContentInternal(l);let c=PT(t);if(c.length>0){let v=c.map(E=>`tools[${E}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${v}.`)}let d,h,p=on(l.contents),m=(r=(s=(n=l.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&r!==void 0?r:IT,y=0;for(;y<m&&(d=await this.generateContentInternal(l),!(!d.functionCalls||d.functionCalls.length===0));){let v=d.candidates[0].content,E=[];for(let A of(a=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[])if(wa(A)){let C=await A.callTool(d.functionCalls);E.push(...C)}y++,h={role:"user",parts:E},l.contents=on(l.contents),l.contents.push(v),l.contents.push(h),MT(l.config)&&(p.push(v),p.push(h))}return MT(l.config)&&(d.automaticFunctionCallingHistory=p),d},this.generateContentStream=async t=>{var n,s,r,o,a;if(this.maybeMoveToResponseJsonSchem(t),DT(t.config)){let h=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(h)}let l=PT(t);if(l.length>0){let h=l.map(p=>`tools[${p}]`).join(", ");throw new Error(`Incompatible tools found at ${h}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let c=(r=(s=(n=t==null?void 0:t.config)===null||n===void 0?void 0:n.toolConfig)===null||s===void 0?void 0:s.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,d=(a=(o=t==null?void 0:t.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(c&&!d)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var s;let r,o=[];if(n!=null&&n.generatedImages)for(let l of n.generatedImages)l&&(l!=null&&l.safetyAttributes)&&((s=l==null?void 0:l.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?r=l==null?void 0:l.safetyAttributes:o.push(l);let a;return r?a={generatedImages:o,positivePromptSafetyAttributes:r,sdkHttpResponse:n.sdkHttpResponse}:a={generatedImages:o,sdkHttpResponse:n.sdkHttpResponse},a}),this.list=async t=>{var n;let o={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((n=o.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new Ri(xi.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(o),o)},this.editImage=async t=>{let n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));let s={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(s)},this.generateVideos=async t=>{var n,s,r,o,a,l;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=t.video)===null||n===void 0)&&n.uri&&(!((s=t.video)===null||s===void 0)&&s.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((o=(r=t.source)===null||r===void 0?void 0:r.video)===null||o===void 0)&&o.uri&&(!((l=(a=t.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,s;let r=(t=e.config)===null||t===void 0?void 0:t.tools;if(!r)return e;let o=await Promise.all(r.map(async l=>wa(l)?await l.tool():l)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(a.config.tools=o,e.config&&e.config.tools&&d0(e.config.tools)){let l=(s=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&s!==void 0?s:{},c=Object.assign({},l);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),u0(c),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return a}async initAfcToolsMap(e){var t,n,s;let r=new Map;for(let o of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(wa(o)){let a=o,l=await a.tool();for(let c of(s=l.functionDeclarations)!==null&&s!==void 0?s:[]){if(!c.name)throw new Error("Function declaration name is required.");if(r.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);r.set(c.name,a)}}return r}async processAfcStream(e){var t,n,s;let r=(s=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&s!==void 0?s:IT,o=!1,a=0,l=await this.initAfcToolsMap(e);return function(c,d,h){return wn(this,arguments,function*(){for(var p,m,y,v,E,A;a<r;){o&&(a++,o=!1);let R=yield X(c.processParamsMaybeAddMcpUsage(h)),I=yield X(c.generateContentStreamInternal(R)),D=[],k=[];try{for(var _=!0,C=(m=void 0,An(I)),T;T=yield X(C.next()),p=T.done,!p;_=!0){v=T.value,_=!1;let N=v;if(yield yield X(N),N.candidates&&(!((E=N.candidates[0])===null||E===void 0)&&E.content)){k.push(N.candidates[0].content);for(let F of(A=N.candidates[0].content.parts)!==null&&A!==void 0?A:[])if(a<r&&F.functionCall){if(!F.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(F.functionCall.name)){let U=yield X(d.get(F.functionCall.name).callTool([F.functionCall]));D.push(...U)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${F.functionCall.name}`)}}}}catch(N){m={error:N}}finally{try{!_&&!p&&(y=C.return)&&(yield X(y.call(C)))}finally{if(m)throw m.error}}if(D.length>0){o=!0;let N=new wr;N.candidates=[{content:{role:"user",parts:D}}],yield yield X(N);let F=[];F.push(...k),F.push({role:"user",parts:D});let U=on(h.contents).concat(F);h.contents=U}else break}})}(this,l,e)}async generateContentInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=CT(this.apiClient,e);return a=O("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=xT(d),p=new wr;return Object.assign(p,h),p})}else{let c=_T(this.apiClient,e);return a=O("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=TT(d),p=new wr;return Object.assign(p,h),p})}}async generateContentStreamInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=CT(this.apiClient,e);return a=O("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),o.then(function(h){return wn(this,arguments,function*(){var p,m,y,v;try{for(var E=!0,A=An(h),_;_=yield X(A.next()),p=_.done,!p;E=!0){v=_.value,E=!1;let C=v,T=xT(yield X(C.json()));T.sdkHttpResponse={headers:C.headers};let R=new wr;Object.assign(R,T),yield yield X(R)}}catch(C){m={error:C}}finally{try{!E&&!p&&(y=A.return)&&(yield X(y.call(A)))}finally{if(m)throw m.error}}})})}else{let c=_T(this.apiClient,e);return a=O("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),o.then(function(h){return wn(this,arguments,function*(){var p,m,y,v;try{for(var E=!0,A=An(h),_;_=yield X(A.next()),p=_.done,!p;E=!0){v=_.value,E=!1;let C=v,T=TT(yield X(C.json()));T.sdkHttpResponse={headers:C.headers};let R=new wr;Object.assign(R,T),yield yield X(R)}}catch(C){m={error:C}}finally{try{!E&&!p&&(y=A.return)&&(yield X(y.call(A)))}finally{if(m)throw m.error}}})})}}async embedContent(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=TN(this.apiClient,e);return a=O("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=RN(d),p=new Kf;return Object.assign(p,h),p})}else{let c=CN(this.apiClient,e);return a=O("{model}:batchEmbedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=xN(d),p=new Kf;return Object.assign(p,h),p})}}async generateImagesInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=HN(this.apiClient,e);return a=O("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=VN(d),p=new Xf;return Object.assign(p,h),p})}else{let c=UN(this.apiClient,e);return a=O("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=BN(d),p=new Xf;return Object.assign(p,h),p})}}async editImageInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=wN(this.apiClient,e);return r=O("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=AN(l),d=new ub;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=HF(this.apiClient,e);return r=O("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=BF(l),d=new hb;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=EF(this.apiClient,e);return r=O("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=wF(l),d=new fb;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=xF(this.apiClient,e);return r=O("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=RF(l),d=new pb;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=sF(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>Nb(d))}else{let c=iF(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>kb(d))}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=fF(this.apiClient,e);return a=O("{models_url}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=gF(d),p=new Jf;return Object.assign(p,h),p})}else{let c=hF(this.apiClient,e);return a=O("{models_url}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=pF(d),p=new Jf;return Object.assign(p,h),p})}}async update(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=OF(this.apiClient,e);return a=O("{model}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>Nb(d))}else{let c=LF(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>kb(d))}}async delete(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=yN(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=bN(d),p=new Zf;return Object.assign(p,h),p})}else{let c=mN(this.apiClient,e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=vN(d),p=new Zf;return Object.assign(p,h),p})}}async countTokens(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=fN(this.apiClient,e);return a=O("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=gN(d),p=new jf;return Object.assign(p,h),p})}else{let c=hN(this.apiClient,e);return a=O("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=pN(d),p=new jf;return Object.assign(p,h),p})}}async computeTokens(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=rN(this.apiClient,e);return r=O("{model}:computeTokens",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=oN(l),d=new gb;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=YN(this.apiClient,e);return a=O("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>{let h=qN(d),p=new Qf;return Object.assign(p,h),p})}else{let c=WN(this.apiClient,e);return a=O("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>{let h=zN(d),p=new Qf;return Object.assign(p,h),p})}}};var $b=class extends Sn{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let s=t.name.split("/operations/")[0],r;n&&"httpOptions"in n&&(r=n.httpOptions);let o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{let s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let s=t.name.split("/operations/")[0],r;n&&"httpOptions"in n&&(r=n.httpOptions);let o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{let s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=GP(e);return a=O("{operationName}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o}else{let c=VP(e);return a=O("{operationName}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o}}async fetchPredictVideosOperationInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=NP(e);return r=O("{resourceName}:fetchPredictOperation",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s}else throw new Error("This method is only supported by the Vertex AI.")}};function xL(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function RL(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>OL(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function IL(i,e,t){let n={},s=f(e,["expireTime"]);t!==void 0&&s!=null&&g(t,["expireTime"],s);let r=f(e,["newSessionExpireTime"]);t!==void 0&&r!=null&&g(t,["newSessionExpireTime"],r);let o=f(e,["uses"]);t!==void 0&&o!=null&&g(t,["uses"],o);let a=f(e,["liveConnectConstraints"]);t!==void 0&&a!=null&&g(t,["bidiGenerateContentSetup"],LL(i,a));let l=f(e,["lockAdditionalFields"]);return t!==void 0&&l!=null&&g(t,["fieldMask"],l),n}function DL(i,e){let t={},n=f(e,["config"]);return n!=null&&g(t,["config"],IL(i,n,t)),t}function PL(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function ML(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function kL(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function NL(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function FL(i,e){let t={},n=f(i,["generationConfig"]);e!==void 0&&n!=null&&g(e,["setup","generationConfig"],n);let s=f(i,["responseModalities"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig","responseModalities"],s);let r=f(i,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);let o=f(i,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);let a=f(i,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);let l=f(i,["maxOutputTokens"]);e!==void 0&&l!=null&&g(e,["setup","generationConfig","maxOutputTokens"],l);let c=f(i,["mediaResolution"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","mediaResolution"],c);let d=f(i,["seed"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","seed"],d);let h=f(i,["speechConfig"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","speechConfig"],uE(h));let p=f(i,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);let m=f(i,["enableAffectiveDialog"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=f(i,["systemInstruction"]);e!==void 0&&y!=null&&g(e,["setup","systemInstruction"],RL(ot(y)));let v=f(i,["tools"]);if(e!==void 0&&v!=null){let I=Ca(v);Array.isArray(I)&&(I=I.map(D=>HL(_a(D)))),g(e,["setup","tools"],I)}let E=f(i,["sessionResumption"]);e!==void 0&&E!=null&&g(e,["setup","sessionResumption"],UL(E));let A=f(i,["inputAudioTranscription"]);e!==void 0&&A!=null&&g(e,["setup","inputAudioTranscription"],A);let _=f(i,["outputAudioTranscription"]);e!==void 0&&_!=null&&g(e,["setup","outputAudioTranscription"],_);let C=f(i,["realtimeInputConfig"]);e!==void 0&&C!=null&&g(e,["setup","realtimeInputConfig"],C);let T=f(i,["contextWindowCompression"]);e!==void 0&&T!=null&&g(e,["setup","contextWindowCompression"],T);let R=f(i,["proactivity"]);if(e!==void 0&&R!=null&&g(e,["setup","proactivity"],R),f(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function LL(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["setup","model"],ce(i,n));let s=f(e,["config"]);return s!=null&&g(t,["config"],FL(s,t)),t}function OL(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],PL(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],ML(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],xL(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let h=f(i,["thoughtSignature"]);h!=null&&g(e,["thoughtSignature"],h);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function UL(i){let e={},t=f(i,["handle"]);if(t!=null&&g(e,["handle"],t),f(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function HL(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>h)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],kL(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],NL(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function BL(i){let e=[];for(let t in i)if(Object.prototype.hasOwnProperty.call(i,t)){let n=i[t];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){let s=Object.keys(n).map(r=>`${t}.${r}`);e.push(...s)}else e.push(t)}return e.join(",")}function VL(i,e){let t=null,n=i.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){let r=n.setup;typeof r=="object"&&r!==null?(i.bidiGenerateContentSetup=r,t=r):delete i.bidiGenerateContentSetup}else n!==void 0&&delete i.bidiGenerateContentSetup;let s=i.fieldMask;if(t){let r=BL(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?i.fieldMask=r:delete i.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&s!==null&&Array.isArray(s)&&s.length>0){let o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],a=[];s.length>0&&(a=s.map(c=>o.includes(c)?`generationConfig.${c}`:c));let l=[];r&&l.push(r),a.length>0&&l.push(...a),l.length>0?i.fieldMask=l.join(","):delete i.fieldMask}else delete i.fieldMask}else s!==null&&Array.isArray(s)&&s.length>0?i.fieldMask=s.join(","):delete i.fieldMask;return i}var zb=class extends Sn{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let a=DL(this.apiClient,e);r=O("auth_tokens",a._url),o=a._query,delete a.config,delete a._url,delete a._query;let l=VL(a,e.config);return s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),s.then(c=>c)}}};function GL(i,e){let t={},n=f(i,["force"]);return e!==void 0&&n!=null&&g(e,["_query","force"],n),t}function $L(i){let e={},t=f(i,["name"]);t!=null&&g(e,["_url","name"],t);let n=f(i,["config"]);return n!=null&&GL(n,e),e}function zL(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","name"],t),e}function qL(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function WL(i){let e={},t=f(i,["parent"]);t!=null&&g(e,["_url","parent"],t);let n=f(i,["config"]);return n!=null&&qL(n,e),e}function YL(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["documents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["documents"],r)}return e}var qb=class extends Sn{constructor(e){super(),this.apiClient=e,this.list=async t=>new Ri(xi.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:t.parent,config:n.config}),await this.listInternal(t),t)}async get(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=zL(e);return r=O("{name}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let o=$L(e);s=O("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=WL(e);return r=O("{parent}/documents",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=YL(l),d=new mb;return Object.assign(d,c),d})}}};var Wb=class extends Sn{constructor(e,t=new qb(e)){super(),this.apiClient=e,this.documents=t,this.list=async(n={})=>new Ri(xi.PAGED_ITEM_FILE_SEARCH_STORES,s=>this.listInternal(s),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=YF(e);return r=O("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async get(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=JF(e);return r=O("{name}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let o=XF(e);s=O("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=nL(e);return r=O("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=iL(l),d=new yb;return Object.assign(d,c),d})}}async uploadToFileSearchStoreInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=sL(e);return r=O("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=rL(l),d=new vb;return Object.assign(d,c),d})}}async importFile(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=QF(e);return r=O("{file_search_store_name}:importFile",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=jF(l),d=new bb;return Object.assign(d,c),d})}}};var h0=function(){let{crypto:i}=globalThis;if(i!=null&&i.randomUUID)return h0=i.randomUUID.bind(i),i.randomUUID();let e=new Uint8Array(1),t=i?()=>i.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))},KL=()=>h0();function Yb(i){return typeof i=="object"&&i!==null&&("name"in i&&i.name==="AbortError"||"message"in i&&String(i.message).includes("FetchRequestCanceledException"))}var Kb=i=>{if(i instanceof Error)return i;if(typeof i=="object"&&i!==null){try{if(Object.prototype.toString.call(i)==="[object Error]"){let e=new Error(i.message,i.cause?{cause:i.cause}:{});return i.stack&&(e.stack=i.stack),i.cause&&!e.cause&&(e.cause=i.cause),i.name&&(e.name=i.name),e}}catch(e){}try{return new Error(JSON.stringify(i))}catch(e){}}return new Error(i)};var Ct=class extends Error{},Tt=class i extends Ct{constructor(e,t,n,s){super(`${i.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,n){let s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new Aa({message:n,cause:Kb(t)});let r=t;return e===400?new cp(e,r,n,s):e===401?new dp(e,r,n,s):e===403?new up(e,r,n,s):e===404?new hp(e,r,n,s):e===409?new fp(e,r,n,s):e===422?new pp(e,r,n,s):e===429?new gp(e,r,n,s):e>=500?new mp(e,r,n,s):new i(e,r,n,s)}},Gc=class extends Tt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Aa=class extends Tt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},lp=class extends Aa{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},cp=class extends Tt{},dp=class extends Tt{},up=class extends Tt{},hp=class extends Tt{},fp=class extends Tt{},pp=class extends Tt{},gp=class extends Tt{},mp=class extends Tt{};var XL=/^[a-z][a-z0-9+.-]*:/i,JL=i=>XL.test(i),Xb=i=>(Xb=Array.isArray,Xb(i)),ZL=Xb,jL=ZL,kT=jL;function QL(i){if(!i)return!0;for(let e in i)return!1;return!0}function e1(i,e){return Object.prototype.hasOwnProperty.call(i,e)}var t1=(i,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Ct(`${i} must be an integer`);if(e<0)throw new Ct(`${i} must be a positive integer`);return e},n1=i=>{try{return JSON.parse(i)}catch(e){return}};var i1=i=>new Promise(e=>setTimeout(e,i));var va="0.0.1";function s1(){return typeof Deno!="undefined"&&Deno.build!=null?"deno":typeof EdgeRuntime!="undefined"?"edge":Object.prototype.toString.call(typeof globalThis.process!="undefined"?globalThis.process:0)==="[object process]"?"node":"unknown"}var r1=()=>{var i,e,t,n,s;let r=s1();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":va,"X-Stainless-OS":FT(Deno.build.os),"X-Stainless-Arch":NT(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(i=Deno.version)===null||i===void 0?void 0:i.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":va,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":va,"X-Stainless-OS":FT((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":NT((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(s=globalThis.process.version)!==null&&s!==void 0?s:"unknown"};let o=o1();return o?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":va,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${o.browser}`,"X-Stainless-Runtime-Version":o.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":va,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function o1(){if(typeof navigator=="undefined"||!navigator)return null;let i=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of i){let n=t.exec(navigator.userAgent);if(n){let s=n[1]||0,r=n[2]||0,o=n[3]||0;return{browser:e,version:`${s}.${r}.${o}`}}}return null}var NT=i=>i==="x32"?"x32":i==="x86_64"||i==="x64"?"x64":i==="arm"?"arm":i==="aarch64"||i==="arm64"?"arm64":i?`other:${i}`:"unknown",FT=i=>(i=i.toLowerCase(),i.includes("ios")?"iOS":i==="android"?"Android":i==="darwin"?"MacOS":i==="win32"?"Windows":i==="freebsd"?"FreeBSD":i==="openbsd"?"OpenBSD":i==="linux"?"Linux":i?`Other:${i}`:"Unknown"),Bf,a1=()=>Bf!=null?Bf:Bf=r1();function l1(){if(typeof fetch!="undefined")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function f0(...i){let e=globalThis.ReadableStream;if(typeof e=="undefined")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...i)}function c1(i){let e=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i[Symbol.iterator]();return f0({start(){},async pull(t){let{done:n,value:s}=await e.next();n?t.close():t.enqueue(s)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function p0(i){if(i[Symbol.asyncIterator])return i;let e=i.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function d1(i){var e,t;if(i===null||typeof i!="object")return;if(i[Symbol.asyncIterator]){await((t=(e=i[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}let n=i.getReader(),s=n.cancel();n.releaseLock(),await s}var u1=({headers:i,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var g0=()=>{var i;if(typeof File=="undefined"){let{process:e}=globalThis,t=typeof((i=e==null?void 0:e.versions)===null||i===void 0?void 0:i.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ab(i,e,t){return g0(),new File(i,e!=null?e:"unknown_file",t)}function h1(i){return(typeof i=="object"&&i!==null&&("name"in i&&i.name&&String(i.name)||"url"in i&&i.url&&String(i.url)||"filename"in i&&i.filename&&String(i.filename)||"path"in i&&i.path&&String(i.path))||"").split(/[\\/]/).pop()||void 0}var f1=i=>i!=null&&typeof i=="object"&&typeof i[Symbol.asyncIterator]=="function";var m0=i=>i!=null&&typeof i=="object"&&typeof i.size=="number"&&typeof i.type=="string"&&typeof i.text=="function"&&typeof i.slice=="function"&&typeof i.arrayBuffer=="function",p1=i=>i!=null&&typeof i=="object"&&typeof i.name=="string"&&typeof i.lastModified=="number"&&m0(i),g1=i=>i!=null&&typeof i=="object"&&typeof i.url=="string"&&typeof i.blob=="function";async function m1(i,e,t){if(g0(),i=await i,p1(i))return i instanceof File?i:ab([await i.arrayBuffer()],i.name);if(g1(i)){let s=await i.blob();return e||(e=new URL(i.url).pathname.split(/[\\/]/).pop()),ab(await Jb(s),e,t)}let n=await Jb(i);if(e||(e=h1(i)),!(t!=null&&t.type)){let s=n.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof s=="string"&&(t=Object.assign(Object.assign({},t),{type:s}))}return ab(n,e,t)}async function Jb(i){var e,t,n,s,r;let o=[];if(typeof i=="string"||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)o.push(i);else if(m0(i))o.push(i instanceof Blob?i:await i.arrayBuffer());else if(f1(i))try{for(var a=!0,l=An(i),c;c=await l.next(),e=c.done,!e;a=!0){s=c.value,a=!1;let d=s;o.push(...await Jb(d))}}catch(d){t={error:d}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}else{let d=(r=i==null?void 0:i.constructor)===null||r===void 0?void 0:r.name;throw new Error(`Unexpected data type: ${typeof i}${d?`; constructor: ${d}`:""}${y1(i)}`)}return o}function y1(i){return typeof i!="object"||i===null?"":`; props: [${Object.getOwnPropertyNames(i).map(t=>`"${t}"`).join(", ")}]`}var yp=class{constructor(e){this._client=e}};yp._key=[];function y0(i){return i.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var LT=Object.freeze(Object.create(null)),v1=(i=y0)=>function(t,...n){if(t.length===1)return t[0];let s=!1,r=[],o=t.reduce((d,h,p)=>{var m,y,v;/[?#]/.test(h)&&(s=!0);let E=n[p],A=(s?encodeURIComponent:i)(""+E);return p!==n.length&&(E==null||typeof E=="object"&&E.toString===((v=Object.getPrototypeOf((y=Object.getPrototypeOf((m=E.hasOwnProperty)!==null&&m!==void 0?m:LT))!==null&&y!==void 0?y:LT))===null||v===void 0?void 0:v.toString))&&(A=E+"",r.push({start:d.length+h.length,length:A.length,error:`Value of type ${Object.prototype.toString.call(E).slice(8,-1)} is not a valid path parameter`})),d+h+(p===n.length?"":A)},""),a=o.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,c;for(;(c=l.exec(a))!==null;)r.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(r.sort((d,h)=>d.start-h.start),r.length>0){let d=0,h=r.reduce((p,m)=>{let y=" ".repeat(m.start-d),v="^".repeat(m.length);return d=m.start+m.length,p+y+v},"");throw new Ct(`Path parameters result in path with invalid segments:
${r.map(p=>p.error).join(`
`)}
${o}
${h}`)}return o},Vf=v1(y0);var vp=class extends yp{create(e,t){var n;let{api_version:s=this._client.apiVersion}=e,r=op(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new Ct("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new Ct("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Vf`/${s}/interactions`,Object.assign(Object.assign({body:r},t),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,t={},n){let{api_version:s=this._client.apiVersion}=t!=null?t:{};return this._client.delete(Vf`/${s}/interactions/${e}`,n)}cancel(e,t={},n){let{api_version:s=this._client.apiVersion}=t!=null?t:{};return this._client.post(Vf`/${s}/interactions/${e}/cancel`,n)}get(e,t={},n){var s;let r=t!=null?t:{},{api_version:o=this._client.apiVersion}=r,a=op(r,["api_version"]);return this._client.get(Vf`/${o}/interactions/${e}`,Object.assign(Object.assign({query:a},n),{stream:(s=t==null?void 0:t.stream)!==null&&s!==void 0?s:!1}))}};vp._key=Object.freeze(["interactions"]);var bp=class extends vp{};function b1(i){let e=0;for(let s of i)e+=s.length;let t=new Uint8Array(e),n=0;for(let s of i)t.set(s,n),n+=s.length;return t}var Gf;function hE(i){let e;return(Gf!=null?Gf:(e=new globalThis.TextEncoder,Gf=e.encode.bind(e)))(i)}var $f;function OT(i){let e;return($f!=null?$f:(e=new globalThis.TextDecoder,$f=e.decode.bind(e)))(i)}var Sa=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?hE(e):e;this.buffer=b1([this.buffer,t]);let n=[],s;for(;(s=E1(this.buffer,this.carriageReturnIndex))!=null;){if(s.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=s.index;continue}if(this.carriageReturnIndex!=null&&(s.index!==this.carriageReturnIndex+1||s.carriage)){n.push(OT(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let r=this.carriageReturnIndex!==null?s.preceding-1:s.preceding,o=OT(this.buffer.subarray(0,r));n.push(o),this.buffer=this.buffer.subarray(s.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}};Sa.NEWLINE_CHARS=new Set([`
`,"\r"]);Sa.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function E1(i,e){for(let s=e!=null?e:0;s<i.length;s++){if(i[s]===10)return{preceding:s,index:s+1,carriage:!1};if(i[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function w1(i){for(let n=0;n<i.length-1;n++){if(i[n]===10&&i[n+1]===10||i[n]===13&&i[n+1]===13)return n+2;if(i[n]===13&&i[n+1]===10&&n+3<i.length&&i[n+2]===13&&i[n+3]===10)return n+4}return-1}var Ep={off:0,error:200,warn:300,info:400,debug:500},UT=(i,e,t)=>{if(i){if(e1(Ep,i))return i;bt(t).warn(`${e} was set to ${JSON.stringify(i)}, expected one of ${JSON.stringify(Object.keys(Ep))}`)}};function Bc(){}function zf(i,e,t){return!e||Ep[i]>Ep[t]?Bc:e[i].bind(e)}var A1={error:Bc,warn:Bc,info:Bc,debug:Bc},HT=new WeakMap;function bt(i){var e;let t=i.logger,n=(e=i.logLevel)!==null&&e!==void 0?e:"off";if(!t)return A1;let s=HT.get(t);if(s&&s[0]===n)return s[1];let r={error:zf("error",t,n),warn:zf("warn",t,n),info:zf("info",t,n),debug:zf("debug",t,n)};return HT.set(t,[n,r]),r}var Er=i=>(i.options&&(i.options=Object.assign({},i.options),delete i.options.headers),i.headers&&(i.headers=Object.fromEntries((i.headers instanceof Headers?[...i.headers]:Object.entries(i.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in i&&(i.retryOfRequestLogID&&(i.retryOf=i.retryOfRequestLogID),delete i.retryOfRequestLogID),i);var Zb=class i{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let s=!1,r=n?bt(n):console;function o(){return wn(this,arguments,function*(){var l,c,d,h;if(s)throw new Ct("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let p=!1;try{try{for(var m=!0,y=An(S1(e,t)),v;v=yield X(y.next()),l=v.done,!l;m=!0){h=v.value,m=!1;let E=h;if(!p)if(E.data.startsWith("[DONE]")){p=!0;continue}else try{yield yield X(JSON.parse(E.data))}catch(A){throw r.error("Could not parse message into JSON:",E.data),r.error("From chunk:",E.raw),A}}}catch(E){c={error:E}}finally{try{!m&&!l&&(d=y.return)&&(yield X(d.call(y)))}finally{if(c)throw c.error}}p=!0}catch(E){if(Yb(E))return yield X(void 0);throw E}finally{p||t.abort()}})}return new i(o,t,n)}static fromReadableStream(e,t,n){let s=!1;function r(){return wn(this,arguments,function*(){var l,c,d,h;let p=new Sa,m=p0(e);try{for(var y=!0,v=An(m),E;E=yield X(v.next()),l=E.done,!l;y=!0){h=E.value,y=!1;let A=h;for(let _ of p.decode(A))yield yield X(_)}}catch(A){c={error:A}}finally{try{!y&&!l&&(d=v.return)&&(yield X(d.call(v)))}finally{if(c)throw c.error}}for(let A of p.flush())yield yield X(A)})}function o(){return wn(this,arguments,function*(){var l,c,d,h;if(s)throw new Ct("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let p=!1;try{try{for(var m=!0,y=An(r()),v;v=yield X(y.next()),l=v.done,!l;m=!0){h=v.value,m=!1;let E=h;p||E&&(yield yield X(JSON.parse(E)))}}catch(E){c={error:E}}finally{try{!m&&!l&&(d=y.return)&&(yield X(d.call(y)))}finally{if(c)throw c.error}}p=!0}catch(E){if(Yb(E))return yield X(void 0);throw E}finally{p||t.abort()}})}return new i(o,t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),s=r=>({next:()=>{if(r.length===0){let o=n.next();e.push(o),t.push(o)}return r.shift()}});return[new i(()=>s(e),this.controller,this.client),new i(()=>s(t),this.controller,this.client)]}toReadableStream(){let e=this,t;return f0({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:s,done:r}=await t.next();if(r)return n.close();let o=hE(JSON.stringify(s)+`
`);n.enqueue(o)}catch(s){n.error(s)}},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}};function S1(i,e){return wn(this,arguments,function*(){var n,s,r,o;if(!i.body)throw e.abort(),typeof globalThis.navigator!="undefined"&&globalThis.navigator.product==="ReactNative"?new Ct("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Ct("Attempted to iterate over a response with no body");let a=new jb,l=new Sa,c=p0(i.body);try{for(var d=!0,h=An(_1(c)),p;p=yield X(h.next()),n=p.done,!n;d=!0){o=p.value,d=!1;let m=o;for(let y of l.decode(m)){let v=a.decode(y);v&&(yield yield X(v))}}}catch(m){s={error:m}}finally{try{!d&&!n&&(r=h.return)&&(yield X(r.call(h)))}finally{if(s)throw s.error}}for(let m of l.flush()){let y=a.decode(m);y&&(yield yield X(y))}})}function _1(i){return wn(this,arguments,function*(){var t,n,s,r;let o=new Uint8Array;try{for(var a=!0,l=An(i),c;c=yield X(l.next()),t=c.done,!t;a=!0){r=c.value,a=!1;let d=r;if(d==null)continue;let h=d instanceof ArrayBuffer?new Uint8Array(d):typeof d=="string"?hE(d):d,p=new Uint8Array(o.length+h.length);p.set(o),p.set(h,o.length),o=p;let m;for(;(m=w1(o))!==-1;)yield yield X(o.slice(0,m)),o=o.slice(m)}}catch(d){n={error:d}}finally{try{!a&&!t&&(s=l.return)&&(yield X(s.call(l)))}finally{if(n)throw n.error}}o.length>0&&(yield yield X(o))})}var jb=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=C1(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function C1(i,e){let t=i.indexOf(e);return t!==-1?[i.substring(0,t),e,i.substring(t+e.length)]:[i,"",""]}async function T1(i,e){let{response:t,requestLogID:n,retryOfRequestLogID:s,startTime:r}=e,o=await(async()=>{var a;if(e.options.stream)return bt(i).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,i):Zb.fromSSEResponse(t,e.controller,i);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let l=t.headers.get("content-type"),c=(a=l==null?void 0:l.split(";")[0])===null||a===void 0?void 0:a.trim();return(c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))?await t.json():await t.text()})();return bt(i).debug(`[${n}] response parsed`,Er({retryOfRequestLogID:s,url:t.url,status:t.status,body:o,durationMs:Date.now()-r})),o}var Qb=class i extends Promise{constructor(e,t,n=T1){super(s=>{s(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new i(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var v0=Symbol("brand.privateNullableHeaders");function*x1(i){if(!i)return;if(v0 in i){let{values:n,nulls:s}=i;yield*n.entries();for(let r of s)yield[r,null];return}let e=!1,t;i instanceof Headers?t=i.entries():kT(i)?t=i:(e=!0,t=Object.entries(i!=null?i:{}));for(let n of t){let s=n[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");let r=kT(n[1])?n[1]:[n[1]],o=!1;for(let a of r)a!==void 0&&(e&&!o&&(o=!0,yield[s,null]),yield[s,a])}}var Hc=i=>{let e=new Headers,t=new Set;for(let n of i){let s=new Set;for(let[r,o]of x1(n)){let a=r.toLowerCase();s.has(a)||(e.delete(r),s.add(a)),o===null?(e.delete(r),t.add(a)):(e.append(r,o),t.delete(a))}}return{[v0]:!0,values:e,nulls:t}};var lb=i=>{var e,t,n,s,r,o;if(typeof globalThis.process!="undefined")return(n=(t=(e=globalThis.process.env)===null||e===void 0?void 0:e[i])===null||t===void 0?void 0:t.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno!="undefined")return(o=(r=(s=globalThis.Deno.env)===null||s===void 0?void 0:s.get)===null||r===void 0?void 0:r.call(s,i))===null||o===void 0?void 0:o.trim()};var b0,wp=class i{constructor(e){var t,n,s,r,o,a,l,{baseURL:c=lb("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:d=(t=lb("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:h="v1beta"}=e,p=op(e,["baseURL","apiKey","apiVersion"]);let m=Object.assign(Object.assign({apiKey:d,apiVersion:h},p),{baseURL:c||"https://generativelanguage.googleapis.com"});this.baseURL=m.baseURL,this.timeout=(n=m.timeout)!==null&&n!==void 0?n:i.DEFAULT_TIMEOUT,this.logger=(s=m.logger)!==null&&s!==void 0?s:console;let y="warn";this.logLevel=y,this.logLevel=(o=(r=UT(m.logLevel,"ClientOptions.logLevel",this))!==null&&r!==void 0?r:UT(lb("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&o!==void 0?o:y,this.fetchOptions=m.fetchOptions,this.maxRetries=(a=m.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(l=m.fetch)!==null&&l!==void 0?l:l1(),this.encoder=u1,this._options=m,this.apiKey=d,this.apiVersion=h,this.clientAdapter=m.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){let t=Hc([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return Hc([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Hc([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n!="undefined").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new Ct(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${va}`}defaultIdempotencyKey(){return`stainless-node-retry-${KL()}`}makeStatusError(e,t,n,s){return Tt.generate(e,t,n,s)}buildURL(e,t,n){let s=!this.baseURLOverridden()&&n||this.baseURL,r=JL(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return QL(o)||(t=Object.assign(Object.assign({},o),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(s=>Object.assign({method:e,path:t},s)))}request(e,t=null){return new Qb(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var s,r,o;let a=await e,l=(s=a.maxRetries)!==null&&s!==void 0?s:this.maxRetries;t==null&&(t=l),await this.prepareOptions(a);let{req:c,url:d,timeout:h}=await this.buildRequest(a,{retryCount:l-t});await this.prepareRequest(c,{url:d,options:a});let p="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),m=n===void 0?"":`, retryOf: ${n}`,y=Date.now();if(bt(this).debug(`[${p}] sending request`,Er({retryOfRequestLogID:n,method:a.method,url:d,options:a,headers:c.headers})),!((r=a.signal)===null||r===void 0)&&r.aborted)throw new Gc;let v=new AbortController,E=await this.fetchWithTimeout(d,c,h,v).catch(Kb),A=Date.now();if(E instanceof globalThis.Error){let C=`retrying, ${t} attempts remaining`;if(!((o=a.signal)===null||o===void 0)&&o.aborted)throw new Gc;let T=Yb(E)||/timed? ?out/i.test(String(E)+("cause"in E?String(E.cause):""));if(t)return bt(this).info(`[${p}] connection ${T?"timed out":"failed"} - ${C}`),bt(this).debug(`[${p}] connection ${T?"timed out":"failed"} (${C})`,Er({retryOfRequestLogID:n,url:d,durationMs:A-y,message:E.message})),this.retryRequest(a,t,n!=null?n:p);throw bt(this).info(`[${p}] connection ${T?"timed out":"failed"} - error; no more retries left`),bt(this).debug(`[${p}] connection ${T?"timed out":"failed"} (error; no more retries left)`,Er({retryOfRequestLogID:n,url:d,durationMs:A-y,message:E.message})),T?new lp:new Aa({cause:E})}let _=`[${p}${m}] ${c.method} ${d} ${E.ok?"succeeded":"failed"} with status ${E.status} in ${A-y}ms`;if(!E.ok){let C=await this.shouldRetry(E);if(t&&C){let N=`retrying, ${t} attempts remaining`;return await d1(E.body),bt(this).info(`${_} - ${N}`),bt(this).debug(`[${p}] response error (${N})`,Er({retryOfRequestLogID:n,url:E.url,status:E.status,headers:E.headers,durationMs:A-y})),this.retryRequest(a,t,n!=null?n:p,E.headers)}let T=C?"error; no more retries left":"error; not retryable";bt(this).info(`${_} - ${T}`);let R=await E.text().catch(N=>Kb(N).message),I=n1(R),D=I?void 0:R;throw bt(this).debug(`[${p}] response error (${T})`,Er({retryOfRequestLogID:n,url:E.url,status:E.status,headers:E.headers,message:D,durationMs:Date.now()-y})),this.makeStatusError(E.status,I,D,E.headers)}return bt(this).info(_),bt(this).debug(`[${p}] response start`,Er({retryOfRequestLogID:n,url:E.url,status:E.status,headers:E.headers,durationMs:A-y})),{response:E,options:a,controller:v,requestLogID:p,retryOfRequestLogID:n,startTime:y}}async fetchWithTimeout(e,t,n,s){let r=t||{},{signal:o,method:a}=r,l=op(r,["signal","method"]);o&&o.addEventListener("abort",()=>s.abort());let c=setTimeout(()=>s.abort(),n),d=globalThis.ReadableStream&&l.body instanceof globalThis.ReadableStream||typeof l.body=="object"&&l.body!==null&&Symbol.asyncIterator in l.body,h=Object.assign(Object.assign(Object.assign({signal:s.signal},d?{duplex:"half"}:{}),{method:"GET"}),l);a&&(h.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,h)}finally{clearTimeout(c)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,s){var r;let o,a=s==null?void 0:s.get("retry-after-ms");if(a){let c=parseFloat(a);Number.isNaN(c)||(o=c)}let l=s==null?void 0:s.get("retry-after");if(l&&!o){let c=parseFloat(l);Number.isNaN(c)?o=Date.parse(l)-Date.now():o=c*1e3}if(!(o&&0<=o&&o<60*1e3)){let c=(r=e.maxRetries)!==null&&r!==void 0?r:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,c)}return await i1(o),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let r=t-e,o=Math.min(.5*Math.pow(2,r),8),a=1-Math.random()*.25;return o*a*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,s,r;let o=Object.assign({},e),{method:a,path:l,query:c,defaultBaseURL:d}=o,h=this.buildURL(l,c,d);"timeout"in o&&t1("timeout",o.timeout),o.timeout=(n=o.timeout)!==null&&n!==void 0?n:this.timeout;let{bodyHeaders:p,body:m}=this.buildBody({options:o}),y=await this.buildHeaders({options:e,method:a,bodyHeaders:p,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:y},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&m instanceof globalThis.ReadableStream&&{duplex:"half"}),m&&{body:m}),(s=this.fetchOptions)!==null&&s!==void 0?s:{}),(r=o.fetchOptions)!==null&&r!==void 0?r:{}),url:h,timeout:o.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:s}){let r={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let o=await this.authHeaders(e),a=Hc([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),a1()),this._options.defaultHeaders,n,e.headers,o]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=Hc([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:c1(e)}:this.encoder({body:e,headers:n})}};wp.DEFAULT_TIMEOUT=6e4;var Pe=class extends wp{constructor(){super(...arguments),this.interactions=new bp(this)}};b0=Pe;Pe.GeminiNextGenAPIClient=b0;Pe.GeminiNextGenAPIClientError=Ct;Pe.APIError=Tt;Pe.APIConnectionError=Aa;Pe.APIConnectionTimeoutError=lp;Pe.APIUserAbortError=Gc;Pe.NotFoundError=hp;Pe.ConflictError=fp;Pe.RateLimitError=gp;Pe.BadRequestError=cp;Pe.AuthenticationError=dp;Pe.InternalServerError=mp;Pe.PermissionDeniedError=up;Pe.UnprocessableEntityError=pp;Pe.toFile=m1;Pe.Interactions=bp;function R1(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function I1(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function D1(i,e){let t={},n=f(i,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function P1(i,e){let t={},n=f(i,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function M1(i,e,t){let n={};if(f(i,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let s=f(i,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&g(e,["displayName"],s),f(i,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let r=f(i,["epochCount"]);e!==void 0&&r!=null&&g(e,["tuningTask","hyperparameters","epochCount"],r);let o=f(i,["learningRateMultiplier"]);if(o!=null&&g(n,["tuningTask","hyperparameters","learningRateMultiplier"],o),f(i,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(f(i,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(f(i,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let a=f(i,["batchSize"]);e!==void 0&&a!=null&&g(e,["tuningTask","hyperparameters","batchSize"],a);let l=f(i,["learningRate"]);if(e!==void 0&&l!=null&&g(e,["tuningTask","hyperparameters","learningRate"],l),f(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(f(i,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function k1(i,e,t){let n={},s=f(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){let m=f(i,["validationDataset"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec"],BT(m))}else if(s==="PREFERENCE_TUNING"){let m=f(i,["validationDataset"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec"],BT(m))}let r=f(i,["tunedModelDisplayName"]);e!==void 0&&r!=null&&g(e,["tunedModelDisplayName"],r);let o=f(i,["description"]);e!==void 0&&o!=null&&g(e,["description"],o);let a=f(t,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){let m=f(i,["epochCount"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","hyperParameters","epochCount"],m)}else if(a==="PREFERENCE_TUNING"){let m=f(i,["epochCount"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],m)}let l=f(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){let m=f(i,["learningRateMultiplier"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],m)}else if(l==="PREFERENCE_TUNING"){let m=f(i,["learningRateMultiplier"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],m)}let c=f(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){let m=f(i,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","exportLastCheckpointOnly"],m)}else if(c==="PREFERENCE_TUNING"){let m=f(i,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],m)}let d=f(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){let m=f(i,["adapterSize"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","hyperParameters","adapterSize"],m)}else if(d==="PREFERENCE_TUNING"){let m=f(i,["adapterSize"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],m)}if(f(i,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(f(i,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let h=f(i,["labels"]);e!==void 0&&h!=null&&g(e,["labels"],h);let p=f(i,["beta"]);return e!==void 0&&p!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","beta"],p),n}function N1(i,e){let t={},n=f(i,["baseModel"]);n!=null&&g(t,["baseModel"],n);let s=f(i,["preTunedModel"]);s!=null&&g(t,["preTunedModel"],s);let r=f(i,["trainingDataset"]);r!=null&&q1(r);let o=f(i,["config"]);return o!=null&&M1(o,t),t}function F1(i,e){let t={},n=f(i,["baseModel"]);n!=null&&g(t,["baseModel"],n);let s=f(i,["preTunedModel"]);s!=null&&g(t,["preTunedModel"],s);let r=f(i,["trainingDataset"]);r!=null&&W1(r,t,e);let o=f(i,["config"]);return o!=null&&k1(o,t,e),t}function L1(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function O1(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function U1(i,e,t){let n={},s=f(i,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);let r=f(i,["pageToken"]);e!==void 0&&r!=null&&g(e,["_query","pageToken"],r);let o=f(i,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),n}function H1(i,e,t){let n={},s=f(i,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);let r=f(i,["pageToken"]);e!==void 0&&r!=null&&g(e,["_query","pageToken"],r);let o=f(i,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),n}function B1(i,e){let t={},n=f(i,["config"]);return n!=null&&U1(n,t),t}function V1(i,e){let t={},n=f(i,["config"]);return n!=null&&H1(n,t),t}function G1(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["nextPageToken"]);s!=null&&g(t,["nextPageToken"],s);let r=f(i,["tunedModels"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>E0(a))),g(t,["tuningJobs"],o)}return t}function $1(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["nextPageToken"]);s!=null&&g(t,["nextPageToken"],s);let r=f(i,["tuningJobs"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>eE(a))),g(t,["tuningJobs"],o)}return t}function z1(i,e){let t={},n=f(i,["name"]);n!=null&&g(t,["model"],n);let s=f(i,["name"]);return s!=null&&g(t,["endpoint"],s),t}function q1(i,e){let t={};if(f(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(i,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=f(i,["examples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),g(t,["examples","examples"],s)}return t}function W1(i,e,t){let n={},s=f(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){let o=f(i,["gcsUri"]);e!==void 0&&o!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(s==="PREFERENCE_TUNING"){let o=f(i,["gcsUri"]);e!==void 0&&o!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}let r=f(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){let o=f(i,["vertexDatasetResource"]);e!==void 0&&o!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(r==="PREFERENCE_TUNING"){let o=f(i,["vertexDatasetResource"]);e!==void 0&&o!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}if(f(i,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function E0(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["name"]);s!=null&&g(t,["name"],s);let r=f(i,["state"]);r!=null&&g(t,["state"],KT(r));let o=f(i,["createTime"]);o!=null&&g(t,["createTime"],o);let a=f(i,["tuningTask","startTime"]);a!=null&&g(t,["startTime"],a);let l=f(i,["tuningTask","completeTime"]);l!=null&&g(t,["endTime"],l);let c=f(i,["updateTime"]);c!=null&&g(t,["updateTime"],c);let d=f(i,["description"]);d!=null&&g(t,["description"],d);let h=f(i,["baseModel"]);h!=null&&g(t,["baseModel"],h);let p=f(i,["_self"]);return p!=null&&g(t,["tunedModel"],z1(p)),t}function eE(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["name"]);s!=null&&g(t,["name"],s);let r=f(i,["state"]);r!=null&&g(t,["state"],KT(r));let o=f(i,["createTime"]);o!=null&&g(t,["createTime"],o);let a=f(i,["startTime"]);a!=null&&g(t,["startTime"],a);let l=f(i,["endTime"]);l!=null&&g(t,["endTime"],l);let c=f(i,["updateTime"]);c!=null&&g(t,["updateTime"],c);let d=f(i,["error"]);d!=null&&g(t,["error"],d);let h=f(i,["description"]);h!=null&&g(t,["description"],h);let p=f(i,["baseModel"]);p!=null&&g(t,["baseModel"],p);let m=f(i,["tunedModel"]);m!=null&&g(t,["tunedModel"],m);let y=f(i,["preTunedModel"]);y!=null&&g(t,["preTunedModel"],y);let v=f(i,["supervisedTuningSpec"]);v!=null&&g(t,["supervisedTuningSpec"],v);let E=f(i,["preferenceOptimizationSpec"]);E!=null&&g(t,["preferenceOptimizationSpec"],E);let A=f(i,["tuningDataStats"]);A!=null&&g(t,["tuningDataStats"],A);let _=f(i,["encryptionSpec"]);_!=null&&g(t,["encryptionSpec"],_);let C=f(i,["partnerModelTuningSpec"]);C!=null&&g(t,["partnerModelTuningSpec"],C);let T=f(i,["customBaseModel"]);T!=null&&g(t,["customBaseModel"],T);let R=f(i,["experiment"]);R!=null&&g(t,["experiment"],R);let I=f(i,["labels"]);I!=null&&g(t,["labels"],I);let D=f(i,["outputUri"]);D!=null&&g(t,["outputUri"],D);let k=f(i,["pipelineJob"]);k!=null&&g(t,["pipelineJob"],k);let N=f(i,["serviceAccount"]);N!=null&&g(t,["serviceAccount"],N);let F=f(i,["tunedModelDisplayName"]);F!=null&&g(t,["tunedModelDisplayName"],F);let U=f(i,["veoTuningSpec"]);return U!=null&&g(t,["veoTuningSpec"],U),t}function Y1(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["name"]);s!=null&&g(t,["name"],s);let r=f(i,["metadata"]);r!=null&&g(t,["metadata"],r);let o=f(i,["done"]);o!=null&&g(t,["done"],o);let a=f(i,["error"]);return a!=null&&g(t,["error"],a),t}function BT(i,e){let t={},n=f(i,["gcsUri"]);n!=null&&g(t,["validationDatasetUri"],n);let s=f(i,["vertexDatasetResource"]);return s!=null&&g(t,["validationDatasetUri"],s),t}var tE=class extends Sn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ri(xi.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var n;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let s={tunedModelName:t.baseModel};!((n=t.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(s.checkpointId=t.config.preTunedModelCheckpointId);let r=Object.assign(Object.assign({},t),{preTunedModel:s});return r.baseModel=void 0,await this.tuneInternal(r)}else{let s=Object.assign({},t);return await this.tuneInternal(s)}else{let s=Object.assign({},t),r=await this.tuneMldevInternal(s),o="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?o=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(o=r.name.split("/operations/")[0]),{name:o,state:db.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=O1(e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>eE(d))}else{let c=L1(e);return a=O("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>E0(d))}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=V1(e);return a=O("tuningJobs",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=$1(d),p=new ep;return Object.assign(p,h),p})}else{let c=B1(e);return a=O("tunedModels",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=G1(d),p=new ep;return Object.assign(p,h),p})}}async cancel(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=I1(e);return a=O("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=P1(d),p=new tp;return Object.assign(p,h),p})}else{let c=R1(e);return a=O("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{let p=h;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let h=D1(d),p=new tp;return Object.assign(p,h),p})}}async tuneInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=F1(e,e);return r=O("tuningJobs",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>eE(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=N1(e);return r=O("tunedModels",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>Y1(l))}}};var nE=class{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},K1=1024*1024*8,X1=3,J1=1e3,Z1=2,Ap="x-goog-upload-status";async function j1(i,e,t){var n;let s=await w0(i,e,t),r=await(s==null?void 0:s.json());if(((n=s==null?void 0:s.headers)===null||n===void 0?void 0:n[Ap])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function Q1(i,e,t){var n;let s=await w0(i,e,t),r=await(s==null?void 0:s.json());if(((n=s==null?void 0:s.headers)===null||n===void 0?void 0:n[Ap])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let o=GT(r),a=new Cb;return Object.assign(a,o),a}async function w0(i,e,t){var n,s;let r=0,o=0,a=new Vc(new Response),l="upload";for(r=i.size;o<r;){let c=Math.min(K1,r-o),d=i.slice(o,o+c);o+c>=r&&(l+=", finalize");let h=0,p=J1;for(;h<X1&&(a=await t.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(o),"Content-Length":String(c)}}}),!(!((n=a==null?void 0:a.headers)===null||n===void 0)&&n[Ap]));)h++,await tO(p),p=p*Z1;if(o+=c,((s=a==null?void 0:a.headers)===null||s===void 0?void 0:s[Ap])!=="active")break;if(r<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function eO(i){return{size:i.size,type:i.type}}function tO(i){return new Promise(e=>setTimeout(e,i))}var iE=class{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await j1(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Q1(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await eO(e)}};var sE=class{create(e,t,n){return new rE(e,t,n)}},rE=class{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var VT="x-goog-api-key",oE=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(VT)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(VT,this.apiKey)}}};var nO="gl-node/",Sp=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e!=null&&e.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new Pe({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e==null?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;let n=MP(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let s=new oE(this.apiKey);this.apiClient=new Lb({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:nO+"web",uploader:new iE,downloader:new nE}),this.models=new Gb(this.apiClient),this.live=new Bb(this.apiClient,s,new sE),this.batches=new Rb(this.apiClient),this.chats=new Db(this.models,this.apiClient),this.caches=new Ib(this.apiClient),this.files=new Mb(this.apiClient),this.operations=new $b(this.apiClient),this.authTokens=new zb(this.apiClient),this.tunings=new tE(this.apiClient),this.fileSearchStores=new Wb(this.apiClient)}};var A0=`You are my assistant for classifying notes by project and restructuring content when needed.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uBD84\uB958 \uADDC\uCE59 (\uC911\uC694\uB3C4 \uC21C)

### 1. \uD504\uB85C\uC81D\uD2B8 \uC0B0\uCD9C\uBB3C (contentType: "artifact")
\uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC9C1\uC811 \uC800\uC7A5\uD574\uC57C \uD560 \uAC83:
- \uC9C1\uC811 \uC791\uC131\uD55C \uBB38\uC11C, \uACC4\uD68D\uC11C, \uD68C\uC758\uB85D
- \uD504\uB85C\uC81D\uD2B8\uB97C \uC704\uD574 \uB9CC\uB4E0 \uCF54\uB4DC, \uC124\uACC4\uC11C
- \uD504\uB85C\uC81D\uD2B8 \uC9C4\uD589 \uAD00\uB828 \uBA54\uBAA8

### 2. \uD504\uB85C\uC81D\uD2B8 \uCC38\uACE0\uC790\uB8CC (contentType: "reference")
Library\uC5D0 \uC800\uC7A5\uD558\uB418 \uD504\uB85C\uC81D\uD2B8\uC640 \uB9C1\uD06C\uD574\uC57C \uD560 \uAC83:
- \uC678\uBD80 \uD29C\uD1A0\uB9AC\uC5BC, \uC608\uC81C \uCF54\uB4DC, \uBB38\uC11C
- \uC6F9\uD398\uC774\uC9C0 \uC2A4\uD06C\uB7A9, \uC544\uD2F0\uD074
- \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uC790\uB8CC
- \uC608: "ESP32 \uC608\uC81C" \u2192 \uD30C\uCE20\uD31C\uC5D0 \uC720\uC6A9\uD558\uC9C0\uB9CC Library\uC5D0 \uC800\uC7A5

### 3. \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC (targetType: "library", contentType: "general")
- \uD2B9\uC815 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828 \uC5C6\uB294 \uC77C\uBC18 \uC815\uBCF4
- \uB274\uC2A4, \uACF5\uACE0, \uC77C\uBC18 \uC544\uD2F0\uD074

### 4. archive
- \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83

## \uD310\uB2E8 \uAE30\uC900
- "\uC774\uAC74 \uB0B4\uAC00 \uC9C1\uC811 \uB9CC\uB4E0 \uC0B0\uCD9C\uBB3C\uC778\uAC00?" \u2192 artifact
- "\uC774\uAC74 \uC678\uBD80 \uC790\uB8CC\uC778\uB370 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC720\uC6A9\uD55C\uAC00?" \u2192 reference
- "\uC774\uAC74 \uADF8\uB0E5 \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC\uC778\uAC00?" \u2192 general
- "\uD504\uB85C\uC81D\uD2B8 \uB05D\uB098\uB3C4 \uACC4\uC18D \uCC38\uACE0\uD560 \uC790\uB8CC\uC778\uAC00?" \u2192 reference (Library)

## \uCF58\uD150\uCE20 \uC7AC\uAD6C\uC131 (Phase 2)

\uB178\uD2B8\uAC00 \uC815\uB9AC\uB418\uC9C0 \uC54A\uC740 \uC6D0\uC2DC \uD615\uD0DC\uB77C\uBA74 \uC7AC\uAD6C\uC131\uC744 \uC81C\uC548\uD574\uB77C:

### \uC7AC\uAD6C\uC131 \uD544\uC694 \uC5EC\uBD80 \uD310\uB2E8
- \uAD6C\uC870\uD654\uB418\uC9C0 \uC54A\uC740 \uBA54\uBAA8 (\uC904\uAE00, \uB098\uC5F4, \uD0A4\uC6CC\uB4DC\uB9CC)
- \uD68C\uC758/\uBBF8\uD305 \uB0B4\uC6A9\uC778\uB370 \uC815\uB9AC \uC548 \uB428
- \uD559\uC2B5 \uB0B4\uC6A9\uC778\uB370 \uCCB4\uACC4 \uC5C6\uC74C
- \uC544\uC774\uB514\uC5B4\uC778\uB370 \uC124\uBA85 \uBD80\uC871

### \uC7AC\uAD6C\uC131 \uC720\uD615\uBCC4 \uD15C\uD50C\uB9BF

**meeting (\uD68C\uC758/\uBBF8\uD305)**:
\`\`\`
## \uD68C\uC758 \uC694\uC57D
- \uC77C\uC2DC: [\uB0A0\uC9DC]
- \uCC38\uC11D\uC790: [\uCD94\uB860 \uAC00\uB2A5\uD558\uBA74]
- \uC8FC\uC81C: [\uD575\uC2EC \uC8FC\uC81C]

## \uB17C\uC758 \uB0B4\uC6A9
- [\uD575\uC2EC \uB17C\uC758 1]
- [\uD575\uC2EC \uB17C\uC758 2]

## \uACB0\uC815\uC0AC\uD56D
- [\uACB0\uC815 1]

## \uC561\uC158 \uC544\uC774\uD15C
- [ ] [\uD560 \uC77C]
\`\`\`

**idea (\uC544\uC774\uB514\uC5B4/\uBE0C\uB808\uC778\uC2A4\uD1A0\uBC0D)**:
\`\`\`
## \uD575\uC2EC \uC544\uC774\uB514\uC5B4
[\uC544\uC774\uB514\uC5B4 1\uC904 \uC694\uC57D]

## \uC0C1\uC138 \uC124\uBA85
[\uC544\uC774\uB514\uC5B4 \uC124\uBA85]

## \uC65C \uC911\uC694\uD55C\uAC00?
[\uC774\uC720]

## \uB2E4\uC74C \uB2E8\uACC4
- [ ] [\uAC80\uC99D/\uC2E4\uD589 \uBC29\uBC95]
\`\`\`

**learning (\uD559\uC2B5/\uC5F0\uAD6C)**:
\`\`\`
## \uC8FC\uC81C
[\uD559\uC2B5 \uC8FC\uC81C]

## \uD575\uC2EC \uAC1C\uB150
- [\uAC1C\uB150 1]
- [\uAC1C\uB150 2]

## \uBC30\uC6B4 \uC810
[\uC778\uC0AC\uC774\uD2B8]

## \uC801\uC6A9 \uBC29\uBC95
- [\uC2E4\uC81C \uC801\uC6A9 \uC608\uC2DC]
\`\`\`

**general (\uC77C\uBC18 \uC815\uB9AC)**:
\`\`\`
## \uC694\uC57D
[\uD575\uC2EC \uB0B4\uC6A9 2-3\uBB38\uC7A5]

## \uC8FC\uC694 \uB0B4\uC6A9
- [\uD3EC\uC778\uD2B8 1]
- [\uD3EC\uC778\uD2B8 2]

## \uAD00\uB828 \uC815\uBCF4
- [\uCC38\uACE0 \uC0AC\uD56D]
\`\`\`

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "targetType": "project \uB610\uB294 library \uB610\uB294 archive",
  "contentType": "artifact \uB610\uB294 reference \uB610\uB294 general",
  "projectName": "\uD504\uB85C\uC81D\uD2B8\uBA85 (project \uB610\uB294 reference\uC77C \uB54C)",
  "isNewProject": true/false,
  "confidence": "high \uB610\uB294 medium \uB610\uB294 low",
  "reason": "\uC774 \uBD84\uB958\uB97C \uC120\uD0DD\uD55C \uC774\uC720 (1\uC904)",
  "title": "\uB178\uD2B8 \uC81C\uBAA9",
  "summary": "2-3\uBB38\uC7A5 \uC694\uC57D",
  "nextAction": "\uB2E4\uC74C \uD589\uB3D9 \uB610\uB294 null",
  "shouldRestructure": true/false,
  "restructureType": "meeting \uB610\uB294 idea \uB610\uB294 learning \uB610\uB294 general (\uC7AC\uAD6C\uC131 \uD544\uC694\uC2DC)",
  "restructuredContent": "\uC7AC\uAD6C\uC131\uB41C \uB9C8\uD06C\uB2E4\uC6B4 \uB0B4\uC6A9 (shouldRestructure\uAC00 true\uC77C \uB54C)"
}

**\uC911\uC694**: shouldRestructure\uAC00 false\uBA74 restructureType\uACFC restructuredContent\uB294 \uC0DD\uB7B5
`,S0=`\uB108\uB294 \uC81C\uD154\uCE74\uC2A4\uD150(Zettelkasten) \uBC29\uC2DD\uC758 \uC601\uAD6C \uB178\uD2B8\uB97C \uB9CC\uB4DC\uB294 \uBE44\uC11C\uB2E4.
\uC544\uB798 \uB178\uD2B8\uC5D0\uC11C \uC81C\uD154\uCE74\uC2A4\uD150\uC6A9 \uC601\uAD6C \uB178\uD2B8 \uD6C4\uBCF4 \uC544\uC774\uB514\uC5B4\uB4E4\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uD55C \uB178\uD2B8\uC5D0\uB294 \uD558\uB098\uC758 \uC544\uC774\uB514\uC5B4\uB9CC \uB2F4\uB294\uB2E4 (atomic note)
- \uAC01 \uC544\uC774\uB514\uC5B4\uB294 3-5\uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD55C\uB2E4
- \uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C
- \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC5F0\uACB0\uB420 \uC218 \uC788\uB294 \uAC1C\uB150 2-3\uAC1C\uB97C \uC81C\uC548\uD574\uB77C
- \uC544\uC774\uB514\uC5B4\uB9C8\uB2E4 \uC5F0\uAD00 \uD0A4\uC6CC\uB4DC\uB97C \uD568\uAED8 \uC801\uC5B4\uB77C

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uC544\uC774\uB514\uC5B4\uB97C \uD55C \uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD558\uB294 \uC81C\uBAA9",
    "body": "3-5\uBB38\uC7A5\uC758 \uC124\uBA85",
    "importance": "\uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uAC00? (1\uC904)",
    "relatedConcepts": ["\uAC1C\uB1501", "\uAC1C\uB1502", "\uAC1C\uB1503"],
    "keywords": ["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3"]
  }
]

\uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uC744 \uBC18\uD658\uD574\uB77C.
`,_0=`\uB108\uB294 \uB098\uC758 \uC791\uC5C5 \uC6B0\uC120\uC21C\uC704 \uCF54\uCE58\uB2E4.
\uC544\uB798 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D\uC744 \uBCF4\uACE0, \uC9C0\uAE08 \uB0B4\uAC00 \uC9D1\uC911\uD574\uC57C \uD560 \uC0C1\uC704 3\uAC1C\uB9CC \uACE8\uB77C\uB77C.

## \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uAC01 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uB300\uD574 \uB2E4\uC74C\uC744 \uC81C\uACF5\uD574\uB77C
- title: \uD504\uB85C\uC81D\uD2B8 \uC774\uB984
- why: \uC65C \uC9C0\uAE08 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904 \uC124\uBA85
- next_action: \uC624\uB298 \uB2F9\uC7A5 \uD560 \uC218 \uC788\uB294 \uAC00\uC7A5 \uC791\uC740 \uB2E4\uC74C \uD589\uB3D9

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uD504\uB85C\uC81D\uD2B8 \uC774\uB984",
    "why": "\uC911\uC694\uD55C \uC774\uC720",
    "next_action": "\uB2E4\uC74C \uD589\uB3D9"
  }
]
`,C0=`\uC774 \uC774\uBBF8\uC9C0\uC5D0\uC11C \uD14D\uC2A4\uD2B8\uB97C \uCD94\uCD9C\uD574\uB77C.
\uC190\uAE00\uC528, \uC778\uC1C4\uBB3C, \uC2A4\uCE94 \uBB38\uC11C \uB4F1 \uBAA8\uB4E0 \uD615\uD0DC\uC758 \uD14D\uC2A4\uD2B8\uB97C \uC77D\uC5B4\uB77C.

## \uADDC\uCE59
- \uC774\uBBF8\uC9C0\uC5D0 \uBCF4\uC774\uB294 \uBAA8\uB4E0 \uD14D\uC2A4\uD2B8\uB97C \uADF8\uB300\uB85C \uCD94\uCD9C
- \uC6D0\uBCF8\uC758 \uC904\uBC14\uAFC8\uACFC \uAD6C\uC870\uB97C \uCD5C\uB300\uD55C \uC720\uC9C0
- \uD45C\uAC00 \uC788\uC73C\uBA74 \uB9C8\uD06C\uB2E4\uC6B4 \uD45C\uB85C \uBCC0\uD658
- \uC77D\uC744 \uC218 \uC5C6\uB294 \uBD80\uBD84\uC740 [\uBD88\uBA85\uD655] \uC73C\uB85C \uD45C\uC2DC
- \uD14D\uC2A4\uD2B8\uB9CC \uCD9C\uB825\uD558\uACE0 \uB2E4\uB978 \uC124\uBA85\uC740 \uD558\uC9C0 \uB9C8\uB77C
`,T0=`\uB178\uD2B8 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD575\uC2EC \uD0A4\uC6CC\uB4DC 5-10\uAC1C\uB97C \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uAE30\uC220 \uC6A9\uC5B4, \uD504\uB85C\uC81D\uD2B8\uBA85, \uC8FC\uC694 \uAC1C\uB150 \uC704\uC8FC\uB85C \uCD94\uCD9C
- \uB108\uBB34 \uC77C\uBC18\uC801\uC778 \uB2E8\uC5B4 (\uC608: \uBC29\uBC95, \uB0B4\uC6A9, \uC815\uBCF4)\uB294 \uC81C\uC678
- \uD55C\uAE00/\uC601\uC5B4 \uBAA8\uB450 \uAC00\uB2A5
- \uBCF5\uD569 \uBA85\uC0AC\uB294 \uBD84\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C (\uC608: "\uC2A4\uB9C8\uD2B8\uD31C", "API\uD0A4")

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3", ...]
`,x0=`\uC0C8 \uB178\uD2B8\uC640 \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4\uC758 \uAD00\uB828\uC131\uC744 \uBD84\uC11D\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {newTitle}
\uD0A4\uC6CC\uB4DC: {newKeywords}

## \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4
{candidates}

## \uADDC\uCE59
- \uAC01 \uD6C4\uBCF4 \uB178\uD2B8\uC5D0 \uB300\uD574 \uAD00\uB828\uB3C4 \uC810\uC218(0.0~1.0)\uB97C \uB9E4\uACA8\uB77C
- 0.5 \uC774\uC0C1\uC778 \uB178\uD2B8\uB9CC \uBC18\uD658
- \uCD5C\uB300 5\uAC1C\uAE4C\uC9C0\uB9CC \uBC18\uD658
- \uAD00\uB828\uB3C4 \uB192\uC740 \uC21C\uC73C\uB85C \uC815\uB82C
- \uAC01 \uC5F0\uACB0\uC758 "\uC774\uC720"\uB97C \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C (\uC65C \uAD00\uB828\uC788\uB294\uAC00?)
- \uC5F0\uACB0 \uC720\uD615 \uBD84\uB958: \uD655\uC7A5|\uBC18\uBC15|\uC608\uC2DC|\uC804\uC81C|\uC751\uC6A9 \uC911 \uD558\uB098

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
[
  {
    "index": 0,
    "relevance": 0.8,
    "reason": "\uC774 \uB178\uD2B8\uC640 \uAD00\uB828\uC788\uB294 \uAD6C\uCCB4\uC801 \uC774\uC720",
    "type": "\uD655\uC7A5"
  }
]
`,R0=`\uC0C8 \uB178\uD2B8\uAC00 \uC5B4\uB5A4 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828\uC788\uB294\uC9C0 **\uC2E0\uC911\uD558\uAC8C** \uD310\uB2E8\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {noteTitle}
\uD0A4\uC6CC\uB4DC: {noteKeywords}

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- \uB178\uD2B8\uC758 **\uD575\uC2EC \uC8FC\uC81C**\uAC00 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB420 \uB54C\uB9CC \uD504\uB85C\uC81D\uD2B8 \uC120\uD0DD
- \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
- **\uD655\uC2E4\uD558\uC9C0 \uC54A\uC73C\uBA74 "None" \uBC18\uD658** (\uC798\uBABB\uB41C \uBD84\uB958\uBCF4\uB2E4 \uB098\uC74C)
- \uC77C\uBC18\uC801\uC778 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 \u2192 "None"
- \uC0C8\uB85C\uC6B4 \uD504\uB85C\uC81D\uD2B8\uB85C \uBCF4\uC774\uBA74 "NEW: \uD504\uB85C\uC81D\uD2B8\uBA85" \uD615\uC2DD\uC73C\uB85C \uBC18\uD658

## \uCD9C\uB825 \uD615\uC2DD (\uD504\uB85C\uC81D\uD2B8\uBA85\uB9CC \uC751\uB2F5)
\uD504\uB85C\uC81D\uD2B8\uBA85 \uB610\uB294 None \uB610\uB294 NEW: \uC0C8\uD504\uB85C\uC81D\uD2B8\uBA85
`,I0=`\uC720\uD29C\uBE0C \uC601\uC0C1\uC758 \uC790\uB9C9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uC790\uB9C9 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,D0=`\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBCF8\uBB38 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uAE00\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uAD11\uACE0\uB098 \uAD00\uB828 \uC5C6\uB294 \uB0B4\uC6A9\uC740 \uBB34\uC2DC\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,P0=`\uB108\uB294 \uBA54\uBAA8\uB97C \uBD84\uC11D\uD558\uC5EC \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uBCC4\uB85C \uBD84\uB9AC\uD558\uB294 \uBE44\uC11C\uB2E4.
\uD558\uB098\uC758 \uBA54\uBAA8\uC5D0 \uC5EC\uB7EC \uC8FC\uC81C\uB098 \uD504\uB85C\uC81D\uD2B8 \uAD00\uB828 \uB0B4\uC6A9\uC774 \uC11E\uC5EC \uC788\uC744 \uC218 \uC788\uB2E4.
\uAC01\uAC01\uC744 \uB3C5\uB9BD\uC801\uC778 \uB178\uD2B8\uB85C \uBD84\uB9AC\uD574\uB77C.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D (\uCC38\uACE0\uC6A9)
{projects}

## \uBA54\uBAA8 \uB0B4\uC6A9
{content}

## \uBD84\uB9AC \uADDC\uCE59
- \uC11C\uB85C \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uB294 \uBC18\uB4DC\uC2DC \uBD84\uB9AC\uD574\uB77C
- \uD55C \uC904\uC9DC\uB9AC \uBA54\uBAA8\uB3C4 \uC758\uBBF8\uAC00 \uC788\uC73C\uBA74 \uBD84\uB9AC \uB300\uC0C1\uC774\uB2E4
- \uAD00\uB828 \uB0B4\uC6A9\uC740 \uD558\uB098\uB85C \uBB36\uC5B4\uB77C (\uACFC\uB3C4\uD55C \uBD84\uB9AC \uAE08\uC9C0)
- \uAC01 \uC139\uC158\uC5D0 \uC801\uC808\uD55C \uC81C\uBAA9\uC744 \uBD99\uC5EC\uB77C

## \uBD84\uB958 \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- **project**: \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB41C \uB0B4\uC6A9\uB9CC
  - \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
  - \uC608: "\uC2A4\uB9C8\uD2B8\uD31C" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC788\uC5B4\uB3C4 "\uB18D\uC5C5 \uB274\uC2A4"\uB294 library
- **library**: \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 (**\uC560\uB9E4\uD558\uBA74 library**)
- **archive**: \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83
- \uC0C8 \uD504\uB85C\uC81D\uD2B8: \uBA85\uD655\uD55C \uBAA9\uD45C\uAC00 \uC788\uB294 \uC0C8\uB85C\uC6B4 \uC791\uC5C5\uC77C \uB54C\uB9CC isNewProject: true

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uBD84\uB9AC\uB41C \uC139\uC158\uC758 \uC81C\uBAA9",
    "content": "\uD574\uB2F9 \uC139\uC158\uC758 \uC6D0\uBCF8 \uB0B4\uC6A9 (\uC815\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C)",
    "targetType": "project",
    "projectName": "\uC2A4\uB9C8\uD2B8\uD31C",
    "isNewProject": false,
    "keywords": ["\uC13C\uC11C", "\uB370\uC774\uD130", "IoT"],
    "isAtomic": false
  }
]

\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC73C\uBA74 \uC804\uCCB4\uB97C \uD558\uB098\uC758 \uC139\uC158\uC73C\uB85C \uBC18\uD658\uD574\uB77C.
`,M0=`\uC8FC\uC81C\uC5D0 \uC18D\uD55C ZK \uB178\uD2B8\uB4E4\uC744 \uBD84\uC11D\uD558\uC5EC \uAD6C\uC870\uD654\uB41C \uC124\uBA85\uC744 \uC0DD\uC131\uD574\uB77C.

## \uC8FC\uC81C
{topic}

## \uB178\uD2B8 \uBAA9\uB85D
{notes}

## \uADDC\uCE59
- \uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85 \uC791\uC131
- \uAC01 \uB178\uD2B8\uC758 \uC5ED\uD560/\uC704\uCE58 \uC124\uBA85 (\uAE30\uCD08, \uC2EC\uD654, \uC751\uC6A9, \uC608\uC2DC \uC911 \uD558\uB098)
- \uB178\uD2B8 \uAC04 \uAD00\uACC4 \uD45C\uC2DC (\uBC1C\uC804, \uAE30\uBC18, \uAD00\uB828 \uC911 \uD558\uB098)
- \uAD00\uB828 \uC8FC\uC81C 2-3\uAC1C \uC81C\uC548

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "description": "\uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85",
  "notes": [
    {
      "title": "\uB178\uD2B8 \uC81C\uBAA9",
      "role": "\uAE30\uCD08",
      "relations": [{"target": "\uB2E4\uB978\uB178\uD2B8\uC81C\uBAA9", "type": "\uBC1C\uC804"}]
    }
  ],
  "relatedTopics": ["\uAD00\uB828\uC8FC\uC81C1", "\uAD00\uB828\uC8FC\uC81C2"]
}
`,k0=`PDF/\uC774\uBBF8\uC9C0 \uBB38\uC11C \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBB38\uC11C \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uBB38\uC11C\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD398\uC774\uC9C0 \uAD6C\uBD84\uC740 \uBB34\uC2DC\uD558\uACE0 \uC804\uCCB4 \uB0B4\uC6A9\uC744 \uD1B5\uD569\uD574\uC11C \uBD84\uC11D\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uBB38\uC11C \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,N0=`\uD68C\uC758 \uB179\uC74C\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uC758\uB85D\uC744 \uC791\uC131\uD574\uB77C.

## \uADDC\uCE59
1. **\uC804\uC0AC(Transcription)**: \uC74C\uC131\uC744 \uD14D\uC2A4\uD2B8\uB85C \uBCC0\uD658. \uD654\uC790 \uAD6C\uBD84\uC774 \uAC00\uB2A5\uD558\uBA74 "\uD654\uC7901:", "\uD654\uC7902:" \uD615\uC2DD\uC73C\uB85C \uD45C\uC2DC
2. **\uC694\uC57D**: \uD68C\uC758 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
3. **\uC561\uC158 \uC544\uC774\uD15C**: \uB204\uAC00 \uBB34\uC5C7\uC744 \uC5B8\uC81C\uAE4C\uC9C0 \uD560\uC9C0 \uCD94\uCD9C. \uBA85\uC2DC\uB418\uC9C0 \uC54A\uC740 \uD56D\uBAA9\uC740 null
4. **\uACB0\uC815\uC0AC\uD56D**: \uD68C\uC758\uC5D0\uC11C \uACB0\uC815\uB41C \uC0AC\uD56D\uB4E4
5. **\uB2E4\uC74C \uD68C\uC758 \uC548\uAC74**: \uD6C4\uC18D \uB17C\uC758\uAC00 \uD544\uC694\uD55C \uC8FC\uC81C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD68C\uC758 \uC81C\uBAA9 (\uC8FC\uC81C \uAE30\uBC18\uC73C\uB85C \uC0DD\uC131)",
  "transcription": "\uC804\uCCB4 \uB300\uD654 \uB0B4\uC6A9 (\uD654\uC790 \uAD6C\uBD84 \uD3EC\uD568)",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "actionItems": [
    {"task": "\uD560 \uC77C", "assignee": "\uB2F4\uB2F9\uC790 \uB610\uB294 null", "deadline": "\uAE30\uD55C \uB610\uB294 null"}
  ],
  "decisions": ["\uACB0\uC815\uC0AC\uD56D1", "\uACB0\uC815\uC0AC\uD56D2"],
  "nextAgenda": ["\uB2E4\uC74C \uC548\uAC741", "\uB2E4\uC74C \uC548\uAC742"]
}

\uC561\uC158 \uC544\uC774\uD15C, \uACB0\uC815\uC0AC\uD56D, \uB2E4\uC74C \uC548\uAC74\uC774 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uB85C \uBC18\uD658\uD574\uB77C.
`,F0=`\uB108\uB294 \uB098\uC758 \uC0DD\uC0B0\uC131 \uCF54\uCE58\uB2E4.
\uC8FC\uC5B4\uC9C4 \uAE30\uAC04 \uB3D9\uC548\uC758 \uC791\uC5C5 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uACE0 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uB77C.

## \uAE30\uAC04
{period} ({dateRange})

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5 \uB0B4\uC6A9
{projectData}

## \uBD84\uC11D \uADDC\uCE59
1. \uC804\uCCB4 \uC694\uC57D: \uC774 \uAE30\uAC04\uC758 \uC791\uC5C5\uC744 2-3\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
2. \uC8FC\uC694 \uC8FC\uC81C: \uB2E4\uB8EC \uD575\uC2EC \uC8FC\uC81C 3-5\uAC1C \uCD94\uCD9C
3. \uC778\uC0AC\uC774\uD2B8: \uBC1C\uACAC\uD55C \uC810, \uBC30\uC6B4 \uC810, \uD328\uD134 3-5\uAC1C
4. \uB2E4\uC74C \uC561\uC158: \uD6C4\uC18D\uC73C\uB85C \uD574\uC57C \uD560 \uAD6C\uCCB4\uC801\uC778 \uD589\uB3D9 3-5\uAC1C
5. \uC791\uC5C5 \uD328\uD134: \uC791\uC5C5 \uBC29\uC2DD\uC5D0\uC11C \uBC1C\uACAC\uB41C \uD328\uD134 (\uC120\uD0DD)

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "summary": "\uC804\uCCB4 \uC694\uC57D (2-3\uBB38\uC7A5)",
  "mainTopics": ["\uC8FC\uC81C1", "\uC8FC\uC81C2", "\uC8FC\uC81C3"],
  "insights": ["\uC778\uC0AC\uC774\uD2B81", "\uC778\uC0AC\uC774\uD2B82", "\uC778\uC0AC\uC774\uD2B83"],
  "nextActions": ["\uC561\uC1581", "\uC561\uC1582", "\uC561\uC1583"],
  "patterns": "\uC791\uC5C5 \uD328\uD134 \uBD84\uC11D (\uC120\uD0DD, \uC5C6\uC73C\uBA74 null)"
}
`,L0=`\uB178\uD2B8 \uB0B4\uC6A9\uC5D0\uC11C \uC77C\uC815/\uD560\uC77C/\uC57D\uC18D\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uC624\uB298 \uB0A0\uC9DC
{today}

## \uCD94\uCD9C \uADDC\uCE59
- \uB0A0\uC9DC/\uC2DC\uAC04\uC774 \uC5B8\uAE09\uB41C \uBAA8\uB4E0 \uC77C\uC815 \uCD94\uCD9C
- \uC0C1\uB300\uC801 \uB0A0\uC9DC\uB97C \uC808\uB300 \uB0A0\uC9DC\uB85C \uBCC0\uD658:
  - "\uB0B4\uC77C" \u2192 \uC624\uB298 + 1\uC77C
  - "\uBAA8\uB808" \u2192 \uC624\uB298 + 2\uC77C
  - "\uB2E4\uC74C \uC8FC \uC6D4\uC694\uC77C" \u2192 \uB2E4\uC74C \uC8FC \uC6D4\uC694\uC77C \uB0A0\uC9DC
  - "\uC774\uBC88 \uC8FC \uAE08\uC694\uC77C" \u2192 \uC774\uBC88 \uC8FC \uAE08\uC694\uC77C \uB0A0\uC9DC
  - "\uB2E4\uC74C \uB2EC" \u2192 \uB2E4\uC74C \uB2EC 1\uC77C
- \uC2DC\uAC04\uC774 \uC5C6\uC73C\uBA74 time\uC744 null\uB85C
- type \uAD6C\uBD84:
  - "event": \uC57D\uC18D, \uBBF8\uD305, \uD68C\uC758, \uBC1C\uD45C, \uBC29\uBB38 \uB4F1 \uD2B9\uC815 \uC2DC\uC810\uC758 \uD65C\uB3D9
  - "task": \uB9C8\uAC10\uC77C, \uC81C\uCD9C, \uC644\uB8CC\uD574\uC57C \uD560 \uC77C

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4)
[
  {
    "title": "\uC77C\uC815 \uC81C\uBAA9",
    "date": "2026-01-15",
    "time": "14:00",
    "type": "event"
  },
  {
    "title": "\uBCF4\uACE0\uC11C \uC81C\uCD9C",
    "date": "2026-01-17",
    "time": null,
    "type": "task"
  }
]

\uC77C\uC815\uC774 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 [] \uBC18\uD658.
`;var iO=1e3,sO=3,rO=2e3,at="gemini-3-flash-preview",xp=class{constructor(e){this.lastRequestTime=0;this.minDelayMs=iO;this.ai=new Sp({apiKey:e})}async waitForRateLimit(){let t=Date.now()-this.lastRequestTime;if(t<this.minDelayMs){let n=this.minDelayMs-t;await this.delay(n)}this.lastRequestTime=Date.now()}delay(e){return new Promise(t=>setTimeout(t,e))}async callWithRetry(e,t=sO){await this.waitForRateLimit();for(let n=0;n<=t;n++)try{return await e()}catch(s){if(s instanceof Error&&(s.message.includes("429")||s.message.includes("RESOURCE_EXHAUSTED")||s.message.includes("quota"))&&n<t){let o=rO*Math.pow(2,n);console.log(`Rate limit hit, retrying in ${o/1e3}s... (attempt ${n+1}/${t})`),await this.delay(o),this.minDelayMs=Math.min(this.minDelayMs*1.5,5e3)}else throw s}throw new Error("Max retries exceeded")}async classifyProject(e,t,n){var l;let s=t.length>0?t.map((c,d)=>`${d+1}. ${c}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",r=A0.replace("{projects}",s).replace("{content}",e);n&&(r=r.replace("## \uCD9C\uB825 \uD615\uC2DD",`${n}

## \uCD9C\uB825 \uD615\uC2DD`));let a=(l=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:r}))).text)!=null?l:"";return this.parseProjectResponse(a)}async extractZK(e){var r;let t=S0.replace("{content}",e),s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:t}))).text)!=null?r:"";return this.parseZKResponse(s)}async getFocus(e){var r;let t=_0.replace("{projects}",e),s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:t}))).text)!=null?r:"";return this.parseFocusResponse(s)}parseProjectResponse(e){var n;let t=e.match(/\{[\s\S]*\}/);if(!t)throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: JSON \uC5C6\uC74C");try{let s=JSON.parse(t[0]);return{targetType:this.validateTargetType(s.targetType),projectName:s.projectName||void 0,isNewProject:(n=s.isNewProject)!=null?n:!1,title:s.title||"Untitled",summary:s.summary||"",nextAction:s.nextAction||null}}catch(s){throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: "+e)}}parseZKResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{return JSON.parse(t[0]).map(s=>({title:s.title,body:s.body,keywords:s.keywords||[],importance:s.importance||"",relatedConcepts:s.relatedConcepts||[]}))}catch(n){return console.error("ZK \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}parseFocusResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{return JSON.parse(t[0]).map(s=>({title:s.title,why:s.why,nextAction:s.next_action}))}catch(n){return console.error("Focus \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async extractTextFromImage(e,t){var s;return(s=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:[{role:"user",parts:[{text:C0},{inlineData:{mimeType:t,data:e}}]}]}))).text)!=null?s:""}async extractTextFromImages(e,t){let n=[];for(let s=0;s<e.length;s++){let r=e[s];t&&t(s+1,e.length);let o=await this.extractTextFromImage(r.base64,r.mimeType);n.push(o),s<e.length-1&&await this.delay(500)}return n}async extractKeywords(e){var r;let t=T0.replace("{content}",e),s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:t}))).text)!=null?r:"";return this.parseKeywordsResponse(s)}async findRelatedNotes(e,t,n){var a;let s=x0.replace("{newTitle}",e).replace("{newKeywords}",t.join(", ")).replace("{candidates}",n),o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:s}))).text)!=null?a:"";return this.parseRelatedNotesResponse(o)}async detectProject(e,t,n){var l;if(n.length===0)return null;let s=R0.replace("{noteTitle}",e).replace("{noteKeywords}",t.join(", ")).replace("{projects}",n.map((c,d)=>`${d+1}. ${c}`).join(`
`)),o=((l=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:s}))).text)!=null?l:"").trim();return o.toLowerCase()==="none"||o===""?null:o.startsWith("NEW:")?o:n.find(c=>o.toLowerCase().includes(c.toLowerCase()))||null}async summarizeContent(e,t){var a;let s=(t==="youtube"?I0:D0).replace("{content}",e),o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:s}))).text)!=null?a:"";return this.parseSummaryResponse(o)}async summarizePDF(e){var r;let t=k0.replace("{content}",e),s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:t}))).text)!=null?r:"";return this.parseSummaryResponse(s)}async analyzeYouTube(e){var r;let t=`\uC774 YouTube \uC601\uC0C1\uC744 \uBD84\uC11D\uD574\uC8FC\uC138\uC694.

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD654\uBA74\uC5D0 \uBCF4\uC774\uB294 \uD14D\uC2A4\uD2B8, \uC2AC\uB77C\uC774\uB4DC, \uCF54\uB4DC \uB4F1\uB3C4 \uCC38\uACE0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:[{role:"user",parts:[{fileData:{mimeType:"video/mp4",fileUri:e}},{text:t}]}]}))).text)!=null?r:"";return this.parseSummaryResponse(s)}async analyzeWebpage(e){var r;let t=`\uB2E4\uC74C \uC6F9\uD398\uC774\uC9C0\uB97C \uBD84\uC11D\uD574\uC8FC\uC138\uC694: ${e}

## \uADDC\uCE59
- \uD398\uC774\uC9C0\uC758 \uD575\uC2EC \uB0B4\uC6A9\uC744 \uC815\uD655\uD788 \uD30C\uC545\uD574\uB77C
- \uACF5\uACE0/\uBAA8\uC9D1\uC774\uBA74: \uB300\uC0C1, \uC870\uAC74, \uAE30\uAC04, \uD61C\uD0DD\uC744 \uAD6C\uCCB4\uC801\uC73C\uB85C
- \uB274\uC2A4/\uAE30\uC0AC\uBA74: \uD575\uC2EC \uC0AC\uC2E4, \uBC30\uACBD, \uC758\uBBF8\uB97C
- \uC81C\uD488/\uC11C\uBE44\uC2A4\uBA74: \uC8FC\uC694 \uAE30\uB2A5, \uAC00\uACA9, \uD2B9\uC9D5\uC744
- \uC77C\uBC18 \uC815\uBCF4\uBA74: \uD575\uC2EC \uBA54\uC2DC\uC9C0\uC640 \uC911\uC694 \uC138\uBD80\uC0AC\uD56D\uC744
- \uC804\uBB38 \uC6A9\uC5B4, \uACE0\uC720\uBA85\uC0AC, \uC22B\uC790\uB294 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD398\uC774\uC9C0 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D (\uAD6C\uCCB4\uC801\uC778 \uC815\uBCF4 \uD3EC\uD568)",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,s=(r=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:t,config:{tools:[{urlContext:{}}]}}))).text)!=null?r:"";return this.parseSummaryResponse(s)}parseSummaryResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{title:"Untitled",summary:e.trim(),keyPoints:[]};try{let n=JSON.parse(t[0]);return{title:n.title||"Untitled",summary:n.summary||"",keyPoints:Array.isArray(n.keyPoints)?n.keyPoints:[]}}catch(n){return console.error("\uC694\uC57D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{title:"Untitled",summary:e.trim(),keyPoints:[]}}}parseKeywordsResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(s=>typeof s=="string"):[]}catch(n){return console.error("\uD0A4\uC6CC\uB4DC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}parseRelatedNotesResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(s=>typeof s=="object"&&typeof s.index=="number"&&typeof s.relevance=="number").filter(s=>s.relevance>=.5).sort((s,r)=>r.relevance-s.relevance).slice(0,5).map(s=>({index:s.index,relevance:s.relevance,reason:s.reason||"",type:s.type||""})):[]}catch(n){return console.error("\uAD00\uB828 \uB178\uD2B8 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async generateTopicStructure(e,t){var o;let n=M0.replace("{topic}",e).replace("{notes}",t),r=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:n}))).text)!=null?o:"";return this.parseTopicStructureResponse(r)}parseTopicStructureResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{description:"",notes:[],relatedTopics:[]};try{let n=JSON.parse(t[0]);return{description:n.description||"",notes:Array.isArray(n.notes)?n.notes:[],relatedTopics:Array.isArray(n.relatedTopics)?n.relatedTopics:[]}}catch(n){return console.error("\uC8FC\uC81C \uAD6C\uC870 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{description:"",notes:[],relatedTopics:[]}}}async splitContent(e,t){var a;let n=t.length>0?t.map((l,c)=>`${c+1}. ${l}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",s=P0.replace("{projects}",n).replace("{content}",e),o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:s}))).text)!=null?a:"";return this.parseSplitResponse(o)}parseSplitResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.map(s=>{var r,o;return{title:s.title||"Untitled",content:s.content||"",targetType:this.validateTargetType(s.targetType),project:s.projectName||void 0,isNewProject:(r=s.isNewProject)!=null?r:!1,keywords:Array.isArray(s.keywords)?s.keywords:[],isAtomic:(o=s.isAtomic)!=null?o:!1}}):[]}catch(n){return console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}validateTargetType(e){return["project","library","archive"].includes(e)?e:"library"}async analyzeReview(e,t,n){var h;let r={today:"\uC624\uB298",week:"\uC774\uBC88 \uC8FC",month:"\uC774\uBC88 \uB2EC",custom:"\uC0AC\uC6A9\uC790 \uC9C0\uC815 \uAE30\uAC04"}[e]||"\uAE30\uAC04",o=`${Le(t.start,"auto")} ~ ${Le(t.end,"auto")}`,a=n.map(p=>{let m=p.notes.map(y=>`  - ${y.title}${y.summary?`: ${y.summary}`:""}`).join(`
`);return`### ${p.projectName} (${p.noteCount}\uAC1C)
${m}`}).join(`

`),l=F0.replace("{period}",r).replace("{dateRange}",o).replace("{projectData}",a),d=(h=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:l}))).text)!=null?h:"";return this.parseReviewAnalysisResponse(d)}parseReviewAnalysisResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]};try{let n=JSON.parse(t[0]);return{summary:n.summary||"",mainTopics:Array.isArray(n.mainTopics)?n.mainTopics:[],insights:Array.isArray(n.insights)?n.insights:[],nextActions:Array.isArray(n.nextActions)?n.nextActions:[],patterns:n.patterns||void 0}}catch(n){return console.error("\uD68C\uACE0 \uBD84\uC11D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]}}}async analyzeMeeting(e,t,n){var a;console.log("\uD68C\uC758 \uB179\uC74C \uC5C5\uB85C\uB4DC \uC911...",n);let s=await this.ai.files.upload({file:e,config:{mimeType:t}});console.log("\uC5C5\uB85C\uB4DC \uC644\uB8CC:",s.uri);let o=(a=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:[{role:"user",parts:[{fileData:{fileUri:s.uri,mimeType:s.mimeType}},{text:N0}]}]}))).text)!=null?a:"";return this.parseMeetingResponse(o,n)}parseMeetingResponse(e,t){let n=e.match(/\{[\s\S]*\}/);if(!n)return{title:"\uD68C\uC758\uB85D",transcription:e.trim(),summary:"",actionItems:[],decisions:[],nextAgenda:[],sourceFile:t};try{let s=JSON.parse(n[0]);return{title:s.title||"\uD68C\uC758\uB85D",transcription:s.transcription||"",summary:s.summary||"",actionItems:Array.isArray(s.actionItems)?s.actionItems.map(r=>({task:r.task||"",assignee:r.assignee||null,deadline:r.deadline||null})):[],decisions:Array.isArray(s.decisions)?s.decisions:[],nextAgenda:Array.isArray(s.nextAgenda)?s.nextAgenda:[],sourceFile:t}}catch(s){return console.error("\uD68C\uC758\uB85D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{title:"\uD68C\uC758\uB85D",transcription:e.trim(),summary:"",actionItems:[],decisions:[],nextAgenda:[],sourceFile:t}}}async detectSchedules(e,t){var o;let n=L0.replace("{content}",e).replace("{today}",t),r=(o=(await this.callWithRetry(async()=>await this.ai.models.generateContent({model:at,contents:n}))).text)!=null?o:"";return this.parseSchedulesResponse(r)}parseSchedulesResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(s=>typeof s=="object"&&typeof s.title=="string"&&typeof s.date=="string"&&(s.type==="event"||s.type==="task")).map(s=>({title:s.title,date:s.date,time:s.time||null,type:s.type})):[]}catch(n){return console.error("\uC77C\uC815 \uAC10\uC9C0 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async generateEmbedding(e){if(!e||e.trim().length===0)return[];let t=e.length>8e3?e.substring(0,8e3):e,n=await this.callWithRetry(async()=>await this.ai.models.embedContent({model:"text-embedding-004",contents:[{parts:[{text:t}]}],config:{outputDimensionality:768}}));return n.embeddings&&n.embeddings.length>0?n.embeddings[0].values||[]:[]}async batchGenerateEmbeddings(e,t){let n=[];for(let s=0;s<e.length;s++){t&&t(s+1,e.length);let r=await this.generateEmbedding(e[s]);n.push(r),s<e.length-1&&await this.delay(300)}return n}};var $A=require("obsidian");var tU={};var ld={};ld.d=(i,e)=>{for(var t in e)ld.o(e,t)&&!ld.o(i,t)&&Object.defineProperty(i,t,{enumerable:!0,get:e[t]})};ld.o=(i,e)=>Object.prototype.hasOwnProperty.call(i,e);var K=globalThis.pdfjsLib={};ld.d(K,{AbortException:()=>gi,AnnotationEditorLayer:()=>xA,AnnotationEditorParamsType:()=>oe,AnnotationEditorType:()=>j,AnnotationEditorUIManager:()=>Xo,AnnotationLayer:()=>sA,AnnotationMode:()=>Es,ColorPicker:()=>Lg,DOMSVGFactory:()=>Ed,DrawLayer:()=>DA,FeatureTest:()=>nt,GlobalWorkerOptions:()=>Vn,ImageKind:()=>kp,InvalidPDFException:()=>hd,MissingPDFException:()=>Wo,OPS:()=>Tn,OutputScale:()=>gd,PDFDataRangeTransport:()=>_g,PDFDateString:()=>dd,PDFWorker:()=>Oa,PasswordResponses:()=>dO,PermissionFlag:()=>cO,PixelsPerInch:()=>sr,RenderingCancelledException:()=>pd,TextLayer:()=>vd,TouchManager:()=>fg,UnexpectedResponseException:()=>pc,Util:()=>V,VerbosityLevel:()=>Sy,XfaLayer:()=>xg,build:()=>jO,createValidAbsoluteUrl:()=>pO,fetchData:()=>xy,getDocument:()=>KO,getFilenameFromUrl:()=>AO,getPdfFilenameFromUrl:()=>SO,getXfaPageViewport:()=>_O,isDataScheme:()=>Ry,isPdfFile:()=>FA,noContextMenu:()=>Gn,normalizeUnicode:()=>bO,setLayerDimensions:()=>Yo,shadow:()=>se,stopEvent:()=>Qt,version:()=>ZO});var mt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),j0=[1,0,0,1,0,0],vE=[.001,0,0,.001,0,0],oO=1e7,Mp=1.35,aO=.35,d$=aO/Mp,jt={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Es={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},lO="pdfjs_internal_editor_",j={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},oe={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},cO={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},lt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},kp={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ue={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var $c={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var Sy={ERRORS:0,WARNINGS:1,INFOS:5},Tn={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},dO={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},_y=Sy.WARNINGS;function uO(i){Number.isInteger(i)&&(_y=i)}function hO(){return _y}function Cy(i){_y>=Sy.INFOS&&console.log(`Info: ${i}`)}function Q(i){_y>=Sy.WARNINGS&&console.log(`Warning: ${i}`)}function ge(i){throw new Error(i)}function ke(i,e){i||ge(e)}function fO(i){switch(i==null?void 0:i.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function pO(i,e=null,t=null){if(!i)return null;try{if(t&&typeof i=="string"){if(t.addDefaultProtocol&&i.startsWith("www.")){let s=i.match(/\./g);(s==null?void 0:s.length)>=2&&(i=`http://${i}`)}if(t.tryConvertEncoding)try{i=vO(i)}catch(s){}}let n=e?new URL(i,e):new URL(i);if(fO(n))return n}catch(n){}return null}function se(i,e,t,n=!1){return Object.defineProperty(i,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}var rr=function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}(),cg=class extends rr{constructor(e,t){super(e,"PasswordException"),this.code=t}},cd=class extends rr{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},hd=class extends rr{constructor(e){super(e,"InvalidPDFException")}},Wo=class extends rr{constructor(e){super(e,"MissingPDFException")}},pc=class extends rr{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},bE=class extends rr{constructor(e){super(e,"FormatError")}},gi=class extends rr{constructor(e){super(e,"AbortException")}};function Q0(i){(typeof i!="object"||(i==null?void 0:i.length)===void 0)&&ge("Invalid argument for bytesToString");let e=i.length,t=8192;if(e<t)return String.fromCharCode.apply(null,i);let n=[];for(let s=0;s<e;s+=t){let r=Math.min(s+t,e),o=i.subarray(s,r);n.push(String.fromCharCode.apply(null,o))}return n.join("")}function Ty(i){typeof i!="string"&&ge("Invalid argument for stringToBytes");let e=i.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=i.charCodeAt(n)&255;return t}function gO(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255)}function kA(i){let e=Object.create(null);for(let[t,n]of i)e[t]=n;return e}function mO(){let i=new Uint8Array(4);return i[0]=1,new Uint32Array(i.buffer,0,1)[0]===1}function yO(){try{return new Function(""),!0}catch(i){return!1}}var nt=class{static get isLittleEndian(){return se(this,"isLittleEndian",mO())}static get isEvalSupported(){return se(this,"isEvalSupported",yO())}static get isOffscreenCanvasSupported(){return se(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas!="undefined")}static get isImageDecoderSupported(){return se(this,"isImageDecoderSupported",typeof ImageDecoder!="undefined")}static get platform(){return typeof navigator!="undefined"&&typeof(navigator==null?void 0:navigator.platform)=="string"?se(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):se(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return se(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}},fE=Array.from(Array(256).keys(),i=>i.toString(16).padStart(2,"0")),Ua,Np,Cd,EE,V=class{static makeHexColor(e,t,n){return`#${fE[e]}${fE[t]}${fE[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){let n=e[0]*t[0]+e[1]*t[2]+t[4],s=e[0]*t[1]+e[1]*t[3]+t[5];return[n,s]}static applyInverseTransform(e,t){let n=t[0]*t[3]-t[1]*t[2],s=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[s,r]}static getAxialAlignedBoundingBox(e,t){let n=this.applyTransform(e,t),s=this.applyTransform(e.slice(2,4),t),r=this.applyTransform([e[0],e[3]],t),o=this.applyTransform([e[2],e[1]],t);return[Math.min(n[0],s[0],r[0],o[0]),Math.min(n[1],s[1],r[1],o[1]),Math.max(n[0],s[0],r[0],o[0]),Math.max(n[1],s[1],r[1],o[1])]}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){let t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],s=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],a=(n+o)/2,l=Math.sqrt((n+o)**2-4*(n*o-r*s))/2,c=a+l||1,d=a-l||1;return[Math.sqrt(c),Math.sqrt(d)]}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>s)return null;let r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[n,r,s,o]}static bezierBoundingBox(e,t,n,s,r,o,a,l,c){return c?(c[0]=Math.min(c[0],e,a),c[1]=Math.min(c[1],t,l),c[2]=Math.max(c[2],e,a),c[3]=Math.max(c[3],t,l)):c=[Math.min(e,a),Math.min(t,l),Math.max(e,a),Math.max(t,l)],S(this,Cd,EE).call(this,e,n,r,a,t,s,o,l,3*(-e+3*(n-r)+a),6*(e-2*n+r),3*(n-e),c),S(this,Cd,EE).call(this,e,n,r,a,t,s,o,l,3*(-t+3*(s-o)+l),6*(t-2*s+o),3*(s-t),c),c}};Ua=new WeakSet,Np=function(e,t,n,s,r,o,a,l,c,d){if(c<=0||c>=1)return;let h=1-c,p=c*c,m=p*c,y=h*(h*(h*e+3*c*t)+3*p*n)+m*s,v=h*(h*(h*r+3*c*o)+3*p*a)+m*l;d[0]=Math.min(d[0],y),d[1]=Math.min(d[1],v),d[2]=Math.max(d[2],y),d[3]=Math.max(d[3],v)},Cd=new WeakSet,EE=function(e,t,n,s,r,o,a,l,c,d,h,p){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&S(this,Ua,Np).call(this,e,t,n,s,r,o,a,l,-h/d,p);return}let m=d**2-4*h*c;if(m<0)return;let y=Math.sqrt(m),v=2*c;S(this,Ua,Np).call(this,e,t,n,s,r,o,a,l,(-d+y)/v,p),S(this,Ua,Np).call(this,e,t,n,s,r,o,a,l,(-d-y)/v,p)},b(V,Ua),b(V,Cd);function vO(i){return decodeURIComponent(escape(i))}var pE=null,O0=null;function bO(i){return pE||(pE=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,O0=new Map([["\uFB05","\u017Ft"]])),i.replaceAll(pE,(e,t,n)=>t?t.normalize("NFKC"):O0.get(n))}function EO(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let i=new Uint8Array(32);return crypto.getRandomValues(i),Q0(i)}var NA="pdfjs_internal_id_";function wO(i){return Uint8Array.prototype.toBase64?i.toBase64():btoa(Q0(i))}typeof Promise.try!="function"&&(Promise.try=function(i,...e){return new Promise(t=>{t(i(...e))})});var Di="http://www.w3.org/2000/svg",Cr=class Cr{};W(Cr,"CSS",96),W(Cr,"PDF",72),W(Cr,"PDF_TO_CSS_UNITS",Cr.CSS/Cr.PDF);var sr=Cr;async function xy(i,e="text"){if(Yc(i,document.baseURI)){let t=await fetch(i);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{let s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}n(new Error(s.statusText))}},s.send(null)})}var fd=class i{constructor({viewBox:e,userUnit:t,scale:n,rotation:s,offsetX:r=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=s,this.offsetX=r,this.offsetY=o,n*=t;let l=(e[2]+e[0])/2,c=(e[3]+e[1])/2,d,h,p,m;switch(s%=360,s<0&&(s+=360),s){case 180:d=-1,h=0,p=0,m=1;break;case 90:d=0,h=1,p=1,m=0;break;case 270:d=0,h=-1,p=-1,m=0;break;case 0:d=1,h=0,p=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(p=-p,m=-m);let y,v,E,A;d===0?(y=Math.abs(c-e[1])*n+r,v=Math.abs(l-e[0])*n+o,E=(e[3]-e[1])*n,A=(e[2]-e[0])*n):(y=Math.abs(l-e[0])*n+r,v=Math.abs(c-e[1])*n+o,E=(e[2]-e[0])*n,A=(e[3]-e[1])*n),this.transform=[d*n,h*n,p*n,m*n,y-d*n*l-p*n*c,v-h*n*l-m*n*c],this.width=E,this.height=A}get rawDims(){let{userUnit:e,viewBox:t}=this,n=t.map(s=>s*e);return se(this,"rawDims",{pageWidth:n[2]-n[0],pageHeight:n[3]-n[1],pageX:n[0],pageY:n[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:r=!1}={}){return new i({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}convertToViewportPoint(e,t){return V.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){let t=V.applyTransform([e[0],e[1]],this.transform),n=V.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return V.applyInverseTransform([e,t],this.transform)}},pd=class extends rr{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}};function Ry(i){let e=i.length,t=0;for(;t<e&&i[t].trim()==="";)t++;return i.substring(t,t+5).toLowerCase()==="data:"}function FA(i){return typeof i=="string"&&/\.pdf$/i.test(i)}function AO(i){return[i]=i.split(/[#?]/,1),i.substring(i.lastIndexOf("/")+1)}function SO(i,e="document.pdf"){if(typeof i!="string")return e;if(Ry(i))return Q('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;let t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=t.exec(i),r=n.exec(s[1])||n.exec(s[2])||n.exec(s[3]);if(r&&(r=r[0],r.includes("%")))try{r=n.exec(decodeURIComponent(r))[0]}catch(o){}return r||e}var dg=class{constructor(){W(this,"started",Object.create(null));W(this,"times",[])}time(e){e in this.started&&Q(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Q(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:n}of this.times)t=Math.max(n.length,t);for(let{name:n,start:s,end:r}of this.times)e.push(`${n.padEnd(t)} ${r-s}ms
`);return e.join("")}};function Yc(i,e){try{let{protocol:t}=e?new URL(i,e):new URL(i);return t==="http:"||t==="https:"}catch(t){return!1}}function Gn(i){i.preventDefault()}function Qt(i){i.preventDefault(),i.stopPropagation()}var Td,dd=class{static toDateObject(e){if(!e||typeof e!="string")return null;u(this,Td)||w(this,Td,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let t=u(this,Td).exec(e);if(!t)return null;let n=parseInt(t[1],10),s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;let c=t[7]||"Z",d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,c==="-"?(o+=d,a+=h):c==="+"&&(o-=d,a-=h),new Date(Date.UTC(n,s,r,o,a,l))}};Td=new WeakMap,b(dd,Td,void 0);function _O(i,{scale:e=1,rotation:t=0}){let{width:n,height:s}=i.attributes.style,r=[0,0,parseInt(n),parseInt(s)];return new fd({viewBox:r,userUnit:1,scale:e,rotation:t})}function LA(i){if(i.startsWith("#")){let e=parseInt(i.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return i.startsWith("rgb(")?i.slice(4,-1).split(",").map(e=>parseInt(e)):i.startsWith("rgba(")?i.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Q(`Not a valid color format: "${i}"`),[0,0,0])}function CO(i){let e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(let t of i.keys()){e.style.color=t;let n=window.getComputedStyle(e).color;i.set(t,LA(n))}e.remove()}function be(i){let{a:e,b:t,c:n,d:s,e:r,f:o}=i.getTransform();return[e,t,n,s,r,o]}function Kn(i){let{a:e,b:t,c:n,d:s,e:r,f:o}=i.getTransform().invertSelf();return[e,t,n,s,r,o]}function Yo(i,e,t=!1,n=!0){if(e instanceof fd){let{pageWidth:s,pageHeight:r}=e.rawDims,{style:o}=i,a=nt.isCSSRoundSupported,l=`var(--scale-factor) * ${s}px`,c=`var(--scale-factor) * ${r}px`,d=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,h=a?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!t||e.rotation%180===0?(o.width=d,o.height=h):(o.width=h,o.height=d)}n&&i.setAttribute("data-main-rotation",e.rotation)}var gd=class{constructor(){let e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},ws,Rr,xn,Ir,xd,Rd,Hg,ex,Bg,tx,Vg,nx,Ha,Fp,Gg,ix,Id,AE,ki=class ki{constructor(e){b(this,Bg);b(this,Vg);b(this,Ha);b(this,Gg);b(this,Id);b(this,ws,null);b(this,Rr,null);b(this,xn,void 0);b(this,Ir,null);b(this,xd,null);w(this,xn,e),u(ki,Rd)||w(ki,Rd,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){let e=w(this,ws,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");let t=u(this,xn)._uiManager._signal;e.addEventListener("contextmenu",Gn,{signal:t}),e.addEventListener("pointerdown",S(ki,Hg,ex),{signal:t});let n=w(this,Ir,document.createElement("div"));n.className="buttons",e.append(n);let s=u(this,xn).toolbarPosition;if(s){let{style:r}=e,o=u(this,xn)._uiManager.direction==="ltr"?1-s[0]:s[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return S(this,Gg,ix).call(this),e}get div(){return u(this,ws)}hide(){var e;u(this,ws).classList.add("hidden"),(e=u(this,Rr))==null||e.hideDropdown()}show(){var e;u(this,ws).classList.remove("hidden"),(e=u(this,xd))==null||e.shown()}async addAltText(e){let t=await e.render();S(this,Ha,Fp).call(this,t),u(this,Ir).prepend(t,u(this,Id,AE)),w(this,xd,e)}addColorPicker(e){w(this,Rr,e);let t=e.renderButton();S(this,Ha,Fp).call(this,t),u(this,Ir).prepend(t,u(this,Id,AE))}remove(){var e;u(this,ws).remove(),(e=u(this,Rr))==null||e.destroy(),w(this,Rr,null)}};ws=new WeakMap,Rr=new WeakMap,xn=new WeakMap,Ir=new WeakMap,xd=new WeakMap,Rd=new WeakMap,Hg=new WeakSet,ex=function(e){e.stopPropagation()},Bg=new WeakSet,tx=function(e){u(this,xn)._focusEventsAllowed=!1,Qt(e)},Vg=new WeakSet,nx=function(e){u(this,xn)._focusEventsAllowed=!0,Qt(e)},Ha=new WeakSet,Fp=function(e){let t=u(this,xn)._uiManager._signal;e.addEventListener("focusin",S(this,Bg,tx).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",S(this,Vg,nx).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Gn,{signal:t})},Gg=new WeakSet,ix=function(){let{editorType:e,_uiManager:t}=u(this,xn),n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",u(ki,Rd)[e]),S(this,Ha,Fp).call(this,n),n.addEventListener("click",s=>{t.delete()},{signal:t._signal}),u(this,Ir).append(n)},Id=new WeakSet,AE=function(){let e=document.createElement("div");return e.className="divider",e},b(ki,Hg),b(ki,Rd,null);var wE=ki,Dd,Dr,Pr,$g,sx,zg,rx,qg,ox,SE=class{constructor(e){b(this,$g);b(this,zg);b(this,qg);b(this,Dd,null);b(this,Dr,null);b(this,Pr,void 0);w(this,Pr,e)}show(e,t,n){let[s,r]=S(this,zg,rx).call(this,t,n),{style:o}=u(this,Dr)||w(this,Dr,S(this,$g,sx).call(this));e.append(u(this,Dr)),o.insetInlineEnd=`${100*s}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){u(this,Dr).remove()}};Dd=new WeakMap,Dr=new WeakMap,Pr=new WeakMap,$g=new WeakSet,sx=function(){let e=w(this,Dr,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Gn,{signal:u(this,Pr)._signal});let t=w(this,Dd,document.createElement("div"));return t.className="buttons",e.append(t),S(this,qg,ox).call(this),e},zg=new WeakSet,rx=function(e,t){let n=0,s=0;for(let r of e){let o=r.y+r.height;if(o<n)continue;let a=r.x+(t?r.width:0);if(o>n){s=a,n=o;continue}t?a>s&&(s=a):a<s&&(s=a)}return[t?1-s:s,n]},qg=new WeakSet,ox=function(){let e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let n=u(this,Pr)._signal;e.addEventListener("contextmenu",Gn,{signal:n}),e.addEventListener("click",()=>{u(this,Pr).highlightSelection("floating_button")},{signal:n}),u(this,Dd).append(e)};function ug(i,e,t){for(let n of t)e.addEventListener(n,i[n].bind(i))}var Wg,_E=class{constructor(){b(this,Wg,0)}get id(){return`${lO}${vt(this,Wg)._++}`}};Wg=new WeakMap;var Ba,Pd,ut,Va,Lp,OA=class OA{constructor(){b(this,Va);b(this,Ba,EO());b(this,Pd,0);b(this,ut,null)}static get _isSVGFittingCanvas(){let e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;let r=s.decode().then(()=>(n.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return se(this,"_isSVGFittingCanvas",r)}async getFromFile(e){let{lastModified:t,name:n,size:s,type:r}=e;return S(this,Va,Lp).call(this,`${t}_${n}_${s}_${r}`,e)}async getFromUrl(e){return S(this,Va,Lp).call(this,e,e)}async getFromBlob(e,t){let n=await t;return S(this,Va,Lp).call(this,e,n)}async getFromId(e){u(this,ut)||w(this,ut,new Map);let t=u(this,ut).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){let{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){u(this,ut)||w(this,ut,new Map);let n=u(this,ut).get(e);if(n!=null&&n.bitmap)return n.refCounter+=1,n;let s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),n={bitmap:s.transferToImageBitmap(),id:`image_${u(this,Ba)}_${vt(this,Pd)._++}`,refCounter:1,isSvg:!1},u(this,ut).set(e,n),u(this,ut).set(n.id,n),n}getSvgUrl(e){let t=u(this,ut).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var s;u(this,ut)||w(this,ut,new Map);let t=u(this,ut).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;let{bitmap:n}=t;if(!t.url&&!t.file){let r=new OffscreenCanvas(n.width,n.height);r.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=r.convertToBlob()}(s=n.close)==null||s.call(n),t.bitmap=null}isValidId(e){return e.startsWith(`image_${u(this,Ba)}_`)}};Ba=new WeakMap,Pd=new WeakMap,ut=new WeakMap,Va=new WeakSet,Lp=async function(e,t){u(this,ut)||w(this,ut,new Map);let n=u(this,ut).get(e);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${u(this,Ba)}_${vt(this,Pd)._++}`,refCounter:0,isSvg:!1});let s;if(typeof t=="string"?(n.url=t,s=await xy(t,"blob")):t instanceof File?s=n.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){let r=OA._isSVGFittingCanvas,o=new FileReader,a=new Image,l=new Promise((c,d)=>{a.onload=()=>{n.bitmap=a,n.isSvg=!0,c()},o.onload=async()=>{let h=n.svgUrl=o.result;a.src=await r?`${h}#svgView(preserveAspectRatio(none))`:h},a.onerror=o.onerror=d});o.readAsDataURL(s),await l}else n.bitmap=await createImageBitmap(s);n.refCounter=1}catch(s){Q(s),n=null}return u(this,ut).set(e,n),n&&u(this,ut).set(n.id,n),n};var CE=OA,Re,As,Md,Ae,TE=class{constructor(e=128){b(this,Re,[]);b(this,As,!1);b(this,Md,void 0);b(this,Ae,-1);w(this,Md,e)}add({cmd:e,undo:t,post:n,mustExec:s,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(s&&e(),u(this,As))return;let l={cmd:e,undo:t,post:n,type:r};if(u(this,Ae)===-1){u(this,Re).length>0&&(u(this,Re).length=0),w(this,Ae,0),u(this,Re).push(l);return}if(o&&u(this,Re)[u(this,Ae)].type===r){a&&(l.undo=u(this,Re)[u(this,Ae)].undo),u(this,Re)[u(this,Ae)]=l;return}let c=u(this,Ae)+1;c===u(this,Md)?u(this,Re).splice(0,1):(w(this,Ae,c),c<u(this,Re).length&&u(this,Re).splice(c)),u(this,Re).push(l)}undo(){if(u(this,Ae)===-1)return;w(this,As,!0);let{undo:e,post:t}=u(this,Re)[u(this,Ae)];e(),t==null||t(),w(this,As,!1),w(this,Ae,u(this,Ae)-1)}redo(){if(u(this,Ae)<u(this,Re).length-1){w(this,Ae,u(this,Ae)+1),w(this,As,!0);let{cmd:e,post:t}=u(this,Re)[u(this,Ae)];e(),t==null||t(),w(this,As,!1)}}hasSomethingToUndo(){return u(this,Ae)!==-1}hasSomethingToRedo(){return u(this,Ae)<u(this,Re).length-1}cleanType(e){if(u(this,Ae)!==-1){for(let t=u(this,Ae);t>=0;t--)if(u(this,Re)[t].type!==e){u(this,Re).splice(t+1,u(this,Ae)-t),w(this,Ae,t);return}u(this,Re).length=0,w(this,Ae,-1)}}destroy(){w(this,Re,null)}};Re=new WeakMap,As=new WeakMap,Md=new WeakMap,Ae=new WeakMap;var Yg,ax,Ko=class{constructor(e){b(this,Yg);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=nt.platform;for(let[n,s,r={}]of e)for(let o of n){let a=o.startsWith("mac+");t&&a?(this.callbacks.set(o.slice(4),{callback:s,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!a&&(this.callbacks.set(o,{callback:s,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;let n=this.callbacks.get(S(this,Yg,ax).call(this,t));if(!n)return;let{callback:s,options:{bubbles:r=!1,args:o=[],checker:a=null}}=n;a&&!a(e,t)||(s.bind(e,...o,t)(),r||Qt(t))}};Yg=new WeakSet,ax=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let t=this.buffer.join("+");return this.buffer.length=0,t};var Kg=class Kg{get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return CO(e),se(this,"_colors",e)}convert(e){let t=LA(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(let[n,s]of this._colors)if(s.every((r,o)=>r===t[o]))return Kg._colorsMapping.get(n);return t}getHexCode(e){let t=this._colors.get(e);return t?V.makeHexColor(...t):e}};W(Kg,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var xE=Kg,Ga,Bt,He,Je,$a,Fi,za,ln,Ss,Mr,qa,kr,Zn,Rn,Nr,kd,Nd,Wa,Fd,jn,_s,Ya,Cs,Qn,Xg,Ts,Ld,xs,Fr,Od,Ud,$e,he,Li,Lr,Hd,Bd,Rs,ei,Oi,Vd,cn,Ka,Op,Gd,RE,Jg,lx,Zg,cx,Xa,Up,jg,dx,Qg,ux,em,hx,$d,IE,tm,fx,zd,DE,qd,PE,nm,px,Ze,Et,In,Pi,im,gx,sm,mx,Wd,ME,rm,yx,Or,Kc,Yd,kE,Na=class Na{constructor(e,t,n,s,r,o,a,l,c,d,h,p,m){b(this,Ka);b(this,Gd);b(this,Jg);b(this,Zg);b(this,Xa);b(this,jg);b(this,Qg);b(this,em);b(this,$d);b(this,tm);b(this,zd);b(this,qd);b(this,nm);b(this,Ze);b(this,In);b(this,im);b(this,sm);b(this,Wd);b(this,rm);b(this,Or);b(this,Yd);b(this,Ga,new AbortController);b(this,Bt,null);b(this,He,new Map);b(this,Je,new Map);b(this,$a,null);b(this,Fi,null);b(this,za,null);b(this,ln,new TE);b(this,Ss,null);b(this,Mr,null);b(this,qa,0);b(this,kr,new Set);b(this,Zn,null);b(this,Rn,null);b(this,Nr,new Set);W(this,"_editorUndoBar",null);b(this,kd,!1);b(this,Nd,!1);b(this,Wa,!1);b(this,Fd,null);b(this,jn,null);b(this,_s,null);b(this,Ya,null);b(this,Cs,!1);b(this,Qn,null);b(this,Xg,new _E);b(this,Ts,!1);b(this,Ld,!1);b(this,xs,null);b(this,Fr,null);b(this,Od,null);b(this,Ud,null);b(this,$e,j.NONE);b(this,he,new Set);b(this,Li,null);b(this,Lr,null);b(this,Hd,null);b(this,Bd,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});b(this,Rs,[0,0]);b(this,ei,null);b(this,Oi,null);b(this,Vd,null);b(this,cn,null);let y=this._signal=u(this,Ga).signal;w(this,Oi,e),w(this,Vd,t),w(this,$a,n),this._eventBus=s,s._on("editingaction",this.onEditingAction.bind(this),{signal:y}),s._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),s._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),s._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),s._on("setpreference",this.onSetPreference.bind(this),{signal:y}),s._on("switchannotationeditorparams",v=>this.updateParams(v.type,v.value),{signal:y}),S(this,jg,dx).call(this),S(this,nm,px).call(this),S(this,$d,IE).call(this),w(this,Fi,r.annotationStorage),w(this,Fd,r.filterFactory),w(this,Lr,o),w(this,Ya,a||null),w(this,kd,l),w(this,Nd,c),w(this,Wa,d),w(this,Ud,h||null),this.viewParameters={realScale:sr.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=p||null,this._supportsPinchToZoom=m!==!1}static get _keyboardManager(){let e=Na.prototype,t=o=>u(o,Oi).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),n=(o,{target:a})=>{if(a instanceof HTMLInputElement){let{type:l}=a;return l!=="text"&&l!=="number"}return!0},s=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return se(this,"_keyboardManager",new Ko([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&u(o,Oi).contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&u(o,Oi).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,n,s,r;(e=u(this,cn))==null||e.resolve(),w(this,cn,null),(t=u(this,Ga))==null||t.abort(),w(this,Ga,null),this._signal=null;for(let o of u(this,Je).values())o.destroy();u(this,Je).clear(),u(this,He).clear(),u(this,Nr).clear(),w(this,Bt,null),u(this,he).clear(),u(this,ln).destroy(),(n=u(this,$a))==null||n.destroy(),(s=u(this,Qn))==null||s.hide(),w(this,Qn,null),u(this,jn)&&(clearTimeout(u(this,jn)),w(this,jn,null)),u(this,ei)&&(clearTimeout(u(this,ei)),w(this,ei,null)),(r=this._editorUndoBar)==null||r.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return u(this,Ud)}get useNewAltTextFlow(){return u(this,Nd)}get useNewAltTextWhenAddingImage(){return u(this,Wa)}get hcmFilter(){return se(this,"hcmFilter",u(this,Lr)?u(this,Fd).addHCMFilter(u(this,Lr).foreground,u(this,Lr).background):"none")}get direction(){return se(this,"direction",getComputedStyle(u(this,Oi)).direction)}get highlightColors(){return se(this,"highlightColors",u(this,Ya)?new Map(u(this,Ya).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return se(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),w(this,Mr,e)}setMainHighlightColorPicker(e){w(this,Od,e)}editAltText(e,t=!1){var n;(n=u(this,$a))==null||n.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":w(this,Wa,t);break}}onPageChanging({pageNumber:e}){w(this,qa,e-1)}focusMainContainer(){u(this,Oi).focus()}findParent(e,t){for(let n of u(this,Je).values()){let{x:s,y:r,width:o,height:a}=n.div.getBoundingClientRect();if(e>=s&&e<=s+o&&t>=r&&t<=r+a)return n}return null}disableUserSelect(e=!1){u(this,Vd).classList.toggle("noUserSelect",e)}addShouldRescale(e){u(this,Nr).add(e)}removeShouldRescale(e){u(this,Nr).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*sr.PDF_TO_CSS_UNITS;for(let n of u(this,Nr))n.onScaleChanging();(t=u(this,Mr))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){let t=document.getSelection();if(!t||t.isCollapsed)return;let{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}=t,a=t.toString(),c=S(this,Ka,Op).call(this,t).closest(".textLayer"),d=this.getSelectionBoxes(c);if(!d)return;t.empty();let h=S(this,Gd,RE).call(this,c),p=u(this,$e)===j.NONE,m=()=>{h==null||h.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o,text:a}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode(j.HIGHLIGHT,m);return}m()}addToAnnotationStorage(e){!e.isEmpty()&&u(this,Fi)&&!u(this,Fi).has(e.id)&&u(this,Fi).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,u(this,Cs)&&(w(this,Cs,!1),S(this,Xa,Up).call(this,"main_toolbar")),!this.hasSelection)return;let{activeElement:e}=document;for(let t of u(this,he))if(t.div.contains(e)){w(this,Fr,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!u(this,Fr))return;let[e,t]=u(this,Fr);w(this,Fr,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){S(this,$d,IE).call(this),S(this,zd,DE).call(this)}removeEditListeners(){S(this,tm,fx).call(this),S(this,qd,PE).call(this)}dragOver(e){for(let{type:t}of e.dataTransfer.items)for(let n of u(this,Rn))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(let t of e.dataTransfer.items)for(let n of u(this,Rn))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var n;if(e.preventDefault(),(n=u(this,Bt))==null||n.commitOrRemove(),!this.hasSelection)return;let t=[];for(let s of u(this,he)){let r=s.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();let{clipboardData:t}=e;for(let r of t.items)for(let o of u(this,Rn))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(r){Q(`paste: "${r.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();let s=this.currentLayer;try{let r=[];for(let l of n){let c=await s.deserialize(l);if(!c)return;r.push(c)}let o=()=>{for(let l of r)S(this,Wd,ME).call(this,l);S(this,Yd,kE).call(this,r)},a=()=>{for(let l of r)l.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(r){Q(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),u(this,$e)!==j.NONE&&!this.isEditorHandlingKeyboard&&Na._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,u(this,Cs)&&(w(this,Cs,!1),S(this,Xa,Up).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(S(this,Qg,ux).call(this),S(this,zd,DE).call(this),S(this,Ze,Et).call(this,{isEditing:u(this,$e)!==j.NONE,isEmpty:S(this,Or,Kc).call(this),hasSomethingToUndo:u(this,ln).hasSomethingToUndo(),hasSomethingToRedo:u(this,ln).hasSomethingToRedo(),hasSelectedEditor:!1})):(S(this,em,hx).call(this),S(this,qd,PE).call(this),S(this,Ze,Et).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!u(this,Rn)){w(this,Rn,e);for(let t of u(this,Rn))S(this,In,Pi).call(this,t.defaultPropertiesToUpdate)}}getId(){return u(this,Xg).id}get currentLayer(){return u(this,Je).get(u(this,qa))}getLayer(e){return u(this,Je).get(e)}get currentPageIndex(){return u(this,qa)}addLayer(e){u(this,Je).set(e.pageIndex,e),u(this,Ts)?e.enable():e.disable()}removeLayer(e){u(this,Je).delete(e.pageIndex)}async updateMode(e,t=null,n=!1){var s;if(u(this,$e)!==e&&!(u(this,cn)&&(await u(this,cn).promise,!u(this,cn)))){if(w(this,cn,Promise.withResolvers()),w(this,$e,e),e===j.NONE){this.setEditingState(!1),S(this,sm,mx).call(this),(s=this._editorUndoBar)==null||s.hide(),u(this,cn).resolve();return}this.setEditingState(!0),await S(this,im,gx).call(this),this.unselectAll();for(let r of u(this,Je).values())r.updateMode(e);if(!t){n&&this.addNewEditorFromKeyboard(),u(this,cn).resolve();return}for(let r of u(this,He).values())r.annotationElementId===t?(this.setSelected(r),r.enterInEditMode()):r.unselect();u(this,cn).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==u(this,$e)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var n;if(u(this,Rn)){switch(e){case oe.CREATE:this.currentLayer.addNewEditor();return;case oe.HIGHLIGHT_DEFAULT_COLOR:(n=u(this,Od))==null||n.updateColor(t);break;case oe.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(u(this,Hd)||w(this,Hd,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(let s of u(this,he))s.updateParams(e,t);for(let s of u(this,Rn))s.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){var r,o;for(let a of u(this,He).values())a.editorType===e&&a.show(t);((o=(r=u(this,Hd))==null?void 0:r.get(oe.HIGHLIGHT_SHOW_ALL))!=null?o:!0)!==t&&S(this,In,Pi).call(this,[[oe.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(u(this,Ld)!==e){w(this,Ld,e);for(let t of u(this,Je).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){let t=[];for(let n of u(this,He).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return u(this,He).get(e)}addEditor(e){u(this,He).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(u(this,jn)&&clearTimeout(u(this,jn)),w(this,jn,setTimeout(()=>{this.focusMainContainer(),w(this,jn,null)},0))),u(this,He).delete(e.id),this.unselect(e),(!e.annotationElementId||!u(this,kr).has(e.annotationElementId))&&((t=u(this,Fi))==null||t.remove(e.id))}addDeletedAnnotationElement(e){u(this,kr).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return u(this,kr).has(e)}removeDeletedAnnotationElement(e){u(this,kr).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){u(this,Bt)!==e&&(w(this,Bt,e),e&&S(this,In,Pi).call(this,e.propertiesToUpdate))}updateUI(e){u(this,rm,yx)===e&&S(this,In,Pi).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){S(this,In,Pi).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(u(this,he).has(e)){u(this,he).delete(e),e.unselect(),S(this,Ze,Et).call(this,{hasSelectedEditor:this.hasSelection});return}u(this,he).add(e),e.select(),S(this,In,Pi).call(this,e.propertiesToUpdate),S(this,Ze,Et).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=u(this,Mr))==null||t.commitOrRemove();for(let n of u(this,he))n!==e&&n.unselect();u(this,he).clear(),u(this,he).add(e),e.select(),S(this,In,Pi).call(this,e.propertiesToUpdate),S(this,Ze,Et).call(this,{hasSelectedEditor:!0})}isSelected(e){return u(this,he).has(e)}get firstSelectedEditor(){return u(this,he).values().next().value}unselect(e){e.unselect(),u(this,he).delete(e),S(this,Ze,Et).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return u(this,he).size!==0}get isEnterHandled(){return u(this,he).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;u(this,ln).undo(),S(this,Ze,Et).call(this,{hasSomethingToUndo:u(this,ln).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:S(this,Or,Kc).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){u(this,ln).redo(),S(this,Ze,Et).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:u(this,ln).hasSomethingToRedo(),isEmpty:S(this,Or,Kc).call(this)})}addCommands(e){u(this,ln).add(e),S(this,Ze,Et).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:S(this,Or,Kc).call(this)})}cleanUndoStack(e){u(this,ln).cleanType(e)}delete(){var r;this.commitOrRemove();let e=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!e)return;let t=e?[e]:[...u(this,he)],n=()=>{var o;(o=this._editorUndoBar)==null||o.show(s,t.length===1?t[0].editorType:t.length);for(let a of t)a.remove()},s=()=>{for(let o of t)S(this,Wd,ME).call(this,o)};this.addCommands({cmd:n,undo:s,mustExec:!0})}commitOrRemove(){var e;(e=u(this,Bt))==null||e.commitOrRemove()}hasSomethingToControl(){return u(this,Bt)||this.hasSelection}selectAll(){for(let e of u(this,he))e.commit();S(this,Yd,kE).call(this,u(this,He).values())}unselectAll(){var e;if(!(u(this,Bt)&&(u(this,Bt).commitOrRemove(),u(this,$e)!==j.NONE))&&!((e=u(this,Mr))!=null&&e.commitOrRemove())&&this.hasSelection){for(let t of u(this,he))t.unselect();u(this,he).clear(),S(this,Ze,Et).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;u(this,Rs)[0]+=e,u(this,Rs)[1]+=t;let[s,r]=u(this,Rs),o=[...u(this,he)],a=1e3;u(this,ei)&&clearTimeout(u(this,ei)),w(this,ei,setTimeout(()=>{w(this,ei,null),u(this,Rs)[0]=u(this,Rs)[1]=0,this.addCommands({cmd:()=>{for(let l of o)u(this,He).has(l.id)&&l.translateInPage(s,r)},undo:()=>{for(let l of o)u(this,He).has(l.id)&&l.translateInPage(-s,-r)},mustExec:!1})},a));for(let l of o)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),w(this,Zn,new Map);for(let e of u(this,he))u(this,Zn).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!u(this,Zn))return!1;this.disableUserSelect(!1);let e=u(this,Zn);w(this,Zn,null);let t=!1;for(let[{x:s,y:r,pageIndex:o},a]of e)a.newX=s,a.newY=r,a.newPageIndex=o,t||(t=s!==a.savedX||r!==a.savedY||o!==a.savedPageIndex);if(!t)return!1;let n=(s,r,o,a)=>{if(u(this,He).has(s.id)){let l=u(this,Je).get(a);l?s._setParentAndPosition(l,r,o):(s.pageIndex=a,s.x=r,s.y=o)}};return this.addCommands({cmd:()=>{for(let[s,{newX:r,newY:o,newPageIndex:a}]of e)n(s,r,o,a)},undo:()=>{for(let[s,{savedX:r,savedY:o,savedPageIndex:a}]of e)n(s,r,o,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(u(this,Zn))for(let n of u(this,Zn).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){let t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||u(this,he).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return u(this,Bt)===e}getActive(){return u(this,Bt)}getMode(){return u(this,$e)}get imageManager(){return se(this,"imageManager",new CE)}getSelectionBoxes(e){if(!e)return null;let t=document.getSelection();for(let c=0,d=t.rangeCount;c<d;c++)if(!e.contains(t.getRangeAt(c).commonAncestorContainer))return null;let{x:n,y:s,width:r,height:o}=e.getBoundingClientRect(),a;switch(e.getAttribute("data-main-rotation")){case"90":a=(c,d,h,p)=>({x:(d-s)/o,y:1-(c+h-n)/r,width:p/o,height:h/r});break;case"180":a=(c,d,h,p)=>({x:1-(c+h-n)/r,y:1-(d+p-s)/o,width:h/r,height:p/o});break;case"270":a=(c,d,h,p)=>({x:1-(d+p-s)/o,y:(c-n)/r,width:p/o,height:h/r});break;default:a=(c,d,h,p)=>({x:(c-n)/r,y:(d-s)/o,width:h/r,height:p/o});break}let l=[];for(let c=0,d=t.rangeCount;c<d;c++){let h=t.getRangeAt(c);if(!h.collapsed)for(let{x:p,y:m,width:y,height:v}of h.getClientRects())y===0||v===0||l.push(a(p,m,y,v))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(u(this,za)||w(this,za,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=u(this,za))==null||t.delete(e)}renderAnnotationElement(e){var s;let t=(s=u(this,za))==null?void 0:s.get(e.data.id);if(!t)return;let n=u(this,Fi).getRawValue(t);n&&(u(this,$e)===j.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}};Ga=new WeakMap,Bt=new WeakMap,He=new WeakMap,Je=new WeakMap,$a=new WeakMap,Fi=new WeakMap,za=new WeakMap,ln=new WeakMap,Ss=new WeakMap,Mr=new WeakMap,qa=new WeakMap,kr=new WeakMap,Zn=new WeakMap,Rn=new WeakMap,Nr=new WeakMap,kd=new WeakMap,Nd=new WeakMap,Wa=new WeakMap,Fd=new WeakMap,jn=new WeakMap,_s=new WeakMap,Ya=new WeakMap,Cs=new WeakMap,Qn=new WeakMap,Xg=new WeakMap,Ts=new WeakMap,Ld=new WeakMap,xs=new WeakMap,Fr=new WeakMap,Od=new WeakMap,Ud=new WeakMap,$e=new WeakMap,he=new WeakMap,Li=new WeakMap,Lr=new WeakMap,Hd=new WeakMap,Bd=new WeakMap,Rs=new WeakMap,ei=new WeakMap,Oi=new WeakMap,Vd=new WeakMap,cn=new WeakMap,Ka=new WeakSet,Op=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},Gd=new WeakSet,RE=function(e){let{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(let n of u(this,Je).values())if(n.hasTextLayer(e))return n;return null},Jg=new WeakSet,lx=function(){let e=document.getSelection();if(!e||e.isCollapsed)return;let n=S(this,Ka,Op).call(this,e).closest(".textLayer"),s=this.getSelectionBoxes(n);s&&(u(this,Qn)||w(this,Qn,new SE(this)),u(this,Qn).show(n,s,this.direction==="ltr"))},Zg=new WeakSet,cx=function(){var r,o,a;let e=document.getSelection();if(!e||e.isCollapsed){u(this,Li)&&((r=u(this,Qn))==null||r.hide(),w(this,Li,null),S(this,Ze,Et).call(this,{hasSelectedText:!1}));return}let{anchorNode:t}=e;if(t===u(this,Li))return;let s=S(this,Ka,Op).call(this,e).closest(".textLayer");if(!s){u(this,Li)&&((o=u(this,Qn))==null||o.hide(),w(this,Li,null),S(this,Ze,Et).call(this,{hasSelectedText:!1}));return}if((a=u(this,Qn))==null||a.hide(),w(this,Li,t),S(this,Ze,Et).call(this,{hasSelectedText:!0}),!(u(this,$e)!==j.HIGHLIGHT&&u(this,$e)!==j.NONE)&&(u(this,$e)===j.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),w(this,Cs,this.isShiftKeyDown),!this.isShiftKeyDown)){let l=u(this,$e)===j.HIGHLIGHT?S(this,Gd,RE).call(this,s):null;l==null||l.toggleDrawing();let c=new AbortController,d=this.combinedSignal(c),h=p=>{p.type==="pointerup"&&p.button!==0||(c.abort(),l==null||l.toggleDrawing(!0),p.type==="pointerup"&&S(this,Xa,Up).call(this,"main_toolbar"))};window.addEventListener("pointerup",h,{signal:d}),window.addEventListener("blur",h,{signal:d})}},Xa=new WeakSet,Up=function(e=""){u(this,$e)===j.HIGHLIGHT?this.highlightSelection(e):u(this,kd)&&S(this,Jg,lx).call(this)},jg=new WeakSet,dx=function(){document.addEventListener("selectionchange",S(this,Zg,cx).bind(this),{signal:this._signal})},Qg=new WeakSet,ux=function(){if(u(this,_s))return;w(this,_s,new AbortController);let e=this.combinedSignal(u(this,_s));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},em=new WeakSet,hx=function(){var e;(e=u(this,_s))==null||e.abort(),w(this,_s,null)},$d=new WeakSet,IE=function(){if(u(this,xs))return;w(this,xs,new AbortController);let e=this.combinedSignal(u(this,xs));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},tm=new WeakSet,fx=function(){var e;(e=u(this,xs))==null||e.abort(),w(this,xs,null)},zd=new WeakSet,DE=function(){if(u(this,Ss))return;w(this,Ss,new AbortController);let e=this.combinedSignal(u(this,Ss));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},qd=new WeakSet,PE=function(){var e;(e=u(this,Ss))==null||e.abort(),w(this,Ss,null)},nm=new WeakSet,px=function(){let e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Ze=new WeakSet,Et=function(e){Object.entries(e).some(([n,s])=>u(this,Bd)[n]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(u(this,Bd),e)}),u(this,$e)===j.HIGHLIGHT&&e.hasSelectedEditor===!1&&S(this,In,Pi).call(this,[[oe.HIGHLIGHT_FREE,!0]]))},In=new WeakSet,Pi=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},im=new WeakSet,gx=async function(){if(!u(this,Ts)){w(this,Ts,!0);let e=[];for(let t of u(this,Je).values())e.push(t.enable());await Promise.all(e);for(let t of u(this,He).values())t.enable()}},sm=new WeakSet,mx=function(){if(this.unselectAll(),u(this,Ts)){w(this,Ts,!1);for(let e of u(this,Je).values())e.disable();for(let e of u(this,He).values())e.disable()}},Wd=new WeakSet,ME=function(e){let t=u(this,Je).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},rm=new WeakSet,yx=function(){let e=null;for(e of u(this,he));return e},Or=new WeakSet,Kc=function(){if(u(this,He).size===0)return!0;if(u(this,He).size===1)for(let e of u(this,He).values())return e.isEmpty();return!1},Yd=new WeakSet,kE=function(e){for(let t of u(this,he))t.unselect();u(this,he).clear();for(let t of e)t.isEmpty()||(u(this,he).add(t),t.select());S(this,Ze,Et).call(this,{hasSelectedEditor:this.hasSelection})},W(Na,"TRANSLATE_SMALL",1),W(Na,"TRANSLATE_BIG",10);var Xo=Na,ze,ti,Dn,Ja,ni,Vt,Za,ii,Dt,Ui,Ur,si,Is,Hr,Xc,ja,Hp,wt=class wt{constructor(e){b(this,Hr);b(this,ja);b(this,ze,null);b(this,ti,!1);b(this,Dn,null);b(this,Ja,null);b(this,ni,null);b(this,Vt,null);b(this,Za,!1);b(this,ii,null);b(this,Dt,null);b(this,Ui,null);b(this,Ur,null);b(this,si,!1);w(this,Dt,e),w(this,si,e._uiManager.useNewAltTextFlow),u(wt,Is)||w(wt,Is,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){var t;(t=wt._l10n)!=null||(wt._l10n=e)}async render(){let e=w(this,Dn,document.createElement("button"));e.className="altText",e.tabIndex="0";let t=w(this,Ja,document.createElement("span"));e.append(t),u(this,si)?(e.classList.add("new"),e.setAttribute("data-l10n-id",u(wt,Is).missing),t.setAttribute("data-l10n-id",u(wt,Is)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let n=u(this,Dt)._uiManager._signal;e.addEventListener("contextmenu",Gn,{signal:n}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});let s=r=>{r.preventDefault(),u(this,Dt)._uiManager.editAltText(u(this,Dt)),u(this,si)&&u(this,Dt)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:u(this,Hr,Xc)}})};return e.addEventListener("click",s,{capture:!0,signal:n}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(w(this,Za,!0),s(r))},{signal:n}),await S(this,ja,Hp).call(this),e}finish(){u(this,Dn)&&(u(this,Dn).focus({focusVisible:u(this,Za)}),w(this,Za,!1))}isEmpty(){return u(this,si)?u(this,ze)===null:!u(this,ze)&&!u(this,ti)}hasData(){return u(this,si)?u(this,ze)!==null||!!u(this,Ui):this.isEmpty()}get guessedText(){return u(this,Ui)}async setGuessedText(e){u(this,ze)===null&&(w(this,Ui,e),w(this,Ur,await wt._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),S(this,ja,Hp).call(this))}toggleAltTextBadge(e=!1){var t;if(!u(this,si)||u(this,ze)){(t=u(this,ii))==null||t.remove(),w(this,ii,null);return}if(!u(this,ii)){let n=w(this,ii,document.createElement("div"));n.className="noAltTextBadge",u(this,Dt).div.append(n)}u(this,ii).classList.toggle("hidden",!e)}serialize(e){let t=u(this,ze);return!e&&u(this,Ui)===t&&(t=u(this,Ur)),{altText:t,decorative:u(this,ti),guessedText:u(this,Ui),textWithDisclaimer:u(this,Ur)}}get data(){return{altText:u(this,ze),decorative:u(this,ti)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:s,cancel:r=!1}){n&&(w(this,Ui,n),w(this,Ur,s)),!(u(this,ze)===e&&u(this,ti)===t)&&(r||(w(this,ze,e),w(this,ti,t)),S(this,ja,Hp).call(this))}toggle(e=!1){u(this,Dn)&&(!e&&u(this,Vt)&&(clearTimeout(u(this,Vt)),w(this,Vt,null)),u(this,Dn).disabled=!e)}shown(){u(this,Dt)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:u(this,Hr,Xc)}})}destroy(){var e,t;(e=u(this,Dn))==null||e.remove(),w(this,Dn,null),w(this,Ja,null),w(this,ni,null),(t=u(this,ii))==null||t.remove(),w(this,ii,null)}};ze=new WeakMap,ti=new WeakMap,Dn=new WeakMap,Ja=new WeakMap,ni=new WeakMap,Vt=new WeakMap,Za=new WeakMap,ii=new WeakMap,Dt=new WeakMap,Ui=new WeakMap,Ur=new WeakMap,si=new WeakMap,Is=new WeakMap,Hr=new WeakSet,Xc=function(){return u(this,ze)&&"added"||u(this,ze)===null&&this.guessedText&&"review"||"missing"},ja=new WeakSet,Hp=async function(){var s,r,o;let e=u(this,Dn);if(!e)return;if(u(this,si)){if(e.classList.toggle("done",!!u(this,ze)),e.setAttribute("data-l10n-id",u(wt,Is)[u(this,Hr,Xc)]),(s=u(this,Ja))==null||s.setAttribute("data-l10n-id",u(wt,Is)[`${u(this,Hr,Xc)}-label`]),!u(this,ze)){(r=u(this,ni))==null||r.remove();return}}else{if(!u(this,ze)&&!u(this,ti)){e.classList.remove("done"),(o=u(this,ni))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=u(this,ni);if(!t){w(this,ni,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${u(this,Dt).id}`;let a=100,l=u(this,Dt)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(u(this,Vt)),w(this,Vt,null)},{once:!0}),e.addEventListener("mouseenter",()=>{w(this,Vt,setTimeout(()=>{w(this,Vt,null),u(this,ni).classList.add("show"),u(this,Dt)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:l}),e.addEventListener("mouseleave",()=>{var c;u(this,Vt)&&(clearTimeout(u(this,Vt)),w(this,Vt,null)),(c=u(this,ni))==null||c.classList.remove("show")},{signal:l})}u(this,ti)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=u(this,ze)),t.parentNode||e.append(t);let n=u(this,Dt).getImageForAltText();n==null||n.setAttribute("aria-describedby",t.id)},b(wt,Is,null),W(wt,"_l10n",null);var hg=wt,Kd,Br,Xd,Jd,Zd,jd,Qd,Qa,Hi,Vr,Ds,om,vx,am,bx,eu,NE,UA=class UA{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:s=null,onPinching:r=null,onPinchEnd:o=null,signal:a}){b(this,om);b(this,am);b(this,eu);b(this,Kd,void 0);b(this,Br,!1);b(this,Xd,null);b(this,Jd,void 0);b(this,Zd,void 0);b(this,jd,void 0);b(this,Qd,void 0);b(this,Qa,void 0);b(this,Hi,null);b(this,Vr,void 0);b(this,Ds,null);w(this,Kd,e),w(this,Xd,n),w(this,Jd,t),w(this,Zd,s),w(this,jd,r),w(this,Qd,o),w(this,Vr,new AbortController),w(this,Qa,AbortSignal.any([a,u(this,Vr).signal])),e.addEventListener("touchstart",S(this,om,vx).bind(this),{passive:!1,signal:u(this,Qa)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return se(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=u(this,Vr))==null||e.abort(),w(this,Vr,null)}};Kd=new WeakMap,Br=new WeakMap,Xd=new WeakMap,Jd=new WeakMap,Zd=new WeakMap,jd=new WeakMap,Qd=new WeakMap,Qa=new WeakMap,Hi=new WeakMap,Vr=new WeakMap,Ds=new WeakMap,om=new WeakSet,vx=function(e){var s,r,o;if((s=u(this,Jd))!=null&&s.call(this)||e.touches.length<2)return;if(!u(this,Ds)){w(this,Ds,new AbortController);let a=AbortSignal.any([u(this,Qa),u(this,Ds).signal]),l=u(this,Kd),c={signal:a,passive:!1};l.addEventListener("touchmove",S(this,am,bx).bind(this),c),l.addEventListener("touchend",S(this,eu,NE).bind(this),c),l.addEventListener("touchcancel",S(this,eu,NE).bind(this),c),(r=u(this,Zd))==null||r.call(this)}if(Qt(e),e.touches.length!==2||(o=u(this,Xd))!=null&&o.call(this)){w(this,Hi,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),w(this,Hi,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},am=new WeakSet,bx=function(e){var T;if(!u(this,Hi)||e.touches.length!==2)return;let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);let{screenX:s,screenY:r}=t,{screenX:o,screenY:a}=n,l=u(this,Hi),{touch0X:c,touch0Y:d,touch1X:h,touch1Y:p}=l,m=h-c,y=p-d,v=o-s,E=a-r,A=Math.hypot(v,E)||1,_=Math.hypot(m,y)||1;if(!u(this,Br)&&Math.abs(_-A)<=UA.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=s,l.touch0Y=r,l.touch1X=o,l.touch1Y=a,e.preventDefault(),!u(this,Br)){w(this,Br,!0);return}let C=[(s+o)/2,(r+a)/2];(T=u(this,jd))==null||T.call(this,C,_,A)},eu=new WeakSet,NE=function(e){var t;u(this,Ds).abort(),w(this,Ds,null),(t=u(this,Qd))==null||t.call(this),u(this,Hi)&&(e.preventDefault(),w(this,Hi,null),w(this,Br,!1))};var fg=UA,Gr,Pn,ye,el,Ps,tu,$r,je,zr,Bi,Ms,nu,qr,Gt,iu,Wr,Vi,ri,tl,nl,dn,Yr,su,lm,ru,FE,ou,LE,il,Bp,cm,Ex,dm,wx,au,OE,sl,Vp,lu,UE,um,Ax,hm,Sx,fm,_x,cu,HE,pm,Cx,du,BE,gm,Tx,mm,xx,ym,Rx,uu,VE,Kr,Jc,ee=class ee{constructor(e){b(this,ru);b(this,il);b(this,cm);b(this,dm);b(this,au);b(this,sl);b(this,lu);b(this,um);b(this,hm);b(this,fm);b(this,cu);b(this,pm);b(this,du);b(this,gm);b(this,mm);b(this,ym);b(this,uu);b(this,Kr);b(this,Gr,null);b(this,Pn,null);b(this,ye,null);b(this,el,!1);b(this,Ps,null);b(this,tu,"");b(this,$r,!1);b(this,je,null);b(this,zr,null);b(this,Bi,null);b(this,Ms,null);b(this,nu,"");b(this,qr,!1);b(this,Gt,null);b(this,iu,!1);b(this,Wr,!1);b(this,Vi,!1);b(this,ri,null);b(this,tl,0);b(this,nl,0);b(this,dn,null);b(this,Yr,null);W(this,"_editToolbar",null);W(this,"_initialOptions",Object.create(null));W(this,"_initialData",null);W(this,"_isVisible",!0);W(this,"_uiManager",null);W(this,"_focusEventsAllowed",!0);b(this,su,!1);b(this,lm,ee._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;let{rotation:t,rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,s],this.pageTranslation=[r,o];let[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){let e=ee.prototype._resizeWithKeyboard,t=Xo.TRANSLATE_SMALL,n=Xo.TRANSLATE_BIG;return se(this,"_resizerKeyboardManager",new Ko([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],ee.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return se(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let t=new GE({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){var s;if((s=ee._l10n)!=null||(ee._l10n=e),ee._l10nResizer||(ee._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),ee._borderLineWidth!==-1)return;let n=getComputedStyle(document.documentElement);ee._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){ge("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return u(this,su)}set _isDraggable(e){var t;w(this,su,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){let[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=u(this,lm)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):S(this,Kr,Jc).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(u(this,qr)?w(this,qr,!1):this.parent.setSelected(this))}focusout(e){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;let t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,s){let[r,o]=this.parentDimensions;[n,s]=this.screenToPageTranslation(n,s),this.x=(e+n)/r,this.y=(t+s)/o,this.fixAndSetPosition()}translate(e,t){S(this,ru,FE).call(this,this.parentDimensions,e,t)}translateInPage(e,t){u(this,Gt)||w(this,Gt,[this.x,this.y,this.width,this.height]),S(this,ru,FE).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){u(this,Gt)||w(this,Gt,[this.x,this.y,this.width,this.height]);let{div:n,parentDimensions:[s,r]}=this;if(this.x+=e/s,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:h,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this,[l,c]=this.getBaseTranslation();o+=l,a+=c;let{style:d}=n;d.left=`${(100*o).toFixed(2)}%`,d.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!u(this,Gt)&&(u(this,Gt)[0]!==this.x||u(this,Gt)[1]!==this.y)}get _hasBeenResized(){return!!u(this,Gt)&&(u(this,Gt)[2]!==this.width||u(this,Gt)[3]!==this.height)}getBaseTranslation(){let[e,t]=this.parentDimensions,{_borderLineWidth:n}=ee,s=n/e,r=n/t;switch(this.rotation){case 90:return[-s,r];case 180:return[s,r];case 270:return[s,-r];default:return[-s,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){let{div:{style:t},pageDimensions:[n,s]}=this,{x:r,y:o,width:a,height:l}=this;if(a*=n,l*=s,r*=n,o*=s,this._mustFixPosition)switch(e){case 0:r=Math.max(0,Math.min(n-a,r)),o=Math.max(0,Math.min(s-l,o));break;case 90:r=Math.max(0,Math.min(n-l,r)),o=Math.min(s,Math.max(a,o));break;case 180:r=Math.min(n,Math.max(a,r)),o=Math.min(s,Math.max(l,o));break;case 270:r=Math.min(n,Math.max(l,r)),o=Math.max(0,Math.min(s-a,o));break}this.x=r/=n,this.y=o/=s;let[c,d]=this.getBaseTranslation();r+=c,o+=d,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return S(n=ee,ou,LE).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return S(n=ee,ou,LE).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(e,t){let[n,s]=this.parentDimensions,{style:r}=this.div;r.width=`${(100*e/n).toFixed(2)}%`,u(this,$r)||(r.height=`${(100*t/s).toFixed(2)}%`)}fixDims(){let{style:e}=this.div,{height:t,width:n}=e,s=n.endsWith("%"),r=!u(this,$r)&&t.endsWith("%");if(s&&r)return;let[o,a]=this.parentDimensions;s||(e.width=`${(100*parseFloat(n)/o).toFixed(2)}%`),!u(this,$r)&&!r&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=u(this,ye))==null||e.finish()}async addEditToolbar(){return this._editToolbar||u(this,Wr)?this._editToolbar:(this._editToolbar=new wE(this),this.div.append(this._editToolbar.render()),u(this,ye)&&await this._editToolbar.addAltText(u(this,ye)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=u(this,ye))==null||e.destroy())}addContainer(e){var n;let t=(n=this._editToolbar)==null?void 0:n.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){u(this,ye)||(hg.initialize(ee._l10n),w(this,ye,new hg(this)),u(this,Gr)&&(u(this,ye).data=u(this,Gr),w(this,Gr,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=u(this,ye))==null?void 0:e.data}set altTextData(e){u(this,ye)&&(u(this,ye).data=e)}get guessedAltText(){var e;return(e=u(this,ye))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=u(this,ye))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=u(this,ye))==null?void 0:t.serialize(e)}hasAltText(){return!!u(this,ye)&&!u(this,ye).isEmpty()}hasAltTextData(){var e,t;return(t=(e=u(this,ye))==null?void 0:e.hasData())!=null?t:!1}render(){var r;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=u(this,el)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),S(this,du,BE).call(this);let[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);let[n,s]=this.getInitialTranslation();return this.translate(n,s),ug(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(u(this,Yr)||w(this,Yr,new fg({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:S(this,um,Ax).bind(this),onPinching:S(this,hm,Sx).bind(this),onPinchEnd:S(this,fm,_x).bind(this),signal:this._uiManager._signal}))),(r=this._uiManager._editorUndoBar)==null||r.hide(),this.div}pointerdown(e){let{isMac:t}=nt.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(w(this,qr,!0),this._isDraggable){S(this,pm,Cx).call(this,e);return}S(this,cu,HE).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){u(this,ri)&&clearTimeout(u(this,ri)),w(this,ri,setTimeout(()=>{var e;w(this,ri,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){let s=this.parentScale,[r,o]=this.pageDimensions,[a,l]=this.pageTranslation,c=e/s,d=t/s,h=this.x*r,p=this.y*o,m=this.width*r,y=this.height*o;switch(n){case 0:return[h+c+a,o-p-d-y+l,h+c+m+a,o-p-d+l];case 90:return[h+d+a,o-p+c+l,h+d+y+a,o-p+c+m+l];case 180:return[h-c-m+a,o-p+d+l,h-c+a,o-p+d+y+l];case 270:return[h-d-y+a,o-p-c-m+l,h-d+a,o-p-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){let[n,s,r,o]=e,a=r-n,l=o-s;switch(this.rotation){case 0:return[n,t-o,a,l];case 90:return[n,t-s,l,a];case 180:return[r,t-s,a,l];case 270:return[r,t-o,l,a];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){w(this,Wr,!0)}disableEditMode(){w(this,Wr,!1)}isInEditMode(){return u(this,Wr)}shouldGetKeyboardEvents(){return u(this,Vi)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:e,left:t,bottom:n,right:s}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&s>0&&e<r&&n>0}rebuild(){S(this,du,BE).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){ge("An editor must be serializable")}static async deserialize(e,t,n){let s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n});s.rotation=e.rotation,w(s,Gr,e.accessibilityData);let[r,o]=s.pageDimensions,[a,l,c,d]=s.getRectInCurrentCoords(e.rect,o);return s.x=a/r,s.y=l/o,s.width=c/r,s.height=d/o,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=u(this,Ms))==null||e.abort(),w(this,Ms,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),u(this,ri)&&(clearTimeout(u(this,ri)),w(this,ri,null)),S(this,Kr,Jc).call(this),this.removeEditToolbar(),u(this,dn)){for(let n of u(this,dn).values())clearTimeout(n);w(this,dn,null)}this.parent=null,(t=u(this,Yr))==null||t.destroy(),w(this,Yr,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(S(this,cm,Ex).call(this),u(this,je).classList.remove("hidden"),ug(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),w(this,Bi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let t=u(this,je).children;if(!u(this,Pn)){w(this,Pn,Array.from(t));let o=S(this,gm,Tx).bind(this),a=S(this,mm,xx).bind(this),l=this._uiManager._signal;for(let c of u(this,Pn)){let d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",o,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",S(this,ym,Rx).bind(this,d),{signal:l}),c.setAttribute("data-l10n-id",ee._l10nResizer[d])}}let n=u(this,Pn)[0],s=0;for(let o of t){if(o===n)break;s++}let r=(360-this.rotation+this.parentRotation)%360/90*(u(this,Pn).length/4);if(r!==s){if(r<s)for(let a=0;a<s-r;a++)u(this,je).append(u(this,je).firstChild);else if(r>s)for(let a=0;a<r-s;a++)u(this,je).firstChild.before(u(this,je).lastChild);let o=0;for(let a of t){let c=u(this,Pn)[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",ee._l10nResizer[c])}}S(this,uu,VE).call(this,0),w(this,Vi,!0),u(this,je).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){u(this,Vi)&&S(this,lu,UE).call(this,u(this,nu),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){S(this,Kr,Jc).call(this),this.div.focus()}select(){var e,t,n;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var s,r;(s=this.div)!=null&&s.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(n=u(this,ye))==null||n.toggleAltTextBadge(!1)}unselect(){var e,t,n,s,r;(e=u(this,je))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(s=this._editToolbar)==null||s.hide(),(r=u(this,ye))==null||r.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return u(this,iu)}set isEditing(e){w(this,iu,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){w(this,$r,!0);let n=e/t,{style:s}=this.div;s.aspectRatio=n,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){u(this,dn)||w(this,dn,new Map);let{action:n}=e,s=u(this,dn).get(n);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),u(this,dn).delete(n),u(this,dn).size===0&&w(this,dn,null)},ee._telemetryTimeout),u(this,dn).set(n,s);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),w(this,el,!1)}disable(){this.div&&(this.div.tabIndex=-1),w(this,el,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){let n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){let{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Gr=new WeakMap,Pn=new WeakMap,ye=new WeakMap,el=new WeakMap,Ps=new WeakMap,tu=new WeakMap,$r=new WeakMap,je=new WeakMap,zr=new WeakMap,Bi=new WeakMap,Ms=new WeakMap,nu=new WeakMap,qr=new WeakMap,Gt=new WeakMap,iu=new WeakMap,Wr=new WeakMap,Vi=new WeakMap,ri=new WeakMap,tl=new WeakMap,nl=new WeakMap,dn=new WeakMap,Yr=new WeakMap,su=new WeakMap,lm=new WeakMap,ru=new WeakSet,FE=function([e,t],n,s){[n,s]=this.screenToPageTranslation(n,s),this.x+=n/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},ou=new WeakSet,LE=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},il=new WeakSet,Bp=function(e){switch(e){case 90:{let[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{let[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},cm=new WeakSet,Ex=function(){if(u(this,je))return;w(this,je,document.createElement("div")),u(this,je).classList.add("resizers");let e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(let n of e){let s=document.createElement("div");u(this,je).append(s),s.classList.add("resizer",n),s.setAttribute("data-resizer-name",n),s.addEventListener("pointerdown",S(this,dm,wx).bind(this,n),{signal:t}),s.addEventListener("contextmenu",Gn,{signal:t}),s.tabIndex=-1}this.div.prepend(u(this,je))},dm=new WeakSet,wx=function(e,t){var d;t.preventDefault();let{isMac:n}=nt.platform;if(t.button!==0||t.ctrlKey&&n)return;(d=u(this,ye))==null||d.toggle(!1);let s=this._isDraggable;this._isDraggable=!1,w(this,zr,[t.screenX,t.screenY]);let r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",S(this,lu,UE).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",Qt,{passive:!1,signal:o}),window.addEventListener("contextmenu",Gn,{signal:o}),w(this,Bi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;let c=()=>{var h;r.abort(),this.parent.togglePointerEvents(!0),(h=u(this,ye))==null||h.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=a,this.div.style.cursor=l,S(this,sl,Vp).call(this)};window.addEventListener("pointerup",c,{signal:o}),window.addEventListener("blur",c,{signal:o})},au=new WeakSet,OE=function(e,t,n,s){this.width=n,this.height=s,this.x=e,this.y=t;let[r,o]=this.parentDimensions;this.setDims(r*n,o*s),this.fixAndSetPosition(),this._onResized()},sl=new WeakSet,Vp=function(){if(!u(this,Bi))return;let{savedX:e,savedY:t,savedWidth:n,savedHeight:s}=u(this,Bi);w(this,Bi,null);let r=this.x,o=this.y,a=this.width,l=this.height;r===e&&o===t&&a===n&&l===s||this.addCommands({cmd:S(this,au,OE).bind(this,r,o,a,l),undo:S(this,au,OE).bind(this,e,t,n,s),mustExec:!0})},lu=new WeakSet,UE=function(e,t){let[n,s]=this.parentDimensions,r=this.x,o=this.y,a=this.width,l=this.height,c=ee.MIN_SIZE/n,d=ee.MIN_SIZE/s,h=S(this,il,Bp).call(this,this.rotation),p=(L,q)=>[h[0]*L+h[2]*q,h[1]*L+h[3]*q],m=S(this,il,Bp).call(this,360-this.rotation),y=(L,q)=>[m[0]*L+m[2]*q,m[1]*L+m[3]*q],v,E,A=!1,_=!1;switch(e){case"topLeft":A=!0,v=(L,q)=>[0,0],E=(L,q)=>[L,q];break;case"topMiddle":v=(L,q)=>[L/2,0],E=(L,q)=>[L/2,q];break;case"topRight":A=!0,v=(L,q)=>[L,0],E=(L,q)=>[0,q];break;case"middleRight":_=!0,v=(L,q)=>[L,q/2],E=(L,q)=>[0,q/2];break;case"bottomRight":A=!0,v=(L,q)=>[L,q],E=(L,q)=>[0,0];break;case"bottomMiddle":v=(L,q)=>[L/2,q],E=(L,q)=>[L/2,0];break;case"bottomLeft":A=!0,v=(L,q)=>[0,q],E=(L,q)=>[L,0];break;case"middleLeft":_=!0,v=(L,q)=>[0,q/2],E=(L,q)=>[L,q/2];break}let C=v(a,l),T=E(a,l),R=p(...T),I=ee._round(r+R[0]),D=ee._round(o+R[1]),k=1,N=1,F,U;if(t.fromKeyboard)({deltaX:F,deltaY:U}=t);else{let{screenX:L,screenY:q}=t,[Ht,Wn]=u(this,zr);[F,U]=this.screenToPageTranslation(L-Ht,q-Wn),u(this,zr)[0]=L,u(this,zr)[1]=q}if([F,U]=y(F/n,U/s),A){let L=Math.hypot(a,l);k=N=Math.max(Math.min(Math.hypot(T[0]-C[0]-F,T[1]-C[1]-U)/L,1/a,1/l),c/a,d/l)}else _?k=Math.max(c,Math.min(1,Math.abs(T[0]-C[0]-F)))/a:N=Math.max(d,Math.min(1,Math.abs(T[1]-C[1]-U)))/l;let re=ee._round(a*k),J=ee._round(l*N);R=p(...E(re,J));let Z=I-R[0],Ge=D-R[1];u(this,Gt)||w(this,Gt,[this.x,this.y,this.width,this.height]),this.width=re,this.height=J,this.x=Z,this.y=Ge,this.setDims(n*re,s*J),this.fixAndSetPosition(),this._onResizing()},um=new WeakSet,Ax=function(){var e;w(this,Bi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=u(this,ye))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},hm=new WeakSet,Sx=function(e,t,n){let r=.7*(n/t)+1-.7;if(r===1)return;let o=S(this,il,Bp).call(this,this.rotation),a=(I,D)=>[o[0]*I+o[2]*D,o[1]*I+o[3]*D],[l,c]=this.parentDimensions,d=this.x,h=this.y,p=this.width,m=this.height,y=ee.MIN_SIZE/l,v=ee.MIN_SIZE/c;r=Math.max(Math.min(r,1/p,1/m),y/p,v/m);let E=ee._round(p*r),A=ee._round(m*r);if(E===p&&A===m)return;u(this,Gt)||w(this,Gt,[d,h,p,m]);let _=a(p/2,m/2),C=ee._round(d+_[0]),T=ee._round(h+_[1]),R=a(E/2,A/2);this.x=C-R[0],this.y=T-R[1],this.width=E,this.height=A,this.setDims(l*E,c*A),this.fixAndSetPosition(),this._onResizing()},fm=new WeakSet,_x=function(){var e;(e=u(this,ye))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),S(this,sl,Vp).call(this)},cu=new WeakSet,HE=function(e){let{isMac:t}=nt.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},pm=new WeakSet,Cx=function(e){let{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1,s=new AbortController,r=this._uiManager.combinedSignal(s),o={capture:!0,passive:!1,signal:r},a=c=>{s.abort(),w(this,Ps,null),w(this,qr,!1),this._uiManager.endDragSession()||S(this,cu,HE).call(this,c),n&&this._onStopDragging()};t&&(w(this,tl,e.clientX),w(this,nl,e.clientY),w(this,Ps,e.pointerId),w(this,tu,e.pointerType),window.addEventListener("pointermove",c=>{n||(n=!0,this._onStartDragging());let{clientX:d,clientY:h,pointerId:p}=c;if(p!==u(this,Ps)){Qt(c);return}let[m,y]=this.screenToPageTranslation(d-u(this,tl),h-u(this,nl));w(this,tl,d),w(this,nl,h),this._uiManager.dragSelectedEditors(m,y)},o),window.addEventListener("touchmove",Qt,o),window.addEventListener("pointerdown",c=>{c.pointerType===u(this,tu)&&(u(this,Yr)||c.isPrimary)&&a(c),Qt(c)},o));let l=c=>{if(!u(this,Ps)||u(this,Ps)===c.pointerId){a(c);return}Qt(c)};window.addEventListener("pointerup",l,{signal:r}),window.addEventListener("blur",l,{signal:r})},du=new WeakSet,BE=function(){if(u(this,Ms)||!this.div)return;w(this,Ms,new AbortController);let e=this._uiManager.combinedSignal(u(this,Ms));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},gm=new WeakSet,Tx=function(e){ee._resizerKeyboardManager.exec(this,e)},mm=new WeakSet,xx=function(e){var t;u(this,Vi)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==u(this,je)&&S(this,Kr,Jc).call(this)},ym=new WeakSet,Rx=function(e){w(this,nu,u(this,Vi)?e:"")},uu=new WeakSet,VE=function(e){if(u(this,Pn))for(let t of u(this,Pn))t.tabIndex=e},Kr=new WeakSet,Jc=function(){w(this,Vi,!1),S(this,uu,VE).call(this,-1),S(this,sl,Vp).call(this)},b(ee,ou),W(ee,"_l10n",null),W(ee,"_l10nResizer",null),W(ee,"_borderLineWidth",-1),W(ee,"_colorManager",new xE),W(ee,"_zIndex",1),W(ee,"_telemetryTimeout",1e3);var _e=ee,GE=class extends _e{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},U0=3285377520,an=4294901760,Xn=65535,pg=class{constructor(e){this.h1=e?e&4294967295:U0,this.h2=e?e&4294967295:U0}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let v=0,E=e.length;v<E;v++){let A=e.charCodeAt(v);A<=255?t[n++]=A:(t[n++]=A>>>8,t[n++]=A&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let s=n>>2,r=n-s*4,o=new Uint32Array(t.buffer,0,s),a=0,l=0,c=this.h1,d=this.h2,h=3432918353,p=461845907,m=h&Xn,y=p&Xn;for(let v=0;v<s;v++)v&1?(a=o[v],a=a*h&an|a*m&Xn,a=a<<15|a>>>17,a=a*p&an|a*y&Xn,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=o[v],l=l*h&an|l*m&Xn,l=l<<15|l>>>17,l=l*p&an|l*y&Xn,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(a=0,r){case 3:a^=t[s*4+2]<<16;case 2:a^=t[s*4+1]<<8;case 1:a^=t[s*4],a=a*h&an|a*m&Xn,a=a<<15|a>>>17,a=a*p&an|a*y&Xn,s&1?c^=a:d^=a}this.h1=c,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&an|e*36045&Xn,t=t*4283543511&an|((t<<16|e>>>16)*2950163797&an)>>>16,e^=t>>>1,e=e*444984403&an|e*60499&Xn,t=t*3301882366&an|((t<<16|e>>>16)*3120437893&an)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}},$E=Object.freeze({map:null,hash:"",transfer:void 0}),Xr,Jr,qe,vm,Ix,md=class{constructor(){b(this,vm);b(this,Xr,!1);b(this,Jr,null);b(this,qe,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let n=u(this,qe).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return u(this,qe).get(e)}remove(e){if(u(this,qe).delete(e),u(this,qe).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let t of u(this,qe).values())if(t instanceof _e)return;this.onAnnotationEditor(null)}}setValue(e,t){let n=u(this,qe).get(e),s=!1;if(n!==void 0)for(let[r,o]of Object.entries(t))n[r]!==o&&(s=!0,n[r]=o);else s=!0,u(this,qe).set(e,t);s&&S(this,vm,Ix).call(this),t instanceof _e&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return u(this,qe).has(e)}getAll(){return u(this,qe).size>0?kA(u(this,qe)):null}setAll(e){for(let[t,n]of Object.entries(e))this.setValue(t,n)}get size(){return u(this,qe).size}resetModified(){u(this,Xr)&&(w(this,Xr,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new gg(this)}get serializable(){if(u(this,qe).size===0)return $E;let e=new Map,t=new pg,n=[],s=Object.create(null),r=!1;for(let[o,a]of u(this,qe)){let l=a instanceof _e?a.serialize(!1,s):a;l&&(e.set(o,l),t.update(`${o}:${JSON.stringify(l)}`),r||(r=!!l.bitmap))}if(r)for(let o of e.values())o.bitmap&&n.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:$E}get editorStats(){var n;let e=null,t=new Map;for(let s of u(this,qe).values()){if(!(s instanceof _e))continue;let r=s.telemetryFinalData;if(!r)continue;let{type:o}=r;t.has(o)||t.set(o,Object.getPrototypeOf(s).constructor),e||(e=Object.create(null));let a=e[o]||(e[o]=new Map);for(let[l,c]of Object.entries(r)){if(l==="type")continue;let d=a.get(l);d||(d=new Map,a.set(l,d));let h=(n=d.get(c))!=null?n:0;d.set(c,h+1)}}for(let[s,r]of t)e[s]=r.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){w(this,Jr,null)}get modifiedIds(){if(u(this,Jr))return u(this,Jr);let e=[];for(let t of u(this,qe).values())!(t instanceof _e)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return w(this,Jr,{ids:new Set(e),hash:e.join(",")})}};Xr=new WeakMap,Jr=new WeakMap,qe=new WeakMap,vm=new WeakSet,Ix=function(){u(this,Xr)||(w(this,Xr,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var hu,gg=class extends md{constructor(t){super();b(this,hu,void 0);let{map:n,hash:s,transfer:r}=t.serializable,o=structuredClone(n,r?{transfer:r}:null);w(this,hu,{map:o,hash:s,transfer:r})}get print(){ge("Should not call PrintAnnotationStorage.print")}get serializable(){return u(this,hu)}get modifiedIds(){return se(this,"modifiedIds",{ids:new Set,hash:""})}};hu=new WeakMap;var rl,zE=class{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){b(this,rl,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),u(this,rl).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||u(this,rl).has(e.loadedName))){if(ke(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:n,src:s,style:r}=e,o=new FontFace(n,s,r);this.addNativeFontFace(o);try{await o.load(),u(this,rl).add(n),t==null||t(e)}catch(a){Q(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}ge("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){let n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(s){throw Q(`Failed to load font '${n.family}': '${s}'.`),e.disableFontFace=!0,s}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{let s=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,s)})}}get isFontLoadingAPISupported(){var t;let e=!!((t=this._document)!=null&&t.fonts);return se(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(mt||typeof navigator!="undefined"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),se(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(ke(!s.done,"completeRequest() cannot be called twice."),s.done=!0;n.length>0&&n[0].done;){let r=n.shift();setTimeout(r.callback,0)}}let{loadingRequests:n}=this,s={done:!1,complete:t,callback:e};return n.push(s),s}get _loadTestFont(){let e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return se(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(T,R){return T.charCodeAt(R)<<24|T.charCodeAt(R+1)<<16|T.charCodeAt(R+2)<<8|T.charCodeAt(R+3)&255}function s(T,R,I,D){let k=T.substring(0,R),N=T.substring(R+I);return k+D+N}let r,o,a=this._document.createElement("canvas");a.width=1,a.height=1;let l=a.getContext("2d"),c=0;function d(T,R){if(++c>30){Q("Load test font never loaded."),R();return}if(l.font="30px "+T,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){R();return}setTimeout(d.bind(null,T,R))}let h=`lt${Date.now()}${this.loadTestFontId++}`,p=this._loadTestFont;p=s(p,976,h.length,h);let y=16,v=1482184792,E=n(p,y);for(r=0,o=h.length-3;r<o;r+=4)E=E-v+n(h,r)|0;r<h.length&&(E=E-v+n(h+"XXX",r)|0),p=s(p,y,4,gO(E));let A=`url(data:font/opentype;base64,${btoa(p)});`,_=`@font-face {font-family:"${h}";src:${A}}`;this.insertRule(_);let C=this._document.createElement("div");C.style.visibility="hidden",C.style.width=C.style.height="10px",C.style.position="absolute",C.style.top=C.style.left="0px";for(let T of[e.loadedName,h]){let R=this._document.createElement("span");R.textContent="Hi",R.style.fontFamily=T,C.append(R)}this._document.body.append(C),d(h,()=>{C.remove(),t.complete()})}};rl=new WeakMap;var qE=class{constructor(e,{disableFontFace:t=!1,fontExtraProperties:n=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(let r in e)this[r]=e[r];this.disableFontFace=t===!0,this.fontExtraProperties=n===!0,this._inspectFont=s}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{let n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;let e=`url(data:${this.mimetype};base64,${wO(this.data)});`,t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${e}}`}return(n=this._inspectFont)==null||n.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let n=this.loadedName+"_path_"+t,s;try{s=e.get(n)}catch(o){Q(`getPathGenerator - ignoring character: "${o}".`)}let r=new Path2D(s||"");return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=r}},Rp={DATA:1,ERROR:2},Me={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function H0(){}function Rt(i){if(i instanceof gi||i instanceof hd||i instanceof Wo||i instanceof cg||i instanceof pc||i instanceof cd)return i;switch(i instanceof Error||typeof i=="object"&&i!==null||ge('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),i.name){case"AbortException":return new gi(i.message);case"InvalidPDFException":return new hd(i.message);case"MissingPDFException":return new Wo(i.message);case"PasswordException":return new cg(i.message,i.code);case"UnexpectedResponseException":return new pc(i.message,i.status);case"UnknownErrorException":return new cd(i.message,i.details)}return new cd(i.message,i.toString())}var ol,bm,Dx,Em,Px,wm,Mx,al,Gp,xr=class{constructor(e,t,n){b(this,bm);b(this,Em);b(this,wm);b(this,al);b(this,ol,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",S(this,bm,Dx).bind(this),{signal:u(this,ol).signal})}on(e,t){let n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){let s=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[s]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},n)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,n,s){let r=this.streamId++,o=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{let d=Promise.withResolvers();return this.streamControllers[r]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:o,targetName:a,action:e,streamId:r,data:t,desiredSize:c.desiredSize},s),d.promise},pull:c=>{let d=Promise.withResolvers();return this.streamControllers[r].pullCall=d,l.postMessage({sourceName:o,targetName:a,stream:Me.PULL,streamId:r,desiredSize:c.desiredSize}),d.promise},cancel:c=>{ke(c instanceof Error,"cancel must have a valid reason");let d=Promise.withResolvers();return this.streamControllers[r].cancelCall=d,this.streamControllers[r].isClosed=!0,l.postMessage({sourceName:o,targetName:a,stream:Me.CANCEL,streamId:r,reason:Rt(c)}),d.promise}},n)}destroy(){var e;(e=u(this,ol))==null||e.abort(),w(this,ol,null)}};ol=new WeakMap,bm=new WeakSet,Dx=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){S(this,wm,Mx).call(this,e);return}if(e.callback){let n=e.callbackId,s=this.callbackCapabilities[n];if(!s)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===Rp.DATA)s.resolve(e.data);else if(e.callback===Rp.ERROR)s.reject(Rt(e.reason));else throw new Error("Unexpected callback case");return}let t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){let n=this.sourceName,s=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:n,targetName:s,callback:Rp.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:n,targetName:s,callback:Rp.ERROR,callbackId:e.callbackId,reason:Rt(o)})});return}if(e.streamId){S(this,Em,Px).call(this,e);return}t(e.data)},Em=new WeakSet,Px=function(e){let t=e.streamId,n=this.sourceName,s=e.sourceName,r=this.comObj,o=this,a=this.actionHandler[e.action],l={enqueue(c,d=1,h){if(this.isCancelled)return;let p=this.desiredSize;this.desiredSize-=d,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:n,targetName:s,stream:Me.ENQUEUE,streamId:t,chunk:c},h)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:Me.CLOSE,streamId:t}),delete o.streamSinks[t])},error(c){ke(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:Me.ERROR,streamId:t,reason:Rt(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){r.postMessage({sourceName:n,targetName:s,stream:Me.START_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:n,targetName:s,stream:Me.START_COMPLETE,streamId:t,reason:Rt(c)})})},wm=new WeakSet,Mx=function(e){let t=e.streamId,n=this.sourceName,s=e.sourceName,r=this.comObj,o=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case Me.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(Rt(e.reason));break;case Me.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(Rt(e.reason));break;case Me.PULL:if(!a){r.postMessage({sourceName:n,targetName:s,stream:Me.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||H0).then(function(){r.postMessage({sourceName:n,targetName:s,stream:Me.PULL_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:n,targetName:s,stream:Me.PULL_COMPLETE,streamId:t,reason:Rt(c)})});break;case Me.ENQUEUE:if(ke(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case Me.CLOSE:if(ke(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),S(this,al,Gp).call(this,o,t);break;case Me.ERROR:ke(o,"error should have stream controller"),o.controller.error(Rt(e.reason)),S(this,al,Gp).call(this,o,t);break;case Me.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(Rt(e.reason)),S(this,al,Gp).call(this,o,t);break;case Me.CANCEL:if(!a)break;let l=Rt(e.reason);Promise.try(a.onCancel||H0,l).then(function(){r.postMessage({sourceName:n,targetName:s,stream:Me.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:n,targetName:s,stream:Me.CANCEL_COMPLETE,streamId:t,reason:Rt(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},al=new WeakSet,Gp=async function(e,t){var n,s,r;await Promise.allSettled([(n=e.startCall)==null?void 0:n.promise,(s=e.pullCall)==null?void 0:s.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]};var fu,mg=class{constructor({enableHWA:e=!1}){b(this,fu,!1);w(this,fu,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");let n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!u(this,fu)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){ge("Abstract method `_createCanvas` called.")}};fu=new WeakMap;var WE=class extends mg{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){let n=this._document.createElement("canvas");return n.width=e,n.height=t,n}},yg=class{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");let t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){ge("Abstract method `_fetch` called.")}},vg=class extends yg{async _fetch(e){let t=await xy(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Ty(t)}},bg=class{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,s,r){return"none"}destroy(e=!1){}},Zr,ll,Gi,$i,ht,jr,Qr,We,ct,eo,Zc,ks,xa,cl,$p,Ns,Ra,Am,kx,pu,KE,Fs,Ia,to,jc,no,Qc,gu,XE,io,ed,YE=class extends bg{constructor({docId:t,ownerDocument:n=globalThis.document}){super();b(this,We);b(this,eo);b(this,ks);b(this,cl);b(this,Ns);b(this,Am);b(this,pu);b(this,Fs);b(this,to);b(this,no);b(this,gu);b(this,io);b(this,Zr,void 0);b(this,ll,void 0);b(this,Gi,void 0);b(this,$i,void 0);b(this,ht,void 0);b(this,jr,void 0);b(this,Qr,0);w(this,$i,t),w(this,ht,n)}addFilter(t){if(!t)return"none";let n=u(this,We,ct).get(t);if(n)return n;let[s,r,o]=S(this,cl,$p).call(this,t),a=t.length===1?s:`${s}${r}${o}`;if(n=u(this,We,ct).get(a),n)return u(this,We,ct).set(t,n),n;let l=`g_${u(this,$i)}_transfer_map_${vt(this,Qr)._++}`,c=S(this,Ns,Ra).call(this,l);u(this,We,ct).set(t,c),u(this,We,ct).set(a,c);let d=S(this,Fs,Ia).call(this,l);return S(this,no,Qc).call(this,s,r,o,d),c}addHCMFilter(t,n){var y;let s=`${t}-${n}`,r="base",o=u(this,eo,Zc).get(r);if((o==null?void 0:o.key)===s||(o?((y=o.filter)==null||y.remove(),o.key=s,o.url="none",o.filter=null):(o={key:s,url:"none",filter:null},u(this,eo,Zc).set(r,o)),!t||!n))return o.url;let a=S(this,io,ed).call(this,t);t=V.makeHexColor(...a);let l=S(this,io,ed).call(this,n);if(n=V.makeHexColor(...l),u(this,ks,xa).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return o.url;let c=new Array(256);for(let v=0;v<=255;v++){let E=v/255;c[v]=E<=.03928?E/12.92:((E+.055)/1.055)**2.4}let d=c.join(","),h=`g_${u(this,$i)}_hcm_filter`,p=o.filter=S(this,Fs,Ia).call(this,h);S(this,no,Qc).call(this,d,d,d,p),S(this,pu,KE).call(this,p);let m=(v,E)=>{let A=a[v]/255,_=l[v]/255,C=new Array(E+1);for(let T=0;T<=E;T++)C[T]=A+T/E*(_-A);return C.join(",")};return S(this,no,Qc).call(this,m(0,5),m(1,5),m(2,5),p),o.url=S(this,Ns,Ra).call(this,h),o.url}addAlphaFilter(t){let n=u(this,We,ct).get(t);if(n)return n;let[s]=S(this,cl,$p).call(this,[t]),r=`alpha_${s}`;if(n=u(this,We,ct).get(r),n)return u(this,We,ct).set(t,n),n;let o=`g_${u(this,$i)}_alpha_map_${vt(this,Qr)._++}`,a=S(this,Ns,Ra).call(this,o);u(this,We,ct).set(t,a),u(this,We,ct).set(r,a);let l=S(this,Fs,Ia).call(this,o);return S(this,gu,XE).call(this,s,l),a}addLuminosityFilter(t){let n=u(this,We,ct).get(t||"luminosity");if(n)return n;let s,r;if(t?([s]=S(this,cl,$p).call(this,[t]),r=`luminosity_${s}`):r="luminosity",n=u(this,We,ct).get(r),n)return u(this,We,ct).set(t,n),n;let o=`g_${u(this,$i)}_luminosity_map_${vt(this,Qr)._++}`,a=S(this,Ns,Ra).call(this,o);u(this,We,ct).set(t,a),u(this,We,ct).set(r,a);let l=S(this,Fs,Ia).call(this,o);return S(this,Am,kx).call(this,l),t&&S(this,gu,XE).call(this,s,l),a}addHighlightHCMFilter(t,n,s,r,o){var _;let a=`${n}-${s}-${r}-${o}`,l=u(this,eo,Zc).get(t);if((l==null?void 0:l.key)===a||(l?((_=l.filter)==null||_.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},u(this,eo,Zc).set(t,l)),!n||!s))return l.url;let[c,d]=[n,s].map(S(this,io,ed).bind(this)),h=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),p=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[m,y]=[r,o].map(S(this,io,ed).bind(this));p<h&&([h,p,m,y]=[p,h,y,m]),u(this,ks,xa).style.color="";let v=(C,T,R)=>{let I=new Array(256),D=(p-h)/R,k=C/255,N=(T-C)/(255*R),F=0;for(let U=0;U<=R;U++){let re=Math.round(h+U*D),J=k+U*N;for(let Z=F;Z<=re;Z++)I[Z]=J;F=re+1}for(let U=F;U<256;U++)I[U]=I[F-1];return I.join(",")},E=`g_${u(this,$i)}_hcm_${t}_filter`,A=l.filter=S(this,Fs,Ia).call(this,E);return S(this,pu,KE).call(this,A),S(this,no,Qc).call(this,v(m[0],y[0],5),v(m[1],y[1],5),v(m[2],y[2],5),A),l.url=S(this,Ns,Ra).call(this,E),l.url}destroy(t=!1){var n,s,r,o;t&&((n=u(this,jr))!=null&&n.size)||((s=u(this,Gi))==null||s.parentNode.parentNode.remove(),w(this,Gi,null),(r=u(this,ll))==null||r.clear(),w(this,ll,null),(o=u(this,jr))==null||o.clear(),w(this,jr,null),w(this,Qr,0))}};Zr=new WeakMap,ll=new WeakMap,Gi=new WeakMap,$i=new WeakMap,ht=new WeakMap,jr=new WeakMap,Qr=new WeakMap,We=new WeakSet,ct=function(){return u(this,ll)||w(this,ll,new Map)},eo=new WeakSet,Zc=function(){return u(this,jr)||w(this,jr,new Map)},ks=new WeakSet,xa=function(){if(!u(this,Gi)){let t=u(this,ht).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;let s=u(this,ht).createElementNS(Di,"svg");s.setAttribute("width",0),s.setAttribute("height",0),w(this,Gi,u(this,ht).createElementNS(Di,"defs")),t.append(s),s.append(u(this,Gi)),u(this,ht).body.append(t)}return u(this,Gi)},cl=new WeakSet,$p=function(t){if(t.length===1){let c=t[0],d=new Array(256);for(let p=0;p<256;p++)d[p]=c[p]/255;let h=d.join(",");return[h,h,h]}let[n,s,r]=t,o=new Array(256),a=new Array(256),l=new Array(256);for(let c=0;c<256;c++)o[c]=n[c]/255,a[c]=s[c]/255,l[c]=r[c]/255;return[o.join(","),a.join(","),l.join(",")]},Ns=new WeakSet,Ra=function(t){if(u(this,Zr)===void 0){w(this,Zr,"");let n=u(this,ht).URL;n!==u(this,ht).baseURI&&(Ry(n)?Q('#createUrl: ignore "data:"-URL for performance reasons.'):w(this,Zr,n.split("#",1)[0]))}return`url(${u(this,Zr)}#${t})`},Am=new WeakSet,kx=function(t){let n=u(this,ht).createElementNS(Di,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},pu=new WeakSet,KE=function(t){let n=u(this,ht).createElementNS(Di,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},Fs=new WeakSet,Ia=function(t){let n=u(this,ht).createElementNS(Di,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),u(this,ks,xa).append(n),n},to=new WeakSet,jc=function(t,n,s){let r=u(this,ht).createElementNS(Di,n);r.setAttribute("type","discrete"),r.setAttribute("tableValues",s),t.append(r)},no=new WeakSet,Qc=function(t,n,s,r){let o=u(this,ht).createElementNS(Di,"feComponentTransfer");r.append(o),S(this,to,jc).call(this,o,"feFuncR",t),S(this,to,jc).call(this,o,"feFuncG",n),S(this,to,jc).call(this,o,"feFuncB",s)},gu=new WeakSet,XE=function(t,n){let s=u(this,ht).createElementNS(Di,"feComponentTransfer");n.append(s),S(this,to,jc).call(this,s,"feFuncA",t)},io=new WeakSet,ed=function(t){return u(this,ks,xa).style.color=t,LA(getComputedStyle(u(this,ks,xa)).getPropertyValue("color"))};var Eg=class{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");let t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){ge("Abstract method `_fetch` called.")}},wg=class extends Eg{async _fetch(e){let t=await xy(e,"arraybuffer");return new Uint8Array(t)}};mt&&Q("Please use the `legacy` build in Node.js environments.");async function Nx(i){let t=await process.getBuiltinModule("fs").promises.readFile(i);return new Uint8Array(t)}var JE=class extends bg{},ZE=class extends mg{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(tU.url)("@napi-rs/canvas").createCanvas(e,t)}},jE=class extends yg{async _fetch(e){return Nx(e)}},QE=class extends Eg{async _fetch(e){return Nx(e)}},gt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function ew(i,e){if(!e)return;let t=e[2]-e[0],n=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,n),i.clip(s)}var yd=class{getPattern(){ge("Abstract method `getPattern` called.")}},tw=class extends yd{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,s){let r;if(s===gt.STROKE||s===gt.FILL){let o=t.current.getClippedPathBoundingBox(s,be(e))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,l=Math.ceil(o[3]-o[1])||1,c=t.cachedCanvases.getCanvas("pattern",a,l),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-o[0],-o[1]),n=V.transform(n,[1,0,0,1,o[0],o[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),ew(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),r=e.createPattern(c.canvas,"no-repeat");let h=new DOMMatrix(n);r.setTransform(h)}else ew(e,this._bbox),r=this._createGradient(e);return r}};function gE(i,e,t,n,s,r,o,a){let l=e.coords,c=e.colors,d=i.data,h=i.width*4,p;l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=r,r=o,o=p),l[n+1]>l[s+1]&&(p=n,n=s,s=p,p=o,o=a,a=p),l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=r,r=o,o=p);let m=(l[t]+e.offsetX)*e.scaleX,y=(l[t+1]+e.offsetY)*e.scaleY,v=(l[n]+e.offsetX)*e.scaleX,E=(l[n+1]+e.offsetY)*e.scaleY,A=(l[s]+e.offsetX)*e.scaleX,_=(l[s+1]+e.offsetY)*e.scaleY;if(y>=_)return;let C=c[r],T=c[r+1],R=c[r+2],I=c[o],D=c[o+1],k=c[o+2],N=c[a],F=c[a+1],U=c[a+2],re=Math.round(y),J=Math.round(_),Z,Ge,L,q,Ht,Wn,Ti,rn;for(let rt=re;rt<=J;rt++){if(rt<E){let we=rt<y?0:(y-rt)/(y-E);Z=m-(m-v)*we,Ge=C-(C-I)*we,L=T-(T-D)*we,q=R-(R-k)*we}else{let we;rt>_?we=1:E===_?we=0:we=(E-rt)/(E-_),Z=v-(v-A)*we,Ge=I-(I-N)*we,L=D-(D-F)*we,q=k-(k-U)*we}let Fe;rt<y?Fe=0:rt>_?Fe=1:Fe=(y-rt)/(y-_),Ht=m-(m-A)*Fe,Wn=C-(C-N)*Fe,Ti=T-(T-F)*Fe,rn=R-(R-U)*Fe;let ma=Math.round(Math.min(Z,Ht)),Lc=Math.round(Math.max(Z,Ht)),En=h*rt+ma*4;for(let we=ma;we<=Lc;we++)Fe=(Z-we)/(Z-Ht),Fe<0?Fe=0:Fe>1&&(Fe=1),d[En++]=Ge-(Ge-Wn)*Fe|0,d[En++]=L-(L-Ti)*Fe|0,d[En++]=q-(q-rn)*Fe|0,d[En++]=255}}function TO(i,e,t){let n=e.coords,s=e.colors,r,o;switch(e.type){case"lattice":let a=e.verticesPerRow,l=Math.floor(n.length/a)-1,c=a-1;for(r=0;r<l;r++){let d=r*a;for(let h=0;h<c;h++,d++)gE(i,t,n[d],n[d+1],n[d+a],s[d],s[d+1],s[d+a]),gE(i,t,n[d+a+1],n[d+1],n[d+a],s[d+a+1],s[d+1],s[d+a])}break;case"triangles":for(r=0,o=n.length;r<o;r+=3)gE(i,t,n[r],n[r+1],n[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}var nw=class extends yd{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){let a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,d=Math.ceil(this._bounds[3])-l,h=Math.min(Math.ceil(Math.abs(c*e[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),m=c/h,y=d/p,v={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/m,scaleY:1/y},E=h+2*2,A=p+2*2,_=n.getCanvas("mesh",E,A),C=_.context,T=C.createImageData(h,p);if(t){let I=T.data;for(let D=0,k=I.length;D<k;D+=4)I[D]=t[0],I[D+1]=t[1],I[D+2]=t[2],I[D+3]=255}for(let I of this._figures)TO(T,I,v);return C.putImageData(T,2,2),{canvas:_.canvas,offsetX:a-2*m,offsetY:l-2*y,scaleX:m,scaleY:y}}getPattern(e,t,n,s){ew(e,this._bbox);let r;if(s===gt.SHADING)r=V.singularValueDecompose2dScale(be(e));else if(r=V.singularValueDecompose2dScale(t.baseTransform),this.matrix){let a=V.singularValueDecompose2dScale(this.matrix);r=[r[0]*a[0],r[1]*a[1]]}let o=this._createMeshCanvas(r,s===gt.SHADING?null:this._background,t.cachedCanvases);return s!==gt.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}},iw=class extends yd{getPattern(){return"hotpink"}};function xO(i){switch(i[0]){case"RadialAxial":return new tw(i);case"Mesh":return new nw(i);case"Dummy":return new iw}throw new Error(`Unknown IR type: ${i[0]}`)}var B0={COLORED:1,UNCOLORED:2},Sm=class Sm{constructor(e,t,n,s,r){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=s,this.baseTransform=r}createPatternCanvas(e){let{bbox:t,operatorList:n,paintType:s,tilingType:r,color:o,canvasGraphicsFactory:a}=this,{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),Cy("TilingType: "+r);let d=t[0],h=t[1],p=t[2],m=t[3],y=p-d,v=m-h,E=V.singularValueDecompose2dScale(this.matrix),A=V.singularValueDecompose2dScale(this.baseTransform),_=E[0]*A[0],C=E[1]*A[1],T=y,R=v,I=!1,D=!1,k=Math.ceil(l*_),N=Math.ceil(c*C),F=Math.ceil(y*_),U=Math.ceil(v*C);k>=F?T=l:I=!0,N>=U?R=c:D=!0;let re=this.getSizeAndScale(T,this.ctx.canvas.width,_),J=this.getSizeAndScale(R,this.ctx.canvas.height,C),Z=e.cachedCanvases.getCanvas("pattern",re.size,J.size),Ge=Z.context,L=a.createCanvasGraphics(Ge);if(L.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(L,s,o),Ge.translate(-re.scale*d,-J.scale*h),L.transform(re.scale,0,0,J.scale,0,0),Ge.save(),this.clipBbox(L,d,h,p,m),L.baseTransform=be(L.ctx),L.executeOperatorList(n),L.endDrawing(),Ge.restore(),I||D){let q=Z.canvas;I&&(T=l),D&&(R=c);let Ht=this.getSizeAndScale(T,this.ctx.canvas.width,_),Wn=this.getSizeAndScale(R,this.ctx.canvas.height,C),Ti=Ht.size,rn=Wn.size,rt=e.cachedCanvases.getCanvas("pattern-workaround",Ti,rn),Fe=rt.context,ma=I?Math.floor(y/l):0,Lc=D?Math.floor(v/c):0;for(let En=0;En<=ma;En++)for(let we=0;we<=Lc;we++)Fe.drawImage(q,Ti*En,rn*we,Ti,rn,0,0,Ti,rn);return{canvas:rt.canvas,scaleX:Ht.scale,scaleY:Wn.scale,offsetX:d,offsetY:h}}return{canvas:Z.canvas,scaleX:re.scale,scaleY:J.scale,offsetX:d,offsetY:h}}getSizeAndScale(e,t,n){let s=Math.max(Sm.MAX_PATTERN_SIZE,t),r=Math.ceil(e*n);return r>=s?r=s:n=r/e,{scale:n,size:r}}clipBbox(e,t,n,s,r){let o=s-t,a=r-n;e.ctx.rect(t,n,o,a),e.current.updateRectMinMax(be(e.ctx),[t,n,s,r]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){let s=e.ctx,r=e.current;switch(t){case B0.COLORED:let o=this.ctx;s.fillStyle=o.fillStyle,s.strokeStyle=o.strokeStyle,r.fillColor=o.fillStyle,r.strokeColor=o.strokeStyle;break;case B0.UNCOLORED:let a=V.makeHexColor(n[0],n[1],n[2]);s.fillStyle=a,s.strokeStyle=a,r.fillColor=a,r.strokeColor=a;break;default:throw new bE(`Unsupported paint type: ${t}`)}}getPattern(e,t,n,s){let r=n;s!==gt.SHADING&&(r=V.transform(r,t.baseTransform),this.matrix&&(r=V.transform(r,this.matrix)));let o=this.createPatternCanvas(t),a=new DOMMatrix(r);a=a.translate(o.offsetX,o.offsetY),a=a.scale(1/o.scaleX,1/o.scaleY);let l=e.createPattern(o.canvas,"repeat");return l.setTransform(a),l}};W(Sm,"MAX_PATTERN_SIZE",3e3);var sw=Sm;function RO({src:i,srcPos:e=0,dest:t,width:n,height:s,nonBlackColor:r=4294967295,inverseDecode:o=!1}){let a=nt.isLittleEndian?4278190080:255,[l,c]=o?[r,a]:[a,r],d=n>>3,h=n&7,p=i.length;t=new Uint32Array(t.buffer);let m=0;for(let y=0;y<s;y++){for(let E=e+d;e<E;e++){let A=e<p?i[e]:255;t[m++]=A&128?c:l,t[m++]=A&64?c:l,t[m++]=A&32?c:l,t[m++]=A&16?c:l,t[m++]=A&8?c:l,t[m++]=A&4?c:l,t[m++]=A&2?c:l,t[m++]=A&1?c:l}if(h===0)continue;let v=e<p?i[e++]:255;for(let E=0;E<h;E++)t[m++]=v&1<<7-E?c:l}return{srcPos:e,destPos:m}}var V0=16,G0=100,IO=15,$0=10,z0=1e3,kt=16;function DO(i,e){if(i._removeMirroring)throw new Error("Context is already forwarding operations.");i.__originalSave=i.save,i.__originalRestore=i.restore,i.__originalRotate=i.rotate,i.__originalScale=i.scale,i.__originalTranslate=i.translate,i.__originalTransform=i.transform,i.__originalSetTransform=i.setTransform,i.__originalResetTransform=i.resetTransform,i.__originalClip=i.clip,i.__originalMoveTo=i.moveTo,i.__originalLineTo=i.lineTo,i.__originalBezierCurveTo=i.bezierCurveTo,i.__originalRect=i.rect,i.__originalClosePath=i.closePath,i.__originalBeginPath=i.beginPath,i._removeMirroring=()=>{i.save=i.__originalSave,i.restore=i.__originalRestore,i.rotate=i.__originalRotate,i.scale=i.__originalScale,i.translate=i.__originalTranslate,i.transform=i.__originalTransform,i.setTransform=i.__originalSetTransform,i.resetTransform=i.__originalResetTransform,i.clip=i.__originalClip,i.moveTo=i.__originalMoveTo,i.lineTo=i.__originalLineTo,i.bezierCurveTo=i.__originalBezierCurveTo,i.rect=i.__originalRect,i.closePath=i.__originalClosePath,i.beginPath=i.__originalBeginPath,delete i._removeMirroring},i.save=function(){e.save(),this.__originalSave()},i.restore=function(){e.restore(),this.__originalRestore()},i.translate=function(n,s){e.translate(n,s),this.__originalTranslate(n,s)},i.scale=function(n,s){e.scale(n,s),this.__originalScale(n,s)},i.transform=function(n,s,r,o,a,l){e.transform(n,s,r,o,a,l),this.__originalTransform(n,s,r,o,a,l)},i.setTransform=function(n,s,r,o,a,l){e.setTransform(n,s,r,o,a,l),this.__originalSetTransform(n,s,r,o,a,l)},i.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},i.rotate=function(n){e.rotate(n),this.__originalRotate(n)},i.clip=function(n){e.clip(n),this.__originalClip(n)},i.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},i.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},i.bezierCurveTo=function(t,n,s,r,o,a){e.bezierCurveTo(t,n,s,r,o,a),this.__originalBezierCurveTo(t,n,s,r,o,a)},i.rect=function(t,n,s,r){e.rect(t,n,s,r),this.__originalRect(t,n,s,r)},i.closePath=function(){e.closePath(),this.__originalClosePath()},i.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}var rw=class{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,n)):(s=this.canvasFactory.create(t,n),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}};function Ip(i,e,t,n,s,r,o,a,l,c){let[d,h,p,m,y,v]=be(i);if(h===0&&p===0){let _=o*d+y,C=Math.round(_),T=a*m+v,R=Math.round(T),I=(o+l)*d+y,D=Math.abs(Math.round(I)-C)||1,k=(a+c)*m+v,N=Math.abs(Math.round(k)-R)||1;return i.setTransform(Math.sign(d),0,0,Math.sign(m),C,R),i.drawImage(e,t,n,s,r,0,0,D,N),i.setTransform(d,h,p,m,y,v),[D,N]}if(d===0&&m===0){let _=a*p+y,C=Math.round(_),T=o*h+v,R=Math.round(T),I=(a+c)*p+y,D=Math.abs(Math.round(I)-C)||1,k=(o+l)*h+v,N=Math.abs(Math.round(k)-R)||1;return i.setTransform(0,Math.sign(h),Math.sign(p),0,C,R),i.drawImage(e,t,n,s,r,0,0,N,D),i.setTransform(d,h,p,m,y,v),[N,D]}i.drawImage(e,t,n,s,r,o,a,l,c);let E=Math.hypot(d,h),A=Math.hypot(p,m);return[E*l,A*c]}function PO(i){let{width:e,height:t}=i;if(e>z0||t>z0)return null;let n=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=e+1,o=new Uint8Array(r*(t+1)),a,l,c,d=e+7&-8,h=new Uint8Array(d*t),p=0;for(let A of i.data){let _=128;for(;_>0;)h[p++]=A&_?0:255,_>>=1}let m=0;for(p=0,h[p]!==0&&(o[0]=1,++m),l=1;l<e;l++)h[p]!==h[p+1]&&(o[l]=h[p]?2:1,++m),p++;for(h[p]!==0&&(o[l]=2,++m),a=1;a<t;a++){p=a*d,c=a*r,h[p-d]!==h[p]&&(o[c]=h[p]?1:8,++m);let A=(h[p]?4:0)+(h[p-d]?8:0);for(l=1;l<e;l++)A=(A>>2)+(h[p+1]?4:0)+(h[p-d+1]?8:0),s[A]&&(o[c+l]=s[A],++m),p++;if(h[p-d]!==h[p]&&(o[c+l]=h[p]?2:4,++m),m>n)return null}for(p=d*(t-1),c=a*r,h[p]!==0&&(o[c]=8,++m),l=1;l<e;l++)h[p]!==h[p+1]&&(o[c+l]=h[p]?4:8,++m),p++;if(h[p]!==0&&(o[c+l]=4,++m),m>n)return null;let y=new Int32Array([0,r,-1,0,-r,0,0,0,1]),v=new Path2D;for(a=0;m&&a<=t;a++){let A=a*r,_=A+e;for(;A<_&&!o[A];)A++;if(A===_)continue;v.moveTo(A%r,a);let C=A,T=o[A];do{let R=y[T];do A+=R;while(!o[A]);let I=o[A];I!==5&&I!==10?(T=I,o[A]=0):(T=I&51*T>>4,o[A]&=T>>2|T<<2),v.lineTo(A%r,A/r|0),o[A]||--m}while(C!==A);--a}return h=null,o=null,function(A){A.save(),A.scale(1/e,-1/t),A.translate(0,-t),A.fill(v),A.beginPath(),A.restore()}}var Ag=class{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=j0,this.textMatrixScale=1,this.fontMatrix=vE,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=lt.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=V.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(e,t){let n=V.applyTransform(t,e),s=V.applyTransform(t.slice(2),e),r=V.applyTransform([t[0],t[3]],e),o=V.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,n[0],s[0],r[0],o[0]),this.minY=Math.min(this.minY,n[1],s[1],r[1],o[1]),this.maxX=Math.max(this.maxX,n[0],s[0],r[0],o[0]),this.maxY=Math.max(this.maxY,n[1],s[1],r[1],o[1])}updateScalingPathMinMax(e,t){V.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,s,r,o,a,l,c,d){let h=V.bezierBoundingBox(t,n,s,r,o,a,l,c,d);d||this.updateRectMinMax(e,h)}getPathBoundingBox(e=gt.FILL,t=null){let n=[this.minX,this.minY,this.maxX,this.maxY];if(e===gt.STROKE){t||ge("Stroke bounding box must include transform.");let s=V.singularValueDecompose2dScale(t),r=s[0]*this.lineWidth/2,o=s[1]*this.lineWidth/2;n[0]-=r,n[1]-=o,n[2]+=r,n[3]+=o}return n}updateClipFromPath(){let e=V.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=gt.FILL,t=null){return V.intersect(this.clipBox,this.getPathBoundingBox(e,t))}};function q0(i,e){if(e instanceof ImageData){i.putImageData(e,0,0);return}let t=e.height,n=e.width,s=t%kt,r=(t-s)/kt,o=s===0?r:r+1,a=i.createImageData(n,kt),l=0,c,d=e.data,h=a.data,p,m,y,v;if(e.kind===kp.GRAYSCALE_1BPP){let E=d.byteLength,A=new Uint32Array(h.buffer,0,h.byteLength>>2),_=A.length,C=n+7>>3,T=4294967295,R=nt.isLittleEndian?4278190080:255;for(p=0;p<o;p++){for(y=p<r?kt:s,c=0,m=0;m<y;m++){let I=E-l,D=0,k=I>C?n:I*8-7,N=k&-8,F=0,U=0;for(;D<N;D+=8)U=d[l++],A[c++]=U&128?T:R,A[c++]=U&64?T:R,A[c++]=U&32?T:R,A[c++]=U&16?T:R,A[c++]=U&8?T:R,A[c++]=U&4?T:R,A[c++]=U&2?T:R,A[c++]=U&1?T:R;for(;D<k;D++)F===0&&(U=d[l++],F=128),A[c++]=U&F?T:R,F>>=1}for(;c<_;)A[c++]=0;i.putImageData(a,0,p*kt)}}else if(e.kind===kp.RGBA_32BPP){for(m=0,v=n*kt*4,p=0;p<r;p++)h.set(d.subarray(l,l+v)),l+=v,i.putImageData(a,0,m),m+=kt;p<o&&(v=n*s*4,h.set(d.subarray(l,l+v)),i.putImageData(a,0,m))}else if(e.kind===kp.RGB_24BPP)for(y=kt,v=n*y,p=0;p<o;p++){for(p>=r&&(y=s,v=n*y),c=0,m=v;m--;)h[c++]=d[l++],h[c++]=d[l++],h[c++]=d[l++],h[c++]=255;i.putImageData(a,0,p*kt)}else throw new Error(`bad image kind: ${e.kind}`)}function W0(i,e){if(e.bitmap){i.drawImage(e.bitmap,0,0);return}let t=e.height,n=e.width,s=t%kt,r=(t-s)/kt,o=s===0?r:r+1,a=i.createImageData(n,kt),l=0,c=e.data,d=a.data;for(let h=0;h<o;h++){let p=h<r?kt:s;({srcPos:l}=RO({src:c,srcPos:l,dest:d,width:n,height:p,nonBlackColor:0})),i.putImageData(a,0,h*kt)}}function zc(i,e){let t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let n of t)i[n]!==void 0&&(e[n]=i[n]);i.setLineDash!==void 0&&(e.setLineDash(i.getLineDash()),e.lineDashOffset=i.lineDashOffset)}function Dp(i){if(i.strokeStyle=i.fillStyle="#000000",i.fillRule="nonzero",i.globalAlpha=1,i.lineWidth=1,i.lineCap="butt",i.lineJoin="miter",i.miterLimit=10,i.globalCompositeOperation="source-over",i.font="10px sans-serif",i.setLineDash!==void 0&&(i.setLineDash([]),i.lineDashOffset=0),!mt){let{filter:e}=i;e!=="none"&&e!==""&&(i.filter="none")}}function Y0(i,e){if(e)return!0;let t=V.singularValueDecompose2dScale(i);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);let n=Math.fround((globalThis.devicePixelRatio||1)*sr.PDF_TO_CSS_UNITS);return t[0]<=n&&t[1]<=n}var MO=["butt","round","square"],kO=["miter","round","bevel"],NO={},K0={},mu,ow,yu,aw,vu,lw,HA=class HA{constructor(e,t,n,s,r,{optionalContentConfig:o,markedContentStack:a=null},l,c){b(this,mu);b(this,yu);b(this,vu);this.ctx=e,this.current=new Ag(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=s,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new rw(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:s=null}){let r=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=a,n){let l=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...be(this.compositeCtx))}this.ctx.save(),Dp(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=be(this.ctx)}executeOperatorList(e,t,n,s){let r=e.argsArray,o=e.fnArray,a=t||0,l=r.length;if(l===a)return a;let c=l-a>$0&&typeof n=="function",d=c?Date.now()+IO:0,h=0,p=this.commonObjs,m=this.objs,y;for(;;){if(s!==void 0&&a===s.nextBreakPoint)return s.breakIt(a,n),a;if(y=o[a],y!==Tn.dependency)this[y].apply(this,r[a]);else for(let v of r[a]){let E=v.startsWith("g_")?p:m;if(!E.has(v))return E.get(v,n),a}if(a++,a===l)return a;if(c&&++h>$0){if(Date.now()>d)return n(),a;h=0}}}endDrawing(){S(this,mu,ow).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())typeof HTMLCanvasElement!="undefined"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),S(this,yu,aw).call(this)}_scaleImage(e,t){var p,m;let n=(p=e.width)!=null?p:e.displayWidth,s=(m=e.height)!=null?m:e.displayHeight,r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),a=n,l=s,c="prescale1",d,h;for(;r>2&&a>1||o>2&&l>1;){let y=a,v=l;r>2&&a>1&&(y=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),r/=a/y),o>2&&l>1&&(v=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,o/=l/v),d=this.cachedCanvases.getCanvas(c,y,v),h=d.context,h.clearRect(0,0,y,v),h.drawImage(e,0,0,a,l,0,0,y,v),e=d.canvas,a=y,l=v,c=c==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e){let t=this.ctx,{width:n,height:s}=e,r=this.current.fillColor,o=this.current.patternFill,a=be(t),l,c,d,h;if((e.bitmap||e.data)&&e.count>1){let k=e.bitmap||e.data.buffer;c=JSON.stringify(o?a:[a.slice(0,4),r]),l=this._cachedBitmapsMap.get(k),l||(l=new Map,this._cachedBitmapsMap.set(k,l));let N=l.get(c);if(N&&!o){let F=Math.round(Math.min(a[0],a[2])+a[4]),U=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:N,offsetX:F,offsetY:U}}d=N}d||(h=this.cachedCanvases.getCanvas("maskCanvas",n,s),W0(h.context,e));let p=V.transform(a,[1/n,0,0,-1/s,0,0]);p=V.transform(p,[1,0,0,1,0,-s]);let[m,y,v,E]=V.getAxialAlignedBoundingBox([0,0,n,s],p),A=Math.round(v-m)||1,_=Math.round(E-y)||1,C=this.cachedCanvases.getCanvas("fillCanvas",A,_),T=C.context,R=m,I=y;T.translate(-R,-I),T.transform(...p),d||(d=this._scaleImage(h.canvas,Kn(T)),d=d.img,l&&o&&l.set(c,d)),T.imageSmoothingEnabled=Y0(be(T),e.interpolate),Ip(T,d,0,0,d.width,d.height,0,0,n,s),T.globalCompositeOperation="source-in";let D=V.transform(Kn(T),[1,0,0,1,-R,-I]);return T.fillStyle=o?r.getPattern(t,this,D,gt.FILL):r,T.fillRect(0,0,n,s),l&&!o&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,C.canvas)),{canvas:C.canvas,offsetX:Math.round(R),offsetY:Math.round(I)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=MO[e]}setLineJoin(e){this.ctx.lineJoin=kO[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){let n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx,this.ctx=s.context;let r=this.ctx;r.setTransform(...be(this.suspendedCtx)),zc(this.suspendedCtx,r),DO(r,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),zc(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,s){let r=s[0],o=s[1],a=s[2]-r,l=s[3]-o;a===0||l===0||(this.genericComposeSMask(t.context,n,a,l,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,s,r,o,a,l,c,d,h){let p=e.canvas,m=l-d,y=c-h;if(o){let E=V.makeHexColor(...o);if(m<0||y<0||m+n>p.width||y+s>p.height){let A=this.cachedCanvases.getCanvas("maskExtension",n,s),_=A.context;_.drawImage(p,-m,-y),_.globalCompositeOperation="destination-atop",_.fillStyle=E,_.fillRect(0,0,n,s),_.globalCompositeOperation="source-over",p=A.canvas,m=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);let A=new Path2D;A.rect(m,y,n,s),e.clip(A),e.globalCompositeOperation="destination-atop",e.fillStyle=E,e.fillRect(m,y,n,s),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));let v=new Path2D;v.rect(l,c,n,s),t.clip(v),t.globalCompositeOperation="destination-in",t.drawImage(p,m,y,n,s,l,c,n,s),t.restore()}save(){this.inSMaskMode?(zc(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),zc(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,s,r,o){this.ctx.transform(e,t,n,s,r,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){let s=this.ctx,r=this.current,o=r.x,a=r.y,l,c,d=be(s),h=d[0]===0&&d[3]===0||d[1]===0&&d[2]===0,p=h?n.slice(0):null;for(let m=0,y=0,v=e.length;m<v;m++)switch(e[m]|0){case Tn.rectangle:o=t[y++],a=t[y++];let E=t[y++],A=t[y++],_=o+E,C=a+A;s.moveTo(o,a),E===0||A===0?s.lineTo(_,C):(s.lineTo(_,a),s.lineTo(_,C),s.lineTo(o,C)),h||r.updateRectMinMax(d,[o,a,_,C]),s.closePath();break;case Tn.moveTo:o=t[y++],a=t[y++],s.moveTo(o,a),h||r.updatePathMinMax(d,o,a);break;case Tn.lineTo:o=t[y++],a=t[y++],s.lineTo(o,a),h||r.updatePathMinMax(d,o,a);break;case Tn.curveTo:l=o,c=a,o=t[y+4],a=t[y+5],s.bezierCurveTo(t[y],t[y+1],t[y+2],t[y+3],o,a),r.updateCurvePathMinMax(d,l,c,t[y],t[y+1],t[y+2],t[y+3],o,a,p),y+=6;break;case Tn.curveTo2:l=o,c=a,s.bezierCurveTo(o,a,t[y],t[y+1],t[y+2],t[y+3]),r.updateCurvePathMinMax(d,l,c,o,a,t[y],t[y+1],t[y+2],t[y+3],p),o=t[y+2],a=t[y+3],y+=4;break;case Tn.curveTo3:l=o,c=a,o=t[y+2],a=t[y+3],s.bezierCurveTo(t[y],t[y+1],o,a,o,a),r.updateCurvePathMinMax(d,l,c,t[y],t[y+1],o,a,o,a,p),y+=4;break;case Tn.closePath:s.closePath();break}h&&r.updateScalingPathMinMax(d,p),r.setCurrentPoint(o,a)}closePath(){this.ctx.closePath()}stroke(e=!0){let t=this.ctx,n=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof n=="object"&&(n!=null&&n.getPattern)?(t.save(),t.strokeStyle=n.getPattern(t,this,Kn(t),gt.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){let t=this.ctx,n=this.current.fillColor,s=this.current.patternFill,r=!1;s&&(t.save(),t.fillStyle=n.getPattern(t,this,Kn(t),gt.FILL),r=!0);let o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),r&&t.restore(),e&&this.consumePath(o)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=NO}eoClip(){this.pendingClip=K0}beginText(){this.current.textMatrix=j0,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}let n=new Path2D,s=t.getTransform().invertSelf();for(let{transform:r,x:o,y:a,fontSize:l,path:c}of e)n.addPath(c,new DOMMatrix(r).preMultiplySelf(s).translate(o,a).scale(l,-l));t.clip(n),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var d;let n=this.commonObjs.get(e),s=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=n.fontMatrix||vE,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&Q("Invalid font matrix for font "+e),t<0?(t=-t,s.fontDirection=-1):s.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;let r=n.loadedName||"sans-serif",o=((d=n.systemFontInfo)==null?void 0:d.css)||`"${r}", ${n.fallbackName}`,a="normal";n.black?a="900":n.bold&&(a="bold");let l=n.italic?"italic":"normal",c=t;t<V0?c=V0:t>G0&&(c=G0),this.current.fontSizeScale=t/c,this.ctx.font=`${l} ${a} ${c}px ${o}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,s,r,o){this.current.textMatrix=[e,t,n,s,r,o],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,s,r){let o=this.ctx,a=this.current,l=a.font,c=a.textRenderingMode,d=a.fontSize/a.fontSizeScale,h=c&lt.FILL_STROKE_MASK,p=!!(c&lt.ADD_TO_PATH_FLAG),m=a.patternFill&&!l.missingFile,y=a.patternStroke&&!l.missingFile,v;if((l.disableFontFace||p||m||y)&&(v=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||m||y){if(o.save(),o.translate(t,n),o.scale(d,-d),h===lt.FILL||h===lt.FILL_STROKE)if(s){let E=o.getTransform();o.setTransform(...s),o.fill(S(this,vu,lw).call(this,v,E,s))}else o.fill(v);if(h===lt.STROKE||h===lt.FILL_STROKE)if(r){let E=o.getTransform();o.setTransform(...r),o.stroke(S(this,vu,lw).call(this,v,E,r))}else o.lineWidth/=d,o.stroke(v);o.restore()}else(h===lt.FILL||h===lt.FILL_STROKE)&&o.fillText(e,t,n),(h===lt.STROKE||h===lt.FILL_STROKE)&&o.strokeText(e,t,n);p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:be(o),x:t,y:n,fontSize:d,path:v})}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let t=e.getImageData(0,0,10,10).data,n=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){n=!0;break}return se(this,"isFontSubpixelAAEnabled",n)}showText(e){let t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);let s=t.fontSize;if(s===0)return;let r=this.ctx,o=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,c=t.fontDirection,d=t.textHScale*c,h=e.length,p=n.vertical,m=p?1:-1,y=n.defaultVMetrics,v=s*t.fontMatrix[0],E=t.textRenderingMode===lt.FILL&&!n.disableFontFace&&!t.patternFill;r.save(),r.transform(...t.textMatrix),r.translate(t.x,t.y+t.textRise),c>0?r.scale(d,-1):r.scale(d,1);let A,_;if(t.patternFill){r.save();let D=t.fillColor.getPattern(r,this,Kn(r),gt.FILL);A=be(r),r.restore(),r.fillStyle=D}if(t.patternStroke){r.save();let D=t.strokeColor.getPattern(r,this,Kn(r),gt.STROKE);_=be(r),r.restore(),r.strokeStyle=D}let C=t.lineWidth,T=t.textMatrixScale;if(T===0||C===0){let D=t.textRenderingMode&lt.FILL_STROKE_MASK;(D===lt.STROKE||D===lt.FILL_STROKE)&&(C=this.getSinglePixelWidth())}else C/=T;if(o!==1&&(r.scale(o,o),C/=o),r.lineWidth=C,n.isInvalidPDFjsFont){let D=[],k=0;for(let N of e)D.push(N.unicode),k+=N.width;r.fillText(D.join(""),0,0),t.x+=k*v*d,r.restore(),this.compose();return}let R=0,I;for(I=0;I<h;++I){let D=e[I];if(typeof D=="number"){R+=m*D*s/1e3;continue}let k=!1,N=(D.isSpace?l:0)+a,F=D.fontChar,U=D.accent,re,J,Z=D.width;if(p){let L=D.vmetric||y,q=-(D.vmetric?L[1]:Z*.5)*v,Ht=L[2]*v;Z=L?-L[0]:Z,re=q/o,J=(R+Ht)/o}else re=R/o,J=0;if(n.remeasure&&Z>0){let L=r.measureText(F).width*1e3/s*o;if(Z<L&&this.isFontSubpixelAAEnabled){let q=Z/L;k=!0,r.save(),r.scale(q,1),re/=q}else Z!==L&&(re+=(Z-L)/2e3*s/o)}if(this.contentVisible&&(D.isInFont||n.missingFile)){if(E&&!U)r.fillText(F,re,J);else if(this.paintChar(F,re,J,A,_),U){let L=re+s*U.offset.x/o,q=J-s*U.offset.y/o;this.paintChar(U.fontChar,L,q,A,_)}}let Ge=p?Z*v-N*c:Z*v+N*c;R+=Ge,k&&r.restore()}p?t.y-=R:t.x+=R*d,r.restore(),this.compose()}showType3Text(e){let t=this.ctx,n=this.current,s=n.font,r=n.fontSize,o=n.fontDirection,a=s.vertical?1:-1,l=n.charSpacing,c=n.wordSpacing,d=n.textHScale*o,h=n.fontMatrix||vE,p=e.length,m=n.textRenderingMode===lt.INVISIBLE,y,v,E,A;if(!(m||r===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...n.textMatrix),t.translate(n.x,n.y),t.scale(d,o),y=0;y<p;++y){if(v=e[y],typeof v=="number"){A=a*v*r/1e3,this.ctx.translate(A,0),n.x+=A*d;continue}let _=(v.isSpace?c:0)+l,C=s.charProcOperatorList[v.operatorListId];if(!C){Q(`Type3 character "${v.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=v,this.save(),t.scale(r,r),t.transform(...h),this.executeOperatorList(C),this.restore()),E=V.applyTransform([v.width,0],h)[0]*r+_,t.translate(E,0),n.x+=E*d}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,s,r,o){this.ctx.rect(n,s,r-n,o-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){let n=e[1],s=this.baseTransform||be(this.ctx),r={createCanvasGraphics:o=>new HA(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new sw(e,n,this.ctx,r,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){this.ctx.strokeStyle=this.current.strokeColor=V.makeHexColor(e,t,n),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,n){this.ctx.fillStyle=this.current.fillColor=V.makeHexColor(e,t,n),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=xO(this.getObject(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;let t=this.ctx;this.save();let n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,Kn(t),gt.SHADING);let s=Kn(t);if(s){let{width:r,height:o}=t.canvas,[a,l,c,d]=V.getAxialAlignedBoundingBox([0,0,r,o],s);this.ctx.fillRect(a,l,c-a,d-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){ge("Should not call beginInlineImage")}beginImageData(){ge("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=be(this.ctx),t)){let n=t[2]-t[0],s=t[3]-t[1];this.ctx.rect(t[0],t[1],n,s),this.current.updateRectMinMax(be(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let t=this.ctx;e.isolated||Cy("TODO: Support non-isolated groups."),e.knockout&&Q("Knockout groups not supported.");let n=be(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=V.getAxialAlignedBoundingBox(e.bbox,be(t)),r=[0,0,t.canvas.width,t.canvas.height];s=V.intersect(s,r)||[0,0,0,0];let o=Math.floor(s[0]),a=Math.floor(s[1]),l=Math.max(Math.ceil(s[2])-o,1),c=Math.max(Math.ceil(s[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,c]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);let h=this.cachedCanvases.getCanvas(d,l,c),p=h.context;p.translate(-o,-a),p.transform(...n),e.smask?this.smaskStack.push({canvas:h.canvas,context:p,offsetX:o,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,a),t.save()),zc(t,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;let t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let s=be(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);let r=V.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],s);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(e,t,n,s,r){if(S(this,mu,ow).call(this),Dp(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){let o=t[2]-t[0],a=t[3]-t[1];if(r&&this.annotationCanvasMap){n=n.slice(),n[4]-=t[0],n[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=o,t[3]=a;let[l,c]=V.singularValueDecompose2dScale(be(this.ctx)),{viewportScale:d}=this,h=Math.ceil(o*this.outputScaleX*d),p=Math.ceil(a*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(h,p);let{canvas:m,context:y}=this.annotationCanvas;this.annotationCanvasMap.set(e,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=y,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,a*c),Dp(this.ctx)}else Dp(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],o,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new Ag(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),S(this,yu,aw).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;let t=e.count;e=this.getObject(e.data,e),e.count=t;let n=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=PO(e)),s.compiled)){s.compiled(n);return}let r=this._createMaskCanvas(e),o=r.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(o,r.offsetX,r.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,s=0,r,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);let a=this.ctx;a.save();let l=be(a);a.transform(t,n,s,r,0,0);let c=this._createMaskCanvas(e);a.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let d=0,h=o.length;d<h;d+=2){let p=V.transform(l,[t,n,s,r,o[d],o[d+1]]),[m,y]=V.applyTransform([0,0],p);a.drawImage(c.canvas,m,y)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;let t=this.ctx,n=this.current.fillColor,s=this.current.patternFill;for(let r of e){let{data:o,width:a,height:l,transform:c}=r,d=this.cachedCanvases.getCanvas("maskCanvas",a,l),h=d.context;h.save();let p=this.getObject(o,r);W0(h,p),h.globalCompositeOperation="source-in",h.fillStyle=s?n.getPattern(h,this,Kn(t),gt.FILL):n,h.fillRect(0,0,a,l),h.restore(),t.save(),t.transform(...c),t.scale(1,-1),Ip(t,d.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);if(!t){Q("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,n,s){if(!this.contentVisible)return;let r=this.getObject(e);if(!r){Q("Dependent image isn't ready yet");return}let o=r.width,a=r.height,l=[];for(let c=0,d=s.length;c<d;c+=2)l.push({transform:[t,0,0,n,s[c],s[c+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(r,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;let{bitmap:t,width:n,height:s}=e,r=this.cachedCanvases.getCanvas("inlineImage",n,s),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;let t=e.width,n=e.height,s=this.ctx;if(this.save(),!mt){let{filter:a}=s;a!=="none"&&a!==""&&(s.filter="none")}s.scale(1/t,-1/n);let r;if(e.bitmap)r=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)r=e;else{let l=this.cachedCanvases.getCanvas("inlineImage",t,n).context;q0(l,e),r=this.applyTransferMapsToCanvas(l)}let o=this._scaleImage(r,Kn(s));s.imageSmoothingEnabled=Y0(be(s),e.interpolate),Ip(s,o.img,0,0,o.paintWidth,o.paintHeight,0,-n,t,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;let n=this.ctx,s;if(e.bitmap)s=e.bitmap;else{let r=e.width,o=e.height,l=this.cachedCanvases.getCanvas("inlineImage",r,o).context;q0(l,e),s=this.applyTransferMapsToCanvas(l)}for(let r of t)n.save(),n.transform(...r.transform),n.scale(1,-1),Ip(n,s,r.x,r.y,r.w,r.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);let n=this.ctx;this.pendingClip&&(t||(this.pendingClip===K0?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=be(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:e}=this.current,{a:t,b:n,c:s,d:r}=this.ctx.getTransform(),o,a;if(n===0&&s===0){let l=Math.abs(t),c=Math.abs(r);if(l===c)if(e===0)o=a=1/l;else{let d=l*e;o=a=d<1?1/d:1}else if(e===0)o=1/l,a=1/c;else{let d=l*e,h=c*e;o=d<1?1/d:1,a=h<1?1/h:1}}else{let l=Math.abs(t*r-n*s),c=Math.hypot(t,n),d=Math.hypot(s,r);if(e===0)o=d/l,a=c/l;else{let h=e*l;o=d>h?d/h:1,a=c>h?c/h:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){let{ctx:t}=this,{lineWidth:n}=this.current,[s,r]=this.getScaleForStroking();if(t.lineWidth=n||1,s===1&&r===1){t.stroke();return}let o=t.getLineDash();if(e&&t.save(),t.scale(s,r),o.length>0){let a=Math.max(s,r);t.setLineDash(o.map(l=>l/a)),t.lineDashOffset/=a}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};mu=new WeakSet,ow=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},yu=new WeakSet,aw=function(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},vu=new WeakSet,lw=function(e,t,n){let s=new Path2D;return s.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),s};var La=HA;for(let i in Tn)La.prototype[i]!==void 0&&(La.prototype[Tn[i]]=La.prototype[i]);var bu,Eu,Vn=class{static get workerPort(){return u(this,bu)}static set workerPort(e){if(!(typeof Worker!="undefined"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");w(this,bu,e)}static get workerSrc(){return u(this,Eu)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");w(this,Eu,e)}};bu=new WeakMap,Eu=new WeakMap,b(Vn,bu,null),b(Vn,Eu,"");var so,wu,cw=class{constructor({parsedData:e,rawData:t}){b(this,so,void 0);b(this,wu,void 0);w(this,so,e),w(this,wu,t)}getRaw(){return u(this,wu)}get(e){var t;return(t=u(this,so).get(e))!=null?t:null}getAll(){return kA(u(this,so))}has(e){return u(this,so).has(e)}};so=new WeakMap,wu=new WeakMap;var Da=Symbol("INTERNAL"),Au,Su,_u,dl,dw=class{constructor(e,{name:t,intent:n,usage:s,rbGroups:r}){b(this,Au,!1);b(this,Su,!1);b(this,_u,!1);b(this,dl,!0);w(this,Au,!!(e&jt.DISPLAY)),w(this,Su,!!(e&jt.PRINT)),this.name=t,this.intent=n,this.usage=s,this.rbGroups=r}get visible(){if(u(this,_u))return u(this,dl);if(!u(this,dl))return!1;let{print:e,view:t}=this.usage;return u(this,Au)?(t==null?void 0:t.viewState)!=="OFF":u(this,Su)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,n=!1){e!==Da&&ge("Internal method `_setVisible` called."),w(this,_u,n),w(this,dl,t)}};Au=new WeakMap,Su=new WeakMap,_u=new WeakMap,dl=new WeakMap;var Ls,fe,ul,hl,Cu,hw,uw=class{constructor(e,t=jt.DISPLAY){b(this,Cu);b(this,Ls,null);b(this,fe,new Map);b(this,ul,null);b(this,hl,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,w(this,hl,e.order);for(let n of e.groups)u(this,fe).set(n.id,new dw(t,n));if(e.baseState==="OFF")for(let n of u(this,fe).values())n._setVisible(Da,!1);for(let n of e.on)u(this,fe).get(n)._setVisible(Da,!0);for(let n of e.off)u(this,fe).get(n)._setVisible(Da,!1);w(this,ul,this.getHash())}}isVisible(e){if(u(this,fe).size===0)return!0;if(!e)return Cy("Optional content group not defined."),!0;if(e.type==="OCG")return u(this,fe).has(e.id)?u(this,fe).get(e.id).visible:(Q(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return S(this,Cu,hw).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(let t of e.ids){if(!u(this,fe).has(t))return Q(`Optional content group not found: ${t}`),!0;if(u(this,fe).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(let t of e.ids){if(!u(this,fe).has(t))return Q(`Optional content group not found: ${t}`),!0;if(!u(this,fe).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(let t of e.ids){if(!u(this,fe).has(t))return Q(`Optional content group not found: ${t}`),!0;if(!u(this,fe).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(let t of e.ids){if(!u(this,fe).has(t))return Q(`Optional content group not found: ${t}`),!0;if(u(this,fe).get(t).visible)return!1}return!0}return Q(`Unknown optional content policy ${e.policy}.`),!0}return Q(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){var r;let s=u(this,fe).get(e);if(!s){Q(`Optional content group not found: ${e}`);return}if(n&&t&&s.rbGroups.length)for(let o of s.rbGroups)for(let a of o)a!==e&&((r=u(this,fe).get(a))==null||r._setVisible(Da,!1,!0));s._setVisible(Da,!!t,!0),w(this,Ls,null)}setOCGState({state:e,preserveRB:t}){let n;for(let s of e){switch(s){case"ON":case"OFF":case"Toggle":n=s;continue}let r=u(this,fe).get(s);if(r)switch(n){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!r.visible,t);break}}w(this,Ls,null)}get hasInitialVisibility(){return u(this,ul)===null||this.getHash()===u(this,ul)}getOrder(){return u(this,fe).size?u(this,hl)?u(this,hl).slice():[...u(this,fe).keys()]:null}getGroups(){return u(this,fe).size>0?kA(u(this,fe)):null}getGroup(e){return u(this,fe).get(e)||null}getHash(){if(u(this,Ls)!==null)return u(this,Ls);let e=new pg;for(let[t,n]of u(this,fe))e.update(`${t}:${n.visible}`);return w(this,Ls,e.hexdigest())}};Ls=new WeakMap,fe=new WeakMap,ul=new WeakMap,hl=new WeakMap,Cu=new WeakSet,hw=function(e){let t=e.length;if(t<2)return!0;let n=e[0];for(let s=1;s<t;s++){let r=e[s],o;if(Array.isArray(r))o=S(this,Cu,hw).call(this,r);else if(u(this,fe).has(r))o=u(this,fe).get(r).visible;else return Q(`Optional content group not found: ${r}`),!0;switch(n){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return n==="And"};var fw=class{constructor(e,{disableRange:t=!1,disableStream:n=!1}){ke(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:s,initialData:r,progressiveDone:o,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,(r==null?void 0:r.length)>0){let l=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),e.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){let n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{let s=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(n),!0)});ke(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e,t;return(t=(e=this._fullRequestReader)==null?void 0:e._loaded)!=null?t:0}_onProgress(e){var t,n,s,r;e.total===void 0?(n=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||n.call(t,{loaded:e.loaded}):(r=(s=this._fullRequestReader)==null?void 0:s.onProgress)==null||r.call(s,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ke(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new pw(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new gw(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}},pw=class{constructor(e,t,n=!1,s=null){this._stream=e,this._done=n||!1,this._filename=FA(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(let r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},gw=class{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function FO(i){let e=!0,t=n("filename\\*","i").exec(i);if(t){t=t[1];let d=a(t);return d=unescape(d),d=l(d),d=c(d),r(d)}if(t=o(i),t){let d=c(t);return r(d)}if(t=n("filename","i").exec(i),t){t=t[1];let d=a(t);return d=c(d),r(d)}function n(d,h){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function s(d,h){if(d){if(!/^[\x00-\xFF]+$/.test(h))return h;try{let p=new TextDecoder(d,{fatal:!0}),m=Ty(h);h=p.decode(m),e=!1}catch(p){}}return h}function r(d){return e&&/[\x80-\xff]/.test(d)&&(d=s("utf-8",d),e&&(d=s("iso-8859-1",d))),d}function o(d){let h=[],p,m=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=m.exec(d))!==null;){let[,v,E,A]=p;if(v=parseInt(v,10),v in h){if(v===0)break;continue}h[v]=[E,A]}let y=[];for(let v=0;v<h.length&&v in h;++v){let[E,A]=h[v];A=a(A),E&&(A=unescape(A),v===0&&(A=l(A))),y.push(A)}return y.join("")}function a(d){if(d.startsWith('"')){let h=d.slice(1).split('\\"');for(let p=0;p<h.length;++p){let m=h[p].indexOf('"');m!==-1&&(h[p]=h[p].slice(0,m),h.length=p+1),h[p]=h[p].replaceAll(/\\(.)/g,"$1")}d=h.join('"')}return d}function l(d){let h=d.indexOf("'");if(h===-1)return d;let p=d.slice(0,h),y=d.slice(h+1).replace(/^[^']*'/,"");return s(p,y)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,p,m,y){if(m==="q"||m==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(v,E){return String.fromCharCode(parseInt(E,16))}),s(p,y);try{y=atob(y)}catch(v){}return s(p,y)})}return""}function Fx(i,e){let t=new Headers;if(!i||!e||typeof e!="object")return t;for(let n in e){let s=e[n];s!==void 0&&t.append(n,s)}return t}function Iy(i){try{return new URL(i).origin}catch(e){}return null}function Lx({responseHeaders:i,isHttp:e,rangeChunkSize:t,disableRange:n}){let s={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(i.get("Content-Length"),10);return!Number.isInteger(r)||(s.suggestedLength=r,r<=2*t)||n||!e||i.get("Accept-Ranges")!=="bytes"||(i.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function Ox(i){let e=i.get("Content-Disposition");if(e){let t=FO(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch(n){}if(FA(t))return t}return null}function Dy(i,e){return i===404||i===0&&e.startsWith("file:")?new Wo('Missing PDF "'+e+'".'):new pc(`Unexpected server response (${i}) while retrieving PDF "${e}".`,i)}function Ux(i){return i===200||i===206}function Hx(i,e,t){return{method:"GET",headers:i,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function Bx(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:(Q(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}var Sg=class{constructor(e){W(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=Fx(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return(t=(e=this._fullRequestReader)==null?void 0:e._loaded)!=null?t:0}getFullReader(){return ke(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new mw(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new yw(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeRequestReaders.slice(0))n.cancel(e)}},mw=class{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;let n=new Headers(e.headers),s=t.url;fetch(s,Hx(n,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=Iy(r.url),!Ux(r.status))throw Dy(r.status,s);this._reader=r.body.getReader(),this._headersCapability.resolve();let o=r.headers,{allowRangeRequests:a,suggestedLength:l}=Lx({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=Ox(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new gi("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:Bx(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}},yw=class{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;let s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;let r=new Headers(e.headers);r.append("Range",`bytes=${t}-${n-1}`);let o=s.url;fetch(o,Hx(r,this._withCredentials,this._abortController)).then(a=>{let l=Iy(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!Ux(a.status))throw Dy(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:Bx(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}},mE=200,yE=206;function LO(i){let e=i.response;return typeof e!="string"?e:Ty(e).buffer}var vw=class{constructor({url:e,httpHeaders:t,withCredentials:n}){W(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=Fx(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){let t=new XMLHttpRequest,n=this.currXhrId++,s=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(let[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=yE):s.expectedStatus=mE,t.responseType="arraybuffer",ke(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var s;let n=this.pendingRequests[e];n&&((s=n.onProgress)==null||s.call(n,t))}onStateChange(e,t){let n=this.pendingRequests[e];if(!n)return;let s=n.xhr;if(s.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){n.onError(s.status);return}let r=s.status||mE;if(!(r===mE&&n.expectedStatus===yE)&&r!==n.expectedStatus){n.onError(s.status);return}let a=LO(s);if(r===yE){let l=s.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?n.onDone({begin:parseInt(c[1],10),chunk:a}):(Q('Missing or invalid "Content-Range" header.'),n.onError(0))}else a?n.onDone({begin:0,chunk:a}):n.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}},bw=class{constructor(e){this._source=e,this._manager=new vw(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ke(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Ew(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let n=new ww(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeRequestReaders.slice(0))n.cancel(e)}},Ew=class{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Iy(t.responseURL);let n=t.getAllResponseHeaders(),s=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{let[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=Lx({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=Ox(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Dy(e,this._url),this._headersCapability.reject(this._storedError);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},ww=class{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;let e=Iy((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){var t;(t=this._storedError)!=null||(this._storedError=Dy(e,this._url));for(let n of this._requests)n.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},OO=/^[a-z][a-z0-9\-+.]+:/i;function UO(i){if(OO.test(i))return new URL(i);let e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(i))}var Aw=class{constructor(e){this.source=e,this.url=UO(e.url),ke(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return(t=(e=this._fullRequestReader)==null?void 0:e._loaded)!=null?t:0}getFullReader(){return ke(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Sw(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new _w(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(let n of this._rangeRequestReaders.slice(0))n.cancel(e)}},Sw=class{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new Wo(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new gi("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},_w=class{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let s=e.source;this._isStreamingSupported=!s.disableStream;let r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}},HO=1e5,xt=30,BO=.8,Z0,Os,Pt,Tu,xu,ro,zi,Ru,Iu,oo,fl,pl,Us,gl,Du,ml,ao,Pu,Mu,lo,co,ku,Hs,yl,_m,Vx,Cm,Gx,Nu,Cw,vl,zp,Fu,Tw,Tm,$x,xm,zx,Ce=class Ce{constructor({textContentSource:e,container:t,viewport:n}){b(this,_m);b(this,Cm);b(this,Nu);b(this,Os,Promise.withResolvers());b(this,Pt,null);b(this,Tu,!1);b(this,xu,!!((Z0=globalThis.FontInspector)!=null&&Z0.enabled));b(this,ro,null);b(this,zi,null);b(this,Ru,0);b(this,Iu,0);b(this,oo,null);b(this,fl,null);b(this,pl,0);b(this,Us,0);b(this,gl,Object.create(null));b(this,Du,[]);b(this,ml,null);b(this,ao,[]);b(this,Pu,new WeakMap);b(this,Mu,null);var l;if(e instanceof ReadableStream)w(this,ml,e);else if(typeof e=="object")w(this,ml,new ReadableStream({start(c){c.enqueue(e),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');w(this,Pt,w(this,fl,t)),w(this,Us,n.scale*(globalThis.devicePixelRatio||1)),w(this,pl,n.rotation),w(this,zi,{div:null,properties:null,ctx:null});let{pageWidth:s,pageHeight:r,pageX:o,pageY:a}=n.rawDims;w(this,Mu,[1,0,0,-1,-o,a+r]),w(this,Iu,s),w(this,Ru,r),S(l=Ce,Tm,$x).call(l),Yo(t,n),u(this,Os).promise.finally(()=>{u(Ce,yl).delete(this),w(this,zi,null),w(this,gl,null)}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:e,isFirefox:t}=nt.platform;return se(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){let e=()=>{u(this,oo).read().then(({value:t,done:n})=>{var s;if(n){u(this,Os).resolve();return}(s=u(this,ro))!=null||w(this,ro,t.lang),Object.assign(u(this,gl),t.styles),S(this,_m,Vx).call(this,t.items),e()},u(this,Os).reject)};return w(this,oo,u(this,ml).getReader()),u(Ce,yl).add(this),e(),u(this,Os).promise}update({viewport:e,onBefore:t=null}){var r;let n=e.scale*(globalThis.devicePixelRatio||1),s=e.rotation;if(s!==u(this,pl)&&(t==null||t(),w(this,pl,s),Yo(u(this,fl),{rotation:s})),n!==u(this,Us)){t==null||t(),w(this,Us,n);let o={div:null,properties:null,ctx:S(r=Ce,vl,zp).call(r,u(this,ro))};for(let a of u(this,ao))o.properties=u(this,Pu).get(a),o.div=a,S(this,Nu,Cw).call(this,o)}}cancel(){var t;let e=new gi("TextLayer task cancelled.");(t=u(this,oo))==null||t.cancel(e).catch(()=>{}),w(this,oo,null),u(this,Os).reject(e)}get textDivs(){return u(this,ao)}get textContentItemsStr(){return u(this,Du)}static cleanup(){if(!(u(this,yl).size>0)){u(this,lo).clear();for(let{canvas:e}of u(this,co).values())e.remove();u(this,co).clear()}}};Os=new WeakMap,Pt=new WeakMap,Tu=new WeakMap,xu=new WeakMap,ro=new WeakMap,zi=new WeakMap,Ru=new WeakMap,Iu=new WeakMap,oo=new WeakMap,fl=new WeakMap,pl=new WeakMap,Us=new WeakMap,gl=new WeakMap,Du=new WeakMap,ml=new WeakMap,ao=new WeakMap,Pu=new WeakMap,Mu=new WeakMap,lo=new WeakMap,co=new WeakMap,ku=new WeakMap,Hs=new WeakMap,yl=new WeakMap,_m=new WeakSet,Vx=function(e){var s,r,o;if(u(this,Tu))return;(o=(r=u(this,zi)).ctx)!=null||(r.ctx=S(s=Ce,vl,zp).call(s,u(this,ro)));let t=u(this,ao),n=u(this,Du);for(let a of e){if(t.length>HO){Q("Ignoring additional textDivs for performance reasons."),w(this,Tu,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){let l=u(this,Pt);w(this,Pt,document.createElement("span")),u(this,Pt).classList.add("markedContent"),a.id!==null&&u(this,Pt).setAttribute("id",`${a.id}`),l.append(u(this,Pt))}else a.type==="endMarkedContent"&&w(this,Pt,u(this,Pt).parentNode);continue}n.push(a.str),S(this,Cm,Gx).call(this,a)}},Cm=new WeakSet,Gx=function(e){var v;let t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};u(this,ao).push(t);let s=V.transform(u(this,Mu),e.transform),r=Math.atan2(s[1],s[0]),o=u(this,gl)[e.fontName];o.vertical&&(r+=Math.PI/2);let a=u(this,xu)&&o.fontSubstitution||o.fontFamily;a=Ce.fontFamilyMap.get(a)||a;let l=Math.hypot(s[2],s[3]),c=l*S(v=Ce,xm,zx).call(v,a,u(this,ro)),d,h;r===0?(d=s[4],h=s[5]-c):(d=s[4]+c*Math.sin(r),h=s[5]-c*Math.cos(r));let p="calc(var(--scale-factor)*",m=t.style;u(this,Pt)===u(this,fl)?(m.left=`${(100*d/u(this,Iu)).toFixed(2)}%`,m.top=`${(100*h/u(this,Ru)).toFixed(2)}%`):(m.left=`${p}${d.toFixed(2)}px)`,m.top=`${p}${h.toFixed(2)}px)`),m.fontSize=`${p}${(u(Ce,Hs)*l).toFixed(2)}px)`,m.fontFamily=a,n.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,u(this,xu)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(n.angle=r*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){let E=Math.abs(e.transform[0]),A=Math.abs(e.transform[3]);E!==A&&Math.max(E,A)/Math.min(E,A)>1.5&&(y=!0)}if(y&&(n.canvasWidth=o.vertical?e.height:e.width),u(this,Pu).set(t,n),u(this,zi).div=t,u(this,zi).properties=n,S(this,Nu,Cw).call(this,u(this,zi)),n.hasText&&u(this,Pt).append(t),n.hasEOL){let E=document.createElement("br");E.setAttribute("role","presentation"),u(this,Pt).append(E)}},Nu=new WeakSet,Cw=function(e){var a;let{div:t,properties:n,ctx:s}=e,{style:r}=t,o="";if(u(Ce,Hs)>1&&(o=`scale(${1/u(Ce,Hs)})`),n.canvasWidth!==0&&n.hasText){let{fontFamily:l}=r,{canvasWidth:c,fontSize:d}=n;S(a=Ce,Fu,Tw).call(a,s,d*u(this,Us),l);let{width:h}=s.measureText(t.textContent);h>0&&(o=`scaleX(${c*u(this,Us)/h}) ${o}`)}n.angle!==0&&(o=`rotate(${n.angle}deg) ${o}`),o.length>0&&(r.transform=o)},vl=new WeakSet,zp=function(e=null){let t=u(this,co).get(e||(e=""));if(!t){let n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),u(this,co).set(e,t),u(this,ku).set(t,{size:0,family:""})}return t},Fu=new WeakSet,Tw=function(e,t,n){let s=u(this,ku).get(e);t===s.size&&n===s.family||(e.font=`${t}px ${n}`,s.size=t,s.family=n)},Tm=new WeakSet,$x=function(){if(u(this,Hs)!==null)return;let e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),w(this,Hs,e.getBoundingClientRect().height),e.remove()},xm=new WeakSet,zx=function(e,t){let n=u(this,lo).get(e);if(n)return n;let s=S(this,vl,zp).call(this,t);s.canvas.width=s.canvas.height=xt,S(this,Fu,Tw).call(this,s,xt,e);let r=s.measureText(""),o=r.fontBoundingBoxAscent,a=Math.abs(r.fontBoundingBoxDescent);if(o){let d=o/(o+a);return u(this,lo).set(e,d),s.canvas.width=s.canvas.height=0,d}s.strokeStyle="red",s.clearRect(0,0,xt,xt),s.strokeText("g",0,0);let l=s.getImageData(0,0,xt,xt).data;a=0;for(let d=l.length-1-3;d>=0;d-=4)if(l[d]>0){a=Math.ceil(d/4/xt);break}s.clearRect(0,0,xt,xt),s.strokeText("A",0,xt),l=s.getImageData(0,0,xt,xt).data,o=0;for(let d=0,h=l.length;d<h;d+=4)if(l[d]>0){o=xt-Math.floor(d/4/xt);break}s.canvas.width=s.canvas.height=0;let c=o?o/(o+a):BO;return u(this,lo).set(e,c),c},b(Ce,vl),b(Ce,Fu),b(Ce,Tm),b(Ce,xm),b(Ce,lo,new Map),b(Ce,co,new Map),b(Ce,ku,new WeakMap),b(Ce,Hs,null),b(Ce,yl,new Set);var vd=Ce,bd=class i{static textContent(e){let t=[],n={items:t,styles:Object.create(null)};function s(r){var l;if(!r)return;let o=null,a=r.name;if(a==="#text")o=r.value;else if(i.shouldBuildText(a))(l=r==null?void 0:r.attributes)!=null&&l.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(let c of r.children)s(c)}return s(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}},VO=65536,GO=100,$O=5e3,zO=mt?ZE:WE,qO=mt?jE:vg,WO=mt?JE:YE,YO=mt?QE:wg;function KO(i={}){var En,we;typeof i=="string"||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});let e=new xw,{docId:t}=e,n=i.url?XO(i.url):null,s=i.data?JO(i.data):null,r=i.httpHeaders||null,o=i.withCredentials===!0,a=(En=i.password)!=null?En:null,l=i.range instanceof _g?i.range:null,c=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:VO,d=i.worker instanceof Oa?i.worker:null,h=i.verbosity,p=typeof i.docBaseUrl=="string"&&!Ry(i.docBaseUrl)?i.docBaseUrl:null,m=typeof i.cMapUrl=="string"?i.cMapUrl:null,y=i.cMapPacked!==!1,v=i.CMapReaderFactory||qO,E=typeof i.standardFontDataUrl=="string"?i.standardFontDataUrl:null,A=i.StandardFontDataFactory||YO,_=i.stopAtErrors!==!0,C=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,T=i.isEvalSupported!==!1,R=typeof i.isOffscreenCanvasSupported=="boolean"?i.isOffscreenCanvasSupported:!mt,I=typeof i.isImageDecoderSupported=="boolean"?i.isImageDecoderSupported:!mt&&(nt.platform.isFirefox||!globalThis.chrome),D=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,k=typeof i.disableFontFace=="boolean"?i.disableFontFace:mt,N=i.fontExtraProperties===!0,F=i.enableXfa===!0,U=i.ownerDocument||globalThis.document,re=i.disableRange===!0,J=i.disableStream===!0,Z=i.disableAutoFetch===!0,Ge=i.pdfBug===!0,L=i.CanvasFactory||zO,q=i.FilterFactory||WO,Ht=i.enableHWA===!0,Wn=l?l.length:(we=i.length)!=null?we:NaN,Ti=typeof i.useSystemFonts=="boolean"?i.useSystemFonts:!mt&&!k,rn=typeof i.useWorkerFetch=="boolean"?i.useWorkerFetch:v===vg&&A===wg&&m&&E&&Yc(m,document.baseURI)&&Yc(E,document.baseURI),rt=null;uO(h);let Fe={canvasFactory:new L({ownerDocument:U,enableHWA:Ht}),filterFactory:new q({docId:t,ownerDocument:U}),cMapReaderFactory:rn?null:new v({baseUrl:m,isCompressed:y}),standardFontDataFactory:rn?null:new A({baseUrl:E})};if(!d){let Oc={verbosity:h,port:Vn.workerPort};d=Oc.port?Oa.fromPort(Oc):new Oa(Oc),e._worker=d}let ma={docId:t,apiVersion:"4.10.38",data:s,password:a,disableAutoFetch:Z,rangeChunkSize:c,length:Wn,docBaseUrl:p,enableXfa:F,evaluatorOptions:{maxImageSize:C,disableFontFace:k,ignoreErrors:_,isEvalSupported:T,isOffscreenCanvasSupported:R,isImageDecoderSupported:I,canvasMaxAreaInBytes:D,fontExtraProperties:N,useSystemFonts:Ti,cMapUrl:rn?m:null,standardFontDataUrl:rn?E:null}},Lc={disableFontFace:k,fontExtraProperties:N,ownerDocument:U,pdfBug:Ge,styleElement:rt,loadingParams:{disableAutoFetch:Z,enableXfa:F}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let Oc=d.messageHandler.sendWithPromise("GetDocRequest",ma,s?[s.buffer]:null),eb;if(l)eb=new fw(l,{disableRange:re,disableStream:J});else if(!s){if(!n)throw new Error("getDocument - no `url` parameter provided.");let ya;if(mt)if(Yc(n)){if(typeof fetch=="undefined"||typeof Response=="undefined"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");ya=Sg}else ya=Aw;else ya=Yc(n)?Sg:bw;eb=new ya({url:n,length:Wn,httpHeaders:r,withCredentials:o,rangeChunkSize:c,disableRange:re,disableStream:J})}return Oc.then(ya=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let dC=new xr(t,ya,d.port),mP=new Pw(dC,e,eb,Lc,Fe);e._transport=mP,dC.send("Ready",null)})}).catch(e._capability.reject),e}function XO(i){if(i instanceof URL)return i.href;try{return new URL(i,window.location).href}catch(e){if(mt&&typeof i=="string")return i}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function JO(i){if(mt&&typeof Buffer!="undefined"&&i instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength)return i;if(typeof i=="string")return Ty(i);if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)||typeof i=="object"&&!isNaN(i==null?void 0:i.length))return new Uint8Array(i);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function X0(i){return typeof i=="object"&&Number.isInteger(i==null?void 0:i.num)&&i.num>=0&&Number.isInteger(i==null?void 0:i.gen)&&i.gen>=0}var Rm,Im=class Im{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${vt(Im,Rm)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,n,s;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(r){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,r}this._transport=null,(s=this._worker)==null||s.destroy(),this._worker=null}};Rm=new WeakMap,b(Im,Rm,0);var xw=Im,_g=class{constructor(e,t,n=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let n of this._progressListeners)n(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){ge("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},Rw=class{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return se(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},Bs,qi,Vs,Pa,bl,qp,Iw=class{constructor(e,t,n,s=!1){b(this,Vs);b(this,bl);b(this,Bs,null);b(this,qi,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=s?new dg:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new Cg,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:s=0,dontFlip:r=!1}={}){return new fd({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}getAnnotations({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return se(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:s=Es.ENABLE,transform:r=null,background:o=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:h=!1}){var T,R;(T=this._stats)==null||T.time("Overall");let p=this._transport.getRenderingIntent(n,s,d,h),{renderingIntent:m,cacheKey:y}=p;w(this,qi,!1),S(this,bl,qp).call(this),a||(a=this._transport.getOptionalContentConfig(m));let v=this._intentStates.get(y);v||(v=Object.create(null),this._intentStates.set(y,v)),v.streamReaderCancelTimeout&&(clearTimeout(v.streamReaderCancelTimeout),v.streamReaderCancelTimeout=null);let E=!!(m&jt.PRINT);v.displayReadyCapability||(v.displayReadyCapability=Promise.withResolvers(),v.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(R=this._stats)==null||R.time("Page Request"),this._pumpOperatorList(p));let A=I=>{var D;v.renderTasks.delete(_),(this._maybeCleanupAfterRender||E)&&w(this,qi,!0),S(this,Vs,Pa).call(this,!E),I?(_.capability.reject(I),this._abortOperatorList({intentState:v,reason:I instanceof Error?I:new Error(I)})):_.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(D=globalThis.Stats)!=null&&D.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},_=new Nw({callback:A,params:{canvasContext:e,viewport:t,transform:r,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:v.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!E,pdfBug:this._pdfBug,pageColors:c});(v.renderTasks||(v.renderTasks=new Set)).add(_);let C=_.task;return Promise.all([v.displayReadyCapability.promise,a]).then(([I,D])=>{var k;if(this.destroyed){A();return}if((k=this._stats)==null||k.time("Rendering"),!(D.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");_.initializeGraphics({transparency:I,optionalContentConfig:D}),_.operatorListChanged()}).catch(A),C}getOperatorList({intent:e="display",annotationMode:t=Es.ENABLE,printAnnotationStorage:n=null,isEditing:s=!1}={}){var c;function r(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}let o=this._transport.getRenderingIntent(e,t,n,s,!0),a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=r,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>bd.textContent(n));let t=this.streamTextContent(e);return new Promise(function(n,s){function r(){o.read().then(function({value:l,done:c}){var d;if(c){n(a);return}(d=a.lang)!=null||(a.lang=l.lang),Object.assign(a.styles,l.styles),a.items.push(...l.items),r()},s)}let o=t.getReader(),a={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),w(this,qi,!1),S(this,bl,qp).call(this),Promise.all(e)}cleanup(e=!1){w(this,qi,!0);let t=S(this,Vs,Pa).call(this,!1);return e&&t&&this._stats&&(this._stats=new dg),t}_startRenderPage(e,t){var s,r;let n=this._intentStates.get(t);n&&((s=this._stats)==null||s.timeEnd("Page Request"),(r=n.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let n=0,s=e.length;n<s;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let n of t.renderTasks)n.operatorListChanged();e.lastChunk&&S(this,Vs,Pa).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:s}){let{map:r,transfer:o}=n,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:s},o).getReader(),c=this._intentStates.get(t);c.streamReader=l;let d=()=>{l.read().then(({value:h,done:p})=>{if(p){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,c),d())},h=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(let p of c.renderTasks)p.operatorListChanged();S(this,Vs,Pa).call(this,!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(h);else if(c.opListReadCapability)c.opListReadCapability.reject(h);else throw h}})};d()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof pd){let s=GO;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new gi(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[s,r]of this._intentStates)if(r===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}};Bs=new WeakMap,qi=new WeakMap,Vs=new WeakSet,Pa=function(e=!1){if(S(this,bl,qp).call(this),!u(this,qi)||this.destroyed)return!1;if(e)return w(this,Bs,setTimeout(()=>{w(this,Bs,null),S(this,Vs,Pa).call(this,!1)},$O)),!1;for(let{renderTasks:t,operatorList:n}of this._intentStates.values())if(t.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),w(this,qi,!1),!0},bl=new WeakSet,qp=function(){u(this,Bs)&&(clearTimeout(u(this,Bs)),w(this,Bs,null))};var Wi,Dm,Dw=class{constructor(){b(this,Wi,new Map);b(this,Dm,Promise.resolve())}postMessage(e,t){let n={data:structuredClone(e,t?{transfer:t}:null)};u(this,Dm).then(()=>{for(let[s]of u(this,Wi))s.call(this,n)})}addEventListener(e,t,n=null){let s=null;if((n==null?void 0:n.signal)instanceof AbortSignal){let{signal:r}=n;if(r.aborted){Q("LoopbackPort - cannot use an `aborted` signal.");return}let o=()=>this.removeEventListener(e,t);s=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}u(this,Wi).set(t,s)}removeEventListener(e,t){let n=u(this,Wi).get(t);n==null||n(),u(this,Wi).delete(t)}terminate(){for(let[,e]of u(this,Wi))e==null||e();u(this,Wi).clear()}};Wi=new WeakMap,Dm=new WeakMap;var Pm,uo,ho,El,Wp,wl,Yp,ve=class ve{constructor({name:e=null,port:t=null,verbosity:n=hO()}={}){b(this,El);var s;if(this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((s=u(ve,ho))!=null&&s.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(u(ve,ho)||w(ve,ho,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new xr("main","worker",e),this._messageHandler.on("ready",function(){}),S(this,El,Wp).call(this)}_initialize(){if(u(ve,uo)||u(ve,wl,Yp)){this._setupFakeWorker();return}let{workerSrc:e}=ve;try{ve._isSameOrigin(window.location.href,e)||(e=ve._createCDNWrapper(new URL(e,window.location).href));let t=new Worker(e,{type:"module"}),n=new xr("main","worker",t),s=()=>{r.abort(),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=new AbortController;t.addEventListener("error",()=>{this._webWorker||s()},{signal:r.signal}),n.on("test",a=>{if(r.abort(),this.destroyed||!a){s();return}this._messageHandler=n,this._port=t,this._webWorker=t,S(this,El,Wp).call(this)}),n.on("ready",a=>{if(r.abort(),this.destroyed){s();return}try{o()}catch(l){this._setupFakeWorker()}});let o=()=>{let a=new Uint8Array;n.send("test",a,[a.buffer])};o();return}catch(t){Cy("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){u(ve,uo)||(Q("Setting up fake worker."),w(ve,uo,!0)),ve._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let t=new Dw;this._port=t;let n=`fake${vt(ve,Pm)._++}`,s=new xr(n+"_worker",n,t);e.setup(s,t),this._messageHandler=new xr(n,n+"_worker",t),S(this,El,Wp).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,n;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=u(ve,ho))==null||t.delete(this._port),this._port=null,(n=this._messageHandler)==null||n.destroy(),this._messageHandler=null}static fromPort(e){var n;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");let t=(n=u(this,ho))==null?void 0:n.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new ve(e)}static get workerSrc(){if(Vn.workerSrc)return Vn.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return se(this,"_setupFakeWorkerGlobal",(async()=>u(this,wl,Yp)?u(this,wl,Yp):(await import(this.workerSrc)).WorkerMessageHandler)())}};Pm=new WeakMap,uo=new WeakMap,ho=new WeakMap,El=new WeakSet,Wp=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},wl=new WeakSet,Yp=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch(t){return null}},b(ve,wl),b(ve,Pm,0),b(ve,uo,!1),b(ve,ho,void 0),mt&&(w(ve,uo,!0),Vn.workerSrc||(Vn.workerSrc="./pdf.worker.mjs")),ve._isSameOrigin=(e,t)=>{let n;try{if(n=new URL(e),!n.origin||n.origin==="null")return!1}catch(r){return!1}let s=new URL(t,n);return n.origin===s.origin},ve._createCDNWrapper=e=>{let t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};var Oa=ve,Yi,oi,Al,Sl,Ki,fo,td,Pw=class{constructor(e,t,n,s,r){b(this,fo);b(this,Yi,new Map);b(this,oi,new Map);b(this,Al,new Map);b(this,Sl,new Map);b(this,Ki,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Cg,this.fontLoader=new zE({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return se(this,"annotationStorage",new md)}getRenderingIntent(e,t=Es.ENABLE,n=null,s=!1,r=!1){let o=jt.DISPLAY,a=$E;switch(e){case"any":o=jt.ANY;break;case"display":break;case"print":o=jt.PRINT;break;default:Q(`getRenderingIntent - invalid intent: ${e}`)}let l=o&jt.PRINT&&n instanceof gg?n:this.annotationStorage;switch(t){case Es.DISABLE:o+=jt.ANNOTATIONS_DISABLE;break;case Es.ENABLE:break;case Es.ENABLE_FORMS:o+=jt.ANNOTATIONS_FORMS;break;case Es.ENABLE_STORAGE:o+=jt.ANNOTATIONS_STORAGE,a=l.serializable;break;default:Q(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(o+=jt.IS_EDITING),r&&(o+=jt.OPLIST);let{ids:c,hash:d}=l.modifiedIds,h=[o,a.hash,d];return{renderingIntent:o,cacheKey:h.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=u(this,Ki))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let s of u(this,oi).values())e.push(s._destroy());u(this,oi).clear(),u(this,Al).clear(),u(this,Sl).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var s,r;this.commonObjs.clear(),this.fontLoader.clear(),u(this,Yi).clear(),this.filterFactory.destroy(),vd.cleanup(),(s=this._networkStream)==null||s.cancelAllRequests(new gi("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,s)=>{ke(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},s.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){s.close();return}ke(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{this._fullReader.cancel(r),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async n=>{var a;await this._fullReader.headersReady;let{isStreamingSupported:s,isRangeSupported:r,contentLength:o}=this._fullReader;return(!s||!r)&&(this._lastProgress&&((a=t.onProgress)==null||a.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var c;(c=t.onProgress)==null||c.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:s,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(n,s)=>{ke(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let r=this._networkStream.getRangeReader(n.begin,n.end);if(!r){s.close();return}s.onPull=()=>{r.read().then(function({value:o,done:a}){if(a){s.close();return}ke(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{s.error(o)})},s.onCancel=o=>{r.cancel(o),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new Rw(n,this))}),e.on("DocException",n=>{t._capability.reject(Rt(n))}),e.on("PasswordRequest",n=>{w(this,Ki,Promise.withResolvers());try{if(!t.onPassword)throw Rt(n);let s=r=>{r instanceof Error?u(this,Ki).reject(r):u(this,Ki).resolve({password:r})};t.onPassword(s,n.code)}catch(s){u(this,Ki).reject(s)}return u(this,Ki).promise}),e.on("DataLoaded",n=>{var s;(s=t.onProgress)==null||s.call(t,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;u(this,oi).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,s,r])=>{var o;if(this.destroyed||this.commonObjs.has(n))return null;switch(s){case"Font":let{disableFontFace:a,fontExtraProperties:l,pdfBug:c}=this._params;if("error"in r){let m=r.error;Q(`Error during font loading: ${m}`),this.commonObjs.resolve(n,m);break}let d=c&&((o=globalThis.FontInspector)!=null&&o.enabled)?(m,y)=>globalThis.FontInspector.fontAdded(m,y):null,h=new qE(r,{disableFontFace:a,fontExtraProperties:l,inspectFont:d});this.fontLoader.bind(h).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!l&&h.data&&(h.data=null),this.commonObjs.resolve(n,h)});break;case"CopyLocalImage":let{imageRef:p}=r;ke(p,"The imageRef must be defined.");for(let m of u(this,oi).values())for(let[,y]of m.objs)if((y==null?void 0:y.ref)===p)return y.dataLen?(this.commonObjs.resolve(n,structuredClone(y)),y.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,r);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([n,s,r,o])=>{var l;if(this.destroyed)return;let a=u(this,oi).get(s);if(!a.objs.has(n)){if(a._intentStates.size===0){(l=o==null?void 0:o.bitmap)==null||l.close();return}switch(r){case"Image":a.objs.resolve(n,o),(o==null?void 0:o.dataLen)>oO&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(n,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",n=>{var s;this.destroyed||(s=t.onProgress)==null||s.call(t,{loaded:n.loaded,total:n.total})}),e.on("FetchBuiltInCMap",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(n)}),e.on("FetchStandardFontData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n,s;this.annotationStorage.size<=0&&Q("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:(s=(n=this._fullReader)==null?void 0:n.filename)!=null?s:null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,n=u(this,Al).get(t);if(n)return n;let s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&u(this,Sl).set(r.refStr,e);let o=new Iw(t,r,this,this._params.pdfBug);return u(this,oi).set(t,o),o});return u(this,Al).set(t,s),s}getPageIndex(e){return X0(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return S(this,fo,td).call(this,"GetFieldObjects")}hasJSActions(){return S(this,fo,td).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return S(this,fo,td).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return S(this,fo,td).call(this,"GetOptionalContentConfig").then(t=>new uw(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",t=u(this,Yi).get(e);if(t)return t;let n=this.messageHandler.sendWithPromise(e,null).then(s=>{var r,o,a,l;return{info:s[0],metadata:s[1]?new cw(s[1]):null,contentDispositionFilename:(o=(r=this._fullReader)==null?void 0:r.filename)!=null?o:null,contentLength:(l=(a=this._fullReader)==null?void 0:a.contentLength)!=null?l:null}});return u(this,Yi).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(let t of u(this,oi).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),u(this,Yi).clear(),this.filterFactory.destroy(!0),vd.cleanup()}}cachedPageNumber(e){var n;if(!X0(e))return null;let t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return(n=u(this,Sl).get(t))!=null?n:null}};Yi=new WeakMap,oi=new WeakMap,Al=new WeakMap,Sl=new WeakMap,Ki=new WeakMap,fo=new WeakSet,td=function(e,t=null){let n=u(this,Yi).get(e);if(n)return n;let s=this.messageHandler.sendWithPromise(e,t);return u(this,Yi).set(e,s),s};var qc=Symbol("INITIAL_DATA"),$t,Lu,Mw,Cg=class{constructor(){b(this,Lu);b(this,$t,Object.create(null))}get(e,t=null){if(t){let s=S(this,Lu,Mw).call(this,e);return s.promise.then(()=>t(s.data)),null}let n=u(this,$t)[e];if(!n||n.data===qc)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){let t=u(this,$t)[e];return!!t&&t.data!==qc}delete(e){let t=u(this,$t)[e];return!t||t.data===qc?!1:(delete u(this,$t)[e],!0)}resolve(e,t=null){let n=S(this,Lu,Mw).call(this,e);n.data=t,n.resolve()}clear(){var e;for(let t in u(this,$t)){let{data:n}=u(this,$t)[t];(e=n==null?void 0:n.bitmap)==null||e.close()}w(this,$t,Object.create(null))}*[Symbol.iterator](){for(let e in u(this,$t)){let{data:t}=u(this,$t)[e];t!==qc&&(yield[e,t])}}};$t=new WeakMap,Lu=new WeakSet,Mw=function(e){var t;return(t=u(this,$t))[e]||(t[e]={...Promise.withResolvers(),data:qc})};var Gs,kw=class{constructor(e){b(this,Gs,null);w(this,Gs,e),this.onContinue=null}get promise(){return u(this,Gs).capability.promise}cancel(e=0){u(this,Gs).cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=u(this,Gs).operatorList;if(!e)return!1;let{annotationCanvasMap:t}=u(this,Gs);return e.form||e.canvas&&(t==null?void 0:t.size)>0}};Gs=new WeakMap;var $s,po,Tr=class Tr{constructor({callback:e,params:t,objs:n,commonObjs:s,annotationCanvasMap:r,operatorList:o,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:h=!1,pageColors:p=null}){b(this,$s,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=s,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=h,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window!="undefined",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new kw(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var a,l;if(this.cancelled)return;if(this._canvas){if(u(Tr,po).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");u(Tr,po).add(this._canvas)}this._pdfBug&&((a=globalThis.StepperManager)!=null&&a.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:n,viewport:s,transform:r,background:o}=this.params;this.gfx=new La(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:s,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var n;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),u(this,$s)&&(window.cancelAnimationFrame(u(this,$s)),w(this,$s,null)),u(Tr,po).delete(this._canvas),this.callback(e||new pd(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?w(this,$s,window.requestAnimationFrame(()=>{w(this,$s,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),u(Tr,po).delete(this._canvas),this.callback())))}};$s=new WeakMap,po=new WeakMap,b(Tr,po,new WeakSet);var Nw=Tr,ZO="4.10.38",jO="f9bea397f";function J0(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function Wc(i){return Math.max(0,Math.min(255,255*i))}var Tg=class{static CMYK_G([e,t,n,s]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Wc(e),[e,e,e]}static G_HTML([e]){let t=J0(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(Wc)}static RGB_HTML(e){return`#${e.map(J0).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,n+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,n,s]){return[Wc(1-Math.min(1,e+s)),Wc(1-Math.min(1,n+s)),Wc(1-Math.min(1,t+s))]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){let s=1-e,r=1-t,o=1-n,a=Math.min(s,r,o);return["CMYK",s,r,o,a]}},Fw=class{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");let s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),n||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){ge("Abstract method `_createSVG` called.")}},Ed=class extends Fw{_createSVG(e){return document.createElementNS(Di,e)}},xg=class{static setupStorage(e,t,n,s,r){let o=s.getValue(t,{value:null});switch(n.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(o.value===n.attributes.xfaOn?e.setAttribute("checked",!0):o.value===n.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",a=>{s.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(let a of n.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{let l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;s.setValue(t,{value:c})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:s,linkService:r}){let{attributes:o}=t,a=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${s}`);for(let[l,c]of Object.entries(o))if(c!=null)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,c)}a&&r.addLinkAttributes(e,o.href,o.newWindow),n&&o.dataId&&this.setupStorage(e,o.dataId,t,n)}static render(e){var h,p;let t=e.annotationStorage,n=e.linkService,s=e.xfaHtml,r=e.intent||"display",o=document.createElement(s.name);s.attributes&&this.setAttributes({html:o,element:s,intent:r,linkService:n});let a=r!=="richText",l=e.div;if(l.append(o),e.viewport){let m=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=m}a&&l.setAttribute("class","xfaLayer xfaFont");let c=[];if(s.children.length===0){if(s.value){let m=document.createTextNode(s.value);o.append(m),a&&bd.shouldBuildText(s.name)&&c.push(m)}return{textDivs:c}}let d=[[s,-1,o]];for(;d.length>0;){let[m,y,v]=d.at(-1);if(y+1===m.children.length){d.pop();continue}let E=m.children[++d.at(-1)[1]];if(E===null)continue;let{name:A}=E;if(A==="#text"){let C=document.createTextNode(E.value);c.push(C),v.append(C);continue}let _=(h=E==null?void 0:E.attributes)!=null&&h.xmlns?document.createElementNS(E.attributes.xmlns,A):document.createElement(A);if(v.append(_),E.attributes&&this.setAttributes({html:_,element:E,storage:t,intent:r,linkService:n}),((p=E.children)==null?void 0:p.length)>0)d.push([E,-1,_]);else if(E.value){let C=document.createTextNode(E.value);a&&bd.shouldBuildText(A)&&c.push(C),_.append(C)}}for(let m of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){let t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}},Oh=1e3,QO=9,Jo=new WeakSet;function ir(i){return{width:i[2]-i[0],height:i[3]-i[1]}}var Lw=class{static create(e){switch(e.data.annotationType){case Ue.LINK:return new Rg(e);case Ue.TEXT:return new Uw(e);case Ue.WIDGET:switch(e.data.fieldType){case"Tx":return new Hw(e);case"Btn":return e.data.radioButton?new Ig(e):e.data.checkBox?new Vw(e):new Gw(e);case"Ch":return new $w(e);case"Sig":return new Bw(e)}return new cs(e);case Ue.POPUP:return new wd(e);case Ue.FREETEXT:return new Dg(e);case Ue.LINE:return new Yw(e);case Ue.SQUARE:return new Kw(e);case Ue.CIRCLE:return new Xw(e);case Ue.POLYLINE:return new Pg(e);case Ue.CARET:return new Zw(e);case Ue.INK:return new Ad(e);case Ue.POLYGON:return new Jw(e);case Ue.HIGHLIGHT:return new Mg(e);case Ue.UNDERLINE:return new Qw(e);case Ue.SQUIGGLY:return new eA(e);case Ue.STRIKEOUT:return new tA(e);case Ue.STAMP:return new kg(e);case Ue.FILEATTACHMENT:return new nA(e);default:return new De(e)}}},go,_l,Cl,Ou,Ow,BA=class BA{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:s=!1}={}){b(this,Ou);b(this,go,null);b(this,_l,!1);b(this,Cl,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:n}){return!!(e!=null&&e.str||t!=null&&t.str||n!=null&&n.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return BA._hasPopupData(this.data)}updateEdited(e){var n;if(!this.container)return;u(this,go)||w(this,go,{rect:this.data.rect.slice(0)});let{rect:t}=e;t&&S(this,Ou,Ow).call(this,t),(n=u(this,Cl))==null||n.popup.updateEdited(e)}resetEdited(){var e;u(this,go)&&(S(this,Ou,Ow).call(this,u(this,go).rect),(e=u(this,Cl))==null||e.popup.resetEdited(),w(this,go,null))}_createContainer(e){let{data:t,parent:{page:n,viewport:s}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),this instanceof cs||(r.tabIndex=Oh);let{style:o}=r;if(o.zIndex=this.parent.zIndex++,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof wd){let{rotation:v}=t;return!t.hasOwnCanvas&&v!==0&&this.setRotation(v,r),r}let{width:a,height:l}=ir(t.rect);if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;let v=t.borderStyle.horizontalCornerRadius,E=t.borderStyle.verticalCornerRadius;if(v>0||E>0){let _=`calc(${v}px * var(--scale-factor)) / calc(${E}px * var(--scale-factor))`;o.borderRadius=_}else if(this instanceof Ig){let _=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;o.borderRadius=_}switch(t.borderStyle.style){case $c.SOLID:o.borderStyle="solid";break;case $c.DASHED:o.borderStyle="dashed";break;case $c.BEVELED:Q("Unimplemented border style: beveled");break;case $c.INSET:Q("Unimplemented border style: inset");break;case $c.UNDERLINE:o.borderBottomStyle="solid";break;default:break}let A=t.borderColor||null;A?(w(this,_l,!0),o.borderColor=V.makeHexColor(A[0]|0,A[1]|0,A[2]|0)):o.borderWidth=0}let c=V.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:d,pageHeight:h,pageX:p,pageY:m}=s.rawDims;o.left=`${100*(c[0]-p)/d}%`,o.top=`${100*(c[1]-m)/h}%`;let{rotation:y}=t;return t.hasOwnCanvas||y===0?(o.width=`${100*a/d}%`,o.height=`${100*l/h}%`):this.setRotation(y,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;let{pageWidth:n,pageHeight:s}=this.parent.viewport.rawDims,{width:r,height:o}=ir(this.data.rect),a,l;e%180===0?(a=100*r/n,l=100*o/s):(a=100*o/n,l=100*r/s),t.style.width=`${a}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(t,n,s)=>{let r=s.detail[t],o=r[0],a=r.slice(1);s.target.style[n]=Tg[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[n]:Tg[`${o}_rgb`](a)})};return se(this,"_commonActions",{display:t=>{let{display:n}=t.detail,s=n%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{let{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{let n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){let n=this._commonActions;for(let s of Object.keys(t.detail)){let r=e[s]||n[s];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let n=this._commonActions;for(let[s,r]of Object.entries(t)){let o=n[s];if(o){let a={detail:{[s]:r},target:e};o(a),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:e}=this.data;if(!e)return;let[t,n,s,r]=this.data.rect.map(v=>Math.fround(v));if(e.length===8){let[v,E,A,_]=e.subarray(2,6);if(s===v&&r===E&&t===A&&n===_)return}let{style:o}=this.container,a;if(u(this,_l)){let{borderColor:v,borderWidth:E}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${v}" stroke-width="${E}">`],this.container.classList.add("hasBorder")}let l=s-t,c=r-n,{svgFactory:d}=this,h=d.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0);let p=d.createElement("defs");h.append(p);let m=d.createElement("clipPath"),y=`clippath_${this.data.id}`;m.setAttribute("id",y),m.setAttribute("clipPathUnits","objectBoundingBox"),p.append(m);for(let v=2,E=e.length;v<E;v+=8){let A=e[v],_=e[v+1],C=e[v+2],T=e[v+3],R=d.createElement("rect"),I=(C-t)/l,D=(r-_)/c,k=(A-C)/l,N=(_-T)/c;R.setAttribute("x",I),R.setAttribute("y",D),R.setAttribute("width",k),R.setAttribute("height",N),m.append(R),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${I}" y="${D}" width="${k}" height="${N}"/>`)}u(this,_l)&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(h),this.container.style.clipPath=`url(#${y})`}_createPopup(){let{data:e}=this,t=w(this,Cl,new wd({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){ge("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let n=[];if(this._fieldObjects){let s=this._fieldObjects[e];if(s)for(let{page:r,id:o,exportValues:a}of s){if(r===-1||o===t)continue;let l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${o}"]`);if(c&&!Jo.has(c)){Q(`_getElementsByName - element not allowed: ${o}`);continue}n.push({id:o,exportValue:l,domElement:c})}return n}for(let s of document.getElementsByName(e)){let{exportValue:r}=s,o=s.getAttribute("data-element-id");o!==t&&Jo.has(s)&&n.push({id:o,exportValue:r,domElement:s})}return n}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};go=new WeakMap,_l=new WeakMap,Cl=new WeakMap,Ou=new WeakSet,Ow=function(e){let{container:{style:t},data:{rect:n,rotation:s},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:l}}}}=this;n==null||n.splice(0,4,...e);let{width:c,height:d}=ir(e);t.left=`${100*(e[0]-a)/r}%`,t.top=`${100*(o-e[3]+l)/o}%`,s===0?(t.width=`${100*c/r}%`,t.height=`${100*d/o}%`):this.setRotation(s)};var De=BA,Xi,Ar,Mm,qx,km,Wx,Rg=class extends De{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});b(this,Xi);b(this,Mm);b(this,km);this.isTooltipOnly=t.data.isTooltipOnly}render(){let{data:t,linkService:n}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let r=!1;return t.url?(n.addLinkAttributes(s,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(s,t.action),r=!0):t.attachment?(S(this,Mm,qx).call(this,s,t.attachment,t.attachmentDest),r=!0):t.setOCGState?(S(this,km,Wx).call(this,s,t.setOCGState),r=!0):t.dest?(this._bindLink(s,t.dest),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),r=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(s,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(s),this.container}_bindLink(t,n){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&S(this,Xi,Ar).call(this)}_bindNamedAction(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),S(this,Xi,Ar).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");let s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let r of Object.keys(n.actions)){let o=s.get(r);o&&(t[o]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:r}}),!1})}t.onclick||(t.onclick=()=>!1),S(this,Xi,Ar).call(this)}_bindResetFormAction(t,n){let s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),S(this,Xi,Ar).call(this),!this._fieldObjects){Q('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{var h;s==null||s();let{fields:r,refs:o,include:a}=n,l=[];if(r.length!==0||o.length!==0){let p=new Set(o);for(let m of r){let y=this._fieldObjects[m]||[];for(let{id:v}of y)p.add(v)}for(let m of Object.values(this._fieldObjects))for(let y of m)p.has(y.id)===a&&l.push(y)}else for(let p of Object.values(this._fieldObjects))l.push(...p);let c=this.annotationStorage,d=[];for(let p of l){let{id:m}=p;switch(d.push(m),p.type){case"text":{let v=p.defaultValue||"";c.setValue(m,{value:v});break}case"checkbox":case"radiobutton":{let v=p.defaultValue===p.exportValues;c.setValue(m,{value:v});break}case"combobox":case"listbox":{let v=p.defaultValue||"";c.setValue(m,{value:v});break}default:continue}let y=document.querySelector(`[data-element-id="${m}"]`);if(y){if(!Jo.has(y)){Q(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((h=this.linkService.eventBus)==null||h.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}};Xi=new WeakSet,Ar=function(){this.container.setAttribute("data-internal-link","")},Mm=new WeakSet,qx=function(t,n,s=null){t.href=this.linkService.getAnchorUrl(""),n.description&&(t.title=n.description),t.onclick=()=>{var r;return(r=this.downloadManager)==null||r.openOrDownloadData(n.content,n.filename,s),!1},S(this,Xi,Ar).call(this)},km=new WeakSet,Wx=function(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),S(this,Xi,Ar).call(this)};var Uw=class extends De{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}},cs=class extends De{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return nt.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,s,r){n.includes("mouse")?e.addEventListener(n,o=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(n,o=>{var a;if(n==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}r&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(o)}}))})}_setEventListeners(e,t,n,s){var r,o,a;for(let[l,c]of n)(c==="Action"||(r=this.data.actions)!=null&&r[c])&&((c==="Focus"||c==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,c,s),c==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):c==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":V.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||QO,r=e.style,o,a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),d=Math.round(c/(Mp*s))||1,h=c/d;o=Math.min(s,l(h/Mp))}else{let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(s,l(c/Mp))}r.fontSize=`calc(${o}px * var(--scale-factor))`,r.color=V.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}},Hw=class extends cs{constructor(e){let t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,s){let r=this.annotationStorage;for(let o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=n),r.setValue(o.id,{[s]:n})}render(){var s,r;let e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){let o=e.getValue(t,{value:this.data.fieldValue}),a=o.value||"",l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&a.length>l&&(a=a.slice(0,l));let c=o.formattedValue||((s=this.data.textContent)==null?void 0:s.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));let d={userValue:a,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=c!=null?c:a,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",c!=null?c:a),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Jo.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=Oh,this._setRequired(n,this.data.required),l&&(n.maxLength=l),n.addEventListener("input",p=>{e.setValue(t,{value:p.target.value}),this.setPropertyOnSiblings(n,"value",p.target.value,"value"),d.formattedValue=null}),n.addEventListener("resetform",p=>{var y;let m=(y=this.data.defaultFieldValue)!=null?y:"";n.value=d.userValue=m,d.formattedValue=null});let h=p=>{let{formattedValue:m}=d;m!=null&&(p.target.value=m),p.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",m=>{var v;if(d.focused)return;let{target:y}=m;d.userValue&&(y.value=d.userValue),d.lastCommittedValue=y.value,d.commitKey=1,(v=this.data.actions)!=null&&v.Focus||(d.focused=!0)}),n.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);let y={value(v){var E;d.userValue=(E=v.detail.value)!=null?E:"",e.setValue(t,{value:d.userValue.toString()}),v.target.value=d.userValue},formattedValue(v){let{formattedValue:E}=v.detail;d.formattedValue=E,E!=null&&v.target!==document.activeElement&&(v.target.value=E),e.setValue(t,{formattedValue:E})},selRange(v){v.target.setSelectionRange(...v.detail.selRange)},charLimit:v=>{var C;let{charLimit:E}=v.detail,{target:A}=v;if(E===0){A.removeAttribute("maxLength");return}A.setAttribute("maxLength",E);let _=d.userValue;!_||_.length<=E||(_=_.slice(0,E),A.value=d.userValue=_,e.setValue(t,{value:_}),(C=this.linkService.eventBus)==null||C.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,willCommit:!0,commitKey:1,selStart:A.selectionStart,selEnd:A.selectionEnd}}))}};this._dispatchEventFromSandbox(y,m)}),n.addEventListener("keydown",m=>{var E;d.commitKey=1;let y=-1;if(m.key==="Escape"?y=0:m.key==="Enter"&&!this.data.multiLine?y=2:m.key==="Tab"&&(d.commitKey=3),y===-1)return;let{value:v}=m.target;d.lastCommittedValue!==v&&(d.lastCommittedValue=v,d.userValue=v,(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,willCommit:!0,commitKey:y,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});let p=h;h=null,n.addEventListener("blur",m=>{var v,E;if(!d.focused||!m.relatedTarget)return;(v=this.data.actions)!=null&&v.Blur||(d.focused=!1);let{value:y}=m.target;d.userValue=y,d.lastCommittedValue!==y&&((E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:d.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}})),p(m)}),(r=this.data.actions)!=null&&r.Keystroke&&n.addEventListener("beforeinput",m=>{var R;d.lastCommittedValue=null;let{data:y,target:v}=m,{value:E,selectionStart:A,selectionEnd:_}=v,C=A,T=_;switch(m.inputType){case"deleteWordBackward":{let I=E.substring(0,A).match(/\w*[^\w]*$/);I&&(C-=I[0].length);break}case"deleteWordForward":{let I=E.substring(A).match(/^[^\w]*\w*/);I&&(T+=I[0].length);break}case"deleteContentBackward":A===_&&(C-=1);break;case"deleteContentForward":A===_&&(T+=1);break}m.preventDefault(),(R=this.linkService.eventBus)==null||R.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,change:y||"",willCommit:!1,selStart:C,selEnd:T}})}),this._setEventListeners(n,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(h&&n.addEventListener("blur",h),this.data.comb){let m=(this.data.rect[2]-this.data.rect[0])/l;n.classList.add("comb"),n.style.letterSpacing=`calc(${m}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},Bw=class extends cs{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}},Vw=class extends cs{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,n=t.id,s=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(n,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let r=document.createElement("input");return Jo.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=Oh,r.addEventListener("change",o=>{let{name:a,checked:l}=o.target;for(let c of this._getElementsByName(a,n)){let d=l&&c.exportValue===t.exportValue;c.domElement&&(c.domElement.checked=d),e.setValue(c.id,{value:d})}e.setValue(n,{value:l})}),r.addEventListener("resetform",o=>{let a=t.defaultFieldValue||"Off";o.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{let a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(n,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},Ig=class extends cs{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,t=this.data,n=t.id,s=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(n,{value:s})),s)for(let o of this._getElementsByName(t.fieldName,n))e.setValue(o.id,{value:!1});let r=document.createElement("input");if(Jo.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.tabIndex=Oh,r.addEventListener("change",o=>{let{name:a,checked:l}=o.target;for(let c of this._getElementsByName(a,n))e.setValue(c.id,{value:!1});e.setValue(n,{value:l})}),r.addEventListener("resetform",o=>{let a=t.defaultFieldValue;o.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){let o=t.buttonValue;r.addEventListener("updatefromsandbox",a=>{let l={value:c=>{let d=o===c.detail.value;for(let h of this._getElementsByName(c.target.name)){let p=d&&h.id===n;h.domElement&&(h.domElement.checked=p),e.setValue(h.id,{value:p})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},Gw=class extends Rg{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}},$w=class extends cs{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");Jo.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=Oh;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",d=>{let h=this.data.defaultFieldValue;for(let p of s.options)p.selected=p.value===h});for(let d of this.data.options){let h=document.createElement("option");h.textContent=d.displayValue,h.value=d.exportValue,n.value.includes(d.exportValue)&&(h.setAttribute("selected",!0),r=!1),s.append(h)}let o=null;if(r){let d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),s.prepend(d),o=()=>{d.remove(),s.removeEventListener("input",o),o=null},s.addEventListener("input",o)}let a=d=>{let h=d?"value":"textContent",{options:p,multiple:m}=s;return m?Array.prototype.filter.call(p,y=>y.selected).map(y=>y[h]):p.selectedIndex===-1?null:p[p.selectedIndex][h]},l=a(!1),c=d=>{let h=d.target.options;return Array.prototype.map.call(h,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",d=>{let h={value(p){o==null||o();let m=p.detail.value,y=new Set(Array.isArray(m)?m:[m]);for(let v of s.options)v.selected=y.has(v.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(p){s.multiple=!0},remove(p){let m=s.options,y=p.detail.remove;m[y].selected=!1,s.remove(y),m.length>0&&Array.prototype.findIndex.call(m,E=>E.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:a(!0),items:c(p)}),l=a(!1)},clear(p){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(p){let{index:m,displayValue:y,exportValue:v}=p.detail.insert,E=s.children[m],A=document.createElement("option");A.textContent=y,A.value=v,E?E.before(A):s.append(A),e.setValue(t,{value:a(!0),items:c(p)}),l=a(!1)},items(p){let{items:m}=p.detail;for(;s.length!==0;)s.remove(0);for(let y of m){let{displayValue:v,exportValue:E}=y,A=document.createElement("option");A.textContent=v,A.value=E,s.append(A)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:a(!0),items:c(p)}),l=a(!1)},indices(p){let m=new Set(p.detail.indices);for(let y of p.target.options)y.selected=m.has(y.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(h,d)}),s.addEventListener("input",d=>{var m;let h=a(!0),p=a(!1);e.setValue(t,{value:h}),d.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:p,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):s.addEventListener("input",function(d){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}},wd=class extends De{constructor(e){let{data:t,elements:n}=e;super(e,{isRenderable:De._hasPopupData(t)}),this.elements=n,this.popup=null}render(){this.container.classList.add("popupAnnotation");let e=this.popup=new zw({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let n of this.elements)n.popup=e,n.container.ariaHasPopup="dialog",t.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(n=>`${NA}${n}`).join(",")),this.container}},Tl,Nm,Fm,xl,mo,Te,Ji,Rl,Uu,Hu,Il,Zi,Mn,ji,Bu,Qi,Vu,yo,vo,Dl,Kp,Gu,qw,Lm,Yx,Om,Kx,Um,Xx,Hm,Jx,Pl,Xp,Ml,Jp,$u,Ww,zw=class{constructor({container:e,color:t,elements:n,titleObj:s,modificationDate:r,contentsObj:o,richText:a,parent:l,rect:c,parentRect:d,open:h}){b(this,Dl);b(this,Gu);b(this,Lm);b(this,Om);b(this,Um);b(this,Hm);b(this,Pl);b(this,Ml);b(this,$u);b(this,Tl,S(this,Um,Xx).bind(this));b(this,Nm,S(this,$u,Ww).bind(this));b(this,Fm,S(this,Ml,Jp).bind(this));b(this,xl,S(this,Pl,Xp).bind(this));b(this,mo,null);b(this,Te,null);b(this,Ji,null);b(this,Rl,null);b(this,Uu,null);b(this,Hu,null);b(this,Il,null);b(this,Zi,!1);b(this,Mn,null);b(this,ji,null);b(this,Bu,null);b(this,Qi,null);b(this,Vu,null);b(this,yo,null);b(this,vo,!1);var p;w(this,Te,e),w(this,Vu,s),w(this,Ji,o),w(this,Qi,a),w(this,Hu,l),w(this,mo,t),w(this,Bu,c),w(this,Il,d),w(this,Uu,n),w(this,Rl,dd.toDateObject(r)),this.trigger=n.flatMap(m=>m.getElementsToTriggerPopup());for(let m of this.trigger)m.addEventListener("click",u(this,xl)),m.addEventListener("mouseenter",u(this,Fm)),m.addEventListener("mouseleave",u(this,Nm)),m.classList.add("popupTriggerArea");for(let m of n)(p=m.container)==null||p.addEventListener("keydown",u(this,Tl));u(this,Te).hidden=!0,h&&S(this,Pl,Xp).call(this)}render(){if(u(this,Mn))return;let e=w(this,Mn,document.createElement("div"));if(e.className="popup",u(this,mo)){let r=e.style.outlineColor=V.makeHexColor(...u(this,mo));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`:e.style.backgroundColor=V.makeHexColor(...u(this,mo).map(a=>Math.floor(.7*(255-a)+a)))}let t=document.createElement("span");t.className="header";let n=document.createElement("h1");if(t.append(n),{dir:n.dir,str:n.textContent}=u(this,Vu),e.append(t),u(this,Rl)){let r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:u(this,Rl).valueOf()})),t.append(r)}let s=u(this,Dl,Kp);if(s)xg.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{let r=this._formatContents(u(this,Ji));e.append(r)}u(this,Te).append(e)}_formatContents({str:e,dir:t}){let n=document.createElement("p");n.classList.add("popupContent"),n.dir=t;let s=e.split(/(?:\r\n?|\n)/);for(let r=0,o=s.length;r<o;++r){let a=s[r];n.append(document.createTextNode(a)),r<o-1&&n.append(document.createElement("br"))}return n}updateEdited({rect:e,popupContent:t}){var n;u(this,yo)||w(this,yo,{contentsObj:u(this,Ji),richText:u(this,Qi)}),e&&w(this,ji,null),t&&(w(this,Qi,S(this,Om,Kx).call(this,t)),w(this,Ji,null)),(n=u(this,Mn))==null||n.remove(),w(this,Mn,null)}resetEdited(){var e;u(this,yo)&&({contentsObj:vt(this,Ji)._,richText:vt(this,Qi)._}=u(this,yo),w(this,yo,null),(e=u(this,Mn))==null||e.remove(),w(this,Mn,null),w(this,ji,null))}forceHide(){w(this,vo,this.isVisible),u(this,vo)&&(u(this,Te).hidden=!0)}maybeShow(){u(this,vo)&&(u(this,Mn)||S(this,Ml,Jp).call(this),w(this,vo,!1),u(this,Te).hidden=!1)}get isVisible(){return u(this,Te).hidden===!1}};Tl=new WeakMap,Nm=new WeakMap,Fm=new WeakMap,xl=new WeakMap,mo=new WeakMap,Te=new WeakMap,Ji=new WeakMap,Rl=new WeakMap,Uu=new WeakMap,Hu=new WeakMap,Il=new WeakMap,Zi=new WeakMap,Mn=new WeakMap,ji=new WeakMap,Bu=new WeakMap,Qi=new WeakMap,Vu=new WeakMap,yo=new WeakMap,vo=new WeakMap,Dl=new WeakSet,Kp=function(){let e=u(this,Qi),t=u(this,Ji);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&u(this,Qi).html||null},Gu=new WeakSet,qw=function(){var e,t,n;return((n=(t=(e=u(this,Dl,Kp))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.fontSize)||0},Lm=new WeakSet,Yx=function(){var e,t,n;return((n=(t=(e=u(this,Dl,Kp))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.color)||null},Om=new WeakSet,Kx=function(e){let t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:u(this,Lm,Yx),fontSize:u(this,Gu,qw)?`calc(${u(this,Gu,qw)}px * var(--scale-factor))`:""}};for(let r of e.split(`
`))t.push({name:"span",value:r,attributes:s});return n},Um=new WeakSet,Xx=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&u(this,Zi))&&S(this,Pl,Xp).call(this)},Hm=new WeakSet,Jx=function(){if(u(this,ji)!==null)return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:s,pageY:r}}}=u(this,Hu),o=!!u(this,Il),a=o?u(this,Il):u(this,Bu);for(let y of u(this,Uu))if(!a||V.intersect(y.data.rect,a)!==null){a=y.data.rect,o=!0;break}let l=V.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),d=o?a[2]-a[0]+5:0,h=l[0]+d,p=l[1];w(this,ji,[100*(h-s)/t,100*(p-r)/n]);let{style:m}=u(this,Te);m.left=`${u(this,ji)[0]}%`,m.top=`${u(this,ji)[1]}%`},Pl=new WeakSet,Xp=function(){w(this,Zi,!u(this,Zi)),u(this,Zi)?(S(this,Ml,Jp).call(this),u(this,Te).addEventListener("click",u(this,xl)),u(this,Te).addEventListener("keydown",u(this,Tl))):(S(this,$u,Ww).call(this),u(this,Te).removeEventListener("click",u(this,xl)),u(this,Te).removeEventListener("keydown",u(this,Tl)))},Ml=new WeakSet,Jp=function(){u(this,Mn)||this.render(),this.isVisible?u(this,Zi)&&u(this,Te).classList.add("focused"):(S(this,Hm,Jx).call(this),u(this,Te).hidden=!1,u(this,Te).style.zIndex=parseInt(u(this,Te).style.zIndex)+1e3)},$u=new WeakSet,Ww=function(){u(this,Te).classList.remove("focused"),!(u(this,Zi)||!this.isVisible)&&(u(this,Te).hidden=!0,u(this,Te).style.zIndex=parseInt(u(this,Te).style.zIndex)-1e3)};var Dg=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=j.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(let t of this.textContent){let n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},zu,Yw=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,zu,null)}render(){this.container.classList.add("lineAnnotation");let t=this.data,{width:n,height:s}=ir(t.rect),r=this.svgFactory.create(n,s,!0),o=w(this,zu,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,zu)}addHighlightArea(){this.container.classList.add("highlightArea")}};zu=new WeakMap;var qu,Kw=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,qu,null)}render(){this.container.classList.add("squareAnnotation");let t=this.data,{width:n,height:s}=ir(t.rect),r=this.svgFactory.create(n,s,!0),o=t.borderStyle.width,a=w(this,qu,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",o/2),a.setAttribute("y",o/2),a.setAttribute("width",n-o),a.setAttribute("height",s-o),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,qu)}addHighlightArea(){this.container.classList.add("highlightArea")}};qu=new WeakMap;var Wu,Xw=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Wu,null)}render(){this.container.classList.add("circleAnnotation");let t=this.data,{width:n,height:s}=ir(t.rect),r=this.svgFactory.create(n,s,!0),o=t.borderStyle.width,a=w(this,Wu,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",n/2),a.setAttribute("cy",s/2),a.setAttribute("rx",n/2-o/2),a.setAttribute("ry",s/2-o/2),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Wu)}addHighlightArea(){this.container.classList.add("highlightArea")}};Wu=new WeakMap;var Yu,Pg=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Yu,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,vertices:n,borderStyle:s,popupRef:r}}=this;if(!n)return this.container;let{width:o,height:a}=ir(t),l=this.svgFactory.create(o,a,!0),c=[];for(let h=0,p=n.length;h<p;h+=2){let m=n[h]-t[0],y=t[3]-n[h+1];c.push(`${m},${y}`)}c=c.join(" ");let d=w(this,Yu,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",c),d.setAttribute("stroke-width",s.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),l.append(d),this.container.append(l),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return u(this,Yu)}addHighlightArea(){this.container.classList.add("highlightArea")}};Yu=new WeakMap;var Jw=class extends Pg{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},Zw=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},Ku,bo,Xu,jw,Ad=class extends De{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Xu);b(this,Ku,null);b(this,bo,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?j.HIGHLIGHT:j.INK}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,rotation:n,inkLists:s,borderStyle:r,popupRef:o}}=this,{transform:a,width:l,height:c}=S(this,Xu,jw).call(this,n,t),d=this.svgFactory.create(l,c,!0),h=w(this,Ku,this.svgFactory.createElement("svg:g"));d.append(h),h.setAttribute("stroke-width",r.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",a);for(let p=0,m=s.length;p<m;p++){let y=this.svgFactory.createElement(this.svgElementName);u(this,bo).push(y),y.setAttribute("points",s[p].join(",")),h.append(y)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);let{thickness:n,points:s,rect:r}=t,o=u(this,Ku);if(n>=0&&o.setAttribute("stroke-width",n||1),s)for(let a=0,l=u(this,bo).length;a<l;a++)u(this,bo)[a].setAttribute("points",s[a].join(","));if(r){let{transform:a,width:l,height:c}=S(this,Xu,jw).call(this,this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${l} ${c}`),o.setAttribute("transform",a)}}getElementsToTriggerPopup(){return u(this,bo)}addHighlightArea(){this.container.classList.add("highlightArea")}};Ku=new WeakMap,bo=new WeakMap,Xu=new WeakSet,jw=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};var Mg=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=j.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},Qw=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},eA=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},tA=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},kg=class extends De{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=j.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Ju,Zu,iA,nA=class extends De{constructor(t){var s;super(t,{isRenderable:!0});b(this,Zu);b(this,Ju,null);let{file:n}=this.data;this.filename=n.filename,this.content=n.content,(s=this.linkService.eventBus)==null||s.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:t,data:n}=this,s;n.hasAppearance||n.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),s.addEventListener("dblclick",S(this,Zu,iA).bind(this)),w(this,Ju,s);let{isMac:r}=nt.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&S(this,Zu,iA).call(this)}),!n.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return u(this,Ju)}addHighlightArea(){this.container.classList.add("highlightArea")}};Ju=new WeakMap,Zu=new WeakSet,iA=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var ju,Eo,wo,Qu,Bm,Zx,eh,rA,sA=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:s,page:r,viewport:o,structTreeLayer:a}){b(this,Bm);b(this,eh);b(this,ju,null);b(this,Eo,null);b(this,wo,new Map);b(this,Qu,null);this.div=e,w(this,ju,t),w(this,Eo,n),w(this,Qu,a||null),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return u(this,wo).size>0}async render(e){var o;let{annotations:t}=e,n=this.div;Yo(n,this.viewport);let s=new Map,r={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Ed,annotationStorage:e.annotationStorage||new md,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let a of t){if(a.noHTML)continue;let l=a.annotationType===Ue.POPUP;if(l){let h=s.get(a.id);if(!h)continue;r.elements=h}else{let{width:h,height:p}=ir(a.rect);if(h<=0||p<=0)continue}r.data=a;let c=Lw.create(r);if(!c.isRenderable)continue;if(!l&&a.popupRef){let h=s.get(a.popupRef);h?h.push(c):s.set(a.popupRef,[c])}let d=c.render();a.hidden&&(d.style.visibility="hidden"),await S(this,Bm,Zx).call(this,d,a.id),c._isEditable&&(u(this,wo).set(c.data.id,c),(o=this._annotationEditorUIManager)==null||o.renderAnnotationElement(c))}S(this,eh,rA).call(this)}update({viewport:e}){let t=this.div;this.viewport=e,Yo(t,{rotation:e.rotation}),S(this,eh,rA).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(u(this,wo).values())}getEditableAnnotation(e){return u(this,wo).get(e)}};ju=new WeakMap,Eo=new WeakMap,wo=new WeakMap,Qu=new WeakMap,Bm=new WeakSet,Zx=async function(e,t){var o,a;let n=e.firstChild||e,s=n.id=`${NA}${t}`,r=await((o=u(this,Qu))==null?void 0:o.getAriaAttributes(s));if(r)for(let[l,c]of r)n.setAttribute(l,c);this.div.append(e),(a=u(this,ju))==null||a.moveElementInDOM(this.div,e,n,!1)},eh=new WeakSet,rA=function(){if(!u(this,Eo))return;let e=this.div;for(let[t,n]of u(this,Eo)){let s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;n.className="annotationContent";let{firstChild:r}=s;r?r.nodeName==="CANVAS"?r.replaceWith(n):r.classList.contains("annotationContent")?r.after(n):r.before(n):s.append(n)}u(this,Eo).clear()};var Pp=/\r\n?|\n/g,kn,zt,th,Ao,qt,Vm,jx,Gm,Qx,$m,eR,kl,Zp,Nl,jp,Fl,Qp,zm,tR,nh,aA,qm,nR,pe=class pe extends _e{constructor(t){super({...t,name:"freeTextEditor"});b(this,Vm);b(this,Gm);b(this,$m);b(this,kl);b(this,Fl);b(this,zm);b(this,qm);b(this,kn,void 0);b(this,zt,"");b(this,th,`${this.id}-editor`);b(this,Ao,null);b(this,qt,void 0);w(this,kn,t.color||pe._defaultColor||_e._defaultLineColor),w(this,qt,t.fontSize||pe._defaultFontSize)}static get _keyboardManager(){let t=pe.prototype,n=o=>o.isEmpty(),s=Xo.TRANSLATE_SMALL,r=Xo.TRANSLATE_BIG;return se(this,"_keyboardManager",new Ko([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:n}]]))}static initialize(t,n){_e.initialize(t,n);let s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case oe.FREETEXT_SIZE:pe._defaultFontSize=n;break;case oe.FREETEXT_COLOR:pe._defaultColor=n;break}}updateParams(t,n){switch(t){case oe.FREETEXT_SIZE:S(this,Vm,jx).call(this,n);break;case oe.FREETEXT_COLOR:S(this,Gm,Qx).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[oe.FREETEXT_SIZE,pe._defaultFontSize],[oe.FREETEXT_COLOR,pe._defaultColor||_e._defaultLineColor]]}get propertiesToUpdate(){return[[oe.FREETEXT_SIZE,u(this,qt)],[oe.FREETEXT_COLOR,u(this,kn)]]}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){let t=this.parentScale;return[-pe._internalPadding*t,-(pe._internalPadding+u(this,qt))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(j.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),w(this,Ao,new AbortController);let t=this._uiManager.combinedSignal(u(this,Ao));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",u(this,th)),this._isDraggable=!0,(t=u(this,Ao))==null||t.abort(),w(this,Ao,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var n;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let t=u(this,zt),n=w(this,zt,S(this,$m,eR).call(this).trimEnd());if(t===n)return;let s=r=>{if(w(this,zt,r),!r){this.remove();return}S(this,Fl,Qp).call(this),this._uiManager.rebuild(this),S(this,kl,Zp).call(this)};this.addCommands({cmd:()=>{s(n)},undo:()=>{s(t)},mustExec:!1}),S(this,kl,Zp).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){pe._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,n;this.width&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",u(this,th)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:s}=this.editorDiv;if(s.fontSize=`calc(${u(this,qt)}px * var(--scale-factor))`,s.color=u(this,kn),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),ug(this,this.div,["dblclick","keydown"]),this.width){let[r,o]=this.parentDimensions;if(this.annotationElementId){let{position:a}=this._initialData,[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);let[d,h]=this.pageDimensions,[p,m]=this.pageTranslation,y,v;switch(this.rotation){case 0:y=t+(a[0]-p)/d,v=n+this.height-(a[1]-m)/h;break;case 90:y=t+(a[0]-p)/d,v=n-(a[1]-m)/h,[l,c]=[c,-l];break;case 180:y=t-this.width+(a[0]-p)/d,v=n-(a[1]-m)/h,[l,c]=[-l,-c];break;case 270:y=t+(a[0]-p-this.height*h)/d,v=n+(a[1]-m-this.width*d)/h,[l,c]=[-c,l];break}this.setAt(y*r,v*o,l,c)}else this.setAt(t*r,n*o,this.width*r,this.height*o);S(this,Fl,Qp).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var y,v,E;let n=t.clipboardData||window.clipboardData,{types:s}=n;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();let r=S(y=pe,nh,aA).call(y,n.getData("text")||"").replaceAll(Pp,`
`);if(!r)return;let o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();let a=o.getRangeAt(0);if(!r.includes(`
`)){a.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}let{startContainer:l,startOffset:c}=a,d=[],h=[];if(l.nodeType===Node.TEXT_NODE){let A=l.parentElement;if(h.push(l.nodeValue.slice(c).replaceAll(Pp,"")),A!==this.editorDiv){let _=d;for(let C of this.editorDiv.childNodes){if(C===A){_=h;continue}_.push(S(v=pe,Nl,jp).call(v,C))}}d.push(l.nodeValue.slice(0,c).replaceAll(Pp,""))}else if(l===this.editorDiv){let A=d,_=0;for(let C of this.editorDiv.childNodes)_++===c&&(A=h),A.push(S(E=pe,Nl,jp).call(E,C))}w(this,zt,`${d.join(`
`)}${r}${h.join(`
`)}`),S(this,Fl,Qp).call(this);let p=new Range,m=d.reduce((A,_)=>A+_.length,0);for(let{firstChild:A}of this.editorDiv.childNodes)if(A.nodeType===Node.TEXT_NODE){let _=A.nodeValue.length;if(m<=_){p.setStart(A,m),p.setEnd(A,m);break}m-=_}o.removeAllRanges(),o.addRange(p)}get contentDiv(){return this.editorDiv}static async deserialize(t,n,s){var a;let r=null;if(t instanceof Dg){let{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:d,rotation:h,id:p,popupRef:m},textContent:y,textPosition:v,parent:{page:{pageNumber:E}}}=t;if(!y||y.length===0)return null;r=t={annotationType:j.FREETEXT,color:Array.from(c),fontSize:l,value:y.join(`
`),position:v,pageIndex:E-1,rect:d.slice(0),rotation:h,id:p,deleted:!1,popupRef:m}}let o=await super.deserialize(t,n,s);return w(o,qt,t.fontSize),w(o,kn,V.makeHexColor(...t.color)),w(o,zt,S(a=pe,nh,aA).call(a,t.value)),o.annotationElementId=t.id||null,o._initialData=r,o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let n=pe._internalPadding*this.parentScale,s=this.getRect(n,n),r=_e._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:u(this,kn)),o={annotationType:j.FREETEXT,color:r,fontSize:u(this,qt),value:S(this,zm,tR).call(this),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?o:this.annotationElementId&&!S(this,qm,nR).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(t){let n=super.renderAnnotationElement(t);if(this.deleted)return n;let{style:s}=n;s.fontSize=`calc(${u(this,qt)}px * var(--scale-factor))`,s.color=u(this,kn),n.replaceChildren();for(let o of u(this,zt).split(`
`)){let a=document.createElement("div");a.append(o?document.createTextNode(o):document.createElement("br")),n.append(a)}let r=pe._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(r,r),popupContent:u(this,zt)}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};kn=new WeakMap,zt=new WeakMap,th=new WeakMap,Ao=new WeakMap,qt=new WeakMap,Vm=new WeakSet,jx=function(t){let n=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--scale-factor))`,this.translate(0,-(r-u(this,qt))*this.parentScale),w(this,qt,r),S(this,kl,Zp).call(this)},s=u(this,qt);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:oe.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Gm=new WeakSet,Qx=function(t){let n=r=>{w(this,kn,this.editorDiv.style.color=r)},s=u(this,kn);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:oe.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},$m=new WeakSet,eR=function(){var s;let t=[];this.editorDiv.normalize();let n=null;for(let r of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(S(s=pe,Nl,jp).call(s,r)),n=r);return t.join(`
`)},kl=new WeakSet,Zp=function(){let[t,n]=this.parentDimensions,s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{let{currentLayer:r,div:o}=this,a=o.style.display,l=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),s=o.getBoundingClientRect(),o.remove(),o.style.display=a,o.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/n):(this.width=s.height/t,this.height=s.width/n),this.fixAndSetPosition()},Nl=new WeakSet,jp=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Pp,"")},Fl=new WeakSet,Qp=function(){if(this.editorDiv.replaceChildren(),!!u(this,zt))for(let t of u(this,zt).split(`
`)){let n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},zm=new WeakSet,tR=function(){return u(this,zt).replaceAll("\xA0"," ")},nh=new WeakSet,aA=function(t){return t.replaceAll(" ","\xA0")},qm=new WeakSet,nR=function(t){let{value:n,fontSize:s,color:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||t.value!==n||t.fontSize!==s||t.color.some((a,l)=>a!==r[l])||t.pageIndex!==o},b(pe,Nl),b(pe,nh),W(pe,"_freeTextDefaultContent",""),W(pe,"_internalPadding",0),W(pe,"_defaultColor",null),W(pe,"_defaultFontSize",10),W(pe,"_type","freetext"),W(pe,"_editorType",j.FREETEXT);var oA=pe,H=class{toSVGPath(){ge("Abstract method `toSVGPath` must be implemented.")}get box(){ge("Abstract getter `box` must be implemented.")}serialize(e,t){ge("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,s,r,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a]*s,o[a+1]=n+e[a+1]*r;return o}static _rescaleAndSwap(e,t,n,s,r,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a+1]*s,o[a+1]=n+e[a]*r;return o}static _translate(e,t,n,s){s||(s=new Float32Array(e.length));for(let r=0,o=e.length;r<o;r+=2)s[r]=t+e[r],s[r+1]=n+e[r+1];return s}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,s,r){switch(r){case 90:return[1-t/n,e/s];case 180:return[1-e/n,1-t/s];case 270:return[t/n,1-e/s];default:return[e/n,t/s]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,s,r,o){return[(e+5*n)/6,(t+5*s)/6,(5*n+r)/6,(5*s+o)/6,(n+r)/2,(s+o)/2]}};W(H,"PRECISION",1e-4);var Wt,Nn,Ll,Ol,ai,ie,So,_o,ih,sh,Ul,Hl,zs,rh,Wm,Ym,Co,nd,Km,iR,Xm,sR,Jm,rR,Zm,oR,jm,aR,Qm,lR,Ni=class Ni{constructor({x:e,y:t},n,s,r,o,a=0){b(this,Co);b(this,Km);b(this,Xm);b(this,Jm);b(this,Zm);b(this,jm);b(this,Qm);b(this,Wt,void 0);b(this,Nn,[]);b(this,Ll,void 0);b(this,Ol,void 0);b(this,ai,[]);b(this,ie,new Float32Array(18));b(this,So,void 0);b(this,_o,void 0);b(this,ih,void 0);b(this,sh,void 0);b(this,Ul,void 0);b(this,Hl,void 0);b(this,zs,[]);w(this,Wt,n),w(this,Hl,r*s),w(this,Ol,o),u(this,ie).set([NaN,NaN,NaN,NaN,e,t],6),w(this,Ll,a),w(this,sh,u(Ni,rh)*s),w(this,ih,u(Ni,Ym)*s),w(this,Ul,s),u(this,zs).push(e,t)}isEmpty(){return isNaN(u(this,ie)[8])}add({x:e,y:t}){var N;w(this,So,e),w(this,_o,t);let[n,s,r,o]=u(this,Wt),[a,l,c,d]=u(this,ie).subarray(8,12),h=e-c,p=t-d,m=Math.hypot(h,p);if(m<u(this,ih))return!1;let y=m-u(this,sh),v=y/m,E=v*h,A=v*p,_=a,C=l;a=c,l=d,c+=E,d+=A,(N=u(this,zs))==null||N.push(e,t);let T=-A/y,R=E/y,I=T*u(this,Hl),D=R*u(this,Hl);return u(this,ie).set(u(this,ie).subarray(2,8),0),u(this,ie).set([c+I,d+D],4),u(this,ie).set(u(this,ie).subarray(14,18),12),u(this,ie).set([c-I,d-D],16),isNaN(u(this,ie)[6])?(u(this,ai).length===0&&(u(this,ie).set([a+I,l+D],2),u(this,ai).push(NaN,NaN,NaN,NaN,(a+I-n)/r,(l+D-s)/o),u(this,ie).set([a-I,l-D],14),u(this,Nn).push(NaN,NaN,NaN,NaN,(a-I-n)/r,(l-D-s)/o)),u(this,ie).set([_,C,a,l,c,d],6),!this.isEmpty()):(u(this,ie).set([_,C,a,l,c,d],6),Math.abs(Math.atan2(C-l,_-a)-Math.atan2(A,E))<Math.PI/2?([a,l,c,d]=u(this,ie).subarray(2,6),u(this,ai).push(NaN,NaN,NaN,NaN,((a+c)/2-n)/r,((l+d)/2-s)/o),[a,l,_,C]=u(this,ie).subarray(14,18),u(this,Nn).push(NaN,NaN,NaN,NaN,((_+a)/2-n)/r,((C+l)/2-s)/o),!0):([_,C,a,l,c,d]=u(this,ie).subarray(0,6),u(this,ai).push(((_+5*a)/6-n)/r,((C+5*l)/6-s)/o,((5*a+c)/6-n)/r,((5*l+d)/6-s)/o,((a+c)/2-n)/r,((l+d)/2-s)/o),[c,d,a,l,_,C]=u(this,ie).subarray(12,18),u(this,Nn).push(((_+5*a)/6-n)/r,((C+5*l)/6-s)/o,((5*a+c)/6-n)/r,((5*l+d)/6-s)/o,((a+c)/2-n)/r,((l+d)/2-s)/o),!0))}toSVGPath(){if(this.isEmpty())return"";let e=u(this,ai),t=u(this,Nn);if(isNaN(u(this,ie)[6])&&!this.isEmpty())return S(this,Km,iR).call(this);let n=[];n.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?n.push(`L${e[s+4]} ${e[s+5]}`):n.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);S(this,Jm,rR).call(this,n);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?n.push(`L${t[s+4]} ${t[s+5]}`):n.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return S(this,Xm,sR).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,s,r,o){return new Fg(e,t,n,s,r,o)}getOutlines(){var h,p;let e=u(this,ai),t=u(this,Nn),n=u(this,ie),[s,r,o,a]=u(this,Wt),l=new Float32Array(((p=(h=u(this,zs))==null?void 0:h.length)!=null?p:0)+2);for(let m=0,y=l.length-2;m<y;m+=2)l[m]=(u(this,zs)[m]-s)/o,l[m+1]=(u(this,zs)[m+1]-r)/a;if(l[l.length-2]=(u(this,So)-s)/o,l[l.length-1]=(u(this,_o)-r)/a,isNaN(n[6])&&!this.isEmpty())return S(this,Zm,oR).call(this,l);let c=new Float32Array(u(this,ai).length+24+u(this,Nn).length),d=e.length;for(let m=0;m<d;m+=2){if(isNaN(e[m])){c[m]=c[m+1]=NaN;continue}c[m]=e[m],c[m+1]=e[m+1]}d=S(this,Qm,lR).call(this,c,d);for(let m=t.length-6;m>=6;m-=6)for(let y=0;y<6;y+=2){if(isNaN(t[m+y])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=t[m+y],c[d+1]=t[m+y+1],d+=2}return S(this,jm,aR).call(this,c,d),this.newFreeDrawOutline(c,l,u(this,Wt),u(this,Ul),u(this,Ll),u(this,Ol))}};Wt=new WeakMap,Nn=new WeakMap,Ll=new WeakMap,Ol=new WeakMap,ai=new WeakMap,ie=new WeakMap,So=new WeakMap,_o=new WeakMap,ih=new WeakMap,sh=new WeakMap,Ul=new WeakMap,Hl=new WeakMap,zs=new WeakMap,rh=new WeakMap,Wm=new WeakMap,Ym=new WeakMap,Co=new WeakSet,nd=function(){let e=u(this,ie).subarray(4,6),t=u(this,ie).subarray(16,18),[n,s,r,o]=u(this,Wt);return[(u(this,So)+(e[0]-t[0])/2-n)/r,(u(this,_o)+(e[1]-t[1])/2-s)/o,(u(this,So)+(t[0]-e[0])/2-n)/r,(u(this,_o)+(t[1]-e[1])/2-s)/o]},Km=new WeakSet,iR=function(){let[e,t,n,s]=u(this,Wt),[r,o,a,l]=S(this,Co,nd).call(this);return`M${(u(this,ie)[2]-e)/n} ${(u(this,ie)[3]-t)/s} L${(u(this,ie)[4]-e)/n} ${(u(this,ie)[5]-t)/s} L${r} ${o} L${a} ${l} L${(u(this,ie)[16]-e)/n} ${(u(this,ie)[17]-t)/s} L${(u(this,ie)[14]-e)/n} ${(u(this,ie)[15]-t)/s} Z`},Xm=new WeakSet,sR=function(e){let t=u(this,Nn);e.push(`L${t[4]} ${t[5]} Z`)},Jm=new WeakSet,rR=function(e){let[t,n,s,r]=u(this,Wt),o=u(this,ie).subarray(4,6),a=u(this,ie).subarray(16,18),[l,c,d,h]=S(this,Co,nd).call(this);e.push(`L${(o[0]-t)/s} ${(o[1]-n)/r} L${l} ${c} L${d} ${h} L${(a[0]-t)/s} ${(a[1]-n)/r}`)},Zm=new WeakSet,oR=function(e){let t=u(this,ie),[n,s,r,o]=u(this,Wt),[a,l,c,d]=S(this,Co,nd).call(this),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-n)/r,(t[3]-s)/o,NaN,NaN,NaN,NaN,(t[4]-n)/r,(t[5]-s)/o,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(t[16]-n)/r,(t[17]-s)/o,NaN,NaN,NaN,NaN,(t[14]-n)/r,(t[15]-s)/o],0),this.newFreeDrawOutline(h,e,u(this,Wt),u(this,Ul),u(this,Ll),u(this,Ol))},jm=new WeakSet,aR=function(e,t){let n=u(this,Nn);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},Qm=new WeakSet,lR=function(e,t){let n=u(this,ie).subarray(4,6),s=u(this,ie).subarray(16,18),[r,o,a,l]=u(this,Wt),[c,d,h,p]=S(this,Co,nd).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-r)/a,(n[1]-o)/l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,h,p,NaN,NaN,NaN,NaN,(s[0]-r)/a,(s[1]-o)/l],t),t+=24},b(Ni,rh,8),b(Ni,Wm,2),b(Ni,Ym,u(Ni,rh)+u(Ni,Wm));var Ng=Ni,Bl,To,es,oh,Yt,ah,Ie,ey,cR,Fg=class extends H{constructor(t,n,s,r,o,a){super();b(this,ey);b(this,Bl,void 0);b(this,To,new Float32Array(4));b(this,es,void 0);b(this,oh,void 0);b(this,Yt,void 0);b(this,ah,void 0);b(this,Ie,void 0);w(this,Ie,t),w(this,Yt,n),w(this,Bl,s),w(this,ah,r),w(this,es,o),w(this,oh,a),this.lastPoint=[NaN,NaN],S(this,ey,cR).call(this,a);let[l,c,d,h]=u(this,To);for(let p=0,m=t.length;p<m;p+=2)t[p]=(t[p]-l)/d,t[p+1]=(t[p+1]-c)/h;for(let p=0,m=n.length;p<m;p+=2)n[p]=(n[p]-l)/d,n[p+1]=(n[p+1]-c)/h}toSVGPath(){let t=[`M${u(this,Ie)[4]} ${u(this,Ie)[5]}`];for(let n=6,s=u(this,Ie).length;n<s;n+=6){if(isNaN(u(this,Ie)[n])){t.push(`L${u(this,Ie)[n+4]} ${u(this,Ie)[n+5]}`);continue}t.push(`C${u(this,Ie)[n]} ${u(this,Ie)[n+1]} ${u(this,Ie)[n+2]} ${u(this,Ie)[n+3]} ${u(this,Ie)[n+4]} ${u(this,Ie)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,s,r],o){let a=s-t,l=r-n,c,d;switch(o){case 0:c=H._rescale(u(this,Ie),t,r,a,-l),d=H._rescale(u(this,Yt),t,r,a,-l);break;case 90:c=H._rescaleAndSwap(u(this,Ie),t,n,a,l),d=H._rescaleAndSwap(u(this,Yt),t,n,a,l);break;case 180:c=H._rescale(u(this,Ie),s,n,-a,l),d=H._rescale(u(this,Yt),s,n,-a,l);break;case 270:c=H._rescaleAndSwap(u(this,Ie),s,r,-a,-l),d=H._rescaleAndSwap(u(this,Yt),s,r,-a,-l);break}return{outline:Array.from(c),points:[Array.from(d)]}}get box(){return u(this,To)}newOutliner(t,n,s,r,o,a=0){return new Ng(t,n,s,r,o,a)}getNewOutline(t,n){let[s,r,o,a]=u(this,To),[l,c,d,h]=u(this,Bl),p=o*d,m=a*h,y=s*d+l,v=r*h+c,E=this.newOutliner({x:u(this,Yt)[0]*p+y,y:u(this,Yt)[1]*m+v},u(this,Bl),u(this,ah),t,u(this,oh),n!=null?n:u(this,es));for(let A=2;A<u(this,Yt).length;A+=2)E.add({x:u(this,Yt)[A]*p+y,y:u(this,Yt)[A+1]*m+v});return E.getOutlines()}};Bl=new WeakMap,To=new WeakMap,es=new WeakMap,oh=new WeakMap,Yt=new WeakMap,ah=new WeakMap,Ie=new WeakMap,ey=new WeakSet,cR=function(t){let n=u(this,Ie),s=n[4],r=n[5],o=s,a=r,l=s,c=r,d=s,h=r,p=t?Math.max:Math.min;for(let y=6,v=n.length;y<v;y+=6){if(isNaN(n[y]))o=Math.min(o,n[y+4]),a=Math.min(a,n[y+5]),l=Math.max(l,n[y+4]),c=Math.max(c,n[y+5]),h<n[y+5]?(d=n[y+4],h=n[y+5]):h===n[y+5]&&(d=p(d,n[y+4]));else{let E=V.bezierBoundingBox(s,r,...n.slice(y,y+6));o=Math.min(o,E[0]),a=Math.min(a,E[1]),l=Math.max(l,E[2]),c=Math.max(c,E[3]),h<E[3]?(d=E[2],h=E[3]):h===E[3]&&(d=p(d,E[2]))}s=n[y+4],r=n[y+5]}let m=u(this,To);m[0]=o-u(this,es),m[1]=a-u(this,es),m[2]=l-o+2*u(this,es),m[3]=c-a+2*u(this,es),this.lastPoint=[d,h]};var lh,ch,qs,Fn,ty,dR,Vl,eg,ny,uR,iy,hR,dh,lA,Sd=class{constructor(e,t=0,n=0,s=!0){b(this,ty);b(this,Vl);b(this,ny);b(this,iy);b(this,dh);b(this,lh,void 0);b(this,ch,void 0);b(this,qs,[]);b(this,Fn,[]);let r=1/0,o=-1/0,a=1/0,l=-1/0,d=10**-4;for(let{x:A,y:_,width:C,height:T}of e){let R=Math.floor((A-t)/d)*d,I=Math.ceil((A+C+t)/d)*d,D=Math.floor((_-t)/d)*d,k=Math.ceil((_+T+t)/d)*d,N=[R,D,k,!0],F=[I,D,k,!1];u(this,qs).push(N,F),r=Math.min(r,R),o=Math.max(o,I),a=Math.min(a,D),l=Math.max(l,k)}let h=o-r+2*n,p=l-a+2*n,m=r-n,y=a-n,v=u(this,qs).at(s?-1:-2),E=[v[0],v[2]];for(let A of u(this,qs)){let[_,C,T]=A;A[0]=(_-m)/h,A[1]=(C-y)/p,A[2]=(T-y)/p}w(this,lh,new Float32Array([m,y,h,p])),w(this,ch,E)}getOutlines(){u(this,qs).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);let e=[];for(let t of u(this,qs))t[3]?(e.push(...S(this,dh,lA).call(this,t)),S(this,ny,uR).call(this,t)):(S(this,iy,hR).call(this,t),e.push(...S(this,dh,lA).call(this,t)));return S(this,ty,dR).call(this,e)}};lh=new WeakMap,ch=new WeakMap,qs=new WeakMap,Fn=new WeakMap,ty=new WeakSet,dR=function(e){let t=[],n=new Set;for(let o of e){let[a,l,c]=o;t.push([a,l,o],[a,c,o])}t.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=t.length;o<a;o+=2){let l=t[o][2],c=t[o+1][2];l.push(c),c.push(l),n.add(l),n.add(c)}let s=[],r;for(;n.size>0;){let o=n.values().next().value,[a,l,c,d,h]=o;n.delete(o);let p=a,m=l;for(r=[a,c],s.push(r);;){let y;if(n.has(d))y=d;else if(n.has(h))y=h;else break;n.delete(y),[a,l,c,d,h]=y,p!==a&&(r.push(p,m,a,m===l?l:c),p=a),m=m===l?c:l}r.push(p,m)}return new cA(s,u(this,lh),u(this,ch))},Vl=new WeakSet,eg=function(e){let t=u(this,Fn),n=0,s=t.length-1;for(;n<=s;){let r=n+s>>1,o=t[r][0];if(o===e)return r;o<e?n=r+1:s=r-1}return s+1},ny=new WeakSet,uR=function([,e,t]){let n=S(this,Vl,eg).call(this,e);u(this,Fn).splice(n,0,[e,t])},iy=new WeakSet,hR=function([,e,t]){let n=S(this,Vl,eg).call(this,e);for(let s=n;s<u(this,Fn).length;s++){let[r,o]=u(this,Fn)[s];if(r!==e)break;if(r===e&&o===t){u(this,Fn).splice(s,1);return}}for(let s=n-1;s>=0;s--){let[r,o]=u(this,Fn)[s];if(r!==e)break;if(r===e&&o===t){u(this,Fn).splice(s,1);return}}},dh=new WeakSet,lA=function(e){let[t,n,s]=e,r=[[t,n,s]],o=S(this,Vl,eg).call(this,s);for(let a=0;a<o;a++){let[l,c]=u(this,Fn)[a];for(let d=0,h=r.length;d<h;d++){let[,p,m]=r[d];if(!(c<=p||m<=l)){if(p>=l){if(m>c)r[d][1]=c;else{if(h===1)return[];r.splice(d,1),d--,h--}continue}r[d][2]=l,m>c&&r.push([t,c,m])}}}return r};var uh,Gl,cA=class extends H{constructor(t,n,s){super();b(this,uh,void 0);b(this,Gl,void 0);w(this,Gl,t),w(this,uh,n),this.lastPoint=s}toSVGPath(){let t=[];for(let n of u(this,Gl)){let[s,r]=n;t.push(`M${s} ${r}`);for(let o=2;o<n.length;o+=2){let a=n[o],l=n[o+1];a===s?(t.push(`V${l}`),r=l):l===r&&(t.push(`H${a}`),s=a)}t.push("Z")}return t.join(" ")}serialize([t,n,s,r],o){let a=[],l=s-t,c=r-n;for(let d of u(this,Gl)){let h=new Array(d.length);for(let p=0;p<d.length;p+=2)h[p]=t+d[p]*l,h[p+1]=r-d[p+1]*c;a.push(h)}return a}get box(){return u(this,uh)}get classNamesForOutlining(){return["highlightOutline"]}};uh=new WeakMap,Gl=new WeakMap;var _d=class extends Ng{newFreeDrawOutline(e,t,n,s,r,o){return new dA(e,t,n,s,r,o)}},dA=class extends Fg{newOutliner(e,t,n,s,r,o=0){return new _d(e,t,n,s,r,o)}},Ln,xo,$l,Be,hh,zl,fh,ph,Ws,On,ql,gh,mh,uA,yh,hA,vh,fA,ts,Sr,sy,fR,li,bs,It=class It{constructor({editor:e=null,uiManager:t=null}){b(this,mh);b(this,yh);b(this,vh);b(this,ts);b(this,sy);b(this,li);b(this,Ln,null);b(this,xo,null);b(this,$l,void 0);b(this,Be,null);b(this,hh,!1);b(this,zl,!1);b(this,fh,null);b(this,ph,void 0);b(this,Ws,null);b(this,On,null);b(this,ql,void 0);var n;e?(w(this,zl,!1),w(this,ql,oe.HIGHLIGHT_COLOR),w(this,fh,e)):(w(this,zl,!0),w(this,ql,oe.HIGHLIGHT_DEFAULT_COLOR)),w(this,On,(e==null?void 0:e._uiManager)||t),w(this,ph,u(this,On)._eventBus),w(this,$l,(e==null?void 0:e.color)||((n=u(this,On))==null?void 0:n.highlightColors.values().next().value)||"#FFFF98"),u(It,gh)||w(It,gh,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return se(this,"_keyboardManager",new Ko([[["Escape","mac+Escape"],It.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],It.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],It.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],It.prototype._moveToPrevious],[["Home","mac+Home"],It.prototype._moveToBeginning],[["End","mac+End"],It.prototype._moveToEnd]]))}renderButton(){let e=w(this,Ln,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);let t=u(this,On)._signal;e.addEventListener("click",S(this,ts,Sr).bind(this),{signal:t}),e.addEventListener("keydown",S(this,vh,fA).bind(this),{signal:t});let n=w(this,xo,document.createElement("span"));return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=u(this,$l),e.append(n),e}renderMainDropdown(){let e=w(this,Be,S(this,mh,uA).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===u(this,Ln)){S(this,ts,Sr).call(this,e);return}let t=e.target.getAttribute("data-color");t&&S(this,yh,hA).call(this,t,e)}_moveToNext(e){var t,n;if(!u(this,li,bs)){S(this,ts,Sr).call(this,e);return}if(e.target===u(this,Ln)){(t=u(this,Be).firstChild)==null||t.focus();return}(n=e.target.nextSibling)==null||n.focus()}_moveToPrevious(e){var t,n;if(e.target===((t=u(this,Be))==null?void 0:t.firstChild)||e.target===u(this,Ln)){u(this,li,bs)&&this._hideDropdownFromKeyboard();return}u(this,li,bs)||S(this,ts,Sr).call(this,e),(n=e.target.previousSibling)==null||n.focus()}_moveToBeginning(e){var t;if(!u(this,li,bs)){S(this,ts,Sr).call(this,e);return}(t=u(this,Be).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!u(this,li,bs)){S(this,ts,Sr).call(this,e);return}(t=u(this,Be).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=u(this,Be))==null||e.classList.add("hidden"),(t=u(this,Ws))==null||t.abort(),w(this,Ws,null)}_hideDropdownFromKeyboard(){var e;if(!u(this,zl)){if(!u(this,li,bs)){(e=u(this,fh))==null||e.unselect();return}this.hideDropdown(),u(this,Ln).focus({preventScroll:!0,focusVisible:u(this,hh)})}}updateColor(e){if(u(this,xo)&&(u(this,xo).style.backgroundColor=e),!u(this,Be))return;let t=u(this,On).highlightColors.values();for(let n of u(this,Be).children)n.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=u(this,Ln))==null||e.remove(),w(this,Ln,null),w(this,xo,null),(t=u(this,Be))==null||t.remove(),w(this,Be,null)}};Ln=new WeakMap,xo=new WeakMap,$l=new WeakMap,Be=new WeakMap,hh=new WeakMap,zl=new WeakMap,fh=new WeakMap,ph=new WeakMap,Ws=new WeakMap,On=new WeakMap,ql=new WeakMap,gh=new WeakMap,mh=new WeakSet,uA=function(){let e=document.createElement("div"),t=u(this,On)._signal;e.addEventListener("contextmenu",Gn,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[n,s]of u(this,On).highlightColors){let r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",s),r.title=n,r.setAttribute("data-l10n-id",u(It,gh)[n]);let o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=s,r.setAttribute("aria-selected",s===u(this,$l)),r.addEventListener("click",S(this,yh,hA).bind(this,s),{signal:t}),e.append(r)}return e.addEventListener("keydown",S(this,vh,fA).bind(this),{signal:t}),e},yh=new WeakSet,hA=function(e,t){t.stopPropagation(),u(this,ph).dispatch("switchannotationeditorparams",{source:this,type:u(this,ql),value:e})},vh=new WeakSet,fA=function(e){It._keyboardManager.exec(this,e)},ts=new WeakSet,Sr=function(e){if(u(this,li,bs)){this.hideDropdown();return}if(w(this,hh,e.detail===0),u(this,Ws)||(w(this,Ws,new AbortController),window.addEventListener("pointerdown",S(this,sy,fR).bind(this),{signal:u(this,On).combinedSignal(u(this,Ws))})),u(this,Be)){u(this,Be).classList.remove("hidden");return}let t=w(this,Be,S(this,mh,uA).call(this));u(this,Ln).append(t)},sy=new WeakSet,fR=function(e){var t;(t=u(this,Be))!=null&&t.contains(e.target)||this.hideDropdown()},li=new WeakSet,bs=function(){return u(this,Be)&&!u(this,Be).classList.contains("hidden")},b(It,gh,null);var Lg=It,Wl,bh,ns,Ro,Yl,Mt,Eh,wh,Io,un,Kt,Qe,Kl,is,ft,Xl,hn,Ah,Sh,pA,Jl,tg,ry,pR,oy,gR,ay,mR,_h,gA,ss,_r,Ys,Ma,ly,yR,Zl,ng,Do,id,cy,vR,dy,bR,uy,ER,hy,wR,fy,AR,le=class le extends _e{constructor(t){super({...t,name:"highlightEditor"});b(this,Sh);b(this,Jl);b(this,ry);b(this,oy);b(this,ay);b(this,_h);b(this,ss);b(this,ly);b(this,Zl);b(this,Do);b(this,cy);b(this,dy);b(this,fy);b(this,Wl,null);b(this,bh,0);b(this,ns,void 0);b(this,Ro,null);b(this,Yl,null);b(this,Mt,null);b(this,Eh,null);b(this,wh,0);b(this,Io,null);b(this,un,null);b(this,Kt,null);b(this,Qe,!1);b(this,Kl,null);b(this,is,void 0);b(this,ft,null);b(this,Xl,"");b(this,hn,void 0);b(this,Ah,"");this.color=t.color||le._defaultColor,w(this,hn,t.thickness||le._defaultThickness),w(this,is,t.opacity||le._defaultOpacity),w(this,ns,t.boxes||null),w(this,Ah,t.methodOfCreation||""),w(this,Xl,t.text||""),this._isDraggable=!1,t.highlightId>-1?(w(this,Qe,!0),S(this,Jl,tg).call(this,t),S(this,ss,_r).call(this)):u(this,ns)&&(w(this,Wl,t.anchorNode),w(this,bh,t.anchorOffset),w(this,Eh,t.focusNode),w(this,wh,t.focusOffset),S(this,Sh,pA).call(this),S(this,ss,_r).call(this),this.rotate(this.rotation))}static get _keyboardManager(){let t=le.prototype;return se(this,"_keyboardManager",new Ko([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:u(this,Qe)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:u(this,hn),methodOfCreation:u(this,Ah)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){var s;_e.initialize(t,n),le._defaultColor||(le._defaultColor=((s=n.highlightColors)==null?void 0:s.values().next().value)||"#fff066")}static updateDefaultParams(t,n){switch(t){case oe.HIGHLIGHT_DEFAULT_COLOR:le._defaultColor=n;break;case oe.HIGHLIGHT_THICKNESS:le._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return u(this,Kl)}updateParams(t,n){switch(t){case oe.HIGHLIGHT_COLOR:S(this,ry,pR).call(this,n);break;case oe.HIGHLIGHT_THICKNESS:S(this,oy,gR).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[oe.HIGHLIGHT_DEFAULT_COLOR,le._defaultColor],[oe.HIGHLIGHT_THICKNESS,le._defaultThickness]]}get propertiesToUpdate(){return[[oe.HIGHLIGHT_COLOR,this.color||le._defaultColor],[oe.HIGHLIGHT_THICKNESS,u(this,hn)||le._defaultThickness],[oe.HIGHLIGHT_FREE,u(this,Qe)]]}async addEditToolbar(){let t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(w(this,Yl,new Lg({editor:this})),t.addColorPicker(u(this,Yl))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(S(this,Do,id).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,S(this,Do,id).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){S(this,_h,gA).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(S(this,ss,_r).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let n=!1;this.parent&&!t?S(this,_h,gA).call(this):t&&(S(this,ss,_r).call(this,t),n=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var r,o,a;let{drawLayer:n}=this.parent,s;u(this,Qe)?(t=(t-this.rotation+360)%360,s=S(r=le,Ys,Ma).call(r,u(this,un).box,t)):s=S(o=le,Ys,Ma).call(o,[this.x,this.y,this.width,this.height],t),n.updateProperties(u(this,Kt),{bbox:s,root:{"data-main-rotation":t}}),n.updateProperties(u(this,ft),{bbox:S(a=le,Ys,Ma).call(a,u(this,Mt).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;let t=super.render();u(this,Xl)&&(t.setAttribute("aria-label",u(this,Xl)),t.setAttribute("role","mark")),u(this,Qe)?t.classList.add("free"):this.div.addEventListener("keydown",S(this,ly,yR).bind(this),{signal:this._uiManager._signal});let n=w(this,Io,document.createElement("div"));t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=u(this,Ro);let[s,r]=this.parentDimensions;return this.setDims(this.width*s,this.height*r),ug(this,u(this,Io),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(u(this,ft),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(u(this,ft),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:S(this,Zl,ng).call(this,!0);break;case 1:case 3:S(this,Zl,ng).call(this,!1);break}}select(){var t;super.select(),u(this,ft)&&((t=this.parent)==null||t.drawLayer.updateProperties(u(this,ft),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),u(this,ft)&&((t=this.parent)==null||t.drawLayer.updateProperties(u(this,ft),{rootClass:{selected:!1}}),u(this,Qe)||S(this,Zl,ng).call(this,!1))}get _mustFixPosition(){return!u(this,Qe)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(u(this,Kt),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(u(this,ft),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:s,x:r,y:o}){let{x:a,y:l,width:c,height:d}=s.getBoundingClientRect(),h=new AbortController,p=t.combinedSignal(h),m=y=>{h.abort(),S(this,hy,wR).call(this,t,y)};window.addEventListener("blur",m,{signal:p}),window.addEventListener("pointerup",m,{signal:p}),window.addEventListener("pointerdown",Qt,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Gn,{signal:p}),s.addEventListener("pointermove",S(this,uy,ER).bind(this,t),{signal:p}),this._freeHighlight=new _d({x:r,y:o},[a,l,c,d],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,s){var v,E,A,_;let r=null;if(t instanceof Mg){let{data:{quadPoints:C,rect:T,rotation:R,id:I,color:D,opacity:k,popupRef:N},parent:{page:{pageNumber:F}}}=t;r=t={annotationType:j.HIGHLIGHT,color:Array.from(D),opacity:k,quadPoints:C,boxes:null,pageIndex:F-1,rect:T.slice(0),rotation:R,id:I,deleted:!1,popupRef:N}}else if(t instanceof Ad){let{data:{inkLists:C,rect:T,rotation:R,id:I,color:D,borderStyle:{rawWidth:k},popupRef:N},parent:{page:{pageNumber:F}}}=t;r=t={annotationType:j.HIGHLIGHT,color:Array.from(D),thickness:k,inkLists:C,boxes:null,pageIndex:F-1,rect:T.slice(0),rotation:R,id:I,deleted:!1,popupRef:N}}let{color:o,quadPoints:a,inkLists:l,opacity:c}=t,d=await super.deserialize(t,n,s);d.color=V.makeHexColor(...o),w(d,is,c||1),l&&w(d,hn,t.thickness),d.annotationElementId=t.id||null,d._initialData=r;let[h,p]=d.pageDimensions,[m,y]=d.pageTranslation;if(a){let C=w(d,ns,[]);for(let T=0;T<a.length;T+=8)C.push({x:(a[T]-m)/h,y:1-(a[T+1]-y)/p,width:(a[T+2]-a[T])/h,height:(a[T+1]-a[T+5])/p});S(v=d,Sh,pA).call(v),S(E=d,ss,_r).call(E),d.rotate(d.rotation)}else if(l){w(d,Qe,!0);let C=l[0],T={x:C[0]-m,y:p-(C[1]-y)},R=new _d(T,[0,0,h,p],1,u(d,hn)/2,!0,.001);for(let k=0,N=C.length;k<N;k+=2)T.x=C[k]-m,T.y=p-(C[k+1]-y),R.add(T);let{id:I,clipPathId:D}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:R.toSVGPath()}},!0,!0);S(A=d,Jl,tg).call(A,{highlightOutlines:R.getOutlines(),highlightId:I,clipPathId:D}),S(_=d,ss,_r).call(_)}return d}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();let n=this.getRect(0,0),s=_e._colorManager.convert(this.color),r={annotationType:j.HIGHLIGHT,color:s,opacity:u(this,is),thickness:u(this,hn),quadPoints:S(this,cy,vR).call(this),outlines:S(this,dy,bR).call(this,n),pageIndex:this.pageIndex,rect:n,rotation:S(this,Do,id).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!S(this,fy,AR).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Wl=new WeakMap,bh=new WeakMap,ns=new WeakMap,Ro=new WeakMap,Yl=new WeakMap,Mt=new WeakMap,Eh=new WeakMap,wh=new WeakMap,Io=new WeakMap,un=new WeakMap,Kt=new WeakMap,Qe=new WeakMap,Kl=new WeakMap,is=new WeakMap,ft=new WeakMap,Xl=new WeakMap,hn=new WeakMap,Ah=new WeakMap,Sh=new WeakSet,pA=function(){let t=new Sd(u(this,ns),.001);w(this,un,t.getOutlines()),[this.x,this.y,this.width,this.height]=u(this,un).box;let n=new Sd(u(this,ns),.0025,.001,this._uiManager.direction==="ltr");w(this,Mt,n.getOutlines());let{lastPoint:s}=u(this,Mt);w(this,Kl,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height])},Jl=new WeakSet,tg=function({highlightOutlines:t,highlightId:n,clipPathId:s}){var h,p;if(w(this,un,t),w(this,Mt,t.getNewOutline(u(this,hn)/2+1.5,.0025)),n>=0)w(this,Kt,n),w(this,Ro,s),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),w(this,ft,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:u(this,Mt).box,path:{d:u(this,Mt).toSVGPath()}},!0));else if(this.parent){let m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(u(this,Kt),{bbox:S(h=le,Ys,Ma).call(h,u(this,un).box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(u(this,ft),{bbox:S(p=le,Ys,Ma).call(p,u(this,Mt).box,m),path:{d:u(this,Mt).toSVGPath()}})}let[o,a,l,c]=t.box;switch(this.rotation){case 0:this.x=o,this.y=a,this.width=l,this.height=c;break;case 90:{let[m,y]=this.parentDimensions;this.x=a,this.y=1-o,this.width=l*y/m,this.height=c*m/y;break}case 180:this.x=1-o,this.y=1-a,this.width=l,this.height=c;break;case 270:{let[m,y]=this.parentDimensions;this.x=1-a,this.y=o,this.width=l*y/m,this.height=c*m/y;break}}let{lastPoint:d}=u(this,Mt);w(this,Kl,[(d[0]-o)/l,(d[1]-a)/c])},ry=new WeakSet,pR=function(t){let n=(o,a)=>{var l,c;this.color=o,w(this,is,a),(l=this.parent)==null||l.drawLayer.updateProperties(u(this,Kt),{root:{fill:o,"fill-opacity":a}}),(c=u(this,Yl))==null||c.updateColor(o)},s=this.color,r=u(this,is);this.addCommands({cmd:n.bind(this,t,le._defaultOpacity),undo:n.bind(this,s,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:oe.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},oy=new WeakSet,gR=function(t){let n=u(this,hn),s=r=>{w(this,hn,r),S(this,ay,mR).call(this,r)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:oe.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},ay=new WeakSet,mR=function(t){if(!u(this,Qe))return;S(this,Jl,tg).call(this,{highlightOutlines:u(this,un).getNewOutline(t/2)}),this.fixAndSetPosition();let[n,s]=this.parentDimensions;this.setDims(this.width*n,this.height*s)},_h=new WeakSet,gA=function(){u(this,Kt)===null||!this.parent||(this.parent.drawLayer.remove(u(this,Kt)),w(this,Kt,null),this.parent.drawLayer.remove(u(this,ft)),w(this,ft,null))},ss=new WeakSet,_r=function(t=this.parent){u(this,Kt)===null&&({id:vt(this,Kt)._,clipPathId:vt(this,Ro)._}=t.drawLayer.draw({bbox:u(this,un).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":u(this,is)},rootClass:{highlight:!0,free:u(this,Qe)},path:{d:u(this,un).toSVGPath()}},!1,!0),w(this,ft,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:u(this,Qe)},bbox:u(this,Mt).box,path:{d:u(this,Mt).toSVGPath()}},u(this,Qe))),u(this,Io)&&(u(this,Io).style.clipPath=u(this,Ro)))},Ys=new WeakSet,Ma=function([t,n,s,r],o){switch(o){case 90:return[1-n-r,t,r,s];case 180:return[1-t-s,1-n-r,s,r];case 270:return[n,1-t-s,r,s]}return[t,n,s,r]},ly=new WeakSet,yR=function(t){le._keyboardManager.exec(this,t)},Zl=new WeakSet,ng=function(t){if(!u(this,Wl))return;let n=window.getSelection();t?n.setPosition(u(this,Wl),u(this,bh)):n.setPosition(u(this,Eh),u(this,wh))},Do=new WeakSet,id=function(){return u(this,Qe)?this.rotation:0},cy=new WeakSet,vR=function(){if(u(this,Qe))return null;let[t,n]=this.pageDimensions,[s,r]=this.pageTranslation,o=u(this,ns),a=new Float32Array(o.length*8),l=0;for(let{x:c,y:d,width:h,height:p}of o){let m=c*t+s,y=(1-d)*n+r;a[l]=a[l+4]=m,a[l+1]=a[l+3]=y,a[l+2]=a[l+6]=m+h*t,a[l+5]=a[l+7]=y-p*n,l+=8}return a},dy=new WeakSet,bR=function(t){return u(this,un).serialize(t,S(this,Do,id).call(this))},uy=new WeakSet,ER=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},hy=new WeakSet,wR=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},fy=new WeakSet,AR=function(t){let{color:n}=this._initialData;return t.color.some((s,r)=>s!==n[r])},b(le,Ys),b(le,uy),b(le,hy),W(le,"_defaultColor",null),W(le,"_defaultOpacity",1),W(le,"_defaultThickness",12),W(le,"_type","highlight"),W(le,"_editorType",j.HIGHLIGHT),W(le,"_freeHighlightId",-1),W(le,"_freeHighlight",null),W(le,"_freeHighlightClipId","");var Og=le,Po,mA=class{constructor(){b(this,Po,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(let[t,n]of Object.entries(e))this.updateProperty(t,n)}updateSVGProperty(e,t){u(this,Po)[e]=t}toSVGProperties(){let e=u(this,Po);return w(this,Po,Object.create(null)),{root:e}}reset(){w(this,Po,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){ge("Not implemented")}};Po=new WeakMap;var Xt,jl,Ye,Mo,ko,Ks,Xs,Js,No,Ch,vA,Th,bA,xh,EA,Fo,sd,py,SR,Ql,ig,Lo,rd,Zs,ka,B=class B extends _e{constructor(t){super(t);b(this,Ch);b(this,Th);b(this,xh);b(this,Fo);b(this,py);b(this,Ql);b(this,Lo);b(this,Zs);b(this,Xt,null);b(this,jl,void 0);W(this,"_drawId",null);w(this,jl,t.mustBeCommitted||!1),t.drawOutlines&&(S(this,Ch,vA).call(this,t),S(this,Fo,sd).call(this))}static _mergeSVGProperties(t,n){let s=new Set(Object.keys(t));for(let[r,o]of Object.entries(n))s.has(r)?Object.assign(t[r],o):t[r]=o;return t}static getDefaultDrawingOptions(t){ge("Not implemented")}static get typesMap(){ge("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){let s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,n),this._currentParent&&(u(B,Ye).updateProperty(s,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){let s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,n)}static get defaultPropertiesToUpdate(){let t=[],n=this._defaultDrawingOptions;for(let[s,r]of this.typesMap)t.push([s,n[r]]);return t}get propertiesToUpdate(){let t=[],{_drawingOptions:n}=this;for(let[s,r]of this.constructor.typesMap)t.push([s,n[r]]);return t}_updateProperty(t,n,s){let r=this._drawingOptions,o=r[n],a=l=>{var d;r.updateProperty(n,l);let c=u(this,Xt).updateProperty(n,l);c&&S(this,Lo,rd).call(this,c),(d=this.parent)==null||d.drawLayer.updateProperties(this._drawId,r.toSVGProperties())};this.addCommands({cmd:a.bind(this,s),undo:a.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,B._mergeSVGProperties(u(this,Xt).getPathResizingSVGProperties(S(this,Ql,ig).call(this)),{bbox:S(this,Zs,ka).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,B._mergeSVGProperties(u(this,Xt).getPathResizedSVGProperties(S(this,Ql,ig).call(this)),{bbox:S(this,Zs,ka).call(this)}))}_onTranslating(t,n){var s;(s=this.parent)==null||s.drawLayer.updateProperties(this._drawId,{bbox:S(this,Zs,ka).call(this,t,n)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,B._mergeSVGProperties(u(this,Xt).getPathTranslatedSVGProperties(S(this,Ql,ig).call(this),this.parentDimensions),{bbox:S(this,Zs,ka).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,u(this,jl)&&(w(this,jl,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){S(this,xh,EA).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(S(this,Fo,sd).call(this),S(this,Lo,rd).call(this,u(this,Xt).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),S(this,xh,EA).call(this)):t&&(this._uiManager.addShouldRescale(this),S(this,Fo,sd).call(this,t),n=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,B._mergeSVGProperties({bbox:S(this,Zs,ka).call(this)},u(this,Xt).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&S(this,Lo,rd).call(this,u(this,Xt).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t=super.render();t.classList.add("draw");let n=document.createElement("div");t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";let[s,r]=this.parentDimensions;return this.setDims(this.width*s,this.height*r),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,n,s,r,o){ge("Not implemented")}static startDrawing(t,n,s,r){var E,A;let{target:o,offsetX:a,offsetY:l,pointerId:c,pointerType:d}=r;if(u(B,Xs)&&u(B,Xs)!==d)return;let{viewport:{rotation:h}}=t,{width:p,height:m}=o.getBoundingClientRect(),y=w(B,Mo,new AbortController),v=t.combinedSignal(y);if(u(B,Ks)||w(B,Ks,c),(E=u(B,Xs))!=null||w(B,Xs,d),window.addEventListener("pointerup",_=>{var C;u(B,Ks)===_.pointerId?this._endDraw(_):(C=u(B,Js))==null||C.delete(_.pointerId)},{signal:v}),window.addEventListener("pointercancel",_=>{var C;u(B,Ks)===_.pointerId?this._currentParent.endDrawingSession():(C=u(B,Js))==null||C.delete(_.pointerId)},{signal:v}),window.addEventListener("pointerdown",_=>{u(B,Xs)===_.pointerType&&((u(B,Js)||w(B,Js,new Set)).add(_.pointerId),u(B,Ye).isCancellable()&&(u(B,Ye).removeLastElement(),u(B,Ye).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:v}),window.addEventListener("contextmenu",Gn,{signal:v}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:v}),o.addEventListener("touchmove",_=>{_.timeStamp===u(B,No)&&Qt(_)},{signal:v}),t.toggleDrawing(),(A=n._editorUndoBar)==null||A.hide(),u(B,Ye)){t.drawLayer.updateProperties(this._currentDrawId,u(B,Ye).startNew(a,l,p,m,h));return}n.updateUIForDefaultProperties(this),w(B,Ye,this.createDrawerInstance(a,l,p,m,h)),w(B,ko,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(u(B,ko).toSVGProperties(),u(B,Ye).defaultSVGProperties),!0,!1)}static _drawMove(t){var o;if(w(B,No,-1),!u(B,Ye))return;let{offsetX:n,offsetY:s,pointerId:r}=t;if(u(B,Ks)===r){if(((o=u(B,Js))==null?void 0:o.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,u(B,Ye).add(n,s)),w(B,No,t.timeStamp),Qt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,w(B,Ye,null),w(B,ko,null),w(B,Xs,null),w(B,No,NaN)),u(B,Mo)&&(u(B,Mo).abort(),w(B,Mo,null),w(B,Ks,NaN),w(B,Js,null))}static _endDraw(t){let n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),t&&n.drawLayer.updateProperties(this._currentDrawId,u(B,Ye).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){let s=u(B,Ye),r=this._currentDrawId,o=s.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(r,s.setLastElement(o))},undo:()=>{n.drawLayer.updateProperties(r,s.removeLastElement())},mustExec:!1,type:oe.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){let n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(oe.DRAW_STEP),!u(B,Ye).isEmpty()){let{pageDimensions:[s,r],scale:o}=n,a=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:u(B,Ye).getOutlines(s*o,r*o,o,this._INNER_MARGIN),drawingOptions:u(B,ko),mustBeCommitted:!t});return this._cleanup(!0),a}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,s,r,o,a){ge("Not implemented")}static async deserialize(t,n,s){var h,p;let{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:l}}=n.viewport,c=this.deserializeDraw(a,l,r,o,this._INNER_MARGIN,t),d=await super.deserialize(t,n,s);return d.createDrawingOptions(t),S(h=d,Ch,vA).call(h,{drawOutlines:c}),S(p=d,Fo,sd).call(p),d.onScaleChanging(),d.rotate(),d}serializeDraw(t){let[n,s]=this.pageTranslation,[r,o]=this.pageDimensions;return u(this,Xt).serialize([n,s,r,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Xt=new WeakMap,jl=new WeakMap,Ye=new WeakMap,Mo=new WeakMap,ko=new WeakMap,Ks=new WeakMap,Xs=new WeakMap,Js=new WeakMap,No=new WeakMap,Ch=new WeakSet,vA=function({drawOutlines:t,drawId:n,drawingOptions:s}){w(this,Xt,t),this._drawingOptions||(this._drawingOptions=s),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=S(this,Th,bA).call(this,t,this.parent),S(this,Lo,rd).call(this,t.box)},Th=new WeakSet,bA=function(t,n){let{id:s}=n.drawLayer.draw(B._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s},xh=new WeakSet,EA=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Fo=new WeakSet,sd=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=S(this,Th,bA).call(this,u(this,Xt),t)}},py=new WeakSet,SR=function([t,n,s,r]){let{parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[n,1-t,s*(a/o),r*(o/a)];case 180:return[1-t,1-n,s,r];case 270:return[1-n,t,s*(a/o),r*(o/a)];default:return[t,n,s,r]}},Ql=new WeakSet,ig=function(){let{x:t,y:n,width:s,height:r,parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[1-n,t,s*(o/a),r*(a/o)];case 180:return[1-t,1-n,s,r];case 270:return[n,1-t,s*(o/a),r*(a/o)];default:return[t,n,s,r]}},Lo=new WeakSet,rd=function(t){if([this.x,this.y,this.width,this.height]=S(this,py,SR).call(this,t),this.div){this.fixAndSetPosition();let[n,s]=this.parentDimensions;this.setDims(this.width*n,this.height*s)}this._onResized()},Zs=new WeakSet,ka=function(){let{x:t,y:n,width:s,height:r,rotation:o,parentRotation:a,parentDimensions:[l,c]}=this;switch((o*4+a)/90){case 1:return[1-n-r,t,r,s];case 2:return[1-t-s,1-n-r,s,r];case 3:return[n,1-t-s,r,s];case 4:return[t,n-s*(l/c),r*(c/l),s*(l/c)];case 5:return[1-n,t,s*(l/c),r*(c/l)];case 6:return[1-t-r*(c/l),1-n,r*(c/l),s*(l/c)];case 7:return[n-s*(l/c),1-t-r*(c/l),s*(l/c),r*(c/l)];case 8:return[t-s,n-r,s,r];case 9:return[1-n,t-s,r,s];case 10:return[1-t,1-n,s,r];case 11:return[n-r,1-t,r,s];case 12:return[t-r*(c/l),n,r*(c/l),s*(l/c)];case 13:return[1-n-s*(l/c),t-r*(c/l),s*(l/c),r*(c/l)];case 14:return[1-t,1-n-s*(l/c),r*(c/l),s*(l/c)];case 15:return[n,1-t,s*(l/c),r*(c/l)];default:return[t,n,s,r]}},W(B,"_currentDrawId",-1),W(B,"_currentParent",null),b(B,Ye,null),b(B,Mo,null),b(B,ko,null),b(B,Ks,NaN),b(B,Xs,null),b(B,Js,null),b(B,No,NaN),W(B,"_INNER_MARGIN",3);var yA=B,ci,Ke,Xe,Oo,ec,At,et,fn,Uo,Ho,Bo,tc,sg,wA=class{constructor(e,t,n,s,r,o){b(this,tc);b(this,ci,new Float64Array(6));b(this,Ke,void 0);b(this,Xe,void 0);b(this,Oo,void 0);b(this,ec,void 0);b(this,At,void 0);b(this,et,"");b(this,fn,0);b(this,Uo,new Ug);b(this,Ho,void 0);b(this,Bo,void 0);w(this,Ho,n),w(this,Bo,s),w(this,Oo,r),w(this,ec,o),[e,t]=S(this,tc,sg).call(this,e,t);let a=w(this,Ke,[NaN,NaN,NaN,NaN,e,t]);w(this,At,[e,t]),w(this,Xe,[{line:a,points:u(this,At)}]),u(this,ci).set(a,0)}updateProperty(e,t){e==="stroke-width"&&w(this,ec,t)}isEmpty(){return!u(this,Xe)||u(this,Xe).length===0}isCancellable(){return u(this,At).length<=10}add(e,t){[e,t]=S(this,tc,sg).call(this,e,t);let[n,s,r,o]=u(this,ci).subarray(2,6),a=e-r,l=t-o;return Math.hypot(u(this,Ho)*a,u(this,Bo)*l)<=2?null:(u(this,At).push(e,t),isNaN(n)?(u(this,ci).set([r,o,e,t],2),u(this,Ke).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(u(this,ci)[0])&&u(this,Ke).splice(6,6),u(this,ci).set([n,s,r,o,e,t],0),u(this,Ke).push(...H.createBezierPoints(n,s,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){let n=this.add(e,t);return n||(u(this,At).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,s,r){w(this,Ho,n),w(this,Bo,s),w(this,Oo,r),[e,t]=S(this,tc,sg).call(this,e,t);let o=w(this,Ke,[NaN,NaN,NaN,NaN,e,t]);w(this,At,[e,t]);let a=u(this,Xe).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),u(this,Xe).push({line:o,points:u(this,At)}),u(this,ci).set(o,0),w(this,fn,0),this.toSVGPath(),null}getLastElement(){return u(this,Xe).at(-1)}setLastElement(e){return u(this,Xe)?(u(this,Xe).push(e),w(this,Ke,e.line),w(this,At,e.points),w(this,fn,0),{path:{d:this.toSVGPath()}}):u(this,Uo).setLastElement(e)}removeLastElement(){if(!u(this,Xe))return u(this,Uo).removeLastElement();u(this,Xe).pop(),w(this,et,"");for(let e=0,t=u(this,Xe).length;e<t;e++){let{line:n,points:s}=u(this,Xe)[e];w(this,Ke,n),w(this,At,s),w(this,fn,0),this.toSVGPath()}return{path:{d:u(this,et)}}}toSVGPath(){let e=H.svgRound(u(this,Ke)[4]),t=H.svgRound(u(this,Ke)[5]);if(u(this,At).length===2)return w(this,et,`${u(this,et)} M ${e} ${t} Z`),u(this,et);if(u(this,At).length<=6){let s=u(this,et).lastIndexOf("M");w(this,et,`${u(this,et).slice(0,s)} M ${e} ${t}`),w(this,fn,6)}if(u(this,At).length===4){let s=H.svgRound(u(this,Ke)[10]),r=H.svgRound(u(this,Ke)[11]);return w(this,et,`${u(this,et)} L ${s} ${r}`),w(this,fn,12),u(this,et)}let n=[];u(this,fn)===0&&(n.push(`M ${e} ${t}`),w(this,fn,6));for(let s=u(this,fn),r=u(this,Ke).length;s<r;s+=6){let[o,a,l,c,d,h]=u(this,Ke).slice(s,s+6).map(H.svgRound);n.push(`C${o} ${a} ${l} ${c} ${d} ${h}`)}return w(this,et,u(this,et)+n.join(" ")),w(this,fn,u(this,Ke).length),u(this,et)}getOutlines(e,t,n,s){let r=u(this,Xe).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),u(this,Uo).build(u(this,Xe),e,t,n,u(this,Oo),u(this,ec),s),w(this,ci,null),w(this,Ke,null),w(this,Xe,null),w(this,et,null),u(this,Uo)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}};ci=new WeakMap,Ke=new WeakMap,Xe=new WeakMap,Oo=new WeakMap,ec=new WeakMap,At=new WeakMap,et=new WeakMap,fn=new WeakMap,Uo=new WeakMap,Ho=new WeakMap,Bo=new WeakMap,tc=new WeakSet,sg=function(e,t){return H._normalizePoint(e,t,u(this,Ho),u(this,Bo),u(this,Oo))};var St,Rh,Ih,Jt,di,ui,nc,ic,sc,Un,Mi,gy,_R,my,CR,yy,TR,VA=class VA extends H{constructor(){super(...arguments);b(this,Un);b(this,gy);b(this,my);b(this,yy);b(this,St,void 0);b(this,Rh,0);b(this,Ih,void 0);b(this,Jt,void 0);b(this,di,void 0);b(this,ui,void 0);b(this,nc,void 0);b(this,ic,void 0);b(this,sc,void 0)}build(t,n,s,r,o,a,l){w(this,di,n),w(this,ui,s),w(this,nc,r),w(this,ic,o),w(this,sc,a),w(this,Ih,l!=null?l:0),w(this,Jt,t),S(this,my,CR).call(this)}setLastElement(t){return u(this,Jt).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return u(this,Jt).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let t=[];for(let{line:n}of u(this,Jt)){if(t.push(`M${H.svgRound(n[4])} ${H.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12){t.push(`L${H.svgRound(n[10])} ${H.svgRound(n[11])}`);continue}for(let s=6,r=n.length;s<r;s+=6){let[o,a,l,c,d,h]=n.subarray(s,s+6).map(H.svgRound);t.push(`C${o} ${a} ${l} ${c} ${d} ${h}`)}}return t.join("")}serialize([t,n,s,r],o){let a=[],l=[],[c,d,h,p]=S(this,gy,_R).call(this),m,y,v,E,A,_,C,T,R;switch(u(this,ic)){case 0:R=H._rescale,m=t,y=n+r,v=s,E=-r,A=t+c*s,_=n+(1-d-p)*r,C=t+(c+h)*s,T=n+(1-d)*r;break;case 90:R=H._rescaleAndSwap,m=t,y=n,v=s,E=r,A=t+d*s,_=n+c*r,C=t+(d+p)*s,T=n+(c+h)*r;break;case 180:R=H._rescale,m=t+s,y=n,v=-s,E=r,A=t+(1-c-h)*s,_=n+d*r,C=t+(1-c)*s,T=n+(d+p)*r;break;case 270:R=H._rescaleAndSwap,m=t+s,y=n+r,v=-s,E=-r,A=t+(1-d-p)*s,_=n+(1-c-h)*r,C=t+(1-d)*s,T=n+(1-c)*r;break}for(let{line:I,points:D}of u(this,Jt))a.push(R(I,m,y,v,E,o?new Array(I.length):null)),l.push(R(D,m,y,v,E,o?new Array(D.length):null));return{lines:a,points:l,rect:[A,_,C,T]}}static deserialize(t,n,s,r,o,{paths:{lines:a,points:l},rotation:c,thickness:d}){let h=[],p,m,y,v,E;switch(c){case 0:E=H._rescale,p=-t/s,m=n/r+1,y=1/s,v=-1/r;break;case 90:E=H._rescaleAndSwap,p=-n/r,m=-t/s,y=1/r,v=1/s;break;case 180:E=H._rescale,p=t/s+1,m=-n/r,y=-1/s,v=1/r;break;case 270:E=H._rescaleAndSwap,p=n/r+1,m=t/s+1,y=-1/r,v=-1/s;break}if(!a){a=[];for(let _ of l){let C=_.length;if(C===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,_[0],_[1]]));continue}if(C===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,_[0],_[1],NaN,NaN,NaN,NaN,_[2],_[3]]));continue}let T=new Float32Array(3*(C-2));a.push(T);let[R,I,D,k]=_.subarray(0,4);T.set([NaN,NaN,NaN,NaN,R,I],0);for(let N=4;N<C;N+=2){let F=_[N],U=_[N+1];T.set(H.createBezierPoints(R,I,D,k,F,U),(N-2)*3),[R,I,D,k]=[D,k,F,U]}}}for(let _=0,C=a.length;_<C;_++)h.push({line:E(a[_].map(T=>T!=null?T:NaN),p,m,y,v),points:E(l[_].map(T=>T!=null?T:NaN),p,m,y,v)});let A=new VA;return A.build(h,s,r,1,c,d,o),A}get box(){return u(this,St)}updateProperty(t,n){return t==="stroke-width"?S(this,yy,TR).call(this,n):null}updateParentDimensions([t,n],s){let[r,o]=S(this,Un,Mi).call(this);w(this,di,t),w(this,ui,n),w(this,nc,s);let[a,l]=S(this,Un,Mi).call(this),c=a-r,d=l-o,h=u(this,St);return h[0]-=c,h[1]-=d,h[2]+=2*c,h[3]+=2*d,h}updateRotation(t){return w(this,Rh,t),{path:{transform:this.rotationTransform}}}get viewBox(){return u(this,St).map(H.svgRound).join(" ")}get defaultProperties(){let[t,n]=u(this,St);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`}}}get rotationTransform(){let[,,t,n]=u(this,St),s=0,r=0,o=0,a=0,l=0,c=0;switch(u(this,Rh)){case 90:r=n/t,o=-t/n,l=t;break;case 180:s=-1,a=-1,l=t,c=n;break;case 270:r=-n/t,o=t/n,c=n;break;default:return""}return`matrix(${s} ${r} ${o} ${a} ${H.svgRound(l)} ${H.svgRound(c)})`}getPathResizingSVGProperties([t,n,s,r]){let[o,a]=S(this,Un,Mi).call(this),[l,c,d,h]=u(this,St);if(Math.abs(d-o)<=H.PRECISION||Math.abs(h-a)<=H.PRECISION){let E=t+s/2-(l+d/2),A=n+r/2-(c+h/2);return{path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`,transform:`${this.rotationTransform} translate(${E} ${A})`}}}let p=(s-2*o)/(d-2*o),m=(r-2*a)/(h-2*a),y=d/s,v=h/r;return{path:{"transform-origin":`${H.svgRound(l)} ${H.svgRound(c)}`,transform:`${this.rotationTransform} scale(${y} ${v}) translate(${H.svgRound(o)} ${H.svgRound(a)}) scale(${p} ${m}) translate(${H.svgRound(-o)} ${H.svgRound(-a)})`}}}getPathResizedSVGProperties([t,n,s,r]){let[o,a]=S(this,Un,Mi).call(this),l=u(this,St),[c,d,h,p]=l;if(l[0]=t,l[1]=n,l[2]=s,l[3]=r,Math.abs(h-o)<=H.PRECISION||Math.abs(p-a)<=H.PRECISION){let A=t+s/2-(c+h/2),_=n+r/2-(d+p/2);for(let{line:C,points:T}of u(this,Jt))H._translate(C,A,_,C),H._translate(T,A,_,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let m=(s-2*o)/(h-2*o),y=(r-2*a)/(p-2*a),v=-m*(c+o)+t+o,E=-y*(d+a)+n+a;if(m!==1||y!==1||v!==0||E!==0)for(let{line:A,points:_}of u(this,Jt))H._rescale(A,v,E,m,y,A),H._rescale(_,v,E,m,y,_);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],s){let[r,o]=s,a=u(this,St),l=t-a[0],c=n-a[1];if(u(this,di)===r&&u(this,ui)===o)for(let{line:d,points:h}of u(this,Jt))H._translate(d,l,c,d),H._translate(h,l,c,h);else{let d=u(this,di)/r,h=u(this,ui)/o;w(this,di,r),w(this,ui,o);for(let{line:p,points:m}of u(this,Jt))H._rescale(p,l,c,d,h,p),H._rescale(m,l,c,d,h,m);a[2]*=d,a[3]*=h}return a[0]=t,a[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${H.svgRound(t)} ${H.svgRound(n)}`}}}get defaultSVGProperties(){let t=u(this,St);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${H.svgRound(t[0])} ${H.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};St=new WeakMap,Rh=new WeakMap,Ih=new WeakMap,Jt=new WeakMap,di=new WeakMap,ui=new WeakMap,nc=new WeakMap,ic=new WeakMap,sc=new WeakMap,Un=new WeakSet,Mi=function(t=u(this,sc)){let n=u(this,Ih)+t/2*u(this,nc);return u(this,ic)%180===0?[n/u(this,di),n/u(this,ui)]:[n/u(this,ui),n/u(this,di)]},gy=new WeakSet,_R=function(){let[t,n,s,r]=u(this,St),[o,a]=S(this,Un,Mi).call(this,0);return[t+o,n+a,s-2*o,r-2*a]},my=new WeakSet,CR=function(){let t=w(this,St,new Float32Array([1/0,1/0,-1/0,-1/0]));for(let{line:r}of u(this,Jt)){if(r.length<=12){for(let l=4,c=r.length;l<c;l+=6){let[d,h]=r.subarray(l,l+2);t[0]=Math.min(t[0],d),t[1]=Math.min(t[1],h),t[2]=Math.max(t[2],d),t[3]=Math.max(t[3],h)}continue}let o=r[4],a=r[5];for(let l=6,c=r.length;l<c;l+=6){let[d,h,p,m,y,v]=r.subarray(l,l+6);V.bezierBoundingBox(o,a,d,h,p,m,y,v,t),o=y,a=v}}let[n,s]=S(this,Un,Mi).call(this);t[0]=Math.min(1,Math.max(0,t[0]-n)),t[1]=Math.min(1,Math.max(0,t[1]-s)),t[2]=Math.min(1,Math.max(0,t[2]+n)),t[3]=Math.min(1,Math.max(0,t[3]+s)),t[2]-=t[0],t[3]-=t[1]},yy=new WeakSet,TR=function(t){let[n,s]=S(this,Un,Mi).call(this);w(this,sc,t);let[r,o]=S(this,Un,Mi).call(this),[a,l]=[r-n,o-s],c=u(this,St);return c[0]-=a,c[1]-=l,c[2]+=2*a,c[3]+=2*l,c};var Ug=VA,rc,GA=class GA extends mA{constructor(t){super();b(this,rc,void 0);w(this,rc,t),super.updateProperties({fill:"none",stroke:_e._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,n){t==="stroke-width"&&(n!=null||(n=this["stroke-width"]),n*=u(this,rc).realScale),super.updateSVGProperty(t,n)}clone(){let t=new GA(u(this,rc));return t.updateAll(this),t}};rc=new WeakMap;var AA=GA,vy,xR,Fa=class Fa extends yA{constructor(t){super({...t,name:"inkEditor"});b(this,vy);this._willKeepAspectRatio=!0}static initialize(t,n){_e.initialize(t,n),this._defaultDrawingOptions=new AA(n.viewParameters)}static getDefaultDrawingOptions(t){let n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return se(this,"typesMap",new Map([[oe.INK_THICKNESS,"stroke-width"],[oe.INK_COLOR,"stroke"],[oe.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,s,r,o){return new wA(t,n,s,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,s,r,o,a){return Ug.deserialize(t,n,s,r,o,a)}static async deserialize(t,n,s){let r=null;if(t instanceof Ad){let{data:{inkLists:a,rect:l,rotation:c,id:d,color:h,opacity:p,borderStyle:{rawWidth:m},popupRef:y},parent:{page:{pageNumber:v}}}=t;r=t={annotationType:j.INK,color:Array.from(h),thickness:m,opacity:p,paths:{points:a},boxes:null,pageIndex:v-1,rect:l.slice(0),rotation:c,id:d,deleted:!1,popupRef:y}}let o=await super.deserialize(t,n,s);return o.annotationElementId=t.id||null,o._initialData=r,o}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:t,_drawingOptions:n,parent:s}=this;n.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){let t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:s}){this._drawingOptions=Fa.getDefaultDrawingOptions({stroke:V.makeHexColor(...t),"stroke-width":n,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:n,points:s,rect:r}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":a,"stroke-width":l}}=this,c={annotationType:j.INK,color:_e._colorManager.convert(o),opacity:a,thickness:l,paths:{lines:n,points:s},pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?c:this.annotationElementId&&!S(this,vy,xR).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(t){let{points:n,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:n}),null}};vy=new WeakSet,xR=function(t){let{color:n,thickness:s,opacity:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((a,l)=>a!==n[l])||t.thickness!==s||t.opacity!==r||t.pageIndex!==o},W(Fa,"_type","ink"),W(Fa,"_editorType",j.INK),W(Fa,"_defaultDrawingOptions",null);var SA=Fa,Se,tt,js,rs,Qs,oc,hi,fi,Zt,ac,Vo,od,Go,ad,lc,rg,Dh,CA,cc,og,Ph,TA,dc,ag,by,RR,ud=class ud extends _e{constructor(t){super({...t,name:"stampEditor"});b(this,Vo);b(this,Go);b(this,lc);b(this,Dh);b(this,cc);b(this,Ph);b(this,dc);b(this,by);b(this,Se,null);b(this,tt,null);b(this,js,null);b(this,rs,null);b(this,Qs,null);b(this,oc,"");b(this,hi,null);b(this,fi,null);b(this,Zt,!1);b(this,ac,!1);w(this,rs,t.bitmapUrl),w(this,Qs,t.bitmapFile)}static initialize(t,n){_e.initialize(t,n)}static get supportedTypes(){return se(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(n=>`image/${n}`))}static get supportedTypesStr(){return se(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,n){n.pasteEditor(j.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){var s,r;let n=t.get("hasAltText");return{hasAltText:(s=n.get(!0))!=null?s:0,hasNoAltText:(r=n.get(!1))!=null?r:0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;let{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");let{data:r,width:o,height:a}=t||this.copyCanvas(null,null,!0).imageData,l=await s.guess({name:"altText",request:{data:r,width:o,height:a,channels:r.length/(o*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");let c=l.output;return await this.setGuessedAltText(c),n&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){var t;u(this,tt)&&(w(this,Se,null),this._uiManager.imageManager.deleteId(u(this,tt)),(t=u(this,hi))==null||t.remove(),w(this,hi,null),u(this,fi)&&(clearTimeout(u(this,fi)),w(this,fi,null))),super.remove()}rebuild(){if(!this.parent){u(this,tt)&&S(this,lc,rg).call(this);return}super.rebuild(),this.div!==null&&(u(this,tt)&&u(this,hi)===null&&S(this,lc,rg).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(u(this,js)||u(this,Se)||u(this,rs)||u(this,Qs)||u(this,tt))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;if(this.width&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),u(this,Se)?S(this,Dh,CA).call(this):S(this,lc,rg).call(this),this.width&&!this.annotationElementId){let[s,r]=this.parentDimensions;this.setAt(t*s,n*r,this.width*s,this.height*r)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;u(this,fi)!==null&&clearTimeout(u(this,fi)),w(this,fi,setTimeout(()=>{w(this,fi,null),S(this,Ph,TA).call(this)},200))}copyCanvas(t,n,s=!1){var m;t||(t=224);let{width:r,height:o}=u(this,Se),a=new gd,l=u(this,Se),c=r,d=o,h=null;if(n){if(r>n||o>n){let k=Math.min(n/r,n/o);c=Math.floor(r*k),d=Math.floor(o*k)}h=document.createElement("canvas");let y=h.width=Math.ceil(c*a.sx),v=h.height=Math.ceil(d*a.sy);u(this,Zt)||(l=S(this,cc,og).call(this,y,v));let E=h.getContext("2d");E.filter=this._uiManager.hcmFilter;let A="white",_="#cfcfd8";this._uiManager.hcmFilter!=="none"?_="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(A="#8f8f9d",_="#42414d");let C=15,T=C*a.sx,R=C*a.sy,I=new OffscreenCanvas(T*2,R*2),D=I.getContext("2d");D.fillStyle=A,D.fillRect(0,0,T*2,R*2),D.fillStyle=_,D.fillRect(0,0,T,R),D.fillRect(T,R,T,R),E.fillStyle=E.createPattern(I,"repeat"),E.fillRect(0,0,y,v),E.drawImage(l,0,0,l.width,l.height,0,0,y,v)}let p=null;if(s){let y,v;if(a.symmetric&&l.width<t&&l.height<t)y=l.width,v=l.height;else if(l=u(this,Se),r>t||o>t){let _=Math.min(t/r,t/o);y=Math.floor(r*_),v=Math.floor(o*_),u(this,Zt)||(l=S(this,cc,og).call(this,y,v))}let A=new OffscreenCanvas(y,v).getContext("2d",{willReadFrequently:!0});A.drawImage(l,0,0,l.width,l.height,0,0,y,v),p={width:y,height:v,data:A.getImageData(0,0,y,v).data}}return{canvas:h,width:c,height:d,imageData:p}}getImageForAltText(){return u(this,hi)}static async deserialize(t,n,s){var v;let r=null;if(t instanceof kg){let{data:{rect:E,rotation:A,id:_,structParent:C,popupRef:T},container:R,parent:{page:{pageNumber:I}}}=t,D=R.querySelector("canvas"),k=s.imageManager.getFromCanvas(R.id,D);D.remove();let N=((v=await n._structTree.getAriaAttributes(`${NA}${_}`))==null?void 0:v.get("aria-label"))||"";r=t={annotationType:j.STAMP,bitmapId:k.id,bitmap:k.bitmap,pageIndex:I-1,rect:E.slice(0),rotation:A,id:_,deleted:!1,accessibilityData:{decorative:!1,altText:N},isSvg:!1,structParent:C,popupRef:T}}let o=await super.deserialize(t,n,s),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:d,isSvg:h,accessibilityData:p}=t;d&&s.imageManager.isValidId(d)?(w(o,tt,d),l&&w(o,Se,l)):w(o,rs,c),w(o,Zt,h);let[m,y]=o.pageDimensions;return o.width=(a[2]-a[0])/m,o.height=(a[3]-a[1])/y,o.annotationElementId=t.id||null,p&&(o.altTextData=p),o._initialData=r,w(o,ac,!!r),o}serialize(t=!1,n=null){var l;if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let s={annotationType:j.STAMP,bitmapId:u(this,tt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:u(this,Zt),structTreeParentId:this._structTreeParentId};if(t)return s.bitmapUrl=S(this,dc,ag).call(this,!0),s.accessibilityData=this.serializeAltText(!0),s;let{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(s.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){let c=S(this,by,RR).call(this,s);if(c.isSame)return null;c.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=(l=this._initialData.structParent)!=null?l:-1}if(s.id=this.annotationElementId,n===null)return s;n.stamps||(n.stamps=new Map);let a=u(this,Zt)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!n.stamps.has(u(this,tt)))n.stamps.set(u(this,tt),{area:a,serialized:s}),s.bitmap=S(this,dc,ag).call(this,!1);else if(u(this,Zt)){let c=n.stamps.get(u(this,tt));a>c.area&&(c.area=a,c.serialized.bitmap.close(),c.serialized.bitmap=S(this,dc,ag).call(this,!1))}return s}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};Se=new WeakMap,tt=new WeakMap,js=new WeakMap,rs=new WeakMap,Qs=new WeakMap,oc=new WeakMap,hi=new WeakMap,fi=new WeakMap,Zt=new WeakMap,ac=new WeakMap,Vo=new WeakSet,od=function(t,n=!1){if(!t){this.remove();return}w(this,Se,t.bitmap),n||(w(this,tt,t.id),w(this,Zt,t.isSvg)),t.file&&w(this,oc,t.file.name),S(this,Dh,CA).call(this)},Go=new WeakSet,ad=function(){if(w(this,js,null),this._uiManager.enableWaiting(!1),!!u(this,hi)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,Se)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,Se)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch(t){}}this.div.focus()}},lc=new WeakSet,rg=function(){if(u(this,tt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(u(this,tt)).then(s=>S(this,Vo,od).call(this,s,!0)).finally(()=>S(this,Go,ad).call(this));return}if(u(this,rs)){let s=u(this,rs);w(this,rs,null),this._uiManager.enableWaiting(!0),w(this,js,this._uiManager.imageManager.getFromUrl(s).then(r=>S(this,Vo,od).call(this,r)).finally(()=>S(this,Go,ad).call(this)));return}if(u(this,Qs)){let s=u(this,Qs);w(this,Qs,null),this._uiManager.enableWaiting(!0),w(this,js,this._uiManager.imageManager.getFromFile(s).then(r=>S(this,Vo,od).call(this,r)).finally(()=>S(this,Go,ad).call(this)));return}let t=document.createElement("input");t.type="file",t.accept=ud.supportedTypesStr;let n=this._uiManager._signal;w(this,js,new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),S(this,Vo,od).call(this,r)}s()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:n})}).finally(()=>S(this,Go,ad).call(this))),t.click()},Dh=new WeakSet,CA=function(){var h;let{div:t}=this,{width:n,height:s}=u(this,Se),[r,o]=this.pageDimensions,a=.75;if(this.width)n=this.width*r,s=this.height*o;else if(n>a*r||s>a*o){let p=Math.min(a*r/n,a*o/s);n*=p,s*=p}let[l,c]=this.parentDimensions;this.setDims(n*l/r,s*c/o),this._uiManager.enableWaiting(!1);let d=w(this,hi,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=n/r,this.height=s/o,(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),S(this,Ph,TA).call(this),u(this,ac)||(this.parent.addUndoableEditor(this),w(this,ac,!0)),this._reportTelemetry({action:"inserted_image"}),u(this,oc)&&d.setAttribute("aria-label",u(this,oc))},cc=new WeakSet,og=function(t,n){let{width:s,height:r}=u(this,Se),o=s,a=r,l=u(this,Se);for(;o>2*t||a>2*n;){let c=o,d=a;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),a>2*n&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));let h=new OffscreenCanvas(o,a);h.getContext("2d").drawImage(l,0,0,c,d,0,0,o,a),l=h.transferToImageBitmap()}return l},Ph=new WeakSet,TA=function(){let[t,n]=this.parentDimensions,{width:s,height:r}=this,o=new gd,a=Math.ceil(s*t*o.sx),l=Math.ceil(r*n*o.sy),c=u(this,hi);if(!c||c.width===a&&c.height===l)return;c.width=a,c.height=l;let d=u(this,Zt)?u(this,Se):S(this,cc,og).call(this,a,l),h=c.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(d,0,0,d.width,d.height,0,0,a,l)},dc=new WeakSet,ag=function(t){if(t){if(u(this,Zt)){let r=this._uiManager.imageManager.getSvgUrl(u(this,tt));if(r)return r}let n=document.createElement("canvas");return{width:n.width,height:n.height}=u(this,Se),n.getContext("2d").drawImage(u(this,Se),0,0),n.toDataURL()}if(u(this,Zt)){let[n,s]=this.pageDimensions,r=Math.round(this.width*n*sr.PDF_TO_CSS_UNITS),o=Math.round(this.height*s*sr.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(r,o);return a.getContext("2d").drawImage(u(this,Se),0,0,u(this,Se).width,u(this,Se).height,0,0,r,o),a.transferToImageBitmap()}return structuredClone(u(this,Se))},by=new WeakSet,RR=function(t){var a;let{pageIndex:n,accessibilityData:{altText:s}}=this._initialData,r=t.pageIndex===n,o=(((a=t.accessibilityData)==null?void 0:a.alt)||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}},W(ud,"_type","stamp"),W(ud,"_editorType",j.STAMP);var _A=ud,$o,uc,pi,er,os,pn,tr,hc,zo,Hn,as,pt,ls,G,nr,Ey,IR,gn,Jn,Mh,RA,kh,IA,fc,lg,Cn=class Cn{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:s,accessibilityManager:r,annotationLayer:o,drawLayer:a,textLayer:l,viewport:c,l10n:d}){b(this,Ey);b(this,gn);b(this,Mh);b(this,kh);b(this,fc);b(this,$o,void 0);b(this,uc,!1);b(this,pi,null);b(this,er,null);b(this,os,null);b(this,pn,new Map);b(this,tr,!1);b(this,hc,!1);b(this,zo,!1);b(this,Hn,null);b(this,as,null);b(this,pt,null);b(this,ls,null);b(this,G,void 0);let h=[...u(Cn,nr).values()];if(!Cn._initialized){Cn._initialized=!0;for(let p of h)p.initialize(d,e)}e.registerEditorTypes(h),w(this,G,e),this.pageIndex=t,this.div=n,w(this,$o,r),w(this,pi,o),this.viewport=c,w(this,pt,l),this.drawLayer=a,this._structTree=s,u(this,G).addLayer(this)}get isEmpty(){return u(this,pn).size===0}get isInvisible(){return this.isEmpty&&u(this,G).getMode()===j.NONE}updateToolbar(e){u(this,G).updateToolbar(e)}updateMode(e=u(this,G).getMode()){switch(S(this,fc,lg).call(this),e){case j.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case j.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case j.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:t}=this.div;for(let n of u(Cn,nr).values())t.toggle(`${n._type}Editing`,e===n._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=u(this,pt))==null?void 0:t.div)}setEditingState(e){u(this,G).setEditingState(e)}addCommands(e){u(this,G).addCommands(e)}cleanUndoStack(e){u(this,G).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=u(this,pi))==null||t.div.classList.toggle("disabled",!e)}async enable(){w(this,zo,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);let e=new Set;for(let n of u(this,pn).values())n.enableEditing(),n.show(!0),n.annotationElementId&&(u(this,G).removeChangedExistingAnnotation(n),e.add(n.annotationElementId));if(!u(this,pi)){w(this,zo,!1);return}let t=u(this,pi).getEditableAnnotations();for(let n of t){if(n.hide(),u(this,G).isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;let s=await this.deserialize(n);s&&(this.addOrRebuild(s),s.enableEditing())}w(this,zo,!1)}disable(){var s;w(this,hc,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);let e=new Map,t=new Map;for(let r of u(this,pn).values())if(r.disableEditing(),!!r.annotationElementId){if(r.serialize()!==null){e.set(r.annotationElementId,r);continue}else t.set(r.annotationElementId,r);(s=this.getEditableAnnotation(r.annotationElementId))==null||s.show(),r.remove()}if(u(this,pi)){let r=u(this,pi).getEditableAnnotations();for(let o of r){let{id:a}=o.data;if(u(this,G).isDeletedAnnotationElement(a))continue;let l=t.get(a);if(l){l.resetAnnotationElement(o),l.show(!1),o.show();continue}l=e.get(a),l&&(u(this,G).addChangedExistingAnnotation(l),l.renderAnnotationElement(o)&&l.show(!1)),o.show()}}S(this,fc,lg).call(this),this.isEmpty&&(this.div.hidden=!0);let{classList:n}=this.div;for(let r of u(Cn,nr).values())n.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),w(this,hc,!1)}getEditableAnnotation(e){var t;return((t=u(this,pi))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){u(this,G).getActive()!==e&&u(this,G).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=u(this,pt))!=null&&e.div&&!u(this,ls)){w(this,ls,new AbortController);let t=u(this,G).combinedSignal(u(this,ls));u(this,pt).div.addEventListener("pointerdown",S(this,Ey,IR).bind(this),{signal:t}),u(this,pt).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=u(this,pt))!=null&&e.div&&u(this,ls)&&(u(this,ls).abort(),w(this,ls,null),u(this,pt).div.classList.remove("highlighting"))}enableClick(){if(u(this,er))return;w(this,er,new AbortController);let e=u(this,G).combinedSignal(u(this,er));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});let t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=u(this,er))==null||e.abort(),w(this,er,null)}attach(e){u(this,pn).set(e.id,e);let{annotationElementId:t}=e;t&&u(this,G).isDeletedAnnotationElement(t)&&u(this,G).removeDeletedAnnotationElement(e)}detach(e){var t;u(this,pn).delete(e.id),(t=u(this,$o))==null||t.removePointerInTextLayer(e.contentDiv),!u(this,hc)&&e.annotationElementId&&u(this,G).addDeletedAnnotationElement(e)}remove(e){this.detach(e),u(this,G).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(u(this,G).addDeletedAnnotationElement(e.annotationElementId),_e.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),u(this,G).addEditor(e),this.attach(e),!e.isAttachedToDOM){let t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!u(this,zo)),u(this,G).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var n;if(!e.isAttachedToDOM)return;let{activeElement:t}=document;e.div.contains(t)&&!u(this,os)&&(e._focusEventsAllowed=!1,w(this,os,setTimeout(()=>{w(this,os,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:u(this,G)._signal}),t.focus())},0))),e._structTreeParentId=(n=u(this,$o))==null?void 0:n.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){let t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getNextId(){return u(this,G).getId()}combinedSignal(e){return u(this,G).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=u(this,gn,Jn))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){u(this,G).updateToolbar(e),u(this,G).updateMode(e);let{offsetX:n,offsetY:s}=S(this,kh,IA).call(this),r=this.getNextId(),o=S(this,Mh,RA).call(this,{parent:this,id:r,x:n,y:s,uiManager:u(this,G),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t,n;return await((n=u(Cn,nr).get((t=e.annotationType)!=null?t:e.annotationEditorType))==null?void 0:n.deserialize(e,this,u(this,G)))||null}createAndAddNewEditor(e,t,n={}){let s=this.getNextId(),r=S(this,Mh,RA).call(this,{parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:u(this,G),isCentered:t,...n});return r&&this.add(r),r}addNewEditor(){this.createAndAddNewEditor(S(this,kh,IA).call(this),!0)}setSelected(e){u(this,G).setSelected(e)}toggleSelected(e){u(this,G).toggleSelected(e)}unselect(e){u(this,G).unselect(e)}pointerup(e){var n;let{isMac:t}=nt.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&u(this,tr)&&(w(this,tr,!1),!((n=u(this,gn,Jn))!=null&&n.isDrawer&&u(this,gn,Jn).supportMultipleDrawings))){if(!u(this,uc)){w(this,uc,!0);return}if(u(this,G).getMode()===j.STAMP){u(this,G).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var s;if(u(this,G).getMode()===j.HIGHLIGHT&&this.enableTextSelection(),u(this,tr)){w(this,tr,!1);return}let{isMac:t}=nt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(w(this,tr,!0),(s=u(this,gn,Jn))!=null&&s.isDrawer){this.startDrawingSession(e);return}let n=u(this,G).getActive();w(this,uc,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus(),u(this,Hn)){u(this,gn,Jn).startDrawing(this,u(this,G),!1,e);return}u(this,G).setCurrentDrawingSession(this),w(this,Hn,new AbortController);let t=u(this,G).combinedSignal(u(this,Hn));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(w(this,as,null),this.commitOrRemove())},{signal:t}),u(this,gn,Jn).startDrawing(this,u(this,G),!1,e)}pause(e){if(e){let{activeElement:t}=document;this.div.contains(t)&&w(this,as,t);return}u(this,as)&&setTimeout(()=>{var t;(t=u(this,as))==null||t.focus(),w(this,as,null)},0)}endDrawingSession(e=!1){return u(this,Hn)?(u(this,G).setCurrentDrawingSession(null),u(this,Hn).abort(),w(this,Hn,null),w(this,as,null),u(this,gn,Jn).endDrawing(e)):null}findNewParent(e,t,n){let s=u(this,G).findParent(t,n);return s===null||s===this?!1:(s.changeParent(e),!0)}commitOrRemove(){return u(this,Hn)?(this.endDrawingSession(),!0):!1}onScaleChanging(){u(this,Hn)&&u(this,gn,Jn).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=u(this,G).getActive())==null?void 0:e.parent)===this&&(u(this,G).commitOrRemove(),u(this,G).setActiveEditor(null)),u(this,os)&&(clearTimeout(u(this,os)),w(this,os,null));for(let n of u(this,pn).values())(t=u(this,$o))==null||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,u(this,pn).clear(),u(this,G).removeLayer(this)}render({viewport:e}){this.viewport=e,Yo(this.div,e);for(let t of u(this,G).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){u(this,G).commitOrRemove(),S(this,fc,lg).call(this);let t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,Yo(this.div,{rotation:n}),t!==n)for(let s of u(this,pn).values())s.rotate(n)}get pageDimensions(){let{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return u(this,G).viewParameters.realScale}};$o=new WeakMap,uc=new WeakMap,pi=new WeakMap,er=new WeakMap,os=new WeakMap,pn=new WeakMap,tr=new WeakMap,hc=new WeakMap,zo=new WeakMap,Hn=new WeakMap,as=new WeakMap,pt=new WeakMap,ls=new WeakMap,G=new WeakMap,nr=new WeakMap,Ey=new WeakSet,IR=function(e){u(this,G).unselectAll();let{target:t}=e;if(t===u(this,pt).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&u(this,pt).div.contains(t)){let{isMac:n}=nt.platform;if(e.button!==0||e.ctrlKey&&n)return;u(this,G).showAllEditors("highlight",!0,!0),u(this,pt).div.classList.add("free"),this.toggleDrawing(),Og.startHighlighting(this,u(this,G).direction==="ltr",{target:u(this,pt).div,x:e.x,y:e.y}),u(this,pt).div.addEventListener("pointerup",()=>{u(this,pt).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:u(this,G)._signal}),e.preventDefault()}},gn=new WeakSet,Jn=function(){return u(Cn,nr).get(u(this,G).getMode())},Mh=new WeakSet,RA=function(e){let t=u(this,gn,Jn);return t?new t.prototype.constructor(e):null},kh=new WeakSet,IA=function(){let{x:e,y:t,width:n,height:s}=this.div.getBoundingClientRect(),r=Math.max(0,e),o=Math.max(0,t),a=Math.min(window.innerWidth,e+n),l=Math.min(window.innerHeight,t+s),c=(r+a)/2-e,d=(o+l)/2-t,[h,p]=this.viewport.rotation%180===0?[c,d]:[d,c];return{offsetX:h,offsetY:p}},fc=new WeakSet,lg=function(){for(let e of u(this,pn).values())e.isEmpty()&&e.remove()},W(Cn,"_initialized",!1),b(Cn,nr,new Map([oA,SA,_A,Og].map(e=>[e._editorType,e])));var xA=Cn,Bn,Nh,_t,qo,wy,DR,Fh,PA,Ay,PR,Lh,MA,dt=class dt{constructor({pageIndex:e}){b(this,Fh);b(this,Ay);b(this,Lh);b(this,Bn,null);b(this,Nh,0);b(this,_t,new Map);b(this,qo,new Map);this.pageIndex=e}setParent(e){if(!u(this,Bn)){w(this,Bn,e);return}if(u(this,Bn)!==e){if(u(this,_t).size>0)for(let t of u(this,_t).values())t.remove(),e.append(t);w(this,Bn,e)}}static get _svgFactory(){return se(this,"_svgFactory",new Ed)}draw(e,t=!1,n=!1){let s=vt(this,Nh)._++,r=S(this,Fh,PA).call(this),o=dt._svgFactory.createElement("defs");r.append(o);let a=dt._svgFactory.createElement("path");o.append(a);let l=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&u(this,qo).set(s,a);let c=n?S(this,Ay,PR).call(this,o,l):null,d=dt._svgFactory.createElement("use");return r.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(r,e),u(this,_t).set(s,r),{id:s,clipPathId:`url(#${c})`}}drawOutline(e,t){let n=vt(this,Nh)._++,s=S(this,Fh,PA).call(this),r=dt._svgFactory.createElement("defs");s.append(r);let o=dt._svgFactory.createElement("path");r.append(o);let a=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){let h=dt._svgFactory.createElement("mask");r.append(h),l=`mask_p${this.pageIndex}_${n}`,h.setAttribute("id",l),h.setAttribute("maskUnits","objectBoundingBox");let p=dt._svgFactory.createElement("rect");h.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");let m=dt._svgFactory.createElement("use");h.append(m),m.setAttribute("href",`#${a}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}let c=dt._svgFactory.createElement("use");s.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);let d=c.cloneNode();return s.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(s,e),u(this,_t).set(n,s),n}finalizeDraw(e,t){u(this,qo).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;let{root:n,bbox:s,rootClass:r,path:o}=t,a=typeof e=="number"?u(this,_t).get(e):e;if(a){if(n&&S(this,Lh,MA).call(this,a,n),s&&S(l=dt,wy,DR).call(l,a,s),r){let{classList:c}=a;for(let[d,h]of Object.entries(r))c.toggle(d,h)}if(o){let d=a.firstChild.firstChild;S(this,Lh,MA).call(this,d,o)}}}updateParent(e,t){if(t===this)return;let n=u(this,_t).get(e);n&&(u(t,Bn).append(n),u(this,_t).delete(e),u(t,_t).set(e,n))}remove(e){u(this,qo).delete(e),u(this,Bn)!==null&&(u(this,_t).get(e).remove(),u(this,_t).delete(e))}destroy(){w(this,Bn,null);for(let e of u(this,_t).values())e.remove();u(this,_t).clear(),u(this,qo).clear()}};Bn=new WeakMap,Nh=new WeakMap,_t=new WeakMap,qo=new WeakMap,wy=new WeakSet,DR=function(e,[t,n,s,r]){let{style:o}=e;o.top=`${100*n}%`,o.left=`${100*t}%`,o.width=`${100*s}%`,o.height=`${100*r}%`},Fh=new WeakSet,PA=function(){let e=dt._svgFactory.create(1,1,!0);return u(this,Bn).append(e),e.setAttribute("aria-hidden",!0),e},Ay=new WeakSet,PR=function(e,t){let n=dt._svgFactory.createElement("clipPath");e.append(n);let s=`clip_${t}`;n.setAttribute("id",s),n.setAttribute("clipPathUnits","objectBoundingBox");let r=dt._svgFactory.createElement("use");return n.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),s},Lh=new WeakSet,MA=function(e,t){for(let[n,s]of Object.entries(t))s===null?e.removeAttribute(n):e.setAttribute(n,s)},b(dt,wy);var DA=dt;globalThis.pdfjsTestingUtils={HighlightOutliner:Sd};var u$=K.AbortException,h$=K.AnnotationEditorLayer,f$=K.AnnotationEditorParamsType,p$=K.AnnotationEditorType,g$=K.AnnotationEditorUIManager,m$=K.AnnotationLayer,y$=K.AnnotationMode,v$=K.ColorPicker,b$=K.DOMSVGFactory,E$=K.DrawLayer,w$=K.FeatureTest,MR=K.GlobalWorkerOptions,A$=K.ImageKind,S$=K.InvalidPDFException,_$=K.MissingPDFException,C$=K.OPS,T$=K.OutputScale,x$=K.PDFDataRangeTransport,R$=K.PDFDateString,I$=K.PDFWorker,D$=K.PasswordResponses,P$=K.PermissionFlag,M$=K.PixelsPerInch,k$=K.RenderingCancelledException,N$=K.TextLayer,F$=K.TouchManager,L$=K.UnexpectedResponseException,O$=K.Util,U$=K.VerbosityLevel,H$=K.XfaLayer,B$=K.build,V$=K.createValidAbsoluteUrl,G$=K.fetchData,Py=K.getDocument,$$=K.getFilenameFromUrl,z$=K.getPdfFilenameFromUrl,q$=K.getXfaPageViewport,W$=K.isDataScheme,Y$=K.isPdfFile,K$=K.noContextMenu,X$=K.normalizeUnicode,J$=K.setLayerDimensions,Z$=K.shadow,j$=K.stopEvent,Q$=K.version;MR.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.mjs";var My=class{constructor(e=50){this.minTextThreshold=e}async extractText(e){let t=await Py({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,n="";for(let o=1;o<=t.numPages;o++){let c=(await(await t.getPage(o)).getTextContent()).items.map(d=>d.str||"").join(" ");n+=`
## \uD398\uC774\uC9C0 ${o}

${c}
`}let r=n.replace(/\s/g,"").length/t.numPages<this.minTextThreshold;return{text:n,isScanned:r,numPages:t.numPages}}async renderPagesToImages(e,t){let n=await Py({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,s=[],r=t?Math.min(n.numPages,t):n.numPages;for(let o=1;o<=r;o++){let a=await n.getPage(o),l=a.getViewport({scale:2}),c=document.createElement("canvas");c.width=l.width,c.height=l.height;let d=c.getContext("2d");await a.render({canvasContext:d,viewport:l}).promise;let h=c.toDataURL("image/png").split(",")[1];s.push({base64:h,mimeType:"image/png",pageNum:o})}return s}async getPageCount(e){return(await Py({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise).numPages}};var ky=class{constructor(e,t,n){this.gemini=e,this.settings=t,this.vault=n,this.pdfProcessor=new My(t.ocrMinTextThreshold),this.dailyUsage=this.loadDailyUsage()}loadDailyUsage(){return{date:Yn(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}saveDailyUsage(){}checkDailyLimit(e){let t=Yn(this.settings.timezone);this.dailyUsage.date!==t&&(this.dailyUsage={date:t,pagesProcessed:0,filesProcessed:0});let n=this.settings.ocrDailyLimit-this.dailyUsage.pagesProcessed;return{allowed:e<=n,remaining:n}}getFileSizeMB(e){return e.stat.size/(1024*1024)}async checkLimits(e){let t=this.getFileSizeMB(e);if(t>this.settings.ocrMaxFileSizeMB)return{allowed:!1,reason:`\uD30C\uC77C \uD06C\uAE30(${t.toFixed(1)}MB)\uAC00 \uC81C\uD55C(${this.settings.ocrMaxFileSizeMB}MB)\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,fileSize:t};if(e.extension==="pdf"){let s=await this.vault.readBinary(e),r=await this.pdfProcessor.getPageCount(s);if(r>this.settings.ocrMaxPages)return{allowed:!1,reason:`\uD398\uC774\uC9C0 \uC218(${r})\uAC00 \uC81C\uD55C(${this.settings.ocrMaxPages})\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,pageCount:r,fileSize:t};let o=this.checkDailyLimit(r);return o.allowed?{allowed:!0,pageCount:r,fileSize:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${o.remaining})`,pageCount:r,fileSize:t}}let n=this.checkDailyLimit(1);return n.allowed?{allowed:!0,pageCount:1,fileSize:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${n.remaining})`,pageCount:1,fileSize:t}}async processImage(e){let t=await this.vault.readBinary(e),n=this.arrayBufferToBase64(t),s=this.getMimeType(e.extension),r=await this.gemini.extractTextFromImage(n,s);return this.dailyUsage.pagesProcessed+=1,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:r,pages:1,sourceType:"image",sourceFile:e.name}}async processPDF(e,t=!1,n){let s=await this.vault.readBinary(e),r=n||this.settings.ocrMaxPages,o=await this.pdfProcessor.extractText(s);if(!o.isScanned&&!t)return{text:o.text,pages:o.numPages,sourceType:"pdf_text",sourceFile:e.name};let a=Math.min(o.numPages,r);new $A.Notice(`\uC2A4\uCE94 PDF \uAC10\uC9C0\uB428. OCR \uCC98\uB9AC \uC911... (${a}\uD398\uC774\uC9C0)`);let l=await this.pdfProcessor.renderPagesToImages(s,r),c=await this.gemini.extractTextFromImages(l,(h,p)=>{new $A.Notice(`OCR \uC9C4\uD589 \uC911: ${h}/${p} \uD398\uC774\uC9C0`,1500)}),d="";for(let h=0;h<c.length;h++)d+=`
## \uD398\uC774\uC9C0 ${h+1}

${c[h]}
`;return this.dailyUsage.pagesProcessed+=c.length,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:d,pages:c.length,sourceType:"pdf_scanned",sourceFile:e.name}}async processFile(e,t){let n=e.extension.toLowerCase();if(["png","jpg","jpeg","webp","gif"].includes(n))return this.processImage(e);if(n==="pdf")return this.processPDF(e,!1,t);throw new Error(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD: ${n}`)}generateMarkdownNote(e){let t=Oe(this.settings.timezone,this.settings.dateFormat),n={image:"\uC774\uBBF8\uC9C0",pdf_text:"PDF (\uD14D\uC2A4\uD2B8)",pdf_scanned:"PDF (\uC2A4\uCE94/OCR)"}[e.sourceType];return`---
type: ocr
source_file: "${e.sourceFile}"
source_type: ${e.sourceType}
pages: ${e.pages}
ocr_at: ${t}
---

# OCR: ${e.sourceFile.replace(/\.[^.]+$/,"")}

> \uC6D0\uBCF8: ${e.sourceFile} | \uCC98\uB9AC \uBC29\uC2DD: ${n} | ${e.pages}\uD398\uC774\uC9C0

${e.text}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}generateSummarizedNote(e,t){let n=Oe(this.settings.timezone,this.settings.dateFormat);return`---
type: ocr
source_file: "${e.sourceFile}"
source_type: ${e.sourceType}
title: "${t.title}"
pages: ${e.pages}
ocr_at: ${n}
---

# ${t.title}

## \uC694\uC57D
${t.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${t.keyPoints.map(s=>`- ${s}`).join(`
`)}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}arrayBufferToBase64(e){let t="",n=new Uint8Array(e);for(let s=0;s<n.byteLength;s++)t+=String.fromCharCode(n[s]);return btoa(t)}getMimeType(e){return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/webp",gif:"image/gif"}[e.toLowerCase()]||"image/png"}getDailyUsage(){return{...this.dailyUsage}}};var Ny=class{constructor(e,t,n){this.embeddingManager=null;this.index=new Map;this.app=e,this.gemini=t,this.settings=n}setEmbeddingManager(e){this.embeddingManager=e}updateSettings(e){this.settings=e}async buildIndex(){this.index.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e)try{let n=await this.indexNote(t);n&&this.index.set(t.path,n)}catch(n){console.error(`\uC778\uB371\uC2F1 \uC2E4\uD328: ${t.path}`,n)}console.log(`\uC778\uB371\uC2A4 \uAD6C\uCD95 \uC644\uB8CC: ${this.index.size}\uAC1C \uB178\uD2B8`)}async indexNote(e){let t=this.app.metadataCache.getFileCache(e),n=t==null?void 0:t.frontmatter,s=[];n!=null&&n.keywords&&(s=Array.isArray(n.keywords)?n.keywords:[n.keywords]);let r;if(n!=null&&n.targetType){let l=n.targetType;["project","library","archive"].includes(l)&&(r=l)}let o=(n==null?void 0:n.title)||e.basename,a=n==null?void 0:n.type;return{path:e.path,title:o,keywords:s,category:r,project:n==null?void 0:n.project,type:a}}async updateIndex(e){let t=await this.indexNote(e);t&&this.index.set(e.path,t)}removeFromIndex(e){this.index.delete(e)}async findRelated(e,t,n){if(this.settings.embeddingEnabled&&this.embeddingManager)try{let s=await this.findRelatedByEmbedding(e,t,n);if(s.length>0)return s}catch(s){console.error("Embedding \uAE30\uBC18 \uAC80\uC0C9 \uC2E4\uD328, \uD0A4\uC6CC\uB4DC \uBC29\uC2DD\uC73C\uB85C \uD3F4\uBC31:",s)}return this.findRelatedByKeywords(e,t,n)}async findRelatedByEmbedding(e,t,n){if(!this.embeddingManager)return[];let s=await this.gemini.generateEmbedding(e);if(s.length===0)return[];let r=this.embeddingManager.findSimilarNotes(s,10,n);if(r.length===0)return[];let o=[];for(let a of r){let l=this.index.get(a.path);l&&o.push({note:l,relevance:a.similarity,matchedKeywords:[],reason:`\uC758\uBBF8 \uC720\uC0AC\uB3C4: ${Math.round(a.similarity*100)}%`,connectionType:""})}return o}async findRelatedByKeywords(e,t,n){let s=await this.gemini.extractKeywords(e);if(s.length===0)return[];let r=this.filterByKeywords(s,n);if(r.length===0)return[];let o=r.map((c,d)=>`${d}. ${c.note.title} (\uD0A4\uC6CC\uB4DC: ${c.note.keywords.join(", ")})`).join(`
`),a=await this.gemini.findRelatedNotes(t,s,o),l=[];for(let c of a)if(c.index>=0&&c.index<r.length){let d=r[c.index];l.push({note:d.note,relevance:c.relevance,matchedKeywords:d.matchedKeywords,reason:c.reason||"",connectionType:c.type||""})}return l}filterByKeywords(e,t){let n=[],s=new Set(e.map(r=>r.toLowerCase()));for(let[r,o]of this.index){if(t&&r===t||o.keywords.length===0)continue;let a=[];for(let l of o.keywords){let c=l.toLowerCase();for(let d of s)if(c===d||c.includes(d)||d.includes(c)){a.push(l);break}}a.length>0&&n.push({note:o,matchedKeywords:a})}return n.sort((r,o)=>o.matchedKeywords.length-r.matchedKeywords.length),n.slice(0,10)}async saveKeywordsToNote(e,t){let n=await this.app.vault.read(e),s=this.updateFrontmatterKeywords(n,t);await this.app.vault.modify(e,s),await this.updateIndex(e)}updateFrontmatterKeywords(e,t){let n=`keywords: [${t.map(r=>`"${r}"`).join(", ")}]`,s=e.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(s){let r=s[1];if(/^keywords:/m.test(r)){let o=r.replace(/^keywords:.*$/m,n);return e.replace(/^---\r?\n[\s\S]*?\r?\n---/,`---
${o}
---`)}else return e.replace(/^---\r?\n([\s\S]*?)\r?\n---/,`---
$1
${n}
---`)}else return`---
${n}
---

${e}`}async addRelatedLinks(e,t){if(t.length===0)return;let n=await this.app.vault.read(e),s=`

---
## \uAD00\uB828 \uB178\uD2B8
${t.map(a=>{let l=a.note.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]] (\uAD00\uB828\uB3C4: ${Math.round(a.relevance*100)}%)`}).join(`
`)}
`,r=/\n---\n##  \n[\s\S]*?(?=\n---\n|$)/,o;r.test(n)?o=n.replace(r,s):o=n+s,await this.app.vault.modify(e,o)}getIndexSize(){return this.index.size}getZettelIndex(){let e=new Map;for(let[t,n]of this.index)n.type==="zettel"&&e.set(t,n);return e}getZettelCount(){return this.getZettelIndex().size}async findRelatedZettels(e,t){if(e.length===0)return[];let n=this.getZettelIndex();if(n.size===0)return[];let s=this.filterZettelsByKeywords(e,n,t);if(s.length===0)return[];let r=s.map((l,c)=>`${c}. ${l.note.title} (\uD0A4\uC6CC\uB4DC: ${l.note.keywords.join(", ")})`).join(`
`),o=await this.gemini.findRelatedNotes("\uC0C8 ZK \uB178\uD2B8",e,r),a=[];for(let l of o)if(l.index>=0&&l.index<s.length){let c=s[l.index];a.push({note:c.note,relevance:l.relevance,matchedKeywords:c.matchedKeywords,reason:l.reason||"",connectionType:l.type||""})}return a}filterZettelsByKeywords(e,t,n){let s=[],r=new Set(e.map(o=>o.toLowerCase()));for(let[o,a]of t){if(n&&o===n||a.keywords.length===0)continue;let l=[];for(let c of a.keywords){let d=c.toLowerCase();for(let h of r)if(d===h||d.includes(h)||h.includes(d)){l.push(c);break}}l.length>0&&s.push({note:a,matchedKeywords:l})}return s.sort((o,a)=>a.matchedKeywords.length-o.matchedKeywords.length),s.slice(0,10)}};var kR=require("obsidian"),Fy={version:1,model:"text-embedding-004",dimensions:768,lastFullScan:"",notes:{}},Ly=class{constructor(e,t,n){this.isInitialized=!1;this.app=e,this.gemini=t,this.settings=n,this.index={...Fy},this.indexPath=".obsidian/plugins/zero-friction-brain/embeddings.json"}async loadIndex(){try{let e=this.app.vault.adapter;if(await e.exists(this.indexPath)){let t=await e.read(this.indexPath),n=JSON.parse(t);this.index={...Fy,...n}}this.isInitialized=!0}catch(e){console.error("Embedding \uC778\uB371\uC2A4 \uB85C\uB4DC \uC2E4\uD328:",e),this.index={...Fy},this.isInitialized=!0}}async saveIndex(){try{let e=this.app.vault.adapter,t=JSON.stringify(this.index,null,2);await e.write(this.indexPath,t)}catch(e){console.error("Embedding \uC778\uB371\uC2A4 \uC800\uC7A5 \uC2E4\uD328:",e)}}computeContentHash(e){let t=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);t=(t<<5)-t+s,t|=0}return t.toString(16)}async updateNoteEmbedding(e,t=!1){if(!this.settings.embeddingEnabled)return!1;try{let n=await this.app.vault.cachedRead(e),s=this.computeContentHash(n),r=this.index.notes[e.path];if(!t&&r&&r.contentHash===s)return!1;let o=await this.gemini.generateEmbedding(n);return o.length===0?(console.warn("\uC784\uBCA0\uB529 \uC0DD\uC131 \uC2E4\uD328:",e.path),!1):(this.index.notes[e.path]={embedding:o,contentHash:s,updatedAt:new Date().toISOString()},!0)}catch(n){return console.error("\uB178\uD2B8 \uC784\uBCA0\uB529 \uC5C5\uB370\uC774\uD2B8 \uC2E4\uD328:",e.path,n),!1}}removeNote(e){this.index.notes[e]&&delete this.index.notes[e]}renameNote(e,t){this.index.notes[e]&&(this.index.notes[t]=this.index.notes[e],delete this.index.notes[e])}cosineSimilarity(e,t){if(e.length!==t.length||e.length===0)return 0;let n=0,s=0,r=0;for(let a=0;a<e.length;a++)n+=e[a]*t[a],s+=e[a]*e[a],r+=t[a]*t[a];let o=Math.sqrt(s)*Math.sqrt(r);return o===0?0:n/o}findSimilarNotes(e,t=10,n,s){if(e.length===0)return[];let r=s!=null?s:this.settings.embeddingSimilarityThreshold,o=[];for(let[a,l]of Object.entries(this.index.notes)){if(a===n||!l.embedding||l.embedding.length===0)continue;let c=this.cosineSimilarity(e,l.embedding);c>=r&&o.push({path:a,similarity:c})}return o.sort((a,l)=>l.similarity-a.similarity).slice(0,t)}async findSimilarNotesByText(e,t=10,n){if(!this.settings.embeddingEnabled)return[];try{let s=await this.gemini.generateEmbedding(e);return this.findSimilarNotes(s,t,n)}catch(s){return console.error("\uD14D\uC2A4\uD2B8 \uAE30\uBC18 \uC720\uC0AC \uB178\uD2B8 \uAC80\uC0C9 \uC2E4\uD328:",s),[]}}getEmbedding(e){var t;return(t=this.index.notes[e])==null?void 0:t.embedding}hasEmbedding(e){var t;return!!((t=this.index.notes[e])!=null&&t.embedding)}getStats(){return{totalNotes:Object.keys(this.index.notes).length,lastFullScan:this.index.lastFullScan,model:this.index.model,dimensions:this.index.dimensions}}async buildFullIndex(e){if(!this.settings.embeddingEnabled)return{success:0,failed:0,skipped:0};let t=this.app.vault.getMarkdownFiles(),n=0,s=0,r=0;for(let o=0;o<t.length;o++){let a=t[o];e&&e(o+1,t.length,a.path);try{await this.updateNoteEmbedding(a,!1)?n++:r++}catch(l){s++}(o+1)%10===0&&await this.saveIndex()}return this.index.lastFullScan=new Date().toISOString(),await this.saveIndex(),{success:n,failed:s,skipped:r}}async buildFolderIndex(e,t){if(!this.settings.embeddingEnabled)return{success:0,failed:0};let n=this.app.vault.getMarkdownFiles().filter(o=>o.path.startsWith(e)),s=0,r=0;for(let o=0;o<n.length;o++){let a=n[o];t&&t(o+1,n.length);try{await this.updateNoteEmbedding(a,!0),s++}catch(l){r++}}return await this.saveIndex(),{success:s,failed:r}}mergeWithNoteIndex(e){let t=this.index.notes[e.path];return t?{...e,embedding:t.embedding,embeddingUpdatedAt:t.updatedAt,contentHash:t.contentHash}:e}async clearIndex(){this.index={...Fy},await this.saveIndex()}async cleanupOrphanedEmbeddings(){let e=[];for(let t of Object.keys(this.index.notes)){let n=this.app.vault.getAbstractFileByPath(t);(!n||!(n instanceof kR.TFile))&&e.push(t)}for(let t of e)delete this.index.notes[t];return e.length>0&&await this.saveIndex(),e.length}};var gc=require("obsidian");function NR(i,e=100){return i.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,e)}var Oy=class{constructor(e,t,n,s){this.projectMOCs=new Map;this.app=e,this.gemini=t,this.projectsFolder=n,this.settings=s}async scanProjectMOCs(){this.projectMOCs.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e){let n=await this.parseProjectMOC(t);n&&this.projectMOCs.set(n.project,n)}console.log(`\uD504\uB85C\uC81D\uD2B8 MOC \uC2A4\uCE94 \uC644\uB8CC: ${this.projectMOCs.size}\uAC1C`)}async parseProjectMOC(e){let t=this.app.metadataCache.getFileCache(e),n=t==null?void 0:t.frontmatter;if(!n||n.type!=="project-moc")return null;let s=n.project||e.basename,r=n.title||e.basename;return{path:e.path,title:r,project:s}}getProjectList(){let e=this.app.vault.getAbstractFileByPath(this.projectsFolder);return e instanceof gc.TFolder?e.children.filter(t=>t instanceof gc.TFolder).map(t=>t.name):[]}getMOCCount(){return this.projectMOCs.size}async detectProject(e,t){let n=this.getProjectList();return n.length===0?null:await this.gemini.detectProject(e,t,n)}async addNoteToMOC(e,t,n){let s=this.projectMOCs.get(e);if(!s)return!1;let r=this.app.vault.getAbstractFileByPath(s.path);if(!(r instanceof gc.TFile))return!1;let o=await this.app.vault.read(r),a=this.app.vault.getAbstractFileByPath(n),c=`[[${a instanceof gc.TFile?a.basename:NR(t)}]]`;if(o.includes(c))return!0;let d=/^##  \s*$/m,h;return d.test(o)?h=o.replace(/^(##  \s*\n)/m,`$1- ${c}
`):h=o.trimEnd()+`

## \uAD00\uB828 \uB178\uD2B8
- ${c}
`,await this.app.vault.modify(r,h),!0}async createProjectMOC(e,t){this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);let s=NR(e),r=`${t}/${s} MOC.md`;if(this.app.vault.getAbstractFileByPath(r))return null;let a=`---
type: project-moc
project: "${e}"
title: "${e} \uD504\uB85C\uC81D\uD2B8"
created: ${Oe(this.settings.timezone,this.settings.dateFormat)}
---

# ${e} \uD504\uB85C\uC81D\uD2B8

## \uAC1C\uC694


## \uC9C4\uD589 \uC911


## \uAD00\uB828 \uB178\uD2B8

`,l=await this.app.vault.create(r,a);return this.projectMOCs.set(e,{path:l.path,title:`${e} \uD504\uB85C\uC81D\uD2B8`,project:e}),l}hasProject(e){return this.projectMOCs.has(e)}getProjectMOCPath(e){let t=this.projectMOCs.get(e);return(t==null?void 0:t.path)||null}removeFromIndex(e){for(let[t,n]of this.projectMOCs)if(n.path===e){this.projectMOCs.delete(t);break}}};var zA=require("obsidian");var Uy=class{constructor(e,t,n,s,r){this.app=e,this.relatedNoteFinder=t,this.zettelFolder=n,this.settings=s,this.gemini=r||null}get indexPath(){return`${this.zettelFolder}/ZK Index.md`}async updateIndex(e,t){let n=this.app.vault.getAbstractFileByPath(this.indexPath);n instanceof zA.TFile?await this.addNoteToIndex(n,e,t):await this.createIndex(e,t)}async createIndex(e,t){let n=Oe(this.settings.timezone,this.settings.dateFormat),s=t[0]||"\uAE30\uD0C0",r=`---
type: zk-index
updated: ${n}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
- [[${e.basename}]]

## \uC8FC\uC81C\uBCC4
### ${s}
- [[${e.basename}]]
`;await this.app.vault.create(this.indexPath,r)}async addNoteToIndex(e,t,n){let s=await this.app.vault.read(e);s=this.updateRecentSection(s,t);let r=n[0]||"\uAE30\uD0C0";s=this.updateTopicSection(s,t,r),s=this.updateTimestamp(s),await this.app.vault.modify(e,s)}updateRecentSection(e,t){let n=/(##  \n)([\s\S]*?)(\n## |\n*$)/,s=e.match(n);if(s){let r=s[2].trim().split(`
`).filter(a=>a.startsWith("- ")),o=`- [[${t.basename}]]`;return r=r.filter(a=>!a.includes(t.basename)),r.unshift(o),r=r.slice(0,10),e.replace(n,`$1${r.join(`
`)}

$3`)}return e}updateTopicSection(e,t,n){let s=`### ${n}`,r=`- [[${t.basename}]]`;if(e.includes(s)){let o=new RegExp(`(### ${this.escapeRegex(n)}
)((?:- \\[\\[.*?\\]\\]
?)*)`),a=e.match(o);if(a)return a[2].includes(t.basename)?e:e.replace(o,`$1$2${r}
`)}else{let o=/(## \n)/;if(o.test(e))return e.replace(o,`$1${s}
${r}

`)}return e}updateTimestamp(e){let t=Oe(this.settings.timezone,this.settings.dateFormat);return e.replace(/^(---\n[\s\S]*?updated: ).*?(\n[\s\S]*?---)/,`$1${t}$2`)}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}async rebuildIndex(){let e=this.relatedNoteFinder.getZettelIndex();if(e.size===0)return;let t=new Map,n=[];for(let[,a]of e){let l=a.keywords[0]||"\uAE30\uD0C0";t.has(l)||t.set(l,[]),t.get(l).push(a);let c=a.path.match(/(\d{13})/),d=a.path.match(/(\d{8})-\d{3}/),h;if(c)h=new Date(parseInt(c[1]));else if(d){let p=d[1];h=new Date(parseInt(p.slice(0,4)),parseInt(p.slice(4,6))-1,parseInt(p.slice(6,8)))}else h=new Date;n.push({note:a,created:h})}n.sort((a,l)=>l.created.getTime()-a.created.getTime());let r=`---
type: zk-index
updated: ${Oe(this.settings.timezone,this.settings.dateFormat)}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
${n.slice(0,10).map(({note:a})=>{let l=a.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]]`}).join(`
`)}

## \uC8FC\uC81C\uBCC4
`;for(let[a,l]of t){let c=null;if(this.gemini&&l.length>=2)try{let d=l.map(h=>`- ${h.title} (\uD0A4\uC6CC\uB4DC: ${h.keywords.join(", ")})`).join(`
`);c=await this.gemini.generateTopicStructure(a,d)}catch(d){console.error(`\uC8FC\uC81C \uAD6C\uC870 \uC0DD\uC131 \uC2E4\uD328: ${a}`,d)}r+=`### ${a}
`,c!=null&&c.description&&(r+=`${c.description}

`),r+=`**\uD575\uC2EC \uB178\uD2B8:**
`;for(let d of l){let h=d.path.split("/"),p=h[h.length-1].replace(/\.md$/,""),m=c==null?void 0:c.notes.find(v=>v.title===d.title),y=m!=null&&m.role?` - ${m.role}`:"";if(r+=`- [[${p}]]${y}
`,m!=null&&m.relations&&m.relations.length>0)for(let v of m.relations){let E=v.type==="\uBC1C\uC804"?"\u2192":v.type==="\uAE30\uBC18"?"\u2190":"\u2194";r+=`  ${E} ${v.target}
`}}c!=null&&c.relatedTopics&&c.relatedTopics.length>0&&(r+=`
**\uAD00\uB828 \uC8FC\uC81C:** ${c.relatedTopics.join(", ")}
`),r+=`
`}let o=this.app.vault.getAbstractFileByPath(this.indexPath);o instanceof zA.TFile&&await this.app.vault.delete(o),await this.app.vault.create(this.indexPath,r)}};var mc=require("obsidian");var Hy=class{constructor(e,t,n){this.app=e,this.gemini=t,this.settings=n}async collectNotes(e){let t=e.customRange||Uc(e.period,this.settings.timezone),n=this.app.vault.getMarkdownFiles(),s=[];for(let r of n){if(this.shouldExclude(r,e))continue;let o=this.getProjectFromPath(r.path);if(e.projectFilter&&o!==e.projectFilter)continue;let a=await this.getNoteDate(r);if(!mC(a,t))continue;let l=await this.extractNoteInfo(r,o,a);s.push(l)}return s.sort((r,o)=>o.modified.getTime()-r.modified.getTime()),s}getBasename(e){let t=e.lastIndexOf("/");return(t>=0?e.substring(t+1):e).replace(/\.md$/,"")}shouldExclude(e,t){let n=[this.settings.archivesFolder,this.settings.zettelFolder],s=t.excludeFolders||n;for(let r of s)if(e.path.startsWith(r))return!0;return!!e.basename.includes("\uD68C\uACE0")}getProjectFromPath(e){let t=this.settings.projectsFolder+"/";if(e.startsWith(t)){let n=e.substring(t.length),s=n.indexOf("/");return s>0?n.substring(0,s):void 0}if(e.startsWith(this.settings.libraryFolder))return"Library";if(e.startsWith(this.settings.inboxFolder))return"Inbox"}async getNoteDate(e){let t=this.app.metadataCache.getFileCache(e),n=t==null?void 0:t.frontmatter;if(n!=null&&n.created){let s=new Date(n.created);if(!isNaN(s.getTime()))return s}return new Date(e.stat.mtime)}async extractNoteInfo(e,t,n){let s=this.app.metadataCache.getFileCache(e),r=s==null?void 0:s.frontmatter,o=[];return r!=null&&r.tags&&(Array.isArray(r.tags)?o.push(...r.tags):o.push(r.tags)),{path:e.path,title:(r==null?void 0:r.title)||e.basename,project:t,created:n,modified:new Date(e.stat.mtime),summary:r==null?void 0:r.summary,tags:o,type:r==null?void 0:r.type}}groupByProject(e){let t=new Map;for(let s of e){let r=s.project||"\uAE30\uD0C0";t.has(r)||t.set(r,[]),t.get(r).push(s)}let n=[];for(let[s,r]of t)n.push({projectName:s,notes:r,noteCount:r.length});return n.sort((s,r)=>r.noteCount-s.noteCount),n}async analyze(e){let t=e.customRange||Uc(e.period,this.settings.timezone),n=await this.collectNotes(e),s=this.groupByProject(n),r=n.filter(a=>a.type==="zettel").length,o=await this.gemini.analyzeReview(e.period,t,s);return{period:e.period,dateRange:t,totalNotes:n.length,newZKNotes:r,projectGroups:s,analysis:o}}async createReviewNote(e){let t=yC(e.period,new Date,this.settings.timezone),n=`${this.settings.archivesFolder}/Reviews`;await this.ensureFolder(n);let s=`${n}/${t}`,r=this.generateReviewContent(e),o=this.app.vault.getAbstractFileByPath(s);return o instanceof mc.TFile?(await this.app.vault.modify(o,r),o):await this.app.vault.create(s,r)}async ensureFolder(e){this.app.vault.getAbstractFileByPath(e)instanceof mc.TFolder||await this.app.vault.createFolder(e)}generateReviewContent(e){let t=new Date,n=ib(t,this.settings.timezone,this.settings.dateFormat),s=`${Le(e.dateRange.start,this.settings.timezone)} ~ ${Le(e.dateRange.end,this.settings.timezone)}`,r;switch(e.period){case"today":r=`${Le(t,this.settings.timezone)} \uC77C\uC77C \uD68C\uACE0`;break;case"week":let l=ob(t);r=`${t.getFullYear()}\uB144 ${l}\uC8FC\uCC28 \uC8FC\uAC04 \uD68C\uACE0`;break;case"month":r=`${t.getFullYear()}\uB144 ${t.getMonth()+1}\uC6D4 \uC6D4\uAC04 \uD68C\uACE0`;break;default:r=`${s} \uD68C\uACE0`}let o=e.projectGroups.map(l=>{let c=l.notes.map(d=>`- [[${this.getBasename(d.path)}]]${d.summary?` - ${d.summary}`:""}`).join(`
`);return`### ${l.projectName} (${l.noteCount}\uAC1C)
${c}`}).join(`

`),a="";if(e.analysis){let{summary:l,mainTopics:c,insights:d,nextActions:h,patterns:p}=e.analysis;a=`
## \uBD84\uC11D \uACB0\uACFC

### \uC694\uC57D
${l}

### \uC8FC\uC694 \uC8FC\uC81C
${c.map(m=>`- ${m}`).join(`
`)}

### \uC778\uC0AC\uC774\uD2B8
${d.map(m=>`- ${m}`).join(`
`)}

### \uB2E4\uC74C \uC561\uC158
${h.map(m=>`- [ ] ${m}`).join(`
`)}
${p?`
### \uC791\uC5C5 \uD328\uD134
${p}`:""}`}return`---
type: review
period: ${e.period}
date_range: ${s}
created: ${n}
tags: [review, ${e.period==="today"?"daily":e.period==="week"?"weekly":"monthly"}]
---

# ${r}

## \uD1B5\uACC4
- \uC791\uC5C5\uD55C \uB178\uD2B8: ${e.totalNotes}\uAC1C
- \uC0C8 ZK \uB178\uD2B8: ${e.newZKNotes}\uAC1C
- \uD65C\uC131 \uD504\uB85C\uC81D\uD2B8: ${e.projectGroups.filter(l=>l.projectName!=="\uAE30\uD0C0"&&l.projectName!=="Library"&&l.projectName!=="Inbox").length}\uAC1C

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5

${o}
${a}
`}getProjectList(){let e=new Set,t=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(t instanceof mc.TFolder)for(let n of t.children)n instanceof mc.TFolder&&e.add(n.name);return Array.from(e).sort()}};var qA=["mp3","wav","m4a","aac","ogg","flac","webm"],nU=2*1024*1024*1024,By=class{constructor(e,t,n){this.app=e,this.gemini=t,this.settings=n}isAudioFile(e){return qA.includes(e.extension.toLowerCase())}getMimeType(e){return{mp3:"audio/mp3",wav:"audio/wav",m4a:"audio/m4a",aac:"audio/aac",ogg:"audio/ogg",flac:"audio/flac",webm:"audio/webm"}[e.toLowerCase()]||"audio/mp3"}async fileToBlob(e,t){let n=await this.app.vault.readBinary(e);return new Blob([n],{type:t})}async processAudio(e){if(e.stat.size>nU)throw new Error("\uD30C\uC77C \uD06C\uAE30\uAC00 2GB\uB97C \uCD08\uACFC\uD569\uB2C8\uB2E4");let t=e.extension.toLowerCase(),n=this.getMimeType(t),s=await this.fileToBlob(e,n);return await this.gemini.analyzeMeeting(s,n,e.name)}generateMarkdownNote(e){let t=Oe(this.settings.timezone,this.settings.dateFormat),n=e.actionItems.length>0?e.actionItems.map(o=>{let a=`- [ ] ${o.task}`;return o.assignee&&(a+=` - @${o.assignee}`),o.deadline&&(a+=` (\uAE30\uD55C: ${o.deadline})`),a}).join(`
`):"- (\uC5C6\uC74C)",s=e.decisions.length>0?e.decisions.map(o=>`- ${o}`).join(`
`):"- (\uC5C6\uC74C)",r=e.nextAgenda.length>0?e.nextAgenda.map(o=>`- ${o}`).join(`
`):"- (\uC5C6\uC74C)";return`---
type: meeting
source_file: "${e.sourceFile}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}

## \uC694\uC57D
${e.summary}

## \uC561\uC158 \uC544\uC774\uD15C
${n}

## \uACB0\uC815\uC0AC\uD56D
${s}

## \uB2E4\uC74C \uD68C\uC758 \uC548\uAC74
${r}

---

<details>
<summary>\uC804\uCCB4 \uB179\uCDE8\uB85D</summary>

${e.transcription}

</details>

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}};var Gy=require("obsidian");var Vy=class{constructor(e,t){this.app=e,this.settings=t}async saveToDaily(e){let t=new Map;for(let s of e)t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s);let n=0;for(let[s,r]of t)await this.appendToDaily(s,r),n+=r.length;return n}async appendToDaily(e,t){let n=this.settings.dailyNotesFolder,s=`${n}/${e}.md`;await this.ensureFolder(n);let r=t.map(a=>this.formatTask(a)).join(`
`),o=this.app.vault.getAbstractFileByPath(s);if(o instanceof Gy.TFile){let a=await this.app.vault.read(o),l=this.appendSchedulesToContent(a,r);await this.app.vault.modify(o,l)}else{let a=this.createDailyNoteContent(e,r);await this.app.vault.create(s,a)}}formatTask(e){let t=e.time?`${e.time} `:"",n=e.type==="event"?"\u{1F4C5}":"\u{1F4CB}";return`- [ ] ${t}${e.title} ${n} ${e.date}`}appendSchedulesToContent(e,t){let n="## \uC77C\uC815";if(e.includes(n)){let r=e.indexOf(n),o=e.indexOf(`
## `,r+1);return o>0?e.substring(0,o)+t+`

`+e.substring(o):e+`
`+t}let s=e.indexOf("---",3);if(s>0){let r=e.indexOf(`
`,s)+1;return e.substring(0,r)+`
## \uC77C\uC815
`+t+`
`+e.substring(r)}return`## \uC77C\uC815
`+t+`

`+e}createDailyNoteContent(e,t){return`---
type: daily
date: ${e}
created: ${Yn(this.settings.timezone)}
---

# ${e}

## \uC77C\uC815
${t}

## \uBA54\uBAA8

`}async ensureFolder(e){if(!(this.app.vault.getAbstractFileByPath(e)instanceof Gy.TFolder))try{await this.app.vault.createFolder(e)}catch(n){}}getToday(){return Yn(this.settings.timezone)}};var $y=class{constructor(e,t){this.gemini=e,this.settings=t}extractVideoId(e){let t=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/|youtube\.com\/shorts\/)([a-zA-Z0-9_-]{11})/,/^([a-zA-Z0-9_-]{11})$/];for(let n of t){let s=e.match(n);if(s)return s[1]}return null}isValidYouTubeUrl(e){return this.extractVideoId(e)!==null}async processVideo(e){let t=this.extractVideoId(e);if(!t)throw new Error("\uC720\uD6A8\uD55C YouTube URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let n=`https://www.youtube.com/watch?v=${t}`;console.log("Gemini \uB124\uC774\uD2F0\uBE0C YouTube \uBD84\uC11D \uC2DC\uC791:",n);let s=await this.gemini.analyzeYouTube(n);return{videoId:t,url:n,title:s.title,summary:s.summary,keyPoints:s.keyPoints}}generateMarkdownNote(e){let t=Oe(this.settings.timezone,this.settings.dateFormat),n=`https://www.youtube.com/embed/${e.videoId}`;return`---
type: youtube
source: "${e.url}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}

<div style="resize: both; overflow: hidden; width: 100%; height: 400px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${n}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none;" allowfullscreen></iframe>
</div>

## \uC694\uC57D
${e.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${e.keyPoints.map(s=>`- ${s}`).join(`
`)}
`}};var Uh=require("obsidian");var zy=class{constructor(e,t){this.gemini=e,this.settings=t}isValidUrl(e){try{let t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch(t){return!1}}extractMetadata(e,t){let n=l=>{let c=[new RegExp(`<meta[^>]*property=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*property=["']${l}["']`,"i"),new RegExp(`<meta[^>]*name=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*name=["']${l}["']`,"i")];for(let d of c){let h=e.match(d);if(h)return h[1]}return""},s=e.match(/<title[^>]*>([^<]+)<\/title>/i),r=e.match(/<link[^>]*rel=["'](?:shortcut )?icon["'][^>]*href=["']([^"']+)["']/i),o=new URL(t),a=l=>l?l.startsWith("http")?l:l.startsWith("//")?o.protocol+l:l.startsWith("/")?o.origin+l:o.origin+"/"+l:"";return{title:n("og:title")||n("twitter:title")||(s==null?void 0:s[1])||"",description:n("og:description")||n("twitter:description")||n("description")||"",image:a(n("og:image")||n("twitter:image")||""),siteName:n("og:site_name")||o.hostname,favicon:a((r==null?void 0:r[1])||"/favicon.ico")}}extractContent(e){let t=e.match(/<title[^>]*>([^<]+)<\/title>/i),n=e.match(/<meta[^>]*property=["']og:title["'][^>]*content=["']([^"']+)["']/i),s=(n==null?void 0:n[1])||(t==null?void 0:t[1])||"Untitled",r=e.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<nav[^>]*>[\s\S]*?<\/nav>/gi,"").replace(/<header[^>]*>[\s\S]*?<\/header>/gi,"").replace(/<footer[^>]*>[\s\S]*?<\/footer>/gi,"").replace(/<aside[^>]*>[\s\S]*?<\/aside>/gi,""),o="",a=r.match(/<article[^>]*>([\s\S]*?)<\/article>/i),l=r.match(/<main[^>]*>([\s\S]*?)<\/main>/i),c=r.match(/<div[^>]*(?:class|id)=["'][^"']*content[^"']*["'][^>]*>([\s\S]*?)<\/div>/i);if(a)o=a[1];else if(l)o=l[1];else if(c)o=c[1];else{let h=r.match(/<body[^>]*>([\s\S]*?)<\/body>/i);o=(h==null?void 0:h[1])||r}return o=o.replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&[a-z]+;/gi," ").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim(),{title:s.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim(),content:o}}async fetchWithJinaReader(e){var c,d;let t=`https://r.jina.ai/${e}`,s=(await(0,Uh.requestUrl)({url:t,method:"GET",headers:{Accept:"text/plain","X-Timeout":"30","X-Wait-For-Selector":"article, .post-content, .se-main-container, #postViewArea"}})).text;s.includes("Warning: This page maybe not yet fully loaded")&&console.log("Jina Reader: \uD398\uC774\uC9C0 \uB85C\uB529 \uACBD\uACE0 \uAC10\uC9C0");let r=s.split(`
`),o="Untitled",a=0;for((c=r[0])!=null&&c.startsWith("# ")?(o=r[0].substring(2).trim(),a=1):(d=r[0])!=null&&d.startsWith("Title: ")&&(o=r[0].substring(7).trim(),a=1);a<r.length;){let h=r[a];if(h!=null&&h.startsWith("URL Source:")||h!=null&&h.startsWith("http")||h!=null&&h.startsWith("Warning:")||h!=null&&h.startsWith("Markdown Content:")||(h==null?void 0:h.trim())==="")a++;else break}let l=r.slice(a).join(`
`).trim();if(l.length<100&&!l.includes(`
`))throw new Error("\uD398\uC774\uC9C0 \uCF58\uD150\uCE20\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4 (JavaScript \uB85C\uB529 \uB300\uAE30 \uC2E4\uD328)");return{title:o,content:l}}async fetchNaverBlog(e){var h;let t=e;if(e.includes("blog.naver.com")){let p=e.match(/blog\.naver\.com\/([^\/]+)\/(\d+)/);p&&(t=`https://m.blog.naver.com/${p[1]}/${p[2]}`)}let s=(await(0,Uh.requestUrl)({url:t,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15",Accept:"text/html,application/xhtml+xml","Accept-Language":"ko-KR,ko;q=0.9"}})).text,r=s.match(/<title[^>]*>([^<]+)<\/title>/i),o=((h=r==null?void 0:r[1])==null?void 0:h.replace(/ :  $/,"").trim())||"Untitled",a="",l=s.match(/<div[^>]*class="[^"]*se-main-container[^"]*"[^>]*>([\s\S]*?)<\/div>\s*<\/div>\s*<\/div>/i),c=s.match(/<div[^>]*id="postViewArea"[^>]*>([\s\S]*?)<\/div>/i),d=(l==null?void 0:l[1])||(c==null?void 0:c[1])||"";return d&&(a=d.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim()),{title:o,content:a}}async processUrl(e){if(!this.isValidUrl(e))throw new Error("\uC720\uD6A8\uD55C URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let t;try{let r=(await(0,Uh.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text;t=this.extractMetadata(r,e)}catch(s){console.log("\uBA54\uD0C0\uB370\uC774\uD130 \uCD94\uCD9C \uC2E4\uD328:",s)}if(e.includes("blog.naver.com"))return console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, Jina Reader \uC0AC\uC6A9"),await this.processUrlFallback(e,t);try{console.log("URL Context Tool\uB85C \uC6F9\uD398\uC774\uC9C0 \uBD84\uC11D \uC2DC\uB3C4");let s=await this.gemini.analyzeWebpage(e),r=["unable to access","cannot access","could not access","\uC811\uADFC\uD560 \uC218 \uC5C6","\uAC00\uC838\uC62C \uC218 \uC5C6"],o=s.summary.toLowerCase();return r.some(l=>o.includes(l.toLowerCase()))?(console.log("URL Context Tool \uC811\uADFC \uC2E4\uD328 \uAC10\uC9C0, \uD3F4\uBC31 \uC2DC\uB3C4"),await this.processUrlFallback(e,t)):(t&&(t.title=t.title||s.title),{url:e,title:s.title,content:"",summary:s.summary,keyPoints:s.keyPoints,metadata:t})}catch(s){console.log("URL Context Tool \uC2E4\uD328, \uD3F4\uBC31 \uC2DC\uB3C4:",s)}return await this.processUrlFallback(e,t)}async processUrlFallback(e,t){let n,s,r=null;if(!t)try{r=(await(0,Uh.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text,t=this.extractMetadata(r,e)}catch(d){console.log("HTML \uAC00\uC838\uC624\uAE30 \uC2E4\uD328:",d)}if(e.includes("blog.naver.com")){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, \uC804\uC6A9 \uCD94\uCD9C \uC2DC\uB3C4");try{let d=await this.fetchNaverBlog(e);if(n=d.title,s=d.content,s.length<100)throw new Error("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uCD94\uCD9C \uC2E4\uD328")}catch(d){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uC804\uC6A9 \uCD94\uCD9C \uC2E4\uD328, Jina Reader \uC2DC\uB3C4:",d);let h=await this.fetchWithJinaReader(e);n=h.title,s=h.content}}else try{console.log("Jina Reader\uB85C \uCF58\uD150\uCE20 \uCD94\uCD9C \uC2DC\uB3C4");let d=await this.fetchWithJinaReader(e);n=d.title,s=d.content}catch(d){if(console.log("Jina Reader \uC2E4\uD328, \uC9C1\uC811 \uCD94\uCD9C\uB85C \uD3F4\uBC31:",d),r){let h=this.extractContent(r);n=h.title,s=h.content}else throw new Error("\uC6F9\uD398\uC774\uC9C0\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4")}if(s.length<50)throw new Error("\uBCF8\uBB38\uC744 \uCD94\uCD9C\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC811\uADFC\uC774 \uC81C\uD55C\uB41C \uD398\uC774\uC9C0\uC77C \uC218 \uC788\uC2B5\uB2C8\uB2E4.");let a=5e4,l=s.length>a?s.slice(0,a)+"...":s,c=await this.gemini.summarizeContent(l,"webpage");return t&&(t.title=t.title||n),{url:e,title:c.title||n,content:l,summary:c.summary,keyPoints:c.keyPoints,metadata:t}}generateMarkdownNote(e){let t=Oe(this.settings.timezone,this.settings.dateFormat),n=e.metadata,s=e.url;e.url.includes("blog.naver.com")&&!e.url.includes("m.blog.naver.com")&&(s=e.url.replace("blog.naver.com","m.blog.naver.com"));let r="";if(n){let o=n.image?`
> ![](${n.image})
>`:"",a=n.description?`
> ${n.description}
>`:"";r=`
> [!bookmark] ${n.siteName||new URL(e.url).hostname}
> **${n.title||e.title}**
>${a}${o}
> \u{1F517} ${e.url}

`}else r=`
> [!bookmark] \uC6F9\uD398\uC774\uC9C0
> **${e.title}**
>
> \u{1F517} ${e.url}

`;return`---
type: webpage
source: "${e.url}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}
${r}
<div style="resize: both; overflow: hidden; width: 100%; height: 600px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${s}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none; color-scheme: light;"></iframe>
</div>

## \uC694\uC57D
${e.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${e.keyPoints.map(o=>`- ${o}`).join(`
`)}
`}};var ds=require("obsidian"),iU="YOUR_CLIENT_ID.apps.googleusercontent.com",sU="YOUR_CLIENT_SECRET",FR="http://127.0.0.1:42813/callback",rU="https://accounts.google.com/o/oauth2/v2/auth",LR="https://oauth2.googleapis.com/token",oU="https://www.googleapis.com/calendar/v3",aU="https://www.googleapis.com/auth/calendar.events",Hh=class{constructor(e,t,n){this.authServer=null;this.app=e,this.settings=t,this.saveSettings=n}isConnected(){return!!this.settings.googleRefreshToken}getClientId(){return this.settings.useOwnApiKey?this.settings.googleClientId:iU}getClientSecret(){return this.settings.useOwnApiKey?this.settings.googleClientSecret:sU}async startOAuth(){let e=this.getClientId();if(!e||e==="YOUR_CLIENT_ID.apps.googleusercontent.com"){new ds.Notice(`Google Calendar Client ID\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.
\uC124\uC815\uC5D0\uC11C Advanced \uBAA8\uB4DC\uB85C \uC9C1\uC811 Client ID\uB97C \uC785\uB825\uD558\uAC70\uB098,
\uD50C\uB7EC\uADF8\uC778 \uC5C5\uB370\uC774\uD2B8\uB97C \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.`,1e4);return}let t=new URLSearchParams({client_id:e,redirect_uri:FR,response_type:"code",scope:aU,access_type:"offline",prompt:"consent"}),n=`${rU}?${t.toString()}`;try{let s=await this.startAuthServer();await this.exchangeCodeForTokens(s),new ds.Notice("Google Calendar \uC5F0\uACB0 \uC644\uB8CC!")}catch(s){console.error("OAuth \uC5D0\uB7EC:",s),new ds.Notice("Google Calendar \uC5F0\uACB0 \uC2E4\uD328: "+s.message)}window.open(n,"_blank")}startAuthServer(){return new Promise((e,t)=>{let n=require("http"),s=setTimeout(()=>{this.stopAuthServer(),t(new Error("\uC778\uC99D \uC2DC\uAC04 \uCD08\uACFC (5\uBD84)"))},5*60*1e3);this.authServer=n.createServer((r,o)=>{let a=new URL(r.url||"","http://127.0.0.1:42813");if(a.pathname==="/callback"){let l=a.searchParams.get("code"),c=a.searchParams.get("error");if(c){o.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),o.end(`
							<html><body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
								<h1>\uC5F0\uACB0 \uC2E4\uD328</h1>
								<p>Google Calendar \uC5F0\uACB0\uC774 \uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p>
								<p>\uC774 \uCC3D\uC744 \uB2EB\uC544\uB3C4 \uB429\uB2C8\uB2E4.</p>
							</body></html>
						`),clearTimeout(s),this.stopAuthServer(),t(new Error(c));return}if(l){o.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),o.end(`
							<html><body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
								<h1>\uC5F0\uACB0 \uC644\uB8CC!</h1>
								<p>Google Calendar\uAC00 \uC5F0\uACB0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p>
								<p>\uC774 \uCC3D\uC744 \uB2EB\uACE0 Obsidian\uC73C\uB85C \uB3CC\uC544\uAC00\uC138\uC694.</p>
							</body></html>
						`),clearTimeout(s),this.stopAuthServer(),e(l);return}}o.writeHead(404),o.end("Not Found")}),this.authServer.listen(42813,"127.0.0.1",()=>{console.log("OAuth \uCF5C\uBC31 \uC11C\uBC84 \uC2DC\uC791: http://127.0.0.1:42813")}),this.authServer.on("error",r=>{clearTimeout(s),t(new Error(`\uC11C\uBC84 \uC2DC\uC791 \uC2E4\uD328: ${r.message}`))})})}stopAuthServer(){this.authServer&&(this.authServer.close(),this.authServer=null)}async exchangeCodeForTokens(e){let n=(await(0,ds.requestUrl)({url:LR,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:this.getClientId(),client_secret:this.getClientSecret(),code:e,grant_type:"authorization_code",redirect_uri:FR}).toString()})).json;if(n.error)throw new Error(n.error_description||n.error);this.settings.googleAccessToken=n.access_token,n.refresh_token&&(this.settings.googleRefreshToken=n.refresh_token),this.settings.googleTokenExpiry=Date.now()+n.expires_in*1e3,await this.saveSettings()}async refreshAccessToken(){if(!this.settings.googleRefreshToken)throw new Error("Refresh token\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC5F0\uACB0\uD574\uC8FC\uC138\uC694.");let t=(await(0,ds.requestUrl)({url:LR,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:this.getClientId(),client_secret:this.getClientSecret(),refresh_token:this.settings.googleRefreshToken,grant_type:"refresh_token"}).toString()})).json;if(t.error)throw t.error==="invalid_grant"?(this.settings.googleRefreshToken="",await this.saveSettings(),new Error("Google \uC5F0\uACB0\uC774 \uB9CC\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC5F0\uACB0\uD574\uC8FC\uC138\uC694.")):new Error(t.error_description||t.error);this.settings.googleAccessToken=t.access_token,this.settings.googleTokenExpiry=Date.now()+t.expires_in*1e3,await this.saveSettings()}async ensureValidToken(){Date.now()>this.settings.googleTokenExpiry-5*60*1e3&&await this.refreshAccessToken()}async createEvent(e){var o;if(!this.isConnected())throw new Error("Google Calendar\uAC00 \uC5F0\uACB0\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");await this.ensureValidToken();let t,n;if(e.time){let a=`${e.date}T${e.time}:00`,l=this.addHour(e.time),c=`${e.date}T${l}:00`;t={dateTime:a,timeZone:this.resolveTimezone()},n={dateTime:c,timeZone:this.resolveTimezone()}}else t={date:e.date},n={date:this.getNextDay(e.date)};let s={summary:e.title,start:t,end:n},r=await(0,ds.requestUrl)({url:`${oU}/calendars/primary/events`,method:"POST",headers:{Authorization:`Bearer ${this.settings.googleAccessToken}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(r.status>=400){let a=r.json;throw new Error(((o=a.error)==null?void 0:o.message)||"\uC774\uBCA4\uD2B8 \uC0DD\uC131 \uC2E4\uD328")}}async saveSchedules(e){let t=0;for(let n of e)try{await this.createEvent(n),t++}catch(s){console.error("\uC77C\uC815 \uC800\uC7A5 \uC2E4\uD328:",n.title,s)}return t}addHour(e){let[t,n]=e.split(":").map(Number),s=(t+1)%24;return`${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}`}getNextDay(e){let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}resolveTimezone(){return this.settings.timezone==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:this.settings.timezone}async disconnect(){this.settings.googleAccessToken="",this.settings.googleRefreshToken="",this.settings.googleTokenExpiry=0,await this.saveSettings(),new ds.Notice("Google Calendar \uC5F0\uACB0\uC774 \uD574\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}};var OR=require("obsidian"),qy=class extends OR.Modal{constructor(t,n,s,r){super(t);this.resolvePromise=null;this.choiceMade=!1;this.schedules=n,this.settings=s,this.selected=new Set(n.map((o,a)=>a)),this.saveToDaily=!0,this.saveToGoogle=s.googleCalendarEnabled&&!!s.googleRefreshToken,this.moveToArchives=!1,this.onFeedback=r}async openAndWait(){return new Promise(t=>{this.resolvePromise=t,this.open()})}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-schedule-modal"),t.createEl("h2",{text:"\uAC10\uC9C0\uB41C \uC77C\uC815"}),t.createEl("p",{text:`${this.schedules.length}\uAC1C\uC758 \uC77C\uC815\uC774 \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uC800\uC7A5\uD560 \uC77C\uC815\uC744 \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let n=t.createDiv({cls:"schedule-list"});n.style.maxHeight="300px",n.style.overflowY="auto",n.style.marginBottom="16px",this.schedules.forEach((A,_)=>{let C=n.createDiv({cls:"schedule-item"});C.style.display="flex",C.style.alignItems="center",C.style.padding="10px 12px",C.style.marginBottom="8px",C.style.border="1px solid var(--background-modifier-border)",C.style.borderRadius="8px",C.style.gap="12px";let T=C.createEl("input",{type:"checkbox",attr:{checked:!0}});T.style.flexShrink="0",T.addEventListener("change",()=>{T.checked?this.selected.add(_):this.selected.delete(_),this.updateSaveButton()});let R=C.createDiv({cls:"schedule-info"});R.style.flex="1",R.style.minWidth="0";let I=R.createEl("div",{text:A.title});I.style.fontWeight="500",I.style.overflow="hidden",I.style.textOverflow="ellipsis",I.style.whiteSpace="nowrap";let D=R.createEl("div");D.style.fontSize="12px",D.style.color="var(--text-muted)";let k=A.type==="event"?"\uC57D\uC18D":"\uD560\uC77C",N=A.type==="event"?"\u{1F4C5}":"\u{1F4CB}",F=A.time||"\uC885\uC77C";D.setText(`${N} ${k} | ${A.date} ${F}`)});let s=t.createDiv({cls:"schedule-destinations"});s.style.padding="12px",s.style.backgroundColor="var(--background-secondary)",s.style.borderRadius="8px",s.style.marginBottom="16px",s.createEl("div",{text:"\uC800\uC7A5 \uC704\uCE58"}).style.fontWeight="500";let r=s.createDiv({cls:"destination-option"});r.style.display="flex",r.style.alignItems="center",r.style.gap="8px",r.style.marginTop="8px";let o=r.createEl("input",{type:"checkbox",attr:{checked:!0}});o.id="save-to-daily",o.addEventListener("change",()=>{this.saveToDaily=o.checked});let a=r.createEl("label",{text:`Daily Notes (${this.settings.dailyNotesFolder}/)`,attr:{for:"save-to-daily"}});a.style.cursor="pointer";let l=s.createDiv({cls:"destination-option"});l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginTop="8px";let c=l.createEl("input",{type:"checkbox",attr:{checked:this.saveToGoogle,disabled:!this.settings.googleCalendarEnabled||!this.settings.googleRefreshToken}});c.id="save-to-google",c.addEventListener("change",()=>{this.saveToGoogle=c.checked});let d=l.createEl("label",{attr:{for:"save-to-google"}});d.style.cursor="pointer",this.settings.googleCalendarEnabled&&this.settings.googleRefreshToken?d.setText("Google Calendar (\uC5F0\uACB0\uB428)"):this.settings.googleCalendarEnabled?(d.setText("Google Calendar (\uC5F0\uACB0 \uD544\uC694)"),d.style.color="var(--text-muted)"):(d.setText("Google Calendar (\uBE44\uD65C\uC131\uD654)"),d.style.color="var(--text-muted)");let h=s.createDiv({cls:"destination-option"});h.style.display="flex",h.style.alignItems="center",h.style.gap="8px",h.style.marginTop="8px";let p=h.createEl("input",{type:"checkbox",attr:{checked:!1}});p.id="move-to-archives",p.addEventListener("change",()=>{this.moveToArchives=p.checked});let m=h.createEl("label",{text:"\u{1F4E6} \uC800\uC7A5 \uD6C4 \uC6D0\uBCF8 \uB178\uD2B8 Archives\uB85C \uC774\uB3D9",attr:{for:"move-to-archives"}});m.style.cursor="pointer";let y=t.createDiv({cls:"modal-button-container"});y.style.display="flex",y.style.justifyContent="flex-end",y.style.gap="8px",y.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>{this.choiceMade=!0,this.onFeedback&&this.onFeedback({type:"schedule_detection",accepted:!1,allSchedules:this.schedules,selectedSchedules:[],rejectedSchedules:this.schedules}),this.close(),this.resolvePromise&&this.resolvePromise(null)});let E=y.createEl("button",{text:`${this.selected.size}\uAC1C \uC800\uC7A5`,cls:"mod-cta"});E.id="save-schedule-btn",E.addEventListener("click",()=>{this.choiceMade=!0;let A=this.schedules.filter((C,T)=>this.selected.has(T)),_=this.schedules.filter((C,T)=>!this.selected.has(T));this.onFeedback&&this.onFeedback({type:"schedule_detection",accepted:A.length>0,allSchedules:this.schedules,selectedSchedules:A,rejectedSchedules:_}),this.close(),this.resolvePromise&&this.resolvePromise({selectedSchedules:A,saveToDaily:this.saveToDaily,saveToGoogle:this.saveToGoogle,moveToArchives:this.moveToArchives})})}updateSaveButton(){let t=this.contentEl.querySelector("#save-schedule-btn");t&&t.setText(`${this.selected.size}\uAC1C \uC800\uC7A5`)}onClose(){this.choiceMade||(this.onFeedback&&this.onFeedback({type:"schedule_detection",accepted:!1,allSchedules:this.schedules,selectedSchedules:[],dismissed:!0}),this.resolvePromise&&this.resolvePromise(null)),this.contentEl.empty()}};var yc=require("obsidian"),Wy=class extends yc.Modal{constructor(t,n,s,r,o=null){super(t);this.choiceMade=!1;this.activeTab="restructured";this.result=n,this.originalContent=s,this.onChoice=r,this.feedbackManager=o,this.component=new yc.Component}getRestructureTypeLabel(t){switch(t){case"meeting":return"\u{1F4CB} \uD68C\uC758/\uBBF8\uD305";case"idea":return"\u{1F4A1} \uC544\uC774\uB514\uC5B4";case"learning":return"\u{1F4DA} \uD559\uC2B5/\uC5F0\uAD6C";case"general":return"\u{1F4DD} \uC77C\uBC18";default:return"\u{1F4DD} \uC77C\uBC18"}}recordFeedback(t){this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"content_restructure",noteTitle:this.result.title,aiSuggestion:{restructuredContent:this.result.restructuredContent,restructureType:this.result.restructureType},userChoice:{accepted:t===!0,dismissed:t===null}})}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-restructure-modal"),t.createEl("h2",{text:"\u2728 \uCF58\uD150\uCE20 \uC7AC\uAD6C\uC131 \uC81C\uC548"});let n=t.createDiv({cls:"restructure-info"});n.style.marginBottom="16px",n.style.padding="12px",n.style.backgroundColor="var(--background-secondary)",n.style.borderRadius="8px",n.createEl("p",{text:"\uC774 \uB178\uD2B8\uAC00 \uC815\uB9AC\uB418\uC9C0 \uC54A\uC740 \uAC83 \uAC19\uC544 \uC7AC\uAD6C\uC131\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4."});let s=this.getRestructureTypeLabel(this.result.restructureType);n.createEl("p",{text:`\uC720\uD615: ${s}`,cls:"restructure-type"}).style.fontWeight="bold";let r=t.createDiv({cls:"restructure-tabs"});r.style.display="flex",r.style.borderBottom="1px solid var(--background-modifier-border)",r.style.marginBottom="12px";let o=r.createEl("button",{text:"\u{1F4C4} \uC6D0\uBCF8"});o.style.flex="1",o.style.padding="8px 16px",o.style.border="none",o.style.cursor="pointer",o.style.backgroundColor="transparent";let a=r.createEl("button",{text:"\u2728 \uC7AC\uAD6C\uC131"});a.style.flex="1",a.style.padding="8px 16px",a.style.border="none",a.style.cursor="pointer",a.style.backgroundColor="transparent";let l=t.createDiv({cls:"restructure-content-area"});l.style.minHeight="200px",l.style.maxHeight="400px",l.style.overflow="auto",l.style.padding="12px",l.style.border="1px solid var(--background-modifier-border)",l.style.borderRadius="8px",l.style.backgroundColor="var(--background-primary)";let c=()=>{this.activeTab==="original"?(o.style.borderBottom="2px solid var(--interactive-accent)",o.style.color="var(--text-normal)",a.style.borderBottom="none",a.style.color="var(--text-muted)",l.empty(),l.createEl("pre",{text:this.originalContent,cls:"original-content"}).style.whiteSpace="pre-wrap"):(a.style.borderBottom="2px solid var(--interactive-accent)",a.style.color="var(--text-normal)",o.style.borderBottom="none",o.style.color="var(--text-muted)",l.empty(),this.result.restructuredContent&&yc.MarkdownRenderer.render(this.app,this.result.restructuredContent,l,"",this.component))};o.addEventListener("click",()=>{this.activeTab="original",c()}),a.addEventListener("click",()=>{this.activeTab="restructured",c()}),c();let d=t.createDiv({cls:"modal-button-container"});d.style.marginTop="16px",d.style.display="flex",d.style.gap="8px",d.style.justifyContent="flex-end",d.createEl("button",{text:"\u{1F4C4} \uC6D0\uBCF8 \uC720\uC9C0"}).addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback(!1),this.close(),this.onChoice(!1)}),d.createEl("button",{text:"\u2728 \uC7AC\uAD6C\uC131 \uC801\uC6A9",cls:"mod-cta"}).addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback(!0),this.close(),this.onChoice(!0)})}onClose(){this.choiceMade||this.recordFeedback(null),this.component.unload(),this.contentEl.empty()}};var lU="feedback.json",Bh=10,UR=100,HR=20,Yy=class{constructor(e,t){this.app=e,this.pluginDir=t,this.store={...Of}}async load(){try{let e=this.getFilePath(),t=this.app.vault.adapter;if(await t.exists(e)){let n=await t.read(e),s=JSON.parse(n);this.store=this.migrate(s)}else this.store={...Of}}catch(e){console.error("Failed to load feedback store:",e),this.store={...Of}}}async save(){try{let e=this.getFilePath(),t=this.app.vault.adapter;this.store.lastUpdated=new Date().toISOString(),await t.write(e,JSON.stringify(this.store,null,2))}catch(e){console.error("Failed to save feedback store:",e)}}getFilePath(){return`${this.pluginDir}/${lU}`}migrate(e){return!e.version||e.version<1?{version:1,entries:e.entries||[],preferences:this.migratePreferences(e.preferences),lastUpdated:e.lastUpdated||new Date().toISOString()}:(e.preferences=this.migratePreferences(e.preferences),e)}migratePreferences(e){var n,s,r,o;let t={...nb};return e?{version:e.version||t.version,feedback:{referenceLocation:{...t.feedback.referenceLocation,...(n=e.feedback)==null?void 0:n.referenceLocation},scheduleDetection:{...t.feedback.scheduleDetection,...(s=e.feedback)==null?void 0:s.scheduleDetection},projectClassification:{...t.feedback.projectClassification,...(r=e.feedback)==null?void 0:r.projectClassification}},restructure:{...t.restructure,...e.restructure},embedding:{...t.embedding,...e.embedding},rag:{...t.rag,...e.rag,feedbackOnAnswers:{...t.rag.feedbackOnAnswers,...(o=e.rag)==null?void 0:o.feedbackOnAnswers}}}:t}addFeedback(e){this.store.entries.push(e),this.store.entries.length>UR&&(this.store.entries=this.store.entries.slice(-UR)),this.updatePreferences(e),this.save()}updatePreferences(e){if(!e.userChoice.dismissed)switch(e.type){case"reference_location":this.updateReferencePreference(e);break;case"schedule_detection":this.updateSchedulePreference(e);break;case"related_notes":this.updateRelatedNotesPreference(e);break;case"project_classification":this.updateProjectClassificationPreference(e);break;case"content_restructure":this.updateRestructurePreference(e);break;case"rag_chat":this.updateRAGPreference(e);break}}updateReferencePreference(e){let t=this.store.preferences.feedback.referenceLocation;e.userChoice.modified==="library"?t.toLibrary++:e.userChoice.modified==="project"&&t.toProject++;let n=t.toLibrary+t.toProject;if(n>=5){let s=t.toLibrary/n;s>.7?t.preference="library":s<.3?t.preference="project":t.preference="neutral"}}updateSchedulePreference(e){let t=this.store.preferences.feedback.scheduleDetection;e.userChoice.accepted?t.accepted++:t.rejected++,e.userChoice.rejectedItems&&e.userChoice.rejectedItems.length>0}updateRelatedNotesPreference(e){}updateProjectClassificationPreference(e){let t=this.store.preferences.feedback.projectClassification;e.userChoice.modified&&e.aiSuggestion.projectName&&(t.corrections.push({original:e.aiSuggestion.projectName,corrected:e.userChoice.modified,keywords:[]}),t.corrections.length>HR&&(t.corrections=t.corrections.slice(-HR)))}updateRestructurePreference(e){let t=this.store.preferences.restructure;e.userChoice.accepted?t.accepted++:t.rejected++;let n=t.accepted+t.rejected;if(n>=5){let s=t.accepted/n;s>.7?t.preference="restructure":s<.3?t.preference="original":t.preference="neutral"}}updateRAGPreference(e){let t=this.store.preferences.rag;if(e.userChoice.accepted){if(t.feedbackOnAnswers.helpful++,e.aiSuggestion.sources)for(let n of e.aiSuggestion.sources)t.preferredNotes.includes(n)||(t.preferredNotes.push(n),t.preferredNotes.length>10&&t.preferredNotes.shift())}else t.feedbackOnAnswers.notHelpful++}generatePromptContext(){let e=this.store.preferences,t=[],n=e.feedback.referenceLocation;if(n.preference!=="neutral"){let a=n.toLibrary+n.toProject;a>=5&&(n.preference==="library"?t.push(`- \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB294 Library \uC120\uD638 (${a}\uD68C \uC911 ${n.toLibrary}\uD68C)`):t.push(`- \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB294 \uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354 \uC120\uD638 (${a}\uD68C \uC911 ${n.toProject}\uD68C)`))}let s=e.feedback.scheduleDetection;s.falsePositivePatterns.length>0&&t.push(`- \uB2E4\uC74C \uD45C\uD604\uC740 \uC77C\uC815\uC73C\uB85C \uAC10\uC9C0\uD558\uC9C0 \uC54A\uC74C: ${s.falsePositivePatterns.join(", ")}`);let r=e.feedback.projectClassification;r.corrections.length>0&&r.corrections.slice(-3).forEach(l=>{l.keywords.length>0&&t.push(`- "${l.keywords.join(", ")}" \uAD00\uB828 \uB0B4\uC6A9\uC740 ${l.corrected} \uD504\uB85C\uC81D\uD2B8\uB85C \uBD84\uB958`)});let o=e.restructure;if(o.preference!=="neutral"){let a=o.accepted+o.rejected;a>=5&&(o.preference==="restructure"?t.push(`- \uCF58\uD150\uCE20 \uC7AC\uAD6C\uC131 \uC120\uD638 (${a}\uD68C \uC911 ${o.accepted}\uD68C \uC218\uB77D)`):t.push(`- \uC6D0\uBCF8 \uC720\uC9C0 \uC120\uD638 (${a}\uD68C \uC911 ${o.rejected}\uD68C \uAC70\uBD80)`))}return t.length>0?`

## \uC0AC\uC6A9\uC790 \uC120\uD638\uB3C4 (\uC774\uC804 \uD53C\uB4DC\uBC31 \uAE30\uBC18)
${t.join(`
`)}`:""}getPreferences(){return this.store.preferences}getEntries(){return this.store.entries}getStats(){let e=this.store.preferences.feedback.referenceLocation,t=this.store.preferences.feedback.scheduleDetection;return{totalEntries:this.store.entries.length,referenceDecisions:e.toLibrary+e.toProject,scheduleDecisions:t.accepted+t.rejected,lastUpdated:this.store.lastUpdated}}};var mi=require("obsidian");var Vh=class{constructor(e,t){this.dayCache=new Map;this.allEventsCache=[];this.fileEventMap=new Map;this.initialized=!1;this.changeListeners=new Set;this.vaultEventRefs=[];this.app=e,this.settings=t}async initialize(){if(this.initialized)return;let e=this.app.vault.getMarkdownFiles();for(let t of e){let n=await this.extractEventsFromFile(t);n.length>0&&(this.fileEventMap.set(t.path,n),this.allEventsCache.push(...n))}this.initialized=!0,this.registerVaultEvents()}registerVaultEvents(){let e=this.app.vault.on("create",async r=>{r instanceof mi.TFile&&r.extension==="md"&&await this.reloadFile(r)});this.vaultEventRefs.push(e);let t=this.app.vault.on("modify",async r=>{r instanceof mi.TFile&&r.extension==="md"&&await this.reloadFile(r)});this.vaultEventRefs.push(t);let n=this.app.vault.on("delete",r=>{r instanceof mi.TFile&&(this.invalidateFile(r.path),this.notifyListeners())});this.vaultEventRefs.push(n);let s=this.app.vault.on("rename",async(r,o)=>{r instanceof mi.TFile&&r.extension==="md"&&(this.invalidateFile(o),await this.reloadFile(r))});this.vaultEventRefs.push(s)}unregisterVaultEvents(){for(let e of this.vaultEventRefs)this.app.vault.offref(e);this.vaultEventRefs=[]}async reloadFile(e){this.invalidateFile(e.path);let t=await this.extractEventsFromFile(e);t.length>0&&(this.fileEventMap.set(e.path,t),this.allEventsCache.push(...t)),this.dayCache.clear(),this.notifyListeners()}invalidateFile(e){this.fileEventMap.get(e)&&(this.allEventsCache=this.allEventsCache.filter(n=>!n.source.path.startsWith(e)),this.fileEventMap.delete(e)),this.dayCache.clear()}addChangeListener(e){this.changeListeners.add(e)}removeChangeListener(e){this.changeListeners.delete(e)}notifyListeners(){for(let e of this.changeListeners)e()}updateSettings(e){this.settings=e}invalidateCache(){this.dayCache.clear(),this.allEventsCache=[],this.fileEventMap.clear(),this.initialized=!1}async getEventsForRange(e,t){return this.initialized||await this.initialize(),this.allEventsCache.filter(n=>n.start>=e&&n.start<=t)}async getEventsForDay(e){if(this.dayCache.has(e))return this.dayCache.get(e);let t=await this.getEventsForRange(new Date(e+"T00:00:00"),new Date(e+"T23:59:59")),n={date:e,notes:t.filter(s=>s.type==="note"),schedules:t.filter(s=>s.type==="schedule"),meetings:t.filter(s=>s.type==="meeting"),total:t.length};return this.dayCache.set(e,n),n}async getEventCountsForMonth(e,t){let n=new Map,s=new Date(e,t,1),r=new Date(e,t+1,0,23,59,59),o=await this.getEventsForRange(s,r);for(let a of o){let l=Le(a.start,this.settings.timezone);n.set(l,(n.get(l)||0)+1)}return n}async extractEventsFromFile(e){let t=[],n=await this.app.vault.cachedRead(e),s=this.parseFrontmatter(n),r=this.determineFileType(e,s),o=this.getEventDate(e,s);if(!o)return t;if(r==="meeting")t.push(this.createEvent(e,s,o,"meeting"));else if(this.isDailyNote(e)){let a=this.extractSchedulesFromDailyNote(e,n,o);t.push(...a)}else t.push(this.createEvent(e,s,o,"note"));return t}parseFrontmatter(e){let t=e.match(/^---\n([\s\S]*?)\n---/);if(!t)return{};try{return(0,mi.parseYaml)(t[1])||{}}catch(n){return{}}}determineFileType(e,t){return t.type==="meeting"||e.path.includes("\uD68C\uC758\uB85D")||e.path.includes("Meeting")?"meeting":this.isDailyNote(e)?"schedule":"note"}isDailyNote(e){let t=this.settings.dailyNotesFolder;return e.path.startsWith(t)}getEventDate(e,t){let n=["date","created","meetingDate"];for(let r of n){let o=t[r];if(o){let a=this.parseDate(o);if(a)return a}}let s=e.basename.match(/^(\d{4}-\d{2}-\d{2})$/);return s?new Date(s[1]+"T00:00:00"):new Date(e.stat.ctime)}parseDate(e){let t=e.match(/^(\d{4}-\d{2}-\d{2})/);if(t)return new Date(t[1]+"T00:00:00");let n=new Date(e);return isNaN(n.getTime())?null:n}createEvent(e,t,n,s){let r=t.title||e.basename,o=this.getProjectFromPath(e.path),a={note:"var(--interactive-accent)",schedule:"var(--text-success)",meeting:"var(--text-warning)"};return{id:e.path,title:r,start:n,allDay:s==="note"||s==="meeting",type:s,color:a[s],source:{path:e.path},metadata:{project:o,tags:t.tags||[],summary:t.summary||void 0}}}extractSchedulesFromDailyNote(e,t,n){let s=[],r=t.split(`
`);for(let o=0;o<r.length;o++){let a=r[o];if(a.match(/^- \[[ x]\]/)){let l=a.match(/^- \[[ x]\] (\d{1,2}:\d{2})?\s*(.+?)(?:\s+[]\s*(\d{4}-\d{2}-\d{2}))?$/);if(l){let c=l[1],d=l[2].trim(),h=l[3],p;if(h?p=new Date(h+"T00:00:00"):p=new Date(n),c){let[m,y]=c.split(":").map(Number);p.setHours(m,y,0,0)}s.push({id:`${e.path}:${o}`,title:d,start:p,allDay:!c,type:"schedule",color:"var(--text-success)",source:{path:e.path,lineNumber:o+1},metadata:{project:this.getProjectFromPath(e.path)}})}}}return s}getProjectFromPath(e){let t=this.settings.projectsFolder;if(e.startsWith(t+"/")){let n=e.substring(t.length+1),s=n.indexOf("/");if(s>0)return n.substring(0,s)}}hasTimeComponent(e){return e.getHours()!==0||e.getMinutes()!==0}async moveEvent(e,t){let[n,s]=e.split(":"),r=this.app.vault.getAbstractFileByPath(n);if(!(r instanceof mi.TFile))return!1;let o=await this.app.vault.read(r);if(s){let a=parseInt(s)-1,l=o.split(`
`);if(a>=0&&a<l.length){let c=l[a],d=Le(t,this.settings.timezone),h=c.replace(/[]\s*\d{4}-\d{2}-\d{2}/,`\u{1F4C5} ${d}`);if(h!==c)return l[a]=h,await this.app.vault.modify(r,l.join(`
`)),this.invalidateCache(),!0}}else{let a=Le(t,this.settings.timezone),l=this.updateFrontmatterDate(o,a);if(l!==o)return await this.app.vault.modify(r,l),this.invalidateCache(),!0}return!1}updateFrontmatterDate(e,t){let n=e.match(/^---\n([\s\S]*?)\n---/);if(!n)return e;let s=n[1],r;return s.includes("date:")?r=s.replace(/date:\s*.*/,`date: ${t}`):r=`date: ${t}
${s}`,e.replace(/^---\n[\s\S]*?\n---/,`---
${r}
---`)}async deleteEvent(e){let[t,n]=e.split(":"),s=this.app.vault.getAbstractFileByPath(t);if(!(s instanceof mi.TFile))return!1;if(n){let r=parseInt(n)-1,a=(await this.app.vault.read(s)).split(`
`);if(r>=0&&r<a.length)return a.splice(r,1),await this.app.vault.modify(s,a.join(`
`)),this.invalidateCache(),!0}else return!1;return!1}async openEvent(e){let[t,n]=e.split(":"),s=this.app.vault.getAbstractFileByPath(t);if(s instanceof mi.TFile){let r=this.app.workspace.getLeaf();if(await r.openFile(s),n){let o=parseInt(n)-1,a=r.view;"editor"in a&&a.editor&&a.editor.setCursor({line:o,ch:0})}}}};var VR=require("obsidian");var BR=require("obsidian"),Zo=class extends BR.Modal{constructor(t,n,s,r){super(t);this.onEventClick=null;this.date=n,this.dataProvider=s,this.settings=r}setOnEventClick(t){this.onEventClick=t}async onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-calendar-day-modal"),t.createEl("p",{text:"\uB85C\uB529 \uC911..."});let n=await this.dataProvider.getEventsForDay(this.date);t.empty();let s=new Date(this.date+"T00:00:00"),o=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"][s.getDay()],a=t.createDiv({cls:"day-modal-header"});if(a.style.marginBottom="16px",a.createEl("h2",{text:`${this.date} (${o}\uC694\uC77C)`}).style.margin="0",a.createEl("p",{text:`\uCD1D ${n.total}\uAC1C \uD56D\uBAA9`,cls:"setting-item-description"}).style.margin="4px 0 0 0",n.total===0){let h=t.createDiv({cls:"day-modal-empty"});h.style.padding="32px",h.style.textAlign="center",h.style.color="var(--text-muted)",h.setText("\uC774 \uB0A0\uC9DC\uC5D0 \uB4F1\uB85D\uB41C \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let l=t.createDiv({cls:"day-modal-sections"});l.style.maxHeight="400px",l.style.overflowY="auto",n.schedules.length>0&&this.renderSection(l,"\uC77C\uC815",n.schedules,"schedule"),n.notes.length>0&&this.renderSection(l,"\uB178\uD2B8",n.notes,"note"),n.meetings.length>0&&this.renderSection(l,"\uD68C\uC758\uB85D",n.meetings,"meeting");let c=t.createDiv({cls:"modal-button-container"});c.style.display="flex",c.style.justifyContent="flex-end",c.style.marginTop="16px",c.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close())}renderSection(t,n,s,r){var d;let o={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"},a=t.createDiv({cls:"day-section"});a.style.marginBottom="16px";let l=a.createDiv({cls:"section-header"});l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginBottom="8px",l.createEl("span",{text:o[r]}),l.createEl("span",{text:`${n} (${s.length})`}).style.fontWeight="500";let c=a.createDiv({cls:"section-list"});for(let h of s){let p=c.createDiv({cls:"event-item"});p.style.display="flex",p.style.alignItems="center",p.style.padding="8px 12px",p.style.marginBottom="4px",p.style.border="1px solid var(--background-modifier-border)",p.style.borderRadius="6px",p.style.cursor="pointer",p.style.transition="background-color 0.15s";let m=p.createDiv({cls:"event-indicator"});m.style.width="4px",m.style.height="24px",m.style.borderRadius="2px",m.style.marginRight="12px",m.style.backgroundColor=h.color||"var(--interactive-accent)";let y=p.createDiv({cls:"event-info"});y.style.flex="1",y.style.minWidth="0";let v=y.createEl("div",{text:h.title});v.style.fontWeight="500",v.style.overflow="hidden",v.style.textOverflow="ellipsis",v.style.whiteSpace="nowrap";let E=y.createEl("div");E.style.fontSize="12px",E.style.color="var(--text-muted)";let A=[];if(h.allDay)A.push("\uC885\uC77C");else{let _=h.start.getHours().toString().padStart(2,"0"),C=h.start.getMinutes().toString().padStart(2,"0");A.push(`${_}:${C}`)}(d=h.metadata)!=null&&d.project&&A.push(h.metadata.project),E.setText(A.join(" | ")),p.addEventListener("mouseenter",()=>{p.style.backgroundColor="var(--background-modifier-hover)"}),p.addEventListener("mouseleave",()=>{p.style.backgroundColor=""}),p.addEventListener("click",async()=>{this.onEventClick?this.onEventClick(h):(await this.dataProvider.openEvent(h.id),this.close())})}}onClose(){this.contentEl.empty()}};var vc="zfb-mini-calendar",Gh=class extends VR.ItemView{constructor(t,n,s){super(t);this.eventCounts=new Map;this.settings=n,this.dataProvider=s;let r=new Date;this.currentYear=r.getFullYear(),this.currentMonth=r.getMonth(),this.refreshCallback=()=>this.renderCalendar()}getViewType(){return vc}getDisplayText(){return"\uCE98\uB9B0\uB354"}getIcon(){return"calendar"}async onOpen(){this.dataProvider.addChangeListener(this.refreshCallback),await this.renderCalendar()}async onClose(){this.dataProvider.removeChangeListener(this.refreshCallback),this.contentEl.empty()}updateSettings(t){this.settings=t,this.renderCalendar()}async renderCalendar(){let t=this.contentEl;t.empty(),t.addClass("zfb-mini-calendar"),this.eventCounts=await this.dataProvider.getEventCountsForMonth(this.currentYear,this.currentMonth),this.renderHeader(t),this.renderWeekdayHeader(t),this.renderDateGrid(t),this.renderTodayButton(t)}renderHeader(t){let n=t.createDiv({cls:"mini-calendar-header"});n.createEl("button",{cls:"nav-btn",text:"<"}).addEventListener("click",()=>this.navigateMonth(-1));let r=["1\uC6D4","2\uC6D4","3\uC6D4","4\uC6D4","5\uC6D4","6\uC6D4","7\uC6D4","8\uC6D4","9\uC6D4","10\uC6D4","11\uC6D4","12\uC6D4"];n.createEl("span",{cls:"month-title",text:`${this.currentYear}\uB144 ${r[this.currentMonth]}`}),n.createEl("button",{cls:"nav-btn",text:">"}).addEventListener("click",()=>this.navigateMonth(1))}renderWeekdayHeader(t){let n=t.createDiv({cls:"weekday-header"}),s=this.settings.calendarFirstDayOfWeek===1?["\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0","\uC77C"]:["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"];for(let r of s)n.createEl("span",{text:r})}renderDateGrid(t){let n=t.createDiv({cls:"date-grid"}),s=new Date(this.currentYear,this.currentMonth,1),r=new Date(this.currentYear,this.currentMonth+1,0),o=s.getDay();this.settings.calendarFirstDayOfWeek===1&&(o=o===0?6:o-1);let a=Le(new Date,this.settings.timezone);for(let l=0;l<o;l++)n.createDiv({cls:"date-cell empty"});for(let l=1;l<=r.getDate();l++){let c=`${this.currentYear}-${String(this.currentMonth+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`,d=this.eventCounts.get(c)||0,h=c===a,p=n.createDiv({cls:"date-cell"});if(h&&p.addClass("today"),p.createEl("span",{cls:"day-number",text:String(l)}),d>0){let m=p.createDiv({cls:"event-dots"}),y=Math.min(d,3);for(let v=0;v<y;v++)m.createDiv({cls:"event-dot"})}p.addEventListener("click",()=>{this.openDayModal(c)})}}renderTodayButton(t){t.createDiv({cls:"today-btn-container"}).createEl("button",{cls:"today-btn",text:"\uC624\uB298"}).addEventListener("click",()=>{let r=new Date;this.currentYear=r.getFullYear(),this.currentMonth=r.getMonth(),this.renderCalendar()})}navigateMonth(t){this.currentMonth+=t,this.currentMonth<0?(this.currentMonth=11,this.currentYear--):this.currentMonth>11&&(this.currentMonth=0,this.currentYear++),this.renderCalendar()}openDayModal(t){new Zo(this.app,t,this.dataProvider,this.settings).open()}};var gP=require("obsidian");var jy,z,WR,YA,bc,jo,GR,YR,KR,Xy={},XR=[],cU=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function or(i,e){for(var t in e)i[t]=e[t];return i}function JR(i){var e=i.parentNode;e&&e.removeChild(i)}function x(i,e,t){var n,s,r,o={};for(r in e)r=="key"?n=e[r]:r=="ref"?s=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?jy.call(arguments,2):t),typeof i=="function"&&i.defaultProps!=null)for(r in i.defaultProps)o[r]===void 0&&(o[r]=i.defaultProps[r]);return Ky(i,o,n,s,null)}function Ky(i,e,t,n,s){var r={type:i,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:s==null?++WR:s};return s==null&&z.vnode!=null&&z.vnode(r),r}function Ne(){return{current:null}}function ae(i){return i.children}function dU(i,e,t,n,s){var r;for(r in t)r==="children"||r==="key"||r in e||Jy(i,r,null,t[r],n);for(r in e)s&&typeof e[r]!="function"||r==="children"||r==="key"||r==="value"||r==="checked"||t[r]===e[r]||Jy(i,r,e[r],t[r],n)}function $R(i,e,t){e[0]==="-"?i.setProperty(e,t==null?"":t):i[e]=t==null?"":typeof t!="number"||cU.test(e)?t:t+"px"}function Jy(i,e,t,n,s){var r;e:if(e==="style")if(typeof t=="string")i.style.cssText=t;else{if(typeof n=="string"&&(i.style.cssText=n=""),n)for(e in n)t&&e in t||$R(i.style,e,"");if(t)for(e in t)n&&t[e]===n[e]||$R(i.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")r=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in i?e.toLowerCase().slice(2):e.slice(2),i.l||(i.l={}),i.l[e+r]=t,t?n||i.addEventListener(e,r?qR:zR,r):i.removeEventListener(e,r?qR:zR,r);else if(e!=="dangerouslySetInnerHTML"){if(s)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in i)try{i[e]=t==null?"":t;break e}catch(o){}typeof t=="function"||(t==null||t===!1&&e.indexOf("-")==-1?i.removeAttribute(e):i.setAttribute(e,t))}}function zR(i){bc=!0;try{return this.l[i.type+!1](z.event?z.event(i):i)}finally{bc=!1}}function qR(i){bc=!0;try{return this.l[i.type+!0](z.event?z.event(i):i)}finally{bc=!1}}function it(i,e){this.props=i,this.context=e}function $h(i,e){if(e==null)return i.__?$h(i.__,i.__.__k.indexOf(i)+1):null;for(var t;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null)return t.__e;return typeof i.type=="function"?$h(i):null}function ZR(i){var e,t;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,e=0;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null){i.__e=i.__c.base=t.__e;break}return ZR(i)}}function uU(i){bc?setTimeout(i):YR(i)}function WA(i){(!i.__d&&(i.__d=!0)&&jo.push(i)&&!Zy.__r++||GR!==z.debounceRendering)&&((GR=z.debounceRendering)||uU)(Zy)}function Zy(){var i,e,t,n,s,r,o,a;for(jo.sort(function(l,c){return l.__v.__b-c.__v.__b});i=jo.shift();)i.__d&&(e=jo.length,n=void 0,s=void 0,o=(r=(t=i).__v).__e,(a=t.__P)&&(n=[],(s=or({},r)).__v=r.__v+1,KA(a,r,s,t.__n,a.ownerSVGElement!==void 0,r.__h!=null?[o]:null,n,o==null?$h(r):o,r.__h),nI(n,r),r.__e!=o&&ZR(r)),jo.length>e&&jo.sort(function(l,c){return l.__v.__b-c.__v.__b}));Zy.__r=0}function jR(i,e,t,n,s,r,o,a,l,c){var d,h,p,m,y,v,E,A=n&&n.__k||XR,_=A.length;for(t.__k=[],d=0;d<e.length;d++)if((m=t.__k[d]=(m=e[d])==null||typeof m=="boolean"?null:typeof m=="string"||typeof m=="number"||typeof m=="bigint"?Ky(null,m,null,null,m):Array.isArray(m)?Ky(ae,{children:m},null,null,null):m.__b>0?Ky(m.type,m.props,m.key,m.ref?m.ref:null,m.__v):m)!=null){if(m.__=t,m.__b=t.__b+1,(p=A[d])===null||p&&m.key==p.key&&m.type===p.type)A[d]=void 0;else for(h=0;h<_;h++){if((p=A[h])&&m.key==p.key&&m.type===p.type){A[h]=void 0;break}p=null}KA(i,m,p=p||Xy,s,r,o,a,l,c),y=m.__e,(h=m.ref)&&p.ref!=h&&(E||(E=[]),p.ref&&E.push(p.ref,null,m),E.push(h,m.__c||y,m)),y!=null?(v==null&&(v=y),typeof m.type=="function"&&m.__k===p.__k?m.__d=l=QR(m,l,i):l=eI(i,m,p,A,y,l),typeof t.type=="function"&&(t.__d=l)):l&&p.__e==l&&l.parentNode!=i&&(l=$h(p))}for(t.__e=v,d=_;d--;)A[d]!=null&&(typeof t.type=="function"&&A[d].__e!=null&&A[d].__e==t.__d&&(t.__d=tI(n).nextSibling),sI(A[d],A[d]));if(E)for(d=0;d<E.length;d++)iI(E[d],E[++d],E[++d])}function QR(i,e,t){for(var n,s=i.__k,r=0;s&&r<s.length;r++)(n=s[r])&&(n.__=i,e=typeof n.type=="function"?QR(n,e,t):eI(t,n,n,s,n.__e,e));return e}function zh(i,e){return e=e||[],i==null||typeof i=="boolean"||(Array.isArray(i)?i.some(function(t){zh(t,e)}):e.push(i)),e}function eI(i,e,t,n,s,r){var o,a,l;if(e.__d!==void 0)o=e.__d,e.__d=void 0;else if(t==null||s!=r||s.parentNode==null)e:if(r==null||r.parentNode!==i)i.appendChild(s),o=null;else{for(a=r,l=0;(a=a.nextSibling)&&l<n.length;l+=1)if(a==s)break e;i.insertBefore(s,r),o=r}return o!==void 0?o:s.nextSibling}function tI(i){var e,t,n;if(i.type==null||typeof i.type=="string")return i.__e;if(i.__k){for(e=i.__k.length-1;e>=0;e--)if((t=i.__k[e])&&(n=tI(t)))return n}return null}function KA(i,e,t,n,s,r,o,a,l){var c,d,h,p,m,y,v,E,A,_,C,T,R,I,D,k=e.type;if(e.constructor!==void 0)return null;t.__h!=null&&(l=t.__h,a=e.__e=t.__e,e.__h=null,r=[a]),(c=z.__b)&&c(e);try{e:if(typeof k=="function"){if(E=e.props,A=(c=k.contextType)&&n[c.__c],_=c?A?A.props.value:c.__:n,t.__c?v=(d=e.__c=t.__c).__=d.__E:("prototype"in k&&k.prototype.render?e.__c=d=new k(E,_):(e.__c=d=new it(E,_),d.constructor=k,d.render=fU),A&&A.sub(d),d.props=E,d.state||(d.state={}),d.context=_,d.__n=n,h=d.__d=!0,d.__h=[],d._sb=[]),d.__s==null&&(d.__s=d.state),k.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=or({},d.__s)),or(d.__s,k.getDerivedStateFromProps(E,d.__s))),p=d.props,m=d.state,d.__v=e,h)k.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(k.getDerivedStateFromProps==null&&E!==p&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(E,_),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(E,d.__s,_)===!1||e.__v===t.__v){for(e.__v!==t.__v&&(d.props=E,d.state=d.__s,d.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.forEach(function(N){N&&(N.__=e)}),C=0;C<d._sb.length;C++)d.__h.push(d._sb[C]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(E,d.__s,_),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(p,m,y)})}if(d.context=_,d.props=E,d.__P=i,T=z.__r,R=0,"prototype"in k&&k.prototype.render){for(d.state=d.__s,d.__d=!1,T&&T(e),c=d.render(d.props,d.state,d.context),I=0;I<d._sb.length;I++)d.__h.push(d._sb[I]);d._sb=[]}else do d.__d=!1,T&&T(e),c=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++R<25);d.state=d.__s,d.getChildContext!=null&&(n=or(or({},n),d.getChildContext())),h||d.getSnapshotBeforeUpdate==null||(y=d.getSnapshotBeforeUpdate(p,m)),D=c!=null&&c.type===ae&&c.key==null?c.props.children:c,jR(i,Array.isArray(D)?D:[D],e,t,n,s,r,o,a,l),d.base=e.__e,e.__h=null,d.__h.length&&o.push(d),v&&(d.__E=d.__=null),d.__e=!1}else r==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=hU(t.__e,e,t,n,s,r,o,l);(c=z.diffed)&&c(e)}catch(N){e.__v=null,(l||r!=null)&&(e.__e=a,e.__h=!!l,r[r.indexOf(a)]=null),z.__e(N,e,t)}}function nI(i,e){z.__c&&z.__c(e,i),i.some(function(t){try{i=t.__h,t.__h=[],i.some(function(n){n.call(t)})}catch(n){z.__e(n,t.__v)}})}function hU(i,e,t,n,s,r,o,a){var l,c,d,h=t.props,p=e.props,m=e.type,y=0;if(m==="svg"&&(s=!0),r!=null){for(;y<r.length;y++)if((l=r[y])&&"setAttribute"in l==!!m&&(m?l.localName===m:l.nodeType===3)){i=l,r[y]=null;break}}if(i==null){if(m===null)return document.createTextNode(p);i=s?document.createElementNS("http://www.w3.org/2000/svg",m):document.createElement(m,p.is&&p),r=null,a=!1}if(m===null)h===p||a&&i.data===p||(i.data=p);else{if(r=r&&jy.call(i.childNodes),c=(h=t.props||Xy).dangerouslySetInnerHTML,d=p.dangerouslySetInnerHTML,!a){if(r!=null)for(h={},y=0;y<i.attributes.length;y++)h[i.attributes[y].name]=i.attributes[y].value;(d||c)&&(d&&(c&&d.__html==c.__html||d.__html===i.innerHTML)||(i.innerHTML=d&&d.__html||""))}if(dU(i,p,h,s,a),d)e.__k=[];else if(y=e.props.children,jR(i,Array.isArray(y)?y:[y],e,t,n,s&&m!=="foreignObject",r,o,r?r[0]:t.__k&&$h(t,0),a),r!=null)for(y=r.length;y--;)r[y]!=null&&JR(r[y]);a||("value"in p&&(y=p.value)!==void 0&&(y!==i.value||m==="progress"&&!y||m==="option"&&y!==h.value)&&Jy(i,"value",y,h.value,!1),"checked"in p&&(y=p.checked)!==void 0&&y!==i.checked&&Jy(i,"checked",y,h.checked,!1))}return i}function iI(i,e,t){try{typeof i=="function"?i(e):i.current=e}catch(n){z.__e(n,t)}}function sI(i,e,t){var n,s;if(z.unmount&&z.unmount(i),(n=i.ref)&&(n.current&&n.current!==i.__e||iI(n,null,e)),(n=i.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(r){z.__e(r,e)}n.base=n.__P=null,i.__c=void 0}if(n=i.__k)for(s=0;s<n.length;s++)n[s]&&sI(n[s],e,t||typeof i.type!="function");t||i.__e==null||JR(i.__e),i.__=i.__e=i.__d=void 0}function fU(i,e,t){return this.constructor(i,t)}function ar(i,e,t){var n,s,r;z.__&&z.__(i,e),s=(n=typeof t=="function")?null:t&&t.__k||e.__k,r=[],KA(e,i=(!n&&t||e).__k=x(ae,null,[i]),s||Xy,Xy,e.ownerSVGElement!==void 0,!n&&t?[t]:s?null:e.firstChild?jy.call(e.childNodes):null,r,!n&&t?t:s?s.__e:e.firstChild,n),nI(r,i)}function Qy(i,e){var t={__c:e="__cC"+KR++,__:i,Consumer:function(n,s){return n.children(s)},Provider:function(n){var s,r;return this.getChildContext||(s=[],(r={})[e]=this,this.getChildContext=function(){return r},this.shouldComponentUpdate=function(o){this.props.value!==o.value&&s.some(function(a){a.__e=!0,WA(a)})},this.sub=function(o){s.push(o);var a=o.componentWillUnmount;o.componentWillUnmount=function(){s.splice(s.indexOf(o),1),a&&a.call(o)}}),n.children}};return t.Provider.__=t.Consumer.contextType=t}jy=XR.slice,z={__e:function(i,e,t,n){for(var s,r,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((r=s.constructor)&&r.getDerivedStateFromError!=null&&(s.setState(r.getDerivedStateFromError(i)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(i,n||{}),o=s.__d),o)return s.__E=s}catch(a){i=a}throw i}},WR=0,YA=function(i){return i!=null&&i.constructor===void 0},bc=!1,it.prototype.setState=function(i,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=or({},this.state),typeof i=="function"&&(i=i(or({},t),this.props)),i&&or(t,i),i!=null&&this.__v&&(e&&this._sb.push(e),WA(this))},it.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),WA(this))},it.prototype.render=ae,jo=[],YR=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Zy.__r=0,KR=0;var gU,yi,XA,rI;var hI=[],JA=[],oI=z.__b,aI=z.__r,lI=z.diffed,cI=z.__c,dI=z.unmount;function mU(){for(var i;i=hI.shift();)if(i.__P&&i.__H)try{i.__H.__h.forEach(ev),i.__H.__h.forEach(ZA),i.__H.__h=[]}catch(e){i.__H.__h=[],z.__e(e,i.__v)}}z.__b=function(i){yi=null,oI&&oI(i)},z.__r=function(i){aI&&aI(i),gU=0;var e=(yi=i.__c).__H;e&&(XA===yi?(e.__h=[],yi.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.__V=JA,t.__N=t.i=void 0})):(e.__h.forEach(ev),e.__h.forEach(ZA),e.__h=[])),XA=yi},z.diffed=function(i){lI&&lI(i);var e=i.__c;e&&e.__H&&(e.__H.__h.length&&(hI.push(e)!==1&&rI===z.requestAnimationFrame||((rI=z.requestAnimationFrame)||yU)(mU)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.__V!==JA&&(t.__=t.__V),t.i=void 0,t.__V=JA})),XA=yi=null},z.__c=function(i,e){e.some(function(t){try{t.__h.forEach(ev),t.__h=t.__h.filter(function(n){return!n.__||ZA(n)})}catch(n){e.some(function(s){s.__h&&(s.__h=[])}),e=[],z.__e(n,t.__v)}}),cI&&cI(i,e)},z.unmount=function(i){dI&&dI(i);var e,t=i.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{ev(n)}catch(s){e=s}}),t.__H=void 0,e&&z.__e(e,t.__v))};var uI=typeof requestAnimationFrame=="function";function yU(i){var e,t=function(){clearTimeout(n),uI&&cancelAnimationFrame(e),setTimeout(i)},n=setTimeout(t,100);uI&&(e=requestAnimationFrame(t))}function ev(i){var e=yi,t=i.__c;typeof t=="function"&&(i.__c=void 0,t()),yi=e}function ZA(i){var e=yi;i.__c=i.__(),yi=e}function vU(i,e){for(var t in e)i[t]=e[t];return i}function fI(i,e){for(var t in i)if(t!=="__source"&&!(t in e))return!0;for(var n in e)if(n!=="__source"&&i[n]!==e[n])return!0;return!1}function pI(i){this.props=i}(pI.prototype=new it).isPureReactComponent=!0,pI.prototype.shouldComponentUpdate=function(i,e){return fI(this.props,i)||fI(this.state,e)};var gI=z.__b;z.__b=function(i){i.type&&i.type.__f&&i.ref&&(i.props.ref=i.ref,i.ref=null),gI&&gI(i)};var yz=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;var bU=z.__e;z.__e=function(i,e,t,n){if(i.then){for(var s,r=e;r=r.__;)if((s=r.__c)&&s.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),s.__c(i,e)}bU(i,e,t,n)};var mI=z.unmount;function AI(i,e,t){return i&&(i.__c&&i.__c.__H&&(i.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),i.__c.__H=null),(i=vU({},i)).__c!=null&&(i.__c.__P===t&&(i.__c.__P=e),i.__c=null),i.__k=i.__k&&i.__k.map(function(n){return AI(n,e,t)})),i}function SI(i,e,t){return i&&(i.__v=null,i.__k=i.__k&&i.__k.map(function(n){return SI(n,e,t)}),i.__c&&i.__c.__P===e&&(i.__e&&t.insertBefore(i.__e,i.__d),i.__c.__e=!0,i.__c.__P=t)),i}function jA(){this.__u=0,this.t=null,this.__b=null}function _I(i){var e=i.__.__c;return e&&e.__a&&e.__a(i)}function tv(){this.u=null,this.o=null}z.unmount=function(i){var e=i.__c;e&&e.__R&&e.__R(),e&&i.__h===!0&&(i.type=null),mI&&mI(i)},(jA.prototype=new it).__c=function(i,e){var t=e.__c,n=this;n.t==null&&(n.t=[]),n.t.push(t);var s=_I(n.__v),r=!1,o=function(){r||(r=!0,t.__R=null,s?s(a):a())};t.__R=o;var a=function(){if(!--n.__u){if(n.state.__a){var c=n.state.__a;n.__v.__k[0]=SI(c,c.__c.__P,c.__c.__O)}var d;for(n.setState({__a:n.__b=null});d=n.t.pop();)d.forceUpdate()}},l=e.__h===!0;n.__u++||l||n.setState({__a:n.__b=n.__v.__k[0]}),i.then(o,o)},jA.prototype.componentWillUnmount=function(){this.t=[]},jA.prototype.render=function(i,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=AI(this.__b,t,n.__O=n.__P)}this.__b=null}var s=e.__a&&x(ae,null,i.fallback);return s&&(s.__h=null),[x(ae,null,e.__a?null:i.children),s]};var yI=function(i,e,t){if(++t[1]===t[0]&&i.o.delete(e),i.props.revealOrder&&(i.props.revealOrder[0]!=="t"||!i.o.size))for(t=i.u;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;i.u=t=t[2]}};function EU(i){return this.getChildContext=function(){return i.context},i.children}function wU(i){var e=this,t=i.i;e.componentWillUnmount=function(){ar(null,e.l),e.l=null,e.i=null},e.i&&e.i!==t&&e.componentWillUnmount(),i.__v?(e.l||(e.i=t,e.l={nodeType:1,parentNode:t,childNodes:[],appendChild:function(n){this.childNodes.push(n),e.i.appendChild(n)},insertBefore:function(n,s){this.childNodes.push(n),e.i.appendChild(n)},removeChild:function(n){this.childNodes.splice(this.childNodes.indexOf(n)>>>1,1),e.i.removeChild(n)}}),ar(x(EU,{context:e.context},i.__v),e.l)):e.l&&e.componentWillUnmount()}function CI(i,e){var t=x(wU,{__v:i,i:e});return t.containerInfo=e,t}(tv.prototype=new it).__a=function(i){var e=this,t=_I(e.__v),n=e.o.get(i);return n[0]++,function(s){var r=function(){e.props.revealOrder?(n.push(s),yI(e,i,n)):s()};t?t(r):r()}},tv.prototype.render=function(i){this.u=null,this.o=new Map;var e=zh(i.children);i.revealOrder&&i.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.o.set(e[t],this.u=[1,0,this.u]);return i.children},tv.prototype.componentDidUpdate=tv.prototype.componentDidMount=function(){var i=this;this.o.forEach(function(e,t){yI(i,t,e)})};var AU=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,SU=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,_U=typeof document!="undefined",CU=function(i){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(i)};it.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(i){Object.defineProperty(it.prototype,i,{configurable:!0,get:function(){return this["UNSAFE_"+i]},set:function(e){Object.defineProperty(this,i,{configurable:!0,writable:!0,value:e})}})});var vI=z.event;function TU(){}function xU(){return this.cancelBubble}function RU(){return this.defaultPrevented}z.event=function(i){return vI&&(i=vI(i)),i.persist=TU,i.isPropagationStopped=xU,i.isDefaultPrevented=RU,i.nativeEvent=i};var IU,bI={configurable:!0,get:function(){return this.class}},EI=z.vnode;z.vnode=function(i){var e=i.type,t=i.props,n=t;if(typeof e=="string"){var s=e.indexOf("-")===-1;for(var r in n={},t){var o=t[r];_U&&r==="children"&&e==="noscript"||r==="value"&&"defaultValue"in t&&o==null||(r==="defaultValue"&&"value"in t&&t.value==null?r="value":r==="download"&&o===!0?o="":/ondoubleclick/i.test(r)?r="ondblclick":/^onchange(textarea|input)/i.test(r+e)&&!CU(t.type)?r="oninput":/^onfocus$/i.test(r)?r="onfocusin":/^onblur$/i.test(r)?r="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(r)?r=r.toLowerCase():s&&SU.test(r)?r=r.replace(/[A-Z0-9]/g,"-$&").toLowerCase():o===null&&(o=void 0),/^oninput$/i.test(r)&&(r=r.toLowerCase(),n[r]&&(r="oninputCapture")),n[r]=o)}e=="select"&&n.multiple&&Array.isArray(n.value)&&(n.value=zh(t.children).forEach(function(a){a.props.selected=n.value.indexOf(a.props.value)!=-1})),e=="select"&&n.defaultValue!=null&&(n.value=zh(t.children).forEach(function(a){a.props.selected=n.multiple?n.defaultValue.indexOf(a.props.value)!=-1:n.defaultValue==a.props.value})),i.props=n,t.class!=t.className&&(bI.enumerable="className"in t,t.className!=null&&(n.class=t.className),Object.defineProperty(n,"className",bI))}i.$$typeof=AU,EI&&EI(i)};var wI=z.__r;z.__r=function(i){wI&&wI(i),IU=i.__c};var HI=[],cS=new Map;function gr(i){HI.push(i),cS.forEach(e=>{GI(e,i)})}function BI(i){i.isConnected&&i.getRootNode&&VI(i.getRootNode())}function VI(i){let e=cS.get(i);if(!e||!e.isConnected){if(e=i.querySelector("style[data-fullcalendar]"),!e){e=document.createElement("style"),e.setAttribute("data-fullcalendar","");let t=PU();t&&(e.nonce=t);let n=i===document?document.head:i,s=i===document?n.querySelector("script,link[rel=stylesheet],link[as=style],style"):n.firstChild;n.insertBefore(e,s)}cS.set(i,e),DU(e)}}function DU(i){for(let e of HI)GI(i,e)}function GI(i,e){let{sheet:t}=i,n=t.cssRules.length;e.split("}").forEach((s,r)=>{s=s.trim(),s&&t.insertRule(s+"}",n+r)})}var QA;function PU(){return QA===void 0&&(QA=MU()),QA}function MU(){let i=document.querySelector('meta[name="csp-nonce"]');if(i&&i.hasAttribute("content"))return i.getAttribute("content");let e=document.querySelector("script[nonce]");return e&&e.nonce||""}typeof document!="undefined"&&VI(document);var kU=':root{--fc-small-font-size:.85em;--fc-page-bg-color:#fff;--fc-neutral-bg-color:hsla(0,0%,82%,.3);--fc-neutral-text-color:grey;--fc-border-color:#ddd;--fc-button-text-color:#fff;--fc-button-bg-color:#2c3e50;--fc-button-border-color:#2c3e50;--fc-button-hover-bg-color:#1e2b37;--fc-button-hover-border-color:#1a252f;--fc-button-active-bg-color:#1a252f;--fc-button-active-border-color:#151e27;--fc-event-bg-color:#3788d8;--fc-event-border-color:#3788d8;--fc-event-text-color:#fff;--fc-event-selected-overlay-color:rgba(0,0,0,.25);--fc-more-link-bg-color:#d0d0d0;--fc-more-link-text-color:inherit;--fc-event-resizer-thickness:8px;--fc-event-resizer-dot-total-width:8px;--fc-event-resizer-dot-border-width:1px;--fc-non-business-color:hsla(0,0%,84%,.3);--fc-bg-event-color:#8fdf82;--fc-bg-event-opacity:0.3;--fc-highlight-color:rgba(188,232,241,.3);--fc-today-bg-color:rgba(255,220,40,.15);--fc-now-indicator-color:red}.fc-not-allowed,.fc-not-allowed .fc-event{cursor:not-allowed}.fc{display:flex;flex-direction:column;font-size:1em}.fc,.fc *,.fc :after,.fc :before{box-sizing:border-box}.fc table{border-collapse:collapse;border-spacing:0;font-size:1em}.fc th{text-align:center}.fc td,.fc th{padding:0;vertical-align:top}.fc a[data-navlink]{cursor:pointer}.fc a[data-navlink]:hover{text-decoration:underline}.fc-direction-ltr{direction:ltr;text-align:left}.fc-direction-rtl{direction:rtl;text-align:right}.fc-theme-standard td,.fc-theme-standard th{border:1px solid var(--fc-border-color)}.fc-liquid-hack td,.fc-liquid-hack th{position:relative}@font-face{font-family:fcicons;font-style:normal;font-weight:400;src:url("data:application/x-font-ttf;charset=utf-8;base64,AAEAAAALAIAAAwAwT1MvMg8SBfAAAAC8AAAAYGNtYXAXVtKNAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZgYydxIAAAF4AAAFNGhlYWQUJ7cIAAAGrAAAADZoaGVhB20DzAAABuQAAAAkaG10eCIABhQAAAcIAAAALGxvY2ED4AU6AAAHNAAAABhtYXhwAA8AjAAAB0wAAAAgbmFtZXsr690AAAdsAAABhnBvc3QAAwAAAAAI9AAAACAAAwPAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBgPA/8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qb//f//AAAAAAAg6QD//f//AAH/4xcEAAMAAQAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAWIAjQKeAskAEwAAJSc3NjQnJiIHAQYUFwEWMjc2NCcCnuLiDQ0MJAz/AA0NAQAMJAwNDcni4gwjDQwM/wANIwz/AA0NDCMNAAAAAQFiAI0CngLJABMAACUBNjQnASYiBwYUHwEHBhQXFjI3AZ4BAA0N/wAMJAwNDeLiDQ0MJAyNAQAMIw0BAAwMDSMM4uINIwwNDQAAAAIA4gC3Ax4CngATACcAACUnNzY0JyYiDwEGFB8BFjI3NjQnISc3NjQnJiIPAQYUHwEWMjc2NCcB87e3DQ0MIw3VDQ3VDSMMDQ0BK7e3DQ0MJAzVDQ3VDCQMDQ3zuLcMJAwNDdUNIwzWDAwNIwy4twwkDA0N1Q0jDNYMDA0jDAAAAgDiALcDHgKeABMAJwAAJTc2NC8BJiIHBhQfAQcGFBcWMjchNzY0LwEmIgcGFB8BBwYUFxYyNwJJ1Q0N1Q0jDA0Nt7cNDQwjDf7V1Q0N1QwkDA0Nt7cNDQwkDLfWDCMN1Q0NDCQMt7gMIw0MDNYMIw3VDQ0MJAy3uAwjDQwMAAADAFUAAAOrA1UAMwBoAHcAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMhMjY1NCYjISIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAAVYRGRkR/qoRGRkRA1UFBAUOCQkVDAsZDf2rDRkLDBUJCA4FBQUFBQUOCQgVDAsZDQJVDRkLDBUJCQ4FBAVVAgECBQMCBwQECAX9qwQJAwQHAwMFAQICAgIBBQMDBwQDCQQCVQUIBAQHAgMFAgEC/oAZEhEZGRESGQAAAAADAFUAAAOrA1UAMwBoAIkAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMzFRQWMzI2PQEzMjY1NCYrATU0JiMiBh0BIyIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAgBkSEhmAERkZEYAZEhIZgBEZGREDVQUEBQ4JCRUMCxkN/asNGQsMFQkIDgUFBQUFBQ4JCBUMCxkNAlUNGQsMFQkJDgUEBVUCAQIFAwIHBAQIBf2rBAkDBAcDAwUBAgICAgEFAwMHBAMJBAJVBQgEBAcCAwUCAQL+gIASGRkSgBkSERmAEhkZEoAZERIZAAABAOIAjQMeAskAIAAAExcHBhQXFjI/ARcWMjc2NC8BNzY0JyYiDwEnJiIHBhQX4uLiDQ0MJAzi4gwkDA0N4uINDQwkDOLiDCQMDQ0CjeLiDSMMDQ3h4Q0NDCMN4uIMIw0MDOLiDAwNIwwAAAABAAAAAQAAa5n0y18PPPUACwQAAAAAANivOVsAAAAA2K85WwAAAAADqwNVAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAOrAAEAAAAAAAAAAAAAAAAAAAALBAAAAAAAAAAAAAAAAgAAAAQAAWIEAAFiBAAA4gQAAOIEAABVBAAAVQQAAOIAAAAAAAoAFAAeAEQAagCqAOoBngJkApoAAQAAAAsAigADAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGZjaWNvbnMAZgBjAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGZjaWNvbnMAZgBjAGkAYwBvAG4Ac2ZjaWNvbnMAZgBjAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmZjaWNvbnMAZgBjAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("truetype")}.fc-icon{speak:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font-family:fcicons!important;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1;text-align:center;text-transform:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1em}.fc-icon-chevron-left:before{content:"\\e900"}.fc-icon-chevron-right:before{content:"\\e901"}.fc-icon-chevrons-left:before{content:"\\e902"}.fc-icon-chevrons-right:before{content:"\\e903"}.fc-icon-minus-square:before{content:"\\e904"}.fc-icon-plus-square:before{content:"\\e905"}.fc-icon-x:before{content:"\\e906"}.fc .fc-button{border-radius:0;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible;text-transform:none}.fc .fc-button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}.fc .fc-button{-webkit-appearance:button}.fc .fc-button:not(:disabled){cursor:pointer}.fc .fc-button{background-color:transparent;border:1px solid transparent;border-radius:.25em;display:inline-block;font-size:1em;font-weight:400;line-height:1.5;padding:.4em .65em;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}.fc .fc-button:hover{text-decoration:none}.fc .fc-button:focus{box-shadow:0 0 0 .2rem rgba(44,62,80,.25);outline:0}.fc .fc-button:disabled{opacity:.65}.fc .fc-button-primary{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:hover{background-color:var(--fc-button-hover-bg-color);border-color:var(--fc-button-hover-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:disabled{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button-primary:not(:disabled).fc-button-active,.fc .fc-button-primary:not(:disabled):active{background-color:var(--fc-button-active-bg-color);border-color:var(--fc-button-active-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:not(:disabled).fc-button-active:focus,.fc .fc-button-primary:not(:disabled):active:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button .fc-icon{font-size:1.5em;vertical-align:middle}.fc .fc-button-group{display:inline-flex;position:relative;vertical-align:middle}.fc .fc-button-group>.fc-button{flex:1 1 auto;position:relative}.fc .fc-button-group>.fc-button.fc-button-active,.fc .fc-button-group>.fc-button:active,.fc .fc-button-group>.fc-button:focus,.fc .fc-button-group>.fc-button:hover{z-index:1}.fc-direction-ltr .fc-button-group>.fc-button:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0;margin-left:-1px}.fc-direction-ltr .fc-button-group>.fc-button:not(:last-child){border-bottom-right-radius:0;border-top-right-radius:0}.fc-direction-rtl .fc-button-group>.fc-button:not(:first-child){border-bottom-right-radius:0;border-top-right-radius:0;margin-right:-1px}.fc-direction-rtl .fc-button-group>.fc-button:not(:last-child){border-bottom-left-radius:0;border-top-left-radius:0}.fc .fc-toolbar{align-items:center;display:flex;justify-content:space-between}.fc .fc-toolbar.fc-header-toolbar{margin-bottom:1.5em}.fc .fc-toolbar.fc-footer-toolbar{margin-top:1.5em}.fc .fc-toolbar-title{font-size:1.75em;margin:0}.fc-direction-ltr .fc-toolbar>*>:not(:first-child){margin-left:.75em}.fc-direction-rtl .fc-toolbar>*>:not(:first-child){margin-right:.75em}.fc-direction-rtl .fc-toolbar-ltr{flex-direction:row-reverse}.fc .fc-scroller{-webkit-overflow-scrolling:touch;position:relative}.fc .fc-scroller-liquid{height:100%}.fc .fc-scroller-liquid-absolute{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-scroller-harness{direction:ltr;overflow:hidden;position:relative}.fc .fc-scroller-harness-liquid{height:100%}.fc-direction-rtl .fc-scroller-harness>.fc-scroller{direction:rtl}.fc-theme-standard .fc-scrollgrid{border:1px solid var(--fc-border-color)}.fc .fc-scrollgrid,.fc .fc-scrollgrid table{table-layout:fixed;width:100%}.fc .fc-scrollgrid table{border-left-style:hidden;border-right-style:hidden;border-top-style:hidden}.fc .fc-scrollgrid{border-bottom-width:0;border-collapse:separate;border-right-width:0}.fc .fc-scrollgrid-liquid{height:100%}.fc .fc-scrollgrid-section,.fc .fc-scrollgrid-section table,.fc .fc-scrollgrid-section>td{height:1px}.fc .fc-scrollgrid-section-liquid>td{height:100%}.fc .fc-scrollgrid-section>*{border-left-width:0;border-top-width:0}.fc .fc-scrollgrid-section-footer>*,.fc .fc-scrollgrid-section-header>*{border-bottom-width:0}.fc .fc-scrollgrid-section-body table,.fc .fc-scrollgrid-section-footer table{border-bottom-style:hidden}.fc .fc-scrollgrid-section-sticky>*{background:var(--fc-page-bg-color);position:sticky;z-index:3}.fc .fc-scrollgrid-section-header.fc-scrollgrid-section-sticky>*{top:0}.fc .fc-scrollgrid-section-footer.fc-scrollgrid-section-sticky>*{bottom:0}.fc .fc-scrollgrid-sticky-shim{height:1px;margin-bottom:-1px}.fc-sticky{position:sticky}.fc .fc-view-harness{flex-grow:1;position:relative}.fc .fc-view-harness-active>.fc-view{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-col-header-cell-cushion{display:inline-block;padding:2px 4px}.fc .fc-bg-event,.fc .fc-highlight,.fc .fc-non-business{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-non-business{background:var(--fc-non-business-color)}.fc .fc-bg-event{background:var(--fc-bg-event-color);opacity:var(--fc-bg-event-opacity)}.fc .fc-bg-event .fc-event-title{font-size:var(--fc-small-font-size);font-style:italic;margin:.5em}.fc .fc-highlight{background:var(--fc-highlight-color)}.fc .fc-cell-shaded,.fc .fc-day-disabled{background:var(--fc-neutral-bg-color)}a.fc-event,a.fc-event:hover{text-decoration:none}.fc-event.fc-event-draggable,.fc-event[href]{cursor:pointer}.fc-event .fc-event-main{position:relative;z-index:2}.fc-event-dragging:not(.fc-event-selected){opacity:.75}.fc-event-dragging.fc-event-selected{box-shadow:0 2px 7px rgba(0,0,0,.3)}.fc-event .fc-event-resizer{display:none;position:absolute;z-index:4}.fc-event-selected .fc-event-resizer,.fc-event:hover .fc-event-resizer{display:block}.fc-event-selected .fc-event-resizer{background:var(--fc-page-bg-color);border-color:inherit;border-radius:calc(var(--fc-event-resizer-dot-total-width)/2);border-style:solid;border-width:var(--fc-event-resizer-dot-border-width);height:var(--fc-event-resizer-dot-total-width);width:var(--fc-event-resizer-dot-total-width)}.fc-event-selected .fc-event-resizer:before{bottom:-20px;content:"";left:-20px;position:absolute;right:-20px;top:-20px}.fc-event-selected,.fc-event:focus{box-shadow:0 2px 5px rgba(0,0,0,.2)}.fc-event-selected:before,.fc-event:focus:before{bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3}.fc-event-selected:after,.fc-event:focus:after{background:var(--fc-event-selected-overlay-color);bottom:-1px;content:"";left:-1px;position:absolute;right:-1px;top:-1px;z-index:1}.fc-h-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-h-event .fc-event-main{color:var(--fc-event-text-color)}.fc-h-event .fc-event-main-frame{display:flex}.fc-h-event .fc-event-time{max-width:100%;overflow:hidden}.fc-h-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-width:0}.fc-h-event .fc-event-title{display:inline-block;left:0;max-width:100%;overflow:hidden;right:0;vertical-align:top}.fc-h-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-start),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-end){border-bottom-left-radius:0;border-left-width:0;border-top-left-radius:0}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-end),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-start){border-bottom-right-radius:0;border-right-width:0;border-top-right-radius:0}.fc-h-event:not(.fc-event-selected) .fc-event-resizer{bottom:0;top:0;width:var(--fc-event-resizer-thickness)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end{cursor:w-resize;left:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start{cursor:e-resize;right:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-h-event.fc-event-selected .fc-event-resizer{margin-top:calc(var(--fc-event-resizer-dot-total-width)*-.5);top:50%}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-start,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-end{left:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-end,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-start{right:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc .fc-popover{box-shadow:0 2px 6px rgba(0,0,0,.15);position:absolute;z-index:9999}.fc .fc-popover-header{align-items:center;display:flex;flex-direction:row;justify-content:space-between;padding:3px 4px}.fc .fc-popover-title{margin:0 2px}.fc .fc-popover-close{cursor:pointer;font-size:1.1em;opacity:.65}.fc-theme-standard .fc-popover{background:var(--fc-page-bg-color);border:1px solid var(--fc-border-color)}.fc-theme-standard .fc-popover-header{background:var(--fc-neutral-bg-color)}';gr(kU);var ta=class{constructor(e){this.drainedOption=e,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}request(e){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),e==null?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),e))}pause(e=""){let{pauseDepths:t}=this;t[e]=(t[e]||0)+1,this.clearTimeout()}resume(e="",t){let{pauseDepths:n}=this;e in n&&(t?delete n[e]:(n[e]-=1,n[e]<=0&&delete n[e]),this.tryDrain())}isPaused(){return Object.keys(this.pauseDepths).length}tryDrain(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}}clear(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)}drained(){this.drainedOption&&this.drainedOption()}};function lf(i){i.parentNode&&i.parentNode.removeChild(i)}function Ve(i,e){if(i.closest)return i.closest(e);if(!document.documentElement.contains(i))return null;do{if(bS(i,e))return i;i=i.parentElement||i.parentNode}while(i!==null&&i.nodeType===1);return null}function bS(i,e){return(i.matches||i.matchesSelector||i.msMatchesSelector).call(i,e)}function $I(i,e){let t=i instanceof HTMLElement?[i]:i,n=[];for(let s=0;s<t.length;s+=1){let r=t[s].querySelectorAll(e);for(let o=0;o<r.length;o+=1)n.push(r[o])}return n}var NU=/(top|left|right|bottom|width|height)$/i;function ha(i,e){for(let t in e)ES(i,t,e[t])}function ES(i,e,t){t==null?i.style[e]="":typeof t=="number"&&NU.test(e)?i.style[e]=`${t}px`:i.style[e]=t}function bv(i){var e,t;return(t=(e=i.composedPath)===null||e===void 0?void 0:e.call(i)[0])!==null&&t!==void 0?t:i.target}var TI=0;function vn(){return TI+=1,"fc-dom-"+TI}function cf(i){i.preventDefault()}function FU(i,e){return t=>{let n=Ve(t.target,i);n&&e.call(n,t,n)}}function wS(i,e,t,n){let s=FU(t,n);return i.addEventListener(e,s),()=>{i.removeEventListener(e,s)}}function zI(i,e,t,n){let s;return wS(i,"mouseover",e,(r,o)=>{if(o!==s){s=o,t(r,o);let a=l=>{s=null,n(l,o),o.removeEventListener("mouseleave",a)};o.addEventListener("mouseleave",a)}})}var xI=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"];function AS(i,e){let t=n=>{e(n),xI.forEach(s=>{i.removeEventListener(s,t)})};xI.forEach(n=>{i.addEventListener(n,t)})}function qI(i){return Object.assign({onClick:i},WI(i))}function WI(i){return{tabIndex:0,onKeyDown(e){(e.key==="Enter"||e.key===" ")&&(i(e),e.preventDefault())}}}var RI=0;function gs(){return RI+=1,String(RI)}function df(){document.body.classList.add("fc-not-allowed")}function uf(){document.body.classList.remove("fc-not-allowed")}function SS(i){i.style.userSelect="none",i.style.webkitUserSelect="none",i.addEventListener("selectstart",cf)}function _S(i){i.style.userSelect="",i.style.webkitUserSelect="",i.removeEventListener("selectstart",cf)}function CS(i){i.addEventListener("contextmenu",cf)}function TS(i){i.removeEventListener("contextmenu",cf)}function YI(i){let e=[],t=[],n,s;for(typeof i=="string"?t=i.split(/\s*,\s*/):typeof i=="function"?t=[i]:Array.isArray(i)&&(t=i),n=0;n<t.length;n+=1)s=t[n],typeof s=="string"?e.push(s.charAt(0)==="-"?{field:s.substring(1),order:-1}:{field:s,order:1}):typeof s=="function"&&e.push({func:s});return e}function KI(i,e,t){let n,s;for(n=0;n<t.length;n+=1)if(s=LU(i,e,t[n]),s)return s;return 0}function LU(i,e,t){return t.func?t.func(i,e):XI(i[t.field],e[t.field])*(t.order||1)}function XI(i,e){return!i&&!e?0:e==null?-1:i==null?1:typeof i=="string"||typeof e=="string"?String(i).localeCompare(String(e)):i-e}function ea(i,e){let t=String(i);return"000".substr(0,e-t.length)+t}function _c(i,e,t){return typeof i=="function"?i(...e):typeof i=="string"?e.reduce((n,s,r)=>n.replace("$"+r,s||""),i):t}function xS(i,e){return i-e}function qh(i){return i%1===0}function OU(i){let e=i.querySelector(".fc-scrollgrid-shrink-frame"),t=i.querySelector(".fc-scrollgrid-shrink-cushion");if(!e)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!t)throw new Error("needs fc-scrollgrid-shrink-cushion className");return i.getBoundingClientRect().width-e.getBoundingClientRect().width+t.getBoundingClientRect().width}var II=["years","months","days","milliseconds"],UU=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function te(i,e){return typeof i=="string"?HU(i):typeof i=="object"&&i?DI(i):typeof i=="number"?DI({[e||"milliseconds"]:i}):null}function HU(i){let e=UU.exec(i);if(e){let t=e[1]?-1:1;return{years:0,months:0,days:t*(e[2]?parseInt(e[2],10):0),milliseconds:t*((e[3]?parseInt(e[3],10):0)*60*60*1e3+(e[4]?parseInt(e[4],10):0)*60*1e3+(e[5]?parseInt(e[5],10):0)*1e3+(e[6]?parseInt(e[6],10):0))}}return null}function DI(i){let e={years:i.years||i.year||0,months:i.months||i.month||0,days:i.days||i.day||0,milliseconds:(i.hours||i.hour||0)*60*60*1e3+(i.minutes||i.minute||0)*60*1e3+(i.seconds||i.second||0)*1e3+(i.milliseconds||i.millisecond||i.ms||0)},t=i.weeks||i.week;return t&&(e.days+=t*7,e.specifiedWeeks=!0),e}function BU(i,e){return i.years===e.years&&i.months===e.months&&i.days===e.days&&i.milliseconds===e.milliseconds}function hf(i,e){return{years:i.years+e.years,months:i.months+e.months,days:i.days+e.days,milliseconds:i.milliseconds+e.milliseconds}}function JI(i,e){return{years:i.years-e.years,months:i.months-e.months,days:i.days-e.days,milliseconds:i.milliseconds-e.milliseconds}}function RS(i,e){return{years:i.years*e,months:i.months*e,days:i.days*e,milliseconds:i.milliseconds*e}}function VU(i){return Ec(i)/365}function GU(i){return Ec(i)/30}function Ec(i){return en(i)/864e5}function en(i){return i.years*(365*864e5)+i.months*(30*864e5)+i.days*864e5+i.milliseconds}function ff(i,e){let t=null;for(let n=0;n<II.length;n+=1){let s=II[n];if(e[s]){let r=i[s]/e[s];if(!qh(r)||t!==null&&t!==r)return null;t=r}else if(i[s])return null}return t}function Wh(i){let e=i.milliseconds;if(e){if(e%1e3!==0)return{unit:"millisecond",value:e};if(e%(1e3*60)!==0)return{unit:"second",value:e/1e3};if(e%(1e3*60*60)!==0)return{unit:"minute",value:e/(1e3*60)};if(e)return{unit:"hour",value:e/(1e3*60*60)}}return i.days?i.specifiedWeeks&&i.days%7===0?{unit:"week",value:i.days/7}:{unit:"day",value:i.days}:i.months?{unit:"month",value:i.months}:i.years?{unit:"year",value:i.years}:{unit:"millisecond",value:0}}function wi(i,e,t){if(i===e)return!0;let n=i.length,s;if(n!==e.length)return!1;for(s=0;s<n;s+=1)if(!(t?t(i[s],e[s]):i[s]===e[s]))return!1;return!0}var $U=["sun","mon","tue","wed","thu","fri","sat"];function Ev(i,e){let t=cr(i);return t[2]+=e*7,Nt(t)}function Ee(i,e){let t=cr(i);return t[2]+=e,Nt(t)}function vi(i,e){let t=cr(i);return t[6]+=e,Nt(t)}function IS(i,e){return Ai(i,e)/7}function Ai(i,e){return(e.valueOf()-i.valueOf())/(1e3*60*60*24)}function zU(i,e){return(e.valueOf()-i.valueOf())/(1e3*60*60)}function qU(i,e){return(e.valueOf()-i.valueOf())/(1e3*60)}function WU(i,e){return(e.valueOf()-i.valueOf())/1e3}function ZI(i,e){let t=de(i),n=de(e);return{years:0,months:0,days:Math.round(Ai(t,n)),milliseconds:e.valueOf()-n.valueOf()-(i.valueOf()-t.valueOf())}}function jI(i,e){let t=wc(i,e);return t!==null&&t%7===0?t/7:null}function wc(i,e){return dr(i)===dr(e)?Math.round(Ai(i,e)):null}function de(i){return Nt([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()])}function YU(i){return Nt([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours()])}function KU(i){return Nt([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes()])}function XU(i){return Nt([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds()])}function JU(i,e,t){let n=i.getUTCFullYear(),s=eS(i,n,e,t);if(s<1)return eS(i,n-1,e,t);let r=eS(i,n+1,e,t);return r>=1?Math.min(s,r):s}function eS(i,e,t,n){let s=Nt([e,0,1+ZU(e,t,n)]),r=de(i),o=Math.round(Ai(s,r));return Math.floor(o/7)+1}function ZU(i,e,t){let n=7+e-t;return-((7+Nt([i,0,n]).getUTCDay()-e)%7)+n-1}function PI(i){return[i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()]}function MI(i){return new Date(i[0],i[1]||0,i[2]==null?1:i[2],i[3]||0,i[4]||0,i[5]||0)}function cr(i){return[i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds()]}function Nt(i){return i.length===1&&(i=i.concat([0])),new Date(Date.UTC(...i))}function DS(i){return!isNaN(i.valueOf())}function dr(i){return i.getUTCHours()*1e3*60*60+i.getUTCMinutes()*1e3*60+i.getUTCSeconds()*1e3+i.getUTCMilliseconds()}function wv(i,e,t=!1){let n=i.toISOString();return n=n.replace(".000",""),t&&(n=n.replace("T00:00:00Z","")),n.length>10&&(e==null?n=n.replace("Z",""):e!==0&&(n=n.replace("Z",kS(e,!0)))),n}function mr(i){return i.toISOString().replace(/T.*$/,"")}function PS(i){return i.toISOString().match(/^\d{4}-\d{2}/)[0]}function MS(i){return ea(i.getUTCHours(),2)+":"+ea(i.getUTCMinutes(),2)+":"+ea(i.getUTCSeconds(),2)}function kS(i,e=!1){let t=i<0?"-":"+",n=Math.abs(i),s=Math.floor(n/60),r=Math.round(n%60);return e?`${t+ea(s,2)}:${ea(r,2)}`:`GMT${t}${s}${r?`:${ea(r,2)}`:""}`}function $(i,e,t){let n,s;return function(...r){if(!n)s=i.apply(this,r);else if(!wi(n,r)){t&&t(s);let o=i.apply(this,r);(!e||!e(o,s))&&(s=o)}return n=r,s}}function Cc(i,e,t){let n,s;return r=>{if(!n)s=i.call(this,r);else if(!Ft(n,r)){t&&t(s);let o=i.call(this,r);(!e||!e(o,s))&&(s=o)}return n=r,s}}var tS={week:3,separator:9,omitZeroMinute:9,meridiem:9,omitCommas:9},cv={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},nv=/\s*([ap])\.?m\.?/i,jU=/,/g,QU=/\s+/g,eH=/\u200e/g,tH=/UTC|GMT/,dS=class{constructor(e){let t={},n={},s=9;for(let r in e)r in tS?(n[r]=e[r],tS[r]<9&&(s=Math.min(tS[r],s))):(t[r]=e[r],r in cv&&(s=Math.min(cv[r],s)));this.standardDateProps=t,this.extendedSettings=n,this.smallestUnitNum=s,this.buildFormattingFunc=$(kI)}format(e,t){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,t)(e)}formatRange(e,t,n,s){let{standardDateProps:r,extendedSettings:o}=this,a=aH(e.marker,t.marker,n.calendarSystem);if(!a)return this.format(e,n);let l=a;l>1&&(r.year==="numeric"||r.year==="2-digit")&&(r.month==="numeric"||r.month==="2-digit")&&(r.day==="numeric"||r.day==="2-digit")&&(l=1);let c=this.format(e,n),d=this.format(t,n);if(c===d)return c;let h=lH(r,l),p=kI(h,o,n),m=p(e),y=p(t),v=cH(c,m,d,y),E=o.separator||s||n.defaultSeparator||"";return v?v.before+m+E+y+v.after:c+E+d}getSmallestUnit(){switch(this.smallestUnitNum){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}}};function kI(i,e,t){let n=Object.keys(i).length;return n===1&&i.timeZoneName==="short"?s=>kS(s.timeZoneOffset):n===0&&e.week?s=>oH(t.computeWeekNumber(s.marker),t.weekText,t.weekTextLong,t.locale,e.week):nH(i,e,t)}function nH(i,e,t){i=Object.assign({},i),e=Object.assign({},e),iH(i,e),i.timeZone="UTC";let n=new Intl.DateTimeFormat(t.locale.codes,i),s;if(e.omitZeroMinute){let r=Object.assign({},i);delete r.minute,s=new Intl.DateTimeFormat(t.locale.codes,r)}return r=>{let{marker:o}=r,a;s&&!o.getUTCMinutes()?a=s:a=n;let l=a.format(o);return sH(l,r,i,e,t)}}function iH(i,e){i.timeZoneName&&(i.hour||(i.hour="2-digit"),i.minute||(i.minute="2-digit")),i.timeZoneName==="long"&&(i.timeZoneName="short"),e.omitZeroMinute&&(i.second||i.millisecond)&&delete e.omitZeroMinute}function sH(i,e,t,n,s){return i=i.replace(eH,""),t.timeZoneName==="short"&&(i=rH(i,s.timeZone==="UTC"||e.timeZoneOffset==null?"UTC":kS(e.timeZoneOffset))),n.omitCommas&&(i=i.replace(jU,"").trim()),n.omitZeroMinute&&(i=i.replace(":00","")),n.meridiem===!1?i=i.replace(nv,"").trim():n.meridiem==="narrow"?i=i.replace(nv,(r,o)=>o.toLocaleLowerCase()):n.meridiem==="short"?i=i.replace(nv,(r,o)=>`${o.toLocaleLowerCase()}m`):n.meridiem==="lowercase"&&(i=i.replace(nv,r=>r.toLocaleLowerCase())),i=i.replace(QU," "),i=i.trim(),i}function rH(i,e){let t=!1;return i=i.replace(tH,()=>(t=!0,e)),t||(i+=` ${e}`),i}function oH(i,e,t,n,s){let r=[];return s==="long"?r.push(t):(s==="short"||s==="narrow")&&r.push(e),(s==="long"||s==="short")&&r.push(" "),r.push(n.simpleNumberFormat.format(i)),n.options.direction==="rtl"&&r.reverse(),r.join("")}function aH(i,e,t){return t.getMarkerYear(i)!==t.getMarkerYear(e)?5:t.getMarkerMonth(i)!==t.getMarkerMonth(e)?4:t.getMarkerDay(i)!==t.getMarkerDay(e)?2:dr(i)!==dr(e)?1:0}function lH(i,e){let t={};for(let n in i)(!(n in cv)||cv[n]<=e)&&(t[n]=i[n]);return t}function cH(i,e,t,n){let s=0;for(;s<i.length;){let r=i.indexOf(e,s);if(r===-1)break;let o=i.substr(0,r);s=r+e.length;let a=i.substr(s),l=0;for(;l<t.length;){let c=t.indexOf(n,l);if(c===-1)break;let d=t.substr(0,c);l=c+n.length;let h=t.substr(l);if(o===d&&a===h)return{before:o,after:a}}}return null}function NI(i,e){let t=e.markerToArray(i.marker);return{marker:i.marker,timeZoneOffset:i.timeZoneOffset,array:t,year:t[0],month:t[1],day:t[2],hour:t[3],minute:t[4],second:t[5],millisecond:t[6]}}function dv(i,e,t,n){let s=NI(i,t.calendarSystem),r=e?NI(e,t.calendarSystem):null;return{date:s,start:s,end:r,timeZone:t.timeZone,localeCodes:t.locale.codes,defaultSeparator:n||t.defaultSeparator}}var uS=class{constructor(e){this.cmdStr=e}format(e,t,n){return t.cmdFormatter(this.cmdStr,dv(e,null,t,n))}formatRange(e,t,n,s){return n.cmdFormatter(this.cmdStr,dv(e,t,n,s))}},hS=class{constructor(e){this.func=e}format(e,t,n){return this.func(dv(e,null,t,n))}formatRange(e,t,n,s){return this.func(dv(e,t,n,s))}};function ue(i){return typeof i=="object"&&i?new dS(i):typeof i=="string"?new uS(i):typeof i=="function"?new hS(i):null}var NS={navLinkDayClick:P,navLinkWeekClick:P,duration:te,bootstrapFontAwesome:P,buttonIcons:P,customButtons:P,defaultAllDayEventDuration:te,defaultTimedEventDuration:te,nextDayThreshold:te,scrollTime:te,scrollTimeReset:Boolean,slotMinTime:te,slotMaxTime:te,dayPopoverFormat:ue,slotDuration:te,snapDuration:te,headerToolbar:P,footerToolbar:P,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:ue,dayHeaderClassNames:P,dayHeaderContent:P,dayHeaderDidMount:P,dayHeaderWillUnmount:P,dayCellClassNames:P,dayCellContent:P,dayCellDidMount:P,dayCellWillUnmount:P,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:P,weekNumbers:Boolean,weekNumberClassNames:P,weekNumberContent:P,weekNumberDidMount:P,weekNumberWillUnmount:P,editable:Boolean,viewClassNames:P,viewDidMount:P,viewWillUnmount:P,nowIndicator:Boolean,nowIndicatorSnap:P,nowIndicatorClassNames:P,nowIndicatorContent:P,nowIndicatorDidMount:P,nowIndicatorWillUnmount:P,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:P,locale:P,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:P,eventOrder:YI,eventOrderStrict:Boolean,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:P,contentHeight:P,direction:String,weekNumberFormat:ue,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,weekTextLong:String,progressiveEventRendering:Boolean,businessHours:P,initialDate:P,now:P,eventDataTransform:P,stickyHeaderDates:P,stickyFooterScrollbar:P,viewHeight:P,defaultAllDay:Boolean,eventSourceFailure:P,eventSourceSuccess:P,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:P,eventConstraint:P,eventAllow:P,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:P,eventContent:P,eventDidMount:P,eventWillUnmount:P,selectConstraint:P,selectOverlap:P,selectAllow:P,droppable:Boolean,unselectCancel:String,slotLabelFormat:P,slotLaneClassNames:P,slotLaneContent:P,slotLaneDidMount:P,slotLaneWillUnmount:P,slotLabelClassNames:P,slotLabelContent:P,slotLabelDidMount:P,slotLabelWillUnmount:P,dayMaxEvents:P,dayMaxEventRows:P,dayMinWidth:Number,slotLabelInterval:te,allDayText:String,allDayClassNames:P,allDayContent:P,allDayDidMount:P,allDayWillUnmount:P,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:ue,rerenderDelay:Number,moreLinkText:P,moreLinkHint:P,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMaxStack:Number,eventMinHeight:Number,eventMinWidth:Number,eventShortHeight:Number,slotEventOverlap:Boolean,plugins:P,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:te,hiddenDays:P,fixedWeekCount:Boolean,validRange:P,visibleRange:P,titleFormat:P,eventInteractive:Boolean,noEventsText:String,viewHint:P,navLinkHint:P,closeHint:String,timeHint:String,eventHint:String,moreLinkClick:P,moreLinkClassNames:P,moreLinkContent:P,moreLinkDidMount:P,moreLinkWillUnmount:P,monthStartFormat:ue,handleCustomRendering:P,customRenderingMetaMap:P,customRenderingReplaces:Boolean},yr={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:" \u2013 ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",scrollTimeReset:!0,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1,eventMinHeight:15,eventMinWidth:30,eventShortHeight:30,monthStartFormat:{month:"long",day:"numeric"},nowIndicatorSnap:"auto"},FS={datesSet:P,eventsSet:P,eventAdd:P,eventChange:P,eventRemove:P,windowResize:P,eventClick:P,eventMouseEnter:P,eventMouseLeave:P,select:P,unselect:P,loading:P,_unmount:P,_beforeprint:P,_afterprint:P,_noEventDrop:P,_noEventResize:P,_resize:P,_scrollRequest:P},LS={buttonText:P,buttonHints:P,views:P,plugins:P,initialEvents:P,events:P,eventSources:P},vr={headerToolbar:Qo,footerToolbar:Qo,buttonText:Qo,buttonHints:Qo,buttonIcons:Qo,dateIncrement:Qo,plugins:iv,events:iv,eventSources:iv,resources:iv};function Qo(i,e){return typeof i=="object"&&typeof e=="object"&&i&&e?Ft(i,e):i===e}function iv(i,e){return Array.isArray(i)&&Array.isArray(e)?wi(i,e):i===e}var QI={type:String,component:P,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:P,usesMinMaxTime:Boolean,classNames:P,content:P,didMount:P,willUnmount:P};function Av(i){return _v(i,vr)}function Sv(i,e){let t={},n={};for(let s in e)s in i&&(t[s]=e[s](i[s]));for(let s in i)s in e||(n[s]=i[s]);return{refined:t,extra:n}}function P(i){return i}var{hasOwnProperty:uv}=Object.prototype;function _v(i,e){let t={};if(e){for(let n in e)if(e[n]===Qo){let s=[];for(let r=i.length-1;r>=0;r-=1){let o=i[r][n];if(typeof o=="object"&&o)s.unshift(o);else if(o!==void 0){t[n]=o;break}}s.length&&(t[n]=_v(s))}}for(let n=i.length-1;n>=0;n-=1){let s=i[n];for(let r in s)r in t||(t[r]=s[r])}return t}function us(i,e){let t={};for(let n in i)e(i[n],n)&&(t[n]=i[n]);return t}function yn(i,e){let t={};for(let n in i)t[n]=e(i[n],n);return t}function OS(i){let e={};for(let t of i)e[t]=!0;return e}function Cv(i){let e=[];for(let t in i)e.push(i[t]);return e}function Ft(i,e){if(i===e)return!0;for(let t in i)if(uv.call(i,t)&&!(t in e))return!1;for(let t in e)if(uv.call(e,t)&&i[t]!==e[t])return!1;return!0}var dH=/^on[A-Z]/;function uH(i,e){let t=hH(i,e);for(let n of t)if(!dH.test(n))return!1;return!0}function hH(i,e){let t=[];for(let n in i)uv.call(i,n)&&(n in e||t.push(n));for(let n in e)uv.call(e,n)&&i[n]!==e[n]&&t.push(n);return t}function av(i,e,t={}){if(i===e)return!0;for(let n in e)if(!(n in i&&fH(i[n],e[n],t[n])))return!1;for(let n in i)if(!(n in e))return!1;return!0}function fH(i,e,t){return i===e||t===!0?!0:t?t(i,e):!1}function eD(i,e=0,t,n=1){let s=[];t==null&&(t=Object.keys(i).length);for(let r=e;r<t;r+=n){let o=i[r];o!==void 0&&s.push(o)}return s}var tD={};function pH(i,e){tD[i]=e}function gH(i){return new tD[i]}var fS=class{getMarkerYear(e){return e.getUTCFullYear()}getMarkerMonth(e){return e.getUTCMonth()}getMarkerDay(e){return e.getUTCDate()}arrayToMarker(e){return Nt(e)}markerToArray(e){return cr(e)}};pH("gregory",fS);var mH=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;function nD(i){let e=mH.exec(i);if(e){let t=new Date(Date.UTC(Number(e[1]),e[3]?Number(e[3])-1:0,Number(e[5]||1),Number(e[7]||0),Number(e[8]||0),Number(e[10]||0),e[12]?+`0.${e[12]}`*1e3:0));if(DS(t)){let n=null;return e[13]&&(n=(e[15]==="-"?-1:1)*(Number(e[16]||0)*60+Number(e[18]||0))),{marker:t,isTimeUnspecified:!e[6],timeZoneOffset:n}}}return null}var Yh=class{constructor(e){let t=this.timeZone=e.timeZone,n=t!=="local"&&t!=="UTC";e.namedTimeZoneImpl&&n&&(this.namedTimeZoneImpl=new e.namedTimeZoneImpl(t)),this.canComputeOffset=!!(!n||this.namedTimeZoneImpl),this.calendarSystem=gH(e.calendarSystem),this.locale=e.locale,this.weekDow=e.locale.week.dow,this.weekDoy=e.locale.week.doy,e.weekNumberCalculation==="ISO"&&(this.weekDow=1,this.weekDoy=4),typeof e.firstDay=="number"&&(this.weekDow=e.firstDay),typeof e.weekNumberCalculation=="function"&&(this.weekNumberFunc=e.weekNumberCalculation),this.weekText=e.weekText!=null?e.weekText:e.locale.options.weekText,this.weekTextLong=(e.weekTextLong!=null?e.weekTextLong:e.locale.options.weekTextLong)||this.weekText,this.cmdFormatter=e.cmdFormatter,this.defaultSeparator=e.defaultSeparator}createMarker(e){let t=this.createMarkerMeta(e);return t===null?null:t.marker}createNowMarker(){return this.canComputeOffset?this.timestampToMarker(new Date().valueOf()):Nt(PI(new Date))}createMarkerMeta(e){if(typeof e=="string")return this.parse(e);let t=null;return typeof e=="number"?t=this.timestampToMarker(e):e instanceof Date?(e=e.valueOf(),isNaN(e)||(t=this.timestampToMarker(e))):Array.isArray(e)&&(t=Nt(e)),t===null||!DS(t)?null:{marker:t,isTimeUnspecified:!1,forcedTzo:null}}parse(e){let t=nD(e);if(t===null)return null;let{marker:n}=t,s=null;return t.timeZoneOffset!==null&&(this.canComputeOffset?n=this.timestampToMarker(n.valueOf()-t.timeZoneOffset*60*1e3):s=t.timeZoneOffset),{marker:n,isTimeUnspecified:t.isTimeUnspecified,forcedTzo:s}}getYear(e){return this.calendarSystem.getMarkerYear(e)}getMonth(e){return this.calendarSystem.getMarkerMonth(e)}getDay(e){return this.calendarSystem.getMarkerDay(e)}add(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]+=t.years,n[1]+=t.months,n[2]+=t.days,n[6]+=t.milliseconds,this.calendarSystem.arrayToMarker(n)}subtract(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]-=t.years,n[1]-=t.months,n[2]-=t.days,n[6]-=t.milliseconds,this.calendarSystem.arrayToMarker(n)}addYears(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]+=t,this.calendarSystem.arrayToMarker(n)}addMonths(e,t){let n=this.calendarSystem.markerToArray(e);return n[1]+=t,this.calendarSystem.arrayToMarker(n)}diffWholeYears(e,t){let{calendarSystem:n}=this;return dr(e)===dr(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)&&n.getMarkerMonth(e)===n.getMarkerMonth(t)?n.getMarkerYear(t)-n.getMarkerYear(e):null}diffWholeMonths(e,t){let{calendarSystem:n}=this;return dr(e)===dr(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)?n.getMarkerMonth(t)-n.getMarkerMonth(e)+(n.getMarkerYear(t)-n.getMarkerYear(e))*12:null}greatestWholeUnit(e,t){let n=this.diffWholeYears(e,t);return n!==null?{unit:"year",value:n}:(n=this.diffWholeMonths(e,t),n!==null?{unit:"month",value:n}:(n=jI(e,t),n!==null?{unit:"week",value:n}:(n=wc(e,t),n!==null?{unit:"day",value:n}:(n=zU(e,t),qh(n)?{unit:"hour",value:n}:(n=qU(e,t),qh(n)?{unit:"minute",value:n}:(n=WU(e,t),qh(n)?{unit:"second",value:n}:{unit:"millisecond",value:t.valueOf()-e.valueOf()}))))))}countDurationsBetween(e,t,n){let s;return n.years&&(s=this.diffWholeYears(e,t),s!==null)?s/VU(n):n.months&&(s=this.diffWholeMonths(e,t),s!==null)?s/GU(n):n.days&&(s=wc(e,t),s!==null)?s/Ec(n):(t.valueOf()-e.valueOf())/en(n)}startOf(e,t){return t==="year"?this.startOfYear(e):t==="month"?this.startOfMonth(e):t==="week"?this.startOfWeek(e):t==="day"?de(e):t==="hour"?YU(e):t==="minute"?KU(e):t==="second"?XU(e):null}startOfYear(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e)])}startOfMonth(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e)])}startOfWeek(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e),e.getUTCDate()-(e.getUTCDay()-this.weekDow+7)%7])}computeWeekNumber(e){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(e)):JU(e,this.weekDow,this.weekDoy)}format(e,t,n={}){return t.format({marker:e,timeZoneOffset:n.forcedTzo!=null?n.forcedTzo:this.offsetForMarker(e)},this)}formatRange(e,t,n,s={}){return s.isEndExclusive&&(t=vi(t,-1)),n.formatRange({marker:e,timeZoneOffset:s.forcedStartTzo!=null?s.forcedStartTzo:this.offsetForMarker(e)},{marker:t,timeZoneOffset:s.forcedEndTzo!=null?s.forcedEndTzo:this.offsetForMarker(t)},this,s.defaultSeparator)}formatIso(e,t={}){let n=null;return t.omitTimeZoneOffset||(t.forcedTzo!=null?n=t.forcedTzo:n=this.offsetForMarker(e)),wv(e,n,t.omitTime)}timestampToMarker(e){return this.timeZone==="local"?Nt(PI(new Date(e))):this.timeZone==="UTC"||!this.namedTimeZoneImpl?new Date(e):Nt(this.namedTimeZoneImpl.timestampToArray(e))}offsetForMarker(e){return this.timeZone==="local"?-MI(cr(e)).getTimezoneOffset():this.timeZone==="UTC"?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(cr(e)):null}toDate(e,t){return this.timeZone==="local"?MI(cr(e)):this.timeZone==="UTC"?new Date(e.valueOf()):this.namedTimeZoneImpl?new Date(e.valueOf()-this.namedTimeZoneImpl.offsetForArray(cr(e))*1e3*60):new Date(e.valueOf()-(t||0))}},hs=class{constructor(e){this.iconOverrideOption&&this.setIconOverride(e[this.iconOverrideOption])}setIconOverride(e){let t,n;if(typeof e=="object"&&e){t=Object.assign({},this.iconClasses);for(n in e)t[n]=this.applyIconOverridePrefix(e[n]);this.iconClasses=t}else e===!1&&(this.iconClasses={})}applyIconOverridePrefix(e){let t=this.iconOverridePrefix;return t&&e.indexOf(t)!==0&&(e=t+e),e}getClass(e){return this.classes[e]||""}getIconClass(e,t){let n;return t&&this.rtlIconClasses?n=this.rtlIconClasses[e]||this.iconClasses[e]:n=this.iconClasses[e],n?`${this.baseIconClass} ${n}`:""}getCustomButtonIconClass(e){let t;return this.iconOverrideCustomButtonOption&&(t=e[this.iconOverrideCustomButtonOption],t)?`${this.baseIconClass} ${this.applyIconOverridePrefix(t)}`:""}};hs.prototype.classes={};hs.prototype.iconClasses={};hs.prototype.baseIconClass="";hs.prototype.iconOverridePrefix="";function Kh(i){i();let e=z.debounceRendering,t=[];function n(s){t.push(s)}for(z.debounceRendering=n,ar(x(pS,{}),document.createElement("div"));t.length;)t.shift()();z.debounceRendering=e}var pS=class extends it{render(){return x("div",{})}componentDidMount(){this.setState({})}};function iD(i){let e=Qy(i),t=e.Provider;return e.Provider=function(){let n=!this.getChildContext,s=t.apply(this,arguments);if(n){let r=[];this.shouldComponentUpdate=o=>{this.props.value!==o.value&&r.forEach(a=>{a.context=o.value,a.forceUpdate()})},this.sub=o=>{r.push(o);let a=o.componentWillUnmount;o.componentWillUnmount=()=>{r.splice(r.indexOf(o),1),a&&a.call(o)}}}return s},e}var hv=class{constructor(e,t,n,s){this.execFunc=e,this.emitter=t,this.scrollTime=n,this.scrollTimeReset=s,this.handleScrollRequest=r=>{this.queuedRequest=Object.assign({},this.queuedRequest||{},r),this.drain()},t.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}detach(){this.emitter.off("_scrollRequest",this.handleScrollRequest)}update(e){e&&this.scrollTimeReset?this.fireInitialScroll():this.drain()}fireInitialScroll(){this.handleScrollRequest({time:this.scrollTime})}drain(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)}},bn=iD({});function sD(i,e,t,n,s,r,o,a,l,c,d,h,p,m){return{dateEnv:s,nowManager:r,options:t,pluginHooks:a,emitter:d,dispatch:l,getCurrentData:c,calendarApi:h,viewSpec:i,viewApi:e,dateProfileGenerator:n,theme:o,isRtl:t.direction==="rtl",addResizeHandler(y){d.on("_resize",y)},removeResizeHandler(y){d.off("_resize",y)},createScrollResponder(y){return new hv(y,d,te(t.scrollTime),t.scrollTimeReset)},registerInteractiveComponent:p,unregisterInteractiveComponent:m}}var bi=class extends it{shouldComponentUpdate(e,t){return!av(this.props,e,this.propEquality)||!av(this.state,t,this.stateEquality)}safeSetState(e){av(this.state,Object.assign(Object.assign({},this.state),e),this.stateEquality)||this.setState(e)}};bi.addPropsEquality=yH;bi.addStateEquality=vH;bi.contextType=bn;bi.prototype.propEquality={};bi.prototype.stateEquality={};var ne=class extends bi{};ne.contextType=bn;function yH(i){let e=Object.create(this.prototype.propEquality);Object.assign(e,i),this.prototype.propEquality=e}function vH(i){let e=Object.create(this.prototype.stateEquality);Object.assign(e,i),this.prototype.stateEquality=e}function nn(i,e){typeof i=="function"?i(e):i&&(i.current=e)}var Xh=class extends ne{constructor(){super(...arguments),this.id=gs(),this.queuedDomNodes=[],this.currentDomNodes=[],this.handleEl=e=>{let{options:t}=this.context,{generatorName:n}=this.props;(!t.customRenderingReplaces||!gS(n,t))&&this.updateElRef(e)},this.updateElRef=e=>{this.props.elRef&&nn(this.props.elRef,e)}}render(){let{props:e,context:t}=this,{options:n}=t,{customGenerator:s,defaultGenerator:r,renderProps:o}=e,a=US(e,[],this.handleEl),l=!1,c,d=[],h;if(s!=null){let p=typeof s=="function"?s(o,x):s;if(p===!0)l=!0;else{let m=p&&typeof p=="object";m&&"html"in p?a.dangerouslySetInnerHTML={__html:p.html}:m&&"domNodes"in p?d=Array.prototype.slice.call(p.domNodes):(m?YA(p):typeof p!="function")?c=p:h=p}}else l=!gS(e.generatorName,n);return l&&r&&(c=r(o)),this.queuedDomNodes=d,this.currentGeneratorMeta=h,x(e.elTag,a,c)}componentDidMount(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentDidUpdate(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentWillUnmount(){this.triggerCustomRendering(!1)}triggerCustomRendering(e){var t;let{props:n,context:s}=this,{handleCustomRendering:r,customRenderingMetaMap:o}=s.options;if(r){let a=(t=this.currentGeneratorMeta)!==null&&t!==void 0?t:o==null?void 0:o[n.generatorName];a&&r(Object.assign(Object.assign({id:this.id,isActive:e,containerEl:this.base,reportNewContainerEl:this.updateElRef,generatorMeta:a},n),{elClasses:(n.elClasses||[]).filter(bH)}))}}applyQueueudDomNodes(){let{queuedDomNodes:e,currentDomNodes:t}=this,n=this.base;if(!wi(e,t)){t.forEach(lf);for(let s of e)n.appendChild(s);this.currentDomNodes=e}}};Xh.addPropsEquality({elClasses:wi,elStyle:Ft,elAttrs:uH,renderProps:Ft});function gS(i,e){var t;return!!(e.handleCustomRendering&&i&&(!((t=e.customRenderingMetaMap)===null||t===void 0)&&t[i]))}function US(i,e,t){let n=Object.assign(Object.assign({},i.elAttrs),{ref:t});return(i.elClasses||e)&&(n.className=(i.elClasses||[]).concat(e||[]).concat(n.className||[]).filter(Boolean).join(" ")),i.elStyle&&(n.style=i.elStyle),n}function bH(i){return!!i}var HS=iD(0),xe=class extends it{constructor(){super(...arguments),this.InnerContent=EH.bind(void 0,this),this.handleEl=e=>{this.el=e,this.props.elRef&&(nn(this.props.elRef,e),e&&this.didMountMisfire&&this.componentDidMount())}}render(){let{props:e}=this,t=wH(e.classNameGenerator,e.renderProps);if(e.children){let n=US(e,t,this.handleEl),s=e.children(this.InnerContent,e.renderProps,n);return e.elTag?x(e.elTag,n,s):s}else return x(Xh,Object.assign(Object.assign({},e),{elRef:this.handleEl,elTag:e.elTag||"div",elClasses:(e.elClasses||[]).concat(t),renderId:this.context}))}componentDidMount(){var e,t;this.el?(t=(e=this.props).didMount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el})):this.didMountMisfire=!0}componentWillUnmount(){var e,t;(t=(e=this.props).willUnmount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el}))}};xe.contextType=HS;function EH(i,e){let t=i.props;return x(Xh,Object.assign({renderProps:t.renderProps,generatorName:t.generatorName,customGenerator:t.customGenerator,defaultGenerator:t.defaultGenerator,renderId:i.context},e))}function wH(i,e){let t=typeof i=="function"?i(e):i||[];return typeof t=="string"?[t]:t}var $n=class extends ne{render(){let{props:e,context:t}=this,{options:n}=t,s={view:t.viewApi};return x(xe,{elRef:e.elRef,elTag:e.elTag||"div",elAttrs:e.elAttrs,elClasses:[...BS(e.viewSpec),...e.elClasses||[]],elStyle:e.elStyle,renderProps:s,classNameGenerator:n.viewClassNames,generatorName:void 0,didMount:n.viewDidMount,willUnmount:n.viewWillUnmount},()=>e.children)}};function BS(i){return[`fc-${i.type}-view`,"fc-view"]}function AH(i,e){let t=null,n=null;return i.start&&(t=e.createMarker(i.start)),i.end&&(n=e.createMarker(i.end)),!t&&!n||t&&n&&n<t?null:{start:t,end:n}}function FI(i,e){let t=[],{start:n}=e,s,r;for(i.sort(SH),s=0;s<i.length;s+=1)r=i[s],r.start>n&&t.push({start:n,end:r.start}),r.end>n&&(n=r.end);return n<e.end&&t.push({start:n,end:e.end}),t}function SH(i,e){return i.start.valueOf()-e.start.valueOf()}function tn(i,e){let{start:t,end:n}=i,s=null;return e.start!==null&&(t===null?t=e.start:t=new Date(Math.max(t.valueOf(),e.start.valueOf()))),e.end!=null&&(n===null?n=e.end:n=new Date(Math.min(n.valueOf(),e.end.valueOf()))),(t===null||n===null||t<n)&&(s={start:t,end:n}),s}function rD(i,e){return(i.start===null?null:i.start.valueOf())===(e.start===null?null:e.start.valueOf())&&(i.end===null?null:i.end.valueOf())===(e.end===null?null:e.end.valueOf())}function Tv(i,e){return(i.end===null||e.start===null||i.end>e.start)&&(i.start===null||e.end===null||i.start<e.end)}function Tc(i,e){return(i.start===null||e.start!==null&&e.start>=i.start)&&(i.end===null||e.end!==null&&e.end<=i.end)}function mn(i,e){return(i.start===null||e>=i.start)&&(i.end===null||e<i.end)}function _H(i,e){return e.start!=null&&i<e.start?e.start:e.end!=null&&i>=e.end?new Date(e.end.valueOf()-1):i}function oD(i){let e=Math.floor(Ai(i.start,i.end))||1,t=de(i.start),n=Ee(t,e);return{start:t,end:n}}function xv(i,e=te(0)){let t=null,n=null;if(i.end){n=de(i.end);let s=i.end.valueOf()-n.valueOf();s&&s>=en(e)&&(n=Ee(n,1))}return i.start&&(t=de(i.start),n&&n<=t&&(n=Ee(t,1))),{start:t,end:n}}function VS(i){let e=xv(i);return Ai(e.start,e.end)>1}function ur(i,e,t,n){return n==="year"?te(t.diffWholeYears(i,e),"year"):n==="month"?te(t.diffWholeMonths(i,e),"month"):ZI(i,e)}var na=class{constructor(e){this.props=e,this.initHiddenDays()}buildPrev(e,t,n){let{dateEnv:s}=this.props,r=s.subtract(s.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(r,-1,n)}buildNext(e,t,n){let{dateEnv:s}=this.props,r=s.add(s.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(r,1,n)}build(e,t,n=!0){let{props:s}=this,r,o,a,l,c,d;return r=this.buildValidRange(),r=this.trimHiddenDays(r),n&&(e=_H(e,r)),o=this.buildCurrentRangeInfo(e,t),a=/^(year|month|week|day)$/.test(o.unit),l=this.buildRenderRange(this.trimHiddenDays(o.range),o.unit,a),l=this.trimHiddenDays(l),c=l,s.showNonCurrentDates||(c=tn(c,o.range)),c=this.adjustActiveRange(c),c=tn(c,r),d=Tv(o.range,r),mn(l,e)||(e=l.start),{currentDate:e,validRange:r,currentRange:o.range,currentRangeUnit:o.unit,isRangeAllDay:a,activeRange:c,renderRange:l,slotMinTime:s.slotMinTime,slotMaxTime:s.slotMaxTime,isValid:d,dateIncrement:this.buildDateIncrement(o.duration)}}buildValidRange(){let e=this.props.validRangeInput,t=typeof e=="function"?e.call(this.props.calendarApi,this.props.dateEnv.toDate(this.props.nowManager.getDateMarker())):e;return this.refineRange(t)||{start:null,end:null}}buildCurrentRangeInfo(e,t){let{props:n}=this,s=null,r=null,o=null,a;return n.duration?(s=n.duration,r=n.durationUnit,o=this.buildRangeFromDuration(e,t,s,r)):(a=this.props.dayCount)?(r="day",o=this.buildRangeFromDayCount(e,t,a)):(o=this.buildCustomVisibleRange(e))?r=n.dateEnv.greatestWholeUnit(o.start,o.end).unit:(s=this.getFallbackDuration(),r=Wh(s).unit,o=this.buildRangeFromDuration(e,t,s,r)),{duration:s,unit:r,range:o}}getFallbackDuration(){return te({day:1})}adjustActiveRange(e){let{dateEnv:t,usesMinMaxTime:n,slotMinTime:s,slotMaxTime:r}=this.props,{start:o,end:a}=e;return n&&(Ec(s)<0&&(o=de(o),o=t.add(o,s)),Ec(r)>1&&(a=de(a),a=Ee(a,-1),a=t.add(a,r))),{start:o,end:a}}buildRangeFromDuration(e,t,n,s){let{dateEnv:r,dateAlignment:o}=this.props,a,l,c;if(!o){let{dateIncrement:h}=this.props;h&&en(h)<en(n)?o=Wh(h).unit:o=s}Ec(n)<=1&&this.isHiddenDay(a)&&(a=this.skipHiddenDays(a,t),a=de(a));function d(){a=r.startOf(e,o),l=r.add(a,n),c={start:a,end:l}}return d(),this.trimHiddenDays(c)||(e=this.skipHiddenDays(e,t),d()),c}buildRangeFromDayCount(e,t,n){let{dateEnv:s,dateAlignment:r}=this.props,o=0,a=e,l;r&&(a=s.startOf(a,r)),a=de(a),a=this.skipHiddenDays(a,t),l=a;do l=Ee(l,1),this.isHiddenDay(l)||(o+=1);while(o<n);return{start:a,end:l}}buildCustomVisibleRange(e){let{props:t}=this,n=t.visibleRangeInput,s=typeof n=="function"?n.call(t.calendarApi,t.dateEnv.toDate(e)):n,r=this.refineRange(s);return r&&(r.start==null||r.end==null)?null:r}buildRenderRange(e,t,n){return e}buildDateIncrement(e){let{dateIncrement:t}=this.props,n;return t||((n=this.props.dateAlignment)?te(1,n):e||te({days:1}))}refineRange(e){if(e){let t=AH(e,this.props.dateEnv);return t&&(t=xv(t)),t}return null}initHiddenDays(){let e=this.props.hiddenDays||[],t=[],n=0,s;for(this.props.weekends===!1&&e.push(0,6),s=0;s<7;s+=1)(t[s]=e.indexOf(s)!==-1)||(n+=1);if(!n)throw new Error("invalid hiddenDays");this.isHiddenDayHash=t}trimHiddenDays(e){let{start:t,end:n}=e;return t&&(t=this.skipHiddenDays(t)),n&&(n=this.skipHiddenDays(n,-1,!0)),t==null||n==null||t<n?{start:t,end:n}:null}isHiddenDay(e){return e instanceof Date&&(e=e.getUTCDay()),this.isHiddenDayHash[e]}skipHiddenDays(e,t=1,n=!1){for(;this.isHiddenDayHash[(e.getUTCDay()+(n?t:0)+7)%7];)e=Ee(e,t);return e}};function pf(i,e,t,n){return{instanceId:gs(),defId:i,range:e,forcedStartTzo:t==null?null:t,forcedEndTzo:n==null?null:n}}function CH(i,e,t,n){for(let s=0;s<n.length;s+=1){let r=n[s].parse(i,t);if(r){let{allDay:o}=i;return o==null&&(o=e,o==null&&(o=r.allDayGuess,o==null&&(o=!1))),{allDay:o,duration:r.duration,typeData:r.typeData,typeId:s}}}return null}function ia(i,e,t){let{dateEnv:n,pluginHooks:s,options:r}=t,{defs:o,instances:a}=i;a=us(a,l=>!o[l.defId].recurringDef);for(let l in o){let c=o[l];if(c.recurringDef){let{duration:d}=c.recurringDef;d||(d=c.allDay?r.defaultAllDayEventDuration:r.defaultTimedEventDuration);let h=TH(c,d,e,n,s.recurringTypes);for(let p of h){let m=pf(l,{start:p,end:n.add(p,d)});a[m.instanceId]=m}}}return{defs:o,instances:a}}function TH(i,e,t,n,s){let o=s[i.recurringDef.typeId].expand(i.recurringDef.typeData,{start:n.subtract(t.start,e),end:t.end},n);return i.allDay&&(o=o.map(de)),o}var lv={id:String,groupId:String,title:String,url:String,interactive:Boolean},aD={start:P,end:P,date:P,allDay:Boolean},xH=Object.assign(Object.assign(Object.assign({},lv),aD),{extendedProps:P});function lD(i,e,t,n,s=GS(t),r,o){let{refined:a,extra:l}=Rv(i,t,s),c=IH(e,t),d=CH(a,c,t.dateEnv,t.pluginHooks.recurringTypes);if(d){let p=Jh(a,l,e?e.sourceId:"",d.allDay,!!d.duration,t,r);return p.recurringDef={typeId:d.typeId,typeData:d.typeData,duration:d.duration},{def:p,instance:null}}let h=RH(a,c,t,n);if(h){let p=Jh(a,l,e?e.sourceId:"",h.allDay,h.hasEnd,t,r),m=pf(p.defId,h.range,h.forcedStartTzo,h.forcedEndTzo);return o&&p.publicId&&o[p.publicId]&&(m.instanceId=o[p.publicId]),{def:p,instance:m}}return null}function Rv(i,e,t=GS(e)){return Sv(i,t)}function GS(i){return Object.assign(Object.assign(Object.assign({},fv),xH),i.pluginHooks.eventRefiners)}function Jh(i,e,t,n,s,r,o){let a={title:i.title||"",groupId:i.groupId||"",publicId:i.id||"",url:i.url||"",recurringDef:null,defId:(o&&i.id?o[i.id]:"")||gs(),sourceId:t,allDay:n,hasEnd:s,interactive:i.interactive,ui:xc(i,r),extendedProps:Object.assign(Object.assign({},i.extendedProps||{}),e)};for(let l of r.pluginHooks.eventDefMemberAdders)Object.assign(a,l(i));return Object.freeze(a.ui.classNames),Object.freeze(a.extendedProps),a}function RH(i,e,t,n){let{allDay:s}=i,r,o=null,a=!1,l,c=null,d=i.start!=null?i.start:i.date;if(r=t.dateEnv.createMarkerMeta(d),r)o=r.marker;else if(!n)return null;return i.end!=null&&(l=t.dateEnv.createMarkerMeta(i.end)),s==null&&(e!=null?s=e:s=(!r||r.isTimeUnspecified)&&(!l||l.isTimeUnspecified)),s&&o&&(o=de(o)),l&&(c=l.marker,s&&(c=de(c)),o&&c<=o&&(c=null)),c?a=!0:n||(a=t.options.forceEventDuration||!1,c=t.dateEnv.add(o,s?t.options.defaultAllDayEventDuration:t.options.defaultTimedEventDuration)),{allDay:s,hasEnd:a,range:{start:o,end:c},forcedStartTzo:r?r.forcedTzo:null,forcedEndTzo:l?l.forcedTzo:null}}function IH(i,e){let t=null;return i&&(t=i.defaultAllDay),t==null&&(t=e.options.defaultAllDay),t}function Zh(i,e,t,n,s,r){let o=yt(),a=GS(t);for(let l of i){let c=lD(l,e,t,n,a,s,r);c&&jh(c,o)}return o}function jh(i,e=yt()){return e.defs[i.def.defId]=i.def,i.instance&&(e.instances[i.instance.instanceId]=i.instance),e}function gf(i,e){let t=i.instances[e];if(t){let n=i.defs[t.defId],s=Dv(i,r=>DH(n,r));return s.defs[n.defId]=n,s.instances[t.instanceId]=t,s}return yt()}function DH(i,e){return!!(i.groupId&&i.groupId===e.groupId)}function yt(){return{defs:{},instances:{}}}function Iv(i,e){return{defs:Object.assign(Object.assign({},i.defs),e.defs),instances:Object.assign(Object.assign({},i.instances),e.instances)}}function Dv(i,e){let t=us(i.defs,e),n=us(i.instances,s=>t[s.defId]);return{defs:t,instances:n}}function PH(i,e){let{defs:t,instances:n}=i,s={},r={};for(let o in t)e.defs[o]||(s[o]=t[o]);for(let o in n)!e.instances[o]&&s[n[o].defId]&&(r[o]=n[o]);return{defs:s,instances:r}}function MH(i,e){return Array.isArray(i)?Zh(i,null,e,!0):typeof i=="object"&&i?Zh([i],null,e,!0):i!=null?String(i):null}function mS(i){return Array.isArray(i)?i:typeof i=="string"?i.split(/\s+/):[]}var fv={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:P,overlap:P,allow:P,className:mS,classNames:mS,color:String,backgroundColor:String,borderColor:String,textColor:String},kH={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]};function xc(i,e){let t=MH(i.constraint,e);return{display:i.display||null,startEditable:i.startEditable!=null?i.startEditable:i.editable,durationEditable:i.durationEditable!=null?i.durationEditable:i.editable,constraints:t!=null?[t]:[],overlap:i.overlap!=null?i.overlap:null,allows:i.allow!=null?[i.allow]:[],backgroundColor:i.backgroundColor||i.color||"",borderColor:i.borderColor||i.color||"",textColor:i.textColor||"",classNames:(i.className||[]).concat(i.classNames||[])}}function $S(i){return i.reduce(NH,kH)}function NH(i,e){return{display:e.display!=null?e.display:i.display,startEditable:e.startEditable!=null?e.startEditable:i.startEditable,durationEditable:e.durationEditable!=null?e.durationEditable:i.durationEditable,constraints:i.constraints.concat(e.constraints),overlap:typeof e.overlap=="boolean"?e.overlap:i.overlap,allows:i.allows.concat(e.allows),backgroundColor:e.backgroundColor||i.backgroundColor,borderColor:e.borderColor||i.borderColor,textColor:e.textColor||i.textColor,classNames:i.classNames.concat(e.classNames)}}var FH={id:String,defaultAllDay:Boolean,url:String,format:String,events:P,eventDataTransform:P,success:P,failure:P};function zS(i,e,t=qS(e)){let n;if(typeof i=="string"?n={url:i}:typeof i=="function"||Array.isArray(i)?n={events:i}:typeof i=="object"&&i&&(n=i),n){let{refined:s,extra:r}=Sv(n,t),o=LH(s,e);if(o)return{_raw:i,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:s.defaultAllDay,eventDataTransform:s.eventDataTransform,success:s.success,failure:s.failure,publicId:s.id||"",sourceId:gs(),sourceDefId:o.sourceDefId,meta:o.meta,ui:xc(s,e),extendedProps:r}}return null}function qS(i){return Object.assign(Object.assign(Object.assign({},fv),FH),i.pluginHooks.eventSourceRefiners)}function LH(i,e){let t=e.pluginHooks.eventSourceDefs;for(let n=t.length-1;n>=0;n-=1){let r=t[n].parseMeta(i);if(r)return{sourceDefId:n,meta:r}}return null}function cD(i,e,t,n,s){switch(e.type){case"RECEIVE_EVENTS":return OH(i,t[e.sourceId],e.fetchId,e.fetchRange,e.rawEvents,s);case"RESET_RAW_EVENTS":return UH(i,t[e.sourceId],e.rawEvents,n.activeRange,s);case"ADD_EVENTS":return HH(i,e.eventStore,n?n.activeRange:null,s);case"RESET_EVENTS":return e.eventStore;case"MERGE_EVENTS":return Iv(i,e.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return n?ia(i,n.activeRange,s):i;case"REMOVE_EVENTS":return PH(i,e.eventStore);case"REMOVE_EVENT_SOURCE":return uD(i,e.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return Dv(i,r=>!r.sourceId);case"REMOVE_ALL_EVENTS":return yt();default:return i}}function OH(i,e,t,n,s,r){if(e&&t===e.latestFetchId){let o=Zh(dD(s,e,r),e,r);return n&&(o=ia(o,n,r)),Iv(uD(i,e.sourceId),o)}return i}function UH(i,e,t,n,s){let{defIdMap:r,instanceIdMap:o}=VH(i),a=Zh(dD(t,e,s),e,s,!1,r,o);return ia(a,n,s)}function dD(i,e,t){let n=t.options.eventDataTransform,s=e?e.eventDataTransform:null;return s&&(i=LI(i,s)),n&&(i=LI(i,n)),i}function LI(i,e){let t;if(!e)t=i;else{t=[];for(let n of i){let s=e(n);s?t.push(s):s==null&&t.push(n)}}return t}function HH(i,e,t,n){return t&&(e=ia(e,t,n)),Iv(i,e)}function WS(i,e,t){let{defs:n}=i,s=yn(i.instances,r=>n[r.defId].allDay?r:Object.assign(Object.assign({},r),{range:{start:t.createMarker(e.toDate(r.range.start,r.forcedStartTzo)),end:t.createMarker(e.toDate(r.range.end,r.forcedEndTzo))},forcedStartTzo:t.canComputeOffset?null:r.forcedStartTzo,forcedEndTzo:t.canComputeOffset?null:r.forcedEndTzo}));return{defs:n,instances:s}}function uD(i,e){return Dv(i,t=>t.sourceId!==e)}function BH(i,e){return{defs:i.defs,instances:us(i.instances,t=>!e[t.instanceId])}}function VH(i){let{defs:e,instances:t}=i,n={},s={};for(let r in e){let o=e[r],{publicId:a}=o;a&&(n[a]=r)}for(let r in t){let o=t[r],a=e[o.defId],{publicId:l}=a;l&&(s[l]=r)}return{defIdMap:n,instanceIdMap:s}}var fs=class{constructor(){this.handlers={},this.thisContext=null}setThisContext(e){this.thisContext=e}setOptions(e){this.options=e}on(e,t){GH(this.handlers,e,t)}off(e,t){$H(this.handlers,e,t)}trigger(e,...t){let n=this.handlers[e]||[],s=this.options&&this.options[e],r=[].concat(s||[],n);for(let o of r)o.apply(this.thisContext,t)}hasHandlers(e){return!!(this.handlers[e]&&this.handlers[e].length||this.options&&this.options[e])}};function GH(i,e,t){(i[e]||(i[e]=[])).push(t)}function $H(i,e,t){t?i[e]&&(i[e]=i[e].filter(n=>n!==t)):delete i[e]}var zH={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"};function YS(i,e){return Zh(qH(i),null,e)}function qH(i){let e;return i===!0?e=[{}]:Array.isArray(i)?e=i.filter(t=>t.daysOfWeek):typeof i=="object"&&i?e=[i]:e=[],e=e.map(t=>Object.assign(Object.assign({},zH),t)),e}function Pv(i,e,t){t.emitter.trigger("select",Object.assign(Object.assign({},KS(i,t)),{jsEvent:e?e.origEvent:null,view:t.viewApi||t.calendarApi.view}))}function WH(i,e){e.emitter.trigger("unselect",{jsEvent:i?i.origEvent:null,view:e.viewApi||e.calendarApi.view})}function KS(i,e){let t={};for(let n of e.pluginHooks.dateSpanTransforms)Object.assign(t,n(i,e));return Object.assign(t,sB(i,e.dateEnv)),t}function pv(i,e,t){let{dateEnv:n,options:s}=t,r=e;return i?(r=de(r),r=n.add(r,s.defaultAllDayEventDuration)):r=n.add(r,s.defaultTimedEventDuration),r}function mf(i,e,t,n){let s=gv(i.defs,e),r=yt();for(let o in i.defs){let a=i.defs[o];r.defs[o]=YH(a,s[o],t,n)}for(let o in i.instances){let a=i.instances[o],l=r.defs[a.defId];r.instances[o]=KH(a,l,s[a.defId],t,n)}return r}function YH(i,e,t,n){let s=t.standardProps||{};s.hasEnd==null&&e.durationEditable&&(t.startDelta||t.endDelta)&&(s.hasEnd=!0);let r=Object.assign(Object.assign(Object.assign({},i),s),{ui:Object.assign(Object.assign({},i.ui),s.ui)});t.extendedProps&&(r.extendedProps=Object.assign(Object.assign({},r.extendedProps),t.extendedProps));for(let o of n.pluginHooks.eventDefMutationAppliers)o(r,t,n);return!r.hasEnd&&n.options.forceEventDuration&&(r.hasEnd=!0),r}function KH(i,e,t,n,s){let{dateEnv:r}=s,o=n.standardProps&&n.standardProps.allDay===!0,a=n.standardProps&&n.standardProps.hasEnd===!1,l=Object.assign({},i);return o&&(l.range=oD(l.range)),n.datesDelta&&t.startEditable&&(l.range={start:r.add(l.range.start,n.datesDelta),end:r.add(l.range.end,n.datesDelta)}),n.startDelta&&t.durationEditable&&(l.range={start:r.add(l.range.start,n.startDelta),end:l.range.end}),n.endDelta&&t.durationEditable&&(l.range={start:l.range.start,end:r.add(l.range.end,n.endDelta)}),a&&(l.range={start:l.range.start,end:pv(e.allDay,l.range.start,s)}),e.allDay&&(l.range={start:de(l.range.start),end:de(l.range.end)}),l.range.end<l.range.start&&(l.range.end=pv(e.allDay,l.range.start,s)),l}var lr=class{constructor(e,t){this.context=e,this.internalEventSource=t}remove(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})}refetch(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId],isRefetch:!0})}get id(){return this.internalEventSource.publicId}get url(){return this.internalEventSource.meta.url}get format(){return this.internalEventSource.meta.format}},me=class i{constructor(e,t,n){this._context=e,this._def=t,this._instance=n||null}setProp(e,t){if(e in aD)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if(e==="id")t=lv[e](t),this.mutate({standardProps:{publicId:t}});else if(e in lv)t=lv[e](t),this.mutate({standardProps:{[e]:t}});else if(e in fv){let n=fv[e](t);e==="color"?n={backgroundColor:t,borderColor:t}:e==="editable"?n={startEditable:t,durationEditable:t}:n={[e]:t},this.mutate({standardProps:{ui:n}})}else console.warn(`Could not set prop '${e}'. Use setExtendedProp instead.`)}setExtendedProp(e,t){this.mutate({extendedProps:{[e]:t}})}setStart(e,t={}){let{dateEnv:n}=this._context,s=n.createMarker(e);if(s&&this._instance){let r=this._instance.range,o=ur(r.start,s,n,t.granularity);t.maintainDuration?this.mutate({datesDelta:o}):this.mutate({startDelta:o})}}setEnd(e,t={}){let{dateEnv:n}=this._context,s;if(!(e!=null&&(s=n.createMarker(e),!s))&&this._instance)if(s){let r=ur(this._instance.range.end,s,n,t.granularity);this.mutate({endDelta:r})}else this.mutate({standardProps:{hasEnd:!1}})}setDates(e,t,n={}){let{dateEnv:s}=this._context,r={allDay:n.allDay},o=s.createMarker(e),a;if(o&&!(t!=null&&(a=s.createMarker(t),!a))&&this._instance){let l=this._instance.range;n.allDay===!0&&(l=oD(l));let c=ur(l.start,o,s,n.granularity);if(a){let d=ur(l.end,a,s,n.granularity);BU(c,d)?this.mutate({datesDelta:c,standardProps:r}):this.mutate({startDelta:c,endDelta:d,standardProps:r})}else r.hasEnd=!1,this.mutate({datesDelta:c,standardProps:r})}}moveStart(e){let t=te(e);t&&this.mutate({startDelta:t})}moveEnd(e){let t=te(e);t&&this.mutate({endDelta:t})}moveDates(e){let t=te(e);t&&this.mutate({datesDelta:t})}setAllDay(e,t={}){let n={allDay:e},{maintainDuration:s}=t;s==null&&(s=this._context.options.allDayMaintainDuration),this._def.allDay!==e&&(n.hasEnd=s),this.mutate({standardProps:n})}formatRange(e){let{dateEnv:t}=this._context,n=this._instance,s=ue(e);return this._def.hasEnd?t.formatRange(n.range.start,n.range.end,s,{forcedStartTzo:n.forcedStartTzo,forcedEndTzo:n.forcedEndTzo}):t.format(n.range.start,s,{forcedTzo:n.forcedStartTzo})}mutate(e){let t=this._instance;if(t){let n=this._def,s=this._context,{eventStore:r}=s.getCurrentData(),o=gf(r,t.instanceId);o=mf(o,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}},e,s);let l=new i(s,n,t);this._def=o.defs[n.defId],this._instance=o.instances[t.instanceId],s.dispatch({type:"MERGE_EVENTS",eventStore:o}),s.emitter.trigger("eventChange",{oldEvent:l,event:this,relatedEvents:Si(o,s,t),revert(){s.dispatch({type:"RESET_EVENTS",eventStore:r})}})}}remove(){let e=this._context,t=hD(this);e.dispatch({type:"REMOVE_EVENTS",eventStore:t}),e.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert(){e.dispatch({type:"MERGE_EVENTS",eventStore:t})}})}get source(){let{sourceId:e}=this._def;return e?new lr(this._context,this._context.getCurrentData().eventSources[e]):null}get start(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null}get end(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null}get startStr(){let e=this._instance;return e?this._context.dateEnv.formatIso(e.range.start,{omitTime:this._def.allDay,forcedTzo:e.forcedStartTzo}):""}get endStr(){let e=this._instance;return e&&this._def.hasEnd?this._context.dateEnv.formatIso(e.range.end,{omitTime:this._def.allDay,forcedTzo:e.forcedEndTzo}):""}get id(){return this._def.publicId}get groupId(){return this._def.groupId}get allDay(){return this._def.allDay}get title(){return this._def.title}get url(){return this._def.url}get display(){return this._def.ui.display||"auto"}get startEditable(){return this._def.ui.startEditable}get durationEditable(){return this._def.ui.durationEditable}get constraint(){return this._def.ui.constraints[0]||null}get overlap(){return this._def.ui.overlap}get allow(){return this._def.ui.allows[0]||null}get backgroundColor(){return this._def.ui.backgroundColor}get borderColor(){return this._def.ui.borderColor}get textColor(){return this._def.ui.textColor}get classNames(){return this._def.ui.classNames}get extendedProps(){return this._def.extendedProps}toPlainObject(e={}){let t=this._def,{ui:n}=t,{startStr:s,endStr:r}=this,o={allDay:t.allDay};return t.title&&(o.title=t.title),s&&(o.start=s),r&&(o.end=r),t.publicId&&(o.id=t.publicId),t.groupId&&(o.groupId=t.groupId),t.url&&(o.url=t.url),n.display&&n.display!=="auto"&&(o.display=n.display),e.collapseColor&&n.backgroundColor&&n.backgroundColor===n.borderColor?o.color=n.backgroundColor:(n.backgroundColor&&(o.backgroundColor=n.backgroundColor),n.borderColor&&(o.borderColor=n.borderColor)),n.textColor&&(o.textColor=n.textColor),n.classNames.length&&(o.classNames=n.classNames),Object.keys(t.extendedProps).length&&(e.collapseExtendedProps?Object.assign(o,t.extendedProps):o.extendedProps=t.extendedProps),o}toJSON(){return this.toPlainObject()}};function hD(i){let e=i._def,t=i._instance;return{defs:{[e.defId]:e},instances:t?{[t.instanceId]:t}:{}}}function Si(i,e,t){let{defs:n,instances:s}=i,r=[],o=t?t.instanceId:"";for(let a in s){let l=s[a],c=n[l.defId];l.instanceId!==o&&r.push(new me(e,c,l))}return r}function Ac(i,e,t,n){let s={},r={},o={},a=[],l=[],c=gv(i.defs,e);for(let d in i.defs){let h=i.defs[d];c[h.defId].display==="inverse-background"&&(h.groupId?(s[h.groupId]=[],o[h.groupId]||(o[h.groupId]=h)):r[d]=[])}for(let d in i.instances){let h=i.instances[d],p=i.defs[h.defId],m=c[p.defId],y=h.range,v=!p.allDay&&n?xv(y,n):y,E=tn(v,t);E&&(m.display==="inverse-background"?p.groupId?s[p.groupId].push(E):r[h.defId].push(E):m.display!=="none"&&(m.display==="background"?a:l).push({def:p,ui:m,instance:h,range:E,isStart:v.start&&v.start.valueOf()===E.start.valueOf(),isEnd:v.end&&v.end.valueOf()===E.end.valueOf()}))}for(let d in s){let h=s[d],p=FI(h,t);for(let m of p){let y=o[d],v=c[y.defId];a.push({def:y,ui:v,instance:null,range:m,isStart:!1,isEnd:!1})}}for(let d in r){let h=r[d],p=FI(h,t);for(let m of p)a.push({def:i.defs[d],ui:c[d],instance:null,range:m,isStart:!1,isEnd:!1})}return{bg:a,fg:l}}function XS(i){return i.ui.display==="background"||i.ui.display==="inverse-background"}function OI(i,e){i.fcSeg=e}function ms(i){return i.fcSeg||i.parentNode.fcSeg||null}function gv(i,e){return yn(i,t=>fD(t,e))}function fD(i,e){let t=[];return e[""]&&t.push(e[""]),e[i.defId]&&t.push(e[i.defId]),t.push(i.ui),$S(t)}function fa(i,e){let t=i.map(XH);return t.sort((n,s)=>KI(n,s,e)),t.map(n=>n._seg)}function XH(i){let{eventRange:e}=i,t=e.def,n=e.instance?e.instance.range:e.range,s=n.start?n.start.valueOf():0,r=n.end?n.end.valueOf():0;return Object.assign(Object.assign(Object.assign({},t.extendedProps),t),{id:t.publicId,start:s,end:r,duration:r-s,allDay:Number(t.allDay),_seg:i})}function JH(i,e){let{pluginHooks:t}=e,n=t.isDraggableTransformers,{def:s,ui:r}=i.eventRange,o=r.startEditable;for(let a of n)o=a(o,s,r,e);return o}function ZH(i,e){return i.isStart&&i.eventRange.ui.durationEditable&&e.options.eventResizableFromStart}function jH(i,e){return i.isEnd&&i.eventRange.ui.durationEditable}function br(i,e,t,n,s,r,o){let{dateEnv:a,options:l}=t,{displayEventTime:c,displayEventEnd:d}=l,h=i.eventRange.def,p=i.eventRange.instance;c==null&&(c=n!==!1),d==null&&(d=s!==!1);let m=p.range.start,y=p.range.end,v=r||i.start||i.eventRange.range.start,E=o||i.end||i.eventRange.range.end,A=de(m).valueOf()===de(v).valueOf(),_=de(vi(y,-1)).valueOf()===de(vi(E,-1)).valueOf();return c&&!h.allDay&&(A||_)?(v=A?m:v,E=_?y:E,d&&h.hasEnd?a.formatRange(v,E,e,{forcedStartTzo:r?null:p.forcedStartTzo,forcedEndTzo:o?null:p.forcedEndTzo}):a.format(v,e,{forcedTzo:r?null:p.forcedStartTzo})):""}function sn(i,e,t){let n=i.eventRange.range;return{isPast:n.end<=(t||e.start),isFuture:n.start>=(t||e.end),isToday:e&&mn(e,n.start)}}function QH(i){let e=["fc-event"];return i.isMirror&&e.push("fc-event-mirror"),i.isDraggable&&e.push("fc-event-draggable"),(i.isStartResizable||i.isEndResizable)&&e.push("fc-event-resizable"),i.isDragging&&e.push("fc-event-dragging"),i.isResizing&&e.push("fc-event-resizing"),i.isSelected&&e.push("fc-event-selected"),i.isStart&&e.push("fc-event-start"),i.isEnd&&e.push("fc-event-end"),i.isPast&&e.push("fc-event-past"),i.isToday&&e.push("fc-event-today"),i.isFuture&&e.push("fc-event-future"),e}function yf(i){return i.instance?i.instance.instanceId:`${i.def.defId}:${i.range.start.toISOString()}`}function Rc(i,e){let{def:t,instance:n}=i.eventRange,{url:s}=t;if(s)return{href:s};let{emitter:r,options:o}=e,{eventInteractive:a}=o;return a==null&&(a=t.interactive,a==null&&(a=!!r.hasHandlers("eventClick"))),a?WI(l=>{r.trigger("eventClick",{el:l.target,event:new me(e,t,n),jsEvent:l,view:e.viewApi})}):{}}var eB={start:P,end:P,allDay:Boolean};function tB(i,e,t){let n=nB(i,e),{range:s}=n;if(!s.start)return null;if(!s.end){if(t==null)return null;s.end=e.add(s.start,t)}return n}function nB(i,e){let{refined:t,extra:n}=Sv(i,eB),s=t.start?e.createMarkerMeta(t.start):null,r=t.end?e.createMarkerMeta(t.end):null,{allDay:o}=t;return o==null&&(o=s&&s.isTimeUnspecified&&(!r||r.isTimeUnspecified)),Object.assign({range:{start:s?s.marker:null,end:r?r.marker:null},allDay:o},n)}function JS(i,e){return rD(i.range,e.range)&&i.allDay===e.allDay&&iB(i,e)}function iB(i,e){for(let t in e)if(t!=="range"&&t!=="allDay"&&i[t]!==e[t])return!1;for(let t in i)if(!(t in e))return!1;return!0}function sB(i,e){return Object.assign(Object.assign({},pD(i.range,e,i.allDay)),{allDay:i.allDay})}function ZS(i,e,t){return Object.assign(Object.assign({},pD(i,e,t)),{timeZone:e.timeZone})}function pD(i,e,t){return{start:e.toDate(i.start),end:e.toDate(i.end),startStr:e.formatIso(i.start,{omitTime:t}),endStr:e.formatIso(i.end,{omitTime:t})}}function rB(i,e,t){let n=Rv({editable:!1},t),s=Jh(n.refined,n.extra,"",i.allDay,!0,t);return{def:s,ui:fD(s,e),instance:pf(s.defId,i.range),range:i.range,isStart:!0,isEnd:!0}}function jS(i,e,t){let n=!1,s=function(a){n||(n=!0,e(a))},r=function(a){n||(n=!0,t(a))},o=i(s,r);o&&typeof o.then=="function"&&o.then(s,r)}var mv=class extends Error{constructor(e,t){super(e),this.response=t}};function QS(i,e,t){i=i.toUpperCase();let n={method:i};return i==="GET"?e+=(e.indexOf("?")===-1?"?":"&")+new URLSearchParams(t):(n.body=new URLSearchParams(t),n.headers={"Content-Type":"application/x-www-form-urlencoded"}),fetch(e,n).then(s=>{if(s.ok)return s.json().then(r=>[r,s],()=>{throw new mv("Failure parsing JSON",s)});throw new mv("Request failed",s)})}var nS;function e_(){return nS==null&&(nS=oB()),nS}function oB(){if(typeof document=="undefined")return!0;let i=document.createElement("div");i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.innerHTML="<table><tr><td><div></div></td></tr></table>",i.querySelector("table").style.height="100px",i.querySelector("div").style.height="100%",document.body.appendChild(i);let t=i.querySelector("div").offsetHeight>0;return document.body.removeChild(i),t}var Qh=class extends ne{constructor(){super(...arguments),this.state={forPrint:!1},this.handleBeforePrint=()=>{Kh(()=>{this.setState({forPrint:!0})})},this.handleAfterPrint=()=>{Kh(()=>{this.setState({forPrint:!1})})}}render(){let{props:e}=this,{options:t}=e,{forPrint:n}=this.state,s=n||t.height==="auto"||t.contentHeight==="auto",r=!s&&t.height!=null?t.height:"",o=["fc",n?"fc-media-print":"fc-media-screen",`fc-direction-${t.direction}`,e.theme.getClass("root")];return e_()||o.push("fc-liquid-hack"),e.children(o,r,s,n)}componentDidMount(){let{emitter:e}=this.props;e.on("_beforeprint",this.handleBeforePrint),e.on("_afterprint",this.handleAfterPrint)}componentWillUnmount(){let{emitter:e}=this.props;e.off("_beforeprint",this.handleBeforePrint),e.off("_afterprint",this.handleAfterPrint)}},zn=class{constructor(e){this.component=e.component,this.isHitComboAllowed=e.isHitComboAllowed||null}destroy(){}};function gD(i,e){return{component:i,el:e.el,useEventCenter:e.useEventCenter!=null?e.useEventCenter:!0,isHitComboAllowed:e.isHitComboAllowed||null}}function vf(i){return{[i.component.uid]:i}}var Ic={},Lt=class extends it{constructor(e,t){super(e,t),this.handleRefresh=()=>{let n=this.computeTiming();n.state.nowDate.valueOf()!==this.state.nowDate.valueOf()&&this.setState(n.state),this.clearTimeout(),this.setTimeout(n.waitMs)},this.handleVisibilityChange=()=>{document.hidden||this.handleRefresh()},this.state=this.computeTiming().state}render(){let{props:e,state:t}=this;return e.children(t.nowDate,t.todayRange)}componentDidMount(){this.setTimeout(),this.context.nowManager.addResetListener(this.handleRefresh),document.addEventListener("visibilitychange",this.handleVisibilityChange)}componentDidUpdate(e){e.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())}componentWillUnmount(){this.clearTimeout(),this.context.nowManager.removeResetListener(this.handleRefresh),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}computeTiming(){let{props:e,context:t}=this,n=t.nowManager.getDateMarker(),{nowIndicatorSnap:s}=t.options;s==="auto"&&(s=/year|month|week|day/.test(e.unit)||(e.unitValue||1)===1);let r,o;return s?(r=t.dateEnv.startOf(n,e.unit),o=t.dateEnv.add(r,te(1,e.unit)).valueOf()-n.valueOf()):(r=n,o=1e3*60),o=Math.min(1e3*60*60*24,o),{state:{nowDate:r,todayRange:aB(r)},waitMs:o}}setTimeout(e=this.computeTiming().waitMs){this.timeoutId=setTimeout(()=>{let t=this.computeTiming();this.setState(t.state,()=>{this.setTimeout(t.waitMs)})},e)}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}};Lt.contextType=bn;function aB(i){let e=de(i),t=Ee(e,1);return{start:e,end:t}}var ef=class{getCurrentData(){return this.currentDataManager.getCurrentData()}dispatch(e){this.currentDataManager.dispatch(e)}get view(){return this.getCurrentData().viewApi}batchRendering(e){e()}updateSize(){this.trigger("_resize",!0)}setOption(e,t){this.dispatch({type:"SET_OPTION",optionName:e,rawOptionValue:t})}getOption(e){return this.currentDataManager.currentCalendarOptionsInput[e]}getAvailableLocaleCodes(){return Object.keys(this.getCurrentData().availableRawLocales)}on(e,t){let{currentDataManager:n}=this;n.currentCalendarOptionsRefiners[e]?n.emitter.on(e,t):console.warn(`Unknown listener name '${e}'`)}off(e,t){this.currentDataManager.emitter.off(e,t)}trigger(e,...t){this.currentDataManager.emitter.trigger(e,...t)}changeView(e,t){this.batchRendering(()=>{if(this.unselect(),t)if(t.start&&t.end)this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e}),this.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:t});else{let{dateEnv:n}=this.getCurrentData();this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e,dateMarker:n.createMarker(t)})}else this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e})})}zoomTo(e,t){let n=this.getCurrentData(),s;t=t||"day",s=n.viewSpecs[t]||this.getUnitViewSpec(t),this.unselect(),s?this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:s.type,dateMarker:e}):this.dispatch({type:"CHANGE_DATE",dateMarker:e})}getUnitViewSpec(e){let{viewSpecs:t,toolbarConfig:n}=this.getCurrentData(),s=[].concat(n.header?n.header.viewsWithButtons:[],n.footer?n.footer.viewsWithButtons:[]),r,o;for(let a in t)s.push(a);for(r=0;r<s.length;r+=1)if(o=t[s[r]],o&&o.singleUnit===e)return o;return null}prev(){this.unselect(),this.dispatch({type:"PREV"})}next(){this.unselect(),this.dispatch({type:"NEXT"})}prevYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,-1)})}nextYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,1)})}today(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.nowManager.getDateMarker()})}gotoDate(e){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.createMarker(e)})}incrementDate(e){let t=this.getCurrentData(),n=te(e);n&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.add(t.currentDate,n)}))}getDate(){let e=this.getCurrentData();return e.dateEnv.toDate(e.currentDate)}formatDate(e,t){let{dateEnv:n}=this.getCurrentData();return n.format(n.createMarker(e),ue(t))}formatRange(e,t,n){let{dateEnv:s}=this.getCurrentData();return s.formatRange(s.createMarker(e),s.createMarker(t),ue(n),n)}formatIso(e,t){let{dateEnv:n}=this.getCurrentData();return n.formatIso(n.createMarker(e),{omitTime:t})}select(e,t){let n;t==null?e.start!=null?n=e:n={start:e,end:null}:n={start:e,end:t};let s=this.getCurrentData(),r=tB(n,s.dateEnv,te({days:1}));r&&(this.dispatch({type:"SELECT_DATES",selection:r}),Pv(r,null,s))}unselect(e){let t=this.getCurrentData();t.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),WH(e,t))}addEvent(e,t){if(e instanceof me){let o=e._def,a=e._instance;return this.getCurrentData().eventStore.defs[o.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:jh({def:o,instance:a})}),this.triggerEventAdd(e)),e}let n=this.getCurrentData(),s;if(t instanceof lr)s=t.internalEventSource;else if(typeof t=="boolean")t&&([s]=Cv(n.eventSources));else if(t!=null){let o=this.getEventSourceById(t);if(!o)return console.warn(`Could not find an event source with ID "${t}"`),null;s=o.internalEventSource}let r=lD(e,s,n,!1);if(r){let o=new me(n,r.def,r.def.recurringDef?null:r.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:jh(r)}),this.triggerEventAdd(o),o}return null}triggerEventAdd(e){let{emitter:t}=this.getCurrentData();t.trigger("eventAdd",{event:e,relatedEvents:[],revert:()=>{this.dispatch({type:"REMOVE_EVENTS",eventStore:hD(e)})}})}getEventById(e){let t=this.getCurrentData(),{defs:n,instances:s}=t.eventStore;e=String(e);for(let r in n){let o=n[r];if(o.publicId===e){if(o.recurringDef)return new me(t,o,null);for(let a in s){let l=s[a];if(l.defId===o.defId)return new me(t,o,l)}}}return null}getEvents(){let e=this.getCurrentData();return Si(e.eventStore,e)}removeAllEvents(){this.dispatch({type:"REMOVE_ALL_EVENTS"})}getEventSources(){let e=this.getCurrentData(),t=e.eventSources,n=[];for(let s in t)n.push(new lr(e,t[s]));return n}getEventSourceById(e){let t=this.getCurrentData(),n=t.eventSources;e=String(e);for(let s in n)if(n[s].publicId===e)return new lr(t,n[s]);return null}addEventSource(e){let t=this.getCurrentData();if(e instanceof lr)return t.eventSources[e.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[e.internalEventSource]}),e;let n=zS(e,t);return n?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[n]}),new lr(t,n)):null}removeAllEventSources(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})}refetchEvents(){this.dispatch({type:"FETCH_EVENT_SOURCES",isRefetch:!0})}scrollToTime(e){let t=te(e);t&&this.trigger("_scrollRequest",{time:t})}};function t_(i,e){return i.left>=e.left&&i.left<e.right&&i.top>=e.top&&i.top<e.bottom}function Mv(i,e){let t={left:Math.max(i.left,e.left),right:Math.min(i.right,e.right),top:Math.max(i.top,e.top),bottom:Math.min(i.bottom,e.bottom)};return t.left<t.right&&t.top<t.bottom?t:!1}function n_(i,e){return{left:Math.min(Math.max(i.left,e.left),e.right),top:Math.min(Math.max(i.top,e.top),e.bottom)}}function i_(i){return{left:(i.left+i.right)/2,top:(i.top+i.bottom)/2}}function s_(i,e){return{left:i.left-e.left,top:i.top-e.top}}var iS=yt(),tf=class{constructor(){this.getKeysForEventDefs=$(this._getKeysForEventDefs),this.splitDateSelection=$(this._splitDateSpan),this.splitEventStore=$(this._splitEventStore),this.splitIndividualUi=$(this._splitIndividualUi),this.splitEventDrag=$(this._splitInteraction),this.splitEventResize=$(this._splitInteraction),this.eventUiBuilders={}}splitProps(e){let t=this.getKeyInfo(e),n=this.getKeysForEventDefs(e.eventStore),s=this.splitDateSelection(e.dateSelection),r=this.splitIndividualUi(e.eventUiBases,n),o=this.splitEventStore(e.eventStore,n),a=this.splitEventDrag(e.eventDrag),l=this.splitEventResize(e.eventResize),c={};this.eventUiBuilders=yn(t,(d,h)=>this.eventUiBuilders[h]||$(lB));for(let d in t){let h=t[d],p=o[d]||iS,m=this.eventUiBuilders[d];c[d]={businessHours:h.businessHours||e.businessHours,dateSelection:s[d]||null,eventStore:p,eventUiBases:m(e.eventUiBases[""],h.ui,r[d]),eventSelection:p.instances[e.eventSelection]?e.eventSelection:"",eventDrag:a[d]||null,eventResize:l[d]||null}}return c}_splitDateSpan(e){let t={};if(e){let n=this.getKeysForDateSpan(e);for(let s of n)t[s]=e}return t}_getKeysForEventDefs(e){return yn(e.defs,t=>this.getKeysForEventDef(t))}_splitEventStore(e,t){let{defs:n,instances:s}=e,r={};for(let o in n)for(let a of t[o])r[a]||(r[a]=yt()),r[a].defs[o]=n[o];for(let o in s){let a=s[o];for(let l of t[a.defId])r[l]&&(r[l].instances[o]=a)}return r}_splitIndividualUi(e,t){let n={};for(let s in e)if(s)for(let r of t[s])n[r]||(n[r]={}),n[r][s]=e[s];return n}_splitInteraction(e){let t={};if(e){let n=this._splitEventStore(e.affectedEvents,this._getKeysForEventDefs(e.affectedEvents)),s=this._getKeysForEventDefs(e.mutatedEvents),r=this._splitEventStore(e.mutatedEvents,s),o=a=>{t[a]||(t[a]={affectedEvents:n[a]||iS,mutatedEvents:r[a]||iS,isEvent:e.isEvent})};for(let a in n)o(a);for(let a in r)o(a)}return t}};function lB(i,e,t){let n=[];i&&n.push(i),e&&n.push(e);let s={"":$S(n)};return t&&Object.assign(s,t),s}function bf(i,e,t,n){return{dow:i.getUTCDay(),isDisabled:!!(n&&(!n.activeRange||!mn(n.activeRange,i))),isOther:!!(n&&!mn(n.currentRange,i)),isToday:!!(e&&mn(e,i)),isPast:!!(t?i<t:e&&i<e.start),isFuture:!!(t?i>t:e&&i>=e.end)}}function Dc(i,e){let t=["fc-day",`fc-day-${$U[i.dow]}`];return i.isDisabled?t.push("fc-day-disabled"):(i.isToday&&(t.push("fc-day-today"),t.push(e.getClass("today"))),i.isPast&&t.push("fc-day-past"),i.isFuture&&t.push("fc-day-future"),i.isOther&&t.push("fc-day-other")),t}var cB=ue({year:"numeric",month:"long",day:"numeric"}),dB=ue({week:"long"});function _i(i,e,t="day",n=!0){let{dateEnv:s,options:r,calendarApi:o}=i,a=s.format(e,t==="week"?dB:cB);if(r.navLinks){let l=s.toDate(e),c=d=>{let h=t==="day"?r.navLinkDayClick:t==="week"?r.navLinkWeekClick:null;typeof h=="function"?h.call(o,s.toDate(e),d):(typeof h=="string"&&(t=h),o.zoomTo(e,t))};return Object.assign({title:_c(r.navLinkHint,[a,l],a),"data-navlink":""},n?qI(c):{onClick:c})}return{"aria-label":a}}var sS=null;function mD(){return sS===null&&(sS=uB()),sS}function uB(){let i=document.createElement("div");ha(i,{position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}),i.innerHTML="<div></div>",document.body.appendChild(i);let t=i.firstChild.getBoundingClientRect().left>i.getBoundingClientRect().left;return lf(i),t}var rS;function yD(){return rS||(rS=hB()),rS}function hB(){let i=document.createElement("div");i.style.overflow="scroll",i.style.position="absolute",i.style.top="-9999px",i.style.left="-9999px",document.body.appendChild(i);let e=vD(i);return document.body.removeChild(i),e}function vD(i){return{x:i.offsetHeight-i.clientHeight,y:i.offsetWidth-i.clientWidth}}function bD(i,e=!1){let t=window.getComputedStyle(i),n=parseInt(t.borderLeftWidth,10)||0,s=parseInt(t.borderRightWidth,10)||0,r=parseInt(t.borderTopWidth,10)||0,o=parseInt(t.borderBottomWidth,10)||0,a=vD(i),l=a.y-n-s,c=a.x-r-o,d={borderLeft:n,borderRight:s,borderTop:r,borderBottom:o,scrollbarBottom:c,scrollbarLeft:0,scrollbarRight:0};return mD()&&t.direction==="rtl"?d.scrollbarLeft=l:d.scrollbarRight=l,e&&(d.paddingLeft=parseInt(t.paddingLeft,10)||0,d.paddingRight=parseInt(t.paddingRight,10)||0,d.paddingTop=parseInt(t.paddingTop,10)||0,d.paddingBottom=parseInt(t.paddingBottom,10)||0),d}function r_(i,e=!1,t){let n=t?i.getBoundingClientRect():Ef(i),s=bD(i,e),r={left:n.left+s.borderLeft+s.scrollbarLeft,right:n.right-s.borderRight-s.scrollbarRight,top:n.top+s.borderTop,bottom:n.bottom-s.borderBottom-s.scrollbarBottom};return e&&(r.left+=s.paddingLeft,r.right-=s.paddingRight,r.top+=s.paddingTop,r.bottom-=s.paddingBottom),r}function Ef(i){let e=i.getBoundingClientRect();return{left:e.left+window.scrollX,top:e.top+window.scrollY,right:e.right+window.scrollX,bottom:e.bottom+window.scrollY}}function fB(i){let e=kv(i),t=i.getBoundingClientRect();for(let n of e){let s=Mv(t,n.getBoundingClientRect());if(s)t=s;else return null}return t}function kv(i){let e=[];for(;i instanceof HTMLElement;){let t=window.getComputedStyle(i);if(t.position==="fixed")break;/(auto|scroll)/.test(t.overflow+t.overflowY+t.overflowX)&&e.push(i),i=i.parentNode}return e}var qn=class{constructor(e,t,n,s){this.els=t;let r=this.originClientRect=e.getBoundingClientRect();n&&this.buildElHorizontals(r.left),s&&this.buildElVerticals(r.top)}buildElHorizontals(e){let t=[],n=[];for(let s of this.els){let r=s.getBoundingClientRect();t.push(r.left-e),n.push(r.right-e)}this.lefts=t,this.rights=n}buildElVerticals(e){let t=[],n=[];for(let s of this.els){let r=s.getBoundingClientRect();t.push(r.top-e),n.push(r.bottom-e)}this.tops=t,this.bottoms=n}leftToIndex(e){let{lefts:t,rights:n}=this,s=t.length,r;for(r=0;r<s;r+=1)if(e>=t[r]&&e<n[r])return r}topToIndex(e){let{tops:t,bottoms:n}=this,s=t.length,r;for(r=0;r<s;r+=1)if(e>=t[r]&&e<n[r])return r}getWidth(e){return this.rights[e]-this.lefts[e]}getHeight(e){return this.bottoms[e]-this.tops[e]}similarTo(e){return sv(this.tops||[],e.tops||[])&&sv(this.bottoms||[],e.bottoms||[])&&sv(this.lefts||[],e.lefts||[])&&sv(this.rights||[],e.rights||[])}};function sv(i,e){let t=i.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(Math.round(i[n])!==Math.round(e[n]))return!1;return!0}var sa=class{getMaxScrollTop(){return this.getScrollHeight()-this.getClientHeight()}getMaxScrollLeft(){return this.getScrollWidth()-this.getClientWidth()}canScrollVertically(){return this.getMaxScrollTop()>0}canScrollHorizontally(){return this.getMaxScrollLeft()>0}canScrollUp(){return this.getScrollTop()>0}canScrollDown(){return this.getScrollTop()<this.getMaxScrollTop()}canScrollLeft(){return this.getScrollLeft()>0}canScrollRight(){return this.getScrollLeft()<this.getMaxScrollLeft()}},nf=class extends sa{constructor(e){super(),this.el=e}getScrollTop(){return this.el.scrollTop}getScrollLeft(){return this.el.scrollLeft}setScrollTop(e){this.el.scrollTop=e}setScrollLeft(e){this.el.scrollLeft=e}getScrollWidth(){return this.el.scrollWidth}getScrollHeight(){return this.el.scrollHeight}getClientHeight(){return this.el.clientHeight}getClientWidth(){return this.el.clientWidth}},sf=class extends sa{getScrollTop(){return window.scrollY}getScrollLeft(){return window.scrollX}setScrollTop(e){window.scroll(window.scrollX,e)}setScrollLeft(e){window.scroll(e,window.scrollY)}getScrollWidth(){return document.documentElement.scrollWidth}getScrollHeight(){return document.documentElement.scrollHeight}getClientHeight(){return document.documentElement.clientHeight}getClientWidth(){return document.documentElement.clientWidth}},st=class extends ne{constructor(){super(...arguments),this.uid=gs()}prepareHits(){}queryHit(e,t,n,s){return null}isValidSegDownEl(e){return!this.props.eventDrag&&!this.props.eventResize&&!Ve(e,".fc-event-mirror")}isValidDateDownEl(e){return!Ve(e,".fc-event:not(.fc-bg-event)")&&!Ve(e,".fc-more-link")&&!Ve(e,"a[data-navlink]")&&!Ve(e,".fc-popover")}};var ra=class{constructor(e=t=>t.thickness||1){this.getEntryThickness=e,this.strictOrder=!1,this.allowReslicing=!1,this.maxCoord=-1,this.maxStackCnt=-1,this.levelCoords=[],this.entriesByLevel=[],this.stackCnts={}}addSegs(e){let t=[];for(let n of e)this.insertEntry(n,t);return t}insertEntry(e,t){let n=this.findInsertion(e);this.isInsertionValid(n,e)?this.insertEntryAt(e,n):this.handleInvalidInsertion(n,e,t)}isInsertionValid(e,t){return(this.maxCoord===-1||e.levelCoord+this.getEntryThickness(t)<=this.maxCoord)&&(this.maxStackCnt===-1||e.stackCnt<this.maxStackCnt)}handleInvalidInsertion(e,t,n){if(this.allowReslicing&&e.touchingEntry){let s=Object.assign(Object.assign({},t),{span:wf(t.span,e.touchingEntry.span)});n.push(s),this.splitEntry(t,e.touchingEntry,n)}else n.push(t)}splitEntry(e,t,n){let s=e.span,r=t.span;s.start<r.start&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:s.start,end:r.start}},n),s.end>r.end&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:r.end,end:s.end}},n)}insertEntryAt(e,t){let{entriesByLevel:n,levelCoords:s}=this;t.lateral===-1?(oS(s,t.level,t.levelCoord),oS(n,t.level,[e])):oS(n[t.level],t.lateral,e),this.stackCnts[Ei(e)]=t.stackCnt}findInsertion(e){let{levelCoords:t,entriesByLevel:n,strictOrder:s,stackCnts:r}=this,o=t.length,a=0,l=-1,c=-1,d=null,h=0;for(let y=0;y<o;y+=1){let v=t[y];if(!s&&v>=a+this.getEntryThickness(e))break;let E=n[y],A,_=of(E,e.span.start,rf),C=_[0]+_[1];for(;(A=E[C])&&A.span.start<e.span.end;){let T=v+this.getEntryThickness(A);T>a&&(a=T,d=A,l=y,c=C),T===a&&(h=Math.max(h,r[Ei(A)]+1)),C+=1}}let p=0;if(d)for(p=l+1;p<o&&t[p]<a;)p+=1;let m=-1;return p<o&&t[p]===a&&(m=of(n[p],e.span.end,rf)[0]),{touchingLevel:l,touchingLateral:c,touchingEntry:d,stackCnt:h,levelCoord:a,level:p,lateral:m}}toRects(){let{entriesByLevel:e,levelCoords:t}=this,n=e.length,s=[];for(let r=0;r<n;r+=1){let o=e[r],a=t[r];for(let l of o)s.push(Object.assign(Object.assign({},l),{thickness:this.getEntryThickness(l),levelCoord:a}))}return s}};function rf(i){return i.span.end}function Ei(i){return i.index+":"+i.span.start}function o_(i){let e=[];for(let t of i){let n=[],s={span:t.span,entries:[t]};for(let r of e)wf(r.span,s.span)?s={entries:r.entries.concat(s.entries),span:pB(r.span,s.span)}:n.push(r);n.push(s),e=n}return e}function pB(i,e){return{start:Math.min(i.start,e.start),end:Math.max(i.end,e.end)}}function wf(i,e){let t=Math.max(i.start,e.start),n=Math.min(i.end,e.end);return t<n?{start:t,end:n}:null}function oS(i,e,t){i.splice(e,0,t)}function of(i,e,t){let n=0,s=i.length;if(!s||e<t(i[n]))return[0,0];if(e>t(i[s-1]))return[s,0];for(;n<s;){let r=Math.floor(n+(s-n)/2),o=t(i[r]);if(e<o)s=r;else if(e>o)n=r+1;else return[r,1]}return[n,0]}var af=class{constructor(e,t){this.emitter=new fs}destroy(){}setMirrorIsVisible(e){}setMirrorNeedsRevert(e){}setAutoScrollEnabled(e){}},Af={};function ED(i,e){return!i||e>10?ue({weekday:"short"}):e>1?ue({weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}):ue({weekday:"long"})}var wD="fc-col-header-cell";function AD(i){return i.text}var yv=class extends ne{render(){let{dateEnv:e,options:t,theme:n,viewApi:s}=this.context,{props:r}=this,{date:o,dateProfile:a}=r,l=bf(o,r.todayRange,null,a),c=[wD].concat(Dc(l,n)),d=e.format(o,r.dayHeaderFormat),h=!l.isDisabled&&r.colCnt>1?_i(this.context,o):{},p=e.toDate(o);e.namedTimeZoneImpl&&(p=vi(p,36e5));let m=Object.assign(Object.assign(Object.assign({date:p,view:s},r.extraRenderProps),{text:d}),l);return x(xe,{elTag:"th",elClasses:c,elAttrs:Object.assign({role:"columnheader",colSpan:r.colSpan,"data-date":l.isDisabled?void 0:mr(o)},r.extraDataAttrs),renderProps:m,generatorName:"dayHeaderContent",customGenerator:t.dayHeaderContent,defaultGenerator:AD,classNameGenerator:t.dayHeaderClassNames,didMount:t.dayHeaderDidMount,willUnmount:t.dayHeaderWillUnmount},y=>x("div",{className:"fc-scrollgrid-sync-inner"},!l.isDisabled&&x(y,{elTag:"a",elAttrs:h,elClasses:["fc-col-header-cell-cushion",r.isSticky&&"fc-sticky"]})))}},gB=ue({weekday:"long"}),vv=class extends ne{render(){let{props:e}=this,{dateEnv:t,theme:n,viewApi:s,options:r}=this.context,o=Ee(new Date(2592e5),e.dow),a={dow:e.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},l=t.format(o,e.dayHeaderFormat),c=Object.assign(Object.assign(Object.assign(Object.assign({date:o},a),{view:s}),e.extraRenderProps),{text:l});return x(xe,{elTag:"th",elClasses:[wD,...Dc(a,n),...e.extraClassNames||[]],elAttrs:Object.assign({role:"columnheader",colSpan:e.colSpan},e.extraDataAttrs),renderProps:c,generatorName:"dayHeaderContent",customGenerator:r.dayHeaderContent,defaultGenerator:AD,classNameGenerator:r.dayHeaderClassNames,didMount:r.dayHeaderDidMount,willUnmount:r.dayHeaderWillUnmount},d=>x("div",{className:"fc-scrollgrid-sync-inner"},x(d,{elTag:"a",elClasses:["fc-col-header-cell-cushion",e.isSticky&&"fc-sticky"],elAttrs:{"aria-label":t.format(o,gB)}})))}},oa=class extends ne{constructor(){super(...arguments),this.createDayHeaderFormatter=$(mB)}render(){let{context:e}=this,{dates:t,dateProfile:n,datesRepDistinctDays:s,renderIntro:r}=this.props,o=this.createDayHeaderFormatter(e.options.dayHeaderFormat,s,t.length);return x(Lt,{unit:"day"},(a,l)=>x("tr",{role:"row"},r&&r("day"),t.map(c=>s?x(yv,{key:c.toISOString(),date:c,dateProfile:n,todayRange:l,colCnt:t.length,dayHeaderFormat:o}):x(vv,{key:c.getUTCDay(),dow:c.getUTCDay(),dayHeaderFormat:o}))))}};function mB(i,e,t){return i||ED(e,t)}var aa=class{constructor(e,t){let n=e.start,{end:s}=e,r=[],o=[],a=-1;for(;n<s;)t.isHiddenDay(n)?r.push(a+.5):(a+=1,r.push(a),o.push(n)),n=Ee(n,1);this.dates=o,this.indices=r,this.cnt=o.length}sliceRange(e){let t=this.getDateDayIndex(e.start),n=this.getDateDayIndex(Ee(e.end,-1)),s=Math.max(0,t),r=Math.min(this.cnt-1,n);return s=Math.ceil(s),r=Math.floor(r),s<=r?{firstIndex:s,lastIndex:r,isStart:t===s,isEnd:n===r}:null}getDateDayIndex(e){let{indices:t}=this,n=Math.floor(Ai(this.dates[0],e));return n<0?t[0]-1:n>=t.length?t[t.length-1]+1:t[n]}},la=class{constructor(e,t){let{dates:n}=e,s,r,o;if(t){for(r=n[0].getUTCDay(),s=1;s<n.length&&n[s].getUTCDay()!==r;s+=1);o=Math.ceil(n.length/s)}else o=1,s=n.length;this.rowCnt=o,this.colCnt=s,this.daySeries=e,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}buildCells(){let e=[];for(let t=0;t<this.rowCnt;t+=1){let n=[];for(let s=0;s<this.colCnt;s+=1)n.push(this.buildCell(t,s));e.push(n)}return e}buildCell(e,t){let n=this.daySeries.dates[e*this.colCnt+t];return{key:n.toISOString(),date:n}}buildHeaderDates(){let e=[];for(let t=0;t<this.colCnt;t+=1)e.push(this.cells[0][t].date);return e}sliceRange(e){let{colCnt:t}=this,n=this.daySeries.sliceRange(e),s=[];if(n){let{firstIndex:r,lastIndex:o}=n,a=r;for(;a<=o;){let l=Math.floor(a/t),c=Math.min((l+1)*t,o+1);s.push({row:l,firstCol:a%t,lastCol:(c-1)%t,isStart:n.isStart&&a===r,isEnd:n.isEnd&&c-1===o}),a=c}}return s}},ca=class{constructor(){this.sliceBusinessHours=$(this._sliceBusinessHours),this.sliceDateSelection=$(this._sliceDateSpan),this.sliceEventStore=$(this._sliceEventStore),this.sliceEventDrag=$(this._sliceInteraction),this.sliceEventResize=$(this._sliceInteraction),this.forceDayIfListItem=!1}sliceProps(e,t,n,s,...r){let{eventUiBases:o}=e,a=this.sliceEventStore(e.eventStore,o,t,n,...r);return{dateSelectionSegs:this.sliceDateSelection(e.dateSelection,t,n,o,s,...r),businessHourSegs:this.sliceBusinessHours(e.businessHours,t,n,s,...r),fgEventSegs:a.fg,bgEventSegs:a.bg,eventDrag:this.sliceEventDrag(e.eventDrag,o,t,n,...r),eventResize:this.sliceEventResize(e.eventResize,o,t,n,...r),eventSelection:e.eventSelection}}sliceNowDate(e,t,n,s,...r){return this._sliceDateSpan({range:{start:e,end:vi(e,1)},allDay:!1},t,n,{},s,...r)}_sliceBusinessHours(e,t,n,s,...r){return e?this._sliceEventStore(ia(e,rv(t,!!n),s),{},t,n,...r).bg:[]}_sliceEventStore(e,t,n,s,...r){if(e){let o=Ac(e,t,rv(n,!!s),s);return{bg:this.sliceEventRanges(o.bg,r),fg:this.sliceEventRanges(o.fg,r)}}return{bg:[],fg:[]}}_sliceInteraction(e,t,n,s,...r){if(!e)return null;let o=Ac(e.mutatedEvents,t,rv(n,!!s),s);return{segs:this.sliceEventRanges(o.fg,r),affectedInstances:e.affectedEvents.instances,isEvent:e.isEvent}}_sliceDateSpan(e,t,n,s,r,...o){if(!e)return[];let a=rv(t,!!n),l=tn(e.range,a);if(l){e=Object.assign(Object.assign({},e),{range:l});let c=rB(e,s,r),d=this.sliceRange(e.range,...o);for(let h of d)h.eventRange=c;return d}return[]}sliceEventRanges(e,t){let n=[];for(let s of e)n.push(...this.sliceEventRange(s,t));return n}sliceEventRange(e,t){let n=e.range;this.forceDayIfListItem&&e.ui.display==="list-item"&&(n={start:n.start,end:Ee(n.start,1)});let s=this.sliceRange(n,...t);for(let r of s)r.eventRange=e,r.isStart=e.isStart&&r.isStart,r.isEnd=e.isEnd&&r.isEnd;return s}};function rv(i,e){let t=i.activeRange;return e?t:{start:vi(t.start,i.slotMinTime.milliseconds),end:vi(t.end,i.slotMaxTime.milliseconds-864e5)}}function Nv(i,e,t){let{instances:n}=i.mutatedEvents;for(let s in n)if(!Tc(e.validRange,n[s].range))return!1;return SD({eventDrag:i},t)}function a_(i,e,t){return Tc(e.validRange,i.range)?SD({dateSelection:i},t):!1}function SD(i,e){let t=e.getCurrentData(),n=Object.assign({businessHours:t.businessHours,dateSelection:"",eventStore:t.eventStore,eventUiBases:t.eventUiBases,eventSelection:"",eventDrag:null,eventResize:null},i);return(e.pluginHooks.isPropsValid||_D)(n,e)}function _D(i,e,t={},n){return!(i.eventDrag&&!yB(i,e,t,n)||i.dateSelection&&!vB(i,e,t,n))}function yB(i,e,t,n){let s=e.getCurrentData(),r=i.eventDrag,o=r.mutatedEvents,a=o.defs,l=o.instances,c=gv(a,r.isEvent?i.eventUiBases:{"":s.selectionConfig});n&&(c=yn(c,n));let d=BH(i.eventStore,r.affectedEvents.instances),h=d.defs,p=d.instances,m=gv(h,i.eventUiBases);for(let y in l){let v=l[y],E=v.range,A=c[v.defId],_=a[v.defId];if(!CD(A.constraints,E,d,i.businessHours,e))return!1;let{eventOverlap:C}=e.options,T=typeof C=="function"?C:null;for(let I in p){let D=p[I];if(Tv(E,D.range)&&(m[D.defId].overlap===!1&&r.isEvent||A.overlap===!1||T&&!T(new me(e,h[D.defId],D),new me(e,_,v))))return!1}let R=s.eventStore;for(let I of A.allows){let D=Object.assign(Object.assign({},t),{range:v.range,allDay:_.allDay}),k=R.defs[_.defId],N=R.instances[y],F;if(k?F=new me(e,k,N):F=new me(e,_),!I(KS(D,e),F))return!1}}return!0}function vB(i,e,t,n){let s=i.eventStore,r=s.defs,o=s.instances,a=i.dateSelection,l=a.range,{selectionConfig:c}=e.getCurrentData();if(n&&(c=n(c)),!CD(c.constraints,l,s,i.businessHours,e))return!1;let{selectOverlap:d}=e.options,h=typeof d=="function"?d:null;for(let p in o){let m=o[p];if(Tv(l,m.range)&&(c.overlap===!1||h&&!h(new me(e,r[m.defId],m),null)))return!1}for(let p of c.allows){let m=Object.assign(Object.assign({},t),a);if(!p(KS(m,e),null))return!1}return!0}function CD(i,e,t,n,s){for(let r of i)if(!EB(bB(r,e,t,n,s),e))return!1;return!0}function bB(i,e,t,n,s){return i==="businessHours"?aS(ia(n,e,s)):typeof i=="string"?aS(Dv(t,r=>r.groupId===i)):typeof i=="object"&&i?aS(ia(i,e,s)):[]}function aS(i){let{instances:e}=i,t=[];for(let n in e)t.push(e[n].range);return t}function EB(i,e){for(let t of i)if(Tc(t,e))return!0;return!1}var ov=/^(visible|hidden)$/,Sc=class extends ne{constructor(){super(...arguments),this.handleEl=e=>{this.el=e,nn(this.props.elRef,e)}}render(){let{props:e}=this,{liquid:t,liquidIsAbsolute:n}=e,s=t&&n,r=["fc-scroller"];return t&&(n?r.push("fc-scroller-liquid-absolute"):r.push("fc-scroller-liquid")),x("div",{ref:this.handleEl,className:r.join(" "),style:{overflowX:e.overflowX,overflowY:e.overflowY,left:s&&-(e.overcomeLeft||0)||"",right:s&&-(e.overcomeRight||0)||"",bottom:s&&-(e.overcomeBottom||0)||"",marginLeft:!s&&-(e.overcomeLeft||0)||"",marginRight:!s&&-(e.overcomeRight||0)||"",marginBottom:!s&&-(e.overcomeBottom||0)||"",maxHeight:e.maxHeight||""}},e.children)}needsXScrolling(){if(ov.test(this.props.overflowX))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),{children:n}=e;for(let s=0;s<n.length;s+=1)if(n[s].getBoundingClientRect().width>t)return!0;return!1}needsYScrolling(){if(ov.test(this.props.overflowY))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),{children:n}=e;for(let s=0;s<n.length;s+=1)if(n[s].getBoundingClientRect().height>t)return!0;return!1}getXScrollbarWidth(){return ov.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight}getYScrollbarWidth(){return ov.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth}},Ot=class{constructor(e){this.masterCallback=e,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=(t,n)=>{let{depths:s,currentMap:r}=this,o=!1,a=!1;t!==null?(o=n in r,r[n]=t,s[n]=(s[n]||0)+1,a=!0):(s[n]-=1,s[n]||(delete r[n],delete this.callbackMap[n],o=!0)),this.masterCallback&&(o&&this.masterCallback(null,String(n)),a&&this.masterCallback(t,String(n)))}}createRef(e){let t=this.callbackMap[e];return t||(t=this.callbackMap[e]=n=>{this.handleValue(n,String(e))}),t}collect(e,t,n){return eD(this.currentMap,e,t,n)}getAll(){return Cv(this.currentMap)}};function TD(i){let e=$I(i,".fc-scrollgrid-shrink"),t=0;for(let n of e)t=Math.max(t,OU(n));return Math.ceil(t)}function l_(i,e){return i.liquid&&e.liquid}function xD(i,e){return e.maxHeight!=null||l_(i,e)}function RD(i,e,t,n){let{expandRows:s}=t;return typeof e.content=="function"?e.content(t):x("table",{role:"presentation",className:[e.tableClassName,i.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:t.tableMinWidth,width:t.clientWidth,height:s?t.clientHeight:""}},t.tableColGroupNode,x(n?"thead":"tbody",{role:"presentation"},typeof e.rowContent=="function"?e.rowContent(t):e.rowContent))}function ID(i,e){return wi(i,e,Ft)}function DD(i,e){let t=[];for(let n of i){let s=n.span||1;for(let r=0;r<s;r+=1)t.push(x("col",{style:{width:n.width==="shrink"?PD(e):n.width||"",minWidth:n.minWidth||""}}))}return x("colgroup",{},...t)}function PD(i){return i==null?4:i}function MD(i){for(let e of i)if(e.width==="shrink")return!0;return!1}function kD(i,e){let t=["fc-scrollgrid",e.theme.getClass("table")];return i&&t.push("fc-scrollgrid-liquid"),t}function ND(i,e){let t=["fc-scrollgrid-section",`fc-scrollgrid-section-${i.type}`,i.className];return e&&i.liquid&&i.maxHeight==null&&t.push("fc-scrollgrid-section-liquid"),i.isSticky&&t.push("fc-scrollgrid-section-sticky"),t}function Pc(i){return x("div",{className:"fc-scrollgrid-sticky-shim",style:{width:i.clientWidth,minWidth:i.tableMinWidth}})}function pa(i){let{stickyHeaderDates:e}=i;return(e==null||e==="auto")&&(e=i.height==="auto"||i.viewHeight==="auto"),e}function Sf(i){let{stickyFooterScrollbar:e}=i;return(e==null||e==="auto")&&(e=i.height==="auto"||i.viewHeight==="auto"),e}var hr=class extends ne{constructor(){super(...arguments),this.processCols=$(e=>e,ID),this.renderMicroColGroup=$(DD),this.scrollerRefs=new Ot,this.scrollerElRefs=new Ot(this._handleScrollerEl.bind(this)),this.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},this.handleSizing=()=>{this.safeSetState(Object.assign({shrinkWidth:this.computeShrinkWidth()},this.computeScrollerDims()))}}render(){let{props:e,state:t,context:n}=this,s=e.sections||[],r=this.processCols(e.cols),o=this.renderMicroColGroup(r,t.shrinkWidth),a=kD(e.liquid,n);e.collapsibleWidth&&a.push("fc-scrollgrid-collapsible");let l=s.length,c=0,d,h=[],p=[],m=[];for(;c<l&&(d=s[c]).type==="header";)h.push(this.renderSection(d,o,!0)),c+=1;for(;c<l&&(d=s[c]).type==="body";)p.push(this.renderSection(d,o,!1)),c+=1;for(;c<l&&(d=s[c]).type==="footer";)m.push(this.renderSection(d,o,!0)),c+=1;let y=!e_(),v={role:"rowgroup"};return x("table",{role:"grid",className:a.join(" "),style:{height:e.height}},!!(!y&&h.length)&&x("thead",v,...h),!!(!y&&p.length)&&x("tbody",v,...p),!!(!y&&m.length)&&x("tfoot",v,...m),y&&x("tbody",v,...h,...p,...m))}renderSection(e,t,n){return"outerContent"in e?x(ae,{key:e.key},e.outerContent):x("tr",{key:e.key,role:"presentation",className:ND(e,this.props.liquid).join(" ")},this.renderChunkTd(e,t,e.chunk,n))}renderChunkTd(e,t,n,s){if("outerContent"in n)return n.outerContent;let{props:r}=this,{forceYScrollbars:o,scrollerClientWidths:a,scrollerClientHeights:l}=this.state,c=xD(r,e),d=l_(r,e),h=r.liquid?o?"scroll":c?"auto":"hidden":"visible",p=e.key,m=RD(e,n,{tableColGroupNode:t,tableMinWidth:"",clientWidth:!r.collapsibleWidth&&a[p]!==void 0?a[p]:null,clientHeight:l[p]!==void 0?l[p]:null,expandRows:e.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:()=>{}},s);return x(s?"th":"td",{ref:n.elRef,role:"presentation"},x("div",{className:`fc-scroller-harness${d?" fc-scroller-harness-liquid":""}`},x(Sc,{ref:this.scrollerRefs.createRef(p),elRef:this.scrollerElRefs.createRef(p),overflowY:h,overflowX:r.liquid?"hidden":"visible",maxHeight:e.maxHeight,liquid:d,liquidIsAbsolute:!0},m)))}_handleScrollerEl(e,t){let n=wB(this.props.sections,t);n&&nn(n.chunk.scrollerElRef,e)}componentDidMount(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)}componentDidUpdate(){this.handleSizing()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}computeShrinkWidth(){return MD(this.props.cols)?TD(this.scrollerElRefs.getAll()):0}computeScrollerDims(){let e=yD(),{scrollerRefs:t,scrollerElRefs:n}=this,s=!1,r={},o={};for(let a in t.currentMap){let l=t.currentMap[a];if(l&&l.needsYScrolling()){s=!0;break}}for(let a of this.props.sections){let l=a.key,c=n.currentMap[l];if(c){let d=c.parentNode;r[l]=Math.floor(d.getBoundingClientRect().width-(s?e.y:0)),o[l]=Math.floor(d.getBoundingClientRect().height)}}return{forceYScrollbars:s,scrollerClientWidths:r,scrollerClientHeights:o}}};hr.addStateEquality({scrollerClientWidths:Ft,scrollerClientHeights:Ft});function wB(i,e){for(let t of i)if(t.key===e)return t;return null}var ps=class extends ne{constructor(){super(...arguments),this.buildPublicEvent=$((e,t,n)=>new me(e,t,n)),this.handleEl=e=>{this.el=e,nn(this.props.elRef,e),e&&OI(e,this.props.seg)}}render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,{eventRange:r}=s,{ui:o}=r,a={event:this.buildPublicEvent(t,r.def,r.instance),view:t.viewApi,timeText:e.timeText,textColor:o.textColor,backgroundColor:o.backgroundColor,borderColor:o.borderColor,isDraggable:!e.disableDragging&&JH(s,t),isStartResizable:!e.disableResizing&&ZH(s,t),isEndResizable:!e.disableResizing&&jH(s),isMirror:!!(e.isDragging||e.isResizing||e.isDateSelecting),isStart:!!s.isStart,isEnd:!!s.isEnd,isPast:!!e.isPast,isFuture:!!e.isFuture,isToday:!!e.isToday,isSelected:!!e.isSelected,isDragging:!!e.isDragging,isResizing:!!e.isResizing};return x(xe,{elRef:this.handleEl,elTag:e.elTag,elAttrs:e.elAttrs,elClasses:[...QH(a),...s.eventRange.ui.classNames,...e.elClasses||[]],elStyle:e.elStyle,renderProps:a,generatorName:"eventContent",customGenerator:n.eventContent,defaultGenerator:e.defaultGenerator,classNameGenerator:n.eventClassNames,didMount:n.eventDidMount,willUnmount:n.eventWillUnmount},e.children)}componentDidUpdate(e){this.el&&this.props.seg!==e.seg&&OI(this.el,this.props.seg)}},fr=class extends ne{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,{ui:r}=s.eventRange,o=n.eventTimeFormat||e.defaultTimeFormat,a=br(s,o,t,e.defaultDisplayEventTime,e.defaultDisplayEventEnd);return x(ps,Object.assign({},e,{elTag:"a",elStyle:{borderColor:r.borderColor,backgroundColor:r.backgroundColor},elAttrs:Rc(s,t),defaultGenerator:AB,timeText:a}),(l,c)=>x(ae,null,x(l,{elTag:"div",elClasses:["fc-event-main"],elStyle:{color:c.textColor}}),!!c.isStartResizable&&x("div",{className:"fc-event-resizer fc-event-resizer-start"}),!!c.isEndResizable&&x("div",{className:"fc-event-resizer fc-event-resizer-end"})))}};fr.addPropsEquality({seg:Ft});function AB(i){return x("div",{className:"fc-event-main-frame"},i.timeText&&x("div",{className:"fc-event-time"},i.timeText),x("div",{className:"fc-event-title-container"},x("div",{className:"fc-event-title fc-sticky"},i.event.title||x(ae,null,"\xA0"))))}var _f=i=>x(bn.Consumer,null,e=>{let{options:t}=e,n={isAxis:i.isAxis,date:e.dateEnv.toDate(i.date),view:e.viewApi};return x(xe,{elRef:i.elRef,elTag:i.elTag||"div",elAttrs:i.elAttrs,elClasses:i.elClasses,elStyle:i.elStyle,renderProps:n,generatorName:"nowIndicatorContent",customGenerator:t.nowIndicatorContent,classNameGenerator:t.nowIndicatorClassNames,didMount:t.nowIndicatorDidMount,willUnmount:t.nowIndicatorWillUnmount},i.children)}),SB=ue({day:"numeric"}),pr=class extends ne{constructor(){super(...arguments),this.refineRenderProps=Cc(_B)}render(){let{props:e,context:t}=this,{options:n}=t,s=this.refineRenderProps({date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,isMonthStart:e.isMonthStart||!1,showDayNumber:e.showDayNumber,extraRenderProps:e.extraRenderProps,viewApi:t.viewApi,dateEnv:t.dateEnv,monthStartFormat:n.monthStartFormat});return x(xe,{elRef:e.elRef,elTag:e.elTag,elAttrs:Object.assign(Object.assign({},e.elAttrs),s.isDisabled?{}:{"data-date":mr(e.date)}),elClasses:[...Dc(s,t.theme),...e.elClasses||[]],elStyle:e.elStyle,renderProps:s,generatorName:"dayCellContent",customGenerator:n.dayCellContent,defaultGenerator:e.defaultGenerator,classNameGenerator:s.isDisabled?void 0:n.dayCellClassNames,didMount:n.dayCellDidMount,willUnmount:n.dayCellWillUnmount},e.children)}};function Mc(i){return!!(i.dayCellContent||gS("dayCellContent",i))}function _B(i){let{date:e,dateEnv:t,dateProfile:n,isMonthStart:s}=i,r=bf(e,i.todayRange,null,n),o=i.showDayNumber?t.format(e,s?i.monthStartFormat:SB):"";return Object.assign(Object.assign(Object.assign({date:t.toDate(e),view:i.viewApi},r),{isMonthStart:s,dayNumberText:o}),i.extraRenderProps)}var da=class extends ne{render(){let{props:e}=this,{seg:t}=e;return x(ps,{elTag:"div",elClasses:["fc-bg-event"],elStyle:{backgroundColor:t.eventRange.ui.backgroundColor},defaultGenerator:CB,seg:t,timeText:"",isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:e.isPast,isFuture:e.isFuture,isToday:e.isToday,disableDragging:!0,disableResizing:!0})}};function CB(i){let{title:e}=i.event;return e&&x("div",{className:"fc-event-title"},i.event.title)}function Cf(i){return x("div",{className:`fc-${i}`})}var Tf=i=>x(bn.Consumer,null,e=>{let{dateEnv:t,options:n}=e,{date:s}=i,r=n.weekNumberFormat||i.defaultFormat,o=t.computeWeekNumber(s),a=t.format(s,r),l={num:o,text:a,date:s};return x(xe,{elRef:i.elRef,elTag:i.elTag,elAttrs:i.elAttrs,elClasses:i.elClasses,elStyle:i.elStyle,renderProps:l,generatorName:"weekNumberContent",customGenerator:n.weekNumberContent,defaultGenerator:TB,classNameGenerator:n.weekNumberClassNames,didMount:n.weekNumberDidMount,willUnmount:n.weekNumberWillUnmount},i.children)});function TB(i){return i.text}var lS=10,yS=class extends ne{constructor(){super(...arguments),this.state={titleId:vn()},this.handleRootEl=e=>{this.rootEl=e,this.props.elRef&&nn(this.props.elRef,e)},this.handleDocumentMouseDown=e=>{let t=bv(e);this.rootEl.contains(t)||this.handleCloseClick()},this.handleDocumentKeyDown=e=>{e.key==="Escape"&&this.handleCloseClick()},this.handleCloseClick=()=>{let{onClose:e}=this.props;e&&e()}}render(){let{theme:e,options:t}=this.context,{props:n,state:s}=this,r=["fc-popover",e.getClass("popover")].concat(n.extraClassNames||[]);return CI(x("div",Object.assign({},n.extraAttrs,{id:n.id,className:r.join(" "),"aria-labelledby":s.titleId,ref:this.handleRootEl}),x("div",{className:"fc-popover-header "+e.getClass("popoverHeader")},x("span",{className:"fc-popover-title",id:s.titleId},n.title),x("span",{className:"fc-popover-close "+e.getIconClass("close"),title:t.closeHint,onClick:this.handleCloseClick})),x("div",{className:"fc-popover-body "+e.getClass("popoverContent")},n.children)),n.parentEl)}componentDidMount(){document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("keydown",this.handleDocumentKeyDown),this.updateSize()}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("keydown",this.handleDocumentKeyDown)}updateSize(){let{isRtl:e}=this.context,{alignmentEl:t,alignGridTop:n}=this.props,{rootEl:s}=this,r=fB(t);if(r){let o=s.getBoundingClientRect(),a=n?Ve(t,".fc-scrollgrid").getBoundingClientRect().top:r.top,l=e?r.right-o.width:r.left;a=Math.max(a,lS),l=Math.min(l,document.documentElement.clientWidth-lS-o.width),l=Math.max(l,lS);let c=s.offsetParent.getBoundingClientRect();ha(s,{top:a-c.top,left:l-c.left})}}},vS=class extends st{constructor(){super(...arguments),this.handleRootEl=e=>{this.rootEl=e,e?this.context.registerInteractiveComponent(this,{el:e,useEventCenter:!1}):this.context.unregisterInteractiveComponent(this)}}render(){let{options:e,dateEnv:t}=this.context,{props:n}=this,{startDate:s,todayRange:r,dateProfile:o}=n,a=t.format(s,e.dayPopoverFormat);return x(pr,{elRef:this.handleRootEl,date:s,dateProfile:o,todayRange:r},(l,c,d)=>x(yS,{elRef:d.ref,id:n.id,title:a,extraClassNames:["fc-more-popover"].concat(d.className||[]),extraAttrs:d,parentEl:n.parentEl,alignmentEl:n.alignmentEl,alignGridTop:n.alignGridTop,onClose:n.onClose},Mc(e)&&x(l,{elTag:"div",elClasses:["fc-more-popover-misc"]}),n.children))}queryHit(e,t,n,s){let{rootEl:r,props:o}=this;return e>=0&&e<n&&t>=0&&t<s?{dateProfile:o.dateProfile,dateSpan:Object.assign({allDay:!o.forceTimed,range:{start:o.startDate,end:o.endDate}},o.extraDateSpan),dayEl:r,rect:{left:0,top:0,right:n,bottom:s},layer:1}:null}},ua=class extends ne{constructor(){super(...arguments),this.state={isPopoverOpen:!1,popoverId:vn()},this.handleLinkEl=e=>{this.linkEl=e,this.props.elRef&&nn(this.props.elRef,e)},this.handleClick=e=>{let{props:t,context:n}=this,{moreLinkClick:s}=n.options,r=UI(t).start;function o(a){let{def:l,instance:c,range:d}=a.eventRange;return{event:new me(n,l,c),start:n.dateEnv.toDate(d.start),end:n.dateEnv.toDate(d.end),isStart:a.isStart,isEnd:a.isEnd}}typeof s=="function"&&(s=s({date:r,allDay:!!t.allDayDate,allSegs:t.allSegs.map(o),hiddenSegs:t.hiddenSegs.map(o),jsEvent:e,view:n.viewApi})),!s||s==="popover"?this.setState({isPopoverOpen:!0}):typeof s=="string"&&n.calendarApi.zoomTo(r,s)},this.handlePopoverClose=()=>{this.setState({isPopoverOpen:!1})}}render(){let{props:e,state:t}=this;return x(bn.Consumer,null,n=>{let{viewApi:s,options:r,calendarApi:o}=n,{moreLinkText:a}=r,{moreCnt:l}=e,c=UI(e),d=typeof a=="function"?a.call(o,l):`+${l} ${a}`,h=_c(r.moreLinkHint,[l],d),p={num:l,shortText:`+${l}`,text:d,view:s};return x(ae,null,!!e.moreCnt&&x(xe,{elTag:e.elTag||"a",elRef:this.handleLinkEl,elClasses:[...e.elClasses||[],"fc-more-link"],elStyle:e.elStyle,elAttrs:Object.assign(Object.assign(Object.assign({},e.elAttrs),qI(this.handleClick)),{title:h,"aria-expanded":t.isPopoverOpen,"aria-controls":t.isPopoverOpen?t.popoverId:""}),renderProps:p,generatorName:"moreLinkContent",customGenerator:r.moreLinkContent,defaultGenerator:e.defaultGenerator||xB,classNameGenerator:r.moreLinkClassNames,didMount:r.moreLinkDidMount,willUnmount:r.moreLinkWillUnmount},e.children),t.isPopoverOpen&&x(vS,{id:t.popoverId,startDate:c.start,endDate:c.end,dateProfile:e.dateProfile,todayRange:e.todayRange,extraDateSpan:e.extraDateSpan,parentEl:this.parentEl,alignmentEl:e.alignmentElRef?e.alignmentElRef.current:this.linkEl,alignGridTop:e.alignGridTop,forceTimed:e.forceTimed,onClose:this.handlePopoverClose},e.popoverContent()))})}componentDidMount(){this.updateParentEl()}componentDidUpdate(){this.updateParentEl()}updateParentEl(){this.linkEl&&(this.parentEl=Ve(this.linkEl,".fc-view-harness"))}};function xB(i){return i.text}function UI(i){if(i.allDayDate)return{start:i.allDayDate,end:Ee(i.allDayDate,1)};let{hiddenSegs:e}=i;return{start:Fv(e),end:IB(e)}}function Fv(i){return i.reduce(RB).eventRange.range.start}function RB(i,e){return i.eventRange.range.start<e.eventRange.range.start?i:e}function IB(i){return i.reduce(DB).eventRange.range.end}function DB(i,e){return i.eventRange.range.end>e.eventRange.range.end?i:e}var PB=[],VD={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},GD=Object.assign(Object.assign({},VD),{buttonHints:{prev:"Previous $0",next:"Next $0",today(i,e){return e==="day"?"Today":`This ${i}`}},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint(i){return`Show ${i} more event${i===1?"":"s"}`}});function MB(i){let e=i.length>0?i[0].code:"en",t=PB.concat(i),n={en:GD};for(let s of t)n[s.code]=s;return{map:n,defaultCode:e}}function $D(i,e){return typeof i=="object"&&!Array.isArray(i)?zD(i.code,[i.code],i):kB(i,e)}function kB(i,e){let t=[].concat(i||[]),n=NB(t,e)||GD;return zD(i,t,n)}function NB(i,e){for(let t=0;t<i.length;t+=1){let n=i[t].toLocaleLowerCase().split("-");for(let s=n.length;s>0;s-=1){let r=n.slice(0,s).join("-");if(e[r])return e[r]}}return null}function zD(i,e,t){let n=_v([VD,t],["buttonText"]);delete n.code;let{week:s}=n;return delete n.week,{codeArg:i,codes:e,week:s,simpleNumberFormat:new Intl.NumberFormat(i),options:n}}function Ut(i){return{id:gs(),name:i.name,premiumReleaseDate:i.premiumReleaseDate?new Date(i.premiumReleaseDate):void 0,deps:i.deps||[],reducers:i.reducers||[],isLoadingFuncs:i.isLoadingFuncs||[],contextInit:[].concat(i.contextInit||[]),eventRefiners:i.eventRefiners||{},eventDefMemberAdders:i.eventDefMemberAdders||[],eventSourceRefiners:i.eventSourceRefiners||{},isDraggableTransformers:i.isDraggableTransformers||[],eventDragMutationMassagers:i.eventDragMutationMassagers||[],eventDefMutationAppliers:i.eventDefMutationAppliers||[],dateSelectionTransformers:i.dateSelectionTransformers||[],datePointTransforms:i.datePointTransforms||[],dateSpanTransforms:i.dateSpanTransforms||[],views:i.views||{},viewPropsTransformers:i.viewPropsTransformers||[],isPropsValid:i.isPropsValid||null,externalDefTransforms:i.externalDefTransforms||[],viewContainerAppends:i.viewContainerAppends||[],eventDropTransformers:i.eventDropTransformers||[],componentInteractions:i.componentInteractions||[],calendarInteractions:i.calendarInteractions||[],themeClasses:i.themeClasses||{},eventSourceDefs:i.eventSourceDefs||[],cmdFormatter:i.cmdFormatter,recurringTypes:i.recurringTypes||[],namedTimeZonedImpl:i.namedTimeZonedImpl,initialView:i.initialView||"",elementDraggingImpl:i.elementDraggingImpl,optionChangeHandlers:i.optionChangeHandlers||{},scrollGridImpl:i.scrollGridImpl||null,listenerRefiners:i.listenerRefiners||{},optionRefiners:i.optionRefiners||{},propSetHandlers:i.propSetHandlers||{}}}function FB(i,e){let t={},n={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function s(r){for(let o of r){let a=o.name,l=t[a];l===void 0?(t[a]=o.id,s(o.deps),n=OB(n,o)):l!==o.id&&console.warn(`Duplicate plugin '${a}'`)}}return i&&s(i),s(e),n}function LB(){let i=[],e=[],t;return(n,s)=>((!t||!wi(n,i)||!wi(s,e))&&(t=FB(n,s)),i=n,e=s,t)}function OB(i,e){return{premiumReleaseDate:UB(i.premiumReleaseDate,e.premiumReleaseDate),reducers:i.reducers.concat(e.reducers),isLoadingFuncs:i.isLoadingFuncs.concat(e.isLoadingFuncs),contextInit:i.contextInit.concat(e.contextInit),eventRefiners:Object.assign(Object.assign({},i.eventRefiners),e.eventRefiners),eventDefMemberAdders:i.eventDefMemberAdders.concat(e.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},i.eventSourceRefiners),e.eventSourceRefiners),isDraggableTransformers:i.isDraggableTransformers.concat(e.isDraggableTransformers),eventDragMutationMassagers:i.eventDragMutationMassagers.concat(e.eventDragMutationMassagers),eventDefMutationAppliers:i.eventDefMutationAppliers.concat(e.eventDefMutationAppliers),dateSelectionTransformers:i.dateSelectionTransformers.concat(e.dateSelectionTransformers),datePointTransforms:i.datePointTransforms.concat(e.datePointTransforms),dateSpanTransforms:i.dateSpanTransforms.concat(e.dateSpanTransforms),views:Object.assign(Object.assign({},i.views),e.views),viewPropsTransformers:i.viewPropsTransformers.concat(e.viewPropsTransformers),isPropsValid:e.isPropsValid||i.isPropsValid,externalDefTransforms:i.externalDefTransforms.concat(e.externalDefTransforms),viewContainerAppends:i.viewContainerAppends.concat(e.viewContainerAppends),eventDropTransformers:i.eventDropTransformers.concat(e.eventDropTransformers),calendarInteractions:i.calendarInteractions.concat(e.calendarInteractions),componentInteractions:i.componentInteractions.concat(e.componentInteractions),themeClasses:Object.assign(Object.assign({},i.themeClasses),e.themeClasses),eventSourceDefs:i.eventSourceDefs.concat(e.eventSourceDefs),cmdFormatter:e.cmdFormatter||i.cmdFormatter,recurringTypes:i.recurringTypes.concat(e.recurringTypes),namedTimeZonedImpl:e.namedTimeZonedImpl||i.namedTimeZonedImpl,initialView:i.initialView||e.initialView,elementDraggingImpl:i.elementDraggingImpl||e.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},i.optionChangeHandlers),e.optionChangeHandlers),scrollGridImpl:e.scrollGridImpl||i.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},i.listenerRefiners),e.listenerRefiners),optionRefiners:Object.assign(Object.assign({},i.optionRefiners),e.optionRefiners),propSetHandlers:Object.assign(Object.assign({},i.propSetHandlers),e.propSetHandlers)}}function UB(i,e){return i===void 0?e:e===void 0?i:new Date(Math.max(i.valueOf(),e.valueOf()))}var Ci=class extends hs{};Ci.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"};Ci.prototype.baseIconClass="fc-icon";Ci.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"};Ci.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"};Ci.prototype.iconOverrideOption="buttonIcons";Ci.prototype.iconOverrideCustomButtonOption="icon";Ci.prototype.iconOverridePrefix="fc-icon-";function HB(i,e){let t={},n;for(n in i)d_(n,t,i,e);for(n in e)d_(n,t,i,e);return t}function d_(i,e,t,n){if(e[i])return e[i];let s=BB(i,e,t,n);return s&&(e[i]=s),s}function BB(i,e,t,n){let s=t[i],r=n[i],o=d=>s&&s[d]!==null?s[d]:r&&r[d]!==null?r[d]:null,a=o("component"),l=o("superType"),c=null;if(l){if(l===i)throw new Error("Can't have a custom view type that references itself");c=d_(l,e,t,n)}return!a&&c&&(a=c.component),a?{type:i,component:a,defaults:Object.assign(Object.assign({},c?c.defaults:{}),s?s.rawOptions:{}),overrides:Object.assign(Object.assign({},c?c.overrides:{}),r?r.rawOptions:{})}:null}function FD(i){return yn(i,VB)}function VB(i){let e=typeof i=="function"?{component:i}:i,{component:t}=e;return e.content?t=LD(e):t&&!(t.prototype instanceof ne)&&(t=LD(Object.assign(Object.assign({},e),{content:t}))),{superType:e.type,component:t,rawOptions:e}}function LD(i){return e=>x(bn.Consumer,null,t=>x(xe,{elTag:"div",elClasses:BS(t.viewSpec),renderProps:Object.assign(Object.assign({},e),{nextDayThreshold:t.options.nextDayThreshold}),generatorName:void 0,customGenerator:i.content,classNameGenerator:i.classNames,didMount:i.didMount,willUnmount:i.willUnmount}))}function GB(i,e,t,n){let s=FD(i),r=FD(e.views),o=HB(s,r);return yn(o,a=>$B(a,r,e,t,n))}function $B(i,e,t,n,s){let r=i.overrides.duration||i.defaults.duration||n.duration||t.duration,o=null,a="",l="",c={};if(r&&(o=zB(r),o)){let p=Wh(o);a=p.unit,p.value===1&&(l=a,c=e[a]?e[a].rawOptions:{})}let d=p=>{let m=p.buttonText||{},y=i.defaults.buttonTextKey;return y!=null&&m[y]!=null?m[y]:m[i.type]!=null?m[i.type]:m[l]!=null?m[l]:null},h=p=>{let m=p.buttonHints||{},y=i.defaults.buttonTextKey;return y!=null&&m[y]!=null?m[y]:m[i.type]!=null?m[i.type]:m[l]!=null?m[l]:null};return{type:i.type,component:i.component,duration:o,durationUnit:a,singleUnit:l,optionDefaults:i.defaults,optionOverrides:Object.assign(Object.assign({},c),i.overrides),buttonTextOverride:d(n)||d(t)||i.overrides.buttonText,buttonTextDefault:d(s)||i.defaults.buttonText||d(yr)||i.type,buttonTitleOverride:h(n)||h(t)||i.overrides.buttonHint,buttonTitleDefault:h(s)||i.defaults.buttonHint||h(yr)}}var OD={};function zB(i){let e=JSON.stringify(i),t=OD[e];return t===void 0&&(t=te(i),OD[e]=t),t}function qB(i,e){switch(e.type){case"CHANGE_VIEW_TYPE":i=e.viewType}return i}function WB(i,e){switch(e.type){case"CHANGE_DATE":return e.dateMarker;default:return i}}function YB(i,e,t){let n=i.initialDate;return n!=null?e.createMarker(n):t.getDateMarker()}function KB(i,e){switch(e.type){case"SET_OPTION":return Object.assign(Object.assign({},i),{[e.optionName]:e.rawOptionValue});default:return i}}function XB(i,e,t,n){let s;switch(e.type){case"CHANGE_VIEW_TYPE":return n.build(e.dateMarker||t);case"CHANGE_DATE":return n.build(e.dateMarker);case"PREV":if(s=n.buildPrev(i,t),s.isValid)return s;break;case"NEXT":if(s=n.buildNext(i,t),s.isValid)return s;break}return i}function JB(i,e,t){let n=e?e.activeRange:null;return WD({},iV(i,t),n,t)}function ZB(i,e,t,n){let s=t?t.activeRange:null;switch(e.type){case"ADD_EVENT_SOURCES":return WD(i,e.sources,s,n);case"REMOVE_EVENT_SOURCE":return QB(i,e.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return t?YD(i,s,n):i;case"FETCH_EVENT_SOURCES":return b_(i,e.sourceIds?OS(e.sourceIds):KD(i,n),s,e.isRefetch||!1,n);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return nV(i,e.sourceId,e.fetchId,e.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return i}}function jB(i,e,t){let n=e?e.activeRange:null;return b_(i,KD(i,t),n,!0,t)}function qD(i){for(let e in i)if(i[e].isFetching)return!0;return!1}function WD(i,e,t,n){let s={};for(let r of e)s[r.sourceId]=r;return t&&(s=YD(s,t,n)),Object.assign(Object.assign({},i),s)}function QB(i,e){return us(i,t=>t.sourceId!==e)}function YD(i,e,t){return b_(i,us(i,n=>eV(n,e,t)),e,!1,t)}function eV(i,e,t){return XD(i,t)?!t.options.lazyFetching||!i.fetchRange||i.isFetching||e.start<i.fetchRange.start||e.end>i.fetchRange.end:!i.latestFetchId}function b_(i,e,t,n,s){let r={};for(let o in i){let a=i[o];e[o]?r[o]=tV(a,t,n,s):r[o]=a}return r}function tV(i,e,t,n){let{options:s,calendarApi:r}=n,o=n.pluginHooks.eventSourceDefs[i.sourceDefId],a=gs();return o.fetch({eventSource:i,range:e,isRefetch:t,context:n},l=>{let{rawEvents:c}=l;s.eventSourceSuccess&&(c=s.eventSourceSuccess.call(r,c,l.response)||c),i.success&&(c=i.success.call(r,c,l.response)||c),n.dispatch({type:"RECEIVE_EVENTS",sourceId:i.sourceId,fetchId:a,fetchRange:e,rawEvents:c})},l=>{let c=!1;s.eventSourceFailure&&(s.eventSourceFailure.call(r,l),c=!0),i.failure&&(i.failure(l),c=!0),c||console.warn(l.message,l),n.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:i.sourceId,fetchId:a,fetchRange:e,error:l})}),Object.assign(Object.assign({},i),{isFetching:!0,latestFetchId:a})}function nV(i,e,t,n){let s=i[e];return s&&t===s.latestFetchId?Object.assign(Object.assign({},i),{[e]:Object.assign(Object.assign({},s),{isFetching:!1,fetchRange:n})}):i}function KD(i,e){return us(i,t=>XD(t,e))}function iV(i,e){let t=qS(e),n=[].concat(i.eventSources||[]),s=[];i.initialEvents&&n.unshift(i.initialEvents),i.events&&n.unshift(i.events);for(let r of n){let o=zS(r,e,t);o&&s.push(o)}return s}function XD(i,e){return!e.pluginHooks.eventSourceDefs[i.sourceDefId].ignoreRange}function sV(i,e){switch(e.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return e.selection;default:return i}}function rV(i,e){switch(e.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return e.eventInstanceId;default:return i}}function oV(i,e){let t;switch(e.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return i}}function aV(i,e){let t;switch(e.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return i}}function lV(i,e,t,n,s){let r=i.headerToolbar?UD(i.headerToolbar,i,e,t,n,s):null,o=i.footerToolbar?UD(i.footerToolbar,i,e,t,n,s):null;return{header:r,footer:o}}function UD(i,e,t,n,s,r){let o={},a=[],l=!1;for(let c in i){let d=i[c],h=cV(d,e,t,n,s,r);o[c]=h.widgets,a.push(...h.viewsWithButtons),l=l||h.hasTitle}return{sectionWidgets:o,viewsWithButtons:a,hasTitle:l}}function cV(i,e,t,n,s,r){let o=e.direction==="rtl",a=e.customButtons||{},l=t.buttonText||{},c=e.buttonText||{},d=t.buttonHints||{},h=e.buttonHints||{},p=i?i.split(" "):[],m=[],y=!1;return{widgets:p.map(E=>E.split(",").map(A=>{if(A==="title")return y=!0,{buttonName:A};let _,C,T,R,I,D;if(_=a[A])T=k=>{_.click&&_.click.call(k.target,k,k.target)},(R=n.getCustomButtonIconClass(_))||(R=n.getIconClass(A,o))||(I=_.text),D=_.hint||_.text;else if(C=s[A]){m.push(A),T=()=>{r.changeView(A)},(I=C.buttonTextOverride)||(R=n.getIconClass(A,o))||(I=C.buttonTextDefault);let k=C.buttonTextOverride||C.buttonTextDefault;D=_c(C.buttonTitleOverride||C.buttonTitleDefault||e.viewHint,[k,A],k)}else if(r[A])if(T=()=>{r[A]()},(I=l[A])||(R=n.getIconClass(A,o))||(I=c[A]),A==="prevYear"||A==="nextYear"){let k=A==="prevYear"?"prev":"next";D=_c(d[k]||h[k],[c.year||"year","year"],c[A])}else D=k=>_c(d[A]||h[A],[c[k]||k,k],c[A]);return{buttonName:A,buttonClick:T,buttonIcon:R,buttonText:I,buttonHint:D}})),viewsWithButtons:m,hasTitle:y}}var u_=class{constructor(e,t,n){this.type=e,this.getCurrentData=t,this.dateEnv=n}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(e){return this.getCurrentData().options[e]}},dV={ignoreRange:!0,parseMeta(i){return Array.isArray(i.events)?i.events:null},fetch(i,e){e({rawEvents:i.eventSource.meta})}},uV=Ut({name:"array-event-source",eventSourceDefs:[dV]}),hV={parseMeta(i){return typeof i.events=="function"?i.events:null},fetch(i,e,t){let{dateEnv:n}=i.context,s=i.eventSource.meta;jS(s.bind(null,ZS(i.range,n)),r=>e({rawEvents:r}),t)}},fV=Ut({name:"func-event-source",eventSourceDefs:[hV]}),pV={method:String,extraParams:P,startParam:String,endParam:String,timeZoneParam:String},gV={parseMeta(i){return i.url&&(i.format==="json"||!i.format)?{url:i.url,format:"json",method:(i.method||"GET").toUpperCase(),extraParams:i.extraParams,startParam:i.startParam,endParam:i.endParam,timeZoneParam:i.timeZoneParam}:null},fetch(i,e,t){let{meta:n}=i.eventSource,s=yV(n,i.range,i.context);QS(n.method,n.url,s).then(([r,o])=>{e({rawEvents:r,response:o})},t)}},mV=Ut({name:"json-event-source",eventSourceRefiners:pV,eventSourceDefs:[gV]});function yV(i,e,t){let{dateEnv:n,options:s}=t,r,o,a,l,c={};return r=i.startParam,r==null&&(r=s.startParam),o=i.endParam,o==null&&(o=s.endParam),a=i.timeZoneParam,a==null&&(a=s.timeZoneParam),typeof i.extraParams=="function"?l=i.extraParams():l=i.extraParams||{},Object.assign(c,l),c[r]=n.formatIso(e.start),c[o]=n.formatIso(e.end),n.timeZone!=="local"&&(c[a]=n.timeZone),c}var vV={daysOfWeek:P,startTime:te,endTime:te,duration:te,startRecur:P,endRecur:P},bV={parse(i,e){if(i.daysOfWeek||i.startTime||i.endTime||i.startRecur||i.endRecur){let t={daysOfWeek:i.daysOfWeek||null,startTime:i.startTime||null,endTime:i.endTime||null,startRecur:i.startRecur?e.createMarker(i.startRecur):null,endRecur:i.endRecur?e.createMarker(i.endRecur):null,dateEnv:e},n;return i.duration&&(n=i.duration),!n&&i.startTime&&i.endTime&&(n=JI(i.endTime,i.startTime)),{allDayGuess:!i.startTime&&!i.endTime,duration:n,typeData:t}}return null},expand(i,e,t){let n=tn(e,{start:i.startRecur,end:i.endRecur});return n?wV(i.daysOfWeek,i.startTime,i.dateEnv,t,n):[]}},EV=Ut({name:"simple-recurring-event",recurringTypes:[bV],eventRefiners:vV});function wV(i,e,t,n,s){let r=i?OS(i):null,o=de(s.start),a=s.end,l=[];for(e&&(e.milliseconds<0?a=Ee(a,1):e.milliseconds>=1e3*60*60*24&&(o=Ee(o,-1)));o<a;){let c;(!r||r[o.getUTCDay()])&&(e?c=n.add(o,e):c=o,l.push(n.createMarker(t.toDate(c)))),o=Ee(o,1)}return l}var AV=Ut({name:"change-handler",optionChangeHandlers:{events(i,e){HD([i],e)},eventSources:HD}});function HD(i,e){let t=Cv(e.getCurrentData().eventSources);if(t.length===1&&i.length===1&&Array.isArray(t[0]._raw)&&Array.isArray(i[0])){e.dispatch({type:"RESET_RAW_EVENTS",sourceId:t[0].sourceId,rawEvents:i[0]});return}let n=[];for(let s of i){let r=!1;for(let o=0;o<t.length;o+=1)if(t[o]._raw===s){t.splice(o,1),r=!0;break}r||n.push(s)}for(let s of t)e.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:s.sourceId});for(let s of n)e.calendarApi.addEventSource(s)}function SV(i,e){e.emitter.trigger("datesSet",Object.assign(Object.assign({},ZS(i.activeRange,e.dateEnv)),{view:e.viewApi}))}function _V(i,e){let{emitter:t}=e;t.hasHandlers("eventsSet")&&t.trigger("eventsSet",Si(i,e))}var CV=[uV,fV,mV,EV,AV,Ut({name:"misc",isLoadingFuncs:[i=>qD(i.eventSources)],propSetHandlers:{dateProfile:SV,eventStore:_V}})],h_=class{constructor(e,t){this.runTaskOption=e,this.drainedOption=t,this.queue=[],this.delayedRunner=new ta(this.drain.bind(this))}request(e,t){this.queue.push(e),this.delayedRunner.request(t)}pause(e){this.delayedRunner.pause(e)}resume(e,t){this.delayedRunner.resume(e,t)}drain(){let{queue:e}=this;for(;e.length;){let t=[],n;for(;n=e.shift();)this.runTask(n),t.push(n);this.drained(t)}}runTask(e){this.runTaskOption&&this.runTaskOption(e)}drained(e){this.drainedOption&&this.drainedOption(e)}};function TV(i,e,t){let n;return/^(year|month)$/.test(i.currentRangeUnit)?n=i.currentRange:n=i.activeRange,t.formatRange(n.start,n.end,ue(e.titleFormat||xV(i)),{isEndExclusive:i.isRangeAllDay,defaultSeparator:e.titleRangeSeparator})}function xV(i){let{currentRangeUnit:e}=i;if(e==="year")return{year:"numeric"};if(e==="month")return{year:"numeric",month:"long"};let t=wc(i.currentRange.start,i.currentRange.end);return t!==null&&t>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}var Lv=class{constructor(){this.resetListeners=new Set}handleInput(e,t){let n=this.dateEnv;if(e!==n&&(typeof t=="function"?this.nowFn=t:n||(this.nowAnchorDate=e.toDate(t?e.createMarker(t):e.createNowMarker()),this.nowAnchorQueried=Date.now()),this.dateEnv=e,n))for(let s of this.resetListeners.values())s()}getDateMarker(){return this.nowAnchorDate?this.dateEnv.timestampToMarker(this.nowAnchorDate.valueOf()+(Date.now()-this.nowAnchorQueried)):this.dateEnv.createMarker(this.nowFn())}addResetListener(e){this.resetListeners.add(e)}removeResetListener(e){this.resetListeners.delete(e)}},f_=class{constructor(e){this.computeCurrentViewData=$(this._computeCurrentViewData),this.organizeRawLocales=$(MB),this.buildLocale=$($D),this.buildPluginHooks=LB(),this.buildDateEnv=$(RV),this.buildTheme=$(IV),this.parseToolbars=$(lV),this.buildViewSpecs=$(GB),this.buildDateProfileGenerator=Cc(DV),this.buildViewApi=$(PV),this.buildViewUiProps=Cc(NV),this.buildEventUiBySource=$(MV,Ft),this.buildEventUiBases=$(kV),this.parseContextBusinessHours=Cc(FV),this.buildTitle=$(TV),this.nowManager=new Lv,this.emitter=new fs,this.actionRunner=new h_(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=p=>{this.actionRunner.request(p)},this.props=e,this.actionRunner.pause(),this.nowManager=new Lv;let t={},n=this.computeOptionsData(e.optionOverrides,t,e.calendarApi),s=n.calendarOptions.initialView||n.pluginHooks.initialView,r=this.computeCurrentViewData(s,n,e.optionOverrides,t);e.calendarApi.currentDataManager=this,this.emitter.setThisContext(e.calendarApi),this.emitter.setOptions(r.options);let o={nowManager:this.nowManager,dateEnv:n.dateEnv,options:n.calendarOptions,pluginHooks:n.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},a=YB(n.calendarOptions,n.dateEnv,this.nowManager),l=r.dateProfileGenerator.build(a);mn(l.activeRange,a)||(a=l.currentRange.start);for(let p of n.pluginHooks.contextInit)p(o);let c=JB(n.calendarOptions,l,o),d={dynamicOptionOverrides:t,currentViewType:s,currentDate:a,dateProfile:l,businessHours:this.parseContextBusinessHours(o),eventSources:c,eventUiBases:{},eventStore:yt(),renderableEventStore:yt(),dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(o).selectionConfig},h=Object.assign(Object.assign({},o),d);for(let p of n.pluginHooks.reducers)Object.assign(d,p(null,null,h));c_(d,o)&&this.emitter.trigger("loading",!0),this.state=d,this.updateData(),this.actionRunner.resume()}resetOptions(e,t){let{props:n}=this;t===void 0?n.optionOverrides=e:(n.optionOverrides=Object.assign(Object.assign({},n.optionOverrides||{}),e),this.optionsForRefining.push(...t)),(t===void 0||t.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(e){let{props:t,state:n,emitter:s}=this,r=KB(n.dynamicOptionOverrides,e),o=this.computeOptionsData(t.optionOverrides,r,t.calendarApi),a=qB(n.currentViewType,e),l=this.computeCurrentViewData(a,o,t.optionOverrides,r);t.calendarApi.currentDataManager=this,s.setThisContext(t.calendarApi),s.setOptions(l.options);let c={nowManager:this.nowManager,dateEnv:o.dateEnv,options:o.calendarOptions,pluginHooks:o.pluginHooks,calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:s,getCurrentData:this.getCurrentData},{currentDate:d,dateProfile:h}=n;this.data&&this.data.dateProfileGenerator!==l.dateProfileGenerator&&(h=l.dateProfileGenerator.build(d)),d=WB(d,e),h=XB(h,e,d,l.dateProfileGenerator),(e.type==="PREV"||e.type==="NEXT"||!mn(h.currentRange,d))&&(d=h.currentRange.start);let p=ZB(n.eventSources,e,h,c),m=cD(n.eventStore,e,p,h,c),v=qD(p)&&!l.options.progressiveEventRendering&&n.renderableEventStore||m,{eventUiSingleBase:E,selectionConfig:A}=this.buildViewUiProps(c),_=this.buildEventUiBySource(p),C=this.buildEventUiBases(v.defs,E,_),T={dynamicOptionOverrides:r,currentViewType:a,currentDate:d,dateProfile:h,eventSources:p,eventStore:m,renderableEventStore:v,selectionConfig:A,eventUiBases:C,businessHours:this.parseContextBusinessHours(c),dateSelection:sV(n.dateSelection,e),eventSelection:rV(n.eventSelection,e),eventDrag:oV(n.eventDrag,e),eventResize:aV(n.eventResize,e)},R=Object.assign(Object.assign({},c),T);for(let k of o.pluginHooks.reducers)Object.assign(T,k(n,e,R));let I=c_(n,c),D=c_(T,c);!I&&D?s.trigger("loading",!0):I&&!D&&s.trigger("loading",!1),this.state=T,t.onAction&&t.onAction(e)}updateData(){let{props:e,state:t}=this,n=this.data,s=this.computeOptionsData(e.optionOverrides,t.dynamicOptionOverrides,e.calendarApi),r=this.computeCurrentViewData(t.currentViewType,s,e.optionOverrides,t.dynamicOptionOverrides),o=this.data=Object.assign(Object.assign(Object.assign({nowManager:this.nowManager,viewTitle:this.buildTitle(t.dateProfile,r.options,s.dateEnv),calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},s),r),t),a=s.pluginHooks.optionChangeHandlers,l=n&&n.calendarOptions,c=s.calendarOptions;if(l&&l!==c){l.timeZone!==c.timeZone&&(t.eventSources=o.eventSources=jB(o.eventSources,t.dateProfile,o),t.eventStore=o.eventStore=WS(o.eventStore,n.dateEnv,o.dateEnv),t.renderableEventStore=o.renderableEventStore=WS(o.renderableEventStore,n.dateEnv,o.dateEnv));for(let d in a)(this.optionsForHandling.indexOf(d)!==-1||l[d]!==c[d])&&a[d](c[d],o)}this.optionsForHandling=[],e.onData&&e.onData(o)}computeOptionsData(e,t,n){if(!this.optionsForRefining.length&&e===this.stableOptionOverrides&&t===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:s,pluginHooks:r,localeDefaults:o,availableLocaleData:a,extra:l}=this.processRawCalendarOptions(e,t);BD(l);let c=this.buildDateEnv(s.timeZone,s.locale,s.weekNumberCalculation,s.firstDay,s.weekText,r,a,s.defaultRangeSeparator),d=this.buildViewSpecs(r.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,o),h=this.buildTheme(s,r),p=this.parseToolbars(s,this.stableOptionOverrides,h,d,n);return this.stableCalendarOptionsData={calendarOptions:s,pluginHooks:r,dateEnv:c,viewSpecs:d,theme:h,toolbarConfig:p,localeDefaults:o,availableRawLocales:a.map}}processRawCalendarOptions(e,t){let{locales:n,locale:s}=Av([yr,e,t]),r=this.organizeRawLocales(n),o=r.map,a=this.buildLocale(s||r.defaultCode,o).options,l=this.buildPluginHooks(e.plugins||[],CV),c=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},NS),FS),LS),l.listenerRefiners),l.optionRefiners),d={},h=Av([yr,a,e,t]),p={},m=this.currentCalendarOptionsInput,y=this.currentCalendarOptionsRefined,v=!1;for(let E in h)this.optionsForRefining.indexOf(E)===-1&&(h[E]===m[E]||vr[E]&&E in m&&vr[E](m[E],h[E]))?p[E]=y[E]:c[E]?(p[E]=c[E](h[E]),v=!0):d[E]=m[E];return v&&(this.currentCalendarOptionsInput=h,this.currentCalendarOptionsRefined=p,this.stableOptionOverrides=e,this.stableDynamicOptionOverrides=t),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:l,availableLocaleData:r,localeDefaults:a,extra:d}}_computeCurrentViewData(e,t,n,s){let r=t.viewSpecs[e];if(!r)throw new Error(`viewType "${e}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:o,extra:a}=this.processRawViewOptions(r,t.pluginHooks,t.localeDefaults,n,s);BD(a),this.nowManager.handleInput(t.dateEnv,o.now);let l=this.buildDateProfileGenerator({dateProfileGeneratorClass:r.optionDefaults.dateProfileGeneratorClass,nowManager:this.nowManager,duration:r.duration,durationUnit:r.durationUnit,usesMinMaxTime:r.optionDefaults.usesMinMaxTime,dateEnv:t.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:o.slotMinTime,slotMaxTime:o.slotMaxTime,showNonCurrentDates:o.showNonCurrentDates,dayCount:o.dayCount,dateAlignment:o.dateAlignment,dateIncrement:o.dateIncrement,hiddenDays:o.hiddenDays,weekends:o.weekends,validRangeInput:o.validRange,visibleRangeInput:o.visibleRange,fixedWeekCount:o.fixedWeekCount}),c=this.buildViewApi(e,this.getCurrentData,t.dateEnv);return{viewSpec:r,options:o,dateProfileGenerator:l,viewApi:c}}processRawViewOptions(e,t,n,s,r){let o=Av([yr,e.optionDefaults,n,s,e.optionOverrides,r]),a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},NS),FS),LS),QI),t.listenerRefiners),t.optionRefiners),l={},c=this.currentViewOptionsInput,d=this.currentViewOptionsRefined,h=!1,p={};for(let m in o)o[m]===c[m]||vr[m]&&vr[m](o[m],c[m])?l[m]=d[m]:(o[m]===this.currentCalendarOptionsInput[m]||vr[m]&&vr[m](o[m],this.currentCalendarOptionsInput[m])?m in this.currentCalendarOptionsRefined&&(l[m]=this.currentCalendarOptionsRefined[m]):a[m]?l[m]=a[m](o[m]):p[m]=o[m],h=!0);return h&&(this.currentViewOptionsInput=o,this.currentViewOptionsRefined=l),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:p}}};function RV(i,e,t,n,s,r,o,a){let l=$D(e||o.defaultCode,o.map);return new Yh({calendarSystem:"gregory",timeZone:i,namedTimeZoneImpl:r.namedTimeZonedImpl,locale:l,weekNumberCalculation:t,firstDay:n,weekText:s,cmdFormatter:r.cmdFormatter,defaultSeparator:a})}function IV(i,e){let t=e.themeClasses[i.themeSystem]||Ci;return new t(i)}function DV(i){let e=i.dateProfileGeneratorClass||na;return new e(i)}function PV(i,e,t){return new u_(i,e,t)}function MV(i){return yn(i,e=>e.ui)}function kV(i,e,t){let n={"":e};for(let s in i){let r=i[s];r.sourceId&&t[r.sourceId]&&(n[s]=t[r.sourceId])}return n}function NV(i){let{options:e}=i;return{eventUiSingleBase:xc({display:e.eventDisplay,editable:e.editable,startEditable:e.eventStartEditable,durationEditable:e.eventDurationEditable,constraint:e.eventConstraint,overlap:typeof e.eventOverlap=="boolean"?e.eventOverlap:void 0,allow:e.eventAllow,backgroundColor:e.eventBackgroundColor,borderColor:e.eventBorderColor,textColor:e.eventTextColor,color:e.eventColor},i),selectionConfig:xc({constraint:e.selectConstraint,overlap:typeof e.selectOverlap=="boolean"?e.selectOverlap:void 0,allow:e.selectAllow},i)}}function c_(i,e){for(let t of e.pluginHooks.isLoadingFuncs)if(t(i))return!0;return!1}function FV(i){return YS(i.options.businessHours,i)}function BD(i,e){for(let t in i)console.warn(`Unknown option '${t}'`+(e?` for view '${e}'`:""))}var p_=class extends ne{render(){let e=this.props.widgetGroups.map(t=>this.renderWidgetGroup(t));return x("div",{className:"fc-toolbar-chunk"},...e)}renderWidgetGroup(e){let{props:t}=this,{theme:n}=this.context,s=[],r=!0;for(let o of e){let{buttonName:a,buttonClick:l,buttonText:c,buttonIcon:d,buttonHint:h}=o;if(a==="title")r=!1,s.push(x("h2",{className:"fc-toolbar-title",id:t.titleId},t.title));else{let p=a===t.activeButton,m=!t.isTodayEnabled&&a==="today"||!t.isPrevEnabled&&a==="prev"||!t.isNextEnabled&&a==="next",y=[`fc-${a}-button`,n.getClass("button")];p&&y.push(n.getClass("buttonActive")),s.push(x("button",{type:"button",title:typeof h=="function"?h(t.navUnit):h,disabled:m,"aria-pressed":p,className:y.join(" "),onClick:l},c||(d?x("span",{className:d,role:"img"}):"")))}}if(s.length>1){let o=r&&n.getClass("buttonGroup")||"";return x("div",{className:o},...s)}return s[0]}},Ov=class extends ne{render(){let{model:e,extraClassName:t}=this.props,n=!1,s,r,o=e.sectionWidgets,a=o.center;return o.left?(n=!0,s=o.left):s=o.start,o.right?(n=!0,r=o.right):r=o.end,x("div",{className:[t||"","fc-toolbar",n?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",s||[]),this.renderSection("center",a||[]),this.renderSection("end",r||[]))}renderSection(e,t){let{props:n}=this;return x(p_,{key:e,widgetGroups:t,title:n.title,navUnit:n.navUnit,activeButton:n.activeButton,isTodayEnabled:n.isTodayEnabled,isPrevEnabled:n.isPrevEnabled,isNextEnabled:n.isNextEnabled,titleId:n.titleId})}},g_=class extends ne{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=e=>{this.el=e,nn(this.props.elRef,e),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:e,state:t}=this,{aspectRatio:n}=e,s=["fc-view-harness",n||e.liquid||e.height?"fc-view-harness-active":"fc-view-harness-passive"],r="",o="";return n?t.availableWidth!==null?r=t.availableWidth/n:o=`${1/n*100}%`:r=e.height||"",x("div",{"aria-labelledby":e.labeledById,ref:this.handleEl,className:s.join(" "),style:{height:r,paddingBottom:o}},e.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}},m_=class extends zn{constructor(e){super(e),this.handleSegClick=(t,n)=>{let{component:s}=this,{context:r}=s,o=ms(n);if(o&&s.isValidSegDownEl(t.target)){let a=Ve(t.target,".fc-event-forced-url"),l=a?a.querySelector("a[href]").href:"";r.emitter.trigger("eventClick",{el:n,event:new me(s.context,o.eventRange.def,o.eventRange.instance),jsEvent:t,view:r.viewApi}),l&&!t.defaultPrevented&&(window.location.href=l)}},this.destroy=wS(e.el,"click",".fc-event",this.handleSegClick)}},y_=class extends zn{constructor(e){super(e),this.handleEventElRemove=t=>{t===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(t,n)=>{ms(n)&&(this.currentSegEl=n,this.triggerEvent("eventMouseEnter",t,n))},this.handleSegLeave=(t,n)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",t,n))},this.removeHoverListeners=zI(e.el,".fc-event",this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(e,t,n){let{component:s}=this,{context:r}=s,o=ms(n);(!t||s.isValidSegDownEl(t.target))&&r.emitter.trigger(e,{el:n,event:new me(r,o.eventRange.def,o.eventRange.instance),jsEvent:t,view:r.viewApi})}},v_=class extends bi{constructor(){super(...arguments),this.buildViewContext=$(sD),this.buildViewPropTransformers=$(OV),this.buildToolbarProps=$(LV),this.headerRef=Ne(),this.footerRef=Ne(),this.interactionsStore={},this.state={viewLabelId:vn()},this.registerInteractiveComponent=(e,t)=>{let n=gD(e,t),o=[m_,y_].concat(this.props.pluginHooks.componentInteractions).map(a=>new a(n));this.interactionsStore[e.uid]=o,Ic[e.uid]=n},this.unregisterInteractiveComponent=e=>{let t=this.interactionsStore[e.uid];if(t){for(let n of t)n.destroy();delete this.interactionsStore[e.uid]}delete Ic[e.uid]},this.resizeRunner=new ta(()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})}),this.handleWindowResize=e=>{let{options:t}=this.props;t.handleWindowResize&&e.target===window&&this.resizeRunner.request(t.windowResizeDelay)}}render(){let{props:e}=this,{toolbarConfig:t,options:n}=e,s=!1,r="",o;e.isHeightAuto||e.forPrint?r="":n.height!=null?s=!0:n.contentHeight!=null?r=n.contentHeight:o=Math.max(n.aspectRatio,.5);let a=this.buildViewContext(e.viewSpec,e.viewApi,e.options,e.dateProfileGenerator,e.dateEnv,e.nowManager,e.theme,e.pluginHooks,e.dispatch,e.getCurrentData,e.emitter,e.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),l=t.header&&t.header.hasTitle?this.state.viewLabelId:void 0;return x(bn.Provider,{value:a},x(Lt,{unit:"day"},c=>{let d=this.buildToolbarProps(e.viewSpec,e.dateProfile,e.dateProfileGenerator,e.currentDate,c,e.viewTitle);return x(ae,null,t.header&&x(Ov,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:t.header,titleId:l},d)),x(g_,{liquid:s,height:r,aspectRatio:o,labeledById:l},this.renderView(e),this.buildAppendContent()),t.footer&&x(Ov,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:t.footer,titleId:""},d)))}))}componentDidMount(){let{props:e}=this;this.calendarInteractions=e.pluginHooks.calendarInteractions.map(n=>new n(e)),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:t}=e.pluginHooks;for(let n in t)t[n](e[n],e)}componentDidUpdate(e){let{props:t}=this,{propSetHandlers:n}=t.pluginHooks;for(let s in n)t[s]!==e[s]&&n[s](t[s],t)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let e of this.calendarInteractions)e.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:e}=this,t=e.pluginHooks.viewContainerAppends.map(n=>n(e));return x(ae,{},...t)}renderView(e){let{pluginHooks:t}=e,{viewSpec:n}=e,s={dateProfile:e.dateProfile,businessHours:e.businessHours,eventStore:e.renderableEventStore,eventUiBases:e.eventUiBases,dateSelection:e.dateSelection,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,isHeightAuto:e.isHeightAuto,forPrint:e.forPrint},r=this.buildViewPropTransformers(t.viewPropsTransformers);for(let a of r)Object.assign(s,a.transform(s,e));let o=n.component;return x(o,Object.assign({},s))}};function LV(i,e,t,n,s,r){let o=t.build(s,void 0,!1),a=t.buildPrev(e,n,!1),l=t.buildNext(e,n,!1);return{title:r,activeButton:i.type,navUnit:i.singleUnit,isTodayEnabled:o.isValid&&!mn(e.currentRange,s),isPrevEnabled:a.isValid,isNextEnabled:l.isValid}}function OV(i){return i.map(e=>new e)}var xf=class extends ef{constructor(e,t={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=n=>{switch(n.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=n=>{this.currentData=n,this.renderRunner.request(n.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:n}=this;Kh(()=>{ar(x(Qh,{options:n.calendarOptions,theme:n.theme,emitter:n.emitter},(s,r,o,a)=>(this.setClassNames(s),this.setHeight(r),x(HS.Provider,{value:this.customContentRenderId},x(v_,Object.assign({isHeightAuto:o,forPrint:a},n))))),this.el)})}else this.isRendered&&(this.isRendered=!1,ar(null,this.el),this.setClassNames([]),this.setHeight(""))},BI(e),this.el=e,this.renderRunner=new ta(this.handleRenderRequest),new f_({optionOverrides:t,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let e=this.isRendering;e?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),e&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){Kh(()=>{super.updateSize()})}batchRendering(e){this.renderRunner.pause("batchRendering"),e(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(e,t){this.currentDataManager.resetOptions(e,t)}setClassNames(e){if(!wi(e,this.currentClassNames)){let{classList:t}=this.el;for(let n of this.currentClassNames)t.remove(n);for(let n of e)t.add(n);this.currentClassNames=e}}setHeight(e){ES(this.el,"height",e)}};var E_=class extends st{constructor(){super(...arguments),this.headerElRef=Ne()}renderSimpleLayout(e,t){let{props:n,context:s}=this,r=[],o=pa(s.options);return e&&r.push({type:"header",key:"header",isSticky:o,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),r.push({type:"body",key:"body",liquid:!0,chunk:{content:t}}),x($n,{elClasses:["fc-daygrid"],viewSpec:s.viewSpec},x(hr,{liquid:!n.isHeightAuto&&!n.forPrint,collapsibleWidth:n.forPrint,cols:[],sections:r}))}renderHScrollLayout(e,t,n,s){let r=this.context.pluginHooks.scrollGridImpl;if(!r)throw new Error("No ScrollGrid implementation");let{props:o,context:a}=this,l=!o.forPrint&&pa(a.options),c=!o.forPrint&&Sf(a.options),d=[];return e&&d.push({type:"header",key:"header",isSticky:l,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),d.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:t}]}),c&&d.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:Pc}]}),x($n,{elClasses:["fc-daygrid"],viewSpec:a.viewSpec},x(r,{liquid:!o.isHeightAuto&&!o.forPrint,forPrint:o.forPrint,collapsibleWidth:o.forPrint,colGroups:[{cols:[{span:n,minWidth:s}]}],sections:d}))}};function Hv(i,e){let t=[];for(let n=0;n<e;n+=1)t[n]=[];for(let n of i)t[n.row].push(n);return t}function Uv(i,e){let t=[];for(let n=0;n<e;n+=1)t[n]=[];for(let n of i)t[n.firstCol].push(n);return t}function JD(i,e){let t=[];if(i){for(let n=0;n<e;n+=1)t[n]={affectedInstances:i.affectedInstances,isEvent:i.isEvent,segs:[]};for(let n of i.segs)t[n.row].segs.push(n)}else for(let n=0;n<e;n+=1)t[n]=null;return t}var ZD=ue({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function jD(i){let{display:e}=i.eventRange.ui;return e==="list-item"||e==="auto"&&!i.eventRange.def.allDay&&i.firstCol===i.lastCol&&i.isStart&&i.isEnd}var Bv=class extends ne{render(){let{props:e}=this;return x(fr,Object.assign({},e,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:ZD,defaultDisplayEventEnd:e.defaultDisplayEventEnd,disableResizing:!e.seg.eventRange.def.allDay}))}},Vv=class extends ne{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,r=n.eventTimeFormat||ZD,o=br(s,r,t,!0,e.defaultDisplayEventEnd);return x(ps,Object.assign({},e,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:Rc(e.seg,t),defaultGenerator:HV,timeText:o,isResizing:!1,isDateSelecting:!1}))}};function HV(i){return x(ae,null,x("div",{className:"fc-daygrid-event-dot",style:{borderColor:i.borderColor||i.backgroundColor}}),i.timeText&&x("div",{className:"fc-event-time"},i.timeText),x("div",{className:"fc-event-title"},i.event.title||x(ae,null,"\xA0")))}var w_=class extends ne{constructor(){super(...arguments),this.compileSegs=$(BV)}render(){let{props:e}=this,{allSegs:t,invisibleSegs:n}=this.compileSegs(e.singlePlacements);return x(ua,{elClasses:["fc-daygrid-more-link"],dateProfile:e.dateProfile,todayRange:e.todayRange,allDayDate:e.allDayDate,moreCnt:e.moreCnt,allSegs:t,hiddenSegs:n,alignmentElRef:e.alignmentElRef,alignGridTop:e.alignGridTop,extraDateSpan:e.extraDateSpan,popoverContent:()=>{let s=(e.eventDrag?e.eventDrag.affectedInstances:null)||(e.eventResize?e.eventResize.affectedInstances:null)||{};return x(ae,null,t.map(r=>{let o=r.eventRange.instance.instanceId;return x("div",{className:"fc-daygrid-event-harness",key:o,style:{visibility:s[o]?"hidden":""}},jD(r)?x(Vv,Object.assign({seg:r,isDragging:!1,isSelected:o===e.eventSelection,defaultDisplayEventEnd:!1},sn(r,e.todayRange))):x(Bv,Object.assign({seg:r,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:o===e.eventSelection,defaultDisplayEventEnd:!1},sn(r,e.todayRange))))}))}})}};function BV(i){let e=[],t=[];for(let n of i)e.push(n.seg),n.isVisible||t.push(n.seg);return{allSegs:e,invisibleSegs:t}}var VV=ue({week:"narrow"}),A_=class extends st{constructor(){super(...arguments),this.rootElRef=Ne(),this.state={dayNumberId:vn()},this.handleRootEl=e=>{nn(this.rootElRef,e),nn(this.props.elRef,e)}}render(){let{context:e,props:t,state:n,rootElRef:s}=this,{options:r,dateEnv:o}=e,{date:a,dateProfile:l}=t,c=t.showDayNumber&&$V(a,l.currentRange,o);return x(pr,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...t.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},t.extraDataAttrs),t.showDayNumber?{"aria-labelledby":n.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:GV,date:a,dateProfile:l,todayRange:t.todayRange,showDayNumber:t.showDayNumber,isMonthStart:c,extraRenderProps:t.extraRenderProps},(d,h)=>x("div",{ref:t.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:t.minHeight}},t.showWeekNumber&&x(Tf,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:_i(e,a,"week"),date:a,defaultFormat:VV}),!h.isDisabled&&(t.showDayNumber||Mc(r)||t.forceDayTop)?x("div",{className:"fc-daygrid-day-top"},x(d,{elTag:"a",elClasses:["fc-daygrid-day-number",c&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},_i(e,a)),{id:n.dayNumberId})})):t.showDayNumber?x("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},x("a",{className:"fc-daygrid-day-number"},"\xA0")):void 0,x("div",{className:"fc-daygrid-day-events",ref:t.fgContentElRef},t.fgContent,x("div",{className:"fc-daygrid-day-bottom",style:{marginTop:t.moreMarginTop}},x(w_,{allDayDate:a,singlePlacements:t.singlePlacements,moreCnt:t.moreCnt,alignmentElRef:s,alignGridTop:!t.showDayNumber,extraDateSpan:t.extraDateSpan,dateProfile:t.dateProfile,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,todayRange:t.todayRange}))),x("div",{className:"fc-daygrid-day-bg"},t.bgContent)))}};function GV(i){return i.dayNumberText||x(ae,null,"\xA0")}function $V(i,e,t){let{start:n,end:s}=e,r=vi(s,-1),o=t.getYear(n),a=t.getMonth(n),l=t.getYear(r),c=t.getMonth(r);return!(o===l&&a===c)&&(i.valueOf()===n.valueOf()||t.getDay(i)===1&&i.valueOf()<s.valueOf())}function QD(i){return i.eventRange.instance.instanceId+":"+i.firstCol}function eP(i){return QD(i)+":"+i.lastCol}function zV(i,e,t,n,s,r,o){let a=new S_(A=>{let _=i[A.index].eventRange.instance.instanceId+":"+A.span.start+":"+(A.span.end-1);return s[_]||1});a.allowReslicing=!0,a.strictOrder=n,e===!0||t===!0?(a.maxCoord=r,a.hiddenConsumes=!0):typeof e=="number"?a.maxStackCnt=e:typeof t=="number"&&(a.maxStackCnt=t,a.hiddenConsumes=!0);let l=[],c=[];for(let A=0;A<i.length;A+=1){let _=i[A],C=eP(_);s[C]!=null?l.push({index:A,span:{start:_.firstCol,end:_.lastCol+1}}):c.push(_)}let d=a.addSegs(l),h=a.toRects(),{singleColPlacements:p,multiColPlacements:m,leftoverMargins:y}=qV(h,i,o),v=[],E=[];for(let A of c){m[A.firstCol].push({seg:A,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let _=A.firstCol;_<=A.lastCol;_+=1)p[_].push({seg:kc(A,_,_+1,o),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let A=0;A<o.length;A+=1)v.push(0);for(let A of d){let _=i[A.index],C=A.span;m[C.start].push({seg:kc(_,C.start,C.end,o),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let T=C.start;T<C.end;T+=1)v[T]+=1,p[T].push({seg:kc(_,T,T+1,o),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let A=0;A<o.length;A+=1)E.push(y[A]);return{singleColPlacements:p,multiColPlacements:m,moreCnts:v,moreMarginTops:E}}function qV(i,e,t){let n=WV(i,t.length),s=[],r=[],o=[];for(let a=0;a<t.length;a+=1){let l=n[a],c=[],d=0,h=0;for(let m of l){let y=e[m.index];c.push({seg:kc(y,a,a+1,t),isVisible:!0,isAbsolute:!1,absoluteTop:m.levelCoord,marginTop:m.levelCoord-d}),d=m.levelCoord+m.thickness}let p=[];d=0,h=0;for(let m of l){let y=e[m.index],v=m.span.end-m.span.start>1,E=m.span.start===a;h+=m.levelCoord-d,d=m.levelCoord+m.thickness,v?(h+=m.thickness,E&&p.push({seg:kc(y,m.span.start,m.span.end,t),isVisible:!0,isAbsolute:!0,absoluteTop:m.levelCoord,marginTop:0})):E&&(p.push({seg:kc(y,m.span.start,m.span.end,t),isVisible:!0,isAbsolute:!1,absoluteTop:m.levelCoord,marginTop:h}),h=0)}s.push(c),r.push(p),o.push(h)}return{singleColPlacements:s,multiColPlacements:r,leftoverMargins:o}}function WV(i,e){let t=[];for(let n=0;n<e;n+=1)t.push([]);for(let n of i)for(let s=n.span.start;s<n.span.end;s+=1)t[s].push(n);return t}function kc(i,e,t,n){if(i.firstCol===e&&i.lastCol===t-1)return i;let s=i.eventRange,r=s.range,o=tn(r,{start:n[e].date,end:Ee(n[t-1].date,1)});return Object.assign(Object.assign({},i),{firstCol:e,lastCol:t-1,eventRange:{def:s.def,ui:Object.assign(Object.assign({},s.ui),{durationEditable:!1}),instance:s.instance,range:o},isStart:i.isStart&&o.start.valueOf()===r.start.valueOf(),isEnd:i.isEnd&&o.end.valueOf()===r.end.valueOf()})}var S_=class extends ra{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(e){let t=super.addSegs(e),{entriesByLevel:n}=this,s=r=>!this.forceHidden[Ei(r)];for(let r=0;r<n.length;r+=1)n[r]=n[r].filter(s);return t}handleInvalidInsertion(e,t,n){let{entriesByLevel:s,forceHidden:r}=this,{touchingEntry:o,touchingLevel:a,touchingLateral:l}=e;if(this.hiddenConsumes&&o){let c=Ei(o);if(!r[c])if(this.allowReslicing){let d=Object.assign(Object.assign({},o),{span:wf(o.span,t.span)}),h=Ei(d);r[h]=!0,s[a][l]=d,n.push(d),this.splitEntry(o,t,n)}else r[c]=!0,n.push(o)}super.handleInvalidInsertion(e,t,n)}},Gv=class extends st{constructor(){super(...arguments),this.cellElRefs=new Ot,this.frameElRefs=new Ot,this.fgElRefs=new Ot,this.segHarnessRefs=new Ot,this.rootElRef=Ne(),this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=e=>{e&&this.updateSizing(!0)}}render(){let{props:e,state:t,context:n}=this,{options:s}=n,r=e.cells.length,o=Uv(e.businessHourSegs,r),a=Uv(e.bgEventSegs,r),l=Uv(this.getHighlightSegs(),r),c=Uv(this.getMirrorSegs(),r),{singleColPlacements:d,multiColPlacements:h,moreCnts:p,moreMarginTops:m}=zV(fa(e.fgEventSegs,s.eventOrder),e.dayMaxEvents,e.dayMaxEventRows,s.eventOrderStrict,t.segHeights,t.maxContentHeight,e.cells),y=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{};return x("tr",{ref:this.rootElRef,role:"row"},e.renderIntro&&e.renderIntro(),e.cells.map((v,E)=>{let A=this.renderFgSegs(E,e.forPrint?d[E]:h[E],e.todayRange,y),_=this.renderFgSegs(E,YV(c[E],h),e.todayRange,{},!!e.eventDrag,!!e.eventResize,!1);return x(A_,{key:v.key,elRef:this.cellElRefs.createRef(v.key),innerElRef:this.frameElRefs.createRef(v.key),dateProfile:e.dateProfile,date:v.date,showDayNumber:e.showDayNumbers,showWeekNumber:e.showWeekNumbers&&E===0,forceDayTop:e.showWeekNumbers,todayRange:e.todayRange,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,extraRenderProps:v.extraRenderProps,extraDataAttrs:v.extraDataAttrs,extraClassNames:v.extraClassNames,extraDateSpan:v.extraDateSpan,moreCnt:p[E],moreMarginTop:m[E],singlePlacements:d[E],fgContentElRef:this.fgElRefs.createRef(v.key),fgContent:x(ae,null,x(ae,null,A),x(ae,null,_)),bgContent:x(ae,null,this.renderFillSegs(l[E],"highlight"),this.renderFillSegs(o[E],"non-business"),this.renderFillSegs(a[E],"bg-event")),minHeight:e.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(e,t){let n=this.props;this.updateSizing(!Ft(e,n))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:e}=this;return e.eventDrag&&e.eventDrag.segs.length?e.eventDrag.segs:e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:e.dateSelectionSegs}getMirrorSegs(){let{props:e}=this;return e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:[]}renderFgSegs(e,t,n,s,r,o,a){let{context:l}=this,{eventSelection:c}=this.props,{framePositions:d}=this.state,h=this.props.cells.length===1,p=r||o||a,m=[];if(d)for(let y of t){let{seg:v}=y,{instanceId:E}=v.eventRange.instance,A=y.isVisible&&!s[E],_=y.isAbsolute,C="",T="";_&&(l.isRtl?(T=0,C=d.lefts[v.lastCol]-d.lefts[v.firstCol]):(C=0,T=d.rights[v.firstCol]-d.rights[v.lastCol])),m.push(x("div",{className:"fc-daygrid-event-harness"+(_?" fc-daygrid-event-harness-abs":""),key:QD(v),ref:p?null:this.segHarnessRefs.createRef(eP(v)),style:{visibility:A?"":"hidden",marginTop:_?"":y.marginTop,top:_?y.absoluteTop:"",left:C,right:T}},jD(v)?x(Vv,Object.assign({seg:v,isDragging:r,isSelected:E===c,defaultDisplayEventEnd:h},sn(v,n))):x(Bv,Object.assign({seg:v,isDragging:r,isResizing:o,isDateSelecting:a,isSelected:E===c,defaultDisplayEventEnd:h},sn(v,n)))))}return m}renderFillSegs(e,t){let{isRtl:n}=this.context,{todayRange:s}=this.props,{framePositions:r}=this.state,o=[];if(r)for(let a of e){let l=n?{right:0,left:r.lefts[a.lastCol]-r.lefts[a.firstCol]}:{left:0,right:r.rights[a.firstCol]-r.rights[a.lastCol]};o.push(x("div",{key:yf(a.eventRange),className:"fc-daygrid-bg-harness",style:l},t==="bg-event"?x(da,Object.assign({seg:a},sn(a,s))):Cf(t)))}return x(ae,{},...o)}updateSizing(e){let{props:t,state:n,frameElRefs:s}=this;if(!t.forPrint&&t.clientWidth!==null){if(e){let l=t.cells.map(c=>s.currentMap[c.key]);if(l.length){let c=this.rootElRef.current,d=new qn(c,l,!0,!1);(!n.framePositions||!n.framePositions.similarTo(d))&&this.setState({framePositions:new qn(c,l,!0,!1)})}}let r=this.state.segHeights,o=this.querySegHeights(),a=t.dayMaxEvents===!0||t.dayMaxEventRows===!0;this.safeSetState({segHeights:Object.assign(Object.assign({},r),o),maxContentHeight:a?this.computeMaxContentHeight():null})}}querySegHeights(){let e=this.segHarnessRefs.currentMap,t={};for(let n in e){let s=Math.round(e[n].getBoundingClientRect().height);t[n]=Math.max(t[n]||0,s)}return t}computeMaxContentHeight(){let e=this.props.cells[0].key,t=this.cellElRefs.currentMap[e],n=this.fgElRefs.currentMap[e];return t.getBoundingClientRect().bottom-n.getBoundingClientRect().top}getCellEls(){let e=this.cellElRefs.currentMap;return this.props.cells.map(t=>e[t.key])}};Gv.addStateEquality({segHeights:Ft});function YV(i,e){if(!i.length)return[];let t=KV(e);return i.map(n=>({seg:n,isVisible:!0,isAbsolute:!0,absoluteTop:t[n.eventRange.instance.instanceId],marginTop:0}))}function KV(i){let e={};for(let t of i)for(let n of t)e[n.seg.eventRange.instance.instanceId]=n.absoluteTop;return e}var __=class extends st{constructor(){super(...arguments),this.splitBusinessHourSegs=$(Hv),this.splitBgEventSegs=$(XV),this.splitFgEventSegs=$(Hv),this.splitDateSelectionSegs=$(Hv),this.splitEventDrag=$(JD),this.splitEventResize=$(JD),this.rowRefs=new Ot}render(){let{props:e,context:t}=this,n=e.cells.length,s=this.splitBusinessHourSegs(e.businessHourSegs,n),r=this.splitBgEventSegs(e.bgEventSegs,n),o=this.splitFgEventSegs(e.fgEventSegs,n),a=this.splitDateSelectionSegs(e.dateSelectionSegs,n),l=this.splitEventDrag(e.eventDrag,n),c=this.splitEventResize(e.eventResize,n),d=n>=7&&e.clientWidth?e.clientWidth/t.options.aspectRatio/6:null;return x(Lt,{unit:"day"},(h,p)=>x(ae,null,e.cells.map((m,y)=>x(Gv,{ref:this.rowRefs.createRef(y),key:m.length?m[0].date.toISOString():y,showDayNumbers:n>1,showWeekNumbers:e.showWeekNumbers,todayRange:p,dateProfile:e.dateProfile,cells:m,renderIntro:e.renderRowIntro,businessHourSegs:s[y],eventSelection:e.eventSelection,bgEventSegs:r[y],fgEventSegs:o[y],dateSelectionSegs:a[y],eventDrag:l[y],eventResize:c[y],dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,clientWidth:e.clientWidth,clientHeight:e.clientHeight,cellMinHeight:d,forPrint:e.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){let e=this.rowRefs.currentMap[0].getCellEls()[0],t=e?e.closest(".fc-daygrid-body"):null;t&&(this.rootEl=t,this.context.registerInteractiveComponent(this,{el:t,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new qn(this.rootEl,this.rowRefs.collect().map(e=>e.getCellEls()[0]),!1,!0),this.colPositions=new qn(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(e,t){let{colPositions:n,rowPositions:s}=this,r=n.leftToIndex(e),o=s.topToIndex(t);if(o!=null&&r!=null){let a=this.props.cells[o][r];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(o,r),allDay:!0},a.extraDateSpan),dayEl:this.getCellEl(o,r),rect:{left:n.lefts[r],right:n.rights[r],top:s.tops[o],bottom:s.bottoms[o]},layer:0}}return null}getCellEl(e,t){return this.rowRefs.currentMap[e].getCellEls()[t]}getCellRange(e,t){let n=this.props.cells[e][t].date,s=Ee(n,1);return{start:n,end:s}}};function XV(i,e){return Hv(i.filter(JV),e)}function JV(i){return i.eventRange.def.allDay}var C_=class extends st{constructor(){super(...arguments),this.elRef=Ne(),this.needsScrollReset=!1}render(){let{props:e}=this,{dayMaxEventRows:t,dayMaxEvents:n,expandRows:s}=e,r=n===!0||t===!0;r&&!s&&(r=!1,t=null,n=null);let o=["fc-daygrid-body",r?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",s?"":"fc-daygrid-body-natural"];return x("div",{ref:this.elRef,className:o.join(" "),style:{width:e.clientWidth,minWidth:e.tableMinWidth}},x("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:e.clientWidth,minWidth:e.tableMinWidth,height:s?e.clientHeight:""}},e.colGroupNode,x("tbody",{role:"presentation"},x(__,{dateProfile:e.dateProfile,cells:e.cells,renderRowIntro:e.renderRowIntro,showWeekNumbers:e.showWeekNumbers,clientWidth:e.clientWidth,clientHeight:e.clientHeight,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,dayMaxEvents:n,dayMaxEventRows:t,forPrint:e.forPrint,isHitComboAllowed:e.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(e){e.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){let e=ZV(this.elRef.current,this.props.dateProfile);if(e){let t=e.closest(".fc-daygrid-body"),n=t.closest(".fc-scroller"),s=e.getBoundingClientRect().top-t.getBoundingClientRect().top;n.scrollTop=s?s+1:0}this.needsScrollReset=!1}}};function ZV(i,e){let t;return e.currentRangeUnit.match(/year|month/)&&(t=i.querySelector(`[data-date="${PS(e.currentDate)}-01"]`)),t||(t=i.querySelector(`[data-date="${mr(e.currentDate)}"]`)),t}var T_=class extends ca{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(e,t){return t.sliceRange(e)}},Rf=class extends st{constructor(){super(...arguments),this.slicer=new T_,this.tableRef=Ne()}render(){let{props:e,context:t}=this;return x(C_,Object.assign({ref:this.tableRef},this.slicer.sliceProps(e,e.dateProfile,e.nextDayThreshold,t,e.dayTableModel),{dateProfile:e.dateProfile,cells:e.dayTableModel.cells,colGroupNode:e.colGroupNode,tableMinWidth:e.tableMinWidth,renderRowIntro:e.renderRowIntro,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.showWeekNumbers,expandRows:e.expandRows,headerAlignElRef:e.headerAlignElRef,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:e.forPrint}))}},$v=class extends E_{constructor(){super(...arguments),this.buildDayTableModel=$(jV),this.headerRef=Ne(),this.tableRef=Ne()}render(){let{options:e,dateProfileGenerator:t}=this.context,{props:n}=this,s=this.buildDayTableModel(n.dateProfile,t),r=e.dayHeaders&&x(oa,{ref:this.headerRef,dateProfile:n.dateProfile,dates:s.headerDates,datesRepDistinctDays:s.rowCnt===1}),o=a=>x(Rf,{ref:this.tableRef,dateProfile:n.dateProfile,dayTableModel:s,businessHours:n.businessHours,dateSelection:n.dateSelection,eventStore:n.eventStore,eventUiBases:n.eventUiBases,eventSelection:n.eventSelection,eventDrag:n.eventDrag,eventResize:n.eventResize,nextDayThreshold:e.nextDayThreshold,colGroupNode:a.tableColGroupNode,tableMinWidth:a.tableMinWidth,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.weekNumbers,expandRows:!n.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:a.clientWidth,clientHeight:a.clientHeight,forPrint:n.forPrint});return e.dayMinWidth?this.renderHScrollLayout(r,o,s.colCnt,e.dayMinWidth):this.renderSimpleLayout(r,o)}};function jV(i,e){let t=new aa(i.renderRange,e);return new la(t,/year|month|week/.test(i.currentRangeUnit))}var zv=class extends na{buildRenderRange(e,t,n){let s=super.buildRenderRange(e,t,n),{props:r}=this;return QV({currentRange:s,snapToWeek:/^(year|month)$/.test(t),fixedWeekCount:r.fixedWeekCount,dateEnv:r.dateEnv})}};function QV(i){let{dateEnv:e,currentRange:t}=i,{start:n,end:s}=t,r;if(i.snapToWeek&&(n=e.startOfWeek(n),r=e.startOfWeek(s),r.valueOf()!==s.valueOf()&&(s=Ev(r,1))),i.fixedWeekCount){let o=e.startOfWeek(e.startOfMonth(Ee(t.end,-1))),a=Math.ceil(IS(o,s));s=Ev(s,6-a)}return{start:n,end:s}}var eG=':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}';gr(eG);var tP=Ut({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:$v,dateProfileGeneratorClass:zv},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});var R_=class extends tf{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(e){return e.allDay?["allDay"]:["timed"]}getKeysForEventDef(e){return e.allDay?XS(e)?["timed","allDay"]:["allDay"]:["timed"]}},tG=ue({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function oP(i){let e=["fc-timegrid-slot","fc-timegrid-slot-label",i.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return x(bn.Consumer,null,t=>{if(!i.isLabeled)return x("td",{className:e.join(" "),"data-time":i.isoTimeStr});let{dateEnv:n,options:s,viewApi:r}=t,o=s.slotLabelFormat==null?tG:Array.isArray(s.slotLabelFormat)?ue(s.slotLabelFormat[0]):ue(s.slotLabelFormat),a={level:0,time:i.time,date:n.toDate(i.date),view:r,text:n.format(i.date,o)};return x(xe,{elTag:"td",elClasses:e,elAttrs:{"data-time":i.isoTimeStr},renderProps:a,generatorName:"slotLabelContent",customGenerator:s.slotLabelContent,defaultGenerator:nG,classNameGenerator:s.slotLabelClassNames,didMount:s.slotLabelDidMount,willUnmount:s.slotLabelWillUnmount},l=>x("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},x(l,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function nG(i){return i.text}var I_=class extends ne{render(){return this.props.slatMetas.map(e=>x("tr",{key:e.key},x(oP,Object.assign({},e))))}},iG=ue({week:"short"}),sG=5,D_=class extends st{constructor(){super(...arguments),this.allDaySplitter=new R_,this.headerElRef=Ne(),this.rootElRef=Ne(),this.scrollerElRef=Ne(),this.state={slatCoords:null},this.handleScrollTopRequest=e=>{let t=this.scrollerElRef.current;t&&(t.scrollTop=e)},this.renderHeadAxis=(e,t="")=>{let{options:n}=this.context,{dateProfile:s}=this.props,r=s.renderRange,a=Ai(r.start,r.end)===1?_i(this.context,r.start,"week"):{};return n.weekNumbers&&e==="day"?x(Tf,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:r.start,defaultFormat:iG},l=>x("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:t}},x(l,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:a}))):x("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},x("div",{className:"fc-timegrid-axis-frame",style:{height:t}}))},this.renderTableRowAxis=e=>{let{options:t,viewApi:n}=this.context,s={text:t.allDayText,view:n};return x(xe,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:s,generatorName:"allDayContent",customGenerator:t.allDayContent,defaultGenerator:rG,classNameGenerator:t.allDayClassNames,didMount:t.allDayDidMount,willUnmount:t.allDayWillUnmount},r=>x("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",e==null?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:e}},x(r,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=e=>{this.setState({slatCoords:e})}}renderSimpleLayout(e,t,n){let{context:s,props:r}=this,o=[],a=pa(s.options);return e&&o.push({type:"header",key:"header",isSticky:a,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),t&&(o.push({type:"body",key:"all-day",chunk:{content:t}}),o.push({type:"body",key:"all-day-divider",outerContent:x("tr",{role:"presentation",className:"fc-scrollgrid-section"},x("td",{className:"fc-timegrid-divider "+s.theme.getClass("tableCellShaded")}))})),o.push({type:"body",key:"body",liquid:!0,expandRows:!!s.options.expandRows,chunk:{scrollerElRef:this.scrollerElRef,content:n}}),x($n,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:s.viewSpec},x(hr,{liquid:!r.isHeightAuto&&!r.forPrint,collapsibleWidth:r.forPrint,cols:[{width:"shrink"}],sections:o}))}renderHScrollLayout(e,t,n,s,r,o,a){let l=this.context.pluginHooks.scrollGridImpl;if(!l)throw new Error("No ScrollGrid implementation");let{context:c,props:d}=this,h=!d.forPrint&&pa(c.options),p=!d.forPrint&&Sf(c.options),m=[];e&&m.push({type:"header",key:"header",isSticky:h,syncRowHeights:!0,chunks:[{key:"axis",rowContent:v=>x("tr",{role:"presentation"},this.renderHeadAxis("day",v.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),t&&(m.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:v=>x("tr",{role:"presentation"},this.renderTableRowAxis(v.rowSyncHeights[0]))},{key:"cols",content:t}]}),m.push({key:"all-day-divider",type:"body",outerContent:x("tr",{role:"presentation",className:"fc-scrollgrid-section"},x("td",{colSpan:2,className:"fc-timegrid-divider "+c.theme.getClass("tableCellShaded")}))}));let y=c.options.nowIndicator;return m.push({type:"body",key:"body",liquid:!0,expandRows:!!c.options.expandRows,chunks:[{key:"axis",content:v=>x("div",{className:"fc-timegrid-axis-chunk"},x("table",{"aria-hidden":!0,style:{height:v.expandRows?v.clientHeight:""}},v.tableColGroupNode,x("tbody",null,x(I_,{slatMetas:o}))),x("div",{className:"fc-timegrid-now-indicator-container"},x(Lt,{unit:y?"minute":"day"},E=>{let A=y&&a&&a.safeComputeTop(E);return typeof A=="number"?x(_f,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:A},isAxis:!0,date:E}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:n}]}),p&&m.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:Pc},{key:"cols",content:Pc}]}),x($n,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:c.viewSpec},x(l,{liquid:!d.isHeightAuto&&!d.forPrint,forPrint:d.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:s,minWidth:r}]}],sections:m}))}getAllDayMaxEventProps(){let{dayMaxEvents:e,dayMaxEventRows:t}=this.context.options;return(e===!0||t===!0)&&(e=void 0,t=sG),{dayMaxEvents:e,dayMaxEventRows:t}}};function rG(i){return i.text}var P_=class{constructor(e,t,n){this.positions=e,this.dateProfile=t,this.slotDuration=n}safeComputeTop(e){let{dateProfile:t}=this;if(mn(t.currentRange,e)){let n=de(e),s=e.valueOf()-n.valueOf();if(s>=en(t.slotMinTime)&&s<en(t.slotMaxTime))return this.computeTimeTop(te(s))}return null}computeDateTop(e,t){return t||(t=de(e)),this.computeTimeTop(te(e.valueOf()-t.valueOf()))}computeTimeTop(e){let{positions:t,dateProfile:n}=this,s=t.els.length,r=(e.milliseconds-en(n.slotMinTime))/en(this.slotDuration),o,a;return r=Math.max(0,r),r=Math.min(s,r),o=Math.floor(r),o=Math.min(o,s-1),a=r-o,t.tops[o]+t.getHeight(o)*a}},M_=class extends ne{render(){let{props:e,context:t}=this,{options:n}=t,{slatElRefs:s}=e;return x("tbody",null,e.slatMetas.map((r,o)=>{let a={time:r.time,date:t.dateEnv.toDate(r.date),view:t.viewApi};return x("tr",{key:r.key,ref:s.createRef(r.key)},e.axis&&x(oP,Object.assign({},r)),x(xe,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!r.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":r.isoTimeStr},renderProps:a,generatorName:"slotLaneContent",customGenerator:n.slotLaneContent,classNameGenerator:n.slotLaneClassNames,didMount:n.slotLaneDidMount,willUnmount:n.slotLaneWillUnmount}))}))}},k_=class extends ne{constructor(){super(...arguments),this.rootElRef=Ne(),this.slatElRefs=new Ot}render(){let{props:e,context:t}=this;return x("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},x("table",{"aria-hidden":!0,className:t.theme.getClass("table"),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:e.minHeight}},e.tableColGroupNode,x(M_,{slatElRefs:this.slatElRefs,axis:e.axis,slatMetas:e.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:e,props:t}=this;t.onCoords&&t.clientWidth!==null&&this.rootElRef.current.offsetHeight&&t.onCoords(new P_(new qn(this.rootElRef.current,oG(this.slatElRefs.currentMap,t.slatMetas),!1,!0),this.props.dateProfile,e.options.slotDuration))}};function oG(i,e){return e.map(t=>i[t.key])}function If(i,e){let t=[],n;for(n=0;n<e;n+=1)t.push([]);if(i)for(n=0;n<i.length;n+=1)t[i[n].col].push(i[n]);return t}function nP(i,e){let t=[];if(i){for(let n=0;n<e;n+=1)t[n]={affectedInstances:i.affectedInstances,isEvent:i.isEvent,segs:[]};for(let n of i.segs)t[n.col].segs.push(n)}else for(let n=0;n<e;n+=1)t[n]=null;return t}var N_=class extends ne{render(){let{props:e}=this;return x(ua,{elClasses:["fc-timegrid-more-link"],elStyle:{top:e.top,bottom:e.bottom},allDayDate:null,moreCnt:e.hiddenSegs.length,allSegs:e.hiddenSegs,hiddenSegs:e.hiddenSegs,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,todayRange:e.todayRange,popoverContent:()=>aP(e.hiddenSegs,e),defaultGenerator:aG,forceTimed:!0},t=>x(t,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}};function aG(i){return i.shortText}function lG(i,e,t){let n=new ra;e!=null&&(n.strictOrder=e),t!=null&&(n.maxStackCnt=t);let s=n.addSegs(i),r=o_(s),o=cG(n);return o=fG(o,1),{segRects:pG(o),hiddenGroups:r}}function cG(i){let{entriesByLevel:e}=i,t=B_((n,s)=>n+":"+s,(n,s)=>{let r=hG(i,n,s),o=iP(r,t),a=e[n][s];return[Object.assign(Object.assign({},a),{nextLevelNodes:o[0]}),a.thickness+o[1]]});return iP(e.length?{level:0,lateralStart:0,lateralEnd:e[0].length}:null,t)[0]}function iP(i,e){if(!i)return[[],0];let{level:t,lateralStart:n,lateralEnd:s}=i,r=n,o=[];for(;r<s;)o.push(e(t,r)),r+=1;return o.sort(dG),[o.map(uG),o[0][1]]}function dG(i,e){return e[1]-i[1]}function uG(i){return i[0]}function hG(i,e,t){let{levelCoords:n,entriesByLevel:s}=i,r=s[e][t],o=n[e]+r.thickness,a=n.length,l=e;for(;l<a&&n[l]<o;l+=1);for(;l<a;l+=1){let c=s[l],d,h=of(c,r.span.start,rf),p=h[0]+h[1],m=p;for(;(d=c[m])&&d.span.start<r.span.end;)m+=1;if(p<m)return{level:l,lateralStart:p,lateralEnd:m}}return null}function fG(i,e){let t=B_((n,s,r)=>Ei(n),(n,s,r)=>{let{nextLevelNodes:o,thickness:a}=n,l=a+r,c=a/l,d,h=[];if(!o.length)d=e;else for(let m of o)if(d===void 0){let y=t(m,s,l);d=y[0],h.push(y[1])}else{let y=t(m,d,0);h.push(y[1])}let p=(d-s)*c;return[d-p,Object.assign(Object.assign({},n),{thickness:p,nextLevelNodes:h})]});return i.map(n=>t(n,0,0)[1])}function pG(i){let e=[],t=B_((s,r,o)=>Ei(s),(s,r,o)=>{let a=Object.assign(Object.assign({},s),{levelCoord:r,stackDepth:o,stackForward:0});return e.push(a),a.stackForward=n(s.nextLevelNodes,r+s.thickness,o+1)+1});function n(s,r,o){let a=0;for(let l of s)a=Math.max(t(l,r,o),a);return a}return n(i,0,0),e}function B_(i,e){let t={};return(...n)=>{let s=i(...n);return s in t?t[s]:t[s]=e(...n)}}function sP(i,e,t=null,n=0){let s=[];if(t)for(let r=0;r<i.length;r+=1){let o=i[r],a=t.computeDateTop(o.start,e),l=Math.max(a+(n||0),t.computeDateTop(o.end,e));s.push({start:Math.round(a),end:Math.round(l)})}return s}function gG(i,e,t,n){let s=[],r=[];for(let c=0;c<i.length;c+=1){let d=e[c];d?s.push({index:c,thickness:1,span:d}):r.push(i[c])}let{segRects:o,hiddenGroups:a}=lG(s,t,n),l=[];for(let c of o)l.push({seg:i[c.index],rect:c});for(let c of r)l.push({seg:c,rect:null});return{segPlacements:l,hiddenGroups:a}}var mG=ue({hour:"numeric",minute:"2-digit",meridiem:!1}),qv=class extends ne{render(){return x(fr,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:mG}))}},F_=class extends ne{constructor(){super(...arguments),this.sortEventSegs=$(fa)}render(){let{props:e,context:t}=this,{options:n}=t,s=n.selectMirror,r=e.eventDrag&&e.eventDrag.segs||e.eventResize&&e.eventResize.segs||s&&e.dateSelectionSegs||[],o=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{},a=this.sortEventSegs(e.fgEventSegs,n.eventOrder);return x(pr,{elTag:"td",elRef:e.elRef,elClasses:["fc-timegrid-col",...e.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},e.extraDataAttrs),date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,extraRenderProps:e.extraRenderProps},l=>x("div",{className:"fc-timegrid-col-frame"},x("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(e.businessHourSegs,"non-business"),this.renderFillSegs(e.bgEventSegs,"bg-event"),this.renderFillSegs(e.dateSelectionSegs,"highlight")),x("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(a,o,!1,!1,!1)),x("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(r,{},!!e.eventDrag,!!e.eventResize,!!s,"mirror")),x("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(e.nowIndicatorSegs)),Mc(n)&&x(l,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(e,t,n,s,r,o){let{props:a}=this;return a.forPrint?aP(e,a):this.renderPositionedFgSegs(e,t,n,s,r,o)}renderPositionedFgSegs(e,t,n,s,r,o){let{eventMaxStack:a,eventShortHeight:l,eventOrderStrict:c,eventMinHeight:d}=this.context.options,{date:h,slatCoords:p,eventSelection:m,todayRange:y,nowDate:v}=this.props,E=n||s||r,A=sP(e,h,p,d),{segPlacements:_,hiddenGroups:C}=gG(e,A,c,a);return x(ae,null,this.renderHiddenGroups(C,e),_.map(T=>{let{seg:R,rect:I}=T,D=R.eventRange.instance.instanceId,k=E||!!(!t[D]&&I),N=x_(I&&I.span),F=!E&&I?this.computeSegHStyle(I):{left:0,right:0},U=!!I&&I.stackForward>0,re=!!I&&I.span.end-I.span.start<l;return x("div",{className:"fc-timegrid-event-harness"+(U?" fc-timegrid-event-harness-inset":""),key:o||D,style:Object.assign(Object.assign({visibility:k?"":"hidden"},N),F)},x(qv,Object.assign({seg:R,isDragging:n,isResizing:s,isDateSelecting:r,isSelected:D===m,isShort:re},sn(R,y,v))))}))}renderHiddenGroups(e,t){let{extraDateSpan:n,dateProfile:s,todayRange:r,nowDate:o,eventSelection:a,eventDrag:l,eventResize:c}=this.props;return x(ae,null,e.map(d=>{let h=x_(d.span),p=yG(d.entries,t);return x(N_,{key:wv(Fv(p)),hiddenSegs:p,top:h.top,bottom:h.bottom,extraDateSpan:n,dateProfile:s,todayRange:r,nowDate:o,eventSelection:a,eventDrag:l,eventResize:c})}))}renderFillSegs(e,t){let{props:n,context:s}=this,o=sP(e,n.date,n.slatCoords,s.options.eventMinHeight).map((a,l)=>{let c=e[l];return x("div",{key:yf(c.eventRange),className:"fc-timegrid-bg-harness",style:x_(a)},t==="bg-event"?x(da,Object.assign({seg:c},sn(c,n.todayRange,n.nowDate))):Cf(t))});return x(ae,null,o)}renderNowIndicator(e){let{slatCoords:t,date:n}=this.props;return t?e.map((s,r)=>x(_f,{key:r,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:t.computeDateTop(s.start,n)},isAxis:!1,date:n})):null}computeSegHStyle(e){let{isRtl:t,options:n}=this.context,s=n.slotEventOverlap,r=e.levelCoord,o=e.levelCoord+e.thickness,a,l;s&&(o=Math.min(1,r+(o-r)*2)),t?(a=1-o,l=r):(a=r,l=1-o);let c={zIndex:e.stackDepth+1,left:a*100+"%",right:l*100+"%"};return s&&!e.stackForward&&(c[t?"marginLeft":"marginRight"]=10*2),c}};function aP(i,{todayRange:e,nowDate:t,eventSelection:n,eventDrag:s,eventResize:r}){let o=(s?s.affectedInstances:null)||(r?r.affectedInstances:null)||{};return x(ae,null,i.map(a=>{let l=a.eventRange.instance.instanceId;return x("div",{key:l,style:{visibility:o[l]?"hidden":""}},x(qv,Object.assign({seg:a,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:l===n,isShort:!1},sn(a,e,t))))}))}function x_(i){return i?{top:i.start,bottom:-i.end}:{top:"",bottom:""}}function yG(i,e){return i.map(t=>e[t.index])}var L_=class extends ne{constructor(){super(...arguments),this.splitFgEventSegs=$(If),this.splitBgEventSegs=$(If),this.splitBusinessHourSegs=$(If),this.splitNowIndicatorSegs=$(If),this.splitDateSelectionSegs=$(If),this.splitEventDrag=$(nP),this.splitEventResize=$(nP),this.rootElRef=Ne(),this.cellElRefs=new Ot}render(){let{props:e,context:t}=this,n=t.options.nowIndicator&&e.slatCoords&&e.slatCoords.safeComputeTop(e.nowDate),s=e.cells.length,r=this.splitFgEventSegs(e.fgEventSegs,s),o=this.splitBgEventSegs(e.bgEventSegs,s),a=this.splitBusinessHourSegs(e.businessHourSegs,s),l=this.splitNowIndicatorSegs(e.nowIndicatorSegs,s),c=this.splitDateSelectionSegs(e.dateSelectionSegs,s),d=this.splitEventDrag(e.eventDrag,s),h=this.splitEventResize(e.eventResize,s);return x("div",{className:"fc-timegrid-cols",ref:this.rootElRef},x("table",{role:"presentation",style:{minWidth:e.tableMinWidth,width:e.clientWidth}},e.tableColGroupNode,x("tbody",{role:"presentation"},x("tr",{role:"row"},e.axis&&x("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},x("div",{className:"fc-timegrid-col-frame"},x("div",{className:"fc-timegrid-now-indicator-container"},typeof n=="number"&&x(_f,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:n},isAxis:!0,date:e.nowDate})))),e.cells.map((p,m)=>x(F_,{key:p.key,elRef:this.cellElRefs.createRef(p.key),dateProfile:e.dateProfile,date:p.date,nowDate:e.nowDate,todayRange:e.todayRange,extraRenderProps:p.extraRenderProps,extraDataAttrs:p.extraDataAttrs,extraClassNames:p.extraClassNames,extraDateSpan:p.extraDateSpan,fgEventSegs:r[m],bgEventSegs:o[m],businessHourSegs:a[m],nowIndicatorSegs:l[m],dateSelectionSegs:c[m],eventDrag:d[m],eventResize:h[m],slatCoords:e.slatCoords,eventSelection:e.eventSelection,forPrint:e.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:e}=this;e.onColCoords&&e.clientWidth!==null&&e.onColCoords(new qn(this.rootElRef.current,vG(this.cellElRefs.currentMap,e.cells),!0,!1))}};function vG(i,e){return e.map(t=>i[t.key])}var O_=class extends st{constructor(){super(...arguments),this.processSlotOptions=$(bG),this.state={slatCoords:null},this.handleRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=e=>{let{onScrollTopRequest:t}=this.props,{slatCoords:n}=this.state;if(t&&n){if(e.time){let s=n.computeTimeTop(e.time);s=Math.ceil(s),s&&(s+=1),t(s)}return!0}return!1},this.handleColCoords=e=>{this.colCoords=e},this.handleSlatCoords=e=>{this.setState({slatCoords:e}),this.props.onSlatCoords&&this.props.onSlatCoords(e)}}render(){let{props:e,state:t}=this;return x("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:e.clientWidth,minWidth:e.tableMinWidth}},x(k_,{axis:e.axis,dateProfile:e.dateProfile,slatMetas:e.slatMetas,clientWidth:e.clientWidth,minHeight:e.expandRows?e.clientHeight:"",tableMinWidth:e.tableMinWidth,tableColGroupNode:e.axis?e.tableColGroupNode:null,onCoords:this.handleSlatCoords}),x(L_,{cells:e.cells,axis:e.axis,dateProfile:e.dateProfile,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange,nowDate:e.nowDate,nowIndicatorSegs:e.nowIndicatorSegs,clientWidth:e.clientWidth,tableMinWidth:e.tableMinWidth,tableColGroupNode:e.tableColGroupNode,slatCoords:t.slatCoords,onColCoords:this.handleColCoords,forPrint:e.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(e){this.scrollResponder.update(e.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(e,t){let{dateEnv:n,options:s}=this.context,{colCoords:r}=this,{dateProfile:o}=this.props,{slatCoords:a}=this.state,{snapDuration:l,snapsPerSlot:c}=this.processSlotOptions(this.props.slotDuration,s.snapDuration),d=r.leftToIndex(e),h=a.positions.topToIndex(t);if(d!=null&&h!=null){let p=this.props.cells[d],m=a.positions.tops[h],y=a.positions.getHeight(h),v=(t-m)/y,E=Math.floor(v*c),A=h*c+E,_=this.props.cells[d].date,C=hf(o.slotMinTime,RS(l,A)),T=n.add(_,C),R=n.add(T,l);return{dateProfile:o,dateSpan:Object.assign({range:{start:T,end:R},allDay:!1},p.extraDateSpan),dayEl:r.els[d],rect:{left:r.lefts[d],right:r.rights[d],top:m,bottom:m+y},layer:0}}return null}};function bG(i,e){let t=e||i,n=ff(i,t);return n===null&&(t=i,n=1),{snapDuration:t,snapsPerSlot:n}}var U_=class extends ca{sliceRange(e,t){let n=[];for(let s=0;s<t.length;s+=1){let r=tn(e,t[s]);r&&n.push({start:r.start,end:r.end,isStart:r.start.valueOf()===e.start.valueOf(),isEnd:r.end.valueOf()===e.end.valueOf(),col:s})}return n}},H_=class extends st{constructor(){super(...arguments),this.buildDayRanges=$(EG),this.slicer=new U_,this.timeColsRef=Ne()}render(){let{props:e,context:t}=this,{dateProfile:n,dayTableModel:s}=e,{nowIndicator:r,nextDayThreshold:o}=t.options,a=this.buildDayRanges(s,n,t.dateEnv);return x(Lt,{unit:r?"minute":"day"},(l,c)=>x(O_,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(e,n,null,t,a),{forPrint:e.forPrint,axis:e.axis,dateProfile:n,slatMetas:e.slatMetas,slotDuration:e.slotDuration,cells:s.cells[0],tableColGroupNode:e.tableColGroupNode,tableMinWidth:e.tableMinWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight,expandRows:e.expandRows,nowDate:l,nowIndicatorSegs:r&&this.slicer.sliceNowDate(l,n,o,t,a),todayRange:c,onScrollTopRequest:e.onScrollTopRequest,onSlatCoords:e.onSlatCoords})))}};function EG(i,e,t){let n=[];for(let s of i.headerDates)n.push({start:t.add(s,e.slotMinTime),end:t.add(s,e.slotMaxTime)});return n}var rP=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function wG(i,e,t,n,s){let r=new Date(0),o=i,a=te(0),l=t||AG(n),c=[];for(;en(o)<en(e);){let d=s.add(r,o),h=ff(a,l)!==null;c.push({date:d,time:o,key:d.toISOString(),isoTimeStr:MS(d),isLabeled:h}),o=hf(o,n),a=hf(a,n)}return c}function AG(i){let e,t,n;for(e=rP.length-1;e>=0;e-=1)if(t=te(rP[e]),n=ff(t,i),n!==null&&n>1)return t;return i}var Wv=class extends D_{constructor(){super(...arguments),this.buildTimeColsModel=$(SG),this.buildSlatMetas=$(wG)}render(){let{options:e,dateEnv:t,dateProfileGenerator:n}=this.context,{props:s}=this,{dateProfile:r}=s,o=this.buildTimeColsModel(r,n),a=this.allDaySplitter.splitProps(s),l=this.buildSlatMetas(r.slotMinTime,r.slotMaxTime,e.slotLabelInterval,e.slotDuration,t),{dayMinWidth:c}=e,d=!c,h=c,p=e.dayHeaders&&x(oa,{dates:o.headerDates,dateProfile:r,datesRepDistinctDays:!0,renderIntro:d?this.renderHeadAxis:null}),m=e.allDaySlot!==!1&&(v=>x(Rf,Object.assign({},a.allDay,{dateProfile:r,dayTableModel:o,nextDayThreshold:e.nextDayThreshold,tableMinWidth:v.tableMinWidth,colGroupNode:v.tableColGroupNode,renderRowIntro:d?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:v.clientWidth,clientHeight:v.clientHeight,forPrint:s.forPrint},this.getAllDayMaxEventProps()))),y=v=>x(H_,Object.assign({},a.timed,{dayTableModel:o,dateProfile:r,axis:d,slotDuration:e.slotDuration,slatMetas:l,forPrint:s.forPrint,tableColGroupNode:v.tableColGroupNode,tableMinWidth:v.tableMinWidth,clientWidth:v.clientWidth,clientHeight:v.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:v.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return h?this.renderHScrollLayout(p,m,y,o.colCnt,c,l,this.state.slatCoords):this.renderSimpleLayout(p,m,y)}};function SG(i,e){let t=new aa(i.renderRange,e);return new la(t,!1)}var _G='.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}';gr(_G);var CG={allDaySlot:Boolean},lP=Ut({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:CG,views:{timeGrid:{component:Wv,usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});var V_=class extends ne{constructor(){super(...arguments),this.state={textId:vn()}}render(){let{theme:e,dateEnv:t,options:n,viewApi:s}=this.context,{cellId:r,dayDate:o,todayRange:a}=this.props,{textId:l}=this.state,c=bf(o,a),d=n.listDayFormat?t.format(o,n.listDayFormat):"",h=n.listDaySideFormat?t.format(o,n.listDaySideFormat):"",p=Object.assign({date:t.toDate(o),view:s,textId:l,text:d,sideText:h,navLinkAttrs:_i(this.context,o),sideNavLinkAttrs:_i(this.context,o,"day",!1)},c);return x(xe,{elTag:"tr",elClasses:["fc-list-day",...Dc(c,e)],elAttrs:{"data-date":mr(o)},renderProps:p,generatorName:"dayHeaderContent",customGenerator:n.dayHeaderContent,defaultGenerator:TG,classNameGenerator:n.dayHeaderClassNames,didMount:n.dayHeaderDidMount,willUnmount:n.dayHeaderWillUnmount},m=>x("th",{scope:"colgroup",colSpan:3,id:r,"aria-labelledby":l},x(m,{elTag:"div",elClasses:["fc-list-day-cushion",e.getClass("tableCellShaded")]})))}};function TG(i){return x(ae,null,i.text&&x("a",Object.assign({id:i.textId,className:"fc-list-day-text"},i.navLinkAttrs),i.text),i.sideText&&x("a",Object.assign({"aria-hidden":!0,className:"fc-list-day-side-text"},i.sideNavLinkAttrs),i.sideText))}var xG=ue({hour:"numeric",minute:"2-digit",meridiem:"short"}),G_=class extends ne{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s,timeHeaderId:r,eventHeaderId:o,dateHeaderId:a}=e,l=n.eventTimeFormat||xG;return x(ps,Object.assign({},e,{elTag:"tr",elClasses:["fc-list-event",s.eventRange.def.url&&"fc-event-forced-url"],defaultGenerator:()=>RG(s,t),seg:s,timeText:"",disableDragging:!0,disableResizing:!0}),(c,d)=>x(ae,null,IG(s,l,t,r,a),x("td",{"aria-hidden":!0,className:"fc-list-event-graphic"},x("span",{className:"fc-list-event-dot",style:{borderColor:d.borderColor||d.backgroundColor}})),x(c,{elTag:"td",elClasses:["fc-list-event-title"],elAttrs:{headers:`${o} ${a}`}})))}};function RG(i,e){let t=Rc(i,e);return x("a",Object.assign({},t),i.eventRange.def.title)}function IG(i,e,t,n,s){let{options:r}=t;if(r.displayEventTime!==!1){let o=i.eventRange.def,a=i.eventRange.instance,l=!1,c;if(o.allDay?l=!0:VS(i.eventRange.range)?i.isStart?c=br(i,e,t,null,null,a.range.start,i.end):i.isEnd?c=br(i,e,t,null,null,i.start,a.range.end):l=!0:c=br(i,e,t),l){let d={text:t.options.allDayText,view:t.viewApi};return x(xe,{elTag:"td",elClasses:["fc-list-event-time"],elAttrs:{headers:`${n} ${s}`},renderProps:d,generatorName:"allDayContent",customGenerator:r.allDayContent,defaultGenerator:DG,classNameGenerator:r.allDayClassNames,didMount:r.allDayDidMount,willUnmount:r.allDayWillUnmount})}return x("td",{className:"fc-list-event-time"},c)}return null}function DG(i){return i.text}var Yv=class extends st{constructor(){super(...arguments),this.computeDateVars=$(MG),this.eventStoreToSegs=$(this._eventStoreToSegs),this.state={timeHeaderId:vn(),eventHeaderId:vn(),dateHeaderIdRoot:vn()},this.setRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e}):this.context.unregisterInteractiveComponent(this)}}render(){let{props:e,context:t}=this,{dayDates:n,dayRanges:s}=this.computeDateVars(e.dateProfile),r=this.eventStoreToSegs(e.eventStore,e.eventUiBases,s);return x($n,{elRef:this.setRootEl,elClasses:["fc-list",t.theme.getClass("table"),t.options.stickyHeaderDates!==!1?"fc-list-sticky":""],viewSpec:t.viewSpec},x(Sc,{liquid:!e.isHeightAuto,overflowX:e.isHeightAuto?"visible":"hidden",overflowY:e.isHeightAuto?"visible":"auto"},r.length>0?this.renderSegList(r,n):this.renderEmptyMessage()))}renderEmptyMessage(){let{options:e,viewApi:t}=this.context,n={text:e.noEventsText,view:t};return x(xe,{elTag:"div",elClasses:["fc-list-empty"],renderProps:n,generatorName:"noEventsContent",customGenerator:e.noEventsContent,defaultGenerator:PG,classNameGenerator:e.noEventsClassNames,didMount:e.noEventsDidMount,willUnmount:e.noEventsWillUnmount},s=>x(s,{elTag:"div",elClasses:["fc-list-empty-cushion"]}))}renderSegList(e,t){let{theme:n,options:s}=this.context,{timeHeaderId:r,eventHeaderId:o,dateHeaderIdRoot:a}=this.state,l=kG(e);return x(Lt,{unit:"day"},(c,d)=>{let h=[];for(let p=0;p<l.length;p+=1){let m=l[p];if(m){let y=mr(t[p]),v=a+"-"+y;h.push(x(V_,{key:y,cellId:v,dayDate:t[p],todayRange:d})),m=fa(m,s.eventOrder);for(let E of m)h.push(x(G_,Object.assign({key:y+":"+E.eventRange.instance.instanceId,seg:E,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,timeHeaderId:r,eventHeaderId:o,dateHeaderId:v},sn(E,d,c))))}}return x("table",{className:"fc-list-table "+n.getClass("table")},x("thead",null,x("tr",null,x("th",{scope:"col",id:r},s.timeHint),x("th",{scope:"col","aria-hidden":!0}),x("th",{scope:"col",id:o},s.eventHint))),x("tbody",null,h))})}_eventStoreToSegs(e,t,n){return this.eventRangesToSegs(Ac(e,t,this.props.dateProfile.activeRange,this.context.options.nextDayThreshold).fg,n)}eventRangesToSegs(e,t){let n=[];for(let s of e)n.push(...this.eventRangeToSegs(s,t));return n}eventRangeToSegs(e,t){let{dateEnv:n}=this.context,{nextDayThreshold:s}=this.context.options,r=e.range,o=e.def.allDay,a,l,c,d=[];for(a=0;a<t.length;a+=1)if(l=tn(r,t[a]),l&&(c={component:this,eventRange:e,start:l.start,end:l.end,isStart:e.isStart&&l.start.valueOf()===r.start.valueOf(),isEnd:e.isEnd&&l.end.valueOf()===r.end.valueOf(),dayIndex:a},d.push(c),!c.isEnd&&!o&&a+1<t.length&&r.end<n.add(t[a+1].start,s))){c.end=r.end,c.isEnd=!0;break}return d}};function PG(i){return i.text}function MG(i){let e=de(i.renderRange.start),t=i.renderRange.end,n=[],s=[];for(;e<t;)n.push(e),s.push({start:e,end:Ee(e,1)}),e=Ee(e,1);return{dayDates:n,dayRanges:s}}function kG(i){let e=[],t,n;for(t=0;t<i.length;t+=1)n=i[t],(e[n.dayIndex]||(e[n.dayIndex]=[])).push(n);return e}var NG=':root{--fc-list-event-dot-width:10px;--fc-list-event-hover-bg-color:#f5f5f5}.fc-theme-standard .fc-list{border:1px solid var(--fc-border-color)}.fc .fc-list-empty{align-items:center;background-color:var(--fc-neutral-bg-color);display:flex;height:100%;justify-content:center}.fc .fc-list-empty-cushion{margin:5em 0}.fc .fc-list-table{border-style:hidden;width:100%}.fc .fc-list-table tr>*{border-left:0;border-right:0}.fc .fc-list-sticky .fc-list-day>*{background:var(--fc-page-bg-color);position:sticky;top:0}.fc .fc-list-table thead{left:-10000px;position:absolute}.fc .fc-list-table tbody>tr:first-child th{border-top:0}.fc .fc-list-table th{padding:0}.fc .fc-list-day-cushion,.fc .fc-list-table td{padding:8px 14px}.fc .fc-list-day-cushion:after{clear:both;content:"";display:table}.fc-theme-standard .fc-list-day-cushion{background-color:var(--fc-neutral-bg-color)}.fc-direction-ltr .fc-list-day-text,.fc-direction-rtl .fc-list-day-side-text{float:left}.fc-direction-ltr .fc-list-day-side-text,.fc-direction-rtl .fc-list-day-text{float:right}.fc-direction-ltr .fc-list-table .fc-list-event-graphic{padding-right:0}.fc-direction-rtl .fc-list-table .fc-list-event-graphic{padding-left:0}.fc .fc-list-event.fc-event-forced-url{cursor:pointer}.fc .fc-list-event:hover td{background-color:var(--fc-list-event-hover-bg-color)}.fc .fc-list-event-graphic,.fc .fc-list-event-time{white-space:nowrap;width:1px}.fc .fc-list-event-dot{border:calc(var(--fc-list-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-list-event-dot-width)/2);box-sizing:content-box;display:inline-block;height:0;width:0}.fc .fc-list-event-title a{color:inherit;text-decoration:none}.fc .fc-list-event.fc-event-forced-url:hover a{text-decoration:underline}';gr(NG);var FG={listDayFormat:cP,listDaySideFormat:cP,noEventsClassNames:P,noEventsContent:P,noEventsDidMount:P,noEventsWillUnmount:P};function cP(i){return i===!1?null:ue(i)}var dP=Ut({name:"@fullcalendar/list",optionRefiners:FG,views:{list:{component:Yv,buttonTextKey:"list",listDayFormat:{month:"long",day:"numeric",year:"numeric"}},listDay:{type:"list",duration:{days:1},listDayFormat:{weekday:"long"}},listWeek:{type:"list",duration:{weeks:1},listDayFormat:{weekday:"long"},listDaySideFormat:{month:"long",day:"numeric",year:"numeric"}},listMonth:{type:"list",duration:{month:1},listDaySideFormat:{weekday:"long"}},listYear:{type:"list",duration:{year:1},listDaySideFormat:{weekday:"long"}}}});Af.touchMouseIgnoreWait=500;var $_=0,Kv=0,z_=!1,Xv=class{constructor(e){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=t=>{if(!this.shouldIgnoreMouse()&&LG(t)&&this.tryStart(t)){let n=this.createEventFromMouse(t,!0);this.emitter.trigger("pointerdown",n),this.initScrollWatch(n),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=t=>{let n=this.createEventFromMouse(t);this.recordCoords(n),this.emitter.trigger("pointermove",n)},this.handleMouseUp=t=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(t)),this.cleanup()},this.handleTouchStart=t=>{if(this.tryStart(t)){this.isTouchDragging=!0;let n=this.createEventFromTouch(t,!0);this.emitter.trigger("pointerdown",n),this.initScrollWatch(n);let s=t.target;this.shouldIgnoreMove||s.addEventListener("touchmove",this.handleTouchMove),s.addEventListener("touchend",this.handleTouchEnd),s.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=t=>{let n=this.createEventFromTouch(t);this.recordCoords(n),this.emitter.trigger("pointermove",n)},this.handleTouchEnd=t=>{if(this.isDragging){let n=t.target;n.removeEventListener("touchmove",this.handleTouchMove),n.removeEventListener("touchend",this.handleTouchEnd),n.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(t)),this.cleanup(),this.isTouchDragging=!1,OG()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=t=>{if(!this.shouldIgnoreMove){let n=window.scrollX-this.prevScrollX+this.prevPageX,s=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:t,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:n,pageY:s,deltaX:n-this.origPageX,deltaY:s-this.origPageY})}},this.containerEl=e,this.emitter=new fs,e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),UG()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),HG()}tryStart(e){let t=this.querySubjectEl(e),n=e.target;return t&&(!this.handleSelector||Ve(n,this.handleSelector))?(this.subjectEl=t,this.isDragging=!0,this.wasTouchScroll=!1,!0):!1}cleanup(){z_=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(e){return this.selector?Ve(e.target,this.selector):this.containerEl}shouldIgnoreMouse(){return $_||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(z_=!0)}initScrollWatch(e){this.shouldWatchScroll&&(this.recordCoords(e),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(e){this.shouldWatchScroll&&(this.prevPageX=e.pageX,this.prevPageY=e.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(e,t){let n=0,s=0;return t?(this.origPageX=e.pageX,this.origPageY=e.pageY):(n=e.pageX-this.origPageX,s=e.pageY-this.origPageY),{origEvent:e,isTouch:!1,subjectEl:this.subjectEl,pageX:e.pageX,pageY:e.pageY,deltaX:n,deltaY:s}}createEventFromTouch(e,t){let n=e.touches,s,r,o=0,a=0;return n&&n.length?(s=n[0].pageX,r=n[0].pageY):(s=e.pageX,r=e.pageY),t?(this.origPageX=s,this.origPageY=r):(o=s-this.origPageX,a=r-this.origPageY),{origEvent:e,isTouch:!0,subjectEl:this.subjectEl,pageX:s,pageY:r,deltaX:o,deltaY:a}}};function LG(i){return i.button===0&&!i.ctrlKey}function OG(){$_+=1,setTimeout(()=>{$_-=1},Af.touchMouseIgnoreWait)}function UG(){Kv+=1,Kv===1&&window.addEventListener("touchmove",hP,{passive:!1})}function HG(){Kv-=1,Kv||window.removeEventListener("touchmove",hP,{passive:!1})}function hP(i){z_&&i.preventDefault()}var q_=class{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(e,t,n){this.sourceEl=e,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=t-window.scrollX,this.origScreenY=n-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(e,t){this.deltaX=e-window.scrollX-this.origScreenX,this.deltaY=t-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(e){e?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=e,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=e)}stop(e,t){let n=()=>{this.cleanup(),t()};e&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(n,this.revertDuration):setTimeout(n,0)}doRevertAnimation(e,t){let n=this.mirrorEl,s=this.sourceEl.getBoundingClientRect();n.style.transition="top "+t+"ms,left "+t+"ms",ha(n,{left:s.left,top:s.top}),AS(n,()=>{n.style.transition="",e()})}cleanup(){this.mirrorEl&&(lf(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&ha(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let e=this.sourceElRect,t=this.mirrorEl;return t||(t=this.mirrorEl=this.sourceEl.cloneNode(!0),t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.pointerEvents="none",t.classList.add("fc-event-dragging"),ha(t,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:e.right-e.left,height:e.bottom-e.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(t)),t}},Jv=class extends sa{constructor(e,t){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=e,this.doesListening=t,this.scrollTop=this.origScrollTop=e.getScrollTop(),this.scrollLeft=this.origScrollLeft=e.getScrollLeft(),this.scrollWidth=e.getScrollWidth(),this.scrollHeight=e.getScrollHeight(),this.clientWidth=e.getClientWidth(),this.clientHeight=e.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(e){this.scrollController.setScrollTop(e),this.doesListening||(this.scrollTop=Math.max(Math.min(e,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(e){this.scrollController.setScrollLeft(e),this.doesListening||(this.scrollLeft=Math.max(Math.min(e,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}},Zv=class extends Jv{constructor(e,t){super(new nf(e),t)}getEventTarget(){return this.scrollController.el}computeClientRect(){return r_(this.scrollController.el)}},W_=class extends Jv{constructor(e){super(new sf,e)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}},uP=typeof performance=="function"?performance.now:Date.now,Y_=class{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let e=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(e){let t=uP();this.handleSide(e,(t-this.msSinceRequest)/1e3),this.requestAnimation(t)}else this.isAnimating=!1}}}start(e,t,n){this.isEnabled&&(this.scrollCaches=this.buildCaches(n),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(e,t))}handleMove(e,t){if(this.isEnabled){let n=e-window.scrollX,s=t-window.scrollY,r=this.pointerScreenY===null?0:s-this.pointerScreenY,o=this.pointerScreenX===null?0:n-this.pointerScreenX;r<0?this.everMovedUp=!0:r>0&&(this.everMovedDown=!0),o<0?this.everMovedLeft=!0:o>0&&(this.everMovedRight=!0),this.pointerScreenX=n,this.pointerScreenY=s,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(uP()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let e of this.scrollCaches)e.destroy();this.scrollCaches=null}}requestAnimation(e){this.msSinceRequest=e,requestAnimationFrame(this.animate)}handleSide(e,t){let{scrollCache:n}=e,{edgeThreshold:s}=this,r=s-e.distance,o=r*r/(s*s)*this.maxVelocity*t,a=1;switch(e.name){case"left":a=-1;case"right":n.setScrollLeft(n.getScrollLeft()+o*a);break;case"top":a=-1;case"bottom":n.setScrollTop(n.getScrollTop()+o*a);break}}computeBestEdge(e,t){let{edgeThreshold:n}=this,s=null,r=this.scrollCaches||[];for(let o of r){let a=o.clientRect,l=e-a.left,c=a.right-e,d=t-a.top,h=a.bottom-t;l>=0&&c>=0&&d>=0&&h>=0&&(d<=n&&this.everMovedUp&&o.canScrollUp()&&(!s||s.distance>d)&&(s={scrollCache:o,name:"top",distance:d}),h<=n&&this.everMovedDown&&o.canScrollDown()&&(!s||s.distance>h)&&(s={scrollCache:o,name:"bottom",distance:h}),l<=n&&this.everMovedLeft&&o.canScrollLeft()&&(!s||s.distance>l)&&(s={scrollCache:o,name:"left",distance:l}),c<=n&&this.everMovedRight&&o.canScrollRight()&&(!s||s.distance>c)&&(s={scrollCache:o,name:"right",distance:c}))}return s}buildCaches(e){return this.queryScrollEls(e).map(t=>t===window?new W_(!1):new Zv(t,!1))}queryScrollEls(e){let t=[];for(let n of this.scrollQuery)typeof n=="object"?t.push(n):t.push(...Array.prototype.slice.call(e.getRootNode().querySelectorAll(n)));return t}},ga=class extends af{constructor(e,t){super(e),this.containerEl=e,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=s=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,SS(document.body),CS(document.body),s.isTouch||s.origEvent.preventDefault(),this.emitter.trigger("pointerdown",s),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(s.subjectEl,s.pageX,s.pageY),this.startDelay(s),this.minDistance||this.handleDistanceSurpassed(s)))},this.onPointerMove=s=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",s),!this.isDistanceSurpassed){let r=this.minDistance,o,{deltaX:a,deltaY:l}=s;o=a*a+l*l,o>=r*r&&this.handleDistanceSurpassed(s)}this.isDragging&&(s.origEvent.type!=="scroll"&&(this.mirror.handleMove(s.pageX,s.pageY),this.autoScroller.handleMove(s.pageX,s.pageY)),this.emitter.trigger("dragmove",s))}},this.onPointerUp=s=>{this.isInteracting&&(this.isInteracting=!1,_S(document.body),TS(document.body),this.emitter.trigger("pointerup",s),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(s)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let n=this.pointer=new Xv(e);n.emitter.on("pointerdown",this.onPointerDown),n.emitter.on("pointermove",this.onPointerMove),n.emitter.on("pointerup",this.onPointerUp),t&&(n.selector=t),this.mirror=new q_,this.autoScroller=new Y_}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(e){typeof this.delay=="number"?this.delayTimeoutId=setTimeout(()=>{this.delayTimeoutId=null,this.handleDelayEnd(e)},this.delay):this.handleDelayEnd(e)}handleDelayEnd(e){this.isDelayEnded=!0,this.tryStartDrag(e)}handleDistanceSurpassed(e){this.isDistanceSurpassed=!0,this.tryStartDrag(e)}tryStartDrag(e){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(e.pageX,e.pageY,this.containerEl),this.emitter.trigger("dragstart",e),this.touchScrollAllowed===!1&&this.pointer.cancelTouchScroll())}tryStopDrag(e){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,e))}stopDrag(e){this.isDragging=!1,this.emitter.trigger("dragend",e)}setIgnoreMove(e){this.pointer.shouldIgnoreMove=e}setMirrorIsVisible(e){this.mirror.setIsVisible(e)}setMirrorNeedsRevert(e){this.mirrorNeedsRevert=e}setAutoScrollEnabled(e){this.autoScroller.isEnabled=e}},K_=class{constructor(e){this.el=e,this.origRect=Ef(e),this.scrollCaches=kv(e).map(t=>new Zv(t,!0))}destroy(){for(let e of this.scrollCaches)e.destroy()}computeLeft(){let e=this.origRect.left;for(let t of this.scrollCaches)e+=t.origScrollLeft-t.getScrollLeft();return e}computeTop(){let e=this.origRect.top;for(let t of this.scrollCaches)e+=t.origScrollTop-t.getScrollTop();return e}isWithinClipping(e,t){let n={left:e,top:t};for(let s of this.scrollCaches)if(!BG(s.getEventTarget())&&!t_(n,s.clientRect))return!1;return!0}};function BG(i){let e=i.tagName;return e==="HTML"||e==="BODY"}var Nc=class{constructor(e,t){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=n=>{let{dragging:s}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(n),this.initialHit||!this.requireInitial?(s.setIgnoreMove(!1),this.emitter.trigger("pointerdown",n)):s.setIgnoreMove(!0)},this.handleDragStart=n=>{this.emitter.trigger("dragstart",n),this.handleMove(n,!0)},this.handleDragMove=n=>{this.emitter.trigger("dragmove",n),this.handleMove(n)},this.handlePointerUp=n=>{this.releaseHits(),this.emitter.trigger("pointerup",n)},this.handleDragEnd=n=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,n),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",n)},this.droppableStore=t,e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragstart",this.handleDragStart),e.emitter.on("dragmove",this.handleDragMove),e.emitter.on("pointerup",this.handlePointerUp),e.emitter.on("dragend",this.handleDragEnd),this.dragging=e,this.emitter=new fs}processFirstCoord(e){let t={left:e.pageX,top:e.pageY},n=t,s=e.subjectEl,r;s instanceof HTMLElement&&(r=Ef(s),n=n_(n,r));let o=this.initialHit=this.queryHitForOffset(n.left,n.top);if(o){if(this.useSubjectCenter&&r){let a=Mv(r,o.rect);a&&(n=i_(a))}this.coordAdjust=s_(n,t)}else this.coordAdjust={left:0,top:0}}handleMove(e,t){let n=this.queryHitForOffset(e.pageX+this.coordAdjust.left,e.pageY+this.coordAdjust.top);(t||!jv(this.movingHit,n))&&(this.movingHit=n,this.emitter.trigger("hitupdate",n,!1,e))}prepareHits(){this.offsetTrackers=yn(this.droppableStore,e=>(e.component.prepareHits(),new K_(e.el)))}releaseHits(){let{offsetTrackers:e}=this;for(let t in e)e[t].destroy();this.offsetTrackers={}}queryHitForOffset(e,t){let{droppableStore:n,offsetTrackers:s}=this,r=null;for(let o in n){let a=n[o].component,l=s[o];if(l&&l.isWithinClipping(e,t)){let c=l.computeLeft(),d=l.computeTop(),h=e-c,p=t-d,{origRect:m}=l,y=m.right-m.left,v=m.bottom-m.top;if(h>=0&&h<y&&p>=0&&p<v){let E=a.queryHit(h,p,y,v);E&&Tc(E.dateProfile.activeRange,E.dateSpan.range)&&(this.disablePointCheck||l.el.contains(l.el.getRootNode().elementFromPoint(h+c-window.scrollX,p+d-window.scrollY)))&&(!r||E.layer>r.layer)&&(E.componentId=o,E.context=a.context,E.rect.left+=c,E.rect.right+=c,E.rect.top+=d,E.rect.bottom+=d,r=E)}}}return r}};function jv(i,e){return!i&&!e?!0:!!i!=!!e?!1:JS(i.dateSpan,e.dateSpan)}function fP(i,e){let t={};for(let n of e.pluginHooks.datePointTransforms)Object.assign(t,n(i,e));return Object.assign(t,VG(i,e.dateEnv)),t}function VG(i,e){return{date:e.toDate(i.range.start),dateStr:e.formatIso(i.range.start,{omitTime:i.allDay}),allDay:i.allDay}}var X_=class extends zn{constructor(e){super(e),this.handlePointerDown=n=>{let{dragging:s}=this,r=n.origEvent.target;s.setIgnoreMove(!this.component.isValidDateDownEl(r))},this.handleDragEnd=n=>{let{component:s}=this,{pointer:r}=this.dragging;if(!r.wasTouchScroll){let{initialHit:o,finalHit:a}=this.hitDragging;if(o&&a&&jv(o,a)){let{context:l}=s,c=Object.assign(Object.assign({},fP(o.dateSpan,l)),{dayEl:o.dayEl,jsEvent:n.origEvent,view:l.viewApi||l.calendarApi.view});l.emitter.trigger("dateClick",c)}}},this.dragging=new ga(e.el),this.dragging.autoScroller.isEnabled=!1;let t=this.hitDragging=new Nc(this.dragging,vf(e));t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}},J_=class extends zn{constructor(e){super(e),this.dragSelection=null,this.handlePointerDown=o=>{let{component:a,dragging:l}=this,{options:c}=a.context,d=c.selectable&&a.isValidDateDownEl(o.origEvent.target);l.setIgnoreMove(!d),l.delay=o.isTouch?GG(a):null},this.handleDragStart=o=>{this.component.context.calendarApi.unselect(o)},this.handleHitUpdate=(o,a)=>{let{context:l}=this.component,c=null,d=!1;if(o){let h=this.hitDragging.initialHit;o.componentId===h.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(h,o)||(c=$G(h,o,l.pluginHooks.dateSelectionTransformers)),(!c||!a_(c,o.dateProfile,l))&&(d=!0,c=null)}c?l.dispatch({type:"SELECT_DATES",selection:c}):a||l.dispatch({type:"UNSELECT_DATES"}),d?df():uf(),a||(this.dragSelection=c)},this.handlePointerUp=o=>{this.dragSelection&&(Pv(this.dragSelection,o,this.component.context),this.dragSelection=null)};let{component:t}=e,{options:n}=t.context,s=this.dragging=new ga(e.el);s.touchScrollAllowed=!1,s.minDistance=n.selectMinDistance||0,s.autoScroller.isEnabled=n.dragScroll;let r=this.hitDragging=new Nc(this.dragging,vf(e));r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}};function GG(i){let{options:e}=i.context,t=e.selectLongPressDelay;return t==null&&(t=e.longPressDelay),t}function $G(i,e,t){let n=i.dateSpan,s=e.dateSpan,r=[n.range.start,n.range.end,s.range.start,s.range.end];r.sort(xS);let o={};for(let a of t){let l=a(i,e);if(l===!1)return null;l&&Object.assign(o,l)}return o.range={start:r[0],end:r[3]},o.allDay=n.allDay,o}var Df=class i extends zn{constructor(e){super(e),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=o=>{let a=o.origEvent.target,{component:l,dragging:c}=this,{mirror:d}=c,{options:h}=l.context,p=l.context;this.subjectEl=o.subjectEl;let m=this.subjectSeg=ms(o.subjectEl),v=(this.eventRange=m.eventRange).instance.instanceId;this.relevantEvents=gf(p.getCurrentData().eventStore,v),c.minDistance=o.isTouch?0:h.eventDragMinDistance,c.delay=o.isTouch&&v!==l.props.eventSelection?qG(l):null,h.fixedMirrorParent?d.parentNode=h.fixedMirrorParent:d.parentNode=Ve(a,".fc"),d.revertDuration=h.dragRevertDuration;let E=l.isValidSegDownEl(a)&&!Ve(a,".fc-event-resizer");c.setIgnoreMove(!E),this.isDragging=E&&o.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=o=>{let a=this.component.context,l=this.eventRange,c=l.instance.instanceId;o.isTouch?c!==this.component.props.eventSelection&&a.dispatch({type:"SELECT_EVENT",eventInstanceId:c}):a.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(a.calendarApi.unselect(o),a.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new me(a,l.def,l.instance),jsEvent:o.origEvent,view:a.viewApi}))},this.handleHitUpdate=(o,a)=>{if(!this.isDragging)return;let l=this.relevantEvents,c=this.hitDragging.initialHit,d=this.component.context,h=null,p=null,m=null,y=!1,v={affectedEvents:l,mutatedEvents:yt(),isEvent:!0};if(o){h=o.context;let E=h.options;d===h||E.editable&&E.droppable?(p=zG(c,o,this.eventRange.instance.range.start,h.getCurrentData().pluginHooks.eventDragMutationMassagers),p&&(m=mf(l,h.getCurrentData().eventUiBases,p,h),v.mutatedEvents=m,Nv(v,o.dateProfile,h)||(y=!0,p=null,m=null,v.mutatedEvents=yt()))):h=null}this.displayDrag(h,v),y?df():uf(),a||(d===h&&jv(c,o)&&(p=null),this.dragging.setMirrorNeedsRevert(!p),this.dragging.setMirrorIsVisible(!o||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=h,this.validMutation=p,this.mutatedRelevantEvents=m)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=o=>{if(this.isDragging){let a=this.component.context,l=a.viewApi,{receivingContext:c,validMutation:d}=this,h=this.eventRange.def,p=this.eventRange.instance,m=new me(a,h,p),y=this.relevantEvents,v=this.mutatedRelevantEvents,{finalHit:E}=this.hitDragging;if(this.clearDrag(),a.emitter.trigger("eventDragStop",{el:this.subjectEl,event:m,jsEvent:o.origEvent,view:l}),d){if(c===a){let A=new me(a,v.defs[h.defId],p?v.instances[p.instanceId]:null);a.dispatch({type:"MERGE_EVENTS",eventStore:v});let _={oldEvent:m,event:A,relatedEvents:Si(v,a,p),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:y})}},C={};for(let T of a.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(C,T(d,a));a.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},_),C),{el:o.subjectEl,delta:d.datesDelta,jsEvent:o.origEvent,view:l})),a.emitter.trigger("eventChange",_)}else if(c){let A={event:m,relatedEvents:Si(y,a,p),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:y})}};a.emitter.trigger("eventLeave",Object.assign(Object.assign({},A),{draggedEl:o.subjectEl,view:l})),a.dispatch({type:"REMOVE_EVENTS",eventStore:y}),a.emitter.trigger("eventRemove",A);let _=v.defs[h.defId],C=v.instances[p.instanceId],T=new me(c,_,C);c.dispatch({type:"MERGE_EVENTS",eventStore:v});let R={event:T,relatedEvents:Si(v,c,C),revert(){c.dispatch({type:"REMOVE_EVENTS",eventStore:v})}};c.emitter.trigger("eventAdd",R),o.isTouch&&c.dispatch({type:"SELECT_EVENT",eventInstanceId:p.instanceId}),c.emitter.trigger("drop",Object.assign(Object.assign({},fP(E.dateSpan,c)),{draggedEl:o.subjectEl,jsEvent:o.origEvent,view:E.context.viewApi})),c.emitter.trigger("eventReceive",Object.assign(Object.assign({},R),{draggedEl:o.subjectEl,view:E.context.viewApi}))}}else a.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:t}=this,{options:n}=t.context,s=this.dragging=new ga(e.el);s.pointer.selector=i.SELECTOR,s.touchScrollAllowed=!1,s.autoScroller.isEnabled=n.dragScroll;let r=this.hitDragging=new Nc(this.dragging,Ic);r.useSubjectCenter=e.useEventCenter,r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("pointerup",this.handlePointerUp),r.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(e,t){let n=this.component.context,s=this.receivingContext;s&&s!==e&&(s===n?s.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:t.affectedEvents,mutatedEvents:yt(),isEvent:!0}}):s.dispatch({type:"UNSET_EVENT_DRAG"})),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){let e=this.component.context,{receivingContext:t}=this;t&&t.dispatch({type:"UNSET_EVENT_DRAG"}),e!==t&&e.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}};Df.SELECTOR=".fc-event-draggable, .fc-event-resizable";function zG(i,e,t,n){let s=i.dateSpan,r=e.dateSpan,o=s.range.start,a=r.range.start,l={};s.allDay!==r.allDay&&(l.allDay=r.allDay,l.hasEnd=e.context.options.allDayMaintainDuration,r.allDay?o=de(t):o=t);let c=ur(o,a,i.context.dateEnv,i.componentId===e.componentId?i.largeUnit:null);c.milliseconds&&(l.allDay=!1);let d={datesDelta:c,standardProps:l};for(let h of n)h(d,i,e);return d}function qG(i){let{options:e}=i.context,t=e.eventLongPressDelay;return t==null&&(t=e.longPressDelay),t}var Z_=class extends zn{constructor(e){super(e),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=r=>{let{component:o}=this,a=this.querySegEl(r),l=ms(a),c=this.eventRange=l.eventRange;this.dragging.minDistance=o.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(r.origEvent.target)||r.isTouch&&this.component.props.eventSelection!==c.instance.instanceId)},this.handleDragStart=r=>{let{context:o}=this.component,a=this.eventRange;this.relevantEvents=gf(o.getCurrentData().eventStore,this.eventRange.instance.instanceId);let l=this.querySegEl(r);this.draggingSegEl=l,this.draggingSeg=ms(l),o.calendarApi.unselect(),o.emitter.trigger("eventResizeStart",{el:l,event:new me(o,a.def,a.instance),jsEvent:r.origEvent,view:o.viewApi})},this.handleHitUpdate=(r,o,a)=>{let{context:l}=this.component,c=this.relevantEvents,d=this.hitDragging.initialHit,h=this.eventRange.instance,p=null,m=null,y=!1,v={affectedEvents:c,mutatedEvents:yt(),isEvent:!0};r&&(r.componentId===d.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(d,r)||(p=WG(d,r,a.subjectEl.classList.contains("fc-event-resizer-start"),h.range))),p&&(m=mf(c,l.getCurrentData().eventUiBases,p,l),v.mutatedEvents=m,Nv(v,r.dateProfile,l)||(y=!0,p=null,m=null,v.mutatedEvents=null)),m?l.dispatch({type:"SET_EVENT_RESIZE",state:v}):l.dispatch({type:"UNSET_EVENT_RESIZE"}),y?df():uf(),o||(p&&jv(d,r)&&(p=null),this.validMutation=p,this.mutatedRelevantEvents=m)},this.handleDragEnd=r=>{let{context:o}=this.component,a=this.eventRange.def,l=this.eventRange.instance,c=new me(o,a,l),d=this.relevantEvents,h=this.mutatedRelevantEvents;if(o.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:c,jsEvent:r.origEvent,view:o.viewApi}),this.validMutation){let p=new me(o,h.defs[a.defId],l?h.instances[l.instanceId]:null);o.dispatch({type:"MERGE_EVENTS",eventStore:h});let m={oldEvent:c,event:p,relatedEvents:Si(h,o,l),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:d})}};o.emitter.trigger("eventResize",Object.assign(Object.assign({},m),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||te(0),endDelta:this.validMutation.endDelta||te(0),jsEvent:r.origEvent,view:o.viewApi})),o.emitter.trigger("eventChange",m)}else o.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:t}=e,n=this.dragging=new ga(e.el);n.pointer.selector=".fc-event-resizer",n.touchScrollAllowed=!1,n.autoScroller.isEnabled=t.context.options.dragScroll;let s=this.hitDragging=new Nc(this.dragging,vf(e));s.emitter.on("pointerdown",this.handlePointerDown),s.emitter.on("dragstart",this.handleDragStart),s.emitter.on("hitupdate",this.handleHitUpdate),s.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(e){return Ve(e.subjectEl,".fc-event")}};function WG(i,e,t,n){let s=i.context.dateEnv,r=i.dateSpan.range.start,o=e.dateSpan.range.start,a=ur(r,o,s,i.largeUnit);if(t){if(s.add(n.start,a)<n.end)return{startDelta:a}}else if(s.add(n.end,a)>n.start)return{endDelta:a};return null}var j_=class{constructor(e){this.context=e,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=n=>{n.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=n=>{let s=this.context.options.unselectCancel,r=bv(n.origEvent);this.matchesCancel=!!Ve(r,s),this.matchesEvent=!!Ve(r,Df.SELECTOR)},this.onDocumentPointerUp=n=>{let{context:s}=this,{documentPointer:r}=this,o=s.getCurrentData();if(!r.wasTouchScroll){if(o.dateSelection&&!this.isRecentPointerDateSelect){let a=s.options.unselectAuto;a&&(!a||!this.matchesCancel)&&s.calendarApi.unselect(n)}o.eventSelection&&!this.matchesEvent&&s.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let t=this.documentPointer=new Xv(document);t.shouldIgnoreMove=!0,t.shouldWatchScroll=!1,t.emitter.on("pointerdown",this.onDocumentPointerDown),t.emitter.on("pointerup",this.onDocumentPointerUp),e.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}},YG={fixedMirrorParent:P},KG={dateClick:P,eventDragStart:P,eventDragStop:P,eventDrop:P,eventResizeStart:P,eventResizeStop:P,eventResize:P,drop:P,eventReceive:P,eventLeave:P};Af.dataAttrPrefix="";var pP=Ut({name:"@fullcalendar/interaction",componentInteractions:[X_,J_,Df,Z_],calendarInteractions:[j_],elementDraggingImpl:ga,optionRefiners:YG,listenerRefiners:KG});var Pf=require("obsidian");var Mf=class extends Pf.Modal{constructor(t,n,s,r){super(t);this.saveCallback=null;this.event=n,this.dataProvider=s,this.settings=r}onSave(t){this.saveCallback=t}onOpen(){var A,_,C;let{contentEl:t}=this;t.empty(),t.addClass("zfb-event-modal");let n={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"},s={note:"\uB178\uD2B8",schedule:"\uC77C\uC815",meeting:"\uD68C\uC758\uB85D"},r=t.createDiv({cls:"event-modal-header"});r.style.display="flex",r.style.alignItems="center",r.style.gap="12px",r.style.marginBottom="16px";let o=r.createEl("span",{text:`${n[this.event.type]} ${s[this.event.type]}`});o.style.padding="4px 8px",o.style.backgroundColor=this.event.color||"var(--interactive-accent)",o.style.color="var(--text-on-accent)",o.style.borderRadius="4px",o.style.fontSize="12px",r.createEl("h2",{text:this.event.title}).style.margin="0";let a=t.createDiv({cls:"event-details"});a.style.padding="16px",a.style.backgroundColor="var(--background-secondary)",a.style.borderRadius="8px",a.style.marginBottom="16px";let l=a.createDiv({cls:"detail-row"});l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginBottom="8px",l.createEl("span",{text:"\u{1F4C5}"});let c=Le(this.event.start,this.settings.timezone),d="";if(this.event.allDay)d=" (\uC885\uC77C)";else{let T=this.event.start.getHours().toString().padStart(2,"0"),R=this.event.start.getMinutes().toString().padStart(2,"0");d=` ${T}:${R}`}if(l.createEl("span",{text:c+d}),(A=this.event.metadata)!=null&&A.project){let T=a.createDiv({cls:"detail-row"});T.style.display="flex",T.style.alignItems="center",T.style.gap="8px",T.style.marginBottom="8px",T.createEl("span",{text:"\u{1F4C1}"}),T.createEl("span",{text:this.event.metadata.project})}if((_=this.event.metadata)!=null&&_.tags&&this.event.metadata.tags.length>0){let T=a.createDiv({cls:"detail-row"});T.style.display="flex",T.style.alignItems="center",T.style.gap="8px",T.style.marginBottom="8px",T.createEl("span",{text:"\u{1F3F7}"});let R=T.createDiv({cls:"tags"});R.style.display="flex",R.style.gap="4px",R.style.flexWrap="wrap";for(let I of this.event.metadata.tags){let D=R.createEl("span",{text:`#${I}`});D.style.padding="2px 6px",D.style.backgroundColor="var(--background-modifier-border)",D.style.borderRadius="4px",D.style.fontSize="12px"}}if((C=this.event.metadata)!=null&&C.summary){let T=a.createDiv({cls:"detail-row"});T.style.marginTop="12px",T.style.paddingTop="12px",T.style.borderTop="1px solid var(--background-modifier-border)",T.createEl("div",{text:"\uC694\uC57D"}).style.fontWeight="500",T.createEl("p",{text:this.event.metadata.summary}).style.margin="4px 0 0 0"}let h=a.createDiv({cls:"detail-row"});h.style.marginTop="12px",h.style.fontSize="12px",h.style.color="var(--text-muted)",h.setText(`\uD30C\uC77C: ${this.event.source.path}`),this.event.source.lineNumber&&h.appendText(` (\uB77C\uC778 ${this.event.source.lineNumber})`);let p=t.createDiv({cls:"modal-button-container"});p.style.display="flex",p.style.justifyContent="space-between",p.style.marginTop="16px";let m=p.createDiv();if(this.event.type==="schedule"&&this.event.source.lineNumber){let T=m.createEl("button",{text:"\uC0AD\uC81C"});T.style.color="var(--text-error)",T.addEventListener("click",async()=>{confirm("\uC774 \uC77C\uC815\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")&&(await this.dataProvider.deleteEvent(this.event.id)?(new Pf.Notice("\uC77C\uC815\uC774 \uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),this.saveCallback&&this.saveCallback(),this.close()):new Pf.Notice("\uC77C\uC815 \uC0AD\uC81C\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4."))})}let y=p.createDiv();y.style.display="flex",y.style.gap="8px",y.createEl("button",{text:"\uD30C\uC77C \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",async()=>{await this.dataProvider.openEvent(this.event.id),this.close()}),y.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}};var Fc="zfb-calendar",kf=class extends gP.ItemView{constructor(t,n,s){super(t);this.calendar=null;this.refreshTimeout=null;this.isRefreshing=!1;this.settings=n,this.dataProvider=s,this.refreshCallback=()=>this.debouncedRefresh()}debouncedRefresh(){this.isRefreshing||(this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(async()=>{await this.refreshEvents()},1e3))}getViewType(){return Fc}getDisplayText(){return"Zero Friction \uCE98\uB9B0\uB354"}getIcon(){return"calendar"}async onOpen(){this.dataProvider.addChangeListener(this.refreshCallback);let t=this.contentEl;t.empty(),t.addClass("zfb-full-calendar");let n=t.createDiv({cls:"calendar-container"});n.style.height="100%",n.style.padding="16px",this.calendar=new xf(n,this.getCalendarOptions()),this.calendar.render()}getCalendarOptions(){return{plugins:[tP,lP,dP,pP],initialView:this.getInitialView(),locale:"ko",firstDay:this.settings.calendarFirstDayOfWeek,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},buttonText:{today:"\uC624\uB298",month:"\uC6D4",week:"\uC8FC",day:"\uC77C",list:"\uBAA9\uB85D"},events:async(t,n)=>{let s=await this.loadEvents();n(s)},editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,eventOrder:(t,n)=>{var a,l,c,d;let s={schedule:0,note:1,meeting:2},r=((a=t.extendedProps)==null?void 0:a.type)||"note",o=((l=n.extendedProps)==null?void 0:l.type)||"note";return((c=s[r])!=null?c:2)-((d=s[o])!=null?d:2)},eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},eventClick:t=>{this.handleEventClick(t)},eventDrop:async t=>{await this.handleEventDrop(t)},select:t=>{this.handleDateSelect(t)},eventDidMount:t=>{let n=t.event,s=n.extendedProps;s!=null&&s.project&&(t.el.title=`${n.title}
\uD504\uB85C\uC81D\uD2B8: ${s.project}`)}}}async onClose(){this.refreshTimeout&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=null),this.dataProvider.removeChangeListener(this.refreshCallback),this.calendar&&(this.calendar.destroy(),this.calendar=null),this.contentEl.empty()}updateSettings(t){this.settings=t,this.calendar&&this.calendar.setOption("firstDay",t.calendarFirstDayOfWeek)}async refreshEvents(){if(!(!this.calendar||this.isRefreshing)){this.isRefreshing=!0;try{let t=this.calendar.view.type,n=this.calendar.getDate(),s=this.contentEl.querySelector(".calendar-container");if(!s)return;this.calendar.destroy(),this.calendar=new xf(s,this.getCalendarOptions()),this.calendar.render(),this.calendar.changeView(t,n)}finally{this.isRefreshing=!1}}}getInitialView(){switch(this.settings.calendarDefaultView){case"month":return"dayGridMonth";case"week":return"timeGridWeek";case"day":return"timeGridDay";case"list":return"listWeek";default:return"dayGridMonth"}}async loadEvents(){let t=new Date,n=new Date(t.getFullYear(),t.getMonth()-3,1),s=new Date(t.getFullYear(),t.getMonth()+3,0);return(await this.dataProvider.getEventsForRange(n,s)).map(o=>this.convertToFullCalendarEvent(o))}convertToFullCalendarEvent(t){return{id:t.id,title:t.title,start:t.start,end:t.end,allDay:t.allDay,backgroundColor:t.color,borderColor:t.color,extendedProps:{type:t.type,source:t.source,...t.metadata}}}handleEventClick(t){let n=t.event.id,s=t.event.extendedProps,r={id:n,title:t.event.title,start:t.event.start,end:t.event.end||void 0,allDay:t.event.allDay,type:s.type,color:t.event.backgroundColor||void 0,source:s.source,metadata:{project:s.project,tags:s.tags,summary:s.summary}},o=new Mf(this.app,r,this.dataProvider,this.settings);o.onSave(async()=>{await this.refreshEvents()}),o.open()}async handleEventDrop(t){let n=t.event.id,s=t.event.start;await this.dataProvider.moveEvent(n,s)||t.revert()}handleDateSelect(t){var r;(r=this.calendar)==null||r.unselect();let n=t.startStr.split("T")[0];new Zo(this.app,n,this.dataProvider,this.settings).open()}};function Nf(i,e=100){return i.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,e)}var Qv=class extends M.Plugin{constructor(){super(...arguments);this.gemini=null;this.ocrProcessor=null;this.relatedNoteFinder=null;this.mocManager=null;this.zkIndexManager=null;this.youtubeExtractor=null;this.webPageExtractor=null;this.reviewManager=null;this.meetingProcessor=null;this.scheduleManager=null;this.googleCalendar=null;this.calendarDataProvider=null;this.feedbackManager=null;this.embeddingManager=null;this.watcherRegistered=!1;this.pendingFiles=new Map;this.zkDailyCounter=new Map;this.zkLuhmannCounter=0}async onload(){await this.loadSettings(),this.addSettingTab(new Hf(this.app,this)),this.processDebounced=(0,M.debounce)(()=>this.processPendingFiles(),3e3,!0),this.feedbackManager=new Yy(this.app,this.manifest.dir),await this.feedbackManager.load(),this.calendarDataProvider=new Vh(this.app,this.settings),this.registerCalendarViews(),this.registerCommands(),this.settings.autoWatch&&this.startWatcher(),this.app.workspace.onLayoutReady(()=>{this.initGemini()}),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uB85C\uB4DC\uB428")}onunload(){this.stopWatcher(),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uC5B8\uB85C\uB4DC\uB428")}async loadSettings(){this.settings=Object.assign({},uC,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.initGemini()}async initGemini(){this.settings.geminiApiKey?(this.gemini=new xp(this.settings.geminiApiKey),this.ocrProcessor=new ky(this.gemini,this.settings,this.app.vault),this.relatedNoteFinder=new Ny(this.app,this.gemini,this.settings),this.embeddingManager=new Ly(this.app,this.gemini,this.settings),await this.embeddingManager.loadIndex(),this.relatedNoteFinder.setEmbeddingManager(this.embeddingManager),this.mocManager=new Oy(this.app,this.gemini,this.settings.projectsFolder,this.settings),this.zkIndexManager=new Uy(this.app,this.relatedNoteFinder,this.settings.zettelFolder,this.settings,this.gemini),this.youtubeExtractor=new $y(this.gemini,this.settings),this.webPageExtractor=new zy(this.gemini,this.settings),this.reviewManager=new Hy(this.app,this.gemini,this.settings),this.meetingProcessor=new By(this.app,this.gemini,this.settings),this.scheduleManager=new Vy(this.app,this.settings),this.googleCalendar=new Hh(this.app,this.settings,()=>this.saveSettings()),Promise.all([this.relatedNoteFinder.buildIndex(),this.mocManager.scanProjectMOCs()]).then(()=>{var t,n,s;console.log(`\uB178\uD2B8 \uC778\uB371\uC2A4: ${(t=this.relatedNoteFinder)==null?void 0:t.getIndexSize()}\uAC1C, MOC: ${(n=this.mocManager)==null?void 0:n.getMOCCount()}\uAC1C, ZK: ${(s=this.relatedNoteFinder)==null?void 0:s.getZettelCount()}\uAC1C`),this.initializeZKCounters()})):(this.gemini=null,this.ocrProcessor=null,this.relatedNoteFinder=null,this.embeddingManager=null,this.mocManager=null,this.youtubeExtractor=null,this.webPageExtractor=null,this.reviewManager=null,this.scheduleManager=null,this.googleCalendar=null)}checkApiKey(){return this.gemini?!0:(new M.Notice("Gemini API \uD0A4\uB97C \uC124\uC815\uD574\uC8FC\uC138\uC694"),!1)}truncateContent(t,n=5e5){let s=t.replace(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g,"[\uC774\uBBF8\uC9C0]");return s=s.replace(/!\[[^\]]*\]\(data:[^)]+\)/g,"[\uC774\uBBF8\uC9C0]"),s.length<=n?s:s.slice(0,n)+`

[... \uB0B4\uC6A9\uC774 \uB108\uBB34 \uAE38\uC5B4 \uC77C\uBD80\uB9CC \uBD84\uC11D\uB428 ...]`}registerCommands(){this.addCommand({id:"project-classify",name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkeys:[{modifiers:["Ctrl","Shift"],key:"g"}],callback:()=>this.classifyCurrentFile()}),this.addCommand({id:"zk-extract",name:"ZK \uCD94\uCD9C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"z"}],callback:()=>this.extractZKFromCurrentFile()}),this.addCommand({id:"focus-top3",name:"Focus Top 3",hotkeys:[{modifiers:["Ctrl","Shift"],key:";"}],callback:()=>this.showFocusTop3()}),this.addCommand({id:"process-inbox",name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",callback:()=>this.processInbox()}),this.addCommand({id:"toggle-watch",name:"Watch \uD1A0\uAE00",callback:()=>this.toggleWatch()}),this.addCommand({id:"ocr-extract",name:"OCR \uCD94\uCD9C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"o"}],callback:()=>this.ocrCurrentFile()}),this.addCommand({id:"ocr-inbox",name:"Inbox OCR \uCC98\uB9AC",callback:()=>this.processInboxOCR()}),this.addCommand({id:"smart-process",name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkeys:[{modifiers:["Ctrl","Shift"],key:"s"}],callback:()=>this.smartProcessCurrentFile()}),this.addCommand({id:"create-moc",name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",callback:()=>this.showCreateMOCModal()}),this.addCommand({id:"url-import",name:"URL \uAC00\uC838\uC624\uAE30",hotkeys:[{modifiers:["Ctrl","Shift"],key:"u"}],callback:()=>this.showURLImportModal()}),this.addCommand({id:"rebuild-zk-index",name:"ZK Index \uC7AC\uAD6C\uCD95",callback:()=>this.rebuildZKIndex()}),this.addCommand({id:"smart-split",name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkeys:[{modifiers:["Ctrl","Shift"],key:"d"}],callback:()=>this.smartSplitCurrentFile()}),this.addCommand({id:"link-related-notes",name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkeys:[{modifiers:["Ctrl","Shift"],key:"l"}],callback:()=>this.linkRelatedNotesForCurrentFile()}),this.addCommand({id:"review-mode",name:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC",hotkeys:[{modifiers:["Ctrl","Shift"],key:"r"}],callback:()=>this.showReviewModal()}),this.addCommand({id:"show-command-list",name:"\uBA85\uB839 \uB9AC\uC2A4\uD2B8",callback:()=>this.showCommandListModal()}),this.addCommand({id:"open-calendar",name:"\uCE98\uB9B0\uB354 \uBDF0",hotkeys:[{modifiers:["Ctrl","Shift"],key:"c"}],callback:()=>this.openCalendarView()}),this.addRibbonIcon("brain","Zero Friction Brain",()=>{this.showCommandListModal()}),this.settings.calendarEnabled&&this.addRibbonIcon("calendar","\uCE98\uB9B0\uB354 \uBDF0",()=>{this.openCalendarView()})}registerCalendarViews(){this.registerView(Fc,t=>new kf(t,this.settings,this.calendarDataProvider)),this.registerView(vc,t=>new Gh(t,this.settings,this.calendarDataProvider))}async openCalendarView(){let t=this.app.workspace.getLeavesOfType(Fc);t.length>0?this.app.workspace.revealLeaf(t[0]):await this.app.workspace.getLeaf("tab").setViewState({type:Fc,active:!0})}async toggleMiniCalendar(){let t=this.app.workspace.getLeavesOfType(vc);if(t.length>0)t[0].detach();else{let n=this.app.workspace.getRightLeaf(!1);n&&await n.setViewState({type:vc,active:!0})}}showReviewModal(){if(this.checkApiKey()){if(!this.reviewManager){new M.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new cC(this.app,this.reviewManager,this.settings).open()}}async connectGoogleCalendar(){this.googleCalendar||(this.googleCalendar=new Hh(this.app,this.settings,()=>this.saveSettings())),await this.googleCalendar.startOAuth()}async disconnectGoogleCalendar(){this.googleCalendar&&await this.googleCalendar.disconnect()}async detectAndSaveSchedules(t,n){if(this.settings.scheduleDetectionEnabled&&!(!this.gemini||!this.scheduleManager))try{let s=Yn(this.settings.timezone),r=await this.gemini.detectSchedules(t,s);if(r.length===0)return;let a=await new qy(this.app,r,this.settings,h=>{var p;this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"schedule_detection",noteTitle:(n==null?void 0:n.basename)||"Unknown",aiSuggestion:{schedules:h.allSchedules},userChoice:{accepted:h.accepted,rejectedItems:(p=h.rejectedSchedules)==null?void 0:p.map(m=>m.title),dismissed:h.dismissed}})}).openAndWait();if(!a||a.selectedSchedules.length===0)return;let l=0,c=0;if(a.saveToDaily&&(l=await this.scheduleManager.saveToDaily(a.selectedSchedules)),a.saveToGoogle&&this.googleCalendar&&this.googleCalendar.isConnected()&&(c=await this.googleCalendar.saveSchedules(a.selectedSchedules)),a.moveToArchives&&n){let h=`${this.settings.archivesFolder}/${n.name}`;await this.app.fileManager.renameFile(n,h),new M.Notice("\uC6D0\uBCF8 \uB178\uD2B8\uAC00 Archives\uB85C \uC774\uB3D9\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}let d=[];l>0&&d.push(`Daily Notes: ${l}\uAC1C`),c>0&&d.push(`Google Calendar: ${c}\uAC1C`),d.length>0&&new M.Notice(`\uC77C\uC815 \uC800\uC7A5\uB428
${d.join(", ")}`)}catch(s){console.error("\uC77C\uC815 \uAC10\uC9C0 \uC2E4\uD328:",s)}}async rebuildZKIndex(){var t;if(!this.zkIndexManager){new M.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new M.Notice("ZK Index \uC7AC\uAD6C\uCD95 \uC911...");try{await this.zkIndexManager.rebuildIndex();let n=((t=this.relatedNoteFinder)==null?void 0:t.getZettelCount())||0;new M.Notice(`ZK Index \uC7AC\uAD6C\uCD95 \uC644\uB8CC: ${n}\uAC1C \uB178\uD2B8`)}catch(n){console.error("ZK Index \uC7AC\uAD6C\uCD95 \uC2E4\uD328:",n),new M.Notice(`\uC7AC\uAD6C\uCD95 \uC2E4\uD328: ${n}`)}}async smartSplitCurrentFile(){var n;if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new M.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(t.extension!=="md"){new M.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uBD84\uB9AC\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4");return}new M.Notice("\uBA54\uBAA8 \uBD84\uC11D \uC911...");try{let s=await this.app.vault.read(t),r=((n=this.mocManager)==null?void 0:n.getProjectList())||[],o=await this.gemini.splitContent(s,r);if(o.length===0){new M.Notice("\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(o.length===1){new M.Notice("\uB2E8\uC77C \uC8FC\uC81C\uB85C \uD310\uB2E8\uB428. \uC77C\uBC18 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958\uB97C \uC0AC\uC6A9\uD558\uC138\uC694.");return}new oC(this.app,o,t,this).open()}catch(s){console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC2E4\uD328:",s),new M.Notice(`\uBD84\uB9AC \uC2E4\uD328: ${s}`)}}async createSplitNotes(t,n){let s=[];for(let o of t){let a=this.getTargetFolder(o.targetType,o.project);if(o.project&&!o.project.startsWith("NEW:")){let p=`${this.settings.projectsFolder}/${o.project}`;this.app.vault.getAbstractFileByPath(p)instanceof M.TFolder&&(a=p)}let l=Nf(o.title),c=`${a}/${l}.md`,d=`---
targetType: ${o.targetType}
keywords: [${o.keywords.join(", ")}]
source: "[[${n.basename}]]"
created: ${Oe(this.settings.timezone,this.settings.dateFormat)}
${o.project?`project: "${o.project}"`:""}
---

# ${o.title}

${o.content}
`;this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a);try{let p=await this.app.vault.create(c,d);if(s.push(o.title),this.relatedNoteFinder&&await this.relatedNoteFinder.updateIndex(p),o.project&&this.mocManager)if(o.project.startsWith("NEW:")){let m=o.project.slice(4).trim();await this.mocManager.createProjectMOC(m,this.settings.projectsFolder)&&await this.mocManager.addNoteToMOC(m,o.title,p.path)}else await this.mocManager.addNoteToMOC(o.project,o.title,p.path)}catch(p){console.error(`\uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328: ${o.title}`,p)}}let r=`${this.settings.archivesFolder}/${n.name}`;try{this.app.vault.getAbstractFileByPath(this.settings.archivesFolder)||await this.app.vault.createFolder(this.settings.archivesFolder),await this.app.fileManager.renameFile(n,r)}catch(o){console.error("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uC2E4\uD328:",o)}new M.Notice(`${s.length}\uAC1C \uB178\uD2B8 \uC0DD\uC131\uB428, \uC6D0\uBCF8\uC740 Archives\uB85C \uC774\uB3D9`)}showCreateMOCModal(){new sC(this.app,this.mocManager,this.settings.projectsFolder).open()}showURLImportModal(){this.checkApiKey()&&new rC(this.app,"URL \uAC00\uC838\uC624\uAE30","\uC720\uD29C\uBE0C \uB610\uB294 \uC6F9\uD398\uC774\uC9C0 URL\uC744 \uC785\uB825\uD558\uC138\uC694 (\uC790\uB3D9 \uAC10\uC9C0)","https://...",async t=>{await this.processURL(t)}).open()}async processURL(t){/(?:youtube\.com|youtu\.be)/.test(t)?await this.processYouTube(t):await this.processWebPage(t)}async processYouTube(t){var n,s;if(!(!this.youtubeExtractor||!this.gemini)){new M.Notice("\uC720\uD29C\uBE0C \uC601\uC0C1 \uBD84\uC11D \uC911...");try{let r=await this.youtubeExtractor.processVideo(t),o=this.youtubeExtractor.generateMarkdownNote(r),a=Nf(r.title),l=`${a}.md`,c=`${this.settings.inboxFolder}/${l}`,d=await this.app.vault.create(c,o);new M.Notice(`\uC720\uD29C\uBE0C \uB178\uD2B8 \uC0DD\uC131: ${a}`);let h=((n=this.mocManager)==null?void 0:n.getProjectList())||[],p=(s=this.feedbackManager)==null?void 0:s.generatePromptContext(),m=await this.gemini.classifyProject(o,h,p);d=await this.applyClassifyResultWithConfirmation(d,m),new M.Notice(`${m.targetType}${m.projectName?` (${m.projectName})`:""}\uB85C \uBD84\uB958\uB428`),this.app.workspace.getLeaf().openFile(d),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(d,o,m.title)}catch(r){console.error("\uC720\uD29C\uBE0C \uCC98\uB9AC \uC624\uB958:",r),new M.Notice(`\uC720\uD29C\uBE0C \uCC98\uB9AC \uC2E4\uD328: ${r}`)}}}async processWebPage(t){var n,s;if(!(!this.webPageExtractor||!this.gemini)){new M.Notice("\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38 \uCD94\uCD9C \uC911...");try{let r=await this.webPageExtractor.processUrl(t),o=this.webPageExtractor.generateMarkdownNote(r),a=Nf(r.title),l=`${a}.md`,c=`${this.settings.inboxFolder}/${l}`,d=await this.app.vault.create(c,o);new M.Notice(`\uC6F9\uD398\uC774\uC9C0 \uB178\uD2B8 \uC0DD\uC131: ${a}`);let h=((n=this.mocManager)==null?void 0:n.getProjectList())||[],p=(s=this.feedbackManager)==null?void 0:s.generatePromptContext(),m=await this.gemini.classifyProject(o,h,p);d=await this.applyClassifyResultWithConfirmation(d,m),new M.Notice(`${m.targetType}${m.projectName?` (${m.projectName})`:""}\uB85C \uBD84\uB958\uB428`),this.app.workspace.getLeaf().openFile(d),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(d,o,m.title)}catch(r){console.error("\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC624\uB958:",r),new M.Notice(`\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC2E4\uD328: ${r}`)}}}async classifyCurrentFile(){var r,o,a,l,c,d;if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new M.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase(),s=["pdf","png","jpg","jpeg","webp","gif"];if(qA.includes(n)){if(!this.meetingProcessor){new M.Notice("\uD68C\uC758\uB85D \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}new M.Notice("\uD68C\uC758\uB85D \uBD84\uC11D \uC911...");try{let h=await this.meetingProcessor.processAudio(t),p=this.meetingProcessor.generateMarkdownNote(h),m=`\uD68C\uC758\uB85D_${Nf(h.title)}.md`,y=`${this.settings.inboxFolder}/${m}`,v=await this.app.vault.create(y,p);if(this.settings.ocrMoveOriginal){let T=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(T)||await this.app.vault.createFolder(T);let I=`${T}/${t.name}`;await this.app.fileManager.renameFile(t,I)}let E=((r=this.mocManager)==null?void 0:r.getProjectList())||[],A=(o=this.feedbackManager)==null?void 0:o.generatePromptContext(),_=await this.gemini.classifyProject(p,E,A),C=await this.applyClassifyResultWithConfirmation(v,_);new M.Notice(`\uD68C\uC758\uB85D \uC0DD\uC131 \uC644\uB8CC: ${_.targetType}${_.projectName?` (${_.projectName})`:""}`),await this.findAndShowRelatedNotes(C,p,h.title),await this.detectAndSaveSchedules(p,C)}catch(h){console.error("\uD68C\uC758\uB85D \uBD84\uC11D \uC624\uB958:",h),new M.Notice(`\uD68C\uC758\uB85D \uBD84\uC11D \uC2E4\uD328: ${h}`)}return}if(s.includes(n)){if(!this.settings.ocrEnabled){new M.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new M.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let h=await this.ocrProcessor.checkLimits(t);if(!h.allowed){new Ff(this.app,h.reason,t,this).open();return}new M.Notice("\uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let p=await this.ocrProcessor.processFile(t);new M.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let m=await this.gemini.summarizePDF(p.text),y=this.ocrProcessor.generateSummarizedNote(p,m),v=t.basename+"_OCR.md",E=`${this.settings.inboxFolder}/${v}`,A=await this.app.vault.create(E,y);if(this.settings.ocrMoveOriginal){let I=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(I)||await this.app.vault.createFolder(I);let k=`${I}/${t.name}`;await this.app.fileManager.renameFile(t,k)}let _=((a=this.mocManager)==null?void 0:a.getProjectList())||[],C=(l=this.feedbackManager)==null?void 0:l.generatePromptContext(),T=await this.gemini.classifyProject(y,_,C),R=await this.applyClassifyResultWithConfirmation(A,T);new M.Notice(`\uC644\uB8CC: OCR(${p.pages}p) \u2192 ${T.targetType}${T.projectName?` (${T.projectName})`:""}`),await this.findAndShowRelatedNotes(R,y,T.title),await this.detectAndSaveSchedules(y,R)}catch(p){console.error("\uCC98\uB9AC \uC624\uB958:",p),new M.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${p}`)}return}if(n==="md"){new M.Notice("\uBD84\uB958 \uC911...");try{let h=await this.app.vault.read(t),p=this.truncateContent(h),m=((c=this.mocManager)==null?void 0:c.getProjectList())||[],y=(d=this.feedbackManager)==null?void 0:d.generatePromptContext(),v=await this.gemini.classifyProject(p,m,y),E=await this.applyClassifyResultWithConfirmation(t,v);new M.Notice(`${v.targetType}${v.projectName?` (${v.projectName})`:""}\uB85C \uBD84\uB958\uB428`),await this.findAndShowRelatedNotes(E,h,v.title),await this.detectAndSaveSchedules(h,E)}catch(h){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",h),new M.Notice(`\uBD84\uB958 \uC2E4\uD328: ${h}`)}return}new M.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}async linkRelatedNotesForCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new M.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(t.extension!=="md"){new M.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uC9C0\uC6D0\uD569\uB2C8\uB2E4");return}new M.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");try{let n=await this.app.vault.read(t),s=this.truncateContent(n),r=n.match(/^#\s+(.+)$/m),o=(r==null?void 0:r[1])||t.basename;await this.findAndShowRelatedNotes(t,s,o)}catch(n){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",n),new M.Notice(`\uAC80\uC0C9 \uC2E4\uD328: ${n}`)}}showCommandListModal(){new lC(this.app,this).open()}async applyClassifyResult(t,n){let s=await this.app.vault.read(t),r=this.updateFrontmatter(s,{targetType:n.targetType,project:n.projectName||void 0,title:n.title,summary:n.summary,next_action:n.nextAction||void 0,processed_at:Oe(this.settings.timezone,this.settings.dateFormat)});await this.app.vault.modify(t,r);let o=this.getTargetFolder(n.targetType,n.projectName);if(o){this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o);let l=`${o}/${t.name}`;await this.app.fileManager.renameFile(t,l);let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof M.TFile)return c}return t}async applyClassifyResultWithConfirmation(t,n){var r,o;if(n.shouldRestructure&&n.restructuredContent){let a=(r=this.feedbackManager)==null?void 0:r.getPreferences();if(a){let l=a.restructure,c=l.accepted+l.rejected;if(l.preference==="restructure"&&l.accepted>=Bh)new M.Notice(`\u2728 \uCF58\uD150\uCE20 \uC790\uB3D9 \uC7AC\uAD6C\uC131 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${l.accepted}/${c}\uD68C)`),await this.applyRestructuredContent(t,n.restructuredContent);else if(l.preference==="original"&&l.rejected>=Bh)new M.Notice(`\u{1F4C4} \uC6D0\uBCF8 \uC720\uC9C0 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${l.rejected}/${c}\uD68C)`);else{let d=await this.app.vault.read(t);await this.showRestructureModal(t,n,d)&&await this.applyRestructuredContent(t,n.restructuredContent)}}else{let l=await this.app.vault.read(t);await this.showRestructureModal(t,n,l)&&await this.applyRestructuredContent(t,n.restructuredContent)}}if(n.contentType!=="reference"||!n.projectName)return this.applyClassifyResult(t,n);let s=(o=this.feedbackManager)==null?void 0:o.getPreferences();if(s){let a=s.feedback.referenceLocation,l=a.toLibrary+a.toProject;if(a.preference==="library"&&a.toLibrary>=Bh){new M.Notice(`\u{1F4DA} Library\uC5D0 \uC790\uB3D9 \uC800\uC7A5 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${a.toLibrary}/${l}\uD68C)`);let c={...n,targetType:"library"};return this.applyClassifyResult(t,c)}if(a.preference==="project"&&a.toProject>=Bh){new M.Notice(`\u{1F4C1} \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC790\uB3D9 \uC800\uC7A5 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${a.toProject}/${l}\uD68C)`);let c={...n,targetType:"project"};return this.applyClassifyResult(t,c)}}return new Promise(a=>{new aC(this.app,n,async l=>{let c={...n};l==="library"?(c={...n,targetType:"library"},new M.Notice(`Library\uC5D0 \uC800\uC7A5 + ${n.projectName} \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C`)):c={...n,targetType:"project"};let d=await this.applyClassifyResult(t,c);a(d)},this.feedbackManager).open()})}showRestructureModal(t,n,s){return new Promise(r=>{new Wy(this.app,n,s,o=>{r(o)},this.feedbackManager).open()})}async applyRestructuredContent(t,n){let r=(await this.app.vault.read(t)).match(/^---\n([\s\S]*?)\n---\n?/),a=(r?r[0]:"")+n;await this.app.vault.modify(t,a)}async findAndShowRelatedNotes(t,n,s){if(!this.relatedNoteFinder||!this.gemini)return;let r=this.truncateContent(n);try{let o=await this.gemini.extractKeywords(r);o.length>0&&this.relatedNoteFinder&&await this.relatedNoteFinder.saveKeywordsToNote(t,o),this.mocManager&&this.mocManager.getMOCCount()>0&&await this.handleProjectMOC(t,s,o),new M.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");let a=await this.relatedNoteFinder.findRelated(r,s,t.path);a.length>0?new nC(this.app,a,t,this.relatedNoteFinder,this.feedbackManager).open():o.length>0&&new M.Notice(`\uD0A4\uC6CC\uB4DC ${o.length}\uAC1C \uC800\uC7A5\uB428`)}catch(o){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",o)}}async handleProjectMOC(t,n,s){if(!(!this.mocManager||!this.gemini))try{let r=await this.mocManager.detectProject(n,s);if(!r)return;if(r.startsWith("NEW:")){let a=r.slice(4).trim();new iC(this.app,a,t,n,this.mocManager,this.settings.projectsFolder).open();return}await this.mocManager.addNoteToMOC(r,n,t.path)&&new M.Notice(`\u{1F4C1} ${r} MOC\uC5D0 \uC5F0\uACB0\uB428`)}catch(r){console.error("MOC \uC5F0\uACB0 \uC624\uB958:",r)}}getTargetFolder(t,n){switch(t){case"project":return n?`${this.settings.projectsFolder}/${n}`:this.settings.projectsFolder;case"library":return this.settings.libraryFolder;case"archive":return this.settings.archivesFolder;default:return this.settings.libraryFolder}}updateFrontmatter(t,n){let s=/^---\n([\s\S]*?)\n---\n?/,r=t.match(s),o="",a=t;r&&(o=r[1],a=t.slice(r[0].length));let l=o.split(`
`).filter(h=>h.trim()),c=new Map;for(let h of l){let p=h.indexOf(":");if(p!==-1){let m=h.slice(0,p).trim(),y=h.slice(p+1).trim();c.set(m,y)}}for(let[h,p]of Object.entries(n))if(p!==void 0){let y=/[:\[\]{}#&*!|>'"%@`]/.test(p)&&!p.startsWith('"')?`"${p.replace(/"/g,'\\"')}"`:p;c.set(h,y)}return`---
${Array.from(c.entries()).map(([h,p])=>`${h}: ${p}`).join(`
`)}
---
${a}`}async extractZKFromCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new M.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new M.Notice("ZK \uC544\uC774\uB514\uC5B4 \uCD94\uCD9C \uC911...");try{let n=await this.app.vault.read(t),s=await this.gemini.extractZK(n);if(s.length===0){new M.Notice("\uCD94\uCD9C\uD560 \uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new Q_(this.app,s,t,this).open()}catch(n){console.error("ZK \uCD94\uCD9C \uC624\uB958:",n),new M.Notice(`\uCD94\uCD9C \uC2E4\uD328: ${n}`)}}initializeZKCounters(){if(!this.relatedNoteFinder)return;let t=this.relatedNoteFinder.getZettelIndex();for(let[n]of t){let r=(n.split("/").pop()||"").match(/^(\d{8})-(\d{3})/);if(r){let o=r[1],a=parseInt(r[2],10),l=this.zkDailyCounter.get(o)||0;a>l&&this.zkDailyCounter.set(o,a)}this.zkLuhmannCounter=Math.max(this.zkLuhmannCounter,t.size)}console.log(`ZK \uCE74\uC6B4\uD130 \uCD08\uAE30\uD654: \uB8E8\uB9CC=${this.zkLuhmannCounter}, \uC77C\uBCC4=${this.zkDailyCounter.size}\uAC1C \uB0A0\uC9DC`)}generateZKId(){switch(this.settings.zkIdType){case"timestamp":return Date.now().toString();case"date-sequence":{let n=Yn(this.settings.timezone).replace(/-/g,""),s=(this.zkDailyCounter.get(n)||0)+1;return this.zkDailyCounter.set(n,s),`${n}-${s.toString().padStart(3,"0")}`}case"luhmann":return this.zkLuhmannCounter++,this.toLuhmannId(this.zkLuhmannCounter);default:return Date.now().toString()}}toLuhmannId(t){if(t<=0)return"1";let n=[],s=t,r=0;for(;s>0;){if(r%2===0){let o=(s-1)%9+1;n.push(o.toString()),s=Math.floor((s-1)/9)}else{let o=(s-1)%26;n.push(String.fromCharCode(97+o)),s=Math.floor((s-1)/26)}r++}return n.reverse().join("")}async createZKNotes(t,n){var d;let s=this.settings.zettelFolder;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s);let o=[],a=[],l=0;for(let h of t){let m=(await this.relatedNoteFinder.findRelatedZettels(h.keywords)).find(C=>C.relevance>=this.settings.zkMergeThreshold);if(m&&await this.showMergeConfirmModal(h,m)){await this.mergeToExistingZK(m.note.path,h,n),a.push(h.title);continue}let y=this.generateZKId(),v=Nf(h.title),E=`${s}/${y} ${v}.md`,A=`---
type: zettel
source: "[[${n.basename}]]"
keywords: [${h.keywords.join(", ")}]
created: ${Oe(this.settings.timezone,this.settings.dateFormat)}
---

# ${h.title}

## \uD575\uC2EC \uC544\uC774\uB514\uC5B4
${h.body}

## \uC65C \uC911\uC694\uD55C\uAC00?
${h.importance||""}

## \uB9E5\uB77D
- **\uC6D0\uBCF8**: [[${n.basename}]]
- **\uAD00\uB828 \uAC1C\uB150**: ${((d=h.relatedConcepts)==null?void 0:d.join(", "))||""}

---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
- [[${n.basename}]] (\uC6D0\uBCF8)
`;await this.app.vault.create(E,A),o.push(h.title);let _=this.app.vault.getAbstractFileByPath(E);if(_ instanceof M.TFile){await this.relatedNoteFinder.updateIndex(_);let C=await this.relatedNoteFinder.findRelatedZettels(h.keywords,E);C.length>0&&(await this.addZKRelatedLinks(_,C),await this.addBacklinksToZettels(_,C),l+=C.length),this.zkIndexManager&&await this.zkIndexManager.updateIndex(_,h.keywords)}await new Promise(C=>setTimeout(C,10))}let c=[];o.length>0&&c.push(`${o.length}\uAC1C \uC0DD\uC131`),a.length>0&&c.push(`${a.length}\uAC1C \uBCD1\uD569`),l>0&&c.push(`${l}\uAC1C \uC5F0\uACB0`),new M.Notice(`ZK \uB178\uD2B8: ${c.join(", ")}`)}showMergeConfirmModal(t,n){return new Promise(s=>{new eC(this.app,t,n,o=>s(o)).open()})}async mergeToExistingZK(t,n,s){let r=this.app.vault.getAbstractFileByPath(t);if(!(r instanceof M.TFile))return;let o=await this.app.vault.read(r),a=`

---
## \uCD94\uAC00\uB41C \uB0B4\uC6A9 (${new Date().toLocaleDateString()})
*\uC6D0\uBCF8: [[${s.basename}]]*

${n.body}
`,l=/(\n---\n##  )/,c;l.test(o)?c=o.replace(l,`${a}$1`):c=o+a;let d=this.extractKeywordsFromFrontmatter(o),h=[...new Set([...d,...n.keywords])];c=this.updateFrontmatterKeywordsInContent(c,h),await this.app.vault.modify(r,c),await this.relatedNoteFinder.updateIndex(r)}extractKeywordsFromFrontmatter(t){let n=t.match(/^---\n[\s\S]*?keywords:\s*\[(.*?)\][\s\S]*?---/);return n?n[1].split(",").map(s=>s.trim().replace(/^["']|["']$/g,"")).filter(s=>s.length>0):[]}updateFrontmatterKeywordsInContent(t,n){let s=`keywords: [${n.join(", ")}]`;return t.replace(/^(---\n[\s\S]*?)(keywords:\s*\[.*?\])([\s\S]*?---)/,`$1${s}$3`)}async addZKRelatedLinks(t,n){if(n.length===0)return;let s=await this.app.vault.read(t),r=n.map(c=>{let d=c.note.path.split("/"),p=d[d.length-1].replace(/\.md$/,""),m=c.reason?`
  \u2192 ${c.reason}`:"";return`- [[${p}]] (${Math.round(c.relevance*100)}%)${m}`}).join(`
`),o=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,a=s.match(o),l;a?l=s.replace(o,`$1
${r}$2`):l=s+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${r}
`,await this.app.vault.modify(t,l)}async addBacklinksToZettels(t,n){for(let s of n){let r=this.app.vault.getAbstractFileByPath(s.note.path);if(!(r instanceof M.TFile))continue;let o=await this.app.vault.read(r);if(o.includes(`[[${t.basename}]]`))continue;let a=s.reason?`
  \u2192 ${s.reason}`:"",l=`- [[${t.basename}]] (${Math.round(s.relevance*100)}%)${a}`,c=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,d=o.match(c),h;d?h=o.replace(c,`$1
${l}$2`):h=o+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${l}
`,await this.app.vault.modify(r,h)}}async showFocusTop3(){if(this.checkApiKey()){new M.Notice("\uD504\uB85C\uC81D\uD2B8 \uBD84\uC11D \uC911...");try{let t=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(!t||!(t instanceof M.TFolder)){new M.Notice("Projects \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=await this.collectProjectsSummary(t);if(!n){new M.Notice("\uC9C4\uD589 \uC911\uC778 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let s=await this.gemini.getFocus(n);if(s.length===0){new M.Notice("\uCD94\uCC9C\uD560 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new tC(this.app,s).open()}catch(t){console.error("Focus \uBD84\uC11D \uC624\uB958:",t),new M.Notice(`\uBD84\uC11D \uC2E4\uD328: ${t}`)}}}async collectProjectsSummary(t){let n=[];for(let s of t.children)if(s instanceof M.TFile&&s.extension==="md"){let r=await this.app.vault.read(s),o=this.extractFrontmatter(r),a=o.title||s.basename,l=o.summary||"",c=o.next_action||"";n.push(`- ${a}: ${l} (\uB2E4\uC74C: ${c})`)}return n.join(`
`)}extractFrontmatter(t){let n=/^---\n([\s\S]*?)\n---/,s=t.match(n);if(!s)return{};let r={},o=s[1].split(`
`);for(let a of o){let l=a.indexOf(":");if(l!==-1){let c=a.slice(0,l).trim(),d=a.slice(l+1).trim();r[c]=d}}return r}async processInbox(){var c,d;if(!this.checkApiKey())return;let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof M.TFolder)){new M.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=0,s=0,r=this.settings.triggerTag,o=[];for(let h of t.children)h instanceof M.TFile&&h.extension==="md"&&(await this.app.vault.read(h)).includes(r)&&o.push(h);if(o.length===0){new M.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new M.Notice(`${o.length}\uAC1C \uD30C\uC77C \uCC98\uB9AC \uC2DC\uC791...`);let a=((c=this.mocManager)==null?void 0:c.getProjectList())||[],l=(d=this.feedbackManager)==null?void 0:d.generatePromptContext();for(let h=0;h<o.length;h++){let p=o[h];try{new M.Notice(`\uCC98\uB9AC \uC911: ${h+1}/${o.length} - ${p.name}`,2e3);let m=await this.app.vault.read(p),y=await this.gemini.classifyProject(m,a,l);await this.applyClassifyResult(p,y),n++}catch(m){console.error(`\uCC98\uB9AC \uC2E4\uD328: ${p.name}`,m),s++}}new M.Notice(`\uC644\uB8CC: ${n}\uAC1C \uCC98\uB9AC, ${s}\uAC1C \uC2E4\uD328`)}toggleWatch(){this.watcherRegistered?(this.stopWatcher(),new M.Notice("Watch \uC911\uC9C0\uB428")):(this.startWatcher(),new M.Notice("Watch \uC2DC\uC791\uB428"))}startWatcher(){this.watcherRegistered||(this.registerEvent(this.app.vault.on("create",t=>{t instanceof M.TFile&&this.onFileChange(t)})),this.registerEvent(this.app.vault.on("modify",t=>{t instanceof M.TFile&&this.onFileChange(t)})),this.registerEvent(this.app.vault.on("delete",t=>{var n,s;t instanceof M.TFile&&((n=this.relatedNoteFinder)==null||n.removeFromIndex(t.path),(s=this.mocManager)==null||s.removeFromIndex(t.path),console.log(`\uC778\uB371\uC2A4\uC5D0\uC11C \uC81C\uAC70: ${t.path}`))})),this.watcherRegistered=!0,console.log("Inbox \uAC10\uC2DC \uC2DC\uC791"))}stopWatcher(){this.watcherRegistered=!1,this.pendingFiles.clear(),console.log("Inbox \uAC10\uC2DC \uC911\uC9C0")}onFileChange(t){this.watcherRegistered&&this.gemini&&t.path.startsWith(this.settings.inboxFolder)&&t.extension==="md"&&(this.pendingFiles.set(t.path,Date.now()),this.processDebounced())}async processPendingFiles(){var o,a;if(!this.gemini)return;let t=Date.now(),n=this.settings.triggerTag,s=((o=this.mocManager)==null?void 0:o.getProjectList())||[],r=(a=this.feedbackManager)==null?void 0:a.generatePromptContext();for(let[l,c]of this.pendingFiles.entries()){if(t-c<3e3)continue;this.pendingFiles.delete(l);let d=this.app.vault.getAbstractFileByPath(l);if(d instanceof M.TFile)try{let h=await this.app.vault.read(d);if(!h.includes(n))continue;let p=await this.gemini.classifyProject(h,s,r);await this.applyClassifyResult(d,p),new M.Notice(`\uC790\uB3D9 \uBD84\uB958: ${d.name} \u2192 ${p.targetType}${p.projectName?` (${p.projectName})`:""}`)}catch(h){console.error(`\uC790\uB3D9 \uBD84\uB958 \uC2E4\uD328: ${l}`,h)}}}async ocrCurrentFile(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new M.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new M.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.workspace.getActiveFile();if(!t){new M.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase();if(!["png","jpg","jpeg","webp","gif","pdf"].includes(n)){new M.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`);return}let r=await this.ocrProcessor.checkLimits(t);if(!r.allowed){new Ff(this.app,r.reason,t,this).open();return}new M.Notice("OCR \uCC98\uB9AC \uC911...");try{let o=await this.ocrProcessor.processFile(t),a=this.ocrProcessor.generateMarkdownNote(o),l=t.basename+"_OCR.md",c=`${this.settings.inboxFolder}/${l}`;if(await this.app.vault.create(c,a),this.settings.ocrMoveOriginal){let d=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(d)||await this.app.vault.createFolder(d);let p=`${d}/${t.name}`;await this.app.fileManager.renameFile(t,p)}new M.Notice(`OCR \uC644\uB8CC: ${l} \uC0DD\uC131\uB428 (${o.pages}\uD398\uC774\uC9C0)`)}catch(o){console.error("OCR \uC624\uB958:",o),new M.Notice(`OCR \uC2E4\uD328: ${o}`)}}async processInboxOCR(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new M.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new M.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof M.TFolder)){new M.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=["png","jpg","jpeg","webp","gif","pdf"],s=[];for(let a of t.children){if(!(a instanceof M.TFile))continue;let l=a.extension.toLowerCase();if(!n.includes(l))continue;(await this.ocrProcessor.checkLimits(a)).allowed&&s.push(a)}if(s.length===0){new M.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new M.Notice(`${s.length}\uAC1C \uD30C\uC77C OCR \uCC98\uB9AC \uC2DC\uC791...`);let r=0,o=0;for(let a=0;a<s.length;a++){let l=s[a];try{new M.Notice(`OCR \uC911: ${a+1}/${s.length} - ${l.name}`,3e3);let c=await this.ocrProcessor.processFile(l),d=this.ocrProcessor.generateMarkdownNote(c),h=l.basename+"_OCR.md",p=`${this.settings.inboxFolder}/${h}`;if(await this.app.vault.create(p,d),this.settings.ocrMoveOriginal){let m=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(m)||await this.app.vault.createFolder(m);let v=`${m}/${l.name}`;await this.app.fileManager.renameFile(l,v)}r++,a<s.length-1&&await new Promise(m=>setTimeout(m,1e3))}catch(c){console.error(`OCR \uCC98\uB9AC \uC2E4\uD328: ${l.name}`,c),o++}}new M.Notice(`OCR \uC644\uB8CC: ${r}\uAC1C \uCC98\uB9AC, ${o}\uAC1C \uC2E4\uD328`)}async smartProcessCurrentFile(){var r,o,a,l;if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new M.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase();if(["pdf","png","jpg","jpeg","webp","gif"].includes(n)){if(!this.settings.ocrEnabled){new M.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new M.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let c=await this.ocrProcessor.checkLimits(t);if(!c.allowed){new Ff(this.app,c.reason,t,this).open();return}new M.Notice("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let d=await this.ocrProcessor.processFile(t);new M.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let h=await this.gemini.summarizePDF(d.text),p=this.ocrProcessor.generateSummarizedNote(d,h),m=t.basename+"_OCR.md",y=`${this.settings.inboxFolder}/${m}`,v=await this.app.vault.create(y,p);if(this.settings.ocrMoveOriginal){let C=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(C)||await this.app.vault.createFolder(C);let R=`${C}/${t.name}`;await this.app.fileManager.renameFile(t,R)}let E=((r=this.mocManager)==null?void 0:r.getProjectList())||[],A=(o=this.feedbackManager)==null?void 0:o.generatePromptContext(),_=await this.gemini.classifyProject(p,E,A);await this.applyClassifyResultWithConfirmation(v,_),new M.Notice(`\uC644\uB8CC: OCR(${d.pages}p) \u2192 ${_.targetType}${_.projectName?` (${_.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(d){console.error("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC624\uB958:",d),new M.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${d}`)}}else if(n==="md"){new M.Notice("\uBD84\uB958 \uC911...");try{let c=await this.app.vault.read(t),d=((a=this.mocManager)==null?void 0:a.getProjectList())||[],h=(l=this.feedbackManager)==null?void 0:l.generatePromptContext(),p=await this.gemini.classifyProject(c,d,h);await this.applyClassifyResultWithConfirmation(t,p),new M.Notice(`${p.targetType}${p.projectName?` (${p.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(c){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",c),new M.Notice(`\uBD84\uB958 \uC2E4\uD328: ${c}`)}}else new M.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}getOCRDailyUsage(){return this.ocrProcessor?this.ocrProcessor.getDailyUsage():{date:Yn(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}},Q_=class extends M.Modal{constructor(e,t,n,s){super(e),this.candidates=t,this.selected=new Set(t.map((r,o)=>o)),this.sourceFile=n,this.plugin=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"ZK \uC544\uC774\uB514\uC5B4 \uC120\uD0DD"}),e.createEl("p",{text:"\uC0DD\uC131\uD560 Zettelkasten \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let t=e.createDiv({cls:"zk-candidate-list"});this.candidates.forEach((o,a)=>{let l=t.createDiv({cls:"zk-candidate-item"}),c=l.createEl("input",{type:"checkbox",attr:{checked:!0}});c.addEventListener("change",()=>{c.checked?this.selected.add(a):this.selected.delete(a)});let d=l.createDiv({cls:"zk-candidate-label"});d.createEl("strong",{text:o.title}),d.createEl("p",{text:o.body,cls:"zk-candidate-body"}),d.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${o.keywords.join(", ")}`,cls:"zk-candidate-keywords"})});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{let o=this.candidates.filter((a,l)=>this.selected.has(l));o.length>0&&await this.plugin.createZKNotes(o,this.sourceFile),this.close()})}onClose(){this.contentEl.empty()}},eC=class extends M.Modal{constructor(e,t,n,s){super(e),this.candidate=t,this.similarNote=n,this.onResult=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC720\uC0AC\uD55C \uB178\uD2B8 \uBC1C\uACAC"}),e.createEl("p",{text:`\uC0C8 \uC544\uC774\uB514\uC5B4\uC640 ${Math.round(this.similarNote.relevance*100)}% \uC720\uC0AC\uD55C \uB178\uD2B8\uAC00 \uC788\uC2B5\uB2C8\uB2E4.`,cls:"setting-item-description"});let t=e.createDiv({cls:"merge-section"});t.createEl("h4",{text:"\uC0C8 \uC544\uC774\uB514\uC5B4"}),t.createEl("p",{text:this.candidate.title,cls:"merge-title"}),t.createEl("p",{text:this.candidate.body,cls:"merge-body"});let n=e.createDiv({cls:"merge-section"});n.createEl("h4",{text:"\uAE30\uC874 \uB178\uD2B8"}),n.createEl("p",{text:this.similarNote.note.title,cls:"merge-title"}),n.createEl("p",{text:`\uD0A4\uC6CC\uB4DC: ${this.similarNote.note.keywords.join(", ")}`,cls:"merge-keywords"});let s=e.createDiv({cls:"merge-buttons"});s.createEl("button",{text:"\uAE30\uC874 \uB178\uD2B8\uC5D0 \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",()=>{this.onResult(!0),this.close()}),s.createEl("button",{text:"\uC0C8 \uB178\uD2B8 \uC0DD\uC131"}).addEventListener("click",()=>{this.onResult(!1),this.close()})}onClose(){this.contentEl.empty()}},tC=class extends M.Modal{constructor(e,t){super(e),this.items=t}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC624\uB298 \uC9D1\uC911\uD560 \uD504\uB85C\uC81D\uD2B8 Top 3"});let t=e.createDiv({cls:"focus-list"});this.items.forEach((r,o)=>{let a=t.createDiv({cls:"focus-item"});a.createEl("h3",{text:`${o+1}. ${r.title}`}),a.createEl("p",{text:r.why,cls:"focus-why"}),a.createEl("p",{text:`\u2192 ${r.nextAction}`,cls:"focus-action"})}),e.createDiv({cls:"modal-button-container"}).createEl("button",{text:"\uB2EB\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}},Ff=class extends M.Modal{constructor(e,t,n,s){super(e),this.reason=t,this.file=n,this.plugin=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uD30C\uC77C\uC774 \uB108\uBB34 \uD07D\uB2C8\uB2E4"}),e.createEl("p",{text:this.reason}),e.createEl("p",{text:"\uC124\uC815\uC5D0\uC11C \uC81C\uD55C\uC744 \uC870\uC815\uD558\uAC70\uB098, \uD30C\uC77C\uC744 \uBD84\uD560\uD574\uC11C \uCC98\uB9AC\uD558\uC138\uC694.",cls:"setting-item-description"});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"\uC124\uC815 \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.app.setting.open()})}onClose(){this.contentEl.empty()}},nC=class extends M.Modal{constructor(t,n,s,r,o=null){super(t);this.choiceMade=!1;this.relatedNotes=n,this.selected=new Set(n.map((a,l)=>l)),this.currentFile=s,this.finder=r,this.feedbackManager=o}recordFeedback(t,n,s){this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"related_notes",noteTitle:this.currentFile.basename,aiSuggestion:{suggestedNotePaths:this.relatedNotes.map(r=>r.note.path)},userChoice:{accepted:t.length>0,rejectedItems:n.map(r=>r.note.path),dismissed:s}})}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uAD00\uB828 \uB178\uD2B8 \uBC1C\uACAC"}),t.createEl("p",{text:"\uC5F0\uACB0\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let n=t.createDiv({cls:"related-notes-list"});this.relatedNotes.forEach((a,l)=>{let c=n.createDiv({cls:"related-note-item"}),d=c.createEl("input",{type:"checkbox",attr:{checked:!0}});d.addEventListener("change",()=>{d.checked?this.selected.add(l):this.selected.delete(l)});let h=c.createDiv({cls:"related-note-label"});h.createEl("strong",{text:a.note.title});let p=Math.round(a.relevance*100);h.createEl("span",{text:` (${p}%)`,cls:"related-note-relevance"}),a.matchedKeywords.length>0&&h.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${a.matchedKeywords.join(", ")}`,cls:"related-note-keywords"})});let s=t.createDiv({cls:"modal-button-container"});s.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback([],this.relatedNotes,!1),this.close()}),s.createEl("button",{text:"\uB9C1\uD06C \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",async()=>{this.choiceMade=!0;let a=this.relatedNotes.filter((c,d)=>this.selected.has(d)),l=this.relatedNotes.filter((c,d)=>!this.selected.has(d));this.recordFeedback(a,l,!1),a.length>0&&(await this.finder.addRelatedLinks(this.currentFile,a),new M.Notice(`${a.length}\uAC1C \uAD00\uB828 \uB178\uD2B8 \uB9C1\uD06C \uCD94\uAC00\uB428`)),this.close()})}onClose(){this.choiceMade||this.recordFeedback([],this.relatedNotes,!0),this.contentEl.empty()}},iC=class extends M.Modal{constructor(e,t,n,s,r,o){super(e),this.projectName=t,this.noteFile=n,this.noteTitle=s,this.mocManager=r,this.projectsFolder=o}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 \uAC10\uC9C0"}),e.createEl("p",{text:`"${this.projectName}" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC0C8\uB85C \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`}),e.createEl("p",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8\uC758 MOC(Map of Content)\uB97C \uC0DD\uC131\uD560\uAE4C\uC694?",cls:"setting-item-description"});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"MOC \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{await this.mocManager.createProjectMOC(this.projectName,this.projectsFolder)?(await this.mocManager.addNoteToMOC(this.projectName,this.noteTitle,this.noteFile.path),new M.Notice(`\u{1F4C1} ${this.projectName} MOC \uC0DD\uC131 \uBC0F \uC5F0\uACB0 \uC644\uB8CC`)):new M.Notice("MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4"),this.close()})}onClose(){this.contentEl.empty()}},sC=class extends M.Modal{constructor(e,t,n){super(e),this.mocManager=t,this.projectsFolder=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131"}),e.createEl("p",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 MOC\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4. \uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694.",cls:"setting-item-description"});let t=e.createDiv({cls:"moc-input-container"});if(t.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uC774\uB984:"}),this.inputEl=t.createEl("input",{type:"text",placeholder:"\uC608: \uC2A4\uB9C8\uD2B8\uD31C"}),this.inputEl.style.width="100%",this.inputEl.style.marginTop="8px",this.inputEl.style.padding="8px",this.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.createMOC()}),this.mocManager&&this.mocManager.getMOCCount()>0){let o=e.createDiv({cls:"existing-mocs"});o.createEl("h4",{text:"\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 MOC:"});let a=o.createEl("ul");for(let l of this.mocManager.getProjectList())a.createEl("li",{text:l})}let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createMOC()),setTimeout(()=>this.inputEl.focus(),10)}async createMOC(){let e=this.inputEl.value.trim();if(!e){new M.Notice("\uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694");return}if(!this.mocManager){new M.Notice("MOC \uAD00\uB9AC\uC790\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4"),this.close();return}if(this.mocManager.getProjectList().includes(e)){new M.Notice(`"${e}" MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4`);return}let n=await this.mocManager.createProjectMOC(e,this.projectsFolder);n?(new M.Notice(`\u{1F4C1} ${e} MOC \uC0DD\uC131 \uC644\uB8CC`),this.app.workspace.getLeaf().openFile(n)):new M.Notice("MOC \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4"),this.close()}onClose(){this.contentEl.empty()}},rC=class extends M.Modal{constructor(e,t,n,s,r){super(e),this.title=t,this.description=n,this.placeholder=s,this.onSubmit=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.title}),e.createEl("p",{text:this.description,cls:"setting-item-description"});let t=e.createDiv({cls:"url-input-container"});this.inputEl=t.createEl("input",{type:"text",placeholder:this.placeholder}),this.inputEl.style.width="100%",this.inputEl.style.padding="8px",navigator.clipboard.readText().then(o=>{o&&(o.startsWith("http://")||o.startsWith("https://"))&&(this.inputEl.value=o)}).catch(()=>{}),this.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.submit()});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uAC00\uC838\uC624\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.submit()),setTimeout(()=>this.inputEl.focus(),10)}async submit(){let e=this.inputEl.value.trim();if(!e){new M.Notice("URL\uC744 \uC785\uB825\uD558\uC138\uC694");return}this.close(),await this.onSubmit(e)}onClose(){this.contentEl.empty()}},oC=class extends M.Modal{constructor(e,t,n,s){super(e),this.sections=t,this.selected=new Set(t.map((r,o)=>o)),this.sourceFile=n,this.plugin=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uACB0\uACFC"}),e.createEl("p",{text:`${this.sections.length}\uAC1C\uC758 \uC139\uC158\uC73C\uB85C \uBD84\uB9AC\uB428. \uC0DD\uC131\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let t=e.createDiv({cls:"split-section-list"});this.sections.forEach((o,a)=>{let l=t.createDiv({cls:"split-section-item"});l.style.marginBottom="16px",l.style.padding="12px",l.style.border="1px solid var(--background-modifier-border)",l.style.borderRadius="8px";let c=l.createDiv({cls:"split-section-header"});c.style.display="flex",c.style.alignItems="center",c.style.gap="8px";let d=c.createEl("input",{type:"checkbox",attr:{checked:!0}});d.addEventListener("change",()=>{d.checked?this.selected.add(a):this.selected.delete(a)}),c.createEl("strong",{text:o.title});let h=c.createDiv({cls:"split-section-badges"});h.style.marginLeft="auto",h.style.display="flex",h.style.gap="4px";let p=h.createEl("span",{text:o.targetType,cls:"split-category-badge"});if(p.style.padding="2px 8px",p.style.borderRadius="4px",p.style.fontSize="12px",p.style.backgroundColor=this.getTargetTypeColor(o.targetType),p.style.color="white",o.project){let v=h.createEl("span",{text:o.project.startsWith("NEW:")?`\u2728 ${o.project.slice(4)}`:`\u{1F4C1} ${o.project}`,cls:"split-project-badge"});v.style.padding="2px 8px",v.style.borderRadius="4px",v.style.fontSize="12px",v.style.backgroundColor="var(--interactive-accent)",v.style.color="white"}let m=l.createDiv({cls:"split-section-preview"});m.style.marginTop="8px",m.style.fontSize="13px",m.style.color="var(--text-muted)",m.style.maxHeight="60px",m.style.overflow="hidden",m.style.textOverflow="ellipsis";let y=o.content.length>150?o.content.slice(0,150)+"...":o.content;if(m.setText(y),o.keywords.length>0){let v=l.createDiv({cls:"split-section-keywords"});v.style.marginTop="8px",v.style.fontSize="12px",v.setText(`\uD0A4\uC6CC\uB4DC: ${o.keywords.join(", ")}`)}});let n=e.createDiv({cls:"modal-button-container"});n.style.marginTop="16px",n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:`${this.selected.size}\uAC1C \uB178\uD2B8 \uC0DD\uC131`,cls:"mod-cta"}).addEventListener("click",async()=>{let o=this.sections.filter((a,l)=>this.selected.has(l));o.length>0&&(this.close(),await this.plugin.createSplitNotes(o,this.sourceFile))})}getTargetTypeColor(e){switch(e){case"project":return"#e67e22";case"library":return"#27ae60";case"archive":return"#95a5a6";default:return"#7f8c8d"}}onClose(){this.contentEl.empty()}},aC=class extends M.Modal{constructor(t,n,s,r=null){super(t);this.choiceMade=!1;this.result=n,this.onChoice=s,this.feedbackManager=r}recordFeedback(t){this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"reference_location",noteTitle:this.result.title,aiSuggestion:{targetType:this.result.targetType,projectName:this.result.projectName},userChoice:{accepted:t!==null&&this.result.targetType==="project"&&t==="project",modified:t||void 0,dismissed:t===null}})}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC800\uC7A5 \uC704\uCE58 \uC120\uD0DD"});let n=t.createDiv({cls:"reference-confirm-info"});n.style.marginBottom="16px",n.style.padding="12px",n.style.backgroundColor="var(--background-secondary)",n.style.borderRadius="8px",n.createEl("p",{text:`"${this.result.title}"`,cls:"reference-title"}).style.fontWeight="bold",n.createEl("p",{text:`\uAD00\uB828 \uD504\uB85C\uC81D\uD2B8: ${this.result.projectName}`,cls:"reference-project"}).style.color="var(--text-muted)",n.createEl("p",{text:"\uC774 \uC790\uB8CC\uB294 \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB85C \uBCF4\uC785\uB2C8\uB2E4. \uC5B4\uB514\uC5D0 \uC800\uC7A5\uD560\uAE4C\uC694?",cls:"reference-question"}).style.marginTop="8px";let s=t.createDiv({cls:"reference-options"});s.style.display="flex",s.style.flexDirection="column",s.style.gap="12px";let r=s.createDiv({cls:"reference-option"});r.style.padding="12px",r.style.border="1px solid var(--background-modifier-border)",r.style.borderRadius="8px",r.style.cursor="pointer",r.addEventListener("mouseenter",()=>{r.style.backgroundColor="var(--background-secondary)"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor=""}),r.createEl("strong",{text:"\u{1F4C1} \uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC800\uC7A5"}),r.createEl("p",{text:`Projects/${this.result.projectName}/ \uC5D0 \uC800\uC7A5`,cls:"option-desc"}).style.color="var(--text-muted)",r.createEl("small",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8 \uC804\uC6A9 \uC790\uB8CC\uB85C \uAD00\uB9AC"}).style.color="var(--text-faint)",r.addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback("project"),this.close(),this.onChoice("project")});let o=s.createDiv({cls:"reference-option"});o.style.padding="12px",o.style.border="2px solid var(--interactive-accent)",o.style.borderRadius="8px",o.style.cursor="pointer",o.style.backgroundColor="var(--background-secondary)",o.createEl("strong",{text:"\u{1F4DA} Library\uC5D0 \uC800\uC7A5 + \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C (\uAD8C\uC7A5)"}),o.createEl("p",{text:"Library/ \uC5D0 \uC800\uC7A5\uD558\uACE0 \uD504\uB85C\uC81D\uD2B8\uC640 \uC5F0\uACB0",cls:"option-desc"}).style.color="var(--text-muted)",o.createEl("small",{text:"\uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5"}).style.color="var(--text-faint)",o.addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback("library"),this.close(),this.onChoice("library")});let a=t.createDiv({cls:"modal-button-container"});a.style.marginTop="16px",a.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close())}onClose(){this.choiceMade||this.recordFeedback(null),this.contentEl.empty()}},lC=class extends M.Modal{constructor(e,t){super(e),this.plugin=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("zfb-command-list-modal");let t=e.createEl("h2",{text:"\u{1F9E0} Zero Friction Brain"});t.style.marginBottom="16px",t.style.textAlign="center";let n=[{name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkey:"Ctrl+Shift+G",icon:"folder",action:()=>this.plugin.classifyCurrentFile()},{name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkey:"Ctrl+Shift+L",icon:"link",action:()=>this.plugin.linkRelatedNotesForCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkey:"Ctrl+Shift+S",icon:"sparkles",action:()=>this.plugin.smartProcessCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkey:"Ctrl+Shift+D",icon:"split",action:()=>this.plugin.smartSplitCurrentFile()},{name:"ZK \uCD94\uCD9C",hotkey:"Ctrl+Shift+Z",icon:"file-plus",action:()=>this.plugin.extractZKFromCurrentFile()},{name:"URL \uAC00\uC838\uC624\uAE30",hotkey:"Ctrl+Shift+U",icon:"globe",action:()=>this.plugin.showURLImportModal()},{name:"Focus Top 3",hotkey:"Ctrl+Shift+;",icon:"target",action:()=>this.plugin.showFocusTop3()},{name:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC",hotkey:"Ctrl+Shift+R",icon:"calendar-check",action:()=>this.plugin.showReviewModal()},{name:"OCR \uCD94\uCD9C",hotkey:"Ctrl+Shift+O",icon:"scan",action:()=>this.plugin.ocrCurrentFile()},{divider:!0},{name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",hotkey:"",icon:"inbox",action:()=>this.plugin.processInbox()},{name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",hotkey:"",icon:"map",action:()=>this.plugin.showCreateMOCModal()},{name:"ZK Index \uC7AC\uAD6C\uCD95",hotkey:"",icon:"refresh-cw",action:()=>this.plugin.rebuildZKIndex()},{name:"Watch \uD1A0\uAE00",hotkey:"",icon:"eye",action:()=>this.plugin.toggleWatch()}],s=e.createDiv({cls:"zfb-command-list"});s.style.display="flex",s.style.flexDirection="column",s.style.gap="4px";for(let a of n){if("divider"in a&&a.divider){let h=s.createEl("hr");h.style.margin="8px 0",h.style.border="none",h.style.borderTop="1px solid var(--background-modifier-border)";continue}let l=s.createDiv({cls:"zfb-command-item"});l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="space-between",l.style.padding="10px 12px",l.style.borderRadius="6px",l.style.cursor="pointer",l.style.transition="background-color 0.1s",l.addEventListener("mouseenter",()=>{l.style.backgroundColor="var(--background-secondary)"}),l.addEventListener("mouseleave",()=>{l.style.backgroundColor=""});let c=l.createDiv();c.style.display="flex",c.style.alignItems="center",c.style.gap="10px";let d=c.createSpan({cls:"zfb-command-icon"});if((0,M.setIcon)(d,a.icon||"command"),d.style.opacity="0.7",c.createSpan({text:a.name}),a.hotkey){let h=l.createSpan({text:a.hotkey,cls:"zfb-command-hotkey"});h.style.fontSize="0.85em",h.style.color="var(--text-muted)",h.style.backgroundColor="var(--background-secondary)",h.style.padding="2px 8px",h.style.borderRadius="4px",h.style.fontFamily="monospace"}l.addEventListener("click",()=>{this.close(),a.action()})}let r=e.createDiv({cls:"zfb-command-footer"});r.style.marginTop="16px",r.style.paddingTop="12px",r.style.borderTop="1px solid var(--background-modifier-border)",r.style.textAlign="center",r.style.color="var(--text-muted)",r.style.fontSize="0.85em",r.createSpan({text:`v${this.plugin.manifest.version} \u2022 `});let o=r.createEl("a",{text:"\uC124\uC815"});o.style.cursor="pointer",o.addEventListener("click",()=>{this.close(),this.app.setting.open(),this.app.setting.openTabById("zero-friction-brain")})}onClose(){this.contentEl.empty()}},cC=class extends M.Modal{constructor(t,n,s){super(t);this.selectedPeriod="week";this.resultContainer=null;this.isLoading=!1;this.reviewManager=n,this.settings=s}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-review-modal"),t.createEl("h2",{text:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC"});let n=t.createDiv({cls:"zfb-review-period-section"});n.createEl("label",{text:"\uAE30\uAC04 \uC120\uD0DD:",cls:"setting-item-name"});let s=n.createDiv({cls:"zfb-period-buttons"});s.style.display="flex",s.style.gap="8px",s.style.marginTop="8px",s.style.marginBottom="16px",[{value:"today",label:"\uC624\uB298"},{value:"week",label:"\uC774\uBC88 \uC8FC"},{value:"month",label:"\uC774\uBC88 \uB2EC"}].forEach(({value:m,label:y})=>{let v=s.createEl("button",{text:y});v.style.padding="8px 16px",v.style.borderRadius="6px",v.style.cursor="pointer",m===this.selectedPeriod&&v.addClass("mod-cta"),v.addEventListener("click",()=>{this.selectedPeriod=m,s.querySelectorAll("button").forEach(E=>E.removeClass("mod-cta")),v.addClass("mod-cta"),this.loadNotes()})});let o=t.createDiv({cls:"zfb-review-filter-section"});o.style.marginBottom="16px",o.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uD544\uD130 (\uC120\uD0DD):",cls:"setting-item-name"});let a=o.createEl("select");a.style.marginLeft="8px",a.style.padding="4px 8px";let l=a.createEl("option",{text:"\uC804\uCCB4",value:""});l.value="",this.reviewManager.getProjectList().forEach(m=>{let y=a.createEl("option",{text:m,value:m});y.value=m}),a.addEventListener("change",()=>{this.projectFilter=a.value||void 0,this.loadNotes()}),this.resultContainer=t.createDiv({cls:"zfb-review-results"}),this.resultContainer.style.marginTop="16px",this.resultContainer.style.maxHeight="400px",this.resultContainer.style.overflowY="auto";let d=t.createDiv({cls:"modal-button-container"});d.style.marginTop="16px",d.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close()),d.createEl("button",{text:"AI \uBD84\uC11D \uBC0F \uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createReviewNote()),this.loadNotes()}async loadNotes(){if(!(!this.resultContainer||this.isLoading)){this.isLoading=!0,this.resultContainer.empty(),this.resultContainer.createEl("p",{text:"\uB178\uD2B8 \uC218\uC9D1 \uC911...",cls:"zfb-loading"});try{let t={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.collectNotes(t),s=this.reviewManager.groupByProject(n);this.renderResults(n,s)}catch(t){console.error("\uB178\uD2B8 \uC218\uC9D1 \uC2E4\uD328:",t),this.resultContainer.empty(),this.resultContainer.createEl("p",{text:`\uC624\uB958: ${t}`,cls:"zfb-error"})}finally{this.isLoading=!1}}}renderResults(t,n){if(!this.resultContainer)return;if(this.resultContainer.empty(),t.length===0){this.resultContainer.createEl("p",{text:"\uD574\uB2F9 \uAE30\uAC04\uC5D0 \uC791\uC5C5\uD55C \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.",cls:"zfb-empty-message"});return}let s=this.resultContainer.createDiv({cls:"zfb-review-summary"});s.style.padding="12px",s.style.backgroundColor="var(--background-secondary)",s.style.borderRadius="8px",s.style.marginBottom="16px";let r=Uc(this.selectedPeriod,this.settings.timezone);s.createEl("p",{text:`${r.label} \uC791\uC5C5: ${t.length}\uAC1C \uB178\uD2B8, ${n.length}\uAC1C \uD504\uB85C\uC81D\uD2B8/\uC601\uC5ED`});for(let o of n){let a=this.resultContainer.createDiv({cls:"zfb-review-group"});a.style.marginBottom="16px";let l=a.createEl("h4",{text:`\u{1F4C1} ${o.projectName} (${o.noteCount}\uAC1C)`});l.style.marginBottom="8px",l.style.borderBottom="1px solid var(--background-modifier-border)",l.style.paddingBottom="4px";let c=a.createEl("ul");c.style.listStyle="none",c.style.paddingLeft="16px",c.style.margin="0";for(let d of o.notes){let h=c.createEl("li");h.style.display="flex",h.style.justifyContent="space-between",h.style.alignItems="center",h.style.padding="4px 0";let p=h.createEl("a",{text:d.title});p.style.cursor="pointer",p.style.color="var(--text-accent)",p.addEventListener("click",async()=>{this.app.vault.getAbstractFileByPath(d.path)instanceof M.TFile&&await this.app.workspace.openLinkText(d.path,"")});let m=h.createEl("span",{text:vC(d.modified),cls:"zfb-note-time"});m.style.fontSize="0.85em",m.style.color="var(--text-muted)"}}}async createReviewNote(){if(!this.isLoading){this.isLoading=!0,new M.Notice("AI \uBD84\uC11D \uC911...");try{let t={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.analyze(t),s=await this.reviewManager.createReviewNote(n);new M.Notice(`\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131\uB428: ${s.basename}`),await this.app.workspace.openLinkText(s.path,""),this.close()}catch(t){console.error("\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328:",t),new M.Notice(`\uC0DD\uC131 \uC2E4\uD328: ${t}`)}finally{this.isLoading=!1}}}onClose(){this.contentEl.empty()}};
/*! Bundled license information:

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
