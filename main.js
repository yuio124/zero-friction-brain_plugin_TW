/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var jH=Object.create;var Ef=Object.defineProperty;var WH=Object.getOwnPropertyDescriptor;var qH=Object.getOwnPropertyNames;var YH=Object.getPrototypeOf,KH=Object.prototype.hasOwnProperty;var XH=(s,e,t)=>e in s?Ef(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var tn=(s,e)=>()=>(s&&(e=s(s=0)),e);var pb=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),GS=(s,e)=>{for(var t in e)Ef(s,t,{get:e[t],enumerable:!0})},nL=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of qH(e))!KH.call(s,i)&&i!==t&&Ef(s,i,{get:()=>e[i],enumerable:!(n=WH(e,i))||n.enumerable});return s};var Io=(s,e,t)=>(t=s!=null?jH(YH(s)):{},nL(e||!s||!s.__esModule?Ef(t,"default",{value:s,enumerable:!0}):t,s)),JH=s=>nL(Ef({},"__esModule",{value:!0}),s);var J=(s,e,t)=>(XH(s,typeof e!="symbol"?e+"":e,t),t),jS=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var b=(s,e,t)=>(jS(s,e,"read from private field"),t?t.call(s):e.get(s)),D=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},k=(s,e,t,n)=>(jS(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t);var Yn=(s,e,t,n)=>({set _(i){k(s,e,i,t)},get _(){return b(s,e,n)}}),N=(s,e,t)=>(jS(s,e,"access private method"),t);var JS={};GS(JS,{DEFAULT_CHUNK_OVERLAP:()=>tl,DEFAULT_CHUNK_SIZE:()=>el,DEFAULT_FEEDBACK_STORE:()=>Sf,DEFAULT_SETTINGS:()=>Qa,DEFAULT_USAGE_STORAGE:()=>Tu,DEFAULT_USER_PREFERENCES:()=>gb,GEMINI_PRICING:()=>yb,MIN_CHUNK_SIZE:()=>mb,PARAGRAPH_SPLIT_REGEX:()=>qS,SECTION_SPLIT_REGEX:()=>WS,USAGE_FEATURE_LABELS:()=>YS,USAGE_FILE_DESKTOP:()=>Tf,USAGE_FILE_MOBILE:()=>bb,USAGE_FILE_NAME:()=>XS,USAGE_STORAGE_MODE_OPTIONS:()=>KS,createEmptyDailySummary:()=>Af});function Af(s){return{date:s,totalInputTokens:0,totalOutputTokens:0,totalCalls:0,callsByFeature:{classify:0,ocr:0,youtube:0,webpage:0,zk:0,related:0,chat:0,embedding:0,review:0,meeting:0,schedule:0,split:0,focus:0,other:0},estimatedCostUSD:0}}var Qa,gb,Sf,el,tl,mb,WS,qS,yb,YS,KS,XS,Tf,bb,Tu,Li=tn(()=>{Qa={geminiApiKey:"",inboxFolder:"00 _Inbox",projectsFolder:"01 Projects",libraryFolder:"02 Library",archivesFolder:"03 Archives",zettelFolder:"10 Zettelkasten",autoWatch:!0,triggerTag:"#\uC644\uB8CC",language:"ko",ocrEnabled:!0,ocrAutoProcess:!1,ocrMoveOriginal:!0,ocrOriginalFolder:"03 Archives/OCR_\uC6D0\uBCF8",ocrMinTextThreshold:50,ocrMaxPages:20,ocrMaxFileSizeMB:10,ocrDailyLimit:50,detailedSummary:!1,zkIdType:"date-sequence",zkMergeThreshold:.8,timezone:"auto",dateFormat:"local",scheduleDetectionEnabled:!0,dailyNotesFolder:"00 _Inbox",googleCalendarEnabled:!1,useOwnApiKey:!1,googleClientId:"",googleClientSecret:"",googleAccessToken:"",googleRefreshToken:"",googleTokenExpiry:0,calendarEnabled:!0,calendarDefaultView:"month",calendarFirstDayOfWeek:0,showMiniCalendar:!0,calendarEngine:"fullcalendar",embeddingEnabled:!1,embeddingSimilarityThreshold:.7,autoEmbeddingEnabled:!0,embeddingChunkSize:500,embeddingChunkOverlap:50,ragEnabled:!0,ragTopK:5,ragMaxContextLength:8e3,onboardingCompleted:!1,preset:"custom",lastNotifiedVersion:void 0,dataStorageLocation:"plugin",dataFolderPath:".zfb-data",youtubeTemplate:`---
type: youtube
source: "{{url}}"
title: "{{escapedTitle}}"
created: {{date}}
---

# {{title}}

{{iframe}}

## \uC694\uC57D
{{summary}}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
{{keyPoints}}
`,webpageTemplate:`---
type: webpage
source: "{{url}}"
title: "{{escapedTitle}}"
created: {{date}}
---

# {{title}}

{{bookmark}}

{{iframe}}

## \uC694\uC57D
{{summary}}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
{{keyPoints}}
`,usageTrackingEnabled:!1,usageStorageMode:"daily30",usageShowStatusBar:!0},gb={version:1,feedback:{referenceLocation:{toLibrary:0,toProject:0,preference:"neutral"},scheduleDetection:{accepted:0,rejected:0,falsePositivePatterns:[]},projectClassification:{corrections:[]}},restructure:{accepted:0,rejected:0,preferredFormats:[],preference:"neutral"},embedding:{acceptedPairs:[],rejectedPairs:[],similarityThresholdAdjustment:0},rag:{frequentQuestions:[],preferredNotes:[],feedbackOnAnswers:{helpful:0,notHelpful:0}}},Sf={version:1,entries:[],preferences:gb,lastUpdated:new Date().toISOString()},el=500,tl=50,mb=100,WS=/(?=^## )/m,qS=/\n\n+/,yb={"gemini-3-flash-preview":{inputPer1M:.5,outputPer1M:3},"gemini-2.0-flash":{inputPer1M:.1,outputPer1M:.4},"gemini-2.0-flash-lite":{inputPer1M:.075,outputPer1M:.3},"gemini-1.5-flash":{inputPer1M:.075,outputPer1M:.3},"gemini-1.5-pro":{inputPer1M:1.25,outputPer1M:5},"text-embedding-004":{inputPer1M:0,outputPer1M:0},"gemini-embedding-001":{inputPer1M:.15,outputPer1M:0}},YS={classify:"\uBD84\uB958",ocr:"OCR",youtube:"YouTube",webpage:"\uC6F9\uD398\uC774\uC9C0",zk:"ZK \uCD94\uCD9C",related:"\uAD00\uB828 \uB178\uD2B8",chat:"\uCC57\uBD07",embedding:"\uC784\uBCA0\uB529",review:"\uD68C\uACE0",meeting:"\uD68C\uC758\uB85D",schedule:"\uC77C\uC815",split:"\uBD84\uB9AC",focus:"Focus",other:"\uAE30\uD0C0"},KS=[{value:"today",label:"\uC624\uB298\uB9CC",desc:"\uC571 \uC7AC\uC2DC\uC791 \uC2DC \uCD08\uAE30\uD654"},{value:"daily30",label:"\uC77C\uBCC4 30\uC77C",desc:"\uCD5C\uADFC 30\uC77C \uB370\uC774\uD130 \uBCF4\uAD00"},{value:"daily90",label:"\uC77C\uBCC4 90\uC77C",desc:"\uCD5C\uADFC 90\uC77C \uB370\uC774\uD130 \uBCF4\uAD00"},{value:"monthly12",label:"\uC6D4\uBCC4 12\uAC1C\uC6D4",desc:"\uC6D4\uBCC4 \uC9D1\uACC4 12\uAC1C\uC6D4 \uBCF4\uAD00"}],XS="usage.json",Tf="usage-desktop.json",bb="usage-mobile.json",Tu={version:1,storageMode:"daily30",dailySummaries:[],monthlySummaries:[],lastUpdated:new Date().toISOString()}});function La(s,e){s&&s(e)}function p4(s){return Object.fromEntries(Object.entries(s).map(([e,t])=>[t,e]))}function KD(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function g4(s){return s?.prototype?.__proto__?.constructor?.name==="TypedArray"}function jx(s){return Number.isInteger(s)||typeof s=="bigint"}function m4(s){return s!=null}function XD(s){let e=[],t=s;for(;Array.isArray(t);)e.push(t.length),t=t[0];return e}function JD(s,e,t=void 0){let n=s[e];if(n!==void 0)return delete s[e],n;if(t===void 0)throw Error(`Key ${e} does not exist in object.`);return t}function ln(...s){return Array.prototype.concat.apply([],s)}function y4(...s){return s.reduce((e,t)=>e.flatMap(n=>t.map(i=>[n,i])))}function jh(s,e){return Math.abs((s+e)%(2*e)-e)}var _n,$a=tn(()=>{_n=class{constructor(){let s=function(...e){return s._call(...e)};return Object.setPrototypeOf(s,new.target.prototype)}_call(...s){throw Error("Must implement _call method in subclass")}}});var b4=pb(()=>{});var ZD=pb(v4=>{(()=>{"use strict";var s={d:(m,y)=>{for(var _ in y)s.o(y,_)&&!s.o(m,_)&&Object.defineProperty(m,_,{enumerable:!0,get:y[_]})},o:(m,y)=>Object.prototype.hasOwnProperty.call(m,y),r:m=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(m,"__esModule",{value:!0})}},e={};s.r(e),s.d(e,{InferenceSession:()=>f,Tensor:()=>c,env:()=>r,registerBackend:()=>i});let t={},n=[],i=(m,y,_)=>{if(!y||typeof y.init!="function"||typeof y.createSessionHandler!="function")throw new TypeError("not a valid backend");{let x=t[m];if(x===void 0)t[m]={backend:y,priority:_};else{if(x.priority>_)return;if(x.priority===_&&x.backend!==y)throw new Error(`cannot register backend "${m}" using priority ${_}`)}if(_>=0){let E=n.indexOf(m);E!==-1&&n.splice(E,1);for(let S=0;S<n.length;S++)if(t[n[S]].priority<=_)return void n.splice(S,0,m);n.push(m)}}},r=new class{constructor(){this.wasm={},this.webgl={},this.logLevelInternal="warning"}set logLevel(m){if(m!==void 0){if(typeof m!="string"||["verbose","info","warning","error","fatal"].indexOf(m)===-1)throw new Error(`Unsupported logging level: ${m}`);this.logLevelInternal=m}}get logLevel(){return this.logLevelInternal}},o=typeof BigInt64Array<"u"&&typeof BigInt64Array.from=="function",l=typeof BigUint64Array<"u"&&typeof BigUint64Array.from=="function",u=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),h=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);o&&(u.set("int64",BigInt64Array),h.set(BigInt64Array,"int64")),l&&(u.set("uint64",BigUint64Array),h.set(BigUint64Array,"uint64"));class d{constructor(y,_,x){let E,S,T;if(typeof y=="string")if(E=y,T=x,y==="string"){if(!Array.isArray(_))throw new TypeError("A string tensor's data must be a string array.");S=_}else{let I=u.get(y);if(I===void 0)throw new TypeError(`Unsupported tensor type: ${y}.`);if(Array.isArray(_))S=I.from(_);else{if(!(_ instanceof I))throw new TypeError(`A ${E} tensor's data must be type of ${I}`);S=_}}else if(T=_,Array.isArray(y)){if(y.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let I=typeof y[0];if(I==="string")E="string",S=y;else{if(I!=="boolean")throw new TypeError(`Invalid element type of data array: ${I}.`);E="bool",S=Uint8Array.from(y)}}else{let I=h.get(y.constructor);if(I===void 0)throw new TypeError(`Unsupported type for tensor data: ${y.constructor}.`);E=I,S=y}if(T===void 0)T=[S.length];else if(!Array.isArray(T))throw new TypeError("A tensor's dims must be a number array");let C=(I=>{let A=1;for(let P=0;P<I.length;P++){let F=I[P];if(typeof F!="number"||!Number.isSafeInteger(F))throw new TypeError(`dims[${P}] must be an integer, got: ${F}`);if(F<0)throw new RangeError(`dims[${P}] must be a non-negative integer, got: ${F}`);A*=F}return A})(T);if(C!==S.length)throw new Error(`Tensor's size(${C}) does not match data length(${S.length}).`);this.dims=T,this.type=E,this.data=S,this.size=C}static bufferToTensor(y,_){if(y===void 0)throw new Error("Image buffer must be defined");if(_.height===void 0||_.width===void 0)throw new Error("Image height and width must be defined");let{height:x,width:E}=_,S=_.norm,T,C;T=S===void 0||S.mean===void 0?255:S.mean,C=S===void 0||S.bias===void 0?0:S.bias;let I=_.bitmapFormat!==void 0?_.bitmapFormat:"RGBA",A=_.tensorFormat!==void 0&&_.tensorFormat!==void 0?_.tensorFormat:"RGB",P=x*E,F=A==="RGBA"?new Float32Array(4*P):new Float32Array(3*P),H=4,z=0,B=1,V=2,M=3,$=0,oe=P,Z=2*P,le=-1;I==="RGB"&&(H=3,z=0,B=1,V=2,M=-1),A==="RGBA"?le=3*P:A==="RBG"?($=0,Z=P,oe=2*P):A==="BGR"&&(Z=0,oe=P,$=2*P);for(let ae=0;ae<P;ae++,z+=H,V+=H,B+=H,M+=H)F[$++]=(y[z]+C)/T,F[oe++]=(y[B]+C)/T,F[Z++]=(y[V]+C)/T,le!==-1&&M!==-1&&(F[le++]=(y[M]+C)/T);return new d("float32",F,A==="RGBA"?[1,4,x,E]:[1,3,x,E])}static async fromImage(y,_){let x=typeof HTMLImageElement<"u"&&y instanceof HTMLImageElement,E=typeof ImageData<"u"&&y instanceof ImageData,S=typeof ImageBitmap<"u"&&y instanceof ImageBitmap,T=typeof String<"u"&&(y instanceof String||typeof y=="string"),C,I={};if(x){let A=document.createElement("canvas"),P=A.getContext("2d");if(P==null)throw new Error("Can not access image data");{let F=y.naturalHeight,H=y.naturalWidth;if(_!==void 0&&_.resizedHeight!==void 0&&_.resizedWidth!==void 0&&(F=_.resizedHeight,H=_.resizedWidth),_!==void 0){if(I=_,_.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");if(I.tensorFormat="RGBA",_.height!==void 0&&_.height!==F)throw new Error("Image input config height doesn't match HTMLImageElement height");if(I.height=F,_.width!==void 0&&_.width!==H)throw new Error("Image input config width doesn't match HTMLImageElement width");I.width=H}else I.tensorFormat="RGBA",I.height=F,I.width=H;A.width=H,A.height=F,P.drawImage(y,0,0,H,F),C=P.getImageData(0,0,H,F).data}}else{if(!E){if(S){if(_===void 0)throw new Error("Please provide image config with format for Imagebitmap");if(_.bitmapFormat!==void 0)throw new Error("Image input config format must be defined for ImageBitmap");let A=document.createElement("canvas").getContext("2d");if(A!=null){let P=y.height,F=y.width;if(A.drawImage(y,0,0,F,P),C=A.getImageData(0,0,F,P).data,_!==void 0){if(_.height!==void 0&&_.height!==P)throw new Error("Image input config height doesn't match ImageBitmap height");if(I.height=P,_.width!==void 0&&_.width!==F)throw new Error("Image input config width doesn't match ImageBitmap width");I.width=F}else I.height=P,I.width=F;return d.bufferToTensor(C,I)}throw new Error("Can not access image data")}if(T)return new Promise((A,P)=>{let F=document.createElement("canvas"),H=F.getContext("2d");if(!y||!H)return P();let z=new Image;z.crossOrigin="Anonymous",z.src=y,z.onload=()=>{F.width=z.width,F.height=z.height,H.drawImage(z,0,0,F.width,F.height);let B=H.getImageData(0,0,F.width,F.height);if(_!==void 0){if(_.height!==void 0&&_.height!==F.height)throw new Error("Image input config height doesn't match ImageBitmap height");if(I.height=F.height,_.width!==void 0&&_.width!==F.width)throw new Error("Image input config width doesn't match ImageBitmap width");I.width=F.width}else I.height=F.height,I.width=F.width;A(d.bufferToTensor(B.data,I))}});throw new Error("Input data provided is not supported - aborted tensor creation")}{let A="RGBA",P,F;if(_!==void 0&&_.resizedWidth!==void 0&&_.resizedHeight!==void 0?(P=_.resizedHeight,F=_.resizedWidth):(P=y.height,F=y.width),_!==void 0){if(I=_,_.bitmapFormat!==void 0&&_.bitmapFormat!==A)throw new Error("Image input config format must be RGBA for ImageData");I.bitmapFormat="RGBA"}else I.bitmapFormat="RGBA";if(I.height=P,I.width=F,_!==void 0){let H=document.createElement("canvas");H.width=F,H.height=P;let z=H.getContext("2d");if(z==null)throw new Error("Can not access image data");z.putImageData(y,0,0),C=z.getImageData(0,0,F,P).data}else C=y.data}}if(C!==void 0)return d.bufferToTensor(C,I);throw new Error("Input data provided is not supported - aborted tensor creation")}toImageData(y){var _,x;let E=document.createElement("canvas").getContext("2d"),S;if(E==null)throw new Error("Can not access image data");{let T=this.dims[3],C=this.dims[2],I=this.dims[1],A=y!==void 0&&y.format!==void 0?y.format:"RGB",P=y!==void 0&&((_=y.norm)===null||_===void 0?void 0:_.mean)!==void 0?y.norm.mean:255,F=y!==void 0&&((x=y.norm)===null||x===void 0?void 0:x.bias)!==void 0?y.norm.bias:0,H=C*T;if(y!==void 0){if(y.height!==void 0&&y.height!==C)throw new Error("Image output config height doesn't match tensor height");if(y.width!==void 0&&y.width!==T)throw new Error("Image output config width doesn't match tensor width");if(y.format!==void 0&&I===4&&y.format!=="RGBA"||I===3&&y.format!=="RGB"&&y.format!=="BGR")throw new Error("Tensor format doesn't match input tensor dims")}let z=4,B=0,V=1,M=2,$=3,oe=0,Z=H,le=2*H,ae=-1;A==="RGBA"?(oe=0,Z=H,le=2*H,ae=3*H):A==="RGB"?(oe=0,Z=H,le=2*H):A==="RBG"&&(oe=0,le=H,Z=2*H),S=E.createImageData(T,C);for(let be=0;be<C*T;B+=z,V+=z,M+=z,$+=z,be++)S.data[B]=(this.data[oe++]-F)*P,S.data[V]=(this.data[Z++]-F)*P,S.data[M]=(this.data[le++]-F)*P,S.data[$]=ae===-1?255:(this.data[ae++]-F)*P}return S}reshape(y){return new d(this.type,this.data,y)}}let c=d;class a{constructor(y){this.handler=y}async run(y,_,x){let E={},S={};if(typeof y!="object"||y===null||y instanceof c||Array.isArray(y))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let T=!0;if(typeof _=="object"){if(_===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(_ instanceof c)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(_)){if(_.length===0)throw new TypeError("'fetches' cannot be an empty array.");T=!1;for(let A of _){if(typeof A!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(A)===-1)throw new RangeError(`'fetches' contains invalid output name: ${A}.`);E[A]=null}if(typeof x=="object"&&x!==null)S=x;else if(x!==void 0)throw new TypeError("'options' must be an object.")}else{let A=!1,P=Object.getOwnPropertyNames(_);for(let F of this.outputNames)if(P.indexOf(F)!==-1){let H=_[F];(H===null||H instanceof c)&&(A=!0,T=!1,E[F]=H)}if(A){if(typeof x=="object"&&x!==null)S=x;else if(x!==void 0)throw new TypeError("'options' must be an object.")}else S=_}}else if(_!==void 0)throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let A of this.inputNames)if(y[A]===void 0)throw new Error(`input '${A}' is missing in 'feeds'.`);if(T)for(let A of this.outputNames)E[A]=null;let C=await this.handler.run(y,E,S),I={};for(let A in C)Object.hasOwnProperty.call(C,A)&&(I[A]=new c(C[A].type,C[A].data,C[A].dims));return I}static async create(y,_,x,E){let S,T={};if(typeof y=="string"){if(S=y,typeof _=="object"&&_!==null)T=_;else if(_!==void 0)throw new TypeError("'options' must be an object.")}else if(y instanceof Uint8Array){if(S=y,typeof _=="object"&&_!==null)T=_;else if(_!==void 0)throw new TypeError("'options' must be an object.")}else{if(!(y instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&y instanceof SharedArrayBuffer))throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");{let P=y,F=0,H=y.byteLength;if(typeof _=="object"&&_!==null)T=_;else if(typeof _=="number"){if(F=_,!Number.isSafeInteger(F))throw new RangeError("'byteOffset' must be an integer.");if(F<0||F>=P.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${P.byteLength}).`);if(H=y.byteLength-F,typeof x=="number"){if(H=x,!Number.isSafeInteger(H))throw new RangeError("'byteLength' must be an integer.");if(H<=0||F+H>P.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${P.byteLength-F}].`);if(typeof E=="object"&&E!==null)T=E;else if(E!==void 0)throw new TypeError("'options' must be an object.")}else if(x!==void 0)throw new TypeError("'byteLength' must be a number.")}else if(_!==void 0)throw new TypeError("'options' must be an object.");S=new Uint8Array(P,F,H)}}let C=(T.executionProviders||[]).map(P=>typeof P=="string"?P:P.name),I=await(async P=>{let F=P.length===0?n:P,H=[];for(let z of F){let B=t[z];if(B){if(B.initialized)return B.backend;if(B.aborted)continue;let V=!!B.initPromise;try{return V||(B.initPromise=B.backend.init()),await B.initPromise,B.initialized=!0,B.backend}catch(M){V||H.push({name:z,err:M}),B.aborted=!0}finally{delete B.initPromise}}}throw new Error(`no available backend found. ERR: ${H.map(z=>`[${z.name}] ${z.err}`).join(", ")}`)})(C),A=await I.createSessionHandler(S,T);return new a(A)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}let f=a;var p=v4;for(var g in e)p[g]=e[g];e.__esModule&&Object.defineProperty(p,"__esModule",{value:!0})})()});var _4=pb((exports,module)=>{(function(s,e){if(typeof exports=="object"&&typeof module=="object")module.exports=e(ZD());else if(typeof define=="function"&&define.amd)define([],e);else{var t=e(typeof exports=="object"?ZD():s.ort);for(var n in t)(typeof exports=="object"?exports:s)[n]=t[n]}})(self,__WEBPACK_EXTERNAL_MODULE__1670__=>(()=>{var __webpack_modules__={3474:(s,e,t)=>{var n,i=(n=(n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(r){function o(){return Z.buffer!=ae&&At(Z.buffer),be}function l(){return Z.buffer!=ae&&At(Z.buffer),Ce}function u(){return Z.buffer!=ae&&At(Z.buffer),Ze}function h(){return Z.buffer!=ae&&At(Z.buffer),Ae}function d(){return Z.buffer!=ae&&At(Z.buffer),Ie}var c,a,f;r=r||{},c||(c=r!==void 0?r:{}),c.ready=new Promise(function(R,O){a=R,f=O});var p,g,m,y,_,x,E=Object.assign({},c),S="./this.program",T=(R,O)=>{throw O},C=typeof window=="object",I=typeof importScripts=="function",A=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",P=c.ENVIRONMENT_IS_PTHREAD||!1,F="";function H(R){return c.locateFile?c.locateFile(R,F):F+R}if(A){let R;F=I?t(908).dirname(F)+"/":"//",x=()=>{_||(y=t(1384),_=t(908))},p=function(O,U){return x(),O=_.normalize(O),y.readFileSync(O,U?void 0:"utf8")},m=O=>((O=p(O,!0)).buffer||(O=new Uint8Array(O)),O),g=(O,U,W)=>{x(),O=_.normalize(O),y.readFile(O,function(X,ne){X?W(X):U(ne.buffer)})},1<process.argv.length&&(S=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(O){if(!(O instanceof Tr))throw O}),process.on("unhandledRejection",function(O){throw O}),T=(O,U)=>{if(Vs())throw process.exitCode=O,U;U instanceof Tr||$("exiting due to exception: "+U),process.exit(O)},c.inspect=function(){return"[Emscripten Module object]"};try{R=t(9925)}catch(O){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),O}t.g.Worker=R.Worker}else(C||I)&&(I?F=self.location.href:typeof document<"u"&&document.currentScript&&(F=document.currentScript.src),n&&(F=n),F=F.indexOf("blob:")!==0?F.substr(0,F.replace(/[?#].*/,"").lastIndexOf("/")+1):"",A||(p=R=>{var O=new XMLHttpRequest;return O.open("GET",R,!1),O.send(null),O.responseText},I&&(m=R=>{var O=new XMLHttpRequest;return O.open("GET",R,!1),O.responseType="arraybuffer",O.send(null),new Uint8Array(O.response)}),g=(R,O,U)=>{var W=new XMLHttpRequest;W.open("GET",R,!0),W.responseType="arraybuffer",W.onload=()=>{W.status==200||W.status==0&&W.response?O(W.response):U()},W.onerror=U,W.send(null)}));A&&typeof performance>"u"&&(t.g.performance=t(6953).performance);var z=console.log.bind(console),B=console.warn.bind(console);A&&(x(),z=R=>y.writeSync(1,R+`
`),B=R=>y.writeSync(2,R+`
`));var V,M=c.print||z,$=c.printErr||B;Object.assign(c,E),E=null,c.thisProgram&&(S=c.thisProgram),c.quit&&(T=c.quit),c.wasmBinary&&(V=c.wasmBinary);var oe=c.noExitRuntime||!1;typeof WebAssembly!="object"&&Xe("no native wasm support detected");var Z,le,ae,be,Ce,Ze,Ae,Ie,_e=!1,ht=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Vt(R,O,U){var W=(O>>>=0)+U;for(U=O;R[U]&&!(U>=W);)++U;if(16<U-O&&R.buffer&&ht)return ht.decode(R.buffer instanceof SharedArrayBuffer?R.slice(O,U):R.subarray(O,U));for(W="";O<U;){var X=R[O++];if(128&X){var ne=63&R[O++];if((224&X)==192)W+=String.fromCharCode((31&X)<<6|ne);else{var de=63&R[O++];65536>(X=(240&X)==224?(15&X)<<12|ne<<6|de:(7&X)<<18|ne<<12|de<<6|63&R[O++])?W+=String.fromCharCode(X):(X-=65536,W+=String.fromCharCode(55296|X>>10,56320|1023&X))}}else W+=String.fromCharCode(X)}return W}function ut(R,O){return(R>>>=0)?Vt(l(),R,O):""}function Rt(R,O,U,W){if(!(0<W))return 0;var X=U>>>=0;W=U+W-1;for(var ne=0;ne<R.length;++ne){var de=R.charCodeAt(ne);if(55296<=de&&57343>=de&&(de=65536+((1023&de)<<10)|1023&R.charCodeAt(++ne)),127>=de){if(U>=W)break;O[U++>>>0]=de}else{if(2047>=de){if(U+1>=W)break;O[U++>>>0]=192|de>>6}else{if(65535>=de){if(U+2>=W)break;O[U++>>>0]=224|de>>12}else{if(U+3>=W)break;O[U++>>>0]=240|de>>18,O[U++>>>0]=128|de>>12&63}O[U++>>>0]=128|de>>6&63}O[U++>>>0]=128|63&de}}return O[U>>>0]=0,U-X}function Yt(R){for(var O=0,U=0;U<R.length;++U){var W=R.charCodeAt(U);127>=W?O++:2047>=W?O+=2:55296<=W&&57343>=W?(O+=4,++U):O+=3}return O}function At(R){ae=R,c.HEAP8=be=new Int8Array(R),c.HEAP16=new Int16Array(R),c.HEAP32=Ze=new Int32Array(R),c.HEAPU8=Ce=new Uint8Array(R),c.HEAPU16=new Uint16Array(R),c.HEAPU32=Ae=new Uint32Array(R),c.HEAPF32=new Float32Array(R),c.HEAPF64=Ie=new Float64Array(R)}P&&(ae=c.buffer);var Qe=c.INITIAL_MEMORY||16777216;if(P)Z=c.wasmMemory,ae=c.buffer;else if(c.wasmMemory)Z=c.wasmMemory;else if(!((Z=new WebAssembly.Memory({initial:Qe/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw $("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),A&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");Z&&(ae=Z.buffer),Qe=ae.byteLength,At(ae);var On,qn=[],is=[],xr=[],Er=[];function Vs(){return oe||!1}function Sr(){var R=c.preRun.shift();qn.unshift(R)}var yt,dn=0,_u=null,Oi=null;function Xe(R){throw P?postMessage({cmd:"onAbort",arg:R}):c.onAbort&&c.onAbort(R),$(R="Aborted("+R+")"),_e=!0,R=new WebAssembly.RuntimeError(R+". Build with -sASSERTIONS for more info."),f(R),R}function lf(){return yt.startsWith("data:application/octet-stream;base64,")}function wu(){var R=yt;try{if(R==yt&&V)return new Uint8Array(V);if(m)return m(R);throw"both async and sync fetching of the wasm failed"}catch(O){Xe(O)}}yt="ort-wasm-threaded.wasm",lf()||(yt=H(yt));var ab={};function Tr(R){this.name="ExitStatus",this.message="Program terminated with exit("+R+")",this.status=R}function xu(R){(R=De.Vb[R])||Xe(),De.mc(R)}function Eu(R){var O=De.Cc();if(!O)return 6;De.ac.push(O),De.Vb[R.Ub]=O,O.Ub=R.Ub;var U={cmd:"run",start_routine:R.Ic,arg:R.zc,pthread_ptr:R.Ub};return O.$b=()=>{U.time=performance.now(),O.postMessage(U,R.Nc)},O.loaded&&(O.$b(),delete O.$b),0}function En(R){if(P)return ge(1,1,R);Vs()||(De.oc(),c.onExit&&c.onExit(R),_e=!0),T(R,new Tr(R))}function Ka(R,O){if(!O&&P)throw cb(R),"unwind";Vs()||P||($F(),Co(xr),LF(0),US[1].length&&BS(1,10),US[2].length&&BS(2,10),De.oc()),En(R)}var De={Yb:[],ac:[],qc:[],Vb:{},fc:function(){P&&De.Ec()},Pc:function(){},Ec:function(){De.receiveObjectTransfer=De.Gc,De.threadInitTLS=De.pc,De.setExitStatus=De.nc,oe=!1},nc:function(){},oc:function(){for(var R of Object.values(De.Vb))De.mc(R);for(R of De.Yb)R.terminate();De.Yb=[]},mc:function(R){var O=R.Ub;delete De.Vb[O],De.Yb.push(R),De.ac.splice(De.ac.indexOf(R),1),R.Ub=0,zS(O)},Gc:function(){},pc:function(){De.qc.forEach(R=>R())},Fc:function(R,O){R.onmessage=U=>{var W=(U=U.data).cmd;if(R.Ub&&(De.Bc=R.Ub),U.targetThread&&U.targetThread!=db()){var X=De.Vb[U.Qc];X?X.postMessage(U,U.transferList):$('Internal error! Worker sent a message "'+W+'" to target pthread '+U.targetThread+", but that thread no longer exists!")}else W==="processProxyingQueue"?q(U.queue):W==="spawnThread"?Eu(U):W==="cleanupThread"?xu(U.thread):W==="killThread"?(U=U.thread,W=De.Vb[U],delete De.Vb[U],W.terminate(),zS(U),De.ac.splice(De.ac.indexOf(W),1),W.Ub=0):W==="cancelThread"?De.Vb[U.thread].postMessage({cmd:"cancel"}):W==="loaded"?(R.loaded=!0,O&&O(R),R.$b&&(R.$b(),delete R.$b)):W==="print"?M("Thread "+U.threadId+": "+U.text):W==="printErr"?$("Thread "+U.threadId+": "+U.text):W==="alert"?alert("Thread "+U.threadId+": "+U.text):U.target==="setimmediate"?R.postMessage(U):W==="onAbort"?c.onAbort&&c.onAbort(U.arg):W&&$("worker sent an unknown command "+W);De.Bc=void 0},R.onerror=U=>{throw $("worker sent an error! "+U.filename+":"+U.lineno+": "+U.message),U},A&&(R.on("message",function(U){R.onmessage({data:U})}),R.on("error",function(U){R.onerror(U)}),R.on("detachedExit",function(){})),R.postMessage({cmd:"load",urlOrBlob:c.mainScriptUrlOrBlob||n,wasmMemory:Z,wasmModule:le})},yc:function(){var R=H("ort-wasm-threaded.worker.js");De.Yb.push(new Worker(R))},Cc:function(){return De.Yb.length==0&&(De.yc(),De.Fc(De.Yb[0])),De.Yb.pop()}};function Co(R){for(;0<R.length;)R.shift()(c)}function lb(R){var O=ze();return R=R(),Be(O),R}function cb(R){if(P)return ge(2,0,R);try{Ka(R)}catch(O){O instanceof Tr||O=="unwind"||T(1,O)}}c.PThread=De,c.establishStackSpace=function(){var R=db(),O=u()[R+44>>2>>>0];R=u()[R+48>>2>>>0],HF(O,O-R),Be(O)};var Ar=[];function at(R){var O=Ar[R];return O||(R>=Ar.length&&(Ar.length=R+1),Ar[R]=O=On.get(R)),O}c.invokeEntryPoint=function(R,O){R=at(R)(O),Vs()?De.nc(R):zF(R)};var Xa,cf,Ja=[],Oe=0,ke=0;function Pe(R){this.Zb=R,this.Sb=R-24,this.xc=function(O){h()[this.Sb+4>>2>>>0]=O},this.bc=function(){return h()[this.Sb+4>>2>>>0]},this.wc=function(O){h()[this.Sb+8>>2>>>0]=O},this.Dc=function(){return h()[this.Sb+8>>2>>>0]},this.rc=function(){u()[this.Sb>>2>>>0]=0},this.hc=function(O){O=O?1:0,o()[this.Sb+12>>0>>>0]=O},this.uc=function(){return o()[this.Sb+12>>0>>>0]!=0},this.ic=function(O){O=O?1:0,o()[this.Sb+13>>0>>>0]=O},this.kc=function(){return o()[this.Sb+13>>0>>>0]!=0},this.fc=function(O,U){this.cc(0),this.xc(O),this.wc(U),this.rc(),this.hc(!1),this.ic(!1)},this.sc=function(){Atomics.add(u(),this.Sb>>2,1)},this.Hc=function(){return Atomics.sub(u(),this.Sb>>2,1)===1},this.cc=function(O){h()[this.Sb+16>>2>>>0]=O},this.tc=function(){return h()[this.Sb+16>>2>>>0]},this.vc=function(){if(GF(this.bc()))return h()[this.Zb>>2>>>0];var O=this.tc();return O!==0?O:this.Zb}}function uf(R){return FF(new Pe(R).Sb)}function Za(R,O,U,W){return P?ge(3,1,R,O,U,W):df(R,O,U,W)}function df(R,O,U,W){if(typeof SharedArrayBuffer>"u")return $("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var X=[];return P&&X.length===0?Za(R,O,U,W):(R={Ic:U,Ub:R,zc:W,Nc:X},P?(R.Oc="spawnThread",postMessage(R,X),0):Eu(R))}function hf(R,O,U){return P?ge(4,1,R,O,U):0}function ff(R,O){if(P)return ge(5,1,R,O)}function pf(R,O){if(P)return ge(6,1,R,O)}function gf(R,O,U){if(P)return ge(7,1,R,O,U)}function mf(R,O,U){return P?ge(8,1,R,O,U):0}function yf(R,O){if(P)return ge(9,1,R,O)}function bf(R,O,U){if(P)return ge(10,1,R,O,U)}function vf(R,O,U,W){if(P)return ge(11,1,R,O,U,W)}function _f(R,O,U,W){if(P)return ge(12,1,R,O,U,W)}function wf(R,O,U,W){if(P)return ge(13,1,R,O,U,W)}function xf(R){if(P)return ge(14,1,R)}function L(R,O){if(P)return ge(15,1,R,O)}function j(R,O,U){if(P)return ge(16,1,R,O,U)}function q(R){Atomics.store(u(),R>>2,1),db()&&VF(R),Atomics.compareExchange(u(),R>>2,1,0)}function K(R){return h()[R>>>2]+4294967296*u()[R+4>>>2]}function ee(R,O,U,W,X,ne){return P?ge(17,1,R,O,U,W,X,ne):-52}function re(R,O,U,W,X,ne){if(P)return ge(18,1,R,O,U,W,X,ne)}function ue(R){var O=Yt(R)+1,U=VS(O);return U&&Rt(R,o(),U,O),U}function Ee(R,O,U){function W(Je){return(Je=Je.toTimeString().match(/\(([A-Za-z ]+)\)$/))?Je[1]:"GMT"}if(P)return ge(19,1,R,O,U);var X=new Date().getFullYear(),ne=new Date(X,0,1),de=new Date(X,6,1);X=ne.getTimezoneOffset();var Se=de.getTimezoneOffset(),We=Math.max(X,Se);u()[R>>2>>>0]=60*We,u()[O>>2>>>0]=+(X!=Se),R=W(ne),O=W(de),R=ue(R),O=ue(O),Se<X?(h()[U>>2>>>0]=R,h()[U+4>>2>>>0]=O):(h()[U>>2>>>0]=O,h()[U+4>>2>>>0]=R)}function ge(R,O){var U=arguments.length-2,W=arguments;return lb(()=>{for(var X=HS(8*U),ne=X>>3,de=0;de<U;de++){var Se=W[2+de];d()[ne+de>>>0]=Se}return BF(R,U,X,O)})}c.executeNotifiedProxyingQueue=q,cf=A?()=>{var R=process.hrtime();return 1e3*R[0]+R[1]/1e6}:P?()=>performance.now()-c.__performance_now_clock_drift:()=>performance.now();var Ue,ft=[],hn={};function en(){if(!Ue){var R,O={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:S||"./this.program"};for(R in hn)hn[R]===void 0?delete O[R]:O[R]=hn[R];var U=[];for(R in O)U.push(R+"="+O[R]);Ue=U}return Ue}function se(R,O){if(P)return ge(20,1,R,O);var U=0;return en().forEach(function(W,X){var ne=O+U;for(X=h()[R+4*X>>2>>>0]=ne,ne=0;ne<W.length;++ne)o()[X++>>0>>>0]=W.charCodeAt(ne);o()[X>>0>>>0]=0,U+=W.length+1}),0}function et(R,O){if(P)return ge(21,1,R,O);var U=en();h()[R>>2>>>0]=U.length;var W=0;return U.forEach(function(X){W+=X.length+1}),h()[O>>2>>>0]=W,0}function wt(R){return P?ge(22,1,R):52}function zs(R,O,U,W){return P?ge(23,1,R,O,U,W):52}function Cr(R,O,U,W,X){return P?ge(24,1,R,O,U,W,X):70}var US=[null,[],[]];function BS(R,O){var U=US[R];O===0||O===10?((R===1?M:$)(Vt(U,0)),U.length=0):U.push(O)}function PF(R,O,U,W){if(P)return ge(25,1,R,O,U,W);for(var X=0,ne=0;ne<U;ne++){var de=h()[O>>2>>>0],Se=h()[O+4>>2>>>0];O+=8;for(var We=0;We<Se;We++)BS(R,l()[de+We>>>0]);X+=Se}return h()[W>>2>>>0]=X,0}var rs=0;function ub(R){return R%4==0&&(R%100!=0||R%400==0)}var MF=[31,29,31,30,31,30,31,31,30,31,30,31],NF=[31,28,31,30,31,30,31,31,30,31,30,31];function OF(R,O,U,W){function X(ie,tt,Pt){for(ie=typeof ie=="number"?ie.toString():ie||"";ie.length<tt;)ie=Pt[0]+ie;return ie}function ne(ie,tt){return X(ie,tt,"0")}function de(ie,tt){function Pt(Su){return 0>Su?-1:0<Su?1:0}var Ir;return(Ir=Pt(ie.getFullYear()-tt.getFullYear()))===0&&(Ir=Pt(ie.getMonth()-tt.getMonth()))===0&&(Ir=Pt(ie.getDate()-tt.getDate())),Ir}function Se(ie){switch(ie.getDay()){case 0:return new Date(ie.getFullYear()-1,11,29);case 1:return ie;case 2:return new Date(ie.getFullYear(),0,3);case 3:return new Date(ie.getFullYear(),0,2);case 4:return new Date(ie.getFullYear(),0,1);case 5:return new Date(ie.getFullYear()-1,11,31);case 6:return new Date(ie.getFullYear()-1,11,30)}}function We(ie){var tt=ie.Wb;for(ie=new Date(new Date(ie.Xb+1900,0,1).getTime());0<tt;){var Pt=ie.getMonth(),Ir=(ub(ie.getFullYear())?MF:NF)[Pt];if(!(tt>Ir-ie.getDate())){ie.setDate(ie.getDate()+tt);break}tt-=Ir-ie.getDate()+1,ie.setDate(1),11>Pt?ie.setMonth(Pt+1):(ie.setMonth(0),ie.setFullYear(ie.getFullYear()+1))}return Pt=new Date(ie.getFullYear()+1,0,4),tt=Se(new Date(ie.getFullYear(),0,4)),Pt=Se(Pt),0>=de(tt,ie)?0>=de(Pt,ie)?ie.getFullYear()+1:ie.getFullYear():ie.getFullYear()-1}var Je=u()[W+40>>2>>>0];for(var Ft in W={Lc:u()[W>>2>>>0],Kc:u()[W+4>>2>>>0],dc:u()[W+8>>2>>>0],jc:u()[W+12>>2>>>0],ec:u()[W+16>>2>>>0],Xb:u()[W+20>>2>>>0],Tb:u()[W+24>>2>>>0],Wb:u()[W+28>>2>>>0],Rc:u()[W+32>>2>>>0],Jc:u()[W+36>>2>>>0],Mc:Je?ut(Je):""},U=ut(U),Je={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})U=U.replace(new RegExp(Ft,"g"),Je[Ft]);var Fi="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Hs="January February March April May June July August September October November December".split(" ");for(Ft in Je={"%a":function(ie){return Fi[ie.Tb].substring(0,3)},"%A":function(ie){return Fi[ie.Tb]},"%b":function(ie){return Hs[ie.ec].substring(0,3)},"%B":function(ie){return Hs[ie.ec]},"%C":function(ie){return ne((ie.Xb+1900)/100|0,2)},"%d":function(ie){return ne(ie.jc,2)},"%e":function(ie){return X(ie.jc,2," ")},"%g":function(ie){return We(ie).toString().substring(2)},"%G":function(ie){return We(ie)},"%H":function(ie){return ne(ie.dc,2)},"%I":function(ie){return(ie=ie.dc)==0?ie=12:12<ie&&(ie-=12),ne(ie,2)},"%j":function(ie){for(var tt=0,Pt=0;Pt<=ie.ec-1;tt+=(ub(ie.Xb+1900)?MF:NF)[Pt++]);return ne(ie.jc+tt,3)},"%m":function(ie){return ne(ie.ec+1,2)},"%M":function(ie){return ne(ie.Kc,2)},"%n":function(){return`
`},"%p":function(ie){return 0<=ie.dc&&12>ie.dc?"AM":"PM"},"%S":function(ie){return ne(ie.Lc,2)},"%t":function(){return"	"},"%u":function(ie){return ie.Tb||7},"%U":function(ie){return ne(Math.floor((ie.Wb+7-ie.Tb)/7),2)},"%V":function(ie){var tt=Math.floor((ie.Wb+7-(ie.Tb+6)%7)/7);if(2>=(ie.Tb+371-ie.Wb-2)%7&&tt++,tt)tt==53&&((Pt=(ie.Tb+371-ie.Wb)%7)==4||Pt==3&&ub(ie.Xb)||(tt=1));else{tt=52;var Pt=(ie.Tb+7-ie.Wb-1)%7;(Pt==4||Pt==5&&ub(ie.Xb%400-1))&&tt++}return ne(tt,2)},"%w":function(ie){return ie.Tb},"%W":function(ie){return ne(Math.floor((ie.Wb+7-(ie.Tb+6)%7)/7),2)},"%y":function(ie){return(ie.Xb+1900).toString().substring(2)},"%Y":function(ie){return ie.Xb+1900},"%z":function(ie){var tt=0<=(ie=ie.Jc);return ie=Math.abs(ie)/60,(tt?"+":"-")+("0000"+(ie/60*100+ie%60)).slice(-4)},"%Z":function(ie){return ie.Mc},"%%":function(){return"%"}},U=U.replace(/%%/g,"\0\0"),Je)U.includes(Ft)&&(U=U.replace(new RegExp(Ft,"g"),Je[Ft](W)));return Ft=function(ie){var tt=Array(Yt(ie)+1);return Rt(ie,tt,0,tt.length),tt}(U=U.replace(/\0\0/g,"%")),Ft.length>O?0:(function(ie,tt){o().set(ie,tt>>>0)}(Ft,R),Ft.length-1)}De.fc();var HH=[null,En,cb,Za,hf,ff,pf,gf,mf,yf,bf,vf,_f,wf,xf,L,j,ee,re,Ee,se,et,wt,zs,Cr,PF],GH={b:function(R){return VS(R+24)+24},n:function(R){return(R=new Pe(R)).uc()||(R.hc(!0),Oe--),R.ic(!1),Ja.push(R),R.sc(),R.vc()},ma:function(R){throw $("Unexpected exception thrown, this is not properly supported - aborting"),_e=!0,R},x:function(){je(0);var R=Ja.pop();if(R.Hc()&&!R.kc()){var O=R.Dc();O&&at(O)(R.Zb),uf(R.Zb)}ke=0},e:function(){var R=ke;if(!R)return rs=0;var O=new Pe(R);O.cc(R);var U=O.bc();if(!U)return rs=0,R;for(var W=Array.prototype.slice.call(arguments),X=0;X<W.length;X++){var ne=W[X];if(ne===0||ne===U)break;if(fb(ne,U,O.Sb+16))return rs=ne,R}return rs=U,R},l:function(){var R=ke;if(!R)return rs=0;var O=new Pe(R);O.cc(R);var U=O.bc();if(!U)return rs=0,R;for(var W=Array.prototype.slice.call(arguments),X=0;X<W.length;X++){var ne=W[X];if(ne===0||ne===U)break;if(fb(ne,U,O.Sb+16))return rs=ne,R}return rs=U,R},h:function(){var R=ke;if(!R)return rs=0;var O=new Pe(R);O.cc(R);var U=O.bc();if(!U)return rs=0,R;for(var W=Array.prototype.slice.call(arguments),X=0;X<W.length;X++){var ne=W[X];if(ne===0||ne===U)break;if(fb(ne,U,O.Sb+16))return rs=ne,R}return rs=U,R},t:uf,M:function(){var R=Ja.pop();R||Xe("no exception to throw");var O=R.Zb;throw R.kc()||(Ja.push(R),R.ic(!0),R.hc(!1),Oe++),ke=O,O},c:function(R,O,U){throw new Pe(R).fc(O,U),ke=R,Oe++,R},pa:function(){return Oe},Fa:function(R){UF(R,!I,1,!C),De.pc()},T:function(R){P?postMessage({cmd:"cleanupThread",thread:R}):xu(R)},xa:df,j:function(R){throw ke||(ke=R),R},H:hf,Ma:ff,ua:pf,wa:gf,oa:mf,Ka:yf,Ca:bf,Ja:vf,V:_f,va:wf,sa:xf,La:L,ta:j,Ta:function(){},X:function(){Xe("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ua:function(){Xe("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},W:function(){return Date.now()},ya:function(){return 2097152},Oa:function(){return!0},za:function(R,O,U,W){if(R==O)setTimeout(()=>q(W));else if(P)postMessage({targetThread:R,cmd:"processProxyingQueue",queue:W});else{if(!(R=De.Vb[R]))return;R.postMessage({cmd:"processProxyingQueue",queue:W})}return 1},Ea:function(){return-1},Pa:function(R,O){R=new Date(1e3*K(R)),u()[O>>2>>>0]=R.getUTCSeconds(),u()[O+4>>2>>>0]=R.getUTCMinutes(),u()[O+8>>2>>>0]=R.getUTCHours(),u()[O+12>>2>>>0]=R.getUTCDate(),u()[O+16>>2>>>0]=R.getUTCMonth(),u()[O+20>>2>>>0]=R.getUTCFullYear()-1900,u()[O+24>>2>>>0]=R.getUTCDay(),R=(R.getTime()-Date.UTC(R.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,u()[O+28>>2>>>0]=R},Qa:function(R,O){R=new Date(1e3*K(R)),u()[O>>2>>>0]=R.getSeconds(),u()[O+4>>2>>>0]=R.getMinutes(),u()[O+8>>2>>>0]=R.getHours(),u()[O+12>>2>>>0]=R.getDate(),u()[O+16>>2>>>0]=R.getMonth(),u()[O+20>>2>>>0]=R.getFullYear()-1900,u()[O+24>>2>>>0]=R.getDay();var U=new Date(R.getFullYear(),0,1),W=(R.getTime()-U.getTime())/864e5|0;u()[O+28>>2>>>0]=W,u()[O+36>>2>>>0]=-60*R.getTimezoneOffset(),W=new Date(R.getFullYear(),6,1).getTimezoneOffset(),R=0|(W!=(U=U.getTimezoneOffset())&&R.getTimezoneOffset()==Math.min(U,W)),u()[O+32>>2>>>0]=R},Ra:function(R){var O=new Date(u()[R+20>>2>>>0]+1900,u()[R+16>>2>>>0],u()[R+12>>2>>>0],u()[R+8>>2>>>0],u()[R+4>>2>>>0],u()[R>>2>>>0],0),U=u()[R+32>>2>>>0],W=O.getTimezoneOffset(),X=new Date(O.getFullYear(),0,1),ne=new Date(O.getFullYear(),6,1).getTimezoneOffset(),de=X.getTimezoneOffset(),Se=Math.min(de,ne);return 0>U?u()[R+32>>2>>>0]=+(ne!=de&&Se==W):0<U!=(Se==W)&&(ne=Math.max(de,ne),O.setTime(O.getTime()+6e4*((0<U?Se:ne)-W))),u()[R+24>>2>>>0]=O.getDay(),U=(O.getTime()-X.getTime())/864e5|0,u()[R+28>>2>>>0]=U,u()[R>>2>>>0]=O.getSeconds(),u()[R+4>>2>>>0]=O.getMinutes(),u()[R+8>>2>>>0]=O.getHours(),u()[R+12>>2>>>0]=O.getDate(),u()[R+16>>2>>>0]=O.getMonth(),O.getTime()/1e3|0},Aa:ee,Ba:re,Sa:function R(O,U,W){R.Ac||(R.Ac=!0,Ee(O,U,W))},y:function(){Xe("")},U:function(){if(!A&&!I){var R="Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread";Xa||(Xa={}),Xa[R]||(Xa[R]=1,A&&(R="warning: "+R),$(R))}},ra:function(){return 4294901760},B:cf,Ia:function(R,O,U){l().copyWithin(R>>>0,O>>>0,O+U>>>0)},F:function(){return A?t(3993).cpus().length:navigator.hardwareConcurrency},Da:function(R,O,U){ft.length=O,U>>=3;for(var W=0;W<O;W++)ft[W]=d()[U+W>>>0];return(0>R?ab[-R-1]:HH[R]).apply(null,ft)},qa:function(R){var O=l().length;if((R>>>=0)<=O||4294901760<R)return!1;for(var U=1;4>=U;U*=2){var W=O*(1+.2/U);W=Math.min(W,R+100663296);var X=Math;W=Math.max(R,W),X=X.min.call(X,4294901760,W+(65536-W%65536)%65536);e:{try{Z.grow(X-ae.byteLength+65535>>>16),At(Z.buffer);var ne=1;break e}catch{}ne=void 0}if(ne)return!0}return!1},Na:function(){throw"unwind"},Ga:se,Ha:et,J:Ka,I:wt,S:zs,ga:Cr,R:PF,d:function(){return rs},na:function R(O,U){R.lc||(R.lc=function(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var X=new Uint8Array(1);return()=>(crypto.getRandomValues(X),X[0])}if(A)try{var ne=t(Object(function(){var de=new Error("Cannot find module 'crypto'");throw de.code="MODULE_NOT_FOUND",de}()));return()=>ne.randomBytes(1)[0]}catch{}return()=>Xe("randomDevice")}());for(var W=0;W<U;W++)o()[O+W>>0>>>0]=R.lc();return 0},ia:function(R,O,U){var W=ze();try{return at(R)(O,U)}catch(X){if(Be(W),X!==X+0)throw X;je(1,0)}},ja:function(R,O,U){var W=ze();try{return at(R)(O,U)}catch(X){if(Be(W),X!==X+0)throw X;je(1,0)}},K:function(R){var O=ze();try{return at(R)()}catch(U){if(Be(O),U!==U+0)throw U;je(1,0)}},f:function(R,O){var U=ze();try{return at(R)(O)}catch(W){if(Be(U),W!==W+0)throw W;je(1,0)}},P:function(R,O,U){var W=ze();try{return at(R)(O,U)}catch(X){if(Be(W),X!==X+0)throw X;je(1,0)}},Q:function(R,O,U){var W=ze();try{return at(R)(O,U)}catch(X){if(Be(W),X!==X+0)throw X;je(1,0)}},k:function(R,O,U){var W=ze();try{return at(R)(O,U)}catch(X){if(Be(W),X!==X+0)throw X;je(1,0)}},p:function(R,O,U,W){var X=ze();try{return at(R)(O,U,W)}catch(ne){if(Be(X),ne!==ne+0)throw ne;je(1,0)}},q:function(R,O,U,W,X){var ne=ze();try{return at(R)(O,U,W,X)}catch(de){if(Be(ne),de!==de+0)throw de;je(1,0)}},N:function(R,O,U,W,X,ne){var de=ze();try{return at(R)(O,U,W,X,ne)}catch(Se){if(Be(de),Se!==Se+0)throw Se;je(1,0)}},s:function(R,O,U,W,X,ne){var de=ze();try{return at(R)(O,U,W,X,ne)}catch(Se){if(Be(de),Se!==Se+0)throw Se;je(1,0)}},w:function(R,O,U,W,X,ne,de){var Se=ze();try{return at(R)(O,U,W,X,ne,de)}catch(We){if(Be(Se),We!==We+0)throw We;je(1,0)}},L:function(R,O,U,W,X,ne,de,Se){var We=ze();try{return at(R)(O,U,W,X,ne,de,Se)}catch(Je){if(Be(We),Je!==Je+0)throw Je;je(1,0)}},E:function(R,O,U,W,X,ne,de,Se,We,Je,Ft,Fi){var Hs=ze();try{return at(R)(O,U,W,X,ne,de,Se,We,Je,Ft,Fi)}catch(ie){if(Be(Hs),ie!==ie+0)throw ie;je(1,0)}},aa:function(R,O,U,W,X,ne,de,Se){var We=ze();try{return QF(R,O,U,W,X,ne,de,Se)}catch(Je){if(Be(We),Je!==Je+0)throw Je;je(1,0)}},_:function(R,O,U,W,X,ne,de){var Se=ze();try{return WF(R,O,U,W,X,ne,de)}catch(We){if(Be(Se),We!==We+0)throw We;je(1,0)}},Z:function(R,O,U,W,X){var ne=ze();try{return eL(R,O,U,W,X)}catch(de){if(Be(ne),de!==de+0)throw de;je(1,0)}},ca:function(R,O,U,W){var X=ze();try{return JF(R,O,U,W)}catch(ne){if(Be(X),ne!==ne+0)throw ne;je(1,0)}},$:function(R){var O=ze();try{return jF(R)}catch(U){if(Be(O),U!==U+0)throw U;je(1,0)}},ba:function(R,O){var U=ze();try{return ZF(R,O)}catch(W){if(Be(U),W!==W+0)throw W;je(1,0)}},Y:function(R,O,U){var W=ze();try{return qF(R,O,U)}catch(X){if(Be(W),X!==X+0)throw X;je(1,0)}},g:function(R){var O=ze();try{at(R)()}catch(U){if(Be(O),U!==U+0)throw U;je(1,0)}},r:function(R,O){var U=ze();try{at(R)(O)}catch(W){if(Be(U),W!==W+0)throw W;je(1,0)}},i:function(R,O,U){var W=ze();try{at(R)(O,U)}catch(X){if(Be(W),X!==X+0)throw X;je(1,0)}},ha:function(R,O,U,W){var X=ze();try{at(R)(O,U,W)}catch(ne){if(Be(X),ne!==ne+0)throw ne;je(1,0)}},m:function(R,O,U,W){var X=ze();try{at(R)(O,U,W)}catch(ne){if(Be(X),ne!==ne+0)throw ne;je(1,0)}},v:function(R,O,U,W,X){var ne=ze();try{at(R)(O,U,W,X)}catch(de){if(Be(ne),de!==de+0)throw de;je(1,0)}},u:function(R,O,U,W,X,ne){var de=ze();try{at(R)(O,U,W,X,ne)}catch(Se){if(Be(de),Se!==Se+0)throw Se;je(1,0)}},O:function(R,O,U,W,X,ne,de){var Se=ze();try{at(R)(O,U,W,X,ne,de)}catch(We){if(Be(Se),We!==We+0)throw We;je(1,0)}},A:function(R,O,U,W,X,ne,de,Se){var We=ze();try{at(R)(O,U,W,X,ne,de,Se)}catch(Je){if(Be(We),Je!==Je+0)throw Je;je(1,0)}},ka:function(R,O,U,W,X,ne,de,Se,We){var Je=ze();try{at(R)(O,U,W,X,ne,de,Se,We)}catch(Ft){if(Be(Je),Ft!==Ft+0)throw Ft;je(1,0)}},C:function(R,O,U,W,X,ne,de,Se,We,Je,Ft){var Fi=ze();try{at(R)(O,U,W,X,ne,de,Se,We,Je,Ft)}catch(Hs){if(Be(Fi),Hs!==Hs+0)throw Hs;je(1,0)}},D:function(R,O,U,W,X,ne,de,Se,We,Je,Ft,Fi,Hs,ie,tt,Pt){var Ir=ze();try{at(R)(O,U,W,X,ne,de,Se,We,Je,Ft,Fi,Hs,ie,tt,Pt)}catch(Su){if(Be(Ir),Su!==Su+0)throw Su;je(1,0)}},fa:function(R,O,U,W,X,ne,de,Se){var We=ze();try{YF(R,O,U,W,X,ne,de,Se)}catch(Je){if(Be(We),Je!==Je+0)throw Je;je(1,0)}},da:function(R,O,U,W,X,ne,de,Se,We,Je,Ft,Fi){var Hs=ze();try{XF(R,O,U,W,X,ne,de,Se,We,Je,Ft,Fi)}catch(ie){if(Be(Hs),ie!==ie+0)throw ie;je(1,0)}},ea:function(R,O,U,W,X,ne){var de=ze();try{KF(R,O,U,W,X,ne)}catch(Se){if(Be(de),Se!==Se+0)throw Se;je(1,0)}},o:function(R){return R},a:Z||c.wasmMemory,G:function(R){rs=R},la:OF,z:function(R,O,U,W){return OF(R,O,U,W)}};(function(){function R(X,ne){c.asm=X.exports,De.qc.push(c.asm.sb),On=c.asm.ub,is.unshift(c.asm.Va),le=ne,P||(dn--,c.monitorRunDependencies&&c.monitorRunDependencies(dn),dn==0&&(_u!==null&&(clearInterval(_u),_u=null),Oi&&(X=Oi,Oi=null,X())))}function O(X){R(X.instance,X.module)}function U(X){return function(){if(!V&&(C||I)){if(typeof fetch=="function"&&!yt.startsWith("file://"))return fetch(yt,{credentials:"same-origin"}).then(function(ne){if(!ne.ok)throw"failed to load wasm binary file at '"+yt+"'";return ne.arrayBuffer()}).catch(function(){return wu()});if(g)return new Promise(function(ne,de){g(yt,function(Se){ne(new Uint8Array(Se))},de)})}return Promise.resolve().then(function(){return wu()})}().then(function(ne){return WebAssembly.instantiate(ne,W)}).then(function(ne){return ne}).then(X,function(ne){$("failed to asynchronously prepare wasm: "+ne),Xe(ne)})}var W={a:GH};if(P||(dn++,c.monitorRunDependencies&&c.monitorRunDependencies(dn)),c.instantiateWasm)try{return c.instantiateWasm(W,R)}catch(X){return $("Module.instantiateWasm callback failed with error: "+X),!1}(V||typeof WebAssembly.instantiateStreaming!="function"||lf()||yt.startsWith("file://")||A||typeof fetch!="function"?U(O):fetch(yt,{credentials:"same-origin"}).then(function(X){return WebAssembly.instantiateStreaming(X,W).then(O,function(ne){return $("wasm streaming compile failed: "+ne),$("falling back to ArrayBuffer instantiation"),U(O)})})).catch(f)})(),c.___wasm_call_ctors=function(){return(c.___wasm_call_ctors=c.asm.Va).apply(null,arguments)},c._OrtInit=function(){return(c._OrtInit=c.asm.Wa).apply(null,arguments)},c._OrtCreateSessionOptions=function(){return(c._OrtCreateSessionOptions=c.asm.Xa).apply(null,arguments)},c._OrtAppendExecutionProvider=function(){return(c._OrtAppendExecutionProvider=c.asm.Ya).apply(null,arguments)},c._OrtAddSessionConfigEntry=function(){return(c._OrtAddSessionConfigEntry=c.asm.Za).apply(null,arguments)},c._OrtReleaseSessionOptions=function(){return(c._OrtReleaseSessionOptions=c.asm._a).apply(null,arguments)},c._OrtCreateSession=function(){return(c._OrtCreateSession=c.asm.$a).apply(null,arguments)},c._OrtReleaseSession=function(){return(c._OrtReleaseSession=c.asm.ab).apply(null,arguments)},c._OrtGetInputCount=function(){return(c._OrtGetInputCount=c.asm.bb).apply(null,arguments)},c._OrtGetOutputCount=function(){return(c._OrtGetOutputCount=c.asm.cb).apply(null,arguments)},c._OrtGetInputName=function(){return(c._OrtGetInputName=c.asm.db).apply(null,arguments)},c._OrtGetOutputName=function(){return(c._OrtGetOutputName=c.asm.eb).apply(null,arguments)},c._OrtFree=function(){return(c._OrtFree=c.asm.fb).apply(null,arguments)},c._OrtCreateTensor=function(){return(c._OrtCreateTensor=c.asm.gb).apply(null,arguments)},c._OrtGetTensorData=function(){return(c._OrtGetTensorData=c.asm.hb).apply(null,arguments)},c._OrtReleaseTensor=function(){return(c._OrtReleaseTensor=c.asm.ib).apply(null,arguments)},c._OrtCreateRunOptions=function(){return(c._OrtCreateRunOptions=c.asm.jb).apply(null,arguments)},c._OrtAddRunConfigEntry=function(){return(c._OrtAddRunConfigEntry=c.asm.kb).apply(null,arguments)},c._OrtReleaseRunOptions=function(){return(c._OrtReleaseRunOptions=c.asm.lb).apply(null,arguments)},c._OrtRun=function(){return(c._OrtRun=c.asm.mb).apply(null,arguments)},c._OrtEndProfiling=function(){return(c._OrtEndProfiling=c.asm.nb).apply(null,arguments)};var db=c._pthread_self=function(){return(db=c._pthread_self=c.asm.ob).apply(null,arguments)},VS=c._malloc=function(){return(VS=c._malloc=c.asm.pb).apply(null,arguments)},FF=c._free=function(){return(FF=c._free=c.asm.qb).apply(null,arguments)},LF=c._fflush=function(){return(LF=c._fflush=c.asm.rb).apply(null,arguments)};c.__emscripten_tls_init=function(){return(c.__emscripten_tls_init=c.asm.sb).apply(null,arguments)};var $F=c.___funcs_on_exit=function(){return($F=c.___funcs_on_exit=c.asm.tb).apply(null,arguments)},UF=c.__emscripten_thread_init=function(){return(UF=c.__emscripten_thread_init=c.asm.vb).apply(null,arguments)};c.__emscripten_thread_crashed=function(){return(c.__emscripten_thread_crashed=c.asm.wb).apply(null,arguments)};var hb,BF=c._emscripten_run_in_main_runtime_thread_js=function(){return(BF=c._emscripten_run_in_main_runtime_thread_js=c.asm.xb).apply(null,arguments)},VF=c.__emscripten_proxy_execute_task_queue=function(){return(VF=c.__emscripten_proxy_execute_task_queue=c.asm.yb).apply(null,arguments)},zS=c.__emscripten_thread_free_data=function(){return(zS=c.__emscripten_thread_free_data=c.asm.zb).apply(null,arguments)},zF=c.__emscripten_thread_exit=function(){return(zF=c.__emscripten_thread_exit=c.asm.Ab).apply(null,arguments)},je=c._setThrew=function(){return(je=c._setThrew=c.asm.Bb).apply(null,arguments)},HF=c._emscripten_stack_set_limits=function(){return(HF=c._emscripten_stack_set_limits=c.asm.Cb).apply(null,arguments)},ze=c.stackSave=function(){return(ze=c.stackSave=c.asm.Db).apply(null,arguments)},Be=c.stackRestore=function(){return(Be=c.stackRestore=c.asm.Eb).apply(null,arguments)},HS=c.stackAlloc=function(){return(HS=c.stackAlloc=c.asm.Fb).apply(null,arguments)},fb=c.___cxa_can_catch=function(){return(fb=c.___cxa_can_catch=c.asm.Gb).apply(null,arguments)},GF=c.___cxa_is_pointer_type=function(){return(GF=c.___cxa_is_pointer_type=c.asm.Hb).apply(null,arguments)},jF=c.dynCall_j=function(){return(jF=c.dynCall_j=c.asm.Ib).apply(null,arguments)},WF=c.dynCall_iiiiij=function(){return(WF=c.dynCall_iiiiij=c.asm.Jb).apply(null,arguments)},qF=c.dynCall_jii=function(){return(qF=c.dynCall_jii=c.asm.Kb).apply(null,arguments)},YF=c.dynCall_viiiiij=function(){return(YF=c.dynCall_viiiiij=c.asm.Lb).apply(null,arguments)},KF=c.dynCall_vjji=function(){return(KF=c.dynCall_vjji=c.asm.Mb).apply(null,arguments)},XF=c.dynCall_viiijjjii=function(){return(XF=c.dynCall_viiijjjii=c.asm.Nb).apply(null,arguments)},JF=c.dynCall_iij=function(){return(JF=c.dynCall_iij=c.asm.Ob).apply(null,arguments)},ZF=c.dynCall_ji=function(){return(ZF=c.dynCall_ji=c.asm.Pb).apply(null,arguments)},QF=c.dynCall_iiiiiij=function(){return(QF=c.dynCall_iiiiiij=c.asm.Qb).apply(null,arguments)},eL=c.dynCall_iiij=function(){return(eL=c.dynCall_iiij=c.asm.Rb).apply(null,arguments)};function tL(){function R(){if(!hb&&(hb=!0,c.calledRun=!0,!_e)&&(P||Co(is),a(c),c.onRuntimeInitialized&&c.onRuntimeInitialized(),!P)){if(c.postRun)for(typeof c.postRun=="function"&&(c.postRun=[c.postRun]);c.postRun.length;){var O=c.postRun.shift();Er.unshift(O)}Co(Er)}}if(!(0<dn))if(P)a(c),P||Co(is),postMessage({cmd:"loaded"});else{if(c.preRun)for(typeof c.preRun=="function"&&(c.preRun=[c.preRun]);c.preRun.length;)Sr();Co(qn),0<dn||(c.setStatus?(c.setStatus("Running..."),setTimeout(function(){setTimeout(function(){c.setStatus("")},1),R()},1)):R())}}if(c.UTF8ToString=ut,c.stringToUTF8=function(R,O,U){return Rt(R,l(),O,U)},c.lengthBytesUTF8=Yt,c.keepRuntimeAlive=Vs,c.wasmMemory=Z,c.stackSave=ze,c.stackRestore=Be,c.stackAlloc=HS,c.ExitStatus=Tr,c.PThread=De,Oi=function R(){hb||tL(),hb||(Oi=R)},c.preInit)for(typeof c.preInit=="function"&&(c.preInit=[c.preInit]);0<c.preInit.length;)c.preInit.pop()();return tL(),r.ready});s.exports=i},932:(s,e,t)=>{var n,i=(n=(n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(r){var o,l,u;r=r||{},o||(o=r!==void 0?r:{}),o.ready=new Promise(function(L,j){l=L,u=j});var h,d,c,a,f,p,g=Object.assign({},o),m="./this.program",y=(L,j)=>{throw j},_=typeof window=="object",x=typeof importScripts=="function",E=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",S="";E?(S=x?t(908).dirname(S)+"/":"//",p=()=>{f||(a=t(1384),f=t(908))},h=function(L,j){return p(),L=f.normalize(L),a.readFileSync(L,j?void 0:"utf8")},c=L=>((L=h(L,!0)).buffer||(L=new Uint8Array(L)),L),d=(L,j,q)=>{p(),L=f.normalize(L),a.readFile(L,function(K,ee){K?q(K):j(ee.buffer)})},1<process.argv.length&&(m=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(L){if(!(L instanceof xr))throw L}),process.on("unhandledRejection",function(L){throw L}),y=(L,j)=>{if(A||0<ht)throw process.exitCode=L,j;j instanceof xr||I("exiting due to exception: "+j),process.exit(L)},o.inspect=function(){return"[Emscripten Module object]"}):(_||x)&&(x?S=self.location.href:typeof document<"u"&&document.currentScript&&(S=document.currentScript.src),n&&(S=n),S=S.indexOf("blob:")!==0?S.substr(0,S.replace(/[?#].*/,"").lastIndexOf("/")+1):"",h=L=>{var j=new XMLHttpRequest;return j.open("GET",L,!1),j.send(null),j.responseText},x&&(c=L=>{var j=new XMLHttpRequest;return j.open("GET",L,!1),j.responseType="arraybuffer",j.send(null),new Uint8Array(j.response)}),d=(L,j,q)=>{var K=new XMLHttpRequest;K.open("GET",L,!0),K.responseType="arraybuffer",K.onload=()=>{K.status==200||K.status==0&&K.response?j(K.response):q()},K.onerror=q,K.send(null)});var T,C=o.print||console.log.bind(console),I=o.printErr||console.warn.bind(console);Object.assign(o,g),g=null,o.thisProgram&&(m=o.thisProgram),o.quit&&(y=o.quit),o.wasmBinary&&(T=o.wasmBinary);var A=o.noExitRuntime||!1;typeof WebAssembly!="object"&&Qe("no native wasm support detected");var P,F,H,z,B,V,M=!1,$=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function oe(L,j,q){var K=(j>>>=0)+q;for(q=j;L[q]&&!(q>=K);)++q;if(16<q-j&&L.buffer&&$)return $.decode(L.subarray(j,q));for(K="";j<q;){var ee=L[j++];if(128&ee){var re=63&L[j++];if((224&ee)==192)K+=String.fromCharCode((31&ee)<<6|re);else{var ue=63&L[j++];65536>(ee=(240&ee)==224?(15&ee)<<12|re<<6|ue:(7&ee)<<18|re<<12|ue<<6|63&L[j++])?K+=String.fromCharCode(ee):(ee-=65536,K+=String.fromCharCode(55296|ee>>10,56320|1023&ee))}}else K+=String.fromCharCode(ee)}return K}function Z(L,j){return(L>>>=0)?oe(z,L,j):""}function le(L,j,q,K){if(!(0<K))return 0;var ee=q>>>=0;K=q+K-1;for(var re=0;re<L.length;++re){var ue=L.charCodeAt(re);if(55296<=ue&&57343>=ue&&(ue=65536+((1023&ue)<<10)|1023&L.charCodeAt(++re)),127>=ue){if(q>=K)break;j[q++>>>0]=ue}else{if(2047>=ue){if(q+1>=K)break;j[q++>>>0]=192|ue>>6}else{if(65535>=ue){if(q+2>=K)break;j[q++>>>0]=224|ue>>12}else{if(q+3>=K)break;j[q++>>>0]=240|ue>>18,j[q++>>>0]=128|ue>>12&63}j[q++>>>0]=128|ue>>6&63}j[q++>>>0]=128|63&ue}}return j[q>>>0]=0,q-ee}function ae(L){for(var j=0,q=0;q<L.length;++q){var K=L.charCodeAt(q);127>=K?j++:2047>=K?j+=2:55296<=K&&57343>=K?(j+=4,++q):j+=3}return j}function be(){var L=P.buffer;F=L,o.HEAP8=H=new Int8Array(L),o.HEAP16=new Int16Array(L),o.HEAP32=B=new Int32Array(L),o.HEAPU8=z=new Uint8Array(L),o.HEAPU16=new Uint16Array(L),o.HEAPU32=V=new Uint32Array(L),o.HEAPF32=new Float32Array(L),o.HEAPF64=new Float64Array(L)}var Ce,Ze=[],Ae=[],Ie=[],_e=[],ht=0;function Vt(){var L=o.preRun.shift();Ze.unshift(L)}var ut,Rt=0,Yt=null,At=null;function Qe(L){throw o.onAbort&&o.onAbort(L),I(L="Aborted("+L+")"),M=!0,L=new WebAssembly.RuntimeError(L+". Build with -sASSERTIONS for more info."),u(L),L}function On(){return ut.startsWith("data:application/octet-stream;base64,")}if(ut="ort-wasm.wasm",!On()){var qn=ut;ut=o.locateFile?o.locateFile(qn,S):S+qn}function is(){var L=ut;try{if(L==ut&&T)return new Uint8Array(T);if(c)return c(L);throw"both async and sync fetching of the wasm failed"}catch(j){Qe(j)}}function xr(L){this.name="ExitStatus",this.message="Program terminated with exit("+L+")",this.status=L}function Er(L){for(;0<L.length;)L.shift()(o)}var Vs=[],Sr=0,yt=0;function dn(L){this.Db=L,this.zb=L-24,this.Ub=function(j){V[this.zb+4>>2>>>0]=j},this.Eb=function(){return V[this.zb+4>>2>>>0]},this.Sb=function(j){V[this.zb+8>>2>>>0]=j},this.Wb=function(){return V[this.zb+8>>2>>>0]},this.Tb=function(){B[this.zb>>2>>>0]=0},this.Ib=function(j){H[this.zb+12>>0>>>0]=j?1:0},this.Pb=function(){return H[this.zb+12>>0>>>0]!=0},this.Jb=function(j){H[this.zb+13>>0>>>0]=j?1:0},this.Lb=function(){return H[this.zb+13>>0>>>0]!=0},this.Rb=function(j,q){this.Fb(0),this.Ub(j),this.Sb(q),this.Tb(),this.Ib(!1),this.Jb(!1)},this.Nb=function(){B[this.zb>>2>>>0]+=1},this.Xb=function(){var j=B[this.zb>>2>>>0];return B[this.zb>>2>>>0]=j-1,j===1},this.Fb=function(j){V[this.zb+16>>2>>>0]=j},this.Ob=function(){return V[this.zb+16>>2>>>0]},this.Qb=function(){if(df(this.Eb()))return V[this.Db>>2>>>0];var j=this.Ob();return j!==0?j:this.Db}}function _u(L){return Xa(new dn(L).zb)}var Oi=[];function Xe(L){var j=Oi[L];return j||(L>=Oi.length&&(Oi.length=L+1),Oi[L]=j=Ce.get(L)),j}function lf(L){var j=ae(L)+1,q=at(j);return q&&le(L,H,q,j),q}var wu={};function ab(){if(!Tr){var L,j={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:m||"./this.program"};for(L in wu)wu[L]===void 0?delete j[L]:j[L]=wu[L];var q=[];for(L in j)q.push(L+"="+j[L]);Tr=q}return Tr}var Tr,xu=[null,[],[]];function Eu(L,j){var q=xu[L];j===0||j===10?((L===1?C:I)(oe(q,0)),q.length=0):q.push(j)}var En=0;function Ka(L){return L%4==0&&(L%100!=0||L%400==0)}var De=[31,29,31,30,31,30,31,31,30,31,30,31],Co=[31,28,31,30,31,30,31,31,30,31,30,31];function lb(L,j,q,K){function ee(se,et,wt){for(se=typeof se=="number"?se.toString():se||"";se.length<et;)se=wt[0]+se;return se}function re(se,et){return ee(se,et,"0")}function ue(se,et){function wt(Cr){return 0>Cr?-1:0<Cr?1:0}var zs;return(zs=wt(se.getFullYear()-et.getFullYear()))===0&&(zs=wt(se.getMonth()-et.getMonth()))===0&&(zs=wt(se.getDate()-et.getDate())),zs}function Ee(se){switch(se.getDay()){case 0:return new Date(se.getFullYear()-1,11,29);case 1:return se;case 2:return new Date(se.getFullYear(),0,3);case 3:return new Date(se.getFullYear(),0,2);case 4:return new Date(se.getFullYear(),0,1);case 5:return new Date(se.getFullYear()-1,11,31);case 6:return new Date(se.getFullYear()-1,11,30)}}function ge(se){var et=se.Bb;for(se=new Date(new Date(se.Cb+1900,0,1).getTime());0<et;){var wt=se.getMonth(),zs=(Ka(se.getFullYear())?De:Co)[wt];if(!(et>zs-se.getDate())){se.setDate(se.getDate()+et);break}et-=zs-se.getDate()+1,se.setDate(1),11>wt?se.setMonth(wt+1):(se.setMonth(0),se.setFullYear(se.getFullYear()+1))}return wt=new Date(se.getFullYear()+1,0,4),et=Ee(new Date(se.getFullYear(),0,4)),wt=Ee(wt),0>=ue(et,se)?0>=ue(wt,se)?se.getFullYear()+1:se.getFullYear():se.getFullYear()-1}var Ue=B[K+40>>2>>>0];for(var ft in K={$b:B[K>>2>>>0],Zb:B[K+4>>2>>>0],Gb:B[K+8>>2>>>0],Kb:B[K+12>>2>>>0],Hb:B[K+16>>2>>>0],Cb:B[K+20>>2>>>0],Ab:B[K+24>>2>>>0],Bb:B[K+28>>2>>>0],bc:B[K+32>>2>>>0],Yb:B[K+36>>2>>>0],ac:Ue?Z(Ue):""},q=Z(q),Ue={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})q=q.replace(new RegExp(ft,"g"),Ue[ft]);var hn="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),en="January February March April May June July August September October November December".split(" ");for(ft in Ue={"%a":function(se){return hn[se.Ab].substring(0,3)},"%A":function(se){return hn[se.Ab]},"%b":function(se){return en[se.Hb].substring(0,3)},"%B":function(se){return en[se.Hb]},"%C":function(se){return re((se.Cb+1900)/100|0,2)},"%d":function(se){return re(se.Kb,2)},"%e":function(se){return ee(se.Kb,2," ")},"%g":function(se){return ge(se).toString().substring(2)},"%G":function(se){return ge(se)},"%H":function(se){return re(se.Gb,2)},"%I":function(se){return(se=se.Gb)==0?se=12:12<se&&(se-=12),re(se,2)},"%j":function(se){for(var et=0,wt=0;wt<=se.Hb-1;et+=(Ka(se.Cb+1900)?De:Co)[wt++]);return re(se.Kb+et,3)},"%m":function(se){return re(se.Hb+1,2)},"%M":function(se){return re(se.Zb,2)},"%n":function(){return`
`},"%p":function(se){return 0<=se.Gb&&12>se.Gb?"AM":"PM"},"%S":function(se){return re(se.$b,2)},"%t":function(){return"	"},"%u":function(se){return se.Ab||7},"%U":function(se){return re(Math.floor((se.Bb+7-se.Ab)/7),2)},"%V":function(se){var et=Math.floor((se.Bb+7-(se.Ab+6)%7)/7);if(2>=(se.Ab+371-se.Bb-2)%7&&et++,et)et==53&&((wt=(se.Ab+371-se.Bb)%7)==4||wt==3&&Ka(se.Cb)||(et=1));else{et=52;var wt=(se.Ab+7-se.Bb-1)%7;(wt==4||wt==5&&Ka(se.Cb%400-1))&&et++}return re(et,2)},"%w":function(se){return se.Ab},"%W":function(se){return re(Math.floor((se.Bb+7-(se.Ab+6)%7)/7),2)},"%y":function(se){return(se.Cb+1900).toString().substring(2)},"%Y":function(se){return se.Cb+1900},"%z":function(se){var et=0<=(se=se.Yb);return se=Math.abs(se)/60,(et?"+":"-")+("0000"+(se/60*100+se%60)).slice(-4)},"%Z":function(se){return se.ac},"%%":function(){return"%"}},q=q.replace(/%%/g,"\0\0"),Ue)q.includes(ft)&&(q=q.replace(new RegExp(ft,"g"),Ue[ft](K)));return ft=function(se){var et=Array(ae(se)+1);return le(se,et,0,et.length),et}(q=q.replace(/\0\0/g,"%")),ft.length>j?0:(H.set(ft,L>>>0),ft.length-1)}var cb={a:function(L){return at(L+24)+24},m:function(L){return(L=new dn(L)).Pb()||(L.Ib(!0),Sr--),L.Jb(!1),Vs.push(L),L.Nb(),L.Qb()},ia:function(L){throw I("Unexpected exception thrown, this is not properly supported - aborting"),M=!0,L},w:function(){Oe(0);var L=Vs.pop();if(L.Xb()&&!L.Lb()){var j=L.Wb();j&&Xe(j)(L.Db),_u(L.Db)}yt=0},d:function(){var L=yt;if(!L)return En=0;var j=new dn(L);j.Fb(L);var q=j.Eb();if(!q)return En=0,L;for(var K=Array.prototype.slice.call(arguments),ee=0;ee<K.length;ee++){var re=K[ee];if(re===0||re===q)break;if(Za(re,q,j.zb+16))return En=re,L}return En=q,L},k:function(){var L=yt;if(!L)return En=0;var j=new dn(L);j.Fb(L);var q=j.Eb();if(!q)return En=0,L;for(var K=Array.prototype.slice.call(arguments),ee=0;ee<K.length;ee++){var re=K[ee];if(re===0||re===q)break;if(Za(re,q,j.zb+16))return En=re,L}return En=q,L},g:function(){var L=yt;if(!L)return En=0;var j=new dn(L);j.Fb(L);var q=j.Eb();if(!q)return En=0,L;for(var K=Array.prototype.slice.call(arguments),ee=0;ee<K.length;ee++){var re=K[ee];if(re===0||re===q)break;if(Za(re,q,j.zb+16))return En=re,L}return En=q,L},s:_u,L:function(){var L=Vs.pop();L||Qe("no exception to throw");var j=L.Db;throw L.Lb()||(Vs.push(L),L.Jb(!0),L.Ib(!1),Sr++),yt=j,j},b:function(L,j,q){throw new dn(L).Rb(j,q),yt=L,Sr++,L},la:function(){return Sr},i:function(L){throw yt||(yt=L),L},H:function(){return 0},Ba:function(){},pa:function(){},ra:function(){},ka:function(){return 0},za:function(){},ua:function(){},ya:function(){},R:function(){},qa:function(){},na:function(){},Aa:function(){},oa:function(){},Ha:function(){},Ja:function(){Qe("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ia:function(){Qe("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},S:function(){return Date.now()},Ca:function(){return!0},Da:function(L,j){L=new Date(1e3*(V[L>>>2]+4294967296*B[L+4>>>2])),B[j>>2>>>0]=L.getUTCSeconds(),B[j+4>>2>>>0]=L.getUTCMinutes(),B[j+8>>2>>>0]=L.getUTCHours(),B[j+12>>2>>>0]=L.getUTCDate(),B[j+16>>2>>>0]=L.getUTCMonth(),B[j+20>>2>>>0]=L.getUTCFullYear()-1900,B[j+24>>2>>>0]=L.getUTCDay(),B[j+28>>2>>>0]=(L.getTime()-Date.UTC(L.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},Ea:function(L,j){L=new Date(1e3*(V[L>>>2]+4294967296*B[L+4>>>2])),B[j>>2>>>0]=L.getSeconds(),B[j+4>>2>>>0]=L.getMinutes(),B[j+8>>2>>>0]=L.getHours(),B[j+12>>2>>>0]=L.getDate(),B[j+16>>2>>>0]=L.getMonth(),B[j+20>>2>>>0]=L.getFullYear()-1900,B[j+24>>2>>>0]=L.getDay();var q=new Date(L.getFullYear(),0,1);B[j+28>>2>>>0]=(L.getTime()-q.getTime())/864e5|0,B[j+36>>2>>>0]=-60*L.getTimezoneOffset();var K=new Date(L.getFullYear(),6,1).getTimezoneOffset();q=q.getTimezoneOffset(),B[j+32>>2>>>0]=0|(K!=q&&L.getTimezoneOffset()==Math.min(q,K))},Fa:function(L){var j=new Date(B[L+20>>2>>>0]+1900,B[L+16>>2>>>0],B[L+12>>2>>>0],B[L+8>>2>>>0],B[L+4>>2>>>0],B[L>>2>>>0],0),q=B[L+32>>2>>>0],K=j.getTimezoneOffset(),ee=new Date(j.getFullYear(),0,1),re=new Date(j.getFullYear(),6,1).getTimezoneOffset(),ue=ee.getTimezoneOffset(),Ee=Math.min(ue,re);return 0>q?B[L+32>>2>>>0]=+(re!=ue&&Ee==K):0<q!=(Ee==K)&&(re=Math.max(ue,re),j.setTime(j.getTime()+6e4*((0<q?Ee:re)-K))),B[L+24>>2>>>0]=j.getDay(),B[L+28>>2>>>0]=(j.getTime()-ee.getTime())/864e5|0,B[L>>2>>>0]=j.getSeconds(),B[L+4>>2>>>0]=j.getMinutes(),B[L+8>>2>>>0]=j.getHours(),B[L+12>>2>>>0]=j.getDate(),B[L+16>>2>>>0]=j.getMonth(),j.getTime()/1e3|0},sa:function(){return-52},ta:function(){},Ga:function L(j,q,K){L.Vb||(L.Vb=!0,function(ee,re,ue){function Ee(en){return(en=en.toTimeString().match(/\(([A-Za-z ]+)\)$/))?en[1]:"GMT"}var ge=new Date().getFullYear(),Ue=new Date(ge,0,1),ft=new Date(ge,6,1);ge=Ue.getTimezoneOffset();var hn=ft.getTimezoneOffset();B[ee>>2>>>0]=60*Math.max(ge,hn),B[re>>2>>>0]=+(ge!=hn),ee=Ee(Ue),re=Ee(ft),ee=lf(ee),re=lf(re),hn<ge?(V[ue>>2>>>0]=ee,V[ue+4>>2>>>0]=re):(V[ue>>2>>>0]=re,V[ue+4>>2>>>0]=ee)}(j,q,K))},B:function(){Qe("")},ma:function(){return 4294901760},I:E?()=>{var L=process.hrtime();return 1e3*L[0]+L[1]/1e6}:()=>performance.now(),xa:function(L,j,q){z.copyWithin(L>>>0,j>>>0,j+q>>>0)},G:function(L){var j=z.length;if(4294901760<(L>>>=0))return!1;for(var q=1;4>=q;q*=2){var K=j*(1+.2/q);K=Math.min(K,L+100663296);var ee=Math;K=Math.max(L,K),ee=ee.min.call(ee,4294901760,K+(65536-K%65536)%65536);e:{try{P.grow(ee-F.byteLength+65535>>>16),be();var re=1;break e}catch{}re=void 0}if(re)return!0}return!1},va:function(L,j){var q=0;return ab().forEach(function(K,ee){var re=j+q;for(ee=V[L+4*ee>>2>>>0]=re,re=0;re<K.length;++re)H[ee++>>0>>>0]=K.charCodeAt(re);H[ee>>0>>>0]=0,q+=K.length+1}),0},wa:function(L,j){var q=ab();V[L>>2>>>0]=q.length;var K=0;return q.forEach(function(ee){K+=ee.length+1}),V[j>>2>>>0]=K,0},ba:function(L){A||0<ht||(Ja(),Er(Ie),cf(0),xu[1].length&&Eu(1,10),xu[2].length&&Eu(2,10)),A||0<ht||(o.onExit&&o.onExit(L),M=!0),y(L,new xr(L))},E:function(){return 52},Q:function(){return 52},ca:function(){return 70},P:function(L,j,q,K){for(var ee=0,re=0;re<q;re++){var ue=V[j>>2>>>0],Ee=V[j+4>>2>>>0];j+=8;for(var ge=0;ge<Ee;ge++)Eu(L,z[ue+ge>>>0]);ee+=Ee}return V[K>>2>>>0]=ee,0},c:function(){return En},ja:function L(j,q){L.Mb||(L.Mb=function(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var ee=new Uint8Array(1);return()=>(crypto.getRandomValues(ee),ee[0])}if(E)try{var re=t(Object(function(){var ue=new Error("Cannot find module 'crypto'");throw ue.code="MODULE_NOT_FOUND",ue}()));return()=>re.randomBytes(1)[0]}catch{}return()=>Qe("randomDevice")}());for(var K=0;K<q;K++)H[j+K>>0>>>0]=L.Mb();return 0},ea:function(L,j,q){var K=ke();try{return Xe(L)(j,q)}catch(ee){if(Pe(K),ee!==ee+0)throw ee;Oe(1,0)}},fa:function(L,j,q){var K=ke();try{return Xe(L)(j,q)}catch(ee){if(Pe(K),ee!==ee+0)throw ee;Oe(1,0)}},J:function(L){var j=ke();try{return Xe(L)()}catch(q){if(Pe(j),q!==q+0)throw q;Oe(1,0)}},e:function(L,j){var q=ke();try{return Xe(L)(j)}catch(K){if(Pe(q),K!==K+0)throw K;Oe(1,0)}},N:function(L,j,q){var K=ke();try{return Xe(L)(j,q)}catch(ee){if(Pe(K),ee!==ee+0)throw ee;Oe(1,0)}},O:function(L,j,q){var K=ke();try{return Xe(L)(j,q)}catch(ee){if(Pe(K),ee!==ee+0)throw ee;Oe(1,0)}},j:function(L,j,q){var K=ke();try{return Xe(L)(j,q)}catch(ee){if(Pe(K),ee!==ee+0)throw ee;Oe(1,0)}},o:function(L,j,q,K){var ee=ke();try{return Xe(L)(j,q,K)}catch(re){if(Pe(ee),re!==re+0)throw re;Oe(1,0)}},p:function(L,j,q,K,ee){var re=ke();try{return Xe(L)(j,q,K,ee)}catch(ue){if(Pe(re),ue!==ue+0)throw ue;Oe(1,0)}},M:function(L,j,q,K,ee,re){var ue=ke();try{return Xe(L)(j,q,K,ee,re)}catch(Ee){if(Pe(ue),Ee!==Ee+0)throw Ee;Oe(1,0)}},r:function(L,j,q,K,ee,re){var ue=ke();try{return Xe(L)(j,q,K,ee,re)}catch(Ee){if(Pe(ue),Ee!==Ee+0)throw Ee;Oe(1,0)}},v:function(L,j,q,K,ee,re,ue){var Ee=ke();try{return Xe(L)(j,q,K,ee,re,ue)}catch(ge){if(Pe(Ee),ge!==ge+0)throw ge;Oe(1,0)}},K:function(L,j,q,K,ee,re,ue,Ee){var ge=ke();try{return Xe(L)(j,q,K,ee,re,ue,Ee)}catch(Ue){if(Pe(ge),Ue!==Ue+0)throw Ue;Oe(1,0)}},D:function(L,j,q,K,ee,re,ue,Ee,ge,Ue,ft,hn){var en=ke();try{return Xe(L)(j,q,K,ee,re,ue,Ee,ge,Ue,ft,hn)}catch(se){if(Pe(en),se!==se+0)throw se;Oe(1,0)}},X:function(L,j,q,K,ee,re,ue,Ee){var ge=ke();try{return _f(L,j,q,K,ee,re,ue,Ee)}catch(Ue){if(Pe(ge),Ue!==Ue+0)throw Ue;Oe(1,0)}},V:function(L,j,q,K,ee,re,ue){var Ee=ke();try{return ff(L,j,q,K,ee,re,ue)}catch(ge){if(Pe(Ee),ge!==ge+0)throw ge;Oe(1,0)}},U:function(L,j,q,K,ee){var re=ke();try{return wf(L,j,q,K,ee)}catch(ue){if(Pe(re),ue!==ue+0)throw ue;Oe(1,0)}},Z:function(L,j,q,K){var ee=ke();try{return bf(L,j,q,K)}catch(re){if(Pe(ee),re!==re+0)throw re;Oe(1,0)}},W:function(L){var j=ke();try{return hf(L)}catch(q){if(Pe(j),q!==q+0)throw q;Oe(1,0)}},Y:function(L,j){var q=ke();try{return vf(L,j)}catch(K){if(Pe(q),K!==K+0)throw K;Oe(1,0)}},T:function(L,j,q){var K=ke();try{return pf(L,j,q)}catch(ee){if(Pe(K),ee!==ee+0)throw ee;Oe(1,0)}},f:function(L){var j=ke();try{Xe(L)()}catch(q){if(Pe(j),q!==q+0)throw q;Oe(1,0)}},q:function(L,j){var q=ke();try{Xe(L)(j)}catch(K){if(Pe(q),K!==K+0)throw K;Oe(1,0)}},h:function(L,j,q){var K=ke();try{Xe(L)(j,q)}catch(ee){if(Pe(K),ee!==ee+0)throw ee;Oe(1,0)}},da:function(L,j,q,K){var ee=ke();try{Xe(L)(j,q,K)}catch(re){if(Pe(ee),re!==re+0)throw re;Oe(1,0)}},l:function(L,j,q,K){var ee=ke();try{Xe(L)(j,q,K)}catch(re){if(Pe(ee),re!==re+0)throw re;Oe(1,0)}},t:function(L,j,q,K,ee){var re=ke();try{Xe(L)(j,q,K,ee)}catch(ue){if(Pe(re),ue!==ue+0)throw ue;Oe(1,0)}},u:function(L,j,q,K,ee,re){var ue=ke();try{Xe(L)(j,q,K,ee,re)}catch(Ee){if(Pe(ue),Ee!==Ee+0)throw Ee;Oe(1,0)}},x:function(L,j,q,K,ee,re,ue){var Ee=ke();try{Xe(L)(j,q,K,ee,re,ue)}catch(ge){if(Pe(Ee),ge!==ge+0)throw ge;Oe(1,0)}},z:function(L,j,q,K,ee,re,ue,Ee){var ge=ke();try{Xe(L)(j,q,K,ee,re,ue,Ee)}catch(Ue){if(Pe(ge),Ue!==Ue+0)throw Ue;Oe(1,0)}},ga:function(L,j,q,K,ee,re,ue,Ee,ge){var Ue=ke();try{Xe(L)(j,q,K,ee,re,ue,Ee,ge)}catch(ft){if(Pe(Ue),ft!==ft+0)throw ft;Oe(1,0)}},A:function(L,j,q,K,ee,re,ue,Ee,ge,Ue,ft){var hn=ke();try{Xe(L)(j,q,K,ee,re,ue,Ee,ge,Ue,ft)}catch(en){if(Pe(hn),en!==en+0)throw en;Oe(1,0)}},C:function(L,j,q,K,ee,re,ue,Ee,ge,Ue,ft,hn,en,se,et,wt){var zs=ke();try{Xe(L)(j,q,K,ee,re,ue,Ee,ge,Ue,ft,hn,en,se,et,wt)}catch(Cr){if(Pe(zs),Cr!==Cr+0)throw Cr;Oe(1,0)}},aa:function(L,j,q,K,ee,re,ue,Ee){var ge=ke();try{gf(L,j,q,K,ee,re,ue,Ee)}catch(Ue){if(Pe(ge),Ue!==Ue+0)throw Ue;Oe(1,0)}},_:function(L,j,q,K,ee,re,ue,Ee,ge,Ue,ft,hn){var en=ke();try{yf(L,j,q,K,ee,re,ue,Ee,ge,Ue,ft,hn)}catch(se){if(Pe(en),se!==se+0)throw se;Oe(1,0)}},$:function(L,j,q,K,ee,re){var ue=ke();try{mf(L,j,q,K,ee,re)}catch(Ee){if(Pe(ue),Ee!==Ee+0)throw Ee;Oe(1,0)}},n:function(L){return L},F:function(L){En=L},ha:lb,y:function(L,j,q,K){return lb(L,j,q,K)}};(function(){function L(ee){o.asm=ee.exports,P=o.asm.Ka,be(),Ce=o.asm.ib,Ae.unshift(o.asm.La),Rt--,o.monitorRunDependencies&&o.monitorRunDependencies(Rt),Rt==0&&(Yt!==null&&(clearInterval(Yt),Yt=null),At&&(ee=At,At=null,ee()))}function j(ee){L(ee.instance)}function q(ee){return function(){if(!T&&(_||x)){if(typeof fetch=="function"&&!ut.startsWith("file://"))return fetch(ut,{credentials:"same-origin"}).then(function(re){if(!re.ok)throw"failed to load wasm binary file at '"+ut+"'";return re.arrayBuffer()}).catch(function(){return is()});if(d)return new Promise(function(re,ue){d(ut,function(Ee){re(new Uint8Array(Ee))},ue)})}return Promise.resolve().then(function(){return is()})}().then(function(re){return WebAssembly.instantiate(re,K)}).then(function(re){return re}).then(ee,function(re){I("failed to asynchronously prepare wasm: "+re),Qe(re)})}var K={a:cb};if(Rt++,o.monitorRunDependencies&&o.monitorRunDependencies(Rt),o.instantiateWasm)try{return o.instantiateWasm(K,L)}catch(ee){return I("Module.instantiateWasm callback failed with error: "+ee),!1}(T||typeof WebAssembly.instantiateStreaming!="function"||On()||ut.startsWith("file://")||E||typeof fetch!="function"?q(j):fetch(ut,{credentials:"same-origin"}).then(function(ee){return WebAssembly.instantiateStreaming(ee,K).then(j,function(re){return I("wasm streaming compile failed: "+re),I("falling back to ArrayBuffer instantiation"),q(j)})})).catch(u)})(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.La).apply(null,arguments)},o._OrtInit=function(){return(o._OrtInit=o.asm.Ma).apply(null,arguments)},o._OrtCreateSessionOptions=function(){return(o._OrtCreateSessionOptions=o.asm.Na).apply(null,arguments)},o._OrtAppendExecutionProvider=function(){return(o._OrtAppendExecutionProvider=o.asm.Oa).apply(null,arguments)},o._OrtAddSessionConfigEntry=function(){return(o._OrtAddSessionConfigEntry=o.asm.Pa).apply(null,arguments)},o._OrtReleaseSessionOptions=function(){return(o._OrtReleaseSessionOptions=o.asm.Qa).apply(null,arguments)},o._OrtCreateSession=function(){return(o._OrtCreateSession=o.asm.Ra).apply(null,arguments)},o._OrtReleaseSession=function(){return(o._OrtReleaseSession=o.asm.Sa).apply(null,arguments)},o._OrtGetInputCount=function(){return(o._OrtGetInputCount=o.asm.Ta).apply(null,arguments)},o._OrtGetOutputCount=function(){return(o._OrtGetOutputCount=o.asm.Ua).apply(null,arguments)},o._OrtGetInputName=function(){return(o._OrtGetInputName=o.asm.Va).apply(null,arguments)},o._OrtGetOutputName=function(){return(o._OrtGetOutputName=o.asm.Wa).apply(null,arguments)},o._OrtFree=function(){return(o._OrtFree=o.asm.Xa).apply(null,arguments)},o._OrtCreateTensor=function(){return(o._OrtCreateTensor=o.asm.Ya).apply(null,arguments)},o._OrtGetTensorData=function(){return(o._OrtGetTensorData=o.asm.Za).apply(null,arguments)},o._OrtReleaseTensor=function(){return(o._OrtReleaseTensor=o.asm._a).apply(null,arguments)},o._OrtCreateRunOptions=function(){return(o._OrtCreateRunOptions=o.asm.$a).apply(null,arguments)},o._OrtAddRunConfigEntry=function(){return(o._OrtAddRunConfigEntry=o.asm.ab).apply(null,arguments)},o._OrtReleaseRunOptions=function(){return(o._OrtReleaseRunOptions=o.asm.bb).apply(null,arguments)},o._OrtRun=function(){return(o._OrtRun=o.asm.cb).apply(null,arguments)},o._OrtEndProfiling=function(){return(o._OrtEndProfiling=o.asm.db).apply(null,arguments)};var Ar,at=o._malloc=function(){return(at=o._malloc=o.asm.eb).apply(null,arguments)},Xa=o._free=function(){return(Xa=o._free=o.asm.fb).apply(null,arguments)},cf=o._fflush=function(){return(cf=o._fflush=o.asm.gb).apply(null,arguments)},Ja=o.___funcs_on_exit=function(){return(Ja=o.___funcs_on_exit=o.asm.hb).apply(null,arguments)},Oe=o._setThrew=function(){return(Oe=o._setThrew=o.asm.jb).apply(null,arguments)},ke=o.stackSave=function(){return(ke=o.stackSave=o.asm.kb).apply(null,arguments)},Pe=o.stackRestore=function(){return(Pe=o.stackRestore=o.asm.lb).apply(null,arguments)},uf=o.stackAlloc=function(){return(uf=o.stackAlloc=o.asm.mb).apply(null,arguments)},Za=o.___cxa_can_catch=function(){return(Za=o.___cxa_can_catch=o.asm.nb).apply(null,arguments)},df=o.___cxa_is_pointer_type=function(){return(df=o.___cxa_is_pointer_type=o.asm.ob).apply(null,arguments)},hf=o.dynCall_j=function(){return(hf=o.dynCall_j=o.asm.pb).apply(null,arguments)},ff=o.dynCall_iiiiij=function(){return(ff=o.dynCall_iiiiij=o.asm.qb).apply(null,arguments)},pf=o.dynCall_jii=function(){return(pf=o.dynCall_jii=o.asm.rb).apply(null,arguments)},gf=o.dynCall_viiiiij=function(){return(gf=o.dynCall_viiiiij=o.asm.sb).apply(null,arguments)},mf=o.dynCall_vjji=function(){return(mf=o.dynCall_vjji=o.asm.tb).apply(null,arguments)},yf=o.dynCall_viiijjjii=function(){return(yf=o.dynCall_viiijjjii=o.asm.ub).apply(null,arguments)},bf=o.dynCall_iij=function(){return(bf=o.dynCall_iij=o.asm.vb).apply(null,arguments)},vf=o.dynCall_ji=function(){return(vf=o.dynCall_ji=o.asm.wb).apply(null,arguments)},_f=o.dynCall_iiiiiij=function(){return(_f=o.dynCall_iiiiiij=o.asm.xb).apply(null,arguments)},wf=o.dynCall_iiij=function(){return(wf=o.dynCall_iiij=o.asm.yb).apply(null,arguments)};function xf(){function L(){if(!Ar&&(Ar=!0,o.calledRun=!0,!M)){if(Er(Ae),l(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;){var j=o.postRun.shift();_e.unshift(j)}Er(_e)}}if(!(0<Rt)){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)Vt();Er(Ze),0<Rt||(o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),L()},1)):L())}}if(o.UTF8ToString=Z,o.stringToUTF8=function(L,j,q){return le(L,z,j,q)},o.lengthBytesUTF8=ae,o.stackSave=ke,o.stackRestore=Pe,o.stackAlloc=uf,At=function L(){Ar||xf(),Ar||(At=L)},o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);0<o.preInit.length;)o.preInit.pop()();return xf(),r.ready});s.exports=i},4537:s=>{"use strict";s.exports=function(e,t){for(var n=new Array(arguments.length-1),i=0,r=2,o=!0;r<arguments.length;)n[i++]=arguments[r++];return new Promise(function(l,u){n[i]=function(h){if(o)if(o=!1,h)u(h);else{for(var d=new Array(arguments.length-1),c=0;c<d.length;)d[c++]=arguments[c];l.apply(null,d)}};try{e.apply(t||null,n)}catch(h){o&&(o=!1,u(h))}})}},7419:(s,e)=>{"use strict";var t=e;t.length=function(l){var u=l.length;if(!u)return 0;for(var h=0;--u%4>1&&l.charAt(u)==="=";)++h;return Math.ceil(3*l.length)/4-h};for(var n=new Array(64),i=new Array(123),r=0;r<64;)i[n[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;t.encode=function(l,u,h){for(var d,c=null,a=[],f=0,p=0;u<h;){var g=l[u++];switch(p){case 0:a[f++]=n[g>>2],d=(3&g)<<4,p=1;break;case 1:a[f++]=n[d|g>>4],d=(15&g)<<2,p=2;break;case 2:a[f++]=n[d|g>>6],a[f++]=n[63&g],p=0}f>8191&&((c||(c=[])).push(String.fromCharCode.apply(String,a)),f=0)}return p&&(a[f++]=n[d],a[f++]=61,p===1&&(a[f++]=61)),c?(f&&c.push(String.fromCharCode.apply(String,a.slice(0,f))),c.join("")):String.fromCharCode.apply(String,a.slice(0,f))};var o="invalid encoding";t.decode=function(l,u,h){for(var d,c=h,a=0,f=0;f<l.length;){var p=l.charCodeAt(f++);if(p===61&&a>1)break;if((p=i[p])===void 0)throw Error(o);switch(a){case 0:d=p,a=1;break;case 1:u[h++]=d<<2|(48&p)>>4,d=p,a=2;break;case 2:u[h++]=(15&d)<<4|(60&p)>>2,d=p,a=3;break;case 3:u[h++]=(3&d)<<6|p,a=0}}if(a===1)throw Error(o);return h-c},t.test=function(l){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(l)}},9211:s=>{"use strict";function e(){this._listeners={}}s.exports=e,e.prototype.on=function(t,n,i){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:n,ctx:i||this}),this},e.prototype.off=function(t,n){if(t===void 0)this._listeners={};else if(n===void 0)this._listeners[t]=[];else for(var i=this._listeners[t],r=0;r<i.length;)i[r].fn===n?i.splice(r,1):++r;return this},e.prototype.emit=function(t){var n=this._listeners[t];if(n){for(var i=[],r=1;r<arguments.length;)i.push(arguments[r++]);for(r=0;r<n.length;)n[r].fn.apply(n[r++].ctx,i)}return this}},945:s=>{"use strict";function e(o){return typeof Float32Array<"u"?function(){var l=new Float32Array([-0]),u=new Uint8Array(l.buffer),h=u[3]===128;function d(p,g,m){l[0]=p,g[m]=u[0],g[m+1]=u[1],g[m+2]=u[2],g[m+3]=u[3]}function c(p,g,m){l[0]=p,g[m]=u[3],g[m+1]=u[2],g[m+2]=u[1],g[m+3]=u[0]}function a(p,g){return u[0]=p[g],u[1]=p[g+1],u[2]=p[g+2],u[3]=p[g+3],l[0]}function f(p,g){return u[3]=p[g],u[2]=p[g+1],u[1]=p[g+2],u[0]=p[g+3],l[0]}o.writeFloatLE=h?d:c,o.writeFloatBE=h?c:d,o.readFloatLE=h?a:f,o.readFloatBE=h?f:a}():function(){function l(h,d,c,a){var f=d<0?1:0;if(f&&(d=-d),d===0)h(1/d>0?0:2147483648,c,a);else if(isNaN(d))h(2143289344,c,a);else if(d>34028234663852886e22)h((f<<31|2139095040)>>>0,c,a);else if(d<11754943508222875e-54)h((f<<31|Math.round(d/1401298464324817e-60))>>>0,c,a);else{var p=Math.floor(Math.log(d)/Math.LN2);h((f<<31|p+127<<23|8388607&Math.round(d*Math.pow(2,-p)*8388608))>>>0,c,a)}}function u(h,d,c){var a=h(d,c),f=2*(a>>31)+1,p=a>>>23&255,g=8388607&a;return p===255?g?NaN:f*(1/0):p===0?1401298464324817e-60*f*g:f*Math.pow(2,p-150)*(g+8388608)}o.writeFloatLE=l.bind(null,t),o.writeFloatBE=l.bind(null,n),o.readFloatLE=u.bind(null,i),o.readFloatBE=u.bind(null,r)}(),typeof Float64Array<"u"?function(){var l=new Float64Array([-0]),u=new Uint8Array(l.buffer),h=u[7]===128;function d(p,g,m){l[0]=p,g[m]=u[0],g[m+1]=u[1],g[m+2]=u[2],g[m+3]=u[3],g[m+4]=u[4],g[m+5]=u[5],g[m+6]=u[6],g[m+7]=u[7]}function c(p,g,m){l[0]=p,g[m]=u[7],g[m+1]=u[6],g[m+2]=u[5],g[m+3]=u[4],g[m+4]=u[3],g[m+5]=u[2],g[m+6]=u[1],g[m+7]=u[0]}function a(p,g){return u[0]=p[g],u[1]=p[g+1],u[2]=p[g+2],u[3]=p[g+3],u[4]=p[g+4],u[5]=p[g+5],u[6]=p[g+6],u[7]=p[g+7],l[0]}function f(p,g){return u[7]=p[g],u[6]=p[g+1],u[5]=p[g+2],u[4]=p[g+3],u[3]=p[g+4],u[2]=p[g+5],u[1]=p[g+6],u[0]=p[g+7],l[0]}o.writeDoubleLE=h?d:c,o.writeDoubleBE=h?c:d,o.readDoubleLE=h?a:f,o.readDoubleBE=h?f:a}():function(){function l(h,d,c,a,f,p){var g=a<0?1:0;if(g&&(a=-a),a===0)h(0,f,p+d),h(1/a>0?0:2147483648,f,p+c);else if(isNaN(a))h(0,f,p+d),h(2146959360,f,p+c);else if(a>17976931348623157e292)h(0,f,p+d),h((g<<31|2146435072)>>>0,f,p+c);else{var m;if(a<22250738585072014e-324)h((m=a/5e-324)>>>0,f,p+d),h((g<<31|m/4294967296)>>>0,f,p+c);else{var y=Math.floor(Math.log(a)/Math.LN2);y===1024&&(y=1023),h(4503599627370496*(m=a*Math.pow(2,-y))>>>0,f,p+d),h((g<<31|y+1023<<20|1048576*m&1048575)>>>0,f,p+c)}}}function u(h,d,c,a,f){var p=h(a,f+d),g=h(a,f+c),m=2*(g>>31)+1,y=g>>>20&2047,_=4294967296*(1048575&g)+p;return y===2047?_?NaN:m*(1/0):y===0?5e-324*m*_:m*Math.pow(2,y-1075)*(_+4503599627370496)}o.writeDoubleLE=l.bind(null,t,0,4),o.writeDoubleBE=l.bind(null,n,4,0),o.readDoubleLE=u.bind(null,i,0,4),o.readDoubleBE=u.bind(null,r,4,0)}(),o}function t(o,l,u){l[u]=255&o,l[u+1]=o>>>8&255,l[u+2]=o>>>16&255,l[u+3]=o>>>24}function n(o,l,u){l[u]=o>>>24,l[u+1]=o>>>16&255,l[u+2]=o>>>8&255,l[u+3]=255&o}function i(o,l){return(o[l]|o[l+1]<<8|o[l+2]<<16|o[l+3]<<24)>>>0}function r(o,l){return(o[l]<<24|o[l+1]<<16|o[l+2]<<8|o[l+3])>>>0}s.exports=e(e)},7199:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(s){}return null}module.exports=inquire},6662:s=>{"use strict";s.exports=function(e,t,n){var i=n||8192,r=i>>>1,o=null,l=i;return function(u){if(u<1||u>r)return e(u);l+u>i&&(o=e(i),l=0);var h=t.call(o,l,l+=u);return 7&l&&(l=1+(7|l)),h}}},4997:(s,e)=>{"use strict";var t=e;t.length=function(n){for(var i=0,r=0,o=0;o<n.length;++o)(r=n.charCodeAt(o))<128?i+=1:r<2048?i+=2:(64512&r)==55296&&(64512&n.charCodeAt(o+1))==56320?(++o,i+=4):i+=3;return i},t.read=function(n,i,r){if(r-i<1)return"";for(var o,l=null,u=[],h=0;i<r;)(o=n[i++])<128?u[h++]=o:o>191&&o<224?u[h++]=(31&o)<<6|63&n[i++]:o>239&&o<365?(o=((7&o)<<18|(63&n[i++])<<12|(63&n[i++])<<6|63&n[i++])-65536,u[h++]=55296+(o>>10),u[h++]=56320+(1023&o)):u[h++]=(15&o)<<12|(63&n[i++])<<6|63&n[i++],h>8191&&((l||(l=[])).push(String.fromCharCode.apply(String,u)),h=0);return l?(h&&l.push(String.fromCharCode.apply(String,u.slice(0,h))),l.join("")):String.fromCharCode.apply(String,u.slice(0,h))},t.write=function(n,i,r){for(var o,l,u=r,h=0;h<n.length;++h)(o=n.charCodeAt(h))<128?i[r++]=o:o<2048?(i[r++]=o>>6|192,i[r++]=63&o|128):(64512&o)==55296&&(64512&(l=n.charCodeAt(h+1)))==56320?(o=65536+((1023&o)<<10)+(1023&l),++h,i[r++]=o>>18|240,i[r++]=o>>12&63|128,i[r++]=o>>6&63|128,i[r++]=63&o|128):(i[r++]=o>>12|224,i[r++]=o>>6&63|128,i[r++]=63&o|128);return r-u}},3442:(s,e)=>{"use strict";e.__esModule=!0;var t=function(){function n(i){if(!i)throw new TypeError("Invalid argument; `value` has no value.");this.value=n.EMPTY,i&&n.isGuid(i)&&(this.value=i)}return n.isGuid=function(i){var r=i.toString();return i&&(i instanceof n||n.validator.test(r))},n.create=function(){return new n([n.gen(2),n.gen(1),n.gen(1),n.gen(1),n.gen(3)].join("-"))},n.createEmpty=function(){return new n("emptyguid")},n.parse=function(i){return new n(i)},n.raw=function(){return[n.gen(2),n.gen(1),n.gen(1),n.gen(1),n.gen(3)].join("-")},n.gen=function(i){for(var r="",o=0;o<i;o++)r+=(65536*(1+Math.random())|0).toString(16).substring(1);return r},n.prototype.equals=function(i){return n.isGuid(i)&&this.value===i.toString()},n.prototype.isEmpty=function(){return this.value===n.EMPTY},n.prototype.toString=function(){return this.value},n.prototype.toJSON=function(){return{value:this.value}},n.validator=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i"),n.EMPTY="00000000-0000-0000-0000-000000000000",n}();e.Guid=t},3720:s=>{s.exports=t;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(A,P,F){this.low=0|A,this.high=0|P,this.unsigned=!!F}function n(A){return(A&&A.__isLong__)===!0}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0}),t.isLong=n;var i={},r={};function o(A,P){var F,H,z;return P?(z=0<=(A>>>=0)&&A<256)&&(H=r[A])?H:(F=u(A,(0|A)<0?-1:0,!0),z&&(r[A]=F),F):(z=-128<=(A|=0)&&A<128)&&(H=i[A])?H:(F=u(A,A<0?-1:0,!1),z&&(i[A]=F),F)}function l(A,P){if(isNaN(A))return P?y:m;if(P){if(A<0)return y;if(A>=f)return T}else{if(A<=-p)return C;if(A+1>=p)return S}return A<0?l(-A,P).neg():u(A%a|0,A/a|0,P)}function u(A,P,F){return new t(A,P,F)}t.fromInt=o,t.fromNumber=l,t.fromBits=u;var h=Math.pow;function d(A,P,F){if(A.length===0)throw Error("empty string");if(A==="NaN"||A==="Infinity"||A==="+Infinity"||A==="-Infinity")return m;if(typeof P=="number"?(F=P,P=!1):P=!!P,(F=F||10)<2||36<F)throw RangeError("radix");var H;if((H=A.indexOf("-"))>0)throw Error("interior hyphen");if(H===0)return d(A.substring(1),P,F).neg();for(var z=l(h(F,8)),B=m,V=0;V<A.length;V+=8){var M=Math.min(8,A.length-V),$=parseInt(A.substring(V,V+M),F);if(M<8){var oe=l(h(F,M));B=B.mul(oe).add(l($))}else B=(B=B.mul(z)).add(l($))}return B.unsigned=P,B}function c(A,P){return typeof A=="number"?l(A,P):typeof A=="string"?d(A,P):u(A.low,A.high,typeof P=="boolean"?P:A.unsigned)}t.fromString=d,t.fromValue=c;var a=4294967296,f=a*a,p=f/2,g=o(1<<24),m=o(0);t.ZERO=m;var y=o(0,!0);t.UZERO=y;var _=o(1);t.ONE=_;var x=o(1,!0);t.UONE=x;var E=o(-1);t.NEG_ONE=E;var S=u(-1,2147483647,!1);t.MAX_VALUE=S;var T=u(-1,-1,!0);t.MAX_UNSIGNED_VALUE=T;var C=u(0,-2147483648,!1);t.MIN_VALUE=C;var I=t.prototype;I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*a+(this.low>>>0):this.high*a+(this.low>>>0)},I.toString=function(A){if((A=A||10)<2||36<A)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(C)){var P=l(A),F=this.div(P),H=F.mul(P).sub(this);return F.toString(A)+H.toInt().toString(A)}return"-"+this.neg().toString(A)}for(var z=l(h(A,6),this.unsigned),B=this,V="";;){var M=B.div(z),$=(B.sub(M.mul(z)).toInt()>>>0).toString(A);if((B=M).isZero())return $+V;for(;$.length<6;)$="0"+$;V=""+$+V}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(C)?64:this.neg().getNumBitsAbs();for(var A=this.high!=0?this.high:this.low,P=31;P>0&&!(A&1<<P);P--);return this.high!=0?P+33:P+1},I.isZero=function(){return this.high===0&&this.low===0},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return(1&this.low)==1},I.isEven=function(){return(1&this.low)==0},I.equals=function(A){return n(A)||(A=c(A)),(this.unsigned===A.unsigned||this.high>>>31!=1||A.high>>>31!=1)&&this.high===A.high&&this.low===A.low},I.eq=I.equals,I.notEquals=function(A){return!this.eq(A)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(A){return this.comp(A)<0},I.lt=I.lessThan,I.lessThanOrEqual=function(A){return this.comp(A)<=0},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(A){return this.comp(A)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(A){return this.comp(A)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(A){if(n(A)||(A=c(A)),this.eq(A))return 0;var P=this.isNegative(),F=A.isNegative();return P&&!F?-1:!P&&F?1:this.unsigned?A.high>>>0>this.high>>>0||A.high===this.high&&A.low>>>0>this.low>>>0?-1:1:this.sub(A).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(C)?C:this.not().add(_)},I.neg=I.negate,I.add=function(A){n(A)||(A=c(A));var P=this.high>>>16,F=65535&this.high,H=this.low>>>16,z=65535&this.low,B=A.high>>>16,V=65535&A.high,M=A.low>>>16,$=0,oe=0,Z=0,le=0;return Z+=(le+=z+(65535&A.low))>>>16,oe+=(Z+=H+M)>>>16,$+=(oe+=F+V)>>>16,$+=P+B,u((Z&=65535)<<16|(le&=65535),($&=65535)<<16|(oe&=65535),this.unsigned)},I.subtract=function(A){return n(A)||(A=c(A)),this.add(A.neg())},I.sub=I.subtract,I.multiply=function(A){if(this.isZero())return m;if(n(A)||(A=c(A)),e)return u(e.mul(this.low,this.high,A.low,A.high),e.get_high(),this.unsigned);if(A.isZero())return m;if(this.eq(C))return A.isOdd()?C:m;if(A.eq(C))return this.isOdd()?C:m;if(this.isNegative())return A.isNegative()?this.neg().mul(A.neg()):this.neg().mul(A).neg();if(A.isNegative())return this.mul(A.neg()).neg();if(this.lt(g)&&A.lt(g))return l(this.toNumber()*A.toNumber(),this.unsigned);var P=this.high>>>16,F=65535&this.high,H=this.low>>>16,z=65535&this.low,B=A.high>>>16,V=65535&A.high,M=A.low>>>16,$=65535&A.low,oe=0,Z=0,le=0,ae=0;return le+=(ae+=z*$)>>>16,Z+=(le+=H*$)>>>16,le&=65535,Z+=(le+=z*M)>>>16,oe+=(Z+=F*$)>>>16,Z&=65535,oe+=(Z+=H*M)>>>16,Z&=65535,oe+=(Z+=z*V)>>>16,oe+=P*$+F*M+H*V+z*B,u((le&=65535)<<16|(ae&=65535),(oe&=65535)<<16|(Z&=65535),this.unsigned)},I.mul=I.multiply,I.divide=function(A){if(n(A)||(A=c(A)),A.isZero())throw Error("division by zero");var P,F,H;if(e)return this.unsigned||this.high!==-2147483648||A.low!==-1||A.high!==-1?u((this.unsigned?e.div_u:e.div_s)(this.low,this.high,A.low,A.high),e.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:m;if(this.unsigned){if(A.unsigned||(A=A.toUnsigned()),A.gt(this))return y;if(A.gt(this.shru(1)))return x;H=y}else{if(this.eq(C))return A.eq(_)||A.eq(E)?C:A.eq(C)?_:(P=this.shr(1).div(A).shl(1)).eq(m)?A.isNegative()?_:E:(F=this.sub(A.mul(P)),H=P.add(F.div(A)));if(A.eq(C))return this.unsigned?y:m;if(this.isNegative())return A.isNegative()?this.neg().div(A.neg()):this.neg().div(A).neg();if(A.isNegative())return this.div(A.neg()).neg();H=m}for(F=this;F.gte(A);){P=Math.max(1,Math.floor(F.toNumber()/A.toNumber()));for(var z=Math.ceil(Math.log(P)/Math.LN2),B=z<=48?1:h(2,z-48),V=l(P),M=V.mul(A);M.isNegative()||M.gt(F);)M=(V=l(P-=B,this.unsigned)).mul(A);V.isZero()&&(V=_),H=H.add(V),F=F.sub(M)}return H},I.div=I.divide,I.modulo=function(A){return n(A)||(A=c(A)),e?u((this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,A.low,A.high),e.get_high(),this.unsigned):this.sub(this.div(A).mul(A))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return u(~this.low,~this.high,this.unsigned)},I.and=function(A){return n(A)||(A=c(A)),u(this.low&A.low,this.high&A.high,this.unsigned)},I.or=function(A){return n(A)||(A=c(A)),u(this.low|A.low,this.high|A.high,this.unsigned)},I.xor=function(A){return n(A)||(A=c(A)),u(this.low^A.low,this.high^A.high,this.unsigned)},I.shiftLeft=function(A){return n(A)&&(A=A.toInt()),(A&=63)==0?this:A<32?u(this.low<<A,this.high<<A|this.low>>>32-A,this.unsigned):u(0,this.low<<A-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(A){return n(A)&&(A=A.toInt()),(A&=63)==0?this:A<32?u(this.low>>>A|this.high<<32-A,this.high>>A,this.unsigned):u(this.high>>A-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(A){if(n(A)&&(A=A.toInt()),(A&=63)==0)return this;var P=this.high;return A<32?u(this.low>>>A|P<<32-A,P>>>A,this.unsigned):u(A===32?P:P>>>A-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},I.toBytes=function(A){return A?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var A=this.high,P=this.low;return[255&P,P>>>8&255,P>>>16&255,P>>>24,255&A,A>>>8&255,A>>>16&255,A>>>24]},I.toBytesBE=function(){var A=this.high,P=this.low;return[A>>>24,A>>>16&255,A>>>8&255,255&A,P>>>24,P>>>16&255,P>>>8&255,255&P]},t.fromBytes=function(A,P,F){return F?t.fromBytesLE(A,P):t.fromBytesBE(A,P)},t.fromBytesLE=function(A,P){return new t(A[0]|A[1]<<8|A[2]<<16|A[3]<<24,A[4]|A[5]<<8|A[6]<<16|A[7]<<24,P)},t.fromBytesBE=function(A,P){return new t(A[4]<<24|A[5]<<16|A[6]<<8|A[7],A[0]<<24|A[1]<<16|A[2]<<8|A[3],P)}},1446:(s,e,t)=>{"use strict";var n,i,r,o=t(2100),l=o.Reader,u=o.Writer,h=o.util,d=o.roots.default||(o.roots.default={});d.onnx=((r={}).Version=(n={},(i=Object.create(n))[n[0]="_START_VERSION"]=0,i[n[1]="IR_VERSION_2017_10_10"]=1,i[n[2]="IR_VERSION_2017_10_30"]=2,i[n[3]="IR_VERSION_2017_11_3"]=3,i[n[4]="IR_VERSION_2019_1_22"]=4,i[n[5]="IR_VERSION"]=5,i),r.AttributeProto=function(){function c(a){if(this.floats=[],this.ints=[],this.strings=[],this.tensors=[],this.graphs=[],a)for(var f=Object.keys(a),p=0;p<f.length;++p)a[f[p]]!=null&&(this[f[p]]=a[f[p]])}return c.prototype.name="",c.prototype.refAttrName="",c.prototype.docString="",c.prototype.type=0,c.prototype.f=0,c.prototype.i=h.Long?h.Long.fromBits(0,0,!1):0,c.prototype.s=h.newBuffer([]),c.prototype.t=null,c.prototype.g=null,c.prototype.floats=h.emptyArray,c.prototype.ints=h.emptyArray,c.prototype.strings=h.emptyArray,c.prototype.tensors=h.emptyArray,c.prototype.graphs=h.emptyArray,c.create=function(a){return new c(a)},c.encode=function(a,f){if(f||(f=u.create()),a.name!=null&&a.hasOwnProperty("name")&&f.uint32(10).string(a.name),a.f!=null&&a.hasOwnProperty("f")&&f.uint32(21).float(a.f),a.i!=null&&a.hasOwnProperty("i")&&f.uint32(24).int64(a.i),a.s!=null&&a.hasOwnProperty("s")&&f.uint32(34).bytes(a.s),a.t!=null&&a.hasOwnProperty("t")&&d.onnx.TensorProto.encode(a.t,f.uint32(42).fork()).ldelim(),a.g!=null&&a.hasOwnProperty("g")&&d.onnx.GraphProto.encode(a.g,f.uint32(50).fork()).ldelim(),a.floats!=null&&a.floats.length){f.uint32(58).fork();for(var p=0;p<a.floats.length;++p)f.float(a.floats[p]);f.ldelim()}if(a.ints!=null&&a.ints.length){for(f.uint32(66).fork(),p=0;p<a.ints.length;++p)f.int64(a.ints[p]);f.ldelim()}if(a.strings!=null&&a.strings.length)for(p=0;p<a.strings.length;++p)f.uint32(74).bytes(a.strings[p]);if(a.tensors!=null&&a.tensors.length)for(p=0;p<a.tensors.length;++p)d.onnx.TensorProto.encode(a.tensors[p],f.uint32(82).fork()).ldelim();if(a.graphs!=null&&a.graphs.length)for(p=0;p<a.graphs.length;++p)d.onnx.GraphProto.encode(a.graphs[p],f.uint32(90).fork()).ldelim();return a.docString!=null&&a.hasOwnProperty("docString")&&f.uint32(106).string(a.docString),a.type!=null&&a.hasOwnProperty("type")&&f.uint32(160).int32(a.type),a.refAttrName!=null&&a.hasOwnProperty("refAttrName")&&f.uint32(170).string(a.refAttrName),f},c.encodeDelimited=function(a,f){return this.encode(a,f).ldelim()},c.decode=function(a,f){a instanceof l||(a=l.create(a));for(var p=f===void 0?a.len:a.pos+f,g=new d.onnx.AttributeProto;a.pos<p;){var m=a.uint32();switch(m>>>3){case 1:g.name=a.string();break;case 21:g.refAttrName=a.string();break;case 13:g.docString=a.string();break;case 20:g.type=a.int32();break;case 2:g.f=a.float();break;case 3:g.i=a.int64();break;case 4:g.s=a.bytes();break;case 5:g.t=d.onnx.TensorProto.decode(a,a.uint32());break;case 6:g.g=d.onnx.GraphProto.decode(a,a.uint32());break;case 7:if(g.floats&&g.floats.length||(g.floats=[]),(7&m)==2)for(var y=a.uint32()+a.pos;a.pos<y;)g.floats.push(a.float());else g.floats.push(a.float());break;case 8:if(g.ints&&g.ints.length||(g.ints=[]),(7&m)==2)for(y=a.uint32()+a.pos;a.pos<y;)g.ints.push(a.int64());else g.ints.push(a.int64());break;case 9:g.strings&&g.strings.length||(g.strings=[]),g.strings.push(a.bytes());break;case 10:g.tensors&&g.tensors.length||(g.tensors=[]),g.tensors.push(d.onnx.TensorProto.decode(a,a.uint32()));break;case 11:g.graphs&&g.graphs.length||(g.graphs=[]),g.graphs.push(d.onnx.GraphProto.decode(a,a.uint32()));break;default:a.skipType(7&m)}}return g},c.decodeDelimited=function(a){return a instanceof l||(a=new l(a)),this.decode(a,a.uint32())},c.verify=function(a){if(typeof a!="object"||a===null)return"object expected";if(a.name!=null&&a.hasOwnProperty("name")&&!h.isString(a.name))return"name: string expected";if(a.refAttrName!=null&&a.hasOwnProperty("refAttrName")&&!h.isString(a.refAttrName))return"refAttrName: string expected";if(a.docString!=null&&a.hasOwnProperty("docString")&&!h.isString(a.docString))return"docString: string expected";if(a.type!=null&&a.hasOwnProperty("type"))switch(a.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:}if(a.f!=null&&a.hasOwnProperty("f")&&typeof a.f!="number")return"f: number expected";if(a.i!=null&&a.hasOwnProperty("i")&&!(h.isInteger(a.i)||a.i&&h.isInteger(a.i.low)&&h.isInteger(a.i.high)))return"i: integer|Long expected";if(a.s!=null&&a.hasOwnProperty("s")&&!(a.s&&typeof a.s.length=="number"||h.isString(a.s)))return"s: buffer expected";if(a.t!=null&&a.hasOwnProperty("t")&&(p=d.onnx.TensorProto.verify(a.t)))return"t."+p;if(a.g!=null&&a.hasOwnProperty("g")&&(p=d.onnx.GraphProto.verify(a.g)))return"g."+p;if(a.floats!=null&&a.hasOwnProperty("floats")){if(!Array.isArray(a.floats))return"floats: array expected";for(var f=0;f<a.floats.length;++f)if(typeof a.floats[f]!="number")return"floats: number[] expected"}if(a.ints!=null&&a.hasOwnProperty("ints")){if(!Array.isArray(a.ints))return"ints: array expected";for(f=0;f<a.ints.length;++f)if(!(h.isInteger(a.ints[f])||a.ints[f]&&h.isInteger(a.ints[f].low)&&h.isInteger(a.ints[f].high)))return"ints: integer|Long[] expected"}if(a.strings!=null&&a.hasOwnProperty("strings")){if(!Array.isArray(a.strings))return"strings: array expected";for(f=0;f<a.strings.length;++f)if(!(a.strings[f]&&typeof a.strings[f].length=="number"||h.isString(a.strings[f])))return"strings: buffer[] expected"}if(a.tensors!=null&&a.hasOwnProperty("tensors")){if(!Array.isArray(a.tensors))return"tensors: array expected";for(f=0;f<a.tensors.length;++f)if(p=d.onnx.TensorProto.verify(a.tensors[f]))return"tensors."+p}if(a.graphs!=null&&a.hasOwnProperty("graphs")){if(!Array.isArray(a.graphs))return"graphs: array expected";for(f=0;f<a.graphs.length;++f){var p;if(p=d.onnx.GraphProto.verify(a.graphs[f]))return"graphs."+p}}return null},c.fromObject=function(a){if(a instanceof d.onnx.AttributeProto)return a;var f=new d.onnx.AttributeProto;switch(a.name!=null&&(f.name=String(a.name)),a.refAttrName!=null&&(f.refAttrName=String(a.refAttrName)),a.docString!=null&&(f.docString=String(a.docString)),a.type){case"UNDEFINED":case 0:f.type=0;break;case"FLOAT":case 1:f.type=1;break;case"INT":case 2:f.type=2;break;case"STRING":case 3:f.type=3;break;case"TENSOR":case 4:f.type=4;break;case"GRAPH":case 5:f.type=5;break;case"FLOATS":case 6:f.type=6;break;case"INTS":case 7:f.type=7;break;case"STRINGS":case 8:f.type=8;break;case"TENSORS":case 9:f.type=9;break;case"GRAPHS":case 10:f.type=10}if(a.f!=null&&(f.f=Number(a.f)),a.i!=null&&(h.Long?(f.i=h.Long.fromValue(a.i)).unsigned=!1:typeof a.i=="string"?f.i=parseInt(a.i,10):typeof a.i=="number"?f.i=a.i:typeof a.i=="object"&&(f.i=new h.LongBits(a.i.low>>>0,a.i.high>>>0).toNumber())),a.s!=null&&(typeof a.s=="string"?h.base64.decode(a.s,f.s=h.newBuffer(h.base64.length(a.s)),0):a.s.length&&(f.s=a.s)),a.t!=null){if(typeof a.t!="object")throw TypeError(".onnx.AttributeProto.t: object expected");f.t=d.onnx.TensorProto.fromObject(a.t)}if(a.g!=null){if(typeof a.g!="object")throw TypeError(".onnx.AttributeProto.g: object expected");f.g=d.onnx.GraphProto.fromObject(a.g)}if(a.floats){if(!Array.isArray(a.floats))throw TypeError(".onnx.AttributeProto.floats: array expected");f.floats=[];for(var p=0;p<a.floats.length;++p)f.floats[p]=Number(a.floats[p])}if(a.ints){if(!Array.isArray(a.ints))throw TypeError(".onnx.AttributeProto.ints: array expected");for(f.ints=[],p=0;p<a.ints.length;++p)h.Long?(f.ints[p]=h.Long.fromValue(a.ints[p])).unsigned=!1:typeof a.ints[p]=="string"?f.ints[p]=parseInt(a.ints[p],10):typeof a.ints[p]=="number"?f.ints[p]=a.ints[p]:typeof a.ints[p]=="object"&&(f.ints[p]=new h.LongBits(a.ints[p].low>>>0,a.ints[p].high>>>0).toNumber())}if(a.strings){if(!Array.isArray(a.strings))throw TypeError(".onnx.AttributeProto.strings: array expected");for(f.strings=[],p=0;p<a.strings.length;++p)typeof a.strings[p]=="string"?h.base64.decode(a.strings[p],f.strings[p]=h.newBuffer(h.base64.length(a.strings[p])),0):a.strings[p].length&&(f.strings[p]=a.strings[p])}if(a.tensors){if(!Array.isArray(a.tensors))throw TypeError(".onnx.AttributeProto.tensors: array expected");for(f.tensors=[],p=0;p<a.tensors.length;++p){if(typeof a.tensors[p]!="object")throw TypeError(".onnx.AttributeProto.tensors: object expected");f.tensors[p]=d.onnx.TensorProto.fromObject(a.tensors[p])}}if(a.graphs){if(!Array.isArray(a.graphs))throw TypeError(".onnx.AttributeProto.graphs: array expected");for(f.graphs=[],p=0;p<a.graphs.length;++p){if(typeof a.graphs[p]!="object")throw TypeError(".onnx.AttributeProto.graphs: object expected");f.graphs[p]=d.onnx.GraphProto.fromObject(a.graphs[p])}}return f},c.toObject=function(a,f){f||(f={});var p={};if((f.arrays||f.defaults)&&(p.floats=[],p.ints=[],p.strings=[],p.tensors=[],p.graphs=[]),f.defaults){if(p.name="",p.f=0,h.Long){var g=new h.Long(0,0,!1);p.i=f.longs===String?g.toString():f.longs===Number?g.toNumber():g}else p.i=f.longs===String?"0":0;f.bytes===String?p.s="":(p.s=[],f.bytes!==Array&&(p.s=h.newBuffer(p.s))),p.t=null,p.g=null,p.docString="",p.type=f.enums===String?"UNDEFINED":0,p.refAttrName=""}if(a.name!=null&&a.hasOwnProperty("name")&&(p.name=a.name),a.f!=null&&a.hasOwnProperty("f")&&(p.f=f.json&&!isFinite(a.f)?String(a.f):a.f),a.i!=null&&a.hasOwnProperty("i")&&(typeof a.i=="number"?p.i=f.longs===String?String(a.i):a.i:p.i=f.longs===String?h.Long.prototype.toString.call(a.i):f.longs===Number?new h.LongBits(a.i.low>>>0,a.i.high>>>0).toNumber():a.i),a.s!=null&&a.hasOwnProperty("s")&&(p.s=f.bytes===String?h.base64.encode(a.s,0,a.s.length):f.bytes===Array?Array.prototype.slice.call(a.s):a.s),a.t!=null&&a.hasOwnProperty("t")&&(p.t=d.onnx.TensorProto.toObject(a.t,f)),a.g!=null&&a.hasOwnProperty("g")&&(p.g=d.onnx.GraphProto.toObject(a.g,f)),a.floats&&a.floats.length){p.floats=[];for(var m=0;m<a.floats.length;++m)p.floats[m]=f.json&&!isFinite(a.floats[m])?String(a.floats[m]):a.floats[m]}if(a.ints&&a.ints.length)for(p.ints=[],m=0;m<a.ints.length;++m)typeof a.ints[m]=="number"?p.ints[m]=f.longs===String?String(a.ints[m]):a.ints[m]:p.ints[m]=f.longs===String?h.Long.prototype.toString.call(a.ints[m]):f.longs===Number?new h.LongBits(a.ints[m].low>>>0,a.ints[m].high>>>0).toNumber():a.ints[m];if(a.strings&&a.strings.length)for(p.strings=[],m=0;m<a.strings.length;++m)p.strings[m]=f.bytes===String?h.base64.encode(a.strings[m],0,a.strings[m].length):f.bytes===Array?Array.prototype.slice.call(a.strings[m]):a.strings[m];if(a.tensors&&a.tensors.length)for(p.tensors=[],m=0;m<a.tensors.length;++m)p.tensors[m]=d.onnx.TensorProto.toObject(a.tensors[m],f);if(a.graphs&&a.graphs.length)for(p.graphs=[],m=0;m<a.graphs.length;++m)p.graphs[m]=d.onnx.GraphProto.toObject(a.graphs[m],f);return a.docString!=null&&a.hasOwnProperty("docString")&&(p.docString=a.docString),a.type!=null&&a.hasOwnProperty("type")&&(p.type=f.enums===String?d.onnx.AttributeProto.AttributeType[a.type]:a.type),a.refAttrName!=null&&a.hasOwnProperty("refAttrName")&&(p.refAttrName=a.refAttrName),p},c.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},c.AttributeType=function(){var a={},f=Object.create(a);return f[a[0]="UNDEFINED"]=0,f[a[1]="FLOAT"]=1,f[a[2]="INT"]=2,f[a[3]="STRING"]=3,f[a[4]="TENSOR"]=4,f[a[5]="GRAPH"]=5,f[a[6]="FLOATS"]=6,f[a[7]="INTS"]=7,f[a[8]="STRINGS"]=8,f[a[9]="TENSORS"]=9,f[a[10]="GRAPHS"]=10,f}(),c}(),r.ValueInfoProto=function(){function c(a){if(a)for(var f=Object.keys(a),p=0;p<f.length;++p)a[f[p]]!=null&&(this[f[p]]=a[f[p]])}return c.prototype.name="",c.prototype.type=null,c.prototype.docString="",c.create=function(a){return new c(a)},c.encode=function(a,f){return f||(f=u.create()),a.name!=null&&a.hasOwnProperty("name")&&f.uint32(10).string(a.name),a.type!=null&&a.hasOwnProperty("type")&&d.onnx.TypeProto.encode(a.type,f.uint32(18).fork()).ldelim(),a.docString!=null&&a.hasOwnProperty("docString")&&f.uint32(26).string(a.docString),f},c.encodeDelimited=function(a,f){return this.encode(a,f).ldelim()},c.decode=function(a,f){a instanceof l||(a=l.create(a));for(var p=f===void 0?a.len:a.pos+f,g=new d.onnx.ValueInfoProto;a.pos<p;){var m=a.uint32();switch(m>>>3){case 1:g.name=a.string();break;case 2:g.type=d.onnx.TypeProto.decode(a,a.uint32());break;case 3:g.docString=a.string();break;default:a.skipType(7&m)}}return g},c.decodeDelimited=function(a){return a instanceof l||(a=new l(a)),this.decode(a,a.uint32())},c.verify=function(a){if(typeof a!="object"||a===null)return"object expected";if(a.name!=null&&a.hasOwnProperty("name")&&!h.isString(a.name))return"name: string expected";if(a.type!=null&&a.hasOwnProperty("type")){var f=d.onnx.TypeProto.verify(a.type);if(f)return"type."+f}return a.docString!=null&&a.hasOwnProperty("docString")&&!h.isString(a.docString)?"docString: string expected":null},c.fromObject=function(a){if(a instanceof d.onnx.ValueInfoProto)return a;var f=new d.onnx.ValueInfoProto;if(a.name!=null&&(f.name=String(a.name)),a.type!=null){if(typeof a.type!="object")throw TypeError(".onnx.ValueInfoProto.type: object expected");f.type=d.onnx.TypeProto.fromObject(a.type)}return a.docString!=null&&(f.docString=String(a.docString)),f},c.toObject=function(a,f){f||(f={});var p={};return f.defaults&&(p.name="",p.type=null,p.docString=""),a.name!=null&&a.hasOwnProperty("name")&&(p.name=a.name),a.type!=null&&a.hasOwnProperty("type")&&(p.type=d.onnx.TypeProto.toObject(a.type,f)),a.docString!=null&&a.hasOwnProperty("docString")&&(p.docString=a.docString),p},c.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},c}(),r.NodeProto=function(){function c(a){if(this.input=[],this.output=[],this.attribute=[],a)for(var f=Object.keys(a),p=0;p<f.length;++p)a[f[p]]!=null&&(this[f[p]]=a[f[p]])}return c.prototype.input=h.emptyArray,c.prototype.output=h.emptyArray,c.prototype.name="",c.prototype.opType="",c.prototype.domain="",c.prototype.attribute=h.emptyArray,c.prototype.docString="",c.create=function(a){return new c(a)},c.encode=function(a,f){if(f||(f=u.create()),a.input!=null&&a.input.length)for(var p=0;p<a.input.length;++p)f.uint32(10).string(a.input[p]);if(a.output!=null&&a.output.length)for(p=0;p<a.output.length;++p)f.uint32(18).string(a.output[p]);if(a.name!=null&&a.hasOwnProperty("name")&&f.uint32(26).string(a.name),a.opType!=null&&a.hasOwnProperty("opType")&&f.uint32(34).string(a.opType),a.attribute!=null&&a.attribute.length)for(p=0;p<a.attribute.length;++p)d.onnx.AttributeProto.encode(a.attribute[p],f.uint32(42).fork()).ldelim();return a.docString!=null&&a.hasOwnProperty("docString")&&f.uint32(50).string(a.docString),a.domain!=null&&a.hasOwnProperty("domain")&&f.uint32(58).string(a.domain),f},c.encodeDelimited=function(a,f){return this.encode(a,f).ldelim()},c.decode=function(a,f){a instanceof l||(a=l.create(a));for(var p=f===void 0?a.len:a.pos+f,g=new d.onnx.NodeProto;a.pos<p;){var m=a.uint32();switch(m>>>3){case 1:g.input&&g.input.length||(g.input=[]),g.input.push(a.string());break;case 2:g.output&&g.output.length||(g.output=[]),g.output.push(a.string());break;case 3:g.name=a.string();break;case 4:g.opType=a.string();break;case 7:g.domain=a.string();break;case 5:g.attribute&&g.attribute.length||(g.attribute=[]),g.attribute.push(d.onnx.AttributeProto.decode(a,a.uint32()));break;case 6:g.docString=a.string();break;default:a.skipType(7&m)}}return g},c.decodeDelimited=function(a){return a instanceof l||(a=new l(a)),this.decode(a,a.uint32())},c.verify=function(a){if(typeof a!="object"||a===null)return"object expected";if(a.input!=null&&a.hasOwnProperty("input")){if(!Array.isArray(a.input))return"input: array expected";for(var f=0;f<a.input.length;++f)if(!h.isString(a.input[f]))return"input: string[] expected"}if(a.output!=null&&a.hasOwnProperty("output")){if(!Array.isArray(a.output))return"output: array expected";for(f=0;f<a.output.length;++f)if(!h.isString(a.output[f]))return"output: string[] expected"}if(a.name!=null&&a.hasOwnProperty("name")&&!h.isString(a.name))return"name: string expected";if(a.opType!=null&&a.hasOwnProperty("opType")&&!h.isString(a.opType))return"opType: string expected";if(a.domain!=null&&a.hasOwnProperty("domain")&&!h.isString(a.domain))return"domain: string expected";if(a.attribute!=null&&a.hasOwnProperty("attribute")){if(!Array.isArray(a.attribute))return"attribute: array expected";for(f=0;f<a.attribute.length;++f){var p=d.onnx.AttributeProto.verify(a.attribute[f]);if(p)return"attribute."+p}}return a.docString!=null&&a.hasOwnProperty("docString")&&!h.isString(a.docString)?"docString: string expected":null},c.fromObject=function(a){if(a instanceof d.onnx.NodeProto)return a;var f=new d.onnx.NodeProto;if(a.input){if(!Array.isArray(a.input))throw TypeError(".onnx.NodeProto.input: array expected");f.input=[];for(var p=0;p<a.input.length;++p)f.input[p]=String(a.input[p])}if(a.output){if(!Array.isArray(a.output))throw TypeError(".onnx.NodeProto.output: array expected");for(f.output=[],p=0;p<a.output.length;++p)f.output[p]=String(a.output[p])}if(a.name!=null&&(f.name=String(a.name)),a.opType!=null&&(f.opType=String(a.opType)),a.domain!=null&&(f.domain=String(a.domain)),a.attribute){if(!Array.isArray(a.attribute))throw TypeError(".onnx.NodeProto.attribute: array expected");for(f.attribute=[],p=0;p<a.attribute.length;++p){if(typeof a.attribute[p]!="object")throw TypeError(".onnx.NodeProto.attribute: object expected");f.attribute[p]=d.onnx.AttributeProto.fromObject(a.attribute[p])}}return a.docString!=null&&(f.docString=String(a.docString)),f},c.toObject=function(a,f){f||(f={});var p={};if((f.arrays||f.defaults)&&(p.input=[],p.output=[],p.attribute=[]),f.defaults&&(p.name="",p.opType="",p.docString="",p.domain=""),a.input&&a.input.length){p.input=[];for(var g=0;g<a.input.length;++g)p.input[g]=a.input[g]}if(a.output&&a.output.length)for(p.output=[],g=0;g<a.output.length;++g)p.output[g]=a.output[g];if(a.name!=null&&a.hasOwnProperty("name")&&(p.name=a.name),a.opType!=null&&a.hasOwnProperty("opType")&&(p.opType=a.opType),a.attribute&&a.attribute.length)for(p.attribute=[],g=0;g<a.attribute.length;++g)p.attribute[g]=d.onnx.AttributeProto.toObject(a.attribute[g],f);return a.docString!=null&&a.hasOwnProperty("docString")&&(p.docString=a.docString),a.domain!=null&&a.hasOwnProperty("domain")&&(p.domain=a.domain),p},c.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},c}(),r.ModelProto=function(){function c(a){if(this.opsetImport=[],this.metadataProps=[],a)for(var f=Object.keys(a),p=0;p<f.length;++p)a[f[p]]!=null&&(this[f[p]]=a[f[p]])}return c.prototype.irVersion=h.Long?h.Long.fromBits(0,0,!1):0,c.prototype.opsetImport=h.emptyArray,c.prototype.producerName="",c.prototype.producerVersion="",c.prototype.domain="",c.prototype.modelVersion=h.Long?h.Long.fromBits(0,0,!1):0,c.prototype.docString="",c.prototype.graph=null,c.prototype.metadataProps=h.emptyArray,c.create=function(a){return new c(a)},c.encode=function(a,f){if(f||(f=u.create()),a.irVersion!=null&&a.hasOwnProperty("irVersion")&&f.uint32(8).int64(a.irVersion),a.producerName!=null&&a.hasOwnProperty("producerName")&&f.uint32(18).string(a.producerName),a.producerVersion!=null&&a.hasOwnProperty("producerVersion")&&f.uint32(26).string(a.producerVersion),a.domain!=null&&a.hasOwnProperty("domain")&&f.uint32(34).string(a.domain),a.modelVersion!=null&&a.hasOwnProperty("modelVersion")&&f.uint32(40).int64(a.modelVersion),a.docString!=null&&a.hasOwnProperty("docString")&&f.uint32(50).string(a.docString),a.graph!=null&&a.hasOwnProperty("graph")&&d.onnx.GraphProto.encode(a.graph,f.uint32(58).fork()).ldelim(),a.opsetImport!=null&&a.opsetImport.length)for(var p=0;p<a.opsetImport.length;++p)d.onnx.OperatorSetIdProto.encode(a.opsetImport[p],f.uint32(66).fork()).ldelim();if(a.metadataProps!=null&&a.metadataProps.length)for(p=0;p<a.metadataProps.length;++p)d.onnx.StringStringEntryProto.encode(a.metadataProps[p],f.uint32(114).fork()).ldelim();return f},c.encodeDelimited=function(a,f){return this.encode(a,f).ldelim()},c.decode=function(a,f){a instanceof l||(a=l.create(a));for(var p=f===void 0?a.len:a.pos+f,g=new d.onnx.ModelProto;a.pos<p;){var m=a.uint32();switch(m>>>3){case 1:g.irVersion=a.int64();break;case 8:g.opsetImport&&g.opsetImport.length||(g.opsetImport=[]),g.opsetImport.push(d.onnx.OperatorSetIdProto.decode(a,a.uint32()));break;case 2:g.producerName=a.string();break;case 3:g.producerVersion=a.string();break;case 4:g.domain=a.string();break;case 5:g.modelVersion=a.int64();break;case 6:g.docString=a.string();break;case 7:g.graph=d.onnx.GraphProto.decode(a,a.uint32());break;case 14:g.metadataProps&&g.metadataProps.length||(g.metadataProps=[]),g.metadataProps.push(d.onnx.StringStringEntryProto.decode(a,a.uint32()));break;default:a.skipType(7&m)}}return g},c.decodeDelimited=function(a){return a instanceof l||(a=new l(a)),this.decode(a,a.uint32())},c.verify=function(a){if(typeof a!="object"||a===null)return"object expected";if(a.irVersion!=null&&a.hasOwnProperty("irVersion")&&!(h.isInteger(a.irVersion)||a.irVersion&&h.isInteger(a.irVersion.low)&&h.isInteger(a.irVersion.high)))return"irVersion: integer|Long expected";if(a.opsetImport!=null&&a.hasOwnProperty("opsetImport")){if(!Array.isArray(a.opsetImport))return"opsetImport: array expected";for(var f=0;f<a.opsetImport.length;++f)if(p=d.onnx.OperatorSetIdProto.verify(a.opsetImport[f]))return"opsetImport."+p}if(a.producerName!=null&&a.hasOwnProperty("producerName")&&!h.isString(a.producerName))return"producerName: string expected";if(a.producerVersion!=null&&a.hasOwnProperty("producerVersion")&&!h.isString(a.producerVersion))return"producerVersion: string expected";if(a.domain!=null&&a.hasOwnProperty("domain")&&!h.isString(a.domain))return"domain: string expected";if(a.modelVersion!=null&&a.hasOwnProperty("modelVersion")&&!(h.isInteger(a.modelVersion)||a.modelVersion&&h.isInteger(a.modelVersion.low)&&h.isInteger(a.modelVersion.high)))return"modelVersion: integer|Long expected";if(a.docString!=null&&a.hasOwnProperty("docString")&&!h.isString(a.docString))return"docString: string expected";if(a.graph!=null&&a.hasOwnProperty("graph")&&(p=d.onnx.GraphProto.verify(a.graph)))return"graph."+p;if(a.metadataProps!=null&&a.hasOwnProperty("metadataProps")){if(!Array.isArray(a.metadataProps))return"metadataProps: array expected";for(f=0;f<a.metadataProps.length;++f){var p;if(p=d.onnx.StringStringEntryProto.verify(a.metadataProps[f]))return"metadataProps."+p}}return null},c.fromObject=function(a){if(a instanceof d.onnx.ModelProto)return a;var f=new d.onnx.ModelProto;if(a.irVersion!=null&&(h.Long?(f.irVersion=h.Long.fromValue(a.irVersion)).unsigned=!1:typeof a.irVersion=="string"?f.irVersion=parseInt(a.irVersion,10):typeof a.irVersion=="number"?f.irVersion=a.irVersion:typeof a.irVersion=="object"&&(f.irVersion=new h.LongBits(a.irVersion.low>>>0,a.irVersion.high>>>0).toNumber())),a.opsetImport){if(!Array.isArray(a.opsetImport))throw TypeError(".onnx.ModelProto.opsetImport: array expected");f.opsetImport=[];for(var p=0;p<a.opsetImport.length;++p){if(typeof a.opsetImport[p]!="object")throw TypeError(".onnx.ModelProto.opsetImport: object expected");f.opsetImport[p]=d.onnx.OperatorSetIdProto.fromObject(a.opsetImport[p])}}if(a.producerName!=null&&(f.producerName=String(a.producerName)),a.producerVersion!=null&&(f.producerVersion=String(a.producerVersion)),a.domain!=null&&(f.domain=String(a.domain)),a.modelVersion!=null&&(h.Long?(f.modelVersion=h.Long.fromValue(a.modelVersion)).unsigned=!1:typeof a.modelVersion=="string"?f.modelVersion=parseInt(a.modelVersion,10):typeof a.modelVersion=="number"?f.modelVersion=a.modelVersion:typeof a.modelVersion=="object"&&(f.modelVersion=new h.LongBits(a.modelVersion.low>>>0,a.modelVersion.high>>>0).toNumber())),a.docString!=null&&(f.docString=String(a.docString)),a.graph!=null){if(typeof a.graph!="object")throw TypeError(".onnx.ModelProto.graph: object expected");f.graph=d.onnx.GraphProto.fromObject(a.graph)}if(a.metadataProps){if(!Array.isArray(a.metadataProps))throw TypeError(".onnx.ModelProto.metadataProps: array expected");for(f.metadataProps=[],p=0;p<a.metadataProps.length;++p){if(typeof a.metadataProps[p]!="object")throw TypeError(".onnx.ModelProto.metadataProps: object expected");f.metadataProps[p]=d.onnx.StringStringEntryProto.fromObject(a.metadataProps[p])}}return f},c.toObject=function(a,f){f||(f={});var p={};if((f.arrays||f.defaults)&&(p.opsetImport=[],p.metadataProps=[]),f.defaults){if(h.Long){var g=new h.Long(0,0,!1);p.irVersion=f.longs===String?g.toString():f.longs===Number?g.toNumber():g}else p.irVersion=f.longs===String?"0":0;p.producerName="",p.producerVersion="",p.domain="",h.Long?(g=new h.Long(0,0,!1),p.modelVersion=f.longs===String?g.toString():f.longs===Number?g.toNumber():g):p.modelVersion=f.longs===String?"0":0,p.docString="",p.graph=null}if(a.irVersion!=null&&a.hasOwnProperty("irVersion")&&(typeof a.irVersion=="number"?p.irVersion=f.longs===String?String(a.irVersion):a.irVersion:p.irVersion=f.longs===String?h.Long.prototype.toString.call(a.irVersion):f.longs===Number?new h.LongBits(a.irVersion.low>>>0,a.irVersion.high>>>0).toNumber():a.irVersion),a.producerName!=null&&a.hasOwnProperty("producerName")&&(p.producerName=a.producerName),a.producerVersion!=null&&a.hasOwnProperty("producerVersion")&&(p.producerVersion=a.producerVersion),a.domain!=null&&a.hasOwnProperty("domain")&&(p.domain=a.domain),a.modelVersion!=null&&a.hasOwnProperty("modelVersion")&&(typeof a.modelVersion=="number"?p.modelVersion=f.longs===String?String(a.modelVersion):a.modelVersion:p.modelVersion=f.longs===String?h.Long.prototype.toString.call(a.modelVersion):f.longs===Number?new h.LongBits(a.modelVersion.low>>>0,a.modelVersion.high>>>0).toNumber():a.modelVersion),a.docString!=null&&a.hasOwnProperty("docString")&&(p.docString=a.docString),a.graph!=null&&a.hasOwnProperty("graph")&&(p.graph=d.onnx.GraphProto.toObject(a.graph,f)),a.opsetImport&&a.opsetImport.length){p.opsetImport=[];for(var m=0;m<a.opsetImport.length;++m)p.opsetImport[m]=d.onnx.OperatorSetIdProto.toObject(a.opsetImport[m],f)}if(a.metadataProps&&a.metadataProps.length)for(p.metadataProps=[],m=0;m<a.metadataProps.length;++m)p.metadataProps[m]=d.onnx.StringStringEntryProto.toObject(a.metadataProps[m],f);return p},c.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},c}(),r.StringStringEntryProto=function(){function c(a){if(a)for(var f=Object.keys(a),p=0;p<f.length;++p)a[f[p]]!=null&&(this[f[p]]=a[f[p]])}return c.prototype.key="",c.prototype.value="",c.create=function(a){return new c(a)},c.encode=function(a,f){return f||(f=u.create()),a.key!=null&&a.hasOwnProperty("key")&&f.uint32(10).string(a.key),a.value!=null&&a.hasOwnProperty("value")&&f.uint32(18).string(a.value),f},c.encodeDelimited=function(a,f){return this.encode(a,f).ldelim()},c.decode=function(a,f){a instanceof l||(a=l.create(a));for(var p=f===void 0?a.len:a.pos+f,g=new d.onnx.StringStringEntryProto;a.pos<p;){var m=a.uint32();switch(m>>>3){case 1:g.key=a.string();break;case 2:g.value=a.string();break;default:a.skipType(7&m)}}return g},c.decodeDelimited=function(a){return a instanceof l||(a=new l(a)),this.decode(a,a.uint32())},c.verify=function(a){return typeof a!="object"||a===null?"object expected":a.key!=null&&a.hasOwnProperty("key")&&!h.isString(a.key)?"key: string expected":a.value!=null&&a.hasOwnProperty("value")&&!h.isString(a.value)?"value: string expected":null},c.fromObject=function(a){if(a instanceof d.onnx.StringStringEntryProto)return a;var f=new d.onnx.StringStringEntryProto;return a.key!=null&&(f.key=String(a.key)),a.value!=null&&(f.value=String(a.value)),f},c.toObject=function(a,f){f||(f={});var p={};return f.defaults&&(p.key="",p.value=""),a.key!=null&&a.hasOwnProperty("key")&&(p.key=a.key),a.value!=null&&a.hasOwnProperty("value")&&(p.value=a.value),p},c.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},c}(),r.TensorAnnotation=function(){function c(a){if(this.quantParameterTensorNames=[],a)for(var f=Object.keys(a),p=0;p<f.length;++p)a[f[p]]!=null&&(this[f[p]]=a[f[p]])}return c.prototype.tensorName="",c.prototype.quantParameterTensorNames=h.emptyArray,c.create=function(a){return new c(a)},c.encode=function(a,f){if(f||(f=u.create()),a.tensorName!=null&&a.hasOwnProperty("tensorName")&&f.uint32(10).string(a.tensorName),a.quantParameterTensorNames!=null&&a.quantParameterTensorNames.length)for(var p=0;p<a.quantParameterTensorNames.length;++p)d.onnx.StringStringEntryProto.encode(a.quantParameterTensorNames[p],f.uint32(18).fork()).ldelim();return f},c.encodeDelimited=function(a,f){return this.encode(a,f).ldelim()},c.decode=function(a,f){a instanceof l||(a=l.create(a));for(var p=f===void 0?a.len:a.pos+f,g=new d.onnx.TensorAnnotation;a.pos<p;){var m=a.uint32();switch(m>>>3){case 1:g.tensorName=a.string();break;case 2:g.quantParameterTensorNames&&g.quantParameterTensorNames.length||(g.quantParameterTensorNames=[]),g.quantParameterTensorNames.push(d.onnx.StringStringEntryProto.decode(a,a.uint32()));break;default:a.skipType(7&m)}}return g},c.decodeDelimited=function(a){return a instanceof l||(a=new l(a)),this.decode(a,a.uint32())},c.verify=function(a){if(typeof a!="object"||a===null)return"object expected";if(a.tensorName!=null&&a.hasOwnProperty("tensorName")&&!h.isString(a.tensorName))return"tensorName: string expected";if(a.quantParameterTensorNames!=null&&a.hasOwnProperty("quantParameterTensorNames")){if(!Array.isArray(a.quantParameterTensorNames))return"quantParameterTensorNames: array expected";for(var f=0;f<a.quantParameterTensorNames.length;++f){var p=d.onnx.StringStringEntryProto.verify(a.quantParameterTensorNames[f]);if(p)return"quantParameterTensorNames."+p}}return null},c.fromObject=function(a){if(a instanceof d.onnx.TensorAnnotation)return a;var f=new d.onnx.TensorAnnotation;if(a.tensorName!=null&&(f.tensorName=String(a.tensorName)),a.quantParameterTensorNames){if(!Array.isArray(a.quantParameterTensorNames))throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: array expected");f.quantParameterTensorNames=[];for(var p=0;p<a.quantParameterTensorNames.length;++p){if(typeof a.quantParameterTensorNames[p]!="object")throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: object expected");f.quantParameterTensorNames[p]=d.onnx.StringStringEntryProto.fromObject(a.quantParameterTensorNames[p])}}return f},c.toObject=function(a,f){f||(f={});var p={};if((f.arrays||f.defaults)&&(p.quantParameterTensorNames=[]),f.defaults&&(p.tensorName=""),a.tensorName!=null&&a.hasOwnProperty("tensorName")&&(p.tensorName=a.tensorName),a.quantParameterTensorNames&&a.quantParameterTensorNames.length){p.quantParameterTensorNames=[];for(var g=0;g<a.quantParameterTensorNames.length;++g)p.quantParameterTensorNames[g]=d.onnx.StringStringEntryProto.toObject(a.quantParameterTensorNames[g],f)}return p},c.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},c}(),r.GraphProto=function(){function c(a){if(this.node=[],this.initializer=[],this.input=[],this.output=[],this.valueInfo=[],this.quantizationAnnotation=[],a)for(var f=Object.keys(a),p=0;p<f.length;++p)a[f[p]]!=null&&(this[f[p]]=a[f[p]])}return c.prototype.node=h.emptyArray,c.prototype.name="",c.prototype.initializer=h.emptyArray,c.prototype.docString="",c.prototype.input=h.emptyArray,c.prototype.output=h.emptyArray,c.prototype.valueInfo=h.emptyArray,c.prototype.quantizationAnnotation=h.emptyArray,c.create=function(a){return new c(a)},c.encode=function(a,f){if(f||(f=u.create()),a.node!=null&&a.node.length)for(var p=0;p<a.node.length;++p)d.onnx.NodeProto.encode(a.node[p],f.uint32(10).fork()).ldelim();if(a.name!=null&&a.hasOwnProperty("name")&&f.uint32(18).string(a.name),a.initializer!=null&&a.initializer.length)for(p=0;p<a.initializer.length;++p)d.onnx.TensorProto.encode(a.initializer[p],f.uint32(42).fork()).ldelim();if(a.docString!=null&&a.hasOwnProperty("docString")&&f.uint32(82).string(a.docString),a.input!=null&&a.input.length)for(p=0;p<a.input.length;++p)d.onnx.ValueInfoProto.encode(a.input[p],f.uint32(90).fork()).ldelim();if(a.output!=null&&a.output.length)for(p=0;p<a.output.length;++p)d.onnx.ValueInfoProto.encode(a.output[p],f.uint32(98).fork()).ldelim();if(a.valueInfo!=null&&a.valueInfo.length)for(p=0;p<a.valueInfo.length;++p)d.onnx.ValueInfoProto.encode(a.valueInfo[p],f.uint32(106).fork()).ldelim();if(a.quantizationAnnotation!=null&&a.quantizationAnnotation.length)for(p=0;p<a.quantizationAnnotation.length;++p)d.onnx.TensorAnnotation.encode(a.quantizationAnnotation[p],f.uint32(114).fork()).ldelim();return f},c.encodeDelimited=function(a,f){return this.encode(a,f).ldelim()},c.decode=function(a,f){a instanceof l||(a=l.create(a));for(var p=f===void 0?a.len:a.pos+f,g=new d.onnx.GraphProto;a.pos<p;){var m=a.uint32();switch(m>>>3){case 1:g.node&&g.node.length||(g.node=[]),g.node.push(d.onnx.NodeProto.decode(a,a.uint32()));break;case 2:g.name=a.string();break;case 5:g.initializer&&g.initializer.length||(g.initializer=[]),g.initializer.push(d.onnx.TensorProto.decode(a,a.uint32()));break;case 10:g.docString=a.string();break;case 11:g.input&&g.input.length||(g.input=[]),g.input.push(d.onnx.ValueInfoProto.decode(a,a.uint32()));break;case 12:g.output&&g.output.length||(g.output=[]),g.output.push(d.onnx.ValueInfoProto.decode(a,a.uint32()));break;case 13:g.valueInfo&&g.valueInfo.length||(g.valueInfo=[]),g.valueInfo.push(d.onnx.ValueInfoProto.decode(a,a.uint32()));break;case 14:g.quantizationAnnotation&&g.quantizationAnnotation.length||(g.quantizationAnnotation=[]),g.quantizationAnnotation.push(d.onnx.TensorAnnotation.decode(a,a.uint32()));break;default:a.skipType(7&m)}}return g},c.decodeDelimited=function(a){return a instanceof l||(a=new l(a)),this.decode(a,a.uint32())},c.verify=function(a){if(typeof a!="object"||a===null)return"object expected";if(a.node!=null&&a.hasOwnProperty("node")){if(!Array.isArray(a.node))return"node: array expected";for(var f=0;f<a.node.length;++f)if(p=d.onnx.NodeProto.verify(a.node[f]))return"node."+p}if(a.name!=null&&a.hasOwnProperty("name")&&!h.isString(a.name))return"name: string expected";if(a.initializer!=null&&a.hasOwnProperty("initializer")){if(!Array.isArray(a.initializer))return"initializer: array expected";for(f=0;f<a.initializer.length;++f)if(p=d.onnx.TensorProto.verify(a.initializer[f]))return"initializer."+p}if(a.docString!=null&&a.hasOwnProperty("docString")&&!h.isString(a.docString))return"docString: string expected";if(a.input!=null&&a.hasOwnProperty("input")){if(!Array.isArray(a.input))return"input: array expected";for(f=0;f<a.input.length;++f)if(p=d.onnx.ValueInfoProto.verify(a.input[f]))return"input."+p}if(a.output!=null&&a.hasOwnProperty("output")){if(!Array.isArray(a.output))return"output: array expected";for(f=0;f<a.output.length;++f)if(p=d.onnx.ValueInfoProto.verify(a.output[f]))return"output."+p}if(a.valueInfo!=null&&a.hasOwnProperty("valueInfo")){if(!Array.isArray(a.valueInfo))return"valueInfo: array expected";for(f=0;f<a.valueInfo.length;++f)if(p=d.onnx.ValueInfoProto.verify(a.valueInfo[f]))return"valueInfo."+p}if(a.quantizationAnnotation!=null&&a.hasOwnProperty("quantizationAnnotation")){if(!Array.isArray(a.quantizationAnnotation))return"quantizationAnnotation: array expected";for(f=0;f<a.quantizationAnnotation.length;++f){var p;if(p=d.onnx.TensorAnnotation.verify(a.quantizationAnnotation[f]))return"quantizationAnnotation."+p}}return null},c.fromObject=function(a){if(a instanceof d.onnx.GraphProto)return a;var f=new d.onnx.GraphProto;if(a.node){if(!Array.isArray(a.node))throw TypeError(".onnx.GraphProto.node: array expected");f.node=[];for(var p=0;p<a.node.length;++p){if(typeof a.node[p]!="object")throw TypeError(".onnx.GraphProto.node: object expected");f.node[p]=d.onnx.NodeProto.fromObject(a.node[p])}}if(a.name!=null&&(f.name=String(a.name)),a.initializer){if(!Array.isArray(a.initializer))throw TypeError(".onnx.GraphProto.initializer: array expected");for(f.initializer=[],p=0;p<a.initializer.length;++p){if(typeof a.initializer[p]!="object")throw TypeError(".onnx.GraphProto.initializer: object expected");f.initializer[p]=d.onnx.TensorProto.fromObject(a.initializer[p])}}if(a.docString!=null&&(f.docString=String(a.docString)),a.input){if(!Array.isArray(a.input))throw TypeError(".onnx.GraphProto.input: array expected");for(f.input=[],p=0;p<a.input.length;++p){if(typeof a.input[p]!="object")throw TypeError(".onnx.GraphProto.input: object expected");f.input[p]=d.onnx.ValueInfoProto.fromObject(a.input[p])}}if(a.output){if(!Array.isArray(a.output))throw TypeError(".onnx.GraphProto.output: array expected");for(f.output=[],p=0;p<a.output.length;++p){if(typeof a.output[p]!="object")throw TypeError(".onnx.GraphProto.output: object expected");f.output[p]=d.onnx.ValueInfoProto.fromObject(a.output[p])}}if(a.valueInfo){if(!Array.isArray(a.valueInfo))throw TypeError(".onnx.GraphProto.valueInfo: array expected");for(f.valueInfo=[],p=0;p<a.valueInfo.length;++p){if(typeof a.valueInfo[p]!="object")throw TypeError(".onnx.GraphProto.valueInfo: object expected");f.valueInfo[p]=d.onnx.ValueInfoProto.fromObject(a.valueInfo[p])}}if(a.quantizationAnnotation){if(!Array.isArray(a.quantizationAnnotation))throw TypeError(".onnx.GraphProto.quantizationAnnotation: array expected");for(f.quantizationAnnotation=[],p=0;p<a.quantizationAnnotation.length;++p){if(typeof a.quantizationAnnotation[p]!="object")throw TypeError(".onnx.GraphProto.quantizationAnnotation: object expected");f.quantizationAnnotation[p]=d.onnx.TensorAnnotation.fromObject(a.quantizationAnnotation[p])}}return f},c.toObject=function(a,f){f||(f={});var p={};if((f.arrays||f.defaults)&&(p.node=[],p.initializer=[],p.input=[],p.output=[],p.valueInfo=[],p.quantizationAnnotation=[]),f.defaults&&(p.name="",p.docString=""),a.node&&a.node.length){p.node=[];for(var g=0;g<a.node.length;++g)p.node[g]=d.onnx.NodeProto.toObject(a.node[g],f)}if(a.name!=null&&a.hasOwnProperty("name")&&(p.name=a.name),a.initializer&&a.initializer.length)for(p.initializer=[],g=0;g<a.initializer.length;++g)p.initializer[g]=d.onnx.TensorProto.toObject(a.initializer[g],f);if(a.docString!=null&&a.hasOwnProperty("docString")&&(p.docString=a.docString),a.input&&a.input.length)for(p.input=[],g=0;g<a.input.length;++g)p.input[g]=d.onnx.ValueInfoProto.toObject(a.input[g],f);if(a.output&&a.output.length)for(p.output=[],g=0;g<a.output.length;++g)p.output[g]=d.onnx.ValueInfoProto.toObject(a.output[g],f);if(a.valueInfo&&a.valueInfo.length)for(p.valueInfo=[],g=0;g<a.valueInfo.length;++g)p.valueInfo[g]=d.onnx.ValueInfoProto.toObject(a.valueInfo[g],f);if(a.quantizationAnnotation&&a.quantizationAnnotation.length)for(p.quantizationAnnotation=[],g=0;g<a.quantizationAnnotation.length;++g)p.quantizationAnnotation[g]=d.onnx.TensorAnnotation.toObject(a.quantizationAnnotation[g],f);return p},c.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},c}(),r.TensorProto=function(){function c(a){if(this.dims=[],this.floatData=[],this.int32Data=[],this.stringData=[],this.int64Data=[],this.externalData=[],this.doubleData=[],this.uint64Data=[],a)for(var f=Object.keys(a),p=0;p<f.length;++p)a[f[p]]!=null&&(this[f[p]]=a[f[p]])}return c.prototype.dims=h.emptyArray,c.prototype.dataType=0,c.prototype.segment=null,c.prototype.floatData=h.emptyArray,c.prototype.int32Data=h.emptyArray,c.prototype.stringData=h.emptyArray,c.prototype.int64Data=h.emptyArray,c.prototype.name="",c.prototype.docString="",c.prototype.rawData=h.newBuffer([]),c.prototype.externalData=h.emptyArray,c.prototype.dataLocation=0,c.prototype.doubleData=h.emptyArray,c.prototype.uint64Data=h.emptyArray,c.create=function(a){return new c(a)},c.encode=function(a,f){if(f||(f=u.create()),a.dims!=null&&a.dims.length){f.uint32(10).fork();for(var p=0;p<a.dims.length;++p)f.int64(a.dims[p]);f.ldelim()}if(a.dataType!=null&&a.hasOwnProperty("dataType")&&f.uint32(16).int32(a.dataType),a.segment!=null&&a.hasOwnProperty("segment")&&d.onnx.TensorProto.Segment.encode(a.segment,f.uint32(26).fork()).ldelim(),a.floatData!=null&&a.floatData.length){for(f.uint32(34).fork(),p=0;p<a.floatData.length;++p)f.float(a.floatData[p]);f.ldelim()}if(a.int32Data!=null&&a.int32Data.length){for(f.uint32(42).fork(),p=0;p<a.int32Data.length;++p)f.int32(a.int32Data[p]);f.ldelim()}if(a.stringData!=null&&a.stringData.length)for(p=0;p<a.stringData.length;++p)f.uint32(50).bytes(a.stringData[p]);if(a.int64Data!=null&&a.int64Data.length){for(f.uint32(58).fork(),p=0;p<a.int64Data.length;++p)f.int64(a.int64Data[p]);f.ldelim()}if(a.name!=null&&a.hasOwnProperty("name")&&f.uint32(66).string(a.name),a.rawData!=null&&a.hasOwnProperty("rawData")&&f.uint32(74).bytes(a.rawData),a.doubleData!=null&&a.doubleData.length){for(f.uint32(82).fork(),p=0;p<a.doubleData.length;++p)f.double(a.doubleData[p]);f.ldelim()}if(a.uint64Data!=null&&a.uint64Data.length){for(f.uint32(90).fork(),p=0;p<a.uint64Data.length;++p)f.uint64(a.uint64Data[p]);f.ldelim()}if(a.docString!=null&&a.hasOwnProperty("docString")&&f.uint32(98).string(a.docString),a.externalData!=null&&a.externalData.length)for(p=0;p<a.externalData.length;++p)d.onnx.StringStringEntryProto.encode(a.externalData[p],f.uint32(106).fork()).ldelim();return a.dataLocation!=null&&a.hasOwnProperty("dataLocation")&&f.uint32(112).int32(a.dataLocation),f},c.encodeDelimited=function(a,f){return this.encode(a,f).ldelim()},c.decode=function(a,f){a instanceof l||(a=l.create(a));for(var p=f===void 0?a.len:a.pos+f,g=new d.onnx.TensorProto;a.pos<p;){var m=a.uint32();switch(m>>>3){case 1:if(g.dims&&g.dims.length||(g.dims=[]),(7&m)==2)for(var y=a.uint32()+a.pos;a.pos<y;)g.dims.push(a.int64());else g.dims.push(a.int64());break;case 2:g.dataType=a.int32();break;case 3:g.segment=d.onnx.TensorProto.Segment.decode(a,a.uint32());break;case 4:if(g.floatData&&g.floatData.length||(g.floatData=[]),(7&m)==2)for(y=a.uint32()+a.pos;a.pos<y;)g.floatData.push(a.float());else g.floatData.push(a.float());break;case 5:if(g.int32Data&&g.int32Data.length||(g.int32Data=[]),(7&m)==2)for(y=a.uint32()+a.pos;a.pos<y;)g.int32Data.push(a.int32());else g.int32Data.push(a.int32());break;case 6:g.stringData&&g.stringData.length||(g.stringData=[]),g.stringData.push(a.bytes());break;case 7:if(g.int64Data&&g.int64Data.length||(g.int64Data=[]),(7&m)==2)for(y=a.uint32()+a.pos;a.pos<y;)g.int64Data.push(a.int64());else g.int64Data.push(a.int64());break;case 8:g.name=a.string();break;case 12:g.docString=a.string();break;case 9:g.rawData=a.bytes();break;case 13:g.externalData&&g.externalData.length||(g.externalData=[]),g.externalData.push(d.onnx.StringStringEntryProto.decode(a,a.uint32()));break;case 14:g.dataLocation=a.int32();break;case 10:if(g.doubleData&&g.doubleData.length||(g.doubleData=[]),(7&m)==2)for(y=a.uint32()+a.pos;a.pos<y;)g.doubleData.push(a.double());else g.doubleData.push(a.double());break;case 11:if(g.uint64Data&&g.uint64Data.length||(g.uint64Data=[]),(7&m)==2)for(y=a.uint32()+a.pos;a.pos<y;)g.uint64Data.push(a.uint64());else g.uint64Data.push(a.uint64());break;default:a.skipType(7&m)}}return g},c.decodeDelimited=function(a){return a instanceof l||(a=new l(a)),this.decode(a,a.uint32())},c.verify=function(a){if(typeof a!="object"||a===null)return"object expected";if(a.dims!=null&&a.hasOwnProperty("dims")){if(!Array.isArray(a.dims))return"dims: array expected";for(var f=0;f<a.dims.length;++f)if(!(h.isInteger(a.dims[f])||a.dims[f]&&h.isInteger(a.dims[f].low)&&h.isInteger(a.dims[f].high)))return"dims: integer|Long[] expected"}if(a.dataType!=null&&a.hasOwnProperty("dataType")&&!h.isInteger(a.dataType))return"dataType: integer expected";if(a.segment!=null&&a.hasOwnProperty("segment")&&(p=d.onnx.TensorProto.Segment.verify(a.segment)))return"segment."+p;if(a.floatData!=null&&a.hasOwnProperty("floatData")){if(!Array.isArray(a.floatData))return"floatData: array expected";for(f=0;f<a.floatData.length;++f)if(typeof a.floatData[f]!="number")return"floatData: number[] expected"}if(a.int32Data!=null&&a.hasOwnProperty("int32Data")){if(!Array.isArray(a.int32Data))return"int32Data: array expected";for(f=0;f<a.int32Data.length;++f)if(!h.isInteger(a.int32Data[f]))return"int32Data: integer[] expected"}if(a.stringData!=null&&a.hasOwnProperty("stringData")){if(!Array.isArray(a.stringData))return"stringData: array expected";for(f=0;f<a.stringData.length;++f)if(!(a.stringData[f]&&typeof a.stringData[f].length=="number"||h.isString(a.stringData[f])))return"stringData: buffer[] expected"}if(a.int64Data!=null&&a.hasOwnProperty("int64Data")){if(!Array.isArray(a.int64Data))return"int64Data: array expected";for(f=0;f<a.int64Data.length;++f)if(!(h.isInteger(a.int64Data[f])||a.int64Data[f]&&h.isInteger(a.int64Data[f].low)&&h.isInteger(a.int64Data[f].high)))return"int64Data: integer|Long[] expected"}if(a.name!=null&&a.hasOwnProperty("name")&&!h.isString(a.name))return"name: string expected";if(a.docString!=null&&a.hasOwnProperty("docString")&&!h.isString(a.docString))return"docString: string expected";if(a.rawData!=null&&a.hasOwnProperty("rawData")&&!(a.rawData&&typeof a.rawData.length=="number"||h.isString(a.rawData)))return"rawData: buffer expected";if(a.externalData!=null&&a.hasOwnProperty("externalData")){if(!Array.isArray(a.externalData))return"externalData: array expected";for(f=0;f<a.externalData.length;++f){var p;if(p=d.onnx.StringStringEntryProto.verify(a.externalData[f]))return"externalData."+p}}if(a.dataLocation!=null&&a.hasOwnProperty("dataLocation"))switch(a.dataLocation){default:return"dataLocation: enum value expected";case 0:case 1:}if(a.doubleData!=null&&a.hasOwnProperty("doubleData")){if(!Array.isArray(a.doubleData))return"doubleData: array expected";for(f=0;f<a.doubleData.length;++f)if(typeof a.doubleData[f]!="number")return"doubleData: number[] expected"}if(a.uint64Data!=null&&a.hasOwnProperty("uint64Data")){if(!Array.isArray(a.uint64Data))return"uint64Data: array expected";for(f=0;f<a.uint64Data.length;++f)if(!(h.isInteger(a.uint64Data[f])||a.uint64Data[f]&&h.isInteger(a.uint64Data[f].low)&&h.isInteger(a.uint64Data[f].high)))return"uint64Data: integer|Long[] expected"}return null},c.fromObject=function(a){if(a instanceof d.onnx.TensorProto)return a;var f=new d.onnx.TensorProto;if(a.dims){if(!Array.isArray(a.dims))throw TypeError(".onnx.TensorProto.dims: array expected");f.dims=[];for(var p=0;p<a.dims.length;++p)h.Long?(f.dims[p]=h.Long.fromValue(a.dims[p])).unsigned=!1:typeof a.dims[p]=="string"?f.dims[p]=parseInt(a.dims[p],10):typeof a.dims[p]=="number"?f.dims[p]=a.dims[p]:typeof a.dims[p]=="object"&&(f.dims[p]=new h.LongBits(a.dims[p].low>>>0,a.dims[p].high>>>0).toNumber())}if(a.dataType!=null&&(f.dataType=0|a.dataType),a.segment!=null){if(typeof a.segment!="object")throw TypeError(".onnx.TensorProto.segment: object expected");f.segment=d.onnx.TensorProto.Segment.fromObject(a.segment)}if(a.floatData){if(!Array.isArray(a.floatData))throw TypeError(".onnx.TensorProto.floatData: array expected");for(f.floatData=[],p=0;p<a.floatData.length;++p)f.floatData[p]=Number(a.floatData[p])}if(a.int32Data){if(!Array.isArray(a.int32Data))throw TypeError(".onnx.TensorProto.int32Data: array expected");for(f.int32Data=[],p=0;p<a.int32Data.length;++p)f.int32Data[p]=0|a.int32Data[p]}if(a.stringData){if(!Array.isArray(a.stringData))throw TypeError(".onnx.TensorProto.stringData: array expected");for(f.stringData=[],p=0;p<a.stringData.length;++p)typeof a.stringData[p]=="string"?h.base64.decode(a.stringData[p],f.stringData[p]=h.newBuffer(h.base64.length(a.stringData[p])),0):a.stringData[p].length&&(f.stringData[p]=a.stringData[p])}if(a.int64Data){if(!Array.isArray(a.int64Data))throw TypeError(".onnx.TensorProto.int64Data: array expected");for(f.int64Data=[],p=0;p<a.int64Data.length;++p)h.Long?(f.int64Data[p]=h.Long.fromValue(a.int64Data[p])).unsigned=!1:typeof a.int64Data[p]=="string"?f.int64Data[p]=parseInt(a.int64Data[p],10):typeof a.int64Data[p]=="number"?f.int64Data[p]=a.int64Data[p]:typeof a.int64Data[p]=="object"&&(f.int64Data[p]=new h.LongBits(a.int64Data[p].low>>>0,a.int64Data[p].high>>>0).toNumber())}if(a.name!=null&&(f.name=String(a.name)),a.docString!=null&&(f.docString=String(a.docString)),a.rawData!=null&&(typeof a.rawData=="string"?h.base64.decode(a.rawData,f.rawData=h.newBuffer(h.base64.length(a.rawData)),0):a.rawData.length&&(f.rawData=a.rawData)),a.externalData){if(!Array.isArray(a.externalData))throw TypeError(".onnx.TensorProto.externalData: array expected");for(f.externalData=[],p=0;p<a.externalData.length;++p){if(typeof a.externalData[p]!="object")throw TypeError(".onnx.TensorProto.externalData: object expected");f.externalData[p]=d.onnx.StringStringEntryProto.fromObject(a.externalData[p])}}switch(a.dataLocation){case"DEFAULT":case 0:f.dataLocation=0;break;case"EXTERNAL":case 1:f.dataLocation=1}if(a.doubleData){if(!Array.isArray(a.doubleData))throw TypeError(".onnx.TensorProto.doubleData: array expected");for(f.doubleData=[],p=0;p<a.doubleData.length;++p)f.doubleData[p]=Number(a.doubleData[p])}if(a.uint64Data){if(!Array.isArray(a.uint64Data))throw TypeError(".onnx.TensorProto.uint64Data: array expected");for(f.uint64Data=[],p=0;p<a.uint64Data.length;++p)h.Long?(f.uint64Data[p]=h.Long.fromValue(a.uint64Data[p])).unsigned=!0:typeof a.uint64Data[p]=="string"?f.uint64Data[p]=parseInt(a.uint64Data[p],10):typeof a.uint64Data[p]=="number"?f.uint64Data[p]=a.uint64Data[p]:typeof a.uint64Data[p]=="object"&&(f.uint64Data[p]=new h.LongBits(a.uint64Data[p].low>>>0,a.uint64Data[p].high>>>0).toNumber(!0))}return f},c.toObject=function(a,f){f||(f={});var p={};if((f.arrays||f.defaults)&&(p.dims=[],p.floatData=[],p.int32Data=[],p.stringData=[],p.int64Data=[],p.doubleData=[],p.uint64Data=[],p.externalData=[]),f.defaults&&(p.dataType=0,p.segment=null,p.name="",f.bytes===String?p.rawData="":(p.rawData=[],f.bytes!==Array&&(p.rawData=h.newBuffer(p.rawData))),p.docString="",p.dataLocation=f.enums===String?"DEFAULT":0),a.dims&&a.dims.length){p.dims=[];for(var g=0;g<a.dims.length;++g)typeof a.dims[g]=="number"?p.dims[g]=f.longs===String?String(a.dims[g]):a.dims[g]:p.dims[g]=f.longs===String?h.Long.prototype.toString.call(a.dims[g]):f.longs===Number?new h.LongBits(a.dims[g].low>>>0,a.dims[g].high>>>0).toNumber():a.dims[g]}if(a.dataType!=null&&a.hasOwnProperty("dataType")&&(p.dataType=a.dataType),a.segment!=null&&a.hasOwnProperty("segment")&&(p.segment=d.onnx.TensorProto.Segment.toObject(a.segment,f)),a.floatData&&a.floatData.length)for(p.floatData=[],g=0;g<a.floatData.length;++g)p.floatData[g]=f.json&&!isFinite(a.floatData[g])?String(a.floatData[g]):a.floatData[g];if(a.int32Data&&a.int32Data.length)for(p.int32Data=[],g=0;g<a.int32Data.length;++g)p.int32Data[g]=a.int32Data[g];if(a.stringData&&a.stringData.length)for(p.stringData=[],g=0;g<a.stringData.length;++g)p.stringData[g]=f.bytes===String?h.base64.encode(a.stringData[g],0,a.stringData[g].length):f.bytes===Array?Array.prototype.slice.call(a.stringData[g]):a.stringData[g];if(a.int64Data&&a.int64Data.length)for(p.int64Data=[],g=0;g<a.int64Data.length;++g)typeof a.int64Data[g]=="number"?p.int64Data[g]=f.longs===String?String(a.int64Data[g]):a.int64Data[g]:p.int64Data[g]=f.longs===String?h.Long.prototype.toString.call(a.int64Data[g]):f.longs===Number?new h.LongBits(a.int64Data[g].low>>>0,a.int64Data[g].high>>>0).toNumber():a.int64Data[g];if(a.name!=null&&a.hasOwnProperty("name")&&(p.name=a.name),a.rawData!=null&&a.hasOwnProperty("rawData")&&(p.rawData=f.bytes===String?h.base64.encode(a.rawData,0,a.rawData.length):f.bytes===Array?Array.prototype.slice.call(a.rawData):a.rawData),a.doubleData&&a.doubleData.length)for(p.doubleData=[],g=0;g<a.doubleData.length;++g)p.doubleData[g]=f.json&&!isFinite(a.doubleData[g])?String(a.doubleData[g]):a.doubleData[g];if(a.uint64Data&&a.uint64Data.length)for(p.uint64Data=[],g=0;g<a.uint64Data.length;++g)typeof a.uint64Data[g]=="number"?p.uint64Data[g]=f.longs===String?String(a.uint64Data[g]):a.uint64Data[g]:p.uint64Data[g]=f.longs===String?h.Long.prototype.toString.call(a.uint64Data[g]):f.longs===Number?new h.LongBits(a.uint64Data[g].low>>>0,a.uint64Data[g].high>>>0).toNumber(!0):a.uint64Data[g];if(a.docString!=null&&a.hasOwnProperty("docString")&&(p.docString=a.docString),a.externalData&&a.externalData.length)for(p.externalData=[],g=0;g<a.externalData.length;++g)p.externalData[g]=d.onnx.StringStringEntryProto.toObject(a.externalData[g],f);return a.dataLocation!=null&&a.hasOwnProperty("dataLocation")&&(p.dataLocation=f.enums===String?d.onnx.TensorProto.DataLocation[a.dataLocation]:a.dataLocation),p},c.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},c.DataType=function(){var a={},f=Object.create(a);return f[a[0]="UNDEFINED"]=0,f[a[1]="FLOAT"]=1,f[a[2]="UINT8"]=2,f[a[3]="INT8"]=3,f[a[4]="UINT16"]=4,f[a[5]="INT16"]=5,f[a[6]="INT32"]=6,f[a[7]="INT64"]=7,f[a[8]="STRING"]=8,f[a[9]="BOOL"]=9,f[a[10]="FLOAT16"]=10,f[a[11]="DOUBLE"]=11,f[a[12]="UINT32"]=12,f[a[13]="UINT64"]=13,f[a[14]="COMPLEX64"]=14,f[a[15]="COMPLEX128"]=15,f[a[16]="BFLOAT16"]=16,f}(),c.Segment=function(){function a(f){if(f)for(var p=Object.keys(f),g=0;g<p.length;++g)f[p[g]]!=null&&(this[p[g]]=f[p[g]])}return a.prototype.begin=h.Long?h.Long.fromBits(0,0,!1):0,a.prototype.end=h.Long?h.Long.fromBits(0,0,!1):0,a.create=function(f){return new a(f)},a.encode=function(f,p){return p||(p=u.create()),f.begin!=null&&f.hasOwnProperty("begin")&&p.uint32(8).int64(f.begin),f.end!=null&&f.hasOwnProperty("end")&&p.uint32(16).int64(f.end),p},a.encodeDelimited=function(f,p){return this.encode(f,p).ldelim()},a.decode=function(f,p){f instanceof l||(f=l.create(f));for(var g=p===void 0?f.len:f.pos+p,m=new d.onnx.TensorProto.Segment;f.pos<g;){var y=f.uint32();switch(y>>>3){case 1:m.begin=f.int64();break;case 2:m.end=f.int64();break;default:f.skipType(7&y)}}return m},a.decodeDelimited=function(f){return f instanceof l||(f=new l(f)),this.decode(f,f.uint32())},a.verify=function(f){return typeof f!="object"||f===null?"object expected":f.begin!=null&&f.hasOwnProperty("begin")&&!(h.isInteger(f.begin)||f.begin&&h.isInteger(f.begin.low)&&h.isInteger(f.begin.high))?"begin: integer|Long expected":f.end!=null&&f.hasOwnProperty("end")&&!(h.isInteger(f.end)||f.end&&h.isInteger(f.end.low)&&h.isInteger(f.end.high))?"end: integer|Long expected":null},a.fromObject=function(f){if(f instanceof d.onnx.TensorProto.Segment)return f;var p=new d.onnx.TensorProto.Segment;return f.begin!=null&&(h.Long?(p.begin=h.Long.fromValue(f.begin)).unsigned=!1:typeof f.begin=="string"?p.begin=parseInt(f.begin,10):typeof f.begin=="number"?p.begin=f.begin:typeof f.begin=="object"&&(p.begin=new h.LongBits(f.begin.low>>>0,f.begin.high>>>0).toNumber())),f.end!=null&&(h.Long?(p.end=h.Long.fromValue(f.end)).unsigned=!1:typeof f.end=="string"?p.end=parseInt(f.end,10):typeof f.end=="number"?p.end=f.end:typeof f.end=="object"&&(p.end=new h.LongBits(f.end.low>>>0,f.end.high>>>0).toNumber())),p},a.toObject=function(f,p){p||(p={});var g={};if(p.defaults){if(h.Long){var m=new h.Long(0,0,!1);g.begin=p.longs===String?m.toString():p.longs===Number?m.toNumber():m}else g.begin=p.longs===String?"0":0;h.Long?(m=new h.Long(0,0,!1),g.end=p.longs===String?m.toString():p.longs===Number?m.toNumber():m):g.end=p.longs===String?"0":0}return f.begin!=null&&f.hasOwnProperty("begin")&&(typeof f.begin=="number"?g.begin=p.longs===String?String(f.begin):f.begin:g.begin=p.longs===String?h.Long.prototype.toString.call(f.begin):p.longs===Number?new h.LongBits(f.begin.low>>>0,f.begin.high>>>0).toNumber():f.begin),f.end!=null&&f.hasOwnProperty("end")&&(typeof f.end=="number"?g.end=p.longs===String?String(f.end):f.end:g.end=p.longs===String?h.Long.prototype.toString.call(f.end):p.longs===Number?new h.LongBits(f.end.low>>>0,f.end.high>>>0).toNumber():f.end),g},a.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},a}(),c.DataLocation=function(){var a={},f=Object.create(a);return f[a[0]="DEFAULT"]=0,f[a[1]="EXTERNAL"]=1,f}(),c}(),r.TensorShapeProto=function(){function c(a){if(this.dim=[],a)for(var f=Object.keys(a),p=0;p<f.length;++p)a[f[p]]!=null&&(this[f[p]]=a[f[p]])}return c.prototype.dim=h.emptyArray,c.create=function(a){return new c(a)},c.encode=function(a,f){if(f||(f=u.create()),a.dim!=null&&a.dim.length)for(var p=0;p<a.dim.length;++p)d.onnx.TensorShapeProto.Dimension.encode(a.dim[p],f.uint32(10).fork()).ldelim();return f},c.encodeDelimited=function(a,f){return this.encode(a,f).ldelim()},c.decode=function(a,f){a instanceof l||(a=l.create(a));for(var p=f===void 0?a.len:a.pos+f,g=new d.onnx.TensorShapeProto;a.pos<p;){var m=a.uint32();m>>>3==1?(g.dim&&g.dim.length||(g.dim=[]),g.dim.push(d.onnx.TensorShapeProto.Dimension.decode(a,a.uint32()))):a.skipType(7&m)}return g},c.decodeDelimited=function(a){return a instanceof l||(a=new l(a)),this.decode(a,a.uint32())},c.verify=function(a){if(typeof a!="object"||a===null)return"object expected";if(a.dim!=null&&a.hasOwnProperty("dim")){if(!Array.isArray(a.dim))return"dim: array expected";for(var f=0;f<a.dim.length;++f){var p=d.onnx.TensorShapeProto.Dimension.verify(a.dim[f]);if(p)return"dim."+p}}return null},c.fromObject=function(a){if(a instanceof d.onnx.TensorShapeProto)return a;var f=new d.onnx.TensorShapeProto;if(a.dim){if(!Array.isArray(a.dim))throw TypeError(".onnx.TensorShapeProto.dim: array expected");f.dim=[];for(var p=0;p<a.dim.length;++p){if(typeof a.dim[p]!="object")throw TypeError(".onnx.TensorShapeProto.dim: object expected");f.dim[p]=d.onnx.TensorShapeProto.Dimension.fromObject(a.dim[p])}}return f},c.toObject=function(a,f){f||(f={});var p={};if((f.arrays||f.defaults)&&(p.dim=[]),a.dim&&a.dim.length){p.dim=[];for(var g=0;g<a.dim.length;++g)p.dim[g]=d.onnx.TensorShapeProto.Dimension.toObject(a.dim[g],f)}return p},c.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},c.Dimension=function(){function a(p){if(p)for(var g=Object.keys(p),m=0;m<g.length;++m)p[g[m]]!=null&&(this[g[m]]=p[g[m]])}var f;return a.prototype.dimValue=h.Long?h.Long.fromBits(0,0,!1):0,a.prototype.dimParam="",a.prototype.denotation="",Object.defineProperty(a.prototype,"value",{get:h.oneOfGetter(f=["dimValue","dimParam"]),set:h.oneOfSetter(f)}),a.create=function(p){return new a(p)},a.encode=function(p,g){return g||(g=u.create()),p.dimValue!=null&&p.hasOwnProperty("dimValue")&&g.uint32(8).int64(p.dimValue),p.dimParam!=null&&p.hasOwnProperty("dimParam")&&g.uint32(18).string(p.dimParam),p.denotation!=null&&p.hasOwnProperty("denotation")&&g.uint32(26).string(p.denotation),g},a.encodeDelimited=function(p,g){return this.encode(p,g).ldelim()},a.decode=function(p,g){p instanceof l||(p=l.create(p));for(var m=g===void 0?p.len:p.pos+g,y=new d.onnx.TensorShapeProto.Dimension;p.pos<m;){var _=p.uint32();switch(_>>>3){case 1:y.dimValue=p.int64();break;case 2:y.dimParam=p.string();break;case 3:y.denotation=p.string();break;default:p.skipType(7&_)}}return y},a.decodeDelimited=function(p){return p instanceof l||(p=new l(p)),this.decode(p,p.uint32())},a.verify=function(p){if(typeof p!="object"||p===null)return"object expected";var g={};if(p.dimValue!=null&&p.hasOwnProperty("dimValue")&&(g.value=1,!(h.isInteger(p.dimValue)||p.dimValue&&h.isInteger(p.dimValue.low)&&h.isInteger(p.dimValue.high))))return"dimValue: integer|Long expected";if(p.dimParam!=null&&p.hasOwnProperty("dimParam")){if(g.value===1)return"value: multiple values";if(g.value=1,!h.isString(p.dimParam))return"dimParam: string expected"}return p.denotation!=null&&p.hasOwnProperty("denotation")&&!h.isString(p.denotation)?"denotation: string expected":null},a.fromObject=function(p){if(p instanceof d.onnx.TensorShapeProto.Dimension)return p;var g=new d.onnx.TensorShapeProto.Dimension;return p.dimValue!=null&&(h.Long?(g.dimValue=h.Long.fromValue(p.dimValue)).unsigned=!1:typeof p.dimValue=="string"?g.dimValue=parseInt(p.dimValue,10):typeof p.dimValue=="number"?g.dimValue=p.dimValue:typeof p.dimValue=="object"&&(g.dimValue=new h.LongBits(p.dimValue.low>>>0,p.dimValue.high>>>0).toNumber())),p.dimParam!=null&&(g.dimParam=String(p.dimParam)),p.denotation!=null&&(g.denotation=String(p.denotation)),g},a.toObject=function(p,g){g||(g={});var m={};return g.defaults&&(m.denotation=""),p.dimValue!=null&&p.hasOwnProperty("dimValue")&&(typeof p.dimValue=="number"?m.dimValue=g.longs===String?String(p.dimValue):p.dimValue:m.dimValue=g.longs===String?h.Long.prototype.toString.call(p.dimValue):g.longs===Number?new h.LongBits(p.dimValue.low>>>0,p.dimValue.high>>>0).toNumber():p.dimValue,g.oneofs&&(m.value="dimValue")),p.dimParam!=null&&p.hasOwnProperty("dimParam")&&(m.dimParam=p.dimParam,g.oneofs&&(m.value="dimParam")),p.denotation!=null&&p.hasOwnProperty("denotation")&&(m.denotation=p.denotation),m},a.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},a}(),c}(),r.TypeProto=function(){function c(f){if(f)for(var p=Object.keys(f),g=0;g<p.length;++g)f[p[g]]!=null&&(this[p[g]]=f[p[g]])}var a;return c.prototype.tensorType=null,c.prototype.denotation="",Object.defineProperty(c.prototype,"value",{get:h.oneOfGetter(a=["tensorType"]),set:h.oneOfSetter(a)}),c.create=function(f){return new c(f)},c.encode=function(f,p){return p||(p=u.create()),f.tensorType!=null&&f.hasOwnProperty("tensorType")&&d.onnx.TypeProto.Tensor.encode(f.tensorType,p.uint32(10).fork()).ldelim(),f.denotation!=null&&f.hasOwnProperty("denotation")&&p.uint32(50).string(f.denotation),p},c.encodeDelimited=function(f,p){return this.encode(f,p).ldelim()},c.decode=function(f,p){f instanceof l||(f=l.create(f));for(var g=p===void 0?f.len:f.pos+p,m=new d.onnx.TypeProto;f.pos<g;){var y=f.uint32();switch(y>>>3){case 1:m.tensorType=d.onnx.TypeProto.Tensor.decode(f,f.uint32());break;case 6:m.denotation=f.string();break;default:f.skipType(7&y)}}return m},c.decodeDelimited=function(f){return f instanceof l||(f=new l(f)),this.decode(f,f.uint32())},c.verify=function(f){if(typeof f!="object"||f===null)return"object expected";if(f.tensorType!=null&&f.hasOwnProperty("tensorType")){var p=d.onnx.TypeProto.Tensor.verify(f.tensorType);if(p)return"tensorType."+p}return f.denotation!=null&&f.hasOwnProperty("denotation")&&!h.isString(f.denotation)?"denotation: string expected":null},c.fromObject=function(f){if(f instanceof d.onnx.TypeProto)return f;var p=new d.onnx.TypeProto;if(f.tensorType!=null){if(typeof f.tensorType!="object")throw TypeError(".onnx.TypeProto.tensorType: object expected");p.tensorType=d.onnx.TypeProto.Tensor.fromObject(f.tensorType)}return f.denotation!=null&&(p.denotation=String(f.denotation)),p},c.toObject=function(f,p){p||(p={});var g={};return p.defaults&&(g.denotation=""),f.tensorType!=null&&f.hasOwnProperty("tensorType")&&(g.tensorType=d.onnx.TypeProto.Tensor.toObject(f.tensorType,p),p.oneofs&&(g.value="tensorType")),f.denotation!=null&&f.hasOwnProperty("denotation")&&(g.denotation=f.denotation),g},c.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},c.Tensor=function(){function f(p){if(p)for(var g=Object.keys(p),m=0;m<g.length;++m)p[g[m]]!=null&&(this[g[m]]=p[g[m]])}return f.prototype.elemType=0,f.prototype.shape=null,f.create=function(p){return new f(p)},f.encode=function(p,g){return g||(g=u.create()),p.elemType!=null&&p.hasOwnProperty("elemType")&&g.uint32(8).int32(p.elemType),p.shape!=null&&p.hasOwnProperty("shape")&&d.onnx.TensorShapeProto.encode(p.shape,g.uint32(18).fork()).ldelim(),g},f.encodeDelimited=function(p,g){return this.encode(p,g).ldelim()},f.decode=function(p,g){p instanceof l||(p=l.create(p));for(var m=g===void 0?p.len:p.pos+g,y=new d.onnx.TypeProto.Tensor;p.pos<m;){var _=p.uint32();switch(_>>>3){case 1:y.elemType=p.int32();break;case 2:y.shape=d.onnx.TensorShapeProto.decode(p,p.uint32());break;default:p.skipType(7&_)}}return y},f.decodeDelimited=function(p){return p instanceof l||(p=new l(p)),this.decode(p,p.uint32())},f.verify=function(p){if(typeof p!="object"||p===null)return"object expected";if(p.elemType!=null&&p.hasOwnProperty("elemType")&&!h.isInteger(p.elemType))return"elemType: integer expected";if(p.shape!=null&&p.hasOwnProperty("shape")){var g=d.onnx.TensorShapeProto.verify(p.shape);if(g)return"shape."+g}return null},f.fromObject=function(p){if(p instanceof d.onnx.TypeProto.Tensor)return p;var g=new d.onnx.TypeProto.Tensor;if(p.elemType!=null&&(g.elemType=0|p.elemType),p.shape!=null){if(typeof p.shape!="object")throw TypeError(".onnx.TypeProto.Tensor.shape: object expected");g.shape=d.onnx.TensorShapeProto.fromObject(p.shape)}return g},f.toObject=function(p,g){g||(g={});var m={};return g.defaults&&(m.elemType=0,m.shape=null),p.elemType!=null&&p.hasOwnProperty("elemType")&&(m.elemType=p.elemType),p.shape!=null&&p.hasOwnProperty("shape")&&(m.shape=d.onnx.TensorShapeProto.toObject(p.shape,g)),m},f.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},f}(),c}(),r.OperatorSetIdProto=function(){function c(a){if(a)for(var f=Object.keys(a),p=0;p<f.length;++p)a[f[p]]!=null&&(this[f[p]]=a[f[p]])}return c.prototype.domain="",c.prototype.version=h.Long?h.Long.fromBits(0,0,!1):0,c.create=function(a){return new c(a)},c.encode=function(a,f){return f||(f=u.create()),a.domain!=null&&a.hasOwnProperty("domain")&&f.uint32(10).string(a.domain),a.version!=null&&a.hasOwnProperty("version")&&f.uint32(16).int64(a.version),f},c.encodeDelimited=function(a,f){return this.encode(a,f).ldelim()},c.decode=function(a,f){a instanceof l||(a=l.create(a));for(var p=f===void 0?a.len:a.pos+f,g=new d.onnx.OperatorSetIdProto;a.pos<p;){var m=a.uint32();switch(m>>>3){case 1:g.domain=a.string();break;case 2:g.version=a.int64();break;default:a.skipType(7&m)}}return g},c.decodeDelimited=function(a){return a instanceof l||(a=new l(a)),this.decode(a,a.uint32())},c.verify=function(a){return typeof a!="object"||a===null?"object expected":a.domain!=null&&a.hasOwnProperty("domain")&&!h.isString(a.domain)?"domain: string expected":a.version!=null&&a.hasOwnProperty("version")&&!(h.isInteger(a.version)||a.version&&h.isInteger(a.version.low)&&h.isInteger(a.version.high))?"version: integer|Long expected":null},c.fromObject=function(a){if(a instanceof d.onnx.OperatorSetIdProto)return a;var f=new d.onnx.OperatorSetIdProto;return a.domain!=null&&(f.domain=String(a.domain)),a.version!=null&&(h.Long?(f.version=h.Long.fromValue(a.version)).unsigned=!1:typeof a.version=="string"?f.version=parseInt(a.version,10):typeof a.version=="number"?f.version=a.version:typeof a.version=="object"&&(f.version=new h.LongBits(a.version.low>>>0,a.version.high>>>0).toNumber())),f},c.toObject=function(a,f){f||(f={});var p={};if(f.defaults)if(p.domain="",h.Long){var g=new h.Long(0,0,!1);p.version=f.longs===String?g.toString():f.longs===Number?g.toNumber():g}else p.version=f.longs===String?"0":0;return a.domain!=null&&a.hasOwnProperty("domain")&&(p.domain=a.domain),a.version!=null&&a.hasOwnProperty("version")&&(typeof a.version=="number"?p.version=f.longs===String?String(a.version):a.version:p.version=f.longs===String?h.Long.prototype.toString.call(a.version):f.longs===Number?new h.LongBits(a.version.low>>>0,a.version.high>>>0).toNumber():a.version),p},c.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},c}(),r),s.exports=d},2100:(s,e,t)=>{"use strict";s.exports=t(9482)},9482:(s,e,t)=>{"use strict";var n=e;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=t(1173),n.BufferWriter=t(3155),n.Reader=t(1408),n.BufferReader=t(593),n.util=t(9693),n.rpc=t(5994),n.roots=t(5054),n.configure=i,i()},1408:(s,e,t)=>{"use strict";s.exports=u;var n,i=t(9693),r=i.LongBits,o=i.utf8;function l(g,m){return RangeError("index out of range: "+g.pos+" + "+(m||1)+" > "+g.len)}function u(g){this.buf=g,this.pos=0,this.len=g.length}var h,d=typeof Uint8Array<"u"?function(g){if(g instanceof Uint8Array||Array.isArray(g))return new u(g);throw Error("illegal buffer")}:function(g){if(Array.isArray(g))return new u(g);throw Error("illegal buffer")},c=function(){return i.Buffer?function(g){return(u.create=function(m){return i.Buffer.isBuffer(m)?new n(m):d(m)})(g)}:d};function a(){var g=new r(0,0),m=0;if(!(this.len-this.pos>4)){for(;m<3;++m){if(this.pos>=this.len)throw l(this);if(g.lo=(g.lo|(127&this.buf[this.pos])<<7*m)>>>0,this.buf[this.pos++]<128)return g}return g.lo=(g.lo|(127&this.buf[this.pos++])<<7*m)>>>0,g}for(;m<4;++m)if(g.lo=(g.lo|(127&this.buf[this.pos])<<7*m)>>>0,this.buf[this.pos++]<128)return g;if(g.lo=(g.lo|(127&this.buf[this.pos])<<28)>>>0,g.hi=(g.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return g;if(m=0,this.len-this.pos>4){for(;m<5;++m)if(g.hi=(g.hi|(127&this.buf[this.pos])<<7*m+3)>>>0,this.buf[this.pos++]<128)return g}else for(;m<5;++m){if(this.pos>=this.len)throw l(this);if(g.hi=(g.hi|(127&this.buf[this.pos])<<7*m+3)>>>0,this.buf[this.pos++]<128)return g}throw Error("invalid varint encoding")}function f(g,m){return(g[m-4]|g[m-3]<<8|g[m-2]<<16|g[m-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw l(this,8);return new r(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}u.create=c(),u.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,u.prototype.uint32=(h=4294967295,function(){if(h=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(h=(h|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(h=(h|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(h=(h|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(h=(h|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return h;if((this.pos+=5)>this.len)throw this.pos=this.len,l(this,10);return h}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var g=this.uint32();return g>>>1^-(1&g)|0},u.prototype.bool=function(){return this.uint32()!==0},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw l(this,4);return f(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw l(this,4);return 0|f(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw l(this,4);var g=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,g},u.prototype.double=function(){if(this.pos+8>this.len)throw l(this,4);var g=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,g},u.prototype.bytes=function(){var g=this.uint32(),m=this.pos,y=this.pos+g;if(y>this.len)throw l(this,g);return this.pos+=g,Array.isArray(this.buf)?this.buf.slice(m,y):m===y?new this.buf.constructor(0):this._slice.call(this.buf,m,y)},u.prototype.string=function(){var g=this.bytes();return o.read(g,0,g.length)},u.prototype.skip=function(g){if(typeof g=="number"){if(this.pos+g>this.len)throw l(this,g);this.pos+=g}else do if(this.pos>=this.len)throw l(this);while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(g){switch(g){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(g=7&this.uint32())!=4;)this.skipType(g);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+g+" at offset "+this.pos)}return this},u._configure=function(g){n=g,u.create=c(),n._configure();var m=i.Long?"toLong":"toNumber";i.merge(u.prototype,{int64:function(){return a.call(this)[m](!1)},uint64:function(){return a.call(this)[m](!0)},sint64:function(){return a.call(this).zzDecode()[m](!1)},fixed64:function(){return p.call(this)[m](!0)},sfixed64:function(){return p.call(this)[m](!1)}})}},593:(s,e,t)=>{"use strict";s.exports=r;var n=t(1408);(r.prototype=Object.create(n.prototype)).constructor=r;var i=t(9693);function r(o){n.call(this,o)}r._configure=function(){i.Buffer&&(r.prototype._slice=i.Buffer.prototype.slice)},r.prototype.string=function(){var o=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+o,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+o,this.len))},r._configure()},5054:s=>{"use strict";s.exports={}},5994:(s,e,t)=>{"use strict";e.Service=t(7948)},7948:(s,e,t)=>{"use strict";s.exports=i;var n=t(9693);function i(r,o,l){if(typeof r!="function")throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=!!o,this.responseDelimited=!!l}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function r(o,l,u,h,d){if(!h)throw TypeError("request must be specified");var c=this;if(!d)return n.asPromise(r,c,o,l,u,h);if(c.rpcImpl)try{return c.rpcImpl(o,l[c.requestDelimited?"encodeDelimited":"encode"](h).finish(),function(a,f){if(a)return c.emit("error",a,o),d(a);if(f!==null){if(!(f instanceof u))try{f=u[c.responseDelimited?"decodeDelimited":"decode"](f)}catch(p){return c.emit("error",p,o),d(p)}return c.emit("data",f,o),d(null,f)}c.end(!0)})}catch(a){return c.emit("error",a,o),void setTimeout(function(){d(a)},0)}else setTimeout(function(){d(Error("already ended"))},0)},i.prototype.end=function(r){return this.rpcImpl&&(r||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},1945:(s,e,t)=>{"use strict";s.exports=i;var n=t(9693);function i(u,h){this.lo=u>>>0,this.hi=h>>>0}var r=i.zero=new i(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(u){if(u===0)return r;var h=u<0;h&&(u=-u);var d=u>>>0,c=(u-d)/4294967296>>>0;return h&&(c=~c>>>0,d=~d>>>0,++d>4294967295&&(d=0,++c>4294967295&&(c=0))),new i(d,c)},i.from=function(u){if(typeof u=="number")return i.fromNumber(u);if(n.isString(u)){if(!n.Long)return i.fromNumber(parseInt(u,10));u=n.Long.fromString(u)}return u.low||u.high?new i(u.low>>>0,u.high>>>0):r},i.prototype.toNumber=function(u){if(!u&&this.hi>>>31){var h=1+~this.lo>>>0,d=~this.hi>>>0;return h||(d=d+1>>>0),-(h+4294967296*d)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(u){return n.Long?new n.Long(0|this.lo,0|this.hi,!!u):{low:0|this.lo,high:0|this.hi,unsigned:!!u}};var l=String.prototype.charCodeAt;i.fromHash=function(u){return u===o?r:new i((l.call(u,0)|l.call(u,1)<<8|l.call(u,2)<<16|l.call(u,3)<<24)>>>0,(l.call(u,4)|l.call(u,5)<<8|l.call(u,6)<<16|l.call(u,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var u=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^u)>>>0,this.lo=(this.lo<<1^u)>>>0,this},i.prototype.zzDecode=function(){var u=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^u)>>>0,this.hi=(this.hi>>>1^u)>>>0,this},i.prototype.length=function(){var u=this.lo,h=(this.lo>>>28|this.hi<<4)>>>0,d=this.hi>>>24;return d===0?h===0?u<16384?u<128?1:2:u<2097152?3:4:h<16384?h<128?5:6:h<2097152?7:8:d<128?9:10}},9693:function(s,e,t){"use strict";var n=e;function i(o,l,u){for(var h=Object.keys(l),d=0;d<h.length;++d)o[h[d]]!==void 0&&u||(o[h[d]]=l[h[d]]);return o}function r(o){function l(u,h){if(!(this instanceof l))return new l(u,h);Object.defineProperty(this,"message",{get:function(){return u}}),Error.captureStackTrace?Error.captureStackTrace(this,l):Object.defineProperty(this,"stack",{value:new Error().stack||""}),h&&i(this,h)}return(l.prototype=Object.create(Error.prototype)).constructor=l,Object.defineProperty(l.prototype,"name",{get:function(){return o}}),l.prototype.toString=function(){return this.name+": "+this.message},l}n.asPromise=t(4537),n.base64=t(7419),n.EventEmitter=t(9211),n.float=t(945),n.inquire=t(7199),n.utf8=t(4997),n.pool=t(6662),n.LongBits=t(1945),n.isNode=!!(t.g!==void 0&&t.g&&t.g.process&&t.g.process.versions&&t.g.process.versions.node),n.global=n.isNode&&t.g||typeof window<"u"&&window||typeof self<"u"&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(o){return typeof o=="number"&&isFinite(o)&&Math.floor(o)===o},n.isString=function(o){return typeof o=="string"||o instanceof String},n.isObject=function(o){return o&&typeof o=="object"},n.isset=n.isSet=function(o,l){var u=o[l];return!(u==null||!o.hasOwnProperty(l))&&(typeof u!="object"||(Array.isArray(u)?u.length:Object.keys(u).length)>0)},n.Buffer=function(){try{var o=n.inquire("buffer").Buffer;return o.prototype.utf8Write?o:null}catch{return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(o){return typeof o=="number"?n.Buffer?n._Buffer_allocUnsafe(o):new n.Array(o):n.Buffer?n._Buffer_from(o):typeof Uint8Array>"u"?o:new Uint8Array(o)},n.Array=typeof Uint8Array<"u"?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(o){return o?n.LongBits.from(o).toHash():n.LongBits.zeroHash},n.longFromHash=function(o,l){var u=n.LongBits.fromHash(o);return n.Long?n.Long.fromBits(u.lo,u.hi,l):u.toNumber(!!l)},n.merge=i,n.lcFirst=function(o){return o.charAt(0).toLowerCase()+o.substring(1)},n.newError=r,n.ProtocolError=r("ProtocolError"),n.oneOfGetter=function(o){for(var l={},u=0;u<o.length;++u)l[o[u]]=1;return function(){for(var h=Object.keys(this),d=h.length-1;d>-1;--d)if(l[h[d]]===1&&this[h[d]]!==void 0&&this[h[d]]!==null)return h[d]}},n.oneOfSetter=function(o){return function(l){for(var u=0;u<o.length;++u)o[u]!==l&&delete this[o[u]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var o=n.Buffer;o?(n._Buffer_from=o.from!==Uint8Array.from&&o.from||function(l,u){return new o(l,u)},n._Buffer_allocUnsafe=o.allocUnsafe||function(l){return new o(l)}):n._Buffer_from=n._Buffer_allocUnsafe=null}},1173:(s,e,t)=>{"use strict";s.exports=c;var n,i=t(9693),r=i.LongBits,o=i.base64,l=i.utf8;function u(_,x,E){this.fn=_,this.len=x,this.next=void 0,this.val=E}function h(){}function d(_){this.head=_.head,this.tail=_.tail,this.len=_.len,this.next=_.states}function c(){this.len=0,this.head=new u(h,0,0),this.tail=this.head,this.states=null}var a=function(){return i.Buffer?function(){return(c.create=function(){return new n})()}:function(){return new c}};function f(_,x,E){x[E]=255&_}function p(_,x){this.len=_,this.next=void 0,this.val=x}function g(_,x,E){for(;_.hi;)x[E++]=127&_.lo|128,_.lo=(_.lo>>>7|_.hi<<25)>>>0,_.hi>>>=7;for(;_.lo>127;)x[E++]=127&_.lo|128,_.lo=_.lo>>>7;x[E++]=_.lo}function m(_,x,E){x[E]=255&_,x[E+1]=_>>>8&255,x[E+2]=_>>>16&255,x[E+3]=_>>>24}c.create=a(),c.alloc=function(_){return new i.Array(_)},i.Array!==Array&&(c.alloc=i.pool(c.alloc,i.Array.prototype.subarray)),c.prototype._push=function(_,x,E){return this.tail=this.tail.next=new u(_,x,E),this.len+=x,this},p.prototype=Object.create(u.prototype),p.prototype.fn=function(_,x,E){for(;_>127;)x[E++]=127&_|128,_>>>=7;x[E]=_},c.prototype.uint32=function(_){return this.len+=(this.tail=this.tail.next=new p((_>>>=0)<128?1:_<16384?2:_<2097152?3:_<268435456?4:5,_)).len,this},c.prototype.int32=function(_){return _<0?this._push(g,10,r.fromNumber(_)):this.uint32(_)},c.prototype.sint32=function(_){return this.uint32((_<<1^_>>31)>>>0)},c.prototype.uint64=function(_){var x=r.from(_);return this._push(g,x.length(),x)},c.prototype.int64=c.prototype.uint64,c.prototype.sint64=function(_){var x=r.from(_).zzEncode();return this._push(g,x.length(),x)},c.prototype.bool=function(_){return this._push(f,1,_?1:0)},c.prototype.fixed32=function(_){return this._push(m,4,_>>>0)},c.prototype.sfixed32=c.prototype.fixed32,c.prototype.fixed64=function(_){var x=r.from(_);return this._push(m,4,x.lo)._push(m,4,x.hi)},c.prototype.sfixed64=c.prototype.fixed64,c.prototype.float=function(_){return this._push(i.float.writeFloatLE,4,_)},c.prototype.double=function(_){return this._push(i.float.writeDoubleLE,8,_)};var y=i.Array.prototype.set?function(_,x,E){x.set(_,E)}:function(_,x,E){for(var S=0;S<_.length;++S)x[E+S]=_[S]};c.prototype.bytes=function(_){var x=_.length>>>0;if(!x)return this._push(f,1,0);if(i.isString(_)){var E=c.alloc(x=o.length(_));o.decode(_,E,0),_=E}return this.uint32(x)._push(y,x,_)},c.prototype.string=function(_){var x=l.length(_);return x?this.uint32(x)._push(l.write,x,_):this._push(f,1,0)},c.prototype.fork=function(){return this.states=new d(this),this.head=this.tail=new u(h,0,0),this.len=0,this},c.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(h,0,0),this.len=0),this},c.prototype.ldelim=function(){var _=this.head,x=this.tail,E=this.len;return this.reset().uint32(E),E&&(this.tail.next=_.next,this.tail=x,this.len+=E),this},c.prototype.finish=function(){for(var _=this.head.next,x=this.constructor.alloc(this.len),E=0;_;)_.fn(_.val,x,E),E+=_.len,_=_.next;return x},c._configure=function(_){n=_,c.create=a(),n._configure()}},3155:(s,e,t)=>{"use strict";s.exports=r;var n=t(1173);(r.prototype=Object.create(n.prototype)).constructor=r;var i=t(9693);function r(){n.call(this)}function o(l,u,h){l.length<40?i.utf8.write(l,u,h):u.utf8Write?u.utf8Write(l,h):u.write(l,h)}r._configure=function(){r.alloc=i._Buffer_allocUnsafe,r.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&i.Buffer.prototype.set.name==="set"?function(l,u,h){u.set(l,h)}:function(l,u,h){if(l.copy)l.copy(u,h,0,l.length);else for(var d=0;d<l.length;)u[h++]=l[d++]}},r.prototype.bytes=function(l){i.isString(l)&&(l=i._Buffer_from(l,"base64"));var u=l.length>>>0;return this.uint32(u),u&&this._push(r.writeBytesBuffer,u,l),this},r.prototype.string=function(l){var u=i.Buffer.byteLength(l);return this.uint32(u),u&&this._push(o,u,l),this},r._configure()},7714:(s,e,t)=>{"use strict";e.R=void 0;let n=t(6919),i=t(7448);e.R=new class{async init(){}async createSessionHandler(r,o){let l=new n.Session(o);return await l.loadModel(r),new i.OnnxjsSessionHandler(l)}}},4200:(s,e,t)=>{"use strict";e.c8=e.rX=void 0;let n=t(1670),i=t(5381),r=t(2157),o=t(2306);e.rX=()=>{if((typeof n.env.wasm.initTimeout!="number"||n.env.wasm.initTimeout<0)&&(n.env.wasm.initTimeout=0),typeof n.env.wasm.simd!="boolean"&&(n.env.wasm.simd=!0),typeof n.env.wasm.proxy!="boolean"&&(n.env.wasm.proxy=!1),typeof n.env.wasm.numThreads!="number"||!Number.isInteger(n.env.wasm.numThreads)||n.env.wasm.numThreads<=0){let l=typeof navigator>"u"?(0,i.cpus)().length:navigator.hardwareConcurrency;n.env.wasm.numThreads=Math.min(4,Math.ceil((l||1)/2))}},e.c8=new class{async init(){(0,e.rX)(),await(0,r.initWasm)()}async createSessionHandler(l,u){let h=new o.OnnxruntimeWebAssemblySessionHandler;return await h.loadModel(l,u),Promise.resolve(h)}}},6018:function(s,e,t){"use strict";var n=this&&this.__createBinding||(Object.create?function(o,l,u,h){h===void 0&&(h=u);var d=Object.getOwnPropertyDescriptor(l,u);d&&!("get"in d?!l.__esModule:d.writable||d.configurable)||(d={enumerable:!0,get:function(){return l[u]}}),Object.defineProperty(o,h,d)}:function(o,l,u,h){h===void 0&&(h=u),o[h]=l[u]}),i=this&&this.__exportStar||function(o,l){for(var u in o)u==="default"||Object.prototype.hasOwnProperty.call(l,u)||n(l,o,u)};Object.defineProperty(e,"__esModule",{value:!0}),i(t(1670),e);let r=t(1670);{let o=t(7714).R;(0,r.registerBackend)("webgl",o,-10)}{let o=t(4200).c8;(0,r.registerBackend)("cpu",o,10),(0,r.registerBackend)("wasm",o,10),(0,r.registerBackend)("xnnpack",o,9)}},246:(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createAttributeWithCacheKey=void 0;class t{constructor(i){Object.assign(this,i)}get cacheKey(){return this._cacheKey||(this._cacheKey=Object.getOwnPropertyNames(this).sort().map(i=>`${this[i]}`).join(";")),this._cacheKey}}e.createAttributeWithCacheKey=n=>new t(n)},7778:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Attribute=void 0;let n=t(1446),i=t(9395),r=t(9162),o=t(2517);var l=i.onnxruntime.experimental.fbs;class u{constructor(d){if(this._attributes=new Map,d!=null){for(let c of d)c instanceof n.onnx.AttributeProto?this._attributes.set(c.name,[u.getValue(c),u.getType(c)]):c instanceof l.Attribute&&this._attributes.set(c.name(),[u.getValue(c),u.getType(c)]);if(this._attributes.size<d.length)throw new Error("duplicated attribute names")}}set(d,c,a){this._attributes.set(d,[a,c])}delete(d){this._attributes.delete(d)}getFloat(d,c){return this.get(d,"float",c)}getInt(d,c){return this.get(d,"int",c)}getString(d,c){return this.get(d,"string",c)}getTensor(d,c){return this.get(d,"tensor",c)}getFloats(d,c){return this.get(d,"floats",c)}getInts(d,c){return this.get(d,"ints",c)}getStrings(d,c){return this.get(d,"strings",c)}getTensors(d,c){return this.get(d,"tensors",c)}get(d,c,a){let f=this._attributes.get(d);if(f===void 0){if(a!==void 0)return a;throw new Error(`required attribute not found: ${d}`)}if(f[1]!==c)throw new Error(`type mismatch: expected ${c} but got ${f[1]}`);return f[0]}static getType(d){let c=d instanceof n.onnx.AttributeProto?d.type:d.type();switch(c){case n.onnx.AttributeProto.AttributeType.FLOAT:return"float";case n.onnx.AttributeProto.AttributeType.INT:return"int";case n.onnx.AttributeProto.AttributeType.STRING:return"string";case n.onnx.AttributeProto.AttributeType.TENSOR:return"tensor";case n.onnx.AttributeProto.AttributeType.FLOATS:return"floats";case n.onnx.AttributeProto.AttributeType.INTS:return"ints";case n.onnx.AttributeProto.AttributeType.STRINGS:return"strings";case n.onnx.AttributeProto.AttributeType.TENSORS:return"tensors";default:throw new Error(`attribute type is not supported yet: ${n.onnx.AttributeProto.AttributeType[c]}`)}}static getValue(d){let c=d instanceof n.onnx.AttributeProto?d.type:d.type();if(c===n.onnx.AttributeProto.AttributeType.GRAPH||c===n.onnx.AttributeProto.AttributeType.GRAPHS)throw new Error("graph attribute is not supported yet");let a=this.getValueNoCheck(d);if(c===n.onnx.AttributeProto.AttributeType.INT&&o.LongUtil.isLong(a))return o.LongUtil.longToNumber(a);if(c===n.onnx.AttributeProto.AttributeType.INTS){let f=a,p=new Array(f.length);for(let g=0;g<f.length;g++){let m=f[g];p[g]=o.LongUtil.longToNumber(m)}return p}if(c===n.onnx.AttributeProto.AttributeType.TENSOR)return d instanceof n.onnx.AttributeProto?r.Tensor.fromProto(a):r.Tensor.fromOrtTensor(a);if(c===n.onnx.AttributeProto.AttributeType.TENSORS){if(d instanceof n.onnx.AttributeProto)return a.map(f=>r.Tensor.fromProto(f));if(d instanceof l.Attribute)return a.map(f=>r.Tensor.fromOrtTensor(f))}if(c===n.onnx.AttributeProto.AttributeType.STRING&&d instanceof n.onnx.AttributeProto){let f=a;return(0,o.decodeUtf8String)(f)}return c===n.onnx.AttributeProto.AttributeType.STRINGS&&d instanceof n.onnx.AttributeProto?a.map(o.decodeUtf8String):a}static getValueNoCheck(d){return d instanceof n.onnx.AttributeProto?this.getValueNoCheckFromOnnxFormat(d):this.getValueNoCheckFromOrtFormat(d)}static getValueNoCheckFromOnnxFormat(d){switch(d.type){case n.onnx.AttributeProto.AttributeType.FLOAT:return d.f;case n.onnx.AttributeProto.AttributeType.INT:return d.i;case n.onnx.AttributeProto.AttributeType.STRING:return d.s;case n.onnx.AttributeProto.AttributeType.TENSOR:return d.t;case n.onnx.AttributeProto.AttributeType.GRAPH:return d.g;case n.onnx.AttributeProto.AttributeType.FLOATS:return d.floats;case n.onnx.AttributeProto.AttributeType.INTS:return d.ints;case n.onnx.AttributeProto.AttributeType.STRINGS:return d.strings;case n.onnx.AttributeProto.AttributeType.TENSORS:return d.tensors;case n.onnx.AttributeProto.AttributeType.GRAPHS:return d.graphs;default:throw new Error(`unsupported attribute type: ${n.onnx.AttributeProto.AttributeType[d.type]}`)}}static getValueNoCheckFromOrtFormat(d){switch(d.type()){case l.AttributeType.FLOAT:return d.f();case l.AttributeType.INT:return d.i();case l.AttributeType.STRING:return d.s();case l.AttributeType.TENSOR:return d.t();case l.AttributeType.GRAPH:return d.g();case l.AttributeType.FLOATS:return d.floatsArray();case l.AttributeType.INTS:{let c=[];for(let a=0;a<d.intsLength();a++)c.push(d.ints(a));return c}case l.AttributeType.STRINGS:{let c=[];for(let a=0;a<d.stringsLength();a++)c.push(d.strings(a));return c}case l.AttributeType.TENSORS:{let c=[];for(let a=0;a<d.tensorsLength();a++)c.push(d.tensors(a));return c}default:throw new Error(`unsupported attribute type: ${l.AttributeType[d.type()]}`)}}}e.Attribute=u},7091:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolveBackend=e.backend=void 0;let n=t(5038),i=new Map;async function r(o){let l=e.backend;if(l[o]!==void 0&&function(u){let h=u;return"initialize"in h&&typeof h.initialize=="function"&&"createSessionHandler"in h&&typeof h.createSessionHandler=="function"&&"dispose"in h&&typeof h.dispose=="function"}(l[o])){let u=l[o],h=u.initialize();if(typeof h=="object"&&"then"in h&&(h=await h),h)return i.set(o,u),u}}e.backend={webgl:new n.WebGLBackend},e.resolveBackend=async function o(l){if(!l)return o(["webgl"]);{let u=typeof l=="string"?[l]:l;for(let h of u){let d=i.get(h);if(d)return d;let c=await r(h);if(c)return c}}throw new Error("no available backend to use")}},5038:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLBackend=void 0;let n=t(1670),i=t(6231),r=t(6416),o=t(7305);e.WebGLBackend=class{get contextId(){return n.env.webgl.contextId}set contextId(l){n.env.webgl.contextId=l}get matmulMaxBatchSize(){return n.env.webgl.matmulMaxBatchSize}set matmulMaxBatchSize(l){n.env.webgl.matmulMaxBatchSize=l}get textureCacheMode(){return n.env.webgl.textureCacheMode}set textureCacheMode(l){n.env.webgl.textureCacheMode=l}get pack(){return n.env.webgl.pack}set pack(l){n.env.webgl.pack=l}get async(){return n.env.webgl.async}set async(l){n.env.webgl.async=l}initialize(){try{return this.glContext=(0,o.createWebGLContext)(this.contextId),typeof this.matmulMaxBatchSize!="number"&&(this.matmulMaxBatchSize=16),typeof this.textureCacheMode!="string"&&(this.textureCacheMode="full"),typeof this.pack!="boolean"&&(this.pack=!1),typeof this.async!="boolean"&&(this.async=!1),i.Logger.setWithEnv(n.env),i.Logger.verbose("WebGLBackend",`Created WebGLContext: ${typeof this.glContext} with matmulMaxBatchSize: ${this.matmulMaxBatchSize}; textureCacheMode: ${this.textureCacheMode}; pack: ${this.pack}; async: ${this.async}.`),!0}catch(l){return i.Logger.warning("WebGLBackend",`Unable to initialize WebGLBackend. ${l}`),!1}}createSessionHandler(l){return new r.WebGLSessionHandler(this,l)}dispose(){this.glContext.dispose()}}},5107:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CoordsGlslLib=void 0;let n=t(2517),i=t(8520),r=t(5060),o=t(7859),l=t(9390);class u extends i.GlslLib{constructor(d){super(d)}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.offsetToCoords()),this.coordsToOffset()),this.toVec()),this.valueFrom()),this.getCommonUtilFuncs()),this.getInputsSamplingSnippets()),this.getOutputSamplingSnippet())}getCustomTypes(){return{}}offsetToCoords(){return{offsetToCoords:new i.GlslLibRoutine(`
      vec2 offsetToCoords(int offset, int width, int height) {
        int t = offset / width;
        int s = offset - t*width;
        vec2 coords = (vec2(s,t) + vec2(0.5,0.5)) / vec2(width, height);
        return coords;
      }
      `)}}coordsToOffset(){return{coordsToOffset:new i.GlslLibRoutine(`
      int coordsToOffset(vec2 coords, int width, int height) {
        float s = coords.s * float(width);
        float t = coords.t * float(height);
        int offset = int(t) * width + int(s);
        return offset;
      }
      `)}}getOutputSamplingSnippet(){let d=this.context.outputTextureLayout;return d.isPacked?this.getPackedOutputSamplingSnippet(d):this.getUnpackedOutputSamplingSnippet(d)}getPackedOutputSamplingSnippet(d){let c=d.unpackedShape,a=[d.width,d.height],f={},p="getOutputCoords";switch(c.length){case 0:f[p]=this.getOutputScalarCoords();break;case 1:f[p]=this.getOutputPacked1DCoords(c,a);break;case 2:f[p]=this.getOutputPacked2DCoords(c,a);break;case 3:f[p]=this.getOutputPacked3DCoords(c,a);break;default:f[p]=this.getOutputPackedNDCoords(c,a)}let g=`
      void setOutput(vec4 val) {
        ${(0,r.getGlsl)(this.context.glContext.version).output} = val;
      }
    `;return f.floatTextureSetRGBA=new i.GlslLibRoutine(g),f}getUnpackedOutputSamplingSnippet(d){let c=d.unpackedShape,a=[d.width,d.height],f={},p="getOutputCoords";switch(c.length){case 0:f[p]=this.getOutputScalarCoords();break;case 1:f[p]=this.getOutputUnpacked1DCoords(c,a);break;case 2:f[p]=this.getOutputUnpacked2DCoords(c,a);break;case 3:f[p]=this.getOutputUnpacked3DCoords(c,a);break;case 4:f[p]=this.getOutputUnpacked4DCoords(c,a);break;case 5:f[p]=this.getOutputUnpacked5DCoords(c,a);break;case 6:f[p]=this.getOutputUnpacked6DCoords(c,a);break;default:throw new Error(`Unsupported output dimensionality: ${c.length}`)}let g=`
        void setOutput(float val) {
          ${(0,r.getGlsl)(this.context.glContext.version).output} = vec4(val, 0, 0, 0);
        }
    `;return f.floatTextureSetR=new i.GlslLibRoutine(g),f}getOutputScalarCoords(){return new i.GlslLibRoutine(`
      int getOutputCoords() {
        return 0;
      }
    `)}getOutputPacked1DCoords(d,c){let a=c,f="";return a[0]===1?(f=`
          int getOutputCoords() {
            return 2 * int(TexCoords.y * ${a[1]}.0);
          }
        `,new i.GlslLibRoutine(f)):a[1]===1?(f=`
          int getOutputCoords() {
            return 2 * int(TexCoords.x * ${a[0]}.0);
          }
        `,new i.GlslLibRoutine(f)):(f=`
        int getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                 vec2(${a[0]}, ${a[1]}));
          return 2 * (resTexRC.y * ${a[0]} + resTexRC.x);
        }
      `,new i.GlslLibRoutine(f))}getOutputPacked2DCoords(d,c){let a="";if(n.ArrayUtil.arraysEqual(d,c))return a=`
        ivec2 getOutputCoords() {
          return 2 * ivec2(TexCoords.xy * vec2(${c[0]}, ${c[1]}));
        }
      `,new i.GlslLibRoutine(a);let f=c,p=Math.ceil(d[1]/2);return a=`
        ivec2 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${f[0]}, ${f[1]}));

          int index = resTexRC.y * ${f[0]} + resTexRC.x;

          // reverse r and c order for packed texture
          int r = imod(index, ${p}) * 2;
          int c = 2 * (index / ${p});

          return ivec2(r, c);
        }
      `,new i.GlslLibRoutine(a)}getOutputPacked3DCoords(d,c){let a=[c[0],c[1]],f=Math.ceil(d[2]/2),p=f*Math.ceil(d[1]/2),g=`
        ivec3 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${a[0]}, ${a[1]}));
          int index = resTexRC.y * ${a[0]} + resTexRC.x;

          int b = index / ${p};
          index -= b * ${p};

          // reverse r and c order for packed texture
          int r = imod(index, ${f}) * 2;
          int c = 2 * (index / ${f});

          return ivec3(b, r, c);
        }
      `;return new i.GlslLibRoutine(g)}getOutputPackedNDCoords(d,c){let a=[c[0],c[1]],f=Math.ceil(d[d.length-1]/2),p=f*Math.ceil(d[d.length-2]/2),g=p,m="",y="b, r, c";for(let x=2;x<d.length-1;x++)g*=d[d.length-x-1],m=`
      int b${x} = index / ${g};
      index -= b${x} * ${g};
    `+m,y=`b${x}, `+y;let _=`
      ivec${d.length} getOutputCoords() {
        ivec2 resTexRC = ivec2(TexCoords.xy *
                              vec2(${a[0]}, ${a[1]}));
        int index = resTexRC.y * ${a[0]} + resTexRC.x;

        ${m}

        int b = index / ${p};
        index -= b * ${p};

        // reverse r and c order for packed texture
        int r = imod(index, ${f}) * 2;
        int c = 2 * (index / ${f});

        return ivec${d.length}(${y});
      }
    `;return new i.GlslLibRoutine(_)}getOutputUnpacked1DCoords(d,c){let a=`
        int getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${c[0]}, ${c[1]}));
          return resTexRC.y * ${c[0]} + resTexRC.x;
        }
      `;return new i.GlslLibRoutine(a)}getOutputUnpacked2DCoords(d,c){let a=`
        ivec2 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${c[0]}, ${c[1]}));
          int index = resTexRC.y * ${c[0]} + resTexRC.x;
          int r = index / ${d[1]};
          int c = index - r * ${d[1]};
          return ivec2(r, c);
        }
      `;return new i.GlslLibRoutine(a)}getOutputUnpacked3DCoords(d,c){let a="",f=d.length,p=null;f<2&&(p=[]),p=new Array(f-1),p[f-2]=d[f-1];for(let y=f-3;y>=0;--y)p[y]=p[y+1]*d[y+1];let g=["r","c","d"],m=p.map((y,_)=>`int ${g[_]} = index / ${y}; ${_===p.length-1?`int ${g[_+1]} = index - ${g[_]} * ${y}`:`index -= ${g[_]} * ${y}`};`).join("");return a=`
        ivec3 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${c[0]}, ${c[1]}));
          int index = resTexRC.y * ${c[0]} + resTexRC.x;
          ${m}
          return ivec3(r, c, d);
        }
      `,new i.GlslLibRoutine(a)}getOutputUnpacked4DCoords(d,c){let a="",f=d.length,p=null;f<2&&(p=[]),p=new Array(f-1),p[f-2]=d[f-1];for(let y=f-3;y>=0;--y)p[y]=p[y+1]*d[y+1];let g=["r","c","d","d2"],m=p.map((y,_)=>`int ${g[_]} = index / ${y}; ${_===p.length-1?`int ${g[_+1]} = index - ${g[_]} * ${y}`:`index -= ${g[_]} * ${y}`};`).join("");return a=`
      ivec4 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${c[0]}, ${c[1]}));
          int index = resTexRC.y * ${c[0]} + resTexRC.x;
          ${m}
          return ivec4(r, c, d, d2);
        }
      `,new i.GlslLibRoutine(a)}getOutputUnpacked5DCoords(d,c){let a="",f=d.length,p=null;f<2&&(p=[]),p=new Array(f-1),p[f-2]=d[f-1];for(let y=f-3;y>=0;--y)p[y]=p[y+1]*d[y+1];let g=["r","c","d","d2","d3"],m=p.map((y,_)=>`int ${g[_]} = index / ${y}; ${_===p.length-1?`int ${g[_+1]} = index - ${g[_]} * ${y}`:`index -= ${g[_]} * ${y}`};`).join("");return a=`
      ivec5 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${c[0]}, ${c[1]}));
          int index = resTexRC.y * ${c[0]} + resTexRC.x;
          ${m}
          return ivec5(r, c, d, d2, d3);
        }
      `,new i.GlslLibRoutine(a)}getOutputUnpacked6DCoords(d,c){let a="",f=d.length,p=null;f<2&&(p=[]),p=new Array(f-1),p[f-2]=d[f-1];for(let y=f-3;y>=0;--y)p[y]=p[y+1]*d[y+1];let g=["r","c","d","d2","d3","d4"],m=p.map((y,_)=>`int ${g[_]} = index / ${y}; ${_===p.length-1?`int ${g[_+1]} = index - ${g[_]} * ${y}`:`index -= ${g[_]} * ${y}`};`).join("");return a=`
     ivec6 getOutputCoords() {
         ivec2 resTexRC = ivec2(TexCoords.xy *
                               vec2(${c[0]}, ${c[1]}));
         int index = resTexRC.y * ${c[0]} + resTexRC.x;
         ${m}
         return ivec6(r, c, d, d2, d3, d4);
       }
     `,new i.GlslLibRoutine(a)}getCommonUtilFuncs(){let d={},c="uvFromFlat";d[c]=new i.GlslLibRoutine(`
    vec2 uvFromFlat(int texNumR, int texNumC, int index) {
      int texC = index / texNumR;
      int texR = index - texC * texNumR;
      // TODO: swap texR, texC order in following function so row is corresponding to u and column is corresponding to
      //       v.
      return (vec2(texR, texC) + halfCR) / vec2(texNumR, texNumC);
    }
    `),c="packedUVfrom1D",d[c]=new i.GlslLibRoutine(`
      vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
        int texelIndex = index / 2;
        int texR = texelIndex / texNumC;
        int texC = texelIndex - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),c="packedUVfrom2D",d[c]=new i.GlslLibRoutine(`
      vec2 packedUVfrom2D(int texNumR, int texNumC, int texelsInLogicalRow, int row, int col) {
        int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
        int texR = texelIndex / texNumC;
        int texC = texelIndex - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),c="packedUVfrom3D",d[c]=new i.GlslLibRoutine(`
      vec2 packedUVfrom3D(int texNumR, int texNumC,
          int texelsInBatch, int texelsInLogicalRow, int b,
          int row, int col) {
        int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
        int texR = index / texNumC;
        int texC = index - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),c="sampleTexture";let a=(0,r.getGlsl)(this.context.glContext.version);return d[c]=new i.GlslLibRoutine(`
        float sampleTexture(sampler2D textureSampler, vec2 uv) {
            return ${a.texture2D}(textureSampler, uv).r;
        }`),d}getInputsSamplingSnippets(){let d={},c=this.context.outputTextureLayout;return this.context.programInfo.inputNames.forEach((a,f)=>{let p=this.context.inputTextureLayouts[f],g=(0,l.generateShaderFuncNameFromInputSamplerName)(a);p.isPacked?d[g]=this.getPackedSamplerFromInput(g,a,p):d[g]=this.getUnpackedSamplerFromInput(g,a,p);let m=(0,l.generateShaderFuncNameFromInputSamplerNameAtOutCoords)(a);p.unpackedShape.length<=c.unpackedShape.length&&(p.isPacked?d[m]=this.getPackedSamplerAtOutputCoords(m,p,c,a):d[m]=this.getUnpackedSamplerAtOutputCoords(m,p,c,a))}),d}getPackedSamplerAtOutputCoords(d,c,a,f){let p=c.unpackedShape,g=a.unpackedShape,m=f,y=(0,l.generateShaderFuncNameFromInputSamplerName)(m),_=p.length,x=g.length,E=n.BroadcastUtil.getBroadcastDims(p,g),S=(0,l.getCoordsDataType)(x),T=x-_,C,I=(0,l.getGlChannels)();C=_===0?"":x<2&&E.length>=1?"coords = 0;":E.map(B=>`coords.${I[B+T]} = 0;`).join(`
`);let A="";A=x<2&&_>0?"coords":p.map((B,V)=>`coords.${I[V+T]}`).join(", ");let P="return outputValue;",F=n.ShapeUtil.size(p)===1,H=n.ShapeUtil.size(g)===1;if(_!==1||F||H){if(F&&!H)P=x===1?`
          return vec4(outputValue.x, outputValue.x, 0., 0.);
        `:`
          return vec4(outputValue.x);
        `;else if(E.length){let B=_-2,V=_-1;E.indexOf(B)>-1&&E.indexOf(V)>-1?P="return vec4(outputValue.x);":E.indexOf(B)>-1?P="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":E.indexOf(V)>-1&&(P="return vec4(outputValue.xx, outputValue.zz);")}}else P=`
        return vec4(outputValue.xy, outputValue.xy);
      `;let z=`
      vec4 ${d}() {
        ${S} coords = getOutputCoords();
        
        int lastDim = coords.${I[x-1]};
        coords.${I[x-1]} = coords.${I[x-2]};
        coords.${I[x-2]} = lastDim;
      
        ${C}
        vec4 outputValue = ${y}(${A});
        ${P}
      }
    `;return new i.GlslLibRoutine(z,["coordinates.getOutputCoords"])}getUnpackedSamplerAtOutputCoords(d,c,a,f){let p=[a.width,a.height],g=[c.width,c.height],m=c.unpackedShape.length,y=a.unpackedShape.length,_=c.unpackedShape,x=a.unpackedShape,E=(0,l.generateShaderFuncNameFromInputSamplerName)(f);if(m===y&&n.ArrayUtil.arraysEqual(g,p)){let H=`
          float ${d}() {
            return sampleTexture(${f}, TexCoords);
          }
        `;return new i.GlslLibRoutine(H,["coordinates.sampleTexture"])}let S=(0,l.getCoordsDataType)(y),T=n.BroadcastUtil.getBroadcastDims(_,x),C=y-m,I,A=(0,l.getGlChannels)();I=m===0?"":y<2&&T.length>=1?"coords = 0;":T.map(H=>`coords.${A[H+C]} = 0;`).join(`
`);let P="";P=y<2&&m>0?"coords":c.unpackedShape.map((H,z)=>`coords.${A[z+C]}`).join(", ");let F=`
        float ${d}() {
          ${S} coords = getOutputCoords();
          ${I}
          return ${E}(${P});
        }
      `;return new i.GlslLibRoutine(F,["coordinates.getOutputCoords"])}getPackedSamplerFromInput(d,c,a){switch(a.unpackedShape.length){case 0:return this.getPackedSamplerScalar(d,c);case 1:return this.getPackedSampler1D(d,c,a);case 2:return this.getPackedSampler2D(d,c,a);case 3:return this.getPackedSampler3D(d,c,a);default:return this.getPackedSamplerND(d,c,a)}}getUnpackedSamplerFromInput(d,c,a){let f=a.unpackedShape;switch(f.length){case 0:return this.getUnpackedSamplerScalar(d,c,a);case 1:return this.getUnpackedSampler1D(d,c,a);case 2:return this.getUnpackedSampler2D(d,c,a);case 3:return this.getUnpackedSampler3D(d,c,a);case 4:return this.getUnpackedSampler4D(d,c,a);case 5:return this.getUnpackedSampler5D(d,c,a);case 6:return this.getUnpackedSampler6D(d,c,a);default:throw new Error(`Unsupported dimension ${f.length}-D`)}}getPackedSamplerScalar(d,c){let a=`
          vec4 ${d}() {
            return ${(0,r.getGlsl)(this.context.glContext.version).texture2D}(${c}, halfCR);
          }
        `;return new i.GlslLibRoutine(a)}getPackedSampler1D(d,c,a){let f=[a.width,a.height],p=[f[1],f[0]],g=(0,r.getGlsl)(this.context.glContext.version),m=`vec4 ${d}(int index) {
      vec2 uv = packedUVfrom1D(
      ${p[0]}, ${p[1]}, index);
      return ${g.texture2D}(${c}, uv);
    }`;return new i.GlslLibRoutine(m,["coordinates.packedUVfrom1D"])}getPackedSampler2D(d,c,a){let f=a.unpackedShape,p=[a.width,a.height],g=(0,r.getGlsl)(this.context.glContext.version),m=p[0],y=p[1];if(p!=null&&n.ArrayUtil.arraysEqual(f,p)){let S=`vec4 ${d}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${y}.0, ${m}.0);
        return ${g.texture2D}(${c}, uv);
      }`;return new i.GlslLibRoutine(S)}let _=p,x=Math.ceil(f[1]/2),E=`vec4 ${d}(int row, int col) {
      vec2 uv = packedUVfrom2D(${_[1]}, ${_[0]}, ${x}, row, col);
      return ${g.texture2D}(${c}, uv);
    }`;return new i.GlslLibRoutine(E,["coordinates.packedUVfrom2D"])}getPackedSampler3D(d,c,a){let f=a.unpackedShape,p=[a.width,a.height],g=[p[0],p[1]],m=(0,r.getGlsl)(this.context.glContext.version);if(f[0]===1){let S=f.slice(1),T=[1,2],C=(0,l.squeezeInputShape)(f,S),I=["b","row","col"],A=JSON.parse(JSON.stringify(a));A.unpackedShape=C;let P=this.getPackedSamplerFromInput(d,c,A),F=`${P.routineBody}
      vec4 ${d}(int b, int row, int col) {
        return ${d}(${(0,l.getSqueezedParams)(I,T)});
      } `;return new i.GlslLibRoutine(F,P.dependencies)}let y=g[0],_=g[1],x=Math.ceil(f[2]/2),E=`vec4 ${d}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${_}, ${y}, ${x*Math.ceil(f[1]/2)}, ${x}, b, row, col);
      return ${m.texture2D}(${c}, uv);}`;return new i.GlslLibRoutine(E,["coordinates.packedUVfrom3D"])}getPackedSamplerND(d,c,a){let f=a.unpackedShape,p=f.length,g=[a.width,a.height],m=(0,r.getGlsl)(this.context.glContext.version),y=[g[0],g[1]],_=y[1],x=y[0],E=Math.ceil(f[p-1]/2),S=E*Math.ceil(f[p-2]/2),T="int b, int row, int col",C=`b * ${S} + (row / 2) * ${E} + (col / 2)`;for(let A=2;A<p-1;A++)T=`int b${A}, `+T,S*=f[p-A-1],C=`b${A} * ${S} + `+C;let I=`vec4 ${d}(${T}) {
      int index = ${C};
      int texR = index / ${x};
      int texC = index - texR * ${x};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${x}, ${_});
      return ${m.texture2D}(${c}, uv);
    }`;return new i.GlslLibRoutine(I)}getUnpackedSamplerScalar(d,c,a){let[f,p]=[a.width,a.height];if(f===1&&p===1){let m=`
          float ${d}() {
            return sampleTexture(${c}, halfCR);
          }
        `;return new i.GlslLibRoutine(m,["coordinates.sampleTexture"])}let g=`
        float ${d}() {
          int offset_${c} = coordsToOffset(TexCoords, ${f}, ${p});
          vec2 uv = uvFromFlat(${f}, ${p}, offset_${c});
          return sampleTexture(${c}, uv);
        }
      `;return new i.GlslLibRoutine(g,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler1D(d,c,a){let f=a.width,p=a.height;if(p===1&&f===1){let m=`
        float ${d}(int index) {
          return sampleTexture(${c}, halfCR);
        }
      `;return new i.GlslLibRoutine(m,["coordinates.sampleTexture"])}if(p===1){let m=`
          float ${d}(int index) {
            vec2 uv = vec2((float(index) + 0.5) / ${f}.0, 0.5);
            return sampleTexture(${c}, uv);
          }
        `;return new i.GlslLibRoutine(m,["coordinates.sampleTexture"])}if(f===1){let m=`
          float ${d}(int index) {
            vec2 uv = vec2(0.5, (float(index) + 0.5) / ${p}.0);
            return sampleTexture(${c}, uv);
          }
        `;return new i.GlslLibRoutine(m,["coordinates.sampleTexture"])}let g=`
        float ${d}(int index) {
          vec2 uv = uvFromFlat(${f}, ${p}, index);
          return sampleTexture(${c}, uv);
        }
      `;return new i.GlslLibRoutine(g,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler2D(d,c,a){let f=a.unpackedShape,p=[a.height,a.width];if(p!=null&&n.ArrayUtil.arraysEqual(f,p)){let S=`
          float ${d}(int row, int col) {
            vec2 uv = (vec2(row, col) + halfCR) / vec2(${p[1]}.0, ${p[0]}.0);
            return sampleTexture(${c}, uv);
          }
        `;return new i.GlslLibRoutine(S,["coordinates.sampleTexture"])}let{newShape:g,keptDims:m}=(0,o.squeezeShape)(f),y=g;if(y.length<f.length){let S=(0,l.squeezeInputShape)(f,y),T=JSON.parse(JSON.stringify(a));T.unpackedShape=S;let C=["col","row"],I=`
          ${this.getUnpackedSamplerFromInput(d,c,T).routineBody}
          float ${d}(int row, int col) {
            return ${d}(${(0,l.getSqueezedParams)(C,m)});
          }
        `;return new i.GlslLibRoutine(I,["coordinates.sampleTexture"])}let _=p[1],x=p[0];if(x===1){let S=`
          float ${d}(int row, int col) {
            int offset_${c} = coordsToOffset(TexCoords, ${_}, ${x});
            float index = dot(vec3(row, col, offset_${c}), vec3(${f[1]}, 1, 1));
            vec2 uv = vec2(0.5, (index + 0.5) / ${_}.0);
            return sampleTexture(${c}, uv);
          }
        `;return new i.GlslLibRoutine(S,["coordinates.sampleTexture","coordinates.coordsToOffset"])}if(_===1){let S=`
          float ${d}(int row, int col) {
            int offset_${c} = coordsToOffset(TexCoords, ${_}, ${x});
            float index = dot(vec3(row, col, offset_${c}), vec3(${f[1]}, 1, 1));
            vec2 uv = vec2((index + 0.5) / ${x}.0, 0.5);
            return sampleTexture(${c}, uv);
          }
        `;return new i.GlslLibRoutine(S,["coordinates.sampleTexture","coordinates.coordsToOffset"])}let E=`
        float ${d}(int row, int col) {
          int index = col * ${f[1]} + row;
          vec2 uv = uvFromFlat(${_}, ${x}, index);
          return sampleTexture(${c}, uv);
        }
      `;return new i.GlslLibRoutine(E,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler3D(d,c,a){let f=a.unpackedShape,p=f[1]*f[2],g=f[2],{newShape:m,keptDims:y}=(0,o.squeezeShape)(f),_=m;if(_.length<f.length){let E=(0,l.squeezeInputShape)(f,_),S=["batch","col","row"],T=JSON.parse(JSON.stringify(a));T.unpackedShape=E;let C=this.getUnpackedSamplerFromInput(d,c,T),I=y.reverse(),A=`
          ${C.routineBody}
          float ${d}(int batch, int row, int col) {
            return ${d}(${(0,l.getSqueezedParams)(S,I)});
          }
        `;return new i.GlslLibRoutine(A,C.dependencies)}let x=`
          float ${d}(int depth, int row, int col) {
            // Explicitly use integer operations as dot() only works on floats.
            int index = depth * ${p} + col * ${g} + row;
            vec2 uv = uvFromFlat(${a.width}, ${a.height}, index);
            return sampleTexture(${c}, uv);
          }
      `;return new i.GlslLibRoutine(x,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler4D(d,c,a){let f=a.unpackedShape,p=f[3],g=f[2]*p,m=`
        float ${d}(int row, int col, int depth, int depth2) {
          int index = row * ${f[1]*g} + col * ${g} +
              depth2 * ${p} + depth;
          vec2 uv = uvFromFlat(${a.width}, ${a.height}, index);
          return sampleTexture(${c}, uv);
        }
      `;return new i.GlslLibRoutine(m,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler5D(d,c,a){let f=a.unpackedShape,p=f[4],g=f[3]*p,m=f[2]*g,y=f[1]*m,{newShape:_,keptDims:x}=(0,o.squeezeShape)(f);if(_.length<f.length){let S=(0,l.squeezeInputShape)(f,_),T=["row","col","depth","depth2","depth3"],C=JSON.parse(JSON.stringify(a));C.unpackedShape=S;let I=`
          ${this.getUnpackedSamplerFromInput(d,c,C).routineBody}
          float ${d}(int row, int col, int depth, int depth2, int depth3) {
            return ${d}(${(0,l.getSqueezedParams)(T,x)});
          }
        `;return new i.GlslLibRoutine(I,["coordinates.sampleTexture","coordinates.uvFromFlat"])}let E=`
        float ${d}(int row, int col, int depth, int depth2, int depth3) {
          int index = row * ${y} + col * ${m} + depth * ${g} +
          depth3 * ${p} + depth2;
          vec2 uv = uvFromFlat(${a.width}, ${a.height}, index);
          return sampleTexture(${c}, uv);
        }
      `;return new i.GlslLibRoutine(E,["coordinates.sampleTexture","coordinates.uvFromFlat"])}getUnpackedSampler6D(d,c,a){let f=a.unpackedShape,p=f[5],g=f[4]*p,m=f[3]*g,y=f[2]*m,_=f[1]*y,{newShape:x,keptDims:E}=(0,o.squeezeShape)(f);if(x.length<f.length){let T=(0,l.squeezeInputShape)(f,x),C=["row","col","depth","depth2","depth3","depth4"],I=JSON.parse(JSON.stringify(a));I.unpackedShape=T;let A=`
            ${this.getUnpackedSamplerFromInput(d,c,I).routineBody}
            float ${d}(int row, int col, int depth,
              int depth2, int depth3, int depth4) {
              return ${d}(${(0,l.getSqueezedParams)(C,E)});
            }
          `;return new i.GlslLibRoutine(A,["coordinates.sampleTexture","coordinates.uvFromFlat"])}let S=`
          float ${d}(int row, int col, int depth,
            int depth2, int depth3, int depth4) {
            int index = row * ${_} + col * ${y} + depth * ${m} +
            depth2 * ${g} + depth3 * ${p} + depth4;
            vec2 uv = uvFromFlat(${a.width}, ${a.height}, index);
            return sampleTexture(${c}, uv);
          }
        `;return new i.GlslLibRoutine(S,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}toVec(){let d=this.context.outputTextureLayout,c=d.shape.length,a=d.strides,f=d.width,p=d.height,g=[];for(let y=0;y<c-1;++y)g.push(`
        c[${y}] = offset / ${a[y]};`),g.push(`
        offset -= c[${y}] * ${a[y]};`);g.push(`
        c[${c-1}] = offset;`);let m=`
      void toVec(vec2 texCoords, out int c[${c}]) {
        int offset = coordsToOffset(texCoords, ${f}, ${p});
        ${g.join("")}
      }
      void toVec(int offset, out int c[${c}]) {
        ${g.join("")}
      }
    `;return{toVec:new i.GlslLibRoutine(m,["coordinates.coordsToOffset"])}}valueFrom(){let d={};return this.context.programInfo.inputNames.forEach((c,a)=>{let f=this.context.inputTextureLayouts[a],p=(f.unpackedShape.length>0?f.unpackedShape:f.shape).length,g=`_${c}`;d[g]=new i.GlslLibRoutine(this.getValueFromSingle(c,p,f.width,f.height,!1),[`shapeUtils.indicesToOffset${g}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"]),g+="_T",d[g]=new i.GlslLibRoutine(this.getValueFromSingle(c,p,f.width,f.height,!0),[`shapeUtils.indicesToOffset${g}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"])}),d}getValueFromSingle(d,c,a,f,p){let g=`_${d}`;return p&&(g+="_T"),`
        float ${g}(int m[${c}]) {
          int offset = indicesToOffset${g}(m);
          vec2 coords = offsetToCoords(offset, ${a}, ${f});
          float value = getColorAsFloat(${(0,r.getGlsl)(this.context.glContext.version).texture2D}(${d}, coords));
          return value;
        }
        `}getPackedValueFrom(d,c,a,f,p){let g=`_${d}_Pack`;return p&&(g+="_T"),`
        vec4 ${g}(int m[${c}]) {
          int offset = indicesToOffset_${d}(m);
          vec2 coords = offsetToCoords(offset, ${a}, ${f});
          return ${(0,r.getGlsl)(this.context.glContext.version).texture2D}(${d}, coords);
        }
        `}}e.CoordsGlslLib=u},8520:(s,e)=>{"use strict";var t;Object.defineProperty(e,"__esModule",{value:!0}),e.TopologicalSortGlslRoutines=e.GlslLibRoutineNode=e.GlslLibRoutine=e.GlslLib=e.GlslContext=e.FunctionType=void 0,(t=e.FunctionType||(e.FunctionType={}))[t.ValueBased=0]="ValueBased",t[t.Positional=1]="Positional",e.GlslContext=class{constructor(n,i,r,o){this.glContext=n,this.programInfo=i,this.inputTextureLayouts=r,this.outputTextureLayout=o}},e.GlslLib=class{constructor(n){this.context=n}},e.GlslLibRoutine=class{constructor(n,i){this.routineBody=n,this.dependencies=i}},e.GlslLibRoutineNode=class{constructor(n,i,r){this.name=n,this.dependencies=r||[],i&&(this.routineBody=i)}addDependency(n){n&&this.dependencies.push(n)}},e.TopologicalSortGlslRoutines=class{static returnOrderedNodes(n){if(!n||n.length===0)return[];if(n.length===1)return n;let i=new Set,r=new Set,o=new Array;return this.createOrderedNodes(n,i,r,o),o}static createOrderedNodes(n,i,r,o){for(let l=0;l<n.length;++l)this.dfsTraverse(n[l],i,r,o)}static dfsTraverse(n,i,r,o){if(!n||r.has(n.name))return;if(i.has(n.name))throw new Error("Cyclic dependency detected. Can't topologically sort routines needed for shader.");i.add(n.name);let l=n.dependencies;if(l&&l.length>0)for(let u=0;u<l.length;++u)this.dfsTraverse(l[u],i,r,o);o.push(n),r.add(n.name),i.delete(n.name)}}},7341:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EncodingGlslLib=void 0;let n=t(8520);class i extends n.GlslLib{constructor(o){super(o)}getFunctions(){return Object.assign(Object.assign({},this.encodeFloat32()),this.decodeFloat32())}getCustomTypes(){return{}}encodeFloat32(){return{encode:new n.GlslLibRoutine(`highp vec4 encode(highp float f) {
        return vec4(f, 0.0, 0.0, 0.0);
      }
        `)}}decodeFloat32(){return{decode:new n.GlslLibRoutine(`highp float decode(highp vec4 rgba) {
        return rgba.r;
      }
        `)}}encodeUint8(){let o=i.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{encode:new n.GlslLibRoutine(`
      highp vec4 encode(highp float f) {
        highp float F = abs(f);
        highp float Sign = step(0.0,-f);
        highp float Exponent = floor(log2(F));
        highp float Mantissa = (exp2(- Exponent) * F);
        Exponent = floor(log2(F) + 127.0) + floor(log2(Mantissa));
        highp vec4 rgba;
        rgba[0] = 128.0 * Sign  + floor(Exponent*exp2(-1.0));
        rgba[1] = 128.0 * mod(Exponent,2.0) + mod(floor(Mantissa*128.0),128.0);
        rgba[2] = floor(mod(floor(Mantissa*exp2(23.0 -8.0)),exp2(8.0)));
        rgba[3] = floor(exp2(23.0)*mod(Mantissa,exp2(-15.0)));
        ${o}
        rgba = rgba / 255.0; // values need to be normalized to [0,1]
        return rgba;
    }
        `)}}decodeUint8(){let o=i.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{decode:new n.GlslLibRoutine(`
        highp float decode(highp vec4 rgba) {
          rgba = rgba * 255.0; // values need to be de-normalized from [0,1] to [0,255]
          ${o}
          highp float Sign = 1.0 - step(128.0,rgba[0])*2.0;
          highp float Exponent = 2.0 * mod(rgba[0],128.0) + step(128.0,rgba[1]) - 127.0;
          highp float Mantissa = mod(rgba[1],128.0)*65536.0 + rgba[2]*256.0 +rgba[3] + float(0x800000);
          highp float Result =  Sign * exp2(Exponent) * (Mantissa * exp2(-23.0 ));
          return Result;
      }
        `)}}static isLittleEndian(){let o=new ArrayBuffer(4),l=new Uint32Array(o),u=new Uint8Array(o);if(l[0]=3735928559,u[0]===239)return!0;if(u[0]===222)return!1;throw new Error("unknown endianness")}}e.EncodingGlslLib=i},9894:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FragColorGlslLib=void 0;let n=t(8520),i=t(5060);class r extends n.GlslLib{constructor(l){super(l)}getFunctions(){return Object.assign(Object.assign({},this.setFragColor()),this.getColorAsFloat())}getCustomTypes(){return{}}setFragColor(){let l=(0,i.getGlsl)(this.context.glContext.version);return{setFragColor:new n.GlslLibRoutine(`
        void setFragColor(float value) {
            ${l.output} = encode(value);
        }
        `,["encoding.encode"])}}getColorAsFloat(){return{getColorAsFloat:new n.GlslLibRoutine(`
        float getColorAsFloat(vec4 color) {
            return decode(color);
        }
        `,["encoding.decode"])}}}e.FragColorGlslLib=r},2848:(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.replaceInlines=void 0;let t=/@inline[\s\n\r]+(\w+)[\s\n\r]+([0-9a-zA-Z_]+)\s*\(([^)]*)\)\s*{(([^}]|[\n\r])*)}/gm;e.replaceInlines=function(n){let i={},r;for(;(r=t.exec(n))!==null;){let o=r[3].split(",").map(l=>{let u=l.trim().split(" ");return u&&u.length===2?{type:u[0],name:u[1]}:null}).filter(l=>l!==null);i[r[2]]={params:o,body:r[4]}}for(let o in i){let l="(\\w+)?\\s+([_0-9a-zA-Z]+)\\s+=\\s+__FUNC__\\((.*)\\)\\s*;".replace("__FUNC__",o),u=new RegExp(l,"gm");for(;(r=u.exec(n))!==null;){let h=r[1],d=r[2],c=r[3].split(","),a=h?`${h} ${d};`:"",f=i[o].body,p="";i[o].params.forEach((m,y)=>{m&&(p+=`${m.type} ${m.name} = ${c[y]};
`)}),f=`${p}
 ${f}`,f=f.replace("return",`${d} = `);let g=`
      ${a}
      {
        ${f}
      }
      `;n=n.replace(r[0],g)}}return n.replace(t,"")}},8879:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GlslPreprocessor=void 0;let n=t(8520),i=t(2848),r=t(5483),o=t(5060);e.GlslPreprocessor=class{constructor(l,u,h,d){this.libs={},this.glslLibRoutineDependencyGraph={},this.context=new n.GlslContext(l,u,h,d),Object.keys(r.glslRegistry).forEach(a=>{let f=new r.glslRegistry[a](this.context);this.libs[a]=f});let c=this.glslLibRoutineDependencyGraph;for(let a in this.libs){let f=this.libs[a].getFunctions();for(let p in f){let g=a+"."+p,m;c[g]?(m=c[g],m.routineBody=f[p].routineBody):(m=new n.GlslLibRoutineNode(g,f[p].routineBody),c[g]=m);let y=f[p].dependencies;if(y)for(let _=0;_<y.length;++_)if(c[y[_]])m.addDependency(c[y[_]]);else{let x=new n.GlslLibRoutineNode(y[_]);c[y[_]]=x,m.addDependency(x)}}}}preprocess(){let l=this.context.programInfo,u=l.shaderSource;return this.context.programInfo.hasMain||(u=`${u}
      ${(0,o.getDefaultFragShaderMain)(this.context.glContext.version,this.context.outputTextureLayout.shape.length)}`),u=(0,i.replaceInlines)(u),`${(0,o.getFragShaderPreamble)(this.context.glContext.version)}
    ${this.getUniforms(l.inputNames,l.variables)}
    ${this.getImports(u)}
    ${u}`}getImports(l){let u=this.selectGlslLibRoutinesToBeIncluded(l);if(u.length===0)return"";let h="";for(let d=0;d<u.length;++d){if(!u[d].routineBody)throw new Error(`Missing body for the Glsl Library routine: ${u[d].name}`);h+=u[d].routineBody+`
`}return h}selectGlslLibRoutinesToBeIncluded(l){let u=[];return Object.keys(this.glslLibRoutineDependencyGraph).forEach(h=>{let d=h.split(".")[1];l.indexOf(d)!==-1&&u.push(this.glslLibRoutineDependencyGraph[h])}),n.TopologicalSortGlslRoutines.returnOrderedNodes(u)}getUniforms(l,u){let h=[];if(l)for(let d of l)h.push(`uniform sampler2D ${d};`);if(u)for(let d of u)h.push(`uniform ${d.type} ${d.name}${d.arrayLength?`[${d.arrayLength}]`:""};`);return h.join(`
`)}}},5483:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.glslRegistry=void 0;let n=t(5107),i=t(7341),r=t(9894),o=t(2655),l=t(3891);e.glslRegistry={encoding:i.EncodingGlslLib,fragcolor:r.FragColorGlslLib,vec:l.VecGlslLib,shapeUtils:o.ShapeUtilsGlslLib,coordinates:n.CoordsGlslLib}},2655:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ShapeUtilsGlslLib=void 0;let n=t(8520);class i extends n.GlslLib{constructor(o){super(o)}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.bcastIndex()),this.bcastMatmulIndex()),this.offsetToIndices()),this.indicesToOffset()),this.incrementIndices())}getCustomTypes(){return{}}bcastIndex(){let o=this.context.outputTextureLayout.shape.length,l={};return this.context.programInfo.inputNames.forEach((u,h)=>{let d=this.context.inputTextureLayouts[h].unpackedShape;if(d.length<=o){let c=d.length,a=o-c,f=`bcastIndices_${u}`,p="";for(let m=0;m<c;++m)p+=`
          realIndices[${m}] = int( mod(float(bcastedIndices[${a+m}]), ${d[m]}.0) );
          `;let g=`
        void ${f} (int bcastedIndices[${o}], out int realIndices[${c}]) {
          ${p}
        }
        `;l[f]=new n.GlslLibRoutine(g)}}),l}bcastMatmulIndex(){let o=this.context.outputTextureLayout.shape.length,l={};return this.context.programInfo.inputNames.forEach((u,h)=>{let d=this.context.inputTextureLayouts[h].shape;if(!(d.length<2||d.length>o)){let c=d.length,a=o-c,f=`bcastMatmulIndices_${u}`,p="";for(let m=0;m<c-2;++m)p+=`
          realIndices[${m}] = int( mod(float(bcastedIndices[${a+m}]), ${d[m]}.0) );
          `;let g=`
        void ${f}(int bcastedIndices[${o}], out int realIndices[${c}]) {
          ${p}
          realIndices[${c-1}] = bcastedIndices[${o-1}];
          realIndices[${c-2}] = bcastedIndices[${o-2}];
        }
        `;l[f]=new n.GlslLibRoutine(g)}}),l}indicesToOffset(){let o={};return this.context.programInfo.inputNames.forEach((l,u)=>{let h=this.context.inputTextureLayouts[u].shape,d=this.context.inputTextureLayouts[u].strides,c=h.length,a=`indicesToOffset_${l}`;o[a]=new n.GlslLibRoutine(i.indexToOffsetSingle(a,c,d)),a=`indicesToOffset_${l}_T`,o[a]=new n.GlslLibRoutine(i.indexToOffsetSingle(a,c,d.slice().reverse()))}),o}static indexToOffsetSingle(o,l,u){let h="";for(let d=l-1;d>=0;--d)h+=`
        offset += indices[${d}] * ${u[d]};
        `;return`
      int ${o}(int indices[${l}]) {
        int offset = 0;
        ${h}
        return offset;
      }
      `}offsetToIndices(){let o={};return this.context.programInfo.inputNames.forEach((l,u)=>{let h=this.context.inputTextureLayouts[u].shape,d=this.context.inputTextureLayouts[u].strides,c=h.length,a=`offsetToIndices_${l}`;o[a]=new n.GlslLibRoutine(i.offsetToIndicesSingle(a,c,d)),a=`offsetToIndices_${l}_T`,o[a]=new n.GlslLibRoutine(i.offsetToIndicesSingle(a,c,d.slice().reverse()))}),o}static offsetToIndicesSingle(o,l,u){let h=[];for(let d=0;d<l-1;++d)h.push(`
      indices[${d}] = offset / ${u[d]};`),h.push(`
        offset -= indices[${d}] * ${u[d]};`);return h.push(`
      indices[${l-1}] = offset;`),`
      void ${o}(int offset, out int indices[${l}]) {
        ${h.join("")}
      }
      `}incrementIndices(){let o={};return this.context.programInfo.inputNames.forEach((l,u)=>{let h=this.context.inputTextureLayouts[u].shape,d=h.length,c=`incrementIndices_${l}`,a="";for(let p=0;p<d;++p)a+=`
        shape[${p}] = ${h[p]};`;let f=`
        void ${c}(int axis, out int indices[${d}]) {
          int shape[${d}];
          ${a};
          for(int i = ${d} -1 ; i >= 0; --i) {
            if(i > axis) continue;
            indices[i] += 1;
            if(indices[i] < shape[i]) {
              break;
            }
            indices[i] = 0;
          }
        }
        `;o[c]=new n.GlslLibRoutine(f)}),o}}e.ShapeUtilsGlslLib=i},5060:(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaultFragShaderMain=e.getFragShaderPreamble=e.getVertexShaderSource=e.getGlsl=void 0;let t={version:"",attribute:"attribute",varyingVertex:"varying",varyingFrag:"varying",texture2D:"texture2D",output:"gl_FragColor",outputDeclaration:""},n={version:"#version 300 es",attribute:"in",varyingVertex:"out",varyingFrag:"in",texture2D:"texture",output:"outputColor",outputDeclaration:"out vec4 outputColor;"};function i(r){return r===1?t:n}e.getGlsl=i,e.getVertexShaderSource=function(r){let o=i(r);return`${o.version}
      precision highp float;
      ${o.attribute} vec3 position;
      ${o.attribute} vec2 textureCoord;

      ${o.varyingVertex} vec2 TexCoords;

      void main()
      {
          gl_Position = vec4(position, 1.0);
          TexCoords = textureCoord;
      }`},e.getFragShaderPreamble=function(r){let o=i(r);return`${o.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${o.varyingFrag} vec2 TexCoords;
    ${o.outputDeclaration}
    const vec2 halfCR = vec2(0.5, 0.5);

    // Custom vector types to handle higher dimenalities.
    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    `},e.getDefaultFragShaderMain=function(r,o){return`
  void main() {
    int indices[${o}];
    toVec(TexCoords, indices);
    vec4 result = vec4(process(indices));
    ${i(r).output} = result;
  }
  `}},3891:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VecGlslLib=void 0;let n=t(8520);class i extends n.GlslLib{constructor(o){super(o)}getCustomTypes(){return{}}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign({},this.binaryVecFunctions()),this.copyVec()),this.setVecItem()),this.getVecItem())}binaryVecFunctions(){let o=this.context.outputTextureLayout.shape.length,l={add:"+=",sub:"-=",mul:"*=",div:"/="},u={};for(let h in l){let d=`${h}Vec`,c="";for(let f=0;f<o;++f)c+=`
          dest[${f}] ${l[h]} src[${f}];
          `;let a=`
        void ${d}(int src[${o}], out int dest[${o}]) {
          ${c}
        }
        `;u[d]=new n.GlslLibRoutine(a)}return u}copyVec(){let o=this.context.outputTextureLayout.shape.length,l="";for(let h=0;h<o;++h)l+=`
        dest[${h}] = src[${h}];
        `;let u=`
      void copyVec(int src[${o}], out int dest[${o}]) {
        ${l}
      }
      `;return{copyVec:new n.GlslLibRoutine(u)}}setVecItem(){let o=this.context.outputTextureLayout.shape.length,l=`
        if(index < 0)
            index =${o} + index;
        if (index == 0)
            m[0] = value;
        `;for(let h=1;h<o-1;++h)l+=`
        else if (index == ${h})
            m[${h}] = value;
            `;l+=`
        else
            m[${o-1}] = value;
        `;let u=`
      void setVecItem(out int m[${o}], int index, int value) {
        ${l}
      }
        `;return{setVecItem:new n.GlslLibRoutine(u)}}getVecItem(){let o=this.context.outputTextureLayout.shape.length,l=`
        if(index < 0)
            index = ${o} + index;
        if (index == 0)
            return m[0];
      `;for(let h=1;h<o-1;++h)l+=`
        else if (index == ${h})
            return m[${h}];
      `;l+=`
        else
            return m[${o-1}];
        `;let u=`
      int getVecItem(int m[${o}], int index) {
        ${l}
      }
    `;return{getVecItem:new n.GlslLibRoutine(u)}}}e.VecGlslLib=i},8316:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLInferenceHandler=void 0;let n=t(6231),i=t(9162),r=t(2517),o=t(2403),l=t(7019),u=t(8710),h=t(5611),d=t(4057),c=t(2039);e.WebGLInferenceHandler=class{constructor(a){this.session=a,this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map}calculateTextureWidthAndHeight(a,f){return(0,d.calculateTextureWidthAndHeight)(this.session.layoutStrategy,a,f)}executeProgram(a,f){if(f.length<a.inputNames.length)throw new Error(`Input size mustn't be less than ${a.inputNames.length}.`);if(a.inputNames.length!==a.inputTypes.length)throw new Error("input names size does not match input types");let p=[];for(let E=0;E<a.inputNames.length;++E)p[E]=this.getOrCreateTextureData(f[E],a.inputTypes[E]);let g=((E,S)=>{let T=S.map(I=>`${I.unpackedShape.join(",")};${I.width}x${I.height}`).join("_"),C=E.name;return E.cacheHint&&(C+="["+E.cacheHint+"]"),C+=":"+T,C})(a,p),m=this.session.programManager.getArtifact(g),y=m?m.programInfo:typeof a.get=="function"?a.get():a,_=(0,d.createTextureLayoutFromTextureType)(this.session.layoutStrategy,y.output.dims,y.output.textureType),x=this.createTextureData(_,y.output.type);return m||(m=this.session.programManager.build(y,p,x),this.session.programManager.setArtifact(g,m)),this.runProgram(m,p,x),x}run(a,f){return this.executeProgram(a,f).tensor}runProgram(a,f,p){for(let g=0;g<f.length;++g)if(!!f[g].isPacked!=(a.programInfo.inputTypes[g]===c.TextureType.packed))throw new Error(`input[${g}] property packed inconsistent`);if(!!p.isPacked!=(a.programInfo.output.textureType===c.TextureType.packed))throw new Error("output property packed inconsistent");this.session.programManager.run(a,f,p)}getOrCreateTextureData(a,f){let p=this.getTextureData(a.dataId,f===c.TextureType.packed);if(!p&&(p=this.getTextureData(a.dataId,f!==c.TextureType.packed),p))return f===c.TextureType.packed?this.pack(p):this.unpack(p);if(!p){let g=(0,d.createTextureLayoutFromTextureType)(this.session.layoutStrategy,a.dims,f);if(f===c.TextureType.packedLastDimension){let _=a.dims;if(_.length===4){let x=[_[0],Math.ceil(_[1]*_[2]*_[3]/4)],E=(0,d.createTextureLayoutFromTextureType)(this.session.layoutStrategy,x,f),S=a.numberData;if(_[1]*_[2]*_[3]%4!=0){let T=_[0],C=_[1]*_[2]*_[3],I=Math.ceil(C*1/4)*4;S=new Float32Array(T*I);for(let A=0;A<T;++A){let P=A*C,F=A*I+A%1*C;S.set(a.numberData.subarray(P,P+C),F)}}return this.createTextureData(E,a.type,S,a,1)}}if(f===c.TextureType.packed){let m=(0,d.createTextureLayoutFromShape)(this.session.layoutStrategy,a.dims,1,[],{reverseWH:!0}),y=this.createTextureData(m,a.type,a.numberData,a,1);p=this.pack(y)}else p=this.createTextureData(g,a.type,a.numberData,a,1)}return p}createTextureDataFromLayoutBindTensor(a,f,p,g){return this.createTextureData(a,f,p,g,1)}createTextureData(a,f,p,g,m){n.Logger.verbose("InferenceHandler",`Creating TextureData: layout:[${JSON.stringify(a)}]`);let y=this.session.textureManager.createTextureFromLayout(f,a,p,m);return this.createTextureDataFromTexture(a,f,y,g)}reshapeUnpacked(a,f){let p=this.getOrCreateTextureData(a,c.TextureType.unpacked),g={channels:p.channels,height:p.height,width:p.width,shape:f.length!==0?f:[1],strides:r.ShapeUtil.computeStrides(f),unpackedShape:f};return this.createTextureDataFromTexture(g,a.type,p.texture).tensor}reshapePacked(a,f){let p=this.getOrCreateTextureData(a,c.TextureType.packed);if((0,l.isReshapeCheap)(a.dims,f)){let x={channels:p.channels,height:p.height,width:p.width,shape:f.length!==0?f:[1],strides:r.ShapeUtil.computeStrides(f),unpackedShape:f,isPacked:!0};return this.createTextureDataFromTexture(x,a.type,p.texture).tensor}let g=(0,l.processDims3D)(a.dims),m=(0,l.processDims3D)(f),y=this.reshapePacked(a,g),_=this.run((0,l.createPackedReshape3DProgramInfoLoader)(this,y,m),[y]);return this.reshapePacked(_,f)}cast(a,f){let p=this.getOrCreateTextureData(a,c.TextureType.unpacked);return this.createTextureDataFromTexture(p,f,p.texture).tensor}createTextureDataFromTexture(a,f,p,g,m){let y=Object.assign(Object.assign({},a),{tensor:g||new i.Tensor(a.unpackedShape,f,_=>this.readTexture(y),async _=>this.readTextureAsync(y),void 0,m),texture:p});return this.setTextureData(y.tensor.dataId,y,a.isPacked),y}getTextureData(a,f=!1){return this.session.isInitializer(a)?this.session.getTextureData(a,f):f?this.packedTextureDataCache.get(a):this.unpackedTextureDataCache.get(a)}setTextureData(a,f,p=!1){this.session.isInitializer(a)?this.session.setTextureData(a,f,p):(p?this.packedTextureDataCache:this.unpackedTextureDataCache).set(a,f)}isTextureLayoutCached(a,f=!1){return!!this.getTextureData(a.dataId,f)}dispose(){this.session.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach(a=>this.session.textureManager.releaseTexture(a)),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach(a=>this.session.textureManager.releaseTexture(a)),this.unpackedTextureDataCache=new Map}readTexture(a){return a.isPacked?this.readTexture(this.unpack(a)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTexture(a,a.tensor.type,a.channels):this.session.textureManager.readUint8TextureAsFloat((0,u.encodeAsUint8)(this,a))}async readTextureAsync(a){return a.isPacked?this.readTextureAsync(this.unpack(a)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTextureAsync(a,a.tensor.type,a.channels):this.session.textureManager.readUint8TextureAsFloat((0,u.encodeAsUint8)(this,a))}pack(a){return this.executeProgram((0,o.createPackProgramInfoLoader)(this,a.tensor),[a.tensor])}unpack(a){return this.executeProgram((0,h.createUnpackProgramInfoLoader)(this,a.tensor),[a.tensor])}}},1640:function(s,e,t){"use strict";var n=this&&this.__createBinding||(Object.create?function(Z,le,ae,be){be===void 0&&(be=ae);var Ce=Object.getOwnPropertyDescriptor(le,ae);Ce&&!("get"in Ce?!le.__esModule:Ce.writable||Ce.configurable)||(Ce={enumerable:!0,get:function(){return le[ae]}}),Object.defineProperty(Z,be,Ce)}:function(Z,le,ae,be){be===void 0&&(be=ae),Z[be]=le[ae]}),i=this&&this.__setModuleDefault||(Object.create?function(Z,le){Object.defineProperty(Z,"default",{enumerable:!0,value:le})}:function(Z,le){Z.default=le}),r=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var le={};if(Z!=null)for(var ae in Z)ae!=="default"&&Object.prototype.hasOwnProperty.call(Z,ae)&&n(le,Z,ae);return i(le,Z),le};Object.defineProperty(e,"__esModule",{value:!0}),e.WEBGL_OP_RESOLVE_RULES=void 0;let o=t(2898),l=r(t(7839)),u=t(4196),h=t(2069),d=t(8138),c=t(9663),a=t(5193),f=t(7992),p=t(1253),g=t(4776),m=t(6572),y=t(3346),_=t(5623),x=t(2870),E=t(2143),S=t(4939),T=t(718),C=t(2268),I=t(8117),A=t(2278),P=t(5524),F=t(5975),H=t(3933),z=t(6558),B=t(5723),V=t(3738),M=r(t(4909)),$=t(8428),oe=t(9793);e.WEBGL_OP_RESOLVE_RULES=[["Abs","","6+",M.abs],["Acos","","7+",M.acos],["Add","","7+",l.add],["And","","7+",l.and],["Asin","","7+",M.asin],["Atan","","7+",M.atan],["AveragePool","","7+",E.averagePool,E.parseAveragePoolAttributes],["BatchNormalization","","7+",o.batchNormalization,o.parseBatchNormalizationAttributes],["Cast","","6+",u.cast,u.parseCastAttributes],["Ceil","","6+",M.ceil],["Clip","","6-10",M.clip,M.parseClipAttributes],["Clip","","11+",M.clipV11],["Concat","","4+",h.concat,h.parseConcatAttributes],["Conv","","1+",d.conv,d.parseConvAttributes],["ConvTranspose","","1+",c.convTranspose,c.parseConvTransposeAttributes],["Cos","","7+",M.cos],["Div","","7+",l.div],["Dropout","","7+",M.identity],["DepthToSpace","","1+",a.depthToSpace,a.parseDepthToSpaceAttributes],["Equal","","7+",l.equal],["Elu","","6+",M.elu,M.parseEluAttributes],["Exp","","6+",M.exp],["Flatten","","1+",f.flatten,f.parseFlattenAttributes],["Floor","","6+",M.floor],["FusedConv","com.microsoft","1+",d.conv,d.parseConvAttributes],["Gather","","1+",p.gather,p.parseGatherAttributes],["Gemm","","7-10",g.gemm,g.parseGemmAttributesV7],["Gemm","","11+",g.gemm,g.parseGemmAttributesV11],["GlobalAveragePool","","1+",E.globalAveragePool,E.parseGlobalAveragePoolAttributes],["GlobalMaxPool","","1+",E.globalMaxPool],["Greater","","7+",l.greater],["Identity","","1+",M.identity],["ImageScaler","","1+",m.imageScaler,m.parseImageScalerAttributes],["InstanceNormalization","","6+",y.instanceNormalization,y.parseInstanceNormalizationAttributes],["LeakyRelu","","6+",M.leakyRelu,M.parseLeakyReluAttributes],["Less","","7+",l.less],["Log","","6+",M.log],["MatMul","","1+",_.matMul,_.parseMatMulAttributes],["MaxPool","","1+",E.maxPool,E.parseMaxPoolAttributes],["Mul","","7+",l.mul],["Neg","","6+",M.neg],["Not","","1+",M.not],["Or","","7+",l.or],["Pad","","2-10",x.padV2,x.parsePadAttributesV2],["Pad","","11+",x.padV11,x.parsePadAttributesV11],["Pow","","7+",l.pow],["PRelu","","7+",l.pRelu],["ReduceLogSum","","1+",S.reduceLogSum,S.parseReduceAttributes],["ReduceMax","","1+",S.reduceMax,S.parseReduceAttributes],["ReduceMean","","1+",S.reduceMean,S.parseReduceAttributes],["ReduceMin","","1+",S.reduceMin,S.parseReduceAttributes],["ReduceProd","","1+",S.reduceProd,S.parseReduceAttributes],["ReduceSum","","1-12",S.reduceSum,S.parseReduceAttributes],["ReduceSumSquare","","1+",S.reduceLogSumSquare,S.parseReduceAttributes],["Relu","","6+",M.relu],["Reshape","","5+",T.reshape],["Resize","","10",C.resize,C.parseResizeAttributesV10],["Resize","","11+",C.resize,C.parseResizeAttributesV11],["Shape","","1+",I.shape],["Sigmoid","","6+",M.sigmoid],["Sin","","7+",M.sin],["Slice","","10+",A.sliceV10],["Slice","","1-9",A.slice,A.parseSliceAttributes],["Softmax","","1-12",P.softmax,P.parseSoftmaxAttributes],["Softmax","","13+",P.softmaxV13,P.parseSoftmaxAttributesV13],["Split","","2-12",F.split,F.parseSplitAttributes],["Sqrt","","6+",M.sqrt],["Squeeze","","1-12",H.squeeze,H.parseSqueezeAttributes],["Squeeze","","13+",H.squeezeV13],["Sub","","7+",l.sub],["Sum","","6+",z.sum],["Tan","","7+",M.tan],["Tanh","","6+",M.tanh],["Tile","","6+",B.tile],["Transpose","","1+",V.transpose,V.parseTransposeAttributes],["Upsample","","7-8",oe.upsample,oe.parseUpsampleAttributesV7],["Upsample","","9",oe.upsample,oe.parseUpsampleAttributesV9],["Unsqueeze","","1-12",$.unsqueeze,$.parseUnsqueezeAttributes],["Unsqueeze","","13+",$.unsqueezeV13],["Xor","","7+",l.xor]]},2898:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseBatchNormalizationAttributes=e.batchNormalization=void 0;let n=t(246),i=t(5060),r=t(2039),o={name:"BatchNormalization",inputNames:["A","Scale","B","Mean","Variance"],inputTypes:[r.TextureType.unpacked,r.TextureType.unpacked,r.TextureType.unpacked,r.TextureType.unpacked,r.TextureType.unpacked]};e.batchNormalization=(h,d,c)=>(u(d),[h.run(Object.assign(Object.assign({},o),{cacheHint:c.cacheKey,get:()=>l(h,d,c)}),d)]),e.parseBatchNormalizationAttributes=h=>{let d=h.attributes.getFloat("epsilon",1e-5),c=h.attributes.getFloat("momentum",.9),a=h.attributes.getInt("spatial",1);return(0,n.createAttributeWithCacheKey)({epsilon:d,momentum:c,spatial:a})};let l=(h,d,c)=>{let a=(0,i.getGlsl)(h.session.backend.glContext.version),f=d[0].dims.length,[p,g]=h.calculateTextureWidthAndHeight(d[1].dims,r.TextureType.unpacked),m=`
  float process(int[${f}] indices) {
    vec2 position = offsetToCoords(indices[1], ${p}, ${g});
    float scale = getColorAsFloat(${a.texture2D}(Scale, position));
    float mean = getColorAsFloat(${a.texture2D}(Mean, position));
    float variance = getColorAsFloat(${a.texture2D}(Variance, position));
    float b = getColorAsFloat(${a.texture2D}(B, position));

    return scale * ( (_A(indices) - mean) / sqrt(variance + float(${c.epsilon})) ) + b;
  }`;return Object.assign(Object.assign({},o),{output:{dims:d[0].dims,type:d[0].type,textureType:r.TextureType.unpacked},shaderSource:m})},u=h=>{if(!h||h.length!==5)throw new Error("BatchNormalization requires 5 inputs.");let d=h[0],c=h[1],a=h[2],f=h[3],p=h[4];if(d.dims.length<3||c.dims.length!==1||a.dims.length!==1||f.dims.length!==1||p.dims.length!==1)throw new Error("invalid input shape.");if(c.dims[0]!==d.dims[1]||a.dims[0]!==d.dims[1]||f.dims[0]!==d.dims[1]||p.dims[0]!==d.dims[1])throw new Error("invalid input shape.");if(d.type!=="float32"&&d.type!=="float64"||c.type!=="float32"&&c.type!=="float64"||a.type!=="float32"&&a.type!=="float64"||f.type!=="float32"&&f.type!=="float64"||p.type!=="float32"&&p.type!=="float64")throw new Error("invalid input tensor types.")}},7839:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.xor=e.sub=e.pRelu=e.pow=e.or=e.mul=e.less=e.greater=e.equal=e.div=e.and=e.add=e.glslPRelu=e.glslPow=e.glslXor=e.glslOr=e.glslAnd=e.glslLess=e.glslGreater=e.glslEqual=e.glslSub=e.glslMul=e.glslDiv=e.glslAdd=void 0;let n=t(2517),i=t(8520),r=t(5060),o=t(2039);function l(){let S="add_";return{body:`
  float ${S}(float a, float b) {
    return a + b;
  }
  vec4 ${S}(vec4 v1, vec4 v2) {
    return v1 + v2;
  }
  `,name:S,type:i.FunctionType.ValueBased}}function u(){let S="div_";return{body:`
  float ${S}(float a, float b) {
    return a / b;
  }
  vec4 ${S}(vec4 v1, vec4 v2) {
    return v1 / v2;
  }
  `,name:S,type:i.FunctionType.ValueBased}}function h(){let S="mul_";return{body:`
  float ${S}(float a, float b) {
    return a * b;
  }
  vec4 ${S}(vec4 v1, vec4 v2) {
    return v1 * v2;
  }
  `,name:S,type:i.FunctionType.ValueBased}}function d(){let S="sub_";return{body:`
  float ${S}(float a, float b) {
    return a - b;
  }
  vec4 ${S}(vec4 v1, vec4 v2) {
    return v1 - v2;
  }
  `,name:S,type:i.FunctionType.ValueBased}}function c(){let S="equal_";return{body:`
  float ${S}(float a, float b) {
    return float(a == b);
  }
  vec4 ${S}(vec4 v1, vec4 v2) {
    return vec4(equal(v1, v2));
  }
  `,name:S,type:i.FunctionType.ValueBased}}function a(){let S="greater_";return{body:`
  float ${S}(float a, float b) {
    return float(a > b);
  }
  vec4 ${S}(vec4 v1, vec4 v2) {
    return vec4( v1.r > v2.r ,
      v1.g > v2.g,
      v1.b > v2.b,
      v1.a > v2.a );
  }
  `,name:S,type:i.FunctionType.ValueBased}}function f(){let S="less_";return{body:`
  float ${S}(float a, float b) {
    return float(a < b);
  }
  vec4 ${S}(vec4 v1, vec4 v2) {
    return vec4( v1.r < v2.r ,
                v1.g < v2.g,
                v1.b < v2.b,
                v1.a < v2.a );
  }
  `,name:S,type:i.FunctionType.ValueBased}}function p(){let S="and_";return{body:`
  float ${S}(float a, float b) {
    return float( bool(a) && bool(b) );
  }
  vec4 ${S}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r && b2.r ,
                b1.g && b2.g,
                b1.b && b2.b,
                b1.a && b2.a );
  }
  `,name:S,type:i.FunctionType.ValueBased}}function g(){let S="or_";return{body:`
  float ${S}(float a, float b) {
    return float( bool(a) || bool(b) );
  }
  vec4 ${S}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r || b2.r ,
                b1.g || b2.g,
                b1.b || b2.b,
                b1.a || b2.a );
  }
  `,name:S,type:i.FunctionType.ValueBased}}function m(){let S="xor_";return{body:`
  float ${S}(float a, float b) {
    return float( bool(a) ^^ bool(b) );
  }
  vec4 ${S}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r ^^ b2.r ,
                b1.g ^^ b2.g,
                b1.b ^^ b2.b,
                b1.a ^^ b2.a );
  }
  `,name:S,type:i.FunctionType.ValueBased}}function y(){return function(S){let T=`${S}_`;return{body:`
  float ${T}(float a, float b) {
    return ${S}(a, b);
  }
  vec4 ${T}(vec4 v1, vec4 v2) {
    return ${S}(v1, v2);
  }
  `,name:T,type:i.FunctionType.ValueBased}}("pow")}function _(){let S="prelu_";return{body:`
  float ${S}(float a, float b) {
    return a < 0.0 ? a * b: a;
  }
  vec4 ${S}(vec4 v1, vec4 v2) {
    return vec4(
      v1.r < 0.0 ? v1.r * v2.r: v1.r,
      v1.g < 0.0 ? v1.g * v2.g: v1.g,
      v1.b < 0.0 ? v1.b * v2.b: v1.b,
      v1.a < 0.0 ? v1.a * v2.a: v1.a
      );
  }
  `,name:S,type:i.FunctionType.ValueBased}}e.glslAdd=l,e.glslDiv=u,e.glslMul=h,e.glslSub=d,e.glslEqual=c,e.glslGreater=a,e.glslLess=f,e.glslAnd=p,e.glslOr=g,e.glslXor=m,e.glslPow=y,e.glslPRelu=_;let x=(S,T,C,I=T[0].type,A)=>{let P=S.session.pack?o.TextureType.packed:o.TextureType.unpacked;return{name:C.name,inputNames:["A","B"],inputTypes:[P,P],cacheHint:A,get:()=>E(S,T,C,I)}},E=(S,T,C,I=T[0].type)=>{let A=S.session.pack?o.TextureType.packed:o.TextureType.unpacked,P=!n.ShapeUtil.areEqual(T[0].dims,T[1].dims),F=T[0].dims,H=S.session.pack;if(P){let V=n.BroadcastUtil.calcShape(T[0].dims,T[1].dims,!1);if(!V)throw new Error("Can't perform binary op on the given tensors");F=V;let M=F.length,$=T[0].dims.length!==0?T[0].dims.length:1,oe=T[1].dims.length!==0?T[1].dims.length:1,Z=T[0].dims.length!==0?"bcastIndices_A(indices, aindices);":"aindices[0] = 0;",le=T[1].dims.length!==0?"bcastIndices_B(indices, bindices);":"bindices[0] = 0;",ae=(0,r.getGlsl)(S.session.backend.glContext.version),be=H?`
      ${C.body}
      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();
        vec4 result = ${C.name}(a, b);
        ${ae.output} = result;
      }`:`
      ${C.body}
      float process(int indices[${M}]) {
        int aindices[${$}];
        int bindices[${oe}];
        ${Z}
        ${le}
        return ${C.name}(_A(aindices), _B(bindices));
      }`;return{name:C.name,inputNames:["A","B"],inputTypes:[A,A],output:{dims:F,type:I,textureType:A},shaderSource:be,hasMain:H}}let z=(0,r.getGlsl)(S.session.backend.glContext.version),B=`
    ${C.body}
    void main() {
      vec4 v1 = ${z.texture2D}(A, TexCoords);
      vec4 v2 = ${z.texture2D}(B, TexCoords);
      vec4 result = ${C.name}(v1, v2);
      ${z.output} = result;
    }
    `;return{name:C.name,inputNames:["A","B"],inputTypes:[A,A],output:{dims:T[0].dims,type:I,textureType:A},shaderSource:B,hasMain:!0}};e.add=(S,T)=>[S.run(x(S,T,l()),T)],e.and=(S,T)=>[S.run(x(S,T,p(),"bool"),T)],e.div=(S,T)=>[S.run(x(S,T,u()),T)],e.equal=(S,T)=>[S.run(x(S,T,c(),"bool"),T)],e.greater=(S,T)=>[S.run(x(S,T,a(),"bool"),T)],e.less=(S,T)=>[S.run(x(S,T,f(),"bool"),T)],e.mul=(S,T)=>[S.run(x(S,T,h()),T)],e.or=(S,T)=>[S.run(x(S,T,g(),"bool"),T)],e.pow=(S,T)=>[S.run(x(S,T,y()),T)],e.pRelu=(S,T)=>[S.run(x(S,T,_()),T)],e.sub=(S,T)=>[S.run(x(S,T,d()),T)],e.xor=(S,T)=>[S.run(x(S,T,m(),"bool"),T)]},4196:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseCastAttributes=e.cast=void 0;let n=t(2517);e.cast=(r,o,l)=>(i(o),[r.cast(o[0],l)]),e.parseCastAttributes=r=>n.ProtoUtil.tensorDataTypeFromProto(r.attributes.getInt("to"));let i=r=>{if(!r||r.length!==1)throw new Error("Cast requires 1 input.");if(r[0].type==="string")throw new Error("Invalid input type.")}},1163:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createPackedConcatProgramInfoLoader=void 0;let n=t(5060),i=t(2039),r=t(9390),o=t(2827);e.createPackedConcatProgramInfoLoader=(u,h,d)=>{let c=(a=h.length,f=d.cacheKey,{name:"Concat (packed)",inputNames:Array.from({length:a},(p,g)=>`X${g}`),inputTypes:Array(a).fill(i.TextureType.packed),cacheHint:f});var a,f;return Object.assign(Object.assign({},c),{get:()=>((p,g,m,y)=>{let _=m[0].dims.slice();if(y>=_.length||y<-1*_.length)throw new Error("axis specified for concat doesn't match input dimensionality");y<0&&(y=_.length+y);let x=_.slice(0);for(let Z=1;Z<m.length;Z++){let le=m[Z].dims.slice();for(let ae=0;ae<_.length;ae++)if(ae===y)x[y]+=le[ae];else if(_[ae]!==le[ae])throw new Error("non concat dimensions must match")}let E=x.length,S=(0,o.getChannels)("coords",E),T=(0,r.getCoordsDataType)(E),C=(0,o.unpackFromChannel)(),I=m.map(Z=>Z.dims),A=(0,r.getGlChannels)(E),P=new Array(I.length-1);P[0]=I[0][y];for(let Z=1;Z<P.length;Z++)P[Z]=P[Z-1]+I[Z][y];let F=A[y],H=A.slice(-2),z=A.join(),B=`if (${F} < ${P[0]}) {
        return getChannel(
            getX0(${z}), vec2(${H.join()}));
        }`;for(let Z=1;Z<P.length;Z++){let le=P[Z-1];B+=`
            if (${F} < ${P[Z]}  && ${F} >= ${P[Z-1]}) {
              return getChannel(
                getX${Z}(${l(A,F,le)}),
                vec2(${l(H,F,le)}));
            }`}let V=P.length,M=P[P.length-1];B+=`
            return getChannel(
              getX${V}(${l(A,F,M)}),
              vec2(${l(H,F,M)}));`;let $=(0,n.getGlsl)(p.session.backend.glContext.version),oe=`
          ${C}
          float getValue(${A.map(Z=>"int "+Z)}) {
            ${B}
          }

          void main() {
            ${T} coords = getOutputCoords();
            int lastDim = coords.${A[E-1]};
            coords.${A[E-1]} = coords.${A[E-2]};
            coords.${A[E-2]} = lastDim;

            vec4 result = vec4(getValue(${S}), 0., 0., 0.);

            ${S[E-1]} = ${S[E-1]} + 1;
            if (${S[E-1]} < ${x[E-1]}) {
              result.g = getValue(${S});
            }

            ${S[E-2]} = ${S[E-2]} + 1;
            if (${S[E-2]} < ${x[E-2]}) {
              result.a = getValue(${S});
            }

            ${S[E-1]} = ${S[E-1]} - 1;
            if (${S[E-2]} < ${x[E-2]} &&
                ${S[E-1]} < ${x[E-1]}) {
              result.b = getValue(${S});
            }
            ${$.output} = result;
          }
        `;return Object.assign(Object.assign({},g),{output:{dims:x,type:m[0].type,textureType:i.TextureType.packed},shaderSource:oe,hasMain:!0})})(u,c,h,d.axis)})};let l=(u,h,d)=>{let c=u.indexOf(h);return u.map((a,f)=>f===c?`${a} - ${d}`:a).join()}},2069:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseConcatAttributes=e.concat=void 0;let n=t(246),i=t(2039),r=t(1163);e.concat=(a,f,p)=>(c(f),a.session.pack&&f[0].dims.length>1?[a.run((0,r.createPackedConcatProgramInfoLoader)(a,f,p),f)]:[a.run(o(a,f,p),f)]);let o=(a,f,p)=>{let g=(m=f.length,y=p.cacheKey,{name:"Concat",inputNames:Array.from({length:m},(_,x)=>`X${x}`),inputTypes:Array(m).fill(i.TextureType.unpacked),cacheHint:y});var m,y;return Object.assign(Object.assign({},g),{get:()=>((_,x,E,S)=>{let T=E[0].dims.slice();if(S>=T.length||S<-1*T.length)throw new Error("axis specified for concat doesn't match input dimensionality");S<0&&(S=T.length+S);let C=T.slice(0);for(let z=1;z<E.length;z++){let B=E[z].dims.slice();for(let V=0;V<T.length;V++)if(V===S)C[S]+=B[V];else if(T[V]!==B[V])throw new Error("non concat dimensions must match")}let I=C.length,A=new Array(E.length),P=0;for(let z=0;z<A.length;++z)P+=E[z].dims[S],A[z]=P;let F="";F=E.length<5?l(A):u(A);let H=`
        ${h(E.length,I)}
        ${d(A)}
        ${F}
        float process(int indices[${I}]) {
          int textureIndex = getTextureWhereDataResides (indices[${S}]);

          if(textureIndex != 0) {
            indices[${S}] = indices[${S}] - int(getSizeInConcatAxisValueFromIndex(textureIndex-int(1)));
          }

          return fetchDataFromCorrectTexture(textureIndex, indices);
        }`;return Object.assign(Object.assign({},x),{output:{dims:C,type:E[0].type,textureType:i.TextureType.unpacked},shaderSource:H})})(0,g,f,p.axis)})},l=a=>`int getTextureWhereDataResides(int index) {
      ${a.map((f,p)=>`if(index<${f}) {return ${p};}
`).join("")}
    }`,u=a=>l(a),h=(a,f)=>{let p=[`float fetchDataFromCorrectTexture(int textureIndex, int indices[${f}]) {`];for(let g=0;g<a;++g)g===0?p.push(`	if (textureIndex == ${g}) { return _X${g}(indices); }`):g===a-1?p.push(`	else { return _X${g}(indices); }`):p.push(`	else if (textureIndex == ${g}) { return _X${g}(indices); }`);return p.push("	}"),p.join(`
`)},d=a=>{let f=["int getSizeInConcatAxisValueFromIndex(int index) {"];for(let p=0;p<a.length;++p)p===0?f.push(`	if (index == ${p}) { return ${a[p]}; }`):p===a.length-1?f.push(`	else { return ${a[p]}; }`):f.push(`	else if (index == ${p}) { return ${a[p]}; }`);return f.push("	}"),f.join(`
`)};e.parseConcatAttributes=a=>(0,n.createAttributeWithCacheKey)({axis:a.attributes.getInt("axis")});let c=a=>{if(!a||a.length<1)throw new Error("too few inputs");let f=a[0].type,p=a[0].dims.length;if(f==="string")throw new Error("string tensor is not supported yet");for(let g of a){if(g.type!==f)throw new Error("input tensors should be one type");if(g.dims.length!==p)throw new Error("input tensors should have the same shape")}}},4770:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createUnpackedGroupedConvProgramInfoLoader=void 0;let n=t(6231),i=t(5060),r=t(2039),o=t(8138),l=t(2823);e.createUnpackedGroupedConvProgramInfoLoader=(u,h,d)=>{let c=(a=h.length>2,f=d.cacheKey,{name:"GroupedConv",inputNames:a?["X","W","Bias"]:["X","W"],inputTypes:a?[r.TextureType.unpacked,r.TextureType.unpacked,r.TextureType.unpacked]:[r.TextureType.unpacked,r.TextureType.unpacked],cacheHint:f});var a,f;return Object.assign(Object.assign({},c),{get:()=>((p,g,m,y)=>{let _=g.length>2?"value += getBias(output_channel);":"",x=g[0].dims.slice(),E=g[1].dims.slice(),S=E[0]/y.group;n.Logger.verbose("GroupedConv",`autpPad:${y.autoPad}, dilations:${y.dilations}, group:${y.group}, kernelShape:${y.kernelShape}, pads:${y.pads}, strides:${y.strides}`);let T=(0,o.calculateOutputShape)(x,E,y.dilations,y.pads,y.strides),C=(0,i.getGlsl)(p.session.backend.glContext.version),{activationFunction:I,applyActivation:A}=(0,l.getActivationSnippet)(y),P=`
  const ivec2 strides = ivec2(${y.strides[0]}, ${y.strides[1]});
  const ivec2 pads = ivec2(${y.pads[0]}, ${y.pads[1]});
  ${I}
  void main() {
    ivec4 coords = getOutputCoords();
    int batch = coords.x;
    int output_channel = coords.y;
    ivec2 xRCCorner = coords.zw * strides - pads;
    int group_id = output_channel / ${S};

    float value = 0.0;
    for (int wInChannel = 0; wInChannel < ${E[1]}; wInChannel++) {
      int input_channel = group_id * ${E[1]} + wInChannel;
      for (int wHeight = 0; wHeight < ${E[2]}; wHeight++) {
        int xHeight = xRCCorner.x + wHeight * ${y.dilations[0]};

        if (xHeight < 0 || xHeight >= ${x[2]}) {
          continue;
        }

        for (int wWidth = 0; wWidth < ${E[3]}; wWidth++) {
          int xWidth = xRCCorner.y + wWidth * ${y.dilations[1]};
          if (xWidth < 0 || xWidth >= ${x[3]}) {
            continue;
          }

          float xVal = getX(batch, input_channel, xWidth, xHeight);
          float wVal = getW(output_channel, wInChannel, wWidth, wHeight);
          value += xVal*wVal;
        }
      }
    }
    ${_}
    ${A}
    ${C.output} = vec4(value, .0, .0, .0);
  }
`;return Object.assign(Object.assign({},m),{output:{dims:T,type:g[0].type,textureType:r.TextureType.unpacked},shaderSource:P,hasMain:!0})})(u,h,c,d)})}},1386:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.conv2DPacked=e.conv2DPackedPointwise=void 0;let n=t(8138),i=t(8555),r=t(708);e.conv2DPackedPointwise=(o,l,u)=>{let h=l[0].dims,d=l[1].dims,c=(0,n.calculateOutputShape)(h,d,u.dilations,u.pads,u.strides),a=o.reshapePacked(l[0],[h[1],h[2]*h[3]]),f=o.reshapePacked(l[1],[d[0],d[1]]),p=l.length>2?[f,a,l[2]]:[f,a],g=o.run((0,r.createPackedMatmulProgramInfoLoader)(o,p,u),p);return o.reshapePacked(g,c)},e.conv2DPacked=(o,l,u)=>{let h=l[0].dims,d=l[1].dims,c=(0,n.calculateOutputShape)(h,d,u.dilations,u.pads,u.strides),a=o.run((0,i.createPackedIm2ColProgramInfoLoader)(o,l[0],l[1],c,u),[l[0]]),f=o.reshapePacked(l[1],[d[0],d[1]*d[2]*d[3]]),p=l.length===3?[f,a,l[2]]:[f,a],g=o.run((0,r.createPackedMatmulProgramInfoLoader)(o,p,u),p);return o.reshapePacked(g,c)}},9663:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseConvTransposeAttributes=e.convTranspose=void 0;let n=t(246),i=t(5060),r=t(2039),o=t(2823),l=(f,p,g,m,y,_)=>(f-1)*p+g+(m-1)*y+1-_,u=(f,p,g,m,y)=>{let _=Math.floor(f/2);p==="SAME_UPPER"?(g[m]=_,g[y]=f-_):p==="SAME_LOWER"&&(g[m]=f-_,g[y]=_)};e.convTranspose=(f,p,g)=>(a(p,g),h(f,p,g));let h=(f,p,g)=>{let m=c(g,p);return[d(f,p,m)]},d=(f,p,g)=>f.run(((m,y,_)=>{let x=(E=y.length>2,S=_.cacheKey,{name:"ConvTranspose",inputNames:E?["X","W","B"]:["X","W"],inputTypes:E?[r.TextureType.unpacked,r.TextureType.unpacked,r.TextureType.unpacked]:[r.TextureType.unpacked,r.TextureType.unpacked],cacheHint:S});var E,S;return Object.assign(Object.assign({},x),{get:()=>((T,C,I,A)=>{let P=C.length>2?"getB(output_channel)":"0.0",F=C[0].dims,H=C[1].dims,z=H[1],B=H[0]/A.group,V=[C[0].dims[0],C[1].dims[1]*A.group,...A.outputShape],M=(0,i.getGlsl)(T.session.backend.glContext.version),{activationFunction:$,applyActivation:oe}=(0,o.getActivationSnippet)(A),Z=`
  const ivec2 strides = ivec2(${A.strides[0]}, ${A.strides[1]});
  const ivec2 pads = ivec2(${A.pads[0]}, ${A.pads[1]});
  ${$}
  void main() {
    ivec4 coords = getOutputCoords();
    int batch = coords.x;
    int output_channel = coords.y;

    ivec2 loc = coords.zw + pads;

    int group_id = output_channel / ${z};
    int wOutChannel = output_channel - group_id * ${z};

    float value = ${P};
    for (int inChannelOffset = 0; inChannelOffset < ${B}; inChannelOffset++) {
      int input_channel = group_id * ${B} + inChannelOffset;
      for (int wWOff = 0; wWOff < ${H[2]}; wWOff++) {
        for (int wHOff = 0; wHOff < ${H[3]}; wHOff++) {
          ivec2 wOff = ivec2(wWOff * ${A.dilations[0]}, wHOff * ${A.dilations[1]});
          ivec2 wLoc = loc - wOff;
          ivec2 wLocIn = wLoc / strides;
          if (
            wLocIn * strides == wLoc &&
            wLocIn.x >= 0 && wLocIn.x < ${F[2]} &&
            wLocIn.y >= 0 && wLocIn.y < ${F[3]}
          ) {
            float xVal = getX(batch, input_channel, wLocIn.y, wLocIn.x);
            float wVal = getW(input_channel, wOutChannel, wHOff, wWOff);
            value += xVal * wVal;
          }
        }
      }
    }
    ${oe}
    ${M.output} = vec4(value, .0, .0, .0);
  }
`;return Object.assign(Object.assign({},I),{output:{dims:V,type:C[0].type,textureType:r.TextureType.unpacked},shaderSource:Z,hasMain:!0})})(m,y,x,_)})})(f,p,g),p),c=(f,p)=>{let g=f.kernelShape.slice();if(f.kernelShape.length===0)for(let x=2;x<p[1].dims.length;++x)g.push(p[1].dims[x]);let m=f.pads.slice(),y=f.outputShape.slice();((x,E,S,T,C,I,A,P)=>{let F=x.length-2,H=P.length===0;for(let z=0;z<F;++z){let B=H?x[z+2]*I[z]:P[z],V=l(x[z+2],I[z],C[z],E[z],S[z],B);u(V,T,C,z,z+F),H&&P.push(I[z]*(x[z+2]-1)+A[z]+(E[z]-1)*S[z]+1-C[z]-C[z+F])}})(p[0].dims,g,f.dilations,f.autoPad,m,f.strides,f.outputPadding,y);let _=Object.assign({},f);return Object.assign(_,{kernelShape:g,pads:m,outputShape:y,cacheKey:f.cacheKey}),_};e.parseConvTransposeAttributes=f=>{let p=f.attributes,g=(0,o.parseInternalActivationAttributes)(p),m=p.getString("auto_pad","NOTSET"),y=p.getInts("dilations",[1,1]),_=p.getInt("group",1),x=p.getInts("kernel_shape",[]),E=p.getInts("output_padding",[0,0]),S=p.getInts("output_shape",[]),T=p.getInts("pads",[0,0,0,0]),C=p.getInts("strides",[1,1]);return(0,n.createAttributeWithCacheKey)(Object.assign({autoPad:m,dilations:y,group:_,kernelShape:x,outputPadding:E,outputShape:S,pads:T,strides:C},g))};let a=(f,p)=>{if(!f||f.length!==2&&f.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(f[0].dims.length!==4||f[1].dims.length!==4)throw new Error("currently only support 2-dimensional conv");if(f[0].dims[1]!==f[1].dims[0])throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let g=f[1].dims[1]*p.group;if(f.length===3&&(f[2].dims.length!==1||f[2].dims[0]!==g))throw new Error("invalid bias");let m=f[0].dims.length-2;if(p.dilations.length!==m)throw new Error(`dilations should be ${m}D`);if(p.strides.length!==m)throw new Error(`strides should be ${m}D`);if(p.pads.length!==2*m)throw new Error(`pads should be ${2*m}D`);if(p.outputPadding.length!==m)throw new Error(`output_padding should be ${m}D`);if(p.kernelShape.length!==0&&p.kernelShape.length!==f[1].dims.length-2)throw new Error("invalid kernel shape");if(p.outputShape.length!==0&&p.outputShape.length!==f[0].dims.length-2)throw new Error("invalid output shape");if(f[0].type!=="float32"||f[1].type!=="float32")throw new Error("ConvTranspose input(X,W) should be float tensor");if(f.length===3&&f[2].type!=="float32")throw new Error("ConvTranspose input(bias) should be float tensor")}},8138:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseConvAttributes=e.conv=e.calculateOutputShape=void 0;let n=t(246),i=t(2517),r=t(4770),o=t(1386),l=t(9828),u=t(2823),h=t(3248),d=t(5623);e.calculateOutputShape=(m,y,_,x,E)=>{let S=m[0],T=m.slice(2),C=T.length,I=y[0],A=y.slice(2).map((F,H)=>F+(F-1)*(_[H]-1)),P=T.map((F,H)=>F+x[H]+x[H+C]).map((F,H)=>Math.floor((F-A[H]+E[H])/E[H]));return[S,I].concat(...P)},e.conv=(m,y,_)=>(g(y,_),c(m,y,_));let c=(m,y,_)=>{let x=p(_,y),E=m.session.pack,S=x.kernelShape[0]===1&&x.kernelShape[1]===1;return x.group>1?[m.run((0,r.createUnpackedGroupedConvProgramInfoLoader)(m,y,x),y)]:S&&E?[a(m,y,x)]:E&&y[0].dims.length===4&&y[0].dims[0]===1&&!S?[(0,o.conv2DPacked)(m,y,x)]:[f(m,y,x)]},a=(m,y,_)=>{let x=y[0].dims,E=y[1].dims,S=(0,e.calculateOutputShape)(x,E,_.dilations,_.pads,_.strides),T=m.reshapeUnpacked(y[0],[x[1],x[2]*x[3]]),C=m.reshapeUnpacked(y[1],[E[0],E[1]]),I=y.length>2?[C,T,y[2]]:[C,T],A=m.run((0,d.createMatmulProgramInfoLoader)(I,_),I);return m.reshapeUnpacked(A,S)},f=(m,y,_)=>{let x=y[0].dims,E=y[1].dims,S=(0,e.calculateOutputShape)(x,E,_.dilations,_.pads,_.strides),T=m.run((0,h.createIm2ColProgramInfoLoader)(m,y[0],y[1],S,_),[y[0]]),C=y.length===3?[T,y[1],y[2]]:[T,y[1]];return m.run((0,l.createDotProductProgramInfoLoader)(m,y,S,_),C)},p=(m,y)=>{let _=m.kernelShape.slice();if(m.kernelShape.length===0)for(let S=2;S<y[1].dims.length;++S)_.push(y[1].dims[S]);let x=m.pads.slice();i.PoolConvUtil.adjustPadsBasedOnAutoPad(y[0].dims,m.strides,m.dilations,_,x,m.autoPad);let E=Object.assign({},m);return Object.assign(E,{kernelShape:_,pads:x,cacheKey:m.cacheKey}),E};e.parseConvAttributes=m=>{let y=m.attributes,_=(0,u.parseInternalActivationAttributes)(y),x=y.getString("auto_pad","NOTSET"),E=y.getInts("dilations",[1,1]),S=y.getInt("group",1),T=y.getInts("kernel_shape",[]),C=y.getInts("pads",[0,0,0,0]),I=y.getInts("strides",[1,1]);return(0,n.createAttributeWithCacheKey)(Object.assign({autoPad:x,dilations:E,group:S,kernelShape:T,pads:C,strides:I},_))};let g=(m,y)=>{if(!m||m.length!==2&&m.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(m[0].dims.length!==4||m[1].dims.length!==4)throw new Error("currently only support 2-dimensional conv");if(m[0].dims[1]!==m[1].dims[1]*y.group)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(m.length===3&&(m[2].dims.length!==1||m[1].dims[0]!==m[2].dims[0]))throw new Error("invalid bias");let _=m[0].dims.length-2;if(y.dilations.length!==_)throw new Error(`dilations should be ${_}D`);if(y.strides.length!==_)throw new Error(`strides should be ${_}D`);if(y.pads.length!==2*_)throw new Error(`pads should be ${2*_}D`);if(y.kernelShape.length!==0&&y.kernelShape.length!==m[1].dims.length-2)throw new Error("invalid kernel shape");if(m[0].type!=="float32"||m[1].type!=="float32")throw new Error("Conv input(X,W) should be float tensor");if(m.length===3&&m[2].type!=="float32")throw new Error("Conv input(bias) should be float tensor")}},5193:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseDepthToSpaceAttributes=e.depthToSpace=void 0;let n=t(3738);e.depthToSpace=(r,o,l)=>{i(o);let u=l.blocksize,h=u*u,d=l.mode==="DCR"?[0,3,4,1,5,2]:[0,1,4,2,5,3],c=l.mode==="DCR"?[o[0].dims[0],u,u,o[0].dims[1]/h,o[0].dims[2],o[0].dims[3]]:[o[0].dims[0],o[0].dims[1]/h,u,u,o[0].dims[2],o[0].dims[3]],a=r.reshapeUnpacked(o[0],c),f={perm:d,cacheKey:`${d}`},[p]=(0,n.transpose)(r,[a],f),g=[o[0].dims[0],o[0].dims[1]/h,o[0].dims[2]*u,o[0].dims[3]*u];return[r.reshapeUnpacked(p,g)]},e.parseDepthToSpaceAttributes=r=>{let o=r.attributes.getInt("blocksize");if(o<1)throw new Error(`blocksize must be >= 1, but got : ${o} for DepthToSpace`);let l=r.attributes.getString("mode","DCR");if(l!=="DCR"&&l!=="CRD")throw new Error(`unrecognized mode: ${l} for DepthToSpace`);return{mode:l,blocksize:o}};let i=r=>{if(r.length!==1)throw new Error(`DepthToSpace expect 1 inputs, but got ${r.length}`);if(r[0].type==="string"||r[0].dims.length!==4)throw new TypeError("DepthToSpace input should be a 4-D numeric tensor")}},9828:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createDotProductProgramInfoLoader=void 0;let n=t(2517),i=t(5060),r=t(2039),o=t(2823),l=t(3248);e.createDotProductProgramInfoLoader=(u,h,d,c)=>{let a=((f,p)=>({name:"ConvDotProduct",inputNames:f?["Im2Col","K","B"]:["Im2Col","K"],inputTypes:f?[r.TextureType.unpacked,r.TextureType.packedLastDimension,r.TextureType.unpacked]:[r.TextureType.unpacked,r.TextureType.packedLastDimension],cacheKey:p.activationCacheKey}))(h.length>2,c);return Object.assign(Object.assign({},a),{get:()=>((f,p,g,m,y)=>{let _=g[0].dims,x=g[1].dims,E=[x[0],Math.ceil(_[1]*x[2]*x[3]/4)],S=(0,l.calculateIm2ColDims)(_,x,m),[T,C]=f.calculateTextureWidthAndHeight(E,r.TextureType.packedLastDimension),I=n.ShapeUtil.computeStrides(S),[A,P]=f.calculateTextureWidthAndHeight(S,r.TextureType.packedLastDimension),F=m.length,H=g.length<3?"0.0":"_B(b)",z=Math.ceil(_[1]*x[2]*x[3]/4),{activationFunction:B,applyActivation:V}=(0,o.getActivationSnippet)(y),M=(0,i.getGlsl)(f.session.backend.glContext.version),$=`
${B}
float process(int indices[${F}]) {
  int b[1];
  b[0] = indices[1];
  int im2col[4];
  im2col[0] = indices[0];
  im2col[1] = indices[2];
  im2col[2] = indices[3];
  int im2colOffset = im2col[0] * ${I[0]} + im2col[1] * ${I[1]} + im2col[2] * ${I[2]};
  int kernelOffset = indices[1] * ${E[1]};
  float value = ${H};
  for (int i = 0; i < ${z}; ++i) {
    vec2 im2colCoords = offsetToCoords(im2colOffset, ${A}, ${P});
    vec2 kernelCoords = offsetToCoords(kernelOffset, ${T}, ${C});
    value += dot(${M.texture2D}(Im2Col, im2colCoords), ${M.texture2D}(K, kernelCoords));
    ++im2colOffset;
    ++kernelOffset;
  }
  ${V}
  return value;
}`;return Object.assign(Object.assign({},p),{output:{dims:m,type:g[0].type,textureType:r.TextureType.unpacked},shaderSource:$})})(u,a,h,d,c)})}},7992:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseFlattenAttributes=e.flatten=void 0;let n=t(2517);e.flatten=(r,o,l)=>{i(o,l);let u=n.ShapeUtil.flattenShape(o[0].dims,l);return[r.reshapeUnpacked(o[0],u)]},e.parseFlattenAttributes=r=>r.attributes.getInt("axis",1);let i=(r,o)=>{if(!r||r.length!==1)throw new Error("Flatten requires 1 input.");let l=r[0].dims.length;if(l===0)throw new Error("scalar tensor is not supported.");if(o<-l||o>l)throw new Error("Invalid axis");if(r[0].type==="string")throw new Error("string tensor is not supported.")}},2823:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseInternalActivationAttributes=e.getActivationSnippet=void 0;let n=t(2517),i=t(4909);e.getActivationSnippet=function(r){let o;switch(r.activation){case"Relu":o=(0,i.glslRelu)();break;case"Sigmoid":o=(0,i.glslSigmoid)();break;case"Clip":o=(0,i.glslClip)(r.clipMin,r.clipMax);break;default:return{activationFunction:"",applyActivation:""}}let l=o.name;return{activationFunction:o.body,applyActivation:`value = ${l}_(value);`}},e.parseInternalActivationAttributes=r=>{let o=r.getString("activation","");if(o==="Clip"){let[l,u]=r.getFloats("activation_params",[n.MIN_CLIP,n.MAX_CLIP]);return{activation:o,clipMax:u,clipMin:l,activationCacheKey:`${o}:${l},${u}`}}return{activation:o,activationCacheKey:o}}},1253:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseGatherAttributes=e.gather=void 0;let n=t(246),i=t(782),r=t(2517),o=t(2039);e.gather=(d,c,a)=>(h(c,a.axis),[d.run(u(d,c,a),c)]),e.parseGatherAttributes=d=>(0,n.createAttributeWithCacheKey)({axis:d.attributes.getInt("axis",0)});let l={name:"Gather",inputNames:["A","B"],inputTypes:[o.TextureType.unpacked,o.TextureType.unpacked]},u=(d,c,a)=>{let f=Object.assign(Object.assign({},l),{cacheHint:a.cacheKey});return Object.assign(Object.assign({},f),{get:()=>((p,g,m,y)=>{let _=m[0].dims.slice(),x=m[1].dims.slice(),E=new Array(_.length+x.length-1);y=r.ShapeUtil.normalizeAxis(y,_.length);let S=[];for(let C=0;C<E.length;C++)C<y?(E[C]=_[C],S.push(`inputIdx[${C}] = outputIdx[${C}];`)):C<y+x.length?(E[C]=x[C-y],S.push(`indexDataIdx[${C-y}] = outputIdx[${C}];`)):(E[C]=_[C-x.length+1],S.push(`inputIdx[${C-x.length+1}] = outputIdx[${C}];`));let T=`
      float process(int outputIdx[${E.length||1}]) {
        int inputIdx[${_.length}];
        int indexDataIdx[${x.length||1}];
        indexDataIdx[0] = 0;
        ${S.join(`
        `)}
        int idx = int(_B(indexDataIdx));
        inputIdx[${y}] = idx < 0 ? idx + ${_[y]} : idx;
        return _A(inputIdx);
      }`;return Object.assign(Object.assign({},g),{output:{dims:E,type:m[0].type,textureType:o.TextureType.unpacked},shaderSource:T})})(0,f,c,a.axis)})},h=(d,c)=>{if(!d||d.length!==2)throw new Error("Gather requires 2 inputs.");let a=d[0].dims.length;if(a<1)throw new Error("Invalid input shape.");if(c<-a||c>a-1)throw new Error("Invalid axis.");if(i.NUMBER_TYPES.indexOf(d[0].type)===-1)throw new Error("Invaid input type.");if(d[1].type!=="int32"&&d[1].type!=="int16")throw new Error("Invaid input type.")}},4776:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseGemmAttributesV11=e.parseGemmAttributesV7=e.gemm=void 0;let n=t(246),i=t(2517),r=t(2039);e.gemm=(d,c,a)=>(h(c,a),[d.run(l(c,a),c)]);let o=(d,c)=>{let a=d.attributes.getInt("transA",0)!==0,f=d.attributes.getInt("transB",0)!==0,p=d.attributes.getFloat("alpha",1),g=d.attributes.getFloat("beta",1);return(0,n.createAttributeWithCacheKey)({transA:a,transB:f,alpha:p,beta:g,isOptionalC:c})};e.parseGemmAttributesV7=d=>o(d,!1),e.parseGemmAttributesV11=d=>o(d,!0);let l=(d,c)=>{let a={name:"Gemm",inputNames:d.length===3?["A","B","C"]:["A","B"],inputTypes:d.length===3?[r.TextureType.unpacked,r.TextureType.unpacked,r.TextureType.unpacked]:[r.TextureType.unpacked,r.TextureType.unpacked],key:c.cacheKey};return Object.assign(Object.assign({},a),{get:()=>u(a,d,c)})},u=(d,c,a)=>{let f=c[0].dims.slice(),p=c[1].dims.slice(),[g,m]=i.GemmUtil.getShapeOfGemmResult(f,a.transA,p,a.transB,c.length===3?c[2].dims:void 0),y=[g,m];if(!y)throw new Error("Can't use gemm on the given tensors");let _=f[f.length-1],x="";a.transA&&(_=f[0]),a.transA&&a.transB?x="value += _A_T(a) * _B_T(b);":a.transA&&!a.transB?x="value += _A_T(a) * _B(b);":!a.transA&&a.transB?x="value += _A(a) * _B_T(b);":a.transA||a.transB||(x="value += _A(a) * _B(b);");let E=y.length,S=`
      float process(int indices[${E}]) {
          int a[${E}];
          int b[${E}];
          ${c.length===3?`int c[${c[2].dims.length}];`:""}

          copyVec(indices, a);
          copyVec(indices, b);
          ${c.length===3?"bcastIndices_C(indices, c);":""}

          float value = 0.0;
          for (int k=0; k<${_}; ++k) {
              a[${E-1}] = k;
              b[${E-2}] = k;
              ${x}
          }

          value = value * alpha;
          ${c.length===3?"value += beta * _C(c);":""}
          return value;
      }`;return Object.assign(Object.assign({},d),{output:{dims:y,type:c[0].type,textureType:r.TextureType.unpacked},variables:[{name:"alpha",type:"float",data:a.alpha},{name:"beta",type:"float",data:a.beta}],shaderSource:S})},h=(d,c)=>{if(!d)throw new Error("Input is missing");if(c.isOptionalC&&(d.length<2||d.length>3))throw new Error("Invaid input shape.");if(!c.isOptionalC&&d.length!==3)throw new Error("Gemm requires 3 inputs");if(d.length===3&&d[2].dims.length!==1&&d[2].dims.length!==2)throw new Error("Invalid input shape of C");if(d[0].type!=="float32"&&d[0].type!=="float64"||d[1].type!=="float32"&&d[1].type!=="float64"||d.length===3&&d[2].type!=="float32"&&d[2].type!=="float64")throw new Error("Invalid input type.");if(d[0].type!==d[1].type||d.length===3&&d[0].type!==d[2].type)throw new Error("Input types are mismatched")}},8555:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createPackedIm2ColProgramInfoLoader=void 0;let n=t(5060),i=t(2039),r=t(2827);e.createPackedIm2ColProgramInfoLoader=(o,l,u,h,d)=>{let c=(a=d.cacheKey,{name:"Im2Col (packed)",inputNames:["A"],inputTypes:[i.TextureType.packed],cacheHint:a});var a;return Object.assign(Object.assign({},c),{get:()=>((f,p,g,m,y,_)=>{let x=g.dims,E=m.dims,S=y.length,T=[E[1]*E[2]*E[3],y[2]*y[3]],C=E[2]*E[3],I=(0,r.unpackFromChannel)(),A=(0,n.getGlsl)(f.session.backend.glContext.version),P="";for(let H=0;H<=1;H++)for(let z=0;z<=1;z++)P+=`
            blockIndex = rc.x + ${z};
            pos = rc.y + ${H};

            if(blockIndex < ${T[1]} && pos < ${T[0]}) {
              offsetY = int(blockIndex / (${y[S-1]})) * ${_.strides[0]} -
                ${_.pads[0]};
              d0 = offsetY + ${_.dilations[0]} * (imod(pos, ${C}) / ${E[2]});

              if(d0 < ${x[2]} && d0 >= 0) {
                offsetX = imod(blockIndex, ${y[S-1]}) * ${_.strides[1]} -
                  ${_.pads[1]};
                d1 = offsetX + ${_.dilations[1]} * imod(imod(pos, ${C}), ${E[2]});

                if(d1 < ${x[3]} && d1 >= 0) {

                  ch = int(float(pos)/ ${C}.);
                    innerDims = vec2(d0, d1);
                    result[${2*H+z}] = getChannel(
                      getA(0, ch, int(innerDims.x),
                      int(innerDims.y)), innerDims);
                }
              }
            }

          `;let F=`
      ${I}

      void main() {
        ivec2 rc = getOutputCoords();
          vec4 result = vec4(0.0);
          int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
          vec2 innerDims;
          ${P}
          ${A.output} = result;
      }
            `;return Object.assign(Object.assign({},p),{output:{dims:T,type:g.type,textureType:i.TextureType.packed},shaderSource:F,hasMain:!0})})(o,c,l,u,h,d)})}},3248:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.calculateIm2ColDims=e.createIm2ColProgramInfoLoader=void 0;let n=t(2039);e.createIm2ColProgramInfoLoader=(i,r,o,l,u)=>{let h=(d=u.cacheKey,{name:"Im2Col",inputNames:["X"],inputTypes:[n.TextureType.unpacked],cacheHint:d});var d;return Object.assign(Object.assign({},h),{get:()=>((c,a,f,p,g,m)=>{let y=f.dims,_=p.dims,x=g.length,E=(0,e.calculateIm2ColDims)(y,_,g,4),S=`
        const int XC = ${y[1]};
        const int XH = ${y[2]};
        const int XW = ${y[3]};
        const int KH = ${m.kernelShape[0]};
        const int KW = ${m.kernelShape[1]};
        const int dilationH = ${m.dilations[0]};
        const int dilationW = ${m.dilations[1]};
        const int strideH = ${m.strides[0]};
        const int strideW = ${m.strides[1]};
        const int padH = ${m.pads[0]};
        const int padW = ${m.pads[1]};
        const int KHKW = KH*KW;
        const int XCKHKW = XC * KHKW;
        const int outputChannels = 4;
        vec4 process(int indices[${x}]) {
          int b  = indices[0]; // batch size
          int oh = indices[1] * strideH - padH; //output height
          int ow = indices[2] * strideW - padW; //output width
          int p = indices[3] * outputChannels; //patch
          vec4 value = vec4(0.0);
          for(int i=0; i < outputChannels; ++i) {
            if(p < XCKHKW) {
              int patchC = p / KHKW;
              int patchH = (p - patchC*KHKW) / KW;
              int patchW = (p - patchC*KHKW) - patchH * KW;
              int xh2 = oh + patchH * dilationH;
              int xw2 = ow + patchW * dilationW;
              int x[${y.length}];
              x[0] = b;
              x[1] = patchC;
              x[2] = xh2;
              x[3] = xw2;
              if(xh2 >= 0 &&
                  xh2 < XH &&
                  xw2 >= 0 &&
                  xw2 < XW) {
                value[i] = _X(x);
              }
            }
            ++p;
          }
          return value;
        }
        `;return Object.assign(Object.assign({},a),{output:{dims:E,type:f.type,textureType:n.TextureType.packedLastDimension},shaderSource:S})})(0,h,r,o,l,u)})},e.calculateIm2ColDims=(i,r,o,l=4)=>[o[0],o[2],o[3],Math.ceil(i[1]*r[2]*r[3]/l)]},6572:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseImageScalerAttributes=e.imageScaler=void 0;let n=t(246),i=t(2039);e.imageScaler=(h,d,c)=>(u(d),[h.run(o(h,d,c),d)]),e.parseImageScalerAttributes=h=>{let d=h.attributes.getFloat("scale"),c=h.attributes.getFloats("bias");return(0,n.createAttributeWithCacheKey)({scale:d,bias:c})};let r={name:"ImageScaler",inputNames:["X"],inputTypes:[i.TextureType.unpacked]},o=(h,d,c)=>{let a=Object.assign(Object.assign({},r),{cacheHint:c.cacheKey});return Object.assign(Object.assign({},a),{get:()=>((f,p,g,m)=>{let y=g[0].dims.slice(),_=y.length,x=`
      ${l(m.bias.length)}
      float process(int indices[${_}]) {
        return _X(indices) * scale + getBias(bias, indices[1]);
      }`;return Object.assign(Object.assign({},p),{output:{dims:y,type:g[0].type,textureType:i.TextureType.unpacked},variables:[{name:"bias",type:"float",arrayLength:m.bias.length,data:m.bias},{name:"scale",type:"float",data:m.scale}],shaderSource:x})})(0,a,d,c)})},l=h=>{let d=[`float getBias(float bias[${h}], int channel) {`];for(let c=0;c<h;++c)c===0?d.push(`	if (channel == ${c}) { return bias[${c}]; }`):c===h-1?d.push(`	else { return bias[${c}]; }`):d.push(`	else if (channel == ${c}) { return bias[${c}]; }`);return d.push("	}"),d.join(`
`)},u=h=>{if(!h||h.length!==1)throw new Error("ImageScaler requires 1 input.");if(h[0].dims.length!==4)throw new Error("Invalid input shape.");if(h[0].type!=="float32"&&h[0].type!=="float64")throw new Error("Invalid input type.")}},3346:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseInstanceNormalizationAttributes=e.instanceNormalization=void 0;let n=t(5060),i=t(2039);e.instanceNormalization=(d,c,a)=>{h(c);let f=d.run(o(c[0]),c);return[d.run(u(d,c[0],a,f.dims),[c[0],f,c[1],c[2]])]},e.parseInstanceNormalizationAttributes=d=>d.attributes.getFloat("epsilon",1e-5);let r={name:"InstanceNormalization_MeanAndVariance",inputNames:["X"],inputTypes:[i.TextureType.unpacked]},o=d=>Object.assign(Object.assign({},r),{get:()=>((c,a)=>{let f=a.dims.slice(),p=f[1],g=f[2]*f[3],m=[f[0],p],y=`
      vec4 process(int[2] indices) {
        vec4 v = vec4(0.0);
        int a[4];
        a[0] = indices[0];
        a[1] = indices[1];
        float temp = 0.0;
        for(int a2=0; a2<${f[2]}; a2++) {
          a[2] = a2;
          for(int a3=0; a3<${f[3]}; a3++) {
            a[3] = a3;
            float x = _X(a);
            temp += x;
          }
        }
        float mean = temp / float(${g});
        temp = 0.0;
        for(int a2=0; a2<${f[2]}; a2++) {
          a[2] = a2;
          for(int a3=0; a3<${f[3]}; a3++) {
            a[3] = a3;
            float x = _X(a);
            temp += (x - mean) * (x - mean);
          }
        }
        v.r = mean;
        v.g = temp / float(${g});

        return v;
      }`;return Object.assign(Object.assign({},c),{output:{dims:m,type:a.type,textureType:i.TextureType.packedLastDimension},shaderSource:y})})(r,d)}),l={name:"InstanceNormalization_ComputeOutput",inputNames:["X","MeanAndVariance","Scale","B"],inputTypes:[i.TextureType.unpacked,i.TextureType.packedLastDimension,i.TextureType.unpacked,i.TextureType.unpacked]},u=(d,c,a,f)=>{let p=Object.assign(Object.assign({},l),{cacheHint:`${a}`});return Object.assign(Object.assign({},p),{get:()=>((g,m,y,_,x)=>{let E=(0,n.getGlsl)(g.session.backend.glContext.version),[S,T]=g.calculateTextureWidthAndHeight(x,i.TextureType.packedLastDimension),[C,I]=[S/4,T],A=`
      vec4 get_MeanAndVariance(int[2] mv) {
        int offset = indicesToOffset_MeanAndVariance(mv);
        vec2 coords = offsetToCoords(offset, ${C}, ${I});
        return ${E.texture2D}(MeanAndVariance, coords);
      }

      float process(int[4] indices) {
        int mv[2];
        mv[0] = indices[0];
        mv[1] = indices[1];
        vec4 mean_and_variance = get_MeanAndVariance(mv);
        float mean = mean_and_variance.r;
        float variance = mean_and_variance.g;

        int sb[1];
        sb[0] = indices[1];
        float scale = _Scale(sb);
        float b = _B(sb);

        return scale * (_X(indices) - mean) / sqrt(variance + epsilon) + b;
      }`;return Object.assign(Object.assign({},m),{output:{dims:y.dims,type:y.type,textureType:i.TextureType.unpacked},variables:[{name:"epsilon",type:"float",data:_}],shaderSource:A})})(d,p,c,a,f)})},h=d=>{if(!d||d.length!==3)throw new Error("InstanceNormalization requires 3 inputs.");let c=d[0],a=d[1],f=d[2];if(c.dims.length<3||a.dims.length!==1||f.dims.length!==1)throw new Error("Invalid input shape.");if(a.dims[0]!==c.dims[1]||f.dims[0]!==c.dims[1])throw new Error("Input shapes are mismatched.");if(c.type!=="float32"&&c.type!=="float64"||a.type!=="float32"&&a.type!=="float64"||f.type!=="float32"&&f.type!=="float64")throw new Error("Invalid input type.");if(d[0].dims.length!==4)throw new Error("Only support 4-D input shape.")}},708:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createPackedMatmulProgramInfoLoader=void 0;let n=t(2517),i=t(5060),r=t(2039),o=t(9390),l=t(2823),u=t(5623);e.createPackedMatmulProgramInfoLoader=(h,d,c)=>{let a=(f=d.length>2,p=c.activationCacheKey,{name:"MatMul (packed)",inputNames:f?["A","B","Bias"]:["A","B"],inputTypes:f?[r.TextureType.packed,r.TextureType.packed,r.TextureType.packed]:[r.TextureType.packed,r.TextureType.packed],cacheHint:p});var f,p;return Object.assign(Object.assign({},a),{get:()=>((g,m,y,_)=>{let x=y.length>2,E=x?"value += getBiasForMatmul();":"",S=y[0].dims,T=y[1].dims,C=n.BroadcastUtil.calcShape(S,T,!0),I=!n.ShapeUtil.areEqual(y[0].dims,y[1].dims);if(!C)throw new Error("Can't use matmul on the given tensors");let A=S[S.length-1],P=Math.ceil(A/2),F=S.length,H=T.length,z=(0,i.getGlsl)(g.session.backend.glContext.version),B=(0,o.getCoordsDataType)(C.length),V=C.length,M=(0,o.getGlChannels)(),{activationFunction:$,applyActivation:oe}=(0,l.getActivationSnippet)(_),Z=x?`${(0,u.getBiasForMatmul)(B,M,y[2].dims,C,!0)}`:"",le=I?`${function(Ze,Ae,Ie,_e){let ht=[],Vt=[],ut=Ie[0].dims,Rt=Ie[1].dims,Yt=ut.length,At=Rt.length,Qe=_e.length,On=Qe-Yt,qn=Qe-At;ht=ut.map((yt,dn)=>`coords.${Ae[dn+On]}`),ht[Yt-1]="i*2",ht.join(", "),Vt=Rt.map((yt,dn)=>`coords.${Ae[dn+qn]}`),Vt[At-2]="i*2",Vt.join(", ");let is=n.BroadcastUtil.getBroadcastDims(ut,_e),xr=n.BroadcastUtil.getBroadcastDims(Rt,_e),Er=is.map(yt=>`coords.${Ae[yt+On]} = 0;`).join(`
`),Vs=xr.map(yt=>`coords.${Ae[yt+qn]} = 0;`).join(`
`),Sr=`int lastDim = coords.${Ae[Qe-1]};
  coords.${Ae[Qe-1]} = coords.${Ae[Qe-2]};
  coords.${Ae[Qe-2]} = lastDim;`;return`
vec4 getAAtOutCoordsMatmul(int i) {
  ${Ze} coords = getOutputCoords();
  ${Sr}
  ${Er}
  vec4 outputValue = getA(${ht});
  return outputValue;
}

vec4 getBAtOutCoordsMatmul(int i) {
  ${Ze} coords = getOutputCoords();
  ${Sr}
  ${Vs}
  vec4 outputValue = getB(${Vt});
  return outputValue;
}`}(B,M,y,C)}`:"",ae=I?"getAAtOutCoordsMatmul(i)":`getA(${function(Ze,Ae){let Ie="";for(let _e=0;_e<Ae-2;_e++)Ie+=`rc.${Ze[_e]}, `;return Ie+=`rc.${Ze[Ae-2]}, i*2`,Ie}(M,F)})`,be=I?"getBAtOutCoordsMatmul(i)":`getB(${function(Ze,Ae){let Ie="";for(let _e=0;_e<Ae-2;_e++)Ie+=`rc.${Ze[_e]}, `;return Ie+=`i*2, rc.${Ze[Ae-1]}`,Ie}(M,H)})`,Ce=`
            ${le}
            ${Z}
            ${$}
            void main() {
              ${I?"":`${B} rc =
          getOutputCoords(); int lastDim = rc.${M[V-1]}; rc.${M[V-1]} =
          rc.${M[V-2]}; rc.${M[V-2]} = lastDim;
      `}

              vec4 value = vec4(0);
              for (int i = 0; i < ${P}; i++) {
                vec4 a = ${ae};
                vec4 b = ${be};

                value += (a.rrbb * b.rgrg);
                value += (a.ggaa * b.baba);
              }
              ${E}
              ${oe}
              ${z.output} = value;
            }`;return Object.assign(Object.assign({},m),{output:{dims:C,type:y[0].type,textureType:r.TextureType.packed},shaderSource:Ce,hasMain:!0})})(h,a,d,c)})}},5623:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getBiasForMatmul=e.createMatmulProgramInfoLoader=e.parseMatMulAttributes=e.matMul=void 0;let n=t(2517),i=t(2039),r=t(9390),o=t(2823),l=t(708);function u(c,a){let f=(p=c.length>2,g=a.activationCacheKey,{name:"MatMul",inputNames:p?["A","B","Bias"]:["A","B"],inputTypes:p?[i.TextureType.unpacked,i.TextureType.unpacked,i.TextureType.unpacked]:[i.TextureType.unpacked,i.TextureType.unpacked],cacheHint:g});var p,g;return Object.assign(Object.assign({},f),{get:()=>function(m,y,_){let x=y[0].dims,E=y[1].dims,S=n.BroadcastUtil.calcShape(x,E,!0);if(!S)throw new Error("Can't use matmul on the given tensors");let T=(0,r.getCoordsDataType)(S.length),C=(0,r.getGlChannels)(),{activationFunction:I,applyActivation:A}=(0,o.getActivationSnippet)(_),P=y.length>2,F=P?"value += getBiasForMatmul();":"",H=P?`${d(T,C,y[2].dims,S,!1)}`:"",z=S.length,B=x.length,V=E.length,M=`
    ${I}
    ${H}
    float process(int indices[${z}]) {
        int a[${B}];
        int b[${V}];
        bcastMatmulIndices_A(indices, a);
        bcastMatmulIndices_B(indices, b);

        float value;
        for (int k=0; k<${x[x.length-1]}; ++k) {
            a[${B-1}] = k;
            b[${V-2}] = k;
            value += _A(a) * _B(b);
        }
        ${F}
        ${A}
        return value;
    }`;return Object.assign(Object.assign({},m),{output:{dims:S,type:y[0].type,textureType:i.TextureType.unpacked},shaderSource:M})}(f,c,a)})}e.matMul=(c,a,f)=>(h(a),c.session.pack?[c.run((0,l.createPackedMatmulProgramInfoLoader)(c,a,f),a)]:[c.run(u(a,f),a)]),e.parseMatMulAttributes=c=>(0,o.parseInternalActivationAttributes)(c.attributes),e.createMatmulProgramInfoLoader=u;let h=c=>{if(!c||c.length!==2)throw new Error("MatMul requires 2 inputs.");if(c[0].dims[c[0].dims.length-1]!==c[1].dims[c[1].dims.length-2])throw new Error("shared dimension does not match.");if(c[0].type!=="float32"&&c[0].type!=="float64"||c[1].type!=="float32"&&c[1].type!=="float64")throw new Error("inputs should be float type");if(c[0].type!==c[1].type)throw new Error("inputs types should match")};function d(c,a,f,p,g){let m="",y=f.length,_=p.length,x=_-y;m=_<2&&y>0?"coords":f.map((T,C)=>`coords.${a[C+x]}`).join(", ");let E=n.BroadcastUtil.getBroadcastDims(f,p).map(T=>`coords.${a[T+x]} = 0;`).join(`
`),S="vec4(outputValue.xx, outputValue.yy)";return n.ShapeUtil.size(f)===1&&(S="vec4(outputValue.x)"),g?`
vec4 getBiasForMatmul() {
  ${c} coords = getOutputCoords();
  ${E}
  vec4 outputValue = getBias(${m});
  return ${S};
}`:`
float getBiasForMatmul() {
  ${c} coords = getOutputCoords();
  ${E}
  return getBias(coords.x);
}`}e.getBiasForMatmul=d},2403:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createPackProgramInfoLoader=void 0;let n=t(5060),i=t(2039),r=t(9390),o=t(2827),l={name:"pack",inputNames:["A"],inputTypes:[i.TextureType.unpackedReversed]};e.createPackProgramInfoLoader=(u,h)=>Object.assign(Object.assign({},l),{get:()=>((d,c)=>{let a=(0,n.getGlsl)(d.session.backend.glContext.version),f=c.dims,p=f.length,g=c.dims.length,m=(0,r.getCoordsDataType)(g),y=(0,o.getChannels)("rc",g),_=(x=g,E=y,S=f[f.length-2],T=f[f.length-1],x===0||x===1?"":`
    int r = ${E[x-2]};
    int c = ${E[x-1]};
    int rp1 = ${E[x-2]} + 1;
    int cp1 = ${E[x-1]} + 1;
    bool rEdge = rp1 >= ${T};
    bool cEdge = cp1 >= ${S};
    `);var x,E,S,T;let C;C=p===0?[1,1]:p===1?[f[0],1]:[f[g-1],f[g-2]];let I=function(F,H,z){if(F===0)return"false";if(F===1)return`rc > ${H[0]}`;let B="";for(let V=F-2;V<F;V++)B+=`${z[V]} >= ${H[V-F+2]}`,V<F-1&&(B+="||");return B}(g,C,y),A=function(F,H){let z=F.length;if(z===0)return"getA(), 0, 0, 0";if(z===1)return`getA(rc),
            rc + 1 >= ${F[0]} ? 0. : getA(rc + 1),
            0, 0`;let B="";if(z>2)for(let V=0;V<z-2;++V)B+=`${H[V]},`;return`getA(${B}r, c),
          rEdge ? 0. : getA(${B}rp1, c),
          cEdge ? 0. : getA(${B}r, cp1),
          rEdge || cEdge ? 0. : getA(${B}rp1, cp1)`}(f,y),P=`
        void main() {
          ${m} rc = getOutputCoords();

          if(${I}) {
            ${a.output} = vec4(0);
          } else {
            ${_}

            ${a.output} = vec4(${A});
          }
        }
      `;return Object.assign(Object.assign({},l),{hasMain:!0,output:{dims:c.dims,type:c.type,textureType:i.TextureType.packed},shaderSource:P})})(u,h)})},2827:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unpackFromChannel=e.getChannels=e.getVecChannels=void 0;let n=t(9390);function i(r,o){return(0,n.getGlChannels)(o).map(l=>`${r}.${l}`)}e.getVecChannels=i,e.getChannels=function(r,o){return o===1?[r]:i(r,o)},e.unpackFromChannel=function(){return`
    float getChannel(vec4 frag, int dim) {
      int modCoord = imod(dim, 2);
      return modCoord == 0 ? frag.r : frag.g;
    }

    float getChannel(vec4 frag, vec2 innerDims) {
      vec2 modCoord = mod(innerDims, 2.);
      return modCoord.x == 0. ?
        (modCoord.y == 0. ? frag.r : frag.g) :
        (modCoord.y == 0. ? frag.b : frag.a);
    }
  `}},2870:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parsePadAttributesV11=e.padV11=e.parsePadAttributesV2=e.padV2=void 0;let n=t(246),i=t(2517),r=t(5060),o=t(2039),l={name:"Pad",inputNames:["A"],inputTypes:[o.TextureType.unpacked]};e.padV2=(m,y,_)=>(d(y),[m.run(Object.assign(Object.assign({},l),{cacheHint:_.cacheKey,get:()=>h(m,y[0],_)}),y)]),e.parsePadAttributesV2=m=>{let y=m.attributes.getString("mode","constant"),_=m.attributes.getFloat("value",0),x=m.attributes.getInts("pads");return(0,n.createAttributeWithCacheKey)({mode:y,value:_,pads:x})},e.padV11=(m,y,_)=>{c(y);let x=u(m,y,_);return(0,e.padV2)(m,[y[0]],x)},e.parsePadAttributesV11=m=>m.attributes.getString("mode","constant");let u=(m,y,_)=>{if(!m.session.isInitializer(y[1].dataId)||y.length>=3&&!m.session.isInitializer(y[2].dataId))throw new Error("dynamic pad attributes are not allowed");let x=Array.from(y[1].integerData),E=y.length>=3?y[2].floatData[0]:0;return(0,n.createAttributeWithCacheKey)({mode:_,pads:x,value:E})},h=(m,y,_)=>{let x=i.ShapeUtil.padShape(y.dims.slice(),_.pads),E=x.length,S=`
      ${a(m,y,_)}
      float process(int[${E}] indices) {
          return padA(indices);
      }`;return{name:"Pad",inputNames:["A"],inputTypes:[o.TextureType.unpacked],output:{dims:x,type:y.type,textureType:o.TextureType.unpacked},shaderSource:S}},d=m=>{if(!m||m.length!==1)throw new Error("Pad requires 1 input");if(m[0].type!=="float32"&&m[0].type!=="float64")throw new Error("Invalid input type.")},c=m=>{if(!m||m.length!==2&&m.length!==3)throw new Error("Pad requires 2 or 3 inputs");if(m[1].type!=="int32")throw new Error("Invalid input type.");if(m.length>=3&&m[2].type==="string")throw new Error("Invalid input type.")},a=(m,y,_)=>{let x=(0,r.getGlsl)(m.session.backend.glContext.version),[E,S]=m.calculateTextureWidthAndHeight(y.dims,o.TextureType.unpacked),T=i.ShapeUtil.computeStrides(y.dims);switch(_.mode){case"constant":return f(x,y.dims,T,E,S,_.pads,_.value);case"reflect":return p(x,y.dims,T,E,S,_.pads);case"edge":return g(x,y.dims,T,E,S,_.pads);default:throw new Error("Invalid mode")}},f=(m,y,_,x,E,S,T)=>{let C=y.length,I="";for(let A=C-1;A>=0;--A)I+=`
        k = m[${A}] - ${S[A]};
        if (k < 0)  return constant;
        if (k >= ${y[A]}) return constant;
        offset += k * ${_[A]};
        `;return`
      float padA(int m[${C}]) {
        const float constant = float(${T});
        int offset = 0;
        int k = 0;
        ${I}
        vec2 coords = offsetToCoords(offset, ${x}, ${E});
        float value = getColorAsFloat(${m.texture2D}(A, coords));
        return value;
      }
      `},p=(m,y,_,x,E,S)=>{let T=y.length,C="";for(let I=T-1;I>=0;--I)C+=`
        k = m[${I}] - ${S[I]};
        if (k < 0) { k = -k; }
        {
          const int _2n_1 = ${2*(y[I]-1)};
          k = int( mod( float(k), float(_2n_1) ) ) ;
          if(k >= ${y[I]}) { k = _2n_1 - k; }
        }
        offset += k * ${_[I]};
        `;return`
      float padA(int m[${T}]) {
        int offset = 0;
        int k = 0;
        ${C}
        vec2 coords = offsetToCoords(offset, ${x}, ${E});
        float value = getColorAsFloat(${m.texture2D}(A, coords));
        return value;
      }
      `},g=(m,y,_,x,E,S)=>{let T=y.length,C="";for(let I=T-1;I>=0;--I)C+=`
        k = m[${I}] - ${S[I]};
        if (k < 0)  k = 0;
        if (k >= ${y[I]}) k = ${y[I]-1};
        offset += k * ${_[I]};
      `;return`
      float padA(int m[${T}]) {
        int offset = 0;
        int k = 0;
        ${C}
        vec2 coords = offsetToCoords(offset, ${x}, ${E});
        float value = getColorAsFloat(${m.texture2D}(A, coords));
        return value;
      }
      `}},2143:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.globalMaxPool=e.parseMaxPoolAttributes=e.maxPool=e.parseGlobalAveragePoolAttributes=e.globalAveragePool=e.parseAveragePoolAttributes=e.averagePool=void 0;let n=t(246),i=t(2517),r=t(2039);e.averagePool=(g,m,y)=>{c(m);let _={name:"AveragePool",inputNames:["X"],inputTypes:[r.TextureType.unpacked],cacheHint:y.cacheKey};return[g.run(Object.assign(Object.assign({},_),{get:()=>o(m,_,!1,y)}),m)]},e.parseAveragePoolAttributes=g=>{let m=g.attributes.getString("auto_pad","NOTSET"),y=g.attributes.getInt("ceil_mode",0),_=g.attributes.getInt("count_include_pad",0)!==0,x=g.attributes.getInts("kernel_shape"),E=g.attributes.getInts("strides",[]),S=g.attributes.getInts("pads",[]);if(y!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");return(0,n.createAttributeWithCacheKey)({autoPad:m,ceilMode:y,countIncludePad:_,kernelShape:x,strides:E,pads:S})};let o=(g,m,y,_)=>{let[x,E]=u(g,_,y),S=i.ShapeUtil.size(x.kernelShape),T="";x.countIncludePad?T+=`value /= float(${S});`:T+=`value /= float(${S} - pad);`;let C=`
        ${a(g[0].dims,x,"value += _X(x);",T,"0.0")}
      `;return Object.assign(Object.assign({},m),{output:{dims:E,type:g[0].type,textureType:r.TextureType.unpacked},shaderSource:C})};e.globalAveragePool=(g,m,y)=>{c(m);let _={name:"GlobalAveragePool",inputNames:["X"],inputTypes:[r.TextureType.unpacked],cacheHint:`${y.countIncludePad}`};return[g.run(Object.assign(Object.assign({},_),{get:()=>o(m,_,!0,y)}),m)]},e.parseGlobalAveragePoolAttributes=g=>{let m=g.attributes.getInt("count_include_pad",0)!==0;return(0,n.createAttributeWithCacheKey)({autoPad:"",ceilMode:0,countIncludePad:m,kernelShape:[],strides:[],pads:[]})},e.maxPool=(g,m,y)=>{c(m);let _={name:"MaxPool",inputNames:["X"],inputTypes:[r.TextureType.unpacked],cacheHint:y.cacheKey};return[g.run(Object.assign(Object.assign({},_),{get:()=>l(m,_,!1,y)}),m)]},e.parseMaxPoolAttributes=g=>{let m=g.attributes.getString("auto_pad","NOTSET"),y=g.attributes.getInt("ceil_mode",0),_=g.attributes.getInts("kernel_shape"),x=g.attributes.getInts("strides",[]),E=g.attributes.getInts("pads",[]),S=g.attributes.getInt("storage_order",0),T=g.attributes.getInts("dilations",[]);if(S!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(y!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");return(0,n.createAttributeWithCacheKey)({autoPad:m,ceilMode:y,countIncludePad:!1,kernelShape:_,strides:x,pads:E,storageOrder:S,dilations:T})};let l=(g,m,y,_)=>{let[x,E]=u(g,_,y),S=`
      ${a(g[0].dims,x,`
      value = max(_X(x), value);
    `,"","-1e5")}
    `;return Object.assign(Object.assign({},m),{output:{dims:E,type:g[0].type,textureType:r.TextureType.unpacked},shaderSource:S})},u=(g,m,y)=>{let _=g[0].dims.slice(),x=Object.hasOwnProperty.call(m,"dilations"),E=m.kernelShape.slice(),S=m.strides.slice(),T=x?m.dilations.slice():[],C=m.pads.slice();i.PoolConvUtil.adjustPoolAttributes(y,_,E,S,T,C);let I=i.PoolConvUtil.computePoolOutputShape(y,_,S,T,E,C,m.autoPad),A=Object.assign({},m);return x?Object.assign(A,{kernelShape:E,strides:S,pads:C,dilations:T,cacheKey:m.cacheKey}):Object.assign(A,{kernelShape:E,strides:S,pads:C,cacheKey:m.cacheKey}),[A,I]},h={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[],cacheKey:""},d={name:"GlobalMaxPool",inputNames:["X"],inputTypes:[r.TextureType.unpacked]};e.globalMaxPool=(g,m)=>(c(m),[g.run(Object.assign(Object.assign({},d),{get:()=>l(m,d,!0,h)}),m)]);let c=g=>{if(!g||g.length!==1)throw new Error("Pool ops requires 1 input.");if(g[0].type!=="float32"&&g[0].type!=="float64")throw new Error("Invalid input type.")},a=(g,m,y,_,x)=>{let E=g.length;if(m.kernelShape.length<=2){let S=m.kernelShape[m.kernelShape.length-1],T=m.strides[m.strides.length-1],C=m.pads[m.pads.length/2-1],I=m.pads[m.pads.length-1],A=g[E-1],P="",F="",H="";if(P=C+I!==0?`
          for (int i = 0; i < ${S}; i++) {
            x[${E} - 1] = indices[${E} - 1] * ${T} - ${C} + i;
            if (x[${E} - 1] < 0 || x[${E} - 1] >= ${A}) {
              pad++;
              continue;
            }
            ${y}
          }`:`
          for (int i = 0; i < ${S}; i++) {
            x[${E} - 1] = indices[${E} - 1] * ${T} - ${C} + i;
            ${y}
          }`,m.kernelShape.length===2){let z=m.kernelShape[m.kernelShape.length-2],B=m.strides[m.strides.length-2],V=m.pads[m.pads.length/2-2],M=m.pads[m.pads.length-2],$=g[E-2];F=V+M!==0?`
            for (int j = 0; j < ${z}; j++) {
              x[${E} - 2] = indices[${E} - 2] * ${B} - ${V} + j;
              if (x[${E} - 2] < 0 || x[${E} - 2] >= ${$}) {
                pad+= ${S};
                continue;
              }
          `:`
            for (int j = 0; j < ${z}; j++) {
              x[${E} - 2] = indices[${E} - 2] * ${B} - ${V} + j;
            `,H=`
          }
        `}return`
        float process(int indices[${E}]) {
          int x[${E}];
          copyVec(indices, x);

          float value = ${x};
          int pad = 0;
          ${F}
          ${P}
          ${H}
          ${_}
          return value;
        }
      `}{let S=i.ShapeUtil.size(m.kernelShape),T=i.ShapeUtil.computeStrides(m.kernelShape),C=T.length,I=m.pads.length,A=p(C),P=f(g,"inputDims"),F=f(m.pads,"pads"),H=f(T,"kernelStrides"),z=f(m.strides,"strides"),B="";return B=m.pads.reduce((V,M)=>V+M)?`
            if (x[j] >= inputDims[j] || x[j] < 0) {
              pad++;
              isPad = true;
              break;
            }
          }
          if (!isPad) {
            ${y}
          }`:`
          }
          ${y}
        `,`
        ${A}
        float process(int indices[${E}]) {
          int x[${E}];
          copyVec(indices, x);
          int offset[${C}];
          int pads[${I}];
          int inputDims[${E}];
          int kernelStrides[${C}];
          int strides[${C}];
          ${F}
          ${P}
          ${z}
          ${H}

          float value = ${x};
          int pad = 0;
          bool isPad = false;
          for (int i = 0; i < ${S}; i++) {
            offsetToIndices(i, kernelStrides, offset);
            isPad = false;
            for (int j = ${E} - ${C}; j < ${E}; j++) {
              x[j] = indices[j] * strides[j - ${E} + ${C}]
                + offset[j - ${E} + ${C}] - pads[j - 2];
              ${B}
          }
          ${_}

          return value;
        }
      `}},f=(g,m)=>{let y="";for(let _=0;_<g.length;_++)y+=`
      ${m}[${_}] = ${g[_]};
    `;return y},p=g=>`
  void offsetToIndices(int offset, int[${g}] strides, out int[${g}] indices) {
    if (${g} == 0) {
      return;
    }
    for (int i = 0; i < ${g} - 1; ++i) {
      indices[i] = offset / strides[i];
      offset -= indices[i] * strides[i];
    }
    indices[${g} - 1] = offset;
  }`},4939:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.reduceLogSumSquare=e.reduceLogSum=e.reduceProd=e.reduceMin=e.reduceMax=e.reduceMean=e.reduceSum=e.parseReduceAttributes=void 0;let n=t(246),i=t(782),r=t(2517),o=t(2039),l=(d,c,a,f,p)=>{h(c);let g={name:f,inputNames:["A"],inputTypes:[o.TextureType.unpacked]};return[d.run(Object.assign(Object.assign({},g),{cacheHint:a.cacheKey,get:()=>u(d,c,a,f,p,g)}),c)]};e.parseReduceAttributes=d=>{let c=d.attributes.getInts("axes",[]),a=d.attributes.getInt("keepdims",1)===1;return(0,n.createAttributeWithCacheKey)({axes:c,keepDims:a})};let u=(d,c,a,f,p,g)=>{let m=[],y=c[0].dims.length||1,_=[],x=r.ShapeUtil.normalizeAxes(a.axes,c[0].dims.length),E=p(c,x),S=E[1];for(let C=0;C<c[0].dims.length;C++)x.indexOf(C)>=0||x.length===0?(a.keepDims&&m.push(1),S=`
          for(int j${C} = 0; j${C} < ${c[0].dims[C]}; j${C}++) {
            inputIdx[${C}] = j${C};
            ${S}
          }`):(_.push(`inputIdx[${C}] = outputIdx[${m.length}];`),m.push(c[0].dims[C]));let T=`
      float process(int outputIdx[${m.length||1}]) {
        float value;                 // final result
        int inputIdx[${y}];      // addressing input data
        ${_.join(`
`)}
        ${E[0]}       // init ops for reduce max/min
        ${S}
        ${E[2]}       // final computation for reduce mean
        return value;
      }`;return Object.assign(Object.assign({},g),{output:{dims:m,type:c[0].type,textureType:o.TextureType.unpacked},shaderSource:T})},h=d=>{if(!d||d.length!==1)throw new Error("Reduce op requires 1 input.");if(i.NUMBER_TYPES.indexOf(d[0].type)===-1)throw new Error("Invalid input type.")};e.reduceSum=(d,c,a)=>l(d,c,a,"ReduceSum",()=>["value = 0.0;","value += _A(inputIdx);",""]),e.reduceMean=(d,c,a)=>l(d,c,a,"ReduceMean",(f,p)=>{let g=1;for(let m=0;m<f[0].dims.length;m++)(p.indexOf(m)>=0||p.length===0)&&(g*=f[0].dims[m]);return["value = 0.0;","value += _A(inputIdx);",`value /= ${g}.;`]}),e.reduceMax=(d,c,a)=>l(d,c,a,"ReduceMax",(f,p)=>{let g=[];for(let m=0;m<f[0].dims.length;m++)(p.indexOf(m)>=0||p.length===0)&&g.push(`inputIdx[${m}] = 0;`);return[`${g.join(`
`)}
value = _A(inputIdx);`,"value = max(value, _A(inputIdx));",""]}),e.reduceMin=(d,c,a)=>l(d,c,a,"ReduceMin",(f,p)=>{let g=[];for(let m=0;m<f[0].dims.length;m++)(p.indexOf(m)>=0||p.length===0)&&g.push(`inputIdx[${m}] = 0;`);return[`${g.join(`
`)}
value = _A(inputIdx);`,"value = min(value, _A(inputIdx));",""]}),e.reduceProd=(d,c,a)=>l(d,c,a,"ReduceProd",()=>["value = 1.0;","value *= _A(inputIdx);",""]),e.reduceLogSum=(d,c,a)=>l(d,c,a,"ReduceLogSum",()=>["value = 0.0;","value += _A(inputIdx);","value = log(value);"]),e.reduceLogSumSquare=(d,c,a)=>l(d,c,a,"ReduceLogSumSquare",()=>["float t; value = 0.0;","t = _A(inputIdx); value += t * t;",""])},7019:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isReshapeCheap=e.processDims3D=e.createPackedReshape3DProgramInfoLoader=void 0;let n=t(2517),i=t(5060),r=t(2039),o=t(2827);e.createPackedReshape3DProgramInfoLoader=(l,u,h)=>{let d=(c=>({name:"Reshape (packed)",inputTypes:[r.TextureType.packed],inputNames:["A"],cacheHint:`${c}`}))(h);return Object.assign(Object.assign({},d),{get:()=>((c,a,f,p)=>{let g=a.dims,m=p,y="";for(let E=0;E<4;E++){let S="";switch(E){case 0:S="outputCoords = rc;";break;case 1:S="outputCoords = ivec3(rc.x, rc.y+1, rc.z);";break;case 2:S="outputCoords = ivec3(rc.x, rc.y, rc.z+1);";break;case 3:S="outputCoords = ivec3(rc.x, rc.y+1, rc.z+1);";break;default:throw new Error}y+=`
        ${S}
        ${E>0?"if(outputCoords.y < rows && outputCoords.z < cols){":""}
          int flattenedIndex = getFlattenedIndex(outputCoords);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flattenedIndex);
          vec2 innerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${E}] = getChannel(getA(inputRC.x, inputRC.y, inputRC.z), innerDims);

        ${E>0?"}":""}
      `}let _=(0,i.getGlsl)(c.session.backend.glContext.version),x=`
      ${function(E){let S=n.ShapeUtil.computeStrides(E),T=["b","r","c"],C="index";return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${S.map((I,A)=>`int ${T[A]} = ${C} / ${I}; ${A===S.length-1?`int ${T[A+1]} = ${C} - ${T[A]} * ${I}`:`index -= ${T[A]} * ${I}`};`).join("")}
      return ivec3(b, r, c);
    }
  `}(g)}
      ${function(E){let S=n.ShapeUtil.computeStrides(E);return`
  int getFlattenedIndex(ivec3 coords) {
    // reverse y, z order
    return coords.x * ${S[0]} + coords.z * ${S[1]} + coords.y;
  }
`}(m)}
      ${(0,o.unpackFromChannel)()}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.0);

        ivec3 outputCoords;
        int rows = ${m[2]};
        int cols = ${m[1]};

        ${y}
        ${_.output} = result;
      }
    `;return Object.assign(Object.assign({},f),{output:{dims:m,type:a.type,textureType:r.TextureType.packed},shaderSource:x,hasMain:!0})})(l,u,d,h)})},e.processDims3D=function(l){if(l.length===0)return[1,1,1];let u=1;for(let h=0;h<l.length-2;++h)u*=l[h];return[u,l.length>1?l[l.length-2]:1,l[l.length-1]]},e.isReshapeCheap=function(l,u){let h=!1;return h=l.length===0||u.length===0||(l.length<2||u.length<2?l[l.length-1]===u[u.length-1]:l[l.length-1]===u[u.length-1]&&l[l.length-2]===u[u.length-2]),h}},718:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.reshape=void 0;let n=t(2517);e.reshape=(i,r)=>{let o=n.ShapeUtil.calculateReshapedDims(r[0].dims,r[1].integerData);return i.session.pack?[i.reshapePacked(r[0],o)]:[i.reshapeUnpacked(r[0],o)]}},2268:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseResizeAttributesV11=e.parseResizeAttributesV10=e.resize=void 0;let n=t(5060),i=t(2039),r=t(9390),o=t(2827),l=t(9793),u={name:"Resize",inputNames:["A"],inputTypes:[i.TextureType.packed]};e.resize=(f,p,g)=>((0,l.validateInputs)(p,g),[f.run(Object.assign(Object.assign({},u),{cacheHint:g.cacheKey,get:()=>h(f,p,g)}),p)]),e.parseResizeAttributesV10=f=>(0,l.parseUpsampleAttributes)(f,10),e.parseResizeAttributesV11=f=>(0,l.parseUpsampleAttributes)(f,11);let h=(f,p,g)=>{let m=(0,n.getGlsl)(f.session.backend.glContext.version),[y,_]=d(p,g);if(y.every(B=>B===1)&&g.coordinateTransformMode!=="tf_crop_and_resize")return Object.assign(Object.assign({},u),{output:{dims:_,type:p[0].type,textureType:i.TextureType.packed},hasMain:!0,shaderSource:`void main() {
                    vec4 v = ${m.texture2D}(X, TexCoords);
                    ${m.output} = v;
                }`});let x=_.length;if(x<2)throw new Error(`output dimension should be at least 2, but got ${x}`);let E=_[x-2],S=_[x-1],T=p[0].dims;if(x!==T.length)throw new Error(`output dimension should match input ${T.length}, but got ${x}`);let C=T[x-2],I=T[x-1],A=y[x-2],P=y[x-1],F="";if(g.mode!=="linear")throw new Error(`resize (packed) does not support mode: '${g.mode}'`);switch(g.coordinateTransformMode){case"asymmetric":F=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        return vec4(coords) / scaleWHWH;
                    }
                `;break;case"half_pixel":F=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        return (vec4(coords) + 0.5) / scaleWHWH - 0.5;
                    }
                `;break;case"pytorch_half_pixel":F=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        vec4 fcoords = vec4(coords);
                        return vec4(
                            ${S}.0 > 1.0 ? (fcoords.x + 0.5) / scaleWHWH.x - 0.5 : 0.0,
                            ${E}.0 > 1.0 ? (fcoords.y + 0.5) / scaleWHWH.y - 0.5 : 0.0,
                            ${S}.0 > 1.0 ? (fcoords.z + 0.5) / scaleWHWH.z - 0.5 : 0.0,
                            ${E}.0 > 1.0 ? (fcoords.w + 0.5) / scaleWHWH.w - 0.5 : 0.0
                          );
                    }
                `;break;case"align_corners":F=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        vec4 resized = vec4(${S}.0 - 1.0, ${E}.0 - 1.0, ${S}.0 - 1.0,
                            ${E}.0 - 1.0);
                        vec4 original = vec4(${I}.0 - 1.0, ${C}.0 - 1.0, ${I}.0 - 1.0,
                            ${C}.0 - 1.0);
                        vec4 new_scale = original / resized;
                        return vec4(coords) * new_scale;
                    }
                `;break;default:throw new Error(`resize (packed) does not support coordinateTransformMode:                                 '${g.coordinateTransformMode}'`)}let H=(0,r.getCoordsDataType)(x),z=`
            const vec2 inputWH = vec2(${C}.0, ${I}.0);
            const vec4 scaleWHWH = vec4(float(${A}), float(${P}), float(${A}), float(${P}));
            ${(0,o.unpackFromChannel)()}
            ${F}
            float getAValue(int x10, int r, int c, int d) {
                return getChannel(getA(x10, r, c, d), vec2(c, d));
            }
            void main() {
                ${H} rc = getOutputCoords();

                int batch = rc[0];
                int depth = rc[1];

                // retrieve the 4 coordinates that is used in the 4 packed output values.
                ivec4 coords = ivec4(rc.wz, rc.w + 1, rc.z + 1);

                // calculate the source index in fraction
                vec4 sourceFrac = getSourceFracIndex(coords);

                // get the lower and upper bound of the 4 values that will be packed into one texel.
                ivec4 x00 = ivec4(max(sourceFrac.xy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xy)));
                ivec4 x01 = ivec4(max(sourceFrac.xw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xw)));
                ivec4 x10 = ivec4(max(sourceFrac.zy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zy)));
                ivec4 x11 = ivec4(max(sourceFrac.zw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zw)));

                bool hasNextRow = rc.w < ${E-1};
                bool hasNextCol = rc.z < ${S-1};

                // pack x00, x01, x10, x11's top-left corner into one vec4 structure
                vec4 topLeft = vec4(
                    getAValue(batch, depth, x00.x, x00.y),
                    hasNextCol ? getAValue(batch, depth, x01.x, x01.y) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.x, x10.y) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.y) : 0.0);

                // pack x00, x01, x10, x11's top-right corner into one vec4 structure
                vec4 topRight = vec4(
                    getAValue(batch, depth, x00.x, x00.w),
                    hasNextCol ? getAValue(batch, depth, x01.x, x01.w) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.x, x10.w) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.w) : 0.0);

                // pack x00, x01, x10, x11's bottom-left corner into one vec4 structure
                vec4 bottomLeft = vec4(
                    getAValue(batch, depth, x00.z, x00.y),
                    hasNextCol ? getAValue(batch, depth, x01.z, x01.y) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.z, x10.y) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.y) : 0.0);

                // pack x00, x01, x10, x11's bottom-right corner into one vec4 structure
                vec4 bottomRight = vec4(
                    getAValue(batch, depth, x00.z, x00.w),
                    hasNextCol ? getAValue(batch, depth, x01.z, x01.w) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.z, x10.w) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.w) : 0.0);

                // calculate the interpolation fraction on u and v direction
                vec4 frac = vec4(sourceFrac) - floor(sourceFrac);
                vec4 clampFrac = clamp(frac, vec4(0.0), vec4(1.0));

                vec4 top = mix(topLeft, topRight, clampFrac.ywyw);
                vec4 bottom = mix(bottomLeft, bottomRight, clampFrac.ywyw);
                vec4 newValue = mix(top, bottom, clampFrac.xxzz);

                ${m.output} = vec4(newValue);
            }
        `;return Object.assign(Object.assign({},u),{output:{dims:_,type:p[0].type,textureType:i.TextureType.packed},hasMain:!0,shaderSource:z})},d=(f,p)=>{let g=f[0].dims,m,y=p.scales;if(y.length===0){let x=f[p.scalesInputIdx];if(x&&x.size!==0){if(f[p.sizesInputIdx])throw new Error("Only one of scales or sizes must be provided as input.");y=c(x,p.mode,p.isResize)}else{let E=f[p.sizesInputIdx];if(!E||E.size===0)throw new Error("Either scales or sizes MUST be provided as input.");m=Array.from(E.integerData),y=a(m,g,p.mode,p.isResize)}}else if(f[p.sizesInputIdx])throw new Error("Only one of scales or sizes must be provided as input.");let _=m||g.map((x,E)=>Math.floor(x*y[E]));return[y,_]},c=(f,p,g)=>{let m=Array.from(f.floatData);return(0,l.scalesValidation)(m,p,g),m},a=(f,p,g,m)=>{let y=p.length,_=new Array(y);for(let x=0,E=y;x<E;x++)if(p[x]===0){if(f[x]!==0)throw new Error("Input dim is zero but required output dim is non-zero.");_[x]=1}else _[x]=f[x]/p[x];return(0,l.scalesValidation)(_,g,m),_}},8117:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shape=void 0;let n=t(9162);e.shape=(r,o)=>(i(o),[new n.Tensor([o[0].dims.length],"int32",void 0,void 0,new Int32Array(o[0].dims))]);let i=r=>{if(!r||r.length!==1)throw new Error("Shape requires 1 input.")}},2278:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sliceV10=e.parseSliceAttributes=e.slice=void 0;let n=t(246),i=t(782),r=t(2517),o=t(2039),l={name:"Slice",inputNames:["A"],inputTypes:[o.TextureType.unpacked]};e.slice=(a,f,p)=>(h(f),[a.run(Object.assign(Object.assign({},l),{cacheHint:p.cacheKey,get:()=>u(a,f[0],p)}),f)]),e.parseSliceAttributes=a=>{let f=a.attributes.getInts("starts"),p=a.attributes.getInts("ends"),g=a.attributes.getInts("axes",[]);return(0,n.createAttributeWithCacheKey)({starts:f,ends:p,axes:g})};let u=(a,f,p)=>{let g=p.axes.length===0?f.dims.slice(0).map((T,C)=>C):p.axes,m=r.ShapeUtil.normalizeAxes(g,f.dims.length),y=p.starts.map((T,C)=>T>f.dims[m[C]]-1?f.dims[m[C]]:r.ShapeUtil.normalizeAxis(T,f.dims[m[C]])),_=p.ends.map((T,C)=>T>f.dims[m[C]]-1?f.dims[m[C]]:r.ShapeUtil.normalizeAxis(T,f.dims[m[C]])),x=f.dims.slice(),E=[];for(let T=0;T<m.length;T++)x[m[T]]=_[T]-y[T],y[T]>0&&E.push(`outputIdx[${m[T]}] += ${y[T]};`);let S=`
      float process(int outputIdx[${x.length}]) {
        ${E.join(`
      `)}
        return _A(outputIdx);
      }`;return Object.assign(Object.assign({},l),{output:{dims:x,type:f.type,textureType:o.TextureType.unpacked},shaderSource:S})},h=a=>{if(!a||a.length!==1)throw new Error("Slice requires 1 input.");if(i.NUMBER_TYPES.indexOf(a[0].type)===-1)throw new Error("Invalid input type.")};e.sliceV10=(a,f)=>{c(f);let p=d(a,f);return[a.run(Object.assign(Object.assign({},l),{cacheHint:p.cacheKey,get:()=>u(a,f[0],p)}),[f[0]])]};let d=(a,f)=>{if(!a.session.isInitializer(f[1].dataId)||!a.session.isInitializer(f[2].dataId)||f.length>=4&&!a.session.isInitializer(f[3].dataId)||f.length>=5&&!a.session.isInitializer(f[4].dataId))throw new Error("dynamic slice attributes are not allowed");if(f.length>=5&&f[4].integerData.some(y=>y!==1))throw new Error("currently non-1 steps is not supported for Slice");let p=Array.from(f[1].integerData),g=Array.from(f[2].integerData),m=f.length>=4?Array.from(f[3].integerData):[];return{starts:p,ends:g,axes:m,cacheKey:`${m};${p};${g}`}},c=a=>{if(!a||a.length<3||a.length>5)throw new Error("Invalid input number.");if(a[1].type!=="int32"||a[1].dims.length!==1)throw new Error("Invalid input type.");if(a[2].type!=="int32"||a[2].dims.length!==1)throw new Error("Invalid input type.");if(a.length>=4&&(a[3].type!=="int32"||a[3].dims.length!==1))throw new Error("Invalid input type.");if(a.length>=5&&(a[4].type!=="int32"||a[4].dims.length!==1))throw new Error("Invalid input type.")}},5524:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.softmaxV13=e.parseSoftmaxAttributesV13=e.parseSoftmaxAttributes=e.softmax=void 0;let n=t(246),i=t(2517),r=t(5060),o=t(2039),l=t(3738),u={name:"SoftmaxComputeMax",inputNames:["A"],inputTypes:[o.TextureType.unpacked]},h={name:"SoftmaxComputeScale",inputNames:["A","Max"],inputTypes:[o.TextureType.unpacked,o.TextureType.unpacked]},d={name:"SoftMax",inputNames:["A","Max","Norm"],inputTypes:[o.TextureType.unpacked,o.TextureType.unpacked,o.TextureType.unpacked]};e.softmax=(m,y,_)=>{g(y);let x=y[0].dims.slice(),E=i.ShapeUtil.normalizeAxis(_.axis,x.length),S=i.ShapeUtil.sizeToDimension(x,E),T=i.ShapeUtil.sizeFromDimension(x,E);return c(m,y,_,S,T)},e.parseSoftmaxAttributes=m=>(0,n.createAttributeWithCacheKey)({axis:m.attributes.getInt("axis",1)}),e.parseSoftmaxAttributesV13=m=>(0,n.createAttributeWithCacheKey)({axis:m.attributes.getInt("axis",-1)}),e.softmaxV13=(m,y,_)=>{g(y);let x=y[0].dims.slice(),E=i.ShapeUtil.normalizeAxis(_.axis,x.length),S=x.length,T=E!==S-1,C=[],I,A=[],P=[];T&&(A=Array.from({length:S}).map((B,V)=>V),A[E]=S-1,A[S-1]=E,A.map(B=>C.push(x[B])),I=(0,n.createAttributeWithCacheKey)({perm:A}),P=(0,l.transpose)(m,y,I));let F=T?i.ShapeUtil.sizeToDimension(C,S-1):i.ShapeUtil.sizeToDimension(x,S-1),H=T?i.ShapeUtil.sizeFromDimension(C,S-1):i.ShapeUtil.sizeFromDimension(x,S-1),z=c(m,T?P:y,_,F,H);return T?(0,l.transpose)(m,z,I):z};let c=(m,y,_,x,E)=>{let S=a(m,y[0],x,E,[x]),T=m.run(Object.assign(Object.assign({},u),{cacheHint:_.cacheKey,get:()=>S}),y),C=f(m,y[0],x,E,S.output.dims,[x]),I=m.run(Object.assign(Object.assign({},h),{cacheHint:_.cacheKey,get:()=>C}),[y[0],T]),A=p(m,y[0],x,E,S.output.dims,C.output.dims);return[m.run(Object.assign(Object.assign({},d),{cacheHint:_.cacheKey,get:()=>A}),[y[0],T,I])]},a=(m,y,_,x,E)=>{let[S,T]=m.calculateTextureWidthAndHeight(y.dims,o.TextureType.unpacked),C=E.length;if(_<1||x<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(E.length!==1)throw new Error("Dimensionality of the output should be 1");if(E[0]!==_)throw new Error("Shape of the output should be equal to logical row count");let I=(0,r.getGlsl)(m.session.backend.glContext.version),A=`
      float process(int[${C}] indices) {
        int logical_row_start_offset = indices[0] * ${x};

        float max = getColorAsFloat(${I.texture2D}(A, offsetToCoords(logical_row_start_offset, ${S},
        ${T} )));
        for(int i=1; i<${x}; ++i)
        {
          float current = getColorAsFloat(${I.texture2D}(A, offsetToCoords(logical_row_start_offset + i,
            ${S}, ${T})));
          if(current > max)
          max = current;
        }

        return max;
      }`;return Object.assign(Object.assign({},u),{output:{dims:E,type:y.type,textureType:o.TextureType.unpacked},shaderSource:A})},f=(m,y,_,x,E,S)=>{let[T,C]=m.calculateTextureWidthAndHeight(y.dims,o.TextureType.unpacked),I=S.length;if(_<1||x<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(S.length!==1)throw new Error("Dimensionality of the output should be 1");if(S[0]!==_)throw new Error("Shape of the output should be equal to logical row count");if(E.length!==1)throw new Error("Dimensionality of the intermediate results should be 1");if(E[0]!==_)throw new Error("Shape of the intermediate results should be equal to logical row count");let A=`
      float process(int[${I}] indices) {
        int logical_row_start_offset = indices[0] * ${x};

        float norm_factor = 0.0;
        float max = _Max(indices);
        for(int i=0; i<${x}; ++i)
        {
          norm_factor += exp(getColorAsFloat(${(0,r.getGlsl)(m.session.backend.glContext.version).texture2D}(A, offsetToCoords(logical_row_start_offset + i,
            ${T}, ${C}))) - max);
        }

        return norm_factor;
      }`;return Object.assign(Object.assign({},h),{output:{dims:S,type:y.type,textureType:o.TextureType.unpacked},shaderSource:A})},p=(m,y,_,x,E,S)=>{let[T,C]=m.calculateTextureWidthAndHeight(y.dims,o.TextureType.unpacked),I=y.dims.length;if(_<1||x<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(E.length!==1||S.length!==1)throw new Error("Dimensionality of the intermediate results should be 1");if(E[0]!==_||S[0]!==_)throw new Error("Shape of the intermediate results should be equal to logical row count");let A=`
      float process(int[${I}] indices) {

      // get offset of current logical tensor index from the 2-D texture coordinates (TexCoords)
      int offset = coordsToOffset(TexCoords, ${T}, ${C});

      //determine the logical row for this index
      int logical_row_index[1];
      logical_row_index[0] = offset / ${x};

      float norm_factor = _Norm(logical_row_index);

      // avoid possible division by 0
      // if norm_facor is 0, all elements are zero
      // if so, return 0
      if(norm_factor == 0.0)
        return 0.0;

      return exp(_A(indices) - _Max(logical_row_index)) / norm_factor;
    }`;return Object.assign(Object.assign({},d),{output:{dims:y.dims,type:y.type,textureType:o.TextureType.unpacked},shaderSource:A})},g=m=>{if(!m||m.length!==1)throw new Error("Softmax requires 1 input.");if(m[0].type!=="float32"&&m[0].type!=="float64")throw new Error("Invalid input type")}},5975:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseSplitAttributes=e.split=void 0;let n=t(246),i=t(2517),r=t(2039),o={name:"Split",inputNames:["A"],inputTypes:[r.TextureType.unpacked]};e.split=(d,c,a)=>{h(c);let f=i.ShapeUtil.normalizeAxis(a.axis,c[0].dims.length),p=l(d,c,f,a),g=[];for(let m=0;m<p;++m)g.push(d.run(Object.assign(Object.assign({},o),{cacheHint:`${a.cacheKey};${m}`,get:()=>u(d,c[0],a,f,m)}),c));return g},e.parseSplitAttributes=d=>{let c=d.attributes.getInt("axis",0),a=d.attributes.getInts("split",[]),f=d.outputs.length;return(0,n.createAttributeWithCacheKey)({axis:c,split:a,numOutputs:f})};let l=(d,c,a,f)=>{let[,p]=i.SplitUtil.splitShape(c[0].dims,a,f.split,f.numOutputs);return p.length},u=(d,c,a,f,p)=>{let[g,m]=i.SplitUtil.splitShape(c.dims,f,a.split,a.numOutputs),y=m[p],_=g[p],x=`
      float process(int indices[${_.length}]) {
        indices[${f}] += ${y};
        return _A(indices);
      }
    `;return Object.assign(Object.assign({},o),{cacheHint:`${a.cacheKey}:${p}`,output:{dims:_,type:c.type,textureType:r.TextureType.unpacked},shaderSource:x})},h=d=>{if(!d||d.length!==1)throw new Error("Split requires one input.");if(d[0].type!=="int8"&&d[0].type!=="uint8"&&d[0].type!=="int16"&&d[0].type!=="uint16"&&d[0].type!=="int32"&&d[0].type!=="uint32"&&d[0].type!=="float32"&&d[0].type!=="float64"&&d[0].type!=="bool")throw new Error("Invalid input type.")}},3933:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseSqueezeAttributes=e.squeezeV13=e.squeeze=void 0;let n=t(2517);e.squeeze=(o,l,u)=>{i(l);let h=n.ShapeUtil.squeezeShape(l[0].dims,u);return[o.reshapeUnpacked(l[0],h)]},e.squeezeV13=(o,l)=>(r(l),(0,e.squeeze)(o,[l[0]],Array.from(l[1].integerData))),e.parseSqueezeAttributes=o=>o.attributes.getInts("axes");let i=o=>{if(!o||o.length!==1)throw new Error("Squeeze requires 1 input.");if(o[0].type==="string")throw new Error("invalid input tensor types.")},r=o=>{if(!o||o.length!==2)throw new Error("Squeeze requires 2 inputs.");if(o[1].type!=="int32")throw new Error("Invalid input type.")}},6558:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sum=void 0;let n=t(5060),i=t(2039);e.sum=(l,u)=>{o(u);let h={name:"Sum",inputNames:u.map((d,c)=>`X${c}`),inputTypes:new Array(u.length).fill(i.TextureType.unpacked)};return[l.run(Object.assign(Object.assign({},h),{get:()=>r(l,u,h)}),u)]};let r=(l,u,h)=>{let d=(0,n.getGlsl)(l.session.backend.glContext.version),c=u[0].dims.slice(),a=`
      void main() {
        vec4 result = ${u.map((f,p)=>`${d.texture2D}(X${p},TexCoords)`).join(" + ")};
        ${d.output} = result;
      }
    `;return Object.assign(Object.assign({},h),{output:{dims:c,type:u[0].type,textureType:i.TextureType.unpacked},hasMain:!0,shaderSource:a})},o=l=>{if(!l||l.length===0)throw new Error("Sum requires inputs.");let u=l[0].dims.length;for(let h=1;h<l.length;h++){if(u!==l[h].dims.length)throw new Error("Input shapes are mismatched.");for(let d=0;d<u;d++)if(l[0].dims[d]!==l[h].dims[d])throw new Error("Input shapes are not matched.")}if(l[0].type!=="float32"&&l[0].type!=="float64")throw new Error("Invalid input type.");for(let h=1;h<l.length;h++)if(l[0].type!==l[h].type)throw new Error("Input types are not matched.")}},5723:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tile=void 0;let n=t(782),i=t(2039);e.tile=(l,u)=>{o(u);let h={name:"Tile",inputNames:["A"],inputTypes:[i.TextureType.unpacked]};return[l.run(Object.assign(Object.assign({},h),{get:()=>r(l,u,h)}),u)]};let r=(l,u,h)=>{let d=u[0].dims.slice(),c=new Array(d.length),a=[];for(let g=0;g<d.length;g++)c[g]=d[g]*u[1].numberData[g],a.push(`inputIdx[${g}] = int(mod(float(outputIdx[${g}]), ${d[g]}.));`);let f=c.length,p=`
      float process(int outputIdx[${f}]) {
        int inputIdx[${f}];
        ${a.join(`
`)}
        return _A(inputIdx);
      }
    `;return Object.assign(Object.assign({},h),{output:{dims:c,type:u[0].type,textureType:i.TextureType.unpacked},shaderSource:p})},o=l=>{if(!l||l.length!==2)throw new Error("Tile requires 2 input.");if(l[1].dims.length!==1)throw new Error("The second input shape must 1 dimension.");if(l[1].dims[0]!==l[0].dims.length)throw new Error("Invalid input shape.");if(n.NUMBER_TYPES.indexOf(l[0].type)===-1)throw new Error("Invalid input type.");if(l[1].type!=="int32"&&l[1].type!=="int16")throw new Error("Invalid repeat type.")}},3738:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseTransposeAttributes=e.transpose=void 0;let n=t(246),i=t(2517),r=t(2039),o={name:"Transpose",inputNames:["A"],inputTypes:[r.TextureType.unpacked]};e.transpose=(a,f,p)=>(c(f),[a.run(Object.assign(Object.assign({},o),{cacheHint:p.cacheKey,get:()=>l(a,f[0],p.perm)}),f)]),e.parseTransposeAttributes=a=>(0,n.createAttributeWithCacheKey)({perm:a.attributes.getInts("perm",[])});let l=(a,f,p)=>{let g=f.dims;p=u(g,p);let m=h(g,p),y=g.length,_=`
      ${d("perm",p,y)}
      float process(int indices[${y}]) {
        int a[${y}];
        perm(a, indices);
        return _A(a);
      }`;return Object.assign(Object.assign({},o),{output:{dims:m,type:f.type,textureType:r.TextureType.unpacked},shaderSource:_})},u=(a,f)=>(f&&f.length!==a.length&&(f=[...a.keys()].reverse()),f),h=(a,f)=>(f=u(a,f),i.ShapeUtil.sortBasedOnPerm(a,f)),d=(a,f,p)=>{let g=[];g.push(`void ${a}(out int a[${p}], int src[${p}]) {`);for(let m=0;m<p;++m)g.push(`	a[${f[m]}]=src[${m}];`);return g.push("	}"),g.join(`
`)},c=a=>{if(!a||a.length!==1)throw new Error("Transpose requires 1 input.");if(a[0].type!=="float32"&&a[0].type!=="float64")throw new Error("input should be float tensor")}},8710:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.encodeAsUint8=void 0;let n=t(5060),i=t(2039);e.encodeAsUint8=(r,o)=>{let l=o.shape,u=(0,n.getGlsl)(r.session.backend.glContext.version),h=`
    const float FLOAT_MAX = 1.70141184e38;
    const float FLOAT_MIN = 1.17549435e-38;

    bool isNaN(float val) {
      return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;
    }

    highp vec4 encodeAsUint8(highp float v) {
      if (isNaN(v)) {
        return vec4(255, 255, 255, 255);
      }

      highp float av = abs(v);

      if(av < FLOAT_MIN) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      } else if(v > FLOAT_MAX) {
        return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
      } else if(v < -FLOAT_MAX) {
        return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
      }

      highp vec4 c = vec4(0,0,0,0);

      highp float e = floor(log2(av));
      highp float m = exp2(fract(log2(av))) - 1.0;

      c[2] = floor(128.0 * m);
      m -= c[2] / 128.0;
      c[1] = floor(32768.0 * m);
      m -= c[1] / 32768.0;
      c[0] = floor(8388608.0 * m);

      highp float ebias = e + 127.0;
      c[3] = floor(ebias / 2.0);
      ebias -= c[3] * 2.0;
      c[2] += floor(ebias) * 128.0;

      c[3] += 128.0 * step(0.0, -v);

      return c / 255.0;
    }

    void main() {
      float value = ${u.texture2D}(X,TexCoords).r;
      ${u.output} = encodeAsUint8(value);
    }`,d={name:"Uint8Encode",inputTypes:[i.TextureType.unpacked],inputNames:["X"],output:{dims:l,type:o.tensor.type,textureType:i.TextureType.downloadUint8AsFloat},shaderSource:h,hasMain:!0};return r.executeProgram(d,[o.tensor])}},4909:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tanh=e.tan=e.sqrt=e.sin=e.sigmoid=e.relu=e.not=e.neg=e.log=e.parseLeakyReluAttributes=e.leakyRelu=e.identity=e.floor=e.exp=e.parseEluAttributes=e.elu=e.cos=e.ceil=e.clipV11=e.parseClipAttributes=e.clip=e.atan=e.asin=e.acos=e.abs=e.glslTanh=e.glslTan=e.glslSqrt=e.glslSigmoid=e.glslRelu=e.glslSin=e.glslNot=e.glslNeg=e.glslLog=e.glslLeakyRelu=e.glslIdentity=e.glslClip=e.glslFloor=e.glslExp=e.glslElu=e.glslCos=e.glslCeil=e.glslAtan=e.glslAsin=e.glslAcos=e.glslAbs=void 0;let n=t(246),i=t(2517),r=t(8520),o=t(5060),l=t(2039);function u(){return z("abs")}function h(){return z("acos")}function d(){return z("asin")}function c(){return z("atan")}function a(){return z("ceil")}function f(){return z("cos")}function p(M){let $="elu";return{body:`
  const float alpha = float(${M});

  float ${$}_(float a) {
    return a >= 0.0 ? a: (exp(a) - 1.0) * alpha;
  }
  vec4 ${$}_(vec4 v) {
    return vec4(${$}_(v.x), ${$}_(v.y), ${$}_(v.z), ${$}_(v.w));
  }
  `,name:$,type:r.FunctionType.ValueBased}}function g(){return z("exp")}function m(){return z("floor")}function y(M,$){let oe="clip";return{body:`
  const float min = float(${M});
  const float max = float(${$});

  float ${oe}_(float a) {
    return clamp(a, min, max);
  }
  vec4 ${oe}_(vec4 v) {
    return clamp(v, min, max);
  }
  `,name:oe,type:r.FunctionType.ValueBased}}function _(){let M="indentity";return{body:`
  float ${M}_(float a) {
    return a;
  }
  vec4 ${M}_(vec4 v) {
    return v;
  }
  `,name:M,type:r.FunctionType.ValueBased}}function x(M){let $="leakyRelu";return{body:`
  const float alpha = float(${M});

  float ${$}_(float a) {
    return a < 0.0 ? a * alpha : a;
  }
  vec4 ${$}_(vec4 v) {
    return vec4(${$}_(v.x), ${$}_(v.y), ${$}_(v.z), ${$}_(v.w));
  }
  `,name:$,type:r.FunctionType.ValueBased}}function E(){return z("log")}function S(){let M="neg";return{body:`
  float ${M}_(float a) {
    return -a;
  }
  vec4 ${M}_(vec4 v) {
    return -v;
  }
  `,name:M,type:r.FunctionType.ValueBased}}function T(){let M="not";return{body:`
  float ${M}_(float a) {
    return float( ! bool(a) );
  }
  bool ${M}_(bool a) {
    return !a;
  }
  vec4 ${M}_(vec4 v) {
    return vec4(!bool(v.x), !bool(v.y), !bool(v.z), !bool(v.w));
  }
  bvec4 ${M}_(bvec4 v) {
    return bvec4(!v.x, !v.y, !v.z, !v.w);
  }
  `,name:M,type:r.FunctionType.ValueBased}}function C(){return z("sin")}function I(){let M="relu";return{body:`
  float ${M}_(float a) {
    return max( a, 0.0 );
  }
  vec4 ${M}_(vec4 v) {
    return max( v, 0.0 );
  }
  `,name:M,type:r.FunctionType.ValueBased}}function A(){let M="sigmoid";return{body:`
  float ${M}_(float a) {
    return 1.0 / (1.0 + exp(-a));
  }
  vec4 ${M}_(vec4 v) {
    return 1.0 / (1.0 + exp(-v));
  }
  `,name:M,type:r.FunctionType.ValueBased}}function P(){return z("sqrt")}function F(){return z("tan")}function H(){let M="tanh";return{body:`
  float ${M}_(float a) {
    a = clamp(a, -10., 10.);
    a = exp(2.*a);
    return (a - 1.) / (a + 1.);
  }
  vec4 ${M}_(vec4 v) {
    v = clamp(v, -10., 10.);
    v = exp(2.*v);
    return (v - 1.) / (v + 1.);
  }
  `,name:M,type:r.FunctionType.ValueBased}}function z(M){return{body:`
  float ${M}_(float a) {
    return ${M}(a);
  }
  vec4 ${M}_(vec4 v) {
    return ${M}(v);
  }
  `,name:M,type:r.FunctionType.ValueBased}}e.glslAbs=u,e.glslAcos=h,e.glslAsin=d,e.glslAtan=c,e.glslCeil=a,e.glslCos=f,e.glslElu=p,e.glslExp=g,e.glslFloor=m,e.glslClip=y,e.glslIdentity=_,e.glslLeakyRelu=x,e.glslLog=E,e.glslNeg=S,e.glslNot=T,e.glslSin=C,e.glslRelu=I,e.glslSigmoid=A,e.glslSqrt=P,e.glslTan=F,e.glslTanh=H;let B=(M,$,oe,Z)=>{let le=M.session.pack?l.TextureType.packed:l.TextureType.unpacked,ae={name:oe.name,inputTypes:[le],inputNames:["A"],cacheHint:Z};return Object.assign(Object.assign({},ae),{get:()=>((be,Ce,Ze,Ae)=>{let Ie=be.session.pack?l.TextureType.packed:l.TextureType.unpacked,_e=(0,o.getGlsl)(be.session.backend.glContext.version);return Object.assign(Object.assign({},Ce),{output:{dims:Ze.dims,type:Ze.type,textureType:Ie},shaderSource:`
     ${Ae.body}
     void main() {
       vec4 v = ${_e.texture2D}(A, TexCoords);
       v = ${Ae.name}_(v);
       ${_e.output} = v;
     }
     `,hasMain:!0})})(M,ae,$,oe)})};e.abs=(M,$)=>[M.run(B(M,$[0],u()),$)],e.acos=(M,$)=>[M.run(B(M,$[0],h()),$)],e.asin=(M,$)=>[M.run(B(M,$[0],d()),$)],e.atan=(M,$)=>[M.run(B(M,$[0],c()),$)],e.clip=(M,$,oe)=>[M.run(B(M,$[0],y(oe.min,oe.max),oe.cacheKey),$)],e.parseClipAttributes=M=>(0,n.createAttributeWithCacheKey)({min:M.attributes.getFloat("min",i.MIN_CLIP),max:M.attributes.getFloat("max",i.MAX_CLIP)}),e.clipV11=(M,$)=>{let oe=V(M,$);return(0,e.clip)(M,[$[0]],oe)};let V=(M,$)=>{if($.length>=3&&(!M.session.isInitializer($[1].dataId)||!M.session.isInitializer($[2].dataId)))throw new Error("dynamic clip attributes are not allowed");let oe=$.length>=3?$[1].numberData[0]:i.MIN_CLIP,Z=$.length>=3?$[2].numberData[0]:i.MAX_CLIP;return(0,n.createAttributeWithCacheKey)({min:oe,max:Z})};e.ceil=(M,$)=>[M.run(B(M,$[0],a()),$)],e.cos=(M,$)=>[M.run(B(M,$[0],f()),$)],e.elu=(M,$,oe)=>[M.run(B(M,$[0],p(oe.alpha),oe.cacheKey),$)],e.parseEluAttributes=M=>(0,n.createAttributeWithCacheKey)({alpha:M.attributes.getFloat("alpha",1)}),e.exp=(M,$)=>[M.run(B(M,$[0],g()),$)],e.floor=(M,$)=>[M.run(B(M,$[0],m()),$)],e.identity=(M,$)=>[M.run(B(M,$[0],_()),$)],e.leakyRelu=(M,$,oe)=>[M.run(B(M,$[0],x(oe.alpha),oe.cacheKey),$)],e.parseLeakyReluAttributes=M=>(0,n.createAttributeWithCacheKey)({alpha:M.attributes.getFloat("alpha",.01)}),e.log=(M,$)=>[M.run(B(M,$[0],E()),$)],e.neg=(M,$)=>[M.run(B(M,$[0],S()),$)],e.not=(M,$)=>[M.run(B(M,$[0],T()),$)],e.relu=(M,$)=>[M.run(B(M,$[0],I()),$)],e.sigmoid=(M,$)=>[M.run(B(M,$[0],A()),$)],e.sin=(M,$)=>[M.run(B(M,$[0],C()),$)],e.sqrt=(M,$)=>[M.run(B(M,$[0],P()),$)],e.tan=(M,$)=>[M.run(B(M,$[0],F()),$)],e.tanh=(M,$)=>[M.run(B(M,$[0],H()),$)]},5611:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createUnpackProgramInfoLoader=e.createUnpackProgramInfo=void 0;let n=t(5060),i=t(2039),r=t(9390),o=t(2827),l={name:"unpack",inputNames:["A"],inputTypes:[i.TextureType.packed]};e.createUnpackProgramInfo=(u,h)=>{let d=h.dims.length,c=(0,o.getChannels)("rc",d),a=c.slice(-2),f=(0,r.getCoordsDataType)(d),p=(0,o.unpackFromChannel)(),g=h.dims.length===0?"":function(_,x){if(_===1)return"rc";let E="";for(let S=0;S<_;S++)E+=x[S],S<_-1&&(E+=",");return E}(d,c),m=d<=1?"rc":`vec2(${a.join(",")})`,y=`
    ${p}
    void main() {
      ${f} rc = getOutputCoords();

       // Sample the texture with the coords to get the rgba channel value.
       vec4 packedInput = getA(${g});

       ${(0,n.getGlsl)(u.session.backend.glContext.version).output} = vec4(getChannel(packedInput, ${m}), 0, 0, 0);
     }
   `;return Object.assign(Object.assign({},l),{hasMain:!0,output:{dims:h.dims,type:h.type,textureType:i.TextureType.unpacked},shaderSource:y})},e.createUnpackProgramInfoLoader=(u,h)=>Object.assign(Object.assign({},l),{get:()=>(0,e.createUnpackProgramInfo)(u,h)})},8428:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseUnsqueezeAttributes=e.unsqueezeV13=e.unsqueeze=void 0;let n=t(2517);e.unsqueeze=(o,l,u)=>{i(l);let h=n.ShapeUtil.unsqueezeShape(l[0].dims,u);return[o.reshapeUnpacked(l[0],h)]},e.unsqueezeV13=(o,l)=>(r(l),(0,e.unsqueeze)(o,[l[0]],Array.from(l[1].integerData))),e.parseUnsqueezeAttributes=o=>o.attributes.getInts("axes");let i=o=>{if(!o||o.length!==1)throw new Error("Unsqueeze requires 1 input.");if(o[0].type==="string")throw new Error("invalid input tensor types.")},r=o=>{if(!o||o.length!==2)throw new Error("Unsqueeze requires 2 inputs.");if(o[1].type!=="int32")throw new Error("Invalid input type.")}},9793:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.scalesValidation=e.validateInputs=e.parseUpsampleAttributes=e.parseUpsampleAttributesV9=e.parseUpsampleAttributesV7=e.upsample=void 0;let n=t(246),i=t(5060),r=t(2039),o={name:"Upsample",inputNames:["X"],inputTypes:[r.TextureType.unpacked]};e.upsample=(u,h,d)=>((0,e.validateInputs)(h,d),[u.run(Object.assign(Object.assign({},o),{cacheHint:d.cacheKey,get:()=>l(u,h,d)}),h)]),e.parseUpsampleAttributesV7=u=>(0,e.parseUpsampleAttributes)(u,7),e.parseUpsampleAttributesV9=u=>(0,e.parseUpsampleAttributes)(u,9),e.parseUpsampleAttributes=(u,h)=>{let d=h>=10,c=u.attributes.getString("mode","nearest");if(c!=="nearest"&&c!=="linear"&&(h<11||c!=="cubic"))throw new Error(`unrecognized mode: ${c}`);let a=[];h<9&&(a=u.attributes.getFloats("scales"),(0,e.scalesValidation)(a,c,d));let f=u.attributes.getFloat("extrapolation_value",0),p=h>10?u.attributes.getString("coordinate_transformation_mode","half_pixel"):"asymmetric";if(["asymmetric","pytorch_half_pixel","tf_half_pixel_for_nn","align_corners","tf_crop_and_resize","half_pixel"].indexOf(p)===-1)throw new Error(`coordinate_transform_mode '${p}' is not supported`);let g=p==="tf_crop_and_resize",m=g,y=c==="nearest"&&h>=11?u.attributes.getString("nearest_mode","round_prefer_floor"):"";if(["round_prefer_floor","round_prefer_ceil","floor","ceil",""].indexOf(y)===-1)throw new Error(`nearest_mode '${y}' is not supported`);let _=u.attributes.getFloat("cubic_coeff_a",-.75),x=u.attributes.getInt("exclude_outside",0)!==0;if(x&&c!=="cubic")throw new Error("exclude_outside can be set to 1 only when mode is CUBIC.");let E=h<11||c==="nearest"&&p==="asymmetric"&&y==="floor",S=0,T=0,C=0;return h>10?u.inputs.length>2?(S=1,T=2,C=3):(T=1,C=2):h===9&&(T=1),(0,n.createAttributeWithCacheKey)({opset:h,isResize:d,mode:c,scales:a,extrapolationValue:f,coordinateTransformMode:p,useExtrapolation:m,needRoiInput:g,nearestMode:y,cubicCoefficientA:_,excludeOutside:x,useNearest2xOptimization:E,roiInputIdx:S,scalesInputIdx:T,sizesInputIdx:C})};let l=(u,h,d)=>{let c=(0,i.getGlsl)(u.session.backend.glContext.version),[a,f]=u.calculateTextureWidthAndHeight(h[0].dims,r.TextureType.unpacked),p=h[0].dims.map((C,I)=>Math.floor(C*d.scales[I])),[g,m]=u.calculateTextureWidthAndHeight(p,r.TextureType.unpacked),y=p.length,_=new Array(y),x=new Array(y),E=`
      int output_pitches[${y}];
      int input_pitches[${y}];
      `;for(let C=y-1;C>=0;C--)_[C]=C===y-1?1:_[C+1]*p[C+1],x[C]=C===y-1?1:x[C+1]*h[0].dims[C+1],E+=`
        output_pitches[${C}] = ${_[C]};
        input_pitches[${C}] = ${x[C]};
        `;let S=`
      float getInputFloat(int index) {
        vec2 coords = offsetToCoords(index, ${a}, ${f});
        float value = getColorAsFloat(${c.texture2D}(X, coords));
        return value;
      }
      `,T=d.mode==="nearest"?`
    ${S}
    float process(int indices[${y}]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${g}, ${m});

      ${E}

      int d, m;
      for (int dim = 0; dim < ${y}; ++dim) {
        d = output_index / output_pitches[dim];
        m = output_index - d * output_pitches[dim];
        output_index = m;

        if (scales[dim] != 1 && d > 0) {
          int d2 = d / scales[dim];
          m = d - d2 * scales[dim];
          d = d2;
        }
        input_index += input_pitches[dim] * d;
      }

      return getInputFloat(input_index);
    }`:y===4?`
    ${S}
    float process(int indices[4]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${g}, ${m});

      ${E}

      int m;
      int index_of_dim0, index_of_dim1, index_of_dim2, index_of_dim3;
      index_of_dim0 = output_index / output_pitches[0];
      m = output_index - index_of_dim0 * output_pitches[0];
      index_of_dim1 = m / output_pitches[1];
      m = m - index_of_dim1 * output_pitches[1];
      index_of_dim2 = m / output_pitches[2];
      m = m - index_of_dim2 * output_pitches[2];
      index_of_dim3 = m;

      int index_of_input_dim2, index_of_input_dim3, x_offset, y_offset;
      index_of_input_dim2 = index_of_dim2 / scales[2];
      y_offset = index_of_dim2 - index_of_input_dim2 * scales[2];
      index_of_input_dim3 = index_of_dim3 / scales[3];
      x_offset = index_of_dim3 - index_of_input_dim3 * scales[3];

      input_index = index_of_dim0 * input_pitches[0] +
            index_of_dim1 * input_pitches[1] +
            index_of_input_dim2 * input_pitches[2] +
            index_of_input_dim3;

      float x00 = getInputFloat(input_index);
      float x10, x01, x11;

      bool end_of_dim2 = false;
      if (index_of_input_dim2 == (${h[0].dims[2]} - 1)) {
        // It's the end in dimension 2
        x01 = x00;
        end_of_dim2 = true;
      } else {
        x01 = getInputFloat(input_index + input_pitches[2]);
      }

      if (index_of_input_dim3 == (input_pitches[2] - 1)) {
        // It's the end in dimension 3
        x10 = x00;
        x11 = x01;
      }
      else {
        x10 = getInputFloat(input_index + 1);
        x11 = end_of_dim2 ? x10 : getInputFloat(input_index + input_pitches[2] + 1);
      }

      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[2]);
      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[2]);
      return y0 + float(x_offset) * (y1 - y0) / float(scales[3]);
    }`:`
    ${S}
    float process(int indices[2]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${g}, ${m});

      ${E}

      int m;
      int index_of_dim0, index_of_dim1;
      index_of_dim0 = output_index / output_pitches[0];
      m = output_index - index_of_dim0 * output_pitches[0];
      index_of_dim1 = m;

      int index_of_input_dim0, index_of_input_dim1, x_offset, y_offset;
      index_of_input_dim0 = index_of_dim0 / scales[0];
      y_offset = index_of_dim0 - index_of_input_dim0 * scales[0];
      index_of_input_dim1 = index_of_dim1 / scales[1];
      x_offset = index_of_dim1 - index_of_input_dim1 * scales[1];

      input_index = index_of_input_dim0 * input_pitches[0] + index_of_input_dim1;

      float x00 = getInputFloat(input_index);
      float x10, x01, x11;

      bool end_of_dim0 = false;
      if (index_of_input_dim0 == (${h[0].dims[0]} - 1)) {
        // It's the end in dimension 0
        x01 = x00;
        end_of_dim0 = true;
      } else {
        x01 = getInputFloat(input_index + input_pitches[0]);
      }

      if (index_of_input_dim1 == (input_pitches[0] - 1)) {
        // It's the end in dimension 1
        x10 = x00;
        x11 = x01;
      }
      else {
        x10 = getInputFloat(input_index + 1);
        x11 = end_of_dim0 ? x10 : getInputFloat(input_index + input_pitches[0] + 1);
      }

      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[0]);
      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[0]);
      return y0 + float(x_offset) * (y1 - y0) / float(scales[1]);
    }`;return Object.assign(Object.assign({},o),{output:{dims:p,type:h[0].type,textureType:r.TextureType.unpacked},shaderSource:T,variables:[{name:"scales",type:"int",arrayLength:d.scales.length,data:d.scales.map(C=>Math.ceil(C))}]})};e.validateInputs=(u,h)=>{if(!u||h.opset<9&&u.length!==1||h.opset>=9&&h.opset<11&&u.length!==2||h.opset>=11&&u.length<2)throw new Error("invalid inputs.");if(h.scales.length>0&&u[0].dims.length!==h.scales.length)throw new Error("Invalid input shape.");if(u[0].type==="string")throw new Error("Invalid input tensor types.")},e.scalesValidation=(u,h,d)=>{if(d){for(let c of u)if(c<=0)throw new Error("Scale value should be greater than 0.")}else for(let c of u)if(c<1)throw new Error("Scale value should be greater than or equal to 1.");if(!(h!=="linear"&&h!=="cubic"||u.length===2||u.length===4&&u[0]===1&&u[1]===1))throw new Error(`'Linear' mode and 'Cubic' mode only support 2-D inputs ('Bilinear', 'Bicubic')         or 4-D inputs with the corresponding outermost 2 scale values being 1         in the ${d?"Resize":"Upsample"} opeartor.`)}},1958:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ProgramManager=void 0;let n=t(1670),i=t(6231),r=t(8879),o=t(5060);e.ProgramManager=class{constructor(l,u,h){this.profiler=l,this.glContext=u,this.textureLayoutStrategy=h,this.repo=new Map,this.attributesBound=!1}getArtifact(l){return this.repo.get(l)}setArtifact(l,u){this.repo.set(l,u)}run(l,u,h){var d;this.profiler.event("op",`ProgramManager.run ${(d=l.programInfo.name)!==null&&d!==void 0?d:"unknown kernel"}`,()=>{var c;let a=this.glContext.gl,f=l.program;a.useProgram(f);try{this.bindOutput(h),this.attributesBound||this.bindAttributes(l.attribLocations),this.bindUniforms(l.uniformLocations,(c=l.programInfo.variables)!==null&&c!==void 0?c:[],u)}catch(p){throw i.Logger.error("ProgramManager",l.programInfo.shaderSource),p}this.profiler.event("backend","GlContext.draw()",()=>{this.glContext.draw()})},this.glContext)}dispose(){this.vertexShader&&this.glContext.deleteShader(this.vertexShader),this.repo.forEach(l=>this.glContext.deleteProgram(l.program))}build(l,u,h){return this.profiler.event("backend","ProgramManager.build",()=>{let d=new r.GlslPreprocessor(this.glContext,l,u,h),c=d.preprocess(),a=this.compile(c);return{programInfo:l,program:a,uniformLocations:this.getUniformLocations(a,d.context.programInfo.inputNames,d.context.programInfo.variables),attribLocations:this.getAttribLocations(a)}})}compile(l){if(!this.vertexShader){i.Logger.verbose("ProrgramManager","Compiling and caching Vertex shader for the first time");let d=(0,o.getVertexShaderSource)(this.glContext.version);this.vertexShader=this.glContext.compileShader(d,this.glContext.gl.VERTEX_SHADER)}n.env.debug&&i.Logger.verbose("ProrgramManager",`FragShader:
${l}
`);let u=this.glContext.compileShader(l,this.glContext.gl.FRAGMENT_SHADER),h=this.glContext.createProgram(this.vertexShader,u);return this.glContext.deleteShader(u),h}bindOutput(l){let u=l.width,h=l.height;i.Logger.verbose("ProrgramManager",`Binding output texture to Framebuffer: w/h=${u}/${h}, shape=${l.shape}, type=${l.tensor.type}`),this.glContext.attachFramebuffer(l.texture,u,h)}bindAttributes(l){let u=l.position,h=l.textureCoord;this.glContext.setVertexAttributes(u,h),this.attributesBound=!0}bindUniforms(l,u,h){var d;let c=this.glContext.gl,a=0;for(let{name:f,type:p,location:g,arrayLength:m}of l){let y=(d=u.find(_=>_.name===f))===null||d===void 0?void 0:d.data;if(p!=="sampler2D"&&!y)throw new Error(`variable '${f}' does not have data defined in program info`);switch(p){case"sampler2D":this.bindTexture(h[a],g,a),a++;break;case"float":m?c.uniform1fv(g,y):c.uniform1f(g,y);break;case"int":m?c.uniform1iv(g,y):c.uniform1i(g,y);break;default:throw new Error(`Uniform not implemented: ${p}`)}}}bindTexture(l,u,h){this.glContext.bindTextureToUniform(l.texture,h,u)}getAttribLocations(l){return{position:this.getAttribLocation(l,"position"),textureCoord:this.getAttribLocation(l,"textureCoord")}}getUniformLocations(l,u,h){let d=[];if(u)for(let c of u)d.push({name:c,type:"sampler2D",location:this.getUniformLocation(l,c)});if(h)for(let c of h)d.push(Object.assign(Object.assign({},c),{location:this.getUniformLocation(l,c.name)}));return d}getUniformLocation(l,u){let h=this.glContext.gl.getUniformLocation(l,u);if(h===null)throw new Error(`Uniform ${u} not found.`);return h}getAttribLocation(l,u){return this.glContext.gl.getAttribLocation(l,u)}}},6416:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLSessionHandler=void 0;let n=t(6231),i=t(1047),r=t(8316),o=t(1640),l=t(1958),u=t(7859),h=t(5702);e.WebGLSessionHandler=class{constructor(d,c){this.backend=d,this.context=c,this.layoutStrategy=new u.PreferLogicalStrategy(d.glContext.maxTextureSize),this.programManager=new l.ProgramManager(this.context.profiler,d.glContext,this.layoutStrategy),this.textureManager=new h.TextureManager(d.glContext,this.layoutStrategy,this.context.profiler,{reuseTextures:d.textureCacheMode==="full"}),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map,this.pack=d.pack,this.pack2unpackMap=new Map,this.unpack2packMap=new Map}createInferenceHandler(){return new r.WebGLInferenceHandler(this)}onGraphInitialized(d){let c=d.getValues().filter(a=>a.from===-1&&a.tensor).map(a=>a.tensor.dataId);this.initializers=new Set(c)}isInitializer(d){return!!this.initializers&&this.initializers.has(d)}addInitializer(d){this.initializers.add(d)}getTextureData(d,c){return c?this.packedTextureDataCache.get(d):this.unpackedTextureDataCache.get(d)}setTextureData(d,c,a=!1){n.Logger.verbose("WebGLSessionHandler","Storing Texture data in cache"),a?this.packedTextureDataCache.set(d,c):this.unpackedTextureDataCache.set(d,c)}dispose(){this.programManager.dispose(),this.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach(d=>this.textureManager.releaseTexture(d,!0)),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach(d=>this.textureManager.releaseTexture(d,!0)),this.unpackedTextureDataCache=new Map}resolve(d,c,a){let f=(0,i.resolveOperator)(d,c,o.WEBGL_OP_RESOLVE_RULES);return{impl:f.opImpl,context:f.opInit?f.opInit(d,a):d}}}},7769:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Uint8DataEncoder=e.RGBAFloatDataEncoder=e.RedFloat32DataEncoder=void 0;let n=t(6231);e.RedFloat32DataEncoder=class{constructor(i,r=1){if(r===1)this.internalFormat=i.R32F,this.format=i.RED,this.textureType=i.FLOAT,this.channelSize=r;else{if(r!==4)throw new Error(`Invalid number of channels: ${r}`);this.internalFormat=i.RGBA32F,this.format=i.RGBA,this.textureType=i.FLOAT,this.channelSize=r}}encode(i,r){let o,l;return i.constructor!==Float32Array&&(n.Logger.warning("Encoder","data was not of type Float32; creating new Float32Array"),l=new Float32Array(i)),r*this.channelSize>i.length?(n.Logger.warning("Encoder","Source data too small. Allocating larger array"),l=i,o=this.allocate(r*this.channelSize),l.forEach((u,h)=>o[h]=u)):(l=i,o=l),o}allocate(i){return new Float32Array(4*i)}decode(i,r){return this.channelSize===1?i.filter((o,l)=>l%4==0).subarray(0,r):i.subarray(0,r)}},e.RGBAFloatDataEncoder=class{constructor(i,r=1,o){if(r!==1&&r!==4)throw new Error(`Invalid number of channels: ${r}`);this.internalFormat=i.RGBA,this.format=i.RGBA,this.channelSize=r,this.textureType=o||i.FLOAT}encode(i,r){let o=i;return this.channelSize===1&&(n.Logger.verbose("Encoder","Exploding into a larger array"),o=this.allocate(r),i.forEach((l,u)=>o[4*u]=l)),o}allocate(i){return new Float32Array(4*i)}decode(i,r){return this.channelSize===1?i.filter((o,l)=>l%4==0).subarray(0,r):i.subarray(0,r)}},e.Uint8DataEncoder=class{constructor(i,r=1){if(this.channelSize=4,r===1)this.internalFormat=i.ALPHA,this.format=i.ALPHA,this.textureType=i.UNSIGNED_BYTE,this.channelSize=r;else{if(r!==4)throw new Error(`Invalid number of channels: ${r}`);this.internalFormat=i.RGBA,this.format=i.RGBA,this.textureType=i.UNSIGNED_BYTE,this.channelSize=r}}encode(i,r){return new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}allocate(i){return new Uint8Array(i*this.channelSize)}decode(i,r){if(i instanceof Uint8Array)return i.subarray(0,r);throw new Error(`Invalid array type: ${i.constructor}`)}}},7859:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getBatchDim=e.sizeToSquarishShape=e.getRowsCols=e.sizeFromShape=e.isInt=e.parseAxisParam=e.squeezeShape=e.PreferLogicalStrategy=e.AlwaysKeepOriginalSizeStrategy=void 0;let n=t(6231),i=t(2517);function r(d,c){let a=[],f=[],p=c!=null&&Array.isArray(c)&&c.length===0,g=c==null||p?null:o(c,d).sort(),m=0;for(let y=0;y<d.length;++y){if(g!=null){if(g[m]===y&&d[y]!==1)throw new Error(`Can't squeeze axis ${y} since its dim '${d[y]}' is not 1`);(g[m]==null||g[m]>y)&&d[y]===1&&(a.push(d[y]),f.push(y)),g[m]<=y&&m++}d[y]!==1&&(a.push(d[y]),f.push(y))}return{newShape:a,keptDims:f}}function o(d,c){let a=c.length;return d=d==null?c.map((f,p)=>p):[].concat(d),(0,i.assert)(d.every(f=>f>=-a&&f<a),()=>`All values in axis param must be in range [-${a}, ${a}) but got axis ${d}`),(0,i.assert)(d.every(l),()=>`All values in axis param must be integers but got axis ${d}`),d.map(f=>f<0?a+f:f)}function l(d){return d%1==0}function u(d){if(d.length===0)return 1;let c=d[0];for(let a=1;a<d.length;a++)c*=d[a];return c}function h(d){let c=Math.ceil(Math.sqrt(d));return[c,Math.ceil(d/c)]}e.AlwaysKeepOriginalSizeStrategy=class{constructor(d){this.maxTextureSize=d}computeTextureWH(d,c){if(d.length===0)return[1,1];let a=this.maxTextureSize;if(c&&c.breakAxis!==void 0){let g=c.breakAxis>=d.length?1:d.slice(c.breakAxis).reduce((y,_)=>y*_),m=c.breakAxis<=0?1:d.slice(0,c.breakAxis).reduce((y,_)=>y*_);if(!(g>a||m>a))return[g,m];n.Logger.verbose("TextureLayout",`Given width/height preferences were unattainable: shape:${d}, breakAxis:${c.breakAxis}`)}let f=d.reduce((g,m)=>g*m),p=Math.floor(Math.sqrt(f));for(;p<a&&p<f&&f%p!=0;p++);if(p>=a||f%p!=0)throw new Error(`The given dimensions are outside this GPU's boundaries: ${d}`);return[p,f/p]}},e.PreferLogicalStrategy=class{constructor(d){this.maxTextureSize=d}computeTextureWH(d,c){let a=this.computeTexture(d,c);return c&&c.isPacked&&(a[0]/=2,a[1]/=2),c&&c.reverseWH?[a[1],a[0]]:a}computeTexture(d,c){let a=c&&c.isPacked;if(d.length===0)return a?[2,2]:[1,1];let f=this.maxTextureSize;if(c&&c.breakAxis!==void 0){let m=c.breakAxis>=d.length?1:d.slice(c.breakAxis).reduce((_,x)=>_*x),y=c.breakAxis<=0?1:d.slice(0,c.breakAxis).reduce((_,x)=>_*x);if(!(m>f||y>f))return[m,y];n.Logger.verbose("TextureLayout",`Given width/height preferences were unattainable: shape:${d}, breakAxis:${c.breakAxis}`)}let p=d.slice(0);a&&(f*=2,p=p.map((m,y)=>y>=p.length-2?p[y]%2==0?p[y]:p[y]+1:p[y]),p.length===1&&(p=[2,p[0]])),p.length!==2&&(p=r(p).newShape);let g=u(p);return p.length<=1&&g<=f?[1,g]:p.length===2&&p[0]<=f&&p[1]<=f?p:p.length===3&&p[0]*p[1]<=f&&p[2]<=f?[p[0]*p[1],p[2]]:p.length===3&&p[0]<=f&&p[1]*p[2]<=f?[p[0],p[1]*p[2]]:p.length===4&&p[0]*p[1]*p[2]<=f&&p[3]<=f?[p[0]*p[1]*p[2],p[3]]:p.length===4&&p[0]<=f&&p[1]*p[2]*p[3]<=f?[p[0],p[1]*p[2]*p[3]]:a?h(g/4).map(m=>2*m):h(g)}},e.squeezeShape=r,e.parseAxisParam=o,e.isInt=l,e.sizeFromShape=u,e.getRowsCols=function(d){if(d.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[d.length>1?d[d.length-2]:1,d[d.length-1]]},e.sizeToSquarishShape=h,e.getBatchDim=function(d,c=2){return u(d.slice(0,d.length-c))}},4057:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createTextureLayoutFromShape=e.calculateTextureWidthAndHeight=e.createTextureLayoutFromTextureType=void 0;let n=t(2517),i=t(2039);e.createTextureLayoutFromTextureType=(r,o,l)=>{let u=l===i.TextureType.unpacked||l===i.TextureType.unpackedReversed?1:4,h=l===i.TextureType.packed,d=l===i.TextureType.unpackedReversed||l===i.TextureType.packed,c=l===i.TextureType.packedLastDimension?o.length-1:void 0,a=l===i.TextureType.packedLastDimension?o.map((f,p)=>p===o.length-1?4*f:f):void 0;return(0,e.createTextureLayoutFromShape)(r,o,u,a,{isPacked:h,reverseWH:d,breakAxis:c})},e.calculateTextureWidthAndHeight=(r,o,l)=>{let u=(0,e.createTextureLayoutFromTextureType)(r,o,l);return[u.width,u.height]},e.createTextureLayoutFromShape=(r,o,l=1,u,h)=>{let d=!(!h||!h.isPacked),[c,a]=r.computeTextureWH(d&&u||o,h),f=o.length,p=o.slice(0);if(f===0&&(p=[1]),l===1)u=o;else if(d){if(l!==4)throw new Error("a packed texture must be 4-channel");u=o,f>0&&(p[f-1]=Math.ceil(p[f-1]/2)),f>1&&(p[f-2]=Math.ceil(p[f-2]/2))}else if(!u)throw new Error("Unpacked shape is needed when using channels > 1");return{width:c,height:a,channels:l,isPacked:d,shape:p,strides:n.ShapeUtil.computeStrides(p),unpackedShape:u,reversedWH:h&&h.reverseWH}}},5702:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextureManager=void 0;let n=t(6231);e.TextureManager=class{constructor(i,r,o,l){this.glContext=i,this.layoutStrategy=r,this.profiler=o,this.config=l,this.pendingRead=new Map,l.reuseTextures&&(this.inUseTextures=new Map,this.idleTextures=new Map,this.textureLookup=new Map)}createTextureFromLayout(i,r,o,l){let u=this.toEncoderType(i),h=this.glContext.getEncoder(u,r.channels||1,l);if(r.isPacked&&l===1)throw new Error("not implemented");let d=r.width,c=r.height,a,f;if(this.config.reuseTextures){a=`${d}x${c}_${h.format}_${h.internalFormat}_${h.textureType}`,f=this.inUseTextures.get(a),f||(f=[],this.inUseTextures.set(a,f));let g=this.idleTextures.get(a);if(g&&g.length>0){let m=g.pop();return f.push(m),l===1&&this.glContext.updateTexture(m,d,c,h,this.toTextureData(i,o)),m}}n.Logger.verbose("TextureManager",`Creating new texture of size ${r.width}x${r.height}`);let p=this.glContext.allocateTexture(d,c,h,this.toTextureData(i,o));return this.config.reuseTextures&&(f.push(p),this.textureLookup.set(p,a)),p}readTexture(i,r,o){return o||(o=1),this.profiler.event("backend","TextureManager.readTexture",()=>{let l=i.shape.reduce((h,d)=>h*d)*o,u=this.glContext.readTexture(i.texture,i.width,i.height,l,this.toEncoderType(r),o);return this.toTensorData(r,u)})}async readTextureAsync(i,r,o){let l=i.tensor.dataId;if(o||(o=1),this.pendingRead.has(l)){let u=this.pendingRead.get(l);return new Promise(h=>u?.push(h))}return this.profiler.event("backend","TextureManager.readTextureAsync",async()=>{this.pendingRead.set(l,[]);let u=i.shape.reduce((a,f)=>a*f)*o;await this.glContext.createAndWaitForFence();let h=this.glContext.readTexture(i.texture,i.width,i.height,u,this.toEncoderType(r),o),d=this.toTensorData(r,h),c=this.pendingRead.get(l);return this.pendingRead.delete(l),c?.forEach(a=>a(d)),d})}readUint8TextureAsFloat(i){return this.profiler.event("backend","TextureManager.readUint8TextureAsFloat",()=>{let r=i.shape.reduce((l,u)=>l*u),o=this.glContext.readTexture(i.texture,i.width,i.height,4*r,"byte",4);return new Float32Array(o.buffer,o.byteOffset,r)})}releaseTexture(i,r){let o;if(this.config.reuseTextures&&(o=this.textureLookup.get(i.texture),o)){r&&this.textureLookup.delete(o);let l=this.inUseTextures.get(o);if(l){let u=l.indexOf(i.texture);if(u!==-1){l.splice(u,1);let h=this.idleTextures.get(o);h||(h=[],this.idleTextures.set(o,h)),h.push(i.texture)}}}o&&!r||(n.Logger.verbose("TextureManager",`Deleting texture of size ${i.width}x${i.height}`),this.glContext.deleteTexture(i.texture))}toTensorData(i,r){switch(i){case"int16":return r instanceof Int16Array?r:Int16Array.from(r);case"int32":return r instanceof Int32Array?r:Int32Array.from(r);case"int8":return r instanceof Int8Array?r:Int8Array.from(r);case"uint16":return r instanceof Uint16Array?r:Uint16Array.from(r);case"uint32":return r instanceof Uint32Array?r:Uint32Array.from(r);case"uint8":case"bool":return r instanceof Uint8Array?r:Uint8Array.from(r);case"float32":return r instanceof Float32Array?r:Float32Array.from(r);case"float64":return r instanceof Float64Array?r:Float64Array.from(r);default:throw new Error(`TensorData type ${i} is not supported`)}}toTextureData(i,r){if(r)return r instanceof Float32Array?r:new Float32Array(r)}toEncoderType(i){return"float"}clearActiveTextures(){this.glContext.clearActiveTextures()}}},2039:(s,e)=>{"use strict";var t;Object.defineProperty(e,"__esModule",{value:!0}),e.TextureType=void 0,(t=e.TextureType||(e.TextureType={}))[t.unpacked=0]="unpacked",t[t.unpackedReversed=1]="unpackedReversed",t[t.packed=2]="packed",t[t.downloadUint8AsFloat=3]="downloadUint8AsFloat",t[t.packedLastDimension=4]="packedLastDimension"},9390:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getGlChannels=e.getCoordsDataType=e.getSqueezedParams=e.squeezeInputShape=e.generateShaderFuncNameFromInputSamplerNameAtOutCoords=e.generateShaderFuncNameFromInputSamplerName=e.repeatedTry=e.getPackedShape=void 0;let n=t(2517);e.getPackedShape=function(i){let r=i.length;return i.slice(0,r-1).concat(i[r-1]/4)},e.repeatedTry=async function(i,r=l=>0,o){return new Promise((l,u)=>{let h=0,d=()=>{if(i())return void l();h++;let c=r(h);o!=null&&h>=o?u():setTimeout(d,c)};d()})},e.generateShaderFuncNameFromInputSamplerName=function(i){return(0,n.assert)(i!==void 0&&i.length!==0,()=>"empty string found for sampler name"),"get"+i.charAt(0).toUpperCase()+i.slice(1)},e.generateShaderFuncNameFromInputSamplerNameAtOutCoords=function(i){return(0,n.assert)(i!==void 0&&i.length!==0,()=>"empty string found for sampler name"),"get"+i.charAt(0).toUpperCase()+i.slice(1)+"AtOutCoords"},e.squeezeInputShape=function(i,r){let o=JSON.parse(JSON.stringify(i));return o=r,o},e.getSqueezedParams=function(i,r){return r.map(o=>i[o]).join(", ")},e.getCoordsDataType=function(i){if(i<=1)return"int";if(i===2)return"ivec2";if(i===3)return"ivec3";if(i===4)return"ivec4";if(i===5)return"ivec5";if(i===6)return"ivec6";throw Error(`GPU for rank ${i} is not yet supported`)},e.getGlChannels=function(i=6){return["x","y","z","w","u","v"].slice(0,i)}},7305:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createNewWebGLContext=e.createWebGLContext=void 0;let n=t(6231),i=t(1713),r={};function o(l){let u=function(){if(typeof document>"u"){if(typeof OffscreenCanvas>"u")throw new TypeError("failed to create canvas: OffscreenCanvas is not supported");return new OffscreenCanvas(1,1)}let c=document.createElement("canvas");return c.width=1,c.height=1,c}(),h,d={alpha:!1,depth:!1,antialias:!1,stencil:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!1,failIfMajorPerformanceCaveat:!1};if((!l||l==="webgl2")&&(h=u.getContext("webgl2",d),h))try{return new i.WebGLContext(h,2)}catch(c){n.Logger.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl2'. Error: ${c}`)}if((!l||l==="webgl")&&(h=u.getContext("webgl",d)||u.getContext("experimental-webgl",d),h))try{return new i.WebGLContext(h,1)}catch(c){n.Logger.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl' or 'experimental-webgl'. Error: ${c}`)}throw new Error("WebGL is not supported")}e.createWebGLContext=function l(u){let h;u&&u!=="webgl2"||!("webgl2"in r)?u&&u!=="webgl"||!("webgl"in r)||(h=r.webgl):h=r.webgl2,h=h||o(u),u=u||h.version===1?"webgl":"webgl2";let d=h.gl;return r[u]=h,d.isContextLost()?(delete r[u],l(u)):(d.disable(d.DEPTH_TEST),d.disable(d.STENCIL_TEST),d.disable(d.BLEND),d.disable(d.DITHER),d.disable(d.POLYGON_OFFSET_FILL),d.disable(d.SAMPLE_COVERAGE),d.enable(d.SCISSOR_TEST),d.enable(d.CULL_FACE),d.cullFace(d.BACK),h)},e.createNewWebGLContext=o},1713:function(s,e,t){"use strict";var n=this&&this.__createBinding||(Object.create?function(d,c,a,f){f===void 0&&(f=a);var p=Object.getOwnPropertyDescriptor(c,a);p&&!("get"in p?!c.__esModule:p.writable||p.configurable)||(p={enumerable:!0,get:function(){return c[a]}}),Object.defineProperty(d,f,p)}:function(d,c,a,f){f===void 0&&(f=a),d[f]=c[a]}),i=this&&this.__setModuleDefault||(Object.create?function(d,c){Object.defineProperty(d,"default",{enumerable:!0,value:c})}:function(d,c){d.default=c}),r=this&&this.__importStar||function(d){if(d&&d.__esModule)return d;var c={};if(d!=null)for(var a in d)a!=="default"&&Object.prototype.hasOwnProperty.call(d,a)&&n(c,d,a);return i(c,d),c};Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLContext=e.linearSearchLastTrue=void 0;let o=t(1670),l=r(t(7769)),u=t(9390);function h(d){let c=0;for(;c<d.length&&d[c]();++c);return c-1}e.linearSearchLastTrue=h,e.WebGLContext=class{constructor(d,c){this.frameBufferBound=!1,this.itemsToPoll=[],this.gl=d,this.version=c,this.getExtensions(),this.vertexbuffer=this.createVertexbuffer(),this.framebuffer=this.createFramebuffer(),this.queryVitalParameters()}allocateTexture(d,c,a,f){let p=this.gl,g=p.createTexture();p.bindTexture(p.TEXTURE_2D,g),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);let m=f?a.encode(f,d*c):null;return p.texImage2D(p.TEXTURE_2D,0,a.internalFormat,d,c,0,a.format,a.textureType,m),this.checkError(),g}updateTexture(d,c,a,f,p){let g=this.gl;g.bindTexture(g.TEXTURE_2D,d);let m=f.encode(p,c*a);g.texSubImage2D(g.TEXTURE_2D,0,0,0,c,a,f.format,f.textureType,m),this.checkError()}attachFramebuffer(d,c,a){let f=this.gl;f.bindTexture(f.TEXTURE_2D,d),f.bindFramebuffer(f.FRAMEBUFFER,this.framebuffer),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,d,0),this.checkError(),f.viewport(0,0,c,a),f.scissor(0,0,c,a)}readTexture(d,c,a,f,p,g){let m=this.gl;g||(g=1),this.frameBufferBound||this.attachFramebuffer(d,c,a);let y=this.getEncoder(p,g),_=y.allocate(c*a);return m.bindTexture(m.TEXTURE_2D,d),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,d,0),m.readPixels(0,0,c,a,m.RGBA,y.textureType,_),this.checkError(),y.decode(_,f)}isFramebufferReady(){return!0}getActiveTexture(){let d=this.gl;return"TEXTURE"+(d.getParameter(this.gl.ACTIVE_TEXTURE)-d.TEXTURE0)}getTextureBinding(){return this.gl.getParameter(this.gl.TEXTURE_BINDING_2D)}getFramebufferBinding(){return this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING)}setVertexAttributes(d,c){let a=this.gl;a.vertexAttribPointer(d,3,a.FLOAT,!1,20,0),a.enableVertexAttribArray(d),c!==-1&&(a.vertexAttribPointer(c,2,a.FLOAT,!1,20,12),a.enableVertexAttribArray(c)),this.checkError()}createProgram(d,c){let a=this.gl,f=a.createProgram();return a.attachShader(f,d),a.attachShader(f,c),a.linkProgram(f),f}compileShader(d,c){let a=this.gl,f=a.createShader(c);if(!f)throw new Error(`createShader() returned null with type ${c}`);if(a.shaderSource(f,d),a.compileShader(f),a.getShaderParameter(f,a.COMPILE_STATUS)===!1)throw new Error(`Failed to compile shader: ${a.getShaderInfoLog(f)}
Shader source:
${d}`);return f}deleteShader(d){this.gl.deleteShader(d)}bindTextureToUniform(d,c,a){let f=this.gl;f.activeTexture(f.TEXTURE0+c),this.checkError(),f.bindTexture(f.TEXTURE_2D,d),this.checkError(),f.uniform1i(a,c),this.checkError()}draw(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.checkError()}checkError(){if(o.env.debug){let d=this.gl,c=d.getError(),a="";switch(c){case d.NO_ERROR:return;case d.INVALID_ENUM:a="INVALID_ENUM";break;case d.INVALID_VALUE:a="INVALID_VALUE";break;case d.INVALID_OPERATION:a="INVALID_OPERATION";break;case d.INVALID_FRAMEBUFFER_OPERATION:a="INVALID_FRAMEBUFFER_OPERATION";break;case d.OUT_OF_MEMORY:a="OUT_OF_MEMORY";break;case d.CONTEXT_LOST_WEBGL:a="CONTEXT_LOST_WEBGL";break;default:a=`Unknown WebGL Error: ${c.toString(16)}`}throw new Error(a)}}deleteTexture(d){this.gl.deleteTexture(d)}deleteProgram(d){this.gl.deleteProgram(d)}getEncoder(d,c,a=0){if(this.version===2)return new l.RedFloat32DataEncoder(this.gl,c);switch(d){case"float":return a===1||this.isRenderFloat32Supported?new l.RGBAFloatDataEncoder(this.gl,c):new l.RGBAFloatDataEncoder(this.gl,c,this.textureHalfFloatExtension.HALF_FLOAT_OES);case"int":throw new Error("not implemented");case"byte":return new l.Uint8DataEncoder(this.gl,c);default:throw new Error(`Invalid dataType: ${d}`)}}clearActiveTextures(){let d=this.gl;for(let c=0;c<this.maxTextureImageUnits;++c)d.activeTexture(d.TEXTURE0+c),d.bindTexture(d.TEXTURE_2D,null)}dispose(){if(this.disposed)return;let d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,null),d.deleteFramebuffer(this.framebuffer),d.bindBuffer(d.ARRAY_BUFFER,null),d.deleteBuffer(this.vertexbuffer),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),d.finish(),this.disposed=!0}createDefaultGeometry(){return new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0])}createVertexbuffer(){let d=this.gl,c=d.createBuffer();if(!c)throw new Error("createBuffer() returned null");let a=this.createDefaultGeometry();return d.bindBuffer(d.ARRAY_BUFFER,c),d.bufferData(d.ARRAY_BUFFER,a,d.STATIC_DRAW),this.checkError(),c}createFramebuffer(){let d=this.gl.createFramebuffer();if(!d)throw new Error("createFramebuffer returned null");return d}queryVitalParameters(){let d=this.gl;if(this.isFloatTextureAttachableToFrameBuffer=this.checkFloatTextureAttachableToFrameBuffer(),this.isRenderFloat32Supported=this.checkRenderFloat32(),this.isFloat32DownloadSupported=this.checkFloat32Download(),this.version===1&&!this.textureHalfFloatExtension&&!this.isRenderFloat32Supported)throw new Error("both float32 and float16 TextureType are not supported");this.isBlendSupported=!this.isRenderFloat32Supported||this.checkFloat32Blend(),this.maxTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE),this.maxTextureImageUnits=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS),this.version}getExtensions(){this.version===2?(this.colorBufferFloatExtension=this.gl.getExtension("EXT_color_buffer_float"),this.disjointTimerQueryWebgl2Extension=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")):(this.textureFloatExtension=this.gl.getExtension("OES_texture_float"),this.textureHalfFloatExtension=this.gl.getExtension("OES_texture_half_float"))}checkFloatTextureAttachableToFrameBuffer(){let d=this.gl,c=d.createTexture();d.bindTexture(d.TEXTURE_2D,c);let a=this.version===2?d.RGBA32F:d.RGBA;d.texImage2D(d.TEXTURE_2D,0,a,1,1,0,d.RGBA,d.FLOAT,null);let f=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,f),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0);let p=d.checkFramebufferStatus(d.FRAMEBUFFER)===d.FRAMEBUFFER_COMPLETE;return d.bindTexture(d.TEXTURE_2D,null),d.bindFramebuffer(d.FRAMEBUFFER,null),d.deleteTexture(c),d.deleteFramebuffer(f),p}checkRenderFloat32(){if(this.version===2){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension)return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Download(){if(this.version===2){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension||!this.gl.getExtension("WEBGL_color_buffer_float"))return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Blend(){let d=this.gl,c,a,f,p,g;try{c=d.createTexture(),a=d.createFramebuffer(),d.bindTexture(d.TEXTURE_2D,c);let m=this.version===2?d.RGBA32F:d.RGBA;return d.texImage2D(d.TEXTURE_2D,0,m,1,1,0,d.RGBA,d.FLOAT,null),d.bindFramebuffer(d.FRAMEBUFFER,a),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),d.enable(d.BLEND),f=d.createShader(d.VERTEX_SHADER),!!f&&(d.shaderSource(f,"void main(){}"),d.compileShader(f),p=d.createShader(d.FRAGMENT_SHADER),!!p&&(d.shaderSource(p,"precision highp float;void main(){gl_FragColor=vec4(0.5);}"),d.compileShader(p),g=d.createProgram(),!!g&&(d.attachShader(g,f),d.attachShader(g,p),d.linkProgram(g),d.useProgram(g),d.drawArrays(d.POINTS,0,1),d.getError()===d.NO_ERROR)))}finally{d.disable(d.BLEND),g&&d.deleteProgram(g),f&&d.deleteShader(f),p&&d.deleteShader(p),a&&(d.bindFramebuffer(d.FRAMEBUFFER,null),d.deleteFramebuffer(a)),c&&(d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(c))}}beginTimer(){if(this.version===2&&this.disjointTimerQueryWebgl2Extension){let d=this.gl,c=this.disjointTimerQueryWebgl2Extension,a=d.createQuery();return d.beginQuery(c.TIME_ELAPSED_EXT,a),a}throw new Error("WebGL1 profiling currently not supported.")}endTimer(){if(this.version!==2||!this.disjointTimerQueryWebgl2Extension)throw new Error("WebGL1 profiling currently not supported");{let d=this.gl,c=this.disjointTimerQueryWebgl2Extension;d.endQuery(c.TIME_ELAPSED_EXT)}}isTimerResultAvailable(d){let c=!1,a=!1;if(this.version!==2||!this.disjointTimerQueryWebgl2Extension)throw new Error("WebGL1 profiling currently not supported");{let f=this.gl,p=this.disjointTimerQueryWebgl2Extension;c=f.getQueryParameter(d,f.QUERY_RESULT_AVAILABLE),a=f.getParameter(p.GPU_DISJOINT_EXT)}return c&&!a}getTimerResult(d){let c=0;if(this.version!==2)throw new Error("WebGL1 profiling currently not supported");{let a=this.gl;c=a.getQueryParameter(d,a.QUERY_RESULT),a.deleteQuery(d)}return c/1e6}async waitForQueryAndGetTime(d){return await(0,u.repeatedTry)(()=>this.isTimerResultAvailable(d)),this.getTimerResult(d)}async createAndWaitForFence(){let d=this.createFence(this.gl);return this.pollFence(d)}createFence(d){let c,a=d,f=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);return d.flush(),c=f===null?()=>!0:()=>{let p=a.clientWaitSync(f,0,0);return p===a.ALREADY_SIGNALED||p===a.CONDITION_SATISFIED},{query:f,isFencePassed:c}}async pollFence(d){return new Promise(c=>{this.addItemToPoll(()=>d.isFencePassed(),()=>c())})}pollItems(){let d=h(this.itemsToPoll.map(c=>c.isDoneFn));for(let c=0;c<=d;++c){let{resolveFn:a}=this.itemsToPoll[c];a()}this.itemsToPoll=this.itemsToPoll.slice(d+1)}async addItemToPoll(d,c){this.itemsToPoll.push({isDoneFn:d,resolveFn:c}),this.itemsToPoll.length>1||await(0,u.repeatedTry)(()=>(this.pollItems(),this.itemsToPoll.length===0))}}},1036:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExecutionPlan=void 0;let n=t(6231);class i{constructor(o,l){this.op=o,this.node=l}}e.ExecutionPlan=class{constructor(r,o,l){this.graph=r,this.profiler=l,this.initialize(o)}initialize(r){this.profiler.event("session","ExecutionPlan.initialize",()=>{let o=this.graph.getNodes();if(o.length!==r.length)throw new Error("The size of nodes and OPs do not match.");this._ops=r.map((l,u)=>new i(l,o[u])),this.reset(),this._starter=[],this._ops.forEach((l,u)=>{let h=!0;for(let d of l.node.inputs)if(!this._values[d]&&this.graph.getInputIndices().indexOf(d)===-1){h=!1;break}h&&this._starter.push(u)})})}reset(){this._values=this.graph.getValues().map(r=>r.tensor)}async execute(r,o){return this.profiler.event("session","ExecutionPlan.execute",async()=>{this.reset();let l=r.createInferenceHandler(),u=this.graph.getInputIndices();if(o.length!==u.length)throw new Error(`number of input tensors don't match the number of inputs to the model: actual: ${o.length} expected: ${u.length}`);o.forEach((p,g)=>{let m=u[g];this._values[m]=p});let h=this._starter.slice(0),d=this.graph.getValues(),c=this.graph.getNodes(),a=0;for(;a<h.length;){let p=h[a++],g=this._ops[p],m=g.node.inputs.map(E=>this._values[E]);if(m.indexOf(void 0)!==-1)throw new Error(`unresolved input detected: op: ${g.node}`);let y=m;n.Logger.verbose("ExecPlan",`Runing op:${g.node.name} (${y.map((E,S)=>`'${g.node.inputs[S]}': ${E.type}[${E.dims.join(",")}]`).join(", ")})`);let _=await this.profiler.event("node",g.node.name,async()=>g.op.impl(l,y,g.op.context));if(_.length!==g.node.outputs.length)throw new Error("the size of output does not match model definition.");_.forEach((E,S)=>{let T=g.node.outputs[S];if(this._values[T])throw new Error(`output [${T}] already has value: op:${g.node.name}`);this._values[T]=E});let x=new Set;_.forEach((E,S)=>{let T=g.node.outputs[S];for(let C of d[T].to){let I=c[C],A=!0;for(let P of I.inputs)if(!this._values[P]){A=!1;break}A&&x.add(C)}}),h.push(...x)}let f=[];for(let p=0;p<this.graph.getOutputIndices().length;p++){let g=this.graph.getOutputIndices()[p],m=this._values[g];if(m===void 0)throw new Error(`required output [${g}] does not have value`);g===0?await m.getData():m.data,f.push(m)}return n.Logger.verbose("ExecPlan","disposing of inferenceHandler"),l.dispose(),f})}}},7070:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Graph=void 0;let n=t(1446),i=t(7778),r=t(9395),o=t(9162),l=t(2517);var u=r.onnxruntime.experimental.fbs;e.Graph={from:(a,f)=>new c(a,f)};class h{constructor(f){this._from=void 0,this._to=[],this.tensor=void 0,this.type=void 0,f&&(this.type=l.ProtoUtil.tensorValueTypeFromProto(f.type.tensorType))}get from(){return this._from}get to(){return this._to}}class d{constructor(f,p){f instanceof n.onnx.NodeProto?(this.name=f.name,this.opType=f.opType,this.attributes=new i.Attribute(f.attribute)):f instanceof u.Node&&(this.name=p??f.name(),this.opType=f.opType(),this.attributes=new i.Attribute(l.ProtoUtil.tensorAttributesFromORTFormat(f))),this.inputs=[],this.outputs=[],this.executeNode=!0}}class c{constructor(f,p){if(!f)throw new TypeError("graph is empty");this.buildGraph(f),this.transformGraph(p),this.checkIsAcyclic()}getInputIndices(){return this._allInputIndices}getInputNames(){return this._allInputNames}getOutputIndices(){return this._allOutputIndices}getOutputNames(){return this._allOutputNames}getValues(){return this._allData}getNodes(){return this._nodes}buildGraph(f){if(f instanceof n.onnx.GraphProto)this.buildGraphFromOnnxFormat(f);else{if(!(f instanceof u.Graph))throw new TypeError("Graph type is not supported.");this.buildGraphFromOrtFormat(f)}}buildGraphFromOnnxFormat(f){let p=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];let g=new Map;if(!f.input)throw new Error("missing information in graph: input");let m=[];for(let y of f.input){if(p.has(y.name))throw new Error(`duplicated input name: ${y.name}`);let _=this._allData.push(new h(y))-1;p.set(y.name,_),m.push(y.name)}if(!f.initializer)throw new Error("missing information in graph: initializer");for(let y of f.initializer){let _=p.get(y.name);if(_===void 0){let x=new h;x.type={shape:{dims:l.ProtoUtil.tensorDimsFromProto(y.dims)},tensorType:l.ProtoUtil.tensorDataTypeFromProto(y.dataType)},_=this._allData.push(x)-1,p.set(y.name,_)}this._allData[_]._from=-1,this._allData[_].tensor=o.Tensor.fromProto(y)}for(let y=0;y<this._allData.length;y++)this._allData[y].tensor||(this._allInputIndices.push(y),this._allInputNames.push(m[y]));if(!f.output)throw new Error("missing information in graph: output");for(let y of f.output){if(p.has(y.name))throw new Error(`duplicated output name: ${y.name}`);let _=this._allData.push(new h(y))-1;p.set(y.name,_),this._allOutputIndices.push(_),this._allOutputNames.push(y.name)}if(!f.node)throw new Error("missing information in graph: node");for(let y of f.node){if(!y.name)for(let x=0;;x++){let E=`unnamed_${y.opType}_${x}`;if(!g.has(E)){y.name=E;break}}if(g.has(y.name))throw new Error(`duplicated node name: ${y.name}`);let _=this._nodes.push(new d(y))-1;g.set(y.name,_)}for(let y=0;y<this._nodes.length;y++){let _=this._nodes[y],x=f.node[y];if(!x.output)throw new Error(`missing output for node: ${x.name}`);for(let E of x.output){let S=p.get(E);if(S===void 0&&(S=this._allData.push(new h)-1,p.set(E,S)),_.outputs.push(S),this._allData[S]._from!==void 0)throw new Error(`multiple nodes output to one data value: ${S}`);if(this._allData[S]._from=y,x.opType==="Constant"){if(!x.attribute||x.attribute.length!==1||!x.attribute[0].t)throw new Error("missing attributes or missing tensor value in attributes for this Constant operator");if(!x.output||x.output.length!==1)throw new Error("missing output or incorrect number of outputs for this Constant operator");_.outputs.pop(),_.executeNode=!1,this._allData[S]._from=-1,this._allData[S].tensor=o.Tensor.fromProto(x.attribute[0].t)}}}for(let y=0;y<this._nodes.length;y++){let _=this._nodes[y],x=f.node[y];if(!x.input)throw new Error(`missing input for node: ${x.name}`);for(let E of x.input){let S=p.get(E);if(S===void 0){if(E===""&&x.input.length===3&&x.opType==="Resize")continue;throw new Error(`unrecognized input '${E}' for node: ${x.name}`)}_.inputs.push(S),this._allData[S]._to.push(y)}}return!0}buildGraphFromOrtFormat(f){var p,g,m;let y=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];let _=new Map,x=[];for(let E=0;E<f.inputsLength();E++){let S=f.inputs(E);if(y.has(S))throw new Error(`duplicated input name: ${S}`);for(let T=0;T<f.nodeArgsLength();T++)if(((p=f.nodeArgs(T))===null||p===void 0?void 0:p.name())===S){let C=new h;if(((m=(g=f.nodeArgs(T))===null||g===void 0?void 0:g.type())===null||m===void 0?void 0:m.valueType())!==u.TypeInfoValue.tensor_type)throw new Error("Unexpected value type for the nodeArg.");let I=f.nodeArgs(T).type().value(new u.TensorTypeAndShape),A=l.ProtoUtil.tensorDataTypeFromProto(I.elemType()),P=I.shape(),F=[];for(let z=0;z<P.dimLength();z++)F.push(l.LongUtil.longToNumber(P.dim(z).value().dimValue()));C.type={shape:{dims:F},tensorType:A};let H=this._allData.push(C)-1;y.set(S,H),x.push(S)}}for(let E=0;E<f.initializersLength();E++){let S=f.initializers(E),T=y.get(S.name());if(T===void 0){let C=new h,I=l.ProtoUtil.tensorDimsFromORTFormat(S),A=l.ProtoUtil.tensorDataTypeFromProto(S.dataType());C.type={shape:{dims:I},tensorType:A},T=this._allData.push(C)-1,y.set(S.name(),T)}this._allData[T]._from=-1,this._allData[T].tensor=o.Tensor.fromOrtTensor(S)}for(let E=0;E<this._allData.length;E++)this._allData[E].tensor||(this._allInputIndices.push(E),this._allInputNames.push(x[E]));for(let E=0;E<f.outputsLength();E++){let S=f.outputs(E);if(y.has(S))throw new Error(`duplicated output name: ${S}`);let T=this._allData.push(new h)-1;y.set(S,T),this._allOutputIndices.push(T),this._allOutputNames.push(S)}if(!f.nodes)throw new Error("missing information in graph: node");for(let E=0;E<f.nodesLength();E++){let S=f.nodes(E),T=S.name();if(!T)for(let I=0;T=`unnamed_${S.opType()}_${I}`,_.has(T);I++);if(_.has(T))throw new Error(`duplicated node name: ${T}`);let C=this._nodes.push(new d(S,T))-1;_.set(T,C)}for(let E=0;E<this._nodes.length;E++){let S=this._nodes[E],T=f.nodes(E);if(T==null)throw new Error(`No node exists at index ${E}`);if(T?.outputsLength()===0)throw new Error(`missing output for node: ${T.name}`);for(let C=0;C<T?.outputsLength();C++){let I=T?.outputs(C),A=y.get(I);if(A===void 0&&(A=this._allData.push(new h)-1,y.set(I,A)),S.outputs.push(A),this._allData[A]._from!==void 0)throw new Error(`multiple nodes output to one data value: ${A}`);if(this._allData[A]._from=E,T.opType()==="Constant"){if(T.attributesLength()!==1||!T.attributes(0).t())throw new Error("missing attributes or missing tensor value in attributes for this Constant operator");if(T.outputsLength()!==1)throw new Error("missing output or incorrect number of outputs for this Constant operator");S.outputs.pop(),S.executeNode=!1,this._allData[A]._from=-1,this._allData[A].tensor=o.Tensor.fromOrtTensor(T.attributes(0).t())}}}for(let E=0;E<this._nodes.length;E++){let S=this._nodes[E],T=f.nodes(E);if(T.inputsLength()===0)throw new Error(`missing input for node: ${T.name}`);for(let C=0;C<T.inputsLength();C++){let I=T.inputs(C),A=y.get(I);if(A===void 0)throw new Error(`unrecognized input '${I}' for node: ${T.name()}`);S.inputs.push(A),this._allData[A]._to.push(E)}}}checkIsAcyclic(){let f=new Set;this._allInputIndices.forEach(m=>{this._allData[m]._to.forEach(y=>{f.add(y)})});let p=Array.from(f),g=new Array(this._nodes.length).fill("white");for(;p.length>0;){let m=p.pop();g[m]==="gray"?g[m]="black":(p.push(m),g[m]="gray",this._nodes[m].outputs.forEach(y=>{let _=this._allData[y];if(_.tensor!==void 0)throw new Error("node outputs should not be initialized");if(_._from!==m)throw new Error("from property of the Value object doesn't match index of Node being processed");_._to.forEach(x=>{if(g[x]==="gray")throw new Error("model graph is cyclic");g[x]==="white"&&p.push(x)})}))}}transformGraph(f){this.removeAllIdentityNodes(),this.removeAllDropoutNodes(),this.fuseConvActivationNodes(),f&&f.transformGraph(this),this.finalizeGraph()}finalizeGraph(){let f=0;for(let p=0;p<this._nodes.length;p++)this._nodes[p].executeNode?f>0&&(this._nodes[p].inputs.forEach(g=>{let m=this._allData[g]._to.indexOf(p+f);m!==-1&&(this._allData[g]._to[m]=p)}),this._nodes[p].outputs.forEach(g=>{this._allData[g]._from&&this._allData[g]._from===p+f&&(this._allData[g]._from=p)})):(f++,this._nodes[p].outputs.forEach(g=>{this._allData[g]._from=-2}),this._nodes.splice(p,1),p--);f=0;for(let p=0;p<this._allData.length;p++)if(this._allData[p].from!==-2||this._allOutputIndices.indexOf(p+f)!==-1){if(f>0){let g=-1;this._allData[p].from!==void 0&&this._allData[p].from!==-1?(g=this._nodes[this._allData[p].from].outputs.indexOf(p+f),g!==-1&&(this._nodes[this._allData[p].from].outputs[g]=p)):(g=this._allInputIndices.indexOf(p+f),g!==-1&&(this._allInputIndices[g]=p)),this._allData[p].to.forEach(m=>{g=this._nodes[m].inputs.indexOf(p+f),g!==-1&&(this._nodes[m].inputs[g]=p)}),this._allData[p].to.length===0&&(g=this._allOutputIndices.indexOf(p+f),g!==-1&&(this._allOutputIndices[g]=p))}}else f++,this._allData.splice(p,1),p--}deleteNode(f){let p=this._nodes[f];if(p.outputs.length>1){for(let E=1;E<p.outputs.length;E++)if(this._allData[p.outputs[E]].to.length>0)throw new Error("Node deletion with more than one output connected to other nodes is not supported. ")}p.executeNode=!1;let g=p.inputs[0],m=p.outputs[0],y=this._allData[m].to,_=this._allData[g].to.indexOf(f);if(_===-1)throw new Error("The Value object doesn't have the current Node in it's 'to' property ");this._allData[g].to.splice(_,1),this._allData[m]._to=[];let x=this._allOutputIndices.indexOf(m);if(x!==-1&&(this._allOutputIndices[x]=g),y&&y.length>0)for(let E of y){let S=this._nodes[E].inputs.indexOf(m);if(S===-1)throw new Error("The Node object doesn't have the output Value in it's 'inputs' property ");this._nodes[E].inputs[S]=g,this._allData[g].to.push(E)}}removeAllDropoutNodes(){let f=0;for(let p of this._nodes){if(p.opType==="Dropout"){if(p.inputs.length!==1)throw new Error("Dropout nodes should only contain one input. ");if(p.outputs.length!==1&&p.outputs.length!==2)throw new Error("Dropout nodes should contain either 1 or 2 output(s)");if(p.outputs.length===2&&this._allData[p.outputs[1]]._to.length!==0)throw new Error("Dropout nodes's second output should not be referenced by other nodes");this.deleteNode(f)}f++}}removeAllIdentityNodes(){let f=0;for(let p of this._nodes)p.opType==="Identity"&&this.deleteNode(f),f++}isActivation(f){switch(f.opType){case"Relu":case"Sigmoid":case"Clip":return!0;default:return!1}}fuseConvActivationNodes(){for(let f of this._nodes)if(f.opType==="Conv"){let p=this._allData[f.outputs[0]]._to;if(p.length===1&&this.isActivation(this._nodes[p[0]])){let g=this._nodes[p[0]];if(g.opType==="Clip")if(g.inputs.length===1)try{f.attributes.set("activation_params","floats",[g.attributes.getFloat("min"),g.attributes.getFloat("max")])}catch{f.attributes.set("activation_params","floats",[l.MIN_CLIP,l.MAX_CLIP])}else{if(!(g.inputs.length>=3&&this._allData[g.inputs[1]].tensor!==void 0&&this._allData[g.inputs[2]].tensor!==void 0))continue;f.attributes.set("activation_params","floats",[this._allData[g.inputs[1]].tensor.floatData[0],this._allData[g.inputs[2]].tensor.floatData[0]])}f.attributes.set("activation","string",g.opType),this.deleteNode(p[0])}}}}},6231:(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.now=e.Profiler=e.Logger=void 0;let t={verbose:1e3,info:2e3,warning:4e3,error:5e3,fatal:6e3},n={none:new class{log(d,c,a){}},console:new class{log(d,c,a){console.log(`${this.color(d)} ${a?"\x1B[35m"+a+"\x1B[0m ":""}${c}`)}color(d){switch(d){case"verbose":return"\x1B[34;40mv\x1B[0m";case"info":return"\x1B[32mi\x1B[0m";case"warning":return"\x1B[30;43mw\x1B[0m";case"error":return"\x1B[31;40me\x1B[0m";case"fatal":return"\x1B[101mf\x1B[0m";default:throw new Error(`unsupported severity: ${d}`)}}}},i={provider:"console",minimalSeverity:"warning",logDateTime:!0,logSourceLocation:!1},r={"":i};function o(d,c,a,f){if(c===void 0)return p=d,{verbose:o.verbose.bind(null,p),info:o.info.bind(null,p),warning:o.warning.bind(null,p),error:o.error.bind(null,p),fatal:o.fatal.bind(null,p)};if(a===void 0)l(d,c);else if(typeof a=="number"&&f===void 0)l(d,c);else if(typeof a=="string"&&f===void 0)l(d,a,0,c);else{if(typeof a!="string"||typeof f!="number")throw new TypeError("input is valid");l(d,a,0,c)}var p}function l(d,c,a,f){let p=r[f||""]||r[""];t[d]<t[p.minimalSeverity]||(p.logDateTime&&(c=`${new Date().toISOString()}|${c}`),p.logSourceLocation,n[p.provider].log(d,c,f))}(function(d){function c(f){r={},a("",f||{})}function a(f,p){if(f==="*")c(p);else{let g=r[f]||i;r[f]={provider:p.provider||g.provider,minimalSeverity:p.minimalSeverity||g.minimalSeverity,logDateTime:p.logDateTime===void 0?g.logDateTime:p.logDateTime,logSourceLocation:p.logSourceLocation===void 0?g.logSourceLocation:p.logSourceLocation}}}d.verbose=function(f,p){d("verbose",f,p)},d.info=function(f,p){d("info",f,p)},d.warning=function(f,p){d("warning",f,p)},d.error=function(f,p){d("error",f,p)},d.fatal=function(f,p){d("fatal",f,p)},d.reset=c,d.set=a,d.setWithEnv=function(f){let p={};f.logLevel&&(p.minimalSeverity=f.logLevel),a("",p)}})(o||(o={})),e.Logger=o;class u{constructor(c,a,f,p,g,m){this.category=c,this.name=a,this.startTime=f,this.endCallback=p,this.timer=g,this.ctx=m}end(){return this.endCallback(this)}async checkTimer(){if(this.ctx===void 0||this.timer===void 0)throw new Error("No webgl timer found");return this.ctx.endTimer(),this.ctx.waitForQueryAndGetTime(this.timer)}}class h{constructor(c,a,f,p){this.category=c,this.name=a,this.startTime=f,this.endTime=p}}e.Profiler=class{static create(d){return d===void 0?new this:new this(d.maxNumberEvents,d.flushBatchSize,d.flushIntervalInMilliseconds)}constructor(d,c,a){this._started=!1,this._flushPointer=0,this._started=!1,this._maxNumberEvents=d===void 0?1e4:d,this._flushBatchSize=c===void 0?10:c,this._flushIntervalInMilliseconds=a===void 0?5e3:a}start(){this._started=!0,this._timingEvents=[],this._flushTime=(0,e.now)(),this._flushPointer=0}stop(){for(this._started=!1;this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer])}event(d,c,a,f){let p=this._started?this.begin(d,c,f):void 0,g=!1,m=a();if(m&&typeof m.then=="function")return g=!0,new Promise((y,_)=>{m.then(async x=>{p&&await p.end(),y(x)},async x=>{p&&await p.end(),_(x)})});if(!g&&p){let y=p.end();if(y&&typeof y.then=="function")return new Promise((_,x)=>{y.then(()=>{_(m)},E=>{x(E)})})}return m}begin(d,c,a){if(!this._started)throw new Error("profiler is not started yet");if(a===void 0){let f=(0,e.now)();return this.flush(f),new u(d,c,f,p=>this.endSync(p))}{let f=a.beginTimer();return new u(d,c,0,async p=>this.end(p),f,a)}}async end(d){let c=await d.checkTimer();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new h(d.category,d.name,d.startTime,c)),this.flush(c))}endSync(d){let c=(0,e.now)();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new h(d.category,d.name,d.startTime,c)),this.flush(c))}logOneEvent(d){e.Logger.verbose(`Profiler.${d.category}`,`${(d.endTime-d.startTime).toFixed(2)}ms on event '${d.name}' at ${d.endTime.toFixed(2)}`)}flush(d){if(this._timingEvents.length-this._flushPointer>=this._flushBatchSize||d-this._flushTime>=this._flushIntervalInMilliseconds){for(let c=this._flushPointer;this._flushPointer<c+this._flushBatchSize&&this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer]);this._flushTime=(0,e.now)()}}get started(){return this._started}},e.now=typeof performance<"u"&&performance.now?()=>performance.now():Date.now},2644:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Model=void 0;let n=t(5686),i=t(1446),r=t(7070),o=t(9395),l=t(2517);var u=o.onnxruntime.experimental.fbs;e.Model=class{constructor(){}load(h,d,c){if(!c)try{return void this.loadFromOnnxFormat(h,d)}catch(a){if(c!==void 0)throw a}this.loadFromOrtFormat(h,d)}loadFromOnnxFormat(h,d){let c=i.onnx.ModelProto.decode(h);if(l.LongUtil.longToNumber(c.irVersion)<3)throw new Error("only support ONNX model with IR_VERSION>=3");this._opsets=c.opsetImport.map(a=>({domain:a.domain,version:l.LongUtil.longToNumber(a.version)})),this._graph=r.Graph.from(c.graph,d)}loadFromOrtFormat(h,d){let c=new n.flatbuffers.ByteBuffer(h),a=u.InferenceSession.getRootAsInferenceSession(c).model();if(l.LongUtil.longToNumber(a.irVersion())<3)throw new Error("only support ONNX model with IR_VERSION>=3");this._opsets=[];for(let f=0;f<a.opsetImportLength();f++){let p=a.opsetImport(f);this._opsets.push({domain:p?.domain(),version:l.LongUtil.longToNumber(p.version())})}this._graph=r.Graph.from(a.graph(),d)}get graph(){return this._graph}get opsets(){return this._opsets}}},782:(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FLOAT_TYPES=e.INT_TYPES=e.NUMBER_TYPES=void 0,e.NUMBER_TYPES=["float32","float64","int32","int16","int8","uint16","uint32","uint8"],e.INT_TYPES=["int32","int16","int8","uint16","uint32","uint8"],e.FLOAT_TYPES=["float32","float64"]},1047:(s,e)=>{"use strict";function t(n,i){if(i.endsWith("+")){let r=Number.parseInt(i.substring(0,i.length-1),10);return!isNaN(r)&&r<=n}if(i.split("-").length===2){let r=i.split("-"),o=Number.parseInt(r[0],10),l=Number.parseInt(r[1],10);return!isNaN(o)&&!isNaN(l)&&o<=n&&n<=l}return Number.parseInt(i,10)===n}Object.defineProperty(e,"__esModule",{value:!0}),e.resolveOperator=void 0,e.resolveOperator=function(n,i,r){for(let o of r){let l=o[0],u=o[1],h=o[2],d=o[3],c=o[4];if(n.opType===l){for(let a of i)if((a.domain===u||a.domain==="ai.onnx"&&u==="")&&t(a.version,h))return{opImpl:d,opInit:c}}}throw new TypeError(`cannot resolve operator '${n.opType}' with opsets: ${i.map(o=>`${o.domain||"ai.onnx"} v${o.version}`).join(", ")}`)}},9395:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.onnxruntime=void 0;let n=t(5686);var i,r;i=e.onnxruntime||(e.onnxruntime={}),function(o){let l;(function(u){u[u.UNDEFINED=0]="UNDEFINED",u[u.FLOAT=1]="FLOAT",u[u.INT=2]="INT",u[u.STRING=3]="STRING",u[u.TENSOR=4]="TENSOR",u[u.GRAPH=5]="GRAPH",u[u.FLOATS=6]="FLOATS",u[u.INTS=7]="INTS",u[u.STRINGS=8]="STRINGS",u[u.TENSORS=9]="TENSORS",u[u.GRAPHS=10]="GRAPHS",u[u.SPARSE_TENSOR=11]="SPARSE_TENSOR",u[u.SPARSE_TENSORS=12]="SPARSE_TENSORS"})(l=o.AttributeType||(o.AttributeType={}))}((r=i.experimental||(i.experimental={})).fbs||(r.fbs={})),function(o){(function(l){(function(u){let h;(function(d){d[d.UNKNOWN=0]="UNKNOWN",d[d.VALUE=1]="VALUE",d[d.PARAM=2]="PARAM"})(h=u.DimensionValueType||(u.DimensionValueType={}))})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){let h;(function(d){d[d.UNDEFINED=0]="UNDEFINED",d[d.FLOAT=1]="FLOAT",d[d.UINT8=2]="UINT8",d[d.INT8=3]="INT8",d[d.UINT16=4]="UINT16",d[d.INT16=5]="INT16",d[d.INT32=6]="INT32",d[d.INT64=7]="INT64",d[d.STRING=8]="STRING",d[d.BOOL=9]="BOOL",d[d.FLOAT16=10]="FLOAT16",d[d.DOUBLE=11]="DOUBLE",d[d.UINT32=12]="UINT32",d[d.UINT64=13]="UINT64",d[d.COMPLEX64=14]="COMPLEX64",d[d.COMPLEX128=15]="COMPLEX128",d[d.BFLOAT16=16]="BFLOAT16"})(h=u.TensorDataType||(u.TensorDataType={}))})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){let h;(function(d){d[d.Primitive=0]="Primitive",d[d.Fused=1]="Fused"})(h=u.NodeType||(u.NodeType={}))})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){let h;(function(d){d[d.NONE=0]="NONE",d[d.tensor_type=1]="tensor_type",d[d.sequence_type=2]="sequence_type",d[d.map_type=3]="map_type"})(h=u.TypeInfoValue||(u.TypeInfoValue={}))})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsShape(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsShape(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}dim(c,a){let f=this.bb.__offset(this.bb_pos,4);return f?(a||new o.experimental.fbs.Dimension).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+f)+4*c),this.bb):null}dimLength(){let c=this.bb.__offset(this.bb_pos,4);return c?this.bb.__vector_len(this.bb_pos+c):0}static startShape(c){c.startObject(1)}static addDim(c,a){c.addFieldOffset(0,a,0)}static createDimVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startDimVector(c,a){c.startVector(4,a,4)}static endShape(c){return c.endObject()}static createShape(c,a){return h.startShape(c),h.addDim(c,a),h.endShape(c)}}u.Shape=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsDimension(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsDimension(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}value(c){let a=this.bb.__offset(this.bb_pos,4);return a?(c||new o.experimental.fbs.DimensionValue).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}denotation(c){let a=this.bb.__offset(this.bb_pos,6);return a?this.bb.__string(this.bb_pos+a,c):null}static startDimension(c){c.startObject(2)}static addValue(c,a){c.addFieldOffset(0,a,0)}static addDenotation(c,a){c.addFieldOffset(1,a,0)}static endDimension(c){return c.endObject()}static createDimension(c,a,f){return h.startDimension(c),h.addValue(c,a),h.addDenotation(c,f),h.endDimension(c)}}u.Dimension=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsDimensionValue(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsDimensionValue(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}dimType(){let c=this.bb.__offset(this.bb_pos,4);return c?this.bb.readInt8(this.bb_pos+c):o.experimental.fbs.DimensionValueType.UNKNOWN}dimValue(){let c=this.bb.__offset(this.bb_pos,6);return c?this.bb.readInt64(this.bb_pos+c):this.bb.createLong(0,0)}dimParam(c){let a=this.bb.__offset(this.bb_pos,8);return a?this.bb.__string(this.bb_pos+a,c):null}static startDimensionValue(c){c.startObject(3)}static addDimType(c,a){c.addFieldInt8(0,a,o.experimental.fbs.DimensionValueType.UNKNOWN)}static addDimValue(c,a){c.addFieldInt64(1,a,c.createLong(0,0))}static addDimParam(c,a){c.addFieldOffset(2,a,0)}static endDimensionValue(c){return c.endObject()}static createDimensionValue(c,a,f,p){return h.startDimensionValue(c),h.addDimType(c,a),h.addDimValue(c,f),h.addDimParam(c,p),h.endDimensionValue(c)}}u.DimensionValue=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsTensorTypeAndShape(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsTensorTypeAndShape(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}elemType(){let c=this.bb.__offset(this.bb_pos,4);return c?this.bb.readInt32(this.bb_pos+c):o.experimental.fbs.TensorDataType.UNDEFINED}shape(c){let a=this.bb.__offset(this.bb_pos,6);return a?(c||new o.experimental.fbs.Shape).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}static startTensorTypeAndShape(c){c.startObject(2)}static addElemType(c,a){c.addFieldInt32(0,a,o.experimental.fbs.TensorDataType.UNDEFINED)}static addShape(c,a){c.addFieldOffset(1,a,0)}static endTensorTypeAndShape(c){return c.endObject()}static createTensorTypeAndShape(c,a,f){return h.startTensorTypeAndShape(c),h.addElemType(c,a),h.addShape(c,f),h.endTensorTypeAndShape(c)}}u.TensorTypeAndShape=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsMapType(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsMapType(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}keyType(){let c=this.bb.__offset(this.bb_pos,4);return c?this.bb.readInt32(this.bb_pos+c):o.experimental.fbs.TensorDataType.UNDEFINED}valueType(c){let a=this.bb.__offset(this.bb_pos,6);return a?(c||new o.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}static startMapType(c){c.startObject(2)}static addKeyType(c,a){c.addFieldInt32(0,a,o.experimental.fbs.TensorDataType.UNDEFINED)}static addValueType(c,a){c.addFieldOffset(1,a,0)}static endMapType(c){return c.endObject()}static createMapType(c,a,f){return h.startMapType(c),h.addKeyType(c,a),h.addValueType(c,f),h.endMapType(c)}}u.MapType=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsSequenceType(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsSequenceType(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}elemType(c){let a=this.bb.__offset(this.bb_pos,4);return a?(c||new o.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}static startSequenceType(c){c.startObject(1)}static addElemType(c,a){c.addFieldOffset(0,a,0)}static endSequenceType(c){return c.endObject()}static createSequenceType(c,a){return h.startSequenceType(c),h.addElemType(c,a),h.endSequenceType(c)}}u.SequenceType=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(l.fbs||(l.fbs={})).EdgeEnd=class{constructor(){this.bb=null,this.bb_pos=0}__init(u,h){return this.bb_pos=u,this.bb=h,this}nodeIndex(){return this.bb.readUint32(this.bb_pos)}srcArgIndex(){return this.bb.readInt32(this.bb_pos+4)}dstArgIndex(){return this.bb.readInt32(this.bb_pos+8)}static createEdgeEnd(u,h,d,c){return u.prep(4,12),u.writeInt32(c),u.writeInt32(d),u.writeInt32(h),u.offset()}}})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsNodeEdge(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsNodeEdge(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}nodeIndex(){let c=this.bb.__offset(this.bb_pos,4);return c?this.bb.readUint32(this.bb_pos+c):0}inputEdges(c,a){let f=this.bb.__offset(this.bb_pos,6);return f?(a||new o.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+f)+12*c,this.bb):null}inputEdgesLength(){let c=this.bb.__offset(this.bb_pos,6);return c?this.bb.__vector_len(this.bb_pos+c):0}outputEdges(c,a){let f=this.bb.__offset(this.bb_pos,8);return f?(a||new o.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+f)+12*c,this.bb):null}outputEdgesLength(){let c=this.bb.__offset(this.bb_pos,8);return c?this.bb.__vector_len(this.bb_pos+c):0}static startNodeEdge(c){c.startObject(3)}static addNodeIndex(c,a){c.addFieldInt32(0,a,0)}static addInputEdges(c,a){c.addFieldOffset(1,a,0)}static startInputEdgesVector(c,a){c.startVector(12,a,4)}static addOutputEdges(c,a){c.addFieldOffset(2,a,0)}static startOutputEdgesVector(c,a){c.startVector(12,a,4)}static endNodeEdge(c){return c.endObject()}static createNodeEdge(c,a,f,p){return h.startNodeEdge(c),h.addNodeIndex(c,a),h.addInputEdges(c,f),h.addOutputEdges(c,p),h.endNodeEdge(c)}}u.NodeEdge=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsNode(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsNode(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}name(c){let a=this.bb.__offset(this.bb_pos,4);return a?this.bb.__string(this.bb_pos+a,c):null}docString(c){let a=this.bb.__offset(this.bb_pos,6);return a?this.bb.__string(this.bb_pos+a,c):null}domain(c){let a=this.bb.__offset(this.bb_pos,8);return a?this.bb.__string(this.bb_pos+a,c):null}sinceVersion(){let c=this.bb.__offset(this.bb_pos,10);return c?this.bb.readInt32(this.bb_pos+c):0}index(){let c=this.bb.__offset(this.bb_pos,12);return c?this.bb.readUint32(this.bb_pos+c):0}opType(c){let a=this.bb.__offset(this.bb_pos,14);return a?this.bb.__string(this.bb_pos+a,c):null}type(){let c=this.bb.__offset(this.bb_pos,16);return c?this.bb.readInt32(this.bb_pos+c):o.experimental.fbs.NodeType.Primitive}executionProviderType(c){let a=this.bb.__offset(this.bb_pos,18);return a?this.bb.__string(this.bb_pos+a,c):null}inputs(c,a){let f=this.bb.__offset(this.bb_pos,20);return f?this.bb.__string(this.bb.__vector(this.bb_pos+f)+4*c,a):null}inputsLength(){let c=this.bb.__offset(this.bb_pos,20);return c?this.bb.__vector_len(this.bb_pos+c):0}outputs(c,a){let f=this.bb.__offset(this.bb_pos,22);return f?this.bb.__string(this.bb.__vector(this.bb_pos+f)+4*c,a):null}outputsLength(){let c=this.bb.__offset(this.bb_pos,22);return c?this.bb.__vector_len(this.bb_pos+c):0}attributes(c,a){let f=this.bb.__offset(this.bb_pos,24);return f?(a||new o.experimental.fbs.Attribute).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+f)+4*c),this.bb):null}attributesLength(){let c=this.bb.__offset(this.bb_pos,24);return c?this.bb.__vector_len(this.bb_pos+c):0}inputArgCounts(c){let a=this.bb.__offset(this.bb_pos,26);return a?this.bb.readInt32(this.bb.__vector(this.bb_pos+a)+4*c):0}inputArgCountsLength(){let c=this.bb.__offset(this.bb_pos,26);return c?this.bb.__vector_len(this.bb_pos+c):0}inputArgCountsArray(){let c=this.bb.__offset(this.bb_pos,26);return c?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+c),this.bb.__vector_len(this.bb_pos+c)):null}implicitInputs(c,a){let f=this.bb.__offset(this.bb_pos,28);return f?this.bb.__string(this.bb.__vector(this.bb_pos+f)+4*c,a):null}implicitInputsLength(){let c=this.bb.__offset(this.bb_pos,28);return c?this.bb.__vector_len(this.bb_pos+c):0}static startNode(c){c.startObject(13)}static addName(c,a){c.addFieldOffset(0,a,0)}static addDocString(c,a){c.addFieldOffset(1,a,0)}static addDomain(c,a){c.addFieldOffset(2,a,0)}static addSinceVersion(c,a){c.addFieldInt32(3,a,0)}static addIndex(c,a){c.addFieldInt32(4,a,0)}static addOpType(c,a){c.addFieldOffset(5,a,0)}static addType(c,a){c.addFieldInt32(6,a,o.experimental.fbs.NodeType.Primitive)}static addExecutionProviderType(c,a){c.addFieldOffset(7,a,0)}static addInputs(c,a){c.addFieldOffset(8,a,0)}static createInputsVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startInputsVector(c,a){c.startVector(4,a,4)}static addOutputs(c,a){c.addFieldOffset(9,a,0)}static createOutputsVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startOutputsVector(c,a){c.startVector(4,a,4)}static addAttributes(c,a){c.addFieldOffset(10,a,0)}static createAttributesVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startAttributesVector(c,a){c.startVector(4,a,4)}static addInputArgCounts(c,a){c.addFieldOffset(11,a,0)}static createInputArgCountsVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addInt32(a[f]);return c.endVector()}static startInputArgCountsVector(c,a){c.startVector(4,a,4)}static addImplicitInputs(c,a){c.addFieldOffset(12,a,0)}static createImplicitInputsVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startImplicitInputsVector(c,a){c.startVector(4,a,4)}static endNode(c){return c.endObject()}static createNode(c,a,f,p,g,m,y,_,x,E,S,T,C,I){return h.startNode(c),h.addName(c,a),h.addDocString(c,f),h.addDomain(c,p),h.addSinceVersion(c,g),h.addIndex(c,m),h.addOpType(c,y),h.addType(c,_),h.addExecutionProviderType(c,x),h.addInputs(c,E),h.addOutputs(c,S),h.addAttributes(c,T),h.addInputArgCounts(c,C),h.addImplicitInputs(c,I),h.endNode(c)}}u.Node=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsValueInfo(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsValueInfo(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}name(c){let a=this.bb.__offset(this.bb_pos,4);return a?this.bb.__string(this.bb_pos+a,c):null}docString(c){let a=this.bb.__offset(this.bb_pos,6);return a?this.bb.__string(this.bb_pos+a,c):null}type(c){let a=this.bb.__offset(this.bb_pos,8);return a?(c||new o.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}static startValueInfo(c){c.startObject(3)}static addName(c,a){c.addFieldOffset(0,a,0)}static addDocString(c,a){c.addFieldOffset(1,a,0)}static addType(c,a){c.addFieldOffset(2,a,0)}static endValueInfo(c){return c.endObject()}static createValueInfo(c,a,f,p){return h.startValueInfo(c),h.addName(c,a),h.addDocString(c,f),h.addType(c,p),h.endValueInfo(c)}}u.ValueInfo=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsTypeInfo(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsTypeInfo(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}denotation(c){let a=this.bb.__offset(this.bb_pos,4);return a?this.bb.__string(this.bb_pos+a,c):null}valueType(){let c=this.bb.__offset(this.bb_pos,6);return c?this.bb.readUint8(this.bb_pos+c):o.experimental.fbs.TypeInfoValue.NONE}value(c){let a=this.bb.__offset(this.bb_pos,8);return a?this.bb.__union(c,this.bb_pos+a):null}static startTypeInfo(c){c.startObject(3)}static addDenotation(c,a){c.addFieldOffset(0,a,0)}static addValueType(c,a){c.addFieldInt8(1,a,o.experimental.fbs.TypeInfoValue.NONE)}static addValue(c,a){c.addFieldOffset(2,a,0)}static endTypeInfo(c){return c.endObject()}static createTypeInfo(c,a,f,p){return h.startTypeInfo(c),h.addDenotation(c,a),h.addValueType(c,f),h.addValue(c,p),h.endTypeInfo(c)}}u.TypeInfo=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsOperatorSetId(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsOperatorSetId(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}domain(c){let a=this.bb.__offset(this.bb_pos,4);return a?this.bb.__string(this.bb_pos+a,c):null}version(){let c=this.bb.__offset(this.bb_pos,6);return c?this.bb.readInt64(this.bb_pos+c):this.bb.createLong(0,0)}static startOperatorSetId(c){c.startObject(2)}static addDomain(c,a){c.addFieldOffset(0,a,0)}static addVersion(c,a){c.addFieldInt64(1,a,c.createLong(0,0))}static endOperatorSetId(c){return c.endObject()}static createOperatorSetId(c,a,f){return h.startOperatorSetId(c),h.addDomain(c,a),h.addVersion(c,f),h.endOperatorSetId(c)}}u.OperatorSetId=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsTensor(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsTensor(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}name(c){let a=this.bb.__offset(this.bb_pos,4);return a?this.bb.__string(this.bb_pos+a,c):null}docString(c){let a=this.bb.__offset(this.bb_pos,6);return a?this.bb.__string(this.bb_pos+a,c):null}dims(c){let a=this.bb.__offset(this.bb_pos,8);return a?this.bb.readInt64(this.bb.__vector(this.bb_pos+a)+8*c):this.bb.createLong(0,0)}dimsLength(){let c=this.bb.__offset(this.bb_pos,8);return c?this.bb.__vector_len(this.bb_pos+c):0}dataType(){let c=this.bb.__offset(this.bb_pos,10);return c?this.bb.readInt32(this.bb_pos+c):o.experimental.fbs.TensorDataType.UNDEFINED}rawData(c){let a=this.bb.__offset(this.bb_pos,12);return a?this.bb.readUint8(this.bb.__vector(this.bb_pos+a)+c):0}rawDataLength(){let c=this.bb.__offset(this.bb_pos,12);return c?this.bb.__vector_len(this.bb_pos+c):0}rawDataArray(){let c=this.bb.__offset(this.bb_pos,12);return c?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+c),this.bb.__vector_len(this.bb_pos+c)):null}stringData(c,a){let f=this.bb.__offset(this.bb_pos,14);return f?this.bb.__string(this.bb.__vector(this.bb_pos+f)+4*c,a):null}stringDataLength(){let c=this.bb.__offset(this.bb_pos,14);return c?this.bb.__vector_len(this.bb_pos+c):0}static startTensor(c){c.startObject(6)}static addName(c,a){c.addFieldOffset(0,a,0)}static addDocString(c,a){c.addFieldOffset(1,a,0)}static addDims(c,a){c.addFieldOffset(2,a,0)}static createDimsVector(c,a){c.startVector(8,a.length,8);for(let f=a.length-1;f>=0;f--)c.addInt64(a[f]);return c.endVector()}static startDimsVector(c,a){c.startVector(8,a,8)}static addDataType(c,a){c.addFieldInt32(3,a,o.experimental.fbs.TensorDataType.UNDEFINED)}static addRawData(c,a){c.addFieldOffset(4,a,0)}static createRawDataVector(c,a){c.startVector(1,a.length,1);for(let f=a.length-1;f>=0;f--)c.addInt8(a[f]);return c.endVector()}static startRawDataVector(c,a){c.startVector(1,a,1)}static addStringData(c,a){c.addFieldOffset(5,a,0)}static createStringDataVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startStringDataVector(c,a){c.startVector(4,a,4)}static endTensor(c){return c.endObject()}static createTensor(c,a,f,p,g,m,y){return h.startTensor(c),h.addName(c,a),h.addDocString(c,f),h.addDims(c,p),h.addDataType(c,g),h.addRawData(c,m),h.addStringData(c,y),h.endTensor(c)}}u.Tensor=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsSparseTensor(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsSparseTensor(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}values(c){let a=this.bb.__offset(this.bb_pos,4);return a?(c||new o.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}indices(c){let a=this.bb.__offset(this.bb_pos,6);return a?(c||new o.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}dims(c){let a=this.bb.__offset(this.bb_pos,8);return a?this.bb.readInt64(this.bb.__vector(this.bb_pos+a)+8*c):this.bb.createLong(0,0)}dimsLength(){let c=this.bb.__offset(this.bb_pos,8);return c?this.bb.__vector_len(this.bb_pos+c):0}static startSparseTensor(c){c.startObject(3)}static addValues(c,a){c.addFieldOffset(0,a,0)}static addIndices(c,a){c.addFieldOffset(1,a,0)}static addDims(c,a){c.addFieldOffset(2,a,0)}static createDimsVector(c,a){c.startVector(8,a.length,8);for(let f=a.length-1;f>=0;f--)c.addInt64(a[f]);return c.endVector()}static startDimsVector(c,a){c.startVector(8,a,8)}static endSparseTensor(c){return c.endObject()}static createSparseTensor(c,a,f,p){return h.startSparseTensor(c),h.addValues(c,a),h.addIndices(c,f),h.addDims(c,p),h.endSparseTensor(c)}}u.SparseTensor=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsAttribute(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsAttribute(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}name(c){let a=this.bb.__offset(this.bb_pos,4);return a?this.bb.__string(this.bb_pos+a,c):null}docString(c){let a=this.bb.__offset(this.bb_pos,6);return a?this.bb.__string(this.bb_pos+a,c):null}type(){let c=this.bb.__offset(this.bb_pos,8);return c?this.bb.readInt32(this.bb_pos+c):o.experimental.fbs.AttributeType.UNDEFINED}f(){let c=this.bb.__offset(this.bb_pos,10);return c?this.bb.readFloat32(this.bb_pos+c):0}i(){let c=this.bb.__offset(this.bb_pos,12);return c?this.bb.readInt64(this.bb_pos+c):this.bb.createLong(0,0)}s(c){let a=this.bb.__offset(this.bb_pos,14);return a?this.bb.__string(this.bb_pos+a,c):null}t(c){let a=this.bb.__offset(this.bb_pos,16);return a?(c||new o.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}g(c){let a=this.bb.__offset(this.bb_pos,18);return a?(c||new o.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}floats(c){let a=this.bb.__offset(this.bb_pos,20);return a?this.bb.readFloat32(this.bb.__vector(this.bb_pos+a)+4*c):0}floatsLength(){let c=this.bb.__offset(this.bb_pos,20);return c?this.bb.__vector_len(this.bb_pos+c):0}floatsArray(){let c=this.bb.__offset(this.bb_pos,20);return c?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+c),this.bb.__vector_len(this.bb_pos+c)):null}ints(c){let a=this.bb.__offset(this.bb_pos,22);return a?this.bb.readInt64(this.bb.__vector(this.bb_pos+a)+8*c):this.bb.createLong(0,0)}intsLength(){let c=this.bb.__offset(this.bb_pos,22);return c?this.bb.__vector_len(this.bb_pos+c):0}strings(c,a){let f=this.bb.__offset(this.bb_pos,24);return f?this.bb.__string(this.bb.__vector(this.bb_pos+f)+4*c,a):null}stringsLength(){let c=this.bb.__offset(this.bb_pos,24);return c?this.bb.__vector_len(this.bb_pos+c):0}tensors(c,a){let f=this.bb.__offset(this.bb_pos,26);return f?(a||new o.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+f)+4*c),this.bb):null}tensorsLength(){let c=this.bb.__offset(this.bb_pos,26);return c?this.bb.__vector_len(this.bb_pos+c):0}graphs(c,a){let f=this.bb.__offset(this.bb_pos,28);return f?(a||new o.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+f)+4*c),this.bb):null}graphsLength(){let c=this.bb.__offset(this.bb_pos,28);return c?this.bb.__vector_len(this.bb_pos+c):0}static startAttribute(c){c.startObject(13)}static addName(c,a){c.addFieldOffset(0,a,0)}static addDocString(c,a){c.addFieldOffset(1,a,0)}static addType(c,a){c.addFieldInt32(2,a,o.experimental.fbs.AttributeType.UNDEFINED)}static addF(c,a){c.addFieldFloat32(3,a,0)}static addI(c,a){c.addFieldInt64(4,a,c.createLong(0,0))}static addS(c,a){c.addFieldOffset(5,a,0)}static addT(c,a){c.addFieldOffset(6,a,0)}static addG(c,a){c.addFieldOffset(7,a,0)}static addFloats(c,a){c.addFieldOffset(8,a,0)}static createFloatsVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addFloat32(a[f]);return c.endVector()}static startFloatsVector(c,a){c.startVector(4,a,4)}static addInts(c,a){c.addFieldOffset(9,a,0)}static createIntsVector(c,a){c.startVector(8,a.length,8);for(let f=a.length-1;f>=0;f--)c.addInt64(a[f]);return c.endVector()}static startIntsVector(c,a){c.startVector(8,a,8)}static addStrings(c,a){c.addFieldOffset(10,a,0)}static createStringsVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startStringsVector(c,a){c.startVector(4,a,4)}static addTensors(c,a){c.addFieldOffset(11,a,0)}static createTensorsVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startTensorsVector(c,a){c.startVector(4,a,4)}static addGraphs(c,a){c.addFieldOffset(12,a,0)}static createGraphsVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startGraphsVector(c,a){c.startVector(4,a,4)}static endAttribute(c){return c.endObject()}static createAttribute(c,a,f,p,g,m,y,_,x,E,S,T,C,I){return h.startAttribute(c),h.addName(c,a),h.addDocString(c,f),h.addType(c,p),h.addF(c,g),h.addI(c,m),h.addS(c,y),h.addT(c,_),h.addG(c,x),h.addFloats(c,E),h.addInts(c,S),h.addStrings(c,T),h.addTensors(c,C),h.addGraphs(c,I),h.endAttribute(c)}}u.Attribute=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsGraph(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsGraph(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}initializers(c,a){let f=this.bb.__offset(this.bb_pos,4);return f?(a||new o.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+f)+4*c),this.bb):null}initializersLength(){let c=this.bb.__offset(this.bb_pos,4);return c?this.bb.__vector_len(this.bb_pos+c):0}nodeArgs(c,a){let f=this.bb.__offset(this.bb_pos,6);return f?(a||new o.experimental.fbs.ValueInfo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+f)+4*c),this.bb):null}nodeArgsLength(){let c=this.bb.__offset(this.bb_pos,6);return c?this.bb.__vector_len(this.bb_pos+c):0}nodes(c,a){let f=this.bb.__offset(this.bb_pos,8);return f?(a||new o.experimental.fbs.Node).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+f)+4*c),this.bb):null}nodesLength(){let c=this.bb.__offset(this.bb_pos,8);return c?this.bb.__vector_len(this.bb_pos+c):0}maxNodeIndex(){let c=this.bb.__offset(this.bb_pos,10);return c?this.bb.readUint32(this.bb_pos+c):0}nodeEdges(c,a){let f=this.bb.__offset(this.bb_pos,12);return f?(a||new o.experimental.fbs.NodeEdge).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+f)+4*c),this.bb):null}nodeEdgesLength(){let c=this.bb.__offset(this.bb_pos,12);return c?this.bb.__vector_len(this.bb_pos+c):0}inputs(c,a){let f=this.bb.__offset(this.bb_pos,14);return f?this.bb.__string(this.bb.__vector(this.bb_pos+f)+4*c,a):null}inputsLength(){let c=this.bb.__offset(this.bb_pos,14);return c?this.bb.__vector_len(this.bb_pos+c):0}outputs(c,a){let f=this.bb.__offset(this.bb_pos,16);return f?this.bb.__string(this.bb.__vector(this.bb_pos+f)+4*c,a):null}outputsLength(){let c=this.bb.__offset(this.bb_pos,16);return c?this.bb.__vector_len(this.bb_pos+c):0}sparseInitializers(c,a){let f=this.bb.__offset(this.bb_pos,18);return f?(a||new o.experimental.fbs.SparseTensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+f)+4*c),this.bb):null}sparseInitializersLength(){let c=this.bb.__offset(this.bb_pos,18);return c?this.bb.__vector_len(this.bb_pos+c):0}static startGraph(c){c.startObject(8)}static addInitializers(c,a){c.addFieldOffset(0,a,0)}static createInitializersVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startInitializersVector(c,a){c.startVector(4,a,4)}static addNodeArgs(c,a){c.addFieldOffset(1,a,0)}static createNodeArgsVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startNodeArgsVector(c,a){c.startVector(4,a,4)}static addNodes(c,a){c.addFieldOffset(2,a,0)}static createNodesVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startNodesVector(c,a){c.startVector(4,a,4)}static addMaxNodeIndex(c,a){c.addFieldInt32(3,a,0)}static addNodeEdges(c,a){c.addFieldOffset(4,a,0)}static createNodeEdgesVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startNodeEdgesVector(c,a){c.startVector(4,a,4)}static addInputs(c,a){c.addFieldOffset(5,a,0)}static createInputsVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startInputsVector(c,a){c.startVector(4,a,4)}static addOutputs(c,a){c.addFieldOffset(6,a,0)}static createOutputsVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startOutputsVector(c,a){c.startVector(4,a,4)}static addSparseInitializers(c,a){c.addFieldOffset(7,a,0)}static createSparseInitializersVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startSparseInitializersVector(c,a){c.startVector(4,a,4)}static endGraph(c){return c.endObject()}static createGraph(c,a,f,p,g,m,y,_,x){return h.startGraph(c),h.addInitializers(c,a),h.addNodeArgs(c,f),h.addNodes(c,p),h.addMaxNodeIndex(c,g),h.addNodeEdges(c,m),h.addInputs(c,y),h.addOutputs(c,_),h.addSparseInitializers(c,x),h.endGraph(c)}}u.Graph=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsModel(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsModel(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}irVersion(){let c=this.bb.__offset(this.bb_pos,4);return c?this.bb.readInt64(this.bb_pos+c):this.bb.createLong(0,0)}opsetImport(c,a){let f=this.bb.__offset(this.bb_pos,6);return f?(a||new o.experimental.fbs.OperatorSetId).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+f)+4*c),this.bb):null}opsetImportLength(){let c=this.bb.__offset(this.bb_pos,6);return c?this.bb.__vector_len(this.bb_pos+c):0}producerName(c){let a=this.bb.__offset(this.bb_pos,8);return a?this.bb.__string(this.bb_pos+a,c):null}producerVersion(c){let a=this.bb.__offset(this.bb_pos,10);return a?this.bb.__string(this.bb_pos+a,c):null}domain(c){let a=this.bb.__offset(this.bb_pos,12);return a?this.bb.__string(this.bb_pos+a,c):null}modelVersion(){let c=this.bb.__offset(this.bb_pos,14);return c?this.bb.readInt64(this.bb_pos+c):this.bb.createLong(0,0)}docString(c){let a=this.bb.__offset(this.bb_pos,16);return a?this.bb.__string(this.bb_pos+a,c):null}graph(c){let a=this.bb.__offset(this.bb_pos,18);return a?(c||new o.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}graphDocString(c){let a=this.bb.__offset(this.bb_pos,20);return a?this.bb.__string(this.bb_pos+a,c):null}static startModel(c){c.startObject(9)}static addIrVersion(c,a){c.addFieldInt64(0,a,c.createLong(0,0))}static addOpsetImport(c,a){c.addFieldOffset(1,a,0)}static createOpsetImportVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startOpsetImportVector(c,a){c.startVector(4,a,4)}static addProducerName(c,a){c.addFieldOffset(2,a,0)}static addProducerVersion(c,a){c.addFieldOffset(3,a,0)}static addDomain(c,a){c.addFieldOffset(4,a,0)}static addModelVersion(c,a){c.addFieldInt64(5,a,c.createLong(0,0))}static addDocString(c,a){c.addFieldOffset(6,a,0)}static addGraph(c,a){c.addFieldOffset(7,a,0)}static addGraphDocString(c,a){c.addFieldOffset(8,a,0)}static endModel(c){return c.endObject()}static createModel(c,a,f,p,g,m,y,_,x,E){return h.startModel(c),h.addIrVersion(c,a),h.addOpsetImport(c,f),h.addProducerName(c,p),h.addProducerVersion(c,g),h.addDomain(c,m),h.addModelVersion(c,y),h.addDocString(c,_),h.addGraph(c,x),h.addGraphDocString(c,E),h.endModel(c)}}u.Model=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsKernelCreateInfos(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsKernelCreateInfos(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}nodeIndices(c){let a=this.bb.__offset(this.bb_pos,4);return a?this.bb.readUint32(this.bb.__vector(this.bb_pos+a)+4*c):0}nodeIndicesLength(){let c=this.bb.__offset(this.bb_pos,4);return c?this.bb.__vector_len(this.bb_pos+c):0}nodeIndicesArray(){let c=this.bb.__offset(this.bb_pos,4);return c?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+c),this.bb.__vector_len(this.bb_pos+c)):null}kernelDefHashes(c){let a=this.bb.__offset(this.bb_pos,6);return a?this.bb.readUint64(this.bb.__vector(this.bb_pos+a)+8*c):this.bb.createLong(0,0)}kernelDefHashesLength(){let c=this.bb.__offset(this.bb_pos,6);return c?this.bb.__vector_len(this.bb_pos+c):0}static startKernelCreateInfos(c){c.startObject(2)}static addNodeIndices(c,a){c.addFieldOffset(0,a,0)}static createNodeIndicesVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addInt32(a[f]);return c.endVector()}static startNodeIndicesVector(c,a){c.startVector(4,a,4)}static addKernelDefHashes(c,a){c.addFieldOffset(1,a,0)}static createKernelDefHashesVector(c,a){c.startVector(8,a.length,8);for(let f=a.length-1;f>=0;f--)c.addInt64(a[f]);return c.endVector()}static startKernelDefHashesVector(c,a){c.startVector(8,a,8)}static endKernelCreateInfos(c){return c.endObject()}static createKernelCreateInfos(c,a,f){return h.startKernelCreateInfos(c),h.addNodeIndices(c,a),h.addKernelDefHashes(c,f),h.endKernelCreateInfos(c)}}u.KernelCreateInfos=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsSubGraphSessionState(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsSubGraphSessionState(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}graphId(c){let a=this.bb.__offset(this.bb_pos,4);return a?this.bb.__string(this.bb_pos+a,c):null}sessionState(c){let a=this.bb.__offset(this.bb_pos,6);return a?(c||new o.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}static startSubGraphSessionState(c){c.startObject(2)}static addGraphId(c,a){c.addFieldOffset(0,a,0)}static addSessionState(c,a){c.addFieldOffset(1,a,0)}static endSubGraphSessionState(c){let a=c.endObject();return c.requiredField(a,4),a}static createSubGraphSessionState(c,a,f){return h.startSubGraphSessionState(c),h.addGraphId(c,a),h.addSessionState(c,f),h.endSubGraphSessionState(c)}}u.SubGraphSessionState=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsSessionState(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsSessionState(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}kernels(c){let a=this.bb.__offset(this.bb_pos,4);return a?(c||new o.experimental.fbs.KernelCreateInfos).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}subGraphSessionStates(c,a){let f=this.bb.__offset(this.bb_pos,6);return f?(a||new o.experimental.fbs.SubGraphSessionState).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+f)+4*c),this.bb):null}subGraphSessionStatesLength(){let c=this.bb.__offset(this.bb_pos,6);return c?this.bb.__vector_len(this.bb_pos+c):0}static startSessionState(c){c.startObject(2)}static addKernels(c,a){c.addFieldOffset(0,a,0)}static addSubGraphSessionStates(c,a){c.addFieldOffset(1,a,0)}static createSubGraphSessionStatesVector(c,a){c.startVector(4,a.length,4);for(let f=a.length-1;f>=0;f--)c.addOffset(a[f]);return c.endVector()}static startSubGraphSessionStatesVector(c,a){c.startVector(4,a,4)}static endSessionState(c){return c.endObject()}static createSessionState(c,a,f){return h.startSessionState(c),h.addKernels(c,a),h.addSubGraphSessionStates(c,f),h.endSessionState(c)}}u.SessionState=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={})),function(o){(function(l){(function(u){class h{constructor(){this.bb=null,this.bb_pos=0}__init(c,a){return this.bb_pos=c,this.bb=a,this}static getRootAsInferenceSession(c,a){return(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static getSizePrefixedRootAsInferenceSession(c,a){return c.setPosition(c.position()+n.flatbuffers.SIZE_PREFIX_LENGTH),(a||new h).__init(c.readInt32(c.position())+c.position(),c)}static bufferHasIdentifier(c){return c.__has_identifier("ORTM")}ortVersion(c){let a=this.bb.__offset(this.bb_pos,4);return a?this.bb.__string(this.bb_pos+a,c):null}model(c){let a=this.bb.__offset(this.bb_pos,6);return a?(c||new o.experimental.fbs.Model).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}sessionState(c){let a=this.bb.__offset(this.bb_pos,8);return a?(c||new o.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+a),this.bb):null}static startInferenceSession(c){c.startObject(3)}static addOrtVersion(c,a){c.addFieldOffset(0,a,0)}static addModel(c,a){c.addFieldOffset(1,a,0)}static addSessionState(c,a){c.addFieldOffset(2,a,0)}static endInferenceSession(c){return c.endObject()}static finishInferenceSessionBuffer(c,a){c.finish(a,"ORTM")}static finishSizePrefixedInferenceSessionBuffer(c,a){c.finish(a,"ORTM",!0)}static createInferenceSession(c,a,f,p){return h.startInferenceSession(c),h.addOrtVersion(c,a),h.addModel(c,f),h.addSessionState(c,p),h.endInferenceSession(c)}}u.InferenceSession=h})(l.fbs||(l.fbs={}))})(o.experimental||(o.experimental={}))}(e.onnxruntime||(e.onnxruntime={}))},7448:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OnnxjsSessionHandler=void 0;let n=t(1670),i=t(9162);e.OnnxjsSessionHandler=class{constructor(r){this.session=r,this.inputNames=this.session.inputNames,this.outputNames=this.session.outputNames}async dispose(){}async run(r,o,l){let u=new Map;for(let c in r)if(Object.hasOwnProperty.call(r,c)){let a=r[c];u.set(c,new i.Tensor(a.dims,a.type,void 0,void 0,a.data))}let h=await this.session.run(u),d={};return h.forEach((c,a)=>{d[a]=new n.Tensor(c.type,c.data,c.dims)}),d}startProfiling(){this.session.startProfiling()}endProfiling(){this.session.endProfiling()}}},6919:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Session=void 0;let n=t(7067),i=t(1296),r=t(7091),o=t(1036),l=t(6231),u=t(2644);e.Session=class{constructor(h={}){this._initialized=!1,this.backendHint=h.backendHint,this.profiler=l.Profiler.create(h.profiler),this.context={profiler:this.profiler,graphInputTypes:[],graphInputDims:[]}}get inputNames(){return this._model.graph.getInputNames()}get outputNames(){return this._model.graph.getOutputNames()}startProfiling(){this.profiler.start()}endProfiling(){this.profiler.stop()}async loadModel(h,d,c){await this.profiler.event("session","Session.loadModel",async()=>{let a=await(0,r.resolveBackend)(this.backendHint);if(this.sessionHandler=a.createSessionHandler(this.context),this._model=new u.Model,typeof h=="string"){let f=h.endsWith(".ort");if(typeof fetch>"u"){let p=await(0,i.promisify)(n.readFile)(h);this.initialize(p,f)}else{let p=await fetch(h),g=await p.arrayBuffer();this.initialize(new Uint8Array(g),f)}}else if(ArrayBuffer.isView(h))this.initialize(h);else{let f=new Uint8Array(h,d||0,c||h.byteLength);this.initialize(f)}})}initialize(h,d){if(this._initialized)throw new Error("already initialized");this.profiler.event("session","Session.initialize",()=>{let c=this.sessionHandler.transformGraph?this.sessionHandler:void 0;this._model.load(h,c,d),this.sessionHandler.onGraphInitialized&&this.sessionHandler.onGraphInitialized(this._model.graph),this.initializeOps(this._model.graph),this._executionPlan=new o.ExecutionPlan(this._model.graph,this._ops,this.profiler)}),this._initialized=!0}async run(h){if(!this._initialized)throw new Error("session not initialized yet");return this.profiler.event("session","Session.run",async()=>{let d=this.normalizeAndValidateInputs(h),c=await this._executionPlan.execute(this.sessionHandler,d);return this.createOutput(c)})}normalizeAndValidateInputs(h){let d=this._model.graph.getInputNames();if(Array.isArray(h)){if(h.length!==d.length)throw new Error(`incorrect input array length: expected ${d.length} but got ${h.length}`)}else{if(h.size!==d.length)throw new Error(`incorrect input map size: expected ${d.length} but got ${h.size}`);let c=new Array(h.size),a=0;for(let f=0;f<d.length;++f){let p=h.get(d[f]);if(!p)throw new Error(`missing input tensor for: '${name}'`);c[a++]=p}h=c}if(this.context.graphInputTypes&&this.context.graphInputTypes.length!==0&&this.context.graphInputDims&&this.context.graphInputDims.length!==0)this.validateInputTensorDims(this.context.graphInputDims,h,!1);else{let c=this._model.graph.getInputIndices(),a=this._model.graph.getValues(),f=new Array(c.length);for(let p=0;p<c.length;++p){let g=a[c[p]];f[p]=g.type.shape.dims,this.context.graphInputTypes.push(g.type.tensorType),this.context.graphInputDims.push(h[p].dims)}this.validateInputTensorDims(f,h,!0)}return this.validateInputTensorTypes(this.context.graphInputTypes,h),h}validateInputTensorTypes(h,d){for(let c=0;c<d.length;c++){let a=h[c],f=d[c].type;if(a!==f)throw new Error(`input tensor[${c}] check failed: expected type '${a}' but got ${f}`)}}validateInputTensorDims(h,d,c){for(let a=0;a<d.length;a++){let f=h[a],p=d[a].dims;if(!this.compareTensorDims(f,p,c))throw new Error(`input tensor[${a}] check failed: expected shape '[${f.join(",")}]' but got [${p.join(",")}]`)}}compareTensorDims(h,d,c){if(h.length!==d.length)return!1;for(let a=0;a<h.length;++a)if(h[a]!==d[a]&&(!c||h[a]!==0))return!1;return!0}createOutput(h){let d=this._model.graph.getOutputNames();if(h.length!==d.length)throw new Error("expected number of outputs do not match number of generated outputs");let c=new Map;for(let a=0;a<d.length;++a)c.set(d[a],h[a]);return c}initializeOps(h){let d=h.getNodes();this._ops=new Array(d.length);for(let c=0;c<d.length;c++)this._ops[c]=this.sessionHandler.resolve(d[c],this._model.opsets,h)}}},9162:function(s,e,t){"use strict";var n=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(e,"__esModule",{value:!0}),e.Tensor=void 0;let i=t(3442),r=n(t(3720)),o=t(1446),l=t(9395),u=t(2517);var h=l.onnxruntime.experimental.fbs;class d{get data(){if(this.cache===void 0){let m=this.dataProvider(this.dataId);if(m.length!==this.size)throw new Error("Length of data provided by the Data Provider is inconsistent with the dims of this Tensor.");this.cache=m}return this.cache}get stringData(){if(this.type!=="string")throw new TypeError("data type is not string");return this.data}get integerData(){switch(this.type){case"uint8":case"int8":case"uint16":case"int16":case"int32":case"uint32":case"bool":return this.data;default:throw new TypeError("data type is not integer (uint8, int8, uint16, int16, int32, uint32, bool)")}}get floatData(){switch(this.type){case"float32":case"float64":return this.data;default:throw new TypeError("data type is not float (float32, float64)")}}get numberData(){if(this.type!=="string")return this.data;throw new TypeError("type cannot be non-number (string)")}get(m){return this.data[u.ShapeUtil.indicesToOffset(m,this.strides)]}set(m,y){this.data[u.ShapeUtil.indicesToOffset(m,this.strides)]=y}async getData(){return this.cache===void 0&&(this.cache=await this.asyncDataProvider(this.dataId)),this.cache}get strides(){return this._strides||(this._strides=u.ShapeUtil.computeStrides(this.dims)),this._strides}constructor(m,y,_,x,E,S=i.Guid.create()){this.dims=m,this.type=y,this.dataProvider=_,this.asyncDataProvider=x,this.cache=E,this.dataId=S,this.size=u.ShapeUtil.validateDimsAndCalcSize(m);let T=this.size,C=_===void 0&&x===void 0&&E===void 0;if(E!==void 0&&E.length!==T)throw new RangeError("Input dims doesn't match data length.");if(y==="string"){if(!(E===void 0||Array.isArray(E)&&E.every(I=>typeof I=="string")))throw new TypeError("cache should be a string array");C&&(this.cache=new Array(T))}else{if(E!==void 0){let I=a(y);if(!(E instanceof I))throw new TypeError(`cache should be type ${I.name}`)}if(C){let I=new ArrayBuffer(T*function(A){switch(A){case"bool":case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;case"float64":return 8;default:throw new Error(`cannot calculate sizeof() on type ${A}`)}}(y));this.cache=function(A,P){return new(a(P))(A)}(I,y)}}}static fromProto(m){if(!m)throw new Error("cannot construct Value from an empty tensor");let y=u.ProtoUtil.tensorDataTypeFromProto(m.dataType),_=u.ProtoUtil.tensorDimsFromProto(m.dims),x=new d(_,y);if(y==="string")m.stringData.forEach((E,S)=>{x.data[S]=(0,u.decodeUtf8String)(E)});else if(m.rawData&&typeof m.rawData.byteLength=="number"&&m.rawData.byteLength>0){let E=x.data,S=new DataView(m.rawData.buffer,m.rawData.byteOffset,m.rawData.byteLength),T=c(m.dataType),C=m.rawData.byteLength/T;if(m.rawData.byteLength%T!=0)throw new Error("invalid buffer length");if(E.length!==C)throw new Error("buffer length mismatch");for(let I=0;I<C;I++){let A=p(S,m.dataType,I*T);E[I]=A}}else{let E;switch(m.dataType){case o.onnx.TensorProto.DataType.FLOAT:E=m.floatData;break;case o.onnx.TensorProto.DataType.INT32:case o.onnx.TensorProto.DataType.INT16:case o.onnx.TensorProto.DataType.UINT16:case o.onnx.TensorProto.DataType.INT8:case o.onnx.TensorProto.DataType.UINT8:case o.onnx.TensorProto.DataType.BOOL:E=m.int32Data;break;case o.onnx.TensorProto.DataType.INT64:E=m.int64Data;break;case o.onnx.TensorProto.DataType.DOUBLE:E=m.doubleData;break;case o.onnx.TensorProto.DataType.UINT32:case o.onnx.TensorProto.DataType.UINT64:E=m.uint64Data;break;default:throw new Error("unspecific error")}if(E==null)throw new Error("failed to populate data from a tensorproto value");let S=x.data;if(S.length!==E.length)throw new Error("array length mismatch");for(let T=0;T<E.length;T++){let C=E[T];r.default.isLong(C)?S[T]=f(C,m.dataType):S[T]=C}}return x}static fromData(m,y,_){return new d(y,_,void 0,void 0,m)}static fromOrtTensor(m){if(!m)throw new Error("cannot construct Value from an empty tensor");let y=u.ProtoUtil.tensorDimsFromORTFormat(m),_=u.ProtoUtil.tensorDataTypeFromProto(m.dataType()),x=new d(y,_);if(_==="string")for(let E=0;E<m.stringDataLength();E++)x.data[E]=m.stringData(E);else if(m.rawDataArray()&&typeof m.rawDataLength()=="number"&&m.rawDataLength()>0){let E=x.data,S=new DataView(m.rawDataArray().buffer,m.rawDataArray().byteOffset,m.rawDataLength()),T=c(m.dataType()),C=m.rawDataLength()/T;if(m.rawDataLength()%T!=0)throw new Error("invalid buffer length");if(E.length!==C)throw new Error("buffer length mismatch");for(let I=0;I<C;I++){let A=p(S,m.dataType(),I*T);E[I]=A}}return x}}function c(g){switch(g){case o.onnx.TensorProto.DataType.UINT8:case o.onnx.TensorProto.DataType.INT8:case o.onnx.TensorProto.DataType.BOOL:return 1;case o.onnx.TensorProto.DataType.UINT16:case o.onnx.TensorProto.DataType.INT16:return 2;case o.onnx.TensorProto.DataType.FLOAT:case o.onnx.TensorProto.DataType.INT32:case o.onnx.TensorProto.DataType.UINT32:return 4;case o.onnx.TensorProto.DataType.INT64:case o.onnx.TensorProto.DataType.DOUBLE:case o.onnx.TensorProto.DataType.UINT64:return 8;default:throw new Error(`cannot calculate sizeof() on type ${o.onnx.TensorProto.DataType[g]}`)}}function a(g){switch(g){case"bool":case"uint8":return Uint8Array;case"int8":return Int8Array;case"int16":return Int16Array;case"uint16":return Uint16Array;case"int32":return Int32Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;default:throw new Error("unspecified error")}}function f(g,m){if(m===o.onnx.TensorProto.DataType.INT64||m===h.TensorDataType.INT64){if(g.greaterThanOrEqual(2147483648)||g.lessThan(-2147483648))throw new TypeError("int64 is not supported")}else{if(m!==o.onnx.TensorProto.DataType.UINT32&&m!==h.TensorDataType.UINT32&&m!==o.onnx.TensorProto.DataType.UINT64&&m!==h.TensorDataType.UINT64)throw new TypeError(`not a LONG type: ${o.onnx.TensorProto.DataType[m]}`);if(g.greaterThanOrEqual(4294967296)||g.lessThan(0))throw new TypeError("uint64 is not supported")}return g.toNumber()}function p(g,m,y){switch(m){case o.onnx.TensorProto.DataType.BOOL:case o.onnx.TensorProto.DataType.UINT8:return g.getUint8(y);case o.onnx.TensorProto.DataType.INT8:return g.getInt8(y);case o.onnx.TensorProto.DataType.UINT16:return g.getUint16(y,!0);case o.onnx.TensorProto.DataType.INT16:return g.getInt16(y,!0);case o.onnx.TensorProto.DataType.FLOAT:return g.getFloat32(y,!0);case o.onnx.TensorProto.DataType.INT32:return g.getInt32(y,!0);case o.onnx.TensorProto.DataType.UINT32:return g.getUint32(y,!0);case o.onnx.TensorProto.DataType.INT64:return f(r.default.fromBits(g.getUint32(y,!0),g.getUint32(y+4,!0),!1),m);case o.onnx.TensorProto.DataType.DOUBLE:return g.getFloat64(y,!0);case o.onnx.TensorProto.DataType.UINT64:return f(r.default.fromBits(g.getUint32(y,!0),g.getUint32(y+4,!0),!0),m);default:throw new Error(`cannot read from DataView for type ${o.onnx.TensorProto.DataType[m]}`)}}e.Tensor=d},2517:function(s,e,t){"use strict";var n=this&&this.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(e,"__esModule",{value:!0}),e.decodeUtf8String=e.MAX_CLIP=e.MIN_CLIP=e.PoolConvUtil=e.ReduceUtil=e.SplitUtil=e.MathUtil=e.ShapeUtil=e.LongUtil=e.ProtoUtil=e.GemmUtil=e.arrayCopyHelper=e.BroadcastUtil=e.MatMulUtil=e.ArrayUtil=e.assert=e.checkInputsShape=void 0;let i=t(5686),r=n(t(3720)),o=t(1446),l=t(9162);e.checkInputsShape=function(m,...y){if(!m||m.length!==y.length)return!1;for(let _=0;_<m.length;_++)if(!m[_].dims||m[_].dims.length!==y[_])return!1;return!0},e.assert=function(m,y){if(!m)throw new Error(typeof y=="string"?y:y())},e.ArrayUtil=class{static arraysEqual(m,y){if(m.length!==y.length)return!1;for(let _=0;_<m.length;_++)if(m[_]!==y[_])return!1;return!0}};class u{static preprocessInputShapes(y,_){return[y.length===1?[1,y[0]]:y,_.length===1?[_[0],1]:_]}static postprocessOutputShape(y,_,x){_===1&&y.splice(y.length-2,1),x===1&&y.pop()}static calcMatMulShape(y,_){return y[1]!==_[0]?void 0:[y[0],_[1]]}}e.MatMulUtil=u;class h{static calcShape(y,_,x=!1){let E=y.length,S=_.length;if(E===0)return _;if(S===0)return y;let T=Math.max(y.length,_.length),C=new Array(T);if(x){if(E<2||S<2)return;let I=u.calcMatMulShape([y[E-2],y[E-1]],[_[S-2],_[S-1]]);if(I===void 0)return;[C[T-2],C[T-1]]=I}for(let I=x?3:1;I<=T;I++){let A=E-I<0?1:y[E-I],P=S-I<0?1:_[S-I];if(A!==P&&A>1&&P>1)return;C[T-I]=Math.max(A,P)}return C}static index(y,_){let x=new Array(_.length);return h.fillIndex(y,_,x),x}static fillIndex(y,_,x){let E=y.length-_.length;for(let S=0;S<_.length;S++)x[S]=y[E+S]%_[S]}static calc(y,_,x,E,S){let T=h.calcShape(y.dims,_.dims);if(T){if(E&&!a.areEqual(T,y.dims))return;let C=a.size(T),I=E?y:new l.Tensor(T,S||y.type);if(T.length===0)I.set([],x(y.get([]),_.get([])));else{let A=new Array(T.length),P=new Array(y.dims.length),F=new Array(_.dims.length),H,z=0,B=0,V=!1,M=!1;y.dims.length===0&&(z=y.get([]),V=!0),_.dims.length===0&&(B=_.get([]),M=!0);for(let $=0;$<C;$++){H=$;for(let oe=T.length-1;oe>=0;oe--)A[oe]=H%T[oe],H=Math.floor(H/T[oe]);V||(h.fillIndex(A,y.dims,P),z=y.get(P)),M||(h.fillIndex(A,_.dims,F),B=_.get(F)),I.set(A,x(z,B))}}return I}}static isValidBroadcast(y,_){let x=y.length,E=_.length;if(x>E)return!1;for(let S=1;S<=x;S++)if(y[x-S]!==1&&y[x-S]!==_[E-S])return!1;return!0}static getBroadcastDims(y,_){let x=y.length,E=[];for(let S=0;S<x;S++){let T=x-1-S,C=y[T]||1;(_[_.length-1-S]||1)>1&&C===1&&E.unshift(T)}return E}}e.BroadcastUtil=h,e.arrayCopyHelper=function(m,y,_,x,E){if(x<0||x>=y.length)throw new Error("sourceIndex out of bounds");if(_<0||_>=m.length)throw new Error("targetIndex out of bounds");if(x+E>y.length)throw new Error("source indices to be copied are outside bounds");if(_+E>m.length)throw new Error("target array is too small to hold result");for(let S=0;S<E;S++)m[_+S]=y[x+S]},e.GemmUtil=class{static getShapeOfGemmResult(m,y,_,x,E){if(m.length!==2||_.length!==2)throw new Error("shape need to be of size 2");let S,T,C;y?(S=m[1],T=m[0]):(S=m[0],T=m[1]);let I=-1;if(x?(C=_[0],I=1):(C=_[1],I=0),_[I]!==T)throw new Error("dimension mismatch");if(S<=0||C<=0||T<=0)throw new Error("invalid shape specified");if(E&&!h.isValidBroadcast(E,[S,C]))throw new Error("gemm: invalid bias shape for broadcast");return[S,C,T]}};class d{static tensorDataTypeFromProto(y){switch(y){case o.onnx.TensorProto.DataType.INT8:return"int8";case o.onnx.TensorProto.DataType.UINT8:return"uint8";case o.onnx.TensorProto.DataType.BOOL:return"bool";case o.onnx.TensorProto.DataType.INT16:return"int16";case o.onnx.TensorProto.DataType.UINT16:return"uint16";case o.onnx.TensorProto.DataType.INT32:return"int32";case o.onnx.TensorProto.DataType.UINT32:return"uint32";case o.onnx.TensorProto.DataType.FLOAT:return"float32";case o.onnx.TensorProto.DataType.DOUBLE:return"float64";case o.onnx.TensorProto.DataType.STRING:return"string";case o.onnx.TensorProto.DataType.INT64:return"int32";case o.onnx.TensorProto.DataType.UINT64:return"uint32";default:throw new Error(`unsupported data type: ${o.onnx.TensorProto.DataType[y]}`)}}static tensorDataTypeStringToEnum(y){switch(y){case"int8":return o.onnx.TensorProto.DataType.INT8;case"uint8":return o.onnx.TensorProto.DataType.UINT8;case"bool":return o.onnx.TensorProto.DataType.BOOL;case"int16":return o.onnx.TensorProto.DataType.INT16;case"uint16":return o.onnx.TensorProto.DataType.UINT16;case"int32":return o.onnx.TensorProto.DataType.INT32;case"uint32":return o.onnx.TensorProto.DataType.UINT32;case"float32":return o.onnx.TensorProto.DataType.FLOAT;case"float64":return o.onnx.TensorProto.DataType.DOUBLE;case"string":return o.onnx.TensorProto.DataType.STRING;case"int64":return o.onnx.TensorProto.DataType.INT64;case"uint64":return o.onnx.TensorProto.DataType.UINT64;default:throw new Error(`unsupported data type: ${y}`)}}static tensorDimsFromProto(y){return y.map(_=>r.default.isLong(_)?_.toNumber():_)}static tensorValueTypeFromProto(y){return{tensorType:d.tensorDataTypeFromProto(y.elemType),shape:{dims:d.tensorDimsFromProto(y.shape.dim.map(_=>_.dimValue))}}}static tensorDimsFromORTFormat(y){let _=[];for(let x=0;x<y.dimsLength();x++)_.push(c.longToNumber(y.dims(x)));return _}static tensorAttributesFromORTFormat(y){let _=[];for(let x=0;x<y.attributesLength();x++)_.push(y.attributes(x));return _}}e.ProtoUtil=d;class c{static longToNumber(y,_){return r.default.isLong(y)?y.toNumber():y instanceof i.flatbuffers.Long?r.default.fromValue({low:y.low,high:y.high,unsigned:_!=null&&_}).toNumber():y}static isLong(y){return r.default.isLong(y)||y instanceof i.flatbuffers.Long}}e.LongUtil=c;class a{static size(y){return a.getSizeFromDimensionRange(y,0,y.length)}static sizeFromDimension(y,_){if(_<0||_>y.length)throw new Error(`invalid dimension of ${_} for sizeFromDimension as Tensor has ${y.length} dimensions.`);return a.getSizeFromDimensionRange(y,_,y.length)}static sizeToDimension(y,_){if(_<0||_>y.length)throw new Error(`invalid dimension of ${_} for sizeToDimension as Tensor has ${y.length} dimensions.`);return a.getSizeFromDimensionRange(y,0,_)}static getSizeFromDimensionRange(y,_,x){let E=1;for(let S=_;S<x;S++){if(y[S]<=0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains 0 or negative values in them.");E*=y[S]}return E}static computeStrides(y){let _=y.length;if(_===0)return[];if(_===1)return[1];let x=new Array(_);x[_-1]=1,x[_-2]=y[_-1];for(let E=_-3;E>=0;--E)x[E]=x[E+1]*y[E+1];return x}static transpose(y){return y.slice().reverse()}static indicesToOffset(y,_,x){x===void 0&&(x=y.length);let E=0;for(let S=0;S<x;++S)E+=_[S]*y[S];return E}static offsetToIndices(y,_){let x=_.length;if(x===0)return[];if(x===1)return[y*_[0]];let E=new Array(_.length);for(let S=0;S<E.length-1;++S)E[S]=Math.floor(y/_[S]),y-=E[S]*_[S];return E[E.length-1]=y,E}static normalizeAxis(y,_){if(y<-_&&y>=_)throw new Error("unsupported axis for this operation.");return y<0?y+_:y}static normalizeAxes(y,_){return y.map(x=>this.normalizeAxis(x,_))}static incrementIndex(y,_,x){if(_.length===0||y.length===0)throw new Error("Index incrementing unsupported for scalar Tensor");if(x===void 0)x=_.length;else if(x<=0||x>_.length)throw new Error("Incorrect axis to increment on");for(let E=x-1;E>=0&&(y[E]++,!(y[E]<_[E]));--E)y[E]=0}static calculateReshapedDims(y,_){if(_.length===0){if(y.length===0||a.size(y)===1)return[];throw new Error("cannot reshape to a scalar Tensor")}let x=_.length,E=new Array(x),S=-1,T=1;for(let I=0;I<x;I++){if(_[I]<-1)throw new Error("a dimension in shape hints cannot be less than -1");if(_[I]===-1){if(S!==-1)throw new Error("at most one dimension in shape hints can be -1");S=I}else{if(_[I]===0){if(I>=y.length)throw new Error("the dimension with value zero exceeds the dimension size of the input tensor");E[I]=y[I]}else E[I]=_[I];T*=E[I]}}let C=a.size(y);if(S!==-1){if(C%T!=0)throw new Error(`the input tensor cannot be reshaped to the requested shape. Input shape: [${y}] Output shape: [${_}]`);E[S]=C/T}else if(T!==C)throw new Error("reshapedDims and originalDims don't have matching sizes");return E}static sortBasedOnPerm(y,_){return _?_.map(x=>y[x]):y.slice().reverse()}static padShape(y,_){let x=y.length;return y.map((E,S)=>E+_[S]+_[S+x])}static areEqual(y,_){return y.length===_.length&&y.every((x,E)=>x===_[E])}static validateDimsAndCalcSize(y){if(y.length>6)throw new TypeError("Only rank 0 to 6 is supported for tensor shape.");let _=1;for(let x of y){if(!Number.isInteger(x))throw new TypeError(`Invalid shape: ${x} is not an integer`);if(x<0||x>2147483647)throw new TypeError(`Invalid shape: length ${x} is not allowed`);_*=x}return _}static flattenShape(y,_){_<0&&(_+=y.length);let x=y.reduce((S,T)=>S*T,1),E=y.slice(_).reduce((S,T)=>S*T,1);return[x/E,E]}static squeezeShape(y,_){let x=new Array;_=a.normalizeAxes(_,y.length);for(let E=0;E<y.length;E++){let S=_.indexOf(E)>=0;if(S&&y[E]!==1)throw new Error("squeeze an axis of size different than 1");(_.length===0&&y[E]>1||_.length>0&&!S)&&x.push(y[E])}return x}static unsqueezeShape(y,_){let x=new Array(y.length+_.length);x.fill(0);for(let S=0;S<_.length;S++){let T=a.normalizeAxis(_[S],x.length);if(T>=x.length)throw new Error("'axes' has an out of range axis");if(x[T]!==0)throw new Error("'axes' has a duplicate axis");x[T]=1}let E=0;for(let S=0;S<x.length;S++)x[S]===0&&(x[S]=y[E++]);if(E!==y.length)throw new Error("the unsqueezed dimension could not be established");return x}}e.ShapeUtil=a,e.MathUtil=class{static sqr(m,y,_,x,E){if(x<0||x>=y.length)throw new Error("sourceIndex out of bounds");if(_<0||_>=m.length)throw new Error("targetIndex out of bounds");if(x+E>y.length)throw new Error("source indices to be copied are outside bounds");if(_+E>m.length)throw new Error("target array is too small to hold result");for(let S=0;S<E;S++)m[_+S]+=Math.pow(y[x+S],2)}static axpy(m,y,_,x,E,S){if(x<0||x>=y.length)throw new Error("sourceIndex out of bounds");if(_<0||_>=m.length)throw new Error("targetIndex out of bounds");if(x+E>y.length)throw new Error("source indices to be copied are outside bounds");if(_+E>m.length)throw new Error("target array is too small to hold result");for(let T=0;T<E;T++)m[_+T]+=S*y[x+T]}static powx(m,y,_,x,E,S){if(x<0||x>=y.length)throw new Error("sourceIndex out of bounds");if(_<0||_>=m.length)throw new Error("targetIndex out of bounds");if(x+E>y.length)throw new Error("source indices to be copied are outside bounds");if(_+E>m.length)throw new Error("target array is too small to hold result");for(let T=0;T<E;T++)m[_+T]=Math.pow(y[x+T],S)}static mul(m,y,_,x,E){if(x<0||x>=y.length)throw new Error("sourceIndex out of bounds");if(_<0||_>=m.length)throw new Error("targetIndex out of bounds");if(x+E>y.length)throw new Error("source indices to be copied are outside bounds");if(_+E>m.length)throw new Error("target array is too small to hold result");for(let S=0;S<E;S++)m[_+S]=y[x+S]*m[_+S]}};class f{static splitShape(y,_,x,E){if(x.length===0){if(!E)throw new Error("need to know number of outputs when the 'split' attribute is not specified");f.determineSplit(y[_],E,x)}let S=[],T=[0];for(let C=0;C<x.length;++C){C!==0&&T.push(T[C-1]+x[C-1]);let I=y.slice();I[_]=x[C],S.push(I)}return[S,T]}static determineSplit(y,_,x){if(y%_!=0)throw new Error("cannot split tensor to equal sized parts");for(let E=0;E<_;++E)x.push(y/_)}}e.SplitUtil=f;class p{static calcReduce(y,_,x,E,S){let T=y.dims.slice(0);_.length===0&&T.forEach((z,B)=>_.push(B));let C=p.calcReduceShape(T,_,!0),I=a.size(C),A=new l.Tensor(C,y.type),P=a.computeStrides(C),F=a.computeStrides(T),H=new Array(T.length);for(let z=0;z<I;z++){let B=a.offsetToIndices(z,P);h.fillIndex(B,T,H),A.set(B,p.calcReduceByAxis(y.numberData,_,T,0,a.indicesToOffset(H,F),E,S))}return x?A:new l.Tensor(p.calcReduceShape(T,_,x),A.type,void 0,void 0,A.data,A.dataId)}static calcReduceByAxis(y,_,x,E,S,T,C){let I=0;if(E>=_.length)return T(y[S]);let A=_[E],P=A>=x.length?1:a.size(x.slice(A+1));for(let F=0;F<x[A];F++)I=F===0?p.calcReduceByAxis(y,_,x,E+1,S,T,C):C(I,p.calcReduceByAxis(y,_,x,E+1,S,T,C)),S+=P;return I}static calcReduceShape(y,_,x){let E=y.slice();for(let S=0;S<_.length;S++)E[_[S]]=x?1:0;return E.filter(S=>S!==0)}}e.ReduceUtil=p;class g{static adjustPoolAttributes(y,_,x,E,S,T){if(!y&&x.length!==_.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(y)for(let C=0;C<_.length-2;C++)C>=x.length?x.push(_[C+2]):x[C]=_[C+2];for(let C=0;C<x.length;C++)if(C<E.length){if(E[C]<0)throw new Error("strides should be greater than or equal to 1")}else E.push(1);for(let C=0;C<x.length;C++)if(C<S.length){if(S[C]<0)throw new Error("dilations should be greater than or equal to 1")}else S.push(1);for(let C=0;C<2*x.length;C++)if(C<T.length){if(T[C]<0)throw new Error("pad should be greater than or equal to 1")}else T.push(0);for(let C=0;C<x.length;C++){if(x[C]<=0)throw new Error("kernel shapes need to be greater than 0");if(T[C]>=x[C]||T[C+x.length]>=x[C])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(y,_,x,E,S,T){if(T){if(S.length!==2*(y.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(_.length!==y.length-2)throw new Error("length of strides should be the length of data dimensions");if(E.length!==y.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let C=0;C<y.length-2;C++)g.adjustPadAndReturnShape(y[C+2],_[C],x[C],E[C],S,C,C+y.length-2,T)}}static computePoolOutputShape(y,_,x,E,S,T,C){if(_.length<=0)throw new Error("input shape must be of size greater than 0");let I=[_[0],_[1]];return g.computeShapeHelper(y,_,I,x,E,S,T,C),I}static computeConvOutputShape(y,_,x,E,S,T,C){if(y.length<=0||_.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let I=[y[0],_[0]];return g.computeShapeHelper(!1,y,I,x,E,S,T,C),I}static computeShapeHelper(y,_,x,E,S,T,C,I){if(y)for(let A=0;A<_.length-2;A++)x.push(1);else for(let A=0;A<_.length-2;A++)x.push(g.adjustPadAndReturnShape(_[A+2],E[A],S[A],T[A],C,A,A+_.length-2,I))}static adjustPadAndReturnShape(y,_,x,E,S,T,C,I){let A=x*(E-1)+1;if(!I||I==="NOTSET")return Math.floor((y+S[T]+S[C]-A)/_+1);switch(I){case"VALID":return S[T]=0,S[C]=0,Math.floor((y-A)/_+1);case"SAME_LOWER":case"SAME_UPPER":if(x!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let P=((y+_-1)/_-1)*_+E-y;return S[T]=Math.floor(I==="SAME_LOWER"?(P+1)/2:P/2),S[C]=P-S[T],Math.floor((y+P-E)/_+1)}default:throw new Error("Unsupported AutoPad type")}}}e.PoolConvUtil=g,e.MIN_CLIP=-34028234663852886e22,e.MAX_CLIP=34028234663852886e22,e.decodeUtf8String=function(m){return new TextDecoder().decode(m)}},7967:(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.iterateExtraOptions=void 0,e.iterateExtraOptions=(t,n,i,r)=>{if(typeof t=="object"&&t!==null){if(i.has(t))throw new Error("Circular reference in options");i.add(t)}Object.entries(t).forEach(([o,l])=>{let u=n?n+o:o;if(typeof l=="object")(0,e.iterateExtraOptions)(l,u+".",i,r);else if(typeof l=="string"||typeof l=="number")r(u,l.toString());else{if(typeof l!="boolean")throw new Error("Can't handle extra config type: "+typeof l);r(u,l?"1":"0")}})}},2157:function(s,e,t){"use strict";var n,i=this&&this.__createBinding||(Object.create?function(P,F,H,z){z===void 0&&(z=H);var B=Object.getOwnPropertyDescriptor(F,H);B&&!("get"in B?!F.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return F[H]}}),Object.defineProperty(P,z,B)}:function(P,F,H,z){z===void 0&&(z=H),P[z]=F[H]}),r=this&&this.__setModuleDefault||(Object.create?function(P,F){Object.defineProperty(P,"default",{enumerable:!0,value:F})}:function(P,F){P.default=F}),o=this&&this.__importStar||function(P){if(P&&P.__esModule)return P;var F={};if(P!=null)for(var H in P)H!=="default"&&Object.prototype.hasOwnProperty.call(P,H)&&i(F,P,H);return r(F,P),F};Object.defineProperty(e,"__esModule",{value:!0}),e.endProfiling=e.run=e.releaseSession=e.createSession=e.createSessionFinalize=e.createSessionAllocate=e.initOrt=e.initWasm=void 0;let l=t(1670),u=o(t(349)),h=t(6361),d=()=>!!l.env.wasm.proxy&&typeof document<"u",c,a,f,p=!1,g=!1,m=!1,y=[],_=[],x=[],E=[],S=[],T=[],C=()=>{if(p||!g||m||!c)throw new Error("worker not ready")},I=P=>{switch(P.data.type){case"init-wasm":p=!1,P.data.err?(m=!0,a[1](P.data.err)):(g=!0,a[0]());break;case"init-ort":P.data.err?f[1](P.data.err):f[0]();break;case"create_allocate":P.data.err?y.shift()[1](P.data.err):y.shift()[0](P.data.out);break;case"create_finalize":P.data.err?_.shift()[1](P.data.err):_.shift()[0](P.data.out);break;case"create":P.data.err?x.shift()[1](P.data.err):x.shift()[0](P.data.out);break;case"release":P.data.err?E.shift()[1](P.data.err):E.shift()[0]();break;case"run":P.data.err?S.shift()[1](P.data.err):S.shift()[0](P.data.out);break;case"end-profiling":P.data.err?T.shift()[1](P.data.err):T.shift()[0]()}},A=typeof document<"u"?(n=document?.currentScript)===null||n===void 0?void 0:n.src:void 0;e.initWasm=async()=>{if(d()){if(g)return;if(p)throw new Error("multiple calls to 'initWasm()' detected.");if(m)throw new Error("previous call to 'initWasm()' failed.");return p=!0,l.env.wasm.wasmPaths===void 0&&A&&A.indexOf("blob:")!==0&&(l.env.wasm.wasmPaths=A.substr(0,+A.lastIndexOf("/")+1)),new Promise((P,F)=>{c?.terminate(),c=t(9710).Z(),c.onmessage=I,a=[P,F];let H={type:"init-wasm",in:l.env.wasm};c.postMessage(H)})}return(0,h.initializeWebAssembly)(l.env.wasm)},e.initOrt=async(P,F)=>{if(d())return C(),new Promise((H,z)=>{f=[H,z];let B={type:"init-ort",in:{numThreads:P,loggingLevel:F}};c.postMessage(B)});u.initOrt(P,F)},e.createSessionAllocate=async P=>d()?(C(),new Promise((F,H)=>{y.push([F,H]);let z={type:"create_allocate",in:{model:P}};c.postMessage(z,[P.buffer])})):u.createSessionAllocate(P),e.createSessionFinalize=async(P,F)=>d()?(C(),new Promise((H,z)=>{_.push([H,z]);let B={type:"create_finalize",in:{modeldata:P,options:F}};c.postMessage(B)})):u.createSessionFinalize(P,F),e.createSession=async(P,F)=>d()?(C(),new Promise((H,z)=>{x.push([H,z]);let B={type:"create",in:{model:P,options:F}};c.postMessage(B,[P.buffer])})):u.createSession(P,F),e.releaseSession=async P=>{if(d())return C(),new Promise((F,H)=>{E.push([F,H]);let z={type:"release",in:P};c.postMessage(z)});u.releaseSession(P)},e.run=async(P,F,H,z,B)=>d()?(C(),new Promise((V,M)=>{S.push([V,M]);let $={type:"run",in:{sessionId:P,inputIndices:F,inputs:H,outputIndices:z,options:B}};c.postMessage($,u.extractTransferableBuffers(H))})):u.run(P,F,H,z,B),e.endProfiling=async P=>{if(d())return C(),new Promise((F,H)=>{T.push([F,H]);let z={type:"end-profiling",in:P};c.postMessage(z)});u.endProfiling(P)}},586:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setRunOptions=void 0;let n=t(7967),i=t(4983),r=t(6361);e.setRunOptions=o=>{let l=(0,r.getInstance)(),u=0,h=[],d=o||{};try{if(o?.logSeverityLevel===void 0)d.logSeverityLevel=2;else if(typeof o.logSeverityLevel!="number"||!Number.isInteger(o.logSeverityLevel)||o.logSeverityLevel<0||o.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${o.logSeverityLevel}`);if(o?.logVerbosityLevel===void 0)d.logVerbosityLevel=0;else if(typeof o.logVerbosityLevel!="number"||!Number.isInteger(o.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${o.logVerbosityLevel}`);o?.terminate===void 0&&(d.terminate=!1);let c=0;if(o?.tag!==void 0&&(c=(0,i.allocWasmString)(o.tag,h)),u=l._OrtCreateRunOptions(d.logSeverityLevel,d.logVerbosityLevel,!!d.terminate,c),u===0)throw new Error("Can't create run options");return o?.extra!==void 0&&(0,n.iterateExtraOptions)(o.extra,"",new WeakSet,(a,f)=>{let p=(0,i.allocWasmString)(a,h),g=(0,i.allocWasmString)(f,h);if(l._OrtAddRunConfigEntry(u,p,g)!==0)throw new Error(`Can't set a run config entry: ${a} - ${f}`)}),[u,h]}catch(c){throw u!==0&&l._OrtReleaseRunOptions(u),h.forEach(l._free),c}}},2306:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OnnxruntimeWebAssemblySessionHandler=void 0;let n=t(2806),i=t(1670),r=t(2850),o=t(2157),l;e.OnnxruntimeWebAssemblySessionHandler=class{async createSessionAllocate(u){let h=await fetch(u),d=await h.arrayBuffer();return(0,o.createSessionAllocate)(new Uint8Array(d))}async loadModel(u,h){if(l||(await(0,o.initOrt)(i.env.wasm.numThreads,(d=>{switch(d){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${d}`)}})(i.env.logLevel)),l=!0),typeof u=="string")if(typeof fetch>"u"){let d=await(0,r.promisify)(n.readFile)(u);[this.sessionId,this.inputNames,this.outputNames]=await(0,o.createSession)(d,h)}else{let d=await this.createSessionAllocate(u);[this.sessionId,this.inputNames,this.outputNames]=await(0,o.createSessionFinalize)(d,h)}else[this.sessionId,this.inputNames,this.outputNames]=await(0,o.createSession)(u,h)}async dispose(){return(0,o.releaseSession)(this.sessionId)}async run(u,h,d){let c=[],a=[];Object.entries(u).forEach(m=>{let y=m[0],_=m[1],x=this.inputNames.indexOf(y);if(x===-1)throw new Error(`invalid input '${y}'`);c.push(_),a.push(x)});let f=[];Object.entries(h).forEach(m=>{let y=m[0],_=this.outputNames.indexOf(y);if(_===-1)throw new Error(`invalid output '${y}'`);f.push(_)});let p=await(0,o.run)(this.sessionId,a,c.map(m=>[m.type,m.dims,m.data]),f,d),g={};for(let m=0;m<p.length;m++)g[this.outputNames[f[m]]]=new i.Tensor(p[m][0],p[m][2],p[m][1]);return g}startProfiling(){}endProfiling(){(0,o.endProfiling)(this.sessionId)}}},4919:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setSessionOptions=void 0;let n=t(7967),i=t(4983),r=t(6361);e.setSessionOptions=o=>{let l=(0,r.getInstance)(),u=0,h=[],d=o||{};(c=>{c.extra||(c.extra={}),c.extra.session||(c.extra.session={});let a=c.extra.session;a.use_ort_model_bytes_directly||(a.use_ort_model_bytes_directly="1")})(d);try{o?.graphOptimizationLevel===void 0&&(d.graphOptimizationLevel="all");let c=(p=>{switch(p){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${p}`)}})(d.graphOptimizationLevel);o?.enableCpuMemArena===void 0&&(d.enableCpuMemArena=!0),o?.enableMemPattern===void 0&&(d.enableMemPattern=!0),o?.executionMode===void 0&&(d.executionMode="sequential");let a=(p=>{switch(p){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${p}`)}})(d.executionMode),f=0;if(o?.logId!==void 0&&(f=(0,i.allocWasmString)(o.logId,h)),o?.logSeverityLevel===void 0)d.logSeverityLevel=2;else if(typeof o.logSeverityLevel!="number"||!Number.isInteger(o.logSeverityLevel)||o.logSeverityLevel<0||o.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${o.logSeverityLevel}`);if(o?.logVerbosityLevel===void 0)d.logVerbosityLevel=0;else if(typeof o.logVerbosityLevel!="number"||!Number.isInteger(o.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${o.logVerbosityLevel}`);if(o?.enableProfiling===void 0&&(d.enableProfiling=!1),u=l._OrtCreateSessionOptions(c,!!d.enableCpuMemArena,!!d.enableMemPattern,a,!!d.enableProfiling,0,f,d.logSeverityLevel,d.logVerbosityLevel),u===0)throw new Error("Can't create session options");return o?.executionProviders&&((p,g,m)=>{for(let y of g){let _=typeof y=="string"?y:y.name;switch(_){case"xnnpack":_="XNNPACK";break;case"wasm":case"cpu":continue;default:throw new Error(`not supported EP: ${_}`)}let x=(0,i.allocWasmString)(_,m);if((0,r.getInstance)()._OrtAppendExecutionProvider(p,x)!==0)throw new Error(`Can't append execution provider: ${_}`)}})(u,o.executionProviders,h),o?.extra!==void 0&&(0,n.iterateExtraOptions)(o.extra,"",new WeakSet,(p,g)=>{let m=(0,i.allocWasmString)(p,h),y=(0,i.allocWasmString)(g,h);if(l._OrtAddSessionConfigEntry(u,m,y)!==0)throw new Error(`Can't set a session config entry: ${p} - ${g}`)}),[u,h]}catch(c){throw u!==0&&l._OrtReleaseSessionOptions(u),h.forEach(l._free),c}}},4983:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.allocWasmString=void 0;let n=t(6361);e.allocWasmString=(i,r)=>{let o=(0,n.getInstance)(),l=o.lengthBytesUTF8(i)+1,u=o._malloc(l);return o.stringToUTF8(i,u,l),r.push(u),u}},349:(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.extractTransferableBuffers=e.endProfiling=e.run=e.releaseSession=e.createSession=e.createSessionFinalize=e.createSessionAllocate=e.initOrt=void 0;let n=t(586),i=t(4919),r=t(4983),o=t(6361);e.initOrt=(c,a)=>{let f=(0,o.getInstance)()._OrtInit(c,a);if(f!==0)throw new Error(`Can't initialize onnxruntime. error code = ${f}`)};let l=new Map;e.createSessionAllocate=c=>{let a=(0,o.getInstance)(),f=a._malloc(c.byteLength);return a.HEAPU8.set(c,f),[f,c.byteLength]},e.createSessionFinalize=(c,a)=>{let f=(0,o.getInstance)(),p=0,g=0,m=[];try{if([g,m]=(0,i.setSessionOptions)(a),p=f._OrtCreateSession(c[0],c[1],g),p===0)throw new Error("Can't create a session")}finally{f._free(c[0]),f._OrtReleaseSessionOptions(g),m.forEach(f._free)}let y=f._OrtGetInputCount(p),_=f._OrtGetOutputCount(p),x=[],E=[],S=[],T=[];for(let C=0;C<y;C++){let I=f._OrtGetInputName(p,C);if(I===0)throw new Error("Can't get an input name");E.push(I),x.push(f.UTF8ToString(I))}for(let C=0;C<_;C++){let I=f._OrtGetOutputName(p,C);if(I===0)throw new Error("Can't get an output name");T.push(I),S.push(f.UTF8ToString(I))}return l.set(p,[p,E,T]),[p,x,S]},e.createSession=(c,a)=>{let f=(0,e.createSessionAllocate)(c);return(0,e.createSessionFinalize)(f,a)},e.releaseSession=c=>{let a=(0,o.getInstance)(),f=l.get(c);if(!f)throw new Error("invalid session id");let p=f[0],g=f[1],m=f[2];g.forEach(a._OrtFree),m.forEach(a._OrtFree),a._OrtReleaseSession(p),l.delete(c)};let u=c=>{switch(c){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${c}`)}},h=c=>{switch(c){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${c}`)}},d=c=>{switch(c){case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${c}`)}};e.run=(c,a,f,p,g)=>{let m=(0,o.getInstance)(),y=l.get(c);if(!y)throw new Error("invalid session id");let _=y[0],x=y[1],E=y[2],S=a.length,T=p.length,C=0,I=[],A=[],P=[];try{[C,I]=(0,n.setRunOptions)(g);for(let M=0;M<S;M++){let $=f[M][0],oe=f[M][1],Z=f[M][2],le,ae;if(Array.isArray(Z)){ae=4*Z.length,le=m._malloc(ae),P.push(le);let Ze=le/4;for(let Ae=0;Ae<Z.length;Ae++){if(typeof Z[Ae]!="string")throw new TypeError(`tensor data at index ${Ae} is not a string`);m.HEAPU32[Ze++]=(0,r.allocWasmString)(Z[Ae],P)}}else ae=Z.byteLength,le=m._malloc(ae),P.push(le),m.HEAPU8.set(new Uint8Array(Z.buffer,Z.byteOffset,ae),le);let be=m.stackSave(),Ce=m.stackAlloc(4*oe.length);try{let Ze=Ce/4;oe.forEach(Ie=>m.HEAP32[Ze++]=Ie);let Ae=m._OrtCreateTensor(u($),le,ae,Ce,oe.length);if(Ae===0)throw new Error("Can't create a tensor");A.push(Ae)}finally{m.stackRestore(be)}}let F=m.stackSave(),H=m.stackAlloc(4*S),z=m.stackAlloc(4*S),B=m.stackAlloc(4*T),V=m.stackAlloc(4*T);try{let M=H/4,$=z/4,oe=B/4,Z=V/4;for(let be=0;be<S;be++)m.HEAPU32[M++]=A[be],m.HEAPU32[$++]=x[a[be]];for(let be=0;be<T;be++)m.HEAPU32[oe++]=0,m.HEAPU32[Z++]=E[p[be]];let le=m._OrtRun(_,z,H,S,V,T,B,C),ae=[];if(le===0)for(let be=0;be<T;be++){let Ce=m.HEAPU32[B/4+be],Ze=m.stackSave(),Ae=m.stackAlloc(16),Ie,_e=0;try{if(le=m._OrtGetTensorData(Ce,Ae,Ae+4,Ae+8,Ae+12),le!==0)throw new Error(`Can't access output tensor data. error code = ${le}`);let ht=Ae/4,Vt=m.HEAPU32[ht++];_e=m.HEAPU32[ht++];let ut=m.HEAPU32[ht++],Rt=m.HEAPU32[ht++],Yt=[];for(let Qe=0;Qe<Rt;Qe++)Yt.push(m.HEAPU32[ut/4+Qe]);m._OrtFree(ut);let At=Yt.length===0?1:Yt.reduce((Qe,On)=>Qe*On);if(Ie=h(Vt),Ie==="string"){let Qe=[],On=_e/4;for(let qn=0;qn<At;qn++){let is=m.HEAPU32[On++],xr=qn===At-1?void 0:m.HEAPU32[On]-is;Qe.push(m.UTF8ToString(is,xr))}ae.push([Ie,Yt,Qe])}else{let Qe=new(d(Ie))(At);new Uint8Array(Qe.buffer,Qe.byteOffset,Qe.byteLength).set(m.HEAPU8.subarray(_e,_e+Qe.byteLength)),ae.push([Ie,Yt,Qe])}}finally{m.stackRestore(Ze),Ie==="string"&&_e&&m._free(_e),m._OrtReleaseTensor(Ce)}}if(le===0)return ae;throw new Error(`failed to call OrtRun(). error code = ${le}.`)}finally{m.stackRestore(F)}}finally{A.forEach(m._OrtReleaseTensor),P.forEach(m._free),m._OrtReleaseRunOptions(C),I.forEach(m._free)}},e.endProfiling=c=>{let a=(0,o.getInstance)(),f=l.get(c);if(!f)throw new Error("invalid session id");let p=f[0],g=a._OrtEndProfiling(p);if(g===0)throw new Error("Can't get an profile file name");a._OrtFree(g)},e.extractTransferableBuffers=c=>{let a=[];for(let f of c){let p=f[2];!Array.isArray(p)&&p.buffer&&a.push(p.buffer)}return a}},6361:function(s,e,t){"use strict";var n=this&&this.__createBinding||(Object.create?function(g,m,y,_){_===void 0&&(_=y);var x=Object.getOwnPropertyDescriptor(m,y);x&&!("get"in x?!m.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return m[y]}}),Object.defineProperty(g,_,x)}:function(g,m,y,_){_===void 0&&(_=y),g[_]=m[y]}),i=this&&this.__setModuleDefault||(Object.create?function(g,m){Object.defineProperty(g,"default",{enumerable:!0,value:m})}:function(g,m){g.default=m}),r=this&&this.__importStar||function(g){if(g&&g.__esModule)return g;var m={};if(g!=null)for(var y in g)y!=="default"&&Object.prototype.hasOwnProperty.call(g,y)&&n(m,g,y);return i(m,g),m},o=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(e,"__esModule",{value:!0}),e.dispose=e.getInstance=e.initializeWebAssembly=void 0;let l=r(t(6449)),u=o(t(932)),h=t(3474),d,c=!1,a=!1,f=!1,p=(g,m)=>m?g?"ort-wasm-simd-threaded.wasm":"ort-wasm-threaded.wasm":g?"ort-wasm-simd.wasm":"ort-wasm.wasm";e.initializeWebAssembly=async g=>{if(c)return Promise.resolve();if(a)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(f)throw new Error("previous call to 'initializeWebAssembly()' failed.");a=!0;let m=g.initTimeout,y=g.numThreads,_=g.simd,x=y>1&&(()=>{try{return typeof SharedArrayBuffer<"u"&&(typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])))}catch{return!1}})(),E=_&&(()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}})(),S=typeof g.wasmPaths=="string"?g.wasmPaths:void 0,T=p(!1,x),C=p(E,x),I=typeof g.wasmPaths=="object"?g.wasmPaths[C]:void 0,A=!1,P=[];if(m>0&&P.push(new Promise(F=>{setTimeout(()=>{A=!0,F()},m)})),P.push(new Promise((F,H)=>{let z=x?h:u.default,B={locateFile:(V,M)=>x&&V.endsWith(".worker.js")&&typeof Blob<"u"?URL.createObjectURL(new Blob([t(4154)],{type:"text/javascript"})):V===T?I??(S??M)+C:M+V};if(x)if(typeof Blob>"u")B.mainScriptUrlOrBlob=l.join("/","ort-wasm-threaded.js");else{let V=`var ortWasmThreaded=(function(){var _scriptDir;return ${z.toString()}})();`;B.mainScriptUrlOrBlob=new Blob([V],{type:"text/javascript"})}z(B).then(V=>{a=!1,c=!0,d=V,F()},V=>{a=!1,f=!0,H(V)})})),await Promise.race(P),A)throw new Error(`WebAssembly backend initializing failed due to timeout: ${m}ms`)},e.getInstance=()=>{if(c&&d)return d;throw new Error("WebAssembly is not initialized yet.")},e.dispose=()=>{var g;!c||a||f||(a=!0,(g=d.PThread)===null||g===void 0||g.terminateAllThreads(),d=void 0,a=!1,c=!1,f=!0)}},9710:(s,e,t)=>{"use strict";t.d(e,{Z:()=>r});var n=t(477),i=t.n(n);function r(){return i()('/*!\n* ONNX Runtime Web v1.14.0\n* Copyright (c) Microsoft Corporation. All rights reserved.\n* Licensed under the MIT License.\n*/\n(()=>{var t={474:(t,e,n)=>{var _scriptDir,r=(_scriptDir=(_scriptDir="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(t){function e(){return j.buffer!=D&&N(j.buffer),P}function r(){return j.buffer!=D&&N(j.buffer),U}function a(){return j.buffer!=D&&N(j.buffer),F}function i(){return j.buffer!=D&&N(j.buffer),I}function o(){return j.buffer!=D&&N(j.buffer),W}var u,c,s;t=t||{},u||(u=void 0!==t?t:{}),u.ready=new Promise((function(t,e){c=t,s=e}));var l,f,p,h,d,y,b=Object.assign({},u),m="./this.program",g=(t,e)=>{throw e},v="object"==typeof window,w="function"==typeof importScripts,_="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,O=u.ENVIRONMENT_IS_PTHREAD||!1,A="";function S(t){return u.locateFile?u.locateFile(t,A):A+t}if(_){let e;A=w?n(908).dirname(A)+"/":"//",y=()=>{d||(h=n(384),d=n(908))},l=function(t,e){return y(),t=d.normalize(t),h.readFileSync(t,e?void 0:"utf8")},p=t=>((t=l(t,!0)).buffer||(t=new Uint8Array(t)),t),f=(t,e,n)=>{y(),t=d.normalize(t),h.readFile(t,(function(t,r){t?n(t):e(r.buffer)}))},1<process.argv.length&&(m=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(t){if(!(t instanceof ct))throw t})),process.on("unhandledRejection",(function(t){throw t})),g=(t,e)=>{if(Q())throw process.exitCode=t,e;e instanceof ct||x("exiting due to exception: "+e),process.exit(t)},u.inspect=function(){return"[Emscripten Module object]"};try{e=n(925)}catch(t){throw console.error(\'The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?\'),t}n.g.Worker=e.Worker}else(v||w)&&(w?A=self.location.href:"undefined"!=typeof document&&document.currentScript&&(A=document.currentScript.src),_scriptDir&&(A=_scriptDir),A=0!==A.indexOf("blob:")?A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1):"",_||(l=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},w&&(p=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),f=(t,e,n)=>{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?e(r.response):n()},r.onerror=n,r.send(null)}));_&&"undefined"==typeof performance&&(n.g.performance=n(953).performance);var T=console.log.bind(console),E=console.warn.bind(console);_&&(y(),T=t=>h.writeSync(1,t+"\\n"),E=t=>h.writeSync(2,t+"\\n"));var M,C=u.print||T,x=u.printErr||E;Object.assign(u,b),b=null,u.thisProgram&&(m=u.thisProgram),u.quit&&(g=u.quit),u.wasmBinary&&(M=u.wasmBinary);var R=u.noExitRuntime||!1;"object"!=typeof WebAssembly&&at("no native wasm support detected");var j,k,D,P,U,F,I,W,H=!1,L="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function z(t,e,n){var r=(e>>>=0)+n;for(n=e;t[n]&&!(n>=r);)++n;if(16<n-e&&t.buffer&&L)return L.decode(t.buffer instanceof SharedArrayBuffer?t.slice(e,n):t.subarray(e,n));for(r="";e<n;){var a=t[e++];if(128&a){var i=63&t[e++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|i);else{var o=63&t[e++];65536>(a=224==(240&a)?(15&a)<<12|i<<6|o:(7&a)<<18|i<<12|o<<6|63&t[e++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function Y(t,e){return(t>>>=0)?z(r(),t,e):""}function B(t,e,n,r){if(!(0<r))return 0;var a=n>>>=0;r=n+r-1;for(var i=0;i<t.length;++i){var o=t.charCodeAt(i);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++i)),127>=o){if(n>=r)break;e[n++>>>0]=o}else{if(2047>=o){if(n+1>=r)break;e[n++>>>0]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;e[n++>>>0]=224|o>>12}else{if(n+3>=r)break;e[n++>>>0]=240|o>>18,e[n++>>>0]=128|o>>12&63}e[n++>>>0]=128|o>>6&63}e[n++>>>0]=128|63&o}}return e[n>>>0]=0,n-a}function G(t){for(var e=0,n=0;n<t.length;++n){var r=t.charCodeAt(n);127>=r?e++:2047>=r?e+=2:55296<=r&&57343>=r?(e+=4,++n):e+=3}return e}function N(t){D=t,u.HEAP8=P=new Int8Array(t),u.HEAP16=new Int16Array(t),u.HEAP32=F=new Int32Array(t),u.HEAPU8=U=new Uint8Array(t),u.HEAPU16=new Uint16Array(t),u.HEAPU32=I=new Uint32Array(t),u.HEAPF32=new Float32Array(t),u.HEAPF64=W=new Float64Array(t)}O&&(D=u.buffer);var V=u.INITIAL_MEMORY||16777216;if(O)j=u.wasmMemory,D=u.buffer;else if(u.wasmMemory)j=u.wasmMemory;else if(!((j=new WebAssembly.Memory({initial:V/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw x("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),_&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");j&&(D=j.buffer),V=D.byteLength,N(D);var $,q=[],X=[],J=[],Z=[];function Q(){return R||!1}function K(){var t=u.preRun.shift();q.unshift(t)}var tt,et=0,nt=null,rt=null;function at(t){throw O?postMessage({cmd:"onAbort",arg:t}):u.onAbort&&u.onAbort(t),x(t="Aborted("+t+")"),H=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),s(t),t}function it(){return tt.startsWith("data:application/octet-stream;base64,")}function ot(){var t=tt;try{if(t==tt&&M)return new Uint8Array(M);if(p)return p(t);throw"both async and sync fetching of the wasm failed"}catch(t){at(t)}}tt="ort-wasm-threaded.wasm",it()||(tt=S(tt));var ut={};function ct(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function st(t){(t=ht.Vb[t])||at(),ht.mc(t)}function lt(t){var e=ht.Cc();if(!e)return 6;ht.ac.push(e),ht.Vb[t.Ub]=e,e.Ub=t.Ub;var n={cmd:"run",start_routine:t.Ic,arg:t.zc,pthread_ptr:t.Ub};return e.$b=()=>{n.time=performance.now(),e.postMessage(n,t.Nc)},e.loaded&&(e.$b(),delete e.$b),0}function ft(t){if(O)return $t(1,1,t);Q()||(ht.oc(),u.onExit&&u.onExit(t),H=!0),g(t,new ct(t))}function pt(t,e){if(!e&&O)throw bt(t),"unwind";Q()||O||(me(),dt(J),be(0),re[1].length&&ae(1,10),re[2].length&&ae(2,10),ht.oc()),ft(t)}var ht={Yb:[],ac:[],qc:[],Vb:{},fc:function(){O&&ht.Ec()},Pc:function(){},Ec:function(){ht.receiveObjectTransfer=ht.Gc,ht.threadInitTLS=ht.pc,ht.setExitStatus=ht.nc,R=!1},nc:function(){},oc:function(){for(var t of Object.values(ht.Vb))ht.mc(t);for(t of ht.Yb)t.terminate();ht.Yb=[]},mc:function(t){var e=t.Ub;delete ht.Vb[e],ht.Yb.push(t),ht.ac.splice(ht.ac.indexOf(t),1),t.Ub=0,Oe(e)},Gc:function(){},pc:function(){ht.qc.forEach((t=>t()))},Fc:function(t,e){t.onmessage=n=>{var r=(n=n.data).cmd;if(t.Ub&&(ht.Bc=t.Ub),n.targetThread&&n.targetThread!=he()){var a=ht.Vb[n.Qc];a?a.postMessage(n,n.transferList):x(\'Internal error! Worker sent a message "\'+r+\'" to target pthread \'+n.targetThread+", but that thread no longer exists!")}else"processProxyingQueue"===r?zt(n.queue):"spawnThread"===r?lt(n):"cleanupThread"===r?st(n.thread):"killThread"===r?(n=n.thread,r=ht.Vb[n],delete ht.Vb[n],r.terminate(),Oe(n),ht.ac.splice(ht.ac.indexOf(r),1),r.Ub=0):"cancelThread"===r?ht.Vb[n.thread].postMessage({cmd:"cancel"}):"loaded"===r?(t.loaded=!0,e&&e(t),t.$b&&(t.$b(),delete t.$b)):"print"===r?C("Thread "+n.threadId+": "+n.text):"printErr"===r?x("Thread "+n.threadId+": "+n.text):"alert"===r?alert("Thread "+n.threadId+": "+n.text):"setimmediate"===n.target?t.postMessage(n):"onAbort"===r?u.onAbort&&u.onAbort(n.arg):r&&x("worker sent an unknown command "+r);ht.Bc=void 0},t.onerror=t=>{throw x("worker sent an error! "+t.filename+":"+t.lineno+": "+t.message),t},_&&(t.on("message",(function(e){t.onmessage({data:e})})),t.on("error",(function(e){t.onerror(e)})),t.on("detachedExit",(function(){}))),t.postMessage({cmd:"load",urlOrBlob:u.mainScriptUrlOrBlob||_scriptDir,wasmMemory:j,wasmModule:k})},yc:function(){var t=S("ort-wasm-threaded.worker.js");ht.Yb.push(new Worker(t))},Cc:function(){return 0==ht.Yb.length&&(ht.yc(),ht.Fc(ht.Yb[0])),ht.Yb.pop()}};function dt(t){for(;0<t.length;)t.shift()(u)}function yt(t){var e=Ee();return t=t(),Me(e),t}function bt(t){if(O)return $t(2,0,t);try{pt(t)}catch(t){t instanceof ct||"unwind"==t||g(1,t)}}u.PThread=ht,u.establishStackSpace=function(){var t=he(),e=a()[t+44>>2>>>0];t=a()[t+48>>2>>>0],Te(e,e-t),Me(e)};var mt=[];function gt(t){var e=mt[t];return e||(t>=mt.length&&(mt.length=t+1),mt[t]=e=$.get(t)),e}u.invokeEntryPoint=function(t,e){t=gt(t)(e),Q()?ht.nc(t):Ae(t)};var vt,wt,_t=[],Ot=0,At=0;function St(t){this.Zb=t,this.Sb=t-24,this.xc=function(t){i()[this.Sb+4>>2>>>0]=t},this.bc=function(){return i()[this.Sb+4>>2>>>0]},this.wc=function(t){i()[this.Sb+8>>2>>>0]=t},this.Dc=function(){return i()[this.Sb+8>>2>>>0]},this.rc=function(){a()[this.Sb>>2>>>0]=0},this.hc=function(t){t=t?1:0,e()[this.Sb+12>>0>>>0]=t},this.uc=function(){return 0!=e()[this.Sb+12>>0>>>0]},this.ic=function(t){t=t?1:0,e()[this.Sb+13>>0>>>0]=t},this.kc=function(){return 0!=e()[this.Sb+13>>0>>>0]},this.fc=function(t,e){this.cc(0),this.xc(t),this.wc(e),this.rc(),this.hc(!1),this.ic(!1)},this.sc=function(){Atomics.add(a(),this.Sb>>2,1)},this.Hc=function(){return 1===Atomics.sub(a(),this.Sb>>2,1)},this.cc=function(t){i()[this.Sb+16>>2>>>0]=t},this.tc=function(){return i()[this.Sb+16>>2>>>0]},this.vc=function(){if(Re(this.bc()))return i()[this.Zb>>2>>>0];var t=this.tc();return 0!==t?t:this.Zb}}function Tt(t){return ye(new St(t).Sb)}function Et(t,e,n,r){return O?$t(3,1,t,e,n,r):Mt(t,e,n,r)}function Mt(t,e,n,r){if("undefined"==typeof SharedArrayBuffer)return x("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var a=[];return O&&0===a.length?Et(t,e,n,r):(t={Ic:n,Ub:t,zc:r,Nc:a},O?(t.Oc="spawnThread",postMessage(t,a),0):lt(t))}function Ct(t,e,n){return O?$t(4,1,t,e,n):0}function xt(t,e){if(O)return $t(5,1,t,e)}function Rt(t,e){if(O)return $t(6,1,t,e)}function jt(t,e,n){if(O)return $t(7,1,t,e,n)}function kt(t,e,n){return O?$t(8,1,t,e,n):0}function Dt(t,e){if(O)return $t(9,1,t,e)}function Pt(t,e,n){if(O)return $t(10,1,t,e,n)}function Ut(t,e,n,r){if(O)return $t(11,1,t,e,n,r)}function Ft(t,e,n,r){if(O)return $t(12,1,t,e,n,r)}function It(t,e,n,r){if(O)return $t(13,1,t,e,n,r)}function Wt(t){if(O)return $t(14,1,t)}function Ht(t,e){if(O)return $t(15,1,t,e)}function Lt(t,e,n){if(O)return $t(16,1,t,e,n)}function zt(t){Atomics.store(a(),t>>2,1),he()&&_e(t),Atomics.compareExchange(a(),t>>2,1,0)}function Yt(t){return i()[t>>>2]+4294967296*a()[t+4>>>2]}function Bt(t,e,n,r,a,i){return O?$t(17,1,t,e,n,r,a,i):-52}function Gt(t,e,n,r,a,i){if(O)return $t(18,1,t,e,n,r,a,i)}function Nt(t){var n=G(t)+1,r=de(n);return r&&B(t,e(),r,n),r}function Vt(t,e,n){function r(t){return(t=t.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?t[1]:"GMT"}if(O)return $t(19,1,t,e,n);var o=(new Date).getFullYear(),u=new Date(o,0,1),c=new Date(o,6,1);o=u.getTimezoneOffset();var s=c.getTimezoneOffset(),l=Math.max(o,s);a()[t>>2>>>0]=60*l,a()[e>>2>>>0]=Number(o!=s),t=r(u),e=r(c),t=Nt(t),e=Nt(e),s<o?(i()[n>>2>>>0]=t,i()[n+4>>2>>>0]=e):(i()[n>>2>>>0]=e,i()[n+4>>2>>>0]=t)}function $t(t,e){var n=arguments.length-2,r=arguments;return yt((()=>{for(var a=Ce(8*n),i=a>>3,u=0;u<n;u++){var c=r[2+u];o()[i+u>>>0]=c}return we(t,n,a,e)}))}u.executeNotifiedProxyingQueue=zt,wt=_?()=>{var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:O?()=>performance.now()-u.__performance_now_clock_drift:()=>performance.now();var qt,Xt=[],Jt={};function Zt(){if(!qt){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:m||"./this.program"};for(t in Jt)void 0===Jt[t]?delete e[t]:e[t]=Jt[t];var n=[];for(t in e)n.push(t+"="+e[t]);qt=n}return qt}function Qt(t,n){if(O)return $t(20,1,t,n);var r=0;return Zt().forEach((function(a,o){var u=n+r;for(o=i()[t+4*o>>2>>>0]=u,u=0;u<a.length;++u)e()[o++>>0>>>0]=a.charCodeAt(u);e()[o>>0>>>0]=0,r+=a.length+1})),0}function Kt(t,e){if(O)return $t(21,1,t,e);var n=Zt();i()[t>>2>>>0]=n.length;var r=0;return n.forEach((function(t){r+=t.length+1})),i()[e>>2>>>0]=r,0}function te(t){return O?$t(22,1,t):52}function ee(t,e,n,r){return O?$t(23,1,t,e,n,r):52}function ne(t,e,n,r,a){return O?$t(24,1,t,e,n,r,a):70}var re=[null,[],[]];function ae(t,e){var n=re[t];0===e||10===e?((1===t?C:x)(z(n,0)),n.length=0):n.push(e)}function ie(t,e,n,a){if(O)return $t(25,1,t,e,n,a);for(var o=0,u=0;u<n;u++){var c=i()[e>>2>>>0],s=i()[e+4>>2>>>0];e+=8;for(var l=0;l<s;l++)ae(t,r()[c+l>>>0]);o+=s}return i()[a>>2>>>0]=o,0}var oe=0;function ue(t){return 0==t%4&&(0!=t%100||0==t%400)}var ce=[31,29,31,30,31,30,31,31,30,31,30,31],se=[31,28,31,30,31,30,31,31,30,31,30,31];function le(t,n,r,i){function o(t,e,n){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=n[0]+t;return t}function u(t,e){return o(t,e,"0")}function c(t,e){function n(t){return 0>t?-1:0<t?1:0}var r;return 0===(r=n(t.getFullYear()-e.getFullYear()))&&0===(r=n(t.getMonth()-e.getMonth()))&&(r=n(t.getDate()-e.getDate())),r}function s(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function l(t){var e=t.Wb;for(t=new Date(new Date(t.Xb+1900,0,1).getTime());0<e;){var n=t.getMonth(),r=(ue(t.getFullYear())?ce:se)[n];if(!(e>r-t.getDate())){t.setDate(t.getDate()+e);break}e-=r-t.getDate()+1,t.setDate(1),11>n?t.setMonth(n+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return n=new Date(t.getFullYear()+1,0,4),e=s(new Date(t.getFullYear(),0,4)),n=s(n),0>=c(e,t)?0>=c(n,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var f=a()[i+40>>2>>>0];for(var p in i={Lc:a()[i>>2>>>0],Kc:a()[i+4>>2>>>0],dc:a()[i+8>>2>>>0],jc:a()[i+12>>2>>>0],ec:a()[i+16>>2>>>0],Xb:a()[i+20>>2>>>0],Tb:a()[i+24>>2>>>0],Wb:a()[i+28>>2>>>0],Rc:a()[i+32>>2>>>0],Jc:a()[i+36>>2>>>0],Mc:f?Y(f):""},r=Y(r),f={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})r=r.replace(new RegExp(p,"g"),f[p]);var h="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),d="January February March April May June July August September October November December".split(" ");for(p in f={"%a":function(t){return h[t.Tb].substring(0,3)},"%A":function(t){return h[t.Tb]},"%b":function(t){return d[t.ec].substring(0,3)},"%B":function(t){return d[t.ec]},"%C":function(t){return u((t.Xb+1900)/100|0,2)},"%d":function(t){return u(t.jc,2)},"%e":function(t){return o(t.jc,2," ")},"%g":function(t){return l(t).toString().substring(2)},"%G":function(t){return l(t)},"%H":function(t){return u(t.dc,2)},"%I":function(t){return 0==(t=t.dc)?t=12:12<t&&(t-=12),u(t,2)},"%j":function(t){for(var e=0,n=0;n<=t.ec-1;e+=(ue(t.Xb+1900)?ce:se)[n++]);return u(t.jc+e,3)},"%m":function(t){return u(t.ec+1,2)},"%M":function(t){return u(t.Kc,2)},"%n":function(){return"\\n"},"%p":function(t){return 0<=t.dc&&12>t.dc?"AM":"PM"},"%S":function(t){return u(t.Lc,2)},"%t":function(){return"\\t"},"%u":function(t){return t.Tb||7},"%U":function(t){return u(Math.floor((t.Wb+7-t.Tb)/7),2)},"%V":function(t){var e=Math.floor((t.Wb+7-(t.Tb+6)%7)/7);if(2>=(t.Tb+371-t.Wb-2)%7&&e++,e)53==e&&(4==(n=(t.Tb+371-t.Wb)%7)||3==n&&ue(t.Xb)||(e=1));else{e=52;var n=(t.Tb+7-t.Wb-1)%7;(4==n||5==n&&ue(t.Xb%400-1))&&e++}return u(e,2)},"%w":function(t){return t.Tb},"%W":function(t){return u(Math.floor((t.Wb+7-(t.Tb+6)%7)/7),2)},"%y":function(t){return(t.Xb+1900).toString().substring(2)},"%Y":function(t){return t.Xb+1900},"%z":function(t){var e=0<=(t=t.Jc);return t=Math.abs(t)/60,(e?"+":"-")+String("0000"+(t/60*100+t%60)).slice(-4)},"%Z":function(t){return t.Mc},"%%":function(){return"%"}},r=r.replace(/%%/g,"\\0\\0"),f)r.includes(p)&&(r=r.replace(new RegExp(p,"g"),f[p](i)));return p=function(t){var e=Array(G(t)+1);return B(t,e,0,e.length),e}(r=r.replace(/\\0\\0/g,"%")),p.length>n?0:(function(t,n){e().set(t,n>>>0)}(p,t),p.length-1)}ht.fc();var fe=[null,ft,bt,Et,Ct,xt,Rt,jt,kt,Dt,Pt,Ut,Ft,It,Wt,Ht,Lt,Bt,Gt,Vt,Qt,Kt,te,ee,ne,ie],pe={b:function(t){return de(t+24)+24},n:function(t){return(t=new St(t)).uc()||(t.hc(!0),Ot--),t.ic(!1),_t.push(t),t.sc(),t.vc()},ma:function(t){throw x("Unexpected exception thrown, this is not properly supported - aborting"),H=!0,t},x:function(){Se(0);var t=_t.pop();if(t.Hc()&&!t.kc()){var e=t.Dc();e&&gt(e)(t.Zb),Tt(t.Zb)}At=0},e:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},l:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},h:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},t:Tt,M:function(){var t=_t.pop();t||at("no exception to throw");var e=t.Zb;throw t.kc()||(_t.push(t),t.ic(!0),t.hc(!1),Ot++),At=e,e},c:function(t,e,n){throw new St(t).fc(e,n),At=t,Ot++,t},pa:function(){return Ot},Fa:function(t){ge(t,!w,1,!v),ht.pc()},T:function(t){O?postMessage({cmd:"cleanupThread",thread:t}):st(t)},xa:Mt,j:function(t){throw At||(At=t),t},H:Ct,Ma:xt,ua:Rt,wa:jt,oa:kt,Ka:Dt,Ca:Pt,Ja:Ut,V:Ft,va:It,sa:Wt,La:Ht,ta:Lt,Ta:function(){},X:function(){at("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ua:function(){at("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},W:function(){return Date.now()},ya:function(){return 2097152},Oa:function(){return!0},za:function(t,e,n,r){if(t==e)setTimeout((()=>zt(r)));else if(O)postMessage({targetThread:t,cmd:"processProxyingQueue",queue:r});else{if(!(t=ht.Vb[t]))return;t.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},Ea:function(){return-1},Pa:function(t,e){t=new Date(1e3*Yt(t)),a()[e>>2>>>0]=t.getUTCSeconds(),a()[e+4>>2>>>0]=t.getUTCMinutes(),a()[e+8>>2>>>0]=t.getUTCHours(),a()[e+12>>2>>>0]=t.getUTCDate(),a()[e+16>>2>>>0]=t.getUTCMonth(),a()[e+20>>2>>>0]=t.getUTCFullYear()-1900,a()[e+24>>2>>>0]=t.getUTCDay(),t=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,a()[e+28>>2>>>0]=t},Qa:function(t,e){t=new Date(1e3*Yt(t)),a()[e>>2>>>0]=t.getSeconds(),a()[e+4>>2>>>0]=t.getMinutes(),a()[e+8>>2>>>0]=t.getHours(),a()[e+12>>2>>>0]=t.getDate(),a()[e+16>>2>>>0]=t.getMonth(),a()[e+20>>2>>>0]=t.getFullYear()-1900,a()[e+24>>2>>>0]=t.getDay();var n=new Date(t.getFullYear(),0,1),r=(t.getTime()-n.getTime())/864e5|0;a()[e+28>>2>>>0]=r,a()[e+36>>2>>>0]=-60*t.getTimezoneOffset(),r=new Date(t.getFullYear(),6,1).getTimezoneOffset(),t=0|(r!=(n=n.getTimezoneOffset())&&t.getTimezoneOffset()==Math.min(n,r)),a()[e+32>>2>>>0]=t},Ra:function(t){var e=new Date(a()[t+20>>2>>>0]+1900,a()[t+16>>2>>>0],a()[t+12>>2>>>0],a()[t+8>>2>>>0],a()[t+4>>2>>>0],a()[t>>2>>>0],0),n=a()[t+32>>2>>>0],r=e.getTimezoneOffset(),i=new Date(e.getFullYear(),0,1),o=new Date(e.getFullYear(),6,1).getTimezoneOffset(),u=i.getTimezoneOffset(),c=Math.min(u,o);return 0>n?a()[t+32>>2>>>0]=Number(o!=u&&c==r):0<n!=(c==r)&&(o=Math.max(u,o),e.setTime(e.getTime()+6e4*((0<n?c:o)-r))),a()[t+24>>2>>>0]=e.getDay(),n=(e.getTime()-i.getTime())/864e5|0,a()[t+28>>2>>>0]=n,a()[t>>2>>>0]=e.getSeconds(),a()[t+4>>2>>>0]=e.getMinutes(),a()[t+8>>2>>>0]=e.getHours(),a()[t+12>>2>>>0]=e.getDate(),a()[t+16>>2>>>0]=e.getMonth(),e.getTime()/1e3|0},Aa:Bt,Ba:Gt,Sa:function t(e,n,r){t.Ac||(t.Ac=!0,Vt(e,n,r))},y:function(){at("")},U:function(){if(!_&&!w){var t="Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread";vt||(vt={}),vt[t]||(vt[t]=1,_&&(t="warning: "+t),x(t))}},ra:function(){return 4294901760},B:wt,Ia:function(t,e,n){r().copyWithin(t>>>0,e>>>0,e+n>>>0)},F:function(){return _?n(993).cpus().length:navigator.hardwareConcurrency},Da:function(t,e,n){Xt.length=e,n>>=3;for(var r=0;r<e;r++)Xt[r]=o()[n+r>>>0];return(0>t?ut[-t-1]:fe[t]).apply(null,Xt)},qa:function(t){var e=r().length;if((t>>>=0)<=e||4294901760<t)return!1;for(var n=1;4>=n;n*=2){var a=e*(1+.2/n);a=Math.min(a,t+100663296);var i=Math;a=Math.max(t,a),i=i.min.call(i,4294901760,a+(65536-a%65536)%65536);t:{try{j.grow(i-D.byteLength+65535>>>16),N(j.buffer);var o=1;break t}catch(t){}o=void 0}if(o)return!0}return!1},Na:function(){throw"unwind"},Ga:Qt,Ha:Kt,J:pt,I:te,S:ee,ga:ne,R:ie,d:function(){return oe},na:function t(r,a){t.lc||(t.lc=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);return()=>(crypto.getRandomValues(t),t[0])}if(_)try{var e=n(Object(function(){var t=new Error("Cannot find module \'crypto\'");throw t.code="MODULE_NOT_FOUND",t}()));return()=>e.randomBytes(1)[0]}catch(t){}return()=>at("randomDevice")}());for(var i=0;i<a;i++)e()[r+i>>0>>>0]=t.lc();return 0},ia:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},ja:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},K:function(t){var e=Ee();try{return gt(t)()}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},f:function(t,e){var n=Ee();try{return gt(t)(e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},P:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},Q:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},k:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},p:function(t,e,n,r){var a=Ee();try{return gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},q:function(t,e,n,r,a){var i=Ee();try{return gt(t)(e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},N:function(t,e,n,r,a,i){var o=Ee();try{return gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},s:function(t,e,n,r,a,i){var o=Ee();try{return gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},w:function(t,e,n,r,a,i,o){var u=Ee();try{return gt(t)(e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},L:function(t,e,n,r,a,i,o,u){var c=Ee();try{return gt(t)(e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},E:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=Ee();try{return gt(t)(e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(Me(p),t!==t+0)throw t;Se(1,0)}},aa:function(t,e,n,r,a,i,o,u){var c=Ee();try{return He(t,e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},_:function(t,e,n,r,a,i,o){var u=Ee();try{return ke(t,e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},Z:function(t,e,n,r,a){var i=Ee();try{return Le(t,e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},ca:function(t,e,n,r){var a=Ee();try{return Ie(t,e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},$:function(t){var e=Ee();try{return je(t)}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},ba:function(t,e){var n=Ee();try{return We(t,e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},Y:function(t,e,n){var r=Ee();try{return De(t,e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},g:function(t){var e=Ee();try{gt(t)()}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},r:function(t,e){var n=Ee();try{gt(t)(e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},i:function(t,e,n){var r=Ee();try{gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},ha:function(t,e,n,r){var a=Ee();try{gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},m:function(t,e,n,r){var a=Ee();try{gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},v:function(t,e,n,r,a){var i=Ee();try{gt(t)(e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},u:function(t,e,n,r,a,i){var o=Ee();try{gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},O:function(t,e,n,r,a,i,o){var u=Ee();try{gt(t)(e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},A:function(t,e,n,r,a,i,o,u){var c=Ee();try{gt(t)(e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},ka:function(t,e,n,r,a,i,o,u,c){var s=Ee();try{gt(t)(e,n,r,a,i,o,u,c)}catch(t){if(Me(s),t!==t+0)throw t;Se(1,0)}},C:function(t,e,n,r,a,i,o,u,c,s,l){var f=Ee();try{gt(t)(e,n,r,a,i,o,u,c,s,l)}catch(t){if(Me(f),t!==t+0)throw t;Se(1,0)}},D:function(t,e,n,r,a,i,o,u,c,s,l,f,p,h,d,y){var b=Ee();try{gt(t)(e,n,r,a,i,o,u,c,s,l,f,p,h,d,y)}catch(t){if(Me(b),t!==t+0)throw t;Se(1,0)}},fa:function(t,e,n,r,a,i,o,u){var c=Ee();try{Pe(t,e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},da:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=Ee();try{Fe(t,e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(Me(p),t!==t+0)throw t;Se(1,0)}},ea:function(t,e,n,r,a,i){var o=Ee();try{Ue(t,e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},o:function(t){return t},a:j||u.wasmMemory,G:function(t){oe=t},la:le,z:function(t,e,n,r){return le(t,e,n,r)}};!function(){function t(t,e){u.asm=t.exports,ht.qc.push(u.asm.sb),$=u.asm.ub,X.unshift(u.asm.Va),k=e,O||(et--,u.monitorRunDependencies&&u.monitorRunDependencies(et),0==et&&(null!==nt&&(clearInterval(nt),nt=null),rt&&(t=rt,rt=null,t())))}function e(e){t(e.instance,e.module)}function n(t){return function(){if(!M&&(v||w)){if("function"==typeof fetch&&!tt.startsWith("file://"))return fetch(tt,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at \'"+tt+"\'";return t.arrayBuffer()})).catch((function(){return ot()}));if(f)return new Promise((function(t,e){f(tt,(function(e){t(new Uint8Array(e))}),e)}))}return Promise.resolve().then((function(){return ot()}))}().then((function(t){return WebAssembly.instantiate(t,r)})).then((function(t){return t})).then(t,(function(t){x("failed to asynchronously prepare wasm: "+t),at(t)}))}var r={a:pe};if(O||(et++,u.monitorRunDependencies&&u.monitorRunDependencies(et)),u.instantiateWasm)try{return u.instantiateWasm(r,t)}catch(t){return x("Module.instantiateWasm callback failed with error: "+t),!1}(M||"function"!=typeof WebAssembly.instantiateStreaming||it()||tt.startsWith("file://")||_||"function"!=typeof fetch?n(e):fetch(tt,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,r).then(e,(function(t){return x("wasm streaming compile failed: "+t),x("falling back to ArrayBuffer instantiation"),n(e)}))}))).catch(s)}(),u.___wasm_call_ctors=function(){return(u.___wasm_call_ctors=u.asm.Va).apply(null,arguments)},u._OrtInit=function(){return(u._OrtInit=u.asm.Wa).apply(null,arguments)},u._OrtCreateSessionOptions=function(){return(u._OrtCreateSessionOptions=u.asm.Xa).apply(null,arguments)},u._OrtAppendExecutionProvider=function(){return(u._OrtAppendExecutionProvider=u.asm.Ya).apply(null,arguments)},u._OrtAddSessionConfigEntry=function(){return(u._OrtAddSessionConfigEntry=u.asm.Za).apply(null,arguments)},u._OrtReleaseSessionOptions=function(){return(u._OrtReleaseSessionOptions=u.asm._a).apply(null,arguments)},u._OrtCreateSession=function(){return(u._OrtCreateSession=u.asm.$a).apply(null,arguments)},u._OrtReleaseSession=function(){return(u._OrtReleaseSession=u.asm.ab).apply(null,arguments)},u._OrtGetInputCount=function(){return(u._OrtGetInputCount=u.asm.bb).apply(null,arguments)},u._OrtGetOutputCount=function(){return(u._OrtGetOutputCount=u.asm.cb).apply(null,arguments)},u._OrtGetInputName=function(){return(u._OrtGetInputName=u.asm.db).apply(null,arguments)},u._OrtGetOutputName=function(){return(u._OrtGetOutputName=u.asm.eb).apply(null,arguments)},u._OrtFree=function(){return(u._OrtFree=u.asm.fb).apply(null,arguments)},u._OrtCreateTensor=function(){return(u._OrtCreateTensor=u.asm.gb).apply(null,arguments)},u._OrtGetTensorData=function(){return(u._OrtGetTensorData=u.asm.hb).apply(null,arguments)},u._OrtReleaseTensor=function(){return(u._OrtReleaseTensor=u.asm.ib).apply(null,arguments)},u._OrtCreateRunOptions=function(){return(u._OrtCreateRunOptions=u.asm.jb).apply(null,arguments)},u._OrtAddRunConfigEntry=function(){return(u._OrtAddRunConfigEntry=u.asm.kb).apply(null,arguments)},u._OrtReleaseRunOptions=function(){return(u._OrtReleaseRunOptions=u.asm.lb).apply(null,arguments)},u._OrtRun=function(){return(u._OrtRun=u.asm.mb).apply(null,arguments)},u._OrtEndProfiling=function(){return(u._OrtEndProfiling=u.asm.nb).apply(null,arguments)};var he=u._pthread_self=function(){return(he=u._pthread_self=u.asm.ob).apply(null,arguments)},de=u._malloc=function(){return(de=u._malloc=u.asm.pb).apply(null,arguments)},ye=u._free=function(){return(ye=u._free=u.asm.qb).apply(null,arguments)},be=u._fflush=function(){return(be=u._fflush=u.asm.rb).apply(null,arguments)};u.__emscripten_tls_init=function(){return(u.__emscripten_tls_init=u.asm.sb).apply(null,arguments)};var me=u.___funcs_on_exit=function(){return(me=u.___funcs_on_exit=u.asm.tb).apply(null,arguments)},ge=u.__emscripten_thread_init=function(){return(ge=u.__emscripten_thread_init=u.asm.vb).apply(null,arguments)};u.__emscripten_thread_crashed=function(){return(u.__emscripten_thread_crashed=u.asm.wb).apply(null,arguments)};var ve,we=u._emscripten_run_in_main_runtime_thread_js=function(){return(we=u._emscripten_run_in_main_runtime_thread_js=u.asm.xb).apply(null,arguments)},_e=u.__emscripten_proxy_execute_task_queue=function(){return(_e=u.__emscripten_proxy_execute_task_queue=u.asm.yb).apply(null,arguments)},Oe=u.__emscripten_thread_free_data=function(){return(Oe=u.__emscripten_thread_free_data=u.asm.zb).apply(null,arguments)},Ae=u.__emscripten_thread_exit=function(){return(Ae=u.__emscripten_thread_exit=u.asm.Ab).apply(null,arguments)},Se=u._setThrew=function(){return(Se=u._setThrew=u.asm.Bb).apply(null,arguments)},Te=u._emscripten_stack_set_limits=function(){return(Te=u._emscripten_stack_set_limits=u.asm.Cb).apply(null,arguments)},Ee=u.stackSave=function(){return(Ee=u.stackSave=u.asm.Db).apply(null,arguments)},Me=u.stackRestore=function(){return(Me=u.stackRestore=u.asm.Eb).apply(null,arguments)},Ce=u.stackAlloc=function(){return(Ce=u.stackAlloc=u.asm.Fb).apply(null,arguments)},xe=u.___cxa_can_catch=function(){return(xe=u.___cxa_can_catch=u.asm.Gb).apply(null,arguments)},Re=u.___cxa_is_pointer_type=function(){return(Re=u.___cxa_is_pointer_type=u.asm.Hb).apply(null,arguments)},je=u.dynCall_j=function(){return(je=u.dynCall_j=u.asm.Ib).apply(null,arguments)},ke=u.dynCall_iiiiij=function(){return(ke=u.dynCall_iiiiij=u.asm.Jb).apply(null,arguments)},De=u.dynCall_jii=function(){return(De=u.dynCall_jii=u.asm.Kb).apply(null,arguments)},Pe=u.dynCall_viiiiij=function(){return(Pe=u.dynCall_viiiiij=u.asm.Lb).apply(null,arguments)},Ue=u.dynCall_vjji=function(){return(Ue=u.dynCall_vjji=u.asm.Mb).apply(null,arguments)},Fe=u.dynCall_viiijjjii=function(){return(Fe=u.dynCall_viiijjjii=u.asm.Nb).apply(null,arguments)},Ie=u.dynCall_iij=function(){return(Ie=u.dynCall_iij=u.asm.Ob).apply(null,arguments)},We=u.dynCall_ji=function(){return(We=u.dynCall_ji=u.asm.Pb).apply(null,arguments)},He=u.dynCall_iiiiiij=function(){return(He=u.dynCall_iiiiiij=u.asm.Qb).apply(null,arguments)},Le=u.dynCall_iiij=function(){return(Le=u.dynCall_iiij=u.asm.Rb).apply(null,arguments)};function ze(){function t(){if(!ve&&(ve=!0,u.calledRun=!0,!H)&&(O||dt(X),c(u),u.onRuntimeInitialized&&u.onRuntimeInitialized(),!O)){if(u.postRun)for("function"==typeof u.postRun&&(u.postRun=[u.postRun]);u.postRun.length;){var t=u.postRun.shift();Z.unshift(t)}dt(Z)}}if(!(0<et))if(O)c(u),O||dt(X),postMessage({cmd:"loaded"});else{if(u.preRun)for("function"==typeof u.preRun&&(u.preRun=[u.preRun]);u.preRun.length;)K();dt(q),0<et||(u.setStatus?(u.setStatus("Running..."),setTimeout((function(){setTimeout((function(){u.setStatus("")}),1),t()}),1)):t())}}if(u.UTF8ToString=Y,u.stringToUTF8=function(t,e,n){return B(t,r(),e,n)},u.lengthBytesUTF8=G,u.keepRuntimeAlive=Q,u.wasmMemory=j,u.stackSave=Ee,u.stackRestore=Me,u.stackAlloc=Ce,u.ExitStatus=ct,u.PThread=ht,rt=function t(){ve||ze(),ve||(rt=t)},u.preInit)for("function"==typeof u.preInit&&(u.preInit=[u.preInit]);0<u.preInit.length;)u.preInit.pop()();return ze(),t.ready});t.exports=r},932:(t,e,n)=>{var _scriptDir,r=(_scriptDir=(_scriptDir="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(t){var e,r,a;t=t||{},e||(e=void 0!==t?t:{}),e.ready=new Promise((function(t,e){r=t,a=e}));var i,o,u,c,s,l,f=Object.assign({},e),p="./this.program",h=(t,e)=>{throw e},d="object"==typeof window,y="function"==typeof importScripts,b="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,m="";b?(m=y?n(908).dirname(m)+"/":"//",l=()=>{s||(c=n(384),s=n(908))},i=function(t,e){return l(),t=s.normalize(t),c.readFileSync(t,e?void 0:"utf8")},u=t=>((t=i(t,!0)).buffer||(t=new Uint8Array(t)),t),o=(t,e,n)=>{l(),t=s.normalize(t),c.readFile(t,(function(t,r){t?n(t):e(r.buffer)}))},1<process.argv.length&&(p=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(t){if(!(t instanceof J))throw t})),process.on("unhandledRejection",(function(t){throw t})),h=(t,e)=>{if(_||0<L)throw process.exitCode=t,e;e instanceof J||w("exiting due to exception: "+e),process.exit(t)},e.inspect=function(){return"[Emscripten Module object]"}):(d||y)&&(y?m=self.location.href:"undefined"!=typeof document&&document.currentScript&&(m=document.currentScript.src),_scriptDir&&(m=_scriptDir),m=0!==m.indexOf("blob:")?m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):"",i=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},y&&(u=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),o=(t,e,n)=>{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?e(r.response):n()},r.onerror=n,r.send(null)});var g,v=e.print||console.log.bind(console),w=e.printErr||console.warn.bind(console);Object.assign(e,f),f=null,e.thisProgram&&(p=e.thisProgram),e.quit&&(h=e.quit),e.wasmBinary&&(g=e.wasmBinary);var _=e.noExitRuntime||!1;"object"!=typeof WebAssembly&&V("no native wasm support detected");var O,A,S,T,E,M,C=!1,x="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function R(t,e,n){var r=(e>>>=0)+n;for(n=e;t[n]&&!(n>=r);)++n;if(16<n-e&&t.buffer&&x)return x.decode(t.subarray(e,n));for(r="";e<n;){var a=t[e++];if(128&a){var i=63&t[e++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|i);else{var o=63&t[e++];65536>(a=224==(240&a)?(15&a)<<12|i<<6|o:(7&a)<<18|i<<12|o<<6|63&t[e++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function j(t,e){return(t>>>=0)?R(T,t,e):""}function k(t,e,n,r){if(!(0<r))return 0;var a=n>>>=0;r=n+r-1;for(var i=0;i<t.length;++i){var o=t.charCodeAt(i);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++i)),127>=o){if(n>=r)break;e[n++>>>0]=o}else{if(2047>=o){if(n+1>=r)break;e[n++>>>0]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;e[n++>>>0]=224|o>>12}else{if(n+3>=r)break;e[n++>>>0]=240|o>>18,e[n++>>>0]=128|o>>12&63}e[n++>>>0]=128|o>>6&63}e[n++>>>0]=128|63&o}}return e[n>>>0]=0,n-a}function D(t){for(var e=0,n=0;n<t.length;++n){var r=t.charCodeAt(n);127>=r?e++:2047>=r?e+=2:55296<=r&&57343>=r?(e+=4,++n):e+=3}return e}function P(){var t=O.buffer;A=t,e.HEAP8=S=new Int8Array(t),e.HEAP16=new Int16Array(t),e.HEAP32=E=new Int32Array(t),e.HEAPU8=T=new Uint8Array(t),e.HEAPU16=new Uint16Array(t),e.HEAPU32=M=new Uint32Array(t),e.HEAPF32=new Float32Array(t),e.HEAPF64=new Float64Array(t)}var U,F=[],I=[],W=[],H=[],L=0;function z(){var t=e.preRun.shift();F.unshift(t)}var Y,B=0,G=null,N=null;function V(t){throw e.onAbort&&e.onAbort(t),w(t="Aborted("+t+")"),C=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),a(t),t}function $(){return Y.startsWith("data:application/octet-stream;base64,")}if(Y="ort-wasm.wasm",!$()){var q=Y;Y=e.locateFile?e.locateFile(q,m):m+q}function X(){var t=Y;try{if(t==Y&&g)return new Uint8Array(g);if(u)return u(t);throw"both async and sync fetching of the wasm failed"}catch(t){V(t)}}function J(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function Z(t){for(;0<t.length;)t.shift()(e)}var Q=[],K=0,tt=0;function et(t){this.Db=t,this.zb=t-24,this.Ub=function(t){M[this.zb+4>>2>>>0]=t},this.Eb=function(){return M[this.zb+4>>2>>>0]},this.Sb=function(t){M[this.zb+8>>2>>>0]=t},this.Wb=function(){return M[this.zb+8>>2>>>0]},this.Tb=function(){E[this.zb>>2>>>0]=0},this.Ib=function(t){S[this.zb+12>>0>>>0]=t?1:0},this.Pb=function(){return 0!=S[this.zb+12>>0>>>0]},this.Jb=function(t){S[this.zb+13>>0>>>0]=t?1:0},this.Lb=function(){return 0!=S[this.zb+13>>0>>>0]},this.Rb=function(t,e){this.Fb(0),this.Ub(t),this.Sb(e),this.Tb(),this.Ib(!1),this.Jb(!1)},this.Nb=function(){E[this.zb>>2>>>0]+=1},this.Xb=function(){var t=E[this.zb>>2>>>0];return E[this.zb>>2>>>0]=t-1,1===t},this.Fb=function(t){M[this.zb+16>>2>>>0]=t},this.Ob=function(){return M[this.zb+16>>2>>>0]},this.Qb=function(){if(Mt(this.Eb()))return M[this.Db>>2>>>0];var t=this.Ob();return 0!==t?t:this.Db}}function nt(t){return vt(new et(t).zb)}var rt=[];function at(t){var e=rt[t];return e||(t>=rt.length&&(rt.length=t+1),rt[t]=e=U.get(t)),e}function it(t){var e=D(t)+1,n=gt(e);return n&&k(t,S,n,e),n}var ot={};function ut(){if(!ct){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:p||"./this.program"};for(t in ot)void 0===ot[t]?delete e[t]:e[t]=ot[t];var n=[];for(t in e)n.push(t+"="+e[t]);ct=n}return ct}var ct,st=[null,[],[]];function lt(t,e){var n=st[t];0===e||10===e?((1===t?v:w)(R(n,0)),n.length=0):n.push(e)}var ft=0;function pt(t){return 0==t%4&&(0!=t%100||0==t%400)}var ht=[31,29,31,30,31,30,31,31,30,31,30,31],dt=[31,28,31,30,31,30,31,31,30,31,30,31];function yt(t,e,n,r){function a(t,e,n){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=n[0]+t;return t}function i(t,e){return a(t,e,"0")}function o(t,e){function n(t){return 0>t?-1:0<t?1:0}var r;return 0===(r=n(t.getFullYear()-e.getFullYear()))&&0===(r=n(t.getMonth()-e.getMonth()))&&(r=n(t.getDate()-e.getDate())),r}function u(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function c(t){var e=t.Bb;for(t=new Date(new Date(t.Cb+1900,0,1).getTime());0<e;){var n=t.getMonth(),r=(pt(t.getFullYear())?ht:dt)[n];if(!(e>r-t.getDate())){t.setDate(t.getDate()+e);break}e-=r-t.getDate()+1,t.setDate(1),11>n?t.setMonth(n+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return n=new Date(t.getFullYear()+1,0,4),e=u(new Date(t.getFullYear(),0,4)),n=u(n),0>=o(e,t)?0>=o(n,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var s=E[r+40>>2>>>0];for(var l in r={$b:E[r>>2>>>0],Zb:E[r+4>>2>>>0],Gb:E[r+8>>2>>>0],Kb:E[r+12>>2>>>0],Hb:E[r+16>>2>>>0],Cb:E[r+20>>2>>>0],Ab:E[r+24>>2>>>0],Bb:E[r+28>>2>>>0],bc:E[r+32>>2>>>0],Yb:E[r+36>>2>>>0],ac:s?j(s):""},n=j(n),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(l,"g"),s[l]);var f="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),p="January February March April May June July August September October November December".split(" ");for(l in s={"%a":function(t){return f[t.Ab].substring(0,3)},"%A":function(t){return f[t.Ab]},"%b":function(t){return p[t.Hb].substring(0,3)},"%B":function(t){return p[t.Hb]},"%C":function(t){return i((t.Cb+1900)/100|0,2)},"%d":function(t){return i(t.Kb,2)},"%e":function(t){return a(t.Kb,2," ")},"%g":function(t){return c(t).toString().substring(2)},"%G":function(t){return c(t)},"%H":function(t){return i(t.Gb,2)},"%I":function(t){return 0==(t=t.Gb)?t=12:12<t&&(t-=12),i(t,2)},"%j":function(t){for(var e=0,n=0;n<=t.Hb-1;e+=(pt(t.Cb+1900)?ht:dt)[n++]);return i(t.Kb+e,3)},"%m":function(t){return i(t.Hb+1,2)},"%M":function(t){return i(t.Zb,2)},"%n":function(){return"\\n"},"%p":function(t){return 0<=t.Gb&&12>t.Gb?"AM":"PM"},"%S":function(t){return i(t.$b,2)},"%t":function(){return"\\t"},"%u":function(t){return t.Ab||7},"%U":function(t){return i(Math.floor((t.Bb+7-t.Ab)/7),2)},"%V":function(t){var e=Math.floor((t.Bb+7-(t.Ab+6)%7)/7);if(2>=(t.Ab+371-t.Bb-2)%7&&e++,e)53==e&&(4==(n=(t.Ab+371-t.Bb)%7)||3==n&&pt(t.Cb)||(e=1));else{e=52;var n=(t.Ab+7-t.Bb-1)%7;(4==n||5==n&&pt(t.Cb%400-1))&&e++}return i(e,2)},"%w":function(t){return t.Ab},"%W":function(t){return i(Math.floor((t.Bb+7-(t.Ab+6)%7)/7),2)},"%y":function(t){return(t.Cb+1900).toString().substring(2)},"%Y":function(t){return t.Cb+1900},"%z":function(t){var e=0<=(t=t.Yb);return t=Math.abs(t)/60,(e?"+":"-")+String("0000"+(t/60*100+t%60)).slice(-4)},"%Z":function(t){return t.ac},"%%":function(){return"%"}},n=n.replace(/%%/g,"\\0\\0"),s)n.includes(l)&&(n=n.replace(new RegExp(l,"g"),s[l](r)));return l=function(t){var e=Array(D(t)+1);return k(t,e,0,e.length),e}(n=n.replace(/\\0\\0/g,"%")),l.length>e?0:(S.set(l,t>>>0),l.length-1)}var bt={a:function(t){return gt(t+24)+24},m:function(t){return(t=new et(t)).Pb()||(t.Ib(!0),K--),t.Jb(!1),Q.push(t),t.Nb(),t.Qb()},ia:function(t){throw w("Unexpected exception thrown, this is not properly supported - aborting"),C=!0,t},w:function(){Ot(0);var t=Q.pop();if(t.Xb()&&!t.Lb()){var e=t.Wb();e&&at(e)(t.Db),nt(t.Db)}tt=0},d:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},k:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},g:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},s:nt,L:function(){var t=Q.pop();t||V("no exception to throw");var e=t.Db;throw t.Lb()||(Q.push(t),t.Jb(!0),t.Ib(!1),K++),tt=e,e},b:function(t,e,n){throw new et(t).Rb(e,n),tt=t,K++,t},la:function(){return K},i:function(t){throw tt||(tt=t),t},H:function(){return 0},Ba:function(){},pa:function(){},ra:function(){},ka:function(){return 0},za:function(){},ua:function(){},ya:function(){},R:function(){},qa:function(){},na:function(){},Aa:function(){},oa:function(){},Ha:function(){},Ja:function(){V("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ia:function(){V("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},S:function(){return Date.now()},Ca:function(){return!0},Da:function(t,e){t=new Date(1e3*(M[t>>>2]+4294967296*E[t+4>>>2])),E[e>>2>>>0]=t.getUTCSeconds(),E[e+4>>2>>>0]=t.getUTCMinutes(),E[e+8>>2>>>0]=t.getUTCHours(),E[e+12>>2>>>0]=t.getUTCDate(),E[e+16>>2>>>0]=t.getUTCMonth(),E[e+20>>2>>>0]=t.getUTCFullYear()-1900,E[e+24>>2>>>0]=t.getUTCDay(),E[e+28>>2>>>0]=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},Ea:function(t,e){t=new Date(1e3*(M[t>>>2]+4294967296*E[t+4>>>2])),E[e>>2>>>0]=t.getSeconds(),E[e+4>>2>>>0]=t.getMinutes(),E[e+8>>2>>>0]=t.getHours(),E[e+12>>2>>>0]=t.getDate(),E[e+16>>2>>>0]=t.getMonth(),E[e+20>>2>>>0]=t.getFullYear()-1900,E[e+24>>2>>>0]=t.getDay();var n=new Date(t.getFullYear(),0,1);E[e+28>>2>>>0]=(t.getTime()-n.getTime())/864e5|0,E[e+36>>2>>>0]=-60*t.getTimezoneOffset();var r=new Date(t.getFullYear(),6,1).getTimezoneOffset();n=n.getTimezoneOffset(),E[e+32>>2>>>0]=0|(r!=n&&t.getTimezoneOffset()==Math.min(n,r))},Fa:function(t){var e=new Date(E[t+20>>2>>>0]+1900,E[t+16>>2>>>0],E[t+12>>2>>>0],E[t+8>>2>>>0],E[t+4>>2>>>0],E[t>>2>>>0],0),n=E[t+32>>2>>>0],r=e.getTimezoneOffset(),a=new Date(e.getFullYear(),0,1),i=new Date(e.getFullYear(),6,1).getTimezoneOffset(),o=a.getTimezoneOffset(),u=Math.min(o,i);return 0>n?E[t+32>>2>>>0]=Number(i!=o&&u==r):0<n!=(u==r)&&(i=Math.max(o,i),e.setTime(e.getTime()+6e4*((0<n?u:i)-r))),E[t+24>>2>>>0]=e.getDay(),E[t+28>>2>>>0]=(e.getTime()-a.getTime())/864e5|0,E[t>>2>>>0]=e.getSeconds(),E[t+4>>2>>>0]=e.getMinutes(),E[t+8>>2>>>0]=e.getHours(),E[t+12>>2>>>0]=e.getDate(),E[t+16>>2>>>0]=e.getMonth(),e.getTime()/1e3|0},sa:function(){return-52},ta:function(){},Ga:function t(e,n,r){t.Vb||(t.Vb=!0,function(t,e,n){function r(t){return(t=t.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?t[1]:"GMT"}var a=(new Date).getFullYear(),i=new Date(a,0,1),o=new Date(a,6,1);a=i.getTimezoneOffset();var u=o.getTimezoneOffset();E[t>>2>>>0]=60*Math.max(a,u),E[e>>2>>>0]=Number(a!=u),t=r(i),e=r(o),t=it(t),e=it(e),u<a?(M[n>>2>>>0]=t,M[n+4>>2>>>0]=e):(M[n>>2>>>0]=e,M[n+4>>2>>>0]=t)}(e,n,r))},B:function(){V("")},ma:function(){return 4294901760},I:b?()=>{var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:()=>performance.now(),xa:function(t,e,n){T.copyWithin(t>>>0,e>>>0,e+n>>>0)},G:function(t){var e=T.length;if(4294901760<(t>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=e*(1+.2/n);r=Math.min(r,t+100663296);var a=Math;r=Math.max(t,r),a=a.min.call(a,4294901760,r+(65536-r%65536)%65536);t:{try{O.grow(a-A.byteLength+65535>>>16),P();var i=1;break t}catch(t){}i=void 0}if(i)return!0}return!1},va:function(t,e){var n=0;return ut().forEach((function(r,a){var i=e+n;for(a=M[t+4*a>>2>>>0]=i,i=0;i<r.length;++i)S[a++>>0>>>0]=r.charCodeAt(i);S[a>>0>>>0]=0,n+=r.length+1})),0},wa:function(t,e){var n=ut();M[t>>2>>>0]=n.length;var r=0;return n.forEach((function(t){r+=t.length+1})),M[e>>2>>>0]=r,0},ba:function(t){_||0<L||(_t(),Z(W),wt(0),st[1].length&&lt(1,10),st[2].length&&lt(2,10)),_||0<L||(e.onExit&&e.onExit(t),C=!0),h(t,new J(t))},E:function(){return 52},Q:function(){return 52},ca:function(){return 70},P:function(t,e,n,r){for(var a=0,i=0;i<n;i++){var o=M[e>>2>>>0],u=M[e+4>>2>>>0];e+=8;for(var c=0;c<u;c++)lt(t,T[o+c>>>0]);a+=u}return M[r>>2>>>0]=a,0},c:function(){return ft},ja:function t(e,r){t.Mb||(t.Mb=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);return()=>(crypto.getRandomValues(t),t[0])}if(b)try{var e=n(Object(function(){var t=new Error("Cannot find module \'crypto\'");throw t.code="MODULE_NOT_FOUND",t}()));return()=>e.randomBytes(1)[0]}catch(t){}return()=>V("randomDevice")}());for(var a=0;a<r;a++)S[e+a>>0>>>0]=t.Mb();return 0},ea:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},fa:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},J:function(t){var e=At();try{return at(t)()}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},e:function(t,e){var n=At();try{return at(t)(e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},N:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},O:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},j:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},o:function(t,e,n,r){var a=At();try{return at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},p:function(t,e,n,r,a){var i=At();try{return at(t)(e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},M:function(t,e,n,r,a,i){var o=At();try{return at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},r:function(t,e,n,r,a,i){var o=At();try{return at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},v:function(t,e,n,r,a,i,o){var u=At();try{return at(t)(e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},K:function(t,e,n,r,a,i,o,u){var c=At();try{return at(t)(e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},D:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=At();try{return at(t)(e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(St(p),t!==t+0)throw t;Ot(1,0)}},X:function(t,e,n,r,a,i,o,u){var c=At();try{return Ft(t,e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},V:function(t,e,n,r,a,i,o){var u=At();try{return xt(t,e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},U:function(t,e,n,r,a){var i=At();try{return It(t,e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},Z:function(t,e,n,r){var a=At();try{return Pt(t,e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},W:function(t){var e=At();try{return Ct(t)}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},Y:function(t,e){var n=At();try{return Ut(t,e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},T:function(t,e,n){var r=At();try{return Rt(t,e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},f:function(t){var e=At();try{at(t)()}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},q:function(t,e){var n=At();try{at(t)(e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},h:function(t,e,n){var r=At();try{at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},da:function(t,e,n,r){var a=At();try{at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},l:function(t,e,n,r){var a=At();try{at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},t:function(t,e,n,r,a){var i=At();try{at(t)(e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},u:function(t,e,n,r,a,i){var o=At();try{at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},x:function(t,e,n,r,a,i,o){var u=At();try{at(t)(e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},z:function(t,e,n,r,a,i,o,u){var c=At();try{at(t)(e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},ga:function(t,e,n,r,a,i,o,u,c){var s=At();try{at(t)(e,n,r,a,i,o,u,c)}catch(t){if(St(s),t!==t+0)throw t;Ot(1,0)}},A:function(t,e,n,r,a,i,o,u,c,s,l){var f=At();try{at(t)(e,n,r,a,i,o,u,c,s,l)}catch(t){if(St(f),t!==t+0)throw t;Ot(1,0)}},C:function(t,e,n,r,a,i,o,u,c,s,l,f,p,h,d,y){var b=At();try{at(t)(e,n,r,a,i,o,u,c,s,l,f,p,h,d,y)}catch(t){if(St(b),t!==t+0)throw t;Ot(1,0)}},aa:function(t,e,n,r,a,i,o,u){var c=At();try{jt(t,e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},_:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=At();try{Dt(t,e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(St(p),t!==t+0)throw t;Ot(1,0)}},$:function(t,e,n,r,a,i){var o=At();try{kt(t,e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},n:function(t){return t},F:function(t){ft=t},ha:yt,y:function(t,e,n,r){return yt(t,e,n,r)}};!function(){function t(t){e.asm=t.exports,O=e.asm.Ka,P(),U=e.asm.ib,I.unshift(e.asm.La),B--,e.monitorRunDependencies&&e.monitorRunDependencies(B),0==B&&(null!==G&&(clearInterval(G),G=null),N&&(t=N,N=null,t()))}function n(e){t(e.instance)}function r(t){return function(){if(!g&&(d||y)){if("function"==typeof fetch&&!Y.startsWith("file://"))return fetch(Y,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at \'"+Y+"\'";return t.arrayBuffer()})).catch((function(){return X()}));if(o)return new Promise((function(t,e){o(Y,(function(e){t(new Uint8Array(e))}),e)}))}return Promise.resolve().then((function(){return X()}))}().then((function(t){return WebAssembly.instantiate(t,i)})).then((function(t){return t})).then(t,(function(t){w("failed to asynchronously prepare wasm: "+t),V(t)}))}var i={a:bt};if(B++,e.monitorRunDependencies&&e.monitorRunDependencies(B),e.instantiateWasm)try{return e.instantiateWasm(i,t)}catch(t){return w("Module.instantiateWasm callback failed with error: "+t),!1}(g||"function"!=typeof WebAssembly.instantiateStreaming||$()||Y.startsWith("file://")||b||"function"!=typeof fetch?r(n):fetch(Y,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,i).then(n,(function(t){return w("wasm streaming compile failed: "+t),w("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(a)}(),e.___wasm_call_ctors=function(){return(e.___wasm_call_ctors=e.asm.La).apply(null,arguments)},e._OrtInit=function(){return(e._OrtInit=e.asm.Ma).apply(null,arguments)},e._OrtCreateSessionOptions=function(){return(e._OrtCreateSessionOptions=e.asm.Na).apply(null,arguments)},e._OrtAppendExecutionProvider=function(){return(e._OrtAppendExecutionProvider=e.asm.Oa).apply(null,arguments)},e._OrtAddSessionConfigEntry=function(){return(e._OrtAddSessionConfigEntry=e.asm.Pa).apply(null,arguments)},e._OrtReleaseSessionOptions=function(){return(e._OrtReleaseSessionOptions=e.asm.Qa).apply(null,arguments)},e._OrtCreateSession=function(){return(e._OrtCreateSession=e.asm.Ra).apply(null,arguments)},e._OrtReleaseSession=function(){return(e._OrtReleaseSession=e.asm.Sa).apply(null,arguments)},e._OrtGetInputCount=function(){return(e._OrtGetInputCount=e.asm.Ta).apply(null,arguments)},e._OrtGetOutputCount=function(){return(e._OrtGetOutputCount=e.asm.Ua).apply(null,arguments)},e._OrtGetInputName=function(){return(e._OrtGetInputName=e.asm.Va).apply(null,arguments)},e._OrtGetOutputName=function(){return(e._OrtGetOutputName=e.asm.Wa).apply(null,arguments)},e._OrtFree=function(){return(e._OrtFree=e.asm.Xa).apply(null,arguments)},e._OrtCreateTensor=function(){return(e._OrtCreateTensor=e.asm.Ya).apply(null,arguments)},e._OrtGetTensorData=function(){return(e._OrtGetTensorData=e.asm.Za).apply(null,arguments)},e._OrtReleaseTensor=function(){return(e._OrtReleaseTensor=e.asm._a).apply(null,arguments)},e._OrtCreateRunOptions=function(){return(e._OrtCreateRunOptions=e.asm.$a).apply(null,arguments)},e._OrtAddRunConfigEntry=function(){return(e._OrtAddRunConfigEntry=e.asm.ab).apply(null,arguments)},e._OrtReleaseRunOptions=function(){return(e._OrtReleaseRunOptions=e.asm.bb).apply(null,arguments)},e._OrtRun=function(){return(e._OrtRun=e.asm.cb).apply(null,arguments)},e._OrtEndProfiling=function(){return(e._OrtEndProfiling=e.asm.db).apply(null,arguments)};var mt,gt=e._malloc=function(){return(gt=e._malloc=e.asm.eb).apply(null,arguments)},vt=e._free=function(){return(vt=e._free=e.asm.fb).apply(null,arguments)},wt=e._fflush=function(){return(wt=e._fflush=e.asm.gb).apply(null,arguments)},_t=e.___funcs_on_exit=function(){return(_t=e.___funcs_on_exit=e.asm.hb).apply(null,arguments)},Ot=e._setThrew=function(){return(Ot=e._setThrew=e.asm.jb).apply(null,arguments)},At=e.stackSave=function(){return(At=e.stackSave=e.asm.kb).apply(null,arguments)},St=e.stackRestore=function(){return(St=e.stackRestore=e.asm.lb).apply(null,arguments)},Tt=e.stackAlloc=function(){return(Tt=e.stackAlloc=e.asm.mb).apply(null,arguments)},Et=e.___cxa_can_catch=function(){return(Et=e.___cxa_can_catch=e.asm.nb).apply(null,arguments)},Mt=e.___cxa_is_pointer_type=function(){return(Mt=e.___cxa_is_pointer_type=e.asm.ob).apply(null,arguments)},Ct=e.dynCall_j=function(){return(Ct=e.dynCall_j=e.asm.pb).apply(null,arguments)},xt=e.dynCall_iiiiij=function(){return(xt=e.dynCall_iiiiij=e.asm.qb).apply(null,arguments)},Rt=e.dynCall_jii=function(){return(Rt=e.dynCall_jii=e.asm.rb).apply(null,arguments)},jt=e.dynCall_viiiiij=function(){return(jt=e.dynCall_viiiiij=e.asm.sb).apply(null,arguments)},kt=e.dynCall_vjji=function(){return(kt=e.dynCall_vjji=e.asm.tb).apply(null,arguments)},Dt=e.dynCall_viiijjjii=function(){return(Dt=e.dynCall_viiijjjii=e.asm.ub).apply(null,arguments)},Pt=e.dynCall_iij=function(){return(Pt=e.dynCall_iij=e.asm.vb).apply(null,arguments)},Ut=e.dynCall_ji=function(){return(Ut=e.dynCall_ji=e.asm.wb).apply(null,arguments)},Ft=e.dynCall_iiiiiij=function(){return(Ft=e.dynCall_iiiiiij=e.asm.xb).apply(null,arguments)},It=e.dynCall_iiij=function(){return(It=e.dynCall_iiij=e.asm.yb).apply(null,arguments)};function Wt(){function t(){if(!mt&&(mt=!0,e.calledRun=!0,!C)){if(Z(I),r(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;){var t=e.postRun.shift();H.unshift(t)}Z(H)}}if(!(0<B)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)z();Z(F),0<B||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),t()}),1)):t())}}if(e.UTF8ToString=j,e.stringToUTF8=function(t,e,n){return k(t,T,e,n)},e.lengthBytesUTF8=D,e.stackSave=At,e.stackRestore=St,e.stackAlloc=Tt,N=function t(){mt||Wt(),mt||(N=t)},e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();return Wt(),t.ready});t.exports=r},967:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.iterateExtraOptions=void 0,e.iterateExtraOptions=(t,n,r,a)=>{if("object"==typeof t&&null!==t){if(r.has(t))throw new Error("Circular reference in options");r.add(t)}Object.entries(t).forEach((([t,i])=>{const o=n?n+t:t;if("object"==typeof i)(0,e.iterateExtraOptions)(i,o+".",r,a);else if("string"==typeof i||"number"==typeof i)a(o,i.toString());else{if("boolean"!=typeof i)throw new Error("Can\'t handle extra config type: "+typeof i);a(o,i?"1":"0")}}))}},586:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setRunOptions=void 0;const r=n(967),a=n(983),i=n(361);e.setRunOptions=t=>{const e=(0,i.getInstance)();let n=0;const o=[],u=t||{};try{if(void 0===(null==t?void 0:t.logSeverityLevel))u.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===(null==t?void 0:t.logVerbosityLevel))u.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);void 0===(null==t?void 0:t.terminate)&&(u.terminate=!1);let i=0;if(void 0!==(null==t?void 0:t.tag)&&(i=(0,a.allocWasmString)(t.tag,o)),n=e._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,i),0===n)throw new Error("Can\'t create run options");return void 0!==(null==t?void 0:t.extra)&&(0,r.iterateExtraOptions)(t.extra,"",new WeakSet,((t,r)=>{const i=(0,a.allocWasmString)(t,o),u=(0,a.allocWasmString)(r,o);if(0!==e._OrtAddRunConfigEntry(n,i,u))throw new Error(`Can\'t set a run config entry: ${t} - ${r}`)})),[n,o]}catch(t){throw 0!==n&&e._OrtReleaseRunOptions(n),o.forEach(e._free),t}}},919:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setSessionOptions=void 0;const r=n(967),a=n(983),i=n(361);e.setSessionOptions=t=>{const e=(0,i.getInstance)();let n=0;const o=[],u=t||{};(t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});const e=t.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1")})(u);try{void 0===(null==t?void 0:t.graphOptimizationLevel)&&(u.graphOptimizationLevel="all");const c=(t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}})(u.graphOptimizationLevel);void 0===(null==t?void 0:t.enableCpuMemArena)&&(u.enableCpuMemArena=!0),void 0===(null==t?void 0:t.enableMemPattern)&&(u.enableMemPattern=!0),void 0===(null==t?void 0:t.executionMode)&&(u.executionMode="sequential");const s=(t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}})(u.executionMode);let l=0;if(void 0!==(null==t?void 0:t.logId)&&(l=(0,a.allocWasmString)(t.logId,o)),void 0===(null==t?void 0:t.logSeverityLevel))u.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===(null==t?void 0:t.logVerbosityLevel))u.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);if(void 0===(null==t?void 0:t.enableProfiling)&&(u.enableProfiling=!1),n=e._OrtCreateSessionOptions(c,!!u.enableCpuMemArena,!!u.enableMemPattern,s,!!u.enableProfiling,0,l,u.logSeverityLevel,u.logVerbosityLevel),0===n)throw new Error("Can\'t create session options");return(null==t?void 0:t.executionProviders)&&((t,e,n)=>{for(const r of e){let e="string"==typeof r?r:r.name;switch(e){case"xnnpack":e="XNNPACK";break;case"wasm":case"cpu":continue;default:throw new Error(`not supported EP: ${e}`)}const o=(0,a.allocWasmString)(e,n);if(0!==(0,i.getInstance)()._OrtAppendExecutionProvider(t,o))throw new Error(`Can\'t append execution provider: ${e}`)}})(n,t.executionProviders,o),void 0!==(null==t?void 0:t.extra)&&(0,r.iterateExtraOptions)(t.extra,"",new WeakSet,((t,r)=>{const i=(0,a.allocWasmString)(t,o),u=(0,a.allocWasmString)(r,o);if(0!==e._OrtAddSessionConfigEntry(n,i,u))throw new Error(`Can\'t set a session config entry: ${t} - ${r}`)})),[n,o]}catch(t){throw 0!==n&&e._OrtReleaseSessionOptions(n),o.forEach(e._free),t}}},983:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.allocWasmString=void 0;const r=n(361);e.allocWasmString=(t,e)=>{const n=(0,r.getInstance)(),a=n.lengthBytesUTF8(t)+1,i=n._malloc(a);return n.stringToUTF8(t,i,a),e.push(i),i}},349:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.extractTransferableBuffers=e.endProfiling=e.run=e.releaseSession=e.createSession=e.createSessionFinalize=e.createSessionAllocate=e.initOrt=void 0;const r=n(586),a=n(919),i=n(983),o=n(361);e.initOrt=(t,e)=>{const n=(0,o.getInstance)()._OrtInit(t,e);if(0!==n)throw new Error(`Can\'t initialize onnxruntime. error code = ${n}`)};const u=new Map;e.createSessionAllocate=t=>{const e=(0,o.getInstance)(),n=e._malloc(t.byteLength);return e.HEAPU8.set(t,n),[n,t.byteLength]},e.createSessionFinalize=(t,e)=>{const n=(0,o.getInstance)();let r=0,i=0,c=[];try{if([i,c]=(0,a.setSessionOptions)(e),r=n._OrtCreateSession(t[0],t[1],i),0===r)throw new Error("Can\'t create a session")}finally{n._free(t[0]),n._OrtReleaseSessionOptions(i),c.forEach(n._free)}const s=n._OrtGetInputCount(r),l=n._OrtGetOutputCount(r),f=[],p=[],h=[],d=[];for(let t=0;t<s;t++){const e=n._OrtGetInputName(r,t);if(0===e)throw new Error("Can\'t get an input name");p.push(e),f.push(n.UTF8ToString(e))}for(let t=0;t<l;t++){const e=n._OrtGetOutputName(r,t);if(0===e)throw new Error("Can\'t get an output name");d.push(e),h.push(n.UTF8ToString(e))}return u.set(r,[r,p,d]),[r,f,h]},e.createSession=(t,n)=>{const r=(0,e.createSessionAllocate)(t);return(0,e.createSessionFinalize)(r,n)},e.releaseSession=t=>{const e=(0,o.getInstance)(),n=u.get(t);if(!n)throw new Error("invalid session id");const r=n[0],a=n[1],i=n[2];a.forEach(e._OrtFree),i.forEach(e._OrtFree),e._OrtReleaseSession(r),u.delete(t)};const c=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${t}`)}},s=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${t}`)}},l=t=>{switch(t){case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}};e.run=(t,e,n,a,f)=>{const p=(0,o.getInstance)(),h=u.get(t);if(!h)throw new Error("invalid session id");const d=h[0],y=h[1],b=h[2],m=e.length,g=a.length;let v=0,w=[];const _=[],O=[];try{[v,w]=(0,r.setRunOptions)(f);for(let t=0;t<m;t++){const e=n[t][0],r=n[t][1],a=n[t][2];let o,u;if(Array.isArray(a)){u=4*a.length,o=p._malloc(u),O.push(o);let t=o/4;for(let e=0;e<a.length;e++){if("string"!=typeof a[e])throw new TypeError(`tensor data at index ${e} is not a string`);p.HEAPU32[t++]=(0,i.allocWasmString)(a[e],O)}}else u=a.byteLength,o=p._malloc(u),O.push(o),p.HEAPU8.set(new Uint8Array(a.buffer,a.byteOffset,u),o);const s=p.stackSave(),l=p.stackAlloc(4*r.length);try{let t=l/4;r.forEach((e=>p.HEAP32[t++]=e));const n=p._OrtCreateTensor(c(e),o,u,l,r.length);if(0===n)throw new Error("Can\'t create a tensor");_.push(n)}finally{p.stackRestore(s)}}const t=p.stackSave(),o=p.stackAlloc(4*m),u=p.stackAlloc(4*m),h=p.stackAlloc(4*g),A=p.stackAlloc(4*g);try{let n=o/4,r=u/4,i=h/4,c=A/4;for(let t=0;t<m;t++)p.HEAPU32[n++]=_[t],p.HEAPU32[r++]=y[e[t]];for(let t=0;t<g;t++)p.HEAPU32[i++]=0,p.HEAPU32[c++]=b[a[t]];let f=p._OrtRun(d,u,o,m,A,g,h,v);const w=[];if(0===f)for(let t=0;t<g;t++){const e=p.HEAPU32[h/4+t],n=p.stackSave(),r=p.stackAlloc(16);let a,i=0;try{if(f=p._OrtGetTensorData(e,r,r+4,r+8,r+12),0!==f)throw new Error(`Can\'t access output tensor data. error code = ${f}`);let t=r/4;const o=p.HEAPU32[t++];i=p.HEAPU32[t++];const u=p.HEAPU32[t++],c=p.HEAPU32[t++],h=[];for(let t=0;t<c;t++)h.push(p.HEAPU32[u/4+t]);p._OrtFree(u);const d=0===h.length?1:h.reduce(((t,e)=>t*e));if(a=s(o),"string"===a){const t=[];let e=i/4;for(let n=0;n<d;n++){const r=p.HEAPU32[e++],a=n===d-1?void 0:p.HEAPU32[e]-r;t.push(p.UTF8ToString(r,a))}w.push([a,h,t])}else{const t=new(l(a))(d);new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(p.HEAPU8.subarray(i,i+t.byteLength)),w.push([a,h,t])}}finally{p.stackRestore(n),"string"===a&&i&&p._free(i),p._OrtReleaseTensor(e)}}if(0===f)return w;throw new Error(`failed to call OrtRun(). error code = ${f}.`)}finally{p.stackRestore(t)}}finally{_.forEach(p._OrtReleaseTensor),O.forEach(p._free),p._OrtReleaseRunOptions(v),w.forEach(p._free)}},e.endProfiling=t=>{const e=(0,o.getInstance)(),n=u.get(t);if(!n)throw new Error("invalid session id");const r=n[0],a=e._OrtEndProfiling(r);if(0===a)throw new Error("Can\'t get an profile file name");e._OrtFree(a)},e.extractTransferableBuffers=t=>{const e=[];for(const n of t){const t=n[2];!Array.isArray(t)&&t.buffer&&e.push(t.buffer)}return e}},361:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(e,n);a&&!("get"in a?!e.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,a)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),a=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&r(e,t,n);return a(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.dispose=e.getInstance=e.initializeWebAssembly=void 0;const u=i(n(449)),c=o(n(932)),s=n(474);let l,f=!1,p=!1,h=!1;const d=(t,e)=>e?t?"ort-wasm-simd-threaded.wasm":"ort-wasm-threaded.wasm":t?"ort-wasm-simd.wasm":"ort-wasm.wasm";e.initializeWebAssembly=async t=>{if(f)return Promise.resolve();if(p)throw new Error("multiple calls to \'initializeWebAssembly()\' detected.");if(h)throw new Error("previous call to \'initializeWebAssembly()\' failed.");p=!0;const e=t.initTimeout,r=t.numThreads,a=t.simd,i=r>1&&(()=>{try{return"undefined"!=typeof SharedArrayBuffer&&("undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])))}catch(t){return!1}})(),o=a&&(()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch(t){return!1}})(),y="string"==typeof t.wasmPaths?t.wasmPaths:void 0,b=d(!1,i),m=d(o,i),g="object"==typeof t.wasmPaths?t.wasmPaths[m]:void 0;let v=!1;const w=[];if(e>0&&w.push(new Promise((t=>{setTimeout((()=>{v=!0,t()}),e)}))),w.push(new Promise(((t,e)=>{const r=i?s:c.default,a={locateFile:(t,e)=>i&&t.endsWith(".worker.js")&&"undefined"!=typeof Blob?URL.createObjectURL(new Blob([n(154)],{type:"text/javascript"})):t===b?null!=g?g:(null!=y?y:e)+m:e+t};if(i)if("undefined"==typeof Blob)a.mainScriptUrlOrBlob=u.join("/","ort-wasm-threaded.js");else{const t=`var ortWasmThreaded=(function(){var _scriptDir;return ${r.toString()}})();`;a.mainScriptUrlOrBlob=new Blob([t],{type:"text/javascript"})}r(a).then((e=>{p=!1,f=!0,l=e,t()}),(t=>{p=!1,h=!0,e(t)}))}))),await Promise.race(w),v)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},e.getInstance=()=>{if(f&&l)return l;throw new Error("WebAssembly is not initialized yet.")},e.dispose=()=>{var t;!f||p||h||(p=!0,null===(t=l.PThread)||void 0===t||t.terminateAllThreads(),l=void 0,p=!1,f=!1,h=!0)}},154:t=>{"use strict";t.exports=\'"use strict";var e={},t="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;if(t){var r=require("worker_threads"),a=r.parentPort;a.on("message",(e=>onmessage({data:e})));var o=require("fs");Object.assign(global,{self:global,require:require,Module:e,location:{href:__filename},Worker:r.Worker,importScripts:function(e){(0,eval)(o.readFileSync(e,"utf8"))},postMessage:function(e){a.postMessage(e)},performance:global.performance||{now:function(){return Date.now()}}})}var s=!1,n=[],i=function(){var e=Array.prototype.slice.call(arguments).join(" ");t?o.writeSync(2,e+"\\\\n"):console.error(e)};self.alert=function(){var t=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:t,threadId:e._pthread_self()})},e.instantiateWasm=(t,r)=>{var a=new WebAssembly.Instance(e.wasmModule,t);return r(a),e.wasmModule=null,a.exports},self.onunhandledrejection=e=>{throw e.reason??e},self.onmessage=t=>{try{if("load"===t.data.cmd){if(e.wasmModule=t.data.wasmModule,e.wasmMemory=t.data.wasmMemory,e.buffer=e.wasmMemory.buffer,e.ENVIRONMENT_IS_PTHREAD=!0,"string"==typeof t.data.urlOrBlob)importScripts(t.data.urlOrBlob);else{var r=URL.createObjectURL(t.data.urlOrBlob);importScripts(r),URL.revokeObjectURL(r)}ortWasmThreaded(e).then((function(t){e=t}))}else if("run"===t.data.cmd){e.__performance_now_clock_drift=performance.now()-t.data.time,e.__emscripten_thread_init(t.data.pthread_ptr,0,0,1),e.establishStackSpace(),e.PThread.receiveObjectTransfer(t.data),e.PThread.threadInitTLS(),s||(n.forEach((t=>{e.executeNotifiedProxyingQueue(t)})),n=[],s=!0);try{e.invokeEntryPoint(t.data.start_routine,t.data.arg)}catch(t){if("unwind"!=t){if(!(t instanceof e.ExitStatus))throw t;e.keepRuntimeAlive()||e.__emscripten_thread_exit(t.status)}}}else"cancel"===t.data.cmd?e._pthread_self()&&e.__emscripten_thread_exit(-1):"setimmediate"===t.data.target||("processProxyingQueue"===t.data.cmd?s?e.executeNotifiedProxyingQueue(t.data.queue):n.push(t.data.queue):(i("worker.js received unknown command "+t.data.cmd),i(t.data)))}catch(t){throw i("worker.js onmessage() captured an uncaught exception: "+t),t&&t.stack&&i(t.stack),e.__emscripten_thread_crashed&&e.__emscripten_thread_crashed(),t}};\\n\'},384:()=>{},993:()=>{},908:()=>{},953:()=>{},925:()=>{},449:()=>{}},e={};function n(r){var a=e[r];if(void 0!==a)return a.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";const t=n(349),e=n(361);self.onmessage=n=>{switch(n.data.type){case"init-wasm":(0,e.initializeWebAssembly)(n.data.in).then((()=>postMessage({type:"init-wasm"})),(t=>postMessage({type:"init-wasm",err:t})));break;case"init-ort":try{const{numThreads:e,loggingLevel:r}=n.data.in;(0,t.initOrt)(e,r),postMessage({type:"init-ort"})}catch(t){postMessage({type:"init-ort",err:t})}break;case"create_allocate":try{const{model:e}=n.data.in,r=(0,t.createSessionAllocate)(e);postMessage({type:"create_allocate",out:r})}catch(t){postMessage({type:"create_allocate",err:t})}break;case"create_finalize":try{const{modeldata:e,options:r}=n.data.in,a=(0,t.createSessionFinalize)(e,r);postMessage({type:"create_finalize",out:a})}catch(t){postMessage({type:"create_finalize",err:t})}break;case"create":try{const{model:e,options:r}=n.data.in,a=(0,t.createSession)(e,r);postMessage({type:"create",out:a})}catch(t){postMessage({type:"create",err:t})}break;case"release":try{const e=n.data.in;(0,t.releaseSession)(e),postMessage({type:"release"})}catch(t){postMessage({type:"release",err:t})}break;case"run":try{const{sessionId:e,inputIndices:r,inputs:a,outputIndices:i,options:o}=n.data.in,u=(0,t.run)(e,r,a,i,o);postMessage({type:"run",out:u},(0,t.extractTransferableBuffers)(u))}catch(t){postMessage({type:"run",err:t})}break;case"end-profiling":try{const e=n.data.in;(0,t.endProfiling)(e),postMessage({type:"end-profiling"})}catch(t){postMessage({type:"end-profiling",err:t})}}}})()})();\n',"Worker",void 0,void 0)}},477:s=>{"use strict";s.exports=function(e,t,n,i){var r=self||window;try{try{var o;try{o=new r.Blob([e])}catch{(o=new(r.BlobBuilder||r.WebKitBlobBuilder||r.MozBlobBuilder||r.MSBlobBuilder)).append(e),o=o.getBlob()}var l=r.URL||r.webkitURL,u=l.createObjectURL(o),h=new r[t](u,n);return l.revokeObjectURL(u),h}catch{return new r[t]("data:application/javascript,".concat(encodeURIComponent(e)),n)}}catch{if(!i)throw Error("Inline worker is not supported");return new r[t](i,n)}}},4154:s=>{"use strict";s.exports=`"use strict";var e={},t="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;if(t){var r=require("worker_threads"),a=r.parentPort;a.on("message",(e=>onmessage({data:e})));var o=require("fs");Object.assign(global,{self:global,require:require,Module:e,location:{href:__filename},Worker:r.Worker,importScripts:function(e){(0,eval)(o.readFileSync(e,"utf8"))},postMessage:function(e){a.postMessage(e)},performance:global.performance||{now:function(){return Date.now()}}})}var s=!1,n=[],i=function(){var e=Array.prototype.slice.call(arguments).join(" ");t?o.writeSync(2,e+"\\n"):console.error(e)};self.alert=function(){var t=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:t,threadId:e._pthread_self()})},e.instantiateWasm=(t,r)=>{var a=new WebAssembly.Instance(e.wasmModule,t);return r(a),e.wasmModule=null,a.exports},self.onunhandledrejection=e=>{throw e.reason??e},self.onmessage=t=>{try{if("load"===t.data.cmd){if(e.wasmModule=t.data.wasmModule,e.wasmMemory=t.data.wasmMemory,e.buffer=e.wasmMemory.buffer,e.ENVIRONMENT_IS_PTHREAD=!0,"string"==typeof t.data.urlOrBlob)importScripts(t.data.urlOrBlob);else{var r=URL.createObjectURL(t.data.urlOrBlob);importScripts(r),URL.revokeObjectURL(r)}ortWasmThreaded(e).then((function(t){e=t}))}else if("run"===t.data.cmd){e.__performance_now_clock_drift=performance.now()-t.data.time,e.__emscripten_thread_init(t.data.pthread_ptr,0,0,1),e.establishStackSpace(),e.PThread.receiveObjectTransfer(t.data),e.PThread.threadInitTLS(),s||(n.forEach((t=>{e.executeNotifiedProxyingQueue(t)})),n=[],s=!0);try{e.invokeEntryPoint(t.data.start_routine,t.data.arg)}catch(t){if("unwind"!=t){if(!(t instanceof e.ExitStatus))throw t;e.keepRuntimeAlive()||e.__emscripten_thread_exit(t.status)}}}else"cancel"===t.data.cmd?e._pthread_self()&&e.__emscripten_thread_exit(-1):"setimmediate"===t.data.target||("processProxyingQueue"===t.data.cmd?s?e.executeNotifiedProxyingQueue(t.data.queue):n.push(t.data.queue):(i("worker.js received unknown command "+t.data.cmd),i(t.data)))}catch(t){throw i("worker.js onmessage() captured an uncaught exception: "+t),t&&t.stack&&i(t.stack),e.__emscripten_thread_crashed&&e.__emscripten_thread_crashed(),t}};
`},1670:s=>{"use strict";s.exports=__WEBPACK_EXTERNAL_MODULE__1670__},7067:()=>{},1296:()=>{},1384:()=>{},3993:()=>{},908:()=>{},6953:()=>{},9925:()=>{},2806:()=>{},6449:()=>{},2850:()=>{},5381:()=>{},5686:(s,e,t)=>{"use strict";t.r(e),t.d(e,{flatbuffers:()=>n});var n={};n.Offset,n.Table,n.SIZEOF_SHORT=2,n.SIZEOF_INT=4,n.FILE_IDENTIFIER_LENGTH=4,n.SIZE_PREFIX_LENGTH=4,n.Encoding={UTF8_BYTES:1,UTF16_STRING:2},n.int32=new Int32Array(2),n.float32=new Float32Array(n.int32.buffer),n.float64=new Float64Array(n.int32.buffer),n.isLittleEndian=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1,n.Long=function(i,r){this.low=0|i,this.high=0|r},n.Long.create=function(i,r){return i==0&&r==0?n.Long.ZERO:new n.Long(i,r)},n.Long.prototype.toFloat64=function(){return(this.low>>>0)+4294967296*this.high},n.Long.prototype.equals=function(i){return this.low==i.low&&this.high==i.high},n.Long.ZERO=new n.Long(0,0),n.Builder=function(i){if(i)r=i;else var r=1024;this.bb=n.ByteBuffer.allocate(r),this.space=r,this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},n.Builder.prototype.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},n.Builder.prototype.forceDefaults=function(i){this.force_defaults=i},n.Builder.prototype.dataBuffer=function(){return this.bb},n.Builder.prototype.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},n.Builder.prototype.prep=function(i,r){i>this.minalign&&(this.minalign=i);for(var o=1+~(this.bb.capacity()-this.space+r)&i-1;this.space<o+i+r;){var l=this.bb.capacity();this.bb=n.Builder.growByteBuffer(this.bb),this.space+=this.bb.capacity()-l}this.pad(o)},n.Builder.prototype.pad=function(i){for(var r=0;r<i;r++)this.bb.writeInt8(--this.space,0)},n.Builder.prototype.writeInt8=function(i){this.bb.writeInt8(this.space-=1,i)},n.Builder.prototype.writeInt16=function(i){this.bb.writeInt16(this.space-=2,i)},n.Builder.prototype.writeInt32=function(i){this.bb.writeInt32(this.space-=4,i)},n.Builder.prototype.writeInt64=function(i){this.bb.writeInt64(this.space-=8,i)},n.Builder.prototype.writeFloat32=function(i){this.bb.writeFloat32(this.space-=4,i)},n.Builder.prototype.writeFloat64=function(i){this.bb.writeFloat64(this.space-=8,i)},n.Builder.prototype.addInt8=function(i){this.prep(1,0),this.writeInt8(i)},n.Builder.prototype.addInt16=function(i){this.prep(2,0),this.writeInt16(i)},n.Builder.prototype.addInt32=function(i){this.prep(4,0),this.writeInt32(i)},n.Builder.prototype.addInt64=function(i){this.prep(8,0),this.writeInt64(i)},n.Builder.prototype.addFloat32=function(i){this.prep(4,0),this.writeFloat32(i)},n.Builder.prototype.addFloat64=function(i){this.prep(8,0),this.writeFloat64(i)},n.Builder.prototype.addFieldInt8=function(i,r,o){(this.force_defaults||r!=o)&&(this.addInt8(r),this.slot(i))},n.Builder.prototype.addFieldInt16=function(i,r,o){(this.force_defaults||r!=o)&&(this.addInt16(r),this.slot(i))},n.Builder.prototype.addFieldInt32=function(i,r,o){(this.force_defaults||r!=o)&&(this.addInt32(r),this.slot(i))},n.Builder.prototype.addFieldInt64=function(i,r,o){!this.force_defaults&&r.equals(o)||(this.addInt64(r),this.slot(i))},n.Builder.prototype.addFieldFloat32=function(i,r,o){(this.force_defaults||r!=o)&&(this.addFloat32(r),this.slot(i))},n.Builder.prototype.addFieldFloat64=function(i,r,o){(this.force_defaults||r!=o)&&(this.addFloat64(r),this.slot(i))},n.Builder.prototype.addFieldOffset=function(i,r,o){(this.force_defaults||r!=o)&&(this.addOffset(r),this.slot(i))},n.Builder.prototype.addFieldStruct=function(i,r,o){r!=o&&(this.nested(r),this.slot(i))},n.Builder.prototype.nested=function(i){if(i!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")},n.Builder.prototype.notNested=function(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")},n.Builder.prototype.slot=function(i){this.vtable[i]=this.offset()},n.Builder.prototype.offset=function(){return this.bb.capacity()-this.space},n.Builder.growByteBuffer=function(i){var r=i.capacity();if(3221225472&r)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var o=r<<1,l=n.ByteBuffer.allocate(o);return l.setPosition(o-r),l.bytes().set(i.bytes(),o-r),l},n.Builder.prototype.addOffset=function(i){this.prep(n.SIZEOF_INT,0),this.writeInt32(this.offset()-i+n.SIZEOF_INT)},n.Builder.prototype.startObject=function(i){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=i;for(var r=0;r<i;r++)this.vtable[r]=0;this.isNested=!0,this.object_start=this.offset()},n.Builder.prototype.endObject=function(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var i=this.offset(),r=this.vtable_in_use-1;r>=0&&this.vtable[r]==0;r--);for(var o=r+1;r>=0;r--)this.addInt16(this.vtable[r]!=0?i-this.vtable[r]:0);this.addInt16(i-this.object_start);var l=(o+2)*n.SIZEOF_SHORT;this.addInt16(l);var u=0,h=this.space;e:for(r=0;r<this.vtables.length;r++){var d=this.bb.capacity()-this.vtables[r];if(l==this.bb.readInt16(d)){for(var c=n.SIZEOF_SHORT;c<l;c+=n.SIZEOF_SHORT)if(this.bb.readInt16(h+c)!=this.bb.readInt16(d+c))continue e;u=this.vtables[r];break}}return u?(this.space=this.bb.capacity()-i,this.bb.writeInt32(this.space,u-i)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-i,this.offset()-i)),this.isNested=!1,i},n.Builder.prototype.finish=function(i,r,o){var l=o?n.SIZE_PREFIX_LENGTH:0;if(r){var u=r;if(this.prep(this.minalign,n.SIZEOF_INT+n.FILE_IDENTIFIER_LENGTH+l),u.length!=n.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+n.FILE_IDENTIFIER_LENGTH);for(var h=n.FILE_IDENTIFIER_LENGTH-1;h>=0;h--)this.writeInt8(u.charCodeAt(h))}this.prep(this.minalign,n.SIZEOF_INT+l),this.addOffset(i),l&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},n.Builder.prototype.finishSizePrefixed=function(i,r){this.finish(i,r,!0)},n.Builder.prototype.requiredField=function(i,r){var o=this.bb.capacity()-i,l=o-this.bb.readInt32(o);if(this.bb.readInt16(l+r)==0)throw new Error("FlatBuffers: field "+r+" must be set")},n.Builder.prototype.startVector=function(i,r,o){this.notNested(),this.vector_num_elems=r,this.prep(n.SIZEOF_INT,i*r),this.prep(o,i*r)},n.Builder.prototype.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},n.Builder.prototype.createString=function(i){if(i instanceof Uint8Array)var r=i;else{r=[];for(var o=0;o<i.length;){var l,u=i.charCodeAt(o++);(l=u<55296||u>=56320?u:(u<<10)+i.charCodeAt(o++)+-56613888)<128?r.push(l):(l<2048?r.push(l>>6&31|192):(l<65536?r.push(l>>12&15|224):r.push(l>>18&7|240,l>>12&63|128),r.push(l>>6&63|128)),r.push(63&l|128))}}this.addInt8(0),this.startVector(1,r.length,1),this.bb.setPosition(this.space-=r.length),o=0;for(var h=this.space,d=this.bb.bytes();o<r.length;o++)d[h++]=r[o];return this.endVector()},n.Builder.prototype.createLong=function(i,r){return n.Long.create(i,r)},n.ByteBuffer=function(i){this.bytes_=i,this.position_=0},n.ByteBuffer.allocate=function(i){return new n.ByteBuffer(new Uint8Array(i))},n.ByteBuffer.prototype.clear=function(){this.position_=0},n.ByteBuffer.prototype.bytes=function(){return this.bytes_},n.ByteBuffer.prototype.position=function(){return this.position_},n.ByteBuffer.prototype.setPosition=function(i){this.position_=i},n.ByteBuffer.prototype.capacity=function(){return this.bytes_.length},n.ByteBuffer.prototype.readInt8=function(i){return this.readUint8(i)<<24>>24},n.ByteBuffer.prototype.readUint8=function(i){return this.bytes_[i]},n.ByteBuffer.prototype.readInt16=function(i){return this.readUint16(i)<<16>>16},n.ByteBuffer.prototype.readUint16=function(i){return this.bytes_[i]|this.bytes_[i+1]<<8},n.ByteBuffer.prototype.readInt32=function(i){return this.bytes_[i]|this.bytes_[i+1]<<8|this.bytes_[i+2]<<16|this.bytes_[i+3]<<24},n.ByteBuffer.prototype.readUint32=function(i){return this.readInt32(i)>>>0},n.ByteBuffer.prototype.readInt64=function(i){return new n.Long(this.readInt32(i),this.readInt32(i+4))},n.ByteBuffer.prototype.readUint64=function(i){return new n.Long(this.readUint32(i),this.readUint32(i+4))},n.ByteBuffer.prototype.readFloat32=function(i){return n.int32[0]=this.readInt32(i),n.float32[0]},n.ByteBuffer.prototype.readFloat64=function(i){return n.int32[n.isLittleEndian?0:1]=this.readInt32(i),n.int32[n.isLittleEndian?1:0]=this.readInt32(i+4),n.float64[0]},n.ByteBuffer.prototype.writeInt8=function(i,r){this.bytes_[i]=r},n.ByteBuffer.prototype.writeUint8=function(i,r){this.bytes_[i]=r},n.ByteBuffer.prototype.writeInt16=function(i,r){this.bytes_[i]=r,this.bytes_[i+1]=r>>8},n.ByteBuffer.prototype.writeUint16=function(i,r){this.bytes_[i]=r,this.bytes_[i+1]=r>>8},n.ByteBuffer.prototype.writeInt32=function(i,r){this.bytes_[i]=r,this.bytes_[i+1]=r>>8,this.bytes_[i+2]=r>>16,this.bytes_[i+3]=r>>24},n.ByteBuffer.prototype.writeUint32=function(i,r){this.bytes_[i]=r,this.bytes_[i+1]=r>>8,this.bytes_[i+2]=r>>16,this.bytes_[i+3]=r>>24},n.ByteBuffer.prototype.writeInt64=function(i,r){this.writeInt32(i,r.low),this.writeInt32(i+4,r.high)},n.ByteBuffer.prototype.writeUint64=function(i,r){this.writeUint32(i,r.low),this.writeUint32(i+4,r.high)},n.ByteBuffer.prototype.writeFloat32=function(i,r){n.float32[0]=r,this.writeInt32(i,n.int32[0])},n.ByteBuffer.prototype.writeFloat64=function(i,r){n.float64[0]=r,this.writeInt32(i,n.int32[n.isLittleEndian?0:1]),this.writeInt32(i+4,n.int32[n.isLittleEndian?1:0])},n.ByteBuffer.prototype.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+n.SIZEOF_INT+n.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var i="",r=0;r<n.FILE_IDENTIFIER_LENGTH;r++)i+=String.fromCharCode(this.readInt8(this.position_+n.SIZEOF_INT+r));return i},n.ByteBuffer.prototype.__offset=function(i,r){var o=i-this.readInt32(i);return r<this.readInt16(o)?this.readInt16(o+r):0},n.ByteBuffer.prototype.__union=function(i,r){return i.bb_pos=r+this.readInt32(r),i.bb=this,i},n.ByteBuffer.prototype.__string=function(i,r){i+=this.readInt32(i);var o=this.readInt32(i),l="",u=0;if(i+=n.SIZEOF_INT,r===n.Encoding.UTF8_BYTES)return this.bytes_.subarray(i,i+o);for(;u<o;){var h,d=this.readUint8(i+u++);if(d<192)h=d;else{var c=this.readUint8(i+u++);if(d<224)h=(31&d)<<6|63&c;else{var a=this.readUint8(i+u++);h=d<240?(15&d)<<12|(63&c)<<6|63&a:(7&d)<<18|(63&c)<<12|(63&a)<<6|63&this.readUint8(i+u++)}}h<65536?l+=String.fromCharCode(h):(h-=65536,l+=String.fromCharCode(55296+(h>>10),56320+(1023&h)))}return l},n.ByteBuffer.prototype.__indirect=function(i){return i+this.readInt32(i)},n.ByteBuffer.prototype.__vector=function(i){return i+this.readInt32(i)+n.SIZEOF_INT},n.ByteBuffer.prototype.__vector_len=function(i){return this.readInt32(i+this.readInt32(i))},n.ByteBuffer.prototype.__has_identifier=function(i){if(i.length!=n.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+n.FILE_IDENTIFIER_LENGTH);for(var r=0;r<n.FILE_IDENTIFIER_LENGTH;r++)if(i.charCodeAt(r)!=this.readInt8(this.position_+n.SIZEOF_INT+r))return!1;return!0},n.ByteBuffer.prototype.createLong=function(i,r){return n.Long.create(i,r)}}},__webpack_module_cache__={};function __webpack_require__(s){var e=__webpack_module_cache__[s];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[s]={exports:{}};return __webpack_modules__[s].call(t.exports,t,t.exports,__webpack_require__),t.exports}__webpack_require__.n=s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(s,e)=>{for(var t in e)__webpack_require__.o(e,t)&&!__webpack_require__.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})},__webpack_require__.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),__webpack_require__.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e),__webpack_require__.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(6018);return __webpack_exports__})())});var QD,ek,_o,Ey,Wx=tn(()=>{QD=Io(b4(),1),ek=Io(_4(),1),Ey=["wasm"];typeof process<"u"&&process?.release?.name==="node"?(_o=QD.default??QD,Ey.unshift("cpu")):(_o=ek.default??ek,typeof navigator<"u"&&/iP(hone|od|ad).+16_4.+AppleWebKit/.test(navigator.userAgent)&&(_o.env.wasm.simd=!1))});function T4(s){return Object.keys(s).length===0}var x4,Zc,E4,MJ,tk,S4,DJ,nk,kJ,qx,Yx,RJ,w4,PJ,mt,Kx=tn(()=>{x4=Io(require("fs"),1),Zc=Io(require("path"),1),E4=Io(require("url"),1);Wx();MJ={},{env:tk}=_o,S4="2.17.2",DJ=typeof self<"u"&&"caches"in self,nk=!T4(x4.default),kJ=!T4(Zc.default),qx=nk&&kJ,Yx=qx?Zc.default.dirname(Zc.default.dirname(E4.default.fileURLToPath(MJ.url))):"./",RJ=qx?Zc.default.join(Yx,"/.cache/"):null,w4="/models/",PJ=qx?Zc.default.join(Yx,w4):w4;tk?.wasm&&(tk.wasm.wasmPaths=qx?Zc.default.join(Yx,"/dist/"):`https://cdn.jsdelivr.net/npm/@xenova/transformers@${S4}/dist/`);mt={backends:{onnx:tk,tfjs:{}},__dirname:Yx,version:S4,allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!0,localModelPath:PJ,useFS:nk,useBrowserCache:DJ,useFSCache:nk,cacheDir:RJ,useCustomCache:!1,customCache:null}});function sk(s,e=null,t=null){let n;try{n=new URL(s)}catch{return!1}return!(e&&!e.includes(n.protocol)||t&&!t.includes(n.hostname))}async function Wh(s){if(mt.useFS&&!sk(s,["http:","https:","blob:"]))return new Zx(s);if(typeof process<"u"&&process?.release?.name==="node"){let e=!!process.env?.TESTING_REMOTELY,t=mt.version,n=new Headers;if(n.set("User-Agent",`transformers.js/${t}; is_ci/${e};`),sk(s,["http:","https:"],["huggingface.co","hf.co"])){let r=process.env?.HF_TOKEN??process.env?.HF_ACCESS_TOKEN;r&&n.set("Authorization",`Bearer ${r}`)}return fetch(s,{headers:n})}else return fetch(s)}function OJ(s,e,t){if(!t)return null;let n=NJ[s]??`Error (${s}) occurred while trying to load file`;throw Error(`${n}: "${e}".`)}async function FJ(s,...e){for(let t of e)try{let n=await s.match(t);if(n)return n}catch{continue}}async function ik(s,e,t=!0,n={}){if(!mt.allowLocalModels){if(n.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!mt.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}La(n.progress_callback,{status:"initiate",name:s,file:e});let i;if(!i&&mt.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{i=await caches.open("transformers-cache")}catch(y){console.warn("An error occurred while opening the browser cache:",y)}}if(!i&&mt.useFSCache&&(i=new Qx(n.cache_dir??mt.cacheDir)),!i&&mt.useCustomCache){if(!mt.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!mt.customCache.match||!mt.customCache.put)throw new Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");i=mt.customCache}let r=n.revision??"main",o=Xx(s,e),l=Xx(mt.localModelPath,o),u=Xx(mt.remoteHost,mt.remotePathTemplate.replaceAll("{model}",s).replaceAll("{revision}",encodeURIComponent(r)),e),h=r==="main"?o:Xx(s,r,e),d,c=i instanceof Qx?h:u,a=!1,f;i&&(f=await FJ(i,l,c));let p=f!==void 0;if(f===void 0){if(mt.allowLocalModels)if(sk(o,["http:","https:"])){if(n.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${o}.`);if(!mt.allowRemoteModels)throw new Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${o}.`)}else try{f=await Wh(l),d=l}catch(_){console.warn(`Unable to load from local path "${l}": "${_}"`)}if(f===void 0||f.status===404){if(n.local_files_only||!mt.allowRemoteModels){if(t)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${l}".`);return null}if(f=await Wh(u),f.status!==200)return OJ(f.status,u,t);d=c}a=i&&typeof Response<"u"&&f instanceof Response&&f.status===200}La(n.progress_callback,{status:"download",name:s,file:e});let g={status:"progress",name:s,file:e},m;return n.progress_callback?p&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)?(m=new Uint8Array(await f.arrayBuffer()),La(n.progress_callback,{...g,progress:100,loaded:m.length,total:m.length})):m=await LJ(f,y=>{La(n.progress_callback,{...g,...y})}):m=new Uint8Array(await f.arrayBuffer()),a&&d&&await i.match(d)===void 0&&await i.put(d,new Response(m,{headers:f.headers})).catch(y=>{console.warn(`Unable to add response to browser cache: ${y}.`)}),La(n.progress_callback,{status:"done",name:s,file:e}),m}async function br(s,e,t=!0,n={}){let i=await ik(s,e,t,n);if(i===null)return{};let o=new TextDecoder("utf-8").decode(i);return JSON.parse(o)}async function LJ(s,e){let t=s.headers.get("Content-Length");t===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let n=parseInt(t??"0"),i=new Uint8Array(n),r=0,o=s.body.getReader();async function l(){let{done:u,value:h}=await o.read();if(u)return;let d=r+h.length;if(d>n){n=d;let a=new Uint8Array(n);a.set(i),i=a}i.set(h,r),r=d;let c=r/n*100;return e({progress:c,loaded:r,total:n}),l()}return await l(),i}function Xx(...s){return s=s.map((e,t)=>(t&&(e=e.replace(new RegExp("^/"),"")),t!==s.length-1&&(e=e.replace(new RegExp("/$"),"")),e)),s.join("/")}var Ua,Jx,Zx,NJ,Qx,Qc=tn(()=>{Ua=Io(require("fs"),1),Jx=Io(require("path"),1);Kx();$a();Zx=class s{constructor(e){J(this,"_CONTENT_TYPE_MAP",{txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"});if(this.filePath=e,this.headers=new Headers,this.exists=Ua.default.existsSync(e),this.exists){this.status=200,this.statusText="OK";let t=Ua.default.statSync(e);this.headers.set("content-length",t.size.toString()),this.updateContentType();let n=this;this.body=new ReadableStream({start(i){n.arrayBuffer().then(r=>{i.enqueue(new Uint8Array(r)),i.close()})}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){let e=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",this._CONTENT_TYPE_MAP[e]??"application/octet-stream")}clone(){let e=new s(this.filePath);return e.exists=this.exists,e.status=this.status,e.statusText=this.statusText,e.headers=new Headers(this.headers),e}async arrayBuffer(){return(await Ua.default.promises.readFile(this.filePath)).buffer}async blob(){let e=await Ua.default.promises.readFile(this.filePath);return new Blob([e],{type:this.headers.get("content-type")})}async text(){return await Ua.default.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}};NJ={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};Qx=class{constructor(e){this.path=e}async match(e){let t=Jx.default.join(this.path,e),n=new Zx(t);if(n.exists)return n}async put(e,t){let n=Buffer.from(await t.arrayBuffer()),i=Jx.default.join(this.path,e);try{await Ua.default.promises.mkdir(Jx.default.dirname(i),{recursive:!0}),await Ua.default.promises.writeFile(i,n)}catch(r){console.warn("An error occurred while writing the file to cache:",r)}}}});function A4(s,[e,t,n],[i,r],o="bilinear",l=!1){let u=r/n,h=i/t,d=new s.constructor(i*r*e),c=t*n,a=i*r;for(let f=0;f<i;++f)for(let p=0;p<r;++p){let g=f*r+p,m=(p+.5)/u-.5,y=(f+.5)/h-.5,_=Math.floor(m),x=Math.floor(y),E=Math.min(_+1,n-1),S=Math.min(x+1,t-1);_=Math.max(_,0),x=Math.max(x,0);let T=m-_,C=y-x,I=(1-T)*(1-C),A=T*(1-C),P=(1-T)*C,F=T*C,H=x*n,z=S*n,B=H+_,V=H+E,M=z+_,$=z+E;for(let oe=0;oe<e;++oe){let Z=oe*c;d[oe*a+g]=I*s[Z+B]+A*s[Z+V]+P*s[Z+M]+F*s[Z+$]}}return d}function C4(s,e,t){let n=new Array(t.length),i=new Array(t.length);for(let l=t.length-1,u=1;l>=0;--l)i[l]=u,n[l]=e[t[l]],u*=n[l];let r=t.map((l,u)=>i[t.indexOf(u)]),o=new s.constructor(s.length);for(let l=0;l<s.length;++l){let u=0;for(let h=e.length-1,d=l;h>=0;--h)u+=d%e[h]*r[h],d=Math.floor(d/e[h]);o[u]=s[l]}return[o,n]}function cn(s){let e=Mn(s)[0],t=s.map(r=>Math.exp(r-e)),n=t.reduce((r,o)=>r+o,0);return t.map(r=>r/n)}function I4(s){return cn(s).map(n=>Math.log(n))}function Ba(s,e=0){return s=Array.from(s).map((t,n)=>[n,t]).sort((t,n)=>n[1]-t[1]),e!==null&&e>0&&(s=s.slice(0,e)),s}function nE(s){if(s.length===0)throw Error("Array must not be empty");let e=s[0],t=0;for(let n=1;n<s.length;++n)s[n]<e&&(e=s[n],t=n);return[e,t]}function Mn(s){if(s.length===0)throw Error("Array must not be empty");let e=s[0],t=0;for(let n=1;n<s.length;++n)s[n]>e&&(e=s[n],t=n);return[Number(e),t]}function D4(s){return s>0&&(s&s-1)===0}function k4(s,e){if(e%2===0||e<=0)throw new Error("Window size must be a positive odd number");let t=new s.constructor(s.length),n=new s.constructor(e),i=Math.floor(e/2);for(let r=0;r<s.length;++r){let o=0;for(let l=-i;l<=i;++l){let u=r+l;u<0?u=Math.abs(u):u>=s.length&&(u=2*(s.length-1)-u),n[o++]=s[u]}n.sort(),t[r]=n[i]}return t}function eu(s,e){let t=Math.pow(10,e);return Math.round(s*t)/t}function R4(s){let e=Math.round(s);return Math.abs(s)%1===.5?e%2===0?e:e-1:e}var eE,rk,tE,Va=tn(()=>{eE=class{constructor(e){if(this.size=e|0,this.size<=1||!D4(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=e<<1,this.table=new Float64Array(this.size*2);for(let n=0;n<this.table.length;n+=2){let i=Math.PI*n/this.size;this.table[n]=Math.cos(i),this.table[n+1]=-Math.sin(i)}let t=0;for(let n=1;this.size>n;n<<=1)++t;this._width=t%2===0?t-1:t,this._bitrev=new Int32Array(1<<this._width);for(let n=0;n<this._bitrev.length;++n){this._bitrev[n]=0;for(let i=0;i<this._width;i+=2){let r=this._width-i-2;this._bitrev[n]|=(n>>>i&3)<<r}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(e,t){let n=t||new Array(e.length>>>1);for(let i=0;i<e.length;i+=2)n[i>>>1]=e[i];return n}toComplexArray(e,t){let n=t||this.createComplexArray();for(let i=0;i<n.length;i+=2)n[i]=e[i>>>1],n[i+1]=0;return n}transform(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._transform4(e,t,1)}realTransform(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._realTransform4(e,t,1)}inverseTransform(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._transform4(e,t,-1);for(let n=0;n<e.length;++n)e[n]/=this.size}_transform4(e,t,n){let i=this._csize,o=1<<this._width,l=i/o<<1,u,h,d=this._bitrev;if(l===4)for(u=0,h=0;u<i;u+=l,++h){let a=d[h];this._singleTransform2(t,e,u,a,o)}else for(u=0,h=0;u<i;u+=l,++h){let a=d[h];this._singleTransform4(t,e,u,a,o,n)}let c=this.table;for(o>>=2;o>=2;o>>=2){l=i/o<<1;let a=l>>>2;for(u=0;u<i;u+=l){let f=u+a-1;for(let p=u,g=0;p<f;p+=2,g+=o){let m=p,y=m+a,_=y+a,x=_+a,E=e[m],S=e[m+1],T=e[y],C=e[y+1],I=e[_],A=e[_+1],P=e[x],F=e[x+1],H=c[g],z=n*c[g+1],B=T*H-C*z,V=T*z+C*H,M=c[2*g],$=n*c[2*g+1],oe=I*M-A*$,Z=I*$+A*M,le=c[3*g],ae=n*c[3*g+1],be=P*le-F*ae,Ce=P*ae+F*le,Ze=E+oe,Ae=S+Z,Ie=E-oe,_e=S-Z,ht=B+be,Vt=V+Ce,ut=n*(B-be),Rt=n*(V-Ce);e[m]=Ze+ht,e[m+1]=Ae+Vt,e[y]=Ie+Rt,e[y+1]=_e-ut,e[_]=Ze-ht,e[_+1]=Ae-Vt,e[x]=Ie-Rt,e[x+1]=_e+ut}}}}_singleTransform2(e,t,n,i,r){let o=e[i],l=e[i+1],u=e[i+r],h=e[i+r+1];t[n]=o+u,t[n+1]=l+h,t[n+2]=o-u,t[n+3]=l-h}_singleTransform4(e,t,n,i,r,o){let l=r*2,u=r*3,h=e[i],d=e[i+1],c=e[i+r],a=e[i+r+1],f=e[i+l],p=e[i+l+1],g=e[i+u],m=e[i+u+1],y=h+f,_=d+p,x=h-f,E=d-p,S=c+g,T=a+m,C=o*(c-g),I=o*(a-m);t[n]=y+S,t[n+1]=_+T,t[n+2]=x+I,t[n+3]=E-C,t[n+4]=y-S,t[n+5]=_-T,t[n+6]=x-I,t[n+7]=E+C}_realTransform4(e,t,n){let i=this._csize,o=1<<this._width,l=i/o<<1,u,h,d=this._bitrev;if(l===4)for(u=0,h=0;u<i;u+=l,++h){let f=d[h];this._singleRealTransform2(t,e,u,f>>>1,o>>>1)}else for(u=0,h=0;u<i;u+=l,++h){let f=d[h];this._singleRealTransform4(t,e,u,f>>>1,o>>>1,n)}let c=this.table;for(o>>=2;o>=2;o>>=2){l=i/o<<1;let f=l>>>1,p=f>>>1,g=p>>>1;for(u=0;u<i;u+=l)for(let m=0,y=0;m<=g;m+=2,y+=o){let _=u+m,x=_+p,E=x+p,S=E+p,T=e[_],C=e[_+1],I=e[x],A=e[x+1],P=e[E],F=e[E+1],H=e[S],z=e[S+1],B=T,V=C,M=c[y],$=n*c[y+1],oe=I*M-A*$,Z=I*$+A*M,le=c[2*y],ae=n*c[2*y+1],be=P*le-F*ae,Ce=P*ae+F*le,Ze=c[3*y],Ae=n*c[3*y+1],Ie=H*Ze-z*Ae,_e=H*Ae+z*Ze,ht=B+be,Vt=V+Ce,ut=B-be,Rt=V-Ce,Yt=oe+Ie,At=Z+_e,Qe=n*(oe-Ie),On=n*(Z-_e);if(e[_]=ht+Yt,e[_+1]=Vt+At,e[x]=ut+On,e[x+1]=Rt-Qe,m===0){e[E]=ht-Yt,e[E+1]=Vt-At;continue}if(m===g)continue;let qn=u+p-m,is=u+f-m;e[qn]=ut-n*On,e[qn+1]=-Rt-n*Qe,e[is]=ht-n*Yt,e[is+1]=-Vt+n*At}}let a=i>>>1;for(let f=2;f<a;f+=2)e[i-f]=e[f],e[i-f+1]=-e[f+1]}_singleRealTransform2(e,t,n,i,r){let o=e[i],l=e[i+r];t[n]=o+l,t[n+1]=0,t[n+2]=o-l,t[n+3]=0}_singleRealTransform4(e,t,n,i,r,o){let l=r*2,u=r*3,h=e[i],d=e[i+r],c=e[i+l],a=e[i+u],f=h+c,p=h-c,g=d+a,m=o*(d-a);t[n]=f+g,t[n+1]=0,t[n+2]=p,t[n+3]=-m,t[n+4]=f-g,t[n+5]=0,t[n+6]=p,t[n+7]=m}},rk=class{constructor(e){let t=2*(e-1),n=2*(2*e-1),i=2**Math.ceil(Math.log2(n));this.bufferSize=i,this._a=t;let r=new Float64Array(n),o=new Float64Array(i);this._chirpBuffer=new Float64Array(i),this._buffer1=new Float64Array(i),this._buffer2=new Float64Array(i),this._outBuffer1=new Float64Array(i),this._outBuffer2=new Float64Array(i);let l=-2*Math.PI/e,u=Math.cos(l),h=Math.sin(l);for(let d=0;d<n>>1;++d){let c=(d+1-e)**2/2,a=Math.sqrt(u**2+h**2)**c,f=c*Math.atan2(h,u),p=2*d;r[p]=a*Math.cos(f),r[p+1]=a*Math.sin(f),o[p]=r[p],o[p+1]=-r[p+1]}this._slicedChirpBuffer=r.subarray(t,n),this._f=new eE(i>>1),this._f.transform(this._chirpBuffer,o)}_transform(e,t,n){let i=this._buffer1,r=this._buffer2,o=this._outBuffer1,l=this._outBuffer2,u=this._chirpBuffer,h=this._slicedChirpBuffer,d=this._a;if(n)for(let c=0;c<h.length;c+=2){let a=c+1,f=c>>1,p=t[f];i[c]=p*h[c],i[a]=p*h[a]}else for(let c=0;c<h.length;c+=2){let a=c+1;i[c]=t[c]*h[c]-t[a]*h[a],i[a]=t[c]*h[a]+t[a]*h[c]}this._f.transform(o,i);for(let c=0;c<u.length;c+=2){let a=c+1;r[c]=o[c]*u[c]-o[a]*u[a],r[a]=o[c]*u[a]+o[a]*u[c]}this._f.inverseTransform(l,r);for(let c=0;c<l.length;c+=2){let a=l[c+d],f=l[c+d+1],p=h[c],g=h[c+1];e[c]=a*p-f*g,e[c+1]=a*g+f*p}}transform(e,t){this._transform(e,t,!1)}realTransform(e,t){this._transform(e,t,!0)}},tE=class{constructor(e){this.fft_length=e,this.isPowerOfTwo=D4(e),this.isPowerOfTwo?(this.fft=new eE(e),this.outputBufferSize=2*e):(this.fft=new rk(e),this.outputBufferSize=this.fft.bufferSize)}realTransform(e,t){this.fft.realTransform(e,t)}transform(e,t){this.fft.transform(e,t)}}});function $J(s,e){let t=s.length,n=e.reduce((r,o)=>r*o);if(t!==n)throw Error(`cannot reshape array of size ${t} into shape (${e})`);let i=s;for(let r=e.length-1;r>=0;r--)i=i.reduce((o,l)=>{let u=o[o.length-1];return u.length<e[r]?u.push(l):o.push([l]),o},[[]]);return i[0]}function UJ(s,e){let[t,n]=C4(s.data,s.dims,e);return new pe(s.type,t,n)}function tu(s,[e,t],n="bilinear",i=!1){let r=s.dims.at(-3)??1,o=s.dims.at(-2),l=s.dims.at(-1),u=A4(s.data,[r,o,l],[e,t],n,i);return new pe(s.type,u,[r,e,t])}function F4(s,e){let t=[s.dims[0],s.dims[2]],n=new s.data.constructor(t[0]*t[1]),[i,r,o]=s.dims,l=0;for(let u=0;u<i;++u){let h=u*o*r;for(let d=0;d<o;++d){let c=0,a=0,f=u*r,p=h+d;for(let m=0;m<r;++m){let y=Number(e.data[f+m]);a+=y,c+=s.data[p+m*o]*y}let g=c/a;n[l++]=g}}return new pe(s.type,n,t)}function N4(s,e){return s=s.slice(),e===null?s=s.filter(t=>t!==1):typeof e=="number"?s[e]===1&&s.splice(e,1):Array.isArray(e)&&(s=s.filter((t,n)=>t!==1||!e.includes(n))),s}function O4(s,e){return e=za(e,s.length+1),s=s.slice(),s.splice(e,0,1),s}function za(s,e,t=null){if(s<-e||s>=e)throw new Error(`IndexError: index ${s} is out of bounds for dimension${t===null?"":" "+t} with size ${e}`);return s<0&&(s=(s%e+e)%e),s}function qh(s,e=0){e=za(e,s[0].dims.length);let t=s[0].dims.slice();t[e]=s.reduce((o,l)=>o+l.dims[e],0);let n=t.reduce((o,l)=>o*l,1),i=new s[0].data.constructor(n),r=s[0].type;if(e===0){let o=0;for(let l of s)i.set(l.data,o),o+=l.data.length}else{let o=0;for(let l=0;l<s.length;++l){let u=s[l];for(let h=0;h<u.data.length;++h){let d=0;for(let c=u.dims.length-1,a=h,f=1;c>=0;--c){let p=u.dims[c],g=a%p;c===e&&(g+=o),d+=g*f,f*=t[c],a=Math.floor(a/p)}i[d]=u.data[h]}o+=u.dims[e]}}return new pe(r,i,t)}function Yh(s,e=0){return qh(s.map(t=>t.unsqueeze(e)),e)}function L4(s,e=null,t=1,n=!1){if(e===null){let h=s.data.reduce((f,p)=>f+p,0)/s.data.length,d=Math.sqrt(s.data.reduce((f,p)=>f+(p-h)**2,0)/(s.data.length-t)),c=new pe(s.type,[h],[]);return[new pe(s.type,[d],[]),c]}e=za(e,s.dims.length);let i=ok(s,e,n),r=s.dims.slice();r[e]=1;let o=new s.data.constructor(s.data.length/s.dims[e]);for(let u=0;u<s.data.length;++u){let h=0;for(let d=s.dims.length-1,c=u,a=1;d>=0;--d){let f=s.dims[d];if(d!==e){let p=c%f;h+=p*a,a*=r[d]}c=Math.floor(c/f)}o[h]+=(s.data[u]-i.data[h])**2}for(let u=0;u<o.length;++u)o[u]=Math.sqrt(o[u]/(s.dims[e]-t));return n||r.splice(e,1),[new pe(s.type,o,r),i]}function ok(s,e=null,t=!1){if(e===null){let r=s.data.reduce((o,l)=>o+l,0);return new pe(s.type,[r/s.data.length],[])}e=za(e,s.dims.length);let n=s.dims.slice();n[e]=1;let i=new s.data.constructor(s.data.length/s.dims[e]);for(let r=0;r<s.data.length;++r){let o=0;for(let l=s.dims.length-1,u=r,h=1;l>=0;--l){let d=s.dims[l];if(l!==e){let c=u%d;o+=c*h,h*=n[l]}u=Math.floor(u/d)}i[o]+=s.data[r]}if(s.dims[e]!==1)for(let r=0;r<i.length;++r)i[r]=i[r]/s.dims[e];return t||n.splice(e,1),new pe(s.type,i,n)}function $4(s){let[e,t]=s.dims,n=[e+1,t+1],i=new pe("float32",new Float32Array(n[0]*n[1]).fill(1/0),n),r=new pe("float32",new Float32Array(n[0]*n[1]).fill(-1),n);i[0].data[0]=0;for(let d=1;d<t+1;++d)for(let c=1;c<e+1;++c){let a=i[c-1][d-1].item(),f=i[c-1][d].item(),p=i[c][d-1].item(),g,m;a<f&&a<p?(g=a,m=0):f<a&&f<p?(g=f,m=1):(g=p,m=2),i[c].data[d]=s[c-1][d-1].item()+g,r[c].data[d]=m}let o=e,l=t;r.data.fill(2,0,n[1]);for(let d=0;d<n[0];++d)r[d].data[0]=1;let u=[],h=[];for(;o>0||l>0;)switch(u.push(o-1),h.push(l-1),r[o][l].item()){case 0:--o,--l;break;case 1:--o;break;case 2:--l;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${o}, ${l}]. Please file a bug report.`)}return u.reverse(),h.reverse(),[u,h]}function BJ(s){let e=new Array(s.length);for(let t=s.length-1,n=1;t>=0;--t)e[t]=n,n*=s[t];return e}function VJ(s){let e=s.reduce((t,n)=>t*n,1);return new pe("int64",new BigInt64Array(e).fill(1n),s)}function U4(s){return VJ(s.dims)}function B4(s,e){if(s.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(s.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(e))throw new Error("The precision must be either 'binary' or 'ubinary'");let t=e==="binary",n=t?"int8":"uint8",i=t?Int8Array:Uint8Array,r=s.data,o=new i(r.length/8);for(let l=0;l<r.length;++l){let u=r[l]>0?1:0,h=Math.floor(l/8),d=l%8;o[h]|=u<<7-d,t&&d===0&&(o[h]-=128)}return new pe(n,o,[s.dims[0],s.dims[1]/8])}var P4,M4,pe,Ha=tn(()=>{Wx();Va();P4=Object.freeze({float32:Float32Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array}),M4=_o.Tensor,pe=class s{constructor(...e){J(this,"dims");J(this,"type");J(this,"data");J(this,"size");return e[0]instanceof M4?Object.assign(this,e[0]):Object.assign(this,new M4(e[0],e[1],e[2])),new Proxy(this,{get:(t,n)=>{if(typeof n=="string"){let i=Number(n);if(Number.isInteger(i))return t._getitem(i)}return t[n]},set:(t,n,i)=>t[n]=i})}*[Symbol.iterator](){let[e,...t]=this.dims;if(t.length>0){let n=t.reduce((i,r)=>i*r);for(let i=0;i<e;++i)yield this._subarray(i,n,t)}else yield*this.data}_getitem(e){let[t,...n]=this.dims;if(e=za(e,t),n.length>0){let i=n.reduce((r,o)=>r*o);return this._subarray(e,i,n)}else return new s(this.type,[this.data[e]],n)}indexOf(e){for(let t=0;t<this.data.length;++t)if(this.data[t]==e)return t;return-1}_subarray(e,t,n){let i=e*t,r=(e+1)*t,o="subarray"in this.data?this.data.subarray(i,r):this.data.slice(i,r);return new s(this.type,o,n)}item(){if(this.data.length!==1)throw new Error(`a Tensor with ${this.data.length} elements cannot be converted to Scalar`);return this.data[0]}tolist(){return $J(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){for(let e=0;e<this.data.length;++e)this.data[e]=1/(1+Math.exp(-this.data[e]));return this}mul(e){return this.clone().mul_(e)}mul_(e){for(let t=0;t<this.data.length;++t)this.data[t]*=e;return this}add(e){return this.clone().add_(e)}add_(e){for(let t=0;t<this.data.length;++t)this.data[t]+=e;return this}clone(){return new s(this.type,this.data.slice(),this.dims.slice())}slice(...e){let t=[],n=[];for(let u=0;u<this.dims.length;++u){let h=e[u];if(h==null)n.push([0,this.dims[u]]),t.push(this.dims[u]);else if(typeof h=="number")h=za(h,this.dims[u],u),n.push([h,h+1]);else if(Array.isArray(h)&&h.length===2){if(h[0]>h[1])throw new Error(`Invalid slice: ${h}`);let d=[Math.max(h[0],0),Math.min(h[1],this.dims[u])];n.push(d),t.push(d[1]-d[0])}else throw new Error(`Invalid slice: ${h}`)}let i=n.map(([u,h])=>h-u),r=i.reduce((u,h)=>u*h),o=new this.data.constructor(r),l=this.stride();for(let u=0;u<r;++u){let h=0;for(let d=i.length-1,c=u;d>=0;--d){let a=i[d];h+=(c%a+n[d][0])*l[d],c=Math.floor(c/a)}o[u]=this.data[h]}return new s(this.type,o,t)}permute(...e){return UJ(this,e)}transpose(...e){return this.permute(...e)}sum(e=null,t=!1){return this.norm(1,e,t)}norm(e="fro",t=null,n=!1){if(e==="fro")e=2;else if(typeof e=="string")throw Error(`Unsupported norm: ${e}`);if(t===null){let o=this.data.reduce((l,u)=>l+u**e,0)**(1/e);return new s(this.type,[o],[])}t=za(t,this.dims.length);let i=this.dims.slice();i[t]=1;let r=new this.data.constructor(this.data.length/this.dims[t]);for(let o=0;o<this.data.length;++o){let l=0;for(let u=this.dims.length-1,h=o,d=1;u>=0;--u){let c=this.dims[u];if(u!==t){let a=h%c;l+=a*d,d*=i[u]}h=Math.floor(h/c)}r[l]+=this.data[o]**e}if(e!==1)for(let o=0;o<r.length;++o)r[o]=r[o]**(1/e);return n||i.splice(t,1),new s(this.type,r,i)}normalize_(e=2,t=1){t=za(t,this.dims.length);let n=this.norm(e,t,!0);for(let i=0;i<this.data.length;++i){let r=0;for(let o=this.dims.length-1,l=i,u=1;o>=0;--o){let h=this.dims[o];if(o!==t){let d=l%h;r+=d*u,u*=this.dims[o]}l=Math.floor(l/h)}this.data[i]/=n.data[r]}return this}normalize(e=2,t=1){return this.clone().normalize_(e,t)}stride(){return BJ(this.dims)}squeeze(e=null){return new s(this.type,this.data,N4(this.dims,e))}squeeze_(e=null){return this.dims=N4(this.dims,e),this}unsqueeze(e=null){return new s(this.type,this.data,O4(this.dims,e))}unsqueeze_(e=null){return this.dims=O4(this.dims,e),this}flatten_(e=0,t=-1){t=(t+this.dims.length)%this.dims.length;let n=this.dims.slice(0,e),i=this.dims.slice(e,t+1),r=this.dims.slice(t+1);return this.dims=[...n,i.reduce((o,l)=>o*l,1),...r],this}flatten(e=0,t=-1){return this.clone().flatten_(e,t)}view(...e){let t=-1;for(let n=0;n<e.length;++n)if(e[n]===-1){if(t!==-1)throw new Error("Only one dimension can be inferred");t=n}if(t!==-1){let n=e.reduce((i,r,o)=>o!==t?i*r:i,1);e[t]=this.data.length/n}return new s(this.type,this.data,e)}neg_(){for(let e=0;e<this.data.length;++e)this.data[e]=-this.data[e];return this}neg(){return this.clone().neg_()}clamp_(e,t){for(let n=0;n<this.data.length;++n)this.data[n]=Math.min(Math.max(this.data[n],e),t);return this}clamp(e,t){return this.clone().clamp_(e,t)}round_(){for(let e=0;e<this.data.length;++e)this.data[e]=Math.round(this.data[e]);return this}round(){return this.clone().round_()}to(e){if(this.type===e)return this;if(!P4.hasOwnProperty(e))throw new Error(`Unsupported type: ${e}`);return new s(e,P4[e].from(this.data),this.dims)}}});var sE,iE,rE,oE,Sy,V4=tn(()=>{sE=class{constructor(e=(t,n)=>t>n){this._heap=[],this._comparator=e}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...e){return this.extend(e)}extend(e){for(let t of e)this._heap.push(t),this._siftUp();return this.size}pop(){let e=this.peek(),t=this.size-1;return t>0&&this._swap(0,t),this._heap.pop(),this._siftDown(),e}replace(e){let t=this.peek();return this._heap[0]=e,this._siftDown(),t}_parent(e){return(e+1>>>1)-1}_left(e){return(e<<1)+1}_right(e){return e+1<<1}_greater(e,t){return this._comparator(this._heap[e],this._heap[t])}_swap(e,t){let n=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=n}_siftUp(){let e=this.size-1;for(;e>0&&this._greater(e,this._parent(e));)this._swap(e,this._parent(e)),e=this._parent(e)}_siftDown(){let e=0;for(;this._left(e)<this.size&&this._greater(this._left(e),e)||this._right(e)<this.size&&this._greater(this._right(e),e);){let t=this._right(e)<this.size&&this._greater(this._right(e),this._left(e))?this._right(e):this._left(e);this._swap(e,t),e=t}}},iE=class{constructor(){this.root=rE.default()}extend(e){for(let t of e)this.push(t)}push(e){let t=this.root;for(let n of e){let i=t.children.get(n);i===void 0&&(i=rE.default(),t.children.set(n,i)),t=i}t.isLeaf=!0}*commonPrefixSearch(e){let t=this.root,n="";for(let i=0;i<e.length&&t!==void 0;++i){let r=e[i];n+=r,t=t.children.get(r),t!==void 0&&t.isLeaf&&(yield n)}}},rE=class s{constructor(e,t){this.isLeaf=e,this.children=t}static default(){return new s(!1,new Map)}},oE=class{constructor(e,t,n){this.sentence=e,this.len=e.length,this.bosTokenId=t,this.eosTokenId=n,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);let i=new Sy(this.bosTokenId,0,0,0,0),r=new Sy(this.eosTokenId,1,this.len,0,0);this.nodes.push(i.clone()),this.nodes.push(r.clone()),this.beginNodes[this.len].push(r),this.endNodes[0].push(i)}insert(e,t,n,i){let r=this.nodes.length,o=new Sy(i,r,e,t,n);this.beginNodes[e].push(o),this.endNodes[e+t].push(o),this.nodes.push(o)}viterbi(){let e=this.len,t=0;for(;t<=e;){if(this.beginNodes[t].length==0)return[];for(let l of this.beginNodes[t]){l.prev=null;let u=0,h=null;for(let d of this.endNodes[t]){let c=d.backtraceScore+l.score;(h===null||c>u)&&(h=d.clone(),u=c)}if(h!==null)l.prev=h,l.backtraceScore=u;else return[]}++t}let n=[],r=this.beginNodes[e][0].prev;if(r===null)return[];let o=r.clone();for(;o.prev!==null;)n.push(o.clone()),o=o.clone().prev.clone();return n.reverse(),n}piece(e){return this.sentence.slice(e.pos,e.pos+e.length)}tokens(){return this.viterbi().map(t=>this.piece(t))}tokenIds(){return this.viterbi().map(t=>t.tokenId)}},Sy=class s{constructor(e,t,n,i,r){this.tokenId=e,this.nodeId=t,this.pos=n,this.length=i,this.score=r,this.prev=null,this.backtraceScore=0}clone(){let e=new s(this.tokenId,this.nodeId,this.pos,this.length,this.score);return e.prev=this.prev,e.backtraceScore=this.backtraceScore,e}}});function H4(s){return/\w/.test(s)}function ak(s){return/[0-9]/.test(s)}function GJ(s,e={}){return s.endsWith(`
`)&&(s=s.slice(0,-1)),s=s.replace(/{#.*?#}/gs,"{##}"),e.lstrip_blocks&&(s=s.replace(/^[ \t]*({[#%])/gm,"$1")),e.trim_blocks&&(s=s.replace(/([#%]})\n/g,"$1")),s.replace(/{##}/g,"").replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{")}function jJ(s,e={}){let t=[],n=GJ(s,e),i=0,r=o=>{let l="";for(;o(n[i]);){if(n[i]==="\\"){if(++i,i>=n.length)throw new SyntaxError("Unexpected end of input");let u=n[i++],h=HJ.get(u);if(h===void 0)throw new SyntaxError(`Unexpected escaped character: ${u}`);l+=h;continue}if(l+=n[i++],i>=n.length)throw new SyntaxError("Unexpected end of input")}return l};e:for(;i<n.length;){let o=t.at(-1)?.type;if(o===void 0||o===te.CloseStatement||o===te.CloseExpression){let u="";for(;i<n.length&&!(n[i]==="{"&&(n[i+1]==="%"||n[i+1]==="{"));)u+=n[i++];if(u.length>0){t.push(new nu(u,te.Text));continue}}r(u=>/\s/.test(u));let l=n[i];if(l==="-"||l==="+"){let u=t.at(-1)?.type;if(u===te.Text||u===void 0)throw new SyntaxError(`Unexpected character: ${l}`);switch(u){case te.Identifier:case te.NumericLiteral:case te.BooleanLiteral:case te.StringLiteral:case te.CloseParen:case te.CloseSquareBracket:break;default:{++i;let h=r(ak);t.push(new nu(`${l}${h}`,h.length>0?te.NumericLiteral:te.UnaryOperator));continue}}}for(let[u,h]of zJ)if(n.slice(i,i+u.length)===u){t.push(new nu(u,h)),i+=u.length;continue e}if(l==="'"||l==='"'){++i;let u=r(h=>h!==l);t.push(new nu(u,te.StringLiteral)),++i;continue}if(ak(l)){let u=r(ak);t.push(new nu(u,te.NumericLiteral));continue}if(H4(l)){let u=r(H4),h=Object.hasOwn(z4,u)?z4[u]:te.Identifier;h===te.In&&t.at(-1)?.type===te.Not?(t.pop(),t.push(new nu("not in",te.NotIn))):t.push(new nu(u,h));continue}throw new SyntaxError(`Unexpected character: ${l}`)}return t}function rZ(s){let e=new WJ([]),t=0;function n(V,M){let $=s[t++];if(!$||$.type!==V)throw new Error(`Parser Error: ${M}. ${$.type} !== ${V}.`);return $}function i(){switch(s[t].type){case te.Text:return l();case te.OpenStatement:return u();case te.OpenExpression:return h();default:throw new SyntaxError(`Unexpected token type: ${s[t].type}`)}}function r(...V){return t+V.length<=s.length&&V.some((M,$)=>M!==s[t+$].type)}function o(...V){return t+V.length<=s.length&&V.every((M,$)=>M===s[t+$].type)}function l(){return new j4(n(te.Text,"Expected text token").value)}function u(){n(te.OpenStatement,"Expected opening statement token");let V;switch(s[t].type){case te.Set:++t,V=d(),n(te.CloseStatement,"Expected closing statement token");break;case te.If:++t,V=c(),n(te.OpenStatement,"Expected {% token"),n(te.EndIf,"Expected endif token"),n(te.CloseStatement,"Expected %} token");break;case te.For:++t,V=f(),n(te.OpenStatement,"Expected {% token"),n(te.EndFor,"Expected endfor token"),n(te.CloseStatement,"Expected %} token");break;default:throw new SyntaxError(`Unknown statement type: ${s[t].type}`)}return V}function h(){n(te.OpenExpression,"Expected opening expression token");let V=p();return n(te.CloseExpression,"Expected closing expression token"),V}function d(){let V=p();if(o(te.Equals)){++t;let M=d();return new YJ(V,M)}return V}function c(){let V=p();n(te.CloseStatement,"Expected closing statement token");let M=[],$=[];for(;!(s[t]?.type===te.OpenStatement&&(s[t+1]?.type===te.ElseIf||s[t+1]?.type===te.Else||s[t+1]?.type===te.EndIf));)M.push(i());if(s[t]?.type===te.OpenStatement&&s[t+1]?.type!==te.EndIf)if(++t,o(te.ElseIf))n(te.ElseIf,"Expected elseif token"),$.push(c());else for(n(te.Else,"Expected else token"),n(te.CloseStatement,"Expected closing statement token");!(s[t]?.type===te.OpenStatement&&s[t+1]?.type===te.EndIf);)$.push(i());return new G4(V,M,$)}function a(V=!1){let M=V?B:p,$=[M()],oe=o(te.Comma);for(;oe&&(++t,$.push(M()),!!o(te.Comma)););return oe?new q4($):$[0]}function f(){let V=a(!0);if(!(V instanceof Kh||V instanceof q4))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${V.type} instead`);n(te.In,"Expected `in` keyword following loop variable");let M=p();n(te.CloseStatement,"Expected closing statement token");let $=[];for(;r(te.OpenStatement,te.EndFor);)$.push(i());return new qJ(V,M,$)}function p(){return g()}function g(){let V=m();if(o(te.If)){++t;let M=m();n(te.Else,"Expected else token");let $=m();return new G4(M,[V],[$])}return V}function m(){let V=y();for(;o(te.Or);){let M=s[t];++t;let $=y();V=new Ty(M,V,$)}return V}function y(){let V=_();for(;o(te.And);){let M=s[t];++t;let $=_();V=new Ty(M,V,$)}return V}function _(){let V;for(;o(te.Not);){let M=s[t];++t;let $=_();V=new nZ(M,$)}return V??x()}function x(){let V=E();for(;o(te.ComparisonBinaryOperator)||o(te.In)||o(te.NotIn);){let M=s[t];++t;let $=E();V=new Ty(M,V,$)}return V}function E(){let V=F();for(;o(te.AdditiveBinaryOperator);){let M=s[t];++t;let $=F();V=new Ty(M,V,$)}return V}function S(){let V=P();return o(te.OpenParen)?T(V):V}function T(V){let M=new XJ(V,C());return o(te.OpenParen)&&(M=T(M)),M}function C(){n(te.OpenParen,"Expected opening parenthesis for arguments list");let V=I();return n(te.CloseParen,"Expected closing parenthesis for arguments list"),V}function I(){let V=[];for(;!o(te.CloseParen);){let M=p();if(o(te.Equals)){if(++t,!(M instanceof Kh))throw new SyntaxError("Expected identifier for keyword argument");let $=p();M=new iZ(M,$)}V.push(M),o(te.Comma)&&++t}return V}function A(){let V=[],M=!1;for(;!o(te.CloseSquareBracket);)o(te.Colon)?(V.push(void 0),++t,M=!0):(V.push(p()),o(te.Colon)&&(++t,M=!0));if(V.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(M){if(V.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new sZ(...V)}return V[0]}function P(){let V=B();for(;o(te.Dot)||o(te.OpenSquareBracket);){let M=s[t];++t;let $,oe=M.type!==te.Dot;if(oe)$=A(),n(te.CloseSquareBracket,"Expected closing square bracket");else if($=B(),$.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");V=new KJ(V,$,oe)}return V}function F(){let V=H();for(;o(te.MultiplicativeBinaryOperator);){let M=s[t];++t;let $=H();V=new Ty(M,V,$)}return V}function H(){let V=z();for(;o(te.Is);){++t;let M=o(te.Not);M&&++t;let $=B();if($ instanceof W4&&($=new Kh($.value.toString())),!($ instanceof Kh))throw new SyntaxError("Expected identifier for the test");V=new tZ(V,M,$)}return V}function z(){let V=S();for(;o(te.Pipe);){++t;let M=B();if(!(M instanceof Kh))throw new SyntaxError("Expected identifier for the filter");o(te.OpenParen)&&(M=T(M)),V=new eZ(V,M)}return V}function B(){let V=s[t];switch(V.type){case te.NumericLiteral:return++t,new JJ(Number(V.value));case te.StringLiteral:return++t,new j4(V.value);case te.BooleanLiteral:return++t,new W4(V.value==="true");case te.Identifier:return++t,new Kh(V.value);case te.OpenParen:{++t;let M=a();if(s[t].type!==te.CloseParen)throw new SyntaxError(`Expected closing parenthesis, got ${s[t].type} instead`);return++t,M}case te.OpenSquareBracket:{++t;let M=[];for(;!o(te.CloseSquareBracket);)M.push(p()),o(te.Comma)&&++t;return++t,new ZJ(M)}case te.OpenCurlyBracket:{++t;let M=new Map;for(;!o(te.CloseCurlyBracket);){let $=p();n(te.Colon,"Expected colon between key and value in object literal");let oe=p();M.set($,oe),o(te.Comma)&&++t}return++t,new QJ(M)}default:throw new SyntaxError(`Unexpected token: ${V.type}`)}}for(;t<s.length;)e.body.push(i());return e}function oZ(s,e,t=1){e===void 0&&(e=s,s=0);let n=[];for(let i=s;i<e;i+=t)n.push(i);return n}function Y4(s,e,t,n=1){let i=Math.sign(n);i>=0?(e=(e??(e=0))<0?Math.max(s.length+e,0):Math.min(e,s.length),t=(t??(t=s.length))<0?Math.max(s.length+t,0):Math.min(t,s.length)):(e=(e??(e=s.length-1))<0?Math.max(s.length+e,-1):Math.min(e,s.length-1),t=(t??(t=-1))<-1?Math.max(s.length+t,-1):Math.min(t,s.length-1));let r=[];for(let o=e;i*o<i*t;o+=n)r.push(s[o]);return r}function K4(s){return s.replace(/\b\w/g,e=>e.toUpperCase())}function aE(s){switch(typeof s){case"number":return new St(s);case"string":return new rt(s);case"boolean":return new Wt(s);case"object":return s===null?new Ay:Array.isArray(s)?new Bt(s.map(aE)):new Mi(new Map(Object.entries(s).map(([e,t])=>[e,aE(t)])));case"function":return new wo((e,t)=>{let n=s(...e.map(i=>i.value))??null;return aE(n)});default:throw new Error(`Cannot convert to runtime value: ${s}`)}}var te,z4,nu,zJ,HJ,Cy,WJ,G4,qJ,YJ,vr,KJ,XJ,Kh,Xh,JJ,j4,W4,ZJ,q4,QJ,Ty,eZ,tZ,nZ,sZ,iZ,xo,St,rt,Wt,Mi,Bt,aZ,wo,Ay,Pi,lk,lZ,X4,J4=tn(()=>{te=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator"}),z4=Object.freeze({set:te.Set,for:te.For,in:te.In,is:te.Is,if:te.If,else:te.Else,endif:te.EndIf,elif:te.ElseIf,endfor:te.EndFor,and:te.And,or:te.Or,not:te.Not,"not in":te.NotIn,true:te.BooleanLiteral,false:te.BooleanLiteral}),nu=class{constructor(s,e){this.value=s,this.type=e}};zJ=[["{%",te.OpenStatement],["%}",te.CloseStatement],["{{",te.OpenExpression],["}}",te.CloseExpression],["(",te.OpenParen],[")",te.CloseParen],["{",te.OpenCurlyBracket],["}",te.CloseCurlyBracket],["[",te.OpenSquareBracket],["]",te.CloseSquareBracket],[",",te.Comma],[".",te.Dot],[":",te.Colon],["|",te.Pipe],["<=",te.ComparisonBinaryOperator],[">=",te.ComparisonBinaryOperator],["==",te.ComparisonBinaryOperator],["!=",te.ComparisonBinaryOperator],["<",te.ComparisonBinaryOperator],[">",te.ComparisonBinaryOperator],["+",te.AdditiveBinaryOperator],["-",te.AdditiveBinaryOperator],["*",te.MultiplicativeBinaryOperator],["/",te.MultiplicativeBinaryOperator],["%",te.MultiplicativeBinaryOperator],["=",te.Equals]],HJ=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);Cy=class{constructor(){J(this,"type","Statement")}},WJ=class extends Cy{constructor(e){super();J(this,"type","Program");this.body=e}},G4=class extends Cy{constructor(e,t,n){super();J(this,"type","If");this.test=e,this.body=t,this.alternate=n}},qJ=class extends Cy{constructor(e,t,n){super();J(this,"type","For");this.loopvar=e,this.iterable=t,this.body=n}},YJ=class extends Cy{constructor(e,t){super();J(this,"type","Set");this.assignee=e,this.value=t}},vr=class extends Cy{constructor(){super(...arguments);J(this,"type","Expression")}},KJ=class extends vr{constructor(e,t,n){super();J(this,"type","MemberExpression");this.object=e,this.property=t,this.computed=n}},XJ=class extends vr{constructor(e,t){super();J(this,"type","CallExpression");this.callee=e,this.args=t}},Kh=class extends vr{constructor(e){super();J(this,"type","Identifier");this.value=e}},Xh=class extends vr{constructor(e){super();J(this,"type","Literal");this.value=e}},JJ=class extends Xh{constructor(){super(...arguments);J(this,"type","NumericLiteral")}},j4=class extends Xh{constructor(){super(...arguments);J(this,"type","StringLiteral")}},W4=class extends Xh{constructor(){super(...arguments);J(this,"type","BooleanLiteral")}},ZJ=class extends Xh{constructor(){super(...arguments);J(this,"type","ArrayLiteral")}},q4=class extends Xh{constructor(){super(...arguments);J(this,"type","TupleLiteral")}},QJ=class extends Xh{constructor(){super(...arguments);J(this,"type","ObjectLiteral")}},Ty=class extends vr{constructor(e,t,n){super();J(this,"type","BinaryExpression");this.operator=e,this.left=t,this.right=n}},eZ=class extends vr{constructor(e,t){super();J(this,"type","FilterExpression");this.operand=e,this.filter=t}},tZ=class extends vr{constructor(e,t,n){super();J(this,"type","TestExpression");this.operand=e,this.negate=t,this.test=n}},nZ=class extends vr{constructor(e,t){super();J(this,"type","UnaryExpression");this.operator=e,this.argument=t}},sZ=class extends vr{constructor(e=void 0,t=void 0,n=void 0){super();J(this,"type","SliceExpression");this.start=e,this.stop=t,this.step=n}},iZ=class extends vr{constructor(e,t){super();J(this,"type","KeywordArgumentExpression");this.key=e,this.value=t}};xo=class{constructor(s=void 0){J(this,"type","RuntimeValue");J(this,"value");J(this,"builtins",new Map);this.value=s}__bool__(){return new Wt(!!this.value)}},St=class extends xo{constructor(){super(...arguments);J(this,"type","NumericValue")}},rt=class extends xo{constructor(){super(...arguments);J(this,"type","StringValue");J(this,"builtins",new Map([["upper",new wo(()=>new rt(this.value.toUpperCase()))],["lower",new wo(()=>new rt(this.value.toLowerCase()))],["strip",new wo(()=>new rt(this.value.trim()))],["title",new wo(()=>new rt(K4(this.value)))],["length",new St(this.value.length)]]))}},Wt=class extends xo{constructor(){super(...arguments);J(this,"type","BooleanValue")}},Mi=class extends xo{constructor(){super(...arguments);J(this,"type","ObjectValue");J(this,"builtins",new Map([["get",new wo(([e,t])=>{if(!(e instanceof rt))throw new Error(`Object key must be a string: got ${e.type}`);return this.value.get(e.value)??t??new Ay})],["items",new wo(()=>new Bt(Array.from(this.value.entries()).map(([e,t])=>new Bt([new rt(e),t]))))]]))}__bool__(){return new Wt(this.value.size>0)}},Bt=class extends xo{constructor(){super(...arguments);J(this,"type","ArrayValue");J(this,"builtins",new Map([["length",new St(this.value.length)]]))}__bool__(){return new Wt(this.value.length>0)}},aZ=class extends Bt{constructor(){super(...arguments);J(this,"type","TupleValue")}},wo=class extends xo{constructor(){super(...arguments);J(this,"type","FunctionValue")}},Ay=class extends xo{constructor(){super(...arguments);J(this,"type","NullValue")}},Pi=class extends xo{constructor(){super(...arguments);J(this,"type","UndefinedValue")}},lk=class{constructor(s){J(this,"variables",new Map([["namespace",new wo(s=>{if(s.length===0)return new Mi(new Map);if(s.length!==1||!(s[0]instanceof Mi))throw new Error("`namespace` expects either zero arguments or a single object argument");return s[0]})]]));J(this,"tests",new Map([["boolean",s=>s.type==="BooleanValue"],["callable",s=>s instanceof wo],["odd",s=>{if(s.type!=="NumericValue")throw new Error(`Cannot apply test "odd" to type: ${s.type}`);return s.value%2!==0}],["even",s=>{if(s.type!=="NumericValue")throw new Error(`Cannot apply test "even" to type: ${s.type}`);return s.value%2===0}],["false",s=>s.type==="BooleanValue"&&!s.value],["true",s=>s.type==="BooleanValue"&&s.value],["number",s=>s.type==="NumericValue"],["integer",s=>s.type==="NumericValue"&&Number.isInteger(s.value)],["iterable",s=>s instanceof Bt||s instanceof rt],["lower",s=>{let e=s.value;return s.type==="StringValue"&&e===e.toLowerCase()}],["upper",s=>{let e=s.value;return s.type==="StringValue"&&e===e.toUpperCase()}],["none",s=>s.type==="NullValue"],["defined",s=>s.type!=="UndefinedValue"],["undefined",s=>s.type==="UndefinedValue"],["equalto",(s,e)=>s.value===e.value]]));this.parent=s}set(s,e){return this.declareVariable(s,aE(e))}declareVariable(s,e){if(this.variables.has(s))throw new SyntaxError(`Variable already declared: ${s}`);return this.variables.set(s,e),e}setVariable(s,e){return this.variables.set(s,e),e}resolve(s){if(this.variables.has(s))return this;if(this.parent)return this.parent.resolve(s);throw new Error(`Unknown variable: ${s}`)}lookupVariable(s){try{return this.resolve(s).variables.get(s)??new Pi}catch{return new Pi}}},lZ=class{constructor(s){J(this,"global");this.global=s??new lk}run(s){return this.evaluate(s,this.global)}evaluateBinaryExpression(s,e){let t=this.evaluate(s.left,e);switch(s.operator.value){case"and":return t.__bool__().value?this.evaluate(s.right,e):t;case"or":return t.__bool__().value?t:this.evaluate(s.right,e)}let n=this.evaluate(s.right,e);switch(s.operator.value){case"==":return new Wt(t.value==n.value);case"!=":return new Wt(t.value!=n.value)}if(t instanceof Pi||n instanceof Pi)throw new Error("Cannot perform operation on undefined values");if(t instanceof Ay||n instanceof Ay)throw new Error("Cannot perform operation on null values");if(t instanceof St&&n instanceof St)switch(s.operator.value){case"+":return new St(t.value+n.value);case"-":return new St(t.value-n.value);case"*":return new St(t.value*n.value);case"/":return new St(t.value/n.value);case"%":return new St(t.value%n.value);case"<":return new Wt(t.value<n.value);case">":return new Wt(t.value>n.value);case">=":return new Wt(t.value>=n.value);case"<=":return new Wt(t.value<=n.value)}else if(t instanceof Bt&&n instanceof Bt)switch(s.operator.value){case"+":return new Bt(t.value.concat(n.value))}else if(n instanceof Bt){let i=n.value.find(r=>r.value===t.value)!==void 0;switch(s.operator.value){case"in":return new Wt(i);case"not in":return new Wt(!i)}}if(t instanceof rt||n instanceof rt)switch(s.operator.value){case"+":return new rt(t.value.toString()+n.value.toString())}if(t instanceof rt&&n instanceof rt)switch(s.operator.value){case"in":return new Wt(n.value.includes(t.value));case"not in":return new Wt(!n.value.includes(t.value))}if(t instanceof rt&&n instanceof Mi)switch(s.operator.value){case"in":return new Wt(n.value.has(t.value));case"not in":return new Wt(!n.value.has(t.value))}throw new SyntaxError(`Unknown operator "${s.operator.value}" between ${t.type} and ${n.type}`)}evaluateFilterExpression(s,e){let t=this.evaluate(s.operand,e);if(s.filter.type==="Identifier"){let n=s.filter;if(t instanceof Bt)switch(n.value){case"list":return t;case"first":return t.value[0];case"last":return t.value[t.value.length-1];case"length":return new St(t.value.length);case"reverse":return new Bt(t.value.reverse());case"sort":return new Bt(t.value.sort((i,r)=>{if(i.type!==r.type)throw new Error(`Cannot compare different types: ${i.type} and ${r.type}`);switch(i.type){case"NumericValue":return i.value-r.value;case"StringValue":return i.value.localeCompare(r.value);default:throw new Error(`Cannot compare type: ${i.type}`)}}));default:throw new Error(`Unknown ArrayValue filter: ${n.value}`)}else if(t instanceof rt)switch(n.value){case"length":return new St(t.value.length);case"upper":return new rt(t.value.toUpperCase());case"lower":return new rt(t.value.toLowerCase());case"title":return new rt(K4(t.value));case"capitalize":return new rt(t.value.charAt(0).toUpperCase()+t.value.slice(1));case"trim":return new rt(t.value.trim());default:throw new Error(`Unknown StringValue filter: ${n.value}`)}else if(t instanceof St)switch(n.value){case"abs":return new St(Math.abs(t.value));default:throw new Error(`Unknown NumericValue filter: ${n.value}`)}else if(t instanceof Mi)switch(n.value){case"items":return new Bt(Array.from(t.value.entries()).map(([i,r])=>new Bt([new rt(i),r])));case"length":return new St(t.value.size);default:throw new Error(`Unknown ObjectValue filter: ${n.value}`)}throw new Error(`Cannot apply filter "${n.value}" to type: ${t.type}`)}else if(s.filter.type==="CallExpression"){let n=s.filter;if(n.callee.type!=="Identifier")throw new Error(`Unknown filter: ${n.callee.type}`);let i=n.callee.value;if(t instanceof Bt){switch(i){case"selectattr":{if(t.value.some(d=>!(d instanceof Mi)))throw new Error("`selectattr` can only be applied to array of objects");if(n.args.some(d=>d.type!=="StringLiteral"))throw new Error("arguments of `selectattr` must be strings");let[r,o,l]=n.args.map(d=>this.evaluate(d,e)),u;if(o){let d=e.tests.get(o.value);if(!d)throw new Error(`Unknown test: ${o.value}`);u=d}else u=(...d)=>d[0].__bool__().value;let h=t.value.filter(d=>{let c=d.value.get(r.value);return c?u(c,l):!1});return new Bt(h)}}throw new Error(`Unknown ArrayValue filter: ${i}`)}else throw new Error(`Cannot apply filter "${i}" to type: ${t.type}`)}throw new Error(`Unknown filter: ${s.filter.type}`)}evaluateTestExpression(s,e){let t=this.evaluate(s.operand,e),n=e.tests.get(s.test.value);if(!n)throw new Error(`Unknown test: ${s.test.value}`);let i=n(t);return new Wt(s.negate?!i:i)}evaluateUnaryExpression(s,e){let t=this.evaluate(s.argument,e);switch(s.operator.value){case"not":return new Wt(!t.value);default:throw new SyntaxError(`Unknown operator: ${s.operator.value}`)}}evalProgram(s,e){return this.evaluateBlock(s.body,e)}evaluateBlock(s,e){let t="";for(let n of s){let i=this.evaluate(n,e);i.type!=="NullValue"&&i.type!=="UndefinedValue"&&(t+=i.value)}return new rt(t)}evaluateIdentifier(s,e){return e.lookupVariable(s.value)}evaluateCallExpression(s,e){let t=[],n=new Map;for(let r of s.args)if(r.type==="KeywordArgumentExpression"){let o=r;n.set(o.key.value,this.evaluate(o.value,e))}else t.push(this.evaluate(r,e));n.size>0&&t.push(new Mi(n));let i=this.evaluate(s.callee,e);if(i.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${i.type}`);return i.value(t,e)}evaluateSliceExpression(s,e,t){if(!(s instanceof Bt||s instanceof rt))throw new Error("Slice object must be an array or string");let n=this.evaluate(e.start,t),i=this.evaluate(e.stop,t),r=this.evaluate(e.step,t);if(!(n instanceof St||n instanceof Pi))throw new Error("Slice start must be numeric or undefined");if(!(i instanceof St||i instanceof Pi))throw new Error("Slice stop must be numeric or undefined");if(!(r instanceof St||r instanceof Pi))throw new Error("Slice step must be numeric or undefined");return s instanceof Bt?new Bt(Y4(s.value,n.value,i.value,r.value)):new rt(Y4(Array.from(s.value),n.value,i.value,r.value).join(""))}evaluateMemberExpression(s,e){let t=this.evaluate(s.object,e),n;if(s.computed){if(s.property.type==="SliceExpression")return this.evaluateSliceExpression(t,s.property,e);n=this.evaluate(s.property,e)}else n=new rt(s.property.value);let i;if(t instanceof Mi){if(!(n instanceof rt))throw new Error(`Cannot access property with non-string: got ${n.type}`);i=t.value.get(n.value)??t.builtins.get(n.value)}else if(t instanceof Bt||t instanceof rt)if(n instanceof St)i=t.value.at(n.value),t instanceof rt&&(i=new rt(t.value.at(n.value)));else if(n instanceof rt)i=t.builtins.get(n.value);else throw new Error(`Cannot access property with non-string/non-number: got ${n.type}`);else{if(!(n instanceof rt))throw new Error(`Cannot access property with non-string: got ${n.type}`);i=t.builtins.get(n.value)}return i instanceof xo?i:new Pi}evaluateSet(s,e){let t=this.evaluate(s.value,e);if(s.assignee.type==="Identifier"){let n=s.assignee.value;e.setVariable(n,t)}else if(s.assignee.type==="MemberExpression"){let n=s.assignee,i=this.evaluate(n.object,e);if(!(i instanceof Mi))throw new Error("Cannot assign to member of non-object");if(n.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");i.value.set(n.property.value,t)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(s.assignee)}`);return new Ay}evaluateIf(s,e){let t=this.evaluate(s.test,e);return this.evaluateBlock(t.__bool__().value?s.body:s.alternate,e)}evaluateFor(s,e){let t=new lk(e),n=this.evaluate(s.iterable,t);if(!(n instanceof Bt))throw new Error(`Expected iterable type in for loop: got ${n.type}`);let i="";for(let r=0;r<n.value.length;++r){let o=new Map([["index",new St(r+1)],["index0",new St(r)],["revindex",new St(n.value.length-r)],["revindex0",new St(n.value.length-r-1)],["first",new Wt(r===0)],["last",new Wt(r===n.value.length-1)],["length",new St(n.value.length)],["previtem",r>0?n.value[r-1]:new Pi],["nextitem",r<n.value.length-1?n.value[r+1]:new Pi]]);t.setVariable("loop",new Mi(o));let l=n.value[r];if(s.loopvar.type==="Identifier")t.setVariable(s.loopvar.value,l);else if(s.loopvar.type==="TupleLiteral"){let h=s.loopvar;if(l.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${l.type}`);let d=l;if(h.value.length!==d.value.length)throw new Error(`Too ${h.value.length>d.value.length?"few":"many"} items to unpack`);for(let c=0;c<h.value.length;++c){if(h.value[c].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${h.value[c].type}`);t.setVariable(h.value[c].value,d.value[c])}}let u=this.evaluateBlock(s.body,t);i+=u.value}return new rt(i)}evaluate(s,e){if(s===void 0)return new Pi;switch(s.type){case"Program":return this.evalProgram(s,e);case"Set":return this.evaluateSet(s,e);case"If":return this.evaluateIf(s,e);case"For":return this.evaluateFor(s,e);case"NumericLiteral":return new St(Number(s.value));case"StringLiteral":return new rt(s.value);case"BooleanLiteral":return new Wt(s.value);case"ArrayLiteral":return new Bt(s.value.map(t=>this.evaluate(t,e)));case"TupleLiteral":return new aZ(s.value.map(t=>this.evaluate(t,e)));case"ObjectLiteral":{let t=new Map;for(let[n,i]of s.value){let r=this.evaluate(n,e);if(!(r instanceof rt))throw new Error(`Object keys must be strings: got ${r.type}`);t.set(r.value,this.evaluate(i,e))}return new Mi(t)}case"Identifier":return this.evaluateIdentifier(s,e);case"CallExpression":return this.evaluateCallExpression(s,e);case"MemberExpression":return this.evaluateMemberExpression(s,e);case"UnaryExpression":return this.evaluateUnaryExpression(s,e);case"BinaryExpression":return this.evaluateBinaryExpression(s,e);case"FilterExpression":return this.evaluateFilterExpression(s,e);case"TestExpression":return this.evaluateTestExpression(s,e);default:throw new SyntaxError(`Unknown node type: ${s.type}`)}}};X4=class{constructor(s){J(this,"parsed");let e=jJ(s,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=rZ(e)}render(s){let e=new lk;e.set("false",!1),e.set("true",!0),e.set("raise_exception",i=>{throw new Error(i)}),e.set("range",oZ);for(let[i,r]of Object.entries(s))e.set(i,r);return new lZ(e).run(this.parsed).value}}});async function Z4(s,e){let t=await Promise.all([br(s,"tokenizer.json",!0,e),br(s,"tokenizer_config.json",!0,e)]);return e.legacy!==null&&(t[1].legacy=e.legacy),t}function cZ(s,e){let t=[],n=0;for(let i of s.matchAll(e)){let r=i[0];n<i.index&&t.push(s.slice(n,i.index)),r.length>0&&t.push(r),n=i.index+r.length}return n<s.length&&t.push(s.slice(n)),t}function bE(s,e=!0){if(s.Regex!==void 0){let t=s.Regex.replace(/\\([#&~])/g,"$1");for(let[n,i]of fZ)t=t.replaceAll(n,i);return new RegExp(t,"gu")}else if(s.String!==void 0){let t=KD(s.String);return new RegExp(e?t:`(${t})`,"gu")}else return console.warn("Unknown pattern type:",s),null}function MR(s){return new Map(Object.entries(s))}function Q4(s){let e=s.dims;switch(e.length){case 1:return s.tolist();case 2:if(e[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return s.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${e.length}.`)}}function NR(s){return s.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function eH(s){return s.replace(/[\u0300-\u036f]/g,"")}function uZ(s){return eH(s.toLowerCase())}function dZ(s,e,t){let n=[],i=0;for(;i<s.length;){if(n.push(s[i]),(t.get(s[i])??e)!==e){++i;continue}for(;i<s.length&&(t.get(s[i])??e)===e;)++i}return n}function hZ(s){return s.match(/\S+/g)||[]}function mZ(s,e,t,n){for(let i of Object.keys(s)){let r=e-s[i].length,o=t(i),l=new Array(r).fill(o);s[i]=n==="right"?ln(s[i],l):ln(l,s[i])}}function yZ(s,e){for(let t of Object.keys(s))s[t].length=e}function OR(s,e,t,n){if(!("language_codes"in s)||!Array.isArray(s.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in s)||!(s.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in s)||typeof s.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");let i=n.src_lang,r=n.tgt_lang;if(!s.language_codes.includes(r))throw new Error(`Target language code "${r}" is not valid. Must be one of: {${s.language_codes.join(", ")}}`);if(i!==void 0){if(!s.language_codes.includes(i))throw new Error(`Source language code "${i}" is not valid. Must be one of: {${s.language_codes.join(", ")}}`);for(let o of s.post_processor.config.single)if("SpecialToken"in o&&s.languageRegex.test(o.SpecialToken.id)){o.SpecialToken.id=s.lang_to_token(i);break}}return n.forced_bos_token_id=s.model.convert_tokens_to_ids([s.lang_to_token(r)])[0],s._call(e,t)}var Iy,fZ,ck,su,uk,dk,tH,pZ,hk,fk,ts,pk,gk,mk,yk,bk,vk,_k,wk,xk,Ek,ws,Sk,Tk,Ak,Ck,Ik,Ga,uE,dE,Dk,hE,kk,ns,Rk,Pk,Mk,Nk,Ok,Fk,Lk,$k,Uk,Bk,fE,Vk,zk,Hk,Gk,jk,Wk,gZ,Ne,qk,Yk,Kk,Xk,Jk,Zk,Qk,eR,tR,nR,sR,iR,rR,oR,pE,aR,gE,lR,cR,uR,lE,mE,dR,hR,fR,pR,gR,mR,yR,bR,vR,_R,wR,nH,cE,bZ,xR,ER,SR,TR,AR,CR,yE,IR,DR,kR,RR,PR,qt,FR=tn(()=>{$a();Qc();Va();Ha();V4();J4();Iy="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",fZ=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"]]),ck=class{constructor(e){this.content=e.content,this.id=e.id,this.single_word=e.single_word??!1,this.lstrip=e.lstrip??!1,this.rstrip=e.rstrip??!1,this.special=e.special??!1,this.normalized=e.normalized??null}},su=class extends _n{constructor(e){super(),this.config=e,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(e,...t){switch(e.type){case"WordPiece":return new uk(e);case"Unigram":return new dk(e,...t);case"BPE":return new hk(e);default:if(e.vocab)return new fk(e,...t);throw new Error(`Unknown TokenizerModel type: ${e.type}`)}}_call(e){let t=this.encode(e);return this.fuse_unk&&(t=dZ(t,this.unk_token_id,this.tokens_to_ids)),t}encode(e){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(e){return e.map(t=>this.tokens_to_ids.get(t)??this.unk_token_id)}convert_ids_to_tokens(e){return e.map(t=>this.vocab[t]??this.unk_token)}},uk=class extends su{constructor(e){super(e),this.tokens_to_ids=MR(e.vocab),this.unk_token_id=this.tokens_to_ids.get(e.unk_token),this.unk_token=e.unk_token,this.max_input_chars_per_word=e.max_input_chars_per_word??100,this.vocab=new Array(this.tokens_to_ids.size);for(let[t,n]of this.tokens_to_ids)this.vocab[n]=t}encode(e){let t=[];for(let n of e){let i=[...n];if(i.length>this.max_input_chars_per_word){t.push(this.unk_token);continue}let r=!1,o=0,l=[];for(;o<i.length;){let u=i.length,h=null;for(;o<u;){let d=i.slice(o,u).join("");if(o>0&&(d=this.config.continuing_subword_prefix+d),this.tokens_to_ids.has(d)){h=d;break}--u}if(h===null){r=!0;break}l.push(h),o=u}r?t.push(this.unk_token):t.push(...l)}return t}},dk=class extends su{constructor(e,t){super(e);let n=e.vocab.length;this.vocab=new Array(n),this.scores=new Array(n);for(let i=0;i<n;++i){let r=e.vocab[i];this.vocab[i]=r[0],this.scores[i]=r[1]}this.unk_token_id=e.unk_id,this.unk_token=this.vocab[e.unk_id],this.tokens_to_ids=new Map(this.vocab.map((i,r)=>[i,r])),this.bosToken=" ",this.bosTokenId=this.tokens_to_ids.get(this.bosToken),this.eosToken=t.eos_token,this.eosTokenId=this.tokens_to_ids.get(this.eosToken),this.unkToken=this.vocab[this.unk_token_id],this.minScore=nE(this.scores)[0],this.unkScore=this.minScore-10,this.scores[this.unk_token_id]=this.unkScore,this.trie=new iE,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(e){let t=e.sentence,n=t.length,i=0;for(;i<n;){let o=!1,l=[];for(let u of this.trie.commonPrefixSearch(t.slice(i))){l.push(u);let h=this.tokens_to_ids.get(u),d=this.scores[h],c=u.length;e.insert(i,c,d,h),!o&&c===1&&(o=!0)}o||e.insert(i,1,this.unkScore,this.unk_token_id),i+=1}}tokenize(e){let t=new oE(e,this.bosTokenId,this.eosTokenId);return this.populateNodes(t),t.tokens()}encode(e){let t=[];for(let n of e){let i=this.tokenize(n);t.push(...i)}return t}},tH=(()=>{let s=[...Array.from({length:94},(i,r)=>r+33),...Array.from({length:12},(i,r)=>r+161),...Array.from({length:82},(i,r)=>r+174)],e=s.slice(),t=0;for(let i=0;i<256;++i)s.includes(i)||(s.push(i),e.push(256+t),t+=1);let n=e.map(i=>String.fromCharCode(i));return Object.fromEntries(s.map((i,r)=>[i,n[r]]))})(),pZ=p4(tH),hk=class extends su{constructor(e){super(e),this.BPE_SPLIT_TOKEN=" ",this.tokens_to_ids=MR(e.vocab),this.unk_token_id=this.tokens_to_ids.get(e.unk_token),this.unk_token=e.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(let[t,n]of this.tokens_to_ids)this.vocab[n]=t;this.bpe_ranks=new Map(e.merges.map((t,n)=>[t,n])),this.merges=e.merges.map(t=>t.split(this.BPE_SPLIT_TOKEN)),this.end_of_word_suffix=e.end_of_word_suffix,this.continuing_subword_suffix=e.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.cache=new Map}bpe(e){if(e.length===0)return[];let t=this.cache.get(e);if(t!==void 0)return t;let n=Array.from(e);this.end_of_word_suffix&&(n[n.length-1]+=this.end_of_word_suffix);let i=[];if(n.length>1){let r=new sE((u,h)=>u.score<h.score),o={token:n[0],bias:0,prev:null,next:null},l=o;for(let u=1;u<n.length;++u){let h={bias:u/n.length,token:n[u],prev:l,next:null};l.next=h,this._add_node(r,l),l=h}for(;!r.isEmpty();){let u=r.pop();if(u.deleted||!u.next||u.next.deleted)continue;if(u.deleted=!0,u.next.deleted=!0,u.prev){let d={...u.prev};u.prev.deleted=!0,u.prev=d,d.prev?d.prev.next=d:o=d}let h={token:u.token+u.next.token,bias:u.bias,prev:u.prev,next:u.next.next};h.prev?(h.prev.next=h,this._add_node(r,h.prev)):o=h,h.next&&(h.next.prev=h,this._add_node(r,h))}for(let u=o;u!==null;u=u.next)i.push(u.token)}else i=n;if(this.continuing_subword_suffix)for(let r=0;r<i.length-1;++r)i[r]+=this.continuing_subword_suffix;return this.cache.set(e,i),i}_add_node(e,t){let n=this.bpe_ranks.get(t.token+this.BPE_SPLIT_TOKEN+t.next.token);n!==void 0&&(t.score=n+t.bias,e.push(t))}encode(e){let t=[];for(let n of e){if(this.ignore_merges&&this.tokens_to_ids.has(n)){t.push(n);continue}let i=this.bpe(n);for(let r of i)this.tokens_to_ids.has(r)?t.push(r):this.byte_fallback?t.push(...Array.from(this.text_encoder.encode(r)).map(o=>`<0x${o.toString(16).toUpperCase().padStart(2,"0")}>`)):t.push(this.unk_token)}return t}},fk=class extends su{constructor(e,t){super(e),this.tokens_to_ids=MR(t.target_lang?e.vocab[t.target_lang]:e.vocab),this.bos_token=t.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=t.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=t.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=t.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(let[n,i]of this.tokens_to_ids)this.vocab[i]=n}encode(e){return e}},ts=class extends _n{constructor(e){super(),this.config=e}static fromConfig(e){if(e===null)return null;switch(e.type){case"BertNormalizer":return new Ek(e);case"Precompiled":return new zk(e);case"Sequence":return new xk(e);case"Replace":return new pk(e);case"NFC":return new gk(e);case"NFKC":return new mk(e);case"NFKD":return new yk(e);case"Strip":return new bk(e);case"StripAccents":return new vk(e);case"Lowercase":return new _k(e);case"Prepend":return new wk(e);default:throw new Error(`Unknown Normalizer type: ${e.type}`)}}normalize(e){throw Error("normalize should be implemented in subclass.")}_call(e){return this.normalize(e)}},pk=class extends ts{normalize(e){let t=bE(this.config.pattern);return t===null?e:e.replaceAll(t,this.config.content)}},gk=class extends ts{normalize(e){return e=e.normalize("NFC"),e}},mk=class extends ts{normalize(e){return e=e.normalize("NFKC"),e}},yk=class extends ts{normalize(e){return e=e.normalize("NFKD"),e}},bk=class extends ts{normalize(e){return this.config.strip_left&&this.config.strip_right?e=e.trim():(this.config.strip_left&&(e=e.trimStart()),this.config.strip_right&&(e=e.trimEnd())),e}},vk=class extends ts{normalize(e){return e=eH(e),e}},_k=class extends ts{normalize(e){return e=e.toLowerCase(),e}},wk=class extends ts{normalize(e){return e=this.config.prepend+e,e}},xk=class extends ts{constructor(e){super(e),this.normalizers=e.normalizers.map(t=>ts.fromConfig(t))}normalize(e){return this.normalizers.reduce((t,n)=>n.normalize(t),e)}},Ek=class extends ts{_tokenize_chinese_chars(e){let t=[];for(let n=0;n<e.length;++n){let i=e[n],r=i.charCodeAt(0);this._is_chinese_char(r)?(t.push(" "),t.push(i),t.push(" ")):t.push(i)}return t.join("")}_is_chinese_char(e){return e>=19968&&e<=40959||e>=13312&&e<=19903||e>=131072&&e<=173791||e>=173824&&e<=177983||e>=177984&&e<=178207||e>=178208&&e<=183983||e>=63744&&e<=64255||e>=194560&&e<=195103}stripAccents(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}_is_control(e){switch(e){case"	":case`
`:case"\r":return!1;default:return/^\p{Cc}|\p{Cf}|\p{Co}|\p{Cs}$/u.test(e)}}_clean_text(e){let t=[];for(let n of e){let i=n.charCodeAt(0);i===0||i===65533||this._is_control(n)||(/^\s$/.test(n)?t.push(" "):t.push(n))}return t.join("")}normalize(e){return this.config.clean_text&&(e=this._clean_text(e)),this.config.handle_chinese_chars&&(e=this._tokenize_chinese_chars(e)),this.config.lowercase?(e=e.toLowerCase(),this.config.strip_accents!==!1&&(e=this.stripAccents(e))):this.config.strip_accents&&(e=this.stripAccents(e)),e}},ws=class extends _n{static fromConfig(e){if(e===null)return null;switch(e.type){case"BertPreTokenizer":return new Sk(e);case"Sequence":return new Hk(e);case"Whitespace":return new Gk(e);case"WhitespaceSplit":return new jk(e);case"Metaspace":return new fE(e);case"ByteLevel":return new Tk(e);case"Split":return new Ak(e);case"Punctuation":return new Ck(e);case"Digits":return new Ik(e);case"Replace":return new Wk(e);default:throw new Error(`Unknown PreTokenizer type: ${e.type}`)}}pre_tokenize_text(e,t){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(e,t){return(Array.isArray(e)?e.map(n=>this.pre_tokenize_text(n,t)):this.pre_tokenize_text(e,t)).flat()}_call(e,t){return this.pre_tokenize(e,t)}},Sk=class extends ws{constructor(e){super(),this.pattern=new RegExp(`[^\\s${Iy}]+|[${Iy}]`,"gu")}pre_tokenize_text(e,t){return e.trim().match(this.pattern)||[]}},Tk=class extends ws{constructor(e){super(),this.config=e,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu,this.byte_encoder=tH,this.text_encoder=new TextEncoder}pre_tokenize_text(e,t){return this.add_prefix_space&&!e.startsWith(" ")&&(e=" "+e),(this.use_regex?e.match(this.pattern)||[]:[e]).map(i=>Array.from(this.text_encoder.encode(i),r=>this.byte_encoder[r]).join(""))}},Ak=class extends ws{constructor(e){super(),this.config=e,this.pattern=bE(this.config.pattern,this.config.invert)}pre_tokenize_text(e,t){return this.pattern===null?[]:this.config.invert?e.match(this.pattern)||[]:cZ(e,this.pattern)}},Ck=class extends ws{constructor(e){super(),this.config=e,this.pattern=new RegExp(`[^${Iy}]+|[${Iy}]+`,"gu")}pre_tokenize_text(e,t){return e.match(this.pattern)||[]}},Ik=class extends ws{constructor(e){super(),this.config=e;let t=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(t,"gu")}pre_tokenize_text(e,t){return e.match(this.pattern)||[]}},Ga=class extends _n{constructor(e){super(),this.config=e}static fromConfig(e){if(e===null)return null;switch(e.type){case"TemplateProcessing":return new Dk(e);case"ByteLevel":return new hE(e);case"RobertaProcessing":return new dE(e);case"BertProcessing":return new uE(e);case"Sequence":return new kk(e);default:throw new Error(`Unknown PostProcessor type: ${e.type}`)}}post_process(e,...t){throw Error("post_process should be implemented in subclass.")}_call(e,...t){return this.post_process(e,...t)}},uE=class extends Ga{constructor(e){super(e),this.cls=e.cls[0],this.sep=e.sep[0]}post_process(e,t=null,{add_special_tokens:n=!0}={}){n&&(e=ln([this.cls],e,[this.sep]));let i=new Array(e.length).fill(0);if(t!==null){let r=n&&this instanceof dE?[this.sep]:[],o=n?[this.sep]:[];e=ln(e,r,t,o),i=ln(i,new Array(t.length+r.length+o.length).fill(1))}return{tokens:e,token_type_ids:i}}},dE=class extends uE{},Dk=class extends Ga{constructor(e){super(e),this.single=e.single,this.pair=e.pair}post_process(e,t=null,{add_special_tokens:n=!0}={}){let i=t===null?this.single:this.pair,r=[],o=[];for(let l of i)"SpecialToken"in l?n&&(r.push(l.SpecialToken.id),o.push(l.SpecialToken.type_id)):"Sequence"in l&&(l.Sequence.id==="A"?(r=ln(r,e),o=ln(o,new Array(e.length).fill(l.Sequence.type_id))):l.Sequence.id==="B"&&(r=ln(r,t),o=ln(o,new Array(t.length).fill(l.Sequence.type_id))));return{tokens:r,token_type_ids:o}}},hE=class extends Ga{post_process(e,t=null){return t&&(e=ln(e,t)),{tokens:e}}},kk=class extends Ga{constructor(e){super(e),this.processors=e.processors.map(t=>Ga.fromConfig(t))}post_process(e,t=null,n={}){let i;for(let r of this.processors)if(r instanceof hE)e=r.post_process(e).tokens,t&&(t=r.post_process(t).tokens);else{let o=r.post_process(e,t,n);e=o.tokens,i=o.token_type_ids}return{tokens:e,token_type_ids:i}}},ns=class extends _n{constructor(e){super(),this.config=e,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=e.trim_offsets}static fromConfig(e){if(e===null)return null;switch(e.type){case"WordPiece":return new Ok(e);case"Metaspace":return new Vk(e);case"ByteLevel":return new Fk(e);case"Replace":return new Rk(e);case"ByteFallback":return new Pk(e);case"Fuse":return new Mk(e);case"Strip":return new Nk(e);case"Sequence":return new $k(e);case"CTC":return new Lk(e);case"BPEDecoder":return new Uk(e);default:throw new Error(`Unknown Decoder type: ${e.type}`)}}_call(e){return this.decode(e)}decode(e){return this.decode_chain(e).join("")}decode_chain(e){throw Error("`decode_chain` should be implemented in subclass.")}},Rk=class extends ns{decode_chain(e){let t=bE(this.config.pattern);return t===null?e:e.map(n=>n.replaceAll(t,this.config.content))}},Pk=class extends ns{constructor(e){super(e),this.text_decoder=new TextDecoder}decode_chain(e){let t=[],n=[];for(let i of e){let r=null;if(i.length===6&&i.startsWith("<0x")&&i.endsWith(">")){let o=parseInt(i.slice(3,5),16);isNaN(o)||(r=o)}if(r!==null)n.push(r);else{if(n.length>0){let o=this.text_decoder.decode(Uint8Array.from(n));t.push(o),n=[]}t.push(i)}}if(n.length>0){let i=this.text_decoder.decode(Uint8Array.from(n));t.push(i),n=[]}return t}},Mk=class extends ns{decode_chain(e){return[e.join("")]}},Nk=class extends ns{constructor(e){super(e),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(e){return e.map(t=>{let n=0;for(let r=0;r<this.start&&t[r]===this.content;++r){n=r+1;continue}let i=t.length;for(let r=0;r<this.stop;++r){let o=t.length-r-1;if(t[o]===this.content){i=o;continue}else break}return t.slice(n,i)})}},Ok=class extends ns{constructor(e){super(e),this.cleanup=e.cleanup}decode_chain(e){return e.map((t,n)=>(n!==0&&(t.startsWith(this.config.prefix)?t=t.replace(this.config.prefix,""):t=" "+t),this.cleanup&&(t=NR(t)),t))}},Fk=class extends ns{constructor(e){super(e),this.byte_decoder=pZ,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(e){let t=e.join(""),n=new Uint8Array([...t].map(r=>this.byte_decoder[r]));return this.text_decoder.decode(n)}decode_chain(e){let t=[],n=[];for(let i of e)this.added_tokens.find(r=>r.content===i)!==void 0?(n.length>0&&(t.push(this.convert_tokens_to_string(n)),n=[]),t.push(i)):n.push(i);return n.length>0&&t.push(this.convert_tokens_to_string(n)),t}},Lk=class extends ns{constructor(e){super(e),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(e){if(e.length===0)return"";let t=[e[0]];for(let r=1;r<e.length;++r)e[r]!==t.at(-1)&&t.push(e[r]);let i=t.filter(r=>r!==this.pad_token).join("");return this.cleanup&&(i=NR(i).replaceAll(this.word_delimiter_token," ").trim()),i}decode_chain(e){return[this.convert_tokens_to_string(e)]}},$k=class extends ns{constructor(e){super(e),this.decoders=e.decoders.map(t=>ns.fromConfig(t))}decode_chain(e){return this.decoders.reduce((t,n)=>n.decode_chain(t),e)}},Uk=class extends ns{constructor(e){super(e),this.suffix=this.config.suffix}decode_chain(e){return e.map((t,n)=>t.replaceAll(this.suffix,n===e.length-1?"":" "))}},Bk=class extends ns{decode_chain(e){let t="";for(let n=1;n<e.length;n+=2)t+=e[n];return[t]}},fE=class extends ws{constructor(e){super(),this.addPrefixSpace=e.add_prefix_space,this.replacement=e.replacement,this.strRep=e.str_rep||this.replacement,this.prepend_scheme=e.prepend_scheme??"always"}pre_tokenize_text(e,{section_index:t=void 0}={}){let n=e.replaceAll(" ",this.strRep);return this.addPrefixSpace&&!n.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&t===0)&&(n=this.strRep+n),[n]}},Vk=class extends ns{constructor(e){super(e),this.addPrefixSpace=e.add_prefix_space,this.replacement=e.replacement}decode_chain(e){let t=[];for(let n=0;n<e.length;++n){let i=e[n].replaceAll(this.replacement," ");this.addPrefixSpace&&n==0&&i.startsWith(" ")&&(i=i.substring(1)),t.push(i)}return t}},zk=class extends ts{constructor(e){super(e),this.charsmap=e.precompiled_charsmap}normalize(e){return e=e.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),e=e.replace(/[\u0009\u000A\u000C\u000D\u1680\u200B\u200C\u200E\u200F\u2028\u2029\u2581\uFEFF\uFFFD]/gm," "),e.includes("\uFF5E")?e=e.split("\uFF5E").map(n=>n.normalize("NFKC")).join("\uFF5E"):e=e.normalize("NFKC"),e}},Hk=class extends ws{constructor(e){super(),this.tokenizers=e.pretokenizers.map(t=>ws.fromConfig(t))}pre_tokenize_text(e,t){return this.tokenizers.reduce((n,i)=>i.pre_tokenize(n,t),[e])}},Gk=class extends ws{constructor(e){super()}pre_tokenize_text(e,t){return e.match(/\w+|[^\w\s]+/g)||[]}},jk=class extends ws{constructor(e){super()}pre_tokenize_text(e,t){return hZ(e)}},Wk=class extends ws{constructor(e){super(),this.config=e,this.pattern=bE(this.config.pattern),this.content=this.config.content}pre_tokenize_text(e,t){return this.pattern===null?[e]:[e.replaceAll(this.pattern,this.config.content)]}},gZ=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];Ne=class extends _n{constructor(t,n){super();J(this,"return_token_type_ids",!1);J(this,"_default_chat_template",`{% for message in messages %}{{'<|im_start|>' + message['role'] + '
' + message['content'] + '<|im_end|>' + '
'}}{% endfor %}{% if add_generation_prompt %}{{ '<|im_start|>assistant
' }}{% endif %}`);this._tokenizer_config=n,this.normalizer=ts.fromConfig(t.normalizer),this.pre_tokenizer=ws.fromConfig(t.pre_tokenizer),this.model=su.fromConfig(t.model,n),this.post_processor=Ga.fromConfig(t.post_processor),this.decoder=ns.fromConfig(t.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(let i of t.added_tokens){let r=new ck(i);this.added_tokens.push(r),this.model.tokens_to_ids.set(r.content,r.id),this.model.vocab[r.id]=r.content,r.special&&(this.special_tokens.push(r.content),this.all_special_ids.push(r.id))}if(this.additional_special_tokens=n.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_regex=this.added_tokens.length>0?new RegExp(this.added_tokens.map(i=>`${i.lstrip?"\\s*":""}(${KD(i.content)})${i.rstrip?"\\s*":""}`).join("|")):null,this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.model_max_length=n.model_max_length,this.remove_space=n.remove_space,this.clean_up_tokenization_spaces=n.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=n.do_lowercase_and_remove_accent??!1,this.padding_side="right",this.legacy=!1,this.chat_template=n.chat_template??null,Array.isArray(this.chat_template)){let i=Object.create(null);for(let{name:r,template:o}of this.chat_template){if(typeof r!="string"||typeof o!="string")throw new Error('Chat template must be a list of objects with "name" and "template" properties');i[r]=o}this.chat_template=i}this._compiled_template_cache=new Map}getToken(...t){for(let n of t){let i=this._tokenizer_config[n];if(i)if(typeof i=="object"){if(i.__type==="AddedToken")return i.content;throw Error(`Unknown token: ${i}`)}else return i}return null}static async from_pretrained(t,{progress_callback:n=null,config:i=null,cache_dir:r=null,local_files_only:o=!1,revision:l="main",legacy:u=null}={}){let h=await Z4(t,{progress_callback:n,config:i,cache_dir:r,local_files_only:o,revision:l,legacy:u});return new this(...h)}_call(t,{text_pair:n=null,add_special_tokens:i=!0,padding:r=!1,truncation:o=null,max_length:l=null,return_tensor:u=!0,return_token_type_ids:h=null}={}){let d=Array.isArray(t),c;if(d){if(t.length===0)throw Error("text array must be non-empty");if(n!==null){if(Array.isArray(n)){if(t.length!==n.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");c=t.map((f,p)=>this._encode_plus(f,n[p],{add_special_tokens:i,return_token_type_ids:h}))}else c=t.map(f=>this._encode_plus(f,null,{add_special_tokens:i,return_token_type_ids:h}))}else{if(t==null)throw Error("text may not be null or undefined");if(Array.isArray(n))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");c=[this._encode_plus(t,n,{add_special_tokens:i,return_token_type_ids:h})]}if(l===null?r==="max_length"?l=this.model_max_length:l=Mn(c.map(f=>f.input_ids.length))[0]:o||console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation=true` to explicitly truncate examples to max length."),l=Math.min(l,this.model_max_length),r||o)for(let f=0;f<c.length;++f)c[f].input_ids.length!==l&&(c[f].input_ids.length>l?o&&yZ(c[f],l):r&&mZ(c[f],l,p=>p==="input_ids"?this.pad_token_id:0,this.padding_side));let a={};if(u){if(!(r&&o)&&c.some(p=>{for(let g of Object.keys(p))if(p[g].length!==c[0][g]?.length)return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");let f=[c.length,c[0].input_ids.length];for(let p of Object.keys(c[0]))a[p]=new pe("int64",BigInt64Array.from(c.flatMap(g=>g[p]).map(BigInt)),f)}else{for(let f of Object.keys(c[0]))a[f]=c.map(p=>p[f]);if(!d)for(let f of Object.keys(a))a[f]=a[f][0]}return a}_encode_text(t){return t===null?null:(this.added_tokens_regex?t.split(this.added_tokens_regex).filter(r=>r):[t]).map((r,o)=>{if(this.added_tokens.find(u=>u.content===r)!==void 0)return r;{if(this.remove_space===!0&&(r=r.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(r=uZ(r)),this.normalizer!==null&&(r=this.normalizer(r)),r.length===0)return[];let u=this.pre_tokenizer!==null?this.pre_tokenizer(r,{section_index:o}):[r];return this.model(u)}}).flat()}_encode_plus(t,n=null,{add_special_tokens:i=!0,return_token_type_ids:r=null}={}){let o=this._encode_text(t),l=this._encode_text(n),u=this.post_processor?this.post_processor(o,l,{add_special_tokens:i}):{tokens:ln(o??[],l??[])},h=this.model.convert_tokens_to_ids(u.tokens),d={input_ids:h,attention_mask:new Array(h.length).fill(1)};return(r??this.return_token_type_ids)&&u.token_type_ids&&(d.token_type_ids=u.token_type_ids),d}encode(t,n=null,{add_special_tokens:i=!0,return_token_type_ids:r=null}={}){let{input_ids:o}=this._encode_plus(t,n,{add_special_tokens:i,return_token_type_ids:r});return o}batch_decode(t,n={}){return t instanceof pe&&(t=t.tolist()),t.map(i=>this.decode(i,n))}decode(t,n={}){if(t instanceof pe&&(t=Q4(t)),!Array.isArray(t)||t.length===0||!jx(t[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(t,n)}decode_single(t,{skip_special_tokens:n=!1,clean_up_tokenization_spaces:i=null}){let r=this.model.convert_ids_to_tokens(t);n&&(r=r.filter(l=>!this.special_tokens.includes(l)));let o=this.decoder?this.decoder(r):r.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(o=o.replaceAll(this.decoder.end_of_word_suffix," "),n&&(o=o.trim())),(i??this.clean_up_tokenization_spaces)&&(o=NR(o)),o}get default_chat_template(){return this._warned_about_chat_template||(console.warn("No chat template is defined for this tokenizer - using a default chat template that implements the ChatML format. If the default is not appropriate for your model, please set `tokenizer.chat_template` to an appropriate template. See https://huggingface.co/docs/transformers/main/chat_templating for more information."),this._warned_about_chat_template=!0),this._default_chat_template}apply_chat_template(t,{chat_template:n=null,add_generation_prompt:i=!1,tokenize:r=!0,padding:o=!1,truncation:l=!1,max_length:u=null,return_tensor:h=!0,tokenizer_kwargs:d={},...c}={}){if(this.chat_template&&typeof this.chat_template=="object"||this.chat_template===null&&this.default_chat_template&&typeof this.default_chat_template=="object"){let g=this.chat_template??this.default_chat_template;if(n!==null&&Object.hasOwn(g,n))n=g[n];else if(n===null&&"default"in g)n=g.default;else if(n===null)throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(g).sort()}.`)}else n??(n=this.chat_template??this.default_chat_template);if(typeof n!="string")throw Error(`chat_template must be a string, but got ${typeof n}`);let a=this._compiled_template_cache.get(n);a===void 0&&(a=new X4(n),this._compiled_template_cache.set(n,a));let f=Object.create(null);for(let g of gZ){let m=this.getToken(g);m&&(f[g]=m)}let p=a.render({messages:t,add_generation_prompt:i,...f,...c});return r?this._call(p,{add_special_tokens:!1,padding:o,truncation:l,max_length:u,return_tensor:h,...d}).input_ids:p}},qk=class extends Ne{constructor(){super(...arguments);J(this,"return_token_type_ids",!0)}},Yk=class extends Ne{constructor(){super(...arguments);J(this,"return_token_type_ids",!0)}},Kk=class extends Ne{constructor(){super(...arguments);J(this,"return_token_type_ids",!0)}},Xk=class extends Ne{constructor(){super(...arguments);J(this,"return_token_type_ids",!0)}},Jk=class extends Ne{constructor(){super(...arguments);J(this,"return_token_type_ids",!0)}},Zk=class extends Ne{constructor(){super(...arguments);J(this,"return_token_type_ids",!0)}},Qk=class extends Ne{constructor(){super(...arguments);J(this,"return_token_type_ids",!0)}},eR=class extends Ne{constructor(){super(...arguments);J(this,"return_token_type_ids",!0)}},tR=class extends Ne{constructor(){super(...arguments);J(this,"return_token_type_ids",!0)}},nR=class extends Ne{},sR=class extends Ne{},iR=class extends Ne{constructor(t,n){super(t,n);J(this,"return_token_type_ids",!0);console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}},rR=class extends Ne{constructor(){super(...arguments);J(this,"return_token_type_ids",!0)}},oR=class extends Ne{},pE=class extends Ne{constructor(){super(...arguments);J(this,"_default_chat_template",'{% for message in messages %}" "{{ message.content }}{{ eos_token }}" "{% endfor %}')}},aR=class extends Ne{},gE=class extends Ne{constructor(e,t){super(e,t),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(n=>this.languageRegex.test(n)),this.lang_to_token=n=>n}_build_translation_inputs(e,t,n){return OR(this,e,t,n)}},lR=class extends gE{},cR=class extends Ne{},uR=class extends pE{constructor(e,t){let n=".,!?\u2026\u3002\uFF0C\u3001\u0964\u06D4\u060C",i=e.pre_tokenizer?.pretokenizers[0]?.pattern;i&&i.Regex===` ?[^(\\s|[${n}])]+`&&(i.Regex=` ?[^\\s${n}]+`),super(e,t)}},lE="\u2581",mE=class extends Ne{constructor(t,n){super(t,n);J(this,"_default_chat_template",`{% if messages[0]['role'] == 'system' %}{% set loop_messages = messages[1:] %}{% set system_message = messages[0]['content'] %}{% elif USE_DEFAULT_PROMPT == true and not '<<SYS>>' in messages[0]['content'] %}{% set loop_messages = messages %}{% set system_message = 'DEFAULT_SYSTEM_MESSAGE' %}{% else %}{% set loop_messages = messages %}{% set system_message = false %}{% endif %}{% for message in loop_messages %}{% if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}{{ raise_exception('Conversation roles must alternate user/assistant/user/assistant/...') }}{% endif %}{% if loop.index0 == 0 and system_message != false %}{% set content = '<<SYS>>
' + system_message + '
<</SYS>>

' + message['content'] %}{% else %}{% set content = message['content'] %}{% endif %}{% if message['role'] == 'user' %}{{ bos_token + '[INST] ' + content.strip() + ' [/INST]' }}{% elif message['role'] == 'system' %}{{ '<<SYS>>
' + content.strip() + '
<</SYS>>

' }}{% elif message['role'] == 'assistant' %}{{ ' '  + content.strip() + ' ' + eos_token }}{% endif %}{% endfor %}`);J(this,"DEFAULT_SYSTEM_PROMPT",`You are a helpful, respectful and honest assistant. Always answer as helpfully as possible, while being safe. Your answers should not include any harmful, unethical, racist, sexist, toxic, dangerous, or illegal content. Please ensure that your responses are socially unbiased and positive in nature.

If a question does not make any sense, or is not factually coherent, explain why instead of answering something not correct. If you don't know the answer to a question, please don't share false information.`);this.use_default_system_prompt=n.use_default_system_prompt??!1,this.legacy=n.legacy??!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new fE({replacement:lE,add_prefix_space:!0,prepend_scheme:"first"}))}_encode_text(t){if(t===null)return null;if(this.legacy||t.length===0)return super._encode_text(t);let n=super._encode_text(lE+t.replaceAll(lE," "));return n.length>1&&n[0]===lE&&this.special_tokens.includes(n[1])&&(n=n.slice(1)),n}get default_chat_template(){return super.default_chat_template.replaceAll("USE_DEFAULT_PROMPT",this.use_default_system_prompt?"true":"false").replaceAll("DEFAULT_SYSTEM_MESSAGE",this.DEFAULT_SYSTEM_PROMPT.replaceAll(`
`,"\\n").replaceAll("'","\\'"))}},dR=class extends mE{},hR=class extends Ne{},fR=class extends Ne{},pR=class extends Ne{},gR=class extends Ne{},mR=class extends Ne{},yR=class extends Ne{},bR=class extends Ne{constructor(){super(...arguments);J(this,"_default_chat_template",`{% if messages[0]['role'] == 'system' %}{{ raise_exception('System role not supported') }}{% endif %}{% for message in messages %}{% if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}{{ raise_exception('Conversation roles must alternate user/assistant/user/assistant/...') }}{% endif %}{% if (message['role'] == 'assistant') %}{% set role = 'model' %}{% else %}{% set role = message['role'] %}{% endif %}{{ '<start_of_turn>' + role + '
' + message['content'] | trim + '<end_of_turn>
' }}{% endfor %}{% if add_generation_prompt %}{{'<start_of_turn>model
'}}{% endif %}`)}},vR=class extends Ne{};_R=class extends Ne{constructor(e,t){super(e,t),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(n=>this.languageRegex.test(n)),this.lang_to_token=n=>n}_build_translation_inputs(e,t,n){return OR(this,e,t,n)}},wR=class extends Ne{constructor(e,t){super(e,t),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(n=>this.languageRegex.test(n)).map(n=>n.slice(2,-2)),this.lang_to_token=n=>`__${n}__`}_build_translation_inputs(e,t,n){return OR(this,e,t,n)}},nH=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],cE=new Map(nH),bZ=new Map([...nH.map(([s,e])=>[e,s]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]),xR=class extends Ne{constructor(){super(...arguments);J(this,"_default_chat_template",'{% for message in messages %}" "{{ message.content }}{{ eos_token }}" "{% endfor %}')}_decode_asr(t,{return_timestamps:n=!1,return_language:i=!1,time_precision:r=null,force_full_sequences:o=!0}={}){if(r===null)throw Error("Must specify time_precision");let l=null,u=n==="word";function h(){return{language:l,timestamp:[null,null],text:""}}let d=[],c=h(),a=0,f=this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1,p=[],g=[],m=!1,y=null,_=new Set(this.all_special_ids);for(let S of t){let T=S.tokens,C=u?S.token_timestamps:null,I=null,A=f;if("stride"in S){let[H,z,B]=S.stride;if(a-=z,y=H-B,z&&(A=z/r+f),B)for(let V=T.length-1;V>=0;--V){let M=T[V];if(M>=f){if(I!==null&&(M-f)*r<y)break;I=M}}}let P=[],F=[];for(let H=0;H<T.length;++H){let z=T[H];if(_.has(z)){let B=this.decode([z]),V=cE.get(B.slice(2,-2));if(V!==void 0){if(l!==null&&V!==l&&!n){p.push(P);let M=this.findLongestCommonSequence(p)[0],$=this.decode(M);c.text=$,d.push(c),p=[],P=[],c=h()}l=c.language=V}}else if(z>=f){let B=(z-f)*r+a,V=eu(B,2);if(I!==null&&z>=I)m=!0;else if(m||p.length>0&&z<A)m=!1;else if(c.timestamp[0]===null)c.timestamp[0]=V;else if(V!==c.timestamp[0]){c.timestamp[1]=V,p.push(P),u&&g.push(F);let[M,$]=this.findLongestCommonSequence(p,g),oe=this.decode(M);c.text=oe,u&&(c.words=this.collateWordTimestamps(M,$,l)),d.push(c),p=[],P=[],g=[],F=[],c=h()}}else if(P.push(z),u){let B=eu(C[H]+a,2),V;H+1<C.length?V=eu(C[H+1]+a,2):V=null,F.push([B,V])}}if("stride"in S){let[H,z,B]=S.stride;a+=H-B}P.length>0?(p.push(P),u&&g.push(F)):p.every(H=>H.length===0)&&(c=h(),p=[],P=[],g=[],F=[])}if(p.length>0){if(o&&n)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");let[S,T]=this.findLongestCommonSequence(p,g),C=this.decode(S);c.text=C,u&&(c.words=this.collateWordTimestamps(S,T,l)),d.push(c)}let x=Object.create(null),E=d.map(S=>S.text).join("");if(n||i){for(let S=0;S<d.length;++S){let T=d[S];n||delete T.timestamp,i||delete T.language}if(u){let S=[];for(let T of d)for(let C of T.words)S.push(C);x={chunks:S}}else x={chunks:d}}return[E,x]}findLongestCommonSequence(t,n=null){let i=t[0],r=i.length,o=[],l=Array.isArray(n)&&n.length>0,u=l?[]:null,h=l?n[0]:null;for(let d=1;d<t.length;++d){let c=t[d],a=0,f=[r,r,0,0],p=c.length;for(let S=1;S<r+p;++S){let T=S/1e4,C=Math.max(0,r-S),I=Math.min(r,r+p-S),A=i.slice(C,I),P=Math.max(0,S-r),F=Math.min(p,S),H=c.slice(P,F);if(A.length!==H.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let z=A.filter((V,M)=>V===H[M]).length,B=z/S+T;z>1&&B>a&&(a=B,f=[C,I,P,F])}let[g,m,y,_]=f,x=Math.floor((m+g)/2),E=Math.floor((_+y)/2);o.push(...i.slice(0,x)),i=c.slice(E),r=i.length,l&&(u.push(...h.slice(0,x)),h=n[d].slice(E))}return o.push(...i),l?(u.push(...h),[o,u]):[o,[]]}collateWordTimestamps(t,n,i){let[r,o,l]=this.combineTokensIntoWords(t,i),u=[];for(let h=0;h<r.length;++h){let d=l[h];u.push({text:r[h],timestamp:[n[d.at(0)][0],n[d.at(-1)][1]]})}return u}combineTokensIntoWords(t,n,i=`"'\u201C\xA1\xBF([{-`,r=`"'.\u3002,\uFF0C!\uFF01?\uFF1F:\uFF1A\u201D)]}\u3001`){n=n??"english";let o,l,u;return["chinese","japanese","thai","lao","myanmar"].includes(n)?[o,l,u]=this.splitTokensOnUnicode(t):[o,l,u]=this.splitTokensOnSpaces(t),this.mergePunctuations(o,l,u,i,r)}decode(t,n){let i;return n&&n.decode_with_timestamps?(t instanceof pe&&(t=Q4(t)),i=this.decodeWithTimestamps(t,n)):i=super.decode(t,n),i}decodeWithTimestamps(t,n){let i=n?.time_precision??.02,r=Array.from(this.all_special_ids).at(-1)+1,o=[[]];for(let l of t)if(l>=r){let u=eu((l-r)*i,2);o.push(`<|${u}|>`),o.push([])}else o[o.length-1].push(l);return o=o.map(l=>typeof l=="string"?l:super.decode(l,n)),o.join("")}splitTokensOnUnicode(t){let n=this.decode(t,{decode_with_timestamps:!0}),i="\uFFFD",r=[],o=[],l=[],u=[],h=[],d=0;for(let c=0;c<t.length;++c){let a=t[c];u.push(a),h.push(c);let f=this.decode(u,{decode_with_timestamps:!0});(!f.includes(i)||n[d+f.indexOf(i)]===i)&&(r.push(f),o.push(u),l.push(h),u=[],h=[],d+=f.length)}return[r,o,l]}splitTokensOnSpaces(t){let[n,i,r]=this.splitTokensOnUnicode(t),o=[],l=[],u=[],h=new RegExp(`^[${Iy}]$`,"gu");for(let d=0;d<n.length;++d){let c=n[d],a=i[d],f=r[d],p=a[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),g=c.startsWith(" "),m=c.trim(),y=h.test(m);if(p||g||y||o.length===0)o.push(c),l.push(a),u.push(f);else{let _=o.length-1;o[_]+=c,l[_].push(...a),u[_].push(...f)}}return[o,l,u]}mergePunctuations(t,n,i,r,o){let l=structuredClone(t),u=structuredClone(n),h=structuredClone(i),d=l.length-2,c=l.length-1;for(;d>=0;)l[d].startsWith(" ")&&r.includes(l[d].trim())?(l[c]=l[d]+l[c],u[c]=ln(u[d],u[c]),h[c]=ln(h[d],h[c]),l[d]="",u[d]=[],h[d]=[]):c=d,--d;for(d=0,c=1;c<l.length;)!l[d].endsWith(" ")&&o.includes(l[c])?(l[d]+=l[c],u[d]=ln(u[d],u[c]),h[d]=ln(h[d],h[c]),l[c]="",u[c]=[],h[c]=[]):d=c,++c;return[l.filter(a=>a),u.filter(a=>a.length>0),h.filter(a=>a.length>0)]}get_decoder_prompt_ids({language:t=null,task:n=null,no_timestamps:i=!0}={}){let r=[];if(t){t=t.toLowerCase();let o=bZ.get(t);if(o===void 0)if(cE.has(t))o=t;else{let h=t.length===2?cE.keys():cE.values();throw new Error(`Language "${t}" is not supported. Must be one of: ${JSON.stringify(h)}`)}let l=this.model.tokens_to_ids.get(`<|${o}|>`);if(l===void 0)throw new Error(`Unable to find language "${o}" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.`);r.push(l)}else r.push(null);if(n){if(n=n.toLowerCase(),n!=="transcribe"&&n!=="translate")throw new Error(`Task "${n}" is not supported. Must be one of: ["transcribe", "translate"]`);let o=this.model.tokens_to_ids.get(`<|${n}|>`);if(o===void 0)throw new Error(`Unable to find task "${n}" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.`);r.push(o)}else r.push(null);if(i){let o=this.model.tokens_to_ids.get("<|notimestamps|>");if(o===void 0)throw new Error('Unable to find "<|notimestamps|>" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.');r.push(o)}return r.map((o,l)=>[l+1,o]).filter(o=>o[1]!==null)}},ER=class extends Ne{},SR=class extends Ne{},TR=class extends Ne{},AR=class extends Ne{constructor(e,t){super(e,t),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(n=>this.languageRegex.test(n)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(e){if(e===null)return null;let[t,...n]=e.trim().split(this.languageRegex);if(n.length===0)return super._encode_text(t);if(n.length===2){let[i,r]=n;return this.supported_language_codes.includes(i)||console.warn(`Unsupported language code "${i}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),ln([i],super._encode_text(r))}}},CR=class extends Ne{},yE=class extends Ne{constructor(){super(...arguments);J(this,"_default_chat_template","{% for message in messages %}{% if message['role'] == 'user' %}{{ ' ' }}{% endif %}{{ message['content'] }}{% if not loop.last %}{{ '  ' }}{% endif %}{% endfor %}{{ eos_token }}")}},IR=class extends yE{},DR=class extends Ne{},kR=class extends Ne{},RR=class extends Ne{constructor(e,t){super(e,t),this.decoder=new Bk({})}},PR=class extends Ne{},qt=class{static async from_pretrained(e,{quantized:t=!0,progress_callback:n=null,config:i=null,cache_dir:r=null,local_files_only:o=!1,revision:l="main",legacy:u=null}={}){let[h,d]=await Z4(e,{quantized:t,progress_callback:n,config:i,cache_dir:r,local_files_only:o,revision:l,legacy:u}),c=d.tokenizer_class?.replace(/Fast$/,"")??"PreTrainedTokenizer",a=this.TOKENIZER_CLASS_MAPPING[c];return a||(console.warn(`Unknown tokenizer class "${c}", attempting to construct from base class.`),a=Ne),new a(h,d)}};J(qt,"TOKENIZER_CLASS_MAPPING",{T5Tokenizer:oR,DistilBertTokenizer:nR,CamembertTokenizer:sR,DebertaTokenizer:Jk,DebertaV2Tokenizer:Zk,BertTokenizer:qk,HerbertTokenizer:Qk,ConvBertTokenizer:eR,RoFormerTokenizer:tR,XLMTokenizer:iR,ElectraTokenizer:rR,MobileBertTokenizer:Kk,SqueezeBertTokenizer:Xk,AlbertTokenizer:Yk,GPT2Tokenizer:pE,BartTokenizer:aR,MBartTokenizer:gE,MBart50Tokenizer:lR,RobertaTokenizer:cR,WhisperTokenizer:xR,CodeGenTokenizer:ER,CLIPTokenizer:SR,SiglipTokenizer:TR,MarianTokenizer:AR,BloomTokenizer:uR,NllbTokenizer:_R,M2M100Tokenizer:wR,LlamaTokenizer:mE,CodeLlamaTokenizer:dR,XLMRobertaTokenizer:hR,MPNetTokenizer:fR,FalconTokenizer:pR,GPTNeoXTokenizer:gR,EsmTokenizer:mR,Wav2Vec2CTCTokenizer:CR,BlenderbotTokenizer:yE,BlenderbotSmallTokenizer:IR,SpeechT5Tokenizer:DR,NougatTokenizer:kR,VitsTokenizer:RR,Qwen2Tokenizer:yR,GemmaTokenizer:bR,Grok1Tokenizer:vR,CohereTokenizer:PR,PreTrainedTokenizer:Ne})});async function vZ(s,e){return await br(s,"config.json",!0,e)}var LR,Eo,$R=tn(()=>{Qc();LR=class{constructor(e){this.model_type=null,this.is_encoder_decoder=!1,Object.assign(this,e)}static async from_pretrained(e,{progress_callback:t=null,config:n=null,cache_dir:i=null,local_files_only:r=!1,revision:o="main"}={}){let l=n??await vZ(e,{progress_callback:t,config:n,cache_dir:i,local_files_only:r,revision:o});return new this(l)}},Eo=class{static async from_pretrained(...e){return LR.from_pretrained(...e)}}});var Dy,ri,vE,_E,wE,xE,EE,SE,TE,AE,CE,IE,sH,iu,UR,BR,VR,iH=tn(()=>{Ha();$a();Va();Dy=class extends _n{constructor(){super(),this.processors=[]}push(e){this.processors.push(e)}extend(e){this.processors.push(...e)}_call(e,t){for(let n of t)this.processors.forEach(i=>i(e,n))}[Symbol.iterator](){return this.processors.values()}},ri=class extends _n{_call(e,t){throw Error("`_call` should be implemented in a subclass")}},vE=class extends ri{constructor(e){super(),this.force_token_map=Object.fromEntries(e??[])}_call(e,t){let n=this.force_token_map[e.length];return m4(n)&&(t.data.fill(-1/0),t.data[n]=0),t}},_E=class extends ri{constructor(e){super(),this.bos_token_id=e}_call(e,t){return e.length===1&&(t.data.fill(-1/0),t.data[this.bos_token_id]=0),t}},wE=class extends ri{constructor(e,t){super(),this.max_length=e,this.forced_eos_token_id=t}_call(e,t){}},xE=class extends ri{constructor(e,t){super(),this.begin_suppress_tokens=e,this.begin_index=t}_call(e,t){if(e.length===this.begin_index)for(let n of this.begin_suppress_tokens)t.data[n]=-1/0;return t}},EE=class extends ri{constructor(e){super(),this.eos_token_id=e.eos_token_id,this.no_timestamps_token_id=e.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=(e.forced_decoder_ids||[]).length+2,e.forced_decoder_ids.slice(-1)[0][1]===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=e.max_initial_timestamp_index}_call(e,t){let n=t.data;if(n[this.no_timestamps_token_id]=-1/0,e.length===this.begin_index-1)return n.fill(-1/0),n[this.timestamp_begin]=0,t;let i=e.slice(this.begin_index),r=i.length>=1&&i[i.length-1]>=this.timestamp_begin,o=i.length<2||i[i.length-2]>=this.timestamp_begin;if(r&&(o?n.subarray(this.timestamp_begin).fill(-1/0):n.subarray(0,this.eos_token_id).fill(-1/0)),e.length===this.begin_index&&this.max_initial_timestamp_index!==null){let d=this.timestamp_begin+this.max_initial_timestamp_index;n.subarray(d+1).fill(-1/0)}let l=I4(n),u=Math.log(l.subarray(this.timestamp_begin).map(Math.exp).reduce((d,c)=>d+c)),h=Mn(l.subarray(0,this.timestamp_begin))[0];return u>h&&n.subarray(0,this.timestamp_begin).fill(-1/0),t}},SE=class extends ri{constructor(e){super(),this.no_repeat_ngram_size=e}getNgrams(e){let t=e.length,n=[];for(let r=0;r<t+1-this.no_repeat_ngram_size;++r){let o=[];for(let l=0;l<this.no_repeat_ngram_size;++l)o.push(e[r+l]);n.push(o)}let i=new Map;for(let r of n){let o=r.slice(0,r.length-1),l=JSON.stringify(o),u=i.get(l)??[];u.push(r[r.length-1]),i.set(l,u)}return i}getGeneratedNgrams(e,t){let n=t.slice(t.length+1-this.no_repeat_ngram_size,t.length);return e.get(JSON.stringify(n))??[]}calcBannedNgramTokens(e){let t=[];if(e.length+1<this.no_repeat_ngram_size)return t;{let n=this.getNgrams(e);return this.getGeneratedNgrams(n,e)}}_call(e,t){let n=this.calcBannedNgramTokens(e);for(let i of n)t.data[i]=-1/0;return t}},TE=class extends ri{constructor(e){super(),this.penalty=e}_call(e,t){for(let n of e)t.data[n]<0?t.data[n]*=this.penalty:t.data[n]/=this.penalty;return t}},AE=class extends ri{constructor(e,t){super(),this.min_length=e,this.eos_token_id=Array.isArray(t)?t:[t]}_call(e,t){if(e.length<this.min_length)for(let n of this.eos_token_id)t.data[n]=-1/0;return t}},CE=class extends ri{constructor(e,t,n){super(),this.prompt_length_to_skip=e,this.min_new_tokens=t,this.eos_token_id=Array.isArray(n)?n:[n]}_call(e,t){if(e.length-this.prompt_length_to_skip<this.min_new_tokens)for(let i of this.eos_token_id)t.data[i]=-1/0;return t}},IE=class extends ri{constructor(e,t){super(),this.bad_words_ids=e,this.eos_token_id=Array.isArray(t)?t:[t]}_call(e,t){for(let n of this.bad_words_ids){let i=!0;for(let r=1;r<=n.length-1&&n.length<e.length;++r)if(n.at(-r-1)!==e.at(-r)){i=!1;break}i&&(t.data[n.at(-1)]=-1/0)}return t}},sH=class{constructor(s={}){this.max_length=s.max_length??20,this.max_new_tokens=s.max_new_tokens??null,this.min_length=s.min_length??0,this.min_new_tokens=s.min_new_tokens??null,this.early_stopping=s.early_stopping??!1,this.max_time=s.max_time??null,this.do_sample=s.do_sample??!1,this.num_beams=s.num_beams??1,this.num_beam_groups=s.num_beam_groups??1,this.penalty_alpha=s.penalty_alpha??null,this.use_cache=s.use_cache??!0,this.temperature=s.temperature??1,this.top_k=s.top_k??50,this.top_p=s.top_p??1,this.typical_p=s.typical_p??1,this.epsilon_cutoff=s.epsilon_cutoff??0,this.eta_cutoff=s.eta_cutoff??0,this.diversity_penalty=s.diversity_penalty??0,this.repetition_penalty=s.repetition_penalty??1,this.encoder_repetition_penalty=s.encoder_repetition_penalty??1,this.length_penalty=s.length_penalty??1,this.no_repeat_ngram_size=s.no_repeat_ngram_size??0,this.bad_words_ids=s.bad_words_ids??null,this.force_words_ids=s.force_words_ids??null,this.renormalize_logits=s.renormalize_logits??!1,this.constraints=s.constraints??null,this.forced_bos_token_id=s.forced_bos_token_id??null,this.forced_eos_token_id=s.forced_eos_token_id??null,this.remove_invalid_values=s.remove_invalid_values??!1,this.exponential_decay_length_penalty=s.exponential_decay_length_penalty??null,this.suppress_tokens=s.suppress_tokens??null,this.begin_suppress_tokens=s.begin_suppress_tokens??null,this.forced_decoder_ids=s.forced_decoder_ids??null,this.num_return_sequences=s.num_return_sequences??1,this.output_attentions=s.output_attentions??!1,this.output_hidden_states=s.output_hidden_states??!1,this.output_scores=s.output_scores??!1,this.return_dict_in_generate=s.return_dict_in_generate??!1,this.pad_token_id=s.pad_token_id??null,this.bos_token_id=s.bos_token_id??null,this.eos_token_id=s.eos_token_id??null,this.encoder_no_repeat_ngram_size=s.encoder_no_repeat_ngram_size??0,this.decoder_start_token_id=s.decoder_start_token_id??null,this.generation_kwargs=s.generation_kwargs??{}}},iu=class extends _n{constructor(e){super(),this.generation_config=e}_call(e,t=-1){return this.sample(e,t)}sample(e,t){throw Error("sample should be implemented in subclasses.")}getLogits(e,t){let n=e.dims.at(-1),i=e.data;if(t===-1)i=i.slice(-n);else{let r=t*n;i=i.slice(r,r+n)}return this.generation_config.temperature>0&&(i=i.map(r=>r/this.generation_config.temperature)),i}randomSelect(e){let t=e.reduce((i,r)=>i+r,0),n=Math.random()*t;for(let i=0;i<e.length;++i)if(n-=e[i],n<=0)return i;return 0}static getSampler(e){if(e.do_sample)return new BR(e);if(e.num_beams>1)return new VR(e);if(e.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${e.num_return_sequences}.`);return new UR(e)}},UR=class extends iu{sample(e,t=-1){let n=this.getLogits(e,t);return[[Mn(n)[1],0]]}},BR=class extends iu{sample(e,t=-1){let n=e.dims.at(-1);this.generation_config.top_k>0&&(n=Math.min(this.generation_config.top_k,n));let i=this.getLogits(e,t),r=Ba(i,n),o=cn(r.map(l=>l[1]));return Array.from({length:this.generation_config.num_beams},()=>{let l=this.randomSelect(o);return[r[l][0],Math.log(o[l])]})}},VR=class extends iu{sample(e,t=-1){let n=e.dims.at(-1);this.generation_config.top_k>0&&(n=Math.min(this.generation_config.top_k,n));let i=this.getLogits(e,t),r=Ba(i,n),o=cn(r.map(l=>l[1]));return Array.from({length:this.generation_config.num_beams},(l,u)=>[r[u][0],Math.log(o[u])])}}});async function ja(s,e,t){let n=`onnx/${e}${t.quantized?"_quantized":""}.onnx`,i=await ik(s,n,!0,t);try{return await zR.create(i,{executionProviders:Ey})}catch(r){if(Ey.length===1&&Ey[0]==="wasm")throw r;return console.warn(r),console.warn("Something went wrong during model construction (most likely a missing operation). Using `wasm` as a fallback. "),await zR.create(i,{executionProviders:["wasm"]})}}function xZ(s,e){let t=Object.create(null),n=[];for(let o of s.inputNames){let l=e[o];if(!(l instanceof pe)){n.push(o);continue}t[o]=wZ.wasm.proxy?l.clone():l}if(n.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${n.join(", ")}.`);let i=Object.keys(e).length,r=s.inputNames.length;if(i>r){let o=Object.keys(e).filter(l=>!s.inputNames.includes(l));console.warn(`WARNING: Too many inputs were provided (${i} > ${r}). The following inputs will be ignored: "${o.join(", ")}".`)}return t}async function Zh(s,e){let t=xZ(s,e);try{let n=await s.run(t);return n=oH(n),n}catch(n){throw console.error(`An error occurred during model execution: "${n}".`),console.error("Inputs given to model:",t),n}}function oH(s){for(let e in s)s[e]instanceof _Z?s[e]=new pe(s[e]):typeof s[e]=="object"&&oH(s[e]);return s}function EZ(s){if(s instanceof pe)return s;if(s.length===0)throw Error("items must be non-empty");if(Array.isArray(s[0])){if(s.some(e=>e.length!==s[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new pe("int64",BigInt64Array.from(s.flat().map(e=>BigInt(e))),[s.length,s[0].length])}else return new pe("int64",BigInt64Array.from(s.map(e=>BigInt(e))),[1,s.length])}function lO(s,e){let t=s.config.pad_token_id??null,n=s.config.eos_token_id??null;jx(n)&&(n=[n]);let i=e.indexOf(t)!==-1,r=n===null||!n.includes(t);if(i&&r){let o=BigInt64Array.from(e.data.map(l=>l!=t));return new pe("int64",o,e.dims)}else return U4(e)}function aH(s,e,t){if(!s.inputNames.includes("position_ids"))return;let n=new BigInt64Array(e.attention_mask.data.length);for(let i=0;i<e.attention_mask.dims[0];++i){let r=i*e.attention_mask.dims[1],o=BigInt(0);for(let l=0;l<e.attention_mask.dims[1];++l){let u=r+l;e.attention_mask.data[u]===0n?n[u]=BigInt(1):(n[u]=o,o+=e.attention_mask.data[u])}}e.position_ids=new pe("int64",n,e.attention_mask.dims),t&&(e.position_ids=e.position_ids.slice(null,-1).unsqueeze_(-1))}function cO(s){return new pe("bool",[s],[1])}async function SZ(s,e){let{encoder_outputs:t,past_key_values:n}=e;t||(t=(await Xy(s,e)).last_hidden_state);let i={input_ids:e.decoder_input_ids,encoder_hidden_states:t},r=!!n;s.decoder_merged_session.inputNames.includes("use_cache_branch")&&(i.use_cache_branch=cO(r)),s.decoder_merged_session.inputNames.includes("encoder_attention_mask")&&(i.encoder_attention_mask=e.attention_mask),aH(s.decoder_merged_session,i,r),s.addPastKeyValues(i,n);let o=await Zh(s.decoder_merged_session,i),l=o.logits;n=s.getPastKeyValues(o,n);let u=s.getAttentions(o);return new iO({logits:l,past_key_values:n,encoder_outputs:t,...u})}function TZ(s,e,t,n){let i=[],r=0,o=s.requires_attention_mask??!0,l=t.decoder_input_ids??t.decoder_start_token_id??t.bos_token_id??t.eos_token_id;l instanceof pe?l=l.tolist().flat():Array.isArray(l)||(l=[l]);for(let u of e){u.dims=[1,...u.dims];let h={inputs:u,encoder_outputs:null,prev_model_outputs:null,output_token_ids:l,done:!1,score:0,id:r++};o&&(h.attention_mask=lO(s,u)),i.push(h)}return i}async function AZ(s,e){let t=s.main_input_name,n=e.output_token_ids;e.prev_model_outputs&&(n=n.slice(-1));let i={[t]:e.inputs,decoder_input_ids:EZ(n),encoder_outputs:e.encoder_outputs,past_key_values:e.prev_model_outputs?.past_key_values};e.attention_mask&&(i.attention_mask=e.attention_mask);let r=await s.forward(i);return e.prev_model_outputs=r,e.encoder_outputs=r.encoder_outputs,r}function CZ(s,e){s.output_token_ids=[...s.output_token_ids,e]}async function Xy(s,e){let t=Object.create(null);for(let n of s.session.inputNames)t[n]=e[n];return s.session.inputNames.includes("token_type_ids")&&!t.token_type_ids&&(t.token_type_ids=new pe("int64",new BigInt64Array(t.input_ids.data.length),t.input_ids.dims)),await Zh(s.session,t)}async function IZ(s,e){let{input_ids:t,past_key_values:n,attention_mask:i}=e,r={input_ids:t,attention_mask:i??lO(s,t)},o=!!n;s.session.inputNames.includes("use_cache_branch")&&(r.use_cache_branch=cO(o)),aH(s.session,r,o),s.addPastKeyValues(r,n);let l=await Zh(s.session,r),u=l.logits;return n=s.getPastKeyValues(l,n),{logits:u,past_key_values:n}}function DZ(s,e,t,n,i){let r=[],o=0;for(let l of e){let u=l.tolist().map(Number);l.dims=[1,...l.dims];let h;i?(h=i[o],h.dims=[1,...h.dims]):h=lO(s,l);let d={input:l,model_input_ids:l,attention_mask:h,prev_model_outputs:null,output_token_ids:u,num_output_tokens:n,done:!1,score:0,id:o++};r.push(d)}return r}async function kZ(s,e){let t=new BigInt64Array(e.output_token_ids.length).fill(1n),n={input_ids:e.model_input_ids,attention_mask:new pe("int64",t,[1,t.length]),past_key_values:e.prev_model_outputs?.past_key_values},i=await s.forward(n);return e.prev_model_outputs=i,i}function RZ(s,e){s.output_token_ids=[...s.output_token_ids,e],s.model_input_ids=new pe("int64",[BigInt(e)],[1,1])}var zR,_Z,wZ,$e,DE,rH,ky,ce,ss,ou,HR,GR,jR,WR,qR,YR,KR,au,XR,JR,ZR,QR,eP,lu,tP,nP,sP,iP,rP,cu,oP,aP,lP,cP,uP,uu,dP,hP,fP,pP,gP,du,mP,yP,bP,vP,_P,hu,wP,xP,EP,SP,TP,fu,AP,CP,IP,DP,kP,Qh,RP,PP,MP,NP,ef,OP,FP,LP,$P,pu,UP,BP,VP,zP,HP,tf,GP,jP,WP,qP,nf,YP,KP,XP,JP,kE,ZP,QP,RE,eM,tM,PE,nM,sM,Jy,iM,rM,oM,sf,aM,lM,cM,uM,ME,dM,hM,NE,fM,pM,gu,gM,mM,yM,bM,vM,mu,_M,wM,xM,EM,SM,yu,TM,AM,CM,IM,DM,OE,kM,RM,FE,PM,MM,LE,rf,NM,OM,FM,$E,LM,$M,UM,BM,VM,UE,zM,HM,BE,GM,jM,VE,WM,qM,zE,YM,KM,HE,XM,JM,GE,ZM,QM,jE,eN,tN,WE,nN,sN,qE,iN,rN,YE,oN,aN,KE,lN,cN,XE,uN,dN,JE,hN,fN,ZE,pN,gN,QE,mN,yN,bN,vN,eS,_N,wN,tS,xN,EN,nS,SN,TN,sS,AN,CN,iS,IN,DN,Zy,kN,RN,PN,rS,MN,oS,NN,ON,FN,aS,LN,$N,lS,UN,BN,cS,VN,zN,uS,HN,GN,dS,jN,WN,qN,YN,hS,KN,XN,JN,ZN,fS,QN,e2,pS,t2,n2,gS,s2,i2,mS,r2,o2,a2,l2,c2,u2,yS,d2,h2,bS,f2,p2,So,g2,m2,y2,b2,Qy,v2,_2,w2,of,x2,E2,S2,T2,eb,A2,C2,I2,D2,k2,R2,bu,P2,M2,N2,O2,F2,vS,L2,$2,U2,B2,V2,_S,z2,H2,wS,G2,j2,xS,W2,q2,tb,Y2,K2,X2,J2,ES,SS,Z2,Q2,eO,tO,TS,nO,sO,xt,lH,cH,PZ,uO,uH,dH,hH,fH,dO,AS,pH,gH,hO,MZ,mH,yH,bH,vH,_H,NZ,wH,xH,OZ,FZ,LZ,EH,SH,TH,AH,$Z,_r,Jh,Ry,ru,Py,My,Ny,Oy,Fy,Ly,$y,Uy,By,Vy,zy,Hy,Gy,jy,Wy,qy,Yy,Ky,iO,Ke,rO,wn,xn,Nn,Wa,oO,aO,fO=tn(()=>{$R();$a();Qc();iH();Ha();Wx();pO();({InferenceSession:zR,Tensor:_Z,env:wZ}=_o),$e={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5},DE=new Map,rH=new Map,ky=new Map;ce=class extends _n{constructor(t,n){super();J(this,"main_input_name","input_ids");this.config=t,this.session=n;let i=ky.get(this.constructor),r=DE.get(i);this.can_generate=!1,this._runBeam=null,this._getStartBeams=null,this._updateBeam=null,this._forward=null,r===$e.DecoderOnly?(this.can_generate=!0,this._runBeam=kZ,this._getStartBeams=DZ,this._updateBeam=RZ,this._forward=IZ):r===$e.Seq2Seq||r===$e.Vision2Seq?(this.can_generate=!0,this._runBeam=AZ,this._getStartBeams=TZ,this._updateBeam=CZ,this._forward=SZ):r===$e.EncoderDecoder?this._forward=Xy:this._forward=Xy}async dispose(){let t=[];for(let n of Object.keys(this)){let i=this[n];i instanceof zR&&t.push(i.handler.dispose())}return await Promise.all(t)}static async from_pretrained(t,{quantized:n=!0,progress_callback:i=null,config:r=null,cache_dir:o=null,local_files_only:l=!1,revision:u="main",model_file_name:h=null}={}){let d={quantized:n,progress_callback:i,config:r,cache_dir:o,local_files_only:l,revision:u,model_file_name:h},c=ky.get(this),a=DE.get(c),f;return a===$e.DecoderOnly?f=await Promise.all([Eo.from_pretrained(t,d),ja(t,d.model_file_name??"decoder_model_merged",d),br(t,"generation_config.json",!1,d)]):a===$e.Seq2Seq||a===$e.Vision2Seq?f=await Promise.all([Eo.from_pretrained(t,d),ja(t,"encoder_model",d),ja(t,"decoder_model_merged",d),br(t,"generation_config.json",!1,d)]):a===$e.MaskGeneration?f=await Promise.all([Eo.from_pretrained(t,d),ja(t,"vision_encoder",d),ja(t,"prompt_encoder_mask_decoder",d)]):a===$e.EncoderDecoder?f=await Promise.all([Eo.from_pretrained(t,d),ja(t,"encoder_model",d),ja(t,"decoder_model_merged",d)]):(a!==$e.EncoderOnly&&console.warn(`Model type for '${c??r?.model_type}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`),f=await Promise.all([Eo.from_pretrained(t,d),ja(t,d.model_file_name??"model",d)])),new this(...f)}async _call(t){return await this.forward(t)}async forward(t){return await this._forward(this,t)}_get_logits_processor(t,n,i=null){let r=new Dy;if(t.repetition_penalty!==null&&t.repetition_penalty!==1&&r.push(new TE(t.repetition_penalty)),t.no_repeat_ngram_size!==null&&t.no_repeat_ngram_size>0&&r.push(new SE(t.no_repeat_ngram_size)),t.bad_words_ids!==null&&r.push(new IE(t.bad_words_ids,t.eos_token_id)),t.min_length!==null&&t.eos_token_id!==null&&t.min_length>0&&r.push(new AE(t.min_length,t.eos_token_id)),t.min_new_tokens!==null&&t.eos_token_id!==null&&t.min_new_tokens>0&&r.push(new CE(n,t.min_new_tokens,t.eos_token_id)),t.forced_bos_token_id!==null&&r.push(new _E(t.forced_bos_token_id)),t.forced_eos_token_id!==null&&r.push(new wE(t.max_length,t.forced_eos_token_id)),t.begin_suppress_tokens!==null){let o=n>1||t.forced_bos_token_id===null?n:n+1;t.forced_decoder_ids!==null&&(o+=t.forced_decoder_ids[t.forced_decoder_ids.length-1][0]),r.push(new xE(t.begin_suppress_tokens,o))}return t.forced_decoder_ids!==null&&r.push(new vE(t.forced_decoder_ids)),i!==null&&r.extend(i),r}_get_generation_config(t){let n=new sH(this.config);return"generation_config"in this&&Object.assign(n,this.generation_config),t!==null&&Object.assign(n,t),n}async generate(t,n=null,i=null,{inputs_attention_mask:r=null}={}){if(!this.can_generate){let y=`The current model class (${ky.get(this.constructor)}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`,_=this.config.model_type,x=AS.get(_)??dO.get(_)??uO.get(_)??hO.get(_);throw x&&(y+=` Please use the following class instead: '${x[0]}'`),Error(y)}if(!(t instanceof pe)&&!g4(t)&&!Array.isArray(t))throw Error(`\`inputs\` must be a Tensor, TypedArray, or Array, but is "${t.constructor.name}".`);let o;if(this.config.is_encoder_decoder)o=0;else if(o=t instanceof pe?t.dims.at(-1):t.length,o===0)throw Error("Must supply a non-empty array of input token ids.");n=this._get_generation_config(n),i=i??new Dy,i=this._get_logits_processor(n,o,i);let l=n.eos_token_id;l!==null&&!Array.isArray(l)&&(l=[l]);let u=1,h=u+(n.max_new_tokens??1/0),d=Number.isInteger(n.max_length)&&(n.max_new_tokens??null)===null,c=iu.getSampler(n),a=this.getStartBeams(t,n,u,r);for(;a.some(m=>!m.done)&&u<h;){let m=[];for(let y of a){if(y.done){m.push(y);continue}if(d&&y.output_token_ids.length>=n.max_length){y.done=!0,m.push(y);continue}let _=await this.runBeam(y);n.output_attentions&&this.addAttentionsToBeam(y,_),n.output_scores;let x=_.logits.slice(null,-1,null);i(y.output_token_ids,x);let E=c(x);for(let[S,T]of E){let C={...y};this.updateBeam(C,S),C.score+=T,l&&l.includes(S)&&(C.done=!0),m.push(C)}}++u,m=this.groupBeams(m).map(y=>y.sort((_,x)=>x.score-_.score).slice(0,n.num_beams)),a=m.flat(),n.callback_function&&n.callback_function(a)}let f=this.groupBeams(a),p=m=>f.map(y=>n.num_return_sequences>1?y.slice(0,n.num_return_sequences).map(_=>_[m]):[y[0][m]]).flat(),g=p("output_token_ids");if(n.return_dict_in_generate){let m=p("decoder_attentions"),y=p("cross_attentions");return{sequences:g,decoder_attentions:m,cross_attentions:y}}else return g}addAttentionsToBeam(t,n){if(this.config.is_encoder_decoder){if(!n.cross_attentions||n.cross_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce cross-attentions. This is most likely because the model was not exported with `output_attentions=True`.");t.cross_attentions||(t.cross_attentions=[]),t.cross_attentions.push(n.cross_attentions)}if(!n.decoder_attentions||n.decoder_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce decoder-attentions. This is most likely because the model was not exported with `output_attentions=True`.");t.decoder_attentions||(t.decoder_attentions=[]),t.decoder_attentions.push(n.decoder_attentions)}groupBeams(t){let n=Object.create(null);for(let i of t)n[i.id]===void 0?n[i.id]=[i]:n[i.id].push(i);return Object.values(n)}getPastKeyValues(t,n){let i=Object.create(null);for(let r in t)if(r.startsWith("present")){let o=r.replace("present","past_key_values");n&&r.includes("encoder")?i[o]=n[o]:i[o]=t[r]}return i}getAttentions(t){let n=Object.create(null);for(let i of["cross_attentions","decoder_attentions"]){let r=[];for(let o in t)if(o.startsWith(i)){let l=o.split(".").pop();r[l]=t[o]}n[i]=r}return n}addPastKeyValues(t,n){if(n)Object.assign(t,n);else if(this.config.is_encoder_decoder&&(this.add_encoder_pkv??!0)){let r=[1,this.num_encoder_heads,0,this.encoder_dim_kv],o=[1,this.num_decoder_heads,0,this.decoder_dim_kv];for(let l=0;l<this.num_decoder_layers;++l)t[`past_key_values.${l}.encoder.key`]=new pe("float32",[],r),t[`past_key_values.${l}.encoder.value`]=new pe("float32",[],r),t[`past_key_values.${l}.decoder.key`]=new pe("float32",[],o),t[`past_key_values.${l}.decoder.value`]=new pe("float32",[],o)}else if(this.config.model_type==="falcon"){let r=[1*this.num_heads,0,this.dim_kv];for(let o=0;o<this.num_layers;++o)t[`past_key_values.${o}.key`]=new pe("float32",[],r),t[`past_key_values.${o}.value`]=new pe("float32",[],r)}else if(this.config.multi_query){let r=[1*this.num_heads,0,2*this.dim_kv];for(let o=0;o<this.num_layers;++o)t[`past_key_values.${o}.key_value`]=new pe("float32",[],r)}else if(this.config.model_type==="bloom"){let r=[1*this.num_heads,this.dim_kv,0],o=[1*this.num_heads,0,this.dim_kv];for(let l=0;l<this.num_layers;++l)t[`past_key_values.${l}.key`]=new pe("float32",[],r),t[`past_key_values.${l}.value`]=new pe("float32",[],o)}else{let r=[1,this.num_heads,0,this.dim_kv];for(let o=0;o<this.num_layers;++o)t[`past_key_values.${o}.key`]=new pe("float32",[],r),t[`past_key_values.${o}.value`]=new pe("float32",[],r)}}getStartBeams(t,n,i,r){return this._getStartBeams(this,t,n,i,r)}async runBeam(t){return await this._runBeam(this,t)}updateBeam(t,n){return this._updateBeam(t,n)}},ss=class{},ou=class extends ce{},HR=class extends ou{},GR=class extends ou{async _call(e){return new xn(await super._call(e))}},jR=class extends ou{async _call(e){return new Ke(await super._call(e))}},WR=class extends ou{async _call(e){return new wn(await super._call(e))}},qR=class extends ou{async _call(e){return new Nn(await super._call(e))}},YR=class extends ce{},KR=class extends YR{},au=class extends ce{},XR=class extends au{},JR=class extends au{async _call(e){return new xn(await super._call(e))}},ZR=class extends au{async _call(e){return new Ke(await super._call(e))}},QR=class extends au{async _call(e){return new wn(await super._call(e))}},eP=class extends au{async _call(e){return new Nn(await super._call(e))}},lu=class extends ce{},tP=class extends lu{},nP=class extends lu{async _call(e){return new xn(await super._call(e))}},sP=class extends lu{async _call(e){return new Ke(await super._call(e))}},iP=class extends lu{async _call(e){return new wn(await super._call(e))}},rP=class extends lu{async _call(e){return new Nn(await super._call(e))}},cu=class extends ce{},oP=class extends cu{},aP=class extends cu{async _call(e){return new xn(await super._call(e))}},lP=class extends cu{async _call(e){return new Ke(await super._call(e))}},cP=class extends cu{async _call(e){return new wn(await super._call(e))}},uP=class extends cu{async _call(e){return new Nn(await super._call(e))}},uu=class extends ce{},dP=class extends uu{},hP=class extends uu{async _call(e){return new xn(await super._call(e))}},fP=class extends uu{async _call(e){return new Ke(await super._call(e))}},pP=class extends uu{async _call(e){return new wn(await super._call(e))}},gP=class extends uu{async _call(e){return new Nn(await super._call(e))}},du=class extends ce{},mP=class extends du{},yP=class extends du{async _call(e){return new xn(await super._call(e))}},bP=class extends du{async _call(e){return new Ke(await super._call(e))}},vP=class extends du{async _call(e){return new wn(await super._call(e))}},_P=class extends du{async _call(e){return new Nn(await super._call(e))}},hu=class extends ce{},wP=class extends hu{},xP=class extends hu{async _call(e){return new xn(await super._call(e))}},EP=class extends hu{async _call(e){return new Ke(await super._call(e))}},SP=class extends hu{async _call(e){return new wn(await super._call(e))}},TP=class extends hu{async _call(e){return new Nn(await super._call(e))}},fu=class extends ce{},AP=class extends fu{},CP=class extends fu{async _call(e){return new Ke(await super._call(e))}},IP=class extends fu{async _call(e){return new wn(await super._call(e))}},DP=class extends fu{async _call(e){return new Nn(await super._call(e))}},kP=class extends fu{async _call(e){return new xn(await super._call(e))}},Qh=class extends ce{},RP=class extends Qh{},PP=class extends Qh{async _call(e){return new xn(await super._call(e))}},MP=class extends Qh{async _call(e){return new Ke(await super._call(e))}},NP=class extends Qh{async _call(e){return new wn(await super._call(e))}},ef=class extends ce{},OP=class extends ef{},FP=class extends ef{async _call(e){return new xn(await super._call(e))}},LP=class extends ef{async _call(e){return new Ke(await super._call(e))}},$P=class extends ef{async _call(e){return new Nn(await super._call(e))}},pu=class extends ce{},UP=class extends pu{},BP=class extends pu{async _call(e){return new xn(await super._call(e))}},VP=class extends pu{async _call(e){return new Ke(await super._call(e))}},zP=class extends pu{async _call(e){return new wn(await super._call(e))}},HP=class extends pu{async _call(e){return new Nn(await super._call(e))}},tf=class extends ce{},GP=class extends tf{},jP=class extends tf{async _call(e){return new xn(await super._call(e))}},WP=class extends tf{async _call(e){return new Ke(await super._call(e))}},qP=class extends tf{async _call(e){return new Nn(await super._call(e))}},nf=class extends ce{},YP=class extends nf{},KP=class extends nf{async _call(e){return new Ke(await super._call(e))}},XP=class extends nf{async _call(e){return new Nn(await super._call(e))}},JP=class extends nf{async _call(e){return new xn(await super._call(e))}},kE=class extends ce{},ZP=class extends kE{},QP=class extends kE{constructor(e,t,n,i){super(e,t),this.decoder_merged_session=n,this.generation_config=i,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}},RE=class extends ce{},eM=class extends RE{},tM=class extends RE{constructor(e,t,n,i){super(e,t),this.decoder_merged_session=n,this.generation_config=i,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}},PE=class extends ce{},nM=class extends PE{},sM=class extends PE{constructor(e,t,n,i){super(e,t),this.decoder_merged_session=n,this.generation_config=i,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}},Jy=class extends ce{},iM=class extends Jy{},rM=class extends Jy{constructor(e,t,n,i){super(e,t),this.decoder_merged_session=n,this.generation_config=i,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}},oM=class extends Jy{async _call(e){return new Ke(await super._call(e))}},sf=class extends ce{},aM=class extends sf{},lM=class extends sf{constructor(e,t,n,i){super(e,t),this.decoder_merged_session=n,this.generation_config=i,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}},cM=class extends sf{async _call(e){return new Ke(await super._call(e))}},uM=class extends sf{constructor(e,t,n){super(e,t),this.generation_config=n,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}},ME=class extends ce{},dM=class extends ME{},hM=class extends ME{constructor(e,t,n,i){super(e,t),this.decoder_merged_session=n,this.generation_config=i,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}},NE=class extends ce{},fM=class extends NE{},pM=class extends NE{constructor(e,t,n,i){super(e,t),this.decoder_merged_session=n,this.generation_config=i,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}},gu=class extends ce{},gM=class extends gu{},mM=class extends gu{async _call(e){return new xn(await super._call(e))}},yM=class extends gu{async _call(e){return new Ke(await super._call(e))}},bM=class extends gu{async _call(e){return new wn(await super._call(e))}},vM=class extends gu{async _call(e){return new Nn(await super._call(e))}},mu=class extends ce{},_M=class extends mu{},wM=class extends mu{async _call(e){return new xn(await super._call(e))}},xM=class extends mu{async _call(e){return new Ke(await super._call(e))}},EM=class extends mu{async _call(e){return new wn(await super._call(e))}},SM=class extends mu{async _call(e){return new Nn(await super._call(e))}},yu=class extends ce{},TM=class extends yu{},AM=class extends yu{async _call(e){return new xn(await super._call(e))}},CM=class extends yu{async _call(e){return new Ke(await super._call(e))}},IM=class extends yu{async _call(e){return new wn(await super._call(e))}},DM=class extends yu{async _call(e){return new Nn(await super._call(e))}},OE=class extends ce{},kM=class extends OE{},RM=class extends OE{},FE=class extends ce{},PM=class extends FE{},MM=class extends FE{constructor(t,n,i,r){super(t,n);J(this,"requires_attention_mask",!1);J(this,"main_input_name","input_features");this.decoder_merged_session=i,this.generation_config=r,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}async generate(t,n=null,i=null){if(n=this._get_generation_config(n),n.return_timestamps??(n.return_timestamps=!1),n.return_timestamps&&(i=[new EE(n)]),n.return_token_timestamps&&(n.output_attentions=!0,n.return_dict_in_generate=!0,n.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),!n.alignment_heads))throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");let r=await super.generate(t,n,i);return n.return_token_timestamps&&n.alignment_heads&&(r.token_timestamps=this._extract_token_timestamps(r,n.alignment_heads,n.num_frames)),r}_extract_token_timestamps(t,n,i=null,r=.02){if(!t.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");let o=this.config.median_filter_width;o===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),o=7);let l=t.cross_attentions.map(d=>{let c=Array.from({length:this.config.decoder_layers},(y,_)=>qh(d.map(x=>x[_]),2)),a=Yh(n.map(([y,_])=>i?c[y].slice(null,_,null,[0,i]):c[y].slice(null,_)));a=a.transpose(1,0,2,3);let[f,p]=L4(a,-2,0,!0),g=a.clone();for(let y=0;y<g.dims[0];++y){let _=g[y];for(let x=0;x<_.dims[0];++x){let E=_[x],S=f[y][x][0],T=p[y][x][0];for(let C=0;C<E.dims[0];++C){let I=E[C];for(let A=0;A<I.data.length;++A)I.data[A]=(I.data[A]-T.data[A])/S.data[A];I.data.set(k4(I.data,o))}}}return ok(g,1)}),u=[t.sequences.length,t.sequences[0].length],h=new pe("float32",new Float32Array(u[0]*u[1]),u);for(let d=0;d<u[0];++d){let c=l[d].neg().squeeze_(0),[a,f]=$4(c),p=Array.from({length:a.length-1},(y,_)=>a[_+1]-a[_]),g=ln([1],p).map(y=>!!y),m=[];for(let y=0;y<g.length;++y)g[y]&&m.push(f[y]*r);h[d].data.set(m,1)}return h}},LE=class extends ce{constructor(t,n,i,r){super(t,n);J(this,"main_input_name","pixel_values");this.decoder_merged_session=i,this.generation_config=r;let o=this.config.encoder,l=this.config.decoder,u=o.model_type;(lH.get(u)??cH.get(u))||console.warn(`Model type for encoder '${u}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`);let d=AS.get(l.model_type);if(!d)throw new Error(`Unable to construct \`VisionEncoderDecoder\` due to unsupported decoder: "${this.config.decoder.model_type}"`);let c=d[1],a=new c(l,i,r);this.add_encoder_pkv="num_decoder_layers"in a,this.add_encoder_pkv?(this.num_decoder_layers=a.num_decoder_layers,this.num_decoder_heads=a.num_decoder_heads,this.decoder_dim_kv=a.decoder_dim_kv,this.num_encoder_layers=a.num_encoder_layers,this.num_encoder_heads=a.num_encoder_heads,this.encoder_dim_kv=a.encoder_dim_kv):(this.num_layers=a.num_layers,this.num_heads=a.num_heads,this.dim_kv=a.dim_kv)}},rf=class extends ce{},NM=class extends rf{},OM=class extends rf{static async from_pretrained(e,t={}){return t.model_file_name??(t.model_file_name="text_model"),super.from_pretrained(e,t)}},FM=class extends rf{static async from_pretrained(e,t={}){return t.model_file_name??(t.model_file_name="vision_model"),super.from_pretrained(e,t)}},$E=class extends ce{},LM=class extends $E{},$M=class extends $E{static async from_pretrained(e,t={}){return t.model_file_name??(t.model_file_name="text_model"),super.from_pretrained(e,t)}},UM=class extends rf{static async from_pretrained(e,t={}){return t.model_file_name??(t.model_file_name="vision_model"),super.from_pretrained(e,t)}},BM=class extends ce{},VM=class extends BM{},UE=class extends ce{},zM=class extends UE{},HM=class extends UE{},BE=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}},GM=class extends BE{},jM=class extends BE{},VE=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_heads,this.num_layers=this.config.num_layers,this.dim_kv=this.config.hidden_size/this.num_heads}},WM=class extends VE{},qM=class extends VE{},zE=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}},YM=class extends zE{},KM=class extends zE{},HE=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}},XM=class extends HE{},JM=class extends HE{},GE=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}},ZM=class extends GE{},QM=class extends GE{},jE=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}},eN=class extends jE{},tN=class extends jE{},WE=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads??this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}},nN=class extends WE{},sN=class extends WE{},qE=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads??this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}},iN=class extends qE{},rN=class extends qE{},YE=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}},oN=class extends YE{},aN=class extends YE{},KE=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.hidden_size/this.num_heads}},lN=class extends KE{},cN=class extends KE{},XE=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_heads,this.num_layers=this.config.n_layers,this.dim_kv=this.config.d_model/this.num_heads}},uN=class extends XE{},dN=class extends XE{},JE=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}},hN=class extends JE{},fN=class extends JE{},ZE=class extends ce{},pN=class extends ZE{},gN=class extends ZE{async _call(e){return new Ke(await super._call(e))}},QE=class extends ce{},mN=class extends QE{},yN=class extends QE{async _call(e){return new Ke(await super._call(e))}},bN=class extends ce{},vN=class extends bN{async _call(e){return new oO(await super._call(e))}},eS=class extends ce{},_N=class extends eS{},wN=class extends eS{async _call(e){return new Ke(await super._call(e))}},tS=class extends ce{},xN=class extends tS{},EN=class extends tS{async _call(e){return new Ke(await super._call(e))}},nS=class extends ce{},SN=class extends nS{},TN=class extends nS{},sS=class extends ce{},AN=class extends sS{},CN=class extends sS{},iS=class extends ce{},IN=class extends iS{},DN=class extends iS{async _call(e){return new Ke(await super._call(e))}},Zy=class extends ce{},kN=class extends Zy{},RN=class extends Zy{async _call(e){return new rS(await super._call(e))}},PN=class extends Zy{async _call(e){return new MN(await super._call(e))}},rS=class extends ss{constructor({logits:e,pred_boxes:t}){super(),this.logits=e,this.pred_boxes=t}},MN=class extends ss{constructor({logits:e,pred_boxes:t,pred_masks:n}){super(),this.logits=e,this.pred_boxes=t,this.pred_masks=n}},oS=class extends ce{},NN=class extends oS{},ON=class extends oS{async _call(e){return new FN(await super._call(e))}},FN=class extends rS{},aS=class extends ce{},LN=class extends aS{},$N=class extends aS{async _call(e){return new Ke(await super._call(e))}},lS=class extends ce{},UN=class extends lS{},BN=class extends lS{async _call(e){return new Ke(await super._call(e))}},cS=class extends ce{},VN=class extends cS{},zN=class extends cS{async _call(e){return new Ke(await super._call(e))}},uS=class extends ce{},HN=class extends uS{},GN=class extends uS{},dS=class extends ce{},jN=class extends dS{},WN=class extends dS{},qN=class extends ce{},YN=class extends qN{},hS=class extends ce{},KN=class extends hS{},XN=class extends hS{},JN=class extends ce{},ZN=class extends JN{},fS=class extends ce{},QN=class extends fS{},e2=class extends fS{async _call(e){return new Ke(await super._call(e))}},pS=class extends ce{},t2=class extends pS{},n2=class extends pS{async _call(e){return new Ke(await super._call(e))}},gS=class extends ce{},s2=class extends gS{},i2=class extends gS{async _call(e){return new Ke(await super._call(e))}},mS=class extends ce{},r2=class extends mS{},o2=class extends mS{async _call(e){return new a2(await super._call(e))}},a2=class extends ss{constructor({logits:e,pred_boxes:t}){super(),this.logits=e,this.pred_boxes=t}},l2=class extends ce{},c2=class extends l2{constructor(e,t,n){super(e,t),this.prompt_encoder_mask_decoder=n}async get_image_embeddings({pixel_values:e}){return await Xy(this,{pixel_values:e})}async forward(e){if((!e.image_embeddings||!e.image_positional_embeddings)&&(e={...e,...await this.get_image_embeddings(e)}),!e.input_labels){let t=e.input_points.dims.slice(0,-1),n=t.reduce((i,r)=>i*r,1);e.input_labels=new pe("int64",new BigInt64Array(n).fill(1n),t)}return await Zh(this.prompt_encoder_mask_decoder,{input_points:e.input_points,input_labels:e.input_labels,image_embeddings:e.image_embeddings,image_positional_embeddings:e.image_positional_embeddings})}async _call(e){return new u2(await super._call(e))}},u2=class extends ss{constructor({iou_scores:e,pred_masks:t}){super(),this.iou_scores=e,this.pred_masks=t}},yS=class extends ce{},d2=class extends yS{},h2=class extends yS{constructor(e,t,n,i){super(e,t),this.decoder_merged_session=n,this.generation_config=i,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}},bS=class extends ce{},f2=class extends bS{},p2=class extends bS{constructor(e,t,n,i){super(e,t),this.decoder_merged_session=n,this.generation_config=i,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}},So=class extends ce{},g2=class extends So{},m2=class extends So{async _call(e){return new Wa(await super._call(e))}},y2=class extends So{async _call(e){return new Ke(await super._call(e))}},b2=class extends So{async _call(e){return new wn(await super._call(e))}},Qy=class extends ce{},v2=class extends Qy{},_2=class extends Qy{async _call(e){return new Wa(await super._call(e))}},w2=class extends Qy{async _call(e){return new Ke(await super._call(e))}},of=class extends ce{},x2=class extends of{},E2=class extends of{async _call(e){return new Wa(await super._call(e))}},S2=class extends of{async _call(e){return new Ke(await super._call(e))}},T2=class extends of{async _call(e){return new wn(await super._call(e))}},eb=class extends ce{},A2=class extends eb{},C2=class extends eb{async _call(e){return new Wa(await super._call(e))}},I2=class extends eb{async _call(e){return new Ke(await super._call(e))}},D2=class extends So{},k2=class extends So{async _call(e){return new Wa(await super._call(e))}},R2=class extends So{async _call(e){return new Ke(await super._call(e))}},bu=class extends ce{},P2=class extends bu{},M2=class extends bu{async _call(e){return new Wa(await super._call(e))}},N2=class extends bu{async _call(e){return new Ke(await super._call(e))}},O2=class extends bu{async _call(e){return new rO(await super._call(e))}},F2=class extends bu{async _call(e){return new wn(await super._call(e))}},vS=class extends ce{},L2=class extends vS{},$2=class extends vS{constructor(e,t,n,i){super(e,t),this.decoder_merged_session=n,this.generation_config=i,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.hidden_size/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.hidden_size/this.num_encoder_heads}async generate_speech(e,t,{threshold:n=.5,minlenratio:i=0,maxlenratio:r=20,vocoder:o=null}={}){let l={input_ids:e},{encoder_outputs:u,encoder_attention_mask:h}=await Xy(this,l),d=u.dims[1]/this.config.reduction_factor,c=Math.floor(d*r),a=Math.floor(d*i),f=this.config.num_mel_bins,p=[],g=null,m=null,y=0;for(;;){++y;let E=cO(!!m),S;m?S=m.output_sequence_out:S=new pe("float32",new Float32Array(f),[1,1,f]);let T={use_cache_branch:E,output_sequence:S,encoder_attention_mask:h,speaker_embeddings:t,encoder_hidden_states:u};this.addPastKeyValues(T,g),m=await Zh(this.decoder_merged_session,T),g=this.getPastKeyValues(m,g);let{prob:C,spectrum:I}=m;if(p.push(I),y>=a&&(Array.from(C.data).filter(A=>A>=n).length>0||y>=c))break}let _=qh(p),{waveform:x}=await Zh(o.session,{spectrogram:_});return{spectrogram:_,waveform:x}}},U2=class extends ce{constructor(){super(...arguments);J(this,"main_input_name","spectrogram")}},B2=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_encoder_layers=this.num_decoder_layers=this.config.decoder_layers,this.num_encoder_heads=this.num_decoder_heads=this.config.decoder_attention_heads,this.encoder_dim_kv=this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads}},V2=class extends B2{},_S=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}},z2=class extends _S{},H2=class extends _S{},wS=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}},G2=class extends wS{},j2=class extends wS{},xS=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}},W2=class extends xS{},q2=class extends xS{},tb=class extends ce{},Y2=class extends tb{},K2=class extends tb{static async from_pretrained(e,t={}){return t.model_file_name??(t.model_file_name="text_model"),super.from_pretrained(e,t)}},X2=class extends tb{static async from_pretrained(e,t={}){return t.model_file_name??(t.model_file_name="audio_model"),super.from_pretrained(e,t)}},J2=class extends ce{},ES=class extends J2{async _call(e){return new aO(await super._call(e))}},SS=class extends ce{},Z2=class extends SS{},Q2=class extends SS{},eO=class extends ce{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}},tO=class extends eO{},TS=class extends ce{},nO=class extends TS{},sO=class extends TS{async _call(e){return new Ke(await super._call(e))}},xt=class{static async from_pretrained(e,{quantized:t=!0,progress_callback:n=null,config:i=null,cache_dir:r=null,local_files_only:o=!1,revision:l="main",model_file_name:u=null}={}){let h={quantized:t,progress_callback:n,config:i,cache_dir:r,local_files_only:o,revision:l,model_file_name:u};if(i=await Eo.from_pretrained(e,h),h.config||(h.config=i),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);for(let d of this.MODEL_CLASS_MAPPINGS){let c=d.get(i.model_type);if(c)return await c[1].from_pretrained(e,h)}if(this.BASE_IF_FAIL)return console.warn(`Unknown model class "${i.model_type}", attempting to construct from base class.`),await ce.from_pretrained(e,h);throw Error(`Unsupported model type: ${i.model_type}`)}};J(xt,"MODEL_CLASS_MAPPINGS",null),J(xt,"BASE_IF_FAIL",!1);lH=new Map([["bert",["BertModel",HR]],["nomic_bert",["NomicBertModel",KR]],["roformer",["RoFormerModel",XR]],["electra",["ElectraModel",oP]],["esm",["EsmModel",RP]],["convbert",["ConvBertModel",tP]],["camembert",["CamembertModel",dP]],["deberta",["DebertaModel",mP]],["deberta-v2",["DebertaV2Model",wP]],["mpnet",["MPNetModel",UP]],["albert",["AlbertModel",YP]],["distilbert",["DistilBertModel",AP]],["roberta",["RobertaModel",gM]],["xlm",["XLMModel",_M]],["xlm-roberta",["XLMRobertaModel",TM]],["clap",["ClapModel",Y2]],["clip",["CLIPModel",NM]],["clipseg",["CLIPSegModel",zM]],["chinese_clip",["ChineseCLIPModel",VM]],["siglip",["SiglipModel",LM]],["mobilebert",["MobileBertModel",OP]],["squeezebert",["SqueezeBertModel",GP]],["wav2vec2",["Wav2Vec2Model",g2]],["wav2vec2-bert",["Wav2Vec2BertModel",A2]],["unispeech",["UniSpeechModel",v2]],["unispeech-sat",["UniSpeechSatModel",x2]],["hubert",["HubertModel",D2]],["wavlm",["WavLMModel",P2]],["audio-spectrogram-transformer",["ASTModel",kM]],["vits",["VitsModel",ES]],["detr",["DetrModel",kN]],["table-transformer",["TableTransformerModel",NN]],["vit",["ViTModel",pN]],["fastvit",["FastViTModel",mN]],["mobilevit",["MobileViTModel",_N]],["mobilevitv2",["MobileViTV2Model",xN]],["owlvit",["OwlViTModel",SN]],["owlv2",["Owlv2Model",AN]],["beit",["BeitModel",IN]],["deit",["DeiTModel",LN]],["convnext",["ConvNextModel",QN]],["convnextv2",["ConvNextV2Model",t2]],["dinov2",["Dinov2Model",s2]],["resnet",["ResNetModel",UN]],["swin",["SwinModel",VN]],["swin2sr",["Swin2SRModel",HN]],["donut-swin",["DonutSwinModel",ZN]],["yolos",["YolosModel",r2]],["dpt",["DPTModel",jN]],["glpn",["GLPNModel",KN]],["hifigan",["SpeechT5HifiGan",U2]],["efficientnet",["EfficientNetModel",nO]]]),cH=new Map([["t5",["T5Model",ZP]],["longt5",["LongT5Model",eM]],["mt5",["MT5Model",nM]],["bart",["BartModel",iM]],["mbart",["MBartModel",aM]],["marian",["MarianModel",d2]],["whisper",["WhisperModel",PM]],["m2m_100",["M2M100Model",f2]],["blenderbot",["BlenderbotModel",dM]],["blenderbot-small",["BlenderbotSmallModel",fM]]]),PZ=new Map([["bloom",["BloomModel",lN]],["gpt2",["GPT2Model",GM]],["gptj",["GPTJModel",XM]],["gpt_bigcode",["GPTBigCodeModel",ZM]],["gpt_neo",["GPTNeoModel",WM]],["gpt_neox",["GPTNeoXModel",YM]],["codegen",["CodeGenModel",eN]],["llama",["LlamaModel",nN]],["qwen2",["Qwen2Model",iN]],["phi",["PhiModel",oN]],["mpt",["MptModel",uN]],["opt",["OPTModel",hN]],["mistral",["MistralModel",z2]],["starcoder2",["Starcoder2Model",G2]],["falcon",["FalconModel",W2]]]),uO=new Map([["speecht5",["SpeechT5ForSpeechToText",L2]],["whisper",["WhisperForConditionalGeneration",MM]]]),uH=new Map([["speecht5",["SpeechT5ForTextToSpeech",$2]]]),dH=new Map([["vits",["VitsModel",ES]]]),hH=new Map([["bert",["BertForSequenceClassification",jR]],["roformer",["RoFormerForSequenceClassification",ZR]],["electra",["ElectraForSequenceClassification",lP]],["esm",["EsmForSequenceClassification",MP]],["convbert",["ConvBertForSequenceClassification",sP]],["camembert",["CamembertForSequenceClassification",fP]],["deberta",["DebertaForSequenceClassification",bP]],["deberta-v2",["DebertaV2ForSequenceClassification",EP]],["mpnet",["MPNetForSequenceClassification",VP]],["albert",["AlbertForSequenceClassification",KP]],["distilbert",["DistilBertForSequenceClassification",CP]],["roberta",["RobertaForSequenceClassification",yM]],["xlm",["XLMForSequenceClassification",xM]],["xlm-roberta",["XLMRobertaForSequenceClassification",CM]],["bart",["BartForSequenceClassification",oM]],["mbart",["MBartForSequenceClassification",cM]],["mobilebert",["MobileBertForSequenceClassification",LP]],["squeezebert",["SqueezeBertForSequenceClassification",WP]]]),fH=new Map([["bert",["BertForTokenClassification",WR]],["roformer",["RoFormerForTokenClassification",QR]],["electra",["ElectraForTokenClassification",cP]],["esm",["EsmForTokenClassification",NP]],["convbert",["ConvBertForTokenClassification",iP]],["camembert",["CamembertForTokenClassification",pP]],["deberta",["DebertaForTokenClassification",vP]],["deberta-v2",["DebertaV2ForTokenClassification",SP]],["mpnet",["MPNetForTokenClassification",zP]],["distilbert",["DistilBertForTokenClassification",IP]],["roberta",["RobertaForTokenClassification",bM]],["xlm",["XLMForTokenClassification",EM]],["xlm-roberta",["XLMRobertaForTokenClassification",IM]]]),dO=new Map([["t5",["T5ForConditionalGeneration",QP]],["longt5",["LongT5ForConditionalGeneration",tM]],["mt5",["MT5ForConditionalGeneration",sM]],["bart",["BartForConditionalGeneration",rM]],["mbart",["MBartForConditionalGeneration",lM]],["marian",["MarianMTModel",h2]],["m2m_100",["M2M100ForConditionalGeneration",p2]],["blenderbot",["BlenderbotForConditionalGeneration",hM]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",pM]]]),AS=new Map([["bloom",["BloomForCausalLM",cN]],["gpt2",["GPT2LMHeadModel",jM]],["gptj",["GPTJForCausalLM",JM]],["gpt_bigcode",["GPTBigCodeForCausalLM",QM]],["gpt_neo",["GPTNeoForCausalLM",qM]],["gpt_neox",["GPTNeoXForCausalLM",KM]],["codegen",["CodeGenForCausalLM",tN]],["llama",["LlamaForCausalLM",sN]],["qwen2",["Qwen2ForCausalLM",rN]],["phi",["PhiForCausalLM",aN]],["mpt",["MptForCausalLM",dN]],["opt",["OPTForCausalLM",fN]],["mbart",["MBartForCausalLM",uM]],["mistral",["MistralForCausalLM",H2]],["starcoder2",["Starcoder2ForCausalLM",j2]],["falcon",["FalconForCausalLM",q2]],["trocr",["TrOCRForCausalLM",V2]],["stablelm",["StableLmForCausalLM",tO]]]),pH=new Map([["bert",["BertForMaskedLM",GR]],["roformer",["RoFormerForMaskedLM",JR]],["electra",["ElectraForMaskedLM",aP]],["esm",["EsmForMaskedLM",PP]],["convbert",["ConvBertForMaskedLM",nP]],["camembert",["CamembertForMaskedLM",hP]],["deberta",["DebertaForMaskedLM",yP]],["deberta-v2",["DebertaV2ForMaskedLM",xP]],["mpnet",["MPNetForMaskedLM",BP]],["albert",["AlbertForMaskedLM",JP]],["distilbert",["DistilBertForMaskedLM",kP]],["roberta",["RobertaForMaskedLM",mM]],["xlm",["XLMWithLMHeadModel",wM]],["xlm-roberta",["XLMRobertaForMaskedLM",AM]],["mobilebert",["MobileBertForMaskedLM",FP]],["squeezebert",["SqueezeBertForMaskedLM",jP]]]),gH=new Map([["bert",["BertForQuestionAnswering",qR]],["roformer",["RoFormerForQuestionAnswering",eP]],["electra",["ElectraForQuestionAnswering",uP]],["convbert",["ConvBertForQuestionAnswering",rP]],["camembert",["CamembertForQuestionAnswering",gP]],["deberta",["DebertaForQuestionAnswering",_P]],["deberta-v2",["DebertaV2ForQuestionAnswering",TP]],["mpnet",["MPNetForQuestionAnswering",HP]],["albert",["AlbertForQuestionAnswering",XP]],["distilbert",["DistilBertForQuestionAnswering",DP]],["roberta",["RobertaForQuestionAnswering",vM]],["xlm",["XLMForQuestionAnswering",SM]],["xlm-roberta",["XLMRobertaForQuestionAnswering",DM]],["mobilebert",["MobileBertForQuestionAnswering",$P]],["squeezebert",["SqueezeBertForQuestionAnswering",qP]]]),hO=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",LE]]]),MZ=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",LE]]]),mH=new Map([["vit",["ViTForImageClassification",gN]],["fastvit",["FastViTForImageClassification",yN]],["mobilevit",["MobileViTForImageClassification",wN]],["mobilevitv2",["MobileViTV2ForImageClassification",EN]],["beit",["BeitForImageClassification",DN]],["deit",["DeiTForImageClassification",$N]],["convnext",["ConvNextForImageClassification",e2]],["convnextv2",["ConvNextV2ForImageClassification",n2]],["dinov2",["Dinov2ForImageClassification",i2]],["resnet",["ResNetForImageClassification",BN]],["swin",["SwinForImageClassification",zN]],["segformer",["SegformerForImageClassification",Z2]],["efficientnet",["EfficientNetForImageClassification",sO]]]),yH=new Map([["detr",["DetrForObjectDetection",RN]],["table-transformer",["TableTransformerForObjectDetection",ON]],["yolos",["YolosForObjectDetection",o2]]]),bH=new Map([["owlvit",["OwlViTForObjectDetection",TN]],["owlv2",["Owlv2ForObjectDetection",CN]]]),vH=new Map([["detr",["DetrForSegmentation",PN]],["clipseg",["CLIPSegForImageSegmentation",HM]]]),_H=new Map([["segformer",["SegformerForSemanticSegmentation",Q2]]]),NZ=new Map([["sam",["SamModel",c2]]]),wH=new Map([["wav2vec2",["Wav2Vec2ForCTC",m2]],["wav2vec2-bert",["Wav2Vec2BertForCTC",C2]],["unispeech",["UniSpeechForCTC",_2]],["unispeech-sat",["UniSpeechSatForCTC",E2]],["wavlm",["WavLMForCTC",M2]],["hubert",["HubertForCTC",k2]]]),xH=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",y2]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",I2]],["unispeech",["UniSpeechForSequenceClassification",w2]],["unispeech-sat",["UniSpeechSatForSequenceClassification",S2]],["wavlm",["WavLMForSequenceClassification",N2]],["hubert",["HubertForSequenceClassification",R2]],["audio-spectrogram-transformer",["ASTForAudioClassification",RM]]]),OZ=new Map([["wavlm",["WavLMForXVector",O2]]]),FZ=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",T2]],["wavlm",["WavLMForAudioFrameClassification",F2]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",b2]]]),LZ=new Map([["vitmatte",["VitMatteForImageMatting",vN]]]),EH=new Map([["swin2sr",["Swin2SRForImageSuperResolution",GN]]]),SH=new Map([["dpt",["DPTForDepthEstimation",WN]],["depth_anything",["DepthAnythingForDepthEstimation",YN]],["glpn",["GLPNForDepthEstimation",XN]]]),TH=new Map([["clip",["CLIPVisionModelWithProjection",FM]],["siglip",["SiglipVisionModel",UM]]]),AH=[[lH,$e.EncoderOnly],[cH,$e.EncoderDecoder],[PZ,$e.DecoderOnly],[hH,$e.EncoderOnly],[fH,$e.EncoderOnly],[dO,$e.Seq2Seq],[uO,$e.Seq2Seq],[AS,$e.DecoderOnly],[pH,$e.EncoderOnly],[gH,$e.EncoderOnly],[hO,$e.Vision2Seq],[mH,$e.EncoderOnly],[vH,$e.EncoderOnly],[_H,$e.EncoderOnly],[LZ,$e.EncoderOnly],[EH,$e.EncoderOnly],[SH,$e.EncoderOnly],[yH,$e.EncoderOnly],[bH,$e.EncoderOnly],[NZ,$e.MaskGeneration],[wH,$e.EncoderOnly],[xH,$e.EncoderOnly],[uH,$e.Seq2Seq],[dH,$e.EncoderOnly],[OZ,$e.EncoderOnly],[FZ,$e.EncoderOnly],[TH,$e.EncoderOnly]];for(let[s,e]of AH)for(let[t,n]of s.values())DE.set(t,e),ky.set(n,t),rH.set(t,n);$Z=[["CLIPTextModelWithProjection",OM,$e.EncoderOnly],["SiglipTextModel",$M,$e.EncoderOnly],["ClapTextModelWithProjection",K2,$e.EncoderOnly],["ClapAudioModelWithProjection",X2,$e.EncoderOnly]];for(let[s,e,t]of $Z)DE.set(s,t),ky.set(e,s),rH.set(s,e);_r=class extends xt{};J(_r,"MODEL_CLASS_MAPPINGS",AH.map(e=>e[0])),J(_r,"BASE_IF_FAIL",!0);Jh=class extends xt{};J(Jh,"MODEL_CLASS_MAPPINGS",[hH]);Ry=class extends xt{};J(Ry,"MODEL_CLASS_MAPPINGS",[fH]);ru=class extends xt{};J(ru,"MODEL_CLASS_MAPPINGS",[dO]);Py=class extends xt{};J(Py,"MODEL_CLASS_MAPPINGS",[uO]);My=class extends xt{};J(My,"MODEL_CLASS_MAPPINGS",[uH]);Ny=class extends xt{};J(Ny,"MODEL_CLASS_MAPPINGS",[dH]);Oy=class extends xt{};J(Oy,"MODEL_CLASS_MAPPINGS",[AS]);Fy=class extends xt{};J(Fy,"MODEL_CLASS_MAPPINGS",[pH]);Ly=class extends xt{};J(Ly,"MODEL_CLASS_MAPPINGS",[gH]);$y=class extends xt{};J($y,"MODEL_CLASS_MAPPINGS",[hO]);Uy=class extends xt{};J(Uy,"MODEL_CLASS_MAPPINGS",[mH]);By=class extends xt{};J(By,"MODEL_CLASS_MAPPINGS",[vH]);Vy=class extends xt{};J(Vy,"MODEL_CLASS_MAPPINGS",[_H]);zy=class extends xt{};J(zy,"MODEL_CLASS_MAPPINGS",[yH]);Hy=class extends xt{};J(Hy,"MODEL_CLASS_MAPPINGS",[bH]);Gy=class extends xt{};J(Gy,"MODEL_CLASS_MAPPINGS",[wH]);jy=class extends xt{};J(jy,"MODEL_CLASS_MAPPINGS",[xH]);Wy=class extends xt{};J(Wy,"MODEL_CLASS_MAPPINGS",[MZ]);qy=class extends xt{};J(qy,"MODEL_CLASS_MAPPINGS",[EH]);Yy=class extends xt{};J(Yy,"MODEL_CLASS_MAPPINGS",[SH]);Ky=class extends xt{};J(Ky,"MODEL_CLASS_MAPPINGS",[TH]);iO=class extends ss{constructor({logits:e,past_key_values:t,encoder_outputs:n,decoder_attentions:i=null,cross_attentions:r=null}){super(),this.logits=e,this.past_key_values=t,this.encoder_outputs=n,this.decoder_attentions=i,this.cross_attentions=r}},Ke=class extends ss{constructor({logits:e}){super(),this.logits=e}},rO=class extends ss{constructor({logits:e,embeddings:t}){super(),this.logits=e,this.embeddings=t}},wn=class extends ss{constructor({logits:e}){super(),this.logits=e}},xn=class extends ss{constructor({logits:e}){super(),this.logits=e}},Nn=class extends ss{constructor({start_logits:e,end_logits:t}){super(),this.start_logits=e,this.end_logits=t}},Wa=class extends ss{constructor({logits:e}){super(),this.logits=e}},oO=class extends ss{constructor({alphas:e}){super(),this.alphas=e}},aO=class extends ss{constructor({waveform:e,spectrogram:t}){super(),this.waveform=e,this.spectrogram=t}}});var CH=pb(()=>{});var CS,Ni,UZ,vu,IH,qa,BZ,VZ,To,IS=tn(()=>{Qc();Kx();Ha();CS=Io(CH(),1),Ni=typeof self<"u",UZ=Ni&&self.constructor.name==="DedicatedWorkerGlobalScope";if(Ni)vu=(s,e)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(s,e)},qa=self.createImageBitmap,IH=self.ImageData;else if(CS.default)qa=async s=>{let t=(await s.metadata()).channels,{data:n,info:i}=await s.rotate().raw().toBuffer({resolveWithObject:!0}),r=new To(new Uint8ClampedArray(n),i.width,i.height,i.channels);return t!==void 0&&t!==i.channels&&r.convert(t),r};else throw new Error("Unable to load image processing library.");BZ={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},VZ=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]),To=class s{constructor(e,t,n,i){this.data=e,this.width=t,this.height=n,this.channels=i}get size(){return[this.width,this.height]}static async read(e){if(e instanceof s)return e;if(typeof e=="string"||e instanceof URL)return await this.fromURL(e);throw new Error(`Unsupported input type: ${typeof e}`)}static async fromURL(e){let t=await Wh(e);if(t.status!==200)throw new Error(`Unable to read image from "${e}" (${t.status} ${t.statusText})`);let n=await t.blob();return this.fromBlob(n)}static async fromBlob(e){if(Ni){let t=await qa(e),n=vu(t.width,t.height).getContext("2d");return n.drawImage(t,0,0),new this(n.getImageData(0,0,t.width,t.height).data,t.width,t.height,4)}else{let t=(0,CS.default)(await e.arrayBuffer());return await qa(t)}}static fromTensor(e,t="CHW"){if(e.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${e.dims.length} dimensions.`);if(t==="CHW")e=e.transpose(1,2,0);else if(t!=="HWC")throw new Error(`Unsupported channel format: ${t}`);if(!(e.data instanceof Uint8ClampedArray||e.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${e.type}`);switch(e.dims[2]){case 1:case 2:case 3:case 4:return new s(e.data,e.dims[1],e.dims[0],e.dims[2]);default:throw new Error(`Unsupported number of channels: ${e.dims[2]}`)}}grayscale(){if(this.channels===1)return this;let e=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let t=0,n=0;t<this.data.length;t+=this.channels){let i=this.data[t],r=this.data[t+1],o=this.data[t+2];e[n++]=Math.round(.2989*i+.587*r+.114*o)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,1)}rgb(){if(this.channels===3)return this;let e=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let t=0,n=0;t<this.data.length;++t)e[n++]=this.data[t],e[n++]=this.data[t],e[n++]=this.data[t];break;case 4:for(let t=0,n=0;t<this.data.length;t+=4)e[n++]=this.data[t],e[n++]=this.data[t+1],e[n++]=this.data[t+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,3)}rgba(){if(this.channels===4)return this;let e=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let t=0,n=0;t<this.data.length;++t)e[n++]=this.data[t],e[n++]=this.data[t],e[n++]=this.data[t],e[n++]=255;break;case 3:for(let t=0,n=0;t<this.data.length;t+=3)e[n++]=this.data[t],e[n++]=this.data[t+1],e[n++]=this.data[t+2],e[n++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,4)}async resize(e,t,{resample:n=2}={}){let i=BZ[n]??n;if(Ni){let r=this.channels,o=this.toCanvas(),l=vu(e,t).getContext("2d");return l.drawImage(o,0,0,e,t),new s(l.getImageData(0,0,e,t).data,e,t,4).convert(r)}else{let r=this.toSharp();switch(i){case"box":case"hamming":(i==="box"||i==="hamming")&&(console.warn(`Resampling method ${i} is not yet supported. Using bilinear instead.`),i="bilinear");case"nearest":case"bilinear":case"bicubic":r=r.affine([e/this.width,0,0,t/this.height],{interpolator:i});break;case"lanczos":r=r.resize({width:e,height:t,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${i} is not supported.`)}return await qa(r)}}async pad([e,t,n,i]){if(e=Math.max(e,0),t=Math.max(t,0),n=Math.max(n,0),i=Math.max(i,0),e===0&&t===0&&n===0&&i===0)return this;if(Ni){let r=this.channels,o=this.toCanvas(),l=this.width+e+t,u=this.height+n+i,h=vu(l,u).getContext("2d");return h.drawImage(o,0,0,this.width,this.height,e,n,l,u),new s(h.getImageData(0,0,l,u).data,l,u,4).convert(r)}else{let r=this.toSharp().extend({left:e,right:t,top:n,bottom:i});return await qa(r)}}async crop([e,t,n,i]){if(e=Math.max(e,0),t=Math.max(t,0),n=Math.min(n,this.width-1),i=Math.min(i,this.height-1),e===0&&t===0&&n===this.width-1&&i===this.height-1)return this;let r=n-e+1,o=i-t+1;if(Ni){let l=this.channels,u=this.toCanvas(),h=vu(r,o).getContext("2d");return h.drawImage(u,e,t,r,o,0,0,r,o),new s(h.getImageData(0,0,r,o).data,r,o,4).convert(l)}else{let l=this.toSharp().extract({left:e,top:t,width:r,height:o});return await qa(l)}}async center_crop(e,t){if(this.width===e&&this.height===t)return this;let n=(this.width-e)/2,i=(this.height-t)/2;if(Ni){let r=this.channels,o=this.toCanvas(),l=vu(e,t).getContext("2d"),u=0,h=0,d=0,c=0;return n>=0?u=n:d=-n,i>=0?h=i:c=-i,l.drawImage(o,u,h,e,t,d,c,e,t),new s(l.getImageData(0,0,e,t).data,e,t,4).convert(r)}else{let r=this.toSharp();if(n>=0&&i>=0)r=r.extract({left:Math.floor(n),top:Math.floor(i),width:e,height:t});else if(n<=0&&i<=0){let o=Math.floor(-i),l=Math.floor(-n);r=r.extend({top:o,left:l,right:e-this.width-l,bottom:t-this.height-o})}else{let o=[0,0],l=0;i<0?(o[0]=Math.floor(-i),o[1]=t-this.height-o[0]):l=Math.floor(i);let u=[0,0],h=0;n<0?(u[0]=Math.floor(-n),u[1]=e-this.width-u[0]):h=Math.floor(n),r=r.extend({top:o[0],bottom:o[1],left:u[0],right:u[1]}).extract({left:h,top:l,width:e,height:t})}return await qa(r)}}async toBlob(e="image/png",t=1){if(!Ni)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:e,quality:t})}toTensor(e="CHW"){let t=new pe("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(e!=="HWC")if(e==="CHW")t=t.permute(2,0,1);else throw new Error(`Unsupported channel format: ${e}`);return t}toCanvas(){if(!Ni)throw new Error("toCanvas() is only supported in browser environments.");let e=this.clone().rgba(),t=vu(e.width,e.height),n=new IH(e.data,e.width,e.height);return t.getContext("2d").putImageData(n,0,0),t}_update(e,t,n,i=null){return this.data=e,this.width=t,this.height=n,i!==null&&(this.channels=i),this}clone(){return new s(this.data.slice(),this.width,this.height,this.channels)}convert(e){if(this.channels===e)return this;switch(e){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(e){if(Ni){if(UZ)throw new Error("Unable to save an image from a Web Worker.");let t=e.split(".").pop().toLowerCase(),n=VZ.get(t)??"image/png",i=await this.toBlob(n),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download=e,o.click(),o.remove()}else{if(mt.useFS)return await this.toSharp().toFile(e);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(Ni)throw new Error("toSharp() is only supported in server-side environments.");return(0,CS.default)(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}});async function RH(s,e){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");let t=await(await Wh(s)).arrayBuffer(),n=new AudioContext({sampleRate:e});typeof e>"u"&&console.warn(`No sampling rate provided, using default of ${n.sampleRate}Hz.`);let i=await n.decodeAudioData(t),r;if(i.numberOfChannels===2){let o=Math.sqrt(2),l=i.getChannelData(0),u=i.getChannelData(1);r=new Float32Array(l.length);for(let h=0;h<i.length;++h)r[h]=o*(l[h]+u[h])/2}else r=i.getChannelData(0);return r}function DH(s){if(s<1)return new Float64Array;if(s===1)return new Float64Array([1]);let e=s-1,t=Math.PI/e,n=new Float64Array(s);for(let i=0;i<s;++i){let r=2*i-e;n[i]=.5+.5*Math.cos(t*r)}return n}function gO(s,e="htk"){let t=zZ[e];if(!t)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof s=="number"?t(s):s.map(n=>t(n))}function GZ(s,e="htk"){let t=HZ[e];if(!t)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof s=="number"?t(s):s.map(n=>t(n))}function jZ(s,e){let t=Float64Array.from({length:e.length-1},(o,l)=>e[l+1]-e[l]),n=Array.from({length:s.length},()=>new Array(e.length));for(let o=0;o<s.length;++o){let l=n[o];for(let u=0;u<e.length;++u)l[u]=e[u]-s[o]}let i=e.length-2,r=Array.from({length:i},()=>new Array(s.length));for(let o=0;o<s.length;++o){let l=n[o];for(let u=0;u<i;++u){let h=-l[u]/t[u],d=l[u+2]/t[u+1];r[u][o]=Math.max(0,Math.min(h,d))}}return r}function kH(s,e,t){let n=(e-s)/(t-1);return Float64Array.from({length:t},(i,r)=>s+n*r)}function af(s,e,t,n,i,r=null,o="htk",l=!1){if(r!==null&&r!=="slaney")throw new Error('norm must be one of null or "slaney"');let u=gO(t,o),h=gO(n,o),d=kH(u,h,e+2),c=GZ(d,o),a;if(l){let p=i/(s*2);a=gO(Float64Array.from({length:s},(g,m)=>m*p),o),c=d}else a=kH(0,Math.floor(i/2),s);let f=jZ(a,c);if(r!==null&&r==="slaney")for(let p=0;p<e;++p){let g=f[p],m=2/(c[p+2]-c[p]);for(let y=0;y<s;++y)g[y]*=m}return f}function WZ(s,e,t){let n=new s.constructor(s.length+e+t),i=s.length-1;for(let r=0;r<s.length;++r)n[e+r]=s[r];for(let r=1;r<=e;++r)n[e-r]=s[jh(r,i)];for(let r=1;r<=t;++r)n[i+e+r]=s[jh(i-r,i)];return n}function PH(s,e,t,n,i){if(t<=0)throw new Error("reference must be greater than zero");if(n<=0)throw new Error("min_value must be greater than zero");t=Math.max(n,t);let r=Math.log10(t);for(let o=0;o<s.length;++o)s[o]=e*Math.log10(Math.max(n,s[o])-r);if(i!==null){if(i<=0)throw new Error("db_range must be greater than zero");let o=Mn(s)[0]-i;for(let l=0;l<s.length;++l)s[l]=Math.max(s[l],o)}return s}function qZ(s,e=1,t=1e-5,n=null){return PH(s,20,e,t,n)}function YZ(s,e=1,t=1e-10,n=null){return PH(s,10,e,t,n)}function nb(s,e,t,n,{fft_length:i=null,power:r=1,center:o=!0,pad_mode:l="reflect",onesided:u=!0,preemphasis:h=null,mel_filters:d=null,mel_floor:c=1e-10,log_mel:a=null,reference:f=1,min_value:p=1e-10,db_range:g=null,remove_dc_offset:m=null,max_num_frames:y=null,do_pad:_=!0,transpose:x=!1}={}){let E=e.length;if(i===null&&(i=t),t>i)throw Error(`frame_length (${t}) may not be larger than fft_length (${i})`);if(E!==t)throw new Error(`Length of the window (${E}) must equal frame_length (${t})`);if(n<=0)throw new Error("hop_length must be greater than zero");if(r===null&&d!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(o){if(l!=="reflect")throw new Error(`pad_mode="${l}" not implemented yet.`);let M=Math.floor((i-1)/2)+1;s=WZ(s,M,M)}let S=Math.floor(1+Math.floor((s.length-t)/n)),T=u?Math.floor(i/2)+1:i,C=S,I=S;y!==null&&(y>S?_&&(I=y):I=C=y);let A=new tE(i),P=new Float64Array(i),F=new Float64Array(A.outputBufferSize),H=new Array(C);for(let M=0;M<C;++M){let $=M*n;for(let Z=0;Z<t;++Z)P[Z]=s[$+Z];if(m){let Z=0;for(let ae=0;ae<t;++ae)Z+=P[ae];let le=Z/t;for(let ae=0;ae<t;++ae)P[ae]-=le}if(h!==null){for(let Z=t-1;Z>=1;--Z)P[Z]-=h*P[Z-1];P[0]*=1-h}for(let Z=0;Z<e.length;++Z)P[Z]*=e[Z];A.realTransform(F,P);let oe=new Array(T);for(let Z=0;Z<oe.length;++Z){let le=Z<<1;oe[Z]=F[le]**2+F[le+1]**2}H[M]=oe}if(r!==null&&r!==2){let M=2/r;for(let $=0;$<H.length;++$){let oe=H[$];for(let Z=0;Z<oe.length;++Z)oe[Z]**=M}}let z=d.length,B=new Float32Array(z*I),V=x?[I,z]:[z,I];for(let M=0;M<z;++M){let $=d[M];for(let oe=0;oe<C;++oe){let Z=H[oe],le=0;for(let ae=0;ae<T;++ae)le+=$[ae]*Z[ae];B[x?oe*z+M:M*C+oe]=Math.max(c,le)}}if(r!==null&&a!==null){let M=Math.min(B.length,C*z);switch(a){case"log":for(let $=0;$<M;++$)B[$]=Math.log(B[$]);break;case"log10":for(let $=0;$<M;++$)B[$]=Math.log10(B[$]);break;case"dB":if(r===1)qZ(B,f,p,g);else if(r===2)YZ(B,f,p,g);else throw new Error(`Cannot use log_mel option '${a}' with power ${r}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${a}'`)}}return{data:B,dims:V}}function sb(s,e,{periodic:t=!0,frame_length:n=null,center:i=!0}={}){let r=t?s+1:s,o;switch(e){case"boxcar":o=new Float64Array(r).fill(1);break;case"hann":case"hann_window":o=DH(r);break;case"povey":o=DH(r).map(l=>Math.pow(l,.85));break;default:throw new Error(`Unknown window type ${e}.`)}if(t&&(o=o.subarray(0,s)),n===null)return o;if(s>n)throw new Error(`Length of the window (${s}) may not be larger than frame_length (${n})`);return o}var zZ,HZ,DS=tn(()=>{Qc();Va();$a();zZ={htk:s=>2595*Math.log10(1+s/700),kaldi:s=>1127*Math.log(1+s/700),slaney:(s,e=1e3,t=15,n=27/Math.log(6.4))=>s>=e?t+Math.log(s/e)*n:3*s/200};HZ={htk:s=>700*(10**(s/2595)-1),kaldi:s=>700*(Math.exp(s/1127)-1),slaney:(s,e=1e3,t=15,n=Math.log(6.4)/27)=>s>=t?e*Math.exp(n*(s-t)):200*s/3}});function KZ([s,e,t,n]){return[s-t/2,e-n/2,s+t/2,e+n/2]}function KO(s,e=.5,t=null,n=!1){let i=s.logits,r=s.pred_boxes,[o,l,u]=i.dims;if(t!==null&&t.length!==o)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let h=[];for(let d=0;d<o;++d){let c=t!==null?t[d]:null,a={boxes:[],classes:[],scores:[]},f=i[d],p=r[d];for(let g=0;g<l;++g){let m=f[g],y=[],_;if(n){_=m.sigmoid().data;for(let x=0;x<_.length;++x)_[x]>e&&y.push(x)}else{let x=Mn(m.data)[1];if(x===u-1)continue;y.push(x),_=cn(m.data)}for(let x of y){let E=p[g].data;E=KZ(E),c!==null&&(E=E.map((S,T)=>S*c[(T+1)%2])),a.boxes.push(E),a.classes.push(x),a.scores.push(_[x])}}h.push(a)}return h}function ib(s,e){if(!(s instanceof Float32Array||s instanceof Float64Array))throw new Error(`${e} expects input to be a Float32Array or a Float64Array, but got ${s?.constructor?.name??typeof s} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}function MH(s,e,t=0,n=null){let i=s/e,r=R4(i)*e;return n!==null&&r>n&&(r=Math.floor(i)*e),r<t&&(r=Math.ceil(i)*e),r}function mO([s,e],t){return[Math.max(Math.floor(s/t),1)*t,Math.max(Math.floor(e/t),1)*t]}var Ao,Tt,yO,kS,bO,vO,_O,wO,xO,EO,RS,SO,TO,AO,CO,PS,IO,MS,DO,kO,RO,NS,PO,MO,NO,OO,FO,LO,$O,UO,BO,VO,zO,HO,Ya,GO,jO,WO,qO,YO,un,XO=tn(()=>{$a();Qc();Va();Ha();IS();DS();Ao=class extends _n{constructor(e){super(),this.config=e}},Tt=class extends Ao{constructor(e){super(e),this.image_mean=this.config.image_mean??this.config.mean,this.image_std=this.config.image_std??this.config.std,this.resample=this.config.resample??2,this.do_rescale=this.config.do_rescale??!0,this.rescale_factor=this.config.rescale_factor??1/255,this.do_normalize=this.config.do_normalize,this.do_resize=this.config.do_resize,this.do_thumbnail=this.config.do_thumbnail,this.size=this.config.size,this.size_divisibility=this.config.size_divisibility??this.config.size_divisor,this.do_center_crop=this.config.do_center_crop,this.crop_size=this.config.crop_size,this.do_convert_rgb=this.config.do_convert_rgb??!0,this.do_crop_margin=this.config.do_crop_margin,this.pad_size=this.config.pad_size,this.do_pad=this.config.do_pad,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=this.config.do_flip_channel_order??!1}async thumbnail(e,t,n=2){let i=e.height,r=e.width,o=t.height,l=t.width,u=Math.min(i,o),h=Math.min(r,l);return u===i&&h===r?e:(i>r?h=Math.floor(r*u/i):r>i&&(u=Math.floor(i*h/r)),await e.resize(h,u,{resample:n}))}async crop_margin(e,t=200){let n=e.clone().grayscale(),i=nE(n.data)[0],o=Mn(n.data)[0]-i;if(o===0)return e;let l=t/255,u=n.width,h=n.height,d=0,c=0;for(let a=0;a<n.height;++a){let f=a*n.width;for(let p=0;p<n.width;++p)(n.data[f+p]-i)/o<l&&(u=Math.min(u,p),h=Math.min(h,a),d=Math.max(d,p),c=Math.max(c,a))}return e=await e.crop([u,h,d,c]),e}pad_image(e,t,n,{mode:i="constant",center:r=!1,constant_values:o=0}={}){let[l,u,h]=t,d,c;if(typeof n=="number"?(d=n,c=n):(d=n.width,c=n.height),d!==u||c!==l){let a=new Float32Array(d*c*h);if(Array.isArray(o))for(let g=0;g<a.length;++g)a[g]=o[g%h];else o!==0&&a.fill(o);let[f,p]=r?[Math.floor((d-u)/2),Math.floor((c-l)/2)]:[0,0];for(let g=0;g<l;++g){let m=(g+p)*d,y=g*u;for(let _=0;_<u;++_){let x=(m+_+f)*h,E=(y+_)*h;for(let S=0;S<h;++S)a[x+S]=e[E+S]}}if(i==="symmetric"){if(r)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");let g=l-1,m=u-1;for(let y=0;y<c;++y){let _=y*d,x=jh(y,g)*u;for(let E=0;E<d;++E){if(y<l&&E<u)continue;let S=(_+E)*h,T=(x+jh(E,m))*h;for(let C=0;C<h;++C)a[S+C]=e[T+C]}}}e=a,t=[c,d,h]}return[e,t]}rescale(e){for(let t=0;t<e.length;++t)e[t]=this.rescale_factor*e[t]}get_resize_output_image_size(e,t){let[n,i]=e.size,r,o;if(this.do_thumbnail){let{height:l,width:u}=t;r=Math.min(l,u)}else Number.isInteger(t)?(r=t,o=this.config.max_size??r):t!==void 0&&(r=t.shortest_edge,o=t.longest_edge);if(r!==void 0||o!==void 0){let l=r===void 0?1:Math.max(r/n,r/i),u=n*l,h=i*l,d=o===void 0?1:Math.min(o/u,o/h),c=Math.floor(Number((u*d).toFixed(2))),a=Math.floor(Number((h*d).toFixed(2)));return this.size_divisibility!==void 0&&([c,a]=mO([c,a],this.size_divisibility)),[c,a]}else if(t!==void 0&&t.width!==void 0&&t.height!==void 0){let l=t.width,u=t.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let h=u/i,d=l/n;Math.abs(1-d)<Math.abs(1-h)?h=d:d=h,u=MH(h*i,this.config.ensure_multiple_of),l=MH(d*n,this.config.ensure_multiple_of)}return[l,u]}else{if(this.size_divisibility!==void 0)return mO([n,i],this.size_divisibility);throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(t)}`)}}async resize(e){let[t,n]=this.get_resize_output_image_size(e,this.size);return await e.resize(t,n,{resample:this.resample})}async preprocess(e,{do_normalize:t=null,do_pad:n=null,do_convert_rgb:i=null,do_convert_grayscale:r=null,do_flip_channel_order:o=null}={}){this.do_crop_margin&&(e=await this.crop_margin(e));let[l,u]=e.size;if(i??this.do_convert_rgb?e=e.rgb():r&&(e=e.grayscale()),this.do_resize&&(e=await this.resize(e)),this.do_thumbnail&&(e=await this.thumbnail(e,this.size,this.resample)),this.do_center_crop){let f,p;Number.isInteger(this.crop_size)?(f=this.crop_size,p=this.crop_size):(f=this.crop_size.width,p=this.crop_size.height),e=await e.center_crop(f,p)}let h=[e.height,e.width],d=Float32Array.from(e.data),c=[e.height,e.width,e.channels];if(this.do_rescale&&this.rescale(d),t??this.do_normalize){let f=this.image_mean;Array.isArray(this.image_mean)||(f=new Array(e.channels).fill(f));let p=this.image_std;if(Array.isArray(this.image_std)||(p=new Array(e.channels).fill(f)),f.length!==e.channels||p.length!==e.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${f.length}) and \`image_std\` (${p.length}) must match the number of channels in the image (${e.channels}).`);for(let g=0;g<d.length;g+=e.channels)for(let m=0;m<e.channels;++m)d[g+m]=(d[g+m]-f[m])/p[m]}if(n??this.do_pad){if(this.pad_size)[d,c]=this.pad_image(d,[e.height,e.width,e.channels],this.pad_size);else if(this.size_divisibility){let[f,p]=mO([c[1],c[0]],this.size_divisibility);[d,c]=this.pad_image(d,c,{width:f,height:p})}}if(o??this.do_flip_channel_order){if(c[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let f=0;f<d.length;f+=3){let p=d[f];d[f]=d[f+2],d[f+2]=p}}let a=new pe("float32",d,c).permute(2,0,1);return{original_size:[u,l],reshaped_input_size:h,pixel_values:a}}async _call(e,...t){Array.isArray(e)||(e=[e]);let n=await Promise.all(e.map(r=>this.preprocess(r)));return{pixel_values:Yh(n.map(r=>r.pixel_values),0),original_sizes:n.map(r=>r.original_size),reshaped_input_sizes:n.map(r=>r.reshaped_input_size)}}},yO=class extends Tt{post_process_semantic_segmentation(e,t=null){let n=e.logits,i=n.dims[0];if(t!==null&&t.length!==i)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let r=[];for(let o=0;o<i;++o){let l=t!==null?t[o]:null,u=n[o];l!==null&&(u=tu(u,l,"bilinear",!1));let[h,d]=l??u.dims.slice(-2),c=new pe("int32",new Int32Array(h*d),[h,d]),a=u[0].data;for(let m=1;m<u.dims[0];++m){let y=u[m].data;for(let _=0;_<y.length;++_)y[_]>a[_]&&(a[_]=y[_],c.data[_]=m)}let f=new Array(u.dims[0]),p=c.data;for(let m=0;m<p.length;++m){let y=p[m];f[y]=y}let g=f.filter(m=>m!==void 0);r.push({segmentation:c,labels:g})}return r}},kS=class extends Tt{},bO=class extends kS{},vO=class extends Tt{},_O=class extends Tt{},wO=class extends Tt{},xO=class extends Tt{},EO=class extends Tt{},RS=class extends Tt{constructor(e){super(e),this.crop_pct=this.config.crop_pct??224/256}async resize(e){let t=this.size?.shortest_edge;if(t===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(t<384){let n=Math.floor(t/this.crop_pct),[i,r]=this.get_resize_output_image_size(e,{shortest_edge:n});e=await e.resize(i,r,{resample:this.resample}),e=await e.center_crop(t,t)}else e=await e.resize(t,t,{resample:this.resample});return e}},SO=class extends RS{},TO=class extends Tt{},AO=class extends Tt{},CO=class extends Tt{constructor(e){super(e),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(t=>t*t))}},PS=class extends Tt{},IO=class extends PS{},MS=class extends Tt{post_process_object_detection(...e){return KO(...e)}},DO=class extends MS{},kO=class extends Tt{},RO=class extends Tt{},NS=class extends Tt{pad_image(e,t,n,i={}){let[r,o,l]=t,u=this.image_mean;Array.isArray(this.image_mean)||(u=new Array(l).fill(u));let h=this.image_std;Array.isArray(h)||(h=new Array(l).fill(u));let d=u.map((c,a)=>-c/h[a]);return super.pad_image(e,t,n,{center:!0,constant_values:d,...i})}},PO=class extends NS{},MO=class extends Tt{async _call(e){let t=await super._call(e),n=[t.pixel_values.dims[0],64,64],i=new pe("int64",new BigInt64Array(n.reduce((r,o)=>r*o)).fill(1n),n);return{...t,pixel_mask:i}}post_process_object_detection(...e){return KO(...e)}remove_low_and_no_objects(e,t,n,i){let r=[],o=[],l=[];for(let u=0;u<e.dims[0];++u){let h=e[u],d=t[u],c=Mn(h.data)[1];if(c===i)continue;let f=cn(h.data)[c];f>n&&(r.push(d),o.push(f),l.push(c))}return[r,o,l]}check_segment_validity(e,t,n,i=.5,r=.8){let o=[],l=0,u=0;for(let d=0;d<e.length;++d)e[d]===n&&(o.push(d),++l),t[n].data[d]>=i&&++u;let h=l>0&&u>0;return h&&(h=l/u>r),[h,o]}compute_segments(e,t,n,i,r,o=null,l=null){let[u,h]=l??e[0].dims,d=new pe("int32",new Int32Array(u*h),[u,h]),c=[];if(l!==null)for(let g=0;g<e.length;++g)e[g]=tu(e[g],l,"bilinear",!1);let a=new Int32Array(e[0].data.length),f=new Float32Array(e[0].data.length);for(let g=0;g<e.length;++g){let m=t[g];for(let y=0;y<e[g].data.length;++y)e[g].data[y]*=m,e[g].data[y]>f[y]&&(a[y]=g,f[y]=e[g].data[y])}let p=0;for(let g=0;g<n.length;++g){let m=n[g],[y,_]=this.check_segment_validity(a,e,g,i,r);if(y){++p;for(let x of _)d.data[x]=p;c.push({id:p,label_id:m,score:t[g]})}}return[d,c]}post_process_panoptic_segmentation(e,t=.5,n=.5,i=.8,r=null,o=null){r===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),r=new Set);let l=e.logits,h=e.pred_masks.sigmoid(),[d,c,a]=l.dims;if(a-=1,o!==null&&o.length!==d)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let f=[];for(let p=0;p<d;++p){let g=o!==null?o[p]:null,m=l[p],y=h[p],[_,x,E]=this.remove_low_and_no_objects(m,y,t,a);if(E.length===0){let[C,I]=g??y.dims.slice(-2),A=new pe("int32",new Int32Array(C*I).fill(-1),[C,I]);f.push({segmentation:A,segments_info:[]});continue}let[S,T]=this.compute_segments(_,x,E,n,i,r,g);f.push({segmentation:S,segments_info:T})}return f}post_process_instance_segmentation(){throw Error("Not implemented yet")}},NO=class extends Tt{post_process_object_detection(...e){return KO(...e)}},OO=class extends Tt{reshape_input_points(e,t,n){e=structuredClone(e);let i=XD(e);if(i.length===3)i=[1,...i],e=[e];else if(i.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let r=0;r<e.length;++r){let o=t[r],l=n[r],u=[l[0]/o[0],l[1]/o[1]];for(let h=0;h<e[r].length;++h)for(let d=0;d<e[r][h].length;++d)for(let c=0;c<e[r][h][d].length;++c)e[r][h][d][c]*=u[c]}return new pe("float32",Float32Array.from(e.flat(1/0)),i)}add_input_labels(e,t){let n=XD(e);if(n.length===2)n=[1,...n],e=[e];else if(n.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(n.some((i,r)=>i!==t.dims[r]))throw Error(`The first ${n.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new pe("int64",e.flat(1/0).map(BigInt),n)}async _call(e,t=null,n=null){let i=await super._call(e);if(t&&(i.input_points=this.reshape_input_points(t,i.original_sizes,i.reshaped_input_sizes)),n){if(!i.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");i.input_labels=this.add_input_labels(n,i.input_points)}return i}post_process_masks(e,t,n,{mask_threshold:i=0,binarize:r=!0,pad_size:o=null}={}){let l=[];o=o??this.pad_size;let u=[o.height,o.width];for(let h=0;h<t.length;++h){let d=t[h],c=n[h],a=e[h],f=[];for(let p=0;p<a.dims[0];++p){let g=a[p],m=tu(g,u,"bilinear",!1);if(m=m.slice(null,[0,c[0]],[0,c[1]]),m=tu(m,d,"bilinear",!1),r){let y=new Uint8Array(m.data.length);for(let _=0;_<m.data.length;++_)m.data[_]>i&&(y[_]=1);m=new pe("bool",y,m.dims)}f.push(m)}l.push(Yh(f))}return l}},FO=class extends Tt{pad_image(e,t,n,i={}){let[r,o,l]=t;return super.pad_image(e,t,{width:o+(n-o%n)%n,height:r+(n-r%n)%n},{mode:"symmetric",center:!1,constant_values:-1,...i})}},LO=class extends Tt{async _call(e,t){Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]);let n=await Promise.all(e.map(o=>this.preprocess(o))),i=await Promise.all(t.map(o=>this.preprocess(o,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:Yh(n.map((o,l)=>qh([o.pixel_values,i[l].pixel_values],0)),0),original_sizes:n.map(o=>o.original_size),reshaped_input_sizes:n.map(o=>o.reshaped_input_size)}}},$O=class extends Ao{constructor(e){var t;super(e),(t=this.config).mel_filters??(t.mel_filters=af(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney")),this.window=sb(this.config.n_fft,"hann")}_extract_fbank_features(e){let{data:t,dims:n}=nb(e,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:this.config.nb_max_frames}),i=Mn(t)[0];for(let r=0;r<t.length;++r)t[r]=(Math.max(t[r],i-8)+4)/4;return{data:t,dims:n}}async _call(e){ib(e,"WhisperFeatureExtractor");let t;e.length>this.config.n_samples?(console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),t=e.slice(0,this.config.n_samples)):(t=new Float32Array(this.config.n_samples),t.set(e));let{data:n,dims:i}=this._extract_fbank_features(t);return{input_features:new pe("float32",n,[1,...i])}}},UO=class extends Ao{_zero_mean_unit_var_norm(e){let n=e.reduce((r,o)=>r+o,0)/e.length,i=e.reduce((r,o)=>r+(o-n)**2,0)/e.length;return e.map(r=>(r-n)/Math.sqrt(i+1e-7))}async _call(e){ib(e,"Wav2Vec2FeatureExtractor"),e instanceof Float64Array&&(e=new Float32Array(e));let t=e;this.config.do_normalize&&(t=this._zero_mean_unit_var_norm(t));let n=[1,t.length];return{input_values:new pe("float32",t,n),attention_mask:new pe("int64",new BigInt64Array(t.length).fill(1n),n)}}},BO=class extends Ao{constructor(e){super(e);let t=this.config.sampling_rate,n=af(256,this.config.num_mel_bins,20,Math.floor(t/2),t,null,"kaldi",!0);for(let i=0;i<n.length;++i)n[i].push(0);this.mel_filters=n,this.window=sb(400,"povey",{periodic:!1})}_extract_fbank_features(e,t){return e=e.map(n=>n*32768),nb(e,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:t,transpose:!0})}async _call(e,{padding:t=!0,pad_to_multiple_of:n=2,do_normalize_per_mel_bins:i=!0,return_attention_mask:r=!0}={}){ib(e,"SeamlessM4TFeatureExtractor");let o=this._extract_fbank_features(e,this.config.max_length);if(i){let[p,g]=o.dims;for(let m=0;m<g;++m){let y=0;for(let S=0;S<p;++S)y+=o.data[S*g+m];let _=y/p,x=0;for(let S=0;S<p;++S)x+=(o.data[S*g+m]-_)**2;x/=p-1;let E=Math.sqrt(x+1e-7);for(let S=0;S<p;++S){let T=S*g+m;o.data[T]=(o.data[T]-_)/E}}}let l;if(t){let[p,g]=o.dims,m=p%n;if(m>0){let y=new Float32Array(g*(p+m));y.set(o.data),y.fill(this.config.padding_value,o.data.length);let _=p+m;o={data:y,dims:[_,g]},r&&(l=new pe("int64",new BigInt64Array(_),[1,_]),l.data.fill(1n,0,p))}}let[u,h]=o.dims,d=this.config.stride;if(u%d!==0)throw new Error(`The number of frames (${u}) must be a multiple of the stride (${d}).`);let a=new pe("float32",o.data,o.dims).view(1,Math.floor(u/d),h*d),f={input_features:a};if(r){let p=a.dims[1],g=new pe("int64",new BigInt64Array(p),[1,p]);if(l)for(let m=1,y=0;m<u;m+=d,++y)g.data[y]=l.data[m];else g.data.fill(1n);f.attention_mask=g}return f}},VO=class extends Ao{constructor(e){super(e);let t=this.config.sampling_rate,n=af(256,this.config.num_mel_bins,20,Math.floor(t/2),t,null,"kaldi",!0);for(let i=0;i<n.length;++i)n[i].push(0);this.mel_filters=n,this.window=sb(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}_extract_fbank_features(e,t){return nb(e,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:t,transpose:!0})}async _call(e){ib(e,"ASTFeatureExtractor");let t=this._extract_fbank_features(e,this.config.max_length);if(this.config.do_normalize){let n=this.std*2;for(let i=0;i<t.data.length;++i)t.data[i]=(t.data[i]-this.mean)/n}return{input_values:new pe("float32",t.data,[1,...t.dims])}}},zO=class extends Ao{constructor(e){super(e),this.mel_filters=af(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=af(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=sb(this.config.fft_window_size,"hann")}_get_input_mel(e,t,n,i){let r,o=!1,l=e.length-t;if(l>0)if(n==="rand_trunc"){o=!0;let u=Math.floor(Math.random()*(l+1));e=e.subarray(u,u+t),r=this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples),r.dims=[1,...r.dims]}else throw new Error(`Truncation strategy "${n}" not implemented`);else{if(l<0){let u=new Float64Array(t);if(u.set(e),i==="repeat")for(let h=e.length;h<t;h+=e.length)u.set(e.subarray(0,Math.min(e.length,t-h)),h);else if(i==="repeatpad")for(let h=e.length;h<-l;h+=e.length)u.set(e,h);e=u}if(n==="fusion")throw new Error(`Truncation strategy "${n}" not implemented`);r=this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples),r.dims=[1,...r.dims]}return{...r,longer:o}}_extract_fbank_features(e,t,n=null){return nb(e,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:t,log_mel:"dB",max_num_frames:n,do_pad:!1,transpose:!0})}async _call(e,{max_length:t=null}={}){ib(e,"ClapFeatureExtractor");let n=this._get_input_mel(e,t??this.config.nb_max_samples,this.config.truncation,this.config.padding);return{input_features:new pe("float32",n.data,[1,...n.dims])}}},HO=class extends Ao{},Ya=class extends _n{constructor(e){super(),this.feature_extractor=e}async _call(e,...t){return await this.feature_extractor(e,...t)}},GO=class extends Ya{async _call(...e){return await this.feature_extractor(...e)}post_process_masks(...e){return this.feature_extractor.post_process_masks(...e)}reshape_input_points(...e){return this.feature_extractor.reshape_input_points(...e)}},jO=class extends Ya{async _call(e){return await this.feature_extractor(e)}},WO=class extends Ya{async _call(e){return await this.feature_extractor(e)}},qO=class extends Ya{async _call(e){return await this.feature_extractor(e)}},YO=class extends Ya{},un=class{static async from_pretrained(e,{progress_callback:t=null,config:n=null,cache_dir:i=null,local_files_only:r=!1,revision:o="main"}={}){let l=n??await br(e,"preprocessor_config.json",!0,{progress_callback:t,config:n,cache_dir:i,local_files_only:r,revision:o}),u=l.feature_extractor_type??l.image_processor_type,h=this.FEATURE_EXTRACTOR_CLASS_MAPPING[u];if(!h)if(l.size!==void 0)console.warn(`Feature extractor type "${u}" not found, assuming ImageFeatureExtractor due to size parameter in config.`),h=Tt;else throw new Error(`Unknown Feature Extractor type: ${u}`);let d=this.PROCESSOR_CLASS_MAPPING[l.processor_class]??Ya,c=new h(l);return new d(c)}};J(un,"FEATURE_EXTRACTOR_CLASS_MAPPING",{ImageFeatureExtractor:Tt,WhisperFeatureExtractor:$O,ViTFeatureExtractor:TO,MobileViTFeatureExtractor:PS,MobileViTImageProcessor:IO,OwlViTFeatureExtractor:MS,Owlv2ImageProcessor:DO,CLIPFeatureExtractor:wO,ChineseCLIPFeatureExtractor:xO,SiglipImageProcessor:EO,ConvNextFeatureExtractor:RS,ConvNextImageProcessor:SO,SegformerFeatureExtractor:yO,BitImageProcessor:vO,DPTImageProcessor:bO,DPTFeatureExtractor:kS,GLPNFeatureExtractor:_O,BeitFeatureExtractor:RO,DeiTFeatureExtractor:kO,DetrFeatureExtractor:MO,YolosFeatureExtractor:NO,DonutFeatureExtractor:NS,NougatImageProcessor:PO,EfficientNetImageProcessor:CO,ViTImageProcessor:AO,VitMatteImageProcessor:LO,SamImageProcessor:OO,Swin2SRImageProcessor:FO,Wav2Vec2FeatureExtractor:UO,SeamlessM4TFeatureExtractor:BO,SpeechT5FeatureExtractor:HO,ASTFeatureExtractor:VO,ClapFeatureExtractor:zO}),J(un,"PROCESSOR_CLASS_MAPPING",{WhisperProcessor:jO,Wav2Vec2ProcessorWithLM:WO,SamProcessor:GO,SpeechT5Processor:qO,OwlViTProcessor:YO})});async function wr(s){return Array.isArray(s)||(s=[s]),await Promise.all(s.map(e=>To.read(e)))}async function OS(s,e){return Array.isArray(s)||(s=[s]),await Promise.all(s.map(t=>typeof t=="string"||t instanceof URL?RH(t,e):t instanceof Float64Array?new Float32Array(t):t))}function FH(s,e){e&&(s=s.map(o=>o|0));let[t,n,i,r]=s;return{xmin:t,ymin:n,xmax:i,ymax:r}}function NH(s){return Array.isArray(s)&&s.every(e=>"role"in e&&"content"in e)}async function LS(s,e=null,{quantized:t=!0,progress_callback:n=null,config:i=null,cache_dir:r=null,local_files_only:o=!1,revision:l="main",model_file_name:u=null}={}){s=XZ[s]??s;let h=OH[s.split("_",1)[0]];if(!h)throw Error(`Unsupported pipeline: ${s}. Must be one of [${Object.keys(OH)}]`);e||(e=h.default.model,console.log(`No model specified. Using default model: "${e}".`));let d={quantized:t,progress_callback:n,config:i,cache_dir:r,local_files_only:o,revision:l,model_file_name:u},c=new Map([["tokenizer",h.tokenizer],["model",h.model],["processor",h.processor]]),a=await JZ(c,e,d);a.task=s,La(n,{status:"ready",task:s,model:e});let f=h.pipeline;return new f(a)}async function JZ(s,e,t){let n=Object.create(null),i=[];for(let[r,o]of s.entries()){if(!o)continue;let l;Array.isArray(o)?l=new Promise(async(u,h)=>{let d;for(let c of o){if(c===null){u(null);return}try{u(await c.from_pretrained(e,t));return}catch(a){d=a}}h(d)}):l=o.from_pretrained(e,t),n[r]=l,i.push(l)}await Promise.all(i);for(let[r,o]of Object.entries(n))n[r]=await o;return n}var kt,JO,ZO,QO,eF,rb,tF,FS,nF,sF,iF,rF,oF,aF,lF,cF,uF,dF,hF,fF,pF,gF,mF,yF,bF,OH,XZ,LH=tn(()=>{FR();fO();XO();$a();Va();DS();Ha();IS();kt=class extends _n{constructor({task:e,model:t,tokenizer:n=null,processor:i=null}){super(),this.task=e,this.model=t,this.tokenizer=n,this.processor=i}async dispose(){await this.model.dispose()}},JO=class extends kt{constructor(e){super(e)}async _call(e,{topk:t=1}={}){let n=this.tokenizer(e,{padding:!0,truncation:!0}),i=await this.model(n),r=this.model.config.problem_type==="multi_label_classification"?u=>u.sigmoid().data:u=>cn(u.data),o=this.model.config.id2label,l=[];for(let u of i.logits){let h=r(u),c=Ba(h,t).map(a=>({label:o[a[0]],score:a[1]}));t===1?l.push(...c):l.push(c)}return Array.isArray(e)||t===1?l:l[0]}},ZO=class extends kt{constructor(e){super(e)}async _call(e,{ignore_labels:t=["O"]}={}){let n=Array.isArray(e),i=this.tokenizer(n?e:[e],{padding:!0,truncation:!0}),o=(await this.model(i)).logits,l=this.model.config.id2label,u=[];for(let h=0;h<o.dims[0];++h){let d=i.input_ids[h],c=o[h],a=[];for(let f=0;f<c.dims[0];++f){let p=c[f],g=Mn(p.data)[1],m=l?l[g]:`LABEL_${g}`;if(t.includes(m))continue;let y=this.tokenizer.decode([d[f].item()],{skip_special_tokens:!0});if(y==="")continue;let _=cn(p.data);a.push({entity:m,score:_[g],index:f,word:y,start:null,end:null})}u.push(a)}return n?u:u[0]}},QO=class extends kt{constructor(e){super(e)}async _call(e,t,{topk:n=1}={}){let i=this.tokenizer(e,{text_pair:t,padding:!0,truncation:!0}),r=await this.model(i),o=[];for(let l=0;l<r.start_logits.dims[0];++l){let u=i.input_ids[l],h=u.indexOf(this.tokenizer.sep_token_id),d=Array.from(cn(r.start_logits[l].data)).map((f,p)=>[f,p]).filter(f=>f[1]>h),c=Array.from(cn(r.end_logits[l].data)).map((f,p)=>[f,p]).filter(f=>f[1]>h),a=y4(d,c).filter(f=>f[0][1]<=f[1][1]).map(f=>[f[0][1],f[1][1],f[0][0]*f[1][0]]).sort((f,p)=>p[2]-f[2]);for(let f=0;f<Math.min(a.length,n);++f){let[p,g,m]=a[f],y=[...u].slice(p,g+1),_=this.tokenizer.decode(y,{skip_special_tokens:!0});o.push({answer:_,score:m})}}return n===1?o[0]:o}},eF=class extends kt{constructor(e){super(e)}async _call(e,{topk:t=5}={}){let n=this.tokenizer(e,{padding:!0,truncation:!0}),i=await this.model(n),r=[];for(let o=0;o<n.input_ids.dims[0];++o){let l=n.input_ids[o],u=l.indexOf(this.tokenizer.mask_token_id);if(u===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);let d=i.logits[o][u],c=Ba(cn(d.data),t);r.push(c.map(a=>{let f=[...l];return f[u]=a[0],{score:a[1],token:a[0],token_str:this.tokenizer.model.vocab[a[0]],sequence:this.tokenizer.decode(f,{skip_special_tokens:!0})}}))}return Array.isArray(e)?r:r[0]}},rb=class extends kt{constructor(t){super(t);J(this,"_key","generated_text")}async _call(t,n={}){Array.isArray(t)||(t=[t]),this.model.config.prefix&&(t=t.map(h=>this.model.config.prefix+h));let i=this.model.config.task_specific_params;i&&i[this.task]&&i[this.task].prefix&&(t=t.map(h=>i[this.task].prefix+h));let r=this.tokenizer,o={padding:!0,truncation:!0},l;this instanceof FS&&"_build_translation_inputs"in r?l=r._build_translation_inputs(t,o,n).input_ids:l=r(t,o).input_ids;let u=await this.model.generate(l,n);return r.batch_decode(u,{skip_special_tokens:!0}).map(h=>({[this._key]:h}))}},tF=class extends rb{constructor(t){super(t);J(this,"_key","summary_text")}},FS=class extends rb{constructor(t){super(t);J(this,"_key","translation_text")}};nF=class extends kt{constructor(e){super(e)}async _call(e,t={}){let n=!1,i=!1,r;if(typeof e=="string")r=e=[e];else if(Array.isArray(e)&&e.every(p=>typeof p=="string"))n=!0,r=e;else{if(NH(e))e=[e];else if(Array.isArray(e)&&e.every(NH))n=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");i=!0,r=e.map(p=>this.tokenizer.apply_chat_template(p,{tokenize:!1,add_generation_prompt:!0}))}let o=t.add_special_tokens??!1,l=i?!1:t.return_full_text??!0;this.tokenizer.padding_side="left";let{input_ids:u,attention_mask:h}=this.tokenizer(r,{add_special_tokens:o,padding:!0,truncation:!0}),d=await this.model.generate(u,t,null,{inputs_attention_mask:h}),c=this.tokenizer.batch_decode(d,{skip_special_tokens:!0}),a;!l&&u.dims.at(-1)>0&&(a=this.tokenizer.batch_decode(u,{skip_special_tokens:!0}).map(p=>p.length));let f=Array.from({length:e.length},p=>[]);for(let p=0;p<c.length;++p){let g=Math.floor(p/d.length*e.length);a&&(c[p]=c[p].slice(a[g])),f[g].push({generated_text:i?[...e[g],{role:"assistant",content:c[p]}]:c[p]})}return!n&&f.length===1?f[0]:f}},sF=class extends kt{constructor(e){super(e),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([t,n])=>[t.toLowerCase(),n])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(e,t,{hypothesis_template:n="This example is {}.",multi_label:i=!1}={}){let r=Array.isArray(e);r||(e=[e]),Array.isArray(t)||(t=[t]);let o=t.map(h=>n.replace("{}",h)),l=i||t.length===1,u=[];for(let h of e){let d=[];for(let f of o){let p=this.tokenizer(h,{text_pair:f,padding:!0,truncation:!0}),g=await this.model(p);l?d.push([g.logits.data[this.contradiction_id],g.logits.data[this.entailment_id]]):d.push(g.logits.data[this.entailment_id])}let a=(l?d.map(f=>cn(f)[1]):cn(d)).map((f,p)=>[f,p]).sort((f,p)=>p[0]-f[0]);u.push({sequence:h,labels:a.map(f=>t[f[1]]),scores:a.map(f=>f[0])})}return r?u:u[0]}},iF=class extends kt{constructor(e){super(e)}async _call(e,{pooling:t="none",normalize:n=!1,quantize:i=!1,precision:r="binary"}={}){let o=this.tokenizer(e,{padding:!0,truncation:!0}),l=await this.model(o),u=l.last_hidden_state??l.logits??l.token_embeddings;if(t!=="none")if(t==="mean")u=F4(u,o.attention_mask);else if(t==="cls")u=u.slice(null,0);else throw Error(`Pooling method '${t}' not supported.`);return n&&(u=u.normalize(2,-1)),i&&(u=B4(u,r)),u}},rF=class extends kt{constructor(e){super(e)}async _call(e,{pool:t=null}={}){let n=await wr(e),{pixel_values:i}=await this.processor(n),r=await this.model({pixel_values:i}),o;if(t){if(!("pooler_output"in r))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");o=r.pooler_output}else o=r.last_hidden_state??r.logits??r.image_embeds;return o}},oF=class extends kt{constructor(e){super(e)}async _call(e,{topk:t=null}={}){let n=!Array.isArray(e),i=this.processor.feature_extractor.config.sampling_rate,r=await OS(e,i),o=this.model.config.id2label,l=[];for(let u of r){let h=await this.processor(u),c=(await this.model(h)).logits[0],f=Ba(cn(c.data),t).map(p=>({label:o[p[0]],score:p[1]}));t===1?l.push(...f):l.push(f)}return!n||t===1?l:l[0]}},aF=class extends kt{constructor(e){super(e)}async _call(e,t,{hypothesis_template:n="This is a sound of {}."}={}){let i=!Array.isArray(e);i&&(e=[e]);let r=t.map(d=>n.replace("{}",d)),o=this.tokenizer(r,{padding:!0,truncation:!0}),l=this.processor.feature_extractor.config.sampling_rate,u=await OS(e,l),h=[];for(let d of u){let c=await this.processor(d),a=await this.model({...o,...c}),f=cn(a.logits_per_audio.data);h.push([...f].map((p,g)=>({score:p,label:t[g]})))}return i?h[0]:h}},lF=class extends kt{constructor(e){super(e)}async _call(e,t={}){switch(this.model.config.model_type){case"whisper":return this._call_whisper(e,t);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":return this._call_wav2vec2(e,t);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(e,t={}){t.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),t.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');let n=!Array.isArray(e);n&&(e=[e]);let i=this.processor.feature_extractor.config.sampling_rate,r=await OS(e,i),o=[];for(let l of r){let u=await this.processor(l),d=(await this.model(u)).logits[0],c=[];for(let f of d)c.push(Mn(f.data)[1]);let a=this.tokenizer.decode(c);o.push({text:a})}return n?o[0]:o}async _call_whisper(e,t={}){let n=t.return_timestamps??!1,i=t.chunk_length_s??0,r=t.chunk_callback??null,o=t.force_full_sequences??!1,l=t.stride_length_s??null;n==="word"&&(t.return_token_timestamps=!0);let u=JD(t,"language",null),h=JD(t,"task",null);if(u||h||n){if(t.forced_decoder_ids)throw new Error("Cannot specify `language`/`task`/`return_timestamps` and `forced_decoder_ids` at the same time.");let m=this.tokenizer.get_decoder_prompt_ids({language:u,task:h,no_timestamps:!n});m.length>0&&(t.forced_decoder_ids=m)}let d=!Array.isArray(e);d&&(e=[e]);let c=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,a=this.processor.feature_extractor.config.hop_length,f=this.processor.feature_extractor.config.sampling_rate,p=await OS(e,f),g=[];for(let m of p){let y=[];if(i>0){if(l===null)l=i/6;else if(i<=l)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");let E=f*i,S=f*l,T=E-2*S,C=0;for(;C<m.length;){let I=m.subarray(C,C+E),A=await this.processor(I),P=C===0,F=C+T>=m.length;y.push({stride:[I.length,P?0:S,F?0:S],input_features:A.input_features,is_last:F}),C+=T}}else y=[{stride:[m.length,0,0],input_features:(await this.processor(m)).input_features,is_last:!0}];for(let E of y){t.num_frames=Math.floor(E.stride[0]/a);let S=await this.model.generate(E.input_features,t);n==="word"?(E.tokens=S.sequences[0],E.token_timestamps=S.token_timestamps.tolist()[0].map(T=>eu(T,2))):E.tokens=S[0],E.stride=E.stride.map(T=>T/f),r!==null&&r(E)}let[_,x]=this.tokenizer._decode_asr(y,{time_precision:c,return_timestamps:n,force_full_sequences:o});g.push({text:_,...x})}return d?g[0]:g}},cF=class extends kt{constructor(e){super(e)}async _call(e,t={}){let n=Array.isArray(e),i=await wr(e),{pixel_values:r}=await this.processor(i),o=[];for(let l of r){l.dims=[1,...l.dims];let u=await this.model.generate(l,t),h=this.tokenizer.batch_decode(u,{skip_special_tokens:!0}).map(d=>({generated_text:d.trim()}));o.push(h)}return n?o:o[0]}},uF=class extends kt{constructor(e){super(e)}async _call(e,{topk:t=1}={}){let n=Array.isArray(e),i=await wr(e),{pixel_values:r}=await this.processor(i),o=await this.model({pixel_values:r}),l=this.model.config.id2label,u=[];for(let h of o.logits){let c=Ba(cn(h.data),t).map(a=>({label:l[a[0]],score:a[1]}));t===1?u.push(...c):u.push(c)}return n||t===1?u:u[0]}},dF=class extends kt{constructor(e){super(e),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(e,{threshold:t=.5,mask_threshold:n=.5,overlap_mask_area_threshold:i=.8,label_ids_to_fuse:r=null,target_sizes:o=null,subtask:l=null}={}){if(Array.isArray(e)&&e.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");let h=await wr(e),d=h.map(y=>[y.height,y.width]),{pixel_values:c,pixel_mask:a}=await this.processor(h),f=await this.model({pixel_values:c,pixel_mask:a}),p=null;if(l!==null)p=this.subtasks_mapping[l];else for(let[y,_]of Object.entries(this.subtasks_mapping))if(_ in this.processor.feature_extractor){p=this.processor.feature_extractor[_].bind(this.processor.feature_extractor),l=y;break}let g=this.model.config.id2label,m=[];if(l==="panoptic"||l==="instance"){let y=p(f,t,n,i,r,o??d)[0],_=y.segmentation;for(let x of y.segments_info){let E=new Uint8ClampedArray(_.data.length);for(let T=0;T<_.data.length;++T)_.data[T]===x.id&&(E[T]=255);let S=new To(E,_.dims[1],_.dims[0],1);m.push({score:x.score,label:g[x.label_id],mask:S})}}else if(l==="semantic"){let{segmentation:y,labels:_}=p(f,o??d)[0];for(let x of _){let E=new Uint8ClampedArray(y.data.length);for(let T=0;T<y.data.length;++T)y.data[T]===x&&(E[T]=255);let S=new To(E,y.dims[1],y.dims[0],1);m.push({score:null,label:g[x],mask:S})}}else throw Error(`Subtask ${l} not supported.`);return m}},hF=class extends kt{constructor(e){super(e)}async _call(e,t,{hypothesis_template:n="This is a photo of {}"}={}){let i=Array.isArray(e),r=await wr(e),o=t.map(a=>n.replace("{}",a)),l=this.tokenizer(o,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:u}=await this.processor(r),h=await this.model({...l,pixel_values:u}),d=this.model.config.model_type==="siglip"?a=>a.sigmoid().data:a=>cn(a.data),c=[];for(let a of h.logits_per_image){let p=[...d(a)].map((g,m)=>({score:g,label:t[m]}));p.sort((g,m)=>m.score-g.score),c.push(p)}return i?c:c[0]}},fF=class extends kt{constructor(e){super(e)}async _call(e,{threshold:t=.9,percentage:n=!1}={}){let i=Array.isArray(e);if(i&&e.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");let r=await wr(e),o=n?null:r.map(f=>[f.height,f.width]),{pixel_values:l,pixel_mask:u}=await this.processor(r),h=await this.model({pixel_values:l,pixel_mask:u}),d=this.processor.feature_extractor.post_process_object_detection(h,t,o),c=this.model.config.id2label,a=d.map(f=>f.boxes.map((p,g)=>({score:f.scores[g],label:c[f.classes[g]],box:FH(p,!n)})));return i?a:a[0]}},pF=class extends kt{constructor(e){super(e)}async _call(e,t,{threshold:n=.1,topk:i=null,percentage:r=!1}={}){let o=Array.isArray(e),l=await wr(e),u=this.tokenizer(t,{padding:!0,truncation:!0}),h=await this.processor(l),d=[];for(let c=0;c<l.length;++c){let a=l[c],f=r?null:[[a.height,a.width]],p=h.pixel_values[c].unsqueeze_(0),g=await this.model({...u,pixel_values:p}),m=this.processor.feature_extractor.post_process_object_detection(g,n,f,!0)[0],y=m.boxes.map((_,x)=>({score:m.scores[x],label:t[m.classes[x]],box:FH(_,!r)})).sort((_,x)=>x.score-_.score);i!==null&&(y=y.slice(0,i)),d.push(y)}return o?d:d[0]}},gF=class extends kt{constructor(e){super(e)}async _call(e,t,n={}){let i=(await wr(e))[0],{pixel_values:r}=await this.processor(i),o=`<s_docvqa><s_question>${t}</s_question><s_answer>`,l=this.tokenizer(o,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,u=await this.model.generate(r,{...n,decoder_input_ids:l,max_length:this.model.config.decoder.max_position_embeddings}),d=this.tokenizer.batch_decode(u)[0].match(/<s_answer>(.*?)<\/s_answer>/),c=null;return d&&d.length>=2&&(c=d[1].trim()),[{answer:c}]}},mF=class extends kt{constructor(t){super(t);J(this,"DEFAULT_VOCODER_ID","Xenova/speecht5_hifigan");this.vocoder=t.vocoder??null}async _call(t,{speaker_embeddings:n=null}={}){return this.processor?this._call_text_to_spectrogram(t,{speaker_embeddings:n}):this._call_text_to_waveform(t)}async _call_text_to_waveform(t){let n=this.tokenizer(t,{padding:!0,truncation:!0}),{waveform:i}=await this.model(n),r=this.model.config.sampling_rate;return{audio:i.data,sampling_rate:r}}async _call_text_to_spectrogram(t,{speaker_embeddings:n}){if(this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await _r.from_pretrained(this.DEFAULT_VOCODER_ID,{quantized:!1})),(typeof n=="string"||n instanceof URL)&&(n=new Float32Array(await(await fetch(n)).arrayBuffer())),n instanceof Float32Array)n=new pe("float32",n,[1,n.length]);else if(!(n instanceof pe))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");let{input_ids:i}=this.tokenizer(t,{padding:!0,truncation:!0}),{waveform:r}=await this.model.generate_speech(i,n,{vocoder:this.vocoder}),o=this.processor.feature_extractor.config.sampling_rate;return{audio:r.data,sampling_rate:o}}},yF=class extends kt{constructor(e){super(e)}async _call(e){let t=await wr(e),n=await this.processor(t),i=await this.model(n),r=[];for(let o of i.reconstruction){let l=o.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");r.push(To.fromTensor(l))}return r.length>1?r:r[0]}},bF=class extends kt{constructor(e){super(e)}async _call(e){let t=await wr(e),n=await this.processor(t),{predicted_depth:i}=await this.model(n),r=[];for(let o=0;o<t.length;++o){let l=tu(i[o],t[o].size.reverse(),"bilinear",!1),u=l.mul_(255/Mn(l.data)[0]).to("uint8");r.push({predicted_depth:i[o],depth:To.fromTensor(u)})}return r.length>1?r:r[0]}},OH=Object.freeze({"text-classification":{tokenizer:qt,pipeline:JO,model:Jh,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:qt,pipeline:ZO,model:Ry,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:qt,pipeline:QO,model:Ly,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:qt,pipeline:eF,model:Fy,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:qt,pipeline:tF,model:ru,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:qt,pipeline:FS,model:ru,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:qt,pipeline:rb,model:ru,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:qt,pipeline:nF,model:Oy,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:qt,pipeline:sF,model:Jh,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:oF,model:jy,processor:un,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:qt,pipeline:aF,model:_r,processor:un,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:qt,pipeline:lF,model:[Py,Gy],processor:un,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:qt,pipeline:mF,model:[Ny,My],processor:[un,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:qt,pipeline:cF,model:$y,processor:un,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:uF,model:Uy,processor:un,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:dF,model:[By,Vy],processor:un,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"zero-shot-image-classification":{tokenizer:qt,pipeline:hF,model:_r,processor:un,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:fF,model:zy,processor:un,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:qt,pipeline:pF,model:Hy,processor:un,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:qt,pipeline:gF,model:Wy,processor:un,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:yF,model:qy,processor:un,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:bF,model:Yy,processor:un,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:qt,pipeline:iF,model:_r,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:un,pipeline:rF,model:[Ky,_r],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),XZ=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"})});var pO=tn(()=>{LH();Kx();fO();FR();XO();$R();DS();IS();Ha();Va()});var VH={};GS(VH,{generateTestEmbeddings:()=>BH,runFullPoC:()=>eQ,testEmbeddingGemma:()=>UH,testTransformersLoad:()=>$H});function ZZ(){console.log("[PoC] \uD658\uACBD \uC124\uC815 \uC911 (v2)..."),mt.allowLocalModels=!1,mt.allowRemoteModels=!0;try{let s=require("os"),e=require("path");mt.cacheDir=e.join(s.homedir(),".cache","transformers"),console.log("[PoC] \uCE90\uC2DC \uB514\uB809\uD1A0\uB9AC:",mt.cacheDir)}catch{console.log("[PoC] Node.js \uBAA8\uB4C8 \uC0AC\uC6A9 \uBD88\uAC00, \uAE30\uBCF8 \uCE90\uC2DC \uC0AC\uC6A9")}console.log("[PoC] \uD658\uACBD \uC124\uC815 \uC644\uB8CC")}async function $H(){console.log("[PoC] Step 1: Transformers.js \uB85C\uB4DC \uD14C\uC2A4\uD2B8");try{if(typeof LS!="function")throw new Error("pipeline \uD568\uC218\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC74C");return console.log("[PoC] Transformers.js \uB85C\uB4DC \uC131\uACF5"),console.log("[PoC] env.allowLocalModels:",mt.allowLocalModels),console.log("[PoC] env.useBrowserCache:",mt.useBrowserCache),{success:!0}}catch(s){return console.error("[PoC] Transformers.js \uB85C\uB4DC \uC2E4\uD328:",s),{success:!1,error:s instanceof Error?s.message:String(s)}}}async function UH(s="\uC81C\uD154\uCE74\uC2A4\uD150\uC740 \uC9C0\uC2DD \uAD00\uB9AC \uC2DC\uC2A4\uD15C\uC785\uB2C8\uB2E4."){console.log("[PoC] Step 2: EmbeddingGemma \uBAA8\uB378 \uB85C\uB4DC \uBC0F \uCD94\uB860 \uD14C\uC2A4\uD2B8"),console.log("[PoC] \uD14C\uC2A4\uD2B8 \uD14D\uC2A4\uD2B8:",s),console.log("[PoC] \uBAA8\uB378:",vF),console.log("[PoC] \uC635\uC158:",_F);try{let e=performance.now(),t=await LS("feature-extraction",vF,_F),n=performance.now(),i=Math.round(n-e);console.log(`[PoC] \uBAA8\uB378 \uB85C\uB4DC \uC644\uB8CC: ${i}ms`);let r=performance.now(),o=await t(s,{pooling:"mean",normalize:!0}),l=performance.now(),u=Math.round(l-r);console.log(`[PoC] \uCD94\uB860 \uC644\uB8CC: ${u}ms`);let h=Array.from(o.data),d=h.length;return console.log(`[PoC] \uC784\uBCA0\uB529 \uCC28\uC6D0: ${d}`),console.log("[PoC] \uC784\uBCA0\uB529 \uC0D8\uD50C (\uCC98\uC74C 5\uAC1C):",h.slice(0,5)),{success:!0,loadTimeMs:i,inferenceTimeMs:u,embedding:h,dimensions:d}}catch(e){return console.error("[PoC] \uB85C\uCEEC \uC784\uBCA0\uB529 \uD14C\uC2A4\uD2B8 \uC2E4\uD328:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}async function BH(){console.log("[PoC] Step 3: \uD488\uC9C8 \uBE44\uAD50\uC6A9 \uD14C\uC2A4\uD2B8 \uC784\uBCA0\uB529 \uC0DD\uC131");let s=["\uC81C\uD154\uCE74\uC2A4\uD150\uC740 \uC9C0\uC2DD \uAD00\uB9AC \uC2DC\uC2A4\uD15C\uC785\uB2C8\uB2E4.","Zettelkasten is a knowledge management system.","\uC2A4\uB9C8\uD2B8\uD31C\uC5D0\uC11C \uC13C\uC11C \uB370\uC774\uD130\uB97C \uC218\uC9D1\uD569\uB2C8\uB2E4.","\uB18D\uC5C5 IoT \uC2DC\uC2A4\uD15C\uC758 \uC628\uB3C4 \uBAA8\uB2C8\uD130\uB9C1","Python\uC73C\uB85C \uC6F9 \uC2A4\uD06C\uB798\uD551\uD558\uAE30","TypeScript \uD0C0\uC785 \uC2DC\uC2A4\uD15C \uC774\uD574\uD558\uAE30"];try{let e=await LS("feature-extraction",vF,_F),t=new Map;for(let i of s){let r=await e(i,{pooling:"mean",normalize:!0}),o=Array.from(r.data);t.set(i,o),console.log(`[PoC] "${i.slice(0,20)}..." \uC784\uBCA0\uB529 \uC644\uB8CC`)}console.log(`
[PoC] \uC720\uC0AC\uB3C4 \uC0D8\uD50C:`);let n=Array.from(t.keys());for(let i=0;i<Math.min(3,n.length);i++)for(let r=i+1;r<Math.min(4,n.length);r++){let o=QZ(t.get(n[i]),t.get(n[r]));console.log(`[PoC] "${n[i].slice(0,15)}..." \u2194 "${n[r].slice(0,15)}...": ${(o*100).toFixed(1)}%`)}return{embeddings:t,success:!0}}catch(e){return console.error("[PoC] \uD14C\uC2A4\uD2B8 \uC784\uBCA0\uB529 \uC0DD\uC131 \uC2E4\uD328:",e),{embeddings:new Map,success:!1,error:e instanceof Error?e.message:String(e)}}}function QZ(s,e){let t=0,n=0,i=0;for(let r=0;r<s.length;r++)t+=s[r]*e[r],n+=s[r]*s[r],i+=e[r]*e[r];return t/(Math.sqrt(n)*Math.sqrt(i))}async function eQ(){if(console.log("=".repeat(60)),console.log("[PoC] Local Embedding PoC \uC2DC\uC791"),console.log("=".repeat(60)),ZZ(),!(await $H()).success){console.error("[PoC] Step 1 \uC2E4\uD328 - \uC911\uB2E8");return}let e=await UH();if(!e.success){console.error("[PoC] Step 2 \uC2E4\uD328 - \uC911\uB2E8");return}if(console.log(`
[PoC] Step 2 \uACB0\uACFC:`),console.log(`  - \uBAA8\uB378 \uB85C\uB4DC: ${e.loadTimeMs}ms`),console.log(`  - \uCD94\uB860 \uC2DC\uAC04: ${e.inferenceTimeMs}ms`),console.log(`  - \uCC28\uC6D0 \uC218: ${e.dimensions} (expected: 768)`),!(await BH()).success){console.error("[PoC] Step 3 \uC2E4\uD328");return}console.log(`
`+"=".repeat(60)),console.log("[PoC] PoC \uC644\uB8CC - \uBAA8\uB4E0 \uD14C\uC2A4\uD2B8 \uD1B5\uACFC!"),console.log("=".repeat(60))}var vF,_F,zH=tn(()=>{pO();vF="Xenova/all-MiniLM-L6-v2",_F={quantized:!0}});var tQ={};GS(tQ,{default:()=>$S});module.exports=JH(tQ);var Y=require("obsidian");Li();var sL=require("obsidian");Li();var vb=class{constructor(e,t,n){this.statusBarEl=null;this.saveDebounceTimer=null;this.app=e,this.settings=t,this.getDataPath=n,this.storage={...Tu},this.mergedStorage={...Tu}}getCurrentPlatformFileName(){return sL.Platform.isMobile?bb:Tf}setStatusBarEl(e){this.statusBarEl=e,this.updateStatusBar()}updateSettings(e){this.settings=e}recordUsage(e,t,n,i){if(!this.settings.usageTrackingEnabled)return;let r=this.getTodayDate(),o=this.calculateCost(t,n,i);this.updateDailySummary(this.storage,r,e,t,n,o),this.updateDailySummary(this.mergedStorage,r,e,t,n,o),this.updateStatusBar(),this.debouncedSave()}updateDailySummary(e,t,n,i,r,o){let l=e.dailySummaries.find(u=>u.date===t);l||(l=Af(t),e.dailySummaries.push(l)),l.totalInputTokens+=i,l.totalOutputTokens+=r,l.totalCalls+=1,l.callsByFeature[n]=(l.callsByFeature[n]||0)+1,l.estimatedCostUSD+=o}getTodayUsage(){let e=this.getTodayDate();return this.mergedStorage.dailySummaries.find(t=>t.date===e)||null}getThisMonthUsage(){let e=this.getTodayDate().substring(0,7),t=this.mergedStorage.dailySummaries.filter(n=>n.date.startsWith(e));return{inputTokens:t.reduce((n,i)=>n+i.totalInputTokens,0),outputTokens:t.reduce((n,i)=>n+i.totalOutputTokens,0),calls:t.reduce((n,i)=>n+i.totalCalls,0),cost:t.reduce((n,i)=>n+i.estimatedCostUSD,0)}}getUsageHistory(e){let t=new Date;t.setDate(t.getDate()-e);let n=t.toISOString().split("T")[0];return this.mergedStorage.dailySummaries.filter(i=>i.date>=n).sort((i,r)=>r.date.localeCompare(i.date))}calculateCost(e,t,n){let i=yb[n]||yb["gemini-3-flash-preview"],r=e/1e6*i.inputPer1M,o=t/1e6*i.outputPer1M;return r+o}updateStatusBar(){if(!this.statusBarEl||!this.settings.usageShowStatusBar){this.statusBarEl&&this.statusBarEl.empty();return}let e=this.getTodayUsage();if(!e){this.statusBarEl.setText("\u{1F9E0} 0/0");return}let t=r=>r>=1e3?(r/1e3).toFixed(1)+"K":r.toString(),n=t(e.totalInputTokens),i=t(e.totalOutputTokens);this.statusBarEl.setText(`\u{1F9E0} ${n}/${i}`)}pruneOldData(){let e=this.settings.usageStorageMode,t=new Date;switch(e){case"today":let n=this.getTodayDate();this.storage.dailySummaries=this.storage.dailySummaries.filter(h=>h.date===n);break;case"daily30":let i=new Date(t);i.setDate(i.getDate()-30),this.storage.dailySummaries=this.storage.dailySummaries.filter(h=>h.date>=i.toISOString().split("T")[0]);break;case"daily90":let r=new Date(t);r.setDate(r.getDate()-90),this.storage.dailySummaries=this.storage.dailySummaries.filter(h=>h.date>=r.toISOString().split("T")[0]);break;case"monthly12":this.aggregateToMonthly();let o=new Date(t);o.setMonth(o.getMonth()-12);let l=o.toISOString().substring(0,7);this.storage.monthlySummaries=(this.storage.monthlySummaries||[]).filter(h=>h.month>=l);let u=t.toISOString().substring(0,7);this.storage.dailySummaries=this.storage.dailySummaries.filter(h=>h.date.startsWith(u));break}this.storage.storageMode=e}async saveUsage(){let e=this.getDataPath(),t=this.getCurrentPlatformFileName(),n=`${e}/${t}`;this.storage.lastUpdated=new Date().toISOString();try{await this.app.vault.adapter.write(n,JSON.stringify(this.storage,null,2))}catch(i){console.error("[UsageTracker] \uC800\uC7A5 \uC2E4\uD328:",i)}}async loadUsage(){let e=this.getDataPath(),t=this.app.vault.adapter;await this.migrateLegacyFile(e);let n=await this.loadPlatformFile(e,Tf),i=await this.loadPlatformFile(e,bb),r=this.getCurrentPlatformFileName();this.storage=r===Tf?n:i,this.mergedStorage=this.mergeDailyData(n,i),this.storage.storageMode!==this.settings.usageStorageMode&&this.pruneOldData(),this.updateStatusBar()}async migrateLegacyFile(e){let t=this.app.vault.adapter,n=`${e}/${XS}`,i=`${e}/${this.getCurrentPlatformFileName()}`;try{if(await t.exists(n)&&!await t.exists(i)){let r=await t.read(n);await t.write(i,r),await t.remove(n),console.log("[UsageTracker] \uB808\uAC70\uC2DC \uD30C\uC77C \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC644\uB8CC")}}catch(r){console.error("[UsageTracker] \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC2E4\uD328:",r)}}async loadPlatformFile(e,t){let n=this.app.vault.adapter,i=`${e}/${t}`;try{if(await n.exists(i)){let r=await n.read(i);return JSON.parse(r)}}catch(r){console.error(`[UsageTracker] ${t} \uB85C\uB4DC \uC2E4\uD328:`,r)}return{...Tu}}mergeDailyData(e,t){let n={version:1,storageMode:this.settings.usageStorageMode,dailySummaries:[],monthlySummaries:[],lastUpdated:new Date().toISOString()},i=new Set;e.dailySummaries.forEach(r=>i.add(r.date)),t.dailySummaries.forEach(r=>i.add(r.date));for(let r of i){let o=e.dailySummaries.find(h=>h.date===r),l=t.dailySummaries.find(h=>h.date===r),u=Af(r);if(o){u.totalInputTokens+=o.totalInputTokens,u.totalOutputTokens+=o.totalOutputTokens,u.totalCalls+=o.totalCalls,u.estimatedCostUSD+=o.estimatedCostUSD;for(let[h,d]of Object.entries(o.callsByFeature))u.callsByFeature[h]=(u.callsByFeature[h]||0)+d}if(l){u.totalInputTokens+=l.totalInputTokens,u.totalOutputTokens+=l.totalOutputTokens,u.totalCalls+=l.totalCalls,u.estimatedCostUSD+=l.estimatedCostUSD;for(let[h,d]of Object.entries(l.callsByFeature))u.callsByFeature[h]=(u.callsByFeature[h]||0)+d}n.dailySummaries.push(u)}return n.dailySummaries.sort((r,o)=>o.date.localeCompare(r.date)),n}async resetUsage(){this.storage={...Tu},this.storage.storageMode=this.settings.usageStorageMode,await this.saveUsage(),await this.loadUsage()}exportToCSV(){let e=["Date","Input Tokens","Output Tokens","Total Calls","Estimated Cost (USD)","classify","ocr","youtube","webpage","zk","related","chat","embedding","review","meeting","schedule","split","focus","other"],t=this.mergedStorage.dailySummaries.map(n=>[n.date,n.totalInputTokens,n.totalOutputTokens,n.totalCalls,n.estimatedCostUSD.toFixed(6),n.callsByFeature.classify||0,n.callsByFeature.ocr||0,n.callsByFeature.youtube||0,n.callsByFeature.webpage||0,n.callsByFeature.zk||0,n.callsByFeature.related||0,n.callsByFeature.chat||0,n.callsByFeature.embedding||0,n.callsByFeature.review||0,n.callsByFeature.meeting||0,n.callsByFeature.schedule||0,n.callsByFeature.split||0,n.callsByFeature.focus||0,n.callsByFeature.other||0]);return[e.join(","),...t.map(n=>n.join(","))].join(`
`)}getTodayDate(){return new Date().toISOString().split("T")[0]}debouncedSave(){this.saveDebounceTimer&&clearTimeout(this.saveDebounceTimer),this.saveDebounceTimer=setTimeout(()=>{this.saveUsage(),this.saveDebounceTimer=null},5e3)}aggregateToMonthly(){let e=new Map;for(let n of this.storage.dailySummaries){let i=n.date.substring(0,7),r=e.get(i);r||(r={month:i,totalInputTokens:0,totalOutputTokens:0,totalCalls:0,callsByFeature:{...Af("").callsByFeature},estimatedCostUSD:0,dailyAverage:{inputTokens:0,outputTokens:0,calls:0}},e.set(i,r)),r.totalInputTokens+=n.totalInputTokens,r.totalOutputTokens+=n.totalOutputTokens,r.totalCalls+=n.totalCalls,r.estimatedCostUSD+=n.estimatedCostUSD;for(let[o,l]of Object.entries(n.callsByFeature))r.callsByFeature[o]=(r.callsByFeature[o]||0)+l}for(let n of e.values()){let i=this.storage.dailySummaries.filter(r=>r.date.startsWith(n.month)).length;i>0&&(n.dailyAverage={inputTokens:Math.round(n.totalInputTokens/i),outputTokens:Math.round(n.totalOutputTokens/i),calls:Math.round(n.totalCalls/i)})}let t=new Map((this.storage.monthlySummaries||[]).map(n=>[n.month,n]));for(let[n,i]of e)t.set(n,i);this.storage.monthlySummaries=Array.from(t.values()).sort((n,i)=>i.month.localeCompare(n.month))}};var he=require("obsidian");var oL=[{value:"auto",label:"\uC790\uB3D9 \uAC10\uC9C0"},{value:"Asia/Seoul",label:"\uD55C\uAD6D (KST, UTC+9)"},{value:"Asia/Tokyo",label:"\uC77C\uBCF8 (JST, UTC+9)"},{value:"Asia/Shanghai",label:"\uC911\uAD6D (CST, UTC+8)"},{value:"America/New_York",label:"\uBBF8\uAD6D \uB3D9\uBD80 (EST/EDT)"},{value:"America/Los_Angeles",label:"\uBBF8\uAD6D \uC11C\uBD80 (PST/PDT)"},{value:"Europe/London",label:"\uC601\uAD6D (GMT/BST)"},{value:"UTC",label:"UTC"}],aL=[{value:"iso",label:"ISO \uD615\uC2DD (2026-01-05T16:24:45+09:00)"},{value:"local",label:"\uB85C\uCEEC \uD615\uC2DD (2026-01-05 16:24:45)"},{value:"friendly",label:"\uCE5C\uADFC\uD55C \uD615\uC2DD (2026\uB144 1\uC6D4 5\uC77C 16:24)"}];function _b(s){return s==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:s}function ZS(s,e,t){let n=_b(e);switch(t){case"iso":return ZH(s,n);case"local":return iL(s,n);case"friendly":return QH(s,n);default:return iL(s,n)}}function ZH(s,e){let t={timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",t).formatToParts(s),i=a=>n.find(f=>f.type===a)?.value||"",r=i("year"),o=i("month"),l=i("day"),u=i("hour"),h=i("minute"),d=i("second"),c=eG(s,e);return`${r}-${o}-${l}T${u}:${h}:${d}${c}`}function iL(s,e){let t={timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",t).formatToParts(s),i=c=>n.find(a=>a.type===c)?.value||"",r=i("year"),o=i("month"),l=i("day"),u=i("hour"),h=i("minute"),d=i("second");return`${r}-${o}-${l} ${u}:${h}:${d}`}function QH(s,e){let t={timeZone:e,year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};return new Intl.DateTimeFormat("ko-KR",t).format(s)}function eG(s,e){let t=new Date(s.toLocaleString("en-US",{timeZone:"UTC"})),i=(new Date(s.toLocaleString("en-US",{timeZone:e})).getTime()-t.getTime())/(1e3*60);if(i===0)return"Z";let r=i>=0?"+":"-",o=Math.abs(i),l=Math.floor(o/60),u=o%60;return`${r}${String(l).padStart(2,"0")}:${String(u).padStart(2,"0")}`}function nn(s,e){let n={timeZone:_b(e),year:"numeric",month:"2-digit",day:"2-digit"},i=new Intl.DateTimeFormat("en-CA",n).formatToParts(s),r=o=>i.find(l=>l.type===o)?.value||"";return`${r("year")}-${r("month")}-${r("day")}`}function Kt(s,e){return ZS(new Date,s,e)}function $i(s){return nn(new Date,s)}function Cf(s,e){let t=_b(e),n=new Date;switch(s){case"today":return rL(n,t);case"week":return tG(n,t);case"month":return nG(n,t);default:return rL(n,t)}}function rL(s,e){let t=QS(s,e),n=eT(s,e);return{start:t,end:n,label:"\uC624\uB298"}}function tG(s,e){let t=s.getDay(),n=t===0?6:t-1,i=new Date(s);i.setDate(i.getDate()-n);let r=new Date(i);return r.setDate(r.getDate()+6),{start:QS(i,e),end:eT(r,e),label:"\uC774\uBC88 \uC8FC"}}function nG(s,e){let t=new Date(s.getFullYear(),s.getMonth(),1),n=new Date(s.getFullYear(),s.getMonth()+1,0);return{start:QS(t,e),end:eT(n,e),label:"\uC774\uBC88 \uB2EC"}}function QS(s,e){let t=new Date(s);return t.setHours(0,0,0,0),t}function eT(s,e){let t=new Date(s);return t.setHours(23,59,59,999),t}function lL(s,e){return s>=e.start&&s<=e.end}function tT(s){let e=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);let n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e.getTime()-n.getTime())/864e5+1)/7)}function cL(s,e,t){let n=_b(t);switch(s){case"today":return`${nn(e,n)} \uC77C\uC77C \uD68C\uACE0.md`;case"week":let i=tT(e);return`${e.getFullYear()}-W${String(i).padStart(2,"0")} \uC8FC\uAC04 \uD68C\uACE0.md`;case"month":return`${nn(e,n).substring(0,7)} \uC6D4\uAC04 \uD68C\uACE0.md`;default:return`${nn(e,n)} \uD68C\uACE0.md`}}function uL(s){let t=new Date().getTime()-s.getTime(),n=Math.floor(t/(1e3*60)),i=Math.floor(t/(1e3*60*60)),r=Math.floor(t/(1e3*60*60*24));return n<1?"\uBC29\uAE08 \uC804":n<60?`${n}\uBD84 \uC804`:i<24?`${i}\uC2DC\uAC04 \uC804`:r===1?"\uC5B4\uC81C":r<7?`${r}\uC77C \uC804`:r<30?`${Math.floor(r/7)}\uC8FC \uC804`:`${Math.floor(r/30)}\uAC1C\uC6D4 \uC804`}var nT=4,dL="https://aistudio.google.com/app/apikey",wb={basic:{autoWatch:!1,ocrEnabled:!0,embeddingEnabled:!1,ragEnabled:!1,calendarEnabled:!1,scheduleDetectionEnabled:!1,googleCalendarEnabled:!1,showMiniCalendar:!1},power:{autoWatch:!0,ocrEnabled:!0,embeddingEnabled:!0,ragEnabled:!0,calendarEnabled:!0,scheduleDetectionEnabled:!0,googleCalendarEnabled:!1,showMiniCalendar:!0},experimental:{autoWatch:!0,ocrEnabled:!0,embeddingEnabled:!0,ragEnabled:!0,calendarEnabled:!0,scheduleDetectionEnabled:!0,googleCalendarEnabled:!1,showMiniCalendar:!0},custom:{}},os={basic:{icon:"\u{1F680}",label:"\uAE30\uBCF8 \uBAA8\uB4DC",shortDesc:"\uBD84\uB958 + URL \uC694\uC57D",longDesc:`\uB178\uD2B8 \uBD84\uB958 + URL \uC694\uC57D
\uAC00\uBCCD\uAC8C \uC2DC\uC791\uD558\uAE30 \uC88B\uC544\uC694`},power:{icon:"\u{1F4AA}",label:"\uD30C\uC6CC \uBAA8\uB4DC (\uAD8C\uC7A5)",shortDesc:"\uC804\uCCB4 \uAE30\uB2A5",longDesc:`\uC804\uCCB4 \uAE30\uB2A5 \uD65C\uC131\uD654
Embedding, RAG \uCC57\uBD07, \uCE98\uB9B0\uB354`},experimental:{icon:"\u{1F9EA}",label:"\uC2E4\uD5D8 \uBAA8\uB4DC",shortDesc:"Beta \uD3EC\uD568",longDesc:`Beta \uAE30\uB2A5 \uD3EC\uD568
\uC0C8\uB85C\uC6B4 \uAE30\uB2A5\uC744 \uBA3C\uC800 \uCCB4\uD5D8`},custom:{icon:"\u2699\uFE0F",label:"\uC0AC\uC6A9\uC790 \uC815\uC758",shortDesc:"\uC9C1\uC811 \uC124\uC815",longDesc:"\uAC1C\uBCC4 \uC124\uC815\uC744 \uC9C1\uC811 \uC870\uC815\uD569\uB2C8\uB2E4"}},xb=["geminiApiKey","googleAccessToken","googleRefreshToken","googleClientId","googleClientSecret","googleTokenExpiry","inboxFolder","projectsFolder","libraryFolder","archivesFolder","zettelFolder","dailyNotesFolder","ocrOriginalFolder","timezone","dateFormat","zkIdType","onboardingCompleted","lastNotifiedVersion","language","dataStorageLocation","dataFolderPath","autoEmbeddingEnabled"],zt="ZFB: ",Gs={EMBEDDINGS:"embeddings.json",EMBEDDINGS_DESKTOP:"embeddings-desktop.json",EMBEDDINGS_MOBILE:"embeddings-mobile.json",CHATS:"chats.json",FEEDBACK:"feedback.json"},Au=".obsidian/plugins/zero-friction-brain";Li();var Eb=class extends he.PluginSettingTab{constructor(t,n){super(t,n);this.showAdvancedSettings=!1;this.plugin=n}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Zero Friction Brain \uC124\uC815"}),t.createEl("h3",{text:"\uBE60\uB978 \uC2DC\uC791"});let n=this.plugin.settings.preset||"custom";new he.Setting(t).setName("\uC124\uC815 \uD504\uB9AC\uC14B").setDesc("\uC0AC\uC6A9 \uD328\uD134\uC5D0 \uB9DE\uB294 \uD504\uB9AC\uC14B\uC744 \uC120\uD0DD\uD558\uC138\uC694").addDropdown(l=>l.addOption("basic",`${os.basic.icon} ${os.basic.label}`).addOption("power",`${os.power.icon} ${os.power.label}`).addOption("experimental",`${os.experimental.icon} ${os.experimental.label}`).addOption("custom",`${os.custom.icon} ${os.custom.label}`).setValue(n).onChange(async u=>{let h=u;h!=="custom"?(this.applyPreset(h),new he.Notice(`${os[h].icon} ${os[h].label} \uC801\uC6A9\uB428`)):(this.plugin.settings.preset="custom",await this.plugin.saveSettings()),this.display()}));let i=t.createDiv({cls:"zfb-preset-description"});if(this.renderPresetDescription(i,n),n!=="custom"&&(new he.Setting(t).setName("\uACE0\uAE09 \uC124\uC815 \uD45C\uC2DC").setDesc("\uC138\uBD80 \uC124\uC815\uC744 \uC9C1\uC811 \uC870\uC815\uD569\uB2C8\uB2E4").addToggle(l=>l.setValue(this.showAdvancedSettings).onChange(u=>{this.showAdvancedSettings=u,this.display()})),!this.showAdvancedSettings))return;if(t.createEl("hr"),t.createEl("h3",{text:"API \uC124\uC815"}),new he.Setting(t).setName("Gemini API \uD0A4").setDesc(createFragment(l=>{l.appendText("Gemini API \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694. "),l.createEl("a",{text:"API \uD0A4 \uBC1C\uAE09\uBC1B\uAE30",href:"https://aistudio.google.com/apikey"})})).addText(l=>l.setPlaceholder("AIzaSy...").setValue(this.plugin.settings.geminiApiKey).onChange(async u=>{this.plugin.settings.geminiApiKey=u,await this.plugin.saveSettings()})),t.createEl("h3",{text:"\uD3F4\uB354 \uC124\uC815"}),new he.Setting(t).setName("Inbox \uD3F4\uB354").setDesc("\uC0C8 \uB178\uD2B8\uAC00 \uC800\uC7A5\uB418\uB294 \uD3F4\uB354").addText(l=>l.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.inboxFolder).onChange(async u=>{this.plugin.settings.inboxFolder=u,await this.plugin.saveSettings()})),new he.Setting(t).setName("Projects \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uBCC4 \uD558\uC704 \uD3F4\uB354\uAC00 \uC0DD\uC131\uB429\uB2C8\uB2E4").addText(l=>l.setPlaceholder("01 Projects").setValue(this.plugin.settings.projectsFolder).onChange(async u=>{this.plugin.settings.projectsFolder=u,await this.plugin.saveSettings()})),new he.Setting(t).setName("Library \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uC5D0 \uC18D\uD558\uC9C0 \uC54A\uB294 \uCC38\uACE0 \uC790\uB8CC").addText(l=>l.setPlaceholder("02 Library").setValue(this.plugin.settings.libraryFolder).onChange(async u=>{this.plugin.settings.libraryFolder=u,await this.plugin.saveSettings()})),new he.Setting(t).setName("Archives \uD3F4\uB354").setDesc("\uC644\uB8CC\uB41C \uD504\uB85C\uC81D\uD2B8 (\uD1B5\uC9F8\uB85C \uC774\uB3D9)").addText(l=>l.setPlaceholder("03 Archives").setValue(this.plugin.settings.archivesFolder).onChange(async u=>{this.plugin.settings.archivesFolder=u,await this.plugin.saveSettings()})),new he.Setting(t).setName("Zettelkasten \uD3F4\uB354").setDesc("ZK \uC601\uAD6C \uB178\uD2B8 \uC800\uC7A5 \uC704\uCE58").addText(l=>l.setPlaceholder("10 Zettelkasten").setValue(this.plugin.settings.zettelFolder).onChange(async u=>{this.plugin.settings.zettelFolder=u,await this.plugin.saveSettings()})),new he.Setting(t).setName("\uD3F4\uB354 \uAD6C\uC870 \uC0DD\uC131").setDesc("\uC704\uC5D0 \uC124\uC815\uB41C \uD3F4\uB354\uB4E4\uC744 \uC790\uB3D9\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4").addButton(l=>l.setButtonText("\uD3F4\uB354 \uC0DD\uC131").setCta().onClick(async()=>{await this.createFolderStructure()})),t.createEl("h3",{text:"\uC635\uC158"}),new he.Setting(t).setName("Inbox \uC790\uB3D9 \uAC10\uC2DC").setDesc("Inbox \uD3F4\uB354\uC758 \uD30C\uC77C\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC2DC\uD558\uC5EC \uBD84\uB958").addToggle(l=>l.setValue(this.plugin.settings.autoWatch).onChange(async u=>{this.plugin.settings.autoWatch=u,await this.plugin.saveSettings(),u?this.plugin.startWatcher():this.plugin.stopWatcher()})),new he.Setting(t).setName("\uD2B8\uB9AC\uAC70 \uD0DC\uADF8").setDesc("\uC774 \uD0DC\uADF8\uAC00 \uC788\uB294 \uB178\uD2B8\uB9CC \uC790\uB3D9 \uBD84\uB958 (\uC608: #\uC644\uB8CC)").addText(l=>l.setPlaceholder("#\uC644\uB8CC").setValue(this.plugin.settings.triggerTag).onChange(async u=>{this.plugin.settings.triggerTag=u,await this.plugin.saveSettings()})),t.createEl("h3",{text:"OCR \uC124\uC815"}),new he.Setting(t).setName("OCR \uAE30\uB2A5 \uD65C\uC131\uD654").setDesc("\uC774\uBBF8\uC9C0 \uBC0F PDF\uC5D0\uC11C \uD14D\uC2A4\uD2B8 \uCD94\uCD9C").addToggle(l=>l.setValue(this.plugin.settings.ocrEnabled).onChange(async u=>{this.plugin.settings.ocrEnabled=u,await this.plugin.saveSettings()})),new he.Setting(t).setName("OCR \uD6C4 \uC6D0\uBCF8 \uC774\uB3D9").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC744 \uC9C0\uC815 \uD3F4\uB354\uB85C \uC774\uB3D9").addToggle(l=>l.setValue(this.plugin.settings.ocrMoveOriginal).onChange(async u=>{this.plugin.settings.ocrMoveOriginal=u,await this.plugin.saveSettings()})),new he.Setting(t).setName("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uD3F4\uB354").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC774 \uC774\uB3D9\uB420 \uD3F4\uB354").addText(l=>l.setPlaceholder("03 Archives/OCR_\uC6D0\uBCF8").setValue(this.plugin.settings.ocrOriginalFolder).onChange(async u=>{this.plugin.settings.ocrOriginalFolder=u,await this.plugin.saveSettings()})),t.createEl("h3",{text:"OCR \uC81C\uD55C (API \uC694\uAE08 \uBCF4\uD638)"}),new he.Setting(t).setName("\uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").setDesc("\uD55C \uBC88\uC5D0 \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 PDF \uD398\uC774\uC9C0 \uC218").addSlider(l=>l.setLimits(1,100,1).setValue(this.plugin.settings.ocrMaxPages).setDynamicTooltip().onChange(async u=>{this.plugin.settings.ocrMaxPages=u,await this.plugin.saveSettings()})).addExtraButton(l=>l.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (20)").onClick(async()=>{this.plugin.settings.ocrMaxPages=20,await this.plugin.saveSettings(),this.display()})),new he.Setting(t).setName("\uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30 (MB)").setDesc("\uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30").addSlider(l=>l.setLimits(1,50,1).setValue(this.plugin.settings.ocrMaxFileSizeMB).setDynamicTooltip().onChange(async u=>{this.plugin.settings.ocrMaxFileSizeMB=u,await this.plugin.saveSettings()})).addExtraButton(l=>l.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (10)").onClick(async()=>{this.plugin.settings.ocrMaxFileSizeMB=10,await this.plugin.saveSettings(),this.display()})),new he.Setting(t).setName("\uC77C\uC77C \uCC98\uB9AC \uD55C\uB3C4 (\uD398\uC774\uC9C0)").setDesc("\uD558\uB8E8\uC5D0 OCR \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").addSlider(l=>l.setLimits(10,500,10).setValue(this.plugin.settings.ocrDailyLimit).setDynamicTooltip().onChange(async u=>{this.plugin.settings.ocrDailyLimit=u,await this.plugin.saveSettings()})).addExtraButton(l=>l.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (50)").onClick(async()=>{this.plugin.settings.ocrDailyLimit=50,await this.plugin.saveSettings(),this.display()})),t.createDiv({cls:"ocr-usage-info"}).createEl("p",{text:`\uC624\uB298 \uC0AC\uC6A9\uB7C9: ${this.plugin.getOCRDailyUsage().pagesProcessed}/${this.plugin.settings.ocrDailyLimit} \uD398\uC774\uC9C0`,cls:"setting-item-description"}),t.createEl("h3",{text:"AI \uC694\uC57D \uC124\uC815"}),new he.Setting(t).setName("\uC0C1\uC138 \uC694\uC57D").setDesc("\uD65C\uC131\uD654 \uC2DC \uB354 \uAE34 \uC694\uC57D(8-15\uBB38\uC7A5)\uACFC \uB354 \uB9CE\uC740 \uD575\uC2EC \uD3EC\uC778\uD2B8(10-20\uAC1C)\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4. OCR, YouTube, \uC6F9\uD398\uC774\uC9C0 \uC694\uC57D\uC5D0 \uC801\uC6A9\uB429\uB2C8\uB2E4.").addToggle(l=>l.setValue(this.plugin.settings.detailedSummary).onChange(async u=>{this.plugin.settings.detailedSummary=u,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Zettelkasten \uC124\uC815"}),new he.Setting(t).setName("ZK \uB178\uD2B8 ID \uD615\uC2DD").setDesc("ZK \uB178\uD2B8 \uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uD560 ID \uD615\uC2DD").addDropdown(l=>l.addOption("timestamp","\uD0C0\uC784\uC2A4\uD0EC\uD504 (1735789200000)").addOption("date-sequence","\uB0A0\uC9DC+\uC21C\uBC88 (20260102-001)").addOption("luhmann","\uB8E8\uB9CC \uC2A4\uD0C0\uC77C (1a1b)").setValue(this.plugin.settings.zkIdType).onChange(async u=>{this.plugin.settings.zkIdType=u,await this.plugin.saveSettings()})),new he.Setting(t).setName("\uC720\uC0AC \uB178\uD2B8 \uBCD1\uD569 \uC784\uACC4\uAC12").setDesc("\uC774 \uAC12 \uC774\uC0C1\uC758 \uC720\uC0AC\uB3C4\uB97C \uAC00\uC9C4 \uB178\uD2B8\uAC00 \uC788\uC73C\uBA74 \uBCD1\uD569 \uC81C\uC548 (0.5~1.0)").addSlider(l=>l.setLimits(.5,1,.05).setValue(this.plugin.settings.zkMergeThreshold).setDynamicTooltip().onChange(async u=>{this.plugin.settings.zkMergeThreshold=u,await this.plugin.saveSettings()})).addExtraButton(l=>l.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (0.8)").onClick(async()=>{this.plugin.settings.zkMergeThreshold=.8,await this.plugin.saveSettings(),this.display()})),t.createEl("h3",{text:"\uC2DC\uAC04\uB300 \uBC0F \uB0A0\uC9DC \uD615\uC2DD"}),new he.Setting(t).setName("\uC2DC\uAC04\uB300").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504\uC5D0 \uC0AC\uC6A9\uD560 \uC2DC\uAC04\uB300").addDropdown(l=>{oL.forEach(u=>{l.addOption(u.value,u.label)}),l.setValue(this.plugin.settings.timezone).onChange(async u=>{this.plugin.settings.timezone=u,await this.plugin.saveSettings()})}),new he.Setting(t).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504 \uD45C\uC2DC \uD615\uC2DD").addDropdown(l=>{aL.forEach(u=>{l.addOption(u.value,u.label)}),l.setValue(this.plugin.settings.dateFormat).onChange(async u=>{this.plugin.settings.dateFormat=u,await this.plugin.saveSettings()})}),t.createEl("h3",{text:"\uC77C\uC815 \uAC10\uC9C0"}),new he.Setting(t).setName("\uC77C\uC815 \uC790\uB3D9 \uAC10\uC9C0").setDesc("\uB178\uD2B8 \uBD84\uB958 \uC2DC \uC77C\uC815/\uD560\uC77C/\uC57D\uC18D\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC9C0").addToggle(l=>l.setValue(this.plugin.settings.scheduleDetectionEnabled).onChange(async u=>{this.plugin.settings.scheduleDetectionEnabled=u,await this.plugin.saveSettings()})),new he.Setting(t).setName("Daily Notes \uD3F4\uB354").setDesc("\uC77C\uC815\uC774 \uC800\uC7A5\uB420 Daily Notes \uD3F4\uB354").addText(l=>l.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.dailyNotesFolder).onChange(async u=>{this.plugin.settings.dailyNotesFolder=u,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Google Calendar \uC5F0\uB3D9"}),new he.Setting(t).setName("Google Calendar \uD65C\uC131\uD654").setDesc("\uC77C\uC815\uC744 Google Calendar\uC5D0\uB3C4 \uC800\uC7A5\uD569\uB2C8\uB2E4").addToggle(l=>l.setValue(this.plugin.settings.googleCalendarEnabled).onChange(async u=>{this.plugin.settings.googleCalendarEnabled=u,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.googleCalendarEnabled){let l=!!this.plugin.settings.googleRefreshToken,u=l?"\uC5F0\uACB0\uB428 \u2713":"\uC5F0\uACB0 \uC548\uB428";if(new he.Setting(t).setName("Google \uACC4\uC815").setDesc(u).addButton(h=>h.setButtonText(l?"\uC7AC\uC5F0\uACB0":"\uC5F0\uACB0\uD558\uAE30").setCta().onClick(async()=>{await this.plugin.connectGoogleCalendar()})).addButton(h=>(l&&h.setButtonText("\uC5F0\uACB0 \uD574\uC81C").onClick(async()=>{await this.plugin.disconnectGoogleCalendar(),this.display()}),h)),new he.Setting(t).setName("\uC790\uCCB4 API \uD0A4 \uC0AC\uC6A9 (Advanced)").setDesc("\uC9C1\uC811 Google Cloud Console\uC5D0\uC11C \uC0DD\uC131\uD55C Client ID\uB97C \uC0AC\uC6A9\uD569\uB2C8\uB2E4").addToggle(h=>h.setValue(this.plugin.settings.useOwnApiKey).onChange(async d=>{this.plugin.settings.useOwnApiKey=d,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.useOwnApiKey){new he.Setting(t).setName("Google Client ID").setDesc("Google Cloud Console\uC5D0\uC11C \uC0DD\uC131\uD55C OAuth 2.0 Client ID").addText(d=>d.setPlaceholder("xxxxx.apps.googleusercontent.com").setValue(this.plugin.settings.googleClientId).onChange(async c=>{this.plugin.settings.googleClientId=c,await this.plugin.saveSettings()})),new he.Setting(t).setName("Google Client Secret").setDesc("OAuth 2.0 Client Secret").addText(d=>d.setPlaceholder("GOCSPX-...").setValue(this.plugin.settings.googleClientSecret).onChange(async c=>{this.plugin.settings.googleClientSecret=c,await this.plugin.saveSettings()}));let h=t.createDiv({cls:"setting-item-description"});h.createEl("p",{text:"Google Cloud Console\uC5D0\uC11C OAuth 2.0 \uD074\uB77C\uC774\uC5B8\uD2B8 ID\uB97C \uC0DD\uC131\uD558\uC138\uC694:"}),h.createEl("a",{text:"Google Cloud Console \uC5F4\uAE30",href:"https://console.cloud.google.com/apis/credentials"}),h.createEl("p",{text:"\uB9AC\uB514\uB809\uC158 URI: http://127.0.0.1:42813/callback",cls:"setting-item-description"}).style.fontFamily="monospace"}}if(t.createEl("h3",{text:"\uCE98\uB9B0\uB354 \uBDF0"}),new he.Setting(t).setName("\uCE98\uB9B0\uB354 \uBDF0 \uD65C\uC131\uD654").setDesc("\uB178\uD2B8, \uC77C\uC815, \uD68C\uC758\uB85D\uC744 \uCE98\uB9B0\uB354\uB85C \uD655\uC778\uD569\uB2C8\uB2E4").addToggle(l=>l.setValue(this.plugin.settings.calendarEnabled).onChange(async u=>{this.plugin.settings.calendarEnabled=u,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.calendarEnabled&&(new he.Setting(t).setName("\uAE30\uBCF8 \uBDF0").setDesc("\uCE98\uB9B0\uB354\uB97C \uC5F4 \uB54C \uAE30\uBCF8\uC73C\uB85C \uD45C\uC2DC\uD560 \uBDF0").addDropdown(l=>l.addOption("month","\uC6D4\uAC04").addOption("week","\uC8FC\uAC04").addOption("day","\uC77C\uAC04").addOption("list","\uBAA9\uB85D").setValue(this.plugin.settings.calendarDefaultView).onChange(async u=>{this.plugin.settings.calendarDefaultView=u,await this.plugin.saveSettings()})),new he.Setting(t).setName("\uC8FC \uC2DC\uC791\uC77C").setDesc("\uCE98\uB9B0\uB354\uC758 \uCCAB \uBC88\uC9F8 \uC694\uC77C").addDropdown(l=>l.addOption("0","\uC77C\uC694\uC77C").addOption("1","\uC6D4\uC694\uC77C").setValue(String(this.plugin.settings.calendarFirstDayOfWeek)).onChange(async u=>{this.plugin.settings.calendarFirstDayOfWeek=parseInt(u),await this.plugin.saveSettings()})),new he.Setting(t).setName("\uC0AC\uC774\uB4DC\uBC14 \uBBF8\uB2C8 \uCE98\uB9B0\uB354").setDesc("\uC624\uB978\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uBBF8\uB2C8 \uCE98\uB9B0\uB354\uB97C \uD45C\uC2DC\uD569\uB2C8\uB2E4").addToggle(l=>l.setValue(this.plugin.settings.showMiniCalendar).onChange(async u=>{this.plugin.settings.showMiniCalendar=u,await this.plugin.saveSettings(),u&&await this.plugin.toggleMiniCalendar()})),new he.Setting(t).setName("\uCE98\uB9B0\uB354 \uC5D4\uC9C4").setDesc(createFragment(l=>{l.appendText("FullCalendar.js (\uD480\uAE30\uB2A5) \uB610\uB294 \uC790\uCCB4 \uAD6C\uD604 (\uACBD\uB7C9) \uC120\uD0DD"),l.createEl("br"),l.createEl("span",{text:"\u{1F4A1} \uC5D4\uC9C4 \uBCC0\uACBD \uD6C4 \uC544\uB798 '\uCE98\uB9B0\uB354 \uBDF0 \uC7AC\uC2DC\uC791' \uBC84\uD2BC\uC744 \uD074\uB9AD\uD558\uC138\uC694",cls:"setting-item-description"}).style.color="var(--text-accent)"})).addDropdown(l=>l.addOption("fullcalendar","FullCalendar.js (\uD480\uAE30\uB2A5)").addOption("native","\uC790\uCCB4 \uAD6C\uD604 (\uACBD\uB7C9)").setValue(this.plugin.settings.calendarEngine).onChange(async u=>{this.plugin.settings.calendarEngine=u,await this.plugin.saveSettings()})),new he.Setting(t).setName("\uCE98\uB9B0\uB354 \uBDF0 \uC7AC\uC2DC\uC791").setDesc("\uC5D4\uC9C4 \uBCC0\uACBD \uD6C4 \uCE98\uB9B0\uB354 \uBDF0\uB97C \uB2E4\uC2DC \uC5F4\uC5B4 \uC801\uC6A9\uD569\uB2C8\uB2E4").addButton(l=>l.setButtonText("\uCE98\uB9B0\uB354 \uBDF0 \uC7AC\uC2DC\uC791").onClick(async()=>{await this.plugin.restartCalendarView(),new he.Notice("\uCE98\uB9B0\uB354 \uBDF0\uAC00 \uC7AC\uC2DC\uC791\uB418\uC5C8\uC2B5\uB2C8\uB2E4")})),new he.Setting(t).setName("\uCE98\uB9B0\uB354 \uC5F4\uAE30").setDesc("Ctrl+Shift+C \uB610\uB294 \uB9AC\uBCF8 \uC544\uC774\uCF58\uC73C\uB85C\uB3C4 \uC5F4 \uC218 \uC788\uC2B5\uB2C8\uB2E4").addButton(l=>l.setButtonText("\uCE98\uB9B0\uB354 \uC5F4\uAE30").setCta().onClick(async()=>{await this.plugin.openCalendarView()}))),t.createEl("h3",{text:"Embedding \uAE30\uBC18 \uAC80\uC0C9 (Beta)"}),new he.Setting(t).setName("Embedding \uD65C\uC131\uD654").setDesc(createFragment(l=>{l.appendText("\uD0A4\uC6CC\uB4DC \uB300\uC2E0 \uC758\uBBF8 \uAE30\uBC18 \uC720\uC0AC\uB3C4\uB85C \uAD00\uB828 \uB178\uD2B8\uB97C \uCC3E\uC2B5\uB2C8\uB2E4. "),l.createEl("br"),l.appendText("\uD65C\uC131\uD654 \uC2DC \uBAA8\uB4E0 \uB178\uD2B8\uC758 \uC784\uBCA0\uB529\uC744 \uC0DD\uC131\uD569\uB2C8\uB2E4 (\uC2DC\uAC04\uC774 \uAC78\uB9B4 \uC218 \uC788\uC74C).")})).addToggle(l=>l.setValue(this.plugin.settings.embeddingEnabled).onChange(async u=>{this.plugin.settings.embeddingEnabled=u,await this.plugin.saveSettings(),this.display(),u&&(new he.Notice("Embedding \uC778\uB371\uC2A4 \uAD6C\uCD95\uC744 \uC2DC\uC791\uD569\uB2C8\uB2E4..."),this.plugin.embeddingManager&&(await this.plugin.embeddingManager.buildFullIndex((h,d,c)=>{(h%10===0||h===d)&&new he.Notice(`Embedding: ${h}/${d}`)}),new he.Notice("Embedding \uC778\uB371\uC2A4 \uAD6C\uCD95 \uC644\uB8CC!")))})),this.plugin.settings.embeddingEnabled){new he.Setting(t).setName("\uC720\uC0AC\uB3C4 \uC784\uACC4\uAC12").setDesc("\uC774 \uAC12 \uC774\uC0C1\uC758 \uC720\uC0AC\uB3C4\uB97C \uAC00\uC9C4 \uB178\uD2B8\uB9CC \uCD94\uCC9C\uD569\uB2C8\uB2E4 (0.5~0.95)").addSlider(u=>u.setLimits(.5,.95,.05).setValue(this.plugin.settings.embeddingSimilarityThreshold).setDynamicTooltip().onChange(async h=>{this.plugin.settings.embeddingSimilarityThreshold=h,await this.plugin.saveSettings()})).addExtraButton(u=>u.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (0.7)").onClick(async()=>{this.plugin.settings.embeddingSimilarityThreshold=.7,await this.plugin.saveSettings(),this.display()})),new he.Setting(t).setName("\uC790\uB3D9 \uC784\uBCA0\uB529").setDesc(createFragment(u=>{u.appendText("\uB178\uD2B8 \uC0DD\uC131/\uC218\uC815 \uC2DC \uC790\uB3D9\uC73C\uB85C \uC784\uBCA0\uB529\uC744 \uC5C5\uB370\uC774\uD2B8\uD569\uB2C8\uB2E4. "),u.createEl("br"),u.createEl("strong",{text:"\u{1F4A1} \uB3D9\uAE30\uD654 \uD301: "}),u.appendText("PC\uC5D0\uC11C\uB9CC \uCF1C\uACE0, \uBAA8\uBC14\uC77C\uC5D0\uC11C\uB294 \uB044\uC138\uC694.")})).addToggle(u=>u.setValue(this.plugin.settings.autoEmbeddingEnabled).onChange(async h=>{this.plugin.settings.autoEmbeddingEnabled=h,await this.plugin.saveSettings()}));let l=t.createEl("details",{cls:"zfb-chunk-settings"});if(l.createEl("summary",{text:"\u{1F4E6} \uCCAD\uD06C \uBD84\uD560 \uC124\uC815 (\uACE0\uAE09)"}),new he.Setting(l).setName("\uCCAD\uD06C \uD06C\uAE30").setDesc("\uB178\uD2B8\uB97C \uBD84\uD560\uD558\uB294 \uB2E8\uC704 \uD06C\uAE30 (200~1000\uC790)").addText(u=>u.setPlaceholder("500").setValue(String(this.plugin.settings.embeddingChunkSize||500)).onChange(async h=>{let d=parseInt(h);d>=200&&d<=1e3&&(this.plugin.settings.embeddingChunkSize=d,await this.plugin.saveSettings())})),new he.Setting(l).setName("\uCCAD\uD06C \uC624\uBC84\uB7A9").setDesc("\uCCAD\uD06C \uAC04 \uC911\uBCF5 \uC601\uC5ED (0~100\uC790)").addText(u=>u.setPlaceholder("50").setValue(String(this.plugin.settings.embeddingChunkOverlap||50)).onChange(async h=>{let d=parseInt(h);d>=0&&d<=100&&(this.plugin.settings.embeddingChunkOverlap=d,await this.plugin.saveSettings())})),l.createEl("p",{text:"\u26A0\uFE0F \uC124\uC815 \uBCC0\uACBD \uC2DC \uC778\uB371\uC2A4 \uC7AC\uAD6C\uCD95 \uD544\uC694",cls:"setting-item-description"}),this.plugin.embeddingManager){let u=this.plugin.embeddingManager.getStats(),h=t.createDiv({cls:"embedding-stats-info"});h.createEl("p",{text:`\uC778\uB371\uC2F1\uB41C \uB178\uD2B8: ${u.totalNotes}\uAC1C`,cls:"setting-item-description"}),u.totalChunks!==void 0&&h.createEl("p",{text:`\uCD1D \uCCAD\uD06C: ${u.totalChunks}\uAC1C`,cls:"setting-item-description"}),u.lastFullScan&&h.createEl("p",{text:`\uB9C8\uC9C0\uB9C9 \uC804\uCCB4 \uC2A4\uCE94: ${new Date(u.lastFullScan).toLocaleString()}`,cls:"setting-item-description"})}new he.Setting(t).setName("\uC778\uB371\uC2A4 \uC7AC\uAD6C\uCD95").setDesc("\uBAA8\uB4E0 \uB178\uD2B8\uC758 \uC784\uBCA0\uB529\uC744 \uB2E4\uC2DC \uC0DD\uC131\uD569\uB2C8\uB2E4 (\uC2DC\uAC04\uC774 \uAC78\uB9B4 \uC218 \uC788\uC74C)").addButton(u=>u.setButtonText("\uC7AC\uAD6C\uCD95").onClick(async()=>{if(this.plugin.embeddingManager){new he.Notice("Embedding \uC778\uB371\uC2A4 \uC7AC\uAD6C\uCD95 \uC2DC\uC791..."),await this.plugin.embeddingManager.clearIndex();let h=await this.plugin.embeddingManager.buildFullIndex((d,c)=>{(d%10===0||d===c)&&new he.Notice(`Embedding: ${d}/${c}`)});new he.Notice(`\uC7AC\uAD6C\uCD95 \uC644\uB8CC! \uC131\uACF5: ${h.success}, \uC2A4\uD0B5: ${h.skipped}, \uC2E4\uD328: ${h.failed}`),this.display()}})),new he.Setting(t).setName("\uC0AD\uC81C\uB41C \uD30C\uC77C \uC784\uBCA0\uB529 \uC815\uB9AC").setDesc("\uC0AD\uC81C\uB41C \uB178\uD2B8\uC758 \uC784\uBCA0\uB529\uC744 \uC815\uB9AC\uD569\uB2C8\uB2E4").addButton(u=>u.setButtonText("\uC815\uB9AC").onClick(async()=>{if(this.plugin.embeddingManager){let h=await this.plugin.embeddingManager.cleanupOrphanedEmbeddings();new he.Notice(`${h}\uAC1C\uC758 \uBBF8\uC0AC\uC6A9 \uC784\uBCA0\uB529\uC774 \uC815\uB9AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4`),this.display()}}))}if(t.createEl("h3",{text:"RAG \uCC57\uBD07"}),new he.Setting(t).setName("RAG \uCC57\uBD07 \uD65C\uC131\uD654").setDesc(createFragment(l=>{l.appendText("\uB178\uD2B8 \uAE30\uBC18 Q&A \uCC57\uBD07\uC744 \uD65C\uC131\uD654\uD569\uB2C8\uB2E4. "),l.createEl("br"),l.appendText("Embedding\uC774 \uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC5B4\uC57C \uD569\uB2C8\uB2E4.")})).addToggle(l=>l.setValue(this.plugin.settings.ragEnabled).setDisabled(!this.plugin.settings.embeddingEnabled).onChange(async u=>{this.plugin.settings.ragEnabled=u,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.embeddingEnabled||t.createDiv({cls:"setting-item-description"}).createEl("p",{text:"\u26A0\uFE0F RAG \uCC57\uBD07\uC744 \uC0AC\uC6A9\uD558\uB824\uBA74 \uBA3C\uC800 Embedding\uC744 \uD65C\uC131\uD654\uD558\uC138\uC694.",cls:"mod-warning"}),this.plugin.settings.ragEnabled&&this.plugin.settings.embeddingEnabled&&(new he.Setting(t).setName("\uAC80\uC0C9\uD560 \uB178\uD2B8 \uC218 (Top-K)").setDesc("\uC9C8\uBB38\uACFC \uAD00\uB828\uB41C \uB178\uD2B8\uB97C \uBA87 \uAC1C\uAE4C\uC9C0 \uAC80\uC0C9\uD560\uC9C0 \uC124\uC815\uD569\uB2C8\uB2E4").addSlider(l=>l.setLimits(1,10,1).setValue(this.plugin.settings.ragTopK).setDynamicTooltip().onChange(async u=>{this.plugin.settings.ragTopK=u,await this.plugin.saveSettings()})).addExtraButton(l=>l.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (5)").onClick(async()=>{this.plugin.settings.ragTopK=5,await this.plugin.saveSettings(),this.display()})),new he.Setting(t).setName("\uCEE8\uD14D\uC2A4\uD2B8 \uCD5C\uB300 \uAE38\uC774").setDesc("AI\uC5D0\uAC8C \uC804\uB2EC\uD560 \uB178\uD2B8 \uB0B4\uC6A9\uC758 \uCD5C\uB300 \uAE00\uC790 \uC218 (1000~10000)").addSlider(l=>l.setLimits(1e3,1e4,500).setValue(this.plugin.settings.ragMaxContextLength).setDynamicTooltip().onChange(async u=>{this.plugin.settings.ragMaxContextLength=u,await this.plugin.saveSettings()})).addExtraButton(l=>l.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (4000)").onClick(async()=>{this.plugin.settings.ragMaxContextLength=4e3,await this.plugin.saveSettings(),this.display()})),new he.Setting(t).setName("\uCC57\uBD07 \uC5F4\uAE30").setDesc("Ctrl+Shift+' \uB610\uB294 \uB9AC\uBCF8 \uC544\uC774\uCF58\uC73C\uB85C\uB3C4 \uC5F4 \uC218 \uC788\uC2B5\uB2C8\uB2E4").addButton(l=>l.setButtonText("\uCC57\uBD07 \uC5F4\uAE30").setCta().onClick(async()=>{await this.plugin.toggleChatbot()}))),t.createEl("h3",{text:"\uB370\uC774\uD130 \uB3D9\uAE30\uD654"}),new he.Setting(t).setName("\uB370\uC774\uD130 \uC800\uC7A5 \uC704\uCE58").setDesc(createFragment(l=>{l.appendText("\uBCFC\uD2B8 \uB0B4\uBD80\uC5D0 \uC800\uC7A5\uD558\uBA74 Obsidian Sync\uB85C \uB3D9\uAE30\uD654\uB429\uB2C8\uB2E4."),l.createEl("br"),l.appendText("\uBCC0\uACBD \uD6C4 \uD50C\uB7EC\uADF8\uC778 \uC7AC\uC2DC\uC791\uC774 \uD544\uC694\uD569\uB2C8\uB2E4.")})).addDropdown(l=>l.addOption("plugin","\uD50C\uB7EC\uADF8\uC778 \uD3F4\uB354 (\uAE30\uBCF8)").addOption("vault","\uBCFC\uD2B8 \uB0B4\uBD80 (.zfb-data)").setValue(this.plugin.settings.dataStorageLocation).onChange(async u=>{this.plugin.settings.dataStorageLocation=u,await this.plugin.saveSettings(),new he.Notice(`\uB370\uC774\uD130 \uC800\uC7A5 \uC704\uCE58\uAC00 \uBCC0\uACBD\uB418\uC5C8\uC2B5\uB2C8\uB2E4.
\uD50C\uB7EC\uADF8\uC778\uC744 \uC7AC\uC2DC\uC791\uD558\uBA74 \uC801\uC6A9\uB429\uB2C8\uB2E4.`)})),this.plugin.settings.dataStorageLocation==="vault"){new he.Setting(t).setName("\uB370\uC774\uD130 \uD3F4\uB354 \uACBD\uB85C").setDesc("\uBCFC\uD2B8 \uB0B4 \uB370\uC774\uD130 \uC800\uC7A5 \uD3F4\uB354 (embeddings, chats, feedback)").addText(u=>u.setPlaceholder(".zfb-data").setValue(this.plugin.settings.dataFolderPath).onChange(async h=>{this.plugin.settings.dataFolderPath=h||".zfb-data",await this.plugin.saveSettings()}));let l=t.createDiv({cls:"setting-item-description"});l.createEl("p",{text:`\uC800\uC7A5 \uACBD\uB85C: ${this.plugin.settings.dataFolderPath}/`}),l.createEl("p",{text:"\u2022 embeddings.json (Embedding \uC778\uB371\uC2A4)",cls:"setting-item-description"}),l.createEl("p",{text:"\u2022 chats.json (\uCC57\uBD07 \uB300\uD654)",cls:"setting-item-description"}),l.createEl("p",{text:"\u2022 feedback.json (\uD53C\uB4DC\uBC31 \uB370\uC774\uD130)",cls:"setting-item-description"})}t.createEl("h3",{text:"\uD15C\uD50C\uB9BF"});let o=t.createDiv({cls:"setting-item-description"});o.createEl("p",{text:"\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uBCC0\uC218:"}),o.innerHTML+=`
			<code>{{title}}</code> \uC81C\uBAA9 &nbsp;
			<code>{{url}}</code> URL &nbsp;
			<code>{{summary}}</code> \uC694\uC57D &nbsp;
			<code>{{keyPoints}}</code> \uD575\uC2EC \uD3EC\uC778\uD2B8 &nbsp;
			<code>{{date}}</code> \uB0A0\uC9DC &nbsp;
			<code>{{iframe}}</code> \uC784\uBCA0\uB4DC
		`,new he.Setting(t).setName("YouTube \uD15C\uD50C\uB9BF").setDesc("YouTube \uC601\uC0C1 \uB178\uD2B8 \uC0DD\uC131 \uC2DC \uC0AC\uC6A9\uD560 \uD15C\uD50C\uB9BF").addTextArea(l=>{l.inputEl.rows=12,l.inputEl.cols=50,l.inputEl.addClass("zfb-template-textarea"),l.setValue(this.plugin.settings.youtubeTemplate).onChange(async u=>{this.plugin.settings.youtubeTemplate=u,await this.plugin.saveSettings()})}).addExtraButton(l=>l.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12\uC73C\uB85C \uCD08\uAE30\uD654").onClick(async()=>{let{DEFAULT_SETTINGS:u}=await Promise.resolve().then(()=>(Li(),JS));this.plugin.settings.youtubeTemplate=u.youtubeTemplate,await this.plugin.saveSettings(),this.display()})),new he.Setting(t).setName("\uC6F9\uD398\uC774\uC9C0 \uD15C\uD50C\uB9BF").setDesc("\uC6F9\uD398\uC774\uC9C0 \uB178\uD2B8 \uC0DD\uC131 \uC2DC \uC0AC\uC6A9\uD560 \uD15C\uD50C\uB9BF").addTextArea(l=>{l.inputEl.rows=12,l.inputEl.cols=50,l.inputEl.addClass("zfb-template-textarea"),l.setValue(this.plugin.settings.webpageTemplate).onChange(async u=>{this.plugin.settings.webpageTemplate=u,await this.plugin.saveSettings()})}).addExtraButton(l=>l.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12\uC73C\uB85C \uCD08\uAE30\uD654").onClick(async()=>{let{DEFAULT_SETTINGS:u}=await Promise.resolve().then(()=>(Li(),JS));this.plugin.settings.webpageTemplate=u.webpageTemplate,await this.plugin.saveSettings(),this.display()})),t.createEl("h3",{text:"API \uC0AC\uC6A9\uB7C9 \uCD94\uC801"}),new he.Setting(t).setName("\uC0AC\uC6A9\uB7C9 \uCD94\uC801").setDesc("Gemini API \uD1A0\uD070 \uC0AC\uC6A9\uB7C9\uC744 \uCD94\uC801\uD569\uB2C8\uB2E4").addToggle(l=>l.setValue(this.plugin.settings.usageTrackingEnabled).onChange(async u=>{this.plugin.settings.usageTrackingEnabled=u,await this.plugin.saveSettings(),await this.plugin.toggleUsageTracker(u),this.display()})),this.plugin.settings.usageTrackingEnabled&&this.renderUsageSettings(t)}async renderUsageSettings(t){await this.plugin.usageTracker?.loadUsage(),new he.Setting(t).setName("\uC800\uC7A5 \uAE30\uAC04").setDesc("\uC0AC\uC6A9\uB7C9 \uB370\uC774\uD130 \uBCF4\uAD00 \uAE30\uAC04").addDropdown(n=>{KS.forEach(i=>{n.addOption(i.value,`${i.label} - ${i.desc}`)}),n.setValue(this.plugin.settings.usageStorageMode).onChange(async i=>{this.plugin.settings.usageStorageMode=i,await this.plugin.saveSettings(),this.plugin.usageTracker&&(this.plugin.usageTracker.pruneOldData(),await this.plugin.usageTracker.saveUsage())})}),new he.Setting(t).setName("\uC0C1\uD0DC\uBC14 \uD45C\uC2DC").setDesc("\uD558\uB2E8 \uC0C1\uD0DC\uBC14\uC5D0 \uC624\uB298 \uC0AC\uC6A9\uB7C9\uC744 \uD45C\uC2DC\uD569\uB2C8\uB2E4").addToggle(n=>n.setValue(this.plugin.settings.usageShowStatusBar).onChange(async i=>{this.plugin.settings.usageShowStatusBar=i,await this.plugin.saveSettings(),this.plugin.usageTracker&&this.plugin.usageTracker.updateStatusBar()})),this.renderTodayUsage(t),this.renderMonthUsage(t),this.renderUsageButtons(t)}renderTodayUsage(t){let n=this.plugin.usageTracker?.getTodayUsage(),i=t.createDiv({cls:"zfb-usage-section"});if(i.createEl("h4",{text:"\uC624\uB298 \uC0AC\uC6A9\uB7C9"}),!n){i.createEl("p",{text:"\uC624\uB298 \uC0AC\uC6A9 \uAE30\uB85D\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.",cls:"zfb-usage-empty"});return}let r=this.plugin.usageTracker?.calculateCost(n.totalInputTokens,n.totalOutputTokens,"gemini-3-flash-preview")??0,o=i.createDiv({cls:"zfb-usage-stats-grid"});this.createStatItem(o,"\uC785\uB825 \uD1A0\uD070",n.totalInputTokens.toLocaleString()),this.createStatItem(o,"\uCD9C\uB825 \uD1A0\uD070",n.totalOutputTokens.toLocaleString()),this.createStatItem(o,"\uCD1D \uD638\uCD9C",n.totalCalls.toString()),this.createStatItem(o,"\uC608\uC0C1 \uBE44\uC6A9",`$${r.toFixed(4)}`);let l=i.createDiv({cls:"zfb-usage-features"});l.createEl("strong",{text:"\uAE30\uB2A5\uBCC4 \uD638\uCD9C:"});let u=l.createDiv({cls:"zfb-usage-feature-list"});Object.entries(n.callsByFeature).filter(([h,d])=>d>0).sort((h,d)=>d[1]-h[1]).forEach(([h,d])=>{let c=YS[h]||h;u.createSpan({text:`${c}: ${d}`,cls:"zfb-usage-feature-item"})})}renderMonthUsage(t){let n=this.plugin.usageTracker?.getThisMonthUsage();if(!n||n.inputTokens===0&&n.outputTokens===0)return;let i=this.plugin.usageTracker?.calculateCost(n.inputTokens,n.outputTokens,"gemini-3-flash-preview")??0,r=t.createDiv({cls:"zfb-usage-section"});r.createEl("h4",{text:"\uC774\uBC88 \uB2EC \uB204\uC801"});let o=r.createDiv({cls:"zfb-usage-stats-grid"});this.createStatItem(o,"\uC785\uB825 \uD1A0\uD070",n.inputTokens.toLocaleString()),this.createStatItem(o,"\uCD9C\uB825 \uD1A0\uD070",n.outputTokens.toLocaleString()),this.createStatItem(o,"\uCD1D \uD638\uCD9C",n.calls.toString()),this.createStatItem(o,"\uC608\uC0C1 \uBE44\uC6A9",`$${i.toFixed(4)}`)}renderUsageButtons(t){let n=t.createDiv({cls:"zfb-usage-buttons"});new he.Setting(n).addButton(i=>i.setButtonText("\uB370\uC774\uD130 \uCD08\uAE30\uD654").setWarning().onClick(async()=>{confirm("\uBAA8\uB4E0 \uC0AC\uC6A9\uB7C9 \uB370\uC774\uD130\uB97C \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")&&(await this.plugin.usageTracker?.resetUsage(),new he.Notice("\uC0AC\uC6A9\uB7C9 \uB370\uC774\uD130\uAC00 \uCD08\uAE30\uD654\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),this.display())})),new he.Setting(n).addButton(i=>i.setButtonText("CSV \uB0B4\uBCF4\uB0B4\uAE30").onClick(async()=>{let r=this.plugin.usageTracker?.exportToCSV();if(r){let o=`zfb-usage-${new Date().toISOString().split("T")[0]}.csv`,l=new Blob([r],{type:"text/csv"}),u=URL.createObjectURL(l),h=document.createElement("a");h.href=u,h.download=o,h.click(),URL.revokeObjectURL(u),new he.Notice("CSV \uD30C\uC77C\uC774 \uB2E4\uC6B4\uB85C\uB4DC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}}))}createStatItem(t,n,i){let r=t.createDiv({cls:"zfb-usage-stat-item"});r.createSpan({text:n,cls:"stat-label"}),r.createSpan({text:i,cls:"stat-value"})}async createFolderStructure(){let t=[this.plugin.settings.inboxFolder,this.plugin.settings.projectsFolder,this.plugin.settings.libraryFolder,this.plugin.settings.archivesFolder,this.plugin.settings.zettelFolder],n=0,i=0;for(let r of t){if(!r)continue;if(this.app.vault.getAbstractFileByPath(r))i++;else try{await this.app.vault.createFolder(r),n++}catch(l){console.error(`\uD3F4\uB354 \uC0DD\uC131 \uC2E4\uD328: ${r}`,l)}}n>0?new he.Notice(`${n}\uAC1C \uD3F4\uB354 \uC0DD\uC131\uB428, ${i}\uAC1C \uC774\uBBF8 \uC874\uC7AC`):new he.Notice(`\uBAA8\uB4E0 \uD3F4\uB354\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4 (${i}\uAC1C)`)}renderPresetDescription(t,n){t.empty();let i=os[n],r=t.createDiv({cls:"preset-desc-content"});r.createEl("strong",{text:`${i.icon} ${i.label}`});let o=r.createDiv({cls:"preset-details"});switch(n){case"basic":o.innerHTML=`
					<p>\uD575\uC2EC \uAE30\uB2A5\uB9CC \uD65C\uC131\uD654\uD558\uC5EC \uAC00\uBCCD\uAC8C \uC2DC\uC791\uD569\uB2C8\uB2E4.</p>
					<ul>
						<li>\u2705 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 (Ctrl+Shift+G)</li>
						<li>\u2705 URL \uC694\uC57D (Ctrl+Shift+U)</li>
						<li>\u2705 OCR \uCD94\uCD9C (Ctrl+Shift+O)</li>
						<li>\u274C Embedding/RAG \uCC57\uBD07</li>
						<li>\u274C \uCE98\uB9B0\uB354/\uC77C\uC815 \uAC10\uC9C0</li>
					</ul>
				`;break;case"power":o.innerHTML=`
					<p>\uC804\uCCB4 \uAE30\uB2A5\uC744 \uD65C\uC131\uD654\uD569\uB2C8\uB2E4. (\uAD8C\uC7A5)</p>
					<ul>
						<li>\u2705 \uBAA8\uB4E0 \uAE30\uBCF8 \uAE30\uB2A5</li>
						<li>\u2705 Embedding \uAE30\uBC18 \uAC80\uC0C9</li>
						<li>\u2705 RAG \uCC57\uBD07</li>
						<li>\u2705 \uCE98\uB9B0\uB354 \uBDF0</li>
						<li>\u2705 \uC77C\uC815 \uC790\uB3D9 \uAC10\uC9C0</li>
					</ul>
				`;break;case"experimental":o.innerHTML=`
					<p>Beta \uAE30\uB2A5\uC744 \uD3EC\uD568\uD55C \uC804\uCCB4 \uAE30\uB2A5\uC744 \uD65C\uC131\uD654\uD569\uB2C8\uB2E4.</p>
					<ul>
						<li>\u2705 \uBAA8\uB4E0 \uD30C\uC6CC \uBAA8\uB4DC \uAE30\uB2A5</li>
						<li>\u{1F9EA} \uC0C8\uB85C\uC6B4 \uC2E4\uD5D8 \uAE30\uB2A5</li>
					</ul>
				`;break;default:o.innerHTML="<p>\uAC1C\uBCC4 \uC124\uC815\uC744 \uC9C1\uC811 \uC870\uC815\uD569\uB2C8\uB2E4.</p>"}}async applyPreset(t){this.plugin.settings.preset=t;let n=wb[t];for(let[i,r]of Object.entries(n))xb.includes(i)||(this.plugin.settings[i]=r);await this.plugin.saveSettings()}};var sG,iG;function rG(){return{geminiUrl:sG,vertexUrl:iG}}function oG(s,e,t,n){var i,r;if(!s?.baseUrl){let o=rG();return e?(i=o.vertexUrl)!==null&&i!==void 0?i:t:(r=o.geminiUrl)!==null&&r!==void 0?r:n}return s.baseUrl}var ci=class{};function fe(s,e){let t=/\{([^}]+)\}/g;return s.replace(t,(n,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){let r=e[i];return r!=null?String(r):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function w(s,e,t){for(let r=0;r<e.length-1;r++){let o=e[r];if(o.endsWith("[]")){let l=o.slice(0,-2);if(!(l in s))if(Array.isArray(t))s[l]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(s[l])){let u=s[l];if(Array.isArray(t))for(let h=0;h<u.length;h++){let d=u[h];w(d,e.slice(r+1),t[h])}else for(let h of u)w(h,e.slice(r+1),t)}return}else if(o.endsWith("[0]")){let l=o.slice(0,-3);l in s||(s[l]=[{}]);let u=s[l];w(u[0],e.slice(r+1),t);return}(!s[o]||typeof s[o]!="object")&&(s[o]={}),s=s[o]}let n=e[e.length-1],i=s[n];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(s,t):s[n]=t}function v(s,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return s;for(let n=0;n<e.length;n++){if(typeof s!="object"||s===null)return t;let i=e[n];if(i.endsWith("[]")){let r=i.slice(0,-2);if(r in s){let o=s[r];return Array.isArray(o)?o.map(l=>v(l,e.slice(n+1),t)):t}else return t}else s=s[i]}return s}catch(n){if(n instanceof TypeError)return t;throw n}}function aG(s,e){for(let[t,n]of Object.entries(e)){let i=t.split("."),r=n.split("."),o=new Set,l=-1;for(let u=0;u<i.length;u++)if(i[u]==="*"){l=u;break}if(l!==-1&&r.length>l)for(let u=l;u<r.length;u++){let h=r[u];h!=="*"&&!h.endsWith("[]")&&!h.endsWith("[0]")&&o.add(h)}rT(s,i,r,0,o)}}function rT(s,e,t,n,i){if(n>=e.length||typeof s!="object"||s===null)return;let r=e[n];if(r.endsWith("[]")){let o=r.slice(0,-2),l=s;if(o in l&&Array.isArray(l[o]))for(let u of l[o])rT(u,e,t,n+1,i)}else if(r==="*"){if(typeof s=="object"&&s!==null&&!Array.isArray(s)){let o=s,l=Object.keys(o).filter(h=>!h.startsWith("_")&&!i.has(h)),u={};for(let h of l)u[h]=o[h];for(let[h,d]of Object.entries(u)){let c=[];for(let a of t.slice(n))a==="*"?c.push(h):c.push(a);w(o,c,d)}for(let h of l)delete o[h]}}else{let o=s;r in o&&rT(o[r],e,t,n+1,i)}}function sA(s){if(typeof s!="string")throw new Error("fromImageBytes must be a string");return s}function lG(s){let e={},t=v(s,["operationName"]);t!=null&&w(e,["operationName"],t);let n=v(s,["resourceName"]);return n!=null&&w(e,["_url","resourceName"],n),e}function cG(s){let e={},t=v(s,["name"]);t!=null&&w(e,["name"],t);let n=v(s,["metadata"]);n!=null&&w(e,["metadata"],n);let i=v(s,["done"]);i!=null&&w(e,["done"],i);let r=v(s,["error"]);r!=null&&w(e,["error"],r);let o=v(s,["response","generateVideoResponse"]);return o!=null&&w(e,["response"],dG(o)),e}function uG(s){let e={},t=v(s,["name"]);t!=null&&w(e,["name"],t);let n=v(s,["metadata"]);n!=null&&w(e,["metadata"],n);let i=v(s,["done"]);i!=null&&w(e,["done"],i);let r=v(s,["error"]);r!=null&&w(e,["error"],r);let o=v(s,["response"]);return o!=null&&w(e,["response"],hG(o)),e}function dG(s){let e={},t=v(s,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>fG(o))),w(e,["generatedVideos"],r)}let n=v(s,["raiMediaFilteredCount"]);n!=null&&w(e,["raiMediaFilteredCount"],n);let i=v(s,["raiMediaFilteredReasons"]);return i!=null&&w(e,["raiMediaFilteredReasons"],i),e}function hG(s){let e={},t=v(s,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>pG(o))),w(e,["generatedVideos"],r)}let n=v(s,["raiMediaFilteredCount"]);n!=null&&w(e,["raiMediaFilteredCount"],n);let i=v(s,["raiMediaFilteredReasons"]);return i!=null&&w(e,["raiMediaFilteredReasons"],i),e}function fG(s){let e={},t=v(s,["video"]);return t!=null&&w(e,["video"],_G(t)),e}function pG(s){let e={},t=v(s,["_self"]);return t!=null&&w(e,["video"],wG(t)),e}function gG(s){let e={},t=v(s,["operationName"]);return t!=null&&w(e,["_url","operationName"],t),e}function mG(s){let e={},t=v(s,["operationName"]);return t!=null&&w(e,["_url","operationName"],t),e}function yG(s){let e={},t=v(s,["name"]);t!=null&&w(e,["name"],t);let n=v(s,["metadata"]);n!=null&&w(e,["metadata"],n);let i=v(s,["done"]);i!=null&&w(e,["done"],i);let r=v(s,["error"]);r!=null&&w(e,["error"],r);let o=v(s,["response"]);return o!=null&&w(e,["response"],bG(o)),e}function bG(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["parent"]);n!=null&&w(e,["parent"],n);let i=v(s,["documentName"]);return i!=null&&w(e,["documentName"],i),e}function O$(s){let e={},t=v(s,["name"]);t!=null&&w(e,["name"],t);let n=v(s,["metadata"]);n!=null&&w(e,["metadata"],n);let i=v(s,["done"]);i!=null&&w(e,["done"],i);let r=v(s,["error"]);r!=null&&w(e,["error"],r);let o=v(s,["response"]);return o!=null&&w(e,["response"],vG(o)),e}function vG(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["parent"]);n!=null&&w(e,["parent"],n);let i=v(s,["documentName"]);return i!=null&&w(e,["documentName"],i),e}function _G(s){let e={},t=v(s,["uri"]);t!=null&&w(e,["uri"],t);let n=v(s,["encodedVideo"]);n!=null&&w(e,["videoBytes"],sA(n));let i=v(s,["encoding"]);return i!=null&&w(e,["mimeType"],i),e}function wG(s){let e={},t=v(s,["gcsUri"]);t!=null&&w(e,["uri"],t);let n=v(s,["bytesBase64Encoded"]);n!=null&&w(e,["videoBytes"],sA(n));let i=v(s,["mimeType"]);return i!=null&&w(e,["mimeType"],i),e}var hL;(function(s){s.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",s.OUTCOME_OK="OUTCOME_OK",s.OUTCOME_FAILED="OUTCOME_FAILED",s.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(hL||(hL={}));var fL;(function(s){s.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",s.PYTHON="PYTHON"})(fL||(fL={}));var pL;(function(s){s.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",s.SILENT="SILENT",s.WHEN_IDLE="WHEN_IDLE",s.INTERRUPT="INTERRUPT"})(pL||(pL={}));var Do;(function(s){s.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",s.STRING="STRING",s.NUMBER="NUMBER",s.INTEGER="INTEGER",s.BOOLEAN="BOOLEAN",s.ARRAY="ARRAY",s.OBJECT="OBJECT",s.NULL="NULL"})(Do||(Do={}));var gL;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(gL||(gL={}));var mL;(function(s){s.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",s.SIMPLE_SEARCH="SIMPLE_SEARCH",s.ELASTIC_SEARCH="ELASTIC_SEARCH"})(mL||(mL={}));var yL;(function(s){s.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",s.NO_AUTH="NO_AUTH",s.API_KEY_AUTH="API_KEY_AUTH",s.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",s.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",s.OAUTH="OAUTH",s.OIDC_AUTH="OIDC_AUTH"})(yL||(yL={}));var bL;(function(s){s.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",s.HTTP_IN_QUERY="HTTP_IN_QUERY",s.HTTP_IN_HEADER="HTTP_IN_HEADER",s.HTTP_IN_PATH="HTTP_IN_PATH",s.HTTP_IN_BODY="HTTP_IN_BODY",s.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(bL||(bL={}));var vL;(function(s){s.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",s.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",s.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",s.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(vL||(vL={}));var _L;(function(s){s.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH",s.MINIMAL="MINIMAL"})(_L||(_L={}));var wL;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",s.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",s.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",s.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",s.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(wL||(wL={}));var xL;(function(s){s.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",s.SEVERITY="SEVERITY",s.PROBABILITY="PROBABILITY"})(xL||(xL={}));var EL;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE",s.OFF="OFF"})(EL||(EL={}));var SL;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.OTHER="OTHER",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.SPII="SPII",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.IMAGE_SAFETY="IMAGE_SAFETY",s.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",s.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",s.NO_IMAGE="NO_IMAGE",s.IMAGE_RECITATION="IMAGE_RECITATION",s.IMAGE_OTHER="IMAGE_OTHER"})(SL||(SL={}));var TL;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})(TL||(TL={}));var AL;(function(s){s.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",s.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",s.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",s.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",s.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(AL||(AL={}));var CL;(function(s){s.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",s.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",s.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",s.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",s.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(CL||(CL={}));var IL;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.IMAGE_SAFETY="IMAGE_SAFETY",s.MODEL_ARMOR="MODEL_ARMOR",s.JAILBREAK="JAILBREAK"})(IL||(IL={}));var DL;(function(s){s.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",s.ON_DEMAND="ON_DEMAND",s.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(DL||(DL={}));var Rb;(function(s){s.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",s.TEXT="TEXT",s.IMAGE="IMAGE",s.AUDIO="AUDIO"})(Rb||(Rb={}));var kL;(function(s){s.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",s.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",s.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",s.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(kL||(kL={}));var RL;(function(s){s.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",s.TUNING_MODE_FULL="TUNING_MODE_FULL",s.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(RL||(RL={}));var PL;(function(s){s.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",s.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",s.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",s.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",s.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",s.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",s.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(PL||(PL={}));var oT;(function(s){s.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",s.JOB_STATE_QUEUED="JOB_STATE_QUEUED",s.JOB_STATE_PENDING="JOB_STATE_PENDING",s.JOB_STATE_RUNNING="JOB_STATE_RUNNING",s.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",s.JOB_STATE_FAILED="JOB_STATE_FAILED",s.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",s.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",s.JOB_STATE_PAUSED="JOB_STATE_PAUSED",s.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",s.JOB_STATE_UPDATING="JOB_STATE_UPDATING",s.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(oT||(oT={}));var ML;(function(s){s.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",s.TUNING_TASK_I2V="TUNING_TASK_I2V",s.TUNING_TASK_T2V="TUNING_TASK_T2V",s.TUNING_TASK_R2V="TUNING_TASK_R2V"})(ML||(ML={}));var NL;(function(s){s.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",s.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",s.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",s.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",s.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(NL||(NL={}));var OL;(function(s){s.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",s.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",s.BALANCED="BALANCED",s.PRIORITIZE_COST="PRIORITIZE_COST"})(OL||(OL={}));var FL;(function(s){s.UNSPECIFIED="UNSPECIFIED",s.BLOCKING="BLOCKING",s.NON_BLOCKING="NON_BLOCKING"})(FL||(FL={}));var LL;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(LL||(LL={}));var $L;(function(s){s.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",s.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})($L||($L={}));var UL;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE",s.VALIDATED="VALIDATED"})(UL||(UL={}));var BL;(function(s){s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(BL||(BL={}));var VL;(function(s){s.DONT_ALLOW="DONT_ALLOW",s.ALLOW_ADULT="ALLOW_ADULT",s.ALLOW_ALL="ALLOW_ALL"})(VL||(VL={}));var zL;(function(s){s.auto="auto",s.en="en",s.ja="ja",s.ko="ko",s.hi="hi",s.zh="zh",s.pt="pt",s.es="es"})(zL||(zL={}));var HL;(function(s){s.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",s.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",s.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",s.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",s.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(HL||(HL={}));var GL;(function(s){s.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",s.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",s.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",s.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(GL||(GL={}));var jL;(function(s){s.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",s.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",s.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",s.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(jL||(jL={}));var WL;(function(s){s.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",s.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",s.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",s.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",s.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",s.EDIT_MODE_STYLE="EDIT_MODE_STYLE",s.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",s.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(WL||(WL={}));var qL;(function(s){s.FOREGROUND="FOREGROUND",s.BACKGROUND="BACKGROUND",s.PROMPT="PROMPT",s.SEMANTIC="SEMANTIC",s.INTERACTIVE="INTERACTIVE"})(qL||(qL={}));var YL;(function(s){s.ASSET="ASSET",s.STYLE="STYLE"})(YL||(YL={}));var KL;(function(s){s.INSERT="INSERT",s.REMOVE="REMOVE",s.REMOVE_STATIC="REMOVE_STATIC",s.OUTPAINT="OUTPAINT"})(KL||(KL={}));var XL;(function(s){s.OPTIMIZED="OPTIMIZED",s.LOSSLESS="LOSSLESS"})(XL||(XL={}));var JL;(function(s){s.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",s.PREFERENCE_TUNING="PREFERENCE_TUNING"})(JL||(JL={}));var ZL;(function(s){s.STATE_UNSPECIFIED="STATE_UNSPECIFIED",s.STATE_PENDING="STATE_PENDING",s.STATE_ACTIVE="STATE_ACTIVE",s.STATE_FAILED="STATE_FAILED"})(ZL||(ZL={}));var QL;(function(s){s.STATE_UNSPECIFIED="STATE_UNSPECIFIED",s.PROCESSING="PROCESSING",s.ACTIVE="ACTIVE",s.FAILED="FAILED"})(QL||(QL={}));var e$;(function(s){s.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",s.UPLOADED="UPLOADED",s.GENERATED="GENERATED"})(e$||(e$={}));var t$;(function(s){s.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.RESPONSE_REJECTED="RESPONSE_REJECTED",s.NEED_MORE_INPUT="NEED_MORE_INPUT"})(t$||(t$={}));var n$;(function(s){s.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",s.TEXT="TEXT",s.IMAGE="IMAGE",s.VIDEO="VIDEO",s.AUDIO="AUDIO",s.DOCUMENT="DOCUMENT"})(n$||(n$={}));var s$;(function(s){s.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",s.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",s.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(s$||(s$={}));var i$;(function(s){s.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",s.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",s.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(i$||(i$={}));var r$;(function(s){s.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",s.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",s.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(r$||(r$={}));var o$;(function(s){s.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",s.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",s.NO_INTERRUPTION="NO_INTERRUPTION"})(o$||(o$={}));var a$;(function(s){s.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",s.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",s.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(a$||(a$={}));var l$;(function(s){s.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",s.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",s.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",s.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",s.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",s.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",s.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",s.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",s.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",s.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",s.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",s.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",s.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(l$||(l$={}));var c$;(function(s){s.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",s.QUALITY="QUALITY",s.DIVERSITY="DIVERSITY",s.VOCALIZATION="VOCALIZATION"})(c$||(c$={}));var Iu;(function(s){s.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",s.PLAY="PLAY",s.PAUSE="PAUSE",s.STOP="STOP",s.RESET_CONTEXT="RESET_CONTEXT"})(Iu||(Iu={}));var kf=class{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var sl=class{get text(){var e,t,n,i,r,o,l,u;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let h="",d=!1,c=[];for(let a of(u=(l=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)!==null&&u!==void 0?u:[]){for(let[f,p]of Object.entries(a))f!=="text"&&f!=="thought"&&f!=="thoughtSignature"&&(p!==null||p!==void 0)&&c.push(f);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;d=!0,h+=a.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?h:void 0}get data(){var e,t,n,i,r,o,l,u;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let h="",d=[];for(let c of(u=(l=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)!==null&&u!==void 0?u:[]){for(let[a,f]of Object.entries(c))a!=="inlineData"&&(f!==null||f!==void 0)&&d.push(a);c.inlineData&&typeof c.inlineData.data=="string"&&(h+=atob(c.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),h.length>0?btoa(h):void 0}get functionCalls(){var e,t,n,i,r,o,l,u;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let h=(u=(l=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)===null||u===void 0?void 0:u.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if(h?.length!==0)return h}get executableCode(){var e,t,n,i,r,o,l,u,h;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let d=(u=(l=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)===null||u===void 0?void 0:u.filter(c=>c.executableCode).map(c=>c.executableCode).filter(c=>c!==void 0);if(d?.length!==0)return(h=d?.[0])===null||h===void 0?void 0:h.code}get codeExecutionResult(){var e,t,n,i,r,o,l,u,h;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let d=(u=(l=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)===null||u===void 0?void 0:u.filter(c=>c.codeExecutionResult).map(c=>c.codeExecutionResult).filter(c=>c!==void 0);if(d?.length!==0)return(h=d?.[0])===null||h===void 0?void 0:h.output}},Pb=class{},Mb=class{},aT=class{},lT=class{},cT=class{},uT=class{},Nb=class{},Ob=class{},Fb=class{},dT=class{};var Lb=class s{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new s,i,r=e;return t?i=uG(r):i=cG(r),Object.assign(n,i),n}},$b=class{},Ub=class{},Bb=class{},Vb=class{},hT=class{},fT=class{},pT=class{};var gT=class s{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new s,r=yG(e);return Object.assign(n,r),n}},mT=class{},yT=class{},bT=class{};var zb=class{};var vT=class{get text(){var e,t,n;let i="",r=!1,o=[];for(let l of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[u,h]of Object.entries(l))u!=="text"&&u!=="thought"&&h!==null&&o.push(u);if(typeof l.text=="string"){if(typeof l.thought=="boolean"&&l.thought)continue;r=!0,i+=l.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?i:void 0}get data(){var e,t,n;let i="",r=[];for(let o of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[l,u]of Object.entries(o))l!=="inlineData"&&u!==null&&r.push(l);o.inlineData&&typeof o.inlineData.data=="string"&&(i+=atob(o.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}};var _T=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var wT=class s{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new s,r=O$(e);return Object.assign(n,r),n}};function lt(s,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(s.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function F$(s,e){let t=lt(s,e);return t?t.startsWith("publishers/")&&s.isVertexAI()?`projects/${s.getProject()}/locations/${s.getLocation()}/${t}`:t.startsWith("models/")&&s.isVertexAI()?`projects/${s.getProject()}/locations/${s.getLocation()}/publishers/google/${t}`:t:""}function L$(s){return Array.isArray(s)?s.map(e=>Hb(e)):[Hb(s)]}function Hb(s){if(typeof s=="object"&&s!==null)return s;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof s}`)}function $$(s){let e=Hb(s);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function U$(s){let e=Hb(s);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function u$(s){if(s==null)throw new Error("PartUnion is required");if(typeof s=="object")return s;if(typeof s=="string")return{text:s};throw new Error(`Unsupported part type: ${typeof s}`)}function B$(s){if(s==null||Array.isArray(s)&&s.length===0)throw new Error("PartListUnion is required");return Array.isArray(s)?s.map(e=>u$(e)):[u$(s)]}function xT(s){return s!=null&&typeof s=="object"&&"parts"in s&&Array.isArray(s.parts)}function d$(s){return s!=null&&typeof s=="object"&&"functionCall"in s}function h$(s){return s!=null&&typeof s=="object"&&"functionResponse"in s}function Fn(s){if(s==null)throw new Error("ContentUnion is required");return xT(s)?s:{role:"user",parts:B$(s)}}function iA(s,e){if(!e)return[];if(s.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let n=Fn(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(s.isVertexAI()){let t=Fn(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Fn(t)):[Fn(e)]}function js(s){if(s==null||Array.isArray(s)&&s.length===0)throw new Error("contents are required");if(!Array.isArray(s)){if(d$(s)||h$(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Fn(s)]}let e=[],t=[],n=xT(s[0]);for(let i of s){let r=xT(i);if(r!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(i);else{if(d$(i)||h$(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(i)}}return n||e.push({role:"user",parts:B$(t)}),e}function xG(s,e){s.includes("null")&&(e.nullable=!0);let t=s.filter(n=>n!=="null");if(t.length===1)e.type=Object.values(Do).includes(t[0].toUpperCase())?t[0].toUpperCase():Do.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let n of t)e.anyOf.push({type:Object.values(Do).includes(n.toUpperCase())?n.toUpperCase():Do.TYPE_UNSPECIFIED})}}function Du(s){let e={},t=["items"],n=["anyOf"],i=["properties"];if(s.type&&s.anyOf)throw new Error("type and anyOf cannot be both populated.");let r=s.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,s=r[1]):r[1].type==="null"&&(e.nullable=!0,s=r[0])),s.type instanceof Array&&xG(s.type,e);for(let[o,l]of Object.entries(s))if(l!=null)if(o=="type"){if(l==="null")throw new Error("type: null can not be the only possible type for the field.");if(l instanceof Array)continue;e.type=Object.values(Do).includes(l.toUpperCase())?l.toUpperCase():Do.TYPE_UNSPECIFIED}else if(t.includes(o))e[o]=Du(l);else if(n.includes(o)){let u=[];for(let h of l){if(h.type=="null"){e.nullable=!0;continue}u.push(Du(h))}e[o]=u}else if(i.includes(o)){let u={};for(let[h,d]of Object.entries(l))u[h]=Du(d);e[o]=u}else{if(o==="additionalProperties")continue;e[o]=l}return e}function rA(s){return Du(s)}function oA(s){if(typeof s=="object")return s;if(typeof s=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:s}}};throw new Error(`Unsupported speechConfig type: ${typeof s}`)}function aA(s){if("multiSpeakerVoiceConfig"in s)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return s}function Mu(s){if(s.functionDeclarations)for(let e of s.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Du(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Du(e.response));return s}function Nu(s){if(s==null)throw new Error("tools is required");if(!Array.isArray(s))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of s)e.push(t);return e}function EG(s,e,t,n=1){let i=!e.startsWith(`${t}/`)&&e.split("/").length===n;return s.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${s.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${s.getProject()}/locations/${s.getLocation()}/${e}`:i?`projects/${s.getProject()}/locations/${s.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function Rr(s,e){if(typeof e!="string")throw new Error("name must be a string");return EG(s,e,"cachedContents")}function V$(s){switch(s){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return s}}function ko(s){return sA(s)}function SG(s){return s!=null&&typeof s=="object"&&"name"in s}function TG(s){return s!=null&&typeof s=="object"&&"video"in s}function AG(s){return s!=null&&typeof s=="object"&&"uri"in s}function z$(s){var e;let t;if(SG(s)&&(t=s.name),!(AG(s)&&(t=s.uri,t===void 0))&&!(TG(s)&&(t=(e=s.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof s=="string"&&(t=s),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let i=t.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${t}`);t=i[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function H$(s,e){let t;return s.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function G$(s){for(let e of["models","tunedModels","publisherModels"])if(CG(s,e))return s[e];return[]}function CG(s,e){return s!==null&&typeof s=="object"&&e in s}function IG(s,e={}){let t=s,n={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(n.responseJsonSchema=t.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function DG(s,e={}){let t=[],n=new Set;for(let i of s){let r=i.name;if(n.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);n.add(r);let o=IG(i,e);o.functionDeclarations&&t.push(...o.functionDeclarations)}return{functionDeclarations:t}}function j$(s,e){let t;if(typeof e=="string")if(s.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(s.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let n=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,i=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(s.isVertexAI()){if(i>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function kG(s){if(typeof s!="string")return s;let e=s;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function W$(s){if(typeof s!="object"||s===null)return{};let e=s,t=e.inlinedResponses;if(typeof t!="object"||t===null)return s;let i=t.inlinedResponses;if(!Array.isArray(i)||i.length===0)return s;let r=!1;for(let o of i){if(typeof o!="object"||o===null)continue;let u=o.response;if(typeof u!="object"||u===null)continue;if(u.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),s}function Ou(s,e){let t=e;if(!s.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function q$(s){let e=s;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function RG(s){let e={},t=v(s,["responsesFile"]);t!=null&&w(e,["fileName"],t);let n=v(s,["inlinedResponses","inlinedResponses"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>d6(o))),w(e,["inlinedResponses"],r)}let i=v(s,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),w(e,["inlinedEmbedContentResponses"],r)}return e}function PG(s){let e={},t=v(s,["predictionsFormat"]);t!=null&&w(e,["format"],t);let n=v(s,["gcsDestination","outputUriPrefix"]);n!=null&&w(e,["gcsUri"],n);let i=v(s,["bigqueryDestination","outputUri"]);return i!=null&&w(e,["bigqueryUri"],i),e}function MG(s){let e={},t=v(s,["format"]);t!=null&&w(e,["predictionsFormat"],t);let n=v(s,["gcsUri"]);n!=null&&w(e,["gcsDestination","outputUriPrefix"],n);let i=v(s,["bigqueryUri"]);if(i!=null&&w(e,["bigqueryDestination","outputUri"],i),v(s,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(v(s,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(v(s,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Db(s){let e={},t=v(s,["name"]);t!=null&&w(e,["name"],t);let n=v(s,["metadata","displayName"]);n!=null&&w(e,["displayName"],n);let i=v(s,["metadata","state"]);i!=null&&w(e,["state"],q$(i));let r=v(s,["metadata","createTime"]);r!=null&&w(e,["createTime"],r);let o=v(s,["metadata","endTime"]);o!=null&&w(e,["endTime"],o);let l=v(s,["metadata","updateTime"]);l!=null&&w(e,["updateTime"],l);let u=v(s,["metadata","model"]);u!=null&&w(e,["model"],u);let h=v(s,["metadata","output"]);return h!=null&&w(e,["dest"],RG(W$(h))),e}function ET(s){let e={},t=v(s,["name"]);t!=null&&w(e,["name"],t);let n=v(s,["displayName"]);n!=null&&w(e,["displayName"],n);let i=v(s,["state"]);i!=null&&w(e,["state"],q$(i));let r=v(s,["error"]);r!=null&&w(e,["error"],r);let o=v(s,["createTime"]);o!=null&&w(e,["createTime"],o);let l=v(s,["startTime"]);l!=null&&w(e,["startTime"],l);let u=v(s,["endTime"]);u!=null&&w(e,["endTime"],u);let h=v(s,["updateTime"]);h!=null&&w(e,["updateTime"],h);let d=v(s,["model"]);d!=null&&w(e,["model"],d);let c=v(s,["inputConfig"]);c!=null&&w(e,["src"],NG(c));let a=v(s,["outputConfig"]);a!=null&&w(e,["dest"],PG(W$(a)));let f=v(s,["completionStats"]);return f!=null&&w(e,["completionStats"],f),e}function NG(s){let e={},t=v(s,["instancesFormat"]);t!=null&&w(e,["format"],t);let n=v(s,["gcsSource","uris"]);n!=null&&w(e,["gcsUri"],n);let i=v(s,["bigquerySource","inputUri"]);return i!=null&&w(e,["bigqueryUri"],i),e}function OG(s,e){let t={};if(v(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(v(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(v(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let n=v(e,["fileName"]);n!=null&&w(t,["fileName"],n);let i=v(e,["inlinedRequests"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>u6(s,o))),w(t,["requests","requests"],r)}return t}function FG(s){let e={},t=v(s,["format"]);t!=null&&w(e,["instancesFormat"],t);let n=v(s,["gcsUri"]);n!=null&&w(e,["gcsSource","uris"],n);let i=v(s,["bigqueryUri"]);if(i!=null&&w(e,["bigquerySource","inputUri"],i),v(s,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(v(s,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function LG(s){let e={},t=v(s,["data"]);if(t!=null&&w(e,["data"],t),v(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=v(s,["mimeType"]);return n!=null&&w(e,["mimeType"],n),e}function $G(s,e){let t={},n=v(e,["name"]);return n!=null&&w(t,["_url","name"],Ou(s,n)),t}function UG(s,e){let t={},n=v(e,["name"]);return n!=null&&w(t,["_url","name"],Ou(s,n)),t}function BG(s){let e={},t=v(s,["content"]);t!=null&&w(e,["content"],t);let n=v(s,["citationMetadata"]);n!=null&&w(e,["citationMetadata"],VG(n));let i=v(s,["tokenCount"]);i!=null&&w(e,["tokenCount"],i);let r=v(s,["finishReason"]);r!=null&&w(e,["finishReason"],r);let o=v(s,["avgLogprobs"]);o!=null&&w(e,["avgLogprobs"],o);let l=v(s,["groundingMetadata"]);l!=null&&w(e,["groundingMetadata"],l);let u=v(s,["index"]);u!=null&&w(e,["index"],u);let h=v(s,["logprobsResult"]);h!=null&&w(e,["logprobsResult"],h);let d=v(s,["safetyRatings"]);if(d!=null){let a=d;Array.isArray(a)&&(a=a.map(f=>f)),w(e,["safetyRatings"],a)}let c=v(s,["urlContextMetadata"]);return c!=null&&w(e,["urlContextMetadata"],c),e}function VG(s){let e={},t=v(s,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(i=>i)),w(e,["citations"],n)}return e}function Y$(s){let e={},t=v(s,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>b6(r))),w(e,["parts"],i)}let n=v(s,["role"]);return n!=null&&w(e,["role"],n),e}function zG(s,e){let t={},n=v(s,["displayName"]);if(e!==void 0&&n!=null&&w(e,["batch","displayName"],n),v(s,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function HG(s,e){let t={},n=v(s,["displayName"]);e!==void 0&&n!=null&&w(e,["displayName"],n);let i=v(s,["dest"]);return e!==void 0&&i!=null&&w(e,["outputConfig"],MG(kG(i))),t}function f$(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["src"]);i!=null&&w(t,["batch","inputConfig"],OG(s,j$(s,i)));let r=v(e,["config"]);return r!=null&&zG(r,t),t}function GG(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["model"],lt(s,n));let i=v(e,["src"]);i!=null&&w(t,["inputConfig"],FG(j$(s,i)));let r=v(e,["config"]);return r!=null&&HG(r,t),t}function jG(s,e){let t={},n=v(s,["displayName"]);return e!==void 0&&n!=null&&w(e,["batch","displayName"],n),t}function WG(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["src"]);i!=null&&w(t,["batch","inputConfig"],QG(s,i));let r=v(e,["config"]);return r!=null&&jG(r,t),t}function qG(s,e){let t={},n=v(e,["name"]);return n!=null&&w(t,["_url","name"],Ou(s,n)),t}function YG(s,e){let t={},n=v(e,["name"]);return n!=null&&w(t,["_url","name"],Ou(s,n)),t}function KG(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["name"]);n!=null&&w(e,["name"],n);let i=v(s,["done"]);i!=null&&w(e,["done"],i);let r=v(s,["error"]);return r!=null&&w(e,["error"],r),e}function XG(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["name"]);n!=null&&w(e,["name"],n);let i=v(s,["done"]);i!=null&&w(e,["done"],i);let r=v(s,["error"]);return r!=null&&w(e,["error"],r),e}function JG(s,e){let t={},n=v(e,["contents"]);if(n!=null){let r=iA(s,n);Array.isArray(r)&&(r=r.map(o=>o)),w(t,["requests[]","request","content"],r)}let i=v(e,["config"]);return i!=null&&(w(t,["_self"],ZG(i,t)),aG(t,{"requests[].*":"requests[].request.*"})),t}function ZG(s,e){let t={},n=v(s,["taskType"]);e!==void 0&&n!=null&&w(e,["requests[]","taskType"],n);let i=v(s,["title"]);e!==void 0&&i!=null&&w(e,["requests[]","title"],i);let r=v(s,["outputDimensionality"]);if(e!==void 0&&r!=null&&w(e,["requests[]","outputDimensionality"],r),v(s,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(v(s,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function QG(s,e){let t={},n=v(e,["fileName"]);n!=null&&w(t,["file_name"],n);let i=v(e,["inlinedRequests"]);return i!=null&&w(t,["requests"],JG(s,i)),t}function e6(s){let e={};if(v(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=v(s,["fileUri"]);t!=null&&w(e,["fileUri"],t);let n=v(s,["mimeType"]);return n!=null&&w(e,["mimeType"],n),e}function t6(s){let e={},t=v(s,["id"]);t!=null&&w(e,["id"],t);let n=v(s,["args"]);n!=null&&w(e,["args"],n);let i=v(s,["name"]);if(i!=null&&w(e,["name"],i),v(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function n6(s){let e={},t=v(s,["mode"]);t!=null&&w(e,["mode"],t);let n=v(s,["allowedFunctionNames"]);if(n!=null&&w(e,["allowedFunctionNames"],n),v(s,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function s6(s,e,t){let n={},i=v(e,["systemInstruction"]);t!==void 0&&i!=null&&w(t,["systemInstruction"],Y$(Fn(i)));let r=v(e,["temperature"]);r!=null&&w(n,["temperature"],r);let o=v(e,["topP"]);o!=null&&w(n,["topP"],o);let l=v(e,["topK"]);l!=null&&w(n,["topK"],l);let u=v(e,["candidateCount"]);u!=null&&w(n,["candidateCount"],u);let h=v(e,["maxOutputTokens"]);h!=null&&w(n,["maxOutputTokens"],h);let d=v(e,["stopSequences"]);d!=null&&w(n,["stopSequences"],d);let c=v(e,["responseLogprobs"]);c!=null&&w(n,["responseLogprobs"],c);let a=v(e,["logprobs"]);a!=null&&w(n,["logprobs"],a);let f=v(e,["presencePenalty"]);f!=null&&w(n,["presencePenalty"],f);let p=v(e,["frequencyPenalty"]);p!=null&&w(n,["frequencyPenalty"],p);let g=v(e,["seed"]);g!=null&&w(n,["seed"],g);let m=v(e,["responseMimeType"]);m!=null&&w(n,["responseMimeType"],m);let y=v(e,["responseSchema"]);y!=null&&w(n,["responseSchema"],rA(y));let _=v(e,["responseJsonSchema"]);if(_!=null&&w(n,["responseJsonSchema"],_),v(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(v(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let x=v(e,["safetySettings"]);if(t!==void 0&&x!=null){let z=x;Array.isArray(z)&&(z=z.map(B=>v6(B))),w(t,["safetySettings"],z)}let E=v(e,["tools"]);if(t!==void 0&&E!=null){let z=Nu(E);Array.isArray(z)&&(z=z.map(B=>w6(Mu(B)))),w(t,["tools"],z)}let S=v(e,["toolConfig"]);if(t!==void 0&&S!=null&&w(t,["toolConfig"],_6(S)),v(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let T=v(e,["cachedContent"]);t!==void 0&&T!=null&&w(t,["cachedContent"],Rr(s,T));let C=v(e,["responseModalities"]);C!=null&&w(n,["responseModalities"],C);let I=v(e,["mediaResolution"]);I!=null&&w(n,["mediaResolution"],I);let A=v(e,["speechConfig"]);if(A!=null&&w(n,["speechConfig"],oA(A)),v(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let P=v(e,["thinkingConfig"]);P!=null&&w(n,["thinkingConfig"],P);let F=v(e,["imageConfig"]);F!=null&&w(n,["imageConfig"],c6(F));let H=v(e,["enableEnhancedCivicAnswers"]);return H!=null&&w(n,["enableEnhancedCivicAnswers"],H),n}function i6(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["candidates"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(h=>BG(h))),w(e,["candidates"],u)}let i=v(s,["modelVersion"]);i!=null&&w(e,["modelVersion"],i);let r=v(s,["promptFeedback"]);r!=null&&w(e,["promptFeedback"],r);let o=v(s,["responseId"]);o!=null&&w(e,["responseId"],o);let l=v(s,["usageMetadata"]);return l!=null&&w(e,["usageMetadata"],l),e}function r6(s,e){let t={},n=v(e,["name"]);return n!=null&&w(t,["_url","name"],Ou(s,n)),t}function o6(s,e){let t={},n=v(e,["name"]);return n!=null&&w(t,["_url","name"],Ou(s,n)),t}function a6(s){let e={};if(v(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=v(s,["enableWidget"]);return t!=null&&w(e,["enableWidget"],t),e}function l6(s){let e={};if(v(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=v(s,["timeRangeFilter"]);return t!=null&&w(e,["timeRangeFilter"],t),e}function c6(s){let e={},t=v(s,["aspectRatio"]);t!=null&&w(e,["aspectRatio"],t);let n=v(s,["imageSize"]);if(n!=null&&w(e,["imageSize"],n),v(s,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(v(s,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function u6(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["request","model"],lt(s,n));let i=v(e,["contents"]);if(i!=null){let l=js(i);Array.isArray(l)&&(l=l.map(u=>Y$(u))),w(t,["request","contents"],l)}let r=v(e,["metadata"]);r!=null&&w(t,["metadata"],r);let o=v(e,["config"]);return o!=null&&w(t,["request","generationConfig"],s6(s,o,v(t,["request"],{}))),t}function d6(s){let e={},t=v(s,["response"]);t!=null&&w(e,["response"],i6(t));let n=v(s,["error"]);return n!=null&&w(e,["error"],n),e}function h6(s,e){let t={},n=v(s,["pageSize"]);e!==void 0&&n!=null&&w(e,["_query","pageSize"],n);let i=v(s,["pageToken"]);if(e!==void 0&&i!=null&&w(e,["_query","pageToken"],i),v(s,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function f6(s,e){let t={},n=v(s,["pageSize"]);e!==void 0&&n!=null&&w(e,["_query","pageSize"],n);let i=v(s,["pageToken"]);e!==void 0&&i!=null&&w(e,["_query","pageToken"],i);let r=v(s,["filter"]);return e!==void 0&&r!=null&&w(e,["_query","filter"],r),t}function p6(s){let e={},t=v(s,["config"]);return t!=null&&h6(t,e),e}function g6(s){let e={},t=v(s,["config"]);return t!=null&&f6(t,e),e}function m6(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["nextPageToken"]);n!=null&&w(e,["nextPageToken"],n);let i=v(s,["operations"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>Db(o))),w(e,["batchJobs"],r)}return e}function y6(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["nextPageToken"]);n!=null&&w(e,["nextPageToken"],n);let i=v(s,["batchPredictionJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>ET(o))),w(e,["batchJobs"],r)}return e}function b6(s){let e={},t=v(s,["mediaResolution"]);t!=null&&w(e,["mediaResolution"],t);let n=v(s,["codeExecutionResult"]);n!=null&&w(e,["codeExecutionResult"],n);let i=v(s,["executableCode"]);i!=null&&w(e,["executableCode"],i);let r=v(s,["fileData"]);r!=null&&w(e,["fileData"],e6(r));let o=v(s,["functionCall"]);o!=null&&w(e,["functionCall"],t6(o));let l=v(s,["functionResponse"]);l!=null&&w(e,["functionResponse"],l);let u=v(s,["inlineData"]);u!=null&&w(e,["inlineData"],LG(u));let h=v(s,["text"]);h!=null&&w(e,["text"],h);let d=v(s,["thought"]);d!=null&&w(e,["thought"],d);let c=v(s,["thoughtSignature"]);c!=null&&w(e,["thoughtSignature"],c);let a=v(s,["videoMetadata"]);return a!=null&&w(e,["videoMetadata"],a),e}function v6(s){let e={},t=v(s,["category"]);if(t!=null&&w(e,["category"],t),v(s,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=v(s,["threshold"]);return n!=null&&w(e,["threshold"],n),e}function _6(s){let e={},t=v(s,["functionCallingConfig"]);t!=null&&w(e,["functionCallingConfig"],n6(t));let n=v(s,["retrievalConfig"]);return n!=null&&w(e,["retrievalConfig"],n),e}function w6(s){let e={},t=v(s,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(c=>c)),w(e,["functionDeclarations"],d)}if(v(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=v(s,["googleSearchRetrieval"]);n!=null&&w(e,["googleSearchRetrieval"],n);let i=v(s,["computerUse"]);i!=null&&w(e,["computerUse"],i);let r=v(s,["fileSearch"]);r!=null&&w(e,["fileSearch"],r);let o=v(s,["codeExecution"]);if(o!=null&&w(e,["codeExecution"],o),v(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=v(s,["googleMaps"]);l!=null&&w(e,["googleMaps"],a6(l));let u=v(s,["googleSearch"]);u!=null&&w(e,["googleSearch"],l6(u));let h=v(s,["urlContext"]);return h!=null&&w(e,["urlContext"],h),e}var Dr;(function(s){s.PAGED_ITEM_BATCH_JOBS="batchJobs",s.PAGED_ITEM_MODELS="models",s.PAGED_ITEM_TUNING_JOBS="tuningJobs",s.PAGED_ITEM_FILES="files",s.PAGED_ITEM_CACHED_CONTENTS="cachedContents",s.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",s.PAGED_ITEM_DOCUMENTS="documents"})(Dr||(Dr={}));var kr=class{constructor(e,t,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,i)}init(e,t,n){var i,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let o={config:{}};!n||Object.keys(n).length===0?o={config:{}}:typeof n=="object"?o=Object.assign({},n):o=n,o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(r=(i=o.config)===null||i===void 0?void 0:i.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var ST=class extends ci{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new kr(Dr.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){let t=f$(this.apiClient,e),n=t._url,i=fe("{model}:batchGenerateContent",n),l=t.batch.inputConfig.requests,u=l.requests,h=[];for(let d of u){let c=Object.assign({},d);if(c.systemInstruction){let a=c.systemInstruction;delete c.systemInstruction;let f=c.request;f.systemInstruction=a,c.request=f}h.push(c)}return l.requests=h,delete t.config,delete t._url,delete t._query,{path:i,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},i=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${i}`),n.dest===void 0){let r=this.getGcsUri(e),o=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?n.dest=`${r.slice(0,-6)}/dest`:n.dest=`${r}_dest_${i}`;else if(o)n.dest=`${o}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=GG(this.apiClient,e);return l=fe("batchPredictionJobs",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>ET(d))}else{let h=f$(this.apiClient,e);return l=fe("{model}:batchGenerateContent",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>Db(d))}}async createEmbeddingsInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=WG(this.apiClient,e);return r=fe("{model}:asyncBatchEmbedContent",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i.then(u=>Db(u))}}async get(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=o6(this.apiClient,e);return l=fe("batchPredictionJobs/{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>ET(d))}else{let h=r6(this.apiClient,e);return l=fe("batches/{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>Db(d))}}async cancel(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let u=UG(this.apiClient,e);o=fe("batchPredictionJobs/{name}:cancel",u._url),l=u._query,delete u._url,delete u._query,await this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{let u=$G(this.apiClient,e);o=fe("batches/{name}:cancel",u._url),l=u._query,delete u._url,delete u._query,await this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=g6(e);return l=fe("batchPredictionJobs",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=y6(d),a=new zb;return Object.assign(a,c),a})}else{let h=p6(e);return l=fe("batches",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=m6(d),a=new zb;return Object.assign(a,c),a})}}async delete(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=YG(this.apiClient,e);return l=fe("batchPredictionJobs/{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>XG(d))}else{let h=qG(this.apiClient,e);return l=fe("batches/{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>KG(d))}}};function x6(s){let e={},t=v(s,["data"]);if(t!=null&&w(e,["data"],t),v(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=v(s,["mimeType"]);return n!=null&&w(e,["mimeType"],n),e}function p$(s){let e={},t=v(s,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>j6(r))),w(e,["parts"],i)}let n=v(s,["role"]);return n!=null&&w(e,["role"],n),e}function E6(s,e){let t={},n=v(s,["ttl"]);e!==void 0&&n!=null&&w(e,["ttl"],n);let i=v(s,["expireTime"]);e!==void 0&&i!=null&&w(e,["expireTime"],i);let r=v(s,["displayName"]);e!==void 0&&r!=null&&w(e,["displayName"],r);let o=v(s,["contents"]);if(e!==void 0&&o!=null){let d=js(o);Array.isArray(d)&&(d=d.map(c=>p$(c))),w(e,["contents"],d)}let l=v(s,["systemInstruction"]);e!==void 0&&l!=null&&w(e,["systemInstruction"],p$(Fn(l)));let u=v(s,["tools"]);if(e!==void 0&&u!=null){let d=u;Array.isArray(d)&&(d=d.map(c=>q6(c))),w(e,["tools"],d)}let h=v(s,["toolConfig"]);if(e!==void 0&&h!=null&&w(e,["toolConfig"],W6(h)),v(s,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function S6(s,e){let t={},n=v(s,["ttl"]);e!==void 0&&n!=null&&w(e,["ttl"],n);let i=v(s,["expireTime"]);e!==void 0&&i!=null&&w(e,["expireTime"],i);let r=v(s,["displayName"]);e!==void 0&&r!=null&&w(e,["displayName"],r);let o=v(s,["contents"]);if(e!==void 0&&o!=null){let c=js(o);Array.isArray(c)&&(c=c.map(a=>a)),w(e,["contents"],c)}let l=v(s,["systemInstruction"]);e!==void 0&&l!=null&&w(e,["systemInstruction"],Fn(l));let u=v(s,["tools"]);if(e!==void 0&&u!=null){let c=u;Array.isArray(c)&&(c=c.map(a=>Y6(a))),w(e,["tools"],c)}let h=v(s,["toolConfig"]);e!==void 0&&h!=null&&w(e,["toolConfig"],h);let d=v(s,["kmsKeyName"]);return e!==void 0&&d!=null&&w(e,["encryption_spec","kmsKeyName"],d),t}function T6(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["model"],F$(s,n));let i=v(e,["config"]);return i!=null&&E6(i,t),t}function A6(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["model"],F$(s,n));let i=v(e,["config"]);return i!=null&&S6(i,t),t}function C6(s,e){let t={},n=v(e,["name"]);return n!=null&&w(t,["_url","name"],Rr(s,n)),t}function I6(s,e){let t={},n=v(e,["name"]);return n!=null&&w(t,["_url","name"],Rr(s,n)),t}function D6(s){let e={},t=v(s,["sdkHttpResponse"]);return t!=null&&w(e,["sdkHttpResponse"],t),e}function k6(s){let e={},t=v(s,["sdkHttpResponse"]);return t!=null&&w(e,["sdkHttpResponse"],t),e}function R6(s){let e={};if(v(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=v(s,["fileUri"]);t!=null&&w(e,["fileUri"],t);let n=v(s,["mimeType"]);return n!=null&&w(e,["mimeType"],n),e}function P6(s){let e={},t=v(s,["id"]);t!=null&&w(e,["id"],t);let n=v(s,["args"]);n!=null&&w(e,["args"],n);let i=v(s,["name"]);if(i!=null&&w(e,["name"],i),v(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function M6(s){let e={},t=v(s,["mode"]);t!=null&&w(e,["mode"],t);let n=v(s,["allowedFunctionNames"]);if(n!=null&&w(e,["allowedFunctionNames"],n),v(s,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function N6(s){let e={};if(v(s,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=v(s,["description"]);t!=null&&w(e,["description"],t);let n=v(s,["name"]);n!=null&&w(e,["name"],n);let i=v(s,["parameters"]);i!=null&&w(e,["parameters"],i);let r=v(s,["parametersJsonSchema"]);r!=null&&w(e,["parametersJsonSchema"],r);let o=v(s,["response"]);o!=null&&w(e,["response"],o);let l=v(s,["responseJsonSchema"]);return l!=null&&w(e,["responseJsonSchema"],l),e}function O6(s,e){let t={},n=v(e,["name"]);return n!=null&&w(t,["_url","name"],Rr(s,n)),t}function F6(s,e){let t={},n=v(e,["name"]);return n!=null&&w(t,["_url","name"],Rr(s,n)),t}function L6(s){let e={};if(v(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=v(s,["enableWidget"]);return t!=null&&w(e,["enableWidget"],t),e}function $6(s){let e={};if(v(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=v(s,["timeRangeFilter"]);return t!=null&&w(e,["timeRangeFilter"],t),e}function U6(s,e){let t={},n=v(s,["pageSize"]);e!==void 0&&n!=null&&w(e,["_query","pageSize"],n);let i=v(s,["pageToken"]);return e!==void 0&&i!=null&&w(e,["_query","pageToken"],i),t}function B6(s,e){let t={},n=v(s,["pageSize"]);e!==void 0&&n!=null&&w(e,["_query","pageSize"],n);let i=v(s,["pageToken"]);return e!==void 0&&i!=null&&w(e,["_query","pageToken"],i),t}function V6(s){let e={},t=v(s,["config"]);return t!=null&&U6(t,e),e}function z6(s){let e={},t=v(s,["config"]);return t!=null&&B6(t,e),e}function H6(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["nextPageToken"]);n!=null&&w(e,["nextPageToken"],n);let i=v(s,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),w(e,["cachedContents"],r)}return e}function G6(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["nextPageToken"]);n!=null&&w(e,["nextPageToken"],n);let i=v(s,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),w(e,["cachedContents"],r)}return e}function j6(s){let e={},t=v(s,["mediaResolution"]);t!=null&&w(e,["mediaResolution"],t);let n=v(s,["codeExecutionResult"]);n!=null&&w(e,["codeExecutionResult"],n);let i=v(s,["executableCode"]);i!=null&&w(e,["executableCode"],i);let r=v(s,["fileData"]);r!=null&&w(e,["fileData"],R6(r));let o=v(s,["functionCall"]);o!=null&&w(e,["functionCall"],P6(o));let l=v(s,["functionResponse"]);l!=null&&w(e,["functionResponse"],l);let u=v(s,["inlineData"]);u!=null&&w(e,["inlineData"],x6(u));let h=v(s,["text"]);h!=null&&w(e,["text"],h);let d=v(s,["thought"]);d!=null&&w(e,["thought"],d);let c=v(s,["thoughtSignature"]);c!=null&&w(e,["thoughtSignature"],c);let a=v(s,["videoMetadata"]);return a!=null&&w(e,["videoMetadata"],a),e}function W6(s){let e={},t=v(s,["functionCallingConfig"]);t!=null&&w(e,["functionCallingConfig"],M6(t));let n=v(s,["retrievalConfig"]);return n!=null&&w(e,["retrievalConfig"],n),e}function q6(s){let e={},t=v(s,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(c=>c)),w(e,["functionDeclarations"],d)}if(v(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=v(s,["googleSearchRetrieval"]);n!=null&&w(e,["googleSearchRetrieval"],n);let i=v(s,["computerUse"]);i!=null&&w(e,["computerUse"],i);let r=v(s,["fileSearch"]);r!=null&&w(e,["fileSearch"],r);let o=v(s,["codeExecution"]);if(o!=null&&w(e,["codeExecution"],o),v(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=v(s,["googleMaps"]);l!=null&&w(e,["googleMaps"],L6(l));let u=v(s,["googleSearch"]);u!=null&&w(e,["googleSearch"],$6(u));let h=v(s,["urlContext"]);return h!=null&&w(e,["urlContext"],h),e}function Y6(s){let e={},t=v(s,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(a=>N6(a))),w(e,["functionDeclarations"],c)}let n=v(s,["retrieval"]);n!=null&&w(e,["retrieval"],n);let i=v(s,["googleSearchRetrieval"]);i!=null&&w(e,["googleSearchRetrieval"],i);let r=v(s,["computerUse"]);if(r!=null&&w(e,["computerUse"],r),v(s,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=v(s,["codeExecution"]);o!=null&&w(e,["codeExecution"],o);let l=v(s,["enterpriseWebSearch"]);l!=null&&w(e,["enterpriseWebSearch"],l);let u=v(s,["googleMaps"]);u!=null&&w(e,["googleMaps"],u);let h=v(s,["googleSearch"]);h!=null&&w(e,["googleSearch"],h);let d=v(s,["urlContext"]);return d!=null&&w(e,["urlContext"],d),e}function K6(s,e){let t={},n=v(s,["ttl"]);e!==void 0&&n!=null&&w(e,["ttl"],n);let i=v(s,["expireTime"]);return e!==void 0&&i!=null&&w(e,["expireTime"],i),t}function X6(s,e){let t={},n=v(s,["ttl"]);e!==void 0&&n!=null&&w(e,["ttl"],n);let i=v(s,["expireTime"]);return e!==void 0&&i!=null&&w(e,["expireTime"],i),t}function J6(s,e){let t={},n=v(e,["name"]);n!=null&&w(t,["_url","name"],Rr(s,n));let i=v(e,["config"]);return i!=null&&K6(i,t),t}function Z6(s,e){let t={},n=v(e,["name"]);n!=null&&w(t,["_url","name"],Rr(s,n));let i=v(e,["config"]);return i!=null&&X6(i,t),t}var TT=class extends ci{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new kr(Dr.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=A6(this.apiClient,e);return l=fe("cachedContents",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let h=T6(this.apiClient,e);return l=fe("cachedContents",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async get(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=F6(this.apiClient,e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let h=O6(this.apiClient,e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async delete(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=I6(this.apiClient,e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=k6(d),a=new Bb;return Object.assign(a,c),a})}else{let h=C6(this.apiClient,e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=D6(d),a=new Bb;return Object.assign(a,c),a})}}async update(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=Z6(this.apiClient,e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let h=J6(this.apiClient,e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async listInternal(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=z6(e);return l=fe("cachedContents",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=G6(d),a=new Vb;return Object.assign(a,c),a})}else{let h=V6(e);return l=fe("cachedContents",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=H6(d),a=new Vb;return Object.assign(a,c),a})}}};function Gb(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(s);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(s,n[i])&&(t[n[i]]=s[n[i]]);return t}function g$(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],n=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Me(s){return this instanceof Me?(this.v=s,this):new Me(s)}function ai(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(s,e||[]),i,r=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(f){return function(p){return Promise.resolve(p).then(f,c)}}function l(f,p){n[f]&&(i[f]=function(g){return new Promise(function(m,y){r.push([f,g,m,y])>1||u(f,g)})},p&&(i[f]=p(i[f])))}function u(f,p){try{h(n[f](p))}catch(g){a(r[0][3],g)}}function h(f){f.value instanceof Me?Promise.resolve(f.value.v).then(d,c):a(r[0][2],f)}function d(f){u("next",f)}function c(f){u("throw",f)}function a(f,p){f(p),r.shift(),r.length&&u(r[0][0],r[0][1])}}function li(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=s[Symbol.asyncIterator],t;return e?e.call(s):(s=typeof g$=="function"?g$(s):s[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=s[r]&&function(o){return new Promise(function(l,u){o=s[r](o),i(l,u,o.done,o.value)})}}function i(r,o,l,u){Promise.resolve(u).then(function(h){r({value:h,done:l})},o)}}function Q6(s){var e;if(s.candidates==null||s.candidates.length===0)return!1;let t=(e=s.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:K$(t)}function K$(s){if(s.parts===void 0||s.parts.length===0)return!1;for(let e of s.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function ej(s){if(s.length!==0){for(let e of s)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function m$(s){if(s===void 0||s.length===0)return[];let e=[],t=s.length,n=0;for(;n<t;)if(s[n].role==="user")e.push(s[n]),n++;else{let i=[],r=!0;for(;n<t&&s[n].role==="model";)i.push(s[n]),r&&!K$(s[n])&&(r=!1),n++;r?e.push(...i):e.pop()}return e}var AT=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new CT(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},CT=class{constructor(e,t,n,i={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=i,this.history=r,this.sendPromise=Promise.resolve(),ej(r)}async sendMessage(e){var t;await this.sendPromise;let n=Fn(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,o,l;let u=await i,h=(o=(r=u.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content,d=u.automaticFunctionCallingHistory,c=this.getHistory(!0).length,a=[];d!=null&&(a=(l=d.slice(c))!==null&&l!==void 0?l:[]);let f=h?[h]:[];this.recordHistory(n,f,a)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;let n=Fn(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});let r=await i;return this.processStreamResponse(r,n)}getHistory(e=!1){let t=e?m$(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return ai(this,arguments,function*(){var i,r,o,l,u,h;let d=[];try{for(var c=!0,a=li(e),f;f=yield Me(a.next()),i=f.done,!i;c=!0){l=f.value,c=!1;let p=l;if(Q6(p)){let g=(h=(u=p.candidates)===null||u===void 0?void 0:u[0])===null||h===void 0?void 0:h.content;g!==void 0&&d.push(g)}yield yield Me(p)}}catch(p){r={error:p}}finally{try{!c&&!i&&(o=a.return)&&(yield Me(o.call(a)))}finally{if(r)throw r.error}}this.recordHistory(t,d)})}recordHistory(e,t,n){let i=[];t.length>0&&t.every(r=>r.role!==void 0)?i=t:i.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...m$(n)):this.history.push(e),this.history.push(...i)}};var jb=class s extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,s.prototype)}};function tj(s){let e={},t=v(s,["file"]);return t!=null&&w(e,["file"],t),e}function nj(s){let e={},t=v(s,["sdkHttpResponse"]);return t!=null&&w(e,["sdkHttpResponse"],t),e}function sj(s){let e={},t=v(s,["name"]);return t!=null&&w(e,["_url","file"],z$(t)),e}function ij(s){let e={},t=v(s,["sdkHttpResponse"]);return t!=null&&w(e,["sdkHttpResponse"],t),e}function rj(s){let e={},t=v(s,["name"]);return t!=null&&w(e,["_url","file"],z$(t)),e}function oj(s,e){let t={},n=v(s,["pageSize"]);e!==void 0&&n!=null&&w(e,["_query","pageSize"],n);let i=v(s,["pageToken"]);return e!==void 0&&i!=null&&w(e,["_query","pageToken"],i),t}function aj(s){let e={},t=v(s,["config"]);return t!=null&&oj(t,e),e}function lj(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["nextPageToken"]);n!=null&&w(e,["nextPageToken"],n);let i=v(s,["files"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),w(e,["files"],r)}return e}var IT=class extends ci{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new kr(Dr.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=aj(e);return r=fe("files",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{let d=h;return d.sdkHttpResponse={headers:u.headers},d})),i.then(u=>{let h=lj(u),d=new mT;return Object.assign(d,h),d})}}async createInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=tj(e);return r=fe("upload/v1beta/files",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i.then(u=>{let h=nj(u),d=new yT;return Object.assign(d,h),d})}}async get(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=rj(e);return r=fe("files/{file}",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i.then(u=>u)}}async delete(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=sj(e);return r=fe("files/{file}",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{let d=h;return d.sdkHttpResponse={headers:u.headers},d})),i.then(u=>{let h=ij(u),d=new bT;return Object.assign(d,h),d})}}};function kb(s){let e={},t=v(s,["data"]);if(t!=null&&w(e,["data"],t),v(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=v(s,["mimeType"]);return n!=null&&w(e,["mimeType"],n),e}function cj(s){let e={},t=v(s,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>Tj(r))),w(e,["parts"],i)}let n=v(s,["role"]);return n!=null&&w(e,["role"],n),e}function uj(s){let e={};if(v(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=v(s,["fileUri"]);t!=null&&w(e,["fileUri"],t);let n=v(s,["mimeType"]);return n!=null&&w(e,["mimeType"],n),e}function dj(s){let e={},t=v(s,["id"]);t!=null&&w(e,["id"],t);let n=v(s,["args"]);n!=null&&w(e,["args"],n);let i=v(s,["name"]);if(i!=null&&w(e,["name"],i),v(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function hj(s){let e={};if(v(s,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=v(s,["description"]);t!=null&&w(e,["description"],t);let n=v(s,["name"]);n!=null&&w(e,["name"],n);let i=v(s,["parameters"]);i!=null&&w(e,["parameters"],i);let r=v(s,["parametersJsonSchema"]);r!=null&&w(e,["parametersJsonSchema"],r);let o=v(s,["response"]);o!=null&&w(e,["response"],o);let l=v(s,["responseJsonSchema"]);return l!=null&&w(e,["responseJsonSchema"],l),e}function fj(s){let e={},t=v(s,["modelSelectionConfig"]);t!=null&&w(e,["modelConfig"],t);let n=v(s,["responseJsonSchema"]);n!=null&&w(e,["responseJsonSchema"],n);let i=v(s,["audioTimestamp"]);i!=null&&w(e,["audioTimestamp"],i);let r=v(s,["candidateCount"]);r!=null&&w(e,["candidateCount"],r);let o=v(s,["enableAffectiveDialog"]);o!=null&&w(e,["enableAffectiveDialog"],o);let l=v(s,["frequencyPenalty"]);l!=null&&w(e,["frequencyPenalty"],l);let u=v(s,["logprobs"]);u!=null&&w(e,["logprobs"],u);let h=v(s,["maxOutputTokens"]);h!=null&&w(e,["maxOutputTokens"],h);let d=v(s,["mediaResolution"]);d!=null&&w(e,["mediaResolution"],d);let c=v(s,["presencePenalty"]);c!=null&&w(e,["presencePenalty"],c);let a=v(s,["responseLogprobs"]);a!=null&&w(e,["responseLogprobs"],a);let f=v(s,["responseMimeType"]);f!=null&&w(e,["responseMimeType"],f);let p=v(s,["responseModalities"]);p!=null&&w(e,["responseModalities"],p);let g=v(s,["responseSchema"]);g!=null&&w(e,["responseSchema"],g);let m=v(s,["routingConfig"]);m!=null&&w(e,["routingConfig"],m);let y=v(s,["seed"]);y!=null&&w(e,["seed"],y);let _=v(s,["speechConfig"]);_!=null&&w(e,["speechConfig"],_);let x=v(s,["stopSequences"]);x!=null&&w(e,["stopSequences"],x);let E=v(s,["temperature"]);E!=null&&w(e,["temperature"],E);let S=v(s,["thinkingConfig"]);S!=null&&w(e,["thinkingConfig"],S);let T=v(s,["topK"]);T!=null&&w(e,["topK"],T);let C=v(s,["topP"]);if(C!=null&&w(e,["topP"],C),v(s,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function pj(s){let e={};if(v(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=v(s,["enableWidget"]);return t!=null&&w(e,["enableWidget"],t),e}function gj(s){let e={};if(v(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=v(s,["timeRangeFilter"]);return t!=null&&w(e,["timeRangeFilter"],t),e}function mj(s,e){let t={},n=v(s,["generationConfig"]);e!==void 0&&n!=null&&w(e,["setup","generationConfig"],n);let i=v(s,["responseModalities"]);e!==void 0&&i!=null&&w(e,["setup","generationConfig","responseModalities"],i);let r=v(s,["temperature"]);e!==void 0&&r!=null&&w(e,["setup","generationConfig","temperature"],r);let o=v(s,["topP"]);e!==void 0&&o!=null&&w(e,["setup","generationConfig","topP"],o);let l=v(s,["topK"]);e!==void 0&&l!=null&&w(e,["setup","generationConfig","topK"],l);let u=v(s,["maxOutputTokens"]);e!==void 0&&u!=null&&w(e,["setup","generationConfig","maxOutputTokens"],u);let h=v(s,["mediaResolution"]);e!==void 0&&h!=null&&w(e,["setup","generationConfig","mediaResolution"],h);let d=v(s,["seed"]);e!==void 0&&d!=null&&w(e,["setup","generationConfig","seed"],d);let c=v(s,["speechConfig"]);e!==void 0&&c!=null&&w(e,["setup","generationConfig","speechConfig"],aA(c));let a=v(s,["thinkingConfig"]);e!==void 0&&a!=null&&w(e,["setup","generationConfig","thinkingConfig"],a);let f=v(s,["enableAffectiveDialog"]);e!==void 0&&f!=null&&w(e,["setup","generationConfig","enableAffectiveDialog"],f);let p=v(s,["systemInstruction"]);e!==void 0&&p!=null&&w(e,["setup","systemInstruction"],cj(Fn(p)));let g=v(s,["tools"]);if(e!==void 0&&g!=null){let T=Nu(g);Array.isArray(T)&&(T=T.map(C=>Cj(Mu(C)))),w(e,["setup","tools"],T)}let m=v(s,["sessionResumption"]);e!==void 0&&m!=null&&w(e,["setup","sessionResumption"],Aj(m));let y=v(s,["inputAudioTranscription"]);e!==void 0&&y!=null&&w(e,["setup","inputAudioTranscription"],y);let _=v(s,["outputAudioTranscription"]);e!==void 0&&_!=null&&w(e,["setup","outputAudioTranscription"],_);let x=v(s,["realtimeInputConfig"]);e!==void 0&&x!=null&&w(e,["setup","realtimeInputConfig"],x);let E=v(s,["contextWindowCompression"]);e!==void 0&&E!=null&&w(e,["setup","contextWindowCompression"],E);let S=v(s,["proactivity"]);if(e!==void 0&&S!=null&&w(e,["setup","proactivity"],S),v(s,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function yj(s,e){let t={},n=v(s,["generationConfig"]);e!==void 0&&n!=null&&w(e,["setup","generationConfig"],fj(n));let i=v(s,["responseModalities"]);e!==void 0&&i!=null&&w(e,["setup","generationConfig","responseModalities"],i);let r=v(s,["temperature"]);e!==void 0&&r!=null&&w(e,["setup","generationConfig","temperature"],r);let o=v(s,["topP"]);e!==void 0&&o!=null&&w(e,["setup","generationConfig","topP"],o);let l=v(s,["topK"]);e!==void 0&&l!=null&&w(e,["setup","generationConfig","topK"],l);let u=v(s,["maxOutputTokens"]);e!==void 0&&u!=null&&w(e,["setup","generationConfig","maxOutputTokens"],u);let h=v(s,["mediaResolution"]);e!==void 0&&h!=null&&w(e,["setup","generationConfig","mediaResolution"],h);let d=v(s,["seed"]);e!==void 0&&d!=null&&w(e,["setup","generationConfig","seed"],d);let c=v(s,["speechConfig"]);e!==void 0&&c!=null&&w(e,["setup","generationConfig","speechConfig"],aA(c));let a=v(s,["thinkingConfig"]);e!==void 0&&a!=null&&w(e,["setup","generationConfig","thinkingConfig"],a);let f=v(s,["enableAffectiveDialog"]);e!==void 0&&f!=null&&w(e,["setup","generationConfig","enableAffectiveDialog"],f);let p=v(s,["systemInstruction"]);e!==void 0&&p!=null&&w(e,["setup","systemInstruction"],Fn(p));let g=v(s,["tools"]);if(e!==void 0&&g!=null){let C=Nu(g);Array.isArray(C)&&(C=C.map(I=>Ij(Mu(I)))),w(e,["setup","tools"],C)}let m=v(s,["sessionResumption"]);e!==void 0&&m!=null&&w(e,["setup","sessionResumption"],m);let y=v(s,["inputAudioTranscription"]);e!==void 0&&y!=null&&w(e,["setup","inputAudioTranscription"],y);let _=v(s,["outputAudioTranscription"]);e!==void 0&&_!=null&&w(e,["setup","outputAudioTranscription"],_);let x=v(s,["realtimeInputConfig"]);e!==void 0&&x!=null&&w(e,["setup","realtimeInputConfig"],x);let E=v(s,["contextWindowCompression"]);e!==void 0&&E!=null&&w(e,["setup","contextWindowCompression"],E);let S=v(s,["proactivity"]);e!==void 0&&S!=null&&w(e,["setup","proactivity"],S);let T=v(s,["explicitVadSignal"]);return e!==void 0&&T!=null&&w(e,["setup","explicitVadSignal"],T),t}function bj(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["setup","model"],lt(s,n));let i=v(e,["config"]);return i!=null&&w(t,["config"],mj(i,t)),t}function vj(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["setup","model"],lt(s,n));let i=v(e,["config"]);return i!=null&&w(t,["config"],yj(i,t)),t}function _j(s){let e={},t=v(s,["musicGenerationConfig"]);return t!=null&&w(e,["musicGenerationConfig"],t),e}function wj(s){let e={},t=v(s,["weightedPrompts"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(i=>i)),w(e,["weightedPrompts"],n)}return e}function xj(s){let e={},t=v(s,["media"]);if(t!=null){let h=L$(t);Array.isArray(h)&&(h=h.map(d=>kb(d))),w(e,["mediaChunks"],h)}let n=v(s,["audio"]);n!=null&&w(e,["audio"],kb(U$(n)));let i=v(s,["audioStreamEnd"]);i!=null&&w(e,["audioStreamEnd"],i);let r=v(s,["video"]);r!=null&&w(e,["video"],kb($$(r)));let o=v(s,["text"]);o!=null&&w(e,["text"],o);let l=v(s,["activityStart"]);l!=null&&w(e,["activityStart"],l);let u=v(s,["activityEnd"]);return u!=null&&w(e,["activityEnd"],u),e}function Ej(s){let e={},t=v(s,["media"]);if(t!=null){let h=L$(t);Array.isArray(h)&&(h=h.map(d=>d)),w(e,["mediaChunks"],h)}let n=v(s,["audio"]);n!=null&&w(e,["audio"],U$(n));let i=v(s,["audioStreamEnd"]);i!=null&&w(e,["audioStreamEnd"],i);let r=v(s,["video"]);r!=null&&w(e,["video"],$$(r));let o=v(s,["text"]);o!=null&&w(e,["text"],o);let l=v(s,["activityStart"]);l!=null&&w(e,["activityStart"],l);let u=v(s,["activityEnd"]);return u!=null&&w(e,["activityEnd"],u),e}function Sj(s){let e={},t=v(s,["setupComplete"]);t!=null&&w(e,["setupComplete"],t);let n=v(s,["serverContent"]);n!=null&&w(e,["serverContent"],n);let i=v(s,["toolCall"]);i!=null&&w(e,["toolCall"],i);let r=v(s,["toolCallCancellation"]);r!=null&&w(e,["toolCallCancellation"],r);let o=v(s,["usageMetadata"]);o!=null&&w(e,["usageMetadata"],Dj(o));let l=v(s,["goAway"]);l!=null&&w(e,["goAway"],l);let u=v(s,["sessionResumptionUpdate"]);u!=null&&w(e,["sessionResumptionUpdate"],u);let h=v(s,["voiceActivityDetectionSignal"]);return h!=null&&w(e,["voiceActivityDetectionSignal"],h),e}function Tj(s){let e={},t=v(s,["mediaResolution"]);t!=null&&w(e,["mediaResolution"],t);let n=v(s,["codeExecutionResult"]);n!=null&&w(e,["codeExecutionResult"],n);let i=v(s,["executableCode"]);i!=null&&w(e,["executableCode"],i);let r=v(s,["fileData"]);r!=null&&w(e,["fileData"],uj(r));let o=v(s,["functionCall"]);o!=null&&w(e,["functionCall"],dj(o));let l=v(s,["functionResponse"]);l!=null&&w(e,["functionResponse"],l);let u=v(s,["inlineData"]);u!=null&&w(e,["inlineData"],kb(u));let h=v(s,["text"]);h!=null&&w(e,["text"],h);let d=v(s,["thought"]);d!=null&&w(e,["thought"],d);let c=v(s,["thoughtSignature"]);c!=null&&w(e,["thoughtSignature"],c);let a=v(s,["videoMetadata"]);return a!=null&&w(e,["videoMetadata"],a),e}function Aj(s){let e={},t=v(s,["handle"]);if(t!=null&&w(e,["handle"],t),v(s,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Cj(s){let e={},t=v(s,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(c=>c)),w(e,["functionDeclarations"],d)}if(v(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=v(s,["googleSearchRetrieval"]);n!=null&&w(e,["googleSearchRetrieval"],n);let i=v(s,["computerUse"]);i!=null&&w(e,["computerUse"],i);let r=v(s,["fileSearch"]);r!=null&&w(e,["fileSearch"],r);let o=v(s,["codeExecution"]);if(o!=null&&w(e,["codeExecution"],o),v(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=v(s,["googleMaps"]);l!=null&&w(e,["googleMaps"],pj(l));let u=v(s,["googleSearch"]);u!=null&&w(e,["googleSearch"],gj(u));let h=v(s,["urlContext"]);return h!=null&&w(e,["urlContext"],h),e}function Ij(s){let e={},t=v(s,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(a=>hj(a))),w(e,["functionDeclarations"],c)}let n=v(s,["retrieval"]);n!=null&&w(e,["retrieval"],n);let i=v(s,["googleSearchRetrieval"]);i!=null&&w(e,["googleSearchRetrieval"],i);let r=v(s,["computerUse"]);if(r!=null&&w(e,["computerUse"],r),v(s,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=v(s,["codeExecution"]);o!=null&&w(e,["codeExecution"],o);let l=v(s,["enterpriseWebSearch"]);l!=null&&w(e,["enterpriseWebSearch"],l);let u=v(s,["googleMaps"]);u!=null&&w(e,["googleMaps"],u);let h=v(s,["googleSearch"]);h!=null&&w(e,["googleSearch"],h);let d=v(s,["urlContext"]);return d!=null&&w(e,["urlContext"],d),e}function Dj(s){let e={},t=v(s,["promptTokenCount"]);t!=null&&w(e,["promptTokenCount"],t);let n=v(s,["cachedContentTokenCount"]);n!=null&&w(e,["cachedContentTokenCount"],n);let i=v(s,["candidatesTokenCount"]);i!=null&&w(e,["responseTokenCount"],i);let r=v(s,["toolUsePromptTokenCount"]);r!=null&&w(e,["toolUsePromptTokenCount"],r);let o=v(s,["thoughtsTokenCount"]);o!=null&&w(e,["thoughtsTokenCount"],o);let l=v(s,["totalTokenCount"]);l!=null&&w(e,["totalTokenCount"],l);let u=v(s,["promptTokensDetails"]);if(u!=null){let f=u;Array.isArray(f)&&(f=f.map(p=>p)),w(e,["promptTokensDetails"],f)}let h=v(s,["cacheTokensDetails"]);if(h!=null){let f=h;Array.isArray(f)&&(f=f.map(p=>p)),w(e,["cacheTokensDetails"],f)}let d=v(s,["candidatesTokensDetails"]);if(d!=null){let f=d;Array.isArray(f)&&(f=f.map(p=>p)),w(e,["responseTokensDetails"],f)}let c=v(s,["toolUsePromptTokensDetails"]);if(c!=null){let f=c;Array.isArray(f)&&(f=f.map(p=>p)),w(e,["toolUsePromptTokensDetails"],f)}let a=v(s,["trafficType"]);return a!=null&&w(e,["trafficType"],a),e}function kj(s){let e={},t=v(s,["data"]);if(t!=null&&w(e,["data"],t),v(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=v(s,["mimeType"]);return n!=null&&w(e,["mimeType"],n),e}function Rj(s){let e={},t=v(s,["content"]);t!=null&&w(e,["content"],t);let n=v(s,["citationMetadata"]);n!=null&&w(e,["citationMetadata"],Pj(n));let i=v(s,["tokenCount"]);i!=null&&w(e,["tokenCount"],i);let r=v(s,["finishReason"]);r!=null&&w(e,["finishReason"],r);let o=v(s,["avgLogprobs"]);o!=null&&w(e,["avgLogprobs"],o);let l=v(s,["groundingMetadata"]);l!=null&&w(e,["groundingMetadata"],l);let u=v(s,["index"]);u!=null&&w(e,["index"],u);let h=v(s,["logprobsResult"]);h!=null&&w(e,["logprobsResult"],h);let d=v(s,["safetyRatings"]);if(d!=null){let a=d;Array.isArray(a)&&(a=a.map(f=>f)),w(e,["safetyRatings"],a)}let c=v(s,["urlContextMetadata"]);return c!=null&&w(e,["urlContextMetadata"],c),e}function Pj(s){let e={},t=v(s,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(i=>i)),w(e,["citations"],n)}return e}function Mj(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["contents"]);if(i!=null){let r=js(i);Array.isArray(r)&&(r=r.map(o=>o)),w(t,["contents"],r)}return t}function Nj(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["tokensInfo"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>r)),w(e,["tokensInfo"],i)}return e}function Oj(s){let e={},t=v(s,["values"]);t!=null&&w(e,["values"],t);let n=v(s,["statistics"]);return n!=null&&w(e,["statistics"],Fj(n)),e}function Fj(s){let e={},t=v(s,["truncated"]);t!=null&&w(e,["truncated"],t);let n=v(s,["token_count"]);return n!=null&&w(e,["tokenCount"],n),e}function lv(s){let e={},t=v(s,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>jW(r))),w(e,["parts"],i)}let n=v(s,["role"]);return n!=null&&w(e,["role"],n),e}function Lj(s){let e={},t=v(s,["controlType"]);t!=null&&w(e,["controlType"],t);let n=v(s,["enableControlImageComputation"]);return n!=null&&w(e,["computeControl"],n),e}function $j(s){let e={};if(v(s,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(v(s,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(v(s,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function Uj(s,e){let t={},n=v(s,["systemInstruction"]);e!==void 0&&n!=null&&w(e,["systemInstruction"],Fn(n));let i=v(s,["tools"]);if(e!==void 0&&i!=null){let o=i;Array.isArray(o)&&(o=o.map(l=>Q$(l))),w(e,["tools"],o)}let r=v(s,["generationConfig"]);return e!==void 0&&r!=null&&w(e,["generationConfig"],kW(r)),t}function Bj(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["contents"]);if(i!=null){let o=js(i);Array.isArray(o)&&(o=o.map(l=>lv(l))),w(t,["contents"],o)}let r=v(e,["config"]);return r!=null&&$j(r),t}function Vj(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["contents"]);if(i!=null){let o=js(i);Array.isArray(o)&&(o=o.map(l=>l)),w(t,["contents"],o)}let r=v(e,["config"]);return r!=null&&Uj(r,t),t}function zj(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["totalTokens"]);n!=null&&w(e,["totalTokens"],n);let i=v(s,["cachedContentTokenCount"]);return i!=null&&w(e,["cachedContentTokenCount"],i),e}function Hj(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["totalTokens"]);return n!=null&&w(e,["totalTokens"],n),e}function Gj(s,e){let t={},n=v(e,["model"]);return n!=null&&w(t,["_url","name"],lt(s,n)),t}function jj(s,e){let t={},n=v(e,["model"]);return n!=null&&w(t,["_url","name"],lt(s,n)),t}function Wj(s){let e={},t=v(s,["sdkHttpResponse"]);return t!=null&&w(e,["sdkHttpResponse"],t),e}function qj(s){let e={},t=v(s,["sdkHttpResponse"]);return t!=null&&w(e,["sdkHttpResponse"],t),e}function Yj(s,e){let t={},n=v(s,["outputGcsUri"]);e!==void 0&&n!=null&&w(e,["parameters","storageUri"],n);let i=v(s,["negativePrompt"]);e!==void 0&&i!=null&&w(e,["parameters","negativePrompt"],i);let r=v(s,["numberOfImages"]);e!==void 0&&r!=null&&w(e,["parameters","sampleCount"],r);let o=v(s,["aspectRatio"]);e!==void 0&&o!=null&&w(e,["parameters","aspectRatio"],o);let l=v(s,["guidanceScale"]);e!==void 0&&l!=null&&w(e,["parameters","guidanceScale"],l);let u=v(s,["seed"]);e!==void 0&&u!=null&&w(e,["parameters","seed"],u);let h=v(s,["safetyFilterLevel"]);e!==void 0&&h!=null&&w(e,["parameters","safetySetting"],h);let d=v(s,["personGeneration"]);e!==void 0&&d!=null&&w(e,["parameters","personGeneration"],d);let c=v(s,["includeSafetyAttributes"]);e!==void 0&&c!=null&&w(e,["parameters","includeSafetyAttributes"],c);let a=v(s,["includeRaiReason"]);e!==void 0&&a!=null&&w(e,["parameters","includeRaiReason"],a);let f=v(s,["language"]);e!==void 0&&f!=null&&w(e,["parameters","language"],f);let p=v(s,["outputMimeType"]);e!==void 0&&p!=null&&w(e,["parameters","outputOptions","mimeType"],p);let g=v(s,["outputCompressionQuality"]);e!==void 0&&g!=null&&w(e,["parameters","outputOptions","compressionQuality"],g);let m=v(s,["addWatermark"]);e!==void 0&&m!=null&&w(e,["parameters","addWatermark"],m);let y=v(s,["labels"]);e!==void 0&&y!=null&&w(e,["labels"],y);let _=v(s,["editMode"]);e!==void 0&&_!=null&&w(e,["parameters","editMode"],_);let x=v(s,["baseSteps"]);return e!==void 0&&x!=null&&w(e,["parameters","editConfig","baseSteps"],x),t}function Kj(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["prompt"]);i!=null&&w(t,["instances[0]","prompt"],i);let r=v(e,["referenceImages"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(u=>JW(u))),w(t,["instances[0]","referenceImages"],l)}let o=v(e,["config"]);return o!=null&&Yj(o,t),t}function Xj(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>cv(r))),w(e,["generatedImages"],i)}return e}function Jj(s,e){let t={},n=v(s,["taskType"]);e!==void 0&&n!=null&&w(e,["requests[]","taskType"],n);let i=v(s,["title"]);e!==void 0&&i!=null&&w(e,["requests[]","title"],i);let r=v(s,["outputDimensionality"]);if(e!==void 0&&r!=null&&w(e,["requests[]","outputDimensionality"],r),v(s,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(v(s,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function Zj(s,e){let t={},n=v(s,["taskType"]);e!==void 0&&n!=null&&w(e,["instances[]","task_type"],n);let i=v(s,["title"]);e!==void 0&&i!=null&&w(e,["instances[]","title"],i);let r=v(s,["outputDimensionality"]);e!==void 0&&r!=null&&w(e,["parameters","outputDimensionality"],r);let o=v(s,["mimeType"]);e!==void 0&&o!=null&&w(e,["instances[]","mimeType"],o);let l=v(s,["autoTruncate"]);return e!==void 0&&l!=null&&w(e,["parameters","autoTruncate"],l),t}function Qj(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["contents"]);if(i!=null){let l=iA(s,i);Array.isArray(l)&&(l=l.map(u=>u)),w(t,["requests[]","content"],l)}let r=v(e,["config"]);r!=null&&Jj(r,t);let o=v(e,["model"]);return o!==void 0&&w(t,["requests[]","model"],lt(s,o)),t}function eW(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["contents"]);if(i!=null){let o=iA(s,i);Array.isArray(o)&&(o=o.map(l=>l)),w(t,["instances[]","content"],o)}let r=v(e,["config"]);return r!=null&&Zj(r,t),t}function tW(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),w(e,["embeddings"],r)}let i=v(s,["metadata"]);return i!=null&&w(e,["metadata"],i),e}function nW(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["predictions[]","embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Oj(o))),w(e,["embeddings"],r)}let i=v(s,["metadata"]);return i!=null&&w(e,["metadata"],i),e}function sW(s){let e={},t=v(s,["endpoint"]);t!=null&&w(e,["name"],t);let n=v(s,["deployedModelId"]);return n!=null&&w(e,["deployedModelId"],n),e}function iW(s){let e={};if(v(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=v(s,["fileUri"]);t!=null&&w(e,["fileUri"],t);let n=v(s,["mimeType"]);return n!=null&&w(e,["mimeType"],n),e}function rW(s){let e={},t=v(s,["id"]);t!=null&&w(e,["id"],t);let n=v(s,["args"]);n!=null&&w(e,["args"],n);let i=v(s,["name"]);if(i!=null&&w(e,["name"],i),v(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function oW(s){let e={},t=v(s,["mode"]);t!=null&&w(e,["mode"],t);let n=v(s,["allowedFunctionNames"]);if(n!=null&&w(e,["allowedFunctionNames"],n),v(s,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function aW(s){let e={};if(v(s,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=v(s,["description"]);t!=null&&w(e,["description"],t);let n=v(s,["name"]);n!=null&&w(e,["name"],n);let i=v(s,["parameters"]);i!=null&&w(e,["parameters"],i);let r=v(s,["parametersJsonSchema"]);r!=null&&w(e,["parametersJsonSchema"],r);let o=v(s,["response"]);o!=null&&w(e,["response"],o);let l=v(s,["responseJsonSchema"]);return l!=null&&w(e,["responseJsonSchema"],l),e}function lW(s,e,t){let n={},i=v(e,["systemInstruction"]);t!==void 0&&i!=null&&w(t,["systemInstruction"],lv(Fn(i)));let r=v(e,["temperature"]);r!=null&&w(n,["temperature"],r);let o=v(e,["topP"]);o!=null&&w(n,["topP"],o);let l=v(e,["topK"]);l!=null&&w(n,["topK"],l);let u=v(e,["candidateCount"]);u!=null&&w(n,["candidateCount"],u);let h=v(e,["maxOutputTokens"]);h!=null&&w(n,["maxOutputTokens"],h);let d=v(e,["stopSequences"]);d!=null&&w(n,["stopSequences"],d);let c=v(e,["responseLogprobs"]);c!=null&&w(n,["responseLogprobs"],c);let a=v(e,["logprobs"]);a!=null&&w(n,["logprobs"],a);let f=v(e,["presencePenalty"]);f!=null&&w(n,["presencePenalty"],f);let p=v(e,["frequencyPenalty"]);p!=null&&w(n,["frequencyPenalty"],p);let g=v(e,["seed"]);g!=null&&w(n,["seed"],g);let m=v(e,["responseMimeType"]);m!=null&&w(n,["responseMimeType"],m);let y=v(e,["responseSchema"]);y!=null&&w(n,["responseSchema"],rA(y));let _=v(e,["responseJsonSchema"]);if(_!=null&&w(n,["responseJsonSchema"],_),v(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(v(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let x=v(e,["safetySettings"]);if(t!==void 0&&x!=null){let z=x;Array.isArray(z)&&(z=z.map(B=>ZW(B))),w(t,["safetySettings"],z)}let E=v(e,["tools"]);if(t!==void 0&&E!=null){let z=Nu(E);Array.isArray(z)&&(z=z.map(B=>rq(Mu(B)))),w(t,["tools"],z)}let S=v(e,["toolConfig"]);if(t!==void 0&&S!=null&&w(t,["toolConfig"],iq(S)),v(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let T=v(e,["cachedContent"]);t!==void 0&&T!=null&&w(t,["cachedContent"],Rr(s,T));let C=v(e,["responseModalities"]);C!=null&&w(n,["responseModalities"],C);let I=v(e,["mediaResolution"]);I!=null&&w(n,["mediaResolution"],I);let A=v(e,["speechConfig"]);if(A!=null&&w(n,["speechConfig"],oA(A)),v(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let P=v(e,["thinkingConfig"]);P!=null&&w(n,["thinkingConfig"],P);let F=v(e,["imageConfig"]);F!=null&&w(n,["imageConfig"],OW(F));let H=v(e,["enableEnhancedCivicAnswers"]);return H!=null&&w(n,["enableEnhancedCivicAnswers"],H),n}function cW(s,e,t){let n={},i=v(e,["systemInstruction"]);t!==void 0&&i!=null&&w(t,["systemInstruction"],Fn(i));let r=v(e,["temperature"]);r!=null&&w(n,["temperature"],r);let o=v(e,["topP"]);o!=null&&w(n,["topP"],o);let l=v(e,["topK"]);l!=null&&w(n,["topK"],l);let u=v(e,["candidateCount"]);u!=null&&w(n,["candidateCount"],u);let h=v(e,["maxOutputTokens"]);h!=null&&w(n,["maxOutputTokens"],h);let d=v(e,["stopSequences"]);d!=null&&w(n,["stopSequences"],d);let c=v(e,["responseLogprobs"]);c!=null&&w(n,["responseLogprobs"],c);let a=v(e,["logprobs"]);a!=null&&w(n,["logprobs"],a);let f=v(e,["presencePenalty"]);f!=null&&w(n,["presencePenalty"],f);let p=v(e,["frequencyPenalty"]);p!=null&&w(n,["frequencyPenalty"],p);let g=v(e,["seed"]);g!=null&&w(n,["seed"],g);let m=v(e,["responseMimeType"]);m!=null&&w(n,["responseMimeType"],m);let y=v(e,["responseSchema"]);y!=null&&w(n,["responseSchema"],rA(y));let _=v(e,["responseJsonSchema"]);_!=null&&w(n,["responseJsonSchema"],_);let x=v(e,["routingConfig"]);x!=null&&w(n,["routingConfig"],x);let E=v(e,["modelSelectionConfig"]);E!=null&&w(n,["modelConfig"],E);let S=v(e,["safetySettings"]);if(t!==void 0&&S!=null){let M=S;Array.isArray(M)&&(M=M.map($=>$)),w(t,["safetySettings"],M)}let T=v(e,["tools"]);if(t!==void 0&&T!=null){let M=Nu(T);Array.isArray(M)&&(M=M.map($=>Q$(Mu($)))),w(t,["tools"],M)}let C=v(e,["toolConfig"]);t!==void 0&&C!=null&&w(t,["toolConfig"],C);let I=v(e,["labels"]);t!==void 0&&I!=null&&w(t,["labels"],I);let A=v(e,["cachedContent"]);t!==void 0&&A!=null&&w(t,["cachedContent"],Rr(s,A));let P=v(e,["responseModalities"]);P!=null&&w(n,["responseModalities"],P);let F=v(e,["mediaResolution"]);F!=null&&w(n,["mediaResolution"],F);let H=v(e,["speechConfig"]);H!=null&&w(n,["speechConfig"],oA(H));let z=v(e,["audioTimestamp"]);z!=null&&w(n,["audioTimestamp"],z);let B=v(e,["thinkingConfig"]);B!=null&&w(n,["thinkingConfig"],B);let V=v(e,["imageConfig"]);if(V!=null&&w(n,["imageConfig"],FW(V)),v(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function y$(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["contents"]);if(i!=null){let o=js(i);Array.isArray(o)&&(o=o.map(l=>lv(l))),w(t,["contents"],o)}let r=v(e,["config"]);return r!=null&&w(t,["generationConfig"],lW(s,r,t)),t}function b$(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["contents"]);if(i!=null){let o=js(i);Array.isArray(o)&&(o=o.map(l=>l)),w(t,["contents"],o)}let r=v(e,["config"]);return r!=null&&w(t,["generationConfig"],cW(s,r,t)),t}function v$(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["candidates"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(h=>Rj(h))),w(e,["candidates"],u)}let i=v(s,["modelVersion"]);i!=null&&w(e,["modelVersion"],i);let r=v(s,["promptFeedback"]);r!=null&&w(e,["promptFeedback"],r);let o=v(s,["responseId"]);o!=null&&w(e,["responseId"],o);let l=v(s,["usageMetadata"]);return l!=null&&w(e,["usageMetadata"],l),e}function _$(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["candidates"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(d=>d)),w(e,["candidates"],h)}let i=v(s,["createTime"]);i!=null&&w(e,["createTime"],i);let r=v(s,["modelVersion"]);r!=null&&w(e,["modelVersion"],r);let o=v(s,["promptFeedback"]);o!=null&&w(e,["promptFeedback"],o);let l=v(s,["responseId"]);l!=null&&w(e,["responseId"],l);let u=v(s,["usageMetadata"]);return u!=null&&w(e,["usageMetadata"],u),e}function uW(s,e){let t={};if(v(s,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(v(s,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let n=v(s,["numberOfImages"]);e!==void 0&&n!=null&&w(e,["parameters","sampleCount"],n);let i=v(s,["aspectRatio"]);e!==void 0&&i!=null&&w(e,["parameters","aspectRatio"],i);let r=v(s,["guidanceScale"]);if(e!==void 0&&r!=null&&w(e,["parameters","guidanceScale"],r),v(s,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=v(s,["safetyFilterLevel"]);e!==void 0&&o!=null&&w(e,["parameters","safetySetting"],o);let l=v(s,["personGeneration"]);e!==void 0&&l!=null&&w(e,["parameters","personGeneration"],l);let u=v(s,["includeSafetyAttributes"]);e!==void 0&&u!=null&&w(e,["parameters","includeSafetyAttributes"],u);let h=v(s,["includeRaiReason"]);e!==void 0&&h!=null&&w(e,["parameters","includeRaiReason"],h);let d=v(s,["language"]);e!==void 0&&d!=null&&w(e,["parameters","language"],d);let c=v(s,["outputMimeType"]);e!==void 0&&c!=null&&w(e,["parameters","outputOptions","mimeType"],c);let a=v(s,["outputCompressionQuality"]);if(e!==void 0&&a!=null&&w(e,["parameters","outputOptions","compressionQuality"],a),v(s,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(v(s,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let f=v(s,["imageSize"]);if(e!==void 0&&f!=null&&w(e,["parameters","sampleImageSize"],f),v(s,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function dW(s,e){let t={},n=v(s,["outputGcsUri"]);e!==void 0&&n!=null&&w(e,["parameters","storageUri"],n);let i=v(s,["negativePrompt"]);e!==void 0&&i!=null&&w(e,["parameters","negativePrompt"],i);let r=v(s,["numberOfImages"]);e!==void 0&&r!=null&&w(e,["parameters","sampleCount"],r);let o=v(s,["aspectRatio"]);e!==void 0&&o!=null&&w(e,["parameters","aspectRatio"],o);let l=v(s,["guidanceScale"]);e!==void 0&&l!=null&&w(e,["parameters","guidanceScale"],l);let u=v(s,["seed"]);e!==void 0&&u!=null&&w(e,["parameters","seed"],u);let h=v(s,["safetyFilterLevel"]);e!==void 0&&h!=null&&w(e,["parameters","safetySetting"],h);let d=v(s,["personGeneration"]);e!==void 0&&d!=null&&w(e,["parameters","personGeneration"],d);let c=v(s,["includeSafetyAttributes"]);e!==void 0&&c!=null&&w(e,["parameters","includeSafetyAttributes"],c);let a=v(s,["includeRaiReason"]);e!==void 0&&a!=null&&w(e,["parameters","includeRaiReason"],a);let f=v(s,["language"]);e!==void 0&&f!=null&&w(e,["parameters","language"],f);let p=v(s,["outputMimeType"]);e!==void 0&&p!=null&&w(e,["parameters","outputOptions","mimeType"],p);let g=v(s,["outputCompressionQuality"]);e!==void 0&&g!=null&&w(e,["parameters","outputOptions","compressionQuality"],g);let m=v(s,["addWatermark"]);e!==void 0&&m!=null&&w(e,["parameters","addWatermark"],m);let y=v(s,["labels"]);e!==void 0&&y!=null&&w(e,["labels"],y);let _=v(s,["imageSize"]);e!==void 0&&_!=null&&w(e,["parameters","sampleImageSize"],_);let x=v(s,["enhancePrompt"]);return e!==void 0&&x!=null&&w(e,["parameters","enhancePrompt"],x),t}function hW(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["prompt"]);i!=null&&w(t,["instances[0]","prompt"],i);let r=v(e,["config"]);return r!=null&&uW(r,t),t}function fW(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["prompt"]);i!=null&&w(t,["instances[0]","prompt"],i);let r=v(e,["config"]);return r!=null&&dW(r,t),t}function pW(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>AW(o))),w(e,["generatedImages"],r)}let i=v(s,["positivePromptSafetyAttributes"]);return i!=null&&w(e,["positivePromptSafetyAttributes"],J$(i)),e}function gW(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>cv(o))),w(e,["generatedImages"],r)}let i=v(s,["positivePromptSafetyAttributes"]);return i!=null&&w(e,["positivePromptSafetyAttributes"],Z$(i)),e}function mW(s,e){let t={},n=v(s,["numberOfVideos"]);if(e!==void 0&&n!=null&&w(e,["parameters","sampleCount"],n),v(s,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(v(s,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let i=v(s,["durationSeconds"]);if(e!==void 0&&i!=null&&w(e,["parameters","durationSeconds"],i),v(s,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let r=v(s,["aspectRatio"]);e!==void 0&&r!=null&&w(e,["parameters","aspectRatio"],r);let o=v(s,["resolution"]);e!==void 0&&o!=null&&w(e,["parameters","resolution"],o);let l=v(s,["personGeneration"]);if(e!==void 0&&l!=null&&w(e,["parameters","personGeneration"],l),v(s,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let u=v(s,["negativePrompt"]);e!==void 0&&u!=null&&w(e,["parameters","negativePrompt"],u);let h=v(s,["enhancePrompt"]);if(e!==void 0&&h!=null&&w(e,["parameters","enhancePrompt"],h),v(s,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let d=v(s,["lastFrame"]);e!==void 0&&d!=null&&w(e,["instances[0]","lastFrame"],uv(d));let c=v(s,["referenceImages"]);if(e!==void 0&&c!=null){let a=c;Array.isArray(a)&&(a=a.map(f=>bq(f))),w(e,["instances[0]","referenceImages"],a)}if(v(s,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(v(s,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function yW(s,e){let t={},n=v(s,["numberOfVideos"]);e!==void 0&&n!=null&&w(e,["parameters","sampleCount"],n);let i=v(s,["outputGcsUri"]);e!==void 0&&i!=null&&w(e,["parameters","storageUri"],i);let r=v(s,["fps"]);e!==void 0&&r!=null&&w(e,["parameters","fps"],r);let o=v(s,["durationSeconds"]);e!==void 0&&o!=null&&w(e,["parameters","durationSeconds"],o);let l=v(s,["seed"]);e!==void 0&&l!=null&&w(e,["parameters","seed"],l);let u=v(s,["aspectRatio"]);e!==void 0&&u!=null&&w(e,["parameters","aspectRatio"],u);let h=v(s,["resolution"]);e!==void 0&&h!=null&&w(e,["parameters","resolution"],h);let d=v(s,["personGeneration"]);e!==void 0&&d!=null&&w(e,["parameters","personGeneration"],d);let c=v(s,["pubsubTopic"]);e!==void 0&&c!=null&&w(e,["parameters","pubsubTopic"],c);let a=v(s,["negativePrompt"]);e!==void 0&&a!=null&&w(e,["parameters","negativePrompt"],a);let f=v(s,["enhancePrompt"]);e!==void 0&&f!=null&&w(e,["parameters","enhancePrompt"],f);let p=v(s,["generateAudio"]);e!==void 0&&p!=null&&w(e,["parameters","generateAudio"],p);let g=v(s,["lastFrame"]);e!==void 0&&g!=null&&w(e,["instances[0]","lastFrame"],ui(g));let m=v(s,["referenceImages"]);if(e!==void 0&&m!=null){let x=m;Array.isArray(x)&&(x=x.map(E=>vq(E))),w(e,["instances[0]","referenceImages"],x)}let y=v(s,["mask"]);e!==void 0&&y!=null&&w(e,["instances[0]","mask"],yq(y));let _=v(s,["compressionQuality"]);return e!==void 0&&_!=null&&w(e,["parameters","compressionQuality"],_),t}function bW(s){let e={},t=v(s,["name"]);t!=null&&w(e,["name"],t);let n=v(s,["metadata"]);n!=null&&w(e,["metadata"],n);let i=v(s,["done"]);i!=null&&w(e,["done"],i);let r=v(s,["error"]);r!=null&&w(e,["error"],r);let o=v(s,["response","generateVideoResponse"]);return o!=null&&w(e,["response"],xW(o)),e}function vW(s){let e={},t=v(s,["name"]);t!=null&&w(e,["name"],t);let n=v(s,["metadata"]);n!=null&&w(e,["metadata"],n);let i=v(s,["done"]);i!=null&&w(e,["done"],i);let r=v(s,["error"]);r!=null&&w(e,["error"],r);let o=v(s,["response"]);return o!=null&&w(e,["response"],EW(o)),e}function _W(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["prompt"]);i!=null&&w(t,["instances[0]","prompt"],i);let r=v(e,["image"]);r!=null&&w(t,["instances[0]","image"],uv(r));let o=v(e,["video"]);o!=null&&w(t,["instances[0]","video"],eU(o));let l=v(e,["source"]);l!=null&&SW(l,t);let u=v(e,["config"]);return u!=null&&mW(u,t),t}function wW(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["prompt"]);i!=null&&w(t,["instances[0]","prompt"],i);let r=v(e,["image"]);r!=null&&w(t,["instances[0]","image"],ui(r));let o=v(e,["video"]);o!=null&&w(t,["instances[0]","video"],tU(o));let l=v(e,["source"]);l!=null&&TW(l,t);let u=v(e,["config"]);return u!=null&&yW(u,t),t}function xW(s){let e={},t=v(s,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>IW(o))),w(e,["generatedVideos"],r)}let n=v(s,["raiMediaFilteredCount"]);n!=null&&w(e,["raiMediaFilteredCount"],n);let i=v(s,["raiMediaFilteredReasons"]);return i!=null&&w(e,["raiMediaFilteredReasons"],i),e}function EW(s){let e={},t=v(s,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>DW(o))),w(e,["generatedVideos"],r)}let n=v(s,["raiMediaFilteredCount"]);n!=null&&w(e,["raiMediaFilteredCount"],n);let i=v(s,["raiMediaFilteredReasons"]);return i!=null&&w(e,["raiMediaFilteredReasons"],i),e}function SW(s,e){let t={},n=v(s,["prompt"]);e!==void 0&&n!=null&&w(e,["instances[0]","prompt"],n);let i=v(s,["image"]);e!==void 0&&i!=null&&w(e,["instances[0]","image"],uv(i));let r=v(s,["video"]);return e!==void 0&&r!=null&&w(e,["instances[0]","video"],eU(r)),t}function TW(s,e){let t={},n=v(s,["prompt"]);e!==void 0&&n!=null&&w(e,["instances[0]","prompt"],n);let i=v(s,["image"]);e!==void 0&&i!=null&&w(e,["instances[0]","image"],ui(i));let r=v(s,["video"]);return e!==void 0&&r!=null&&w(e,["instances[0]","video"],tU(r)),t}function AW(s){let e={},t=v(s,["_self"]);t!=null&&w(e,["image"],LW(t));let n=v(s,["raiFilteredReason"]);n!=null&&w(e,["raiFilteredReason"],n);let i=v(s,["_self"]);return i!=null&&w(e,["safetyAttributes"],J$(i)),e}function cv(s){let e={},t=v(s,["_self"]);t!=null&&w(e,["image"],X$(t));let n=v(s,["raiFilteredReason"]);n!=null&&w(e,["raiFilteredReason"],n);let i=v(s,["_self"]);i!=null&&w(e,["safetyAttributes"],Z$(i));let r=v(s,["prompt"]);return r!=null&&w(e,["enhancedPrompt"],r),e}function CW(s){let e={},t=v(s,["_self"]);t!=null&&w(e,["mask"],X$(t));let n=v(s,["labels"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>r)),w(e,["labels"],i)}return e}function IW(s){let e={},t=v(s,["video"]);return t!=null&&w(e,["video"],gq(t)),e}function DW(s){let e={},t=v(s,["_self"]);return t!=null&&w(e,["video"],mq(t)),e}function kW(s){let e={},t=v(s,["modelSelectionConfig"]);t!=null&&w(e,["modelConfig"],t);let n=v(s,["responseJsonSchema"]);n!=null&&w(e,["responseJsonSchema"],n);let i=v(s,["audioTimestamp"]);i!=null&&w(e,["audioTimestamp"],i);let r=v(s,["candidateCount"]);r!=null&&w(e,["candidateCount"],r);let o=v(s,["enableAffectiveDialog"]);o!=null&&w(e,["enableAffectiveDialog"],o);let l=v(s,["frequencyPenalty"]);l!=null&&w(e,["frequencyPenalty"],l);let u=v(s,["logprobs"]);u!=null&&w(e,["logprobs"],u);let h=v(s,["maxOutputTokens"]);h!=null&&w(e,["maxOutputTokens"],h);let d=v(s,["mediaResolution"]);d!=null&&w(e,["mediaResolution"],d);let c=v(s,["presencePenalty"]);c!=null&&w(e,["presencePenalty"],c);let a=v(s,["responseLogprobs"]);a!=null&&w(e,["responseLogprobs"],a);let f=v(s,["responseMimeType"]);f!=null&&w(e,["responseMimeType"],f);let p=v(s,["responseModalities"]);p!=null&&w(e,["responseModalities"],p);let g=v(s,["responseSchema"]);g!=null&&w(e,["responseSchema"],g);let m=v(s,["routingConfig"]);m!=null&&w(e,["routingConfig"],m);let y=v(s,["seed"]);y!=null&&w(e,["seed"],y);let _=v(s,["speechConfig"]);_!=null&&w(e,["speechConfig"],_);let x=v(s,["stopSequences"]);x!=null&&w(e,["stopSequences"],x);let E=v(s,["temperature"]);E!=null&&w(e,["temperature"],E);let S=v(s,["thinkingConfig"]);S!=null&&w(e,["thinkingConfig"],S);let T=v(s,["topK"]);T!=null&&w(e,["topK"],T);let C=v(s,["topP"]);if(C!=null&&w(e,["topP"],C),v(s,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function RW(s,e){let t={},n=v(e,["model"]);return n!=null&&w(t,["_url","name"],lt(s,n)),t}function PW(s,e){let t={},n=v(e,["model"]);return n!=null&&w(t,["_url","name"],lt(s,n)),t}function MW(s){let e={};if(v(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=v(s,["enableWidget"]);return t!=null&&w(e,["enableWidget"],t),e}function NW(s){let e={};if(v(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=v(s,["timeRangeFilter"]);return t!=null&&w(e,["timeRangeFilter"],t),e}function OW(s){let e={},t=v(s,["aspectRatio"]);t!=null&&w(e,["aspectRatio"],t);let n=v(s,["imageSize"]);if(n!=null&&w(e,["imageSize"],n),v(s,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(v(s,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function FW(s){let e={},t=v(s,["aspectRatio"]);t!=null&&w(e,["aspectRatio"],t);let n=v(s,["imageSize"]);n!=null&&w(e,["imageSize"],n);let i=v(s,["outputMimeType"]);i!=null&&w(e,["imageOutputOptions","mimeType"],i);let r=v(s,["outputCompressionQuality"]);return r!=null&&w(e,["imageOutputOptions","compressionQuality"],r),e}function LW(s){let e={},t=v(s,["bytesBase64Encoded"]);t!=null&&w(e,["imageBytes"],ko(t));let n=v(s,["mimeType"]);return n!=null&&w(e,["mimeType"],n),e}function X$(s){let e={},t=v(s,["gcsUri"]);t!=null&&w(e,["gcsUri"],t);let n=v(s,["bytesBase64Encoded"]);n!=null&&w(e,["imageBytes"],ko(n));let i=v(s,["mimeType"]);return i!=null&&w(e,["mimeType"],i),e}function uv(s){let e={};if(v(s,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=v(s,["imageBytes"]);t!=null&&w(e,["bytesBase64Encoded"],ko(t));let n=v(s,["mimeType"]);return n!=null&&w(e,["mimeType"],n),e}function ui(s){let e={},t=v(s,["gcsUri"]);t!=null&&w(e,["gcsUri"],t);let n=v(s,["imageBytes"]);n!=null&&w(e,["bytesBase64Encoded"],ko(n));let i=v(s,["mimeType"]);return i!=null&&w(e,["mimeType"],i),e}function $W(s,e,t){let n={},i=v(e,["pageSize"]);t!==void 0&&i!=null&&w(t,["_query","pageSize"],i);let r=v(e,["pageToken"]);t!==void 0&&r!=null&&w(t,["_query","pageToken"],r);let o=v(e,["filter"]);t!==void 0&&o!=null&&w(t,["_query","filter"],o);let l=v(e,["queryBase"]);return t!==void 0&&l!=null&&w(t,["_url","models_url"],H$(s,l)),n}function UW(s,e,t){let n={},i=v(e,["pageSize"]);t!==void 0&&i!=null&&w(t,["_query","pageSize"],i);let r=v(e,["pageToken"]);t!==void 0&&r!=null&&w(t,["_query","pageToken"],r);let o=v(e,["filter"]);t!==void 0&&o!=null&&w(t,["_query","filter"],o);let l=v(e,["queryBase"]);return t!==void 0&&l!=null&&w(t,["_url","models_url"],H$(s,l)),n}function BW(s,e){let t={},n=v(e,["config"]);return n!=null&&$W(s,n,t),t}function VW(s,e){let t={},n=v(e,["config"]);return n!=null&&UW(s,n,t),t}function zW(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["nextPageToken"]);n!=null&&w(e,["nextPageToken"],n);let i=v(s,["_self"]);if(i!=null){let r=G$(i);Array.isArray(r)&&(r=r.map(o=>DT(o))),w(e,["models"],r)}return e}function HW(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["nextPageToken"]);n!=null&&w(e,["nextPageToken"],n);let i=v(s,["_self"]);if(i!=null){let r=G$(i);Array.isArray(r)&&(r=r.map(o=>kT(o))),w(e,["models"],r)}return e}function GW(s){let e={},t=v(s,["maskMode"]);t!=null&&w(e,["maskMode"],t);let n=v(s,["segmentationClasses"]);n!=null&&w(e,["maskClasses"],n);let i=v(s,["maskDilation"]);return i!=null&&w(e,["dilation"],i),e}function DT(s){let e={},t=v(s,["name"]);t!=null&&w(e,["name"],t);let n=v(s,["displayName"]);n!=null&&w(e,["displayName"],n);let i=v(s,["description"]);i!=null&&w(e,["description"],i);let r=v(s,["version"]);r!=null&&w(e,["version"],r);let o=v(s,["_self"]);o!=null&&w(e,["tunedModelInfo"],oq(o));let l=v(s,["inputTokenLimit"]);l!=null&&w(e,["inputTokenLimit"],l);let u=v(s,["outputTokenLimit"]);u!=null&&w(e,["outputTokenLimit"],u);let h=v(s,["supportedGenerationMethods"]);h!=null&&w(e,["supportedActions"],h);let d=v(s,["temperature"]);d!=null&&w(e,["temperature"],d);let c=v(s,["maxTemperature"]);c!=null&&w(e,["maxTemperature"],c);let a=v(s,["topP"]);a!=null&&w(e,["topP"],a);let f=v(s,["topK"]);f!=null&&w(e,["topK"],f);let p=v(s,["thinking"]);return p!=null&&w(e,["thinking"],p),e}function kT(s){let e={},t=v(s,["name"]);t!=null&&w(e,["name"],t);let n=v(s,["displayName"]);n!=null&&w(e,["displayName"],n);let i=v(s,["description"]);i!=null&&w(e,["description"],i);let r=v(s,["versionId"]);r!=null&&w(e,["version"],r);let o=v(s,["deployedModels"]);if(o!=null){let c=o;Array.isArray(c)&&(c=c.map(a=>sW(a))),w(e,["endpoints"],c)}let l=v(s,["labels"]);l!=null&&w(e,["labels"],l);let u=v(s,["_self"]);u!=null&&w(e,["tunedModelInfo"],aq(u));let h=v(s,["defaultCheckpointId"]);h!=null&&w(e,["defaultCheckpointId"],h);let d=v(s,["checkpoints"]);if(d!=null){let c=d;Array.isArray(c)&&(c=c.map(a=>a)),w(e,["checkpoints"],c)}return e}function jW(s){let e={},t=v(s,["mediaResolution"]);t!=null&&w(e,["mediaResolution"],t);let n=v(s,["codeExecutionResult"]);n!=null&&w(e,["codeExecutionResult"],n);let i=v(s,["executableCode"]);i!=null&&w(e,["executableCode"],i);let r=v(s,["fileData"]);r!=null&&w(e,["fileData"],iW(r));let o=v(s,["functionCall"]);o!=null&&w(e,["functionCall"],rW(o));let l=v(s,["functionResponse"]);l!=null&&w(e,["functionResponse"],l);let u=v(s,["inlineData"]);u!=null&&w(e,["inlineData"],kj(u));let h=v(s,["text"]);h!=null&&w(e,["text"],h);let d=v(s,["thought"]);d!=null&&w(e,["thought"],d);let c=v(s,["thoughtSignature"]);c!=null&&w(e,["thoughtSignature"],c);let a=v(s,["videoMetadata"]);return a!=null&&w(e,["videoMetadata"],a),e}function WW(s){let e={},t=v(s,["productImage"]);return t!=null&&w(e,["image"],ui(t)),e}function qW(s,e){let t={},n=v(s,["numberOfImages"]);e!==void 0&&n!=null&&w(e,["parameters","sampleCount"],n);let i=v(s,["baseSteps"]);e!==void 0&&i!=null&&w(e,["parameters","baseSteps"],i);let r=v(s,["outputGcsUri"]);e!==void 0&&r!=null&&w(e,["parameters","storageUri"],r);let o=v(s,["seed"]);e!==void 0&&o!=null&&w(e,["parameters","seed"],o);let l=v(s,["safetyFilterLevel"]);e!==void 0&&l!=null&&w(e,["parameters","safetySetting"],l);let u=v(s,["personGeneration"]);e!==void 0&&u!=null&&w(e,["parameters","personGeneration"],u);let h=v(s,["addWatermark"]);e!==void 0&&h!=null&&w(e,["parameters","addWatermark"],h);let d=v(s,["outputMimeType"]);e!==void 0&&d!=null&&w(e,["parameters","outputOptions","mimeType"],d);let c=v(s,["outputCompressionQuality"]);e!==void 0&&c!=null&&w(e,["parameters","outputOptions","compressionQuality"],c);let a=v(s,["enhancePrompt"]);e!==void 0&&a!=null&&w(e,["parameters","enhancePrompt"],a);let f=v(s,["labels"]);return e!==void 0&&f!=null&&w(e,["labels"],f),t}function YW(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["source"]);i!=null&&XW(i,t);let r=v(e,["config"]);return r!=null&&qW(r,t),t}function KW(s){let e={},t=v(s,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(i=>cv(i))),w(e,["generatedImages"],n)}return e}function XW(s,e){let t={},n=v(s,["prompt"]);e!==void 0&&n!=null&&w(e,["instances[0]","prompt"],n);let i=v(s,["personImage"]);e!==void 0&&i!=null&&w(e,["instances[0]","personImage","image"],ui(i));let r=v(s,["productImages"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>WW(l))),w(e,["instances[0]","productImages"],o)}return t}function JW(s){let e={},t=v(s,["referenceImage"]);t!=null&&w(e,["referenceImage"],ui(t));let n=v(s,["referenceId"]);n!=null&&w(e,["referenceId"],n);let i=v(s,["referenceType"]);i!=null&&w(e,["referenceType"],i);let r=v(s,["maskImageConfig"]);r!=null&&w(e,["maskImageConfig"],GW(r));let o=v(s,["controlImageConfig"]);o!=null&&w(e,["controlImageConfig"],Lj(o));let l=v(s,["styleImageConfig"]);l!=null&&w(e,["styleImageConfig"],l);let u=v(s,["subjectImageConfig"]);return u!=null&&w(e,["subjectImageConfig"],u),e}function J$(s){let e={},t=v(s,["safetyAttributes","categories"]);t!=null&&w(e,["categories"],t);let n=v(s,["safetyAttributes","scores"]);n!=null&&w(e,["scores"],n);let i=v(s,["contentType"]);return i!=null&&w(e,["contentType"],i),e}function Z$(s){let e={},t=v(s,["safetyAttributes","categories"]);t!=null&&w(e,["categories"],t);let n=v(s,["safetyAttributes","scores"]);n!=null&&w(e,["scores"],n);let i=v(s,["contentType"]);return i!=null&&w(e,["contentType"],i),e}function ZW(s){let e={},t=v(s,["category"]);if(t!=null&&w(e,["category"],t),v(s,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=v(s,["threshold"]);return n!=null&&w(e,["threshold"],n),e}function QW(s){let e={},t=v(s,["image"]);return t!=null&&w(e,["image"],ui(t)),e}function eq(s,e){let t={},n=v(s,["mode"]);e!==void 0&&n!=null&&w(e,["parameters","mode"],n);let i=v(s,["maxPredictions"]);e!==void 0&&i!=null&&w(e,["parameters","maxPredictions"],i);let r=v(s,["confidenceThreshold"]);e!==void 0&&r!=null&&w(e,["parameters","confidenceThreshold"],r);let o=v(s,["maskDilation"]);e!==void 0&&o!=null&&w(e,["parameters","maskDilation"],o);let l=v(s,["binaryColorThreshold"]);e!==void 0&&l!=null&&w(e,["parameters","binaryColorThreshold"],l);let u=v(s,["labels"]);return e!==void 0&&u!=null&&w(e,["labels"],u),t}function tq(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["source"]);i!=null&&sq(i,t);let r=v(e,["config"]);return r!=null&&eq(r,t),t}function nq(s){let e={},t=v(s,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(i=>CW(i))),w(e,["generatedMasks"],n)}return e}function sq(s,e){let t={},n=v(s,["prompt"]);e!==void 0&&n!=null&&w(e,["instances[0]","prompt"],n);let i=v(s,["image"]);e!==void 0&&i!=null&&w(e,["instances[0]","image"],ui(i));let r=v(s,["scribbleImage"]);return e!==void 0&&r!=null&&w(e,["instances[0]","scribble"],QW(r)),t}function iq(s){let e={},t=v(s,["functionCallingConfig"]);t!=null&&w(e,["functionCallingConfig"],oW(t));let n=v(s,["retrievalConfig"]);return n!=null&&w(e,["retrievalConfig"],n),e}function rq(s){let e={},t=v(s,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(c=>c)),w(e,["functionDeclarations"],d)}if(v(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=v(s,["googleSearchRetrieval"]);n!=null&&w(e,["googleSearchRetrieval"],n);let i=v(s,["computerUse"]);i!=null&&w(e,["computerUse"],i);let r=v(s,["fileSearch"]);r!=null&&w(e,["fileSearch"],r);let o=v(s,["codeExecution"]);if(o!=null&&w(e,["codeExecution"],o),v(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=v(s,["googleMaps"]);l!=null&&w(e,["googleMaps"],MW(l));let u=v(s,["googleSearch"]);u!=null&&w(e,["googleSearch"],NW(u));let h=v(s,["urlContext"]);return h!=null&&w(e,["urlContext"],h),e}function Q$(s){let e={},t=v(s,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(a=>aW(a))),w(e,["functionDeclarations"],c)}let n=v(s,["retrieval"]);n!=null&&w(e,["retrieval"],n);let i=v(s,["googleSearchRetrieval"]);i!=null&&w(e,["googleSearchRetrieval"],i);let r=v(s,["computerUse"]);if(r!=null&&w(e,["computerUse"],r),v(s,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=v(s,["codeExecution"]);o!=null&&w(e,["codeExecution"],o);let l=v(s,["enterpriseWebSearch"]);l!=null&&w(e,["enterpriseWebSearch"],l);let u=v(s,["googleMaps"]);u!=null&&w(e,["googleMaps"],u);let h=v(s,["googleSearch"]);h!=null&&w(e,["googleSearch"],h);let d=v(s,["urlContext"]);return d!=null&&w(e,["urlContext"],d),e}function oq(s){let e={},t=v(s,["baseModel"]);t!=null&&w(e,["baseModel"],t);let n=v(s,["createTime"]);n!=null&&w(e,["createTime"],n);let i=v(s,["updateTime"]);return i!=null&&w(e,["updateTime"],i),e}function aq(s){let e={},t=v(s,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&w(e,["baseModel"],t);let n=v(s,["createTime"]);n!=null&&w(e,["createTime"],n);let i=v(s,["updateTime"]);return i!=null&&w(e,["updateTime"],i),e}function lq(s,e){let t={},n=v(s,["displayName"]);e!==void 0&&n!=null&&w(e,["displayName"],n);let i=v(s,["description"]);e!==void 0&&i!=null&&w(e,["description"],i);let r=v(s,["defaultCheckpointId"]);return e!==void 0&&r!=null&&w(e,["defaultCheckpointId"],r),t}function cq(s,e){let t={},n=v(s,["displayName"]);e!==void 0&&n!=null&&w(e,["displayName"],n);let i=v(s,["description"]);e!==void 0&&i!=null&&w(e,["description"],i);let r=v(s,["defaultCheckpointId"]);return e!==void 0&&r!=null&&w(e,["defaultCheckpointId"],r),t}function uq(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","name"],lt(s,n));let i=v(e,["config"]);return i!=null&&lq(i,t),t}function dq(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["config"]);return i!=null&&cq(i,t),t}function hq(s,e){let t={},n=v(s,["outputGcsUri"]);e!==void 0&&n!=null&&w(e,["parameters","storageUri"],n);let i=v(s,["safetyFilterLevel"]);e!==void 0&&i!=null&&w(e,["parameters","safetySetting"],i);let r=v(s,["personGeneration"]);e!==void 0&&r!=null&&w(e,["parameters","personGeneration"],r);let o=v(s,["includeRaiReason"]);e!==void 0&&o!=null&&w(e,["parameters","includeRaiReason"],o);let l=v(s,["outputMimeType"]);e!==void 0&&l!=null&&w(e,["parameters","outputOptions","mimeType"],l);let u=v(s,["outputCompressionQuality"]);e!==void 0&&u!=null&&w(e,["parameters","outputOptions","compressionQuality"],u);let h=v(s,["enhanceInputImage"]);e!==void 0&&h!=null&&w(e,["parameters","upscaleConfig","enhanceInputImage"],h);let d=v(s,["imagePreservationFactor"]);e!==void 0&&d!=null&&w(e,["parameters","upscaleConfig","imagePreservationFactor"],d);let c=v(s,["labels"]);e!==void 0&&c!=null&&w(e,["labels"],c);let a=v(s,["numberOfImages"]);e!==void 0&&a!=null&&w(e,["parameters","sampleCount"],a);let f=v(s,["mode"]);return e!==void 0&&f!=null&&w(e,["parameters","mode"],f),t}function fq(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["_url","model"],lt(s,n));let i=v(e,["image"]);i!=null&&w(t,["instances[0]","image"],ui(i));let r=v(e,["upscaleFactor"]);r!=null&&w(t,["parameters","upscaleConfig","upscaleFactor"],r);let o=v(e,["config"]);return o!=null&&hq(o,t),t}function pq(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>cv(r))),w(e,["generatedImages"],i)}return e}function gq(s){let e={},t=v(s,["uri"]);t!=null&&w(e,["uri"],t);let n=v(s,["encodedVideo"]);n!=null&&w(e,["videoBytes"],ko(n));let i=v(s,["encoding"]);return i!=null&&w(e,["mimeType"],i),e}function mq(s){let e={},t=v(s,["gcsUri"]);t!=null&&w(e,["uri"],t);let n=v(s,["bytesBase64Encoded"]);n!=null&&w(e,["videoBytes"],ko(n));let i=v(s,["mimeType"]);return i!=null&&w(e,["mimeType"],i),e}function yq(s){let e={},t=v(s,["image"]);t!=null&&w(e,["_self"],ui(t));let n=v(s,["maskMode"]);return n!=null&&w(e,["maskMode"],n),e}function bq(s){let e={},t=v(s,["image"]);t!=null&&w(e,["image"],uv(t));let n=v(s,["referenceType"]);return n!=null&&w(e,["referenceType"],n),e}function vq(s){let e={},t=v(s,["image"]);t!=null&&w(e,["image"],ui(t));let n=v(s,["referenceType"]);return n!=null&&w(e,["referenceType"],n),e}function eU(s){let e={},t=v(s,["uri"]);t!=null&&w(e,["uri"],t);let n=v(s,["videoBytes"]);n!=null&&w(e,["encodedVideo"],ko(n));let i=v(s,["mimeType"]);return i!=null&&w(e,["encoding"],i),e}function tU(s){let e={},t=v(s,["uri"]);t!=null&&w(e,["gcsUri"],t);let n=v(s,["videoBytes"]);n!=null&&w(e,["bytesBase64Encoded"],ko(n));let i=v(s,["mimeType"]);return i!=null&&w(e,["mimeType"],i),e}function _q(s,e){let t={},n=v(s,["displayName"]);return e!==void 0&&n!=null&&w(e,["displayName"],n),t}function wq(s){let e={},t=v(s,["config"]);return t!=null&&_q(t,e),e}function xq(s,e){let t={},n=v(s,["force"]);return e!==void 0&&n!=null&&w(e,["_query","force"],n),t}function Eq(s){let e={},t=v(s,["name"]);t!=null&&w(e,["_url","name"],t);let n=v(s,["config"]);return n!=null&&xq(n,e),e}function Sq(s){let e={},t=v(s,["name"]);return t!=null&&w(e,["_url","name"],t),e}function Tq(s,e){let t={},n=v(s,["customMetadata"]);if(e!==void 0&&n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),w(e,["customMetadata"],r)}let i=v(s,["chunkingConfig"]);return e!==void 0&&i!=null&&w(e,["chunkingConfig"],i),t}function Aq(s){let e={},t=v(s,["name"]);t!=null&&w(e,["name"],t);let n=v(s,["metadata"]);n!=null&&w(e,["metadata"],n);let i=v(s,["done"]);i!=null&&w(e,["done"],i);let r=v(s,["error"]);r!=null&&w(e,["error"],r);let o=v(s,["response"]);return o!=null&&w(e,["response"],Iq(o)),e}function Cq(s){let e={},t=v(s,["fileSearchStoreName"]);t!=null&&w(e,["_url","file_search_store_name"],t);let n=v(s,["fileName"]);n!=null&&w(e,["fileName"],n);let i=v(s,["config"]);return i!=null&&Tq(i,e),e}function Iq(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["parent"]);n!=null&&w(e,["parent"],n);let i=v(s,["documentName"]);return i!=null&&w(e,["documentName"],i),e}function Dq(s,e){let t={},n=v(s,["pageSize"]);e!==void 0&&n!=null&&w(e,["_query","pageSize"],n);let i=v(s,["pageToken"]);return e!==void 0&&i!=null&&w(e,["_query","pageToken"],i),t}function kq(s){let e={},t=v(s,["config"]);return t!=null&&Dq(t,e),e}function Rq(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["nextPageToken"]);n!=null&&w(e,["nextPageToken"],n);let i=v(s,["fileSearchStores"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),w(e,["fileSearchStores"],r)}return e}function nU(s,e){let t={},n=v(s,["mimeType"]);e!==void 0&&n!=null&&w(e,["mimeType"],n);let i=v(s,["displayName"]);e!==void 0&&i!=null&&w(e,["displayName"],i);let r=v(s,["customMetadata"]);if(e!==void 0&&r!=null){let l=r;Array.isArray(l)&&(l=l.map(u=>u)),w(e,["customMetadata"],l)}let o=v(s,["chunkingConfig"]);return e!==void 0&&o!=null&&w(e,["chunkingConfig"],o),t}function Pq(s){let e={},t=v(s,["fileSearchStoreName"]);t!=null&&w(e,["_url","file_search_store_name"],t);let n=v(s,["config"]);return n!=null&&nU(n,e),e}function Mq(s){let e={},t=v(s,["sdkHttpResponse"]);return t!=null&&w(e,["sdkHttpResponse"],t),e}var Nq="Content-Type",Oq="X-Server-Timeout",Fq="User-Agent",RT="x-goog-api-client",Lq="1.34.0",$q=`google-genai-sdk/${Lq}`,Uq="v1beta1",Bq="v1beta",PT=class{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:Uq,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Bq,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let i=[this.getRequestUrlInternal(t)];return n&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[o,l]of Object.entries(e.queryParams))i.searchParams.append(o,String(l));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,i.toString(),e.abortSignal),this.unaryApiCall(i,r,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[i,r]of Object.entries(t))typeof r=="object"?n[i]=Object.assign(Object.assign({},n[i]),r):r!==void 0&&(n[i]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,i.toString(),e.abortSignal),this.streamApiCall(i,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,i){if(t&&t.timeout||i){let r=new AbortController,o=r.signal;if(t.timeout&&t?.timeout>0){let l=setTimeout(()=>r.abort(),t.timeout);l&&typeof l.unref=="function"&&l.unref()}i&&i.addEventListener("abort",()=>{r.abort()}),e.signal=o}return t&&t.extraBody!==null&&Vq(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async i=>(await w$(i),new kf(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async i=>(await w$(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){return ai(this,arguments,function*(){var n;let i=(n=e?.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let o="",l="data:",u=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:h,value:d}=yield Me(i.read());if(h){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let c=r.decode(d,{stream:!0});try{let p=JSON.parse(c);if("error"in p){let g=JSON.parse(JSON.stringify(p.error)),m=g.status,y=g.code,_=`got status: ${m}. ${JSON.stringify(p)}`;if(y>=400&&y<600)throw new jb({message:_,status:y})}}catch(p){if(p.name==="ApiError")throw p}o+=c;let a=-1,f=0;for(;;){a=-1,f=0;for(let m of u){let y=o.indexOf(m);y!==-1&&(a===-1||y<a)&&(a=y,f=m.length)}if(a===-1)break;let p=o.substring(0,a);o=o.substring(a+f);let g=p.trim();if(g.startsWith(l)){let m=g.substring(l.length).trim();try{let y=new Response(m,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield Me(new kf(y))}catch(y){throw new Error(`exception parsing stream chunk ${m}. ${y}`)}}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){let e={},t=$q+" "+this.clientOptions.userAgentExtra;return e[Fq]=t,e[RT]=t,e[Nq]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[i,r]of Object.entries(e.headers))n.append(i,r);e.timeout&&e.timeout>0&&n.append(Oq,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(t=n.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),n}async uploadFile(e,t){var n;let i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);let r=this.clientOptions.uploader,o=await r.stat(e);i.sizeBytes=String(o.size);let l=(n=t?.mimeType)!==null&&n!==void 0?n:o.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=l;let u={file:i},h=this.getFileName(e),d=fe("upload/v1beta/files",u._url),c=await this.fetchUploadUrl(d,i.sizeBytes,i.mimeType,h,u,t?.httpOptions);return r.upload(e,c,this)}async uploadFileToFileSearchStore(e,t,n){var i;let r=this.clientOptions.uploader,o=await r.stat(t),l=String(o.size),u=(i=n?.mimeType)!==null&&i!==void 0?i:o.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let h=`upload/v1beta/${e}:uploadToFileSearchStore`,d=this.getFileName(t),c={};n!=null&&nU(n,c);let a=await this.fetchUploadUrl(h,l,u,d,c,n?.httpOptions);return r.uploadToFileSearchStore(t,a,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,i,r,o){var l;let u={};o?u=o:u={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},i?{"X-Goog-Upload-File-Name":i}:{})};let h=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:u});if(!h||!h?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let d=(l=h?.headers)===null||l===void 0?void 0:l["x-goog-upload-url"];if(d===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return d}};async function w$(s){var e;if(s===void 0)throw new Error("response is undefined");if(!s.ok){let t=s.status,n;!((e=s.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await s.json():n={error:{message:await s.text(),code:s.status,status:s.statusText}};let i=JSON.stringify(n);throw t>=400&&t<600?new jb({message:i,status:t}):new Error(i)}}function Vq(s,e){if(!e||Object.keys(e).length===0)return;if(s.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof s.body=="string"&&s.body.length>0)try{let r=JSON.parse(s.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))t=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(r,o){let l=Object.assign({},r);for(let u in o)if(Object.prototype.hasOwnProperty.call(o,u)){let h=o[u],d=l[u];h&&typeof h=="object"&&!Array.isArray(h)&&d&&typeof d=="object"&&!Array.isArray(d)?l[u]=n(d,h):(d&&h&&typeof d!=typeof h&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${u}". Original type: ${typeof d}, New type: ${typeof h}. Overwriting.`),l[u]=h)}return l}let i=n(t,e);s.body=JSON.stringify(i)}var zq="mcp_used/unknown",Hq=!1;function sU(s){for(let e of s)if(Gq(e)||typeof e=="object"&&"inputSchema"in e)return!0;return Hq}function iU(s){var e;let t=(e=s[RT])!==null&&e!==void 0?e:"";s[RT]=(t+` ${zq}`).trimStart()}function Gq(s){return s!==null&&typeof s=="object"&&s instanceof MT}function jq(s){return ai(this,arguments,function*(t,n=100){let i,r=0;for(;r<n;){let o=yield Me(t.listTools({cursor:i}));for(let l of o.tools)yield yield Me(l),r++;if(!o.nextCursor)break;i=o.nextCursor}})}var MT=class s{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new s(e,t)}async initialize(){var e,t,n,i;if(this.mcpTools.length>0)return;let r={},o=[];for(let d of this.mcpClients)try{for(var l=!0,u=(t=void 0,li(jq(d))),h;h=await u.next(),e=h.done,!e;l=!0){i=h.value,l=!1;let c=i;o.push(c);let a=c.name;if(r[a])throw new Error(`Duplicate function name ${a} found in MCP tools. Please ensure function names are unique.`);r[a]=d}}catch(c){t={error:c}}finally{try{!l&&!e&&(n=u.return)&&await n.call(u)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),DG(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let i=this.functionNameToMcpClient[n.name],r;this.config.timeout&&(r={timeout:this.config.timeout});let o=await i.callTool({name:n.name,arguments:n.args},void 0,r);t.push({functionResponse:{name:n.name,response:o.isError?{error:o}:o}})}return t}};async function Wq(s,e,t){let n=new _T,i;t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data),Object.assign(n,i),e(n)}var NT=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let i=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),o=Yq(this.apiClient.getDefaultHeaders()),l=this.apiClient.getApiKey(),u=`${i}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${l}`,h=()=>{},d=new Promise(x=>{h=x}),c=e.callbacks,a=function(){h({})},f=this.apiClient,p={onopen:a,onmessage:x=>{Wq(f,c.onmessage,x)},onerror:(t=c?.onerror)!==null&&t!==void 0?t:function(x){},onclose:(n=c?.onclose)!==null&&n!==void 0?n:function(x){}},g=this.webSocketFactory.create(u,qq(o),p);g.connect(),await d;let _={setup:{model:lt(this.apiClient,e.model)}};return g.send(JSON.stringify(_)),new OT(g,this.apiClient)}},OT=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=wj(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=_j(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Iu.PLAY)}pause(){this.sendPlaybackControl(Iu.PAUSE)}stop(){this.sendPlaybackControl(Iu.STOP)}resetContext(){this.sendPlaybackControl(Iu.RESET_CONTEXT)}close(){this.conn.close()}};function qq(s){let e={};return s.forEach((t,n)=>{e[n]=t}),e}function Yq(s){let e=new Headers;for(let[t,n]of Object.entries(s))e.append(t,n);return e}var Kq="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Xq(s,e,t){let n=new vT,i;t.data instanceof Blob?i=await t.data.text():t.data instanceof ArrayBuffer?i=new TextDecoder().decode(t.data):i=t.data;let r=JSON.parse(i);if(s.isVertexAI()){let o=Sj(r);Object.assign(n,o)}else Object.assign(n,r);e(n)}var FT=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new NT(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,i,r,o,l;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let u=this.apiClient.getWebsocketBaseUrl(),h=this.apiClient.getApiVersion(),d,c=this.apiClient.getHeaders();e.config&&e.config.tools&&sU(e.config.tools)&&iU(c);let a=Qq(c);if(this.apiClient.isVertexAI())d=`${u}/ws/google.cloud.aiplatform.${h}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(a,d);else{let A=this.apiClient.getApiKey(),P="BidiGenerateContent",F="key";A?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),h!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),P="BidiGenerateContentConstrained",F="access_token"),d=`${u}/ws/google.ai.generativelanguage.${h}.GenerativeService.${P}?${F}=${A}`}let f=()=>{},p=new Promise(A=>{f=A}),g=e.callbacks,m=function(){var A;(A=g?.onopen)===null||A===void 0||A.call(g),f({})},y=this.apiClient,_={onopen:m,onmessage:A=>{Xq(y,g.onmessage,A)},onerror:(t=g?.onerror)!==null&&t!==void 0?t:function(A){},onclose:(n=g?.onclose)!==null&&n!==void 0?n:function(A){}},x=this.webSocketFactory.create(d,Zq(a),_);x.connect(),await p;let E=lt(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&E.startsWith("publishers/")){let A=this.apiClient.getProject(),P=this.apiClient.getLocation();E=`projects/${A}/locations/${P}/`+E}let S={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Rb.AUDIO]}:e.config.responseModalities=[Rb.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let T=(l=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&l!==void 0?l:[],C=[];for(let A of T)if(this.isCallableTool(A)){let P=A;C.push(await P.tool())}else C.push(A);C.length>0&&(e.config.tools=C);let I={model:E,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?S=vj(this.apiClient,I):S=bj(this.apiClient,I),delete S.config,x.send(JSON.stringify(S)),new LT(x,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},Jq={turnComplete:!0},LT=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=js(t.turns),e.isVertexAI()||(n=n.map(i=>lv(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(let r of n){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(Kq)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},Jq),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:Ej(e)}:t={realtimeInput:xj(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function Zq(s){let e={};return s.forEach((t,n)=>{e[n]=t}),e}function Qq(s){let e=new Headers;for(let[t,n]of Object.entries(s))e.append(t,n);return e}var x$=10;function E$(s){var e,t,n;if(!((e=s?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(let o of(t=s?.tools)!==null&&t!==void 0?t:[])if(ku(o)){i=!0;break}if(!i)return!0;let r=(n=s?.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function ku(s){return"callTool"in s&&typeof s.callTool=="function"}function e5(s){var e,t,n;return(n=(t=(e=s.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>ku(i)))!==null&&n!==void 0?n:!1}function S$(s){var e;let t=[];return!((e=s?.config)===null||e===void 0)&&e.tools&&s.config.tools.forEach((n,i)=>{if(ku(n))return;let r=n;r.functionDeclarations&&r.functionDeclarations.length>0&&t.push(i)}),t}function T$(s){var e;return!(!((e=s?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var $T=class extends ci{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,i,r,o,l;let u=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!e5(t)||E$(t.config))return await this.generateContentInternal(u);let h=S$(t);if(h.length>0){let g=h.map(m=>`tools[${m}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${g}.`)}let d,c,a=js(u.contents),f=(r=(i=(n=u.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&r!==void 0?r:x$,p=0;for(;p<f&&(d=await this.generateContentInternal(u),!(!d.functionCalls||d.functionCalls.length===0));){let g=d.candidates[0].content,m=[];for(let y of(l=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&l!==void 0?l:[])if(ku(y)){let x=await y.callTool(d.functionCalls);m.push(...x)}p++,c={role:"user",parts:m},u.contents=js(u.contents),u.contents.push(g),u.contents.push(c),T$(u.config)&&(a.push(g),a.push(c))}return T$(u.config)&&(d.automaticFunctionCallingHistory=a),d},this.generateContentStream=async t=>{var n,i,r,o,l;if(this.maybeMoveToResponseJsonSchem(t),E$(t.config)){let c=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(c)}let u=S$(t);if(u.length>0){let c=u.map(a=>`tools[${a}]`).join(", ");throw new Error(`Incompatible tools found at ${c}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let h=(r=(i=(n=t?.config)===null||n===void 0?void 0:n.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,d=(l=(o=t?.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||l===void 0?void 0:l.disable;if(h&&!d)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var i;let r,o=[];if(n?.generatedImages)for(let u of n.generatedImages)u&&u?.safetyAttributes&&((i=u?.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?r=u?.safetyAttributes:o.push(u);let l;return r?l={generatedImages:o,positivePromptSafetyAttributes:r,sdkHttpResponse:n.sdkHttpResponse}:l={generatedImages:o,sdkHttpResponse:n.sdkHttpResponse},l}),this.list=async t=>{var n;let o={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((n=o.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new kr(Dr.PAGED_ITEM_MODELS,l=>this.listInternal(l),await this.listInternal(o),o)},this.editImage=async t=>{let n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));let i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(i)},this.generateVideos=async t=>{var n,i,r,o,l,u;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=t.video)===null||n===void 0)&&n.uri&&(!((i=t.video)===null||i===void 0)&&i.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((o=(r=t.source)===null||r===void 0?void 0:r.video)===null||o===void 0)&&o.uri&&(!((u=(l=t.source)===null||l===void 0?void 0:l.video)===null||u===void 0)&&u.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,i;let r=(t=e.config)===null||t===void 0?void 0:t.tools;if(!r)return e;let o=await Promise.all(r.map(async u=>ku(u)?await u.tool():u)),l={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(l.config.tools=o,e.config&&e.config.tools&&sU(e.config.tools)){let u=(i=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&i!==void 0?i:{},h=Object.assign({},u);Object.keys(h).length===0&&(h=this.apiClient.getDefaultHeaders()),iU(h),l.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:h})}return l}async initAfcToolsMap(e){var t,n,i;let r=new Map;for(let o of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(ku(o)){let l=o,u=await l.tool();for(let h of(i=u.functionDeclarations)!==null&&i!==void 0?i:[]){if(!h.name)throw new Error("Function declaration name is required.");if(r.has(h.name))throw new Error(`Duplicate tool declaration name: ${h.name}`);r.set(h.name,l)}}return r}async processAfcStream(e){var t,n,i;let r=(i=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&i!==void 0?i:x$,o=!1,l=0,u=await this.initAfcToolsMap(e);return function(h,d,c){return ai(this,arguments,function*(){for(var a,f,p,g,m,y;l<r;){o&&(l++,o=!1);let S=yield Me(h.processParamsMaybeAddMcpUsage(c)),T=yield Me(h.generateContentStreamInternal(S)),C=[],I=[];try{for(var _=!0,x=(f=void 0,li(T)),E;E=yield Me(x.next()),a=E.done,!a;_=!0){g=E.value,_=!1;let A=g;if(yield yield Me(A),A.candidates&&(!((m=A.candidates[0])===null||m===void 0)&&m.content)){I.push(A.candidates[0].content);for(let P of(y=A.candidates[0].content.parts)!==null&&y!==void 0?y:[])if(l<r&&P.functionCall){if(!P.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(P.functionCall.name)){let F=yield Me(d.get(P.functionCall.name).callTool([P.functionCall]));C.push(...F)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${P.functionCall.name}`)}}}}catch(A){f={error:A}}finally{try{!_&&!a&&(p=x.return)&&(yield Me(p.call(x)))}finally{if(f)throw f.error}}if(C.length>0){o=!0;let A=new sl;A.candidates=[{content:{role:"user",parts:C}}],yield yield Me(A);let P=[];P.push(...I),P.push({role:"user",parts:C});let F=js(c.contents).concat(P);c.contents=F}else break}})}(this,u,e)}async generateContentInternal(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=b$(this.apiClient,e);return l=fe("{model}:generateContent",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=_$(d),a=new sl;return Object.assign(a,c),a})}else{let h=y$(this.apiClient,e);return l=fe("{model}:generateContent",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=v$(d),a=new sl;return Object.assign(a,c),a})}}async generateContentStreamInternal(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=b$(this.apiClient,e);return l=fe("{model}:streamGenerateContent?alt=sse",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.requestStream({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),o.then(function(c){return ai(this,arguments,function*(){var a,f,p,g;try{for(var m=!0,y=li(c),_;_=yield Me(y.next()),a=_.done,!a;m=!0){g=_.value,m=!1;let x=g,E=_$(yield Me(x.json()));E.sdkHttpResponse={headers:x.headers};let S=new sl;Object.assign(S,E),yield yield Me(S)}}catch(x){f={error:x}}finally{try{!m&&!a&&(p=y.return)&&(yield Me(p.call(y)))}finally{if(f)throw f.error}}})})}else{let h=y$(this.apiClient,e);return l=fe("{model}:streamGenerateContent?alt=sse",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.requestStream({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),o.then(function(c){return ai(this,arguments,function*(){var a,f,p,g;try{for(var m=!0,y=li(c),_;_=yield Me(y.next()),a=_.done,!a;m=!0){g=_.value,m=!1;let x=g,E=v$(yield Me(x.json()));E.sdkHttpResponse={headers:x.headers};let S=new sl;Object.assign(S,E),yield yield Me(S)}}catch(x){f={error:x}}finally{try{!m&&!a&&(p=y.return)&&(yield Me(p.call(y)))}finally{if(f)throw f.error}}})})}}async embedContent(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=eW(this.apiClient,e);return l=fe("{model}:predict",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=nW(d),a=new Pb;return Object.assign(a,c),a})}else{let h=Qj(this.apiClient,e);return l=fe("{model}:batchEmbedContents",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=tW(d),a=new Pb;return Object.assign(a,c),a})}}async generateImagesInternal(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=fW(this.apiClient,e);return l=fe("{model}:predict",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=gW(d),a=new Mb;return Object.assign(a,c),a})}else{let h=hW(this.apiClient,e);return l=fe("{model}:predict",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=pW(d),a=new Mb;return Object.assign(a,c),a})}}async editImageInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){let l=Kj(this.apiClient,e);return r=fe("{model}:predict",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{let d=h;return d.sdkHttpResponse={headers:u.headers},d})),i.then(u=>{let h=Xj(u),d=new aT;return Object.assign(d,h),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){let l=fq(this.apiClient,e);return r=fe("{model}:predict",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{let d=h;return d.sdkHttpResponse={headers:u.headers},d})),i.then(u=>{let h=pq(u),d=new lT;return Object.assign(d,h),d})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){let l=YW(this.apiClient,e);return r=fe("{model}:predict",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i.then(u=>{let h=KW(u),d=new cT;return Object.assign(d,h),d})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){let l=tq(this.apiClient,e);return r=fe("{model}:predict",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i.then(u=>{let h=nq(u),d=new uT;return Object.assign(d,h),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=PW(this.apiClient,e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>kT(d))}else{let h=RW(this.apiClient,e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>DT(d))}}async listInternal(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=VW(this.apiClient,e);return l=fe("{models_url}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=HW(d),a=new Nb;return Object.assign(a,c),a})}else{let h=BW(this.apiClient,e);return l=fe("{models_url}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=zW(d),a=new Nb;return Object.assign(a,c),a})}}async update(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=dq(this.apiClient,e);return l=fe("{model}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>kT(d))}else{let h=uq(this.apiClient,e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>DT(d))}}async delete(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=jj(this.apiClient,e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=qj(d),a=new Ob;return Object.assign(a,c),a})}else{let h=Gj(this.apiClient,e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=Wj(d),a=new Ob;return Object.assign(a,c),a})}}async countTokens(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=Vj(this.apiClient,e);return l=fe("{model}:countTokens",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=Hj(d),a=new Fb;return Object.assign(a,c),a})}else{let h=Bj(this.apiClient,e);return l=fe("{model}:countTokens",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=zj(d),a=new Fb;return Object.assign(a,c),a})}}async computeTokens(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){let l=Mj(this.apiClient,e);return r=fe("{model}:computeTokens",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{let d=h;return d.sdkHttpResponse={headers:u.headers},d})),i.then(u=>{let h=Nj(u),d=new dT;return Object.assign(d,h),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=wW(this.apiClient,e);return l=fe("{model}:predictLongRunning",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>{let c=vW(d),a=new Lb;return Object.assign(a,c),a})}else{let h=_W(this.apiClient,e);return l=fe("{model}:predictLongRunning",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>{let c=bW(d),a=new Lb;return Object.assign(a,c),a})}}};var UT=class extends ci{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=t.name.split("/operations/")[0],r;n&&"httpOptions"in n&&(r=n.httpOptions);let o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=t.name.split("/operations/")[0],r;n&&"httpOptions"in n&&(r=n.httpOptions);let o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=mG(e);return l=fe("{operationName}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o}else{let h=gG(e);return l=fe("{operationName}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o}}async fetchPredictVideosOperationInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){let l=lG(e);return r=fe("{resourceName}:fetchPredictOperation",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}};function t5(s){let e={},t=v(s,["data"]);if(t!=null&&w(e,["data"],t),v(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=v(s,["mimeType"]);return n!=null&&w(e,["mimeType"],n),e}function n5(s){let e={},t=v(s,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>d5(r))),w(e,["parts"],i)}let n=v(s,["role"]);return n!=null&&w(e,["role"],n),e}function s5(s,e,t){let n={},i=v(e,["expireTime"]);t!==void 0&&i!=null&&w(t,["expireTime"],i);let r=v(e,["newSessionExpireTime"]);t!==void 0&&r!=null&&w(t,["newSessionExpireTime"],r);let o=v(e,["uses"]);t!==void 0&&o!=null&&w(t,["uses"],o);let l=v(e,["liveConnectConstraints"]);t!==void 0&&l!=null&&w(t,["bidiGenerateContentSetup"],u5(s,l));let u=v(e,["lockAdditionalFields"]);return t!==void 0&&u!=null&&w(t,["fieldMask"],u),n}function i5(s,e){let t={},n=v(e,["config"]);return n!=null&&w(t,["config"],s5(s,n,t)),t}function r5(s){let e={};if(v(s,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=v(s,["fileUri"]);t!=null&&w(e,["fileUri"],t);let n=v(s,["mimeType"]);return n!=null&&w(e,["mimeType"],n),e}function o5(s){let e={},t=v(s,["id"]);t!=null&&w(e,["id"],t);let n=v(s,["args"]);n!=null&&w(e,["args"],n);let i=v(s,["name"]);if(i!=null&&w(e,["name"],i),v(s,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(s,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function a5(s){let e={};if(v(s,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=v(s,["enableWidget"]);return t!=null&&w(e,["enableWidget"],t),e}function l5(s){let e={};if(v(s,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(s,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=v(s,["timeRangeFilter"]);return t!=null&&w(e,["timeRangeFilter"],t),e}function c5(s,e){let t={},n=v(s,["generationConfig"]);e!==void 0&&n!=null&&w(e,["setup","generationConfig"],n);let i=v(s,["responseModalities"]);e!==void 0&&i!=null&&w(e,["setup","generationConfig","responseModalities"],i);let r=v(s,["temperature"]);e!==void 0&&r!=null&&w(e,["setup","generationConfig","temperature"],r);let o=v(s,["topP"]);e!==void 0&&o!=null&&w(e,["setup","generationConfig","topP"],o);let l=v(s,["topK"]);e!==void 0&&l!=null&&w(e,["setup","generationConfig","topK"],l);let u=v(s,["maxOutputTokens"]);e!==void 0&&u!=null&&w(e,["setup","generationConfig","maxOutputTokens"],u);let h=v(s,["mediaResolution"]);e!==void 0&&h!=null&&w(e,["setup","generationConfig","mediaResolution"],h);let d=v(s,["seed"]);e!==void 0&&d!=null&&w(e,["setup","generationConfig","seed"],d);let c=v(s,["speechConfig"]);e!==void 0&&c!=null&&w(e,["setup","generationConfig","speechConfig"],aA(c));let a=v(s,["thinkingConfig"]);e!==void 0&&a!=null&&w(e,["setup","generationConfig","thinkingConfig"],a);let f=v(s,["enableAffectiveDialog"]);e!==void 0&&f!=null&&w(e,["setup","generationConfig","enableAffectiveDialog"],f);let p=v(s,["systemInstruction"]);e!==void 0&&p!=null&&w(e,["setup","systemInstruction"],n5(Fn(p)));let g=v(s,["tools"]);if(e!==void 0&&g!=null){let T=Nu(g);Array.isArray(T)&&(T=T.map(C=>f5(Mu(C)))),w(e,["setup","tools"],T)}let m=v(s,["sessionResumption"]);e!==void 0&&m!=null&&w(e,["setup","sessionResumption"],h5(m));let y=v(s,["inputAudioTranscription"]);e!==void 0&&y!=null&&w(e,["setup","inputAudioTranscription"],y);let _=v(s,["outputAudioTranscription"]);e!==void 0&&_!=null&&w(e,["setup","outputAudioTranscription"],_);let x=v(s,["realtimeInputConfig"]);e!==void 0&&x!=null&&w(e,["setup","realtimeInputConfig"],x);let E=v(s,["contextWindowCompression"]);e!==void 0&&E!=null&&w(e,["setup","contextWindowCompression"],E);let S=v(s,["proactivity"]);if(e!==void 0&&S!=null&&w(e,["setup","proactivity"],S),v(s,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function u5(s,e){let t={},n=v(e,["model"]);n!=null&&w(t,["setup","model"],lt(s,n));let i=v(e,["config"]);return i!=null&&w(t,["config"],c5(i,t)),t}function d5(s){let e={},t=v(s,["mediaResolution"]);t!=null&&w(e,["mediaResolution"],t);let n=v(s,["codeExecutionResult"]);n!=null&&w(e,["codeExecutionResult"],n);let i=v(s,["executableCode"]);i!=null&&w(e,["executableCode"],i);let r=v(s,["fileData"]);r!=null&&w(e,["fileData"],r5(r));let o=v(s,["functionCall"]);o!=null&&w(e,["functionCall"],o5(o));let l=v(s,["functionResponse"]);l!=null&&w(e,["functionResponse"],l);let u=v(s,["inlineData"]);u!=null&&w(e,["inlineData"],t5(u));let h=v(s,["text"]);h!=null&&w(e,["text"],h);let d=v(s,["thought"]);d!=null&&w(e,["thought"],d);let c=v(s,["thoughtSignature"]);c!=null&&w(e,["thoughtSignature"],c);let a=v(s,["videoMetadata"]);return a!=null&&w(e,["videoMetadata"],a),e}function h5(s){let e={},t=v(s,["handle"]);if(t!=null&&w(e,["handle"],t),v(s,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function f5(s){let e={},t=v(s,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(c=>c)),w(e,["functionDeclarations"],d)}if(v(s,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=v(s,["googleSearchRetrieval"]);n!=null&&w(e,["googleSearchRetrieval"],n);let i=v(s,["computerUse"]);i!=null&&w(e,["computerUse"],i);let r=v(s,["fileSearch"]);r!=null&&w(e,["fileSearch"],r);let o=v(s,["codeExecution"]);if(o!=null&&w(e,["codeExecution"],o),v(s,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=v(s,["googleMaps"]);l!=null&&w(e,["googleMaps"],a5(l));let u=v(s,["googleSearch"]);u!=null&&w(e,["googleSearch"],l5(u));let h=v(s,["urlContext"]);return h!=null&&w(e,["urlContext"],h),e}function p5(s){let e=[];for(let t in s)if(Object.prototype.hasOwnProperty.call(s,t)){let n=s[t];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){let i=Object.keys(n).map(r=>`${t}.${r}`);e.push(...i)}else e.push(t)}return e.join(",")}function g5(s,e){let t=null,n=s.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){let r=n.setup;typeof r=="object"&&r!==null?(s.bidiGenerateContentSetup=r,t=r):delete s.bidiGenerateContentSetup}else n!==void 0&&delete s.bidiGenerateContentSetup;let i=s.fieldMask;if(t){let r=p5(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)r?s.fieldMask=r:delete s.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){let o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],l=[];i.length>0&&(l=i.map(h=>o.includes(h)?`generationConfig.${h}`:h));let u=[];r&&u.push(r),l.length>0&&u.push(...l),u.length>0?s.fieldMask=u.join(","):delete s.fieldMask}else delete s.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?s.fieldMask=i.join(","):delete s.fieldMask;return s}var BT=class extends ci{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let l=i5(this.apiClient,e);r=fe("auth_tokens",l._url),o=l._query,delete l.config,delete l._url,delete l._query;let u=g5(l,e.config);return i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),i.then(h=>h)}}};function m5(s,e){let t={},n=v(s,["force"]);return e!==void 0&&n!=null&&w(e,["_query","force"],n),t}function y5(s){let e={},t=v(s,["name"]);t!=null&&w(e,["_url","name"],t);let n=v(s,["config"]);return n!=null&&m5(n,e),e}function b5(s){let e={},t=v(s,["name"]);return t!=null&&w(e,["_url","name"],t),e}function v5(s,e){let t={},n=v(s,["pageSize"]);e!==void 0&&n!=null&&w(e,["_query","pageSize"],n);let i=v(s,["pageToken"]);return e!==void 0&&i!=null&&w(e,["_query","pageToken"],i),t}function _5(s){let e={},t=v(s,["parent"]);t!=null&&w(e,["_url","parent"],t);let n=v(s,["config"]);return n!=null&&v5(n,e),e}function w5(s){let e={},t=v(s,["sdkHttpResponse"]);t!=null&&w(e,["sdkHttpResponse"],t);let n=v(s,["nextPageToken"]);n!=null&&w(e,["nextPageToken"],n);let i=v(s,["documents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),w(e,["documents"],r)}return e}var VT=class extends ci{constructor(e){super(),this.apiClient=e,this.list=async t=>new kr(Dr.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:t.parent,config:n.config}),await this.listInternal(t),t)}async get(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=b5(e);return r=fe("{name}",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i.then(u=>u)}}async delete(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let o=y5(e);i=fe("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=_5(e);return r=fe("{parent}/documents",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i.then(u=>{let h=w5(u),d=new hT;return Object.assign(d,h),d})}}};var zT=class extends ci{constructor(e,t=new VT(e)){super(),this.apiClient=e,this.documents=t,this.list=async(n={})=>new kr(Dr.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=wq(e);return r=fe("fileSearchStores",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i.then(u=>u)}}async get(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=Sq(e);return r=fe("{name}",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i.then(u=>u)}}async delete(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let o=Eq(e);i=fe("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=kq(e);return r=fe("fileSearchStores",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i.then(u=>{let h=Rq(u),d=new fT;return Object.assign(d,h),d})}}async uploadToFileSearchStoreInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=Pq(e);return r=fe("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i.then(u=>{let h=Mq(u),d=new pT;return Object.assign(d,h),d})}}async importFile(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=Cq(e);return r=fe("{file_search_store_name}:importFile",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),i.then(u=>{let h=Aq(u),d=new gT;return Object.assign(d,h),d})}}};var rU=function(){let{crypto:s}=globalThis;if(s?.randomUUID)return rU=s.randomUUID.bind(s),s.randomUUID();let e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))},x5=()=>rU();function HT(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}var GT=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){let e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch{}try{return new Error(JSON.stringify(s))}catch{}}return new Error(s)};var as=class extends Error{},ls=class s extends as{constructor(e,t,n,i){super(`${s.makeMessage(e,t,n)}`),this.status=e,this.headers=i,this.error=t}static makeMessage(e,t,n){let i=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,n,i){if(!e||!i)return new Ru({message:n,cause:GT(t)});let r=t;return e===400?new qb(e,r,n,i):e===401?new Yb(e,r,n,i):e===403?new Kb(e,r,n,i):e===404?new Xb(e,r,n,i):e===409?new Jb(e,r,n,i):e===422?new Zb(e,r,n,i):e===429?new Qb(e,r,n,i):e>=500?new ev(e,r,n,i):new s(e,r,n,i)}},Rf=class extends ls{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Ru=class extends ls{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Wb=class extends Ru{constructor({message:e}={}){super({message:e??"Request timed out."})}},qb=class extends ls{},Yb=class extends ls{},Kb=class extends ls{},Xb=class extends ls{},Jb=class extends ls{},Zb=class extends ls{},Qb=class extends ls{},ev=class extends ls{};var E5=/^[a-z][a-z0-9+.-]*:/i,S5=s=>E5.test(s),jT=s=>(jT=Array.isArray,jT(s)),T5=jT,A5=T5,A$=A5;function C5(s){if(!s)return!0;for(let e in s)return!1;return!0}function I5(s,e){return Object.prototype.hasOwnProperty.call(s,e)}var D5=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new as(`${s} must be an integer`);if(e<0)throw new as(`${s} must be a positive integer`);return e},k5=s=>{try{return JSON.parse(s)}catch{return}};var R5=s=>new Promise(e=>setTimeout(e,s));var Cu="0.0.1";function P5(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var M5=()=>{var s,e,t,n,i;let r=P5();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Cu,"X-Stainless-OS":I$(Deno.build.os),"X-Stainless-Arch":C$(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(s=Deno.version)===null||s===void 0?void 0:s.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Cu,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Cu,"X-Stainless-OS":I$((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":C$((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!==null&&i!==void 0?i:"unknown"};let o=N5();return o?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Cu,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${o.browser}`,"X-Stainless-Runtime-Version":o.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Cu,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function N5(){if(typeof navigator>"u"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of s){let n=t.exec(navigator.userAgent);if(n){let i=n[1]||0,r=n[2]||0,o=n[3]||0;return{browser:e,version:`${i}.${r}.${o}`}}}return null}var C$=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",I$=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),Sb,O5=()=>Sb??(Sb=M5());function F5(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function oU(...s){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function L5(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return oU({start(){},async pull(t){let{done:n,value:i}=await e.next();n?t.close():t.enqueue(i)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function aU(s){if(s[Symbol.asyncIterator])return s;let e=s.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function $5(s){var e,t;if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await((t=(e=s[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}let n=s.getReader(),i=n.cancel();n.releaseLock(),await i}var U5=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var lU=()=>{var s;if(typeof File>"u"){let{process:e}=globalThis,t=typeof((s=e?.versions)===null||s===void 0?void 0:s.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function sT(s,e,t){return lU(),new File(s,e??"unknown_file",t)}function B5(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}var V5=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function";var cU=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",z5=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&cU(s),H5=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function G5(s,e,t){if(lU(),s=await s,z5(s))return s instanceof File?s:sT([await s.arrayBuffer()],s.name);if(H5(s)){let i=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),sT(await WT(i),e,t)}let n=await WT(s);if(e||(e=B5(s)),!t?.type){let i=n.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof i=="string"&&(t=Object.assign(Object.assign({},t),{type:i}))}return sT(n,e,t)}async function WT(s){var e,t,n,i,r;let o=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)o.push(s);else if(cU(s))o.push(s instanceof Blob?s:await s.arrayBuffer());else if(V5(s))try{for(var l=!0,u=li(s),h;h=await u.next(),e=h.done,!e;l=!0){i=h.value,l=!1;let d=i;o.push(...await WT(d))}}catch(d){t={error:d}}finally{try{!l&&!e&&(n=u.return)&&await n.call(u)}finally{if(t)throw t.error}}else{let d=(r=s?.constructor)===null||r===void 0?void 0:r.name;throw new Error(`Unexpected data type: ${typeof s}${d?`; constructor: ${d}`:""}${j5(s)}`)}return o}function j5(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}var tv=class{constructor(e){this._client=e}};tv._key=[];function uU(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var D$=Object.freeze(Object.create(null)),W5=(s=uU)=>function(t,...n){if(t.length===1)return t[0];let i=!1,r=[],o=t.reduce((d,c,a)=>{var f,p,g;/[?#]/.test(c)&&(i=!0);let m=n[a],y=(i?encodeURIComponent:s)(""+m);return a!==n.length&&(m==null||typeof m=="object"&&m.toString===((g=Object.getPrototypeOf((p=Object.getPrototypeOf((f=m.hasOwnProperty)!==null&&f!==void 0?f:D$))!==null&&p!==void 0?p:D$))===null||g===void 0?void 0:g.toString))&&(y=m+"",r.push({start:d.length+c.length,length:y.length,error:`Value of type ${Object.prototype.toString.call(m).slice(8,-1)} is not a valid path parameter`})),d+c+(a===n.length?"":y)},""),l=o.split(/[?#]/,1)[0],u=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,h;for(;(h=u.exec(l))!==null;)r.push({start:h.index,length:h[0].length,error:`Value "${h[0]}" can't be safely passed as a path parameter`});if(r.sort((d,c)=>d.start-c.start),r.length>0){let d=0,c=r.reduce((a,f)=>{let p=" ".repeat(f.start-d),g="^".repeat(f.length);return d=f.start+f.length,a+p+g},"");throw new as(`Path parameters result in path with invalid segments:
${r.map(a=>a.error).join(`
`)}
${o}
${c}`)}return o},Tb=W5(uU);var nv=class extends tv{create(e,t){var n;let{api_version:i=this._client.apiVersion}=e,r=Gb(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new as("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new as("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Tb`/${i}/interactions`,Object.assign(Object.assign({body:r},t),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,t={},n){let{api_version:i=this._client.apiVersion}=t??{};return this._client.delete(Tb`/${i}/interactions/${e}`,n)}cancel(e,t={},n){let{api_version:i=this._client.apiVersion}=t??{};return this._client.post(Tb`/${i}/interactions/${e}/cancel`,n)}get(e,t={},n){var i;let r=t??{},{api_version:o=this._client.apiVersion}=r,l=Gb(r,["api_version"]);return this._client.get(Tb`/${o}/interactions/${e}`,Object.assign(Object.assign({query:l},n),{stream:(i=t?.stream)!==null&&i!==void 0?i:!1}))}};nv._key=Object.freeze(["interactions"]);var sv=class extends nv{};function q5(s){let e=0;for(let i of s)e+=i.length;let t=new Uint8Array(e),n=0;for(let i of s)t.set(i,n),n+=i.length;return t}var Ab;function lA(s){let e;return(Ab??(e=new globalThis.TextEncoder,Ab=e.encode.bind(e)))(s)}var Cb;function k$(s){let e;return(Cb??(e=new globalThis.TextDecoder,Cb=e.decode.bind(e)))(s)}var Pu=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?lA(e):e;this.buffer=q5([this.buffer,t]);let n=[],i;for(;(i=Y5(this.buffer,this.carriageReturnIndex))!=null;){if(i.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=i.index;continue}if(this.carriageReturnIndex!=null&&(i.index!==this.carriageReturnIndex+1||i.carriage)){n.push(k$(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let r=this.carriageReturnIndex!==null?i.preceding-1:i.preceding,o=k$(this.buffer.subarray(0,r));n.push(o),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}};Pu.NEWLINE_CHARS=new Set([`
`,"\r"]);Pu.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Y5(s,e){for(let i=e??0;i<s.length;i++){if(s[i]===10)return{preceding:i,index:i+1,carriage:!1};if(s[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function K5(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}var iv={off:0,error:200,warn:300,info:400,debug:500},R$=(s,e,t)=>{if(s){if(I5(iv,s))return s;Kn(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(iv))}`)}};function Df(){}function Ib(s,e,t){return!e||iv[s]>iv[t]?Df:e[s].bind(e)}var X5={error:Df,warn:Df,info:Df,debug:Df},P$=new WeakMap;function Kn(s){var e;let t=s.logger,n=(e=s.logLevel)!==null&&e!==void 0?e:"off";if(!t)return X5;let i=P$.get(t);if(i&&i[0]===n)return i[1];let r={error:Ib("error",t,n),warn:Ib("warn",t,n),info:Ib("info",t,n),debug:Ib("debug",t,n)};return P$.set(t,[n,r]),r}var nl=s=>(s.options&&(s.options=Object.assign({},s.options),delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var qT=class s{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let i=!1,r=n?Kn(n):console;function o(){return ai(this,arguments,function*(){var u,h,d,c;if(i)throw new as("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let a=!1;try{try{for(var f=!0,p=li(J5(e,t)),g;g=yield Me(p.next()),u=g.done,!u;f=!0){c=g.value,f=!1;let m=c;if(!a)if(m.data.startsWith("[DONE]")){a=!0;continue}else try{yield yield Me(JSON.parse(m.data))}catch(y){throw r.error("Could not parse message into JSON:",m.data),r.error("From chunk:",m.raw),y}}}catch(m){h={error:m}}finally{try{!f&&!u&&(d=p.return)&&(yield Me(d.call(p)))}finally{if(h)throw h.error}}a=!0}catch(m){if(HT(m))return yield Me(void 0);throw m}finally{a||t.abort()}})}return new s(o,t,n)}static fromReadableStream(e,t,n){let i=!1;function r(){return ai(this,arguments,function*(){var u,h,d,c;let a=new Pu,f=aU(e);try{for(var p=!0,g=li(f),m;m=yield Me(g.next()),u=m.done,!u;p=!0){c=m.value,p=!1;let y=c;for(let _ of a.decode(y))yield yield Me(_)}}catch(y){h={error:y}}finally{try{!p&&!u&&(d=g.return)&&(yield Me(d.call(g)))}finally{if(h)throw h.error}}for(let y of a.flush())yield yield Me(y)})}function o(){return ai(this,arguments,function*(){var u,h,d,c;if(i)throw new as("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let a=!1;try{try{for(var f=!0,p=li(r()),g;g=yield Me(p.next()),u=g.done,!u;f=!0){c=g.value,f=!1;let m=c;a||m&&(yield yield Me(JSON.parse(m)))}}catch(m){h={error:m}}finally{try{!f&&!u&&(d=p.return)&&(yield Me(d.call(p)))}finally{if(h)throw h.error}}a=!0}catch(m){if(HT(m))return yield Me(void 0);throw m}finally{a||t.abort()}})}return new s(o,t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),i=r=>({next:()=>{if(r.length===0){let o=n.next();e.push(o),t.push(o)}return r.shift()}});return[new s(()=>i(e),this.controller,this.client),new s(()=>i(t),this.controller,this.client)]}toReadableStream(){let e=this,t;return oU({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:i,done:r}=await t.next();if(r)return n.close();let o=lA(JSON.stringify(i)+`
`);n.enqueue(o)}catch(i){n.error(i)}},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}};function J5(s,e){return ai(this,arguments,function*(){var n,i,r,o;if(!s.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new as("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new as("Attempted to iterate over a response with no body");let l=new YT,u=new Pu,h=aU(s.body);try{for(var d=!0,c=li(Z5(h)),a;a=yield Me(c.next()),n=a.done,!n;d=!0){o=a.value,d=!1;let f=o;for(let p of u.decode(f)){let g=l.decode(p);g&&(yield yield Me(g))}}}catch(f){i={error:f}}finally{try{!d&&!n&&(r=c.return)&&(yield Me(r.call(c)))}finally{if(i)throw i.error}}for(let f of u.flush()){let p=l.decode(f);p&&(yield yield Me(p))}})}function Z5(s){return ai(this,arguments,function*(){var t,n,i,r;let o=new Uint8Array;try{for(var l=!0,u=li(s),h;h=yield Me(u.next()),t=h.done,!t;l=!0){r=h.value,l=!1;let d=r;if(d==null)continue;let c=d instanceof ArrayBuffer?new Uint8Array(d):typeof d=="string"?lA(d):d,a=new Uint8Array(o.length+c.length);a.set(o),a.set(c,o.length),o=a;let f;for(;(f=K5(o))!==-1;)yield yield Me(o.slice(0,f)),o=o.slice(f)}}catch(d){n={error:d}}finally{try{!l&&!t&&(i=u.return)&&(yield Me(i.call(u)))}finally{if(n)throw n.error}}o.length>0&&(yield yield Me(o))})}var YT=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,i]=Q5(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}};function Q5(s,e){let t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}async function e8(s,e){let{response:t,requestLogID:n,retryOfRequestLogID:i,startTime:r}=e,o=await(async()=>{var l;if(e.options.stream)return Kn(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,s):qT.fromSSEResponse(t,e.controller,s);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let u=t.headers.get("content-type"),h=(l=u?.split(";")[0])===null||l===void 0?void 0:l.trim();return h?.includes("application/json")||h?.endsWith("+json")?await t.json():await t.text()})();return Kn(s).debug(`[${n}] response parsed`,nl({retryOfRequestLogID:i,url:t.url,status:t.status,body:o,durationMs:Date.now()-r})),o}var KT=class s extends Promise{constructor(e,t,n=e8){super(i=>{i(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new s(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var dU=Symbol("brand.privateNullableHeaders");function*t8(s){if(!s)return;if(dU in s){let{values:n,nulls:i}=s;yield*n.entries();for(let r of i)yield[r,null];return}let e=!1,t;s instanceof Headers?t=s.entries():A$(s)?t=s:(e=!0,t=Object.entries(s??{}));for(let n of t){let i=n[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");let r=A$(n[1])?n[1]:[n[1]],o=!1;for(let l of r)l!==void 0&&(e&&!o&&(o=!0,yield[i,null]),yield[i,l])}}var If=s=>{let e=new Headers,t=new Set;for(let n of s){let i=new Set;for(let[r,o]of t8(n)){let l=r.toLowerCase();i.has(l)||(e.delete(r),i.add(l)),o===null?(e.delete(r),t.add(l)):(e.append(r,o),t.delete(l))}}return{[dU]:!0,values:e,nulls:t}};var iT=s=>{var e,t,n,i,r,o;if(typeof globalThis.process<"u")return(n=(t=(e=globalThis.process.env)===null||e===void 0?void 0:e[s])===null||t===void 0?void 0:t.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno<"u")return(o=(r=(i=globalThis.Deno.env)===null||i===void 0?void 0:i.get)===null||r===void 0?void 0:r.call(i,s))===null||o===void 0?void 0:o.trim()};var hU,rv=class s{constructor(e){var t,n,i,r,o,l,u,{baseURL:h=iT("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:d=(t=iT("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:c="v1beta"}=e,a=Gb(e,["baseURL","apiKey","apiVersion"]);let f=Object.assign(Object.assign({apiKey:d,apiVersion:c},a),{baseURL:h||"https://generativelanguage.googleapis.com"});this.baseURL=f.baseURL,this.timeout=(n=f.timeout)!==null&&n!==void 0?n:s.DEFAULT_TIMEOUT,this.logger=(i=f.logger)!==null&&i!==void 0?i:console;let p="warn";this.logLevel=p,this.logLevel=(o=(r=R$(f.logLevel,"ClientOptions.logLevel",this))!==null&&r!==void 0?r:R$(iT("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&o!==void 0?o:p,this.fetchOptions=f.fetchOptions,this.maxRetries=(l=f.maxRetries)!==null&&l!==void 0?l:2,this.fetch=(u=f.fetch)!==null&&u!==void 0?u:F5(),this.encoder=U5,this._options=f,this.apiKey=d,this.apiVersion=c,this.clientAdapter=f.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){let t=If([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return If([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return If([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new as(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Cu}`}defaultIdempotencyKey(){return`stainless-node-retry-${x5()}`}makeStatusError(e,t,n,i){return ls.generate(e,t,n,i)}buildURL(e,t,n){let i=!this.baseURLOverridden()&&n||this.baseURL,r=S5(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return C5(o)||(t=Object.assign(Object.assign({},o),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(i=>Object.assign({method:e,path:t},i)))}request(e,t=null){return new KT(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var i,r,o;let l=await e,u=(i=l.maxRetries)!==null&&i!==void 0?i:this.maxRetries;t==null&&(t=u),await this.prepareOptions(l);let{req:h,url:d,timeout:c}=await this.buildRequest(l,{retryCount:u-t});await this.prepareRequest(h,{url:d,options:l});let a="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),f=n===void 0?"":`, retryOf: ${n}`,p=Date.now();if(Kn(this).debug(`[${a}] sending request`,nl({retryOfRequestLogID:n,method:l.method,url:d,options:l,headers:h.headers})),!((r=l.signal)===null||r===void 0)&&r.aborted)throw new Rf;let g=new AbortController,m=await this.fetchWithTimeout(d,h,c,g).catch(GT),y=Date.now();if(m instanceof globalThis.Error){let x=`retrying, ${t} attempts remaining`;if(!((o=l.signal)===null||o===void 0)&&o.aborted)throw new Rf;let E=HT(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(t)return Kn(this).info(`[${a}] connection ${E?"timed out":"failed"} - ${x}`),Kn(this).debug(`[${a}] connection ${E?"timed out":"failed"} (${x})`,nl({retryOfRequestLogID:n,url:d,durationMs:y-p,message:m.message})),this.retryRequest(l,t,n??a);throw Kn(this).info(`[${a}] connection ${E?"timed out":"failed"} - error; no more retries left`),Kn(this).debug(`[${a}] connection ${E?"timed out":"failed"} (error; no more retries left)`,nl({retryOfRequestLogID:n,url:d,durationMs:y-p,message:m.message})),E?new Wb:new Ru({cause:m})}let _=`[${a}${f}] ${h.method} ${d} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${y-p}ms`;if(!m.ok){let x=await this.shouldRetry(m);if(t&&x){let A=`retrying, ${t} attempts remaining`;return await $5(m.body),Kn(this).info(`${_} - ${A}`),Kn(this).debug(`[${a}] response error (${A})`,nl({retryOfRequestLogID:n,url:m.url,status:m.status,headers:m.headers,durationMs:y-p})),this.retryRequest(l,t,n??a,m.headers)}let E=x?"error; no more retries left":"error; not retryable";Kn(this).info(`${_} - ${E}`);let S=await m.text().catch(A=>GT(A).message),T=k5(S),C=T?void 0:S;throw Kn(this).debug(`[${a}] response error (${E})`,nl({retryOfRequestLogID:n,url:m.url,status:m.status,headers:m.headers,message:C,durationMs:Date.now()-p})),this.makeStatusError(m.status,T,C,m.headers)}return Kn(this).info(_),Kn(this).debug(`[${a}] response start`,nl({retryOfRequestLogID:n,url:m.url,status:m.status,headers:m.headers,durationMs:y-p})),{response:m,options:l,controller:g,requestLogID:a,retryOfRequestLogID:n,startTime:p}}async fetchWithTimeout(e,t,n,i){let r=t||{},{signal:o,method:l}=r,u=Gb(r,["signal","method"]);o&&o.addEventListener("abort",()=>i.abort());let h=setTimeout(()=>i.abort(),n),d=globalThis.ReadableStream&&u.body instanceof globalThis.ReadableStream||typeof u.body=="object"&&u.body!==null&&Symbol.asyncIterator in u.body,c=Object.assign(Object.assign(Object.assign({signal:i.signal},d?{duplex:"half"}:{}),{method:"GET"}),u);l&&(c.method=l.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(h)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,i){var r;let o,l=i?.get("retry-after-ms");if(l){let h=parseFloat(l);Number.isNaN(h)||(o=h)}let u=i?.get("retry-after");if(u&&!o){let h=parseFloat(u);Number.isNaN(h)?o=Date.parse(u)-Date.now():o=h*1e3}if(!(o&&0<=o&&o<60*1e3)){let h=(r=e.maxRetries)!==null&&r!==void 0?r:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,h)}return await R5(o),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let r=t-e,o=Math.min(.5*Math.pow(2,r),8),l=1-Math.random()*.25;return o*l*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,i,r;let o=Object.assign({},e),{method:l,path:u,query:h,defaultBaseURL:d}=o,c=this.buildURL(u,h,d);"timeout"in o&&D5("timeout",o.timeout),o.timeout=(n=o.timeout)!==null&&n!==void 0?n:this.timeout;let{bodyHeaders:a,body:f}=this.buildBody({options:o}),p=await this.buildHeaders({options:e,method:l,bodyHeaders:a,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:l,headers:p},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"}),f&&{body:f}),(i=this.fetchOptions)!==null&&i!==void 0?i:{}),(r=o.fetchOptions)!==null&&r!==void 0?r:{}),url:c,timeout:o.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:i}){let r={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let o=await this.authHeaders(e),l=If([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),O5()),this._options.defaultHeaders,n,e.headers,o]);return this.validateHeaders(l),l.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=If([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:L5(e)}:this.encoder({body:e,headers:n})}};rv.DEFAULT_TIMEOUT=6e4;var Xt=class extends rv{constructor(){super(...arguments),this.interactions=new sv(this)}};hU=Xt;Xt.GeminiNextGenAPIClient=hU;Xt.GeminiNextGenAPIClientError=as;Xt.APIError=ls;Xt.APIConnectionError=Ru;Xt.APIConnectionTimeoutError=Wb;Xt.APIUserAbortError=Rf;Xt.NotFoundError=Xb;Xt.ConflictError=Jb;Xt.RateLimitError=Qb;Xt.BadRequestError=qb;Xt.AuthenticationError=Yb;Xt.InternalServerError=ev;Xt.PermissionDeniedError=Kb;Xt.UnprocessableEntityError=Zb;Xt.toFile=G5;Xt.Interactions=sv;function n8(s,e){let t={},n=v(s,["name"]);return n!=null&&w(t,["_url","name"],n),t}function s8(s,e){let t={},n=v(s,["name"]);return n!=null&&w(t,["_url","name"],n),t}function i8(s,e){let t={},n=v(s,["sdkHttpResponse"]);return n!=null&&w(t,["sdkHttpResponse"],n),t}function r8(s,e){let t={},n=v(s,["sdkHttpResponse"]);return n!=null&&w(t,["sdkHttpResponse"],n),t}function o8(s,e,t){let n={};if(v(s,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let i=v(s,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&w(e,["displayName"],i),v(s,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let r=v(s,["epochCount"]);e!==void 0&&r!=null&&w(e,["tuningTask","hyperparameters","epochCount"],r);let o=v(s,["learningRateMultiplier"]);if(o!=null&&w(n,["tuningTask","hyperparameters","learningRateMultiplier"],o),v(s,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(v(s,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(v(s,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let l=v(s,["batchSize"]);e!==void 0&&l!=null&&w(e,["tuningTask","hyperparameters","batchSize"],l);let u=v(s,["learningRate"]);if(e!==void 0&&u!=null&&w(e,["tuningTask","hyperparameters","learningRate"],u),v(s,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(v(s,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function a8(s,e,t){let n={},i=v(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let f=v(s,["validationDataset"]);e!==void 0&&f!=null&&w(e,["supervisedTuningSpec"],M$(f))}else if(i==="PREFERENCE_TUNING"){let f=v(s,["validationDataset"]);e!==void 0&&f!=null&&w(e,["preferenceOptimizationSpec"],M$(f))}let r=v(s,["tunedModelDisplayName"]);e!==void 0&&r!=null&&w(e,["tunedModelDisplayName"],r);let o=v(s,["description"]);e!==void 0&&o!=null&&w(e,["description"],o);let l=v(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){let f=v(s,["epochCount"]);e!==void 0&&f!=null&&w(e,["supervisedTuningSpec","hyperParameters","epochCount"],f)}else if(l==="PREFERENCE_TUNING"){let f=v(s,["epochCount"]);e!==void 0&&f!=null&&w(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],f)}let u=v(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){let f=v(s,["learningRateMultiplier"]);e!==void 0&&f!=null&&w(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],f)}else if(u==="PREFERENCE_TUNING"){let f=v(s,["learningRateMultiplier"]);e!==void 0&&f!=null&&w(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],f)}let h=v(t,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){let f=v(s,["exportLastCheckpointOnly"]);e!==void 0&&f!=null&&w(e,["supervisedTuningSpec","exportLastCheckpointOnly"],f)}else if(h==="PREFERENCE_TUNING"){let f=v(s,["exportLastCheckpointOnly"]);e!==void 0&&f!=null&&w(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],f)}let d=v(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){let f=v(s,["adapterSize"]);e!==void 0&&f!=null&&w(e,["supervisedTuningSpec","hyperParameters","adapterSize"],f)}else if(d==="PREFERENCE_TUNING"){let f=v(s,["adapterSize"]);e!==void 0&&f!=null&&w(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],f)}if(v(s,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(v(s,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let c=v(s,["labels"]);e!==void 0&&c!=null&&w(e,["labels"],c);let a=v(s,["beta"]);return e!==void 0&&a!=null&&w(e,["preferenceOptimizationSpec","hyperParameters","beta"],a),n}function l8(s,e){let t={},n=v(s,["baseModel"]);n!=null&&w(t,["baseModel"],n);let i=v(s,["preTunedModel"]);i!=null&&w(t,["preTunedModel"],i);let r=v(s,["trainingDataset"]);r!=null&&v8(r);let o=v(s,["config"]);return o!=null&&o8(o,t),t}function c8(s,e){let t={},n=v(s,["baseModel"]);n!=null&&w(t,["baseModel"],n);let i=v(s,["preTunedModel"]);i!=null&&w(t,["preTunedModel"],i);let r=v(s,["trainingDataset"]);r!=null&&_8(r,t,e);let o=v(s,["config"]);return o!=null&&a8(o,t,e),t}function u8(s,e){let t={},n=v(s,["name"]);return n!=null&&w(t,["_url","name"],n),t}function d8(s,e){let t={},n=v(s,["name"]);return n!=null&&w(t,["_url","name"],n),t}function h8(s,e,t){let n={},i=v(s,["pageSize"]);e!==void 0&&i!=null&&w(e,["_query","pageSize"],i);let r=v(s,["pageToken"]);e!==void 0&&r!=null&&w(e,["_query","pageToken"],r);let o=v(s,["filter"]);return e!==void 0&&o!=null&&w(e,["_query","filter"],o),n}function f8(s,e,t){let n={},i=v(s,["pageSize"]);e!==void 0&&i!=null&&w(e,["_query","pageSize"],i);let r=v(s,["pageToken"]);e!==void 0&&r!=null&&w(e,["_query","pageToken"],r);let o=v(s,["filter"]);return e!==void 0&&o!=null&&w(e,["_query","filter"],o),n}function p8(s,e){let t={},n=v(s,["config"]);return n!=null&&h8(n,t),t}function g8(s,e){let t={},n=v(s,["config"]);return n!=null&&f8(n,t),t}function m8(s,e){let t={},n=v(s,["sdkHttpResponse"]);n!=null&&w(t,["sdkHttpResponse"],n);let i=v(s,["nextPageToken"]);i!=null&&w(t,["nextPageToken"],i);let r=v(s,["tunedModels"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>fU(l))),w(t,["tuningJobs"],o)}return t}function y8(s,e){let t={},n=v(s,["sdkHttpResponse"]);n!=null&&w(t,["sdkHttpResponse"],n);let i=v(s,["nextPageToken"]);i!=null&&w(t,["nextPageToken"],i);let r=v(s,["tuningJobs"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>XT(l))),w(t,["tuningJobs"],o)}return t}function b8(s,e){let t={},n=v(s,["name"]);n!=null&&w(t,["model"],n);let i=v(s,["name"]);return i!=null&&w(t,["endpoint"],i),t}function v8(s,e){let t={};if(v(s,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(v(s,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=v(s,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>r)),w(t,["examples","examples"],i)}return t}function _8(s,e,t){let n={},i=v(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let o=v(s,["gcsUri"]);e!==void 0&&o!=null&&w(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(i==="PREFERENCE_TUNING"){let o=v(s,["gcsUri"]);e!==void 0&&o!=null&&w(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}let r=v(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){let o=v(s,["vertexDatasetResource"]);e!==void 0&&o!=null&&w(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(r==="PREFERENCE_TUNING"){let o=v(s,["vertexDatasetResource"]);e!==void 0&&o!=null&&w(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}if(v(s,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function fU(s,e){let t={},n=v(s,["sdkHttpResponse"]);n!=null&&w(t,["sdkHttpResponse"],n);let i=v(s,["name"]);i!=null&&w(t,["name"],i);let r=v(s,["state"]);r!=null&&w(t,["state"],V$(r));let o=v(s,["createTime"]);o!=null&&w(t,["createTime"],o);let l=v(s,["tuningTask","startTime"]);l!=null&&w(t,["startTime"],l);let u=v(s,["tuningTask","completeTime"]);u!=null&&w(t,["endTime"],u);let h=v(s,["updateTime"]);h!=null&&w(t,["updateTime"],h);let d=v(s,["description"]);d!=null&&w(t,["description"],d);let c=v(s,["baseModel"]);c!=null&&w(t,["baseModel"],c);let a=v(s,["_self"]);return a!=null&&w(t,["tunedModel"],b8(a)),t}function XT(s,e){let t={},n=v(s,["sdkHttpResponse"]);n!=null&&w(t,["sdkHttpResponse"],n);let i=v(s,["name"]);i!=null&&w(t,["name"],i);let r=v(s,["state"]);r!=null&&w(t,["state"],V$(r));let o=v(s,["createTime"]);o!=null&&w(t,["createTime"],o);let l=v(s,["startTime"]);l!=null&&w(t,["startTime"],l);let u=v(s,["endTime"]);u!=null&&w(t,["endTime"],u);let h=v(s,["updateTime"]);h!=null&&w(t,["updateTime"],h);let d=v(s,["error"]);d!=null&&w(t,["error"],d);let c=v(s,["description"]);c!=null&&w(t,["description"],c);let a=v(s,["baseModel"]);a!=null&&w(t,["baseModel"],a);let f=v(s,["tunedModel"]);f!=null&&w(t,["tunedModel"],f);let p=v(s,["preTunedModel"]);p!=null&&w(t,["preTunedModel"],p);let g=v(s,["supervisedTuningSpec"]);g!=null&&w(t,["supervisedTuningSpec"],g);let m=v(s,["preferenceOptimizationSpec"]);m!=null&&w(t,["preferenceOptimizationSpec"],m);let y=v(s,["tuningDataStats"]);y!=null&&w(t,["tuningDataStats"],y);let _=v(s,["encryptionSpec"]);_!=null&&w(t,["encryptionSpec"],_);let x=v(s,["partnerModelTuningSpec"]);x!=null&&w(t,["partnerModelTuningSpec"],x);let E=v(s,["customBaseModel"]);E!=null&&w(t,["customBaseModel"],E);let S=v(s,["experiment"]);S!=null&&w(t,["experiment"],S);let T=v(s,["labels"]);T!=null&&w(t,["labels"],T);let C=v(s,["outputUri"]);C!=null&&w(t,["outputUri"],C);let I=v(s,["pipelineJob"]);I!=null&&w(t,["pipelineJob"],I);let A=v(s,["serviceAccount"]);A!=null&&w(t,["serviceAccount"],A);let P=v(s,["tunedModelDisplayName"]);P!=null&&w(t,["tunedModelDisplayName"],P);let F=v(s,["veoTuningSpec"]);return F!=null&&w(t,["veoTuningSpec"],F),t}function w8(s,e){let t={},n=v(s,["sdkHttpResponse"]);n!=null&&w(t,["sdkHttpResponse"],n);let i=v(s,["name"]);i!=null&&w(t,["name"],i);let r=v(s,["metadata"]);r!=null&&w(t,["metadata"],r);let o=v(s,["done"]);o!=null&&w(t,["done"],o);let l=v(s,["error"]);return l!=null&&w(t,["error"],l),t}function M$(s,e){let t={},n=v(s,["gcsUri"]);n!=null&&w(t,["validationDatasetUri"],n);let i=v(s,["vertexDatasetResource"]);return i!=null&&w(t,["validationDatasetUri"],i),t}var JT=class extends ci{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new kr(Dr.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var n;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let i={tunedModelName:t.baseModel};!((n=t.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(i.checkpointId=t.config.preTunedModelCheckpointId);let r=Object.assign(Object.assign({},t),{preTunedModel:i});return r.baseModel=void 0,await this.tuneInternal(r)}else{let i=Object.assign({},t);return await this.tuneInternal(i)}else{let i=Object.assign({},t),r=await this.tuneMldevInternal(i),o="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?o=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(o=r.name.split("/operations/")[0]),{name:o,state:oT.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=d8(e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>XT(d))}else{let h=u8(e);return l=fe("{name}",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>fU(d))}}async listInternal(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=g8(e);return l=fe("tuningJobs",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=y8(d),a=new $b;return Object.assign(a,c),a})}else{let h=p8(e);return l=fe("tunedModels",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=m8(d),a=new $b;return Object.assign(a,c),a})}}async cancel(e){var t,n,i,r;let o,l="",u={};if(this.apiClient.isVertexAI()){let h=s8(e);return l=fe("{name}:cancel",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=r8(d),a=new Ub;return Object.assign(a,c),a})}else{let h=n8(e);return l=fe("{name}:cancel",h._url),u=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(c=>{let a=c;return a.sdkHttpResponse={headers:d.headers},a})),o.then(d=>{let c=i8(d),a=new Ub;return Object.assign(a,c),a})}}async tuneInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){let l=c8(e,e);return r=fe("tuningJobs",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{let d=h;return d.sdkHttpResponse={headers:u.headers},d})),i.then(u=>XT(u))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=l8(e);return r=fe("tunedModels",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{let d=h;return d.sdkHttpResponse={headers:u.headers},d})),i.then(u=>w8(u))}}};var ZT=class{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},x8=1024*1024*8,E8=3,S8=1e3,T8=2,ov="x-goog-upload-status";async function A8(s,e,t){var n;let i=await pU(s,e,t),r=await i?.json();if(((n=i?.headers)===null||n===void 0?void 0:n[ov])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function C8(s,e,t){var n;let i=await pU(s,e,t),r=await i?.json();if(((n=i?.headers)===null||n===void 0?void 0:n[ov])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let o=O$(r),l=new wT;return Object.assign(l,o),l}async function pU(s,e,t){var n,i;let r=0,o=0,l=new kf(new Response),u="upload";for(r=s.size;o<r;){let h=Math.min(x8,r-o),d=s.slice(o,o+h);o+h>=r&&(u+=", finalize");let c=0,a=S8;for(;c<E8&&(l=await t.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(o),"Content-Length":String(h)}}}),!(!((n=l?.headers)===null||n===void 0)&&n[ov]));)c++,await D8(a),a=a*T8;if(o+=h,((i=l?.headers)===null||i===void 0?void 0:i[ov])!=="active")break;if(r<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return l}async function I8(s){return{size:s.size,type:s.type}}function D8(s){return new Promise(e=>setTimeout(e,s))}var QT=class{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await A8(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await C8(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await I8(e)}};var eA=class{create(e,t,n){return new tA(e,t,n)}},tA=class{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var N$="x-goog-api-key",nA=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(N$)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(N$,this.apiKey)}}};var k8="gl-node/",av=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e?.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new Xt({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e?.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;let n=oG(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let i=new nA(this.apiKey);this.apiClient=new PT({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:k8+"web",uploader:new QT,downloader:new ZT}),this.models=new $T(this.apiClient),this.live=new FT(this.apiClient,i,new eA),this.batches=new ST(this.apiClient),this.chats=new AT(this.models,this.apiClient),this.caches=new TT(this.apiClient),this.files=new IT(this.apiClient),this.operations=new UT(this.apiClient),this.authTokens=new BT(this.apiClient),this.tunings=new JT(this.apiClient),this.fileSearchStores=new zT(this.apiClient)}};var gU=`You are my assistant for classifying notes by project and restructuring content when needed.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uBD84\uB958 \uADDC\uCE59 (\uC911\uC694\uB3C4 \uC21C)

### 1. \uD504\uB85C\uC81D\uD2B8 \uC0B0\uCD9C\uBB3C (contentType: "artifact")
\uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC9C1\uC811 \uC800\uC7A5\uD574\uC57C \uD560 \uAC83:
- \uC9C1\uC811 \uC791\uC131\uD55C \uBB38\uC11C, \uACC4\uD68D\uC11C, \uD68C\uC758\uB85D
- \uD504\uB85C\uC81D\uD2B8\uB97C \uC704\uD574 \uB9CC\uB4E0 \uCF54\uB4DC, \uC124\uACC4\uC11C
- \uD504\uB85C\uC81D\uD2B8 \uC9C4\uD589 \uAD00\uB828 \uBA54\uBAA8

### 2. \uD504\uB85C\uC81D\uD2B8 \uCC38\uACE0\uC790\uB8CC (contentType: "reference")
Library\uC5D0 \uC800\uC7A5\uD558\uB418 \uD504\uB85C\uC81D\uD2B8\uC640 \uB9C1\uD06C\uD574\uC57C \uD560 \uAC83:
- \uC678\uBD80 \uD29C\uD1A0\uB9AC\uC5BC, \uC608\uC81C \uCF54\uB4DC, \uBB38\uC11C
- \uC6F9\uD398\uC774\uC9C0 \uC2A4\uD06C\uB7A9, \uC544\uD2F0\uD074
- \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uC790\uB8CC
- \uC608: "ESP32 \uC608\uC81C" \u2192 \uD30C\uCE20\uD31C\uC5D0 \uC720\uC6A9\uD558\uC9C0\uB9CC Library\uC5D0 \uC800\uC7A5

### 3. \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC (targetType: "library", contentType: "general")
- \uD2B9\uC815 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828 \uC5C6\uB294 \uC77C\uBC18 \uC815\uBCF4
- \uB274\uC2A4, \uACF5\uACE0, \uC77C\uBC18 \uC544\uD2F0\uD074

### 4. archive
- \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83

## \uD310\uB2E8 \uAE30\uC900
- "\uC774\uAC74 \uB0B4\uAC00 \uC9C1\uC811 \uB9CC\uB4E0 \uC0B0\uCD9C\uBB3C\uC778\uAC00?" \u2192 artifact
- "\uC774\uAC74 \uC678\uBD80 \uC790\uB8CC\uC778\uB370 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC720\uC6A9\uD55C\uAC00?" \u2192 reference
- "\uC774\uAC74 \uADF8\uB0E5 \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC\uC778\uAC00?" \u2192 general
- "\uD504\uB85C\uC81D\uD2B8 \uB05D\uB098\uB3C4 \uACC4\uC18D \uCC38\uACE0\uD560 \uC790\uB8CC\uC778\uAC00?" \u2192 reference (Library)

## \uCF58\uD150\uCE20 \uC7AC\uAD6C\uC131 (Phase 2)

\uB178\uD2B8\uAC00 \uC815\uB9AC\uB418\uC9C0 \uC54A\uC740 \uC6D0\uC2DC \uD615\uD0DC\uB77C\uBA74 \uC7AC\uAD6C\uC131\uC744 \uC81C\uC548\uD574\uB77C:

### \uC7AC\uAD6C\uC131 \uD544\uC694 \uC5EC\uBD80 \uD310\uB2E8
- \uAD6C\uC870\uD654\uB418\uC9C0 \uC54A\uC740 \uBA54\uBAA8 (\uC904\uAE00, \uB098\uC5F4, \uD0A4\uC6CC\uB4DC\uB9CC)
- \uD68C\uC758/\uBBF8\uD305 \uB0B4\uC6A9\uC778\uB370 \uC815\uB9AC \uC548 \uB428
- \uD559\uC2B5 \uB0B4\uC6A9\uC778\uB370 \uCCB4\uACC4 \uC5C6\uC74C
- \uC544\uC774\uB514\uC5B4\uC778\uB370 \uC124\uBA85 \uBD80\uC871

### \uC7AC\uAD6C\uC131 \uC720\uD615\uBCC4 \uD15C\uD50C\uB9BF

**meeting (\uD68C\uC758/\uBBF8\uD305)**:
\`\`\`
## \uD68C\uC758 \uC694\uC57D
- \uC77C\uC2DC: [\uB0A0\uC9DC]
- \uCC38\uC11D\uC790: [\uCD94\uB860 \uAC00\uB2A5\uD558\uBA74]
- \uC8FC\uC81C: [\uD575\uC2EC \uC8FC\uC81C]

## \uB17C\uC758 \uB0B4\uC6A9
- [\uD575\uC2EC \uB17C\uC758 1]
- [\uD575\uC2EC \uB17C\uC758 2]

## \uACB0\uC815\uC0AC\uD56D
- [\uACB0\uC815 1]

## \uC561\uC158 \uC544\uC774\uD15C
- [ ] [\uD560 \uC77C]
\`\`\`

**idea (\uC544\uC774\uB514\uC5B4/\uBE0C\uB808\uC778\uC2A4\uD1A0\uBC0D)**:
\`\`\`
## \uD575\uC2EC \uC544\uC774\uB514\uC5B4
[\uC544\uC774\uB514\uC5B4 1\uC904 \uC694\uC57D]

## \uC0C1\uC138 \uC124\uBA85
[\uC544\uC774\uB514\uC5B4 \uC124\uBA85]

## \uC65C \uC911\uC694\uD55C\uAC00?
[\uC774\uC720]

## \uB2E4\uC74C \uB2E8\uACC4
- [ ] [\uAC80\uC99D/\uC2E4\uD589 \uBC29\uBC95]
\`\`\`

**learning (\uD559\uC2B5/\uC5F0\uAD6C)**:
\`\`\`
## \uC8FC\uC81C
[\uD559\uC2B5 \uC8FC\uC81C]

## \uD575\uC2EC \uAC1C\uB150
- [\uAC1C\uB150 1]
- [\uAC1C\uB150 2]

## \uBC30\uC6B4 \uC810
[\uC778\uC0AC\uC774\uD2B8]

## \uC801\uC6A9 \uBC29\uBC95
- [\uC2E4\uC81C \uC801\uC6A9 \uC608\uC2DC]
\`\`\`

**general (\uC77C\uBC18 \uC815\uB9AC)**:
\`\`\`
## \uC694\uC57D
[\uD575\uC2EC \uB0B4\uC6A9 2-3\uBB38\uC7A5]

## \uC8FC\uC694 \uB0B4\uC6A9
- [\uD3EC\uC778\uD2B8 1]
- [\uD3EC\uC778\uD2B8 2]

## \uAD00\uB828 \uC815\uBCF4
- [\uCC38\uACE0 \uC0AC\uD56D]
\`\`\`

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "targetType": "project \uB610\uB294 library \uB610\uB294 archive",
  "contentType": "artifact \uB610\uB294 reference \uB610\uB294 general",
  "projectName": "\uD504\uB85C\uC81D\uD2B8\uBA85 (project \uB610\uB294 reference\uC77C \uB54C)",
  "isNewProject": true/false,
  "confidence": "high \uB610\uB294 medium \uB610\uB294 low",
  "reason": "\uC774 \uBD84\uB958\uB97C \uC120\uD0DD\uD55C \uC774\uC720 (1\uC904)",
  "title": "\uB178\uD2B8 \uC81C\uBAA9",
  "summary": "2-3\uBB38\uC7A5 \uC694\uC57D",
  "nextAction": "\uB2E4\uC74C \uD589\uB3D9 \uB610\uB294 null",
  "shouldRestructure": true/false,
  "restructureType": "meeting \uB610\uB294 idea \uB610\uB294 learning \uB610\uB294 general (\uC7AC\uAD6C\uC131 \uD544\uC694\uC2DC)",
  "restructuredContent": "\uC7AC\uAD6C\uC131\uB41C \uB9C8\uD06C\uB2E4\uC6B4 \uB0B4\uC6A9 (shouldRestructure\uAC00 true\uC77C \uB54C)"
}

**\uC911\uC694**: shouldRestructure\uAC00 false\uBA74 restructureType\uACFC restructuredContent\uB294 \uC0DD\uB7B5
`,mU=`\uB108\uB294 \uC81C\uD154\uCE74\uC2A4\uD150(Zettelkasten) \uBC29\uC2DD\uC758 \uC601\uAD6C \uB178\uD2B8\uB97C \uB9CC\uB4DC\uB294 \uBE44\uC11C\uB2E4.
\uC544\uB798 \uB178\uD2B8\uC5D0\uC11C \uC81C\uD154\uCE74\uC2A4\uD150\uC6A9 \uC601\uAD6C \uB178\uD2B8 \uD6C4\uBCF4 \uC544\uC774\uB514\uC5B4\uB4E4\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uD55C \uB178\uD2B8\uC5D0\uB294 \uD558\uB098\uC758 \uC544\uC774\uB514\uC5B4\uB9CC \uB2F4\uB294\uB2E4 (atomic note)
- \uAC01 \uC544\uC774\uB514\uC5B4\uB294 3-5\uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD55C\uB2E4
- \uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C
- \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC5F0\uACB0\uB420 \uC218 \uC788\uB294 \uAC1C\uB150 2-3\uAC1C\uB97C \uC81C\uC548\uD574\uB77C
- \uC544\uC774\uB514\uC5B4\uB9C8\uB2E4 \uC5F0\uAD00 \uD0A4\uC6CC\uB4DC\uB97C \uD568\uAED8 \uC801\uC5B4\uB77C

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uC544\uC774\uB514\uC5B4\uB97C \uD55C \uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD558\uB294 \uC81C\uBAA9",
    "body": "3-5\uBB38\uC7A5\uC758 \uC124\uBA85",
    "importance": "\uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uAC00? (1\uC904)",
    "relatedConcepts": ["\uAC1C\uB1501", "\uAC1C\uB1502", "\uAC1C\uB1503"],
    "keywords": ["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3"]
  }
]

\uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uC744 \uBC18\uD658\uD574\uB77C.
`,yU=`\uB108\uB294 \uB098\uC758 \uC791\uC5C5 \uC6B0\uC120\uC21C\uC704 \uCF54\uCE58\uB2E4.
\uC544\uB798 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D\uC744 \uBCF4\uACE0, \uC9C0\uAE08 \uB0B4\uAC00 \uC9D1\uC911\uD574\uC57C \uD560 \uC0C1\uC704 3\uAC1C\uB9CC \uACE8\uB77C\uB77C.

## \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uAC01 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uB300\uD574 \uB2E4\uC74C\uC744 \uC81C\uACF5\uD574\uB77C
- title: \uD504\uB85C\uC81D\uD2B8 \uC774\uB984
- why: \uC65C \uC9C0\uAE08 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904 \uC124\uBA85
- next_action: \uC624\uB298 \uB2F9\uC7A5 \uD560 \uC218 \uC788\uB294 \uAC00\uC7A5 \uC791\uC740 \uB2E4\uC74C \uD589\uB3D9

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uD504\uB85C\uC81D\uD2B8 \uC774\uB984",
    "why": "\uC911\uC694\uD55C \uC774\uC720",
    "next_action": "\uB2E4\uC74C \uD589\uB3D9"
  }
]
`,bU=`\uC774 \uC774\uBBF8\uC9C0\uC5D0\uC11C \uD14D\uC2A4\uD2B8\uB97C \uCD94\uCD9C\uD574\uB77C.
\uC190\uAE00\uC528, \uC778\uC1C4\uBB3C, \uC2A4\uCE94 \uBB38\uC11C \uB4F1 \uBAA8\uB4E0 \uD615\uD0DC\uC758 \uD14D\uC2A4\uD2B8\uB97C \uC77D\uC5B4\uB77C.

## \uADDC\uCE59
- \uC774\uBBF8\uC9C0\uC5D0 \uBCF4\uC774\uB294 \uBAA8\uB4E0 \uD14D\uC2A4\uD2B8\uB97C \uADF8\uB300\uB85C \uCD94\uCD9C
- \uC6D0\uBCF8\uC758 \uC904\uBC14\uAFC8\uACFC \uAD6C\uC870\uB97C \uCD5C\uB300\uD55C \uC720\uC9C0
- \uD45C\uAC00 \uC788\uC73C\uBA74 \uB9C8\uD06C\uB2E4\uC6B4 \uD45C\uB85C \uBCC0\uD658
- \uC77D\uC744 \uC218 \uC5C6\uB294 \uBD80\uBD84\uC740 [\uBD88\uBA85\uD655] \uC73C\uB85C \uD45C\uC2DC
- \uD14D\uC2A4\uD2B8\uB9CC \uCD9C\uB825\uD558\uACE0 \uB2E4\uB978 \uC124\uBA85\uC740 \uD558\uC9C0 \uB9C8\uB77C
`,vU=`\uB178\uD2B8 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD575\uC2EC \uD0A4\uC6CC\uB4DC 5-10\uAC1C\uB97C \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uAE30\uC220 \uC6A9\uC5B4, \uD504\uB85C\uC81D\uD2B8\uBA85, \uC8FC\uC694 \uAC1C\uB150 \uC704\uC8FC\uB85C \uCD94\uCD9C
- \uB108\uBB34 \uC77C\uBC18\uC801\uC778 \uB2E8\uC5B4 (\uC608: \uBC29\uBC95, \uB0B4\uC6A9, \uC815\uBCF4)\uB294 \uC81C\uC678
- \uD55C\uAE00/\uC601\uC5B4 \uBAA8\uB450 \uAC00\uB2A5
- \uBCF5\uD569 \uBA85\uC0AC\uB294 \uBD84\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C (\uC608: "\uC2A4\uB9C8\uD2B8\uD31C", "API\uD0A4")

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3", ...]
`,_U=`\uC0C8 \uB178\uD2B8\uC640 \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4\uC758 \uAD00\uB828\uC131\uC744 \uBD84\uC11D\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {newTitle}
\uD0A4\uC6CC\uB4DC: {newKeywords}

## \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4
{candidates}

## \uADDC\uCE59
- \uAC01 \uD6C4\uBCF4 \uB178\uD2B8\uC5D0 \uB300\uD574 \uAD00\uB828\uB3C4 \uC810\uC218(0.0~1.0)\uB97C \uB9E4\uACA8\uB77C
- 0.5 \uC774\uC0C1\uC778 \uB178\uD2B8\uB9CC \uBC18\uD658
- \uCD5C\uB300 5\uAC1C\uAE4C\uC9C0\uB9CC \uBC18\uD658
- \uAD00\uB828\uB3C4 \uB192\uC740 \uC21C\uC73C\uB85C \uC815\uB82C
- \uAC01 \uC5F0\uACB0\uC758 "\uC774\uC720"\uB97C \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C (\uC65C \uAD00\uB828\uC788\uB294\uAC00?)
- \uC5F0\uACB0 \uC720\uD615 \uBD84\uB958: \uD655\uC7A5|\uBC18\uBC15|\uC608\uC2DC|\uC804\uC81C|\uC751\uC6A9 \uC911 \uD558\uB098

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
[
  {
    "index": 0,
    "relevance": 0.8,
    "reason": "\uC774 \uB178\uD2B8\uC640 \uAD00\uB828\uC788\uB294 \uAD6C\uCCB4\uC801 \uC774\uC720",
    "type": "\uD655\uC7A5"
  }
]
`,wU=`\uC0C8 \uB178\uD2B8\uAC00 \uC5B4\uB5A4 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828\uC788\uB294\uC9C0 **\uC2E0\uC911\uD558\uAC8C** \uD310\uB2E8\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {noteTitle}
\uD0A4\uC6CC\uB4DC: {noteKeywords}

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- \uB178\uD2B8\uC758 **\uD575\uC2EC \uC8FC\uC81C**\uAC00 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB420 \uB54C\uB9CC \uD504\uB85C\uC81D\uD2B8 \uC120\uD0DD
- \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
- **\uD655\uC2E4\uD558\uC9C0 \uC54A\uC73C\uBA74 "None" \uBC18\uD658** (\uC798\uBABB\uB41C \uBD84\uB958\uBCF4\uB2E4 \uB098\uC74C)
- \uC77C\uBC18\uC801\uC778 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 \u2192 "None"
- \uC0C8\uB85C\uC6B4 \uD504\uB85C\uC81D\uD2B8\uB85C \uBCF4\uC774\uBA74 "NEW: \uD504\uB85C\uC81D\uD2B8\uBA85" \uD615\uC2DD\uC73C\uB85C \uBC18\uD658

## \uCD9C\uB825 \uD615\uC2DD (\uD504\uB85C\uC81D\uD2B8\uBA85\uB9CC \uC751\uB2F5)
\uD504\uB85C\uC81D\uD2B8\uBA85 \uB610\uB294 None \uB610\uB294 NEW: \uC0C8\uD504\uB85C\uC81D\uD2B8\uBA85
`,xU=`\uC720\uD29C\uBE0C \uC601\uC0C1\uC758 \uC790\uB9C9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uC790\uB9C9 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,EU=`\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBCF8\uBB38 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uAE00\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uAD11\uACE0\uB098 \uAD00\uB828 \uC5C6\uB294 \uB0B4\uC6A9\uC740 \uBB34\uC2DC\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,SU=`\uB108\uB294 \uBA54\uBAA8\uB97C \uBD84\uC11D\uD558\uC5EC \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uBCC4\uB85C \uBD84\uB9AC\uD558\uB294 \uBE44\uC11C\uB2E4.
\uD558\uB098\uC758 \uBA54\uBAA8\uC5D0 \uC5EC\uB7EC \uC8FC\uC81C\uB098 \uD504\uB85C\uC81D\uD2B8 \uAD00\uB828 \uB0B4\uC6A9\uC774 \uC11E\uC5EC \uC788\uC744 \uC218 \uC788\uB2E4.
\uAC01\uAC01\uC744 \uB3C5\uB9BD\uC801\uC778 \uB178\uD2B8\uB85C \uBD84\uB9AC\uD574\uB77C.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D (\uCC38\uACE0\uC6A9)
{projects}

## \uBA54\uBAA8 \uB0B4\uC6A9
{content}

## \uBD84\uB9AC \uADDC\uCE59
- \uC11C\uB85C \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uB294 \uBC18\uB4DC\uC2DC \uBD84\uB9AC\uD574\uB77C
- \uD55C \uC904\uC9DC\uB9AC \uBA54\uBAA8\uB3C4 \uC758\uBBF8\uAC00 \uC788\uC73C\uBA74 \uBD84\uB9AC \uB300\uC0C1\uC774\uB2E4
- \uAD00\uB828 \uB0B4\uC6A9\uC740 \uD558\uB098\uB85C \uBB36\uC5B4\uB77C (\uACFC\uB3C4\uD55C \uBD84\uB9AC \uAE08\uC9C0)
- \uAC01 \uC139\uC158\uC5D0 \uC801\uC808\uD55C \uC81C\uBAA9\uC744 \uBD99\uC5EC\uB77C

## \uBD84\uB958 \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- **project**: \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB41C \uB0B4\uC6A9\uB9CC
  - \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
  - \uC608: "\uC2A4\uB9C8\uD2B8\uD31C" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC788\uC5B4\uB3C4 "\uB18D\uC5C5 \uB274\uC2A4"\uB294 library
- **library**: \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 (**\uC560\uB9E4\uD558\uBA74 library**)
- **archive**: \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83
- \uC0C8 \uD504\uB85C\uC81D\uD2B8: \uBA85\uD655\uD55C \uBAA9\uD45C\uAC00 \uC788\uB294 \uC0C8\uB85C\uC6B4 \uC791\uC5C5\uC77C \uB54C\uB9CC isNewProject: true

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uBD84\uB9AC\uB41C \uC139\uC158\uC758 \uC81C\uBAA9",
    "content": "\uD574\uB2F9 \uC139\uC158\uC758 \uC6D0\uBCF8 \uB0B4\uC6A9 (\uC815\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C)",
    "targetType": "project",
    "projectName": "\uC2A4\uB9C8\uD2B8\uD31C",
    "isNewProject": false,
    "keywords": ["\uC13C\uC11C", "\uB370\uC774\uD130", "IoT"],
    "isAtomic": false
  }
]

\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC73C\uBA74 \uC804\uCCB4\uB97C \uD558\uB098\uC758 \uC139\uC158\uC73C\uB85C \uBC18\uD658\uD574\uB77C.
`,TU=`\uC8FC\uC81C\uC5D0 \uC18D\uD55C ZK \uB178\uD2B8\uB4E4\uC744 \uBD84\uC11D\uD558\uC5EC \uAD6C\uC870\uD654\uB41C \uC124\uBA85\uC744 \uC0DD\uC131\uD574\uB77C.

## \uC8FC\uC81C
{topic}

## \uB178\uD2B8 \uBAA9\uB85D
{notes}

## \uADDC\uCE59
- \uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85 \uC791\uC131
- \uAC01 \uB178\uD2B8\uC758 \uC5ED\uD560/\uC704\uCE58 \uC124\uBA85 (\uAE30\uCD08, \uC2EC\uD654, \uC751\uC6A9, \uC608\uC2DC \uC911 \uD558\uB098)
- \uB178\uD2B8 \uAC04 \uAD00\uACC4 \uD45C\uC2DC (\uBC1C\uC804, \uAE30\uBC18, \uAD00\uB828 \uC911 \uD558\uB098)
- \uAD00\uB828 \uC8FC\uC81C 2-3\uAC1C \uC81C\uC548

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "description": "\uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85",
  "notes": [
    {
      "title": "\uB178\uD2B8 \uC81C\uBAA9",
      "role": "\uAE30\uCD08",
      "relations": [{"target": "\uB2E4\uB978\uB178\uD2B8\uC81C\uBAA9", "type": "\uBC1C\uC804"}]
    }
  ],
  "relatedTopics": ["\uAD00\uB828\uC8FC\uC81C1", "\uAD00\uB828\uC8FC\uC81C2"]
}
`,AU=`PDF/\uC774\uBBF8\uC9C0 \uBB38\uC11C \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBB38\uC11C \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uBB38\uC11C\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD398\uC774\uC9C0 \uAD6C\uBD84\uC740 \uBB34\uC2DC\uD558\uACE0 \uC804\uCCB4 \uB0B4\uC6A9\uC744 \uD1B5\uD569\uD574\uC11C \uBD84\uC11D\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uBB38\uC11C \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,CU=`PDF/\uC774\uBBF8\uC9C0 \uBB38\uC11C \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uC0C1\uC138\uD558\uAC8C \uC694\uC57D\uD574\uB77C.

## \uBB38\uC11C \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uBB38\uC11C\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 8-15\uBB38\uC7A5\uC73C\uB85C **\uC0C1\uC138\uD558\uAC8C** \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 10-20\uAC1C\uC758 bullet point\uB85C **\uBE60\uC9D0\uC5C6\uC774** \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uC138\uBD80 \uC0AC\uD56D, \uC608\uC2DC, \uC218\uCE58 \uB370\uC774\uD130\uAC00 \uC788\uC73C\uBA74 \uD3EC\uD568\uD574\uB77C
- \uD398\uC774\uC9C0 \uAD6C\uBD84\uC740 \uBB34\uC2DC\uD558\uACE0 \uC804\uCCB4 \uB0B4\uC6A9\uC744 \uD1B5\uD569\uD574\uC11C \uBD84\uC11D\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uBB38\uC11C \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "8-15\uBB38\uC7A5 \uC0C1\uC138 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ... (10-20\uAC1C)]
}
`,IU=`\uD68C\uC758 \uB179\uC74C\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uC758\uB85D\uC744 \uC791\uC131\uD574\uB77C.

## \uADDC\uCE59
1. **\uC804\uC0AC(Transcription)**: \uC74C\uC131\uC744 \uD14D\uC2A4\uD2B8\uB85C \uBCC0\uD658. \uD654\uC790 \uAD6C\uBD84\uC774 \uAC00\uB2A5\uD558\uBA74 "\uD654\uC7901:", "\uD654\uC7902:" \uD615\uC2DD\uC73C\uB85C \uD45C\uC2DC
2. **\uC694\uC57D**: \uD68C\uC758 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
3. **\uC561\uC158 \uC544\uC774\uD15C**: \uB204\uAC00 \uBB34\uC5C7\uC744 \uC5B8\uC81C\uAE4C\uC9C0 \uD560\uC9C0 \uCD94\uCD9C. \uBA85\uC2DC\uB418\uC9C0 \uC54A\uC740 \uD56D\uBAA9\uC740 null
4. **\uACB0\uC815\uC0AC\uD56D**: \uD68C\uC758\uC5D0\uC11C \uACB0\uC815\uB41C \uC0AC\uD56D\uB4E4
5. **\uB2E4\uC74C \uD68C\uC758 \uC548\uAC74**: \uD6C4\uC18D \uB17C\uC758\uAC00 \uD544\uC694\uD55C \uC8FC\uC81C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD68C\uC758 \uC81C\uBAA9 (\uC8FC\uC81C \uAE30\uBC18\uC73C\uB85C \uC0DD\uC131)",
  "transcription": "\uC804\uCCB4 \uB300\uD654 \uB0B4\uC6A9 (\uD654\uC790 \uAD6C\uBD84 \uD3EC\uD568)",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "actionItems": [
    {"task": "\uD560 \uC77C", "assignee": "\uB2F4\uB2F9\uC790 \uB610\uB294 null", "deadline": "\uAE30\uD55C \uB610\uB294 null"}
  ],
  "decisions": ["\uACB0\uC815\uC0AC\uD56D1", "\uACB0\uC815\uC0AC\uD56D2"],
  "nextAgenda": ["\uB2E4\uC74C \uC548\uAC741", "\uB2E4\uC74C \uC548\uAC742"]
}

\uC561\uC158 \uC544\uC774\uD15C, \uACB0\uC815\uC0AC\uD56D, \uB2E4\uC74C \uC548\uAC74\uC774 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uB85C \uBC18\uD658\uD574\uB77C.
`,DU=`\uB108\uB294 \uB098\uC758 \uC0DD\uC0B0\uC131 \uCF54\uCE58\uB2E4.
\uC8FC\uC5B4\uC9C4 \uAE30\uAC04 \uB3D9\uC548\uC758 \uC791\uC5C5 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uACE0 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uB77C.

## \uAE30\uAC04
{period} ({dateRange})

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5 \uB0B4\uC6A9
{projectData}

## \uBD84\uC11D \uADDC\uCE59
1. \uC804\uCCB4 \uC694\uC57D: \uC774 \uAE30\uAC04\uC758 \uC791\uC5C5\uC744 2-3\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
2. \uC8FC\uC694 \uC8FC\uC81C: \uB2E4\uB8EC \uD575\uC2EC \uC8FC\uC81C 3-5\uAC1C \uCD94\uCD9C
3. \uC778\uC0AC\uC774\uD2B8: \uBC1C\uACAC\uD55C \uC810, \uBC30\uC6B4 \uC810, \uD328\uD134 3-5\uAC1C
4. \uB2E4\uC74C \uC561\uC158: \uD6C4\uC18D\uC73C\uB85C \uD574\uC57C \uD560 \uAD6C\uCCB4\uC801\uC778 \uD589\uB3D9 3-5\uAC1C
5. \uC791\uC5C5 \uD328\uD134: \uC791\uC5C5 \uBC29\uC2DD\uC5D0\uC11C \uBC1C\uACAC\uB41C \uD328\uD134 (\uC120\uD0DD)

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "summary": "\uC804\uCCB4 \uC694\uC57D (2-3\uBB38\uC7A5)",
  "mainTopics": ["\uC8FC\uC81C1", "\uC8FC\uC81C2", "\uC8FC\uC81C3"],
  "insights": ["\uC778\uC0AC\uC774\uD2B81", "\uC778\uC0AC\uC774\uD2B82", "\uC778\uC0AC\uC774\uD2B83"],
  "nextActions": ["\uC561\uC1581", "\uC561\uC1582", "\uC561\uC1583"],
  "patterns": "\uC791\uC5C5 \uD328\uD134 \uBD84\uC11D (\uC120\uD0DD, \uC5C6\uC73C\uBA74 null)"
}
`,kU=`\uB178\uD2B8 \uB0B4\uC6A9\uC5D0\uC11C \uC77C\uC815/\uD560\uC77C/\uC57D\uC18D\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uC624\uB298 \uB0A0\uC9DC
{today}

## \uCD94\uCD9C \uADDC\uCE59
- \uB0A0\uC9DC/\uC2DC\uAC04\uC774 \uC5B8\uAE09\uB41C \uBAA8\uB4E0 \uC77C\uC815 \uCD94\uCD9C
- \uC0C1\uB300\uC801 \uB0A0\uC9DC\uB97C \uC808\uB300 \uB0A0\uC9DC\uB85C \uBCC0\uD658:
  - "\uB0B4\uC77C" \u2192 \uC624\uB298 + 1\uC77C
  - "\uBAA8\uB808" \u2192 \uC624\uB298 + 2\uC77C
  - "\uB2E4\uC74C \uC8FC \uC6D4\uC694\uC77C" \u2192 \uB2E4\uC74C \uC8FC \uC6D4\uC694\uC77C \uB0A0\uC9DC
  - "\uC774\uBC88 \uC8FC \uAE08\uC694\uC77C" \u2192 \uC774\uBC88 \uC8FC \uAE08\uC694\uC77C \uB0A0\uC9DC
  - "\uB2E4\uC74C \uB2EC" \u2192 \uB2E4\uC74C \uB2EC 1\uC77C
- \uC2DC\uAC04\uC774 \uC5C6\uC73C\uBA74 time\uC744 null\uB85C
- type \uAD6C\uBD84:
  - "event": \uC57D\uC18D, \uBBF8\uD305, \uD68C\uC758, \uBC1C\uD45C, \uBC29\uBB38 \uB4F1 \uD2B9\uC815 \uC2DC\uC810\uC758 \uD65C\uB3D9
  - "task": \uB9C8\uAC10\uC77C, \uC81C\uCD9C, \uC644\uB8CC\uD574\uC57C \uD560 \uC77C

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4)
[
  {
    "title": "\uC77C\uC815 \uC81C\uBAA9",
    "date": "2026-01-15",
    "time": "14:00",
    "type": "event"
  },
  {
    "title": "\uBCF4\uACE0\uC11C \uC81C\uCD9C",
    "date": "2026-01-17",
    "time": null,
    "type": "task"
  }
]

\uC77C\uC815\uC774 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 [] \uBC18\uD658.
`;var R8=1e3,P8=3,M8=2e3,it="gemini-3-flash-preview",dv=class{constructor(e){this.lastRequestTime=0;this.minDelayMs=R8;this.usageTracker=null;this.ai=new av({apiKey:e})}setUsageTracker(e){this.usageTracker=e}recordUsage(e,t,n){if(!this.usageTracker)return;let i=t.usageMetadata;i&&this.usageTracker.recordUsage(e,i.promptTokenCount??0,i.candidatesTokenCount??0,n)}async waitForRateLimit(){let t=Date.now()-this.lastRequestTime;if(t<this.minDelayMs){let n=this.minDelayMs-t;await this.delay(n)}this.lastRequestTime=Date.now()}delay(e){return new Promise(t=>setTimeout(t,e))}async callWithRetry(e,t=P8){await this.waitForRateLimit();for(let n=0;n<=t;n++)try{return await e()}catch(i){if(i instanceof Error&&(i.message.includes("429")||i.message.includes("RESOURCE_EXHAUSTED")||i.message.includes("quota"))&&n<t){let o=M8*Math.pow(2,n);console.log(`Rate limit hit, retrying in ${o/1e3}s... (attempt ${n+1}/${t})`),await this.delay(o),this.minDelayMs=Math.min(this.minDelayMs*1.5,5e3)}else throw i}throw new Error("Max retries exceeded")}async classifyProject(e,t,n){let i=t.length>0?t.map((u,h)=>`${h+1}. ${u}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",r=gU.replace("{projects}",i).replace("{content}",e);n&&(r=r.replace("## \uCD9C\uB825 \uD615\uC2DD",`${n}

## \uCD9C\uB825 \uD615\uC2DD`));let o=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:r}));this.recordUsage("classify",o,it);let l=o.text??"";return this.parseProjectResponse(l)}async extractZK(e){let t=mU.replace("{content}",e),n=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:t}));this.recordUsage("zk",n,it);let i=n.text??"";return this.parseZKResponse(i)}async getFocus(e){let t=yU.replace("{projects}",e),n=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:t}));this.recordUsage("focus",n,it);let i=n.text??"";return this.parseFocusResponse(i)}parseProjectResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: JSON \uC5C6\uC74C");try{let n=JSON.parse(t[0]);return{targetType:this.validateTargetType(n.targetType),projectName:n.projectName||void 0,isNewProject:n.isNewProject??!1,title:n.title||"Untitled",summary:n.summary||"",nextAction:n.nextAction||null}}catch{throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: "+e)}}parseZKResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{return JSON.parse(t[0]).map(i=>({title:i.title,body:i.body,keywords:i.keywords||[],importance:i.importance||"",relatedConcepts:i.relatedConcepts||[]}))}catch{return console.error("ZK \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}parseFocusResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{return JSON.parse(t[0]).map(i=>({title:i.title,why:i.why,nextAction:i.next_action}))}catch{return console.error("Focus \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async extractTextFromImage(e,t){let n=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:[{role:"user",parts:[{text:bU},{inlineData:{mimeType:t,data:e}}]}]}));return this.recordUsage("ocr",n,it),n.text??""}async extractTextFromImages(e,t){let n=[];for(let i=0;i<e.length;i++){let r=e[i];t&&t(i+1,e.length);let o=await this.extractTextFromImage(r.base64,r.mimeType);n.push(o),i<e.length-1&&await this.delay(500)}return n}async extractKeywords(e){let t=vU.replace("{content}",e),n=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:t}));this.recordUsage("other",n,it);let i=n.text??"";return this.parseKeywordsResponse(i)}async findRelatedNotes(e,t,n){let i=_U.replace("{newTitle}",e).replace("{newKeywords}",t.join(", ")).replace("{candidates}",n),r=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:i}));this.recordUsage("related",r,it);let o=r.text??"";return this.parseRelatedNotesResponse(o)}async detectProject(e,t,n){if(n.length===0)return null;let i=wU.replace("{noteTitle}",e).replace("{noteKeywords}",t.join(", ")).replace("{projects}",n.map((u,h)=>`${h+1}. ${u}`).join(`
`)),r=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:i}));this.recordUsage("classify",r,it);let o=(r.text??"").trim();return o.toLowerCase()==="none"||o===""?null:o.startsWith("NEW:")?o:n.find(u=>o.toLowerCase().includes(u.toLowerCase()))||null}async summarizeContent(e,t){let i=(t==="youtube"?xU:EU).replace("{content}",e),r=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:i}));this.recordUsage(t,r,it);let o=r.text??"";return this.parseSummaryResponse(o)}async summarizePDF(e,t=!1){let i=(t?CU:AU).replace("{content}",e),r=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:i}));this.recordUsage("ocr",r,it);let o=r.text??"";return this.parseSummaryResponse(o)}async analyzeYouTube(e){let t=`\uC774 YouTube \uC601\uC0C1\uC744 \uBD84\uC11D\uD574\uC8FC\uC138\uC694.

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD654\uBA74\uC5D0 \uBCF4\uC774\uB294 \uD14D\uC2A4\uD2B8, \uC2AC\uB77C\uC774\uB4DC, \uCF54\uB4DC \uB4F1\uB3C4 \uCC38\uACE0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,n=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:[{role:"user",parts:[{fileData:{mimeType:"video/mp4",fileUri:e}},{text:t}]}]}));this.recordUsage("youtube",n,it);let i=n.text??"";return this.parseSummaryResponse(i)}async analyzeWebpage(e){let t=`\uB2E4\uC74C \uC6F9\uD398\uC774\uC9C0\uB97C \uBD84\uC11D\uD574\uC8FC\uC138\uC694: ${e}

## \uADDC\uCE59
- \uD398\uC774\uC9C0\uC758 \uD575\uC2EC \uB0B4\uC6A9\uC744 \uC815\uD655\uD788 \uD30C\uC545\uD574\uB77C
- \uACF5\uACE0/\uBAA8\uC9D1\uC774\uBA74: \uB300\uC0C1, \uC870\uAC74, \uAE30\uAC04, \uD61C\uD0DD\uC744 \uAD6C\uCCB4\uC801\uC73C\uB85C
- \uB274\uC2A4/\uAE30\uC0AC\uBA74: \uD575\uC2EC \uC0AC\uC2E4, \uBC30\uACBD, \uC758\uBBF8\uB97C
- \uC81C\uD488/\uC11C\uBE44\uC2A4\uBA74: \uC8FC\uC694 \uAE30\uB2A5, \uAC00\uACA9, \uD2B9\uC9D5\uC744
- \uC77C\uBC18 \uC815\uBCF4\uBA74: \uD575\uC2EC \uBA54\uC2DC\uC9C0\uC640 \uC911\uC694 \uC138\uBD80\uC0AC\uD56D\uC744
- \uC804\uBB38 \uC6A9\uC5B4, \uACE0\uC720\uBA85\uC0AC, \uC22B\uC790\uB294 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD398\uC774\uC9C0 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D (\uAD6C\uCCB4\uC801\uC778 \uC815\uBCF4 \uD3EC\uD568)",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,n=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:t,config:{tools:[{urlContext:{}}]}}));this.recordUsage("webpage",n,it);let i=n.text??"";return this.parseSummaryResponse(i)}parseSummaryResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{title:"Untitled",summary:e.trim(),keyPoints:[]};try{let n=JSON.parse(t[0]);return{title:n.title||"Untitled",summary:n.summary||"",keyPoints:Array.isArray(n.keyPoints)?n.keyPoints:[]}}catch{return console.error("\uC694\uC57D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{title:"Untitled",summary:e.trim(),keyPoints:[]}}}parseKeywordsResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(i=>typeof i=="string"):[]}catch{return console.error("\uD0A4\uC6CC\uB4DC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}parseRelatedNotesResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(i=>typeof i=="object"&&typeof i.index=="number"&&typeof i.relevance=="number").filter(i=>i.relevance>=.5).sort((i,r)=>r.relevance-i.relevance).slice(0,5).map(i=>({index:i.index,relevance:i.relevance,reason:i.reason||"",type:i.type||""})):[]}catch{return console.error("\uAD00\uB828 \uB178\uD2B8 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async generateTopicStructure(e,t){let n=TU.replace("{topic}",e).replace("{notes}",t),i=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:n}));this.recordUsage("zk",i,it);let r=i.text??"";return this.parseTopicStructureResponse(r)}parseTopicStructureResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{description:"",notes:[],relatedTopics:[]};try{let n=JSON.parse(t[0]);return{description:n.description||"",notes:Array.isArray(n.notes)?n.notes:[],relatedTopics:Array.isArray(n.relatedTopics)?n.relatedTopics:[]}}catch{return console.error("\uC8FC\uC81C \uAD6C\uC870 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{description:"",notes:[],relatedTopics:[]}}}async splitContent(e,t){let n=t.length>0?t.map((l,u)=>`${u+1}. ${l}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",i=SU.replace("{projects}",n).replace("{content}",e),r=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:i}));this.recordUsage("split",r,it);let o=r.text??"";return this.parseSplitResponse(o)}parseSplitResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.map(i=>({title:i.title||"Untitled",content:i.content||"",targetType:this.validateTargetType(i.targetType),project:i.projectName||void 0,isNewProject:i.isNewProject??!1,keywords:Array.isArray(i.keywords)?i.keywords:[],isAtomic:i.isAtomic??!1})):[]}catch{return console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}validateTargetType(e){return["project","library","archive"].includes(e)?e:"library"}async analyzeReview(e,t,n){let r={today:"\uC624\uB298",week:"\uC774\uBC88 \uC8FC",month:"\uC774\uBC88 \uB2EC",custom:"\uC0AC\uC6A9\uC790 \uC9C0\uC815 \uAE30\uAC04"}[e]||"\uAE30\uAC04",o=`${nn(t.start,"auto")} ~ ${nn(t.end,"auto")}`,l=n.map(c=>{let a=c.notes.map(f=>`  - ${f.title}${f.summary?`: ${f.summary}`:""}`).join(`
`);return`### ${c.projectName} (${c.noteCount}\uAC1C)
${a}`}).join(`

`),u=DU.replace("{period}",r).replace("{dateRange}",o).replace("{projectData}",l),h=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:u}));this.recordUsage("review",h,it);let d=h.text??"";return this.parseReviewAnalysisResponse(d)}parseReviewAnalysisResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]};try{let n=JSON.parse(t[0]);return{summary:n.summary||"",mainTopics:Array.isArray(n.mainTopics)?n.mainTopics:[],insights:Array.isArray(n.insights)?n.insights:[],nextActions:Array.isArray(n.nextActions)?n.nextActions:[],patterns:n.patterns||void 0}}catch{return console.error("\uD68C\uACE0 \uBD84\uC11D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]}}}async analyzeMeeting(e,t,n){console.log("\uD68C\uC758 \uB179\uC74C \uC5C5\uB85C\uB4DC \uC911...",n);let i=await this.ai.files.upload({file:e,config:{mimeType:t}});console.log("\uC5C5\uB85C\uB4DC \uC644\uB8CC:",i.uri);let r=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:[{role:"user",parts:[{fileData:{fileUri:i.uri,mimeType:i.mimeType}},{text:IU}]}]}));this.recordUsage("meeting",r,it);let o=r.text??"";return this.parseMeetingResponse(o,n)}parseMeetingResponse(e,t){let n=e.match(/\{[\s\S]*\}/);if(!n)return{title:"\uD68C\uC758\uB85D",transcription:e.trim(),summary:"",actionItems:[],decisions:[],nextAgenda:[],sourceFile:t};try{let i=JSON.parse(n[0]);return{title:i.title||"\uD68C\uC758\uB85D",transcription:i.transcription||"",summary:i.summary||"",actionItems:Array.isArray(i.actionItems)?i.actionItems.map(r=>({task:r.task||"",assignee:r.assignee||null,deadline:r.deadline||null})):[],decisions:Array.isArray(i.decisions)?i.decisions:[],nextAgenda:Array.isArray(i.nextAgenda)?i.nextAgenda:[],sourceFile:t}}catch{return console.error("\uD68C\uC758\uB85D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{title:"\uD68C\uC758\uB85D",transcription:e.trim(),summary:"",actionItems:[],decisions:[],nextAgenda:[],sourceFile:t}}}async detectSchedules(e,t){let n=kU.replace("{content}",e).replace("{today}",t),i=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:n}));this.recordUsage("schedule",i,it);let r=i.text??"";return this.parseSchedulesResponse(r)}parseSchedulesResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(i=>typeof i=="object"&&typeof i.title=="string"&&typeof i.date=="string"&&(i.type==="event"||i.type==="task")).map(i=>({title:i.title,date:i.date,time:i.time||null,type:i.type})):[]}catch{return console.error("\uC77C\uC815 \uAC10\uC9C0 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async generateContent(e){let t=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:it,contents:e}));this.recordUsage("chat",t,it);let n=t.text??"";if(!n)throw new Error("\uC751\uB2F5 \uC0DD\uC131 \uC2E4\uD328");return n.trim()}async generateEmbedding(e,t="document"){if(!e||e.trim().length===0)return[];let n=e.length>8e3?e.substring(0,8e3):e,i=t==="query"?"RETRIEVAL_QUERY":"RETRIEVAL_DOCUMENT",r=await this.callWithRetry(async()=>await this.ai.models.embedContent({model:"gemini-embedding-001",contents:[{parts:[{text:n}]}],config:{taskType:i,outputDimensionality:768}}));if(this.usageTracker){let o=Math.ceil(n.length/4);this.usageTracker.recordUsage("embedding",o,0,"gemini-embedding-001")}return r.embeddings&&r.embeddings.length>0?r.embeddings[0].values||[]:[]}async batchGenerateEmbeddings(e,t){let n=[];for(let i=0;i<e.length;i++){t&&t(i+1,e.length);let r=await this.generateEmbedding(e[i]);n.push(r),i<e.length-1&&await this.delay(300)}return n}};var yw=require("obsidian");var DY={};var Jf={};Jf.d=(s,e)=>{for(var t in e)Jf.o(e,t)&&!Jf.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})};Jf.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e);var Re=globalThis.pdfjsLib={};Jf.d(Re,{AbortException:()=>or,AnnotationEditorLayer:()=>E1,AnnotationEditorParamsType:()=>nt,AnnotationEditorType:()=>Fe,AnnotationEditorUIManager:()=>kc,AnnotationLayer:()=>e1,AnnotationMode:()=>Po,ColorPicker:()=>__,DOMSVGFactory:()=>cp,DrawLayer:()=>A1,FeatureTest:()=>kn,GlobalWorkerOptions:()=>Ci,ImageKind:()=>yv,InvalidPDFException:()=>tp,MissingPDFException:()=>Cc,OPS:()=>hi,OutputScale:()=>ip,PDFDataRangeTransport:()=>l_,PDFDateString:()=>Qf,PDFWorker:()=>Wu,PasswordResponses:()=>$8,PermissionFlag:()=>L8,PixelsPerInch:()=>ma,RenderingCancelledException:()=>sp,TextLayer:()=>ap,TouchManager:()=>Jv,UnexpectedResponseException:()=>Eh,Util:()=>ve,VerbosityLevel:()=>aw,XfaLayer:()=>d_,build:()=>AY,createValidAbsoluteUrl:()=>z8,fetchData:()=>dw,getDocument:()=>xY,getFilenameFromUrl:()=>X8,getPdfFilenameFromUrl:()=>J8,getXfaPageViewport:()=>Z8,isDataScheme:()=>hw,isPdfFile:()=>R1,noContextMenu:()=>Ii,normalizeUnicode:()=>q8,setLayerDimensions:()=>Ic,shadow:()=>Ye,stopEvent:()=>Os,version:()=>TY});var jn=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),jU=[1,0,0,1,0,0],pA=[.001,0,0,.001,0,0],N8=1e7,mv=1.35,O8=.35,DQ=O8/mv,Ns={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Po={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},F8="pdfjs_internal_editor_",Fe={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},nt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},L8={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ln={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},yv={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},sn={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var Pf={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var aw={ERRORS:0,WARNINGS:1,INFOS:5},hi={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},$8={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},lw=aw.WARNINGS;function U8(s){Number.isInteger(s)&&(lw=s)}function B8(){return lw}function cw(s){lw>=aw.INFOS&&console.log(`Info: ${s}`)}function Le(s){lw>=aw.WARNINGS&&console.log(`Warning: ${s}`)}function vt(s){throw new Error(s)}function Zt(s,e){s||vt(e)}function V8(s){switch(s?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function z8(s,e=null,t=null){if(!s)return null;try{if(t&&typeof s=="string"&&(t.addDefaultProtocol&&s.startsWith("www.")&&s.match(/\./g)?.length>=2&&(s=`http://${s}`),t.tryConvertEncoding))try{s=W8(s)}catch{}let n=e?new URL(s,e):new URL(s);if(V8(n))return n}catch{}return null}function Ye(s,e,t,n=!1){return Object.defineProperty(s,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}var ya=function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}(),qv=class extends ya{constructor(e,t){super(e,"PasswordException"),this.code=t}},Zf=class extends ya{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},tp=class extends ya{constructor(e){super(e,"InvalidPDFException")}},Cc=class extends ya{constructor(e){super(e,"MissingPDFException")}},Eh=class extends ya{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},gA=class extends ya{constructor(e){super(e,"FormatError")}},or=class extends ya{constructor(e){super(e,"AbortException")}};function WU(s){(typeof s!="object"||s?.length===void 0)&&vt("Invalid argument for bytesToString");let e=s.length,t=8192;if(e<t)return String.fromCharCode.apply(null,s);let n=[];for(let i=0;i<e;i+=t){let r=Math.min(i+t,e),o=s.subarray(i,r);n.push(String.fromCharCode.apply(null,o))}return n.join("")}function uw(s){typeof s!="string"&&vt("Invalid argument for stringToBytes");let e=s.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=s.charCodeAt(n)&255;return t}function H8(s){return String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255)}function D1(s){let e=Object.create(null);for(let[t,n]of s)e[t]=n;return e}function G8(){let s=new Uint8Array(4);return s[0]=1,new Uint32Array(s.buffer,0,1)[0]===1}function j8(){try{return new Function(""),!0}catch{return!1}}var kn=class{static get isLittleEndian(){return Ye(this,"isLittleEndian",G8())}static get isEvalSupported(){return Ye(this,"isEvalSupported",j8())}static get isOffscreenCanvasSupported(){return Ye(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Ye(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?Ye(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent=="string"&&navigator.userAgent.includes("Firefox")}):Ye(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return Ye(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}},cA=Array.from(Array(256).keys(),s=>s.toString(16).padStart(2,"0")),qu,bv,pp,mA,ve=class{static makeHexColor(e,t,n){return`#${cA[e]}${cA[t]}${cA[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){let n=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[n,i]}static applyInverseTransform(e,t){let n=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[i,r]}static getAxialAlignedBoundingBox(e,t){let n=this.applyTransform(e,t),i=this.applyTransform(e.slice(2,4),t),r=this.applyTransform([e[0],e[3]],t),o=this.applyTransform([e[2],e[1]],t);return[Math.min(n[0],i[0],r[0],o[0]),Math.min(n[1],i[1],r[1],o[1]),Math.max(n[0],i[0],r[0],o[0]),Math.max(n[1],i[1],r[1],o[1])]}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){let t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],l=(n+o)/2,u=Math.sqrt((n+o)**2-4*(n*o-r*i))/2,h=l+u||1,d=l-u||1;return[Math.sqrt(h),Math.sqrt(d)]}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>i)return null;let r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[n,r,i,o]}static bezierBoundingBox(e,t,n,i,r,o,l,u,h){return h?(h[0]=Math.min(h[0],e,l),h[1]=Math.min(h[1],t,u),h[2]=Math.max(h[2],e,l),h[3]=Math.max(h[3],t,u)):h=[Math.min(e,l),Math.min(t,u),Math.max(e,l),Math.max(t,u)],N(this,pp,mA).call(this,e,n,r,l,t,i,o,u,3*(-e+3*(n-r)+l),6*(e-2*n+r),3*(n-e),h),N(this,pp,mA).call(this,e,n,r,l,t,i,o,u,3*(-t+3*(i-o)+u),6*(t-2*i+o),3*(i-t),h),h}};qu=new WeakSet,bv=function(e,t,n,i,r,o,l,u,h,d){if(h<=0||h>=1)return;let c=1-h,a=h*h,f=a*h,p=c*(c*(c*e+3*h*t)+3*a*n)+f*i,g=c*(c*(c*r+3*h*o)+3*a*l)+f*u;d[0]=Math.min(d[0],p),d[1]=Math.min(d[1],g),d[2]=Math.max(d[2],p),d[3]=Math.max(d[3],g)},pp=new WeakSet,mA=function(e,t,n,i,r,o,l,u,h,d,c,a){if(Math.abs(h)<1e-12){Math.abs(d)>=1e-12&&N(this,qu,bv).call(this,e,t,n,i,r,o,l,u,-c/d,a);return}let f=d**2-4*c*h;if(f<0)return;let p=Math.sqrt(f),g=2*h;N(this,qu,bv).call(this,e,t,n,i,r,o,l,u,(-d+p)/g,a),N(this,qu,bv).call(this,e,t,n,i,r,o,l,u,(-d-p)/g,a)},D(ve,qu),D(ve,pp);function W8(s){return decodeURIComponent(escape(s))}var uA=null,RU=null;function q8(s){return uA||(uA=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,RU=new Map([["\uFB05","\u017Ft"]])),s.replaceAll(uA,(e,t,n)=>t?t.normalize("NFKC"):RU.get(n))}function Y8(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let s=new Uint8Array(32);return crypto.getRandomValues(s),WU(s)}var k1="pdfjs_internal_id_";function K8(s){return Uint8Array.prototype.toBase64?s.toBase64():btoa(WU(s))}typeof Promise.try!="function"&&(Promise.try=function(s,...e){return new Promise(t=>{t(s(...e))})});var Pr="http://www.w3.org/2000/svg",al=class al{};J(al,"CSS",96),J(al,"PDF",72),J(al,"PDF_TO_CSS_UNITS",al.CSS/al.PDF);var ma=al;async function dw(s,e="text"){if(Ff(s,document.baseURI)){let t=await fetch(s);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{let i=new XMLHttpRequest;i.open("GET",s,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}n(new Error(i.statusText))}},i.send(null)})}var np=class s{constructor({viewBox:e,userUnit:t,scale:n,rotation:i,offsetX:r=0,offsetY:o=0,dontFlip:l=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=i,this.offsetX=r,this.offsetY=o,n*=t;let u=(e[2]+e[0])/2,h=(e[3]+e[1])/2,d,c,a,f;switch(i%=360,i<0&&(i+=360),i){case 180:d=-1,c=0,a=0,f=1;break;case 90:d=0,c=1,a=1,f=0;break;case 270:d=0,c=-1,a=-1,f=0;break;case 0:d=1,c=0,a=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}l&&(a=-a,f=-f);let p,g,m,y;d===0?(p=Math.abs(h-e[1])*n+r,g=Math.abs(u-e[0])*n+o,m=(e[3]-e[1])*n,y=(e[2]-e[0])*n):(p=Math.abs(u-e[0])*n+r,g=Math.abs(h-e[1])*n+o,m=(e[2]-e[0])*n,y=(e[3]-e[1])*n),this.transform=[d*n,c*n,a*n,f*n,p-d*n*u-a*n*h,g-c*n*u-f*n*h],this.width=m,this.height=y}get rawDims(){let{userUnit:e,viewBox:t}=this,n=t.map(i=>i*e);return Ye(this,"rawDims",{pageWidth:n[2]-n[0],pageHeight:n[3]-n[1],pageX:n[0],pageY:n[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new s({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:i,dontFlip:r})}convertToViewportPoint(e,t){return ve.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){let t=ve.applyTransform([e[0],e[1]],this.transform),n=ve.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return ve.applyInverseTransform([e,t],this.transform)}},sp=class extends ya{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}};function hw(s){let e=s.length,t=0;for(;t<e&&s[t].trim()==="";)t++;return s.substring(t,t+5).toLowerCase()==="data:"}function R1(s){return typeof s=="string"&&/\.pdf$/i.test(s)}function X8(s){return[s]=s.split(/[#?]/,1),s.substring(s.lastIndexOf("/")+1)}function J8(s,e="document.pdf"){if(typeof s!="string")return e;if(hw(s))return Le('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;let t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=t.exec(s),r=n.exec(i[1])||n.exec(i[2])||n.exec(i[3]);if(r&&(r=r[0],r.includes("%")))try{r=n.exec(decodeURIComponent(r))[0]}catch{}return r||e}var Yv=class{constructor(){J(this,"started",Object.create(null));J(this,"times",[])}time(e){e in this.started&&Le(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Le(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:n}of this.times)t=Math.max(n.length,t);for(let{name:n,start:i,end:r}of this.times)e.push(`${n.padEnd(t)} ${r-i}ms
`);return e.join("")}};function Ff(s,e){try{let{protocol:t}=e?new URL(s,e):new URL(s);return t==="http:"||t==="https:"}catch{return!1}}function Ii(s){s.preventDefault()}function Os(s){s.preventDefault(),s.stopPropagation()}var gp,Qf=class{static toDateObject(e){if(!e||typeof e!="string")return null;b(this,gp)||k(this,gp,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let t=b(this,gp).exec(e);if(!t)return null;let n=parseInt(t[1],10),i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let l=parseInt(t[5],10);l=l>=0&&l<=59?l:0;let u=parseInt(t[6],10);u=u>=0&&u<=59?u:0;let h=t[7]||"Z",d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let c=parseInt(t[9],10)||0;return c=c>=0&&c<=59?c:0,h==="-"?(o+=d,l+=c):h==="+"&&(o-=d,l-=c),new Date(Date.UTC(n,i,r,o,l,u))}};gp=new WeakMap,D(Qf,gp,void 0);function Z8(s,{scale:e=1,rotation:t=0}){let{width:n,height:i}=s.attributes.style,r=[0,0,parseInt(n),parseInt(i)];return new np({viewBox:r,userUnit:1,scale:e,rotation:t})}function P1(s){if(s.startsWith("#")){let e=parseInt(s.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return s.startsWith("rgb(")?s.slice(4,-1).split(",").map(e=>parseInt(e)):s.startsWith("rgba(")?s.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Le(`Not a valid color format: "${s}"`),[0,0,0])}function Q8(s){let e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(let t of s.keys()){e.style.color=t;let n=window.getComputedStyle(e).color;s.set(t,P1(n))}e.remove()}function It(s){let{a:e,b:t,c:n,d:i,e:r,f:o}=s.getTransform();return[e,t,n,i,r,o]}function Ui(s){let{a:e,b:t,c:n,d:i,e:r,f:o}=s.getTransform().invertSelf();return[e,t,n,i,r,o]}function Ic(s,e,t=!1,n=!0){if(e instanceof np){let{pageWidth:i,pageHeight:r}=e.rawDims,{style:o}=s,l=kn.isCSSRoundSupported,u=`var(--scale-factor) * ${i}px`,h=`var(--scale-factor) * ${r}px`,d=l?`round(down, ${u}, var(--scale-round-x, 1px))`:`calc(${u})`,c=l?`round(down, ${h}, var(--scale-round-y, 1px))`:`calc(${h})`;!t||e.rotation%180===0?(o.width=d,o.height=c):(o.width=c,o.height=d)}n&&s.setAttribute("data-main-rotation",e.rotation)}var ip=class{constructor(){let e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},Mo,ul,fi,dl,mp,yp,E_,qU,S_,YU,T_,KU,Yu,vv,A_,XU,bp,bA,Or=class Or{constructor(e){D(this,S_);D(this,T_);D(this,Yu);D(this,A_);D(this,bp);D(this,Mo,null);D(this,ul,null);D(this,fi,void 0);D(this,dl,null);D(this,mp,null);k(this,fi,e),b(Or,yp)||k(Or,yp,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){let e=k(this,Mo,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");let t=b(this,fi)._uiManager._signal;e.addEventListener("contextmenu",Ii,{signal:t}),e.addEventListener("pointerdown",N(Or,E_,qU),{signal:t});let n=k(this,dl,document.createElement("div"));n.className="buttons",e.append(n);let i=b(this,fi).toolbarPosition;if(i){let{style:r}=e,o=b(this,fi)._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return N(this,A_,XU).call(this),e}get div(){return b(this,Mo)}hide(){b(this,Mo).classList.add("hidden"),b(this,ul)?.hideDropdown()}show(){b(this,Mo).classList.remove("hidden"),b(this,mp)?.shown()}async addAltText(e){let t=await e.render();N(this,Yu,vv).call(this,t),b(this,dl).prepend(t,b(this,bp,bA)),k(this,mp,e)}addColorPicker(e){k(this,ul,e);let t=e.renderButton();N(this,Yu,vv).call(this,t),b(this,dl).prepend(t,b(this,bp,bA))}remove(){b(this,Mo).remove(),b(this,ul)?.destroy(),k(this,ul,null)}};Mo=new WeakMap,ul=new WeakMap,fi=new WeakMap,dl=new WeakMap,mp=new WeakMap,yp=new WeakMap,E_=new WeakSet,qU=function(e){e.stopPropagation()},S_=new WeakSet,YU=function(e){b(this,fi)._focusEventsAllowed=!1,Os(e)},T_=new WeakSet,KU=function(e){b(this,fi)._focusEventsAllowed=!0,Os(e)},Yu=new WeakSet,vv=function(e){let t=b(this,fi)._uiManager._signal;e.addEventListener("focusin",N(this,S_,YU).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",N(this,T_,KU).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Ii,{signal:t})},A_=new WeakSet,XU=function(){let{editorType:e,_uiManager:t}=b(this,fi),n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",b(Or,yp)[e]),N(this,Yu,vv).call(this,n),n.addEventListener("click",i=>{t.delete()},{signal:t._signal}),b(this,dl).append(n)},bp=new WeakSet,bA=function(){let e=document.createElement("div");return e.className="divider",e},D(Or,E_),D(Or,yp,null);var yA=Or,vp,hl,fl,C_,JU,I_,ZU,D_,QU,vA=class{constructor(e){D(this,C_);D(this,I_);D(this,D_);D(this,vp,null);D(this,hl,null);D(this,fl,void 0);k(this,fl,e)}show(e,t,n){let[i,r]=N(this,I_,ZU).call(this,t,n),{style:o}=b(this,hl)||k(this,hl,N(this,C_,JU).call(this));e.append(b(this,hl)),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){b(this,hl).remove()}};vp=new WeakMap,hl=new WeakMap,fl=new WeakMap,C_=new WeakSet,JU=function(){let e=k(this,hl,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Ii,{signal:b(this,fl)._signal});let t=k(this,vp,document.createElement("div"));return t.className="buttons",e.append(t),N(this,D_,QU).call(this),e},I_=new WeakSet,ZU=function(e,t){let n=0,i=0;for(let r of e){let o=r.y+r.height;if(o<n)continue;let l=r.x+(t?r.width:0);if(o>n){i=l,n=o;continue}t?l>i&&(i=l):l<i&&(i=l)}return[t?1-i:i,n]},D_=new WeakSet,QU=function(){let e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let n=b(this,fl)._signal;e.addEventListener("contextmenu",Ii,{signal:n}),e.addEventListener("click",()=>{b(this,fl).highlightSelection("floating_button")},{signal:n}),b(this,vp).append(e)};function Kv(s,e,t){for(let n of t)e.addEventListener(n,s[n].bind(s))}var k_,_A=class{constructor(){D(this,k_,0)}get id(){return`${F8}${Yn(this,k_)._++}`}};k_=new WeakMap;var Ku,_p,Bn,Xu,_v,M1=class M1{constructor(){D(this,Xu);D(this,Ku,Y8());D(this,_p,0);D(this,Bn,null)}static get _isSVGFittingCanvas(){let e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;let r=i.decode().then(()=>(n.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Ye(this,"_isSVGFittingCanvas",r)}async getFromFile(e){let{lastModified:t,name:n,size:i,type:r}=e;return N(this,Xu,_v).call(this,`${t}_${n}_${i}_${r}`,e)}async getFromUrl(e){return N(this,Xu,_v).call(this,e,e)}async getFromBlob(e,t){let n=await t;return N(this,Xu,_v).call(this,e,n)}async getFromId(e){b(this,Bn)||k(this,Bn,new Map);let t=b(this,Bn).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){let{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){b(this,Bn)||k(this,Bn,new Map);let n=b(this,Bn).get(e);if(n?.bitmap)return n.refCounter+=1,n;let i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),n={bitmap:i.transferToImageBitmap(),id:`image_${b(this,Ku)}_${Yn(this,_p)._++}`,refCounter:1,isSvg:!1},b(this,Bn).set(e,n),b(this,Bn).set(n.id,n),n}getSvgUrl(e){let t=b(this,Bn).get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){b(this,Bn)||k(this,Bn,new Map);let t=b(this,Bn).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;let{bitmap:n}=t;if(!t.url&&!t.file){let i=new OffscreenCanvas(n.width,n.height);i.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=i.convertToBlob()}n.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${b(this,Ku)}_`)}};Ku=new WeakMap,_p=new WeakMap,Bn=new WeakMap,Xu=new WeakSet,_v=async function(e,t){b(this,Bn)||k(this,Bn,new Map);let n=b(this,Bn).get(e);if(n===null)return null;if(n?.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${b(this,Ku)}_${Yn(this,_p)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(n.url=t,i=await dw(t,"blob")):t instanceof File?i=n.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){let r=M1._isSVGFittingCanvas,o=new FileReader,l=new Image,u=new Promise((h,d)=>{l.onload=()=>{n.bitmap=l,n.isSvg=!0,h()},o.onload=async()=>{let c=n.svgUrl=o.result;l.src=await r?`${c}#svgView(preserveAspectRatio(none))`:c},l.onerror=o.onerror=d});o.readAsDataURL(i),await u}else n.bitmap=await createImageBitmap(i);n.refCounter=1}catch(i){Le(i),n=null}return b(this,Bn).set(e,n),n&&b(this,Bn).set(n.id,n),n};var wA=M1,Ht,No,wp,Mt,xA=class{constructor(e=128){D(this,Ht,[]);D(this,No,!1);D(this,wp,void 0);D(this,Mt,-1);k(this,wp,e)}add({cmd:e,undo:t,post:n,mustExec:i,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:l=!1}){if(i&&e(),b(this,No))return;let u={cmd:e,undo:t,post:n,type:r};if(b(this,Mt)===-1){b(this,Ht).length>0&&(b(this,Ht).length=0),k(this,Mt,0),b(this,Ht).push(u);return}if(o&&b(this,Ht)[b(this,Mt)].type===r){l&&(u.undo=b(this,Ht)[b(this,Mt)].undo),b(this,Ht)[b(this,Mt)]=u;return}let h=b(this,Mt)+1;h===b(this,wp)?b(this,Ht).splice(0,1):(k(this,Mt,h),h<b(this,Ht).length&&b(this,Ht).splice(h)),b(this,Ht).push(u)}undo(){if(b(this,Mt)===-1)return;k(this,No,!0);let{undo:e,post:t}=b(this,Ht)[b(this,Mt)];e(),t?.(),k(this,No,!1),k(this,Mt,b(this,Mt)-1)}redo(){if(b(this,Mt)<b(this,Ht).length-1){k(this,Mt,b(this,Mt)+1),k(this,No,!0);let{cmd:e,post:t}=b(this,Ht)[b(this,Mt)];e(),t?.(),k(this,No,!1)}}hasSomethingToUndo(){return b(this,Mt)!==-1}hasSomethingToRedo(){return b(this,Mt)<b(this,Ht).length-1}cleanType(e){if(b(this,Mt)!==-1){for(let t=b(this,Mt);t>=0;t--)if(b(this,Ht)[t].type!==e){b(this,Ht).splice(t+1,b(this,Mt)-t),k(this,Mt,t);return}b(this,Ht).length=0,k(this,Mt,-1)}}destroy(){k(this,Ht,null)}};Ht=new WeakMap,No=new WeakMap,wp=new WeakMap,Mt=new WeakMap;var R_,eB,Dc=class{constructor(e){D(this,R_);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=kn.platform;for(let[n,i,r={}]of e)for(let o of n){let l=o.startsWith("mac+");t&&l?(this.callbacks.set(o.slice(4),{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!l&&(this.callbacks.set(o,{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;let n=this.callbacks.get(N(this,R_,eB).call(this,t));if(!n)return;let{callback:i,options:{bubbles:r=!1,args:o=[],checker:l=null}}=n;l&&!l(e,t)||(i.bind(e,...o,t)(),r||Os(t))}};R_=new WeakSet,eB=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let t=this.buffer.join("+");return this.buffer.length=0,t};var P_=class P_{get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return Q8(e),Ye(this,"_colors",e)}convert(e){let t=P1(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(let[n,i]of this._colors)if(i.every((r,o)=>r===t[o]))return P_._colorsMapping.get(n);return t}getHexCode(e){let t=this._colors.get(e);return t?ve.makeHexColor(...t):e}};J(P_,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var EA=P_,Ju,xs,rn,Sn,Zu,Lr,Qu,qs,Oo,pl,ed,gl,zi,pi,ml,xp,Ep,td,Sp,Hi,Fo,nd,Lo,Gi,M_,$o,Tp,Uo,yl,Ap,Cp,fn,pt,$r,bl,Ip,Dp,Bo,ji,Ur,kp,Ys,sd,wv,Rp,SA,N_,tB,O_,nB,id,xv,F_,sB,L_,iB,$_,rB,Pp,TA,U_,oB,Mp,AA,Np,CA,B_,aB,Tn,Xn,gi,Mr,V_,lB,z_,cB,Op,IA,H_,uB,vl,Lf,Fp,DA,Hu=class Hu{constructor(e,t,n,i,r,o,l,u,h,d,c,a,f){D(this,sd);D(this,Rp);D(this,N_);D(this,O_);D(this,id);D(this,F_);D(this,L_);D(this,$_);D(this,Pp);D(this,U_);D(this,Mp);D(this,Np);D(this,B_);D(this,Tn);D(this,gi);D(this,V_);D(this,z_);D(this,Op);D(this,H_);D(this,vl);D(this,Fp);D(this,Ju,new AbortController);D(this,xs,null);D(this,rn,new Map);D(this,Sn,new Map);D(this,Zu,null);D(this,Lr,null);D(this,Qu,null);D(this,qs,new xA);D(this,Oo,null);D(this,pl,null);D(this,ed,0);D(this,gl,new Set);D(this,zi,null);D(this,pi,null);D(this,ml,new Set);J(this,"_editorUndoBar",null);D(this,xp,!1);D(this,Ep,!1);D(this,td,!1);D(this,Sp,null);D(this,Hi,null);D(this,Fo,null);D(this,nd,null);D(this,Lo,!1);D(this,Gi,null);D(this,M_,new _A);D(this,$o,!1);D(this,Tp,!1);D(this,Uo,null);D(this,yl,null);D(this,Ap,null);D(this,Cp,null);D(this,fn,Fe.NONE);D(this,pt,new Set);D(this,$r,null);D(this,bl,null);D(this,Ip,null);D(this,Dp,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});D(this,Bo,[0,0]);D(this,ji,null);D(this,Ur,null);D(this,kp,null);D(this,Ys,null);let p=this._signal=b(this,Ju).signal;k(this,Ur,e),k(this,kp,t),k(this,Zu,n),this._eventBus=i,i._on("editingaction",this.onEditingAction.bind(this),{signal:p}),i._on("pagechanging",this.onPageChanging.bind(this),{signal:p}),i._on("scalechanging",this.onScaleChanging.bind(this),{signal:p}),i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:p}),i._on("setpreference",this.onSetPreference.bind(this),{signal:p}),i._on("switchannotationeditorparams",g=>this.updateParams(g.type,g.value),{signal:p}),N(this,F_,sB).call(this),N(this,B_,aB).call(this),N(this,Pp,TA).call(this),k(this,Lr,r.annotationStorage),k(this,Sp,r.filterFactory),k(this,bl,o),k(this,nd,l||null),k(this,xp,u),k(this,Ep,h),k(this,td,d),k(this,Cp,c||null),this.viewParameters={realScale:ma.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=a||null,this._supportsPinchToZoom=f!==!1}static get _keyboardManager(){let e=Hu.prototype,t=o=>b(o,Ur).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),n=(o,{target:l})=>{if(l instanceof HTMLInputElement){let{type:u}=l;return u!=="text"&&u!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return Ye(this,"_keyboardManager",new Dc([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&b(o,Ur).contains(l)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&b(o,Ur).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){b(this,Ys)?.resolve(),k(this,Ys,null),b(this,Ju)?.abort(),k(this,Ju,null),this._signal=null;for(let e of b(this,Sn).values())e.destroy();b(this,Sn).clear(),b(this,rn).clear(),b(this,ml).clear(),k(this,xs,null),b(this,pt).clear(),b(this,qs).destroy(),b(this,Zu)?.destroy(),b(this,Gi)?.hide(),k(this,Gi,null),b(this,Hi)&&(clearTimeout(b(this,Hi)),k(this,Hi,null)),b(this,ji)&&(clearTimeout(b(this,ji)),k(this,ji,null)),this._editorUndoBar?.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return b(this,Cp)}get useNewAltTextFlow(){return b(this,Ep)}get useNewAltTextWhenAddingImage(){return b(this,td)}get hcmFilter(){return Ye(this,"hcmFilter",b(this,bl)?b(this,Sp).addHCMFilter(b(this,bl).foreground,b(this,bl).background):"none")}get direction(){return Ye(this,"direction",getComputedStyle(b(this,Ur)).direction)}get highlightColors(){return Ye(this,"highlightColors",b(this,nd)?new Map(b(this,nd).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return Ye(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),k(this,pl,e)}setMainHighlightColorPicker(e){k(this,Ap,e)}editAltText(e,t=!1){b(this,Zu)?.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":k(this,td,t);break}}onPageChanging({pageNumber:e}){k(this,ed,e-1)}focusMainContainer(){b(this,Ur).focus()}findParent(e,t){for(let n of b(this,Sn).values()){let{x:i,y:r,width:o,height:l}=n.div.getBoundingClientRect();if(e>=i&&e<=i+o&&t>=r&&t<=r+l)return n}return null}disableUserSelect(e=!1){b(this,kp).classList.toggle("noUserSelect",e)}addShouldRescale(e){b(this,ml).add(e)}removeShouldRescale(e){b(this,ml).delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*ma.PDF_TO_CSS_UNITS;for(let t of b(this,ml))t.onScaleChanging();b(this,pl)?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){let t=document.getSelection();if(!t||t.isCollapsed)return;let{anchorNode:n,anchorOffset:i,focusNode:r,focusOffset:o}=t,l=t.toString(),h=N(this,sd,wv).call(this,t).closest(".textLayer"),d=this.getSelectionBoxes(h);if(!d)return;t.empty();let c=N(this,Rp,SA).call(this,h),a=b(this,fn)===Fe.NONE,f=()=>{c?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:n,anchorOffset:i,focusNode:r,focusOffset:o,text:l}),a&&this.showAllEditors("highlight",!0,!0)};if(a){this.switchToMode(Fe.HIGHLIGHT,f);return}f()}addToAnnotationStorage(e){!e.isEmpty()&&b(this,Lr)&&!b(this,Lr).has(e.id)&&b(this,Lr).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,b(this,Lo)&&(k(this,Lo,!1),N(this,id,xv).call(this,"main_toolbar")),!this.hasSelection)return;let{activeElement:e}=document;for(let t of b(this,pt))if(t.div.contains(e)){k(this,yl,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!b(this,yl))return;let[e,t]=b(this,yl);k(this,yl,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){N(this,Pp,TA).call(this),N(this,Mp,AA).call(this)}removeEditListeners(){N(this,U_,oB).call(this),N(this,Np,CA).call(this)}dragOver(e){for(let{type:t}of e.dataTransfer.items)for(let n of b(this,pi))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(let t of e.dataTransfer.items)for(let n of b(this,pi))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),b(this,xs)?.commitOrRemove(),!this.hasSelection)return;let t=[];for(let n of b(this,pt)){let i=n.serialize(!0);i&&t.push(i)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();let{clipboardData:t}=e;for(let r of t.items)for(let o of b(this,pi))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(r){Le(`paste: "${r.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();let i=this.currentLayer;try{let r=[];for(let u of n){let h=await i.deserialize(u);if(!h)return;r.push(h)}let o=()=>{for(let u of r)N(this,Op,IA).call(this,u);N(this,Fp,DA).call(this,r)},l=()=>{for(let u of r)u.remove()};this.addCommands({cmd:o,undo:l,mustExec:!0})}catch(r){Le(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),b(this,fn)!==Fe.NONE&&!this.isEditorHandlingKeyboard&&Hu._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,b(this,Lo)&&(k(this,Lo,!1),N(this,id,xv).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(N(this,L_,iB).call(this),N(this,Mp,AA).call(this),N(this,Tn,Xn).call(this,{isEditing:b(this,fn)!==Fe.NONE,isEmpty:N(this,vl,Lf).call(this),hasSomethingToUndo:b(this,qs).hasSomethingToUndo(),hasSomethingToRedo:b(this,qs).hasSomethingToRedo(),hasSelectedEditor:!1})):(N(this,$_,rB).call(this),N(this,Np,CA).call(this),N(this,Tn,Xn).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!b(this,pi)){k(this,pi,e);for(let t of b(this,pi))N(this,gi,Mr).call(this,t.defaultPropertiesToUpdate)}}getId(){return b(this,M_).id}get currentLayer(){return b(this,Sn).get(b(this,ed))}getLayer(e){return b(this,Sn).get(e)}get currentPageIndex(){return b(this,ed)}addLayer(e){b(this,Sn).set(e.pageIndex,e),b(this,$o)?e.enable():e.disable()}removeLayer(e){b(this,Sn).delete(e.pageIndex)}async updateMode(e,t=null,n=!1){if(b(this,fn)!==e&&!(b(this,Ys)&&(await b(this,Ys).promise,!b(this,Ys)))){if(k(this,Ys,Promise.withResolvers()),k(this,fn,e),e===Fe.NONE){this.setEditingState(!1),N(this,z_,cB).call(this),this._editorUndoBar?.hide(),b(this,Ys).resolve();return}this.setEditingState(!0),await N(this,V_,lB).call(this),this.unselectAll();for(let i of b(this,Sn).values())i.updateMode(e);if(!t){n&&this.addNewEditorFromKeyboard(),b(this,Ys).resolve();return}for(let i of b(this,rn).values())i.annotationElementId===t?(this.setSelected(i),i.enterInEditMode()):i.unselect();b(this,Ys).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==b(this,fn)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){if(b(this,pi)){switch(e){case nt.CREATE:this.currentLayer.addNewEditor();return;case nt.HIGHLIGHT_DEFAULT_COLOR:b(this,Ap)?.updateColor(t);break;case nt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(b(this,Ip)||k(this,Ip,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(let n of b(this,pt))n.updateParams(e,t);for(let n of b(this,pi))n.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){for(let r of b(this,rn).values())r.editorType===e&&r.show(t);(b(this,Ip)?.get(nt.HIGHLIGHT_SHOW_ALL)??!0)!==t&&N(this,gi,Mr).call(this,[[nt.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(b(this,Tp)!==e){k(this,Tp,e);for(let t of b(this,Sn).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){let t=[];for(let n of b(this,rn).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return b(this,rn).get(e)}addEditor(e){b(this,rn).set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(b(this,Hi)&&clearTimeout(b(this,Hi)),k(this,Hi,setTimeout(()=>{this.focusMainContainer(),k(this,Hi,null)},0))),b(this,rn).delete(e.id),this.unselect(e),(!e.annotationElementId||!b(this,gl).has(e.annotationElementId))&&b(this,Lr)?.remove(e.id)}addDeletedAnnotationElement(e){b(this,gl).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return b(this,gl).has(e)}removeDeletedAnnotationElement(e){b(this,gl).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){b(this,xs)!==e&&(k(this,xs,e),e&&N(this,gi,Mr).call(this,e.propertiesToUpdate))}updateUI(e){b(this,H_,uB)===e&&N(this,gi,Mr).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){N(this,gi,Mr).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(b(this,pt).has(e)){b(this,pt).delete(e),e.unselect(),N(this,Tn,Xn).call(this,{hasSelectedEditor:this.hasSelection});return}b(this,pt).add(e),e.select(),N(this,gi,Mr).call(this,e.propertiesToUpdate),N(this,Tn,Xn).call(this,{hasSelectedEditor:!0})}setSelected(e){b(this,pl)?.commitOrRemove();for(let t of b(this,pt))t!==e&&t.unselect();b(this,pt).clear(),b(this,pt).add(e),e.select(),N(this,gi,Mr).call(this,e.propertiesToUpdate),N(this,Tn,Xn).call(this,{hasSelectedEditor:!0})}isSelected(e){return b(this,pt).has(e)}get firstSelectedEditor(){return b(this,pt).values().next().value}unselect(e){e.unselect(),b(this,pt).delete(e),N(this,Tn,Xn).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return b(this,pt).size!==0}get isEnterHandled(){return b(this,pt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){b(this,qs).undo(),N(this,Tn,Xn).call(this,{hasSomethingToUndo:b(this,qs).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:N(this,vl,Lf).call(this)}),this._editorUndoBar?.hide()}redo(){b(this,qs).redo(),N(this,Tn,Xn).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:b(this,qs).hasSomethingToRedo(),isEmpty:N(this,vl,Lf).call(this)})}addCommands(e){b(this,qs).add(e),N(this,Tn,Xn).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:N(this,vl,Lf).call(this)})}cleanUndoStack(e){b(this,qs).cleanType(e)}delete(){this.commitOrRemove();let e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;let t=e?[e]:[...b(this,pt)],n=()=>{this._editorUndoBar?.show(i,t.length===1?t[0].editorType:t.length);for(let r of t)r.remove()},i=()=>{for(let r of t)N(this,Op,IA).call(this,r)};this.addCommands({cmd:n,undo:i,mustExec:!0})}commitOrRemove(){b(this,xs)?.commitOrRemove()}hasSomethingToControl(){return b(this,xs)||this.hasSelection}selectAll(){for(let e of b(this,pt))e.commit();N(this,Fp,DA).call(this,b(this,rn).values())}unselectAll(){if(!(b(this,xs)&&(b(this,xs).commitOrRemove(),b(this,fn)!==Fe.NONE))&&!b(this,pl)?.commitOrRemove()&&this.hasSelection){for(let e of b(this,pt))e.unselect();b(this,pt).clear(),N(this,Tn,Xn).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;b(this,Bo)[0]+=e,b(this,Bo)[1]+=t;let[i,r]=b(this,Bo),o=[...b(this,pt)],l=1e3;b(this,ji)&&clearTimeout(b(this,ji)),k(this,ji,setTimeout(()=>{k(this,ji,null),b(this,Bo)[0]=b(this,Bo)[1]=0,this.addCommands({cmd:()=>{for(let u of o)b(this,rn).has(u.id)&&u.translateInPage(i,r)},undo:()=>{for(let u of o)b(this,rn).has(u.id)&&u.translateInPage(-i,-r)},mustExec:!1})},l));for(let u of o)u.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),k(this,zi,new Map);for(let e of b(this,pt))b(this,zi).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!b(this,zi))return!1;this.disableUserSelect(!1);let e=b(this,zi);k(this,zi,null);let t=!1;for(let[{x:i,y:r,pageIndex:o},l]of e)l.newX=i,l.newY=r,l.newPageIndex=o,t||(t=i!==l.savedX||r!==l.savedY||o!==l.savedPageIndex);if(!t)return!1;let n=(i,r,o,l)=>{if(b(this,rn).has(i.id)){let u=b(this,Sn).get(l);u?i._setParentAndPosition(u,r,o):(i.pageIndex=l,i.x=r,i.y=o)}};return this.addCommands({cmd:()=>{for(let[i,{newX:r,newY:o,newPageIndex:l}]of e)n(i,r,o,l)},undo:()=>{for(let[i,{savedX:r,savedY:o,savedPageIndex:l}]of e)n(i,r,o,l)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(b(this,zi))for(let n of b(this,zi).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){let t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||b(this,pt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return b(this,xs)===e}getActive(){return b(this,xs)}getMode(){return b(this,fn)}get imageManager(){return Ye(this,"imageManager",new wA)}getSelectionBoxes(e){if(!e)return null;let t=document.getSelection();for(let h=0,d=t.rangeCount;h<d;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;let{x:n,y:i,width:r,height:o}=e.getBoundingClientRect(),l;switch(e.getAttribute("data-main-rotation")){case"90":l=(h,d,c,a)=>({x:(d-i)/o,y:1-(h+c-n)/r,width:a/o,height:c/r});break;case"180":l=(h,d,c,a)=>({x:1-(h+c-n)/r,y:1-(d+a-i)/o,width:c/r,height:a/o});break;case"270":l=(h,d,c,a)=>({x:1-(d+a-i)/o,y:(h-n)/r,width:a/o,height:c/r});break;default:l=(h,d,c,a)=>({x:(h-n)/r,y:(d-i)/o,width:c/r,height:a/o});break}let u=[];for(let h=0,d=t.rangeCount;h<d;h++){let c=t.getRangeAt(h);if(!c.collapsed)for(let{x:a,y:f,width:p,height:g}of c.getClientRects())p===0||g===0||u.push(l(a,f,p,g))}return u.length===0?null:u}addChangedExistingAnnotation({annotationElementId:e,id:t}){(b(this,Qu)||k(this,Qu,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){b(this,Qu)?.delete(e)}renderAnnotationElement(e){let t=b(this,Qu)?.get(e.data.id);if(!t)return;let n=b(this,Lr).getRawValue(t);n&&(b(this,fn)===Fe.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}};Ju=new WeakMap,xs=new WeakMap,rn=new WeakMap,Sn=new WeakMap,Zu=new WeakMap,Lr=new WeakMap,Qu=new WeakMap,qs=new WeakMap,Oo=new WeakMap,pl=new WeakMap,ed=new WeakMap,gl=new WeakMap,zi=new WeakMap,pi=new WeakMap,ml=new WeakMap,xp=new WeakMap,Ep=new WeakMap,td=new WeakMap,Sp=new WeakMap,Hi=new WeakMap,Fo=new WeakMap,nd=new WeakMap,Lo=new WeakMap,Gi=new WeakMap,M_=new WeakMap,$o=new WeakMap,Tp=new WeakMap,Uo=new WeakMap,yl=new WeakMap,Ap=new WeakMap,Cp=new WeakMap,fn=new WeakMap,pt=new WeakMap,$r=new WeakMap,bl=new WeakMap,Ip=new WeakMap,Dp=new WeakMap,Bo=new WeakMap,ji=new WeakMap,Ur=new WeakMap,kp=new WeakMap,Ys=new WeakMap,sd=new WeakSet,wv=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},Rp=new WeakSet,SA=function(e){let{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(let n of b(this,Sn).values())if(n.hasTextLayer(e))return n;return null},N_=new WeakSet,tB=function(){let e=document.getSelection();if(!e||e.isCollapsed)return;let n=N(this,sd,wv).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(n);i&&(b(this,Gi)||k(this,Gi,new vA(this)),b(this,Gi).show(n,i,this.direction==="ltr"))},O_=new WeakSet,nB=function(){let e=document.getSelection();if(!e||e.isCollapsed){b(this,$r)&&(b(this,Gi)?.hide(),k(this,$r,null),N(this,Tn,Xn).call(this,{hasSelectedText:!1}));return}let{anchorNode:t}=e;if(t===b(this,$r))return;let i=N(this,sd,wv).call(this,e).closest(".textLayer");if(!i){b(this,$r)&&(b(this,Gi)?.hide(),k(this,$r,null),N(this,Tn,Xn).call(this,{hasSelectedText:!1}));return}if(b(this,Gi)?.hide(),k(this,$r,t),N(this,Tn,Xn).call(this,{hasSelectedText:!0}),!(b(this,fn)!==Fe.HIGHLIGHT&&b(this,fn)!==Fe.NONE)&&(b(this,fn)===Fe.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),k(this,Lo,this.isShiftKeyDown),!this.isShiftKeyDown)){let r=b(this,fn)===Fe.HIGHLIGHT?N(this,Rp,SA).call(this,i):null;r?.toggleDrawing();let o=new AbortController,l=this.combinedSignal(o),u=h=>{h.type==="pointerup"&&h.button!==0||(o.abort(),r?.toggleDrawing(!0),h.type==="pointerup"&&N(this,id,xv).call(this,"main_toolbar"))};window.addEventListener("pointerup",u,{signal:l}),window.addEventListener("blur",u,{signal:l})}},id=new WeakSet,xv=function(e=""){b(this,fn)===Fe.HIGHLIGHT?this.highlightSelection(e):b(this,xp)&&N(this,N_,tB).call(this)},F_=new WeakSet,sB=function(){document.addEventListener("selectionchange",N(this,O_,nB).bind(this),{signal:this._signal})},L_=new WeakSet,iB=function(){if(b(this,Fo))return;k(this,Fo,new AbortController);let e=this.combinedSignal(b(this,Fo));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},$_=new WeakSet,rB=function(){b(this,Fo)?.abort(),k(this,Fo,null)},Pp=new WeakSet,TA=function(){if(b(this,Uo))return;k(this,Uo,new AbortController);let e=this.combinedSignal(b(this,Uo));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},U_=new WeakSet,oB=function(){b(this,Uo)?.abort(),k(this,Uo,null)},Mp=new WeakSet,AA=function(){if(b(this,Oo))return;k(this,Oo,new AbortController);let e=this.combinedSignal(b(this,Oo));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},Np=new WeakSet,CA=function(){b(this,Oo)?.abort(),k(this,Oo,null)},B_=new WeakSet,aB=function(){let e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Tn=new WeakSet,Xn=function(e){Object.entries(e).some(([n,i])=>b(this,Dp)[n]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(b(this,Dp),e)}),b(this,fn)===Fe.HIGHLIGHT&&e.hasSelectedEditor===!1&&N(this,gi,Mr).call(this,[[nt.HIGHLIGHT_FREE,!0]]))},gi=new WeakSet,Mr=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},V_=new WeakSet,lB=async function(){if(!b(this,$o)){k(this,$o,!0);let e=[];for(let t of b(this,Sn).values())e.push(t.enable());await Promise.all(e);for(let t of b(this,rn).values())t.enable()}},z_=new WeakSet,cB=function(){if(this.unselectAll(),b(this,$o)){k(this,$o,!1);for(let e of b(this,Sn).values())e.disable();for(let e of b(this,rn).values())e.disable()}},Op=new WeakSet,IA=function(e){let t=b(this,Sn).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},H_=new WeakSet,uB=function(){let e=null;for(e of b(this,pt));return e},vl=new WeakSet,Lf=function(){if(b(this,rn).size===0)return!0;if(b(this,rn).size===1)for(let e of b(this,rn).values())return e.isEmpty();return!1},Fp=new WeakSet,DA=function(e){for(let t of b(this,pt))t.unselect();b(this,pt).clear();for(let t of e)t.isEmpty()||(b(this,pt).add(t),t.select());N(this,Tn,Xn).call(this,{hasSelectedEditor:this.hasSelection})},J(Hu,"TRANSLATE_SMALL",1),J(Hu,"TRANSLATE_BIG",10);var kc=Hu,pn,Wi,mi,rd,qi,Es,od,Yi,hs,Br,_l,Ki,Vo,wl,$f,ad,Ev,Jn=class Jn{constructor(e){D(this,wl);D(this,ad);D(this,pn,null);D(this,Wi,!1);D(this,mi,null);D(this,rd,null);D(this,qi,null);D(this,Es,null);D(this,od,!1);D(this,Yi,null);D(this,hs,null);D(this,Br,null);D(this,_l,null);D(this,Ki,!1);k(this,hs,e),k(this,Ki,e._uiManager.useNewAltTextFlow),b(Jn,Vo)||k(Jn,Vo,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){Jn._l10n??(Jn._l10n=e)}async render(){let e=k(this,mi,document.createElement("button"));e.className="altText",e.tabIndex="0";let t=k(this,rd,document.createElement("span"));e.append(t),b(this,Ki)?(e.classList.add("new"),e.setAttribute("data-l10n-id",b(Jn,Vo).missing),t.setAttribute("data-l10n-id",b(Jn,Vo)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let n=b(this,hs)._uiManager._signal;e.addEventListener("contextmenu",Ii,{signal:n}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});let i=r=>{r.preventDefault(),b(this,hs)._uiManager.editAltText(b(this,hs)),b(this,Ki)&&b(this,hs)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:b(this,wl,$f)}})};return e.addEventListener("click",i,{capture:!0,signal:n}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(k(this,od,!0),i(r))},{signal:n}),await N(this,ad,Ev).call(this),e}finish(){b(this,mi)&&(b(this,mi).focus({focusVisible:b(this,od)}),k(this,od,!1))}isEmpty(){return b(this,Ki)?b(this,pn)===null:!b(this,pn)&&!b(this,Wi)}hasData(){return b(this,Ki)?b(this,pn)!==null||!!b(this,Br):this.isEmpty()}get guessedText(){return b(this,Br)}async setGuessedText(e){b(this,pn)===null&&(k(this,Br,e),k(this,_l,await Jn._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),N(this,ad,Ev).call(this))}toggleAltTextBadge(e=!1){if(!b(this,Ki)||b(this,pn)){b(this,Yi)?.remove(),k(this,Yi,null);return}if(!b(this,Yi)){let t=k(this,Yi,document.createElement("div"));t.className="noAltTextBadge",b(this,hs).div.append(t)}b(this,Yi).classList.toggle("hidden",!e)}serialize(e){let t=b(this,pn);return!e&&b(this,Br)===t&&(t=b(this,_l)),{altText:t,decorative:b(this,Wi),guessedText:b(this,Br),textWithDisclaimer:b(this,_l)}}get data(){return{altText:b(this,pn),decorative:b(this,Wi)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:i,cancel:r=!1}){n&&(k(this,Br,n),k(this,_l,i)),!(b(this,pn)===e&&b(this,Wi)===t)&&(r||(k(this,pn,e),k(this,Wi,t)),N(this,ad,Ev).call(this))}toggle(e=!1){b(this,mi)&&(!e&&b(this,Es)&&(clearTimeout(b(this,Es)),k(this,Es,null)),b(this,mi).disabled=!e)}shown(){b(this,hs)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:b(this,wl,$f)}})}destroy(){b(this,mi)?.remove(),k(this,mi,null),k(this,rd,null),k(this,qi,null),b(this,Yi)?.remove(),k(this,Yi,null)}};pn=new WeakMap,Wi=new WeakMap,mi=new WeakMap,rd=new WeakMap,qi=new WeakMap,Es=new WeakMap,od=new WeakMap,Yi=new WeakMap,hs=new WeakMap,Br=new WeakMap,_l=new WeakMap,Ki=new WeakMap,Vo=new WeakMap,wl=new WeakSet,$f=function(){return b(this,pn)&&"added"||b(this,pn)===null&&this.guessedText&&"review"||"missing"},ad=new WeakSet,Ev=async function(){let e=b(this,mi);if(!e)return;if(b(this,Ki)){if(e.classList.toggle("done",!!b(this,pn)),e.setAttribute("data-l10n-id",b(Jn,Vo)[b(this,wl,$f)]),b(this,rd)?.setAttribute("data-l10n-id",b(Jn,Vo)[`${b(this,wl,$f)}-label`]),!b(this,pn)){b(this,qi)?.remove();return}}else{if(!b(this,pn)&&!b(this,Wi)){e.classList.remove("done"),b(this,qi)?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=b(this,qi);if(!t){k(this,qi,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${b(this,hs).id}`;let i=100,r=b(this,hs)._uiManager._signal;r.addEventListener("abort",()=>{clearTimeout(b(this,Es)),k(this,Es,null)},{once:!0}),e.addEventListener("mouseenter",()=>{k(this,Es,setTimeout(()=>{k(this,Es,null),b(this,qi).classList.add("show"),b(this,hs)._reportTelemetry({action:"alt_text_tooltip"})},i))},{signal:r}),e.addEventListener("mouseleave",()=>{b(this,Es)&&(clearTimeout(b(this,Es)),k(this,Es,null)),b(this,qi)?.classList.remove("show")},{signal:r})}b(this,Wi)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=b(this,pn)),t.parentNode||e.append(t),b(this,hs).getImageForAltText()?.setAttribute("aria-describedby",t.id)},D(Jn,Vo,null),J(Jn,"_l10n",null);var Xv=Jn,Lp,xl,$p,Up,Bp,Vp,zp,ld,Vr,El,zo,G_,dB,j_,hB,Hp,kA,N1=class N1{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:i=null,onPinching:r=null,onPinchEnd:o=null,signal:l}){D(this,G_);D(this,j_);D(this,Hp);D(this,Lp,void 0);D(this,xl,!1);D(this,$p,null);D(this,Up,void 0);D(this,Bp,void 0);D(this,Vp,void 0);D(this,zp,void 0);D(this,ld,void 0);D(this,Vr,null);D(this,El,void 0);D(this,zo,null);k(this,Lp,e),k(this,$p,n),k(this,Up,t),k(this,Bp,i),k(this,Vp,r),k(this,zp,o),k(this,El,new AbortController),k(this,ld,AbortSignal.any([l,b(this,El).signal])),e.addEventListener("touchstart",N(this,G_,dB).bind(this),{passive:!1,signal:b(this,ld)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return Ye(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){b(this,El)?.abort(),k(this,El,null)}};Lp=new WeakMap,xl=new WeakMap,$p=new WeakMap,Up=new WeakMap,Bp=new WeakMap,Vp=new WeakMap,zp=new WeakMap,ld=new WeakMap,Vr=new WeakMap,El=new WeakMap,zo=new WeakMap,G_=new WeakSet,dB=function(e){var i,r,o;if((i=b(this,Up))!=null&&i.call(this)||e.touches.length<2)return;if(!b(this,zo)){k(this,zo,new AbortController);let l=AbortSignal.any([b(this,ld),b(this,zo).signal]),u=b(this,Lp),h={signal:l,passive:!1};u.addEventListener("touchmove",N(this,j_,hB).bind(this),h),u.addEventListener("touchend",N(this,Hp,kA).bind(this),h),u.addEventListener("touchcancel",N(this,Hp,kA).bind(this),h),(r=b(this,Bp))==null||r.call(this)}if(Os(e),e.touches.length!==2||(o=b(this,$p))!=null&&o.call(this)){k(this,Vr,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),k(this,Vr,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},j_=new WeakSet,hB=function(e){var E;if(!b(this,Vr)||e.touches.length!==2)return;let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);let{screenX:i,screenY:r}=t,{screenX:o,screenY:l}=n,u=b(this,Vr),{touch0X:h,touch0Y:d,touch1X:c,touch1Y:a}=u,f=c-h,p=a-d,g=o-i,m=l-r,y=Math.hypot(g,m)||1,_=Math.hypot(f,p)||1;if(!b(this,xl)&&Math.abs(_-y)<=N1.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(u.touch0X=i,u.touch0Y=r,u.touch1X=o,u.touch1Y=l,e.preventDefault(),!b(this,xl)){k(this,xl,!0);return}let x=[(i+o)/2,(r+l)/2];(E=b(this,Vp))==null||E.call(this,x,_,y)},Hp=new WeakSet,kA=function(e){var t;b(this,zo).abort(),k(this,zo,null),(t=b(this,zp))==null||t.call(this),b(this,Vr)&&(e.preventDefault(),k(this,Vr,null),k(this,xl,!1))};var Jv=N1,Sl,yi,Et,cd,Ho,Gp,Tl,An,Al,zr,Go,jp,Cl,Ss,Wp,Il,Hr,Xi,ud,dd,Ks,Dl,qp,W_,Yp,RA,Kp,PA,hd,Sv,q_,fB,Y_,pB,Xp,MA,fd,Tv,Jp,NA,K_,gB,X_,mB,J_,yB,Zp,OA,Z_,bB,Qp,FA,Q_,vB,e0,_B,t0,wB,eg,LA,kl,Uf,Ve=class Ve{constructor(e){D(this,Yp);D(this,hd);D(this,q_);D(this,Y_);D(this,Xp);D(this,fd);D(this,Jp);D(this,K_);D(this,X_);D(this,J_);D(this,Zp);D(this,Z_);D(this,Qp);D(this,Q_);D(this,e0);D(this,t0);D(this,eg);D(this,kl);D(this,Sl,null);D(this,yi,null);D(this,Et,null);D(this,cd,!1);D(this,Ho,null);D(this,Gp,"");D(this,Tl,!1);D(this,An,null);D(this,Al,null);D(this,zr,null);D(this,Go,null);D(this,jp,"");D(this,Cl,!1);D(this,Ss,null);D(this,Wp,!1);D(this,Il,!1);D(this,Hr,!1);D(this,Xi,null);D(this,ud,0);D(this,dd,0);D(this,Ks,null);D(this,Dl,null);J(this,"_editToolbar",null);J(this,"_initialOptions",Object.create(null));J(this,"_initialData",null);J(this,"_isVisible",!0);J(this,"_uiManager",null);J(this,"_focusEventsAllowed",!0);D(this,qp,!1);D(this,W_,Ve._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;let{rotation:t,rawDims:{pageWidth:n,pageHeight:i,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,i],this.pageTranslation=[r,o];let[l,u]=this.parentDimensions;this.x=e.x/l,this.y=e.y/u,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){let e=Ve.prototype._resizeWithKeyboard,t=kc.TRANSLATE_SMALL,n=kc.TRANSLATE_BIG;return Ye(this,"_resizerKeyboardManager",new Dc([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],Ve.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return Ye(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let t=new $A({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Ve._l10n??(Ve._l10n=e),Ve._l10nResizer||(Ve._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Ve._borderLineWidth!==-1)return;let n=getComputedStyle(document.documentElement);Ve._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){vt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return b(this,qp)}set _isDraggable(e){k(this,qp,e),this.div?.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){let[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=b(this,W_)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):N(this,kl,Uf).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(b(this,Cl)?k(this,Cl,!1):this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,i){let[r,o]=this.parentDimensions;[n,i]=this.screenToPageTranslation(n,i),this.x=(e+n)/r,this.y=(t+i)/o,this.fixAndSetPosition()}translate(e,t){N(this,Yp,RA).call(this,this.parentDimensions,e,t)}translateInPage(e,t){b(this,Ss)||k(this,Ss,[this.x,this.y,this.width,this.height]),N(this,Yp,RA).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){b(this,Ss)||k(this,Ss,[this.x,this.y,this.width,this.height]);let{div:n,parentDimensions:[i,r]}=this;if(this.x+=e/i,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:c,y:a}=this.div.getBoundingClientRect();this.parent.findNewParent(this,c,a)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:l}=this,[u,h]=this.getBaseTranslation();o+=u,l+=h;let{style:d}=n;d.left=`${(100*o).toFixed(2)}%`,d.top=`${(100*l).toFixed(2)}%`,this._onTranslating(o,l),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!b(this,Ss)&&(b(this,Ss)[0]!==this.x||b(this,Ss)[1]!==this.y)}get _hasBeenResized(){return!!b(this,Ss)&&(b(this,Ss)[2]!==this.width||b(this,Ss)[3]!==this.height)}getBaseTranslation(){let[e,t]=this.parentDimensions,{_borderLineWidth:n}=Ve,i=n/e,r=n/t;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){let{div:{style:t},pageDimensions:[n,i]}=this,{x:r,y:o,width:l,height:u}=this;if(l*=n,u*=i,r*=n,o*=i,this._mustFixPosition)switch(e){case 0:r=Math.max(0,Math.min(n-l,r)),o=Math.max(0,Math.min(i-u,o));break;case 90:r=Math.max(0,Math.min(n-u,r)),o=Math.min(i,Math.max(l,o));break;case 180:r=Math.min(n,Math.max(l,r)),o=Math.min(i,Math.max(u,o));break;case 270:r=Math.min(n,Math.max(u,r)),o=Math.max(0,Math.min(i-l,o));break}this.x=r/=n,this.y=o/=i;let[h,d]=this.getBaseTranslation();r+=h,o+=d,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return N(n=Ve,Kp,PA).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return N(n=Ve,Kp,PA).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(e,t){let[n,i]=this.parentDimensions,{style:r}=this.div;r.width=`${(100*e/n).toFixed(2)}%`,b(this,Tl)||(r.height=`${(100*t/i).toFixed(2)}%`)}fixDims(){let{style:e}=this.div,{height:t,width:n}=e,i=n.endsWith("%"),r=!b(this,Tl)&&t.endsWith("%");if(i&&r)return;let[o,l]=this.parentDimensions;i||(e.width=`${(100*parseFloat(n)/o).toFixed(2)}%`),!b(this,Tl)&&!r&&(e.height=`${(100*parseFloat(t)/l).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){b(this,Et)?.finish()}async addEditToolbar(){return this._editToolbar||b(this,Il)?this._editToolbar:(this._editToolbar=new yA(this),this.div.append(this._editToolbar.render()),b(this,Et)&&await this._editToolbar.addAltText(b(this,Et)),this._editToolbar)}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,b(this,Et)?.destroy())}addContainer(e){let t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){b(this,Et)||(Xv.initialize(Ve._l10n),k(this,Et,new Xv(this)),b(this,Sl)&&(b(this,Et).data=b(this,Sl),k(this,Sl,null)),await this.addEditToolbar())}get altTextData(){return b(this,Et)?.data}set altTextData(e){b(this,Et)&&(b(this,Et).data=e)}get guessedAltText(){return b(this,Et)?.guessedText}async setGuessedAltText(e){await b(this,Et)?.setGuessedText(e)}serializeAltText(e){return b(this,Et)?.serialize(e)}hasAltText(){return!!b(this,Et)&&!b(this,Et).isEmpty()}hasAltTextData(){return b(this,Et)?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=b(this,cd)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),N(this,Qp,FA).call(this);let[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);let[n,i]=this.getInitialTranslation();return this.translate(n,i),Kv(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(b(this,Dl)||k(this,Dl,new Jv({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:N(this,K_,gB).bind(this),onPinching:N(this,X_,mB).bind(this),onPinchEnd:N(this,J_,yB).bind(this),signal:this._uiManager._signal}))),this._uiManager._editorUndoBar?.hide(),this.div}pointerdown(e){let{isMac:t}=kn.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(k(this,Cl,!0),this._isDraggable){N(this,Z_,bB).call(this,e);return}N(this,Zp,OA).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){b(this,Xi)&&clearTimeout(b(this,Xi)),k(this,Xi,setTimeout(()=>{k(this,Xi,null),this.parent?.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){let i=this.parentScale,[r,o]=this.pageDimensions,[l,u]=this.pageTranslation,h=e/i,d=t/i,c=this.x*r,a=this.y*o,f=this.width*r,p=this.height*o;switch(n){case 0:return[c+h+l,o-a-d-p+u,c+h+f+l,o-a-d+u];case 90:return[c+d+l,o-a+h+u,c+d+p+l,o-a+h+f+u];case 180:return[c-h-f+l,o-a+d+u,c-h+l,o-a+d+p+u];case 270:return[c-d-p+l,o-a-h-f+u,c-d+l,o-a-h+u];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){let[n,i,r,o]=e,l=r-n,u=o-i;switch(this.rotation){case 0:return[n,t-o,l,u];case 90:return[n,t-i,u,l];case 180:return[r,t-i,l,u];case 270:return[r,t-o,u,l];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){k(this,Il,!0)}disableEditMode(){k(this,Il,!1)}isInEditMode(){return b(this,Il)}shouldGetKeyboardEvents(){return b(this,Hr)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:e,left:t,bottom:n,right:i}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&i>0&&e<r&&n>0}rebuild(){N(this,Qp,FA).call(this)}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){vt("An editor must be serializable")}static async deserialize(e,t,n){let i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n});i.rotation=e.rotation,k(i,Sl,e.accessibilityData);let[r,o]=i.pageDimensions,[l,u,h,d]=i.getRectInCurrentCoords(e.rect,o);return i.x=l/r,i.y=u/o,i.width=h/r,i.height=d/o,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(b(this,Go)?.abort(),k(this,Go,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),b(this,Xi)&&(clearTimeout(b(this,Xi)),k(this,Xi,null)),N(this,kl,Uf).call(this),this.removeEditToolbar(),b(this,Ks)){for(let e of b(this,Ks).values())clearTimeout(e);k(this,Ks,null)}this.parent=null,b(this,Dl)?.destroy(),k(this,Dl,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(N(this,q_,fB).call(this),b(this,An).classList.remove("hidden"),Kv(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),k(this,zr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let t=b(this,An).children;if(!b(this,yi)){k(this,yi,Array.from(t));let o=N(this,Q_,vB).bind(this),l=N(this,e0,_B).bind(this),u=this._uiManager._signal;for(let h of b(this,yi)){let d=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",o,{signal:u}),h.addEventListener("blur",l,{signal:u}),h.addEventListener("focus",N(this,t0,wB).bind(this,d),{signal:u}),h.setAttribute("data-l10n-id",Ve._l10nResizer[d])}}let n=b(this,yi)[0],i=0;for(let o of t){if(o===n)break;i++}let r=(360-this.rotation+this.parentRotation)%360/90*(b(this,yi).length/4);if(r!==i){if(r<i)for(let l=0;l<i-r;l++)b(this,An).append(b(this,An).firstChild);else if(r>i)for(let l=0;l<r-i;l++)b(this,An).firstChild.before(b(this,An).lastChild);let o=0;for(let l of t){let h=b(this,yi)[o++].getAttribute("data-resizer-name");l.setAttribute("data-l10n-id",Ve._l10nResizer[h])}}N(this,eg,LA).call(this,0),k(this,Hr,!0),b(this,An).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){b(this,Hr)&&N(this,Jp,NA).call(this,b(this,jp),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){N(this,kl,Uf).call(this),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),b(this,Et)?.toggleAltTextBadge(!1)}unselect(){b(this,An)?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),b(this,Et)?.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return b(this,Wp)}set isEditing(e){k(this,Wp,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){k(this,Tl,!0);let n=e/t,{style:i}=this.div;i.aspectRatio=n,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){b(this,Ks)||k(this,Ks,new Map);let{action:n}=e,i=b(this,Ks).get(n);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),b(this,Ks).delete(n),b(this,Ks).size===0&&k(this,Ks,null)},Ve._telemetryTimeout),b(this,Ks).set(n,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),k(this,cd,!1)}disable(){this.div&&(this.div.tabIndex=-1),k(this,cd,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){let n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){let{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Sl=new WeakMap,yi=new WeakMap,Et=new WeakMap,cd=new WeakMap,Ho=new WeakMap,Gp=new WeakMap,Tl=new WeakMap,An=new WeakMap,Al=new WeakMap,zr=new WeakMap,Go=new WeakMap,jp=new WeakMap,Cl=new WeakMap,Ss=new WeakMap,Wp=new WeakMap,Il=new WeakMap,Hr=new WeakMap,Xi=new WeakMap,ud=new WeakMap,dd=new WeakMap,Ks=new WeakMap,Dl=new WeakMap,qp=new WeakMap,W_=new WeakMap,Yp=new WeakSet,RA=function([e,t],n,i){[n,i]=this.screenToPageTranslation(n,i),this.x+=n/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Kp=new WeakSet,PA=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},hd=new WeakSet,Sv=function(e){switch(e){case 90:{let[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{let[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},q_=new WeakSet,fB=function(){if(b(this,An))return;k(this,An,document.createElement("div")),b(this,An).classList.add("resizers");let e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(let n of e){let i=document.createElement("div");b(this,An).append(i),i.classList.add("resizer",n),i.setAttribute("data-resizer-name",n),i.addEventListener("pointerdown",N(this,Y_,pB).bind(this,n),{signal:t}),i.addEventListener("contextmenu",Ii,{signal:t}),i.tabIndex=-1}this.div.prepend(b(this,An))},Y_=new WeakSet,pB=function(e,t){t.preventDefault();let{isMac:n}=kn.platform;if(t.button!==0||t.ctrlKey&&n)return;b(this,Et)?.toggle(!1);let i=this._isDraggable;this._isDraggable=!1,k(this,Al,[t.screenX,t.screenY]);let r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",N(this,Jp,NA).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",Os,{passive:!1,signal:o}),window.addEventListener("contextmenu",Ii,{signal:o}),k(this,zr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let l=this.parent.div.style.cursor,u=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;let h=()=>{r.abort(),this.parent.togglePointerEvents(!0),b(this,Et)?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=l,this.div.style.cursor=u,N(this,fd,Tv).call(this)};window.addEventListener("pointerup",h,{signal:o}),window.addEventListener("blur",h,{signal:o})},Xp=new WeakSet,MA=function(e,t,n,i){this.width=n,this.height=i,this.x=e,this.y=t;let[r,o]=this.parentDimensions;this.setDims(r*n,o*i),this.fixAndSetPosition(),this._onResized()},fd=new WeakSet,Tv=function(){if(!b(this,zr))return;let{savedX:e,savedY:t,savedWidth:n,savedHeight:i}=b(this,zr);k(this,zr,null);let r=this.x,o=this.y,l=this.width,u=this.height;r===e&&o===t&&l===n&&u===i||this.addCommands({cmd:N(this,Xp,MA).bind(this,r,o,l,u),undo:N(this,Xp,MA).bind(this,e,t,n,i),mustExec:!0})},Jp=new WeakSet,NA=function(e,t){let[n,i]=this.parentDimensions,r=this.x,o=this.y,l=this.width,u=this.height,h=Ve.MIN_SIZE/n,d=Ve.MIN_SIZE/i,c=N(this,hd,Sv).call(this,this.rotation),a=(M,$)=>[c[0]*M+c[2]*$,c[1]*M+c[3]*$],f=N(this,hd,Sv).call(this,360-this.rotation),p=(M,$)=>[f[0]*M+f[2]*$,f[1]*M+f[3]*$],g,m,y=!1,_=!1;switch(e){case"topLeft":y=!0,g=(M,$)=>[0,0],m=(M,$)=>[M,$];break;case"topMiddle":g=(M,$)=>[M/2,0],m=(M,$)=>[M/2,$];break;case"topRight":y=!0,g=(M,$)=>[M,0],m=(M,$)=>[0,$];break;case"middleRight":_=!0,g=(M,$)=>[M,$/2],m=(M,$)=>[0,$/2];break;case"bottomRight":y=!0,g=(M,$)=>[M,$],m=(M,$)=>[0,0];break;case"bottomMiddle":g=(M,$)=>[M/2,$],m=(M,$)=>[M/2,0];break;case"bottomLeft":y=!0,g=(M,$)=>[0,$],m=(M,$)=>[M,0];break;case"middleLeft":_=!0,g=(M,$)=>[0,$/2],m=(M,$)=>[M,$/2];break}let x=g(l,u),E=m(l,u),S=a(...E),T=Ve._round(r+S[0]),C=Ve._round(o+S[1]),I=1,A=1,P,F;if(t.fromKeyboard)({deltaX:P,deltaY:F}=t);else{let{screenX:M,screenY:$}=t,[oe,Z]=b(this,Al);[P,F]=this.screenToPageTranslation(M-oe,$-Z),b(this,Al)[0]=M,b(this,Al)[1]=$}if([P,F]=p(P/n,F/i),y){let M=Math.hypot(l,u);I=A=Math.max(Math.min(Math.hypot(E[0]-x[0]-P,E[1]-x[1]-F)/M,1/l,1/u),h/l,d/u)}else _?I=Math.max(h,Math.min(1,Math.abs(E[0]-x[0]-P)))/l:A=Math.max(d,Math.min(1,Math.abs(E[1]-x[1]-F)))/u;let H=Ve._round(l*I),z=Ve._round(u*A);S=a(...m(H,z));let B=T-S[0],V=C-S[1];b(this,Ss)||k(this,Ss,[this.x,this.y,this.width,this.height]),this.width=H,this.height=z,this.x=B,this.y=V,this.setDims(n*H,i*z),this.fixAndSetPosition(),this._onResizing()},K_=new WeakSet,gB=function(){k(this,zr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),b(this,Et)?.toggle(!1),this.parent.togglePointerEvents(!1)},X_=new WeakSet,mB=function(e,t,n){let r=.7*(n/t)+1-.7;if(r===1)return;let o=N(this,hd,Sv).call(this,this.rotation),l=(T,C)=>[o[0]*T+o[2]*C,o[1]*T+o[3]*C],[u,h]=this.parentDimensions,d=this.x,c=this.y,a=this.width,f=this.height,p=Ve.MIN_SIZE/u,g=Ve.MIN_SIZE/h;r=Math.max(Math.min(r,1/a,1/f),p/a,g/f);let m=Ve._round(a*r),y=Ve._round(f*r);if(m===a&&y===f)return;b(this,Ss)||k(this,Ss,[d,c,a,f]);let _=l(a/2,f/2),x=Ve._round(d+_[0]),E=Ve._round(c+_[1]),S=l(m/2,y/2);this.x=x-S[0],this.y=E-S[1],this.width=m,this.height=y,this.setDims(u*m,h*y),this.fixAndSetPosition(),this._onResizing()},J_=new WeakSet,yB=function(){b(this,Et)?.toggle(!0),this.parent.togglePointerEvents(!0),N(this,fd,Tv).call(this)},Zp=new WeakSet,OA=function(e){let{isMac:t}=kn.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},Z_=new WeakSet,bB=function(e){let{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1,i=new AbortController,r=this._uiManager.combinedSignal(i),o={capture:!0,passive:!1,signal:r},l=h=>{i.abort(),k(this,Ho,null),k(this,Cl,!1),this._uiManager.endDragSession()||N(this,Zp,OA).call(this,h),n&&this._onStopDragging()};t&&(k(this,ud,e.clientX),k(this,dd,e.clientY),k(this,Ho,e.pointerId),k(this,Gp,e.pointerType),window.addEventListener("pointermove",h=>{n||(n=!0,this._onStartDragging());let{clientX:d,clientY:c,pointerId:a}=h;if(a!==b(this,Ho)){Os(h);return}let[f,p]=this.screenToPageTranslation(d-b(this,ud),c-b(this,dd));k(this,ud,d),k(this,dd,c),this._uiManager.dragSelectedEditors(f,p)},o),window.addEventListener("touchmove",Os,o),window.addEventListener("pointerdown",h=>{h.pointerType===b(this,Gp)&&(b(this,Dl)||h.isPrimary)&&l(h),Os(h)},o));let u=h=>{if(!b(this,Ho)||b(this,Ho)===h.pointerId){l(h);return}Os(h)};window.addEventListener("pointerup",u,{signal:r}),window.addEventListener("blur",u,{signal:r})},Qp=new WeakSet,FA=function(){if(b(this,Go)||!this.div)return;k(this,Go,new AbortController);let e=this._uiManager.combinedSignal(b(this,Go));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},Q_=new WeakSet,vB=function(e){Ve._resizerKeyboardManager.exec(this,e)},e0=new WeakSet,_B=function(e){b(this,Hr)&&e.relatedTarget?.parentNode!==b(this,An)&&N(this,kl,Uf).call(this)},t0=new WeakSet,wB=function(e){k(this,jp,b(this,Hr)?e:"")},eg=new WeakSet,LA=function(e){if(b(this,yi))for(let t of b(this,yi))t.tabIndex=e},kl=new WeakSet,Uf=function(){k(this,Hr,!1),N(this,eg,LA).call(this,-1),N(this,fd,Tv).call(this)},D(Ve,Kp),J(Ve,"_l10n",null),J(Ve,"_l10nResizer",null),J(Ve,"_borderLineWidth",-1),J(Ve,"_colorManager",new EA),J(Ve,"_zIndex",1),J(Ve,"_telemetryTimeout",1e3);var Ot=Ve,$A=class extends Ot{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},PU=3285377520,Ws=4294901760,Bi=65535,Zv=class{constructor(e){this.h1=e?e&4294967295:PU,this.h2=e?e&4294967295:PU}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let g=0,m=e.length;g<m;g++){let y=e.charCodeAt(g);y<=255?t[n++]=y:(t[n++]=y>>>8,t[n++]=y&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let i=n>>2,r=n-i*4,o=new Uint32Array(t.buffer,0,i),l=0,u=0,h=this.h1,d=this.h2,c=3432918353,a=461845907,f=c&Bi,p=a&Bi;for(let g=0;g<i;g++)g&1?(l=o[g],l=l*c&Ws|l*f&Bi,l=l<<15|l>>>17,l=l*a&Ws|l*p&Bi,h^=l,h=h<<13|h>>>19,h=h*5+3864292196):(u=o[g],u=u*c&Ws|u*f&Bi,u=u<<15|u>>>17,u=u*a&Ws|u*p&Bi,d^=u,d=d<<13|d>>>19,d=d*5+3864292196);switch(l=0,r){case 3:l^=t[i*4+2]<<16;case 2:l^=t[i*4+1]<<8;case 1:l^=t[i*4],l=l*c&Ws|l*f&Bi,l=l<<15|l>>>17,l=l*a&Ws|l*p&Bi,i&1?h^=l:d^=l}this.h1=h,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Ws|e*36045&Bi,t=t*4283543511&Ws|((t<<16|e>>>16)*2950163797&Ws)>>>16,e^=t>>>1,e=e*444984403&Ws|e*60499&Bi,t=t*3301882366&Ws|((t<<16|e>>>16)*3120437893&Ws)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}},UA=Object.freeze({map:null,hash:"",transfer:void 0}),Rl,Pl,gn,n0,xB,rp=class{constructor(){D(this,n0);D(this,Rl,!1);D(this,Pl,null);D(this,gn,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let n=b(this,gn).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return b(this,gn).get(e)}remove(e){if(b(this,gn).delete(e),b(this,gn).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let t of b(this,gn).values())if(t instanceof Ot)return;this.onAnnotationEditor(null)}}setValue(e,t){let n=b(this,gn).get(e),i=!1;if(n!==void 0)for(let[r,o]of Object.entries(t))n[r]!==o&&(i=!0,n[r]=o);else i=!0,b(this,gn).set(e,t);i&&N(this,n0,xB).call(this),t instanceof Ot&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return b(this,gn).has(e)}getAll(){return b(this,gn).size>0?D1(b(this,gn)):null}setAll(e){for(let[t,n]of Object.entries(e))this.setValue(t,n)}get size(){return b(this,gn).size}resetModified(){b(this,Rl)&&(k(this,Rl,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Qv(this)}get serializable(){if(b(this,gn).size===0)return UA;let e=new Map,t=new Zv,n=[],i=Object.create(null),r=!1;for(let[o,l]of b(this,gn)){let u=l instanceof Ot?l.serialize(!1,i):l;u&&(e.set(o,u),t.update(`${o}:${JSON.stringify(u)}`),r||(r=!!u.bitmap))}if(r)for(let o of e.values())o.bitmap&&n.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:UA}get editorStats(){let e=null,t=new Map;for(let n of b(this,gn).values()){if(!(n instanceof Ot))continue;let i=n.telemetryFinalData;if(!i)continue;let{type:r}=i;t.has(r)||t.set(r,Object.getPrototypeOf(n).constructor),e||(e=Object.create(null));let o=e[r]||(e[r]=new Map);for(let[l,u]of Object.entries(i)){if(l==="type")continue;let h=o.get(l);h||(h=new Map,o.set(l,h));let d=h.get(u)??0;h.set(u,d+1)}}for(let[n,i]of t)e[n]=i.computeTelemetryFinalData(e[n]);return e}resetModifiedIds(){k(this,Pl,null)}get modifiedIds(){if(b(this,Pl))return b(this,Pl);let e=[];for(let t of b(this,gn).values())!(t instanceof Ot)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return k(this,Pl,{ids:new Set(e),hash:e.join(",")})}};Rl=new WeakMap,Pl=new WeakMap,gn=new WeakMap,n0=new WeakSet,xB=function(){b(this,Rl)||(k(this,Rl,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var tg,Qv=class extends rp{constructor(t){super();D(this,tg,void 0);let{map:n,hash:i,transfer:r}=t.serializable,o=structuredClone(n,r?{transfer:r}:null);k(this,tg,{map:o,hash:i,transfer:r})}get print(){vt("Should not call PrintAnnotationStorage.print")}get serializable(){return b(this,tg)}get modifiedIds(){return Ye(this,"modifiedIds",{ids:new Set,hash:""})}};tg=new WeakMap;var pd,BA=class{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){D(this,pd,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),b(this,pd).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||b(this,pd).has(e.loadedName))){if(Zt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:n,src:i,style:r}=e,o=new FontFace(n,i,r);this.addNativeFontFace(o);try{await o.load(),b(this,pd).add(n),t?.(e)}catch{Le(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}vt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){let n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(i){throw Le(`Failed to load font '${n.family}': '${i}'.`),e.disableFontFace=!0,i}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{let i=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){let e=!!this._document?.fonts;return Ye(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(jn||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),Ye(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(Zt(!i.done,"completeRequest() cannot be called twice."),i.done=!0;n.length>0&&n[0].done;){let r=n.shift();setTimeout(r.callback,0)}}let{loadingRequests:n}=this,i={done:!1,complete:t,callback:e};return n.push(i),i}get _loadTestFont(){let e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Ye(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(E,S){return E.charCodeAt(S)<<24|E.charCodeAt(S+1)<<16|E.charCodeAt(S+2)<<8|E.charCodeAt(S+3)&255}function i(E,S,T,C){let I=E.substring(0,S),A=E.substring(S+T);return I+C+A}let r,o,l=this._document.createElement("canvas");l.width=1,l.height=1;let u=l.getContext("2d"),h=0;function d(E,S){if(++h>30){Le("Load test font never loaded."),S();return}if(u.font="30px "+E,u.fillText(".",0,20),u.getImageData(0,0,1,1).data[3]>0){S();return}setTimeout(d.bind(null,E,S))}let c=`lt${Date.now()}${this.loadTestFontId++}`,a=this._loadTestFont;a=i(a,976,c.length,c);let p=16,g=1482184792,m=n(a,p);for(r=0,o=c.length-3;r<o;r+=4)m=m-g+n(c,r)|0;r<c.length&&(m=m-g+n(c+"XXX",r)|0),a=i(a,p,4,H8(m));let y=`url(data:font/opentype;base64,${btoa(a)});`,_=`@font-face {font-family:"${c}";src:${y}}`;this.insertRule(_);let x=this._document.createElement("div");x.style.visibility="hidden",x.style.width=x.style.height="10px",x.style.position="absolute",x.style.top=x.style.left="0px";for(let E of[e.loadedName,c]){let S=this._document.createElement("span");S.textContent="Hi",S.style.fontFamily=E,x.append(S)}this._document.body.append(x),d(c,()=>{x.remove(),t.complete()})}};pd=new WeakMap;var VA=class{constructor(e,{disableFontFace:t=!1,fontExtraProperties:n=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(let r in e)this[r]=e[r];this.disableFontFace=t===!0,this.fontExtraProperties=n===!0,this._inspectFont=i}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{let t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let e=`url(data:${this.mimetype};base64,${K8(this.data)});`,t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let n=this.loadedName+"_path_"+t,i;try{i=e.get(n)}catch(o){Le(`getPathGenerator - ignoring character: "${o}".`)}let r=new Path2D(i||"");return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=r}},hv={DATA:1,ERROR:2},Jt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function MU(){}function us(s){if(s instanceof or||s instanceof tp||s instanceof Cc||s instanceof qv||s instanceof Eh||s instanceof Zf)return s;switch(s instanceof Error||typeof s=="object"&&s!==null||vt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),s.name){case"AbortException":return new or(s.message);case"InvalidPDFException":return new tp(s.message);case"MissingPDFException":return new Cc(s.message);case"PasswordException":return new qv(s.message,s.code);case"UnexpectedResponseException":return new Eh(s.message,s.status);case"UnknownErrorException":return new Zf(s.message,s.details)}return new Zf(s.message,s.toString())}var gd,s0,EB,i0,SB,r0,TB,md,Av,cl=class{constructor(e,t,n){D(this,s0);D(this,i0);D(this,r0);D(this,md);D(this,gd,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",N(this,s0,EB).bind(this),{signal:b(this,gd).signal})}on(e,t){let n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){let i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},n)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,n,i){let r=this.streamId++,o=this.sourceName,l=this.targetName,u=this.comObj;return new ReadableStream({start:h=>{let d=Promise.withResolvers();return this.streamControllers[r]={controller:h,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},u.postMessage({sourceName:o,targetName:l,action:e,streamId:r,data:t,desiredSize:h.desiredSize},i),d.promise},pull:h=>{let d=Promise.withResolvers();return this.streamControllers[r].pullCall=d,u.postMessage({sourceName:o,targetName:l,stream:Jt.PULL,streamId:r,desiredSize:h.desiredSize}),d.promise},cancel:h=>{Zt(h instanceof Error,"cancel must have a valid reason");let d=Promise.withResolvers();return this.streamControllers[r].cancelCall=d,this.streamControllers[r].isClosed=!0,u.postMessage({sourceName:o,targetName:l,stream:Jt.CANCEL,streamId:r,reason:us(h)}),d.promise}},n)}destroy(){b(this,gd)?.abort(),k(this,gd,null)}};gd=new WeakMap,s0=new WeakSet,EB=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){N(this,r0,TB).call(this,e);return}if(e.callback){let n=e.callbackId,i=this.callbackCapabilities[n];if(!i)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===hv.DATA)i.resolve(e.data);else if(e.callback===hv.ERROR)i.reject(us(e.reason));else throw new Error("Unexpected callback case");return}let t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){let n=this.sourceName,i=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:n,targetName:i,callback:hv.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:n,targetName:i,callback:hv.ERROR,callbackId:e.callbackId,reason:us(o)})});return}if(e.streamId){N(this,i0,SB).call(this,e);return}t(e.data)},i0=new WeakSet,SB=function(e){let t=e.streamId,n=this.sourceName,i=e.sourceName,r=this.comObj,o=this,l=this.actionHandler[e.action],u={enqueue(h,d=1,c){if(this.isCancelled)return;let a=this.desiredSize;this.desiredSize-=d,a>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:n,targetName:i,stream:Jt.ENQUEUE,streamId:t,chunk:h},c)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:i,stream:Jt.CLOSE,streamId:t}),delete o.streamSinks[t])},error(h){Zt(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:i,stream:Jt.ERROR,streamId:t,reason:us(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};u.sinkCapability.resolve(),u.ready=u.sinkCapability.promise,this.streamSinks[t]=u,Promise.try(l,e.data,u).then(function(){r.postMessage({sourceName:n,targetName:i,stream:Jt.START_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:n,targetName:i,stream:Jt.START_COMPLETE,streamId:t,reason:us(h)})})},r0=new WeakSet,TB=function(e){let t=e.streamId,n=this.sourceName,i=e.sourceName,r=this.comObj,o=this.streamControllers[t],l=this.streamSinks[t];switch(e.stream){case Jt.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(us(e.reason));break;case Jt.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(us(e.reason));break;case Jt.PULL:if(!l){r.postMessage({sourceName:n,targetName:i,stream:Jt.PULL_COMPLETE,streamId:t,success:!0});break}l.desiredSize<=0&&e.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=e.desiredSize,Promise.try(l.onPull||MU).then(function(){r.postMessage({sourceName:n,targetName:i,stream:Jt.PULL_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:n,targetName:i,stream:Jt.PULL_COMPLETE,streamId:t,reason:us(h)})});break;case Jt.ENQUEUE:if(Zt(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case Jt.CLOSE:if(Zt(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),N(this,md,Av).call(this,o,t);break;case Jt.ERROR:Zt(o,"error should have stream controller"),o.controller.error(us(e.reason)),N(this,md,Av).call(this,o,t);break;case Jt.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(us(e.reason)),N(this,md,Av).call(this,o,t);break;case Jt.CANCEL:if(!l)break;let u=us(e.reason);Promise.try(l.onCancel||MU,u).then(function(){r.postMessage({sourceName:n,targetName:i,stream:Jt.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:n,targetName:i,stream:Jt.CANCEL_COMPLETE,streamId:t,reason:us(h)})}),l.sinkCapability.reject(u),l.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},md=new WeakSet,Av=async function(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]};var ng,e_=class{constructor({enableHWA:e=!1}){D(this,ng,!1);k(this,ng,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");let n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!b(this,ng)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){vt("Abstract method `_createCanvas` called.")}};ng=new WeakMap;var zA=class extends e_{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){let n=this._document.createElement("canvas");return n.width=e,n.height=t,n}},t_=class{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");let t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){vt("Abstract method `_fetch` called.")}},n_=class extends t_{async _fetch(e){let t=await dw(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):uw(t)}},s_=class{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,i,r){return"none"}destroy(e=!1){}},Ml,yd,Gr,jr,Vn,Nl,Ol,mn,$n,Fl,Bf,jo,Fu,bd,Cv,Wo,Lu,o0,AB,sg,GA,qo,$u,Ll,Vf,$l,zf,ig,jA,Ul,Hf,HA=class extends s_{constructor({docId:t,ownerDocument:n=globalThis.document}){super();D(this,mn);D(this,Fl);D(this,jo);D(this,bd);D(this,Wo);D(this,o0);D(this,sg);D(this,qo);D(this,Ll);D(this,$l);D(this,ig);D(this,Ul);D(this,Ml,void 0);D(this,yd,void 0);D(this,Gr,void 0);D(this,jr,void 0);D(this,Vn,void 0);D(this,Nl,void 0);D(this,Ol,0);k(this,jr,t),k(this,Vn,n)}addFilter(t){if(!t)return"none";let n=b(this,mn,$n).get(t);if(n)return n;let[i,r,o]=N(this,bd,Cv).call(this,t),l=t.length===1?i:`${i}${r}${o}`;if(n=b(this,mn,$n).get(l),n)return b(this,mn,$n).set(t,n),n;let u=`g_${b(this,jr)}_transfer_map_${Yn(this,Ol)._++}`,h=N(this,Wo,Lu).call(this,u);b(this,mn,$n).set(t,h),b(this,mn,$n).set(l,h);let d=N(this,qo,$u).call(this,u);return N(this,$l,zf).call(this,i,r,o,d),h}addHCMFilter(t,n){let i=`${t}-${n}`,r="base",o=b(this,Fl,Bf).get(r);if(o?.key===i||(o?(o.filter?.remove(),o.key=i,o.url="none",o.filter=null):(o={key:i,url:"none",filter:null},b(this,Fl,Bf).set(r,o)),!t||!n))return o.url;let l=N(this,Ul,Hf).call(this,t);t=ve.makeHexColor(...l);let u=N(this,Ul,Hf).call(this,n);if(n=ve.makeHexColor(...u),b(this,jo,Fu).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return o.url;let h=new Array(256);for(let p=0;p<=255;p++){let g=p/255;h[p]=g<=.03928?g/12.92:((g+.055)/1.055)**2.4}let d=h.join(","),c=`g_${b(this,jr)}_hcm_filter`,a=o.filter=N(this,qo,$u).call(this,c);N(this,$l,zf).call(this,d,d,d,a),N(this,sg,GA).call(this,a);let f=(p,g)=>{let m=l[p]/255,y=u[p]/255,_=new Array(g+1);for(let x=0;x<=g;x++)_[x]=m+x/g*(y-m);return _.join(",")};return N(this,$l,zf).call(this,f(0,5),f(1,5),f(2,5),a),o.url=N(this,Wo,Lu).call(this,c),o.url}addAlphaFilter(t){let n=b(this,mn,$n).get(t);if(n)return n;let[i]=N(this,bd,Cv).call(this,[t]),r=`alpha_${i}`;if(n=b(this,mn,$n).get(r),n)return b(this,mn,$n).set(t,n),n;let o=`g_${b(this,jr)}_alpha_map_${Yn(this,Ol)._++}`,l=N(this,Wo,Lu).call(this,o);b(this,mn,$n).set(t,l),b(this,mn,$n).set(r,l);let u=N(this,qo,$u).call(this,o);return N(this,ig,jA).call(this,i,u),l}addLuminosityFilter(t){let n=b(this,mn,$n).get(t||"luminosity");if(n)return n;let i,r;if(t?([i]=N(this,bd,Cv).call(this,[t]),r=`luminosity_${i}`):r="luminosity",n=b(this,mn,$n).get(r),n)return b(this,mn,$n).set(t,n),n;let o=`g_${b(this,jr)}_luminosity_map_${Yn(this,Ol)._++}`,l=N(this,Wo,Lu).call(this,o);b(this,mn,$n).set(t,l),b(this,mn,$n).set(r,l);let u=N(this,qo,$u).call(this,o);return N(this,o0,AB).call(this,u),t&&N(this,ig,jA).call(this,i,u),l}addHighlightHCMFilter(t,n,i,r,o){let l=`${n}-${i}-${r}-${o}`,u=b(this,Fl,Bf).get(t);if(u?.key===l||(u?(u.filter?.remove(),u.key=l,u.url="none",u.filter=null):(u={key:l,url:"none",filter:null},b(this,Fl,Bf).set(t,u)),!n||!i))return u.url;let[h,d]=[n,i].map(N(this,Ul,Hf).bind(this)),c=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),a=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[f,p]=[r,o].map(N(this,Ul,Hf).bind(this));a<c&&([c,a,f,p]=[a,c,p,f]),b(this,jo,Fu).style.color="";let g=(_,x,E)=>{let S=new Array(256),T=(a-c)/E,C=_/255,I=(x-_)/(255*E),A=0;for(let P=0;P<=E;P++){let F=Math.round(c+P*T),H=C+P*I;for(let z=A;z<=F;z++)S[z]=H;A=F+1}for(let P=A;P<256;P++)S[P]=S[A-1];return S.join(",")},m=`g_${b(this,jr)}_hcm_${t}_filter`,y=u.filter=N(this,qo,$u).call(this,m);return N(this,sg,GA).call(this,y),N(this,$l,zf).call(this,g(f[0],p[0],5),g(f[1],p[1],5),g(f[2],p[2],5),y),u.url=N(this,Wo,Lu).call(this,m),u.url}destroy(t=!1){t&&b(this,Nl)?.size||(b(this,Gr)?.parentNode.parentNode.remove(),k(this,Gr,null),b(this,yd)?.clear(),k(this,yd,null),b(this,Nl)?.clear(),k(this,Nl,null),k(this,Ol,0))}};Ml=new WeakMap,yd=new WeakMap,Gr=new WeakMap,jr=new WeakMap,Vn=new WeakMap,Nl=new WeakMap,Ol=new WeakMap,mn=new WeakSet,$n=function(){return b(this,yd)||k(this,yd,new Map)},Fl=new WeakSet,Bf=function(){return b(this,Nl)||k(this,Nl,new Map)},jo=new WeakSet,Fu=function(){if(!b(this,Gr)){let t=b(this,Vn).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;let i=b(this,Vn).createElementNS(Pr,"svg");i.setAttribute("width",0),i.setAttribute("height",0),k(this,Gr,b(this,Vn).createElementNS(Pr,"defs")),t.append(i),i.append(b(this,Gr)),b(this,Vn).body.append(t)}return b(this,Gr)},bd=new WeakSet,Cv=function(t){if(t.length===1){let h=t[0],d=new Array(256);for(let a=0;a<256;a++)d[a]=h[a]/255;let c=d.join(",");return[c,c,c]}let[n,i,r]=t,o=new Array(256),l=new Array(256),u=new Array(256);for(let h=0;h<256;h++)o[h]=n[h]/255,l[h]=i[h]/255,u[h]=r[h]/255;return[o.join(","),l.join(","),u.join(",")]},Wo=new WeakSet,Lu=function(t){if(b(this,Ml)===void 0){k(this,Ml,"");let n=b(this,Vn).URL;n!==b(this,Vn).baseURI&&(hw(n)?Le('#createUrl: ignore "data:"-URL for performance reasons.'):k(this,Ml,n.split("#",1)[0]))}return`url(${b(this,Ml)}#${t})`},o0=new WeakSet,AB=function(t){let n=b(this,Vn).createElementNS(Pr,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},sg=new WeakSet,GA=function(t){let n=b(this,Vn).createElementNS(Pr,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},qo=new WeakSet,$u=function(t){let n=b(this,Vn).createElementNS(Pr,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),b(this,jo,Fu).append(n),n},Ll=new WeakSet,Vf=function(t,n,i){let r=b(this,Vn).createElementNS(Pr,n);r.setAttribute("type","discrete"),r.setAttribute("tableValues",i),t.append(r)},$l=new WeakSet,zf=function(t,n,i,r){let o=b(this,Vn).createElementNS(Pr,"feComponentTransfer");r.append(o),N(this,Ll,Vf).call(this,o,"feFuncR",t),N(this,Ll,Vf).call(this,o,"feFuncG",n),N(this,Ll,Vf).call(this,o,"feFuncB",i)},ig=new WeakSet,jA=function(t,n){let i=b(this,Vn).createElementNS(Pr,"feComponentTransfer");n.append(i),N(this,Ll,Vf).call(this,i,"feFuncA",t)},Ul=new WeakSet,Hf=function(t){return b(this,jo,Fu).style.color=t,P1(getComputedStyle(b(this,jo,Fu)).getPropertyValue("color"))};var i_=class{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");let t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){vt("Abstract method `_fetch` called.")}},r_=class extends i_{async _fetch(e){let t=await dw(e,"arraybuffer");return new Uint8Array(t)}};jn&&Le("Please use the `legacy` build in Node.js environments.");async function CB(s){let t=await process.getBuiltinModule("fs").promises.readFile(s);return new Uint8Array(t)}var WA=class extends s_{},qA=class extends e_{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(DY.url)("@napi-rs/canvas").createCanvas(e,t)}},YA=class extends t_{async _fetch(e){return CB(e)}},KA=class extends i_{async _fetch(e){return CB(e)}},Gn={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function XA(s,e){if(!e)return;let t=e[2]-e[0],n=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,n),s.clip(i)}var op=class{getPattern(){vt("Abstract method `getPattern` called.")}},JA=class extends op{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,i){let r;if(i===Gn.STROKE||i===Gn.FILL){let o=t.current.getClippedPathBoundingBox(i,It(e))||[0,0,0,0],l=Math.ceil(o[2]-o[0])||1,u=Math.ceil(o[3]-o[1])||1,h=t.cachedCanvases.getCanvas("pattern",l,u),d=h.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-o[0],-o[1]),n=ve.transform(n,[1,0,0,1,o[0],o[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),XA(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),r=e.createPattern(h.canvas,"no-repeat");let c=new DOMMatrix(n);r.setTransform(c)}else XA(e,this._bbox),r=this._createGradient(e);return r}};function dA(s,e,t,n,i,r,o,l){let u=e.coords,h=e.colors,d=s.data,c=s.width*4,a;u[t+1]>u[n+1]&&(a=t,t=n,n=a,a=r,r=o,o=a),u[n+1]>u[i+1]&&(a=n,n=i,i=a,a=o,o=l,l=a),u[t+1]>u[n+1]&&(a=t,t=n,n=a,a=r,r=o,o=a);let f=(u[t]+e.offsetX)*e.scaleX,p=(u[t+1]+e.offsetY)*e.scaleY,g=(u[n]+e.offsetX)*e.scaleX,m=(u[n+1]+e.offsetY)*e.scaleY,y=(u[i]+e.offsetX)*e.scaleX,_=(u[i+1]+e.offsetY)*e.scaleY;if(p>=_)return;let x=h[r],E=h[r+1],S=h[r+2],T=h[o],C=h[o+1],I=h[o+2],A=h[l],P=h[l+1],F=h[l+2],H=Math.round(p),z=Math.round(_),B,V,M,$,oe,Z,le,ae;for(let be=H;be<=z;be++){if(be<m){let _e=be<p?0:(p-be)/(p-m);B=f-(f-g)*_e,V=x-(x-T)*_e,M=E-(E-C)*_e,$=S-(S-I)*_e}else{let _e;be>_?_e=1:m===_?_e=0:_e=(m-be)/(m-_),B=g-(g-y)*_e,V=T-(T-A)*_e,M=C-(C-P)*_e,$=I-(I-F)*_e}let Ce;be<p?Ce=0:be>_?Ce=1:Ce=(p-be)/(p-_),oe=f-(f-y)*Ce,Z=x-(x-A)*Ce,le=E-(E-P)*Ce,ae=S-(S-F)*Ce;let Ze=Math.round(Math.min(B,oe)),Ae=Math.round(Math.max(B,oe)),Ie=c*be+Ze*4;for(let _e=Ze;_e<=Ae;_e++)Ce=(B-_e)/(B-oe),Ce<0?Ce=0:Ce>1&&(Ce=1),d[Ie++]=V-(V-Z)*Ce|0,d[Ie++]=M-(M-le)*Ce|0,d[Ie++]=$-($-ae)*Ce|0,d[Ie++]=255}}function eY(s,e,t){let n=e.coords,i=e.colors,r,o;switch(e.type){case"lattice":let l=e.verticesPerRow,u=Math.floor(n.length/l)-1,h=l-1;for(r=0;r<u;r++){let d=r*l;for(let c=0;c<h;c++,d++)dA(s,t,n[d],n[d+1],n[d+l],i[d],i[d+1],i[d+l]),dA(s,t,n[d+l+1],n[d+1],n[d+l],i[d+l+1],i[d+1],i[d+l])}break;case"triangles":for(r=0,o=n.length;r<o;r+=3)dA(s,t,n[r],n[r+1],n[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}var ZA=class extends op{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){let l=Math.floor(this._bounds[0]),u=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-l,d=Math.ceil(this._bounds[3])-u,c=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),a=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),f=h/c,p=d/a,g={coords:this._coords,colors:this._colors,offsetX:-l,offsetY:-u,scaleX:1/f,scaleY:1/p},m=c+2*2,y=a+2*2,_=n.getCanvas("mesh",m,y),x=_.context,E=x.createImageData(c,a);if(t){let T=E.data;for(let C=0,I=T.length;C<I;C+=4)T[C]=t[0],T[C+1]=t[1],T[C+2]=t[2],T[C+3]=255}for(let T of this._figures)eY(E,T,g);return x.putImageData(E,2,2),{canvas:_.canvas,offsetX:l-2*f,offsetY:u-2*p,scaleX:f,scaleY:p}}getPattern(e,t,n,i){XA(e,this._bbox);let r;if(i===Gn.SHADING)r=ve.singularValueDecompose2dScale(It(e));else if(r=ve.singularValueDecompose2dScale(t.baseTransform),this.matrix){let l=ve.singularValueDecompose2dScale(this.matrix);r=[r[0]*l[0],r[1]*l[1]]}let o=this._createMeshCanvas(r,i===Gn.SHADING?null:this._background,t.cachedCanvases);return i!==Gn.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}},QA=class extends op{getPattern(){return"hotpink"}};function tY(s){switch(s[0]){case"RadialAxial":return new JA(s);case"Mesh":return new ZA(s);case"Dummy":return new QA}throw new Error(`Unknown IR type: ${s[0]}`)}var NU={COLORED:1,UNCOLORED:2},a0=class a0{constructor(e,t,n,i,r){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=i,this.baseTransform=r}createPatternCanvas(e){let{bbox:t,operatorList:n,paintType:i,tilingType:r,color:o,canvasGraphicsFactory:l}=this,{xstep:u,ystep:h}=this;u=Math.abs(u),h=Math.abs(h),cw("TilingType: "+r);let d=t[0],c=t[1],a=t[2],f=t[3],p=a-d,g=f-c,m=ve.singularValueDecompose2dScale(this.matrix),y=ve.singularValueDecompose2dScale(this.baseTransform),_=m[0]*y[0],x=m[1]*y[1],E=p,S=g,T=!1,C=!1,I=Math.ceil(u*_),A=Math.ceil(h*x),P=Math.ceil(p*_),F=Math.ceil(g*x);I>=P?E=u:T=!0,A>=F?S=h:C=!0;let H=this.getSizeAndScale(E,this.ctx.canvas.width,_),z=this.getSizeAndScale(S,this.ctx.canvas.height,x),B=e.cachedCanvases.getCanvas("pattern",H.size,z.size),V=B.context,M=l.createCanvasGraphics(V);if(M.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(M,i,o),V.translate(-H.scale*d,-z.scale*c),M.transform(H.scale,0,0,z.scale,0,0),V.save(),this.clipBbox(M,d,c,a,f),M.baseTransform=It(M.ctx),M.executeOperatorList(n),M.endDrawing(),V.restore(),T||C){let $=B.canvas;T&&(E=u),C&&(S=h);let oe=this.getSizeAndScale(E,this.ctx.canvas.width,_),Z=this.getSizeAndScale(S,this.ctx.canvas.height,x),le=oe.size,ae=Z.size,be=e.cachedCanvases.getCanvas("pattern-workaround",le,ae),Ce=be.context,Ze=T?Math.floor(p/u):0,Ae=C?Math.floor(g/h):0;for(let Ie=0;Ie<=Ze;Ie++)for(let _e=0;_e<=Ae;_e++)Ce.drawImage($,le*Ie,ae*_e,le,ae,0,0,le,ae);return{canvas:be.canvas,scaleX:oe.scale,scaleY:Z.scale,offsetX:d,offsetY:c}}return{canvas:B.canvas,scaleX:H.scale,scaleY:z.scale,offsetX:d,offsetY:c}}getSizeAndScale(e,t,n){let i=Math.max(a0.MAX_PATTERN_SIZE,t),r=Math.ceil(e*n);return r>=i?r=i:n=r/e,{scale:n,size:r}}clipBbox(e,t,n,i,r){let o=i-t,l=r-n;e.ctx.rect(t,n,o,l),e.current.updateRectMinMax(It(e.ctx),[t,n,i,r]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){let i=e.ctx,r=e.current;switch(t){case NU.COLORED:let o=this.ctx;i.fillStyle=o.fillStyle,i.strokeStyle=o.strokeStyle,r.fillColor=o.fillStyle,r.strokeColor=o.strokeStyle;break;case NU.UNCOLORED:let l=ve.makeHexColor(n[0],n[1],n[2]);i.fillStyle=l,i.strokeStyle=l,r.fillColor=l,r.strokeColor=l;break;default:throw new gA(`Unsupported paint type: ${t}`)}}getPattern(e,t,n,i){let r=n;i!==Gn.SHADING&&(r=ve.transform(r,t.baseTransform),this.matrix&&(r=ve.transform(r,this.matrix)));let o=this.createPatternCanvas(t),l=new DOMMatrix(r);l=l.translate(o.offsetX,o.offsetY),l=l.scale(1/o.scaleX,1/o.scaleY);let u=e.createPattern(o.canvas,"repeat");return u.setTransform(l),u}};J(a0,"MAX_PATTERN_SIZE",3e3);var eC=a0;function nY({src:s,srcPos:e=0,dest:t,width:n,height:i,nonBlackColor:r=4294967295,inverseDecode:o=!1}){let l=kn.isLittleEndian?4278190080:255,[u,h]=o?[r,l]:[l,r],d=n>>3,c=n&7,a=s.length;t=new Uint32Array(t.buffer);let f=0;for(let p=0;p<i;p++){for(let m=e+d;e<m;e++){let y=e<a?s[e]:255;t[f++]=y&128?h:u,t[f++]=y&64?h:u,t[f++]=y&32?h:u,t[f++]=y&16?h:u,t[f++]=y&8?h:u,t[f++]=y&4?h:u,t[f++]=y&2?h:u,t[f++]=y&1?h:u}if(c===0)continue;let g=e<a?s[e++]:255;for(let m=0;m<c;m++)t[f++]=g&1<<7-m?h:u}return{srcPos:e,destPos:f}}var OU=16,FU=100,sY=15,LU=10,$U=1e3,gs=16;function iY(s,e){if(s._removeMirroring)throw new Error("Context is already forwarding operations.");s.__originalSave=s.save,s.__originalRestore=s.restore,s.__originalRotate=s.rotate,s.__originalScale=s.scale,s.__originalTranslate=s.translate,s.__originalTransform=s.transform,s.__originalSetTransform=s.setTransform,s.__originalResetTransform=s.resetTransform,s.__originalClip=s.clip,s.__originalMoveTo=s.moveTo,s.__originalLineTo=s.lineTo,s.__originalBezierCurveTo=s.bezierCurveTo,s.__originalRect=s.rect,s.__originalClosePath=s.closePath,s.__originalBeginPath=s.beginPath,s._removeMirroring=()=>{s.save=s.__originalSave,s.restore=s.__originalRestore,s.rotate=s.__originalRotate,s.scale=s.__originalScale,s.translate=s.__originalTranslate,s.transform=s.__originalTransform,s.setTransform=s.__originalSetTransform,s.resetTransform=s.__originalResetTransform,s.clip=s.__originalClip,s.moveTo=s.__originalMoveTo,s.lineTo=s.__originalLineTo,s.bezierCurveTo=s.__originalBezierCurveTo,s.rect=s.__originalRect,s.closePath=s.__originalClosePath,s.beginPath=s.__originalBeginPath,delete s._removeMirroring},s.save=function(){e.save(),this.__originalSave()},s.restore=function(){e.restore(),this.__originalRestore()},s.translate=function(n,i){e.translate(n,i),this.__originalTranslate(n,i)},s.scale=function(n,i){e.scale(n,i),this.__originalScale(n,i)},s.transform=function(n,i,r,o,l,u){e.transform(n,i,r,o,l,u),this.__originalTransform(n,i,r,o,l,u)},s.setTransform=function(n,i,r,o,l,u){e.setTransform(n,i,r,o,l,u),this.__originalSetTransform(n,i,r,o,l,u)},s.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},s.rotate=function(n){e.rotate(n),this.__originalRotate(n)},s.clip=function(n){e.clip(n),this.__originalClip(n)},s.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},s.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},s.bezierCurveTo=function(t,n,i,r,o,l){e.bezierCurveTo(t,n,i,r,o,l),this.__originalBezierCurveTo(t,n,i,r,o,l)},s.rect=function(t,n,i,r){e.rect(t,n,i,r),this.__originalRect(t,n,i,r)},s.closePath=function(){e.closePath(),this.__originalClosePath()},s.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}var tC=class{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,n)):(i=this.canvasFactory.create(t,n),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}};function fv(s,e,t,n,i,r,o,l,u,h){let[d,c,a,f,p,g]=It(s);if(c===0&&a===0){let _=o*d+p,x=Math.round(_),E=l*f+g,S=Math.round(E),T=(o+u)*d+p,C=Math.abs(Math.round(T)-x)||1,I=(l+h)*f+g,A=Math.abs(Math.round(I)-S)||1;return s.setTransform(Math.sign(d),0,0,Math.sign(f),x,S),s.drawImage(e,t,n,i,r,0,0,C,A),s.setTransform(d,c,a,f,p,g),[C,A]}if(d===0&&f===0){let _=l*a+p,x=Math.round(_),E=o*c+g,S=Math.round(E),T=(l+h)*a+p,C=Math.abs(Math.round(T)-x)||1,I=(o+u)*c+g,A=Math.abs(Math.round(I)-S)||1;return s.setTransform(0,Math.sign(c),Math.sign(a),0,x,S),s.drawImage(e,t,n,i,r,0,0,A,C),s.setTransform(d,c,a,f,p,g),[A,C]}s.drawImage(e,t,n,i,r,o,l,u,h);let m=Math.hypot(d,c),y=Math.hypot(a,f);return[m*u,y*h]}function rY(s){let{width:e,height:t}=s;if(e>$U||t>$U)return null;let n=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=e+1,o=new Uint8Array(r*(t+1)),l,u,h,d=e+7&-8,c=new Uint8Array(d*t),a=0;for(let y of s.data){let _=128;for(;_>0;)c[a++]=y&_?0:255,_>>=1}let f=0;for(a=0,c[a]!==0&&(o[0]=1,++f),u=1;u<e;u++)c[a]!==c[a+1]&&(o[u]=c[a]?2:1,++f),a++;for(c[a]!==0&&(o[u]=2,++f),l=1;l<t;l++){a=l*d,h=l*r,c[a-d]!==c[a]&&(o[h]=c[a]?1:8,++f);let y=(c[a]?4:0)+(c[a-d]?8:0);for(u=1;u<e;u++)y=(y>>2)+(c[a+1]?4:0)+(c[a-d+1]?8:0),i[y]&&(o[h+u]=i[y],++f),a++;if(c[a-d]!==c[a]&&(o[h+u]=c[a]?2:4,++f),f>n)return null}for(a=d*(t-1),h=l*r,c[a]!==0&&(o[h]=8,++f),u=1;u<e;u++)c[a]!==c[a+1]&&(o[h+u]=c[a]?4:8,++f),a++;if(c[a]!==0&&(o[h+u]=4,++f),f>n)return null;let p=new Int32Array([0,r,-1,0,-r,0,0,0,1]),g=new Path2D;for(l=0;f&&l<=t;l++){let y=l*r,_=y+e;for(;y<_&&!o[y];)y++;if(y===_)continue;g.moveTo(y%r,l);let x=y,E=o[y];do{let S=p[E];do y+=S;while(!o[y]);let T=o[y];T!==5&&T!==10?(E=T,o[y]=0):(E=T&51*E>>4,o[y]&=E>>2|E<<2),g.lineTo(y%r,y/r|0),o[y]||--f}while(x!==y);--l}return c=null,o=null,function(y){y.save(),y.scale(1/e,-1/t),y.translate(0,-t),y.fill(g),y.beginPath(),y.restore()}}var o_=class{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=jU,this.textMatrixScale=1,this.fontMatrix=pA,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Ln.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=ve.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(e,t){let n=ve.applyTransform(t,e),i=ve.applyTransform(t.slice(2),e),r=ve.applyTransform([t[0],t[3]],e),o=ve.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,n[0],i[0],r[0],o[0]),this.minY=Math.min(this.minY,n[1],i[1],r[1],o[1]),this.maxX=Math.max(this.maxX,n[0],i[0],r[0],o[0]),this.maxY=Math.max(this.maxY,n[1],i[1],r[1],o[1])}updateScalingPathMinMax(e,t){ve.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,i,r,o,l,u,h,d){let c=ve.bezierBoundingBox(t,n,i,r,o,l,u,h,d);d||this.updateRectMinMax(e,c)}getPathBoundingBox(e=Gn.FILL,t=null){let n=[this.minX,this.minY,this.maxX,this.maxY];if(e===Gn.STROKE){t||vt("Stroke bounding box must include transform.");let i=ve.singularValueDecompose2dScale(t),r=i[0]*this.lineWidth/2,o=i[1]*this.lineWidth/2;n[0]-=r,n[1]-=o,n[2]+=r,n[3]+=o}return n}updateClipFromPath(){let e=ve.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=Gn.FILL,t=null){return ve.intersect(this.clipBox,this.getPathBoundingBox(e,t))}};function UU(s,e){if(e instanceof ImageData){s.putImageData(e,0,0);return}let t=e.height,n=e.width,i=t%gs,r=(t-i)/gs,o=i===0?r:r+1,l=s.createImageData(n,gs),u=0,h,d=e.data,c=l.data,a,f,p,g;if(e.kind===yv.GRAYSCALE_1BPP){let m=d.byteLength,y=new Uint32Array(c.buffer,0,c.byteLength>>2),_=y.length,x=n+7>>3,E=4294967295,S=kn.isLittleEndian?4278190080:255;for(a=0;a<o;a++){for(p=a<r?gs:i,h=0,f=0;f<p;f++){let T=m-u,C=0,I=T>x?n:T*8-7,A=I&-8,P=0,F=0;for(;C<A;C+=8)F=d[u++],y[h++]=F&128?E:S,y[h++]=F&64?E:S,y[h++]=F&32?E:S,y[h++]=F&16?E:S,y[h++]=F&8?E:S,y[h++]=F&4?E:S,y[h++]=F&2?E:S,y[h++]=F&1?E:S;for(;C<I;C++)P===0&&(F=d[u++],P=128),y[h++]=F&P?E:S,P>>=1}for(;h<_;)y[h++]=0;s.putImageData(l,0,a*gs)}}else if(e.kind===yv.RGBA_32BPP){for(f=0,g=n*gs*4,a=0;a<r;a++)c.set(d.subarray(u,u+g)),u+=g,s.putImageData(l,0,f),f+=gs;a<o&&(g=n*i*4,c.set(d.subarray(u,u+g)),s.putImageData(l,0,f))}else if(e.kind===yv.RGB_24BPP)for(p=gs,g=n*p,a=0;a<o;a++){for(a>=r&&(p=i,g=n*p),h=0,f=g;f--;)c[h++]=d[u++],c[h++]=d[u++],c[h++]=d[u++],c[h++]=255;s.putImageData(l,0,a*gs)}else throw new Error(`bad image kind: ${e.kind}`)}function BU(s,e){if(e.bitmap){s.drawImage(e.bitmap,0,0);return}let t=e.height,n=e.width,i=t%gs,r=(t-i)/gs,o=i===0?r:r+1,l=s.createImageData(n,gs),u=0,h=e.data,d=l.data;for(let c=0;c<o;c++){let a=c<r?gs:i;({srcPos:u}=nY({src:h,srcPos:u,dest:d,width:n,height:a,nonBlackColor:0})),s.putImageData(l,0,c*gs)}}function Mf(s,e){let t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let n of t)s[n]!==void 0&&(e[n]=s[n]);s.setLineDash!==void 0&&(e.setLineDash(s.getLineDash()),e.lineDashOffset=s.lineDashOffset)}function pv(s){if(s.strokeStyle=s.fillStyle="#000000",s.fillRule="nonzero",s.globalAlpha=1,s.lineWidth=1,s.lineCap="butt",s.lineJoin="miter",s.miterLimit=10,s.globalCompositeOperation="source-over",s.font="10px sans-serif",s.setLineDash!==void 0&&(s.setLineDash([]),s.lineDashOffset=0),!jn){let{filter:e}=s;e!=="none"&&e!==""&&(s.filter="none")}}function VU(s,e){if(e)return!0;let t=ve.singularValueDecompose2dScale(s);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);let n=Math.fround((globalThis.devicePixelRatio||1)*ma.PDF_TO_CSS_UNITS);return t[0]<=n&&t[1]<=n}var oY=["butt","round","square"],aY=["miter","round","bevel"],lY={},zU={},rg,nC,og,sC,ag,iC,O1=class O1{constructor(e,t,n,i,r,{optionalContentConfig:o,markedContentStack:l=null},u,h){D(this,rg);D(this,og);D(this,ag);this.ctx=e,this.current=new o_(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=l||[],this.optionalContentConfig=o,this.cachedCanvases=new tC(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=u,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:i=null}){let r=this.ctx.canvas.width,o=this.ctx.canvas.height,l=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=l,n){let u=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=u.canvas,this.ctx=u.context,this.ctx.save(),this.ctx.transform(...It(this.compositeCtx))}this.ctx.save(),pv(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=It(this.ctx)}executeOperatorList(e,t,n,i){let r=e.argsArray,o=e.fnArray,l=t||0,u=r.length;if(u===l)return l;let h=u-l>LU&&typeof n=="function",d=h?Date.now()+sY:0,c=0,a=this.commonObjs,f=this.objs,p;for(;;){if(i!==void 0&&l===i.nextBreakPoint)return i.breakIt(l,n),l;if(p=o[l],p!==hi.dependency)this[p].apply(this,r[l]);else for(let g of r[l]){let m=g.startsWith("g_")?a:f;if(!m.has(g))return m.get(g,n),l}if(l++,l===u)return l;if(h&&++c>LU){if(Date.now()>d)return n(),l;c=0}}}endDrawing(){N(this,rg,nC).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),N(this,og,sC).call(this)}_scaleImage(e,t){let n=e.width??e.displayWidth,i=e.height??e.displayHeight,r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=n,u=i,h="prescale1",d,c;for(;r>2&&l>1||o>2&&u>1;){let a=l,f=u;r>2&&l>1&&(a=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),r/=l/a),o>2&&u>1&&(f=u>=16384?Math.floor(u/2)-1||1:Math.ceil(u)/2,o/=u/f),d=this.cachedCanvases.getCanvas(h,a,f),c=d.context,c.clearRect(0,0,a,f),c.drawImage(e,0,0,l,u,0,0,a,f),e=d.canvas,l=a,u=f,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:u}}_createMaskCanvas(e){let t=this.ctx,{width:n,height:i}=e,r=this.current.fillColor,o=this.current.patternFill,l=It(t),u,h,d,c;if((e.bitmap||e.data)&&e.count>1){let I=e.bitmap||e.data.buffer;h=JSON.stringify(o?l:[l.slice(0,4),r]),u=this._cachedBitmapsMap.get(I),u||(u=new Map,this._cachedBitmapsMap.set(I,u));let A=u.get(h);if(A&&!o){let P=Math.round(Math.min(l[0],l[2])+l[4]),F=Math.round(Math.min(l[1],l[3])+l[5]);return{canvas:A,offsetX:P,offsetY:F}}d=A}d||(c=this.cachedCanvases.getCanvas("maskCanvas",n,i),BU(c.context,e));let a=ve.transform(l,[1/n,0,0,-1/i,0,0]);a=ve.transform(a,[1,0,0,1,0,-i]);let[f,p,g,m]=ve.getAxialAlignedBoundingBox([0,0,n,i],a),y=Math.round(g-f)||1,_=Math.round(m-p)||1,x=this.cachedCanvases.getCanvas("fillCanvas",y,_),E=x.context,S=f,T=p;E.translate(-S,-T),E.transform(...a),d||(d=this._scaleImage(c.canvas,Ui(E)),d=d.img,u&&o&&u.set(h,d)),E.imageSmoothingEnabled=VU(It(E),e.interpolate),fv(E,d,0,0,d.width,d.height,0,0,n,i),E.globalCompositeOperation="source-in";let C=ve.transform(Ui(E),[1,0,0,1,-S,-T]);return E.fillStyle=o?r.getPattern(t,this,C,Gn.FILL):r,E.fillRect(0,0,n,i),u&&!o&&(this.cachedCanvases.delete("fillCanvas"),u.set(h,x.canvas)),{canvas:x.canvas,offsetX:Math.round(S),offsetY:Math.round(T)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=oY[e]}setLineJoin(e){this.ctx.lineJoin=aY[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){let n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx,this.ctx=i.context;let r=this.ctx;r.setTransform(...It(this.suspendedCtx)),Mf(this.suspendedCtx,r),iY(r,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Mf(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,i){let r=i[0],o=i[1],l=i[2]-r,u=i[3]-o;l===0||u===0||(this.genericComposeSMask(t.context,n,l,u,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,i,r,o,l,u,h,d,c){let a=e.canvas,f=u-d,p=h-c;if(o){let m=ve.makeHexColor(...o);if(f<0||p<0||f+n>a.width||p+i>a.height){let y=this.cachedCanvases.getCanvas("maskExtension",n,i),_=y.context;_.drawImage(a,-f,-p),_.globalCompositeOperation="destination-atop",_.fillStyle=m,_.fillRect(0,0,n,i),_.globalCompositeOperation="source-over",a=y.canvas,f=p=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);let y=new Path2D;y.rect(f,p,n,i),e.clip(y),e.globalCompositeOperation="destination-atop",e.fillStyle=m,e.fillRect(f,p,n,i),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&l?t.filter=this.filterFactory.addAlphaFilter(l):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(l));let g=new Path2D;g.rect(u,h,n,i),t.clip(g),t.globalCompositeOperation="destination-in",t.drawImage(a,f,p,n,i,u,h,n,i),t.restore()}save(){this.inSMaskMode?(Mf(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Mf(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,i,r,o){this.ctx.transform(e,t,n,i,r,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){let i=this.ctx,r=this.current,o=r.x,l=r.y,u,h,d=It(i),c=d[0]===0&&d[3]===0||d[1]===0&&d[2]===0,a=c?n.slice(0):null;for(let f=0,p=0,g=e.length;f<g;f++)switch(e[f]|0){case hi.rectangle:o=t[p++],l=t[p++];let m=t[p++],y=t[p++],_=o+m,x=l+y;i.moveTo(o,l),m===0||y===0?i.lineTo(_,x):(i.lineTo(_,l),i.lineTo(_,x),i.lineTo(o,x)),c||r.updateRectMinMax(d,[o,l,_,x]),i.closePath();break;case hi.moveTo:o=t[p++],l=t[p++],i.moveTo(o,l),c||r.updatePathMinMax(d,o,l);break;case hi.lineTo:o=t[p++],l=t[p++],i.lineTo(o,l),c||r.updatePathMinMax(d,o,l);break;case hi.curveTo:u=o,h=l,o=t[p+4],l=t[p+5],i.bezierCurveTo(t[p],t[p+1],t[p+2],t[p+3],o,l),r.updateCurvePathMinMax(d,u,h,t[p],t[p+1],t[p+2],t[p+3],o,l,a),p+=6;break;case hi.curveTo2:u=o,h=l,i.bezierCurveTo(o,l,t[p],t[p+1],t[p+2],t[p+3]),r.updateCurvePathMinMax(d,u,h,o,l,t[p],t[p+1],t[p+2],t[p+3],a),o=t[p+2],l=t[p+3],p+=4;break;case hi.curveTo3:u=o,h=l,o=t[p+2],l=t[p+3],i.bezierCurveTo(t[p],t[p+1],o,l,o,l),r.updateCurvePathMinMax(d,u,h,t[p],t[p+1],o,l,o,l,a),p+=4;break;case hi.closePath:i.closePath();break}c&&r.updateScalingPathMinMax(d,a),r.setCurrentPoint(o,l)}closePath(){this.ctx.closePath()}stroke(e=!0){let t=this.ctx,n=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof n=="object"&&n?.getPattern?(t.save(),t.strokeStyle=n.getPattern(t,this,Ui(t),Gn.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){let t=this.ctx,n=this.current.fillColor,i=this.current.patternFill,r=!1;i&&(t.save(),t.fillStyle=n.getPattern(t,this,Ui(t),Gn.FILL),r=!0);let o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),r&&t.restore(),e&&this.consumePath(o)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=lY}eoClip(){this.pendingClip=zU}beginText(){this.current.textMatrix=jU,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}let n=new Path2D,i=t.getTransform().invertSelf();for(let{transform:r,x:o,y:l,fontSize:u,path:h}of e)n.addPath(h,new DOMMatrix(r).preMultiplySelf(i).translate(o,l).scale(u,-u));t.clip(n),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){let n=this.commonObjs.get(e),i=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=n.fontMatrix||pA,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&Le("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;let r=n.loadedName||"sans-serif",o=n.systemFontInfo?.css||`"${r}", ${n.fallbackName}`,l="normal";n.black?l="900":n.bold&&(l="bold");let u=n.italic?"italic":"normal",h=t;t<OU?h=OU:t>FU&&(h=FU),this.current.fontSizeScale=t/h,this.ctx.font=`${u} ${l} ${h}px ${o}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,i,r,o){this.current.textMatrix=[e,t,n,i,r,o],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,i,r){let o=this.ctx,l=this.current,u=l.font,h=l.textRenderingMode,d=l.fontSize/l.fontSizeScale,c=h&Ln.FILL_STROKE_MASK,a=!!(h&Ln.ADD_TO_PATH_FLAG),f=l.patternFill&&!u.missingFile,p=l.patternStroke&&!u.missingFile,g;if((u.disableFontFace||a||f||p)&&(g=u.getPathGenerator(this.commonObjs,e)),u.disableFontFace||f||p){if(o.save(),o.translate(t,n),o.scale(d,-d),c===Ln.FILL||c===Ln.FILL_STROKE)if(i){let m=o.getTransform();o.setTransform(...i),o.fill(N(this,ag,iC).call(this,g,m,i))}else o.fill(g);if(c===Ln.STROKE||c===Ln.FILL_STROKE)if(r){let m=o.getTransform();o.setTransform(...r),o.stroke(N(this,ag,iC).call(this,g,m,r))}else o.lineWidth/=d,o.stroke(g);o.restore()}else(c===Ln.FILL||c===Ln.FILL_STROKE)&&o.fillText(e,t,n),(c===Ln.STROKE||c===Ln.FILL_STROKE)&&o.strokeText(e,t,n);a&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:It(o),x:t,y:n,fontSize:d,path:g})}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let t=e.getImageData(0,0,10,10).data,n=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){n=!0;break}return Ye(this,"isFontSubpixelAAEnabled",n)}showText(e){let t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);let i=t.fontSize;if(i===0)return;let r=this.ctx,o=t.fontSizeScale,l=t.charSpacing,u=t.wordSpacing,h=t.fontDirection,d=t.textHScale*h,c=e.length,a=n.vertical,f=a?1:-1,p=n.defaultVMetrics,g=i*t.fontMatrix[0],m=t.textRenderingMode===Ln.FILL&&!n.disableFontFace&&!t.patternFill;r.save(),r.transform(...t.textMatrix),r.translate(t.x,t.y+t.textRise),h>0?r.scale(d,-1):r.scale(d,1);let y,_;if(t.patternFill){r.save();let C=t.fillColor.getPattern(r,this,Ui(r),Gn.FILL);y=It(r),r.restore(),r.fillStyle=C}if(t.patternStroke){r.save();let C=t.strokeColor.getPattern(r,this,Ui(r),Gn.STROKE);_=It(r),r.restore(),r.strokeStyle=C}let x=t.lineWidth,E=t.textMatrixScale;if(E===0||x===0){let C=t.textRenderingMode&Ln.FILL_STROKE_MASK;(C===Ln.STROKE||C===Ln.FILL_STROKE)&&(x=this.getSinglePixelWidth())}else x/=E;if(o!==1&&(r.scale(o,o),x/=o),r.lineWidth=x,n.isInvalidPDFjsFont){let C=[],I=0;for(let A of e)C.push(A.unicode),I+=A.width;r.fillText(C.join(""),0,0),t.x+=I*g*d,r.restore(),this.compose();return}let S=0,T;for(T=0;T<c;++T){let C=e[T];if(typeof C=="number"){S+=f*C*i/1e3;continue}let I=!1,A=(C.isSpace?u:0)+l,P=C.fontChar,F=C.accent,H,z,B=C.width;if(a){let M=C.vmetric||p,$=-(C.vmetric?M[1]:B*.5)*g,oe=M[2]*g;B=M?-M[0]:B,H=$/o,z=(S+oe)/o}else H=S/o,z=0;if(n.remeasure&&B>0){let M=r.measureText(P).width*1e3/i*o;if(B<M&&this.isFontSubpixelAAEnabled){let $=B/M;I=!0,r.save(),r.scale($,1),H/=$}else B!==M&&(H+=(B-M)/2e3*i/o)}if(this.contentVisible&&(C.isInFont||n.missingFile)){if(m&&!F)r.fillText(P,H,z);else if(this.paintChar(P,H,z,y,_),F){let M=H+i*F.offset.x/o,$=z-i*F.offset.y/o;this.paintChar(F.fontChar,M,$,y,_)}}let V=a?B*g-A*h:B*g+A*h;S+=V,I&&r.restore()}a?t.y-=S:t.x+=S*d,r.restore(),this.compose()}showType3Text(e){let t=this.ctx,n=this.current,i=n.font,r=n.fontSize,o=n.fontDirection,l=i.vertical?1:-1,u=n.charSpacing,h=n.wordSpacing,d=n.textHScale*o,c=n.fontMatrix||pA,a=e.length,f=n.textRenderingMode===Ln.INVISIBLE,p,g,m,y;if(!(f||r===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...n.textMatrix),t.translate(n.x,n.y),t.scale(d,o),p=0;p<a;++p){if(g=e[p],typeof g=="number"){y=l*g*r/1e3,this.ctx.translate(y,0),n.x+=y*d;continue}let _=(g.isSpace?h:0)+u,x=i.charProcOperatorList[g.operatorListId];if(!x){Le(`Type3 character "${g.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=g,this.save(),t.scale(r,r),t.transform(...c),this.executeOperatorList(x),this.restore()),m=ve.applyTransform([g.width,0],c)[0]*r+_,t.translate(m,0),n.x+=m*d}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,i,r,o){this.ctx.rect(n,i,r-n,o-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){let n=e[1],i=this.baseTransform||It(this.ctx),r={createCanvasGraphics:o=>new O1(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new eC(e,n,this.ctx,r,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){this.ctx.strokeStyle=this.current.strokeColor=ve.makeHexColor(e,t,n),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,n){this.ctx.fillStyle=this.current.fillColor=ve.makeHexColor(e,t,n),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=tY(this.getObject(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;let t=this.ctx;this.save();let n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,Ui(t),Gn.SHADING);let i=Ui(t);if(i){let{width:r,height:o}=t.canvas,[l,u,h,d]=ve.getAxialAlignedBoundingBox([0,0,r,o],i);this.ctx.fillRect(l,u,h-l,d-u)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){vt("Should not call beginInlineImage")}beginImageData(){vt("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=It(this.ctx),t)){let n=t[2]-t[0],i=t[3]-t[1];this.ctx.rect(t[0],t[1],n,i),this.current.updateRectMinMax(It(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let t=this.ctx;e.isolated||cw("TODO: Support non-isolated groups."),e.knockout&&Le("Knockout groups not supported.");let n=It(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=ve.getAxialAlignedBoundingBox(e.bbox,It(t)),r=[0,0,t.canvas.width,t.canvas.height];i=ve.intersect(i,r)||[0,0,0,0];let o=Math.floor(i[0]),l=Math.floor(i[1]),u=Math.max(Math.ceil(i[2])-o,1),h=Math.max(Math.ceil(i[3])-l,1);this.current.startNewPathAndClipBox([0,0,u,h]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);let c=this.cachedCanvases.getCanvas(d,u,h),a=c.context;a.translate(-o,-l),a.transform(...n),e.smask?this.smaskStack.push({canvas:c.canvas,context:a,offsetX:o,offsetY:l,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,l),t.save()),Mf(t,a),this.ctx=a,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;let t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let i=It(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);let r=ve.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],i);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(e,t,n,i,r){if(N(this,rg,nC).call(this),pv(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){let o=t[2]-t[0],l=t[3]-t[1];if(r&&this.annotationCanvasMap){n=n.slice(),n[4]-=t[0],n[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=o,t[3]=l;let[u,h]=ve.singularValueDecompose2dScale(It(this.ctx)),{viewportScale:d}=this,c=Math.ceil(o*this.outputScaleX*d),a=Math.ceil(l*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(c,a);let{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(u,0,0,-h,0,l*h),pv(this.ctx)}else pv(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],o,l),this.ctx.clip(),this.ctx.beginPath()}this.current=new o_(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),N(this,og,sC).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;let t=e.count;e=this.getObject(e.data,e),e.count=t;let n=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=rY(e)),i.compiled)){i.compiled(n);return}let r=this._createMaskCanvas(e),o=r.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(o,r.offsetX,r.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,i=0,r,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);let l=this.ctx;l.save();let u=It(l);l.transform(t,n,i,r,0,0);let h=this._createMaskCanvas(e);l.setTransform(1,0,0,1,h.offsetX-u[4],h.offsetY-u[5]);for(let d=0,c=o.length;d<c;d+=2){let a=ve.transform(u,[t,n,i,r,o[d],o[d+1]]),[f,p]=ve.applyTransform([0,0],a);l.drawImage(h.canvas,f,p)}l.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;let t=this.ctx,n=this.current.fillColor,i=this.current.patternFill;for(let r of e){let{data:o,width:l,height:u,transform:h}=r,d=this.cachedCanvases.getCanvas("maskCanvas",l,u),c=d.context;c.save();let a=this.getObject(o,r);BU(c,a),c.globalCompositeOperation="source-in",c.fillStyle=i?n.getPattern(c,this,Ui(t),Gn.FILL):n,c.fillRect(0,0,l,u),c.restore(),t.save(),t.transform(...h),t.scale(1,-1),fv(t,d.canvas,0,0,l,u,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);if(!t){Le("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,n,i){if(!this.contentVisible)return;let r=this.getObject(e);if(!r){Le("Dependent image isn't ready yet");return}let o=r.width,l=r.height,u=[];for(let h=0,d=i.length;h<d;h+=2)u.push({transform:[t,0,0,n,i[h],i[h+1]],x:0,y:0,w:o,h:l});this.paintInlineImageXObjectGroup(r,u)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;let{bitmap:t,width:n,height:i}=e,r=this.cachedCanvases.getCanvas("inlineImage",n,i),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;let t=e.width,n=e.height,i=this.ctx;if(this.save(),!jn){let{filter:l}=i;l!=="none"&&l!==""&&(i.filter="none")}i.scale(1/t,-1/n);let r;if(e.bitmap)r=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)r=e;else{let u=this.cachedCanvases.getCanvas("inlineImage",t,n).context;UU(u,e),r=this.applyTransferMapsToCanvas(u)}let o=this._scaleImage(r,Ui(i));i.imageSmoothingEnabled=VU(It(i),e.interpolate),fv(i,o.img,0,0,o.paintWidth,o.paintHeight,0,-n,t,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;let n=this.ctx,i;if(e.bitmap)i=e.bitmap;else{let r=e.width,o=e.height,u=this.cachedCanvases.getCanvas("inlineImage",r,o).context;UU(u,e),i=this.applyTransferMapsToCanvas(u)}for(let r of t)n.save(),n.transform(...r.transform),n.scale(1,-1),fv(n,i,r.x,r.y,r.w,r.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);let n=this.ctx;this.pendingClip&&(t||(this.pendingClip===zU?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=It(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:e}=this.current,{a:t,b:n,c:i,d:r}=this.ctx.getTransform(),o,l;if(n===0&&i===0){let u=Math.abs(t),h=Math.abs(r);if(u===h)if(e===0)o=l=1/u;else{let d=u*e;o=l=d<1?1/d:1}else if(e===0)o=1/u,l=1/h;else{let d=u*e,c=h*e;o=d<1?1/d:1,l=c<1?1/c:1}}else{let u=Math.abs(t*r-n*i),h=Math.hypot(t,n),d=Math.hypot(i,r);if(e===0)o=d/u,l=h/u;else{let c=e*u;o=d>c?d/c:1,l=h>c?h/c:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=l}return this._cachedScaleForStroking}rescaleAndStroke(e){let{ctx:t}=this,{lineWidth:n}=this.current,[i,r]=this.getScaleForStroking();if(t.lineWidth=n||1,i===1&&r===1){t.stroke();return}let o=t.getLineDash();if(e&&t.save(),t.scale(i,r),o.length>0){let l=Math.max(i,r);t.setLineDash(o.map(u=>u/l)),t.lineDashOffset/=l}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};rg=new WeakSet,nC=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},og=new WeakSet,sC=function(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},ag=new WeakSet,iC=function(e,t,n){let i=new Path2D;return i.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),i};var ju=O1;for(let s in hi)ju.prototype[s]!==void 0&&(ju.prototype[hi[s]]=ju.prototype[s]);var lg,cg,Ci=class{static get workerPort(){return b(this,lg)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");k(this,lg,e)}static get workerSrc(){return b(this,cg)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");k(this,cg,e)}};lg=new WeakMap,cg=new WeakMap,D(Ci,lg,null),D(Ci,cg,"");var Bl,ug,rC=class{constructor({parsedData:e,rawData:t}){D(this,Bl,void 0);D(this,ug,void 0);k(this,Bl,e),k(this,ug,t)}getRaw(){return b(this,ug)}get(e){return b(this,Bl).get(e)??null}getAll(){return D1(b(this,Bl))}has(e){return b(this,Bl).has(e)}};Bl=new WeakMap,ug=new WeakMap;var Uu=Symbol("INTERNAL"),dg,hg,fg,vd,oC=class{constructor(e,{name:t,intent:n,usage:i,rbGroups:r}){D(this,dg,!1);D(this,hg,!1);D(this,fg,!1);D(this,vd,!0);k(this,dg,!!(e&Ns.DISPLAY)),k(this,hg,!!(e&Ns.PRINT)),this.name=t,this.intent=n,this.usage=i,this.rbGroups=r}get visible(){if(b(this,fg))return b(this,vd);if(!b(this,vd))return!1;let{print:e,view:t}=this.usage;return b(this,dg)?t?.viewState!=="OFF":b(this,hg)?e?.printState!=="OFF":!0}_setVisible(e,t,n=!1){e!==Uu&&vt("Internal method `_setVisible` called."),k(this,fg,n),k(this,vd,t)}};dg=new WeakMap,hg=new WeakMap,fg=new WeakMap,vd=new WeakMap;var Yo,gt,_d,wd,pg,lC,aC=class{constructor(e,t=Ns.DISPLAY){D(this,pg);D(this,Yo,null);D(this,gt,new Map);D(this,_d,null);D(this,wd,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,k(this,wd,e.order);for(let n of e.groups)b(this,gt).set(n.id,new oC(t,n));if(e.baseState==="OFF")for(let n of b(this,gt).values())n._setVisible(Uu,!1);for(let n of e.on)b(this,gt).get(n)._setVisible(Uu,!0);for(let n of e.off)b(this,gt).get(n)._setVisible(Uu,!1);k(this,_d,this.getHash())}}isVisible(e){if(b(this,gt).size===0)return!0;if(!e)return cw("Optional content group not defined."),!0;if(e.type==="OCG")return b(this,gt).has(e.id)?b(this,gt).get(e.id).visible:(Le(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return N(this,pg,lC).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(let t of e.ids){if(!b(this,gt).has(t))return Le(`Optional content group not found: ${t}`),!0;if(b(this,gt).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(let t of e.ids){if(!b(this,gt).has(t))return Le(`Optional content group not found: ${t}`),!0;if(!b(this,gt).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(let t of e.ids){if(!b(this,gt).has(t))return Le(`Optional content group not found: ${t}`),!0;if(!b(this,gt).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(let t of e.ids){if(!b(this,gt).has(t))return Le(`Optional content group not found: ${t}`),!0;if(b(this,gt).get(t).visible)return!1}return!0}return Le(`Unknown optional content policy ${e.policy}.`),!0}return Le(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){let i=b(this,gt).get(e);if(!i){Le(`Optional content group not found: ${e}`);return}if(n&&t&&i.rbGroups.length)for(let r of i.rbGroups)for(let o of r)o!==e&&b(this,gt).get(o)?._setVisible(Uu,!1,!0);i._setVisible(Uu,!!t,!0),k(this,Yo,null)}setOCGState({state:e,preserveRB:t}){let n;for(let i of e){switch(i){case"ON":case"OFF":case"Toggle":n=i;continue}let r=b(this,gt).get(i);if(r)switch(n){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!r.visible,t);break}}k(this,Yo,null)}get hasInitialVisibility(){return b(this,_d)===null||this.getHash()===b(this,_d)}getOrder(){return b(this,gt).size?b(this,wd)?b(this,wd).slice():[...b(this,gt).keys()]:null}getGroups(){return b(this,gt).size>0?D1(b(this,gt)):null}getGroup(e){return b(this,gt).get(e)||null}getHash(){if(b(this,Yo)!==null)return b(this,Yo);let e=new Zv;for(let[t,n]of b(this,gt))e.update(`${t}:${n.visible}`);return k(this,Yo,e.hexdigest())}};Yo=new WeakMap,gt=new WeakMap,_d=new WeakMap,wd=new WeakMap,pg=new WeakSet,lC=function(e){let t=e.length;if(t<2)return!0;let n=e[0];for(let i=1;i<t;i++){let r=e[i],o;if(Array.isArray(r))o=N(this,pg,lC).call(this,r);else if(b(this,gt).has(r))o=b(this,gt).get(r).visible;else return Le(`Optional content group not found: ${r}`),!0;switch(n){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return n==="And"};var cC=class{constructor(e,{disableRange:t=!1,disableStream:n=!1}){Zt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:i,initialData:r,progressiveDone:o,contentDispositionFilename:l}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=l,r?.length>0){let u=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(u)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((u,h)=>{this._onReceiveData({begin:u,chunk:h})}),e.addProgressListener((u,h)=>{this._onProgress({loaded:u,total:h})}),e.addProgressiveReadListener(u=>{this._onReceiveData({chunk:u})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){let n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{let i=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(n),!0)});Zt(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Zt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new uC(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new dC(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}},uC=class{constructor(e,t,n=!1,i=null){this._stream=e,this._done=n||!1,this._filename=R1(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(let r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},dC=class{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function cY(s){let e=!0,t=n("filename\\*","i").exec(s);if(t){t=t[1];let d=l(t);return d=unescape(d),d=u(d),d=h(d),r(d)}if(t=o(s),t){let d=h(t);return r(d)}if(t=n("filename","i").exec(s),t){t=t[1];let d=l(t);return d=h(d),r(d)}function n(d,c){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',c)}function i(d,c){if(d){if(!/^[\x00-\xFF]+$/.test(c))return c;try{let a=new TextDecoder(d,{fatal:!0}),f=uw(c);c=a.decode(f),e=!1}catch{}}return c}function r(d){return e&&/[\x80-\xff]/.test(d)&&(d=i("utf-8",d),e&&(d=i("iso-8859-1",d))),d}function o(d){let c=[],a,f=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(a=f.exec(d))!==null;){let[,g,m,y]=a;if(g=parseInt(g,10),g in c){if(g===0)break;continue}c[g]=[m,y]}let p=[];for(let g=0;g<c.length&&g in c;++g){let[m,y]=c[g];y=l(y),m&&(y=unescape(y),g===0&&(y=u(y))),p.push(y)}return p.join("")}function l(d){if(d.startsWith('"')){let c=d.slice(1).split('\\"');for(let a=0;a<c.length;++a){let f=c[a].indexOf('"');f!==-1&&(c[a]=c[a].slice(0,f),c.length=a+1),c[a]=c[a].replaceAll(/\\(.)/g,"$1")}d=c.join('"')}return d}function u(d){let c=d.indexOf("'");if(c===-1)return d;let a=d.slice(0,c),p=d.slice(c+1).replace(/^[^']*'/,"");return i(a,p)}function h(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(c,a,f,p){if(f==="q"||f==="Q")return p=p.replaceAll("_"," "),p=p.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,m){return String.fromCharCode(parseInt(m,16))}),i(a,p);try{p=atob(p)}catch{}return i(a,p)})}return""}function IB(s,e){let t=new Headers;if(!s||!e||typeof e!="object")return t;for(let n in e){let i=e[n];i!==void 0&&t.append(n,i)}return t}function fw(s){try{return new URL(s).origin}catch{}return null}function DB({responseHeaders:s,isHttp:e,rangeChunkSize:t,disableRange:n}){let i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(s.get("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*t)||n||!e||s.get("Accept-Ranges")!=="bytes"||(s.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function kB(s){let e=s.get("Content-Disposition");if(e){let t=cY(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(R1(t))return t}return null}function pw(s,e){return s===404||s===0&&e.startsWith("file:")?new Cc('Missing PDF "'+e+'".'):new Eh(`Unexpected server response (${s}) while retrieving PDF "${e}".`,s)}function RB(s){return s===200||s===206}function PB(s,e,t){return{method:"GET",headers:s,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function MB(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:(Le(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}var a_=class{constructor(e){J(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=IB(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Zt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new hC(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new fC(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},hC=class{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;let n=new Headers(e.headers),i=t.url;fetch(i,PB(n,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=fw(r.url),!RB(r.status))throw pw(r.status,i);this._reader=r.body.getReader(),this._headersCapability.resolve();let o=r.headers,{allowRangeRequests:l,suggestedLength:u}=DB({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=l,this._contentLength=u||this._contentLength,this._filename=kB(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new or("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:MB(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},fC=class{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;let i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;let r=new Headers(e.headers);r.append("Range",`bytes=${t}-${n-1}`);let o=i.url;fetch(o,PB(r,this._withCredentials,this._abortController)).then(l=>{let u=fw(l.url);if(u!==e._responseOrigin)throw new Error(`Expected range response-origin "${u}" to match "${e._responseOrigin}".`);if(!RB(l.status))throw pw(l.status,o);this._readCapability.resolve(),this._reader=l.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:MB(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},hA=200,fA=206;function uY(s){let e=s.response;return typeof e!="string"?e:uw(e).buffer}var pC=class{constructor({url:e,httpHeaders:t,withCredentials:n}){J(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=IB(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){let t=new XMLHttpRequest,n=this.currXhrId++,i=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(let[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=fA):i.expectedStatus=hA,t.responseType="arraybuffer",Zt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){let n=this.pendingRequests[e];n&&n.onProgress?.(t)}onStateChange(e,t){let n=this.pendingRequests[e];if(!n)return;let i=n.xhr;if(i.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){n.onError(i.status);return}let r=i.status||hA;if(!(r===hA&&n.expectedStatus===fA)&&r!==n.expectedStatus){n.onError(i.status);return}let l=uY(i);if(r===fA){let u=i.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(u);h?n.onDone({begin:parseInt(h[1],10),chunk:l}):(Le('Missing or invalid "Content-Range" header.'),n.onError(0))}else l?n.onDone({begin:0,chunk:l}):n.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}},gC=class{constructor(e){this._source=e,this._manager=new pC(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Zt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new mC(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let n=new yC(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},mC=class{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=fw(t.responseURL);let n=t.getAllResponseHeaders(),i=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(l=>{let[u,...h]=l.split(": ");return[u,h.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=DB({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=kB(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=pw(e,this._url),this._headersCapability.reject(this._storedError);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},yC=class{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){let e=fw(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=pw(e,this._url));for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},dY=/^[a-z][a-z0-9\-+.]+:/i;function hY(s){if(dY.test(s))return new URL(s);let e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(s))}var bC=class{constructor(e){this.source=e,this.url=hY(e.url),Zt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Zt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new vC(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new _C(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},vC=class{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=new Cc(`Missing PDF "${this._url}".`)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new or("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},_C=class{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let i=e.source;this._isStreamingSupported=!i.disableStream;let r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}},fY=1e5,cs=30,pY=.8,Ko,fs,gg,mg,Vl,Wr,yg,bg,zl,xd,Ed,Xo,Sd,vg,Td,Hl,_g,wg,Gl,jl,xg,Jo,Ad,l0,NB,c0,OB,Eg,wC,Cd,Iv,Sg,xC,u0,FB,d0,LB,Lt=class Lt{constructor({textContentSource:e,container:t,viewport:n}){D(this,l0);D(this,c0);D(this,Eg);D(this,Ko,Promise.withResolvers());D(this,fs,null);D(this,gg,!1);D(this,mg,!!globalThis.FontInspector?.enabled);D(this,Vl,null);D(this,Wr,null);D(this,yg,0);D(this,bg,0);D(this,zl,null);D(this,xd,null);D(this,Ed,0);D(this,Xo,0);D(this,Sd,Object.create(null));D(this,vg,[]);D(this,Td,null);D(this,Hl,[]);D(this,_g,new WeakMap);D(this,wg,null);var u;if(e instanceof ReadableStream)k(this,Td,e);else if(typeof e=="object")k(this,Td,new ReadableStream({start(h){h.enqueue(e),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');k(this,fs,k(this,xd,t)),k(this,Xo,n.scale*(globalThis.devicePixelRatio||1)),k(this,Ed,n.rotation),k(this,Wr,{div:null,properties:null,ctx:null});let{pageWidth:i,pageHeight:r,pageX:o,pageY:l}=n.rawDims;k(this,wg,[1,0,0,-1,-o,l+r]),k(this,bg,i),k(this,yg,r),N(u=Lt,u0,FB).call(u),Ic(t,n),b(this,Ko).promise.finally(()=>{b(Lt,Ad).delete(this),k(this,Wr,null),k(this,Sd,null)}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:e,isFirefox:t}=kn.platform;return Ye(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){let e=()=>{b(this,zl).read().then(({value:t,done:n})=>{if(n){b(this,Ko).resolve();return}b(this,Vl)??k(this,Vl,t.lang),Object.assign(b(this,Sd),t.styles),N(this,l0,NB).call(this,t.items),e()},b(this,Ko).reject)};return k(this,zl,b(this,Td).getReader()),b(Lt,Ad).add(this),e(),b(this,Ko).promise}update({viewport:e,onBefore:t=null}){var r;let n=e.scale*(globalThis.devicePixelRatio||1),i=e.rotation;if(i!==b(this,Ed)&&(t?.(),k(this,Ed,i),Ic(b(this,xd),{rotation:i})),n!==b(this,Xo)){t?.(),k(this,Xo,n);let o={div:null,properties:null,ctx:N(r=Lt,Cd,Iv).call(r,b(this,Vl))};for(let l of b(this,Hl))o.properties=b(this,_g).get(l),o.div=l,N(this,Eg,wC).call(this,o)}}cancel(){let e=new or("TextLayer task cancelled.");b(this,zl)?.cancel(e).catch(()=>{}),k(this,zl,null),b(this,Ko).reject(e)}get textDivs(){return b(this,Hl)}get textContentItemsStr(){return b(this,vg)}static cleanup(){if(!(b(this,Ad).size>0)){b(this,Gl).clear();for(let{canvas:e}of b(this,jl).values())e.remove();b(this,jl).clear()}}};Ko=new WeakMap,fs=new WeakMap,gg=new WeakMap,mg=new WeakMap,Vl=new WeakMap,Wr=new WeakMap,yg=new WeakMap,bg=new WeakMap,zl=new WeakMap,xd=new WeakMap,Ed=new WeakMap,Xo=new WeakMap,Sd=new WeakMap,vg=new WeakMap,Td=new WeakMap,Hl=new WeakMap,_g=new WeakMap,wg=new WeakMap,Gl=new WeakMap,jl=new WeakMap,xg=new WeakMap,Jo=new WeakMap,Ad=new WeakMap,l0=new WeakSet,NB=function(e){var i,r;if(b(this,gg))return;(r=b(this,Wr)).ctx??(r.ctx=N(i=Lt,Cd,Iv).call(i,b(this,Vl)));let t=b(this,Hl),n=b(this,vg);for(let o of e){if(t.length>fY){Le("Ignoring additional textDivs for performance reasons."),k(this,gg,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){let l=b(this,fs);k(this,fs,document.createElement("span")),b(this,fs).classList.add("markedContent"),o.id!==null&&b(this,fs).setAttribute("id",`${o.id}`),l.append(b(this,fs))}else o.type==="endMarkedContent"&&k(this,fs,b(this,fs).parentNode);continue}n.push(o.str),N(this,c0,OB).call(this,o)}},c0=new WeakSet,OB=function(e){var g;let t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};b(this,Hl).push(t);let i=ve.transform(b(this,wg),e.transform),r=Math.atan2(i[1],i[0]),o=b(this,Sd)[e.fontName];o.vertical&&(r+=Math.PI/2);let l=b(this,mg)&&o.fontSubstitution||o.fontFamily;l=Lt.fontFamilyMap.get(l)||l;let u=Math.hypot(i[2],i[3]),h=u*N(g=Lt,d0,LB).call(g,l,b(this,Vl)),d,c;r===0?(d=i[4],c=i[5]-h):(d=i[4]+h*Math.sin(r),c=i[5]-h*Math.cos(r));let a="calc(var(--scale-factor)*",f=t.style;b(this,fs)===b(this,xd)?(f.left=`${(100*d/b(this,bg)).toFixed(2)}%`,f.top=`${(100*c/b(this,yg)).toFixed(2)}%`):(f.left=`${a}${d.toFixed(2)}px)`,f.top=`${a}${c.toFixed(2)}px)`),f.fontSize=`${a}${(b(Lt,Jo)*u).toFixed(2)}px)`,f.fontFamily=l,n.fontSize=u,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,b(this,mg)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(n.angle=r*(180/Math.PI));let p=!1;if(e.str.length>1)p=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){let m=Math.abs(e.transform[0]),y=Math.abs(e.transform[3]);m!==y&&Math.max(m,y)/Math.min(m,y)>1.5&&(p=!0)}if(p&&(n.canvasWidth=o.vertical?e.height:e.width),b(this,_g).set(t,n),b(this,Wr).div=t,b(this,Wr).properties=n,N(this,Eg,wC).call(this,b(this,Wr)),n.hasText&&b(this,fs).append(t),n.hasEOL){let m=document.createElement("br");m.setAttribute("role","presentation"),b(this,fs).append(m)}},Eg=new WeakSet,wC=function(e){var l;let{div:t,properties:n,ctx:i}=e,{style:r}=t,o="";if(b(Lt,Jo)>1&&(o=`scale(${1/b(Lt,Jo)})`),n.canvasWidth!==0&&n.hasText){let{fontFamily:u}=r,{canvasWidth:h,fontSize:d}=n;N(l=Lt,Sg,xC).call(l,i,d*b(this,Xo),u);let{width:c}=i.measureText(t.textContent);c>0&&(o=`scaleX(${h*b(this,Xo)/c}) ${o}`)}n.angle!==0&&(o=`rotate(${n.angle}deg) ${o}`),o.length>0&&(r.transform=o)},Cd=new WeakSet,Iv=function(e=null){let t=b(this,jl).get(e||(e=""));if(!t){let n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),b(this,jl).set(e,t),b(this,xg).set(t,{size:0,family:""})}return t},Sg=new WeakSet,xC=function(e,t,n){let i=b(this,xg).get(e);t===i.size&&n===i.family||(e.font=`${t}px ${n}`,i.size=t,i.family=n)},u0=new WeakSet,FB=function(){if(b(this,Jo)!==null)return;let e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),k(this,Jo,e.getBoundingClientRect().height),e.remove()},d0=new WeakSet,LB=function(e,t){let n=b(this,Gl).get(e);if(n)return n;let i=N(this,Cd,Iv).call(this,t);i.canvas.width=i.canvas.height=cs,N(this,Sg,xC).call(this,i,cs,e);let r=i.measureText(""),o=r.fontBoundingBoxAscent,l=Math.abs(r.fontBoundingBoxDescent);if(o){let d=o/(o+l);return b(this,Gl).set(e,d),i.canvas.width=i.canvas.height=0,d}i.strokeStyle="red",i.clearRect(0,0,cs,cs),i.strokeText("g",0,0);let u=i.getImageData(0,0,cs,cs).data;l=0;for(let d=u.length-1-3;d>=0;d-=4)if(u[d]>0){l=Math.ceil(d/4/cs);break}i.clearRect(0,0,cs,cs),i.strokeText("A",0,cs),u=i.getImageData(0,0,cs,cs).data,o=0;for(let d=0,c=u.length;d<c;d+=4)if(u[d]>0){o=cs-Math.floor(d/4/cs);break}i.canvas.width=i.canvas.height=0;let h=o?o/(o+l):pY;return b(this,Gl).set(e,h),h},D(Lt,Cd),D(Lt,Sg),D(Lt,u0),D(Lt,d0),D(Lt,Gl,new Map),D(Lt,jl,new Map),D(Lt,xg,new WeakMap),D(Lt,Jo,null),D(Lt,Ad,new Set);var ap=Lt,lp=class s{static textContent(e){let t=[],n={items:t,styles:Object.create(null)};function i(r){if(!r)return;let o=null,l=r.name;if(l==="#text")o=r.value;else if(s.shouldBuildText(l))r?.attributes?.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(let u of r.children)i(u)}return i(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}},gY=65536,mY=100,yY=5e3,bY=jn?qA:zA,vY=jn?YA:n_,_Y=jn?WA:HA,wY=jn?KA:r_;function xY(s={}){typeof s=="string"||s instanceof URL?s={url:s}:(s instanceof ArrayBuffer||ArrayBuffer.isView(s))&&(s={data:s});let e=new EC,{docId:t}=e,n=s.url?EY(s.url):null,i=s.data?SY(s.data):null,r=s.httpHeaders||null,o=s.withCredentials===!0,l=s.password??null,u=s.range instanceof l_?s.range:null,h=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:gY,d=s.worker instanceof Wu?s.worker:null,c=s.verbosity,a=typeof s.docBaseUrl=="string"&&!hw(s.docBaseUrl)?s.docBaseUrl:null,f=typeof s.cMapUrl=="string"?s.cMapUrl:null,p=s.cMapPacked!==!1,g=s.CMapReaderFactory||vY,m=typeof s.standardFontDataUrl=="string"?s.standardFontDataUrl:null,y=s.StandardFontDataFactory||wY,_=s.stopAtErrors!==!0,x=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,E=s.isEvalSupported!==!1,S=typeof s.isOffscreenCanvasSupported=="boolean"?s.isOffscreenCanvasSupported:!jn,T=typeof s.isImageDecoderSupported=="boolean"?s.isImageDecoderSupported:!jn&&(kn.platform.isFirefox||!globalThis.chrome),C=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,I=typeof s.disableFontFace=="boolean"?s.disableFontFace:jn,A=s.fontExtraProperties===!0,P=s.enableXfa===!0,F=s.ownerDocument||globalThis.document,H=s.disableRange===!0,z=s.disableStream===!0,B=s.disableAutoFetch===!0,V=s.pdfBug===!0,M=s.CanvasFactory||bY,$=s.FilterFactory||_Y,oe=s.enableHWA===!0,Z=u?u.length:s.length??NaN,le=typeof s.useSystemFonts=="boolean"?s.useSystemFonts:!jn&&!I,ae=typeof s.useWorkerFetch=="boolean"?s.useWorkerFetch:g===n_&&y===r_&&f&&m&&Ff(f,document.baseURI)&&Ff(m,document.baseURI),be=null;U8(c);let Ce={canvasFactory:new M({ownerDocument:F,enableHWA:oe}),filterFactory:new $({docId:t,ownerDocument:F}),cMapReaderFactory:ae?null:new g({baseUrl:f,isCompressed:p}),standardFontDataFactory:ae?null:new y({baseUrl:m})};if(!d){let Ie={verbosity:c,port:Ci.workerPort};d=Ie.port?Wu.fromPort(Ie):new Wu(Ie),e._worker=d}let Ze={docId:t,apiVersion:"4.10.38",data:i,password:l,disableAutoFetch:B,rangeChunkSize:h,length:Z,docBaseUrl:a,enableXfa:P,evaluatorOptions:{maxImageSize:x,disableFontFace:I,ignoreErrors:_,isEvalSupported:E,isOffscreenCanvasSupported:S,isImageDecoderSupported:T,canvasMaxAreaInBytes:C,fontExtraProperties:A,useSystemFonts:le,cMapUrl:ae?f:null,standardFontDataUrl:ae?m:null}},Ae={disableFontFace:I,fontExtraProperties:A,ownerDocument:F,pdfBug:V,styleElement:be,loadingParams:{disableAutoFetch:B,enableXfa:P}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let Ie=d.messageHandler.sendWithPromise("GetDocRequest",Ze,i?[i.buffer]:null),_e;if(u)_e=new cC(u,{disableRange:H,disableStream:z});else if(!i){if(!n)throw new Error("getDocument - no `url` parameter provided.");let ht;if(jn)if(Ff(n)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");ht=a_}else ht=bC;else ht=Ff(n)?a_:gC;_e=new ht({url:n,length:Z,httpHeaders:r,withCredentials:o,rangeChunkSize:h,disableRange:H,disableStream:z})}return Ie.then(ht=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let Vt=new cl(t,ht,d.port),ut=new CC(Vt,e,_e,Ae,Ce);e._transport=ut,Vt.send("Ready",null)})}).catch(e._capability.reject),e}function EY(s){if(s instanceof URL)return s.href;try{return new URL(s,window.location).href}catch{if(jn&&typeof s=="string")return s}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function SY(s){if(jn&&typeof Buffer<"u"&&s instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength)return s;if(typeof s=="string")return uw(s);if(s instanceof ArrayBuffer||ArrayBuffer.isView(s)||typeof s=="object"&&!isNaN(s?.length))return new Uint8Array(s);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function HU(s){return typeof s=="object"&&Number.isInteger(s?.num)&&s.num>=0&&Number.isInteger(s?.gen)&&s.gen>=0}var h0,f0=class f0{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${Yn(f0,h0)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}};h0=new WeakMap,D(f0,h0,0);var EC=f0,l_=class{constructor(e,t,n=!1,i=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let n of this._progressListeners)n(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){vt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},SC=class{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Ye(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},Zo,qr,Qo,Bu,Id,Dv,TC=class{constructor(e,t,n,i=!1){D(this,Qo);D(this,Id);D(this,Zo,null);D(this,qr,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=i?new Yv:null,this._pdfBug=i,this.commonObjs=n.commonObjs,this.objs=new c_,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:i=0,dontFlip:r=!1}={}){return new np({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:i,dontFlip:r})}getAnnotations({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Ye(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:i=Po.ENABLE,transform:r=null,background:o=null,optionalContentConfigPromise:l=null,annotationCanvasMap:u=null,pageColors:h=null,printAnnotationStorage:d=null,isEditing:c=!1}){this._stats?.time("Overall");let a=this._transport.getRenderingIntent(n,i,d,c),{renderingIntent:f,cacheKey:p}=a;k(this,qr,!1),N(this,Id,Dv).call(this),l||(l=this._transport.getOptionalContentConfig(f));let g=this._intentStates.get(p);g||(g=Object.create(null),this._intentStates.set(p,g)),g.streamReaderCancelTimeout&&(clearTimeout(g.streamReaderCancelTimeout),g.streamReaderCancelTimeout=null);let m=!!(f&Ns.PRINT);g.displayReadyCapability||(g.displayReadyCapability=Promise.withResolvers(),g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(a));let y=E=>{g.renderTasks.delete(_),(this._maybeCleanupAfterRender||m)&&k(this,qr,!0),N(this,Qo,Bu).call(this,!m),E?(_.capability.reject(E),this._abortOperatorList({intentState:g,reason:E instanceof Error?E:new Error(E)})):_.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},_=new kC({callback:y,params:{canvasContext:e,viewport:t,transform:r,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:u,operatorList:g.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!m,pdfBug:this._pdfBug,pageColors:h});(g.renderTasks||(g.renderTasks=new Set)).add(_);let x=_.task;return Promise.all([g.displayReadyCapability.promise,l]).then(([E,S])=>{if(this.destroyed){y();return}if(this._stats?.time("Rendering"),!(S.renderingIntent&f))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");_.initializeGraphics({transparency:E,optionalContentConfig:S}),_.operatorListChanged()}).catch(y),x}getOperatorList({intent:e="display",annotationMode:t=Po.ENABLE,printAnnotationStorage:n=null,isEditing:i=!1}={}){function r(){l.operatorList.lastChunk&&(l.opListReadCapability.resolve(l.operatorList),l.renderTasks.delete(u))}let o=this._transport.getRenderingIntent(e,t,n,i,!0),l=this._intentStates.get(o.cacheKey);l||(l=Object.create(null),this._intentStates.set(o.cacheKey,l));let u;return l.opListReadCapability||(u=Object.create(null),u.operatorListChanged=r,l.opListReadCapability=Promise.withResolvers(),(l.renderTasks||(l.renderTasks=new Set)).add(u),l.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o)),l.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>lp.textContent(n));let t=this.streamTextContent(e);return new Promise(function(n,i){function r(){o.read().then(function({value:u,done:h}){if(h){n(l);return}l.lang??(l.lang=u.lang),Object.assign(l.styles,u.styles),l.items.push(...u.items),r()},i)}let o=t.getReader(),l={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),k(this,qr,!1),N(this,Id,Dv).call(this),Promise.all(e)}cleanup(e=!1){k(this,qr,!0);let t=N(this,Qo,Bu).call(this,!1);return e&&t&&this._stats&&(this._stats=new Yv),t}_startRenderPage(e,t){let n=this._intentStates.get(t);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let n=0,i=e.length;n<i;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let n of t.renderTasks)n.operatorListChanged();e.lastChunk&&N(this,Qo,Bu).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:i}){let{map:r,transfer:o}=n,u=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:i},o).getReader(),h=this._intentStates.get(t);h.streamReader=u;let d=()=>{u.read().then(({value:c,done:a})=>{if(a){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(c,h),d())},c=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(let a of h.renderTasks)a.operatorListChanged();N(this,Qo,Bu).call(this,!0)}if(h.displayReadyCapability)h.displayReadyCapability.reject(c);else if(h.opListReadCapability)h.opListReadCapability.reject(c);else throw c}})};d()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof sp){let i=mY;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new or(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[i,r]of this._intentStates)if(r===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}};Zo=new WeakMap,qr=new WeakMap,Qo=new WeakSet,Bu=function(e=!1){if(N(this,Id,Dv).call(this),!b(this,qr)||this.destroyed)return!1;if(e)return k(this,Zo,setTimeout(()=>{k(this,Zo,null),N(this,Qo,Bu).call(this,!1)},yY)),!1;for(let{renderTasks:t,operatorList:n}of this._intentStates.values())if(t.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),k(this,qr,!1),!0},Id=new WeakSet,Dv=function(){b(this,Zo)&&(clearTimeout(b(this,Zo)),k(this,Zo,null))};var Yr,p0,AC=class{constructor(){D(this,Yr,new Map);D(this,p0,Promise.resolve())}postMessage(e,t){let n={data:structuredClone(e,t?{transfer:t}:null)};b(this,p0).then(()=>{for(let[i]of b(this,Yr))i.call(this,n)})}addEventListener(e,t,n=null){let i=null;if(n?.signal instanceof AbortSignal){let{signal:r}=n;if(r.aborted){Le("LoopbackPort - cannot use an `aborted` signal.");return}let o=()=>this.removeEventListener(e,t);i=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}b(this,Yr).set(t,i)}removeEventListener(e,t){b(this,Yr).get(t)?.(),b(this,Yr).delete(t)}terminate(){for(let[,e]of b(this,Yr))e?.();b(this,Yr).clear()}};Yr=new WeakMap,p0=new WeakMap;var g0,Wl,ql,Dd,kv,kd,Rv,Ct=class Ct{constructor({name:e=null,port:t=null,verbosity:n=B8()}={}){D(this,Dd);if(this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if(b(Ct,ql)?.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(b(Ct,ql)||k(Ct,ql,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new cl("main","worker",e),this._messageHandler.on("ready",function(){}),N(this,Dd,kv).call(this)}_initialize(){if(b(Ct,Wl)||b(Ct,kd,Rv)){this._setupFakeWorker();return}let{workerSrc:e}=Ct;try{Ct._isSameOrigin(window.location.href,e)||(e=Ct._createCDNWrapper(new URL(e,window.location).href));let t=new Worker(e,{type:"module"}),n=new cl("main","worker",t),i=()=>{r.abort(),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=new AbortController;t.addEventListener("error",()=>{this._webWorker||i()},{signal:r.signal}),n.on("test",l=>{if(r.abort(),this.destroyed||!l){i();return}this._messageHandler=n,this._port=t,this._webWorker=t,N(this,Dd,kv).call(this)}),n.on("ready",l=>{if(r.abort(),this.destroyed){i();return}try{o()}catch{this._setupFakeWorker()}});let o=()=>{let l=new Uint8Array;n.send("test",l,[l.buffer])};o();return}catch{cw("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){b(Ct,Wl)||(Le("Setting up fake worker."),k(Ct,Wl,!0)),Ct._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let t=new AC;this._port=t;let n=`fake${Yn(Ct,g0)._++}`,i=new cl(n+"_worker",n,t);e.setup(i,t),this._messageHandler=new cl(n,n+"_worker",t),N(this,Dd,kv).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this._webWorker?.terminate(),this._webWorker=null,b(Ct,ql)?.delete(this._port),this._port=null,this._messageHandler?.destroy(),this._messageHandler=null}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");let t=b(this,ql)?.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Ct(e)}static get workerSrc(){if(Ci.workerSrc)return Ci.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Ye(this,"_setupFakeWorkerGlobal",(async()=>b(this,kd,Rv)?b(this,kd,Rv):(await import(this.workerSrc)).WorkerMessageHandler)())}};g0=new WeakMap,Wl=new WeakMap,ql=new WeakMap,Dd=new WeakSet,kv=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},kd=new WeakSet,Rv=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},D(Ct,kd),D(Ct,g0,0),D(Ct,Wl,!1),D(Ct,ql,void 0),jn&&(k(Ct,Wl,!0),Ci.workerSrc||(Ci.workerSrc="./pdf.worker.mjs")),Ct._isSameOrigin=(e,t)=>{let n;try{if(n=new URL(e),!n.origin||n.origin==="null")return!1}catch{return!1}let i=new URL(t,n);return n.origin===i.origin},Ct._createCDNWrapper=e=>{let t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};var Wu=Ct,Kr,Ji,Rd,Pd,Xr,Yl,Gf,CC=class{constructor(e,t,n,i,r){D(this,Yl);D(this,Kr,new Map);D(this,Ji,new Map);D(this,Rd,new Map);D(this,Pd,new Map);D(this,Xr,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new c_,this.fontLoader=new BA({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Ye(this,"annotationStorage",new rp)}getRenderingIntent(e,t=Po.ENABLE,n=null,i=!1,r=!1){let o=Ns.DISPLAY,l=UA;switch(e){case"any":o=Ns.ANY;break;case"display":break;case"print":o=Ns.PRINT;break;default:Le(`getRenderingIntent - invalid intent: ${e}`)}let u=o&Ns.PRINT&&n instanceof Qv?n:this.annotationStorage;switch(t){case Po.DISABLE:o+=Ns.ANNOTATIONS_DISABLE;break;case Po.ENABLE:break;case Po.ENABLE_FORMS:o+=Ns.ANNOTATIONS_FORMS;break;case Po.ENABLE_STORAGE:o+=Ns.ANNOTATIONS_STORAGE,l=u.serializable;break;default:Le(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(o+=Ns.IS_EDITING),r&&(o+=Ns.OPLIST);let{ids:h,hash:d}=u.modifiedIds,c=[o,l.hash,d];return{renderingIntent:o,cacheKey:c.join("_"),annotationStorageSerializable:l,modifiedIds:h}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),b(this,Xr)?.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let n of b(this,Ji).values())e.push(n._destroy());b(this,Ji).clear(),b(this,Rd).clear(),b(this,Pd).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),b(this,Kr).clear(),this.filterFactory.destroy(),ap.cleanup(),this._networkStream?.cancelAllRequests(new or("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,i)=>{Zt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){i.close();return}Zt(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async n=>{await this._fullReader.headersReady;let{isStreamingSupported:i,isRangeSupported:r,contentLength:o}=this._fullReader;return(!i||!r)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=l=>{t.onProgress?.({loaded:l.loaded,total:l.total})}),{isStreamingSupported:i,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(n,i)=>{Zt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let r=this._networkStream.getRangeReader(n.begin,n.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:o,done:l}){if(l){i.close();return}Zt(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{r.cancel(o),i.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new SC(n,this))}),e.on("DocException",n=>{t._capability.reject(us(n))}),e.on("PasswordRequest",n=>{k(this,Xr,Promise.withResolvers());try{if(!t.onPassword)throw us(n);let i=r=>{r instanceof Error?b(this,Xr).reject(r):b(this,Xr).resolve({password:r})};t.onPassword(i,n.code)}catch(i){b(this,Xr).reject(i)}return b(this,Xr).promise}),e.on("DataLoaded",n=>{t.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;b(this,Ji).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,i,r])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(i){case"Font":let{disableFontFace:o,fontExtraProperties:l,pdfBug:u}=this._params;if("error"in r){let a=r.error;Le(`Error during font loading: ${a}`),this.commonObjs.resolve(n,a);break}let h=u&&globalThis.FontInspector?.enabled?(a,f)=>globalThis.FontInspector.fontAdded(a,f):null,d=new VA(r,{disableFontFace:o,fontExtraProperties:l,inspectFont:h});this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!l&&d.data&&(d.data=null),this.commonObjs.resolve(n,d)});break;case"CopyLocalImage":let{imageRef:c}=r;Zt(c,"The imageRef must be defined.");for(let a of b(this,Ji).values())for(let[,f]of a.objs)if(f?.ref===c)return f.dataLen?(this.commonObjs.resolve(n,structuredClone(f)),f.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,r);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([n,i,r,o])=>{if(this.destroyed)return;let l=b(this,Ji).get(i);if(!l.objs.has(n)){if(l._intentStates.size===0){o?.bitmap?.close();return}switch(r){case"Image":l.objs.resolve(n,o),o?.dataLen>N8&&(l._maybeCleanupAfterRender=!0);break;case"Pattern":l.objs.resolve(n,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",n=>{this.destroyed||t.onProgress?.({loaded:n.loaded,total:n.total})}),e.on("FetchBuiltInCMap",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(n)}),e.on("FetchStandardFontData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&Le("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,n=b(this,Rd).get(t);if(n)return n;let i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&b(this,Pd).set(r.refStr,e);let o=new TC(t,r,this,this._params.pdfBug);return b(this,Ji).set(t,o),o});return b(this,Rd).set(t,i),i}getPageIndex(e){return HU(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return N(this,Yl,Gf).call(this,"GetFieldObjects")}hasJSActions(){return N(this,Yl,Gf).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return N(this,Yl,Gf).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return N(this,Yl,Gf).call(this,"GetOptionalContentConfig").then(t=>new aC(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",t=b(this,Kr).get(e);if(t)return t;let n=this.messageHandler.sendWithPromise(e,null).then(i=>({info:i[0],metadata:i[1]?new rC(i[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return b(this,Kr).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(let t of b(this,Ji).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),b(this,Kr).clear(),this.filterFactory.destroy(!0),ap.cleanup()}}cachedPageNumber(e){if(!HU(e))return null;let t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return b(this,Pd).get(t)??null}};Kr=new WeakMap,Ji=new WeakMap,Rd=new WeakMap,Pd=new WeakMap,Xr=new WeakMap,Yl=new WeakSet,Gf=function(e,t=null){let n=b(this,Kr).get(e);if(n)return n;let i=this.messageHandler.sendWithPromise(e,t);return b(this,Kr).set(e,i),i};var Nf=Symbol("INITIAL_DATA"),Ts,Tg,IC,c_=class{constructor(){D(this,Tg);D(this,Ts,Object.create(null))}get(e,t=null){if(t){let i=N(this,Tg,IC).call(this,e);return i.promise.then(()=>t(i.data)),null}let n=b(this,Ts)[e];if(!n||n.data===Nf)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){let t=b(this,Ts)[e];return!!t&&t.data!==Nf}delete(e){let t=b(this,Ts)[e];return!t||t.data===Nf?!1:(delete b(this,Ts)[e],!0)}resolve(e,t=null){let n=N(this,Tg,IC).call(this,e);n.data=t,n.resolve()}clear(){for(let e in b(this,Ts)){let{data:t}=b(this,Ts)[e];t?.bitmap?.close()}k(this,Ts,Object.create(null))}*[Symbol.iterator](){for(let e in b(this,Ts)){let{data:t}=b(this,Ts)[e];t!==Nf&&(yield[e,t])}}};Ts=new WeakMap,Tg=new WeakSet,IC=function(e){var t;return(t=b(this,Ts))[e]||(t[e]={...Promise.withResolvers(),data:Nf})};var ea,DC=class{constructor(e){D(this,ea,null);k(this,ea,e),this.onContinue=null}get promise(){return b(this,ea).capability.promise}cancel(e=0){b(this,ea).cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=b(this,ea).operatorList;if(!e)return!1;let{annotationCanvasMap:t}=b(this,ea);return e.form||e.canvas&&t?.size>0}};ea=new WeakMap;var ta,Kl,ll=class ll{constructor({callback:e,params:t,objs:n,commonObjs:i,annotationCanvasMap:r,operatorList:o,pageIndex:l,canvasFactory:u,filterFactory:h,useRequestAnimationFrame:d=!1,pdfBug:c=!1,pageColors:a=null}){D(this,ta,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=l,this.canvasFactory=u,this.filterFactory=h,this._pdfBug=c,this.pageColors=a,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new DC(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(b(ll,Kl).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");b(ll,Kl).add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:n,viewport:i,transform:r,background:o}=this.params;this.gfx=new ju(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:i,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),b(this,ta)&&(window.cancelAnimationFrame(b(this,ta)),k(this,ta,null)),b(ll,Kl).delete(this._canvas),this.callback(e||new sp(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?k(this,ta,window.requestAnimationFrame(()=>{k(this,ta,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),b(ll,Kl).delete(this._canvas),this.callback())))}};ta=new WeakMap,Kl=new WeakMap,D(ll,Kl,new WeakSet);var kC=ll,TY="4.10.38",AY="f9bea397f";function GU(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}function Of(s){return Math.max(0,Math.min(255,255*s))}var u_=class{static CMYK_G([e,t,n,i]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Of(e),[e,e,e]}static G_HTML([e]){let t=GU(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(Of)}static RGB_HTML(e){return`#${e.map(GU).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,n+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,n,i]){return[Of(1-Math.min(1,e+i)),Of(1-Math.min(1,n+i)),Of(1-Math.min(1,t+i))]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){let i=1-e,r=1-t,o=1-n,l=Math.min(i,r,o);return["CMYK",i,r,o,l]}},RC=class{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");let i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),n||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){vt("Abstract method `_createSVG` called.")}},cp=class extends RC{_createSVG(e){return document.createElementNS(Pr,e)}},d_=class{static setupStorage(e,t,n,i,r){let o=i.getValue(t,{value:null});switch(n.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",l=>{i.setValue(t,{value:l.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(o.value===n.attributes.xfaOn?e.setAttribute("checked",!0):o.value===n.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",l=>{i.setValue(t,{value:l.target.checked?l.target.getAttribute("xfaOn"):l.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",l=>{i.setValue(t,{value:l.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(let l of n.children)l.attributes.value===o.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}e.addEventListener("input",l=>{let u=l.target.options,h=u.selectedIndex===-1?"":u[u.selectedIndex].value;i.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:i,linkService:r}){let{attributes:o}=t,l=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(let[u,h]of Object.entries(o))if(h!=null)switch(u){case"class":h.length&&e.setAttribute(u,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!l||u!=="href"&&u!=="newWindow")&&e.setAttribute(u,h)}l&&r.addLinkAttributes(e,o.href,o.newWindow),n&&o.dataId&&this.setupStorage(e,o.dataId,t,n)}static render(e){let t=e.annotationStorage,n=e.linkService,i=e.xfaHtml,r=e.intent||"display",o=document.createElement(i.name);i.attributes&&this.setAttributes({html:o,element:i,intent:r,linkService:n});let l=r!=="richText",u=e.div;if(u.append(o),e.viewport){let c=`matrix(${e.viewport.transform.join(",")})`;u.style.transform=c}l&&u.setAttribute("class","xfaLayer xfaFont");let h=[];if(i.children.length===0){if(i.value){let c=document.createTextNode(i.value);o.append(c),l&&lp.shouldBuildText(i.name)&&h.push(c)}return{textDivs:h}}let d=[[i,-1,o]];for(;d.length>0;){let[c,a,f]=d.at(-1);if(a+1===c.children.length){d.pop();continue}let p=c.children[++d.at(-1)[1]];if(p===null)continue;let{name:g}=p;if(g==="#text"){let y=document.createTextNode(p.value);h.push(y),f.append(y);continue}let m=p?.attributes?.xmlns?document.createElementNS(p.attributes.xmlns,g):document.createElement(g);if(f.append(m),p.attributes&&this.setAttributes({html:m,element:p,storage:t,intent:r,linkService:n}),p.children?.length>0)d.push([p,-1,m]);else if(p.value){let y=document.createTextNode(p.value);l&&lp.shouldBuildText(g)&&h.push(y),m.append(y)}}for(let c of u.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))c.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){let t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}},Am=1e3,CY=9,Rc=new WeakSet;function ga(s){return{width:s[2]-s[0],height:s[3]-s[1]}}var PC=class{static create(e){switch(e.data.annotationType){case sn.LINK:return new h_(e);case sn.TEXT:return new NC(e);case sn.WIDGET:switch(e.data.fieldType){case"Tx":return new OC(e);case"Btn":return e.data.radioButton?new f_(e):e.data.checkBox?new LC(e):new $C(e);case"Ch":return new UC(e);case"Sig":return new FC(e)}return new ho(e);case sn.POPUP:return new up(e);case sn.FREETEXT:return new p_(e);case sn.LINE:return new HC(e);case sn.SQUARE:return new GC(e);case sn.CIRCLE:return new jC(e);case sn.POLYLINE:return new g_(e);case sn.CARET:return new qC(e);case sn.INK:return new dp(e);case sn.POLYGON:return new WC(e);case sn.HIGHLIGHT:return new m_(e);case sn.UNDERLINE:return new KC(e);case sn.SQUIGGLY:return new XC(e);case sn.STRIKEOUT:return new JC(e);case sn.STAMP:return new y_(e);case sn.FILEATTACHMENT:return new ZC(e);default:return new jt(e)}}},Xl,Md,Nd,Ag,MC,F1=class F1{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:i=!1}={}){D(this,Ag);D(this,Xl,null);D(this,Md,!1);D(this,Nd,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:n}){return!!(e?.str||t?.str||n?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return F1._hasPopupData(this.data)}updateEdited(e){if(!this.container)return;b(this,Xl)||k(this,Xl,{rect:this.data.rect.slice(0)});let{rect:t}=e;t&&N(this,Ag,MC).call(this,t),b(this,Nd)?.popup.updateEdited(e)}resetEdited(){b(this,Xl)&&(N(this,Ag,MC).call(this,b(this,Xl).rect),b(this,Nd)?.popup.resetEdited(),k(this,Xl,null))}_createContainer(e){let{data:t,parent:{page:n,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),this instanceof ho||(r.tabIndex=Am);let{style:o}=r;if(o.zIndex=this.parent.zIndex++,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof up){let{rotation:g}=t;return!t.hasOwnCanvas&&g!==0&&this.setRotation(g,r),r}let{width:l,height:u}=ga(t.rect);if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;let g=t.borderStyle.horizontalCornerRadius,m=t.borderStyle.verticalCornerRadius;if(g>0||m>0){let _=`calc(${g}px * var(--scale-factor)) / calc(${m}px * var(--scale-factor))`;o.borderRadius=_}else if(this instanceof f_){let _=`calc(${l}px * var(--scale-factor)) / calc(${u}px * var(--scale-factor))`;o.borderRadius=_}switch(t.borderStyle.style){case Pf.SOLID:o.borderStyle="solid";break;case Pf.DASHED:o.borderStyle="dashed";break;case Pf.BEVELED:Le("Unimplemented border style: beveled");break;case Pf.INSET:Le("Unimplemented border style: inset");break;case Pf.UNDERLINE:o.borderBottomStyle="solid";break;default:break}let y=t.borderColor||null;y?(k(this,Md,!0),o.borderColor=ve.makeHexColor(y[0]|0,y[1]|0,y[2]|0)):o.borderWidth=0}let h=ve.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:d,pageHeight:c,pageX:a,pageY:f}=i.rawDims;o.left=`${100*(h[0]-a)/d}%`,o.top=`${100*(h[1]-f)/c}%`;let{rotation:p}=t;return t.hasOwnCanvas||p===0?(o.width=`${100*l/d}%`,o.height=`${100*u/c}%`):this.setRotation(p,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;let{pageWidth:n,pageHeight:i}=this.parent.viewport.rawDims,{width:r,height:o}=ga(this.data.rect),l,u;e%180===0?(l=100*r/n,u=100*o/i):(l=100*o/n,u=100*r/i),t.style.width=`${l}%`,t.style.height=`${u}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(t,n,i)=>{let r=i.detail[t],o=r[0],l=r.slice(1);i.target.style[n]=u_[`${o}_HTML`](l),this.annotationStorage.setValue(this.data.id,{[n]:u_[`${o}_rgb`](l)})};return Ye(this,"_commonActions",{display:t=>{let{display:n}=t.detail,i=n%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{let{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{let n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){let n=this._commonActions;for(let i of Object.keys(t.detail))(e[i]||n[i])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let n=this._commonActions;for(let[i,r]of Object.entries(t)){let o=n[i];if(o){let l={detail:{[i]:r},target:e};o(l),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:e}=this.data;if(!e)return;let[t,n,i,r]=this.data.rect.map(g=>Math.fround(g));if(e.length===8){let[g,m,y,_]=e.subarray(2,6);if(i===g&&r===m&&t===y&&n===_)return}let{style:o}=this.container,l;if(b(this,Md)){let{borderColor:g,borderWidth:m}=o;o.borderWidth=0,l=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${m}">`],this.container.classList.add("hasBorder")}let u=i-t,h=r-n,{svgFactory:d}=this,c=d.createElement("svg");c.classList.add("quadrilateralsContainer"),c.setAttribute("width",0),c.setAttribute("height",0);let a=d.createElement("defs");c.append(a);let f=d.createElement("clipPath"),p=`clippath_${this.data.id}`;f.setAttribute("id",p),f.setAttribute("clipPathUnits","objectBoundingBox"),a.append(f);for(let g=2,m=e.length;g<m;g+=8){let y=e[g],_=e[g+1],x=e[g+2],E=e[g+3],S=d.createElement("rect"),T=(x-t)/u,C=(r-_)/h,I=(y-x)/u,A=(_-E)/h;S.setAttribute("x",T),S.setAttribute("y",C),S.setAttribute("width",I),S.setAttribute("height",A),f.append(S),l?.push(`<rect vector-effect="non-scaling-stroke" x="${T}" y="${C}" width="${I}" height="${A}"/>`)}b(this,Md)&&(l.push("</g></svg>')"),o.backgroundImage=l.join("")),this.container.append(c),this.container.style.clipPath=`url(#${p})`}_createPopup(){let{data:e}=this,t=k(this,Nd,new up({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){vt("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let n=[];if(this._fieldObjects){let i=this._fieldObjects[e];if(i)for(let{page:r,id:o,exportValues:l}of i){if(r===-1||o===t)continue;let u=typeof l=="string"?l:null,h=document.querySelector(`[data-element-id="${o}"]`);if(h&&!Rc.has(h)){Le(`_getElementsByName - element not allowed: ${o}`);continue}n.push({id:o,exportValue:u,domElement:h})}return n}for(let i of document.getElementsByName(e)){let{exportValue:r}=i,o=i.getAttribute("data-element-id");o!==t&&Rc.has(i)&&n.push({id:o,exportValue:r,domElement:i})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};Xl=new WeakMap,Md=new WeakMap,Nd=new WeakMap,Ag=new WeakSet,MC=function(e){let{container:{style:t},data:{rect:n,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:l,pageY:u}}}}=this;n?.splice(0,4,...e);let{width:h,height:d}=ga(e);t.left=`${100*(e[0]-l)/r}%`,t.top=`${100*(o-e[3]+u)/o}%`,i===0?(t.width=`${100*h/r}%`,t.height=`${100*d/o}%`):this.setRotation(i)};var jt=F1,Jr,il,m0,$B,y0,UB,h_=class extends jt{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!n?.ignoreBorder,createQuadrilaterals:!0});D(this,Jr);D(this,m0);D(this,y0);this.isTooltipOnly=t.data.isTooltipOnly}render(){let{data:t,linkService:n}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let r=!1;return t.url?(n.addLinkAttributes(i,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(i,t.action),r=!0):t.attachment?(N(this,m0,$B).call(this,i,t.attachment,t.attachmentDest),r=!0):t.setOCGState?(N(this,y0,UB).call(this,i,t.setOCGState),r=!0):t.dest?(this._bindLink(i,t.dest),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),r=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(i,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(i),this.container}_bindLink(t,n){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&N(this,Jr,il).call(this)}_bindNamedAction(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),N(this,Jr,il).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");let i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let r of Object.keys(n.actions)){let o=i.get(r);o&&(t[o]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:r}}),!1))}t.onclick||(t.onclick=()=>!1),N(this,Jr,il).call(this)}_bindResetFormAction(t,n){let i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),N(this,Jr,il).call(this),!this._fieldObjects){Le('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{i?.();let{fields:r,refs:o,include:l}=n,u=[];if(r.length!==0||o.length!==0){let c=new Set(o);for(let a of r){let f=this._fieldObjects[a]||[];for(let{id:p}of f)c.add(p)}for(let a of Object.values(this._fieldObjects))for(let f of a)c.has(f.id)===l&&u.push(f)}else for(let c of Object.values(this._fieldObjects))u.push(...c);let h=this.annotationStorage,d=[];for(let c of u){let{id:a}=c;switch(d.push(a),c.type){case"text":{let p=c.defaultValue||"";h.setValue(a,{value:p});break}case"checkbox":case"radiobutton":{let p=c.defaultValue===c.exportValues;h.setValue(a,{value:p});break}case"combobox":case"listbox":{let p=c.defaultValue||"";h.setValue(a,{value:p});break}default:continue}let f=document.querySelector(`[data-element-id="${a}"]`);if(f){if(!Rc.has(f)){Le(`_bindResetFormAction - element not allowed: ${a}`);continue}}else continue;f.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}}),!1}}};Jr=new WeakSet,il=function(){this.container.setAttribute("data-internal-link","")},m0=new WeakSet,$B=function(t,n,i=null){t.href=this.linkService.getAnchorUrl(""),n.description&&(t.title=n.description),t.onclick=()=>(this.downloadManager?.openOrDownloadData(n.content,n.filename,i),!1),N(this,Jr,il).call(this)},y0=new WeakSet,UB=function(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),N(this,Jr,il).call(this)};var NC=class extends jt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}},ho=class extends jt{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return kn.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,i,r){n.includes("mouse")?e.addEventListener(n,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(n,o=>{if(n==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}r&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o)}})})}_setEventListeners(e,t,n,i){for(let[r,o]of n)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,r,o,i),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":ve.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||CY,r=e.style,o,l=2,u=h=>Math.round(10*h)/10;if(this.data.multiLine){let h=Math.abs(this.data.rect[3]-this.data.rect[1]-l),d=Math.round(h/(mv*i))||1,c=h/d;o=Math.min(i,u(c/mv))}else{let h=Math.abs(this.data.rect[3]-this.data.rect[1]-l);o=Math.min(i,u(h/mv))}r.fontSize=`calc(${o}px * var(--scale-factor))`,r.color=ve.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}},OC=class extends ho{constructor(e){let t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,i){let r=this.annotationStorage;for(let o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=n),r.setValue(o.id,{[i]:n})}render(){let e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){let i=e.getValue(t,{value:this.data.fieldValue}),r=i.value||"",o=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;o&&r.length>o&&(r=r.slice(0,o));let l=i.formattedValue||this.data.textContent?.join(`
`)||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));let u={userValue:r,formattedValue:l,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=l??r,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",l??r),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Rc.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=Am,this._setRequired(n,this.data.required),o&&(n.maxLength=o),n.addEventListener("input",d=>{e.setValue(t,{value:d.target.value}),this.setPropertyOnSiblings(n,"value",d.target.value,"value"),u.formattedValue=null}),n.addEventListener("resetform",d=>{let c=this.data.defaultFieldValue??"";n.value=u.userValue=c,u.formattedValue=null});let h=d=>{let{formattedValue:c}=u;c!=null&&(d.target.value=c),d.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",c=>{if(u.focused)return;let{target:a}=c;u.userValue&&(a.value=u.userValue),u.lastCommittedValue=a.value,u.commitKey=1,this.data.actions?.Focus||(u.focused=!0)}),n.addEventListener("updatefromsandbox",c=>{this.showElementAndHideCanvas(c.target);let a={value(f){u.userValue=f.detail.value??"",e.setValue(t,{value:u.userValue.toString()}),f.target.value=u.userValue},formattedValue(f){let{formattedValue:p}=f.detail;u.formattedValue=p,p!=null&&f.target!==document.activeElement&&(f.target.value=p),e.setValue(t,{formattedValue:p})},selRange(f){f.target.setSelectionRange(...f.detail.selRange)},charLimit:f=>{let{charLimit:p}=f.detail,{target:g}=f;if(p===0){g.removeAttribute("maxLength");return}g.setAttribute("maxLength",p);let m=u.userValue;!m||m.length<=p||(m=m.slice(0,p),g.value=u.userValue=m,e.setValue(t,{value:m}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:m,willCommit:!0,commitKey:1,selStart:g.selectionStart,selEnd:g.selectionEnd}}))}};this._dispatchEventFromSandbox(a,c)}),n.addEventListener("keydown",c=>{u.commitKey=1;let a=-1;if(c.key==="Escape"?a=0:c.key==="Enter"&&!this.data.multiLine?a=2:c.key==="Tab"&&(u.commitKey=3),a===-1)return;let{value:f}=c.target;u.lastCommittedValue!==f&&(u.lastCommittedValue=f,u.userValue=f,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:f,willCommit:!0,commitKey:a,selStart:c.target.selectionStart,selEnd:c.target.selectionEnd}}))});let d=h;h=null,n.addEventListener("blur",c=>{if(!u.focused||!c.relatedTarget)return;this.data.actions?.Blur||(u.focused=!1);let{value:a}=c.target;u.userValue=a,u.lastCommittedValue!==a&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:a,willCommit:!0,commitKey:u.commitKey,selStart:c.target.selectionStart,selEnd:c.target.selectionEnd}}),d(c)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",c=>{u.lastCommittedValue=null;let{data:a,target:f}=c,{value:p,selectionStart:g,selectionEnd:m}=f,y=g,_=m;switch(c.inputType){case"deleteWordBackward":{let x=p.substring(0,g).match(/\w*[^\w]*$/);x&&(y-=x[0].length);break}case"deleteWordForward":{let x=p.substring(g).match(/^[^\w]*\w*/);x&&(_+=x[0].length);break}case"deleteContentBackward":g===m&&(y-=1);break;case"deleteContentForward":g===m&&(_+=1);break}c.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:p,change:a||"",willCommit:!1,selStart:y,selEnd:_}})}),this._setEventListeners(n,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.value)}if(h&&n.addEventListener("blur",h),this.data.comb){let c=(this.data.rect[2]-this.data.rect[0])/o;n.classList.add("comb"),n.style.letterSpacing=`calc(${c}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},FC=class extends ho{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}},LC=class extends ho{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,n=t.id,i=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(n,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let r=document.createElement("input");return Rc.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=Am,r.addEventListener("change",o=>{let{name:l,checked:u}=o.target;for(let h of this._getElementsByName(l,n)){let d=u&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=d),e.setValue(h.id,{value:d})}e.setValue(n,{value:u})}),r.addEventListener("resetform",o=>{let l=t.defaultFieldValue||"Off";o.target.checked=l===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{let l={value(u){u.target.checked=u.detail.value!=="Off",e.setValue(n,{value:u.target.checked})}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},f_=class extends ho{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,t=this.data,n=t.id,i=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(n,{value:i})),i)for(let o of this._getElementsByName(t.fieldName,n))e.setValue(o.id,{value:!1});let r=document.createElement("input");if(Rc.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=Am,r.addEventListener("change",o=>{let{name:l,checked:u}=o.target;for(let h of this._getElementsByName(l,n))e.setValue(h.id,{value:!1});e.setValue(n,{value:u})}),r.addEventListener("resetform",o=>{let l=t.defaultFieldValue;o.target.checked=l!=null&&l===t.buttonValue}),this.enableScripting&&this.hasJSActions){let o=t.buttonValue;r.addEventListener("updatefromsandbox",l=>{let u={value:h=>{let d=o===h.detail.value;for(let c of this._getElementsByName(h.target.name)){let a=d&&c.id===n;c.domElement&&(c.domElement.checked=a),e.setValue(c.id,{value:a})}}};this._dispatchEventFromSandbox(u,l)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},$C=class extends h_{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}},UC=class extends ho{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Rc.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=Am;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",d=>{let c=this.data.defaultFieldValue;for(let a of i.options)a.selected=a.value===c});for(let d of this.data.options){let c=document.createElement("option");c.textContent=d.displayValue,c.value=d.exportValue,n.value.includes(d.exportValue)&&(c.setAttribute("selected",!0),r=!1),i.append(c)}let o=null;if(r){let d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),i.prepend(d),o=()=>{d.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}let l=d=>{let c=d?"value":"textContent",{options:a,multiple:f}=i;return f?Array.prototype.filter.call(a,p=>p.selected).map(p=>p[c]):a.selectedIndex===-1?null:a[a.selectedIndex][c]},u=l(!1),h=d=>{let c=d.target.options;return Array.prototype.map.call(c,a=>({displayValue:a.textContent,exportValue:a.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",d=>{let c={value(a){o?.();let f=a.detail.value,p=new Set(Array.isArray(f)?f:[f]);for(let g of i.options)g.selected=p.has(g.value);e.setValue(t,{value:l(!0)}),u=l(!1)},multipleSelection(a){i.multiple=!0},remove(a){let f=i.options,p=a.detail.remove;f[p].selected=!1,i.remove(p),f.length>0&&Array.prototype.findIndex.call(f,m=>m.selected)===-1&&(f[0].selected=!0),e.setValue(t,{value:l(!0),items:h(a)}),u=l(!1)},clear(a){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),u=l(!1)},insert(a){let{index:f,displayValue:p,exportValue:g}=a.detail.insert,m=i.children[f],y=document.createElement("option");y.textContent=p,y.value=g,m?m.before(y):i.append(y),e.setValue(t,{value:l(!0),items:h(a)}),u=l(!1)},items(a){let{items:f}=a.detail;for(;i.length!==0;)i.remove(0);for(let p of f){let{displayValue:g,exportValue:m}=p,y=document.createElement("option");y.textContent=g,y.value=m,i.append(y)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:l(!0),items:h(a)}),u=l(!1)},indices(a){let f=new Set(a.detail.indices);for(let p of a.target.options)p.selected=f.has(p.index);e.setValue(t,{value:l(!0)}),u=l(!1)},editable(a){a.target.disabled=!a.detail.editable}};this._dispatchEventFromSandbox(c,d)}),i.addEventListener("input",d=>{let c=l(!0),a=l(!1);e.setValue(t,{value:c}),d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:u,change:a,changeEx:c,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):i.addEventListener("input",function(d){e.setValue(t,{value:l(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},up=class extends jt{constructor(e){let{data:t,elements:n}=e;super(e,{isRenderable:jt._hasPopupData(t)}),this.elements=n,this.popup=null}render(){this.container.classList.add("popupAnnotation");let e=this.popup=new BC({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let n of this.elements)n.popup=e,n.container.ariaHasPopup="dialog",t.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(n=>`${k1}${n}`).join(",")),this.container}},Od,b0,v0,Fd,Jl,$t,Zr,Ld,Cg,Ig,$d,Qr,bi,eo,Dg,to,kg,Zl,Ql,Ud,Pv,Rg,VC,_0,BB,w0,VB,x0,zB,E0,HB,Bd,Mv,Vd,Nv,Pg,zC,BC=class{constructor({container:e,color:t,elements:n,titleObj:i,modificationDate:r,contentsObj:o,richText:l,parent:u,rect:h,parentRect:d,open:c}){D(this,Ud);D(this,Rg);D(this,_0);D(this,w0);D(this,x0);D(this,E0);D(this,Bd);D(this,Vd);D(this,Pg);D(this,Od,N(this,x0,zB).bind(this));D(this,b0,N(this,Pg,zC).bind(this));D(this,v0,N(this,Vd,Nv).bind(this));D(this,Fd,N(this,Bd,Mv).bind(this));D(this,Jl,null);D(this,$t,null);D(this,Zr,null);D(this,Ld,null);D(this,Cg,null);D(this,Ig,null);D(this,$d,null);D(this,Qr,!1);D(this,bi,null);D(this,eo,null);D(this,Dg,null);D(this,to,null);D(this,kg,null);D(this,Zl,null);D(this,Ql,!1);k(this,$t,e),k(this,kg,i),k(this,Zr,o),k(this,to,l),k(this,Ig,u),k(this,Jl,t),k(this,Dg,h),k(this,$d,d),k(this,Cg,n),k(this,Ld,Qf.toDateObject(r)),this.trigger=n.flatMap(a=>a.getElementsToTriggerPopup());for(let a of this.trigger)a.addEventListener("click",b(this,Fd)),a.addEventListener("mouseenter",b(this,v0)),a.addEventListener("mouseleave",b(this,b0)),a.classList.add("popupTriggerArea");for(let a of n)a.container?.addEventListener("keydown",b(this,Od));b(this,$t).hidden=!0,c&&N(this,Bd,Mv).call(this)}render(){if(b(this,bi))return;let e=k(this,bi,document.createElement("div"));if(e.className="popup",b(this,Jl)){let r=e.style.outlineColor=ve.makeHexColor(...b(this,Jl));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`:e.style.backgroundColor=ve.makeHexColor(...b(this,Jl).map(l=>Math.floor(.7*(255-l)+l)))}let t=document.createElement("span");t.className="header";let n=document.createElement("h1");if(t.append(n),{dir:n.dir,str:n.textContent}=b(this,kg),e.append(t),b(this,Ld)){let r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:b(this,Ld).valueOf()})),t.append(r)}let i=b(this,Ud,Pv);if(i)d_.render({xfaHtml:i,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{let r=this._formatContents(b(this,Zr));e.append(r)}b(this,$t).append(e)}_formatContents({str:e,dir:t}){let n=document.createElement("p");n.classList.add("popupContent"),n.dir=t;let i=e.split(/(?:\r\n?|\n)/);for(let r=0,o=i.length;r<o;++r){let l=i[r];n.append(document.createTextNode(l)),r<o-1&&n.append(document.createElement("br"))}return n}updateEdited({rect:e,popupContent:t}){b(this,Zl)||k(this,Zl,{contentsObj:b(this,Zr),richText:b(this,to)}),e&&k(this,eo,null),t&&(k(this,to,N(this,w0,VB).call(this,t)),k(this,Zr,null)),b(this,bi)?.remove(),k(this,bi,null)}resetEdited(){b(this,Zl)&&({contentsObj:Yn(this,Zr)._,richText:Yn(this,to)._}=b(this,Zl),k(this,Zl,null),b(this,bi)?.remove(),k(this,bi,null),k(this,eo,null))}forceHide(){k(this,Ql,this.isVisible),b(this,Ql)&&(b(this,$t).hidden=!0)}maybeShow(){b(this,Ql)&&(b(this,bi)||N(this,Vd,Nv).call(this),k(this,Ql,!1),b(this,$t).hidden=!1)}get isVisible(){return b(this,$t).hidden===!1}};Od=new WeakMap,b0=new WeakMap,v0=new WeakMap,Fd=new WeakMap,Jl=new WeakMap,$t=new WeakMap,Zr=new WeakMap,Ld=new WeakMap,Cg=new WeakMap,Ig=new WeakMap,$d=new WeakMap,Qr=new WeakMap,bi=new WeakMap,eo=new WeakMap,Dg=new WeakMap,to=new WeakMap,kg=new WeakMap,Zl=new WeakMap,Ql=new WeakMap,Ud=new WeakSet,Pv=function(){let e=b(this,to),t=b(this,Zr);return e?.str&&(!t?.str||t.str===e.str)&&b(this,to).html||null},Rg=new WeakSet,VC=function(){return b(this,Ud,Pv)?.attributes?.style?.fontSize||0},_0=new WeakSet,BB=function(){return b(this,Ud,Pv)?.attributes?.style?.color||null},w0=new WeakSet,VB=function(e){let t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:b(this,_0,BB),fontSize:b(this,Rg,VC)?`calc(${b(this,Rg,VC)}px * var(--scale-factor))`:""}};for(let r of e.split(`
`))t.push({name:"span",value:r,attributes:i});return n},x0=new WeakSet,zB=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&b(this,Qr))&&N(this,Bd,Mv).call(this)},E0=new WeakSet,HB=function(){if(b(this,eo)!==null)return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:i,pageY:r}}}=b(this,Ig),o=!!b(this,$d),l=o?b(this,$d):b(this,Dg);for(let p of b(this,Cg))if(!l||ve.intersect(p.data.rect,l)!==null){l=p.data.rect,o=!0;break}let u=ve.normalizeRect([l[0],e[3]-l[1]+e[1],l[2],e[3]-l[3]+e[1]]),d=o?l[2]-l[0]+5:0,c=u[0]+d,a=u[1];k(this,eo,[100*(c-i)/t,100*(a-r)/n]);let{style:f}=b(this,$t);f.left=`${b(this,eo)[0]}%`,f.top=`${b(this,eo)[1]}%`},Bd=new WeakSet,Mv=function(){k(this,Qr,!b(this,Qr)),b(this,Qr)?(N(this,Vd,Nv).call(this),b(this,$t).addEventListener("click",b(this,Fd)),b(this,$t).addEventListener("keydown",b(this,Od))):(N(this,Pg,zC).call(this),b(this,$t).removeEventListener("click",b(this,Fd)),b(this,$t).removeEventListener("keydown",b(this,Od)))},Vd=new WeakSet,Nv=function(){b(this,bi)||this.render(),this.isVisible?b(this,Qr)&&b(this,$t).classList.add("focused"):(N(this,E0,HB).call(this),b(this,$t).hidden=!1,b(this,$t).style.zIndex=parseInt(b(this,$t).style.zIndex)+1e3)},Pg=new WeakSet,zC=function(){b(this,$t).classList.remove("focused"),!(b(this,Qr)||!this.isVisible)&&(b(this,$t).hidden=!0,b(this,$t).style.zIndex=parseInt(b(this,$t).style.zIndex)-1e3)};var p_=class extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Fe.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(let t of this.textContent){let n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Mg,HC=class extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});D(this,Mg,null)}render(){this.container.classList.add("lineAnnotation");let t=this.data,{width:n,height:i}=ga(t.rect),r=this.svgFactory.create(n,i,!0),o=k(this,Mg,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return b(this,Mg)}addHighlightArea(){this.container.classList.add("highlightArea")}};Mg=new WeakMap;var Ng,GC=class extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});D(this,Ng,null)}render(){this.container.classList.add("squareAnnotation");let t=this.data,{width:n,height:i}=ga(t.rect),r=this.svgFactory.create(n,i,!0),o=t.borderStyle.width,l=k(this,Ng,this.svgFactory.createElement("svg:rect"));return l.setAttribute("x",o/2),l.setAttribute("y",o/2),l.setAttribute("width",n-o),l.setAttribute("height",i-o),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),r.append(l),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return b(this,Ng)}addHighlightArea(){this.container.classList.add("highlightArea")}};Ng=new WeakMap;var Og,jC=class extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});D(this,Og,null)}render(){this.container.classList.add("circleAnnotation");let t=this.data,{width:n,height:i}=ga(t.rect),r=this.svgFactory.create(n,i,!0),o=t.borderStyle.width,l=k(this,Og,this.svgFactory.createElement("svg:ellipse"));return l.setAttribute("cx",n/2),l.setAttribute("cy",i/2),l.setAttribute("rx",n/2-o/2),l.setAttribute("ry",i/2-o/2),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),r.append(l),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return b(this,Og)}addHighlightArea(){this.container.classList.add("highlightArea")}};Og=new WeakMap;var Fg,g_=class extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});D(this,Fg,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,vertices:n,borderStyle:i,popupRef:r}}=this;if(!n)return this.container;let{width:o,height:l}=ga(t),u=this.svgFactory.create(o,l,!0),h=[];for(let c=0,a=n.length;c<a;c+=2){let f=n[c]-t[0],p=t[3]-n[c+1];h.push(`${f},${p}`)}h=h.join(" ");let d=k(this,Fg,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",h),d.setAttribute("stroke-width",i.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),u.append(d),this.container.append(u),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return b(this,Fg)}addHighlightArea(){this.container.classList.add("highlightArea")}};Fg=new WeakMap;var WC=class extends g_{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},qC=class extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},Lg,ec,$g,YC,dp=class extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});D(this,$g);D(this,Lg,null);D(this,ec,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Fe.HIGHLIGHT:Fe.INK}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,rotation:n,inkLists:i,borderStyle:r,popupRef:o}}=this,{transform:l,width:u,height:h}=N(this,$g,YC).call(this,n,t),d=this.svgFactory.create(u,h,!0),c=k(this,Lg,this.svgFactory.createElement("svg:g"));d.append(c),c.setAttribute("stroke-width",r.width||1),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit",10),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),c.setAttribute("transform",l);for(let a=0,f=i.length;a<f;a++){let p=this.svgFactory.createElement(this.svgElementName);b(this,ec).push(p),p.setAttribute("points",i[a].join(",")),c.append(p)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);let{thickness:n,points:i,rect:r}=t,o=b(this,Lg);if(n>=0&&o.setAttribute("stroke-width",n||1),i)for(let l=0,u=b(this,ec).length;l<u;l++)b(this,ec)[l].setAttribute("points",i[l].join(","));if(r){let{transform:l,width:u,height:h}=N(this,$g,YC).call(this,this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${u} ${h}`),o.setAttribute("transform",l)}}getElementsToTriggerPopup(){return b(this,ec)}addHighlightArea(){this.container.classList.add("highlightArea")}};Lg=new WeakMap,ec=new WeakMap,$g=new WeakSet,YC=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};var m_=class extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Fe.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},KC=class extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},XC=class extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},JC=class extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},y_=class extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Fe.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Ug,Bg,QC,ZC=class extends jt{constructor(t){super(t,{isRenderable:!0});D(this,Bg);D(this,Ug,null);let{file:n}=this.data;this.filename=n.filename,this.content=n.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:t,data:n}=this,i;n.hasAppearance||n.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),i.addEventListener("dblclick",N(this,Bg,QC).bind(this)),k(this,Ug,i);let{isMac:r}=kn.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&N(this,Bg,QC).call(this)}),!n.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return b(this,Ug)}addHighlightArea(){this.container.classList.add("highlightArea")}};Ug=new WeakMap,Bg=new WeakSet,QC=function(){this.downloadManager?.openOrDownloadData(this.content,this.filename)};var Vg,tc,nc,zg,S0,GB,Hg,t1,e1=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:i,page:r,viewport:o,structTreeLayer:l}){D(this,S0);D(this,Hg);D(this,Vg,null);D(this,tc,null);D(this,nc,new Map);D(this,zg,null);this.div=e,k(this,Vg,t),k(this,tc,n),k(this,zg,l||null),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return b(this,nc).size>0}async render(e){let{annotations:t}=e,n=this.div;Ic(n,this.viewport);let i=new Map,r={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new cp,annotationStorage:e.annotationStorage||new rp,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let o of t){if(o.noHTML)continue;let l=o.annotationType===sn.POPUP;if(l){let d=i.get(o.id);if(!d)continue;r.elements=d}else{let{width:d,height:c}=ga(o.rect);if(d<=0||c<=0)continue}r.data=o;let u=PC.create(r);if(!u.isRenderable)continue;if(!l&&o.popupRef){let d=i.get(o.popupRef);d?d.push(u):i.set(o.popupRef,[u])}let h=u.render();o.hidden&&(h.style.visibility="hidden"),await N(this,S0,GB).call(this,h,o.id),u._isEditable&&(b(this,nc).set(u.data.id,u),this._annotationEditorUIManager?.renderAnnotationElement(u))}N(this,Hg,t1).call(this)}update({viewport:e}){let t=this.div;this.viewport=e,Ic(t,{rotation:e.rotation}),N(this,Hg,t1).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(b(this,nc).values())}getEditableAnnotation(e){return b(this,nc).get(e)}};Vg=new WeakMap,tc=new WeakMap,nc=new WeakMap,zg=new WeakMap,S0=new WeakSet,GB=async function(e,t){let n=e.firstChild||e,i=n.id=`${k1}${t}`,r=await b(this,zg)?.getAriaAttributes(i);if(r)for(let[o,l]of r)n.setAttribute(o,l);this.div.append(e),b(this,Vg)?.moveElementInDOM(this.div,e,n,!1)},Hg=new WeakSet,t1=function(){if(!b(this,tc))return;let e=this.div;for(let[t,n]of b(this,tc)){let i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;n.className="annotationContent";let{firstChild:r}=i;r?r.nodeName==="CANVAS"?r.replaceWith(n):r.classList.contains("annotationContent")?r.after(n):r.before(n):i.append(n)}b(this,tc).clear()};var gv=/\r\n?|\n/g,vi,As,Gg,sc,Cs,T0,jB,A0,WB,C0,qB,zd,Ov,Hd,Fv,Gd,Lv,I0,YB,jg,s1,D0,KB,bt=class bt extends Ot{constructor(t){super({...t,name:"freeTextEditor"});D(this,T0);D(this,A0);D(this,C0);D(this,zd);D(this,Gd);D(this,I0);D(this,D0);D(this,vi,void 0);D(this,As,"");D(this,Gg,`${this.id}-editor`);D(this,sc,null);D(this,Cs,void 0);k(this,vi,t.color||bt._defaultColor||Ot._defaultLineColor),k(this,Cs,t.fontSize||bt._defaultFontSize)}static get _keyboardManager(){let t=bt.prototype,n=o=>o.isEmpty(),i=kc.TRANSLATE_SMALL,r=kc.TRANSLATE_BIG;return Ye(this,"_keyboardManager",new Dc([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:n}]]))}static initialize(t,n){Ot.initialize(t,n);let i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case nt.FREETEXT_SIZE:bt._defaultFontSize=n;break;case nt.FREETEXT_COLOR:bt._defaultColor=n;break}}updateParams(t,n){switch(t){case nt.FREETEXT_SIZE:N(this,T0,jB).call(this,n);break;case nt.FREETEXT_COLOR:N(this,A0,WB).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[nt.FREETEXT_SIZE,bt._defaultFontSize],[nt.FREETEXT_COLOR,bt._defaultColor||Ot._defaultLineColor]]}get propertiesToUpdate(){return[[nt.FREETEXT_SIZE,b(this,Cs)],[nt.FREETEXT_COLOR,b(this,vi)]]}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){let t=this.parentScale;return[-bt._internalPadding*t,-(bt._internalPadding+b(this,Cs))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Fe.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),k(this,sc,new AbortController);let t=this._uiManager.combinedSignal(b(this,sc));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",b(this,Gg)),this._isDraggable=!0,b(this,sc)?.abort(),k(this,sc,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let t=b(this,As),n=k(this,As,N(this,C0,qB).call(this).trimEnd());if(t===n)return;let i=r=>{if(k(this,As,r),!r){this.remove();return}N(this,Gd,Lv).call(this),this._uiManager.rebuild(this),N(this,zd,Ov).call(this)};this.addCommands({cmd:()=>{i(n)},undo:()=>{i(t)},mustExec:!1}),N(this,zd,Ov).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){bt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,n;this.width&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",b(this,Gg)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:i}=this.editorDiv;if(i.fontSize=`calc(${b(this,Cs)}px * var(--scale-factor))`,i.color=b(this,vi),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Kv(this,this.div,["dblclick","keydown"]),this.width){let[r,o]=this.parentDimensions;if(this.annotationElementId){let{position:l}=this._initialData,[u,h]=this.getInitialTranslation();[u,h]=this.pageTranslationToScreen(u,h);let[d,c]=this.pageDimensions,[a,f]=this.pageTranslation,p,g;switch(this.rotation){case 0:p=t+(l[0]-a)/d,g=n+this.height-(l[1]-f)/c;break;case 90:p=t+(l[0]-a)/d,g=n-(l[1]-f)/c,[u,h]=[h,-u];break;case 180:p=t-this.width+(l[0]-a)/d,g=n-(l[1]-f)/c,[u,h]=[-u,-h];break;case 270:p=t+(l[0]-a-this.height*c)/d,g=n+(l[1]-f-this.width*d)/c,[u,h]=[-h,u];break}this.setAt(p*r,g*o,u,h)}else this.setAt(t*r,n*o,this.width*r,this.height*o);N(this,Gd,Lv).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var p,g,m;let n=t.clipboardData||window.clipboardData,{types:i}=n;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();let r=N(p=bt,jg,s1).call(p,n.getData("text")||"").replaceAll(gv,`
`);if(!r)return;let o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();let l=o.getRangeAt(0);if(!r.includes(`
`)){l.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}let{startContainer:u,startOffset:h}=l,d=[],c=[];if(u.nodeType===Node.TEXT_NODE){let y=u.parentElement;if(c.push(u.nodeValue.slice(h).replaceAll(gv,"")),y!==this.editorDiv){let _=d;for(let x of this.editorDiv.childNodes){if(x===y){_=c;continue}_.push(N(g=bt,Hd,Fv).call(g,x))}}d.push(u.nodeValue.slice(0,h).replaceAll(gv,""))}else if(u===this.editorDiv){let y=d,_=0;for(let x of this.editorDiv.childNodes)_++===h&&(y=c),y.push(N(m=bt,Hd,Fv).call(m,x))}k(this,As,`${d.join(`
`)}${r}${c.join(`
`)}`),N(this,Gd,Lv).call(this);let a=new Range,f=d.reduce((y,_)=>y+_.length,0);for(let{firstChild:y}of this.editorDiv.childNodes)if(y.nodeType===Node.TEXT_NODE){let _=y.nodeValue.length;if(f<=_){a.setStart(y,f),a.setEnd(y,f);break}f-=_}o.removeAllRanges(),o.addRange(a)}get contentDiv(){return this.editorDiv}static async deserialize(t,n,i){var l;let r=null;if(t instanceof p_){let{data:{defaultAppearanceData:{fontSize:u,fontColor:h},rect:d,rotation:c,id:a,popupRef:f},textContent:p,textPosition:g,parent:{page:{pageNumber:m}}}=t;if(!p||p.length===0)return null;r=t={annotationType:Fe.FREETEXT,color:Array.from(h),fontSize:u,value:p.join(`
`),position:g,pageIndex:m-1,rect:d.slice(0),rotation:c,id:a,deleted:!1,popupRef:f}}let o=await super.deserialize(t,n,i);return k(o,Cs,t.fontSize),k(o,vi,ve.makeHexColor(...t.color)),k(o,As,N(l=bt,jg,s1).call(l,t.value)),o.annotationElementId=t.id||null,o._initialData=r,o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let n=bt._internalPadding*this.parentScale,i=this.getRect(n,n),r=Ot._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:b(this,vi)),o={annotationType:Fe.FREETEXT,color:r,fontSize:b(this,Cs),value:N(this,I0,YB).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?o:this.annotationElementId&&!N(this,D0,KB).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(t){let n=super.renderAnnotationElement(t);if(this.deleted)return n;let{style:i}=n;i.fontSize=`calc(${b(this,Cs)}px * var(--scale-factor))`,i.color=b(this,vi),n.replaceChildren();for(let o of b(this,As).split(`
`)){let l=document.createElement("div");l.append(o?document.createTextNode(o):document.createElement("br")),n.append(l)}let r=bt._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(r,r),popupContent:b(this,As)}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};vi=new WeakMap,As=new WeakMap,Gg=new WeakMap,sc=new WeakMap,Cs=new WeakMap,T0=new WeakSet,jB=function(t){let n=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--scale-factor))`,this.translate(0,-(r-b(this,Cs))*this.parentScale),k(this,Cs,r),N(this,zd,Ov).call(this)},i=b(this,Cs);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:nt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},A0=new WeakSet,WB=function(t){let n=r=>{k(this,vi,this.editorDiv.style.color=r)},i=b(this,vi);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:nt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},C0=new WeakSet,qB=function(){var i;let t=[];this.editorDiv.normalize();let n=null;for(let r of this.editorDiv.childNodes)n?.nodeType===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(N(i=bt,Hd,Fv).call(i,r)),n=r);return t.join(`
`)},zd=new WeakSet,Ov=function(){let[t,n]=this.parentDimensions,i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{let{currentLayer:r,div:o}=this,l=o.style.display,u=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),i=o.getBoundingClientRect(),o.remove(),o.style.display=l,o.classList.toggle("hidden",u)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/n):(this.width=i.height/t,this.height=i.width/n),this.fixAndSetPosition()},Hd=new WeakSet,Fv=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(gv,"")},Gd=new WeakSet,Lv=function(){if(this.editorDiv.replaceChildren(),!!b(this,As))for(let t of b(this,As).split(`
`)){let n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},I0=new WeakSet,YB=function(){return b(this,As).replaceAll("\xA0"," ")},jg=new WeakSet,s1=function(t){return t.replaceAll(" ","\xA0")},D0=new WeakSet,KB=function(t){let{value:n,fontSize:i,color:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||t.value!==n||t.fontSize!==i||t.color.some((l,u)=>l!==r[u])||t.pageIndex!==o},D(bt,Hd),D(bt,jg),J(bt,"_freeTextDefaultContent",""),J(bt,"_internalPadding",0),J(bt,"_defaultColor",null),J(bt,"_defaultFontSize",10),J(bt,"_type","freetext"),J(bt,"_editorType",Fe.FREETEXT);var n1=bt,me=class{toSVGPath(){vt("Abstract method `toSVGPath` must be implemented.")}get box(){vt("Abstract getter `box` must be implemented.")}serialize(e,t){vt("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,i,r,o){o||(o=new Float32Array(e.length));for(let l=0,u=e.length;l<u;l+=2)o[l]=t+e[l]*i,o[l+1]=n+e[l+1]*r;return o}static _rescaleAndSwap(e,t,n,i,r,o){o||(o=new Float32Array(e.length));for(let l=0,u=e.length;l<u;l+=2)o[l]=t+e[l+1]*i,o[l+1]=n+e[l]*r;return o}static _translate(e,t,n,i){i||(i=new Float32Array(e.length));for(let r=0,o=e.length;r<o;r+=2)i[r]=t+e[r],i[r+1]=n+e[r+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,i,r){switch(r){case 90:return[1-t/n,e/i];case 180:return[1-e/n,1-t/i];case 270:return[t/n,1-e/i];default:return[e/n,t/i]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,i,r,o){return[(e+5*n)/6,(t+5*i)/6,(5*n+r)/6,(5*i+o)/6,(n+r)/2,(i+o)/2]}};J(me,"PRECISION",1e-4);var Is,_i,jd,Wd,Zi,qe,ic,rc,Wg,qg,qd,Yd,na,Yg,k0,R0,oc,jf,P0,XB,M0,JB,N0,ZB,O0,QB,F0,e3,L0,t3,Fr=class Fr{constructor({x:e,y:t},n,i,r,o,l=0){D(this,oc);D(this,P0);D(this,M0);D(this,N0);D(this,O0);D(this,F0);D(this,L0);D(this,Is,void 0);D(this,_i,[]);D(this,jd,void 0);D(this,Wd,void 0);D(this,Zi,[]);D(this,qe,new Float32Array(18));D(this,ic,void 0);D(this,rc,void 0);D(this,Wg,void 0);D(this,qg,void 0);D(this,qd,void 0);D(this,Yd,void 0);D(this,na,[]);k(this,Is,n),k(this,Yd,r*i),k(this,Wd,o),b(this,qe).set([NaN,NaN,NaN,NaN,e,t],6),k(this,jd,l),k(this,qg,b(Fr,Yg)*i),k(this,Wg,b(Fr,R0)*i),k(this,qd,i),b(this,na).push(e,t)}isEmpty(){return isNaN(b(this,qe)[8])}add({x:e,y:t}){k(this,ic,e),k(this,rc,t);let[n,i,r,o]=b(this,Is),[l,u,h,d]=b(this,qe).subarray(8,12),c=e-h,a=t-d,f=Math.hypot(c,a);if(f<b(this,Wg))return!1;let p=f-b(this,qg),g=p/f,m=g*c,y=g*a,_=l,x=u;l=h,u=d,h+=m,d+=y,b(this,na)?.push(e,t);let E=-y/p,S=m/p,T=E*b(this,Yd),C=S*b(this,Yd);return b(this,qe).set(b(this,qe).subarray(2,8),0),b(this,qe).set([h+T,d+C],4),b(this,qe).set(b(this,qe).subarray(14,18),12),b(this,qe).set([h-T,d-C],16),isNaN(b(this,qe)[6])?(b(this,Zi).length===0&&(b(this,qe).set([l+T,u+C],2),b(this,Zi).push(NaN,NaN,NaN,NaN,(l+T-n)/r,(u+C-i)/o),b(this,qe).set([l-T,u-C],14),b(this,_i).push(NaN,NaN,NaN,NaN,(l-T-n)/r,(u-C-i)/o)),b(this,qe).set([_,x,l,u,h,d],6),!this.isEmpty()):(b(this,qe).set([_,x,l,u,h,d],6),Math.abs(Math.atan2(x-u,_-l)-Math.atan2(y,m))<Math.PI/2?([l,u,h,d]=b(this,qe).subarray(2,6),b(this,Zi).push(NaN,NaN,NaN,NaN,((l+h)/2-n)/r,((u+d)/2-i)/o),[l,u,_,x]=b(this,qe).subarray(14,18),b(this,_i).push(NaN,NaN,NaN,NaN,((_+l)/2-n)/r,((x+u)/2-i)/o),!0):([_,x,l,u,h,d]=b(this,qe).subarray(0,6),b(this,Zi).push(((_+5*l)/6-n)/r,((x+5*u)/6-i)/o,((5*l+h)/6-n)/r,((5*u+d)/6-i)/o,((l+h)/2-n)/r,((u+d)/2-i)/o),[h,d,l,u,_,x]=b(this,qe).subarray(12,18),b(this,_i).push(((_+5*l)/6-n)/r,((x+5*u)/6-i)/o,((5*l+h)/6-n)/r,((5*u+d)/6-i)/o,((l+h)/2-n)/r,((u+d)/2-i)/o),!0))}toSVGPath(){if(this.isEmpty())return"";let e=b(this,Zi),t=b(this,_i);if(isNaN(b(this,qe)[6])&&!this.isEmpty())return N(this,P0,XB).call(this);let n=[];n.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?n.push(`L${e[i+4]} ${e[i+5]}`):n.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);N(this,N0,ZB).call(this,n);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?n.push(`L${t[i+4]} ${t[i+5]}`):n.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return N(this,M0,JB).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,i,r,o){return new v_(e,t,n,i,r,o)}getOutlines(){let e=b(this,Zi),t=b(this,_i),n=b(this,qe),[i,r,o,l]=b(this,Is),u=new Float32Array((b(this,na)?.length??0)+2);for(let c=0,a=u.length-2;c<a;c+=2)u[c]=(b(this,na)[c]-i)/o,u[c+1]=(b(this,na)[c+1]-r)/l;if(u[u.length-2]=(b(this,ic)-i)/o,u[u.length-1]=(b(this,rc)-r)/l,isNaN(n[6])&&!this.isEmpty())return N(this,O0,QB).call(this,u);let h=new Float32Array(b(this,Zi).length+24+b(this,_i).length),d=e.length;for(let c=0;c<d;c+=2){if(isNaN(e[c])){h[c]=h[c+1]=NaN;continue}h[c]=e[c],h[c+1]=e[c+1]}d=N(this,L0,t3).call(this,h,d);for(let c=t.length-6;c>=6;c-=6)for(let a=0;a<6;a+=2){if(isNaN(t[c+a])){h[d]=h[d+1]=NaN,d+=2;continue}h[d]=t[c+a],h[d+1]=t[c+a+1],d+=2}return N(this,F0,e3).call(this,h,d),this.newFreeDrawOutline(h,u,b(this,Is),b(this,qd),b(this,jd),b(this,Wd))}};Is=new WeakMap,_i=new WeakMap,jd=new WeakMap,Wd=new WeakMap,Zi=new WeakMap,qe=new WeakMap,ic=new WeakMap,rc=new WeakMap,Wg=new WeakMap,qg=new WeakMap,qd=new WeakMap,Yd=new WeakMap,na=new WeakMap,Yg=new WeakMap,k0=new WeakMap,R0=new WeakMap,oc=new WeakSet,jf=function(){let e=b(this,qe).subarray(4,6),t=b(this,qe).subarray(16,18),[n,i,r,o]=b(this,Is);return[(b(this,ic)+(e[0]-t[0])/2-n)/r,(b(this,rc)+(e[1]-t[1])/2-i)/o,(b(this,ic)+(t[0]-e[0])/2-n)/r,(b(this,rc)+(t[1]-e[1])/2-i)/o]},P0=new WeakSet,XB=function(){let[e,t,n,i]=b(this,Is),[r,o,l,u]=N(this,oc,jf).call(this);return`M${(b(this,qe)[2]-e)/n} ${(b(this,qe)[3]-t)/i} L${(b(this,qe)[4]-e)/n} ${(b(this,qe)[5]-t)/i} L${r} ${o} L${l} ${u} L${(b(this,qe)[16]-e)/n} ${(b(this,qe)[17]-t)/i} L${(b(this,qe)[14]-e)/n} ${(b(this,qe)[15]-t)/i} Z`},M0=new WeakSet,JB=function(e){let t=b(this,_i);e.push(`L${t[4]} ${t[5]} Z`)},N0=new WeakSet,ZB=function(e){let[t,n,i,r]=b(this,Is),o=b(this,qe).subarray(4,6),l=b(this,qe).subarray(16,18),[u,h,d,c]=N(this,oc,jf).call(this);e.push(`L${(o[0]-t)/i} ${(o[1]-n)/r} L${u} ${h} L${d} ${c} L${(l[0]-t)/i} ${(l[1]-n)/r}`)},O0=new WeakSet,QB=function(e){let t=b(this,qe),[n,i,r,o]=b(this,Is),[l,u,h,d]=N(this,oc,jf).call(this),c=new Float32Array(36);return c.set([NaN,NaN,NaN,NaN,(t[2]-n)/r,(t[3]-i)/o,NaN,NaN,NaN,NaN,(t[4]-n)/r,(t[5]-i)/o,NaN,NaN,NaN,NaN,l,u,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,(t[16]-n)/r,(t[17]-i)/o,NaN,NaN,NaN,NaN,(t[14]-n)/r,(t[15]-i)/o],0),this.newFreeDrawOutline(c,e,b(this,Is),b(this,qd),b(this,jd),b(this,Wd))},F0=new WeakSet,e3=function(e,t){let n=b(this,_i);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},L0=new WeakSet,t3=function(e,t){let n=b(this,qe).subarray(4,6),i=b(this,qe).subarray(16,18),[r,o,l,u]=b(this,Is),[h,d,c,a]=N(this,oc,jf).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-r)/l,(n[1]-o)/u,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,c,a,NaN,NaN,NaN,NaN,(i[0]-r)/l,(i[1]-o)/u],t),t+=24},D(Fr,Yg,8),D(Fr,k0,2),D(Fr,R0,b(Fr,Yg)+b(Fr,k0));var b_=Fr,Kd,ac,no,Kg,Ds,Xg,Gt,$0,n3,v_=class extends me{constructor(t,n,i,r,o,l){super();D(this,$0);D(this,Kd,void 0);D(this,ac,new Float32Array(4));D(this,no,void 0);D(this,Kg,void 0);D(this,Ds,void 0);D(this,Xg,void 0);D(this,Gt,void 0);k(this,Gt,t),k(this,Ds,n),k(this,Kd,i),k(this,Xg,r),k(this,no,o),k(this,Kg,l),this.lastPoint=[NaN,NaN],N(this,$0,n3).call(this,l);let[u,h,d,c]=b(this,ac);for(let a=0,f=t.length;a<f;a+=2)t[a]=(t[a]-u)/d,t[a+1]=(t[a+1]-h)/c;for(let a=0,f=n.length;a<f;a+=2)n[a]=(n[a]-u)/d,n[a+1]=(n[a+1]-h)/c}toSVGPath(){let t=[`M${b(this,Gt)[4]} ${b(this,Gt)[5]}`];for(let n=6,i=b(this,Gt).length;n<i;n+=6){if(isNaN(b(this,Gt)[n])){t.push(`L${b(this,Gt)[n+4]} ${b(this,Gt)[n+5]}`);continue}t.push(`C${b(this,Gt)[n]} ${b(this,Gt)[n+1]} ${b(this,Gt)[n+2]} ${b(this,Gt)[n+3]} ${b(this,Gt)[n+4]} ${b(this,Gt)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,i,r],o){let l=i-t,u=r-n,h,d;switch(o){case 0:h=me._rescale(b(this,Gt),t,r,l,-u),d=me._rescale(b(this,Ds),t,r,l,-u);break;case 90:h=me._rescaleAndSwap(b(this,Gt),t,n,l,u),d=me._rescaleAndSwap(b(this,Ds),t,n,l,u);break;case 180:h=me._rescale(b(this,Gt),i,n,-l,u),d=me._rescale(b(this,Ds),i,n,-l,u);break;case 270:h=me._rescaleAndSwap(b(this,Gt),i,r,-l,-u),d=me._rescaleAndSwap(b(this,Ds),i,r,-l,-u);break}return{outline:Array.from(h),points:[Array.from(d)]}}get box(){return b(this,ac)}newOutliner(t,n,i,r,o,l=0){return new b_(t,n,i,r,o,l)}getNewOutline(t,n){let[i,r,o,l]=b(this,ac),[u,h,d,c]=b(this,Kd),a=o*d,f=l*c,p=i*d+u,g=r*c+h,m=this.newOutliner({x:b(this,Ds)[0]*a+p,y:b(this,Ds)[1]*f+g},b(this,Kd),b(this,Xg),t,b(this,Kg),n??b(this,no));for(let y=2;y<b(this,Ds).length;y+=2)m.add({x:b(this,Ds)[y]*a+p,y:b(this,Ds)[y+1]*f+g});return m.getOutlines()}};Kd=new WeakMap,ac=new WeakMap,no=new WeakMap,Kg=new WeakMap,Ds=new WeakMap,Xg=new WeakMap,Gt=new WeakMap,$0=new WeakSet,n3=function(t){let n=b(this,Gt),i=n[4],r=n[5],o=i,l=r,u=i,h=r,d=i,c=r,a=t?Math.max:Math.min;for(let p=6,g=n.length;p<g;p+=6){if(isNaN(n[p]))o=Math.min(o,n[p+4]),l=Math.min(l,n[p+5]),u=Math.max(u,n[p+4]),h=Math.max(h,n[p+5]),c<n[p+5]?(d=n[p+4],c=n[p+5]):c===n[p+5]&&(d=a(d,n[p+4]));else{let m=ve.bezierBoundingBox(i,r,...n.slice(p,p+6));o=Math.min(o,m[0]),l=Math.min(l,m[1]),u=Math.max(u,m[2]),h=Math.max(h,m[3]),c<m[3]?(d=m[2],c=m[3]):c===m[3]&&(d=a(d,m[2]))}i=n[p+4],r=n[p+5]}let f=b(this,ac);f[0]=o-b(this,no),f[1]=l-b(this,no),f[2]=u-o+2*b(this,no),f[3]=h-l+2*b(this,no),this.lastPoint=[d,c]};var Jg,Zg,sa,wi,U0,s3,Xd,$v,B0,i3,V0,r3,Qg,i1,hp=class{constructor(e,t=0,n=0,i=!0){D(this,U0);D(this,Xd);D(this,B0);D(this,V0);D(this,Qg);D(this,Jg,void 0);D(this,Zg,void 0);D(this,sa,[]);D(this,wi,[]);let r=1/0,o=-1/0,l=1/0,u=-1/0,d=10**-4;for(let{x:y,y:_,width:x,height:E}of e){let S=Math.floor((y-t)/d)*d,T=Math.ceil((y+x+t)/d)*d,C=Math.floor((_-t)/d)*d,I=Math.ceil((_+E+t)/d)*d,A=[S,C,I,!0],P=[T,C,I,!1];b(this,sa).push(A,P),r=Math.min(r,S),o=Math.max(o,T),l=Math.min(l,C),u=Math.max(u,I)}let c=o-r+2*n,a=u-l+2*n,f=r-n,p=l-n,g=b(this,sa).at(i?-1:-2),m=[g[0],g[2]];for(let y of b(this,sa)){let[_,x,E]=y;y[0]=(_-f)/c,y[1]=(x-p)/a,y[2]=(E-p)/a}k(this,Jg,new Float32Array([f,p,c,a])),k(this,Zg,m)}getOutlines(){b(this,sa).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);let e=[];for(let t of b(this,sa))t[3]?(e.push(...N(this,Qg,i1).call(this,t)),N(this,B0,i3).call(this,t)):(N(this,V0,r3).call(this,t),e.push(...N(this,Qg,i1).call(this,t)));return N(this,U0,s3).call(this,e)}};Jg=new WeakMap,Zg=new WeakMap,sa=new WeakMap,wi=new WeakMap,U0=new WeakSet,s3=function(e){let t=[],n=new Set;for(let o of e){let[l,u,h]=o;t.push([l,u,o],[l,h,o])}t.sort((o,l)=>o[1]-l[1]||o[0]-l[0]);for(let o=0,l=t.length;o<l;o+=2){let u=t[o][2],h=t[o+1][2];u.push(h),h.push(u),n.add(u),n.add(h)}let i=[],r;for(;n.size>0;){let o=n.values().next().value,[l,u,h,d,c]=o;n.delete(o);let a=l,f=u;for(r=[l,h],i.push(r);;){let p;if(n.has(d))p=d;else if(n.has(c))p=c;else break;n.delete(p),[l,u,h,d,c]=p,a!==l&&(r.push(a,f,l,f===u?u:h),a=l),f=f===u?h:u}r.push(a,f)}return new r1(i,b(this,Jg),b(this,Zg))},Xd=new WeakSet,$v=function(e){let t=b(this,wi),n=0,i=t.length-1;for(;n<=i;){let r=n+i>>1,o=t[r][0];if(o===e)return r;o<e?n=r+1:i=r-1}return i+1},B0=new WeakSet,i3=function([,e,t]){let n=N(this,Xd,$v).call(this,e);b(this,wi).splice(n,0,[e,t])},V0=new WeakSet,r3=function([,e,t]){let n=N(this,Xd,$v).call(this,e);for(let i=n;i<b(this,wi).length;i++){let[r,o]=b(this,wi)[i];if(r!==e)break;if(r===e&&o===t){b(this,wi).splice(i,1);return}}for(let i=n-1;i>=0;i--){let[r,o]=b(this,wi)[i];if(r!==e)break;if(r===e&&o===t){b(this,wi).splice(i,1);return}}},Qg=new WeakSet,i1=function(e){let[t,n,i]=e,r=[[t,n,i]],o=N(this,Xd,$v).call(this,i);for(let l=0;l<o;l++){let[u,h]=b(this,wi)[l];for(let d=0,c=r.length;d<c;d++){let[,a,f]=r[d];if(!(h<=a||f<=u)){if(a>=u){if(f>h)r[d][1]=h;else{if(c===1)return[];r.splice(d,1),d--,c--}continue}r[d][2]=u,f>h&&r.push([t,h,f])}}}return r};var em,Jd,r1=class extends me{constructor(t,n,i){super();D(this,em,void 0);D(this,Jd,void 0);k(this,Jd,t),k(this,em,n),this.lastPoint=i}toSVGPath(){let t=[];for(let n of b(this,Jd)){let[i,r]=n;t.push(`M${i} ${r}`);for(let o=2;o<n.length;o+=2){let l=n[o],u=n[o+1];l===i?(t.push(`V${u}`),r=u):u===r&&(t.push(`H${l}`),i=l)}t.push("Z")}return t.join(" ")}serialize([t,n,i,r],o){let l=[],u=i-t,h=r-n;for(let d of b(this,Jd)){let c=new Array(d.length);for(let a=0;a<d.length;a+=2)c[a]=t+d[a]*u,c[a+1]=r-d[a+1]*h;l.push(c)}return l}get box(){return b(this,em)}get classNamesForOutlining(){return["highlightOutline"]}};em=new WeakMap,Jd=new WeakMap;var fp=class extends b_{newFreeDrawOutline(e,t,n,i,r,o){return new o1(e,t,n,i,r,o)}},o1=class extends v_{newOutliner(e,t,n,i,r,o=0){return new fp(e,t,n,i,r,o)}},xi,lc,Zd,on,tm,Qd,nm,sm,ia,Ei,eh,im,rm,a1,om,l1,am,c1,so,rl,z0,o3,Qi,Ro,ds=class ds{constructor({editor:e=null,uiManager:t=null}){D(this,rm);D(this,om);D(this,am);D(this,so);D(this,z0);D(this,Qi);D(this,xi,null);D(this,lc,null);D(this,Zd,void 0);D(this,on,null);D(this,tm,!1);D(this,Qd,!1);D(this,nm,null);D(this,sm,void 0);D(this,ia,null);D(this,Ei,null);D(this,eh,void 0);e?(k(this,Qd,!1),k(this,eh,nt.HIGHLIGHT_COLOR),k(this,nm,e)):(k(this,Qd,!0),k(this,eh,nt.HIGHLIGHT_DEFAULT_COLOR)),k(this,Ei,e?._uiManager||t),k(this,sm,b(this,Ei)._eventBus),k(this,Zd,e?.color||b(this,Ei)?.highlightColors.values().next().value||"#FFFF98"),b(ds,im)||k(ds,im,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Ye(this,"_keyboardManager",new Dc([[["Escape","mac+Escape"],ds.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ds.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ds.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ds.prototype._moveToPrevious],[["Home","mac+Home"],ds.prototype._moveToBeginning],[["End","mac+End"],ds.prototype._moveToEnd]]))}renderButton(){let e=k(this,xi,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);let t=b(this,Ei)._signal;e.addEventListener("click",N(this,so,rl).bind(this),{signal:t}),e.addEventListener("keydown",N(this,am,c1).bind(this),{signal:t});let n=k(this,lc,document.createElement("span"));return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=b(this,Zd),e.append(n),e}renderMainDropdown(){let e=k(this,on,N(this,rm,a1).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===b(this,xi)){N(this,so,rl).call(this,e);return}let t=e.target.getAttribute("data-color");t&&N(this,om,l1).call(this,t,e)}_moveToNext(e){if(!b(this,Qi,Ro)){N(this,so,rl).call(this,e);return}if(e.target===b(this,xi)){b(this,on).firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===b(this,on)?.firstChild||e.target===b(this,xi)){b(this,Qi,Ro)&&this._hideDropdownFromKeyboard();return}b(this,Qi,Ro)||N(this,so,rl).call(this,e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!b(this,Qi,Ro)){N(this,so,rl).call(this,e);return}b(this,on).firstChild?.focus()}_moveToEnd(e){if(!b(this,Qi,Ro)){N(this,so,rl).call(this,e);return}b(this,on).lastChild?.focus()}hideDropdown(){b(this,on)?.classList.add("hidden"),b(this,ia)?.abort(),k(this,ia,null)}_hideDropdownFromKeyboard(){if(!b(this,Qd)){if(!b(this,Qi,Ro)){b(this,nm)?.unselect();return}this.hideDropdown(),b(this,xi).focus({preventScroll:!0,focusVisible:b(this,tm)})}}updateColor(e){if(b(this,lc)&&(b(this,lc).style.backgroundColor=e),!b(this,on))return;let t=b(this,Ei).highlightColors.values();for(let n of b(this,on).children)n.setAttribute("aria-selected",t.next().value===e)}destroy(){b(this,xi)?.remove(),k(this,xi,null),k(this,lc,null),b(this,on)?.remove(),k(this,on,null)}};xi=new WeakMap,lc=new WeakMap,Zd=new WeakMap,on=new WeakMap,tm=new WeakMap,Qd=new WeakMap,nm=new WeakMap,sm=new WeakMap,ia=new WeakMap,Ei=new WeakMap,eh=new WeakMap,im=new WeakMap,rm=new WeakSet,a1=function(){let e=document.createElement("div"),t=b(this,Ei)._signal;e.addEventListener("contextmenu",Ii,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[n,i]of b(this,Ei).highlightColors){let r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=n,r.setAttribute("data-l10n-id",b(ds,im)[n]);let o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=i,r.setAttribute("aria-selected",i===b(this,Zd)),r.addEventListener("click",N(this,om,l1).bind(this,i),{signal:t}),e.append(r)}return e.addEventListener("keydown",N(this,am,c1).bind(this),{signal:t}),e},om=new WeakSet,l1=function(e,t){t.stopPropagation(),b(this,sm).dispatch("switchannotationeditorparams",{source:this,type:b(this,eh),value:e})},am=new WeakSet,c1=function(e){ds._keyboardManager.exec(this,e)},so=new WeakSet,rl=function(e){if(b(this,Qi,Ro)){this.hideDropdown();return}if(k(this,tm,e.detail===0),b(this,ia)||(k(this,ia,new AbortController),window.addEventListener("pointerdown",N(this,z0,o3).bind(this),{signal:b(this,Ei).combinedSignal(b(this,ia))})),b(this,on)){b(this,on).classList.remove("hidden");return}let t=k(this,on,N(this,rm,a1).call(this));b(this,xi).append(t)},z0=new WeakSet,o3=function(e){b(this,on)?.contains(e.target)||this.hideDropdown()},Qi=new WeakSet,Ro=function(){return b(this,on)&&!b(this,on).classList.contains("hidden")},D(ds,im,null);var __=ds,th,lm,io,cc,nh,ps,cm,um,uc,Xs,ks,Cn,sh,ro,zn,ih,Js,dm,hm,u1,rh,Uv,H0,a3,G0,l3,j0,c3,fm,d1,oo,ol,ra,Vu,W0,u3,oh,Bv,dc,Wf,q0,d3,Y0,h3,K0,f3,X0,p3,J0,g3,ot=class ot extends Ot{constructor(t){super({...t,name:"highlightEditor"});D(this,hm);D(this,rh);D(this,H0);D(this,G0);D(this,j0);D(this,fm);D(this,oo);D(this,W0);D(this,oh);D(this,dc);D(this,q0);D(this,Y0);D(this,J0);D(this,th,null);D(this,lm,0);D(this,io,void 0);D(this,cc,null);D(this,nh,null);D(this,ps,null);D(this,cm,null);D(this,um,0);D(this,uc,null);D(this,Xs,null);D(this,ks,null);D(this,Cn,!1);D(this,sh,null);D(this,ro,void 0);D(this,zn,null);D(this,ih,"");D(this,Js,void 0);D(this,dm,"");this.color=t.color||ot._defaultColor,k(this,Js,t.thickness||ot._defaultThickness),k(this,ro,t.opacity||ot._defaultOpacity),k(this,io,t.boxes||null),k(this,dm,t.methodOfCreation||""),k(this,ih,t.text||""),this._isDraggable=!1,t.highlightId>-1?(k(this,Cn,!0),N(this,rh,Uv).call(this,t),N(this,oo,ol).call(this)):b(this,io)&&(k(this,th,t.anchorNode),k(this,lm,t.anchorOffset),k(this,cm,t.focusNode),k(this,um,t.focusOffset),N(this,hm,u1).call(this),N(this,oo,ol).call(this),this.rotate(this.rotation))}static get _keyboardManager(){let t=ot.prototype;return Ye(this,"_keyboardManager",new Dc([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:b(this,Cn)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:b(this,Js),methodOfCreation:b(this,dm)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){Ot.initialize(t,n),ot._defaultColor||(ot._defaultColor=n.highlightColors?.values().next().value||"#fff066")}static updateDefaultParams(t,n){switch(t){case nt.HIGHLIGHT_DEFAULT_COLOR:ot._defaultColor=n;break;case nt.HIGHLIGHT_THICKNESS:ot._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return b(this,sh)}updateParams(t,n){switch(t){case nt.HIGHLIGHT_COLOR:N(this,H0,a3).call(this,n);break;case nt.HIGHLIGHT_THICKNESS:N(this,G0,l3).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[nt.HIGHLIGHT_DEFAULT_COLOR,ot._defaultColor],[nt.HIGHLIGHT_THICKNESS,ot._defaultThickness]]}get propertiesToUpdate(){return[[nt.HIGHLIGHT_COLOR,this.color||ot._defaultColor],[nt.HIGHLIGHT_THICKNESS,b(this,Js)||ot._defaultThickness],[nt.HIGHLIGHT_FREE,b(this,Cn)]]}async addEditToolbar(){let t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(k(this,nh,new __({editor:this})),t.addColorPicker(b(this,nh))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(N(this,dc,Wf).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,N(this,dc,Wf).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){N(this,fm,d1).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(N(this,oo,ol).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let n=!1;this.parent&&!t?N(this,fm,d1).call(this):t&&(N(this,oo,ol).call(this,t),n=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var r,o,l;let{drawLayer:n}=this.parent,i;b(this,Cn)?(t=(t-this.rotation+360)%360,i=N(r=ot,ra,Vu).call(r,b(this,Xs).box,t)):i=N(o=ot,ra,Vu).call(o,[this.x,this.y,this.width,this.height],t),n.updateProperties(b(this,ks),{bbox:i,root:{"data-main-rotation":t}}),n.updateProperties(b(this,zn),{bbox:N(l=ot,ra,Vu).call(l,b(this,ps).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;let t=super.render();b(this,ih)&&(t.setAttribute("aria-label",b(this,ih)),t.setAttribute("role","mark")),b(this,Cn)?t.classList.add("free"):this.div.addEventListener("keydown",N(this,W0,u3).bind(this),{signal:this._uiManager._signal});let n=k(this,uc,document.createElement("div"));t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=b(this,cc);let[i,r]=this.parentDimensions;return this.setDims(this.width*i,this.height*r),Kv(this,b(this,uc),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(b(this,zn),{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(b(this,zn),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:N(this,oh,Bv).call(this,!0);break;case 1:case 3:N(this,oh,Bv).call(this,!1);break}}select(){super.select(),b(this,zn)&&this.parent?.drawLayer.updateProperties(b(this,zn),{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),b(this,zn)&&(this.parent?.drawLayer.updateProperties(b(this,zn),{rootClass:{selected:!1}}),b(this,Cn)||N(this,oh,Bv).call(this,!1))}get _mustFixPosition(){return!b(this,Cn)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(b(this,ks),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(b(this,zn),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:i,x:r,y:o}){let{x:l,y:u,width:h,height:d}=i.getBoundingClientRect(),c=new AbortController,a=t.combinedSignal(c),f=p=>{c.abort(),N(this,X0,p3).call(this,t,p)};window.addEventListener("blur",f,{signal:a}),window.addEventListener("pointerup",f,{signal:a}),window.addEventListener("pointerdown",Os,{capture:!0,passive:!1,signal:a}),window.addEventListener("contextmenu",Ii,{signal:a}),i.addEventListener("pointermove",N(this,K0,f3).bind(this,t),{signal:a}),this._freeHighlight=new fp({x:r,y:o},[l,u,h,d],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,i){var g,m,y,_;let r=null;if(t instanceof m_){let{data:{quadPoints:x,rect:E,rotation:S,id:T,color:C,opacity:I,popupRef:A},parent:{page:{pageNumber:P}}}=t;r=t={annotationType:Fe.HIGHLIGHT,color:Array.from(C),opacity:I,quadPoints:x,boxes:null,pageIndex:P-1,rect:E.slice(0),rotation:S,id:T,deleted:!1,popupRef:A}}else if(t instanceof dp){let{data:{inkLists:x,rect:E,rotation:S,id:T,color:C,borderStyle:{rawWidth:I},popupRef:A},parent:{page:{pageNumber:P}}}=t;r=t={annotationType:Fe.HIGHLIGHT,color:Array.from(C),thickness:I,inkLists:x,boxes:null,pageIndex:P-1,rect:E.slice(0),rotation:S,id:T,deleted:!1,popupRef:A}}let{color:o,quadPoints:l,inkLists:u,opacity:h}=t,d=await super.deserialize(t,n,i);d.color=ve.makeHexColor(...o),k(d,ro,h||1),u&&k(d,Js,t.thickness),d.annotationElementId=t.id||null,d._initialData=r;let[c,a]=d.pageDimensions,[f,p]=d.pageTranslation;if(l){let x=k(d,io,[]);for(let E=0;E<l.length;E+=8)x.push({x:(l[E]-f)/c,y:1-(l[E+1]-p)/a,width:(l[E+2]-l[E])/c,height:(l[E+1]-l[E+5])/a});N(g=d,hm,u1).call(g),N(m=d,oo,ol).call(m),d.rotate(d.rotation)}else if(u){k(d,Cn,!0);let x=u[0],E={x:x[0]-f,y:a-(x[1]-p)},S=new fp(E,[0,0,c,a],1,b(d,Js)/2,!0,.001);for(let I=0,A=x.length;I<A;I+=2)E.x=x[I]-f,E.y=a-(x[I+1]-p),S.add(E);let{id:T,clipPathId:C}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:S.toSVGPath()}},!0,!0);N(y=d,rh,Uv).call(y,{highlightOutlines:S.getOutlines(),highlightId:T,clipPathId:C}),N(_=d,oo,ol).call(_)}return d}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();let n=this.getRect(0,0),i=Ot._colorManager.convert(this.color),r={annotationType:Fe.HIGHLIGHT,color:i,opacity:b(this,ro),thickness:b(this,Js),quadPoints:N(this,q0,d3).call(this),outlines:N(this,Y0,h3).call(this,n),pageIndex:this.pageIndex,rect:n,rotation:N(this,dc,Wf).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!N(this,J0,g3).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};th=new WeakMap,lm=new WeakMap,io=new WeakMap,cc=new WeakMap,nh=new WeakMap,ps=new WeakMap,cm=new WeakMap,um=new WeakMap,uc=new WeakMap,Xs=new WeakMap,ks=new WeakMap,Cn=new WeakMap,sh=new WeakMap,ro=new WeakMap,zn=new WeakMap,ih=new WeakMap,Js=new WeakMap,dm=new WeakMap,hm=new WeakSet,u1=function(){let t=new hp(b(this,io),.001);k(this,Xs,t.getOutlines()),[this.x,this.y,this.width,this.height]=b(this,Xs).box;let n=new hp(b(this,io),.0025,.001,this._uiManager.direction==="ltr");k(this,ps,n.getOutlines());let{lastPoint:i}=b(this,ps);k(this,sh,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},rh=new WeakSet,Uv=function({highlightOutlines:t,highlightId:n,clipPathId:i}){var c,a;if(k(this,Xs,t),k(this,ps,t.getNewOutline(b(this,Js)/2+1.5,.0025)),n>=0)k(this,ks,n),k(this,cc,i),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),k(this,zn,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:b(this,ps).box,path:{d:b(this,ps).toSVGPath()}},!0));else if(this.parent){let f=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(b(this,ks),{bbox:N(c=ot,ra,Vu).call(c,b(this,Xs).box,(f-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(b(this,zn),{bbox:N(a=ot,ra,Vu).call(a,b(this,ps).box,f),path:{d:b(this,ps).toSVGPath()}})}let[o,l,u,h]=t.box;switch(this.rotation){case 0:this.x=o,this.y=l,this.width=u,this.height=h;break;case 90:{let[f,p]=this.parentDimensions;this.x=l,this.y=1-o,this.width=u*p/f,this.height=h*f/p;break}case 180:this.x=1-o,this.y=1-l,this.width=u,this.height=h;break;case 270:{let[f,p]=this.parentDimensions;this.x=1-l,this.y=o,this.width=u*p/f,this.height=h*f/p;break}}let{lastPoint:d}=b(this,ps);k(this,sh,[(d[0]-o)/u,(d[1]-l)/h])},H0=new WeakSet,a3=function(t){let n=(o,l)=>{this.color=o,k(this,ro,l),this.parent?.drawLayer.updateProperties(b(this,ks),{root:{fill:o,"fill-opacity":l}}),b(this,nh)?.updateColor(o)},i=this.color,r=b(this,ro);this.addCommands({cmd:n.bind(this,t,ot._defaultOpacity),undo:n.bind(this,i,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:nt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},G0=new WeakSet,l3=function(t){let n=b(this,Js),i=r=>{k(this,Js,r),N(this,j0,c3).call(this,r)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:nt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},j0=new WeakSet,c3=function(t){if(!b(this,Cn))return;N(this,rh,Uv).call(this,{highlightOutlines:b(this,Xs).getNewOutline(t/2)}),this.fixAndSetPosition();let[n,i]=this.parentDimensions;this.setDims(this.width*n,this.height*i)},fm=new WeakSet,d1=function(){b(this,ks)===null||!this.parent||(this.parent.drawLayer.remove(b(this,ks)),k(this,ks,null),this.parent.drawLayer.remove(b(this,zn)),k(this,zn,null))},oo=new WeakSet,ol=function(t=this.parent){b(this,ks)===null&&({id:Yn(this,ks)._,clipPathId:Yn(this,cc)._}=t.drawLayer.draw({bbox:b(this,Xs).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":b(this,ro)},rootClass:{highlight:!0,free:b(this,Cn)},path:{d:b(this,Xs).toSVGPath()}},!1,!0),k(this,zn,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:b(this,Cn)},bbox:b(this,ps).box,path:{d:b(this,ps).toSVGPath()}},b(this,Cn))),b(this,uc)&&(b(this,uc).style.clipPath=b(this,cc)))},ra=new WeakSet,Vu=function([t,n,i,r],o){switch(o){case 90:return[1-n-r,t,r,i];case 180:return[1-t-i,1-n-r,i,r];case 270:return[n,1-t-i,r,i]}return[t,n,i,r]},W0=new WeakSet,u3=function(t){ot._keyboardManager.exec(this,t)},oh=new WeakSet,Bv=function(t){if(!b(this,th))return;let n=window.getSelection();t?n.setPosition(b(this,th),b(this,lm)):n.setPosition(b(this,cm),b(this,um))},dc=new WeakSet,Wf=function(){return b(this,Cn)?this.rotation:0},q0=new WeakSet,d3=function(){if(b(this,Cn))return null;let[t,n]=this.pageDimensions,[i,r]=this.pageTranslation,o=b(this,io),l=new Float32Array(o.length*8),u=0;for(let{x:h,y:d,width:c,height:a}of o){let f=h*t+i,p=(1-d)*n+r;l[u]=l[u+4]=f,l[u+1]=l[u+3]=p,l[u+2]=l[u+6]=f+c*t,l[u+5]=l[u+7]=p-a*n,u+=8}return l},Y0=new WeakSet,h3=function(t){return b(this,Xs).serialize(t,N(this,dc,Wf).call(this))},K0=new WeakSet,f3=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},X0=new WeakSet,p3=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},J0=new WeakSet,g3=function(t){let{color:n}=this._initialData;return t.color.some((i,r)=>i!==n[r])},D(ot,ra),D(ot,K0),D(ot,X0),J(ot,"_defaultColor",null),J(ot,"_defaultOpacity",1),J(ot,"_defaultThickness",12),J(ot,"_type","highlight"),J(ot,"_editorType",Fe.HIGHLIGHT),J(ot,"_freeHighlightId",-1),J(ot,"_freeHighlight",null),J(ot,"_freeHighlightClipId","");var w_=ot,hc,h1=class{constructor(){D(this,hc,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(let[t,n]of Object.entries(e))this.updateProperty(t,n)}updateSVGProperty(e,t){b(this,hc)[e]=t}toSVGProperties(){let e=b(this,hc);return k(this,hc,Object.create(null)),{root:e}}reset(){k(this,hc,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){vt("Not implemented")}};hc=new WeakMap;var Rs,ah,yn,fc,pc,oa,aa,la,gc,pm,p1,gm,g1,mm,m1,mc,qf,Z0,m3,lh,Vv,yc,Yf,ca,zu,ye=class ye extends Ot{constructor(t){super(t);D(this,pm);D(this,gm);D(this,mm);D(this,mc);D(this,Z0);D(this,lh);D(this,yc);D(this,ca);D(this,Rs,null);D(this,ah,void 0);J(this,"_drawId",null);k(this,ah,t.mustBeCommitted||!1),t.drawOutlines&&(N(this,pm,p1).call(this,t),N(this,mc,qf).call(this))}static _mergeSVGProperties(t,n){let i=new Set(Object.keys(t));for(let[r,o]of Object.entries(n))i.has(r)?Object.assign(t[r],o):t[r]=o;return t}static getDefaultDrawingOptions(t){vt("Not implemented")}static get typesMap(){vt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){let i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,n),this._currentParent&&(b(ye,yn).updateProperty(i,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){let i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,n)}static get defaultPropertiesToUpdate(){let t=[],n=this._defaultDrawingOptions;for(let[i,r]of this.typesMap)t.push([i,n[r]]);return t}get propertiesToUpdate(){let t=[],{_drawingOptions:n}=this;for(let[i,r]of this.constructor.typesMap)t.push([i,n[r]]);return t}_updateProperty(t,n,i){let r=this._drawingOptions,o=r[n],l=u=>{r.updateProperty(n,u);let h=b(this,Rs).updateProperty(n,u);h&&N(this,yc,Yf).call(this,h),this.parent?.drawLayer.updateProperties(this._drawId,r.toSVGProperties())};this.addCommands({cmd:l.bind(this,i),undo:l.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,ye._mergeSVGProperties(b(this,Rs).getPathResizingSVGProperties(N(this,lh,Vv).call(this)),{bbox:N(this,ca,zu).call(this)}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,ye._mergeSVGProperties(b(this,Rs).getPathResizedSVGProperties(N(this,lh,Vv).call(this)),{bbox:N(this,ca,zu).call(this)}))}_onTranslating(t,n){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:N(this,ca,zu).call(this,t,n)})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,ye._mergeSVGProperties(b(this,Rs).getPathTranslatedSVGProperties(N(this,lh,Vv).call(this),this.parentDimensions),{bbox:N(this,ca,zu).call(this)}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,b(this,ah)&&(k(this,ah,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){N(this,mm,m1).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(N(this,mc,qf).call(this),N(this,yc,Yf).call(this,b(this,Rs).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),N(this,mm,m1).call(this)):t&&(this._uiManager.addShouldRescale(this),N(this,mc,qf).call(this,t),n=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,ye._mergeSVGProperties({bbox:N(this,ca,zu).call(this)},b(this,Rs).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&N(this,yc,Yf).call(this,b(this,Rs).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t=super.render();t.classList.add("draw");let n=document.createElement("div");t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";let[i,r]=this.parentDimensions;return this.setDims(this.width*i,this.height*r),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,n,i,r,o){vt("Not implemented")}static startDrawing(t,n,i,r){let{target:o,offsetX:l,offsetY:u,pointerId:h,pointerType:d}=r;if(b(ye,aa)&&b(ye,aa)!==d)return;let{viewport:{rotation:c}}=t,{width:a,height:f}=o.getBoundingClientRect(),p=k(ye,fc,new AbortController),g=t.combinedSignal(p);if(b(ye,oa)||k(ye,oa,h),b(ye,aa)??k(ye,aa,d),window.addEventListener("pointerup",m=>{b(ye,oa)===m.pointerId?this._endDraw(m):b(ye,la)?.delete(m.pointerId)},{signal:g}),window.addEventListener("pointercancel",m=>{b(ye,oa)===m.pointerId?this._currentParent.endDrawingSession():b(ye,la)?.delete(m.pointerId)},{signal:g}),window.addEventListener("pointerdown",m=>{b(ye,aa)===m.pointerType&&((b(ye,la)||k(ye,la,new Set)).add(m.pointerId),b(ye,yn).isCancellable()&&(b(ye,yn).removeLastElement(),b(ye,yn).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",Ii,{signal:g}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:g}),o.addEventListener("touchmove",m=>{m.timeStamp===b(ye,gc)&&Os(m)},{signal:g}),t.toggleDrawing(),n._editorUndoBar?.hide(),b(ye,yn)){t.drawLayer.updateProperties(this._currentDrawId,b(ye,yn).startNew(l,u,a,f,c));return}n.updateUIForDefaultProperties(this),k(ye,yn,this.createDrawerInstance(l,u,a,f,c)),k(ye,pc,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(b(ye,pc).toSVGProperties(),b(ye,yn).defaultSVGProperties),!0,!1)}static _drawMove(t){if(k(ye,gc,-1),!b(ye,yn))return;let{offsetX:n,offsetY:i,pointerId:r}=t;if(b(ye,oa)===r){if(b(ye,la)?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,b(ye,yn).add(n,i)),k(ye,gc,t.timeStamp),Os(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,k(ye,yn,null),k(ye,pc,null),k(ye,aa,null),k(ye,gc,NaN)),b(ye,fc)&&(b(ye,fc).abort(),k(ye,fc,null),k(ye,oa,NaN),k(ye,la,null))}static _endDraw(t){let n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),t&&n.drawLayer.updateProperties(this._currentDrawId,b(ye,yn).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){let i=b(ye,yn),r=this._currentDrawId,o=i.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(r,i.setLastElement(o))},undo:()=>{n.drawLayer.updateProperties(r,i.removeLastElement())},mustExec:!1,type:nt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){let n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(nt.DRAW_STEP),!b(ye,yn).isEmpty()){let{pageDimensions:[i,r],scale:o}=n,l=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:b(ye,yn).getOutlines(i*o,r*o,o,this._INNER_MARGIN),drawingOptions:b(ye,pc),mustBeCommitted:!t});return this._cleanup(!0),l}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,i,r,o,l){vt("Not implemented")}static async deserialize(t,n,i){var c,a;let{rawDims:{pageWidth:r,pageHeight:o,pageX:l,pageY:u}}=n.viewport,h=this.deserializeDraw(l,u,r,o,this._INNER_MARGIN,t),d=await super.deserialize(t,n,i);return d.createDrawingOptions(t),N(c=d,pm,p1).call(c,{drawOutlines:h}),N(a=d,mc,qf).call(a),d.onScaleChanging(),d.rotate(),d}serializeDraw(t){let[n,i]=this.pageTranslation,[r,o]=this.pageDimensions;return b(this,Rs).serialize([n,i,r,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Rs=new WeakMap,ah=new WeakMap,yn=new WeakMap,fc=new WeakMap,pc=new WeakMap,oa=new WeakMap,aa=new WeakMap,la=new WeakMap,gc=new WeakMap,pm=new WeakSet,p1=function({drawOutlines:t,drawId:n,drawingOptions:i}){k(this,Rs,t),this._drawingOptions||(this._drawingOptions=i),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=N(this,gm,g1).call(this,t,this.parent),N(this,yc,Yf).call(this,t.box)},gm=new WeakSet,g1=function(t,n){let{id:i}=n.drawLayer.draw(ye._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},mm=new WeakSet,m1=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},mc=new WeakSet,qf=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=N(this,gm,g1).call(this,b(this,Rs),t)}},Z0=new WeakSet,m3=function([t,n,i,r]){let{parentDimensions:[o,l],rotation:u}=this;switch(u){case 90:return[n,1-t,i*(l/o),r*(o/l)];case 180:return[1-t,1-n,i,r];case 270:return[1-n,t,i*(l/o),r*(o/l)];default:return[t,n,i,r]}},lh=new WeakSet,Vv=function(){let{x:t,y:n,width:i,height:r,parentDimensions:[o,l],rotation:u}=this;switch(u){case 90:return[1-n,t,i*(o/l),r*(l/o)];case 180:return[1-t,1-n,i,r];case 270:return[n,1-t,i*(o/l),r*(l/o)];default:return[t,n,i,r]}},yc=new WeakSet,Yf=function(t){if([this.x,this.y,this.width,this.height]=N(this,Z0,m3).call(this,t),this.div){this.fixAndSetPosition();let[n,i]=this.parentDimensions;this.setDims(this.width*n,this.height*i)}this._onResized()},ca=new WeakSet,zu=function(){let{x:t,y:n,width:i,height:r,rotation:o,parentRotation:l,parentDimensions:[u,h]}=this;switch((o*4+l)/90){case 1:return[1-n-r,t,r,i];case 2:return[1-t-i,1-n-r,i,r];case 3:return[n,1-t-i,r,i];case 4:return[t,n-i*(u/h),r*(h/u),i*(u/h)];case 5:return[1-n,t,i*(u/h),r*(h/u)];case 6:return[1-t-r*(h/u),1-n,r*(h/u),i*(u/h)];case 7:return[n-i*(u/h),1-t-r*(h/u),i*(u/h),r*(h/u)];case 8:return[t-i,n-r,i,r];case 9:return[1-n,t-i,r,i];case 10:return[1-t,1-n,i,r];case 11:return[n-r,1-t,r,i];case 12:return[t-r*(h/u),n,r*(h/u),i*(u/h)];case 13:return[1-n-i*(u/h),t-r*(h/u),i*(u/h),r*(h/u)];case 14:return[1-t,1-n-i*(u/h),r*(h/u),i*(u/h)];case 15:return[n,1-t,i*(u/h),r*(h/u)];default:return[t,n,i,r]}},J(ye,"_currentDrawId",-1),J(ye,"_currentParent",null),D(ye,yn,null),D(ye,fc,null),D(ye,pc,null),D(ye,oa,NaN),D(ye,aa,null),D(ye,la,null),D(ye,gc,NaN),J(ye,"_INNER_MARGIN",3);var f1=ye,er,bn,vn,bc,ch,Zn,In,Zs,vc,_c,wc,uh,zv,y1=class{constructor(e,t,n,i,r,o){D(this,uh);D(this,er,new Float64Array(6));D(this,bn,void 0);D(this,vn,void 0);D(this,bc,void 0);D(this,ch,void 0);D(this,Zn,void 0);D(this,In,"");D(this,Zs,0);D(this,vc,new x_);D(this,_c,void 0);D(this,wc,void 0);k(this,_c,n),k(this,wc,i),k(this,bc,r),k(this,ch,o),[e,t]=N(this,uh,zv).call(this,e,t);let l=k(this,bn,[NaN,NaN,NaN,NaN,e,t]);k(this,Zn,[e,t]),k(this,vn,[{line:l,points:b(this,Zn)}]),b(this,er).set(l,0)}updateProperty(e,t){e==="stroke-width"&&k(this,ch,t)}isEmpty(){return!b(this,vn)||b(this,vn).length===0}isCancellable(){return b(this,Zn).length<=10}add(e,t){[e,t]=N(this,uh,zv).call(this,e,t);let[n,i,r,o]=b(this,er).subarray(2,6),l=e-r,u=t-o;return Math.hypot(b(this,_c)*l,b(this,wc)*u)<=2?null:(b(this,Zn).push(e,t),isNaN(n)?(b(this,er).set([r,o,e,t],2),b(this,bn).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(b(this,er)[0])&&b(this,bn).splice(6,6),b(this,er).set([n,i,r,o,e,t],0),b(this,bn).push(...me.createBezierPoints(n,i,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){let n=this.add(e,t);return n||(b(this,Zn).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,i,r){k(this,_c,n),k(this,wc,i),k(this,bc,r),[e,t]=N(this,uh,zv).call(this,e,t);let o=k(this,bn,[NaN,NaN,NaN,NaN,e,t]);k(this,Zn,[e,t]);let l=b(this,vn).at(-1);return l&&(l.line=new Float32Array(l.line),l.points=new Float32Array(l.points)),b(this,vn).push({line:o,points:b(this,Zn)}),b(this,er).set(o,0),k(this,Zs,0),this.toSVGPath(),null}getLastElement(){return b(this,vn).at(-1)}setLastElement(e){return b(this,vn)?(b(this,vn).push(e),k(this,bn,e.line),k(this,Zn,e.points),k(this,Zs,0),{path:{d:this.toSVGPath()}}):b(this,vc).setLastElement(e)}removeLastElement(){if(!b(this,vn))return b(this,vc).removeLastElement();b(this,vn).pop(),k(this,In,"");for(let e=0,t=b(this,vn).length;e<t;e++){let{line:n,points:i}=b(this,vn)[e];k(this,bn,n),k(this,Zn,i),k(this,Zs,0),this.toSVGPath()}return{path:{d:b(this,In)}}}toSVGPath(){let e=me.svgRound(b(this,bn)[4]),t=me.svgRound(b(this,bn)[5]);if(b(this,Zn).length===2)return k(this,In,`${b(this,In)} M ${e} ${t} Z`),b(this,In);if(b(this,Zn).length<=6){let i=b(this,In).lastIndexOf("M");k(this,In,`${b(this,In).slice(0,i)} M ${e} ${t}`),k(this,Zs,6)}if(b(this,Zn).length===4){let i=me.svgRound(b(this,bn)[10]),r=me.svgRound(b(this,bn)[11]);return k(this,In,`${b(this,In)} L ${i} ${r}`),k(this,Zs,12),b(this,In)}let n=[];b(this,Zs)===0&&(n.push(`M ${e} ${t}`),k(this,Zs,6));for(let i=b(this,Zs),r=b(this,bn).length;i<r;i+=6){let[o,l,u,h,d,c]=b(this,bn).slice(i,i+6).map(me.svgRound);n.push(`C${o} ${l} ${u} ${h} ${d} ${c}`)}return k(this,In,b(this,In)+n.join(" ")),k(this,Zs,b(this,bn).length),b(this,In)}getOutlines(e,t,n,i){let r=b(this,vn).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),b(this,vc).build(b(this,vn),e,t,n,b(this,bc),b(this,ch),i),k(this,er,null),k(this,bn,null),k(this,vn,null),k(this,In,null),b(this,vc)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}};er=new WeakMap,bn=new WeakMap,vn=new WeakMap,bc=new WeakMap,ch=new WeakMap,Zn=new WeakMap,In=new WeakMap,Zs=new WeakMap,vc=new WeakMap,_c=new WeakMap,wc=new WeakMap,uh=new WeakSet,zv=function(e,t){return me._normalizePoint(e,t,b(this,_c),b(this,wc),b(this,bc))};var Qn,ym,bm,Ps,tr,nr,dh,hh,fh,Si,Nr,Q0,y3,ew,b3,tw,v3,L1=class L1 extends me{constructor(){super(...arguments);D(this,Si);D(this,Q0);D(this,ew);D(this,tw);D(this,Qn,void 0);D(this,ym,0);D(this,bm,void 0);D(this,Ps,void 0);D(this,tr,void 0);D(this,nr,void 0);D(this,dh,void 0);D(this,hh,void 0);D(this,fh,void 0)}build(t,n,i,r,o,l,u){k(this,tr,n),k(this,nr,i),k(this,dh,r),k(this,hh,o),k(this,fh,l),k(this,bm,u??0),k(this,Ps,t),N(this,ew,b3).call(this)}setLastElement(t){return b(this,Ps).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return b(this,Ps).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let t=[];for(let{line:n}of b(this,Ps)){if(t.push(`M${me.svgRound(n[4])} ${me.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12){t.push(`L${me.svgRound(n[10])} ${me.svgRound(n[11])}`);continue}for(let i=6,r=n.length;i<r;i+=6){let[o,l,u,h,d,c]=n.subarray(i,i+6).map(me.svgRound);t.push(`C${o} ${l} ${u} ${h} ${d} ${c}`)}}return t.join("")}serialize([t,n,i,r],o){let l=[],u=[],[h,d,c,a]=N(this,Q0,y3).call(this),f,p,g,m,y,_,x,E,S;switch(b(this,hh)){case 0:S=me._rescale,f=t,p=n+r,g=i,m=-r,y=t+h*i,_=n+(1-d-a)*r,x=t+(h+c)*i,E=n+(1-d)*r;break;case 90:S=me._rescaleAndSwap,f=t,p=n,g=i,m=r,y=t+d*i,_=n+h*r,x=t+(d+a)*i,E=n+(h+c)*r;break;case 180:S=me._rescale,f=t+i,p=n,g=-i,m=r,y=t+(1-h-c)*i,_=n+d*r,x=t+(1-h)*i,E=n+(d+a)*r;break;case 270:S=me._rescaleAndSwap,f=t+i,p=n+r,g=-i,m=-r,y=t+(1-d-a)*i,_=n+(1-h-c)*r,x=t+(1-d)*i,E=n+(1-h)*r;break}for(let{line:T,points:C}of b(this,Ps))l.push(S(T,f,p,g,m,o?new Array(T.length):null)),u.push(S(C,f,p,g,m,o?new Array(C.length):null));return{lines:l,points:u,rect:[y,_,x,E]}}static deserialize(t,n,i,r,o,{paths:{lines:l,points:u},rotation:h,thickness:d}){let c=[],a,f,p,g,m;switch(h){case 0:m=me._rescale,a=-t/i,f=n/r+1,p=1/i,g=-1/r;break;case 90:m=me._rescaleAndSwap,a=-n/r,f=-t/i,p=1/r,g=1/i;break;case 180:m=me._rescale,a=t/i+1,f=-n/r,p=-1/i,g=1/r;break;case 270:m=me._rescaleAndSwap,a=n/r+1,f=t/i+1,p=-1/r,g=-1/i;break}if(!l){l=[];for(let _ of u){let x=_.length;if(x===2){l.push(new Float32Array([NaN,NaN,NaN,NaN,_[0],_[1]]));continue}if(x===4){l.push(new Float32Array([NaN,NaN,NaN,NaN,_[0],_[1],NaN,NaN,NaN,NaN,_[2],_[3]]));continue}let E=new Float32Array(3*(x-2));l.push(E);let[S,T,C,I]=_.subarray(0,4);E.set([NaN,NaN,NaN,NaN,S,T],0);for(let A=4;A<x;A+=2){let P=_[A],F=_[A+1];E.set(me.createBezierPoints(S,T,C,I,P,F),(A-2)*3),[S,T,C,I]=[C,I,P,F]}}}for(let _=0,x=l.length;_<x;_++)c.push({line:m(l[_].map(E=>E??NaN),a,f,p,g),points:m(u[_].map(E=>E??NaN),a,f,p,g)});let y=new L1;return y.build(c,i,r,1,h,d,o),y}get box(){return b(this,Qn)}updateProperty(t,n){return t==="stroke-width"?N(this,tw,v3).call(this,n):null}updateParentDimensions([t,n],i){let[r,o]=N(this,Si,Nr).call(this);k(this,tr,t),k(this,nr,n),k(this,dh,i);let[l,u]=N(this,Si,Nr).call(this),h=l-r,d=u-o,c=b(this,Qn);return c[0]-=h,c[1]-=d,c[2]+=2*h,c[3]+=2*d,c}updateRotation(t){return k(this,ym,t),{path:{transform:this.rotationTransform}}}get viewBox(){return b(this,Qn).map(me.svgRound).join(" ")}get defaultProperties(){let[t,n]=b(this,Qn);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${me.svgRound(t)} ${me.svgRound(n)}`}}}get rotationTransform(){let[,,t,n]=b(this,Qn),i=0,r=0,o=0,l=0,u=0,h=0;switch(b(this,ym)){case 90:r=n/t,o=-t/n,u=t;break;case 180:i=-1,l=-1,u=t,h=n;break;case 270:r=-n/t,o=t/n,h=n;break;default:return""}return`matrix(${i} ${r} ${o} ${l} ${me.svgRound(u)} ${me.svgRound(h)})`}getPathResizingSVGProperties([t,n,i,r]){let[o,l]=N(this,Si,Nr).call(this),[u,h,d,c]=b(this,Qn);if(Math.abs(d-o)<=me.PRECISION||Math.abs(c-l)<=me.PRECISION){let m=t+i/2-(u+d/2),y=n+r/2-(h+c/2);return{path:{"transform-origin":`${me.svgRound(t)} ${me.svgRound(n)}`,transform:`${this.rotationTransform} translate(${m} ${y})`}}}let a=(i-2*o)/(d-2*o),f=(r-2*l)/(c-2*l),p=d/i,g=c/r;return{path:{"transform-origin":`${me.svgRound(u)} ${me.svgRound(h)}`,transform:`${this.rotationTransform} scale(${p} ${g}) translate(${me.svgRound(o)} ${me.svgRound(l)}) scale(${a} ${f}) translate(${me.svgRound(-o)} ${me.svgRound(-l)})`}}}getPathResizedSVGProperties([t,n,i,r]){let[o,l]=N(this,Si,Nr).call(this),u=b(this,Qn),[h,d,c,a]=u;if(u[0]=t,u[1]=n,u[2]=i,u[3]=r,Math.abs(c-o)<=me.PRECISION||Math.abs(a-l)<=me.PRECISION){let y=t+i/2-(h+c/2),_=n+r/2-(d+a/2);for(let{line:x,points:E}of b(this,Ps))me._translate(x,y,_,x),me._translate(E,y,_,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${me.svgRound(t)} ${me.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let f=(i-2*o)/(c-2*o),p=(r-2*l)/(a-2*l),g=-f*(h+o)+t+o,m=-p*(d+l)+n+l;if(f!==1||p!==1||g!==0||m!==0)for(let{line:y,points:_}of b(this,Ps))me._rescale(y,g,m,f,p,y),me._rescale(_,g,m,f,p,_);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${me.svgRound(t)} ${me.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],i){let[r,o]=i,l=b(this,Qn),u=t-l[0],h=n-l[1];if(b(this,tr)===r&&b(this,nr)===o)for(let{line:d,points:c}of b(this,Ps))me._translate(d,u,h,d),me._translate(c,u,h,c);else{let d=b(this,tr)/r,c=b(this,nr)/o;k(this,tr,r),k(this,nr,o);for(let{line:a,points:f}of b(this,Ps))me._rescale(a,u,h,d,c,a),me._rescale(f,u,h,d,c,f);l[2]*=d,l[3]*=c}return l[0]=t,l[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${me.svgRound(t)} ${me.svgRound(n)}`}}}get defaultSVGProperties(){let t=b(this,Qn);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${me.svgRound(t[0])} ${me.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};Qn=new WeakMap,ym=new WeakMap,bm=new WeakMap,Ps=new WeakMap,tr=new WeakMap,nr=new WeakMap,dh=new WeakMap,hh=new WeakMap,fh=new WeakMap,Si=new WeakSet,Nr=function(t=b(this,fh)){let n=b(this,bm)+t/2*b(this,dh);return b(this,hh)%180===0?[n/b(this,tr),n/b(this,nr)]:[n/b(this,nr),n/b(this,tr)]},Q0=new WeakSet,y3=function(){let[t,n,i,r]=b(this,Qn),[o,l]=N(this,Si,Nr).call(this,0);return[t+o,n+l,i-2*o,r-2*l]},ew=new WeakSet,b3=function(){let t=k(this,Qn,new Float32Array([1/0,1/0,-1/0,-1/0]));for(let{line:r}of b(this,Ps)){if(r.length<=12){for(let u=4,h=r.length;u<h;u+=6){let[d,c]=r.subarray(u,u+2);t[0]=Math.min(t[0],d),t[1]=Math.min(t[1],c),t[2]=Math.max(t[2],d),t[3]=Math.max(t[3],c)}continue}let o=r[4],l=r[5];for(let u=6,h=r.length;u<h;u+=6){let[d,c,a,f,p,g]=r.subarray(u,u+6);ve.bezierBoundingBox(o,l,d,c,a,f,p,g,t),o=p,l=g}}let[n,i]=N(this,Si,Nr).call(this);t[0]=Math.min(1,Math.max(0,t[0]-n)),t[1]=Math.min(1,Math.max(0,t[1]-i)),t[2]=Math.min(1,Math.max(0,t[2]+n)),t[3]=Math.min(1,Math.max(0,t[3]+i)),t[2]-=t[0],t[3]-=t[1]},tw=new WeakSet,v3=function(t){let[n,i]=N(this,Si,Nr).call(this);k(this,fh,t);let[r,o]=N(this,Si,Nr).call(this),[l,u]=[r-n,o-i],h=b(this,Qn);return h[0]-=l,h[1]-=u,h[2]+=2*l,h[3]+=2*u,h};var x_=L1,ph,$1=class $1 extends h1{constructor(t){super();D(this,ph,void 0);k(this,ph,t),super.updateProperties({fill:"none",stroke:Ot._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,n){t==="stroke-width"&&(n??(n=this["stroke-width"]),n*=b(this,ph).realScale),super.updateSVGProperty(t,n)}clone(){let t=new $1(b(this,ph));return t.updateAll(this),t}};ph=new WeakMap;var b1=$1,nw,_3,Gu=class Gu extends f1{constructor(t){super({...t,name:"inkEditor"});D(this,nw);this._willKeepAspectRatio=!0}static initialize(t,n){Ot.initialize(t,n),this._defaultDrawingOptions=new b1(n.viewParameters)}static getDefaultDrawingOptions(t){let n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return Ye(this,"typesMap",new Map([[nt.INK_THICKNESS,"stroke-width"],[nt.INK_COLOR,"stroke"],[nt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,i,r,o){return new y1(t,n,i,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,i,r,o,l){return x_.deserialize(t,n,i,r,o,l)}static async deserialize(t,n,i){let r=null;if(t instanceof dp){let{data:{inkLists:l,rect:u,rotation:h,id:d,color:c,opacity:a,borderStyle:{rawWidth:f},popupRef:p},parent:{page:{pageNumber:g}}}=t;r=t={annotationType:Fe.INK,color:Array.from(c),thickness:f,opacity:a,paths:{points:l},boxes:null,pageIndex:g-1,rect:u.slice(0),rotation:h,id:d,deleted:!1,popupRef:p}}let o=await super.deserialize(t,n,i);return o.annotationElementId=t.id||null,o._initialData=r,o}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:t,_drawingOptions:n,parent:i}=this;n.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){let t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:i}){this._drawingOptions=Gu.getDefaultDrawingOptions({stroke:ve.makeHexColor(...t),"stroke-width":n,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:n,points:i,rect:r}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":l,"stroke-width":u}}=this,h={annotationType:Fe.INK,color:Ot._colorManager.convert(o),opacity:l,thickness:u,paths:{lines:n,points:i},pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?h:this.annotationElementId&&!N(this,nw,_3).call(this,h)?null:(h.id=this.annotationElementId,h)}renderAnnotationElement(t){let{points:n,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:n}),null}};nw=new WeakSet,_3=function(t){let{color:n,thickness:i,opacity:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((l,u)=>l!==n[u])||t.thickness!==i||t.opacity!==r||t.pageIndex!==o},J(Gu,"_type","ink"),J(Gu,"_editorType",Fe.INK),J(Gu,"_defaultDrawingOptions",null);var v1=Gu,Nt,Dn,ua,ao,da,gh,sr,ir,Ms,mh,xc,Kf,Ec,Xf,yh,Hv,vm,w1,bh,Gv,_m,x1,vh,jv,sw,w3,ep=class ep extends Ot{constructor(t){super({...t,name:"stampEditor"});D(this,xc);D(this,Ec);D(this,yh);D(this,vm);D(this,bh);D(this,_m);D(this,vh);D(this,sw);D(this,Nt,null);D(this,Dn,null);D(this,ua,null);D(this,ao,null);D(this,da,null);D(this,gh,"");D(this,sr,null);D(this,ir,null);D(this,Ms,!1);D(this,mh,!1);k(this,ao,t.bitmapUrl),k(this,da,t.bitmapFile)}static initialize(t,n){Ot.initialize(t,n)}static get supportedTypes(){return Ye(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(n=>`image/${n}`))}static get supportedTypesStr(){return Ye(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,n){n.pasteEditor(Fe.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){let n=t.get("hasAltText");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;let{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");let{data:r,width:o,height:l}=t||this.copyCanvas(null,null,!0).imageData,u=await i.guess({name:"altText",request:{data:r,width:o,height:l,channels:r.length/(o*l)}});if(!u)throw new Error("No response from the AI service.");if(u.error)throw new Error("Error from the AI service.");if(u.cancel)return null;if(!u.output)throw new Error("No valid response from the AI service.");let h=u.output;return await this.setGuessedAltText(h),n&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){b(this,Dn)&&(k(this,Nt,null),this._uiManager.imageManager.deleteId(b(this,Dn)),b(this,sr)?.remove(),k(this,sr,null),b(this,ir)&&(clearTimeout(b(this,ir)),k(this,ir,null))),super.remove()}rebuild(){if(!this.parent){b(this,Dn)&&N(this,yh,Hv).call(this);return}super.rebuild(),this.div!==null&&(b(this,Dn)&&b(this,sr)===null&&N(this,yh,Hv).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(b(this,ua)||b(this,Nt)||b(this,ao)||b(this,da)||b(this,Dn))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;if(this.width&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),b(this,Nt)?N(this,vm,w1).call(this):N(this,yh,Hv).call(this),this.width&&!this.annotationElementId){let[i,r]=this.parentDimensions;this.setAt(t*i,n*r,this.width*i,this.height*r)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;b(this,ir)!==null&&clearTimeout(b(this,ir)),k(this,ir,setTimeout(()=>{k(this,ir,null),N(this,_m,x1).call(this)},200))}copyCanvas(t,n,i=!1){t||(t=224);let{width:r,height:o}=b(this,Nt),l=new ip,u=b(this,Nt),h=r,d=o,c=null;if(n){if(r>n||o>n){let C=Math.min(n/r,n/o);h=Math.floor(r*C),d=Math.floor(o*C)}c=document.createElement("canvas");let f=c.width=Math.ceil(h*l.sx),p=c.height=Math.ceil(d*l.sy);b(this,Ms)||(u=N(this,bh,Gv).call(this,f,p));let g=c.getContext("2d");g.filter=this._uiManager.hcmFilter;let m="white",y="#cfcfd8";this._uiManager.hcmFilter!=="none"?y="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(m="#8f8f9d",y="#42414d");let _=15,x=_*l.sx,E=_*l.sy,S=new OffscreenCanvas(x*2,E*2),T=S.getContext("2d");T.fillStyle=m,T.fillRect(0,0,x*2,E*2),T.fillStyle=y,T.fillRect(0,0,x,E),T.fillRect(x,E,x,E),g.fillStyle=g.createPattern(S,"repeat"),g.fillRect(0,0,f,p),g.drawImage(u,0,0,u.width,u.height,0,0,f,p)}let a=null;if(i){let f,p;if(l.symmetric&&u.width<t&&u.height<t)f=u.width,p=u.height;else if(u=b(this,Nt),r>t||o>t){let y=Math.min(t/r,t/o);f=Math.floor(r*y),p=Math.floor(o*y),b(this,Ms)||(u=N(this,bh,Gv).call(this,f,p))}let m=new OffscreenCanvas(f,p).getContext("2d",{willReadFrequently:!0});m.drawImage(u,0,0,u.width,u.height,0,0,f,p),a={width:f,height:p,data:m.getImageData(0,0,f,p).data}}return{canvas:c,width:h,height:d,imageData:a}}getImageForAltText(){return b(this,sr)}static async deserialize(t,n,i){let r=null;if(t instanceof y_){let{data:{rect:g,rotation:m,id:y,structParent:_,popupRef:x},container:E,parent:{page:{pageNumber:S}}}=t,T=E.querySelector("canvas"),C=i.imageManager.getFromCanvas(E.id,T);T.remove();let I=(await n._structTree.getAriaAttributes(`${k1}${y}`))?.get("aria-label")||"";r=t={annotationType:Fe.STAMP,bitmapId:C.id,bitmap:C.bitmap,pageIndex:S-1,rect:g.slice(0),rotation:m,id:y,deleted:!1,accessibilityData:{decorative:!1,altText:I},isSvg:!1,structParent:_,popupRef:x}}let o=await super.deserialize(t,n,i),{rect:l,bitmap:u,bitmapUrl:h,bitmapId:d,isSvg:c,accessibilityData:a}=t;d&&i.imageManager.isValidId(d)?(k(o,Dn,d),u&&k(o,Nt,u)):k(o,ao,h),k(o,Ms,c);let[f,p]=o.pageDimensions;return o.width=(l[2]-l[0])/f,o.height=(l[3]-l[1])/p,o.annotationElementId=t.id||null,a&&(o.altTextData=a),o._initialData=r,k(o,mh,!!r),o}serialize(t=!1,n=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let i={annotationType:Fe.STAMP,bitmapId:b(this,Dn),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:b(this,Ms),structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=N(this,vh,jv).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i;let{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(i.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){let u=N(this,sw,w3).call(this,i);if(u.isSame)return null;u.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,n===null)return i;n.stamps||(n.stamps=new Map);let l=b(this,Ms)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!n.stamps.has(b(this,Dn)))n.stamps.set(b(this,Dn),{area:l,serialized:i}),i.bitmap=N(this,vh,jv).call(this,!1);else if(b(this,Ms)){let u=n.stamps.get(b(this,Dn));l>u.area&&(u.area=l,u.serialized.bitmap.close(),u.serialized.bitmap=N(this,vh,jv).call(this,!1))}return i}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};Nt=new WeakMap,Dn=new WeakMap,ua=new WeakMap,ao=new WeakMap,da=new WeakMap,gh=new WeakMap,sr=new WeakMap,ir=new WeakMap,Ms=new WeakMap,mh=new WeakMap,xc=new WeakSet,Kf=function(t,n=!1){if(!t){this.remove();return}k(this,Nt,t.bitmap),n||(k(this,Dn,t.id),k(this,Ms,t.isSvg)),t.file&&k(this,gh,t.file.name),N(this,vm,w1).call(this)},Ec=new WeakSet,Xf=function(){if(k(this,ua,null),this._uiManager.enableWaiting(!1),!!b(this,sr)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&b(this,Nt)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&b(this,Nt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},yh=new WeakSet,Hv=function(){if(b(this,Dn)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(b(this,Dn)).then(i=>N(this,xc,Kf).call(this,i,!0)).finally(()=>N(this,Ec,Xf).call(this));return}if(b(this,ao)){let i=b(this,ao);k(this,ao,null),this._uiManager.enableWaiting(!0),k(this,ua,this._uiManager.imageManager.getFromUrl(i).then(r=>N(this,xc,Kf).call(this,r)).finally(()=>N(this,Ec,Xf).call(this)));return}if(b(this,da)){let i=b(this,da);k(this,da,null),this._uiManager.enableWaiting(!0),k(this,ua,this._uiManager.imageManager.getFromFile(i).then(r=>N(this,xc,Kf).call(this,r)).finally(()=>N(this,Ec,Xf).call(this)));return}let t=document.createElement("input");t.type="file",t.accept=ep.supportedTypesStr;let n=this._uiManager._signal;k(this,ua,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),N(this,xc,Kf).call(this,r)}i()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:n})}).finally(()=>N(this,Ec,Xf).call(this))),t.click()},vm=new WeakSet,w1=function(){let{div:t}=this,{width:n,height:i}=b(this,Nt),[r,o]=this.pageDimensions,l=.75;if(this.width)n=this.width*r,i=this.height*o;else if(n>l*r||i>l*o){let c=Math.min(l*r/n,l*o/i);n*=c,i*=c}let[u,h]=this.parentDimensions;this.setDims(n*u/r,i*h/o),this._uiManager.enableWaiting(!1);let d=k(this,sr,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=n/r,this.height=i/o,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),N(this,_m,x1).call(this),b(this,mh)||(this.parent.addUndoableEditor(this),k(this,mh,!0)),this._reportTelemetry({action:"inserted_image"}),b(this,gh)&&d.setAttribute("aria-label",b(this,gh))},bh=new WeakSet,Gv=function(t,n){let{width:i,height:r}=b(this,Nt),o=i,l=r,u=b(this,Nt);for(;o>2*t||l>2*n;){let h=o,d=l;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),l>2*n&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2));let c=new OffscreenCanvas(o,l);c.getContext("2d").drawImage(u,0,0,h,d,0,0,o,l),u=c.transferToImageBitmap()}return u},_m=new WeakSet,x1=function(){let[t,n]=this.parentDimensions,{width:i,height:r}=this,o=new ip,l=Math.ceil(i*t*o.sx),u=Math.ceil(r*n*o.sy),h=b(this,sr);if(!h||h.width===l&&h.height===u)return;h.width=l,h.height=u;let d=b(this,Ms)?b(this,Nt):N(this,bh,Gv).call(this,l,u),c=h.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(d,0,0,d.width,d.height,0,0,l,u)},vh=new WeakSet,jv=function(t){if(t){if(b(this,Ms)){let r=this._uiManager.imageManager.getSvgUrl(b(this,Dn));if(r)return r}let n=document.createElement("canvas");return{width:n.width,height:n.height}=b(this,Nt),n.getContext("2d").drawImage(b(this,Nt),0,0),n.toDataURL()}if(b(this,Ms)){let[n,i]=this.pageDimensions,r=Math.round(this.width*n*ma.PDF_TO_CSS_UNITS),o=Math.round(this.height*i*ma.PDF_TO_CSS_UNITS),l=new OffscreenCanvas(r,o);return l.getContext("2d").drawImage(b(this,Nt),0,0,b(this,Nt).width,b(this,Nt).height,0,0,r,o),l.transferToImageBitmap()}return structuredClone(b(this,Nt))},sw=new WeakSet,w3=function(t){let{pageIndex:n,accessibilityData:{altText:i}}=this._initialData,r=t.pageIndex===n,o=(t.accessibilityData?.alt||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}},J(ep,"_type","stamp"),J(ep,"_editorType",Fe.STAMP);var _1=ep,Sc,_h,rr,ha,lo,Qs,fa,wh,Tc,Ti,co,Hn,uo,we,pa,iw,x3,ei,Vi,wm,S1,xm,T1,xh,Wv,di=class di{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:i,accessibilityManager:r,annotationLayer:o,drawLayer:l,textLayer:u,viewport:h,l10n:d}){D(this,iw);D(this,ei);D(this,wm);D(this,xm);D(this,xh);D(this,Sc,void 0);D(this,_h,!1);D(this,rr,null);D(this,ha,null);D(this,lo,null);D(this,Qs,new Map);D(this,fa,!1);D(this,wh,!1);D(this,Tc,!1);D(this,Ti,null);D(this,co,null);D(this,Hn,null);D(this,uo,null);D(this,we,void 0);let c=[...b(di,pa).values()];if(!di._initialized){di._initialized=!0;for(let a of c)a.initialize(d,e)}e.registerEditorTypes(c),k(this,we,e),this.pageIndex=t,this.div=n,k(this,Sc,r),k(this,rr,o),this.viewport=h,k(this,Hn,u),this.drawLayer=l,this._structTree=i,b(this,we).addLayer(this)}get isEmpty(){return b(this,Qs).size===0}get isInvisible(){return this.isEmpty&&b(this,we).getMode()===Fe.NONE}updateToolbar(e){b(this,we).updateToolbar(e)}updateMode(e=b(this,we).getMode()){switch(N(this,xh,Wv).call(this),e){case Fe.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Fe.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Fe.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:t}=this.div;for(let n of b(di,pa).values())t.toggle(`${n._type}Editing`,e===n._editorType);this.div.hidden=!1}hasTextLayer(e){return e===b(this,Hn)?.div}setEditingState(e){b(this,we).setEditingState(e)}addCommands(e){b(this,we).addCommands(e)}cleanUndoStack(e){b(this,we).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){b(this,rr)?.div.classList.toggle("disabled",!e)}async enable(){k(this,Tc,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);let e=new Set;for(let n of b(this,Qs).values())n.enableEditing(),n.show(!0),n.annotationElementId&&(b(this,we).removeChangedExistingAnnotation(n),e.add(n.annotationElementId));if(!b(this,rr)){k(this,Tc,!1);return}let t=b(this,rr).getEditableAnnotations();for(let n of t){if(n.hide(),b(this,we).isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;let i=await this.deserialize(n);i&&(this.addOrRebuild(i),i.enableEditing())}k(this,Tc,!1)}disable(){k(this,wh,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);let e=new Map,t=new Map;for(let i of b(this,Qs).values())if(i.disableEditing(),!!i.annotationElementId){if(i.serialize()!==null){e.set(i.annotationElementId,i);continue}else t.set(i.annotationElementId,i);this.getEditableAnnotation(i.annotationElementId)?.show(),i.remove()}if(b(this,rr)){let i=b(this,rr).getEditableAnnotations();for(let r of i){let{id:o}=r.data;if(b(this,we).isDeletedAnnotationElement(o))continue;let l=t.get(o);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=e.get(o),l&&(b(this,we).addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}N(this,xh,Wv).call(this),this.isEmpty&&(this.div.hidden=!0);let{classList:n}=this.div;for(let i of b(di,pa).values())n.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),k(this,wh,!1)}getEditableAnnotation(e){return b(this,rr)?.getEditableAnnotation(e)||null}setActiveEditor(e){b(this,we).getActive()!==e&&b(this,we).setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,b(this,Hn)?.div&&!b(this,uo)){k(this,uo,new AbortController);let e=b(this,we).combinedSignal(b(this,uo));b(this,Hn).div.addEventListener("pointerdown",N(this,iw,x3).bind(this),{signal:e}),b(this,Hn).div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,b(this,Hn)?.div&&b(this,uo)&&(b(this,uo).abort(),k(this,uo,null),b(this,Hn).div.classList.remove("highlighting"))}enableClick(){if(b(this,ha))return;k(this,ha,new AbortController);let e=b(this,we).combinedSignal(b(this,ha));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});let t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){b(this,ha)?.abort(),k(this,ha,null)}attach(e){b(this,Qs).set(e.id,e);let{annotationElementId:t}=e;t&&b(this,we).isDeletedAnnotationElement(t)&&b(this,we).removeDeletedAnnotationElement(e)}detach(e){b(this,Qs).delete(e.id),b(this,Sc)?.removePointerInTextLayer(e.contentDiv),!b(this,wh)&&e.annotationElementId&&b(this,we).addDeletedAnnotationElement(e)}remove(e){this.detach(e),b(this,we).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(b(this,we).addDeletedAnnotationElement(e.annotationElementId),Ot.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),b(this,we).addEditor(e),this.attach(e),!e.isAttachedToDOM){let t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!b(this,Tc)),b(this,we).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;let{activeElement:t}=document;e.div.contains(t)&&!b(this,lo)&&(e._focusEventsAllowed=!1,k(this,lo,setTimeout(()=>{k(this,lo,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:b(this,we)._signal}),t.focus())},0))),e._structTreeParentId=b(this,Sc)?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){let t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getNextId(){return b(this,we).getId()}combinedSignal(e){return b(this,we).combinedSignal(e)}canCreateNewEmptyEditor(){return b(this,ei,Vi)?.canCreateNewEmptyEditor()}pasteEditor(e,t){b(this,we).updateToolbar(e),b(this,we).updateMode(e);let{offsetX:n,offsetY:i}=N(this,xm,T1).call(this),r=this.getNextId(),o=N(this,wm,S1).call(this,{parent:this,id:r,x:n,y:i,uiManager:b(this,we),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){return await b(di,pa).get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,b(this,we))||null}createAndAddNewEditor(e,t,n={}){let i=this.getNextId(),r=N(this,wm,S1).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:b(this,we),isCentered:t,...n});return r&&this.add(r),r}addNewEditor(){this.createAndAddNewEditor(N(this,xm,T1).call(this),!0)}setSelected(e){b(this,we).setSelected(e)}toggleSelected(e){b(this,we).toggleSelected(e)}unselect(e){b(this,we).unselect(e)}pointerup(e){let{isMac:t}=kn.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&b(this,fa)&&(k(this,fa,!1),!(b(this,ei,Vi)?.isDrawer&&b(this,ei,Vi).supportMultipleDrawings))){if(!b(this,_h)){k(this,_h,!0);return}if(b(this,we).getMode()===Fe.STAMP){b(this,we).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){if(b(this,we).getMode()===Fe.HIGHLIGHT&&this.enableTextSelection(),b(this,fa)){k(this,fa,!1);return}let{isMac:t}=kn.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(k(this,fa,!0),b(this,ei,Vi)?.isDrawer){this.startDrawingSession(e);return}let n=b(this,we).getActive();k(this,_h,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus(),b(this,Ti)){b(this,ei,Vi).startDrawing(this,b(this,we),!1,e);return}b(this,we).setCurrentDrawingSession(this),k(this,Ti,new AbortController);let t=b(this,we).combinedSignal(b(this,Ti));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(k(this,co,null),this.commitOrRemove())},{signal:t}),b(this,ei,Vi).startDrawing(this,b(this,we),!1,e)}pause(e){if(e){let{activeElement:t}=document;this.div.contains(t)&&k(this,co,t);return}b(this,co)&&setTimeout(()=>{b(this,co)?.focus(),k(this,co,null)},0)}endDrawingSession(e=!1){return b(this,Ti)?(b(this,we).setCurrentDrawingSession(null),b(this,Ti).abort(),k(this,Ti,null),k(this,co,null),b(this,ei,Vi).endDrawing(e)):null}findNewParent(e,t,n){let i=b(this,we).findParent(t,n);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return b(this,Ti)?(this.endDrawingSession(),!0):!1}onScaleChanging(){b(this,Ti)&&b(this,ei,Vi).onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),b(this,we).getActive()?.parent===this&&(b(this,we).commitOrRemove(),b(this,we).setActiveEditor(null)),b(this,lo)&&(clearTimeout(b(this,lo)),k(this,lo,null));for(let e of b(this,Qs).values())b(this,Sc)?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,b(this,Qs).clear(),b(this,we).removeLayer(this)}render({viewport:e}){this.viewport=e,Ic(this.div,e);for(let t of b(this,we).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){b(this,we).commitOrRemove(),N(this,xh,Wv).call(this);let t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,Ic(this.div,{rotation:n}),t!==n)for(let i of b(this,Qs).values())i.rotate(n)}get pageDimensions(){let{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return b(this,we).viewParameters.realScale}};Sc=new WeakMap,_h=new WeakMap,rr=new WeakMap,ha=new WeakMap,lo=new WeakMap,Qs=new WeakMap,fa=new WeakMap,wh=new WeakMap,Tc=new WeakMap,Ti=new WeakMap,co=new WeakMap,Hn=new WeakMap,uo=new WeakMap,we=new WeakMap,pa=new WeakMap,iw=new WeakSet,x3=function(e){b(this,we).unselectAll();let{target:t}=e;if(t===b(this,Hn).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&b(this,Hn).div.contains(t)){let{isMac:n}=kn.platform;if(e.button!==0||e.ctrlKey&&n)return;b(this,we).showAllEditors("highlight",!0,!0),b(this,Hn).div.classList.add("free"),this.toggleDrawing(),w_.startHighlighting(this,b(this,we).direction==="ltr",{target:b(this,Hn).div,x:e.x,y:e.y}),b(this,Hn).div.addEventListener("pointerup",()=>{b(this,Hn).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:b(this,we)._signal}),e.preventDefault()}},ei=new WeakSet,Vi=function(){return b(di,pa).get(b(this,we).getMode())},wm=new WeakSet,S1=function(e){let t=b(this,ei,Vi);return t?new t.prototype.constructor(e):null},xm=new WeakSet,T1=function(){let{x:e,y:t,width:n,height:i}=this.div.getBoundingClientRect(),r=Math.max(0,e),o=Math.max(0,t),l=Math.min(window.innerWidth,e+n),u=Math.min(window.innerHeight,t+i),h=(r+l)/2-e,d=(o+u)/2-t,[c,a]=this.viewport.rotation%180===0?[h,d]:[d,h];return{offsetX:c,offsetY:a}},xh=new WeakSet,Wv=function(){for(let e of b(this,Qs).values())e.isEmpty()&&e.remove()},J(di,"_initialized",!1),D(di,pa,new Map([n1,v1,_1,w_].map(e=>[e._editorType,e])));var E1=di,Ai,Em,es,Ac,rw,E3,Sm,C1,ow,S3,Tm,I1,Un=class Un{constructor({pageIndex:e}){D(this,Sm);D(this,ow);D(this,Tm);D(this,Ai,null);D(this,Em,0);D(this,es,new Map);D(this,Ac,new Map);this.pageIndex=e}setParent(e){if(!b(this,Ai)){k(this,Ai,e);return}if(b(this,Ai)!==e){if(b(this,es).size>0)for(let t of b(this,es).values())t.remove(),e.append(t);k(this,Ai,e)}}static get _svgFactory(){return Ye(this,"_svgFactory",new cp)}draw(e,t=!1,n=!1){let i=Yn(this,Em)._++,r=N(this,Sm,C1).call(this),o=Un._svgFactory.createElement("defs");r.append(o);let l=Un._svgFactory.createElement("path");o.append(l);let u=`path_p${this.pageIndex}_${i}`;l.setAttribute("id",u),l.setAttribute("vector-effect","non-scaling-stroke"),t&&b(this,Ac).set(i,l);let h=n?N(this,ow,S3).call(this,o,u):null,d=Un._svgFactory.createElement("use");return r.append(d),d.setAttribute("href",`#${u}`),this.updateProperties(r,e),b(this,es).set(i,r),{id:i,clipPathId:`url(#${h})`}}drawOutline(e,t){let n=Yn(this,Em)._++,i=N(this,Sm,C1).call(this),r=Un._svgFactory.createElement("defs");i.append(r);let o=Un._svgFactory.createElement("path");r.append(o);let l=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke");let u;if(t){let c=Un._svgFactory.createElement("mask");r.append(c),u=`mask_p${this.pageIndex}_${n}`,c.setAttribute("id",u),c.setAttribute("maskUnits","objectBoundingBox");let a=Un._svgFactory.createElement("rect");c.append(a),a.setAttribute("width","1"),a.setAttribute("height","1"),a.setAttribute("fill","white");let f=Un._svgFactory.createElement("use");c.append(f),f.setAttribute("href",`#${l}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}let h=Un._svgFactory.createElement("use");i.append(h),h.setAttribute("href",`#${l}`),u&&h.setAttribute("mask",`url(#${u})`);let d=h.cloneNode();return i.append(d),h.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(i,e),b(this,es).set(n,i),n}finalizeDraw(e,t){b(this,Ac).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var u;if(!t)return;let{root:n,bbox:i,rootClass:r,path:o}=t,l=typeof e=="number"?b(this,es).get(e):e;if(l){if(n&&N(this,Tm,I1).call(this,l,n),i&&N(u=Un,rw,E3).call(u,l,i),r){let{classList:h}=l;for(let[d,c]of Object.entries(r))h.toggle(d,c)}if(o){let d=l.firstChild.firstChild;N(this,Tm,I1).call(this,d,o)}}}updateParent(e,t){if(t===this)return;let n=b(this,es).get(e);n&&(b(t,Ai).append(n),b(this,es).delete(e),b(t,es).set(e,n))}remove(e){b(this,Ac).delete(e),b(this,Ai)!==null&&(b(this,es).get(e).remove(),b(this,es).delete(e))}destroy(){k(this,Ai,null);for(let e of b(this,es).values())e.remove();b(this,es).clear(),b(this,Ac).clear()}};Ai=new WeakMap,Em=new WeakMap,es=new WeakMap,Ac=new WeakMap,rw=new WeakSet,E3=function(e,[t,n,i,r]){let{style:o}=e;o.top=`${100*n}%`,o.left=`${100*t}%`,o.width=`${100*i}%`,o.height=`${100*r}%`},Sm=new WeakSet,C1=function(){let e=Un._svgFactory.create(1,1,!0);return b(this,Ai).append(e),e.setAttribute("aria-hidden",!0),e},ow=new WeakSet,S3=function(e,t){let n=Un._svgFactory.createElement("clipPath");e.append(n);let i=`clip_${t}`;n.setAttribute("id",i),n.setAttribute("clipPathUnits","objectBoundingBox");let r=Un._svgFactory.createElement("use");return n.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),i},Tm=new WeakSet,I1=function(e,t){for(let[n,i]of Object.entries(t))i===null?e.removeAttribute(n):e.setAttribute(n,i)},D(Un,rw);var A1=Un;globalThis.pdfjsTestingUtils={HighlightOutliner:hp};var kQ=Re.AbortException,RQ=Re.AnnotationEditorLayer,PQ=Re.AnnotationEditorParamsType,MQ=Re.AnnotationEditorType,NQ=Re.AnnotationEditorUIManager,OQ=Re.AnnotationLayer,FQ=Re.AnnotationMode,LQ=Re.ColorPicker,$Q=Re.DOMSVGFactory,UQ=Re.DrawLayer,BQ=Re.FeatureTest,T3=Re.GlobalWorkerOptions,VQ=Re.ImageKind,zQ=Re.InvalidPDFException,HQ=Re.MissingPDFException,GQ=Re.OPS,jQ=Re.OutputScale,WQ=Re.PDFDataRangeTransport,qQ=Re.PDFDateString,YQ=Re.PDFWorker,KQ=Re.PasswordResponses,XQ=Re.PermissionFlag,JQ=Re.PixelsPerInch,ZQ=Re.RenderingCancelledException,QQ=Re.TextLayer,eee=Re.TouchManager,tee=Re.UnexpectedResponseException,nee=Re.Util,see=Re.VerbosityLevel,iee=Re.XfaLayer,ree=Re.build,oee=Re.createValidAbsoluteUrl,aee=Re.fetchData,gw=Re.getDocument,lee=Re.getFilenameFromUrl,cee=Re.getPdfFilenameFromUrl,uee=Re.getXfaPageViewport,dee=Re.isDataScheme,hee=Re.isPdfFile,fee=Re.noContextMenu,pee=Re.normalizeUnicode,gee=Re.setLayerDimensions,mee=Re.shadow,yee=Re.stopEvent,bee=Re.version;T3.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.mjs";var mw=class{constructor(e=50){this.minTextThreshold=e}async extractText(e){let t=await gw({data:new Uint8Array(e),useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,n="";for(let o=1;o<=t.numPages;o++){let h=(await(await t.getPage(o)).getTextContent()).items.map(d=>d.str||"").join(" ");n+=`
## \uD398\uC774\uC9C0 ${o}

${h}
`}let r=n.replace(/\s/g,"").length/t.numPages<this.minTextThreshold;return{text:n,isScanned:r,numPages:t.numPages}}async renderPagesToImages(e,t){let n=await gw({data:new Uint8Array(e),useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,i=[],r=t?Math.min(n.numPages,t):n.numPages;for(let o=1;o<=r;o++){let l=await n.getPage(o),u=l.getViewport({scale:2}),h=document.createElement("canvas");h.width=u.width,h.height=u.height;let d=h.getContext("2d");await l.render({canvasContext:d,viewport:u}).promise;let c=h.toDataURL("image/png").split(",")[1];i.push({base64:c,mimeType:"image/png",pageNum:o})}return i}async getPageCount(e){return(await gw({data:new Uint8Array(e),useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise).numPages}};var bw=class{constructor(e,t,n){this.gemini=e,this.settings=t,this.vault=n,this.pdfProcessor=new mw(t.ocrMinTextThreshold),this.dailyUsage=this.loadDailyUsage()}loadDailyUsage(){return{date:$i(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}saveDailyUsage(){}checkDailyLimit(e){let t=$i(this.settings.timezone);this.dailyUsage.date!==t&&(this.dailyUsage={date:t,pagesProcessed:0,filesProcessed:0});let n=this.settings.ocrDailyLimit-this.dailyUsage.pagesProcessed;return{allowed:e<=n,remaining:n}}getFileSizeMB(e){return e.stat.size/(1024*1024)}async checkLimits(e){let t=this.getFileSizeMB(e);if(t>this.settings.ocrMaxFileSizeMB)return{allowed:!1,reason:`\uD30C\uC77C \uD06C\uAE30(${t.toFixed(1)}MB)\uAC00 \uC81C\uD55C(${this.settings.ocrMaxFileSizeMB}MB)\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,fileSize:t};if(e.extension==="pdf"){let i=await this.vault.readBinary(e),r=await this.pdfProcessor.getPageCount(i);if(r>this.settings.ocrMaxPages)return{allowed:!1,reason:`\uD398\uC774\uC9C0 \uC218(${r})\uAC00 \uC81C\uD55C(${this.settings.ocrMaxPages})\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,pageCount:r,fileSize:t};let o=this.checkDailyLimit(r);return o.allowed?{allowed:!0,pageCount:r,fileSize:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${o.remaining})`,pageCount:r,fileSize:t}}let n=this.checkDailyLimit(1);return n.allowed?{allowed:!0,pageCount:1,fileSize:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${n.remaining})`,pageCount:1,fileSize:t}}async processImage(e){let t=await this.vault.readBinary(e),n=this.arrayBufferToBase64(t),i=this.getMimeType(e.extension),r=await this.gemini.extractTextFromImage(n,i);return this.dailyUsage.pagesProcessed+=1,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:r,pages:1,sourceType:"image",sourceFile:e.name}}async processPDF(e,t=!1,n){let i=await this.vault.readBinary(e),r=n||this.settings.ocrMaxPages,o=i.slice(0),l=await this.pdfProcessor.extractText(o);if(!l.isScanned&&!t)return{text:l.text,pages:l.numPages,sourceType:"pdf_text",sourceFile:e.name};let u=Math.min(l.numPages,r);new yw.Notice(`\uC2A4\uCE94 PDF \uAC10\uC9C0\uB428. OCR \uCC98\uB9AC \uC911... (${u}\uD398\uC774\uC9C0)`);let h=await this.pdfProcessor.renderPagesToImages(i.slice(0),r),d=await this.gemini.extractTextFromImages(h,(a,f)=>{new yw.Notice(`OCR \uC9C4\uD589 \uC911: ${a}/${f} \uD398\uC774\uC9C0`,1500)}),c="";for(let a=0;a<d.length;a++)c+=`
## \uD398\uC774\uC9C0 ${a+1}

${d[a]}
`;return this.dailyUsage.pagesProcessed+=d.length,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:c,pages:d.length,sourceType:"pdf_scanned",sourceFile:e.name}}async processFile(e,t){let n=e.extension.toLowerCase();if(["png","jpg","jpeg","webp","gif"].includes(n))return this.processImage(e);if(n==="pdf")return this.processPDF(e,!1,t);throw new Error(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD: ${n}`)}async processMultipleImages(e,t){if(e.length===0)throw new Error("\uCC98\uB9AC\uD560 \uC774\uBBF8\uC9C0\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");let n=this.checkDailyLimit(e.length);if(!n.allowed)throw new Error(`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${n.remaining}, \uD544\uC694: ${e.length})`);let i=[];for(let l of e){let u=await this.vault.readBinary(l),h=this.arrayBufferToBase64(u),d=this.getMimeType(l.extension);i.push({base64:h,mimeType:d})}let r=await this.gemini.extractTextFromImages(i,(l,u)=>{new yw.Notice(`OCR \uC9C4\uD589 \uC911: ${l}/${u} \uD398\uC774\uC9C0`,1500)}),o="";for(let l=0;l<r.length;l++)r.length>1?o+=`
## \uD398\uC774\uC9C0 ${l+1}

${r[l]}
`:o=r[l];return this.dailyUsage.pagesProcessed+=e.length,this.dailyUsage.filesProcessed+=e.length,this.saveDailyUsage(),{text:o,pages:e.length,sourceType:"image",sourceFile:t}}checkLimitsForMultipleImages(e){let t=e.reduce((r,o)=>r+this.getFileSizeMB(o),0),n=this.settings.ocrMaxFileSizeMB*2;if(t>n)return{allowed:!1,reason:`\uCD1D \uD30C\uC77C \uD06C\uAE30(${t.toFixed(1)}MB)\uAC00 \uC81C\uD55C(${n}MB)\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,pageCount:e.length,totalSizeMB:t};let i=this.checkDailyLimit(e.length);return i.allowed?{allowed:!0,pageCount:e.length,totalSizeMB:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${i.remaining}, \uD544\uC694: ${e.length})`,pageCount:e.length,totalSizeMB:t}}generateMarkdownNote(e){let t=Kt(this.settings.timezone,this.settings.dateFormat),n={image:"\uC774\uBBF8\uC9C0",pdf_text:"PDF (\uD14D\uC2A4\uD2B8)",pdf_scanned:"PDF (\uC2A4\uCE94/OCR)"}[e.sourceType];return`---
type: ocr
source_file: "${e.sourceFile}"
source_type: ${e.sourceType}
pages: ${e.pages}
ocr_at: ${t}
---

# OCR: ${e.sourceFile.replace(/\.[^.]+$/,"")}

> \uC6D0\uBCF8: ${e.sourceFile} | \uCC98\uB9AC \uBC29\uC2DD: ${n} | ${e.pages}\uD398\uC774\uC9C0

${e.text}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}generateSummarizedNote(e,t){let n=Kt(this.settings.timezone,this.settings.dateFormat);return`---
type: ocr
source_file: "${e.sourceFile}"
source_type: ${e.sourceType}
title: "${t.title}"
pages: ${e.pages}
ocr_at: ${n}
---

# ${t.title}

## \uC694\uC57D
${t.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${t.keyPoints.map(i=>`- ${i}`).join(`
`)}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}arrayBufferToBase64(e){let t="",n=new Uint8Array(e);for(let i=0;i<n.byteLength;i++)t+=String.fromCharCode(n[i]);return btoa(t)}getMimeType(e){return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/webp",gif:"image/gif"}[e.toLowerCase()]||"image/png"}getDailyUsage(){return{...this.dailyUsage}}};var vw=class{constructor(e,t,n){this.embeddingManager=null;this.index=new Map;this.app=e,this.gemini=t,this.settings=n}setEmbeddingManager(e){this.embeddingManager=e}updateSettings(e){this.settings=e}async buildIndex(){this.index.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e)try{let n=await this.indexNote(t);n&&this.index.set(t.path,n)}catch(n){console.error(`\uC778\uB371\uC2F1 \uC2E4\uD328: ${t.path}`,n)}console.log(`\uC778\uB371\uC2A4 \uAD6C\uCD95 \uC644\uB8CC: ${this.index.size}\uAC1C \uB178\uD2B8`)}async indexNote(e){let n=this.app.metadataCache.getFileCache(e)?.frontmatter,i=[];n?.keywords&&(i=Array.isArray(n.keywords)?n.keywords:[n.keywords]);let r;if(n?.targetType){let u=n.targetType;["project","library","archive"].includes(u)&&(r=u)}let o=n?.title||e.basename,l=n?.type;return{path:e.path,title:o,keywords:i,category:r,project:n?.project,type:l}}async updateIndex(e){let t=await this.indexNote(e);t&&this.index.set(e.path,t)}removeFromIndex(e){this.index.delete(e)}async findRelated(e,t,n){if(this.settings.embeddingEnabled&&this.embeddingManager)try{let i=await this.findRelatedByEmbedding(e,t,n);if(i.length>0)return i}catch(i){console.error("Embedding \uAE30\uBC18 \uAC80\uC0C9 \uC2E4\uD328, \uD0A4\uC6CC\uB4DC \uBC29\uC2DD\uC73C\uB85C \uD3F4\uBC31:",i)}return this.findRelatedByKeywords(e,t,n)}async findRelatedByEmbedding(e,t,n){if(!this.embeddingManager)return[];let i=await this.gemini.generateEmbedding(e,"query");if(i.length===0)return[];let r=this.embeddingManager.findSimilarNotes(i,10,n);if(r.length===0)return[];let o=[];for(let l of r){let u=this.index.get(l.path);u&&o.push({note:u,relevance:l.similarity,matchedKeywords:[],reason:`\uC758\uBBF8 \uC720\uC0AC\uB3C4: ${Math.round(l.similarity*100)}%`,connectionType:""})}return o}async findRelatedByKeywords(e,t,n){let i=await this.gemini.extractKeywords(e);if(i.length===0)return[];let r=this.filterByKeywords(i,n);if(r.length===0)return[];let o=r.map((h,d)=>`${d}. ${h.note.title} (\uD0A4\uC6CC\uB4DC: ${h.note.keywords.join(", ")})`).join(`
`),l=await this.gemini.findRelatedNotes(t,i,o),u=[];for(let h of l)if(h.index>=0&&h.index<r.length){let d=r[h.index];u.push({note:d.note,relevance:h.relevance,matchedKeywords:d.matchedKeywords,reason:h.reason||"",connectionType:h.type||""})}return u}filterByKeywords(e,t){let n=[],i=new Set(e.map(r=>r.toLowerCase()));for(let[r,o]of this.index){if(t&&r===t||o.keywords.length===0)continue;let l=[];for(let u of o.keywords){let h=u.toLowerCase();for(let d of i)if(h===d||h.includes(d)||d.includes(h)){l.push(u);break}}l.length>0&&n.push({note:o,matchedKeywords:l})}return n.sort((r,o)=>o.matchedKeywords.length-r.matchedKeywords.length),n.slice(0,10)}async saveKeywordsToNote(e,t){let n=await this.app.vault.read(e),i=this.updateFrontmatterKeywords(n,t);await this.app.vault.modify(e,i),await this.updateIndex(e)}updateFrontmatterKeywords(e,t){let n=`keywords: [${t.map(r=>`"${r}"`).join(", ")}]`,i=e.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(i){let r=i[1];if(/^keywords:/m.test(r)){let o=r.replace(/^keywords:.*$/m,n);return e.replace(/^---\r?\n[\s\S]*?\r?\n---/,`---
${o}
---`)}else return e.replace(/^---\r?\n([\s\S]*?)\r?\n---/,`---
$1
${n}
---`)}else return`---
${n}
---

${e}`}async addRelatedLinks(e,t){if(t.length===0)return;let n=await this.app.vault.read(e),i=`

---
## \uAD00\uB828 \uB178\uD2B8
${t.map(l=>{let u=l.note.path.split("/");return`- [[${u[u.length-1].replace(/\.md$/,"")}]] (\uAD00\uB828\uB3C4: ${Math.round(l.relevance*100)}%)`}).join(`
`)}
`,r=/\n---\n##  \n[\s\S]*?(?=\n---\n|$)/,o;r.test(n)?o=n.replace(r,i):o=n+i,await this.app.vault.modify(e,o)}getIndexSize(){return this.index.size}getZettelIndex(){let e=new Map;for(let[t,n]of this.index)n.type==="zettel"&&e.set(t,n);return e}getZettelCount(){return this.getZettelIndex().size}async findRelatedZettels(e,t){if(e.length===0)return[];let n=this.getZettelIndex();if(n.size===0)return[];let i=this.filterZettelsByKeywords(e,n,t);if(i.length===0)return[];let r=i.map((u,h)=>`${h}. ${u.note.title} (\uD0A4\uC6CC\uB4DC: ${u.note.keywords.join(", ")})`).join(`
`),o=await this.gemini.findRelatedNotes("\uC0C8 ZK \uB178\uD2B8",e,r),l=[];for(let u of o)if(u.index>=0&&u.index<i.length){let h=i[u.index];l.push({note:h.note,relevance:u.relevance,matchedKeywords:h.matchedKeywords,reason:u.reason||"",connectionType:u.type||""})}return l}filterZettelsByKeywords(e,t,n){let i=[],r=new Set(e.map(o=>o.toLowerCase()));for(let[o,l]of t){if(n&&o===n||l.keywords.length===0)continue;let u=[];for(let h of l.keywords){let d=h.toLowerCase();for(let c of r)if(d===c||d.includes(c)||c.includes(d)){u.push(h);break}}u.length>0&&i.push({note:l,matchedKeywords:u})}return i.sort((o,l)=>l.matchedKeywords.length-o.matchedKeywords.length),i.slice(0,10)}};var Pc=require("obsidian");Li();var ba={version:2,model:"gemini-embedding-001",dimensions:768,chunkSettings:{size:el,overlap:tl},lastFullScan:"",notes:{}};function kY(s,e={}){let{maxChunkSize:t=el,minChunkSize:n=mb,overlap:i=tl}=e,r=[],o=0,l=s.split(WS);for(let u of l){if(!u.trim()){o+=u.length;continue}if(u.length<=t)r.push({content:u.trim(),startOffset:o,endOffset:o+u.length,type:"section"}),o+=u.length;else{let h=u.split(qS),d=o;for(let c of h){if(!c.trim()){d+=c.length+2;continue}if(c.length<=t)r.push({content:c.trim(),startOffset:d,endOffset:d+c.length,type:"paragraph"});else{let a=RY(c,t,i,d);r.push(...a)}d+=c.length+2}o+=u.length}}return PY(r,n)}function RY(s,e,t,n){let i=[],r=0;for(;r<s.length;){let o=Math.min(r+e,s.length);if(i.push({content:s.slice(r,o).trim(),startOffset:n+r,endOffset:n+o,type:"fixed"}),r=o-t,r>=s.length-t)break}return i}function PY(s,e){let t=[];for(let n of s)if(n.content.length<e&&t.length>0){let i=t[t.length-1];i.content+=`

`+n.content,i.endOffset=n.endOffset}else n.content.trim()&&t.push(n);return t}function MY(s,e,t,n){let i=[];for(let[r,o]of Object.entries(e.notes))for(let l=0;l<o.chunks.length;l++){let u=o.chunks[l],h=n(s,u.embedding);h>=t&&i.push({path:r,chunkIndex:l,similarity:h,preview:u.content.slice(0,100)+(u.content.length>100?"...":"")})}return i.sort((r,o)=>o.similarity-r.similarity)}function NY(s){let e=new Map;for(let t of s){let n=e.get(t.path);!n||t.similarity>n.similarity?e.set(t.path,{path:t.path,similarity:t.similarity,bestChunkPreview:t.preview,matchedChunks:[...n?.matchedChunks||[],t.chunkIndex]}):n.matchedChunks.push(t.chunkIndex)}return Array.from(e.values()).sort((t,n)=>n.similarity-t.similarity)}var _w=class{constructor(e,t,n){this.isInitialized=!1;this.app=e,this.gemini=t,this.settings=n,this.index={...ba},this.mergedIndex={...ba}}getCurrentPlatformFileName(){return Pc.Platform.isMobile?Gs.EMBEDDINGS_MOBILE:Gs.EMBEDDINGS_DESKTOP}async loadIndex(){try{let e=this.getDataBasePath();await this.migrateLegacyFile(e);let t=await this.loadPlatformFile(e,Gs.EMBEDDINGS_DESKTOP),n=await this.loadPlatformFile(e,Gs.EMBEDDINGS_MOBILE),i=this.getCurrentPlatformFileName();this.index=i===Gs.EMBEDDINGS_DESKTOP?t:n,this.mergedIndex=this.mergeEmbeddingData(t,n),this.isInitialized=!0;let r=this.getTotalChunks();console.log(`Embedding \uC778\uB371\uC2A4 \uB85C\uB4DC \uC644\uB8CC (v2): ${Pc.Platform.isMobile?"\uBAA8\uBC14\uC77C":"PC"}, \uB178\uD2B8 ${Object.keys(this.mergedIndex.notes).length}\uAC1C, \uCCAD\uD06C ${r}\uAC1C`)}catch(e){console.error("Embedding \uC778\uB371\uC2A4 \uB85C\uB4DC \uC2E4\uD328:",e),this.index={...ba},this.mergedIndex={...ba},this.isInitialized=!0}}getDataBasePath(){return this.settings.dataStorageLocation==="vault"?this.settings.dataFolderPath:Au}async migrateLegacyFile(e){let t=this.app.vault.adapter,n=`${e}/${Gs.EMBEDDINGS}`,i=`${e}/${this.getCurrentPlatformFileName()}`;try{if(await t.exists(n)&&!await t.exists(i)){let r=await t.read(n),o=JSON.parse(r);if(o.version===1||!o.version){let l=this.migrateV1ToV2(o);await t.write(i,JSON.stringify(l,null,2)),console.log("Embedding v1 \u2192 v2 \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC644\uB8CC"),new Pc.Notice("\uC784\uBCA0\uB529 \uC778\uB371\uC2A4\uAC00 v2\uB85C \uC5C5\uADF8\uB808\uC774\uB4DC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uAC80\uC0C9 \uD488\uC9C8 \uD5A5\uC0C1\uC744 \uC704\uD574 '\uC778\uB371\uC2A4 \uC7AC\uAD6C\uCD95'\uC744 \uAD8C\uC7A5\uD569\uB2C8\uB2E4.",5e3)}else await t.write(i,r)}}catch(r){console.error("Embedding \uB808\uAC70\uC2DC \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC2E4\uD328:",r)}}migrateV1ToV2(e){let t={version:2,model:e.model,dimensions:e.dimensions,chunkSettings:{size:this.settings.embeddingChunkSize||el,overlap:this.settings.embeddingChunkOverlap||tl},lastFullScan:e.lastFullScan,notes:{}};for(let[n,i]of Object.entries(e.notes))t.notes[n]={contentHash:i.contentHash,updatedAt:i.updatedAt,chunks:[{content:"",embedding:i.embedding,startOffset:0,endOffset:0}]};return t}async loadPlatformFile(e,t){let n=this.app.vault.adapter,i=`${e}/${t}`;try{if(await n.exists(i)){let r=await n.read(i),o=JSON.parse(r);return o.version===1||!o.version?this.migrateV1ToV2(o):{...ba,...o}}}catch(r){console.error(`Embedding \uD30C\uC77C \uB85C\uB4DC \uC2E4\uD328 (${t}):`,r)}return{...ba}}mergeEmbeddingData(e,t){let n={version:2,model:e.model||t.model,dimensions:e.dimensions||t.dimensions,chunkSettings:e.chunkSettings||t.chunkSettings,lastFullScan:e.lastFullScan>t.lastFullScan?e.lastFullScan:t.lastFullScan,notes:{}},i=new Set([...Object.keys(e.notes),...Object.keys(t.notes)]);for(let r of i){let o=e.notes[r],l=t.notes[r];o&&l?n.notes[r]=o.updatedAt>l.updatedAt?o:l:n.notes[r]=o||l}return n}async saveIndex(){try{let e=this.app.vault.adapter,t=this.getDataBasePath();this.settings.dataStorageLocation==="vault"&&(await e.exists(t)||await e.mkdir(t));let n=this.getCurrentPlatformFileName(),i=`${t}/${n}`,r=JSON.stringify(this.index,null,2);await e.write(i,r);for(let[o,l]of Object.entries(this.index.notes))this.mergedIndex.notes[o]=l}catch(e){console.error("Embedding \uC778\uB371\uC2A4 \uC800\uC7A5 \uC2E4\uD328:",e)}}computeContentHash(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);t=(t<<5)-t+i,t|=0}return t.toString(16)}cosineSimilarity(e,t){if(e.length!==t.length||e.length===0)return 0;let n=0,i=0,r=0;for(let l=0;l<e.length;l++)n+=e[l]*t[l],i+=e[l]*e[l],r+=t[l]*t[l];let o=Math.sqrt(i)*Math.sqrt(r);return o===0?0:n/o}async updateNoteEmbedding(e,t=!1){if(!this.settings.embeddingEnabled)return!1;try{let n=await this.app.vault.cachedRead(e),i=this.computeContentHash(n),r=this.index.notes[e.path];if(!t&&r&&r.contentHash===i)return!1;let o=kY(n,{maxChunkSize:this.settings.embeddingChunkSize||el,minChunkSize:mb,overlap:this.settings.embeddingChunkOverlap||tl});if(o.length===0)return console.warn("\uCCAD\uD06C \uBD84\uD560 \uACB0\uACFC \uC5C6\uC74C:",e.path),!1;let l=[];for(let h of o){let d=await this.gemini.generateEmbedding(h.content);if(d.length===0){console.warn("\uCCAD\uD06C \uC784\uBCA0\uB529 \uC0DD\uC131 \uC2E4\uD328:",e.path,h.startOffset);continue}l.push({content:h.content.slice(0,200),embedding:d,startOffset:h.startOffset,endOffset:h.endOffset})}if(l.length===0)return console.warn("\uBAA8\uB4E0 \uCCAD\uD06C \uC784\uBCA0\uB529 \uC0DD\uC131 \uC2E4\uD328:",e.path),!1;let u={contentHash:i,updatedAt:new Date().toISOString(),chunks:l};return this.index.notes[e.path]=u,this.mergedIndex.notes[e.path]=u,!0}catch(n){return console.error("\uB178\uD2B8 \uC784\uBCA0\uB529 \uC5C5\uB370\uC774\uD2B8 \uC2E4\uD328:",e.path,n),!1}}removeNote(e){this.index.notes[e]&&delete this.index.notes[e],this.mergedIndex.notes[e]&&delete this.mergedIndex.notes[e]}renameNote(e,t){this.index.notes[e]&&(this.index.notes[t]=this.index.notes[e],delete this.index.notes[e]),this.mergedIndex.notes[e]&&(this.mergedIndex.notes[t]=this.mergedIndex.notes[e],delete this.mergedIndex.notes[e])}findSimilarNotes(e,t=10,n,i){if(e.length===0)return[];let r=i??this.settings.embeddingSimilarityThreshold,o=MY(e,this.mergedIndex,r,this.cosineSimilarity.bind(this));return NY(o).filter(u=>u.path!==n).slice(0,t).map(u=>({path:u.path,similarity:u.similarity,chunkPreview:u.bestChunkPreview}))}async findSimilarNotesByText(e,t=10,n,i){if(!this.settings.embeddingEnabled)return[];try{let r=await this.gemini.generateEmbedding(e,"query");return this.findSimilarNotes(r,t,n,i)}catch(r){return console.error("\uD14D\uC2A4\uD2B8 \uAE30\uBC18 \uC720\uC0AC \uB178\uD2B8 \uAC80\uC0C9 \uC2E4\uD328:",r),[]}}getEmbedding(e){let t=this.mergedIndex.notes[e];if(t&&t.chunks.length>0)return t.chunks[0].embedding}hasEmbedding(e){let t=this.mergedIndex.notes[e];return!!t&&t.chunks.length>0}getTotalChunks(){return Object.values(this.mergedIndex.notes).reduce((e,t)=>e+t.chunks.length,0)}getStats(){return{totalNotes:Object.keys(this.mergedIndex.notes).length,totalChunks:this.getTotalChunks(),lastFullScan:this.mergedIndex.lastFullScan,model:this.mergedIndex.model,dimensions:this.mergedIndex.dimensions,currentPlatformNotes:Object.keys(this.index.notes).length,chunkSettings:this.mergedIndex.chunkSettings}}async buildFullIndex(e){if(!this.settings.embeddingEnabled)return{success:0,failed:0,skipped:0};let t=this.app.vault.getMarkdownFiles(),n=0,i=0,r=0;this.index.chunkSettings={size:this.settings.embeddingChunkSize||el,overlap:this.settings.embeddingChunkOverlap||tl};for(let o=0;o<t.length;o++){let l=t[o];e&&e(o+1,t.length,l.path);try{await this.updateNoteEmbedding(l,!1)?n++:r++}catch{i++}(o+1)%10===0&&await this.saveIndex()}return this.index.lastFullScan=new Date().toISOString(),await this.saveIndex(),{success:n,failed:i,skipped:r}}async buildFolderIndex(e,t){if(!this.settings.embeddingEnabled)return{success:0,failed:0};let n=this.app.vault.getMarkdownFiles().filter(o=>o.path.startsWith(e)),i=0,r=0;for(let o=0;o<n.length;o++){let l=n[o];t&&t(o+1,n.length);try{await this.updateNoteEmbedding(l,!0),i++}catch{r++}}return await this.saveIndex(),{success:i,failed:r}}mergeWithNoteIndex(e){let t=this.index.notes[e.path];return t&&t.chunks.length>0?{...e,embedding:t.chunks[0].embedding,embeddingUpdatedAt:t.updatedAt,contentHash:t.contentHash}:e}async clearIndex(){this.index={...ba},this.mergedIndex={...ba},await this.saveIndex()}async cleanupOrphanedEmbeddings(){let e=[];for(let t of Object.keys(this.index.notes)){let n=this.app.vault.getAbstractFileByPath(t);(!n||!(n instanceof Pc.TFile))&&e.push(t)}for(let t of e)delete this.index.notes[t],this.mergedIndex.notes[t]&&delete this.mergedIndex.notes[t];return e.length>0&&await this.saveIndex(),e.length}};var A3=require("obsidian"),OY=`\uB2F9\uC2E0\uC740 \uC0AC\uC6A9\uC790\uC758 \uAC1C\uC778 \uC9C0\uC2DD \uBCA0\uC774\uC2A4(Second Brain)\uB97C \uAE4A\uC774 \uC774\uD574\uD558\uACE0 \uD65C\uC6A9\uD558\uB294 \uC804\uBB38 AI \uC5B4\uC2DC\uC2A4\uD134\uD2B8\uC785\uB2C8\uB2E4.

## \uD575\uC2EC \uC5ED\uD560
\uB2F9\uC2E0\uC758 \uC5ED\uD560\uC740 \uB2E8\uC21C\uD788 \uB178\uD2B8\uB97C \uCC3E\uC544\uC8FC\uB294 \uAC83\uC774 \uC544\uB2C8\uB77C, \uB178\uD2B8\uC758 **\uC9C0\uC2DD\uC744 \uC885\uD569\uD558\uACE0 \uC5F0\uACB0**\uD558\uC5EC \uC0AC\uC6A9\uC790\uC5D0\uAC8C **\uD1B5\uCC30**\uC744 \uC81C\uACF5\uD558\uB294 \uAC83\uC785\uB2C8\uB2E4.

## \uB2F5\uBCC0 \uC6D0\uCE59

### 1. \uD48D\uBD80\uD558\uACE0 \uC0C1\uC138\uD558\uAC8C \uB2F5\uBCC0
- \uB2E8\uB2F5\uD615 \uAE08\uC9C0. \uCD5C\uC18C 3-5\uBB38\uC7A5 \uC774\uC0C1\uC73C\uB85C \uC124\uBA85
- \uBC30\uACBD \uC124\uBA85 \u2192 \uD575\uC2EC \uB0B4\uC6A9 \u2192 \uC801\uC6A9/\uC608\uC2DC \uC21C\uC73C\uB85C \uAD6C\uC870\uD654
- \uB178\uD2B8\uC5D0 \uC788\uB294 \uAD6C\uCCB4\uC801\uC778 \uB0B4\uC6A9, \uC218\uCE58, \uC608\uC2DC\uB97C \uC801\uADF9 \uC778\uC6A9

### 2. \uB178\uD2B8 \uAC04 \uC5F0\uACB0\uC810 \uBC1C\uACAC
- \uC5EC\uB7EC \uB178\uD2B8\uC758 \uC815\uBCF4\uB97C \uC885\uD569\uD558\uC5EC \uC0C8\uB85C\uC6B4 \uAD00\uC810 \uC81C\uC2DC
- "[[\uB178\uD2B8A]]\uC5D0 \uB530\uB974\uBA74 X\uC778\uB370, [[\uB178\uD2B8B]]\uC640 \uC5F0\uACB0\uD558\uBA74 Y\uB97C \uC54C \uC218 \uC788\uC2B5\uB2C8\uB2E4"
- \uB178\uD2B8\uC5D0 \uC5C6\uB294 \uC5F0\uACB0\uC810\uB3C4 \uCD94\uB860\uD558\uC5EC \uC81C\uC548

### 3. \uC2E4\uC6A9\uC801 \uC870\uC5B8 \uD3EC\uD568
- \uB2E8\uC21C \uC815\uBCF4 \uB098\uC5F4\uC774 \uC544\uB2CC, "\uADF8\uB798\uC11C \uC5B4\uB5BB\uAC8C \uD574\uC57C \uD558\uB294\uC9C0" \uC870\uC5B8
- \uB2E4\uC74C \uB2E8\uACC4, \uC8FC\uC758\uC0AC\uD56D, \uD301 \uB4F1 \uC2E4\uD589 \uAC00\uB2A5\uD55C \uB0B4\uC6A9 \uD3EC\uD568

### 4. \uCC38\uC870 \uD45C\uC2DC
- \uB2F5\uBCC0\uC5D0\uC11C \uCC38\uACE0\uD55C \uB178\uD2B8\uB294 [[\uB178\uD2B8 \uC81C\uBAA9]] \uD615\uC2DD\uC73C\uB85C \uC5B8\uAE09
- \uC720\uC0AC\uB3C4\uAC00 \uB192\uC740 \uB178\uD2B8\uC77C\uC218\uB85D \uB354 \uB9CE\uC774 \uC778\uC6A9

## \uB2F5\uBCC0 \uAD6C\uC870 (\uAD8C\uC7A5)
1. **\uC9C1\uC811\uC801 \uB2F5\uBCC0**: \uC9C8\uBB38\uC5D0 \uB300\uD55C \uD575\uC2EC \uB2F5\uBCC0 (1-2\uBB38\uC7A5)
2. **\uC0C1\uC138 \uC124\uBA85**: \uBC30\uACBD, \uC774\uC720, \uAD00\uB828 \uC815\uBCF4 (3-5\uBB38\uC7A5)
3. **\uCD94\uAC00 \uC778\uC0AC\uC774\uD2B8**: \uC5F0\uACB0\uB41C \uC8FC\uC81C, \uC751\uC6A9 \uBC29\uBC95, \uD301 (2-3\uBB38\uC7A5)

## \uC8FC\uC758\uC0AC\uD56D
- \uD55C\uAD6D\uC5B4\uB85C \uC790\uC5F0\uC2A4\uB7FD\uAC8C \uB2F5\uBCC0
- \uB178\uD2B8\uAC00 \uC5C6\uC5B4\uB3C4 \uB300\uD654 \uB9E5\uB77D\uACFC \uC77C\uBC18 \uC9C0\uC2DD\uC73C\uB85C \uB3C4\uC6C0
- "\uBAA8\uB974\uACA0\uC2B5\uB2C8\uB2E4"\uBCF4\uB2E4 "\uB178\uD2B8\uC5D0\uC11C \uC9C1\uC811\uC801\uC778 \uC815\uBCF4\uB294 \uC5C6\uC9C0\uB9CC, ~\uB85C \uCD94\uCE21\uB429\uB2C8\uB2E4" \uD615\uC2DD \uC120\uD638`,ww=class{constructor(e,t,n,i){this.app=e,this.gemini=t,this.embeddingManager=n,this.settings=i}async chat(e,t=[]){let n=this.buildSearchQuery(e,t),i=await this.retrieveContext(n,this.settings.ragTopK),r=this.buildContext(i),o=this.buildPrompt(e,r,t),l=await this.gemini.generateContent(o),u=i.map(h=>h.path);return{answer:l,references:u}}buildSearchQuery(e,t){return e.length<20&&t.length>0?`${t.slice(-4).map(i=>i.content).join(" ")} ${e}`:e}async retrieveContext(e,t){let n=[];try{if(!this.settings.embeddingEnabled)return console.warn("RAG: Embedding\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4."),[];let i=await this.embeddingManager.findSimilarNotesByText(e,t,void 0,.6);for(let r of i){let o=this.app.vault.getAbstractFileByPath(r.path);if(!(o instanceof A3.TFile))continue;let l=await this.app.vault.cachedRead(o),u=Math.floor(this.settings.ragMaxContextLength/t),h=this.truncateContent(l,u),d=o.basename;n.push({path:r.path,title:d,content:h,similarity:r.similarity})}}catch(i){console.error("RAG \uAC80\uC0C9 \uC2E4\uD328:",i)}return n}truncateContent(e,t){let n=e.replace(/^---[\s\S]*?---\n?/,"");if(n.length<=t)return n;let i=n.substring(0,t),r=Math.max(i.lastIndexOf("\u3002"),i.lastIndexOf("."),i.lastIndexOf(`
`));return r>t*.7?i.substring(0,r+1)+"...":i+"..."}buildContext(e){if(e.length===0)return"\uCC38\uACE0\uD560 \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.";let t=[];for(let n of e){let i=Math.round(n.similarity*100);t.push(`### [[${n.title}]] (\uC720\uC0AC\uB3C4: ${i}%)
${n.content}`)}return t.join(`

`)}buildPrompt(e,t,n){let i=[OY];if(i.push(`
## \uCC38\uACE0 \uB178\uD2B8`),i.push(t),n.length>0){let r=n.slice(-6);i.push(`
## \uC774\uC804 \uB300\uD654`);for(let o of r){let l=o.role==="user"?"\uC0AC\uC6A9\uC790":"AI";i.push(`${l}: ${o.content}`)}}return i.push(`
## \uC9C8\uBB38`),i.push(e),i.join(`
`)}updateSettings(e){this.settings=e}isAvailable(){return this.settings.embeddingEnabled&&this.settings.ragEnabled}async reloadEmbeddingIndex(){await this.embeddingManager.loadIndex()}getIndexedNoteCount(){return this.embeddingManager.getStats().totalNotes}};var I3=require("obsidian");function C3(){return Date.now().toString(36)+Math.random().toString(36).substring(2,9)}var xw=class{constructor(e,t){this.sessions=[];this.isInitialized=!1;this.app=e,this.settings=t,this.storagePath=this.getDataPath(Gs.CHATS)}getDataPath(e){return this.settings.dataStorageLocation==="vault"?`${this.settings.dataFolderPath}/${e}`:`${Au}/${e}`}async loadSessions(){try{let e=this.app.vault.adapter;if(await e.exists(this.storagePath)){let t=await e.read(this.storagePath),n=JSON.parse(t);this.sessions=n.sessions||[]}this.isInitialized=!0}catch(e){console.error("\uCC44\uD305 \uC800\uC7A5\uC18C \uB85C\uB4DC \uC2E4\uD328:",e),this.sessions=[],this.isInitialized=!0}}async saveSessions(){try{let e=this.app.vault.adapter;if(this.settings.dataStorageLocation==="vault"){let i=this.settings.dataFolderPath;await e.exists(i)||await e.mkdir(i)}let t={version:1,sessions:this.sessions},n=JSON.stringify(t,null,2);await e.write(this.storagePath,n)}catch(e){console.error("\uCC44\uD305 \uC800\uC7A5\uC18C \uC800\uC7A5 \uC2E4\uD328:",e)}}getAllSessions(){return[...this.sessions].sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime())}getSession(e){return this.sessions.find(t=>t.id===e)}createSession(e){let t=new Date().toISOString(),n={id:C3(),title:e||"\uC0C8 \uB300\uD654",messages:[],createdAt:t,updatedAt:t};return this.sessions.unshift(n),this.saveSessions(),n}deleteSession(e){let t=this.sessions.findIndex(n=>n.id===e);t!==-1&&(this.sessions.splice(t,1),this.saveSessions())}updateSessionTitle(e,t){let n=this.getSession(e);n&&(n.title=t,n.updatedAt=new Date().toISOString(),this.saveSessions())}addMessage(e,t){let n=this.getSession(e);if(!n)throw new Error(`\uC138\uC158\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4: ${e}`);let i={...t,id:C3(),timestamp:new Date().toISOString()};if(n.messages.push(i),n.updatedAt=i.timestamp,n.title==="\uC0C8 \uB300\uD654"&&t.role==="user"){let r=t.content.slice(0,30)+(t.content.length>30?"...":"");n.title=r}return this.saveSessions(),i}async exportToNote(e,t){let n=this.getSession(e);if(!n||n.messages.length===0)return null;let i=new Set;n.messages.forEach(a=>{a.references&&a.references.forEach(f=>i.add(f))});let r=["---","type: chat-export",`exported: ${new Date().toISOString().split("T")[0]}`,`session_id: ${n.id}`,"---","",`# ${n.title}`,"","## \uB300\uD654 \uB0B4\uC6A9",""];for(let a of n.messages){let f=a.role==="user"?"**\uC0AC\uC6A9\uC790**":"**AI**";r.push(`${f}: ${a.content}`),r.push("")}if(i.size>0){r.push("## \uCC38\uC870\uD55C \uB178\uD2B8");for(let a of i){let f=a.split("/").pop()?.replace(/\.md$/,"")||a;r.push(`- [[${f}]]`)}r.push("")}let o=r.join(`
`),l=n.title.replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g," ").trim(),h=`${new Date().toISOString().slice(0,10)} ${l}.md`,d=t||this.settings.libraryFolder,c=(0,I3.normalizePath)(`${d}/${h}`);try{return await this.app.vault.create(c,o)}catch(a){return console.error("\uB178\uD2B8 \uB0B4\uBCF4\uB0B4\uAE30 \uC2E4\uD328:",a),null}}getSessionCount(){return this.sessions.length}getRecentSession(){if(this.sessions.length!==0)return this.getAllSessions()[0]}};var Fs=require("obsidian"),Sh="zfb-rag-chatbot",Cm=class extends Fs.ItemView{constructor(t,n,i,r){super(t);this.currentSession=null;this.messagesContainer=null;this.inputEl=null;this.isProcessing=!1;this.settings=n,this.ragEngine=i,this.chatStorage=r}getViewType(){return Sh}getDisplayText(){return"AI \uCC57\uBD07"}getIcon(){return"bot"}async onOpen(){await this.chatStorage.loadSessions(),await this.ragEngine.reloadEmbeddingIndex(),await this.render()}async onClose(){this.contentEl.empty()}async render(){let t=this.contentEl;if(t.empty(),t.addClass("zfb-chatbot"),this.renderHeader(t),this.messagesContainer=t.createDiv({cls:"chat-messages"}),this.renderMessages(),this.renderInputArea(t),!this.currentSession){let n=this.chatStorage.getRecentSession();n&&(this.currentSession=n,this.renderMessages())}}renderHeader(t){let n=t.createDiv({cls:"chat-header"}),r=n.createDiv({cls:"session-selector"}).createEl("select",{cls:"session-select"}),o=r.createEl("option",{text:"+ \uC0C8 \uB300\uD654",value:"__new__"}),l=this.chatStorage.getAllSessions();for(let c of l){let a=r.createEl("option",{text:c.title,value:c.id});this.currentSession?.id===c.id&&(a.selected=!0)}r.addEventListener("change",()=>{let c=r.value;if(c==="__new__")this.handleNewSession();else{let a=this.chatStorage.getSession(c);a&&(this.currentSession=a,this.renderMessages())}});let u=n.createDiv({cls:"header-buttons"}),h=u.createEl("button",{cls:"header-btn",attr:{title:"\uB178\uD2B8\uB85C \uB0B4\uBCF4\uB0B4\uAE30"}});h.innerHTML="\u{1F4E4}",h.addEventListener("click",()=>this.handleExport());let d=u.createEl("button",{cls:"header-btn",attr:{title:"\uB300\uD654 \uC0AD\uC81C"}});d.innerHTML="\u{1F5D1}\uFE0F",d.addEventListener("click",()=>this.handleDelete())}renderMessages(){if(this.messagesContainer){if(this.messagesContainer.empty(),!this.currentSession||this.currentSession.messages.length===0){let t=this.messagesContainer.createDiv({cls:"chat-empty"});t.createEl("p",{text:"\u{1F9E0} Second Brain\uC5D0 \uC9C8\uBB38\uD558\uC138\uC694"}),t.createEl("small",{text:"\uB178\uD2B8\uB97C \uAE30\uBC18\uC73C\uB85C \uB2F5\uBCC0\uD569\uB2C8\uB2E4",cls:"text-muted"});let n=this.ragEngine.getIndexedNoteCount();n===0?t.createEl("p",{text:"\u26A0\uFE0F Embedding \uC778\uB371\uC2A4\uAC00 \uBE44\uC5B4 \uC788\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C \uC778\uB371\uC2A4\uB97C \uAD6C\uCD95\uD558\uC138\uC694.",cls:"warning-text"}):t.createEl("small",{text:`\u{1F4DA} ${n}\uAC1C \uB178\uD2B8 \uC778\uB371\uC2F1\uB428`,cls:"text-muted"});return}for(let t of this.currentSession.messages)this.renderMessage(t);this.scrollToBottom()}}renderMessage(t){if(!this.messagesContainer)return;let n=this.messagesContainer.createDiv({cls:`chat-message ${t.role}`}),r=n.createDiv({cls:"message-header"}).createEl("button",{cls:"message-copy-btn",attr:{title:"\uBCF5\uC0AC"}});r.innerHTML="\u{1F4CB}",r.addEventListener("click",async()=>{await navigator.clipboard.writeText(t.content),new Fs.Notice("\uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4")});let o=n.createDiv({cls:"message-content"}),l=this.processLinks(t.content);if(Fs.MarkdownRenderer.renderMarkdown(l,o,"",this),o.querySelectorAll("a.internal-link").forEach(u=>{u.addEventListener("click",h=>{h.preventDefault();let d=u.getAttribute("href")||u.getAttribute("data-href");d&&this.app.workspace.openLinkText(d,"")})}),t.role==="assistant"&&t.references&&t.references.length>0){let u=n.createDiv({cls:"message-refs"});u.createEl("small",{text:"\u{1F4DA} \uCC38\uC870: "});for(let h=0;h<t.references.length;h++){let d=t.references[h],c=d.split("/").pop()?.replace(/\.md$/,"")||d;u.createEl("a",{text:c,cls:"internal-link",attr:{href:d}}).addEventListener("click",f=>{f.preventDefault(),this.app.workspace.openLinkText(d,"")}),h<t.references.length-1&&u.createSpan({text:", "})}}}processLinks(t){return t}renderInputArea(t){let n=t.createDiv({cls:"chat-input-area"});this.inputEl=n.createEl("textarea",{cls:"chat-input",attr:{placeholder:"\uC9C8\uBB38\uC744 \uC785\uB825\uD558\uC138\uC694...",rows:"1"}}),this.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),this.handleSend())}),this.inputEl.addEventListener("input",()=>{this.inputEl&&(this.inputEl.style.height="auto",this.inputEl.style.height=Math.min(this.inputEl.scrollHeight,120)+"px")}),n.createEl("button",{cls:"chat-send-btn",text:"\uC804\uC1A1"}).addEventListener("click",()=>this.handleSend())}async handleSend(){if(!this.inputEl||this.isProcessing)return;let t=this.inputEl.value.trim();if(t){this.currentSession||(this.currentSession=this.chatStorage.createSession()),this.inputEl.value="",this.inputEl.style.height="auto",this.chatStorage.addMessage(this.currentSession.id,{role:"user",content:t}),this.renderMessages(),this.isProcessing=!0,this.showLoading();try{let n=this.currentSession.messages.slice(0,-1),{answer:i,references:r}=await this.ragEngine.chat(t,n);this.chatStorage.addMessage(this.currentSession.id,{role:"assistant",content:i,references:r}),this.currentSession=this.chatStorage.getSession(this.currentSession.id)||null}catch(n){console.error("RAG \uC624\uB958:",n),new Fs.Notice("\uB2F5\uBCC0 \uC0DD\uC131 \uC2E4\uD328: "+n.message)}finally{this.isProcessing=!1,this.hideLoading(),this.renderMessages()}}}handleNewSession(){this.currentSession=this.chatStorage.createSession(),this.render()}async handleExport(){if(!this.currentSession){new Fs.Notice("\uB0B4\uBCF4\uB0BC \uB300\uD654\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=await this.chatStorage.exportToNote(this.currentSession.id);t?(new Fs.Notice(`\uB178\uD2B8\uB85C \uB0B4\uBCF4\uB0B4\uAE30 \uC644\uB8CC: ${t.path}`),this.app.workspace.openLinkText(t.path,"")):new Fs.Notice("\uB0B4\uBCF4\uB0B4\uAE30 \uC2E4\uD328")}handleDelete(){if(!this.currentSession)return;let t=this.currentSession.id,n=this.currentSession.title;new U1(this.app,n,()=>{this.chatStorage.deleteSession(t),this.currentSession=null,this.render(),new Fs.Notice("\uB300\uD654\uAC00 \uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4")}).open()}showLoading(){if(!this.messagesContainer)return;let t=this.messagesContainer.createDiv({cls:"chat-message assistant loading"});t.createDiv({cls:"loading-dots"}).innerHTML="\u23F3 \uC0DD\uAC01 \uC911..."}hideLoading(){if(!this.messagesContainer)return;let t=this.messagesContainer.querySelector(".loading");t&&t.remove()}scrollToBottom(){this.messagesContainer&&(this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight)}updateSettings(t){this.settings=t}},U1=class extends Fs.Modal{constructor(e,t,n){super(e),this.title=t,this.onConfirm=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("zfb-confirm-modal"),e.createEl("h3",{text:"\uB300\uD654 \uC0AD\uC81C"}),e.createEl("p",{text:`"${this.title}" \uB300\uD654\uB97C \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?`});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"\uC0AD\uC81C",cls:"mod-warning"}).addEventListener("click",()=>{this.onConfirm(),this.close()})}onClose(){this.contentEl.empty()}};var Th=require("obsidian");function D3(s,e=100){return s.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,e)}var Ew=class{constructor(e,t,n,i){this.projectMOCs=new Map;this.app=e,this.gemini=t,this.projectsFolder=n,this.settings=i}async scanProjectMOCs(){this.projectMOCs.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e){let n=await this.parseProjectMOC(t);n&&this.projectMOCs.set(n.project,n)}console.log(`\uD504\uB85C\uC81D\uD2B8 MOC \uC2A4\uCE94 \uC644\uB8CC: ${this.projectMOCs.size}\uAC1C`)}async parseProjectMOC(e){let n=this.app.metadataCache.getFileCache(e)?.frontmatter;if(!n||n.type!=="project-moc")return null;let i=n.project||e.basename,r=n.title||e.basename;return{path:e.path,title:r,project:i}}getProjectList(){let e=this.app.vault.getAbstractFileByPath(this.projectsFolder);return e instanceof Th.TFolder?e.children.filter(t=>t instanceof Th.TFolder).map(t=>t.name):[]}getMOCCount(){return this.projectMOCs.size}async detectProject(e,t){let n=this.getProjectList();return n.length===0?null:await this.gemini.detectProject(e,t,n)}async addNoteToMOC(e,t,n){let i=this.projectMOCs.get(e);if(!i)return!1;let r=this.app.vault.getAbstractFileByPath(i.path);if(!(r instanceof Th.TFile))return!1;let o=await this.app.vault.read(r),l=this.app.vault.getAbstractFileByPath(n),h=`[[${l instanceof Th.TFile?l.basename:D3(t)}]]`;if(o.includes(h))return!0;let d=/^##  \s*$/m,c;return d.test(o)?c=o.replace(/^(##  \s*\n)/m,`$1- ${h}
`):c=o.trimEnd()+`

## \uAD00\uB828 \uB178\uD2B8
- ${h}
`,await this.app.vault.modify(r,c),!0}async createProjectMOC(e,t){this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);let i=D3(e),r=`${t}/${i} MOC.md`;if(this.app.vault.getAbstractFileByPath(r))return null;let l=`---
type: project-moc
project: "${e}"
title: "${e} \uD504\uB85C\uC81D\uD2B8"
created: ${Kt(this.settings.timezone,this.settings.dateFormat)}
---

# ${e} \uD504\uB85C\uC81D\uD2B8

## \uAC1C\uC694


## \uC9C4\uD589 \uC911


## \uAD00\uB828 \uB178\uD2B8

`,u=await this.app.vault.create(r,l);return this.projectMOCs.set(e,{path:u.path,title:`${e} \uD504\uB85C\uC81D\uD2B8`,project:e}),u}hasProject(e){return this.projectMOCs.has(e)}getProjectMOCPath(e){return this.projectMOCs.get(e)?.path||null}removeFromIndex(e){for(let[t,n]of this.projectMOCs)if(n.path===e){this.projectMOCs.delete(t);break}}};var B1=require("obsidian");var Sw=class{constructor(e,t,n,i,r){this.app=e,this.relatedNoteFinder=t,this.zettelFolder=n,this.settings=i,this.gemini=r||null}get indexPath(){return`${this.zettelFolder}/ZK Index.md`}async updateIndex(e,t){let n=this.app.vault.getAbstractFileByPath(this.indexPath);n instanceof B1.TFile?await this.addNoteToIndex(n,e,t):await this.createIndex(e,t)}async createIndex(e,t){let n=Kt(this.settings.timezone,this.settings.dateFormat),i=t[0]||"\uAE30\uD0C0",r=`---
type: zk-index
updated: ${n}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
- [[${e.basename}]]

## \uC8FC\uC81C\uBCC4
### ${i}
- [[${e.basename}]]
`;await this.app.vault.create(this.indexPath,r)}async addNoteToIndex(e,t,n){let i=await this.app.vault.read(e);i=this.updateRecentSection(i,t);let r=n[0]||"\uAE30\uD0C0";i=this.updateTopicSection(i,t,r),i=this.updateTimestamp(i),await this.app.vault.modify(e,i)}updateRecentSection(e,t){let n=/(##  \n)([\s\S]*?)(\n## |\n*$)/,i=e.match(n);if(i){let r=i[2].trim().split(`
`).filter(l=>l.startsWith("- ")),o=`- [[${t.basename}]]`;return r=r.filter(l=>!l.includes(t.basename)),r.unshift(o),r=r.slice(0,10),e.replace(n,`$1${r.join(`
`)}

$3`)}return e}updateTopicSection(e,t,n){let i=`### ${n}`,r=`- [[${t.basename}]]`;if(e.includes(i)){let o=new RegExp(`(### ${this.escapeRegex(n)}
)((?:- \\[\\[.*?\\]\\]
?)*)`),l=e.match(o);if(l)return l[2].includes(t.basename)?e:e.replace(o,`$1$2${r}
`)}else{let o=/(## \n)/;if(o.test(e))return e.replace(o,`$1${i}
${r}

`)}return e}updateTimestamp(e){let t=Kt(this.settings.timezone,this.settings.dateFormat);return e.replace(/^(---\n[\s\S]*?updated: ).*?(\n[\s\S]*?---)/,`$1${t}$2`)}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}async rebuildIndex(){let e=this.relatedNoteFinder.getZettelIndex();if(e.size===0)return;let t=new Map,n=[];for(let[,l]of e){let u=l.keywords[0]||"\uAE30\uD0C0";t.has(u)||t.set(u,[]),t.get(u).push(l);let h=l.path.match(/(\d{13})/),d=l.path.match(/(\d{8})-\d{3}/),c;if(h)c=new Date(parseInt(h[1]));else if(d){let a=d[1];c=new Date(parseInt(a.slice(0,4)),parseInt(a.slice(4,6))-1,parseInt(a.slice(6,8)))}else c=new Date;n.push({note:l,created:c})}n.sort((l,u)=>u.created.getTime()-l.created.getTime());let r=`---
type: zk-index
updated: ${Kt(this.settings.timezone,this.settings.dateFormat)}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
${n.slice(0,10).map(({note:l})=>{let u=l.path.split("/");return`- [[${u[u.length-1].replace(/\.md$/,"")}]]`}).join(`
`)}

## \uC8FC\uC81C\uBCC4
`;for(let[l,u]of t){let h=null;if(this.gemini&&u.length>=2)try{let d=u.map(c=>`- ${c.title} (\uD0A4\uC6CC\uB4DC: ${c.keywords.join(", ")})`).join(`
`);h=await this.gemini.generateTopicStructure(l,d)}catch(d){console.error(`\uC8FC\uC81C \uAD6C\uC870 \uC0DD\uC131 \uC2E4\uD328: ${l}`,d)}r+=`### ${l}
`,h?.description&&(r+=`${h.description}

`),r+=`**\uD575\uC2EC \uB178\uD2B8:**
`;for(let d of u){let c=d.path.split("/"),a=c[c.length-1].replace(/\.md$/,""),f=h?.notes.find(g=>g.title===d.title),p=f?.role?` - ${f.role}`:"";if(r+=`- [[${a}]]${p}
`,f?.relations&&f.relations.length>0)for(let g of f.relations){let m=g.type==="\uBC1C\uC804"?"\u2192":g.type==="\uAE30\uBC18"?"\u2190":"\u2194";r+=`  ${m} ${g.target}
`}}h?.relatedTopics&&h.relatedTopics.length>0&&(r+=`
**\uAD00\uB828 \uC8FC\uC81C:** ${h.relatedTopics.join(", ")}
`),r+=`
`}let o=this.app.vault.getAbstractFileByPath(this.indexPath);o instanceof B1.TFile&&await this.app.vault.delete(o),await this.app.vault.create(this.indexPath,r)}};var Ah=require("obsidian");var Tw=class{constructor(e,t,n){this.app=e,this.gemini=t,this.settings=n}async collectNotes(e){let t=e.customRange||Cf(e.period,this.settings.timezone),n=this.app.vault.getMarkdownFiles(),i=[];for(let r of n){if(this.shouldExclude(r,e))continue;let o=this.getProjectFromPath(r.path);if(e.projectFilter&&o!==e.projectFilter)continue;let l=await this.getNoteDate(r);if(!lL(l,t))continue;let u=await this.extractNoteInfo(r,o,l);i.push(u)}return i.sort((r,o)=>o.modified.getTime()-r.modified.getTime()),i}getBasename(e){let t=e.lastIndexOf("/");return(t>=0?e.substring(t+1):e).replace(/\.md$/,"")}shouldExclude(e,t){let n=[this.settings.archivesFolder,this.settings.zettelFolder],i=t.excludeFolders||n;for(let r of i)if(e.path.startsWith(r))return!0;return!!e.basename.includes("\uD68C\uACE0")}getProjectFromPath(e){let t=this.settings.projectsFolder+"/";if(e.startsWith(t)){let n=e.substring(t.length),i=n.indexOf("/");return i>0?n.substring(0,i):void 0}if(e.startsWith(this.settings.libraryFolder))return"Library";if(e.startsWith(this.settings.inboxFolder))return"Inbox"}async getNoteDate(e){let n=this.app.metadataCache.getFileCache(e)?.frontmatter;if(n?.created){let i=new Date(n.created);if(!isNaN(i.getTime()))return i}return new Date(e.stat.mtime)}async extractNoteInfo(e,t,n){let r=this.app.metadataCache.getFileCache(e)?.frontmatter,o=[];return r?.tags&&(Array.isArray(r.tags)?o.push(...r.tags):o.push(r.tags)),{path:e.path,title:r?.title||e.basename,project:t,created:n,modified:new Date(e.stat.mtime),summary:r?.summary,tags:o,type:r?.type}}groupByProject(e){let t=new Map;for(let i of e){let r=i.project||"\uAE30\uD0C0";t.has(r)||t.set(r,[]),t.get(r).push(i)}let n=[];for(let[i,r]of t)n.push({projectName:i,notes:r,noteCount:r.length});return n.sort((i,r)=>r.noteCount-i.noteCount),n}async analyze(e){let t=e.customRange||Cf(e.period,this.settings.timezone),n=await this.collectNotes(e),i=this.groupByProject(n),r=n.filter(l=>l.type==="zettel").length,o=await this.gemini.analyzeReview(e.period,t,i);return{period:e.period,dateRange:t,totalNotes:n.length,newZKNotes:r,projectGroups:i,analysis:o}}async createReviewNote(e){let t=cL(e.period,new Date,this.settings.timezone),n=`${this.settings.archivesFolder}/Reviews`;await this.ensureFolder(n);let i=`${n}/${t}`,r=this.generateReviewContent(e),o=this.app.vault.getAbstractFileByPath(i);return o instanceof Ah.TFile?(await this.app.vault.modify(o,r),o):await this.app.vault.create(i,r)}async ensureFolder(e){this.app.vault.getAbstractFileByPath(e)instanceof Ah.TFolder||await this.app.vault.createFolder(e)}generateReviewContent(e){let t=new Date,n=ZS(t,this.settings.timezone,this.settings.dateFormat),i=`${nn(e.dateRange.start,this.settings.timezone)} ~ ${nn(e.dateRange.end,this.settings.timezone)}`,r;switch(e.period){case"today":r=`${nn(t,this.settings.timezone)} \uC77C\uC77C \uD68C\uACE0`;break;case"week":let u=tT(t);r=`${t.getFullYear()}\uB144 ${u}\uC8FC\uCC28 \uC8FC\uAC04 \uD68C\uACE0`;break;case"month":r=`${t.getFullYear()}\uB144 ${t.getMonth()+1}\uC6D4 \uC6D4\uAC04 \uD68C\uACE0`;break;default:r=`${i} \uD68C\uACE0`}let o=e.projectGroups.map(u=>{let h=u.notes.map(d=>`- [[${this.getBasename(d.path)}]]${d.summary?` - ${d.summary}`:""}`).join(`
`);return`### ${u.projectName} (${u.noteCount}\uAC1C)
${h}`}).join(`

`),l="";if(e.analysis){let{summary:u,mainTopics:h,insights:d,nextActions:c,patterns:a}=e.analysis;l=`
## \uBD84\uC11D \uACB0\uACFC

### \uC694\uC57D
${u}

### \uC8FC\uC694 \uC8FC\uC81C
${h.map(f=>`- ${f}`).join(`
`)}

### \uC778\uC0AC\uC774\uD2B8
${d.map(f=>`- ${f}`).join(`
`)}

### \uB2E4\uC74C \uC561\uC158
${c.map(f=>`- [ ] ${f}`).join(`
`)}
${a?`
### \uC791\uC5C5 \uD328\uD134
${a}`:""}`}return`---
type: review
period: ${e.period}
date_range: ${i}
created: ${n}
tags: [review, ${e.period==="today"?"daily":e.period==="week"?"weekly":"monthly"}]
---

# ${r}

## \uD1B5\uACC4
- \uC791\uC5C5\uD55C \uB178\uD2B8: ${e.totalNotes}\uAC1C
- \uC0C8 ZK \uB178\uD2B8: ${e.newZKNotes}\uAC1C
- \uD65C\uC131 \uD504\uB85C\uC81D\uD2B8: ${e.projectGroups.filter(u=>u.projectName!=="\uAE30\uD0C0"&&u.projectName!=="Library"&&u.projectName!=="Inbox").length}\uAC1C

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5

${o}
${l}
`}getProjectList(){let e=new Set,t=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(t instanceof Ah.TFolder)for(let n of t.children)n instanceof Ah.TFolder&&e.add(n.name);return Array.from(e).sort()}};var V1=["mp3","wav","m4a","aac","ogg","flac","webm"],FY=2*1024*1024*1024,Aw=class{constructor(e,t,n){this.app=e,this.gemini=t,this.settings=n}isAudioFile(e){return V1.includes(e.extension.toLowerCase())}getMimeType(e){return{mp3:"audio/mp3",wav:"audio/wav",m4a:"audio/m4a",aac:"audio/aac",ogg:"audio/ogg",flac:"audio/flac",webm:"audio/webm"}[e.toLowerCase()]||"audio/mp3"}async fileToBlob(e,t){let n=await this.app.vault.readBinary(e);return new Blob([n],{type:t})}async processAudio(e){if(e.stat.size>FY)throw new Error("\uD30C\uC77C \uD06C\uAE30\uAC00 2GB\uB97C \uCD08\uACFC\uD569\uB2C8\uB2E4");let t=e.extension.toLowerCase(),n=this.getMimeType(t),i=await this.fileToBlob(e,n);return await this.gemini.analyzeMeeting(i,n,e.name)}generateMarkdownNote(e){let t=Kt(this.settings.timezone,this.settings.dateFormat),n=e.actionItems.length>0?e.actionItems.map(o=>{let l=`- [ ] ${o.task}`;return o.assignee&&(l+=` - @${o.assignee}`),o.deadline&&(l+=` (\uAE30\uD55C: ${o.deadline})`),l}).join(`
`):"- (\uC5C6\uC74C)",i=e.decisions.length>0?e.decisions.map(o=>`- ${o}`).join(`
`):"- (\uC5C6\uC74C)",r=e.nextAgenda.length>0?e.nextAgenda.map(o=>`- ${o}`).join(`
`):"- (\uC5C6\uC74C)";return`---
type: meeting
source_file: "${e.sourceFile}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}

## \uC694\uC57D
${e.summary}

## \uC561\uC158 \uC544\uC774\uD15C
${n}

## \uACB0\uC815\uC0AC\uD56D
${i}

## \uB2E4\uC74C \uD68C\uC758 \uC548\uAC74
${r}

---

<details>
<summary>\uC804\uCCB4 \uB179\uCDE8\uB85D</summary>

${e.transcription}

</details>

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}};var Iw=require("obsidian");var Cw=class{constructor(e,t){this.app=e,this.settings=t}async saveToDaily(e){let t=new Map;for(let i of e)t.has(i.date)||t.set(i.date,[]),t.get(i.date).push(i);let n=0;for(let[i,r]of t)await this.appendToDaily(i,r),n+=r.length;return n}async appendToDaily(e,t){let n=this.settings.dailyNotesFolder,i=`${n}/${e}.md`;await this.ensureFolder(n);let r=t.map(l=>this.formatTask(l)).join(`
`),o=this.app.vault.getAbstractFileByPath(i);if(o instanceof Iw.TFile){let l=await this.app.vault.read(o),u=this.appendSchedulesToContent(l,r);await this.app.vault.modify(o,u)}else{let l=this.createDailyNoteContent(e,r);await this.app.vault.create(i,l)}}formatTask(e){let t=e.time?`${e.time} `:"",n=e.type==="event"?"\u{1F4C5}":"\u{1F4CB}",i=e.sourceNote?` (from [[${e.sourceNote}]])`:"";return`- [ ] ${t}${e.title} ${n} ${e.date}${i}`}appendSchedulesToContent(e,t){let n="## \uC77C\uC815";if(e.includes(n)){let r=e.indexOf(n),o=e.indexOf(`
## `,r+1);return o>0?e.substring(0,o)+t+`

`+e.substring(o):e+`
`+t}let i=e.indexOf("---",3);if(i>0){let r=e.indexOf(`
`,i)+1;return e.substring(0,r)+`
## \uC77C\uC815
`+t+`
`+e.substring(r)}return`## \uC77C\uC815
`+t+`

`+e}createDailyNoteContent(e,t){return`---
type: daily
date: ${e}
created: ${$i(this.settings.timezone)}
---

# ${e}

## \uC77C\uC815
${t}

## \uBA54\uBAA8

`}async ensureFolder(e){if(!(this.app.vault.getAbstractFileByPath(e)instanceof Iw.TFolder))try{await this.app.vault.createFolder(e)}catch{}}getToday(){return $i(this.settings.timezone)}};Li();function va(s){return s.replace(/\$/g,"$$$$")}function Dw(s,e,t){let n=s?.trim()?s:t;if(!n)return console.warn("\uD15C\uD50C\uB9BF\uC774 \uBE44\uC5B4\uC788\uC2B5\uB2C8\uB2E4. \uAE30\uBCF8 \uD615\uC2DD\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4."),`# ${e.title}

${e.summary}

${e.keyPoints.map(l=>`- ${l}`).join(`
`)}`;let i=e.keyPoints.map(l=>`- ${l}`).join(`
`),r=e.title.replace(/"/g,'\\"'),o=n;return o=o.replace(/\{\{title\}\}/g,va(e.title)),o=o.replace(/\{\{escapedTitle\}\}/g,va(r)),o=o.replace(/\{\{url\}\}/g,va(e.url)),o=o.replace(/\{\{summary\}\}/g,va(e.summary)),o=o.replace(/\{\{keyPoints\}\}/g,va(i)),o=o.replace(/\{\{date\}\}/g,va(e.date)),o=o.replace(/\{\{iframe\}\}/g,va(e.iframe||"")),o=o.replace(/\{\{bookmark\}\}/g,va(e.bookmark||"")),o}function k3(s){return`<div style="resize: both; overflow: hidden; width: 100%; height: 400px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${`https://www.youtube.com/embed/${s}`}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none;" allowfullscreen></iframe>
</div>`}function R3(s){let e=s;return s.includes("blog.naver.com")&&!s.includes("m.blog.naver.com")&&(e=s.replace("blog.naver.com","m.blog.naver.com")),`<div style="resize: both; overflow: hidden; width: 100%; height: 600px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${e}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none; color-scheme: light;"></iframe>
</div>`}function P3(s,e,t){if(t){let n=t.image?`
> ![](${t.image})
>`:"",i=t.description?`
> ${t.description}
>`:"";return`> [!bookmark] ${t.siteName||new URL(e).hostname}
> **${s}**
>${i}${n}
> \u{1F517} ${e}`}return`> [!bookmark] \uC6F9\uD398\uC774\uC9C0
> **${s}**
>
> \u{1F517} ${e}`}var kw=class{constructor(e,t){this.gemini=e,this.settings=t}extractVideoId(e){let t=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/|youtube\.com\/shorts\/)([a-zA-Z0-9_-]{11})/,/^([a-zA-Z0-9_-]{11})$/];for(let n of t){let i=e.match(n);if(i)return i[1]}return null}isValidYouTubeUrl(e){return this.extractVideoId(e)!==null}async processVideo(e){let t=this.extractVideoId(e);if(!t)throw new Error("\uC720\uD6A8\uD55C YouTube URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let n=`https://www.youtube.com/watch?v=${t}`;console.log("Gemini \uB124\uC774\uD2F0\uBE0C YouTube \uBD84\uC11D \uC2DC\uC791:",n);let i=await this.gemini.analyzeYouTube(n);return{videoId:t,url:n,title:i.title,summary:i.summary,keyPoints:i.keyPoints}}generateMarkdownNote(e){let t=Kt(this.settings.timezone,this.settings.dateFormat),n={title:e.title,url:e.url,summary:e.summary,keyPoints:e.keyPoints,date:t,iframe:k3(e.videoId)};return Dw(this.settings.youtubeTemplate,n,Qa.youtubeTemplate)}};var Im=require("obsidian");Li();var Rw=class{constructor(e,t){this.gemini=e,this.settings=t}isValidUrl(e){try{let t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}}extractMetadata(e,t){let n=u=>{let h=[new RegExp(`<meta[^>]*property=["']${u}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*property=["']${u}["']`,"i"),new RegExp(`<meta[^>]*name=["']${u}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*name=["']${u}["']`,"i")];for(let d of h){let c=e.match(d);if(c)return c[1]}return""},i=e.match(/<title[^>]*>([^<]+)<\/title>/i),r=e.match(/<link[^>]*rel=["'](?:shortcut )?icon["'][^>]*href=["']([^"']+)["']/i),o=new URL(t),l=u=>u?u.startsWith("http")?u:u.startsWith("//")?o.protocol+u:u.startsWith("/")?o.origin+u:o.origin+"/"+u:"";return{title:n("og:title")||n("twitter:title")||i?.[1]||"",description:n("og:description")||n("twitter:description")||n("description")||"",image:l(n("og:image")||n("twitter:image")||""),siteName:n("og:site_name")||o.hostname,favicon:l(r?.[1]||"/favicon.ico")}}extractContent(e){let t=e.match(/<title[^>]*>([^<]+)<\/title>/i),i=e.match(/<meta[^>]*property=["']og:title["'][^>]*content=["']([^"']+)["']/i)?.[1]||t?.[1]||"Untitled",r=e.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<nav[^>]*>[\s\S]*?<\/nav>/gi,"").replace(/<header[^>]*>[\s\S]*?<\/header>/gi,"").replace(/<footer[^>]*>[\s\S]*?<\/footer>/gi,"").replace(/<aside[^>]*>[\s\S]*?<\/aside>/gi,""),o="",l=r.match(/<article[^>]*>([\s\S]*?)<\/article>/i),u=r.match(/<main[^>]*>([\s\S]*?)<\/main>/i),h=r.match(/<div[^>]*(?:class|id)=["'][^"']*content[^"']*["'][^>]*>([\s\S]*?)<\/div>/i);return l?o=l[1]:u?o=u[1]:h?o=h[1]:o=r.match(/<body[^>]*>([\s\S]*?)<\/body>/i)?.[1]||r,o=o.replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&[a-z]+;/gi," ").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim(),{title:i.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim(),content:o}}async fetchWithJinaReader(e){let t=`https://r.jina.ai/${e}`,i=(await(0,Im.requestUrl)({url:t,method:"GET",headers:{Accept:"text/plain","X-Timeout":"30","X-Wait-For-Selector":"article, .post-content, .se-main-container, #postViewArea"}})).text;i.includes("Warning: This page maybe not yet fully loaded")&&console.log("Jina Reader: \uD398\uC774\uC9C0 \uB85C\uB529 \uACBD\uACE0 \uAC10\uC9C0");let r=i.split(`
`),o="Untitled",l=0;for(r[0]?.startsWith("# ")?(o=r[0].substring(2).trim(),l=1):r[0]?.startsWith("Title: ")&&(o=r[0].substring(7).trim(),l=1);l<r.length;){let h=r[l];if(h?.startsWith("URL Source:")||h?.startsWith("http")||h?.startsWith("Warning:")||h?.startsWith("Markdown Content:")||h?.trim()==="")l++;else break}let u=r.slice(l).join(`
`).trim();if(u.length<100&&!u.includes(`
`))throw new Error("\uD398\uC774\uC9C0 \uCF58\uD150\uCE20\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4 (JavaScript \uB85C\uB529 \uB300\uAE30 \uC2E4\uD328)");return{title:o,content:u}}async fetchNaverBlog(e){let t=e;if(e.includes("blog.naver.com")){let c=e.match(/blog\.naver\.com\/([^\/]+)\/(\d+)/);c&&(t=`https://m.blog.naver.com/${c[1]}/${c[2]}`)}let i=(await(0,Im.requestUrl)({url:t,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15",Accept:"text/html,application/xhtml+xml","Accept-Language":"ko-KR,ko;q=0.9"}})).text,o=i.match(/<title[^>]*>([^<]+)<\/title>/i)?.[1]?.replace(/ :  $/,"").trim()||"Untitled",l="",u=i.match(/<div[^>]*class="[^"]*se-main-container[^"]*"[^>]*>([\s\S]*?)<\/div>\s*<\/div>\s*<\/div>/i),h=i.match(/<div[^>]*id="postViewArea"[^>]*>([\s\S]*?)<\/div>/i),d=u?.[1]||h?.[1]||"";return d&&(l=d.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim()),{title:o,content:l}}async processUrl(e){if(!this.isValidUrl(e))throw new Error("\uC720\uD6A8\uD55C URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let t;try{let r=(await(0,Im.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text;t=this.extractMetadata(r,e)}catch(i){console.log("\uBA54\uD0C0\uB370\uC774\uD130 \uCD94\uCD9C \uC2E4\uD328:",i)}if(e.includes("blog.naver.com"))return console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, Jina Reader \uC0AC\uC6A9"),await this.processUrlFallback(e,t);try{console.log("URL Context Tool\uB85C \uC6F9\uD398\uC774\uC9C0 \uBD84\uC11D \uC2DC\uB3C4");let i=await this.gemini.analyzeWebpage(e),r=["unable to access","cannot access","could not access","\uC811\uADFC\uD560 \uC218 \uC5C6","\uAC00\uC838\uC62C \uC218 \uC5C6"],o=i.summary.toLowerCase();return r.some(u=>o.includes(u.toLowerCase()))?(console.log("URL Context Tool \uC811\uADFC \uC2E4\uD328 \uAC10\uC9C0, \uD3F4\uBC31 \uC2DC\uB3C4"),await this.processUrlFallback(e,t)):(t&&(t.title=t.title||i.title),{url:e,title:i.title,content:"",summary:i.summary,keyPoints:i.keyPoints,metadata:t})}catch(i){console.log("URL Context Tool \uC2E4\uD328, \uD3F4\uBC31 \uC2DC\uB3C4:",i)}return await this.processUrlFallback(e,t)}async processUrlFallback(e,t){let n,i,r=null;if(!t)try{r=(await(0,Im.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text,t=this.extractMetadata(r,e)}catch(d){console.log("HTML \uAC00\uC838\uC624\uAE30 \uC2E4\uD328:",d)}if(e.includes("blog.naver.com")){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, \uC804\uC6A9 \uCD94\uCD9C \uC2DC\uB3C4");try{let d=await this.fetchNaverBlog(e);if(n=d.title,i=d.content,i.length<100)throw new Error("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uCD94\uCD9C \uC2E4\uD328")}catch(d){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uC804\uC6A9 \uCD94\uCD9C \uC2E4\uD328, Jina Reader \uC2DC\uB3C4:",d);let c=await this.fetchWithJinaReader(e);n=c.title,i=c.content}}else try{console.log("Jina Reader\uB85C \uCF58\uD150\uCE20 \uCD94\uCD9C \uC2DC\uB3C4");let d=await this.fetchWithJinaReader(e);n=d.title,i=d.content}catch(d){if(console.log("Jina Reader \uC2E4\uD328, \uC9C1\uC811 \uCD94\uCD9C\uB85C \uD3F4\uBC31:",d),r){let c=this.extractContent(r);n=c.title,i=c.content}else throw new Error("\uC6F9\uD398\uC774\uC9C0\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4")}if(i.length<50)throw new Error("\uBCF8\uBB38\uC744 \uCD94\uCD9C\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC811\uADFC\uC774 \uC81C\uD55C\uB41C \uD398\uC774\uC9C0\uC77C \uC218 \uC788\uC2B5\uB2C8\uB2E4.");let l=5e4,u=i.length>l?i.slice(0,l)+"...":i,h=await this.gemini.summarizeContent(u,"webpage");return t&&(t.title=t.title||n),{url:e,title:h.title||n,content:u,summary:h.summary,keyPoints:h.keyPoints,metadata:t}}generateMarkdownNote(e){let t=Kt(this.settings.timezone,this.settings.dateFormat),n=e.metadata,i=P3(e.title,e.url,{siteName:n?.siteName,description:n?.description,image:n?.image}),r={title:e.title,url:e.url,summary:e.summary,keyPoints:e.keyPoints,date:t,iframe:R3(e.url),bookmark:i};return Dw(this.settings.webpageTemplate,r,Qa.webpageTemplate)}};var fo=require("obsidian"),LY="YOUR_CLIENT_ID.apps.googleusercontent.com",$Y="YOUR_CLIENT_SECRET",M3="http://127.0.0.1:42813/callback",UY="https://accounts.google.com/o/oauth2/v2/auth",N3="https://oauth2.googleapis.com/token",BY="https://www.googleapis.com/calendar/v3",VY="https://www.googleapis.com/auth/calendar.events",Dm=class{constructor(e,t,n){this.authServer=null;this.app=e,this.settings=t,this.saveSettings=n}isConnected(){return!!this.settings.googleRefreshToken}getClientId(){return this.settings.useOwnApiKey?this.settings.googleClientId:LY}getClientSecret(){return this.settings.useOwnApiKey?this.settings.googleClientSecret:$Y}async startOAuth(){let e=this.getClientId();if(!e||e==="YOUR_CLIENT_ID.apps.googleusercontent.com"){new fo.Notice(`Google Calendar Client ID\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.
\uC124\uC815\uC5D0\uC11C Advanced \uBAA8\uB4DC\uB85C \uC9C1\uC811 Client ID\uB97C \uC785\uB825\uD558\uAC70\uB098,
\uD50C\uB7EC\uADF8\uC778 \uC5C5\uB370\uC774\uD2B8\uB97C \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.`,1e4);return}let t=new URLSearchParams({client_id:e,redirect_uri:M3,response_type:"code",scope:VY,access_type:"offline",prompt:"consent"}),n=`${UY}?${t.toString()}`;try{let i=await this.startAuthServer();await this.exchangeCodeForTokens(i),new fo.Notice("Google Calendar \uC5F0\uACB0 \uC644\uB8CC!")}catch(i){console.error("OAuth \uC5D0\uB7EC:",i),new fo.Notice("Google Calendar \uC5F0\uACB0 \uC2E4\uD328: "+i.message)}window.open(n,"_blank")}startAuthServer(){return new Promise((e,t)=>{let n=require("http"),i=setTimeout(()=>{this.stopAuthServer(),t(new Error("\uC778\uC99D \uC2DC\uAC04 \uCD08\uACFC (5\uBD84)"))},5*60*1e3);this.authServer=n.createServer((r,o)=>{let l=new URL(r.url||"","http://127.0.0.1:42813");if(l.pathname==="/callback"){let u=l.searchParams.get("code"),h=l.searchParams.get("error");if(h){o.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),o.end(`
							<html><body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
								<h1>\uC5F0\uACB0 \uC2E4\uD328</h1>
								<p>Google Calendar \uC5F0\uACB0\uC774 \uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p>
								<p>\uC774 \uCC3D\uC744 \uB2EB\uC544\uB3C4 \uB429\uB2C8\uB2E4.</p>
							</body></html>
						`),clearTimeout(i),this.stopAuthServer(),t(new Error(h));return}if(u){o.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),o.end(`
							<html><body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
								<h1>\uC5F0\uACB0 \uC644\uB8CC!</h1>
								<p>Google Calendar\uAC00 \uC5F0\uACB0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p>
								<p>\uC774 \uCC3D\uC744 \uB2EB\uACE0 Obsidian\uC73C\uB85C \uB3CC\uC544\uAC00\uC138\uC694.</p>
							</body></html>
						`),clearTimeout(i),this.stopAuthServer(),e(u);return}}o.writeHead(404),o.end("Not Found")}),this.authServer.listen(42813,"127.0.0.1",()=>{console.log("OAuth \uCF5C\uBC31 \uC11C\uBC84 \uC2DC\uC791: http://127.0.0.1:42813")}),this.authServer.on("error",r=>{clearTimeout(i),t(new Error(`\uC11C\uBC84 \uC2DC\uC791 \uC2E4\uD328: ${r.message}`))})})}stopAuthServer(){this.authServer&&(this.authServer.close(),this.authServer=null)}async exchangeCodeForTokens(e){let n=(await(0,fo.requestUrl)({url:N3,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:this.getClientId(),client_secret:this.getClientSecret(),code:e,grant_type:"authorization_code",redirect_uri:M3}).toString()})).json;if(n.error)throw new Error(n.error_description||n.error);this.settings.googleAccessToken=n.access_token,n.refresh_token&&(this.settings.googleRefreshToken=n.refresh_token),this.settings.googleTokenExpiry=Date.now()+n.expires_in*1e3,await this.saveSettings()}async refreshAccessToken(){if(!this.settings.googleRefreshToken)throw new Error("Refresh token\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC5F0\uACB0\uD574\uC8FC\uC138\uC694.");let t=(await(0,fo.requestUrl)({url:N3,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:this.getClientId(),client_secret:this.getClientSecret(),refresh_token:this.settings.googleRefreshToken,grant_type:"refresh_token"}).toString()})).json;if(t.error)throw t.error==="invalid_grant"?(this.settings.googleRefreshToken="",await this.saveSettings(),new Error("Google \uC5F0\uACB0\uC774 \uB9CC\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC5F0\uACB0\uD574\uC8FC\uC138\uC694.")):new Error(t.error_description||t.error);this.settings.googleAccessToken=t.access_token,this.settings.googleTokenExpiry=Date.now()+t.expires_in*1e3,await this.saveSettings()}async ensureValidToken(){Date.now()>this.settings.googleTokenExpiry-5*60*1e3&&await this.refreshAccessToken()}async createEvent(e){if(!this.isConnected())throw new Error("Google Calendar\uAC00 \uC5F0\uACB0\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");await this.ensureValidToken();let t,n;if(e.time){let o=`${e.date}T${e.time}:00`,l=this.addHour(e.time),u=`${e.date}T${l}:00`;t={dateTime:o,timeZone:this.resolveTimezone()},n={dateTime:u,timeZone:this.resolveTimezone()}}else t={date:e.date},n={date:this.getNextDay(e.date)};let i={summary:e.title,start:t,end:n},r=await(0,fo.requestUrl)({url:`${BY}/calendars/primary/events`,method:"POST",headers:{Authorization:`Bearer ${this.settings.googleAccessToken}`,"Content-Type":"application/json"},body:JSON.stringify(i)});if(r.status>=400){let o=r.json;throw new Error(o.error?.message||"\uC774\uBCA4\uD2B8 \uC0DD\uC131 \uC2E4\uD328")}}async saveSchedules(e){let t=0;for(let n of e)try{await this.createEvent(n),t++}catch(i){console.error("\uC77C\uC815 \uC800\uC7A5 \uC2E4\uD328:",n.title,i)}return t}addHour(e){let[t,n]=e.split(":").map(Number),i=(t+1)%24;return`${String(i).padStart(2,"0")}:${String(n).padStart(2,"0")}`}getNextDay(e){let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}resolveTimezone(){return this.settings.timezone==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:this.settings.timezone}async disconnect(){this.settings.googleAccessToken="",this.settings.googleRefreshToken="",this.settings.googleTokenExpiry=0,await this.saveSettings(),new fo.Notice("Google Calendar \uC5F0\uACB0\uC774 \uD574\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}};var O3=require("obsidian"),Pw=class extends O3.Modal{constructor(t,n,i,r){super(t);this.resolvePromise=null;this.choiceMade=!1;this.schedules=n,this.settings=i,this.selected=new Set(n.map((o,l)=>l)),this.saveToDaily=!0,this.saveToGoogle=i.googleCalendarEnabled&&!!i.googleRefreshToken,this.moveToArchives=!1,this.onFeedback=r}async openAndWait(){return new Promise(t=>{this.resolvePromise=t,this.open()})}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-schedule-modal"),t.createEl("h2",{text:"\uAC10\uC9C0\uB41C \uC77C\uC815"}),t.createEl("p",{text:`${this.schedules.length}\uAC1C\uC758 \uC77C\uC815\uC774 \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uC800\uC7A5\uD560 \uC77C\uC815\uC744 \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let n=t.createDiv({cls:"schedule-list"});n.style.maxHeight="300px",n.style.overflowY="auto",n.style.marginBottom="16px",this.schedules.forEach((y,_)=>{let x=n.createDiv({cls:"schedule-item"});x.style.display="flex",x.style.alignItems="center",x.style.padding="10px 12px",x.style.marginBottom="8px",x.style.border="1px solid var(--background-modifier-border)",x.style.borderRadius="8px",x.style.gap="12px";let E=x.createEl("input",{type:"checkbox",attr:{checked:!0}});E.style.flexShrink="0",E.addEventListener("change",()=>{E.checked?this.selected.add(_):this.selected.delete(_),this.updateSaveButton()});let S=x.createDiv({cls:"schedule-info"});S.style.flex="1",S.style.minWidth="0";let T=S.createEl("div",{text:y.title});T.style.fontWeight="500",T.style.overflow="hidden",T.style.textOverflow="ellipsis",T.style.whiteSpace="nowrap";let C=S.createEl("div");C.style.fontSize="12px",C.style.color="var(--text-muted)";let I=y.type==="event"?"\uC57D\uC18D":"\uD560\uC77C",A=y.type==="event"?"\u{1F4C5}":"\u{1F4CB}",P=y.time||"\uC885\uC77C";C.setText(`${A} ${I} | ${y.date} ${P}`)});let i=t.createDiv({cls:"schedule-destinations"});i.style.padding="12px",i.style.backgroundColor="var(--background-secondary)",i.style.borderRadius="8px",i.style.marginBottom="16px",i.createEl("div",{text:"\uC800\uC7A5 \uC704\uCE58"}).style.fontWeight="500";let r=i.createDiv({cls:"destination-option"});r.style.display="flex",r.style.alignItems="center",r.style.gap="8px",r.style.marginTop="8px";let o=r.createEl("input",{type:"checkbox",attr:{checked:!0}});o.id="save-to-daily",o.addEventListener("change",()=>{this.saveToDaily=o.checked});let l=r.createEl("label",{text:`Daily Notes (${this.settings.dailyNotesFolder}/)`,attr:{for:"save-to-daily"}});l.style.cursor="pointer";let u=i.createDiv({cls:"destination-option"});u.style.display="flex",u.style.alignItems="center",u.style.gap="8px",u.style.marginTop="8px";let h=u.createEl("input",{type:"checkbox",attr:{checked:this.saveToGoogle,disabled:!this.settings.googleCalendarEnabled||!this.settings.googleRefreshToken}});h.id="save-to-google",h.addEventListener("change",()=>{this.saveToGoogle=h.checked});let d=u.createEl("label",{attr:{for:"save-to-google"}});d.style.cursor="pointer",this.settings.googleCalendarEnabled&&this.settings.googleRefreshToken?d.setText("Google Calendar (\uC5F0\uACB0\uB428)"):this.settings.googleCalendarEnabled?(d.setText("Google Calendar (\uC5F0\uACB0 \uD544\uC694)"),d.style.color="var(--text-muted)"):(d.setText("Google Calendar (\uBE44\uD65C\uC131\uD654)"),d.style.color="var(--text-muted)");let c=i.createDiv({cls:"destination-option"});c.style.display="flex",c.style.alignItems="center",c.style.gap="8px",c.style.marginTop="8px";let a=c.createEl("input",{type:"checkbox",attr:{checked:!1}});a.id="move-to-archives",a.addEventListener("change",()=>{this.moveToArchives=a.checked});let f=c.createEl("label",{text:"\u{1F4E6} \uC800\uC7A5 \uD6C4 \uC6D0\uBCF8 \uB178\uD2B8 Archives\uB85C \uC774\uB3D9",attr:{for:"move-to-archives"}});f.style.cursor="pointer";let p=t.createDiv({cls:"modal-button-container"});p.style.display="flex",p.style.justifyContent="flex-end",p.style.gap="8px",p.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>{this.choiceMade=!0,this.onFeedback&&this.onFeedback({type:"schedule_detection",accepted:!1,allSchedules:this.schedules,selectedSchedules:[],rejectedSchedules:this.schedules}),this.close(),this.resolvePromise&&this.resolvePromise(null)});let m=p.createEl("button",{text:`${this.selected.size}\uAC1C \uC800\uC7A5`,cls:"mod-cta"});m.id="save-schedule-btn",m.addEventListener("click",()=>{this.choiceMade=!0;let y=this.schedules.filter((x,E)=>this.selected.has(E)),_=this.schedules.filter((x,E)=>!this.selected.has(E));this.onFeedback&&this.onFeedback({type:"schedule_detection",accepted:y.length>0,allSchedules:this.schedules,selectedSchedules:y,rejectedSchedules:_}),this.close(),this.resolvePromise&&this.resolvePromise({selectedSchedules:y,saveToDaily:this.saveToDaily,saveToGoogle:this.saveToGoogle,moveToArchives:this.moveToArchives})})}updateSaveButton(){let t=this.contentEl.querySelector("#save-schedule-btn");t&&t.setText(`${this.selected.size}\uAC1C \uC800\uC7A5`)}onClose(){this.choiceMade||(this.onFeedback&&this.onFeedback({type:"schedule_detection",accepted:!1,allSchedules:this.schedules,selectedSchedules:[],dismissed:!0}),this.resolvePromise&&this.resolvePromise(null)),this.contentEl.empty()}};var Ch=require("obsidian"),Mw=class extends Ch.Modal{constructor(t,n,i,r,o=null){super(t);this.choiceMade=!1;this.activeTab="restructured";this.result=n,this.originalContent=i,this.onChoice=r,this.feedbackManager=o,this.component=new Ch.Component}getRestructureTypeLabel(t){switch(t){case"meeting":return"\u{1F4CB} \uD68C\uC758/\uBBF8\uD305";case"idea":return"\u{1F4A1} \uC544\uC774\uB514\uC5B4";case"learning":return"\u{1F4DA} \uD559\uC2B5/\uC5F0\uAD6C";case"general":return"\u{1F4DD} \uC77C\uBC18";default:return"\u{1F4DD} \uC77C\uBC18"}}recordFeedback(t){this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"content_restructure",noteTitle:this.result.title,aiSuggestion:{restructuredContent:this.result.restructuredContent,restructureType:this.result.restructureType},userChoice:{accepted:t===!0,dismissed:t===null}})}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-restructure-modal"),t.createEl("h2",{text:"\u2728 \uCF58\uD150\uCE20 \uC7AC\uAD6C\uC131 \uC81C\uC548"});let n=t.createDiv({cls:"restructure-info"});n.style.marginBottom="16px",n.style.padding="12px",n.style.backgroundColor="var(--background-secondary)",n.style.borderRadius="8px",n.createEl("p",{text:"\uC774 \uB178\uD2B8\uAC00 \uC815\uB9AC\uB418\uC9C0 \uC54A\uC740 \uAC83 \uAC19\uC544 \uC7AC\uAD6C\uC131\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4."});let i=this.getRestructureTypeLabel(this.result.restructureType);n.createEl("p",{text:`\uC720\uD615: ${i}`,cls:"restructure-type"}).style.fontWeight="bold";let r=t.createDiv({cls:"restructure-tabs"});r.style.display="flex",r.style.borderBottom="1px solid var(--background-modifier-border)",r.style.marginBottom="12px";let o=r.createEl("button",{text:"\u{1F4C4} \uC6D0\uBCF8"});o.style.flex="1",o.style.padding="8px 16px",o.style.border="none",o.style.cursor="pointer",o.style.backgroundColor="transparent";let l=r.createEl("button",{text:"\u2728 \uC7AC\uAD6C\uC131"});l.style.flex="1",l.style.padding="8px 16px",l.style.border="none",l.style.cursor="pointer",l.style.backgroundColor="transparent";let u=t.createDiv({cls:"restructure-content-area"});u.style.minHeight="200px",u.style.maxHeight="400px",u.style.overflow="auto",u.style.padding="12px",u.style.border="1px solid var(--background-modifier-border)",u.style.borderRadius="8px",u.style.backgroundColor="var(--background-primary)";let h=()=>{this.activeTab==="original"?(o.style.borderBottom="2px solid var(--interactive-accent)",o.style.color="var(--text-normal)",l.style.borderBottom="none",l.style.color="var(--text-muted)",u.empty(),u.createEl("pre",{text:this.originalContent,cls:"original-content"}).style.whiteSpace="pre-wrap"):(l.style.borderBottom="2px solid var(--interactive-accent)",l.style.color="var(--text-normal)",o.style.borderBottom="none",o.style.color="var(--text-muted)",u.empty(),this.result.restructuredContent&&Ch.MarkdownRenderer.render(this.app,this.result.restructuredContent,u,"",this.component))};o.addEventListener("click",()=>{this.activeTab="original",h()}),l.addEventListener("click",()=>{this.activeTab="restructured",h()}),h();let d=t.createDiv({cls:"modal-button-container"});d.style.marginTop="16px",d.style.display="flex",d.style.gap="8px",d.style.justifyContent="flex-end",d.createEl("button",{text:"\u{1F4C4} \uC6D0\uBCF8 \uC720\uC9C0"}).addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback(!1),this.close(),this.onChoice(!1)}),d.createEl("button",{text:"\u2728 \uC7AC\uAD6C\uC131 \uC801\uC6A9",cls:"mod-cta"}).addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback(!0),this.close(),this.onChoice(!0)})}onClose(){this.choiceMade||this.recordFeedback(null),this.component.unload(),this.contentEl.empty()}};var F3=require("obsidian"),Nw=class extends F3.Modal{constructor(t,n,i){super(t);this.resolvePromise=null;this.processButton=null;this.settings=i,this.imageFiles=n,this.selected=new Set}async openAndWait(){return new Promise(t=>{this.resolvePromise=t,this.open()})}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-image-batch-modal"),t.createEl("h2",{text:"\uC774\uBBF8\uC9C0 \uD1B5\uD569 \uCC98\uB9AC"}),t.createEl("p",{text:`_Inbox\uC5D0\uC11C ${this.imageFiles.length}\uAC1C\uC758 \uC774\uBBF8\uC9C0\uB97C \uBC1C\uACAC\uD588\uC2B5\uB2C8\uB2E4. \uCC98\uB9AC\uD560 \uC774\uBBF8\uC9C0\uB97C \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let n=t.createDiv({cls:"image-batch-controls"});n.style.marginBottom="12px",n.style.display="flex",n.style.gap="8px";let i=n.createEl("button",{text:"\uC804\uCCB4 \uC120\uD0DD"});i.style.fontSize="12px",i.addEventListener("click",()=>{this.imageFiles.forEach(d=>this.selected.add(d.path)),this.renderList(o),this.updateProcessButton()});let r=n.createEl("button",{text:"\uC804\uCCB4 \uD574\uC81C"});r.style.fontSize="12px",r.addEventListener("click",()=>{this.selected.clear(),this.renderList(o),this.updateProcessButton()});let o=t.createDiv({cls:"image-list"});o.style.maxHeight="400px",o.style.overflowY="auto",o.style.marginBottom="16px",o.style.border="1px solid var(--background-modifier-border)",o.style.borderRadius="8px",o.style.padding="8px",this.renderList(o);let l=t.createEl("p",{cls:"setting-item-description"});l.style.fontSize="12px",l.style.marginBottom="16px",l.innerHTML=`
			<strong>\uB3D9\uC791:</strong> \uC120\uD0DD\uD55C \uC774\uBBF8\uC9C0\uB4E4\uC744 \uD558\uB098\uC758 \uBB38\uC11C\uB85C OCR \uCC98\uB9AC \uD6C4 AI \uC694\uC57D \uBC0F \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958\uB97C \uC218\uD589\uD569\uB2C8\uB2E4.<br>
			<em>\uC5F0\uC18D\uB41C \uD544\uAE30 \uB178\uD2B8\uB098 \uAD00\uB828 \uC774\uBBF8\uC9C0\uB4E4\uC744 \uD558\uB098\uC758 \uBB38\uC11C\uB85C \uD1B5\uD569\uD560 \uB54C \uC720\uC6A9\uD569\uB2C8\uB2E4.</em>
		`;let u=t.createDiv({cls:"modal-button-container"});u.style.display="flex",u.style.justifyContent="flex-end",u.style.gap="8px",u.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>{this.resolvePromise?.(null),this.close()}),this.processButton=u.createEl("button",{text:"OCR + \uBD84\uB958 (0\uAC1C \uC120\uD0DD)",cls:"mod-cta"}),this.processButton.disabled=!0,this.processButton.addEventListener("click",()=>{let d=this.imageFiles.filter(c=>this.selected.has(c.path));this.resolvePromise?.({selectedFiles:d}),this.close()})}renderList(t){if(t.empty(),this.imageFiles.length===0){t.createEl("p",{text:"_Inbox\uC5D0 \uC774\uBBF8\uC9C0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.",cls:"setting-item-description"});return}this.imageFiles.forEach(n=>{let i=t.createDiv({cls:"image-item"});i.style.display="flex",i.style.alignItems="center",i.style.padding="8px",i.style.marginBottom="4px",i.style.borderRadius="4px",i.style.gap="10px",i.style.cursor="pointer",this.selected.has(n.path)&&(i.style.backgroundColor="var(--background-modifier-success)");let r=i.createEl("input",{type:"checkbox"});r.checked=this.selected.has(n.path),r.style.flexShrink="0",r.addEventListener("change",d=>{d.stopPropagation(),r.checked?this.selected.add(n.path):this.selected.delete(n.path),this.renderList(t),this.updateProcessButton()});let o=i.createSpan({cls:"image-icon"});o.style.fontSize="16px",o.textContent=this.getFileIcon(n.extension);let l=i.createDiv({cls:"image-info"});l.style.flex="1",l.style.minWidth="0";let u=l.createDiv({cls:"image-name"});u.textContent=n.name,u.style.fontWeight="500",u.style.overflow="hidden",u.style.textOverflow="ellipsis",u.style.whiteSpace="nowrap";let h=l.createDiv({cls:"image-meta"});h.style.fontSize="11px",h.style.color="var(--text-muted)",h.textContent=this.formatFileSize(n.stat.size),i.addEventListener("click",d=>{d.target!==r&&(r.checked=!r.checked,r.checked?this.selected.add(n.path):this.selected.delete(n.path),this.renderList(t),this.updateProcessButton())})})}updateProcessButton(){if(this.processButton){let t=this.selected.size;this.processButton.textContent=`OCR + \uBD84\uB958 (${t}\uAC1C \uC120\uD0DD)`,this.processButton.disabled=t===0}}getFileIcon(t){return{png:"\u{1F5BC}\uFE0F",jpg:"\u{1F5BC}\uFE0F",jpeg:"\u{1F5BC}\uFE0F",webp:"\u{1F5BC}\uFE0F",gif:"\u{1F5BC}\uFE0F",pdf:"\u{1F4C4}"}[t.toLowerCase()]||"\u{1F4C4}"}formatFileSize(t){return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`}onClose(){let{contentEl:t}=this;t.empty(),this.resolvePromise&&(this.resolvePromise(null),this.resolvePromise=null)}};var Fw=require("obsidian"),Ow=class extends Fw.Modal{constructor(t,n){super(t);this.inputEl=null;this.resultsEl=null;this.results=[];this.selectedIndex=0;this.searchTimeout=null;this.isSearching=!1;this.embeddingManager=n}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-smart-search-modal"),t.createEl("div",{text:"\uBB34\uC5C7\uC744 \uCC3E\uACE0 \uC788\uB098\uC694?",cls:"smart-search-header"});let n=t.createDiv({cls:"smart-search-input-container"});this.inputEl=n.createEl("input",{type:"text",placeholder:"\uD30C\uC77C\uBA85 \uB610\uB294 \uB0B4\uC6A9\uC73C\uB85C \uAC80\uC0C9...",cls:"smart-search-input"}),this.inputEl.addEventListener("input",()=>this.onInputChange()),this.inputEl.addEventListener("keydown",i=>this.onKeyDown(i)),this.resultsEl=t.createDiv({cls:"smart-search-results"}),this.showEmptyState(),this.inputEl.focus()}onClose(){this.searchTimeout&&clearTimeout(this.searchTimeout),this.contentEl.empty()}onInputChange(){this.searchTimeout&&clearTimeout(this.searchTimeout);let t=this.inputEl?.value.trim()||"";if(t.length<2){this.showEmptyState();return}this.showSearching(),this.searchTimeout=setTimeout(()=>{this.performSearch(t)},300)}onKeyDown(t){switch(t.key){case"ArrowDown":t.preventDefault(),this.selectNext();break;case"ArrowUp":t.preventDefault(),this.selectPrevious();break;case"Enter":t.preventDefault(),this.openSelected();break;case"Escape":t.preventDefault(),this.close();break}}async performSearch(t){if(!this.isSearching){this.isSearching=!0;try{let n=t.toLowerCase(),i=new Set;this.results=[];let r=this.app.vault.getMarkdownFiles(),o=[];for(let u of r){let h=u.basename.toLowerCase();if(h.includes(n)){let d=u.parent?.path||"/",c=.9;h===n?c=1:h.startsWith(n)&&(c=.95),o.push({path:u.path,similarity:c,file:u,folder:d==="/"?"\uB8E8\uD2B8":d,matchType:"filename"}),i.add(u.path)}}o.sort((u,h)=>h.similarity-u.similarity),this.results.push(...o.slice(0,5));let l=await this.embeddingManager.findSimilarNotesByText(t,15,void 0,.2);for(let u of l){if(i.has(u.path))continue;let h=this.app.vault.getAbstractFileByPath(u.path);if(h instanceof Fw.TFile){let d=h.parent?.path||"/";if(this.results.push({...u,file:h,folder:d==="/"?"\uB8E8\uD2B8":d,matchType:"content"}),i.add(u.path),this.results.length>=10)break}}this.selectedIndex=0,this.renderResults()}catch(n){console.error("\uC2A4\uB9C8\uD2B8 \uAC80\uC0C9 \uC624\uB958:",n),this.showError()}finally{this.isSearching=!1}}}renderResults(){if(this.resultsEl){if(this.resultsEl.empty(),this.results.length===0){this.showNoResults();return}for(let t=0;t<this.results.length;t++){let n=this.results[t],i=this.resultsEl.createDiv({cls:`smart-search-item ${t===this.selectedIndex?"is-selected":""}`}),r=i.createDiv({cls:"search-item-title-row"}),o=n.matchType==="filename"?"\u{1F4DD}":"\u{1F50D}";if(r.createSpan({text:`${o} `,cls:"search-item-icon"}),r.createSpan({text:n.file.basename,cls:"search-item-title"}),n.matchType==="filename")r.createSpan({text:"\uC774\uB984",cls:"search-item-match-type"});else{let l=Math.round(n.similarity*100);r.createSpan({text:`${l}%`,cls:"search-item-similarity"})}n.chunkPreview&&n.matchType==="content"&&i.createDiv({text:n.chunkPreview,cls:"search-item-chunk-preview"}),i.createDiv({text:`\u2192 ${n.folder}`,cls:"search-item-folder"}),i.addEventListener("click",()=>{this.selectedIndex=t,this.openSelected()}),i.addEventListener("mouseenter",()=>{this.selectedIndex=t,this.updateSelection()})}}}updateSelection(){if(!this.resultsEl)return;this.resultsEl.querySelectorAll(".smart-search-item").forEach((n,i)=>{i===this.selectedIndex?n.addClass("is-selected"):n.removeClass("is-selected")})}selectNext(){this.results.length!==0&&(this.selectedIndex=(this.selectedIndex+1)%this.results.length,this.updateSelection(),this.scrollToSelected())}selectPrevious(){this.results.length!==0&&(this.selectedIndex=(this.selectedIndex-1+this.results.length)%this.results.length,this.updateSelection(),this.scrollToSelected())}scrollToSelected(){if(!this.resultsEl)return;let t=this.resultsEl.querySelector(".is-selected");t&&t.scrollIntoView({block:"nearest"})}openSelected(){if(this.results.length===0||this.selectedIndex>=this.results.length)return;let t=this.results[this.selectedIndex];this.app.workspace.openLinkText(t.file.path,""),this.close()}showEmptyState(){if(!this.resultsEl)return;this.resultsEl.empty(),this.results=[];let t=this.resultsEl.createDiv({cls:"smart-search-empty"});t.createEl("p",{text:"\uAC80\uC0C9\uC5B4\uB97C 2\uAE00\uC790 \uC774\uC0C1 \uC785\uB825\uD558\uC138\uC694"}),t.createEl("small",{text:"\uB0B4\uC6A9 \uAE30\uBC18\uC73C\uB85C \uAD00\uB828 \uBB38\uC11C\uB97C \uCC3E\uC544\uB4DC\uB9BD\uB2C8\uB2E4"})}showSearching(){if(!this.resultsEl)return;this.resultsEl.empty(),this.resultsEl.createDiv({cls:"smart-search-searching"}).createEl("p",{text:"\u{1F50D} \uAC80\uC0C9 \uC911..."})}showNoResults(){if(!this.resultsEl)return;this.resultsEl.empty();let t=this.resultsEl.createDiv({cls:"smart-search-no-results"});t.createEl("p",{text:"\uAD00\uB828 \uBB38\uC11C\uB97C \uCC3E\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4"}),t.createEl("small",{text:"\uB2E4\uB978 \uAC80\uC0C9\uC5B4\uB97C \uC2DC\uB3C4\uD574\uBCF4\uC138\uC694"})}showError(){if(!this.resultsEl)return;this.resultsEl.empty();let t=this.resultsEl.createDiv({cls:"smart-search-error"});t.createEl("p",{text:"\uAC80\uC0C9 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4"}),t.createEl("small",{text:"\uC784\uBCA0\uB529 \uC778\uB371\uC2A4\uAC00 \uAD6C\uCD95\uB418\uC5B4 \uC788\uB294\uC9C0 \uD655\uC778\uD558\uC138\uC694"})}};Li();var km=10,L3=100,$3=20,Lw=class{constructor(e,t){this.app=e,this.settings=t,this.store={...Sf}}async load(){try{let e=this.getFilePath(),t=this.app.vault.adapter;if(await t.exists(e)){let n=await t.read(e),i=JSON.parse(n);this.store=this.migrate(i)}else this.store={...Sf}}catch(e){console.error("Failed to load feedback store:",e),this.store={...Sf}}}async save(){try{let e=this.getFilePath(),t=this.app.vault.adapter;if(this.settings.dataStorageLocation==="vault"){let n=this.settings.dataFolderPath;await t.exists(n)||await t.mkdir(n)}this.store.lastUpdated=new Date().toISOString(),await t.write(e,JSON.stringify(this.store,null,2))}catch(e){console.error("Failed to save feedback store:",e)}}getFilePath(){return this.settings.dataStorageLocation==="vault"?`${this.settings.dataFolderPath}/${Gs.FEEDBACK}`:`${Au}/${Gs.FEEDBACK}`}migrate(e){return!e.version||e.version<1?{version:1,entries:e.entries||[],preferences:this.migratePreferences(e.preferences),lastUpdated:e.lastUpdated||new Date().toISOString()}:(e.preferences=this.migratePreferences(e.preferences),e)}migratePreferences(e){let t={...gb};return e?{version:e.version||t.version,feedback:{referenceLocation:{...t.feedback.referenceLocation,...e.feedback?.referenceLocation},scheduleDetection:{...t.feedback.scheduleDetection,...e.feedback?.scheduleDetection},projectClassification:{...t.feedback.projectClassification,...e.feedback?.projectClassification}},restructure:{...t.restructure,...e.restructure},embedding:{...t.embedding,...e.embedding},rag:{...t.rag,...e.rag,feedbackOnAnswers:{...t.rag.feedbackOnAnswers,...e.rag?.feedbackOnAnswers}}}:t}addFeedback(e){this.store.entries.push(e),this.store.entries.length>L3&&(this.store.entries=this.store.entries.slice(-L3)),this.updatePreferences(e),this.save()}updatePreferences(e){if(!e.userChoice.dismissed)switch(e.type){case"reference_location":this.updateReferencePreference(e);break;case"schedule_detection":this.updateSchedulePreference(e);break;case"related_notes":this.updateRelatedNotesPreference(e);break;case"project_classification":this.updateProjectClassificationPreference(e);break;case"content_restructure":this.updateRestructurePreference(e);break;case"rag_chat":this.updateRAGPreference(e);break}}updateReferencePreference(e){let t=this.store.preferences.feedback.referenceLocation;e.userChoice.modified==="library"?t.toLibrary++:e.userChoice.modified==="project"&&t.toProject++;let n=t.toLibrary+t.toProject;if(n>=5){let i=t.toLibrary/n;i>.7?t.preference="library":i<.3?t.preference="project":t.preference="neutral"}}updateSchedulePreference(e){let t=this.store.preferences.feedback.scheduleDetection;e.userChoice.accepted?t.accepted++:t.rejected++,e.userChoice.rejectedItems&&e.userChoice.rejectedItems.length>0}updateRelatedNotesPreference(e){}updateProjectClassificationPreference(e){let t=this.store.preferences.feedback.projectClassification;e.userChoice.modified&&e.aiSuggestion.projectName&&(t.corrections.push({original:e.aiSuggestion.projectName,corrected:e.userChoice.modified,keywords:[]}),t.corrections.length>$3&&(t.corrections=t.corrections.slice(-$3)))}updateRestructurePreference(e){let t=this.store.preferences.restructure;e.userChoice.accepted?t.accepted++:t.rejected++;let n=t.accepted+t.rejected;if(n>=5){let i=t.accepted/n;i>.7?t.preference="restructure":i<.3?t.preference="original":t.preference="neutral"}}updateRAGPreference(e){let t=this.store.preferences.rag;if(e.userChoice.accepted){if(t.feedbackOnAnswers.helpful++,e.aiSuggestion.sources)for(let n of e.aiSuggestion.sources)t.preferredNotes.includes(n)||(t.preferredNotes.push(n),t.preferredNotes.length>10&&t.preferredNotes.shift())}else t.feedbackOnAnswers.notHelpful++}generatePromptContext(){let e=this.store.preferences,t=[],n=e.feedback.referenceLocation;if(n.preference!=="neutral"){let l=n.toLibrary+n.toProject;l>=5&&(n.preference==="library"?t.push(`- \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB294 Library \uC120\uD638 (${l}\uD68C \uC911 ${n.toLibrary}\uD68C)`):t.push(`- \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB294 \uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354 \uC120\uD638 (${l}\uD68C \uC911 ${n.toProject}\uD68C)`))}let i=e.feedback.scheduleDetection;i.falsePositivePatterns.length>0&&t.push(`- \uB2E4\uC74C \uD45C\uD604\uC740 \uC77C\uC815\uC73C\uB85C \uAC10\uC9C0\uD558\uC9C0 \uC54A\uC74C: ${i.falsePositivePatterns.join(", ")}`);let r=e.feedback.projectClassification;r.corrections.length>0&&r.corrections.slice(-3).forEach(u=>{u.keywords.length>0&&t.push(`- "${u.keywords.join(", ")}" \uAD00\uB828 \uB0B4\uC6A9\uC740 ${u.corrected} \uD504\uB85C\uC81D\uD2B8\uB85C \uBD84\uB958`)});let o=e.restructure;if(o.preference!=="neutral"){let l=o.accepted+o.rejected;l>=5&&(o.preference==="restructure"?t.push(`- \uCF58\uD150\uCE20 \uC7AC\uAD6C\uC131 \uC120\uD638 (${l}\uD68C \uC911 ${o.accepted}\uD68C \uC218\uB77D)`):t.push(`- \uC6D0\uBCF8 \uC720\uC9C0 \uC120\uD638 (${l}\uD68C \uC911 ${o.rejected}\uD68C \uAC70\uBD80)`))}return t.length>0?`

## \uC0AC\uC6A9\uC790 \uC120\uD638\uB3C4 (\uC774\uC804 \uD53C\uB4DC\uBC31 \uAE30\uBC18)
${t.join(`
`)}`:""}getPreferences(){return this.store.preferences}getEntries(){return this.store.entries}getStats(){let e=this.store.preferences.feedback.referenceLocation,t=this.store.preferences.feedback.scheduleDetection;return{totalEntries:this.store.entries.length,referenceDecisions:e.toLibrary+e.toProject,scheduleDecisions:t.accepted+t.rejected,lastUpdated:this.store.lastUpdated}}};var _a=require("obsidian");var $w=class extends _a.Modal{constructor(t,n,i){super(t);this.currentStep=1;this.settings={...n},this.onComplete=i}onOpen(){this.contentEl.addClass("zfb-onboarding"),this.renderStep(1)}onClose(){this.contentEl.empty()}renderStep(t){this.currentStep=t;let{contentEl:n}=this;switch(n.empty(),this.renderProgress(n,t),t){case 1:this.renderStep1(n);break;case 2:this.renderStep2(n);break;case 3:this.renderStep3(n);break;case 4:this.renderStep4(n);break}}renderProgress(t,n){let i=t.createDiv({cls:"onboarding-progress"});for(let r=1;r<=nT;r++)i.createSpan({cls:`progress-dot ${r===n?"active":""} ${r<n?"completed":""}`}).setText(r.toString())}renderStep1(t){t.createEl("h2",{text:"1\uB2E8\uACC4: Gemini API \uD0A4 \uC124\uC815"}),t.createEl("p",{text:"\uC774 \uD50C\uB7EC\uADF8\uC778\uC740 Google Gemini AI\uB97C \uC0AC\uC6A9\uD569\uB2C8\uB2E4. \uBB34\uB8CC\uB85C API \uD0A4\uB97C \uBC1C\uAE09\uBC1B\uC744 \uC218 \uC788\uC2B5\uB2C8\uB2E4."}),t.createEl("a",{text:"\u{1F4D6} API \uD0A4 \uBC1C\uAE09 \uAC00\uC774\uB4DC (Google AI Studio)",href:dL}).setAttr("target","_blank"),new _a.Setting(t).setName("Gemini API \uD0A4").setDesc("Google AI Studio\uC5D0\uC11C \uBC1C\uAE09\uBC1B\uC740 \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694").addText(i=>i.setPlaceholder("AIza...").setValue(this.settings.geminiApiKey).onChange(r=>{this.settings.geminiApiKey=r})),this.renderNavButtons(t,1)}renderStep2(t){t.createEl("h2",{text:"2\uB2E8\uACC4: \uD3F4\uB354 \uAD6C\uC870 \uC124\uC815"}),t.createEl("p",{text:"\uB178\uD2B8\uB97C \uC815\uB9AC\uD560 \uD3F4\uB354 \uAD6C\uC870\uB97C \uC790\uB3D9\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4."});let n=t.createDiv({cls:"folder-preview"});n.innerHTML=`
			<pre>\u{1F4C1} 00 _Inbox/        \u2190 \uC5EC\uAE30\uC5D0 \uC4F0\uAE30\uB9CC \uD558\uC138\uC694
\u{1F4C1} 01 Projects/      \u2190 AI\uAC00 \uD504\uB85C\uC81D\uD2B8\uBCC4\uB85C \uC815\uB9AC
\u{1F4C1} 02 Library/       \u2190 \uCC38\uACE0\uC790\uB8CC \uBAA8\uC74C
\u{1F4C1} 03 Archives/      \u2190 \uC644\uB8CC\uB41C \uD56D\uBAA9
\u{1F4C1} 10 Zettelkasten/  \u2190 \uC601\uAD6C \uB178\uD2B8</pre>
		`,new _a.Setting(t).setName("\uD3F4\uB354 \uAD6C\uC870 \uC0DD\uC131").setDesc("\uC704 \uAD6C\uC870\uB85C \uD3F4\uB354\uB97C \uC790\uB3D9 \uC0DD\uC131\uD569\uB2C8\uB2E4").addButton(i=>i.setButtonText("\uD3F4\uB354 \uC0DD\uC131").setCta().onClick(async()=>{await this.createFolderStructure(),new _a.Notice("\uD3F4\uB354 \uAD6C\uC870\uAC00 \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4!"),i.setButtonText("\u2713 \uC644\uB8CC"),i.setDisabled(!0)})),this.renderNavButtons(t,2)}renderStep3(t){t.createEl("h2",{text:"3\uB2E8\uACC4: \uC0AC\uC6A9 \uBAA8\uB4DC \uC120\uD0DD"}),t.createEl("p",{text:"\uC0AC\uC6A9 \uD328\uD134\uC5D0 \uB9DE\uB294 \uBAA8\uB4DC\uB97C \uC120\uD0DD\uD558\uC138\uC694. \uB098\uC911\uC5D0 \uC124\uC815\uC5D0\uC11C \uBCC0\uACBD\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4."});let n=t.createDiv({cls:"preset-cards"}),i=["basic","power","experimental"];for(let r of i){let o=os[r],l=this.settings.preset===r,u=n.createDiv({cls:`preset-card ${l?"selected":""}`});u.createDiv({text:o.icon,cls:"preset-icon"}),u.createDiv({text:o.label,cls:"preset-label"}),u.createDiv({text:o.longDesc,cls:"preset-desc"}),u.addEventListener("click",()=>{n.querySelectorAll(".preset-card").forEach(h=>h.removeClass("selected")),u.addClass("selected"),this.applyPreset(r)})}this.renderNavButtons(t,3)}renderStep4(t){t.createEl("h2",{text:"4\uB2E8\uACC4: \uC2DC\uC791\uD558\uAE30"}),t.createEl("p",{text:"\uC124\uC815\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4! \uC774\uC81C \uC0AC\uC6A9\uD574\uBCF4\uC138\uC694."});let n=t.createDiv({cls:"tips-container"});n.innerHTML=`
			<div class="tip">
				<strong>\u{1F4DD} \uB178\uD2B8 \uBD84\uB958</strong>
				<p>_Inbox\uC5D0 \uB178\uD2B8 \uC791\uC131 \u2192 <kbd>Ctrl+Shift+G</kbd></p>
			</div>
			<div class="tip">
				<strong>\u{1F517} URL \uC694\uC57D</strong>
				<p>\uB178\uD2B8\uC5D0 URL \uBD99\uC5EC\uB123\uAE30 \u2192 <kbd>Ctrl+Shift+U</kbd></p>
			</div>
			<div class="tip">
				<strong>\u{1F916} AI \uCC57\uBD07</strong>
				<p><kbd>Ctrl+Shift+'</kbd>\uB85C \uCC57\uBD07 \uC5F4\uAE30</p>
			</div>
		`;let i=t.createDiv({cls:"modal-button-container"});i.createEl("button",{text:"\uC774\uC804"}).addEventListener("click",()=>this.renderStep(3)),i.createEl("button",{text:"\uC2DC\uC791\uD558\uAE30",cls:"mod-cta"}).addEventListener("click",()=>{this.settings.onboardingCompleted=!0,this.onComplete(this.settings),this.close()})}renderNavButtons(t,n){let i=t.createDiv({cls:"modal-button-container"});n>1&&i.createEl("button",{text:"\uC774\uC804"}).addEventListener("click",()=>this.renderStep(n-1)),n<nT&&i.createEl("button",{text:"\uB2E4\uC74C",cls:"mod-cta"}).addEventListener("click",()=>{if(n===1&&!this.settings.geminiApiKey){new _a.Notice("API \uD0A4\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694");return}this.renderStep(n+1)})}async createFolderStructure(){let t=[this.settings.inboxFolder,this.settings.projectsFolder,this.settings.libraryFolder,this.settings.archivesFolder,this.settings.zettelFolder];for(let n of t)await this.app.vault.adapter.exists(n)||await this.app.vault.createFolder(n)}applyPreset(t){this.settings.preset=t;let n=wb[t];for(let[i,r]of Object.entries(n))xb.includes(i)||(this.settings[i]=r)}};var ar=require("obsidian");var Rm=class{constructor(e,t){this.dayCache=new Map;this.allEventsCache=[];this.fileEventMap=new Map;this.initialized=!1;this.changeListeners=new Set;this.vaultEventRefs=[];this.app=e,this.settings=t}async initialize(){if(this.initialized)return;let e=this.app.vault.getMarkdownFiles();for(let t of e){let n=await this.extractEventsFromFile(t);n.length>0&&(this.fileEventMap.set(t.path,n),this.allEventsCache.push(...n))}this.initialized=!0,this.registerVaultEvents()}registerVaultEvents(){let e=this.app.vault.on("create",async r=>{r instanceof ar.TFile&&r.extension==="md"&&await this.reloadFile(r)});this.vaultEventRefs.push(e);let t=this.app.vault.on("modify",async r=>{r instanceof ar.TFile&&r.extension==="md"&&await this.reloadFile(r)});this.vaultEventRefs.push(t);let n=this.app.vault.on("delete",r=>{r instanceof ar.TFile&&(this.invalidateFile(r.path),this.notifyListeners())});this.vaultEventRefs.push(n);let i=this.app.vault.on("rename",async(r,o)=>{r instanceof ar.TFile&&r.extension==="md"&&(this.invalidateFile(o),await this.reloadFile(r))});this.vaultEventRefs.push(i)}unregisterVaultEvents(){for(let e of this.vaultEventRefs)this.app.vault.offref(e);this.vaultEventRefs=[]}async reloadFile(e){this.invalidateFile(e.path);let t=await this.extractEventsFromFile(e);t.length>0&&(this.fileEventMap.set(e.path,t),this.allEventsCache.push(...t)),this.dayCache.clear(),this.notifyListeners()}invalidateFile(e){this.fileEventMap.get(e)&&(this.allEventsCache=this.allEventsCache.filter(n=>!n.source.path.startsWith(e)),this.fileEventMap.delete(e)),this.dayCache.clear()}addChangeListener(e){this.changeListeners.add(e)}removeChangeListener(e){this.changeListeners.delete(e)}notifyListeners(){for(let e of this.changeListeners)e()}updateSettings(e){this.settings=e}invalidateCache(){this.dayCache.clear(),this.allEventsCache=[],this.fileEventMap.clear(),this.initialized=!1}async getEventsForRange(e,t){return this.initialized||await this.initialize(),this.allEventsCache.filter(n=>n.start>=e&&n.start<=t)}async getEventsForDay(e){if(this.dayCache.has(e))return this.dayCache.get(e);let t=await this.getEventsForRange(new Date(e+"T00:00:00"),new Date(e+"T23:59:59")),n={date:e,notes:t.filter(i=>i.type==="note"),schedules:t.filter(i=>i.type==="schedule"),meetings:t.filter(i=>i.type==="meeting"),total:t.length};return this.dayCache.set(e,n),n}async getEventCountsForMonth(e,t){let n=new Map,i=new Date(e,t,1),r=new Date(e,t+1,0,23,59,59),o=await this.getEventsForRange(i,r);for(let l of o){let u=nn(l.start,this.settings.timezone);n.set(u,(n.get(u)||0)+1)}return n}async extractEventsFromFile(e){let t=[],n=await this.app.vault.cachedRead(e),i=this.parseFrontmatter(n),r=this.determineFileType(e,i),o=this.getEventDate(e,i);if(!o)return t;if(r==="meeting")t.push(this.createEvent(e,i,o,"meeting"));else if(this.isDailyNote(e)){let l=this.extractSchedulesFromDailyNote(e,n,o);t.push(...l)}else t.push(this.createEvent(e,i,o,"note"));return t}parseFrontmatter(e){let t=e.match(/^---\n([\s\S]*?)\n---/);if(!t)return{};try{return(0,ar.parseYaml)(t[1])||{}}catch{return{}}}determineFileType(e,t){return t.type==="meeting"||e.path.includes("\uD68C\uC758\uB85D")||e.path.includes("Meeting")?"meeting":this.isDailyNote(e)?"schedule":"note"}isDailyNote(e){let t=this.settings.dailyNotesFolder;return e.path.startsWith(t)}getEventDate(e,t){let n=["date","created","meetingDate"];for(let r of n){let o=t[r];if(o){let l=this.parseDate(o);if(l)return l}}let i=e.basename.match(/^(\d{4}-\d{2}-\d{2})$/);return i?new Date(i[1]+"T00:00:00"):new Date(e.stat.ctime)}parseDate(e){let t=e.match(/^(\d{4}-\d{2}-\d{2})/);if(t)return new Date(t[1]+"T00:00:00");let n=new Date(e);return isNaN(n.getTime())?null:n}createEvent(e,t,n,i){let r=t.title||e.basename,o=this.getProjectFromPath(e.path),l={note:"var(--interactive-accent)",schedule:"var(--text-success)",meeting:"var(--text-warning)"};return{id:e.path,title:r,start:n,allDay:i==="note"||i==="meeting",type:i,color:l[i],source:{path:e.path},metadata:{project:o,tags:t.tags||[],summary:t.summary||void 0}}}extractSchedulesFromDailyNote(e,t,n){let i=[],r=t.split(`
`);for(let o=0;o<r.length;o++){let l=r[o];if(l.match(/^- \[[ x]\]/)){let u=l.match(/^- \[[ x]\] (\d{1,2}:\d{2})?\s*(.+?)(?:\s+[]\s*(\d{4}-\d{2}-\d{2}))?$/);if(u){let h=u[1],c=u[2].trim().replace(/\s*\(from \[\[.+?\]\]\)\s*$/,"").trim(),a=u[3],f;if(a?f=new Date(a+"T00:00:00"):f=new Date(n),h){let[p,g]=h.split(":").map(Number);f.setHours(p,g,0,0)}i.push({id:`${e.path}:${o}`,title:c,start:f,allDay:!h,type:"schedule",color:"var(--text-success)",source:{path:e.path,lineNumber:o+1},metadata:{project:this.getProjectFromPath(e.path)}})}}}return i}getProjectFromPath(e){let t=this.settings.projectsFolder;if(e.startsWith(t+"/")){let n=e.substring(t.length+1),i=n.indexOf("/");if(i>0)return n.substring(0,i)}}hasTimeComponent(e){return e.getHours()!==0||e.getMinutes()!==0}async moveEvent(e,t){let[n,i]=e.split(":"),r=this.app.vault.getAbstractFileByPath(n);if(!(r instanceof ar.TFile))return!1;let o=await this.app.vault.read(r);if(i){let l=parseInt(i)-1,u=o.split(`
`);if(l>=0&&l<u.length){let h=u[l],d=nn(t,this.settings.timezone),c=h.replace(/[]\s*\d{4}-\d{2}-\d{2}/,`\u{1F4C5} ${d}`);if(c!==h)return u[l]=c,await this.app.vault.modify(r,u.join(`
`)),this.invalidateCache(),!0}}else{let l=nn(t,this.settings.timezone),u=this.updateFrontmatterDate(o,l);if(u!==o)return await this.app.vault.modify(r,u),this.invalidateCache(),!0}return!1}updateFrontmatterDate(e,t){let n=e.match(/^---\n([\s\S]*?)\n---/);if(!n)return e;let i=n[1],r;return i.includes("date:")?r=i.replace(/date:\s*.*/,`date: ${t}`):r=`date: ${t}
${i}`,e.replace(/^---\n[\s\S]*?\n---/,`---
${r}
---`)}async deleteEvent(e){let[t,n]=e.split(":"),i=this.app.vault.getAbstractFileByPath(t);if(!(i instanceof ar.TFile))return!1;if(n){let r=parseInt(n)-1,l=(await this.app.vault.read(i)).split(`
`);if(r>=0&&r<l.length)return l.splice(r,1),await this.app.vault.modify(i,l.join(`
`)),this.invalidateCache(),!0}else return!1;return!1}async openEvent(e){let[t,n]=e.split(":"),i=this.app.vault.getAbstractFileByPath(t);if(i instanceof ar.TFile){let r=this.app.workspace.getLeaf();if(await r.openFile(i),n){let o=parseInt(n)-1,l=r.view;"editor"in l&&l.editor&&l.editor.setCursor({line:o,ch:0})}}}};var U3=require("obsidian");var wa=require("obsidian"),lr=class extends wa.Modal{constructor(t,n,i,r){super(t);this.onEventClick=null;this.isMobileView=!1;this.modalWidth=400;this.date=n,this.dataProvider=i,this.settings=r}setOnEventClick(t){this.onEventClick=t}async onOpen(){let{contentEl:t,modalEl:n}=this;t.empty(),t.addClass("zfb-calendar-day-modal"),n.addClass("zfb-calendar-day-modal-container");let i=document.querySelector(".workspace"),r=i?.offsetWidth||window.innerWidth,o=Math.min(window.innerWidth,r);if(this.isMobileView=wa.Platform.isMobile||o<500,this.modalWidth=Math.min(o-32,400),this.isMobileView){document.documentElement.style.overflowX="hidden",document.body.style.overflowX="hidden",i&&(i.style.overflowX="hidden");let m=n.parentElement;m&&(m.style.setProperty("overflow-x","hidden","important"),m.style.setProperty("width",`${r}px`,"important"),m.style.setProperty("max-width",`${r}px`,"important"),m.style.setProperty("left","auto","important"),m.style.setProperty("right","0","important")),n.style.setProperty("width",`${this.modalWidth}px`,"important"),n.style.setProperty("max-width",`${this.modalWidth}px`,"important"),n.style.setProperty("min-width","0","important"),n.style.setProperty("overflow","hidden","important"),n.style.setProperty("position","relative","important"),n.style.setProperty("left","auto","important"),n.style.setProperty("right","auto","important"),n.style.setProperty("margin","auto","important"),t.style.setProperty("width","100%","important"),t.style.setProperty("max-width","100%","important"),t.style.setProperty("min-width","0","important"),t.style.setProperty("padding","16px","important"),t.style.setProperty("overflow","hidden","important"),t.style.setProperty("box-sizing","border-box","important"),t.style.setProperty("word-break","break-word","important")}t.createEl("p",{text:"\uB85C\uB529 \uC911..."});let l=await this.dataProvider.getEventsForDay(this.date);t.empty();let u=new Date(this.date+"T00:00:00"),d=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"][u.getDay()],c=t.createDiv({cls:"day-modal-header"});c.style.marginBottom="16px",c.style.overflow="hidden",c.style.maxWidth="100%",this.isMobileView&&c.style.setProperty("width",`${this.modalWidth-32}px`,"important");let a=c.createEl("h2",{text:`${this.date} (${d}\uC694\uC77C)`});if(a.style.margin="0",a.style.overflow="hidden",a.style.textOverflow="ellipsis",a.style.whiteSpace="nowrap",this.isMobileView&&a.style.setProperty("max-width",`${this.modalWidth-48}px`,"important"),c.createEl("p",{text:`\uCD1D ${l.total}\uAC1C \uD56D\uBAA9`,cls:"setting-item-description"}).style.margin="4px 0 0 0",l.total===0){let m=t.createDiv({cls:"day-modal-empty"});m.style.padding="32px",m.style.textAlign="center",m.style.color="var(--text-muted)",m.setText("\uC774 \uB0A0\uC9DC\uC5D0 \uB4F1\uB85D\uB41C \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let f=t.createDiv({cls:"day-modal-sections"});f.style.maxHeight=this.isMobileView?"50vh":"400px",f.style.overflowY="auto",f.style.overflowX="hidden",this.isMobileView&&(f.style.setProperty("width",`${this.modalWidth-32}px`,"important"),f.style.setProperty("max-width",`${this.modalWidth-32}px`,"important")),l.schedules.length>0&&this.renderSection(f,"\uC77C\uC815",l.schedules,"schedule"),l.notes.length>0&&this.renderSection(f,"\uB178\uD2B8",l.notes,"note"),l.meetings.length>0&&this.renderSection(f,"\uD68C\uC758\uB85D",l.meetings,"meeting");let p=t.createDiv({cls:"modal-button-container"});p.style.display="flex",p.style.justifyContent="flex-end",p.style.marginTop="16px",p.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close())}renderSection(t,n,i,r){let o={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"},l=this.isMobileView?this.modalWidth-56:void 0,u=t.createDiv({cls:"day-section"});u.style.marginBottom="16px",u.style.overflow="hidden",u.style.maxWidth="100%",this.isMobileView&&u.style.setProperty("width",`${this.modalWidth-32}px`,"important");let h=u.createDiv({cls:"section-header"});h.style.display="flex",h.style.alignItems="center",h.style.gap="8px",h.style.marginBottom="8px",h.createEl("span",{text:o[r]}),h.createEl("span",{text:`${n} (${i.length})`}).style.fontWeight="500";let d=u.createDiv({cls:"section-list"});d.style.overflow="hidden",d.style.maxWidth="100%",this.isMobileView&&d.style.setProperty("width",`${this.modalWidth-32}px`,"important");for(let c of i){let a=d.createDiv({cls:"event-item"});a.style.display="flex",a.style.alignItems="center",a.style.padding="8px 12px",a.style.marginBottom="4px",a.style.border="1px solid var(--background-modifier-border)",a.style.borderRadius="6px",a.style.cursor="pointer",a.style.transition="background-color 0.15s",a.style.overflow="hidden",a.style.maxWidth="100%",a.style.boxSizing="border-box",this.isMobileView&&l&&(a.style.setProperty("width",`${l}px`,"important"),a.style.setProperty("max-width",`${l}px`,"important"));let f=a.createDiv({cls:"event-indicator"});f.style.width="4px",f.style.height="24px",f.style.borderRadius="2px",f.style.marginRight="12px",f.style.flexShrink="0",f.style.backgroundColor=c.color||"var(--interactive-accent)";let p=a.createDiv({cls:"event-info"});p.createEl("div",{text:c.title,cls:"event-title"});let g=p.createEl("div",{cls:"event-detail"}),m=[];if(c.allDay)m.push("\uC885\uC77C");else{let y=c.start.getHours().toString().padStart(2,"0"),_=c.start.getMinutes().toString().padStart(2,"0");m.push(`${y}:${_}`)}if(c.metadata?.project&&m.push(c.metadata.project),g.setText(m.join(" | ")),a.addEventListener("mouseenter",()=>{a.style.backgroundColor="var(--background-modifier-hover)"}),a.addEventListener("mouseleave",()=>{a.style.backgroundColor=""}),a.setAttribute("title",c.title),wa.Platform.isMobile||a.addEventListener("mouseover",y=>{(y.ctrlKey||y.metaKey)&&this.app.workspace.trigger("hover-link",{event:y,source:"calendar-day-modal",hoverParent:a,targetEl:a,linktext:c.id})}),wa.Platform.isMobile){let y=null,_=!1;a.addEventListener("touchstart",x=>{_=!1,y=setTimeout(()=>{_=!0,new wa.Notice(c.title,3e3)},500)}),a.addEventListener("touchend",()=>{y&&(clearTimeout(y),y=null)}),a.addEventListener("touchmove",()=>{y&&(clearTimeout(y),y=null)})}a.addEventListener("click",async()=>{this.onEventClick?this.onEventClick(c):(await this.dataProvider.openEvent(c.id),this.close())})}}onClose(){if(this.isMobileView){document.documentElement.style.overflowX="",document.body.style.overflowX="";let t=document.querySelector(".workspace");t&&(t.style.overflowX="")}this.contentEl.empty()}};var Ih="zfb-mini-calendar",Pm=class extends U3.ItemView{constructor(t,n,i){super(t);this.eventCounts=new Map;this.settings=n,this.dataProvider=i;let r=new Date;this.currentYear=r.getFullYear(),this.currentMonth=r.getMonth(),this.refreshCallback=()=>this.renderCalendar()}getViewType(){return Ih}getDisplayText(){return"\uCE98\uB9B0\uB354"}getIcon(){return"calendar"}async onOpen(){this.dataProvider.addChangeListener(this.refreshCallback),await this.renderCalendar()}async onClose(){this.dataProvider.removeChangeListener(this.refreshCallback),this.contentEl.empty()}updateSettings(t){this.settings=t,this.renderCalendar()}async renderCalendar(){let t=this.contentEl;t.empty(),t.addClass("zfb-mini-calendar"),this.eventCounts=await this.dataProvider.getEventCountsForMonth(this.currentYear,this.currentMonth),this.renderHeader(t),this.renderWeekdayHeader(t),this.renderDateGrid(t),this.renderTodayButton(t)}renderHeader(t){let n=t.createDiv({cls:"mini-calendar-header"});n.createEl("button",{cls:"nav-btn",text:"<"}).addEventListener("click",()=>this.navigateMonth(-1));let r=["1\uC6D4","2\uC6D4","3\uC6D4","4\uC6D4","5\uC6D4","6\uC6D4","7\uC6D4","8\uC6D4","9\uC6D4","10\uC6D4","11\uC6D4","12\uC6D4"];n.createEl("span",{cls:"month-title",text:`${this.currentYear}\uB144 ${r[this.currentMonth]}`}),n.createEl("button",{cls:"nav-btn",text:">"}).addEventListener("click",()=>this.navigateMonth(1))}renderWeekdayHeader(t){let n=t.createDiv({cls:"weekday-header"}),i=this.settings.calendarFirstDayOfWeek===1?["\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0","\uC77C"]:["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"];for(let r of i)n.createEl("span",{text:r})}renderDateGrid(t){let n=t.createDiv({cls:"date-grid"}),i=new Date(this.currentYear,this.currentMonth,1),r=new Date(this.currentYear,this.currentMonth+1,0),o=i.getDay();this.settings.calendarFirstDayOfWeek===1&&(o=o===0?6:o-1);let l=nn(new Date,this.settings.timezone);for(let u=0;u<o;u++)n.createDiv({cls:"date-cell empty"});for(let u=1;u<=r.getDate();u++){let h=`${this.currentYear}-${String(this.currentMonth+1).padStart(2,"0")}-${String(u).padStart(2,"0")}`,d=this.eventCounts.get(h)||0,c=h===l,a=n.createDiv({cls:"date-cell"});if(c&&a.addClass("today"),a.createEl("span",{cls:"day-number",text:String(u)}),d>0){let f=a.createDiv({cls:"event-dots"}),p=Math.min(d,3);for(let g=0;g<p;g++)f.createDiv({cls:"event-dot"})}a.addEventListener("click",()=>{this.openDayModal(h)})}}renderTodayButton(t){t.createDiv({cls:"today-btn-container"}).createEl("button",{cls:"today-btn",text:"\uC624\uB298"}).addEventListener("click",()=>{let r=new Date;this.currentYear=r.getFullYear(),this.currentMonth=r.getMonth(),this.renderCalendar()})}navigateMonth(t){this.currentMonth+=t,this.currentMonth<0?(this.currentMonth=11,this.currentYear--):this.currentMonth>11&&(this.currentMonth=0,this.currentYear++),this.renderCalendar()}openDayModal(t){new lr(this.app,t,this.dataProvider,this.settings).open()}};var f4=require("obsidian");var Hw,Te,G3,H1,Dh,Mc,B3,j3,W3,Bw={},q3=[],zY=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function xa(s,e){for(var t in e)s[t]=e[t];return s}function Y3(s){var e=s.parentNode;e&&e.removeChild(s)}function G(s,e,t){var n,i,r,o={};for(r in e)r=="key"?n=e[r]:r=="ref"?i=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?Hw.call(arguments,2):t),typeof s=="function"&&s.defaultProps!=null)for(r in s.defaultProps)o[r]===void 0&&(o[r]=s.defaultProps[r]);return Uw(s,o,n,i,null)}function Uw(s,e,t,n,i){var r={type:s,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:i??++G3};return i==null&&Te.vnode!=null&&Te.vnode(r),r}function Qt(){return{current:null}}function st(s){return s.children}function HY(s,e,t,n,i){var r;for(r in t)r==="children"||r==="key"||r in e||Vw(s,r,null,t[r],n);for(r in e)i&&typeof e[r]!="function"||r==="children"||r==="key"||r==="value"||r==="checked"||t[r]===e[r]||Vw(s,r,e[r],t[r],n)}function V3(s,e,t){e[0]==="-"?s.setProperty(e,t??""):s[e]=t==null?"":typeof t!="number"||zY.test(e)?t:t+"px"}function Vw(s,e,t,n,i){var r;e:if(e==="style")if(typeof t=="string")s.style.cssText=t;else{if(typeof n=="string"&&(s.style.cssText=n=""),n)for(e in n)t&&e in t||V3(s.style,e,"");if(t)for(e in t)n&&t[e]===n[e]||V3(s.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")r=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in s?e.toLowerCase().slice(2):e.slice(2),s.l||(s.l={}),s.l[e+r]=t,t?n||s.addEventListener(e,r?H3:z3,r):s.removeEventListener(e,r?H3:z3,r);else if(e!=="dangerouslySetInnerHTML"){if(i)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in s)try{s[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e.indexOf("-")==-1?s.removeAttribute(e):s.setAttribute(e,t))}}function z3(s){Dh=!0;try{return this.l[s.type+!1](Te.event?Te.event(s):s)}finally{Dh=!1}}function H3(s){Dh=!0;try{return this.l[s.type+!0](Te.event?Te.event(s):s)}finally{Dh=!1}}function Rn(s,e){this.props=s,this.context=e}function Mm(s,e){if(e==null)return s.__?Mm(s.__,s.__.__k.indexOf(s)+1):null;for(var t;e<s.__k.length;e++)if((t=s.__k[e])!=null&&t.__e!=null)return t.__e;return typeof s.type=="function"?Mm(s):null}function K3(s){var e,t;if((s=s.__)!=null&&s.__c!=null){for(s.__e=s.__c.base=null,e=0;e<s.__k.length;e++)if((t=s.__k[e])!=null&&t.__e!=null){s.__e=s.__c.base=t.__e;break}return K3(s)}}function GY(s){Dh?setTimeout(s):j3(s)}function z1(s){(!s.__d&&(s.__d=!0)&&Mc.push(s)&&!zw.__r++||B3!==Te.debounceRendering)&&((B3=Te.debounceRendering)||GY)(zw)}function zw(){var s,e,t,n,i,r,o,l;for(Mc.sort(function(u,h){return u.__v.__b-h.__v.__b});s=Mc.shift();)s.__d&&(e=Mc.length,n=void 0,i=void 0,o=(r=(t=s).__v).__e,(l=t.__P)&&(n=[],(i=xa({},r)).__v=r.__v+1,G1(l,r,i,t.__n,l.ownerSVGElement!==void 0,r.__h!=null?[o]:null,n,o??Mm(r),r.__h),eV(n,r),r.__e!=o&&K3(r)),Mc.length>e&&Mc.sort(function(u,h){return u.__v.__b-h.__v.__b}));zw.__r=0}function X3(s,e,t,n,i,r,o,l,u,h){var d,c,a,f,p,g,m,y=n&&n.__k||q3,_=y.length;for(t.__k=[],d=0;d<e.length;d++)if((f=t.__k[d]=(f=e[d])==null||typeof f=="boolean"?null:typeof f=="string"||typeof f=="number"||typeof f=="bigint"?Uw(null,f,null,null,f):Array.isArray(f)?Uw(st,{children:f},null,null,null):f.__b>0?Uw(f.type,f.props,f.key,f.ref?f.ref:null,f.__v):f)!=null){if(f.__=t,f.__b=t.__b+1,(a=y[d])===null||a&&f.key==a.key&&f.type===a.type)y[d]=void 0;else for(c=0;c<_;c++){if((a=y[c])&&f.key==a.key&&f.type===a.type){y[c]=void 0;break}a=null}G1(s,f,a=a||Bw,i,r,o,l,u,h),p=f.__e,(c=f.ref)&&a.ref!=c&&(m||(m=[]),a.ref&&m.push(a.ref,null,f),m.push(c,f.__c||p,f)),p!=null?(g==null&&(g=p),typeof f.type=="function"&&f.__k===a.__k?f.__d=u=J3(f,u,s):u=Z3(s,f,a,y,p,u),typeof t.type=="function"&&(t.__d=u)):u&&a.__e==u&&u.parentNode!=s&&(u=Mm(a))}for(t.__e=g,d=_;d--;)y[d]!=null&&(typeof t.type=="function"&&y[d].__e!=null&&y[d].__e==t.__d&&(t.__d=Q3(n).nextSibling),nV(y[d],y[d]));if(m)for(d=0;d<m.length;d++)tV(m[d],m[++d],m[++d])}function J3(s,e,t){for(var n,i=s.__k,r=0;i&&r<i.length;r++)(n=i[r])&&(n.__=s,e=typeof n.type=="function"?J3(n,e,t):Z3(t,n,n,i,n.__e,e));return e}function Nm(s,e){return e=e||[],s==null||typeof s=="boolean"||(Array.isArray(s)?s.some(function(t){Nm(t,e)}):e.push(s)),e}function Z3(s,e,t,n,i,r){var o,l,u;if(e.__d!==void 0)o=e.__d,e.__d=void 0;else if(t==null||i!=r||i.parentNode==null)e:if(r==null||r.parentNode!==s)s.appendChild(i),o=null;else{for(l=r,u=0;(l=l.nextSibling)&&u<n.length;u+=1)if(l==i)break e;s.insertBefore(i,r),o=r}return o!==void 0?o:i.nextSibling}function Q3(s){var e,t,n;if(s.type==null||typeof s.type=="string")return s.__e;if(s.__k){for(e=s.__k.length-1;e>=0;e--)if((t=s.__k[e])&&(n=Q3(t)))return n}return null}function G1(s,e,t,n,i,r,o,l,u){var h,d,c,a,f,p,g,m,y,_,x,E,S,T,C,I=e.type;if(e.constructor!==void 0)return null;t.__h!=null&&(u=t.__h,l=e.__e=t.__e,e.__h=null,r=[l]),(h=Te.__b)&&h(e);try{e:if(typeof I=="function"){if(m=e.props,y=(h=I.contextType)&&n[h.__c],_=h?y?y.props.value:h.__:n,t.__c?g=(d=e.__c=t.__c).__=d.__E:("prototype"in I&&I.prototype.render?e.__c=d=new I(m,_):(e.__c=d=new Rn(m,_),d.constructor=I,d.render=WY),y&&y.sub(d),d.props=m,d.state||(d.state={}),d.context=_,d.__n=n,c=d.__d=!0,d.__h=[],d._sb=[]),d.__s==null&&(d.__s=d.state),I.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=xa({},d.__s)),xa(d.__s,I.getDerivedStateFromProps(m,d.__s))),a=d.props,f=d.state,d.__v=e,c)I.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(I.getDerivedStateFromProps==null&&m!==a&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(m,_),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(m,d.__s,_)===!1||e.__v===t.__v){for(e.__v!==t.__v&&(d.props=m,d.state=d.__s,d.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.forEach(function(A){A&&(A.__=e)}),x=0;x<d._sb.length;x++)d.__h.push(d._sb[x]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(m,d.__s,_),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(a,f,p)})}if(d.context=_,d.props=m,d.__P=s,E=Te.__r,S=0,"prototype"in I&&I.prototype.render){for(d.state=d.__s,d.__d=!1,E&&E(e),h=d.render(d.props,d.state,d.context),T=0;T<d._sb.length;T++)d.__h.push(d._sb[T]);d._sb=[]}else do d.__d=!1,E&&E(e),h=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++S<25);d.state=d.__s,d.getChildContext!=null&&(n=xa(xa({},n),d.getChildContext())),c||d.getSnapshotBeforeUpdate==null||(p=d.getSnapshotBeforeUpdate(a,f)),C=h!=null&&h.type===st&&h.key==null?h.props.children:h,X3(s,Array.isArray(C)?C:[C],e,t,n,i,r,o,l,u),d.base=e.__e,e.__h=null,d.__h.length&&o.push(d),g&&(d.__E=d.__=null),d.__e=!1}else r==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=jY(t.__e,e,t,n,i,r,o,u);(h=Te.diffed)&&h(e)}catch(A){e.__v=null,(u||r!=null)&&(e.__e=l,e.__h=!!u,r[r.indexOf(l)]=null),Te.__e(A,e,t)}}function eV(s,e){Te.__c&&Te.__c(e,s),s.some(function(t){try{s=t.__h,t.__h=[],s.some(function(n){n.call(t)})}catch(n){Te.__e(n,t.__v)}})}function jY(s,e,t,n,i,r,o,l){var u,h,d,c=t.props,a=e.props,f=e.type,p=0;if(f==="svg"&&(i=!0),r!=null){for(;p<r.length;p++)if((u=r[p])&&"setAttribute"in u==!!f&&(f?u.localName===f:u.nodeType===3)){s=u,r[p]=null;break}}if(s==null){if(f===null)return document.createTextNode(a);s=i?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,a.is&&a),r=null,l=!1}if(f===null)c===a||l&&s.data===a||(s.data=a);else{if(r=r&&Hw.call(s.childNodes),h=(c=t.props||Bw).dangerouslySetInnerHTML,d=a.dangerouslySetInnerHTML,!l){if(r!=null)for(c={},p=0;p<s.attributes.length;p++)c[s.attributes[p].name]=s.attributes[p].value;(d||h)&&(d&&(h&&d.__html==h.__html||d.__html===s.innerHTML)||(s.innerHTML=d&&d.__html||""))}if(HY(s,a,c,i,l),d)e.__k=[];else if(p=e.props.children,X3(s,Array.isArray(p)?p:[p],e,t,n,i&&f!=="foreignObject",r,o,r?r[0]:t.__k&&Mm(t,0),l),r!=null)for(p=r.length;p--;)r[p]!=null&&Y3(r[p]);l||("value"in a&&(p=a.value)!==void 0&&(p!==s.value||f==="progress"&&!p||f==="option"&&p!==c.value)&&Vw(s,"value",p,c.value,!1),"checked"in a&&(p=a.checked)!==void 0&&p!==s.checked&&Vw(s,"checked",p,c.checked,!1))}return s}function tV(s,e,t){try{typeof s=="function"?s(e):s.current=e}catch(n){Te.__e(n,t)}}function nV(s,e,t){var n,i;if(Te.unmount&&Te.unmount(s),(n=s.ref)&&(n.current&&n.current!==s.__e||tV(n,null,e)),(n=s.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(r){Te.__e(r,e)}n.base=n.__P=null,s.__c=void 0}if(n=s.__k)for(i=0;i<n.length;i++)n[i]&&nV(n[i],e,t||typeof s.type!="function");t||s.__e==null||Y3(s.__e),s.__=s.__e=s.__d=void 0}function WY(s,e,t){return this.constructor(s,t)}function Ea(s,e,t){var n,i,r;Te.__&&Te.__(s,e),i=(n=typeof t=="function")?null:t&&t.__k||e.__k,r=[],G1(e,s=(!n&&t||e).__k=G(st,null,[s]),i||Bw,Bw,e.ownerSVGElement!==void 0,!n&&t?[t]:i?null:e.firstChild?Hw.call(e.childNodes):null,r,!n&&t?t:i?i.__e:e.firstChild,n),eV(r,s)}function Gw(s,e){var t={__c:e="__cC"+W3++,__:s,Consumer:function(n,i){return n.children(i)},Provider:function(n){var i,r;return this.getChildContext||(i=[],(r={})[e]=this,this.getChildContext=function(){return r},this.shouldComponentUpdate=function(o){this.props.value!==o.value&&i.some(function(l){l.__e=!0,z1(l)})},this.sub=function(o){i.push(o);var l=o.componentWillUnmount;o.componentWillUnmount=function(){i.splice(i.indexOf(o),1),l&&l.call(o)}}),n.children}};return t.Provider.__=t.Consumer.contextType=t}Hw=q3.slice,Te={__e:function(s,e,t,n){for(var i,r,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((r=i.constructor)&&r.getDerivedStateFromError!=null&&(i.setState(r.getDerivedStateFromError(s)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(s,n||{}),o=i.__d),o)return i.__E=i}catch(l){s=l}throw s}},G3=0,H1=function(s){return s!=null&&s.constructor===void 0},Dh=!1,Rn.prototype.setState=function(s,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=xa({},this.state),typeof s=="function"&&(s=s(xa({},t),this.props)),s&&xa(t,s),s!=null&&this.__v&&(e&&this._sb.push(e),z1(this))},Rn.prototype.forceUpdate=function(s){this.__v&&(this.__e=!0,s&&this.__h.push(s),z1(this))},Rn.prototype.render=st,Mc=[],j3=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,zw.__r=0,W3=0;var YY,cr,j1,sV;var uV=[],W1=[],iV=Te.__b,rV=Te.__r,oV=Te.diffed,aV=Te.__c,lV=Te.unmount;function KY(){for(var s;s=uV.shift();)if(s.__P&&s.__H)try{s.__H.__h.forEach(jw),s.__H.__h.forEach(q1),s.__H.__h=[]}catch(e){s.__H.__h=[],Te.__e(e,s.__v)}}Te.__b=function(s){cr=null,iV&&iV(s)},Te.__r=function(s){rV&&rV(s),YY=0;var e=(cr=s.__c).__H;e&&(j1===cr?(e.__h=[],cr.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.__V=W1,t.__N=t.i=void 0})):(e.__h.forEach(jw),e.__h.forEach(q1),e.__h=[])),j1=cr},Te.diffed=function(s){oV&&oV(s);var e=s.__c;e&&e.__H&&(e.__H.__h.length&&(uV.push(e)!==1&&sV===Te.requestAnimationFrame||((sV=Te.requestAnimationFrame)||XY)(KY)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.__V!==W1&&(t.__=t.__V),t.i=void 0,t.__V=W1})),j1=cr=null},Te.__c=function(s,e){e.some(function(t){try{t.__h.forEach(jw),t.__h=t.__h.filter(function(n){return!n.__||q1(n)})}catch(n){e.some(function(i){i.__h&&(i.__h=[])}),e=[],Te.__e(n,t.__v)}}),aV&&aV(s,e)},Te.unmount=function(s){lV&&lV(s);var e,t=s.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{jw(n)}catch(i){e=i}}),t.__H=void 0,e&&Te.__e(e,t.__v))};var cV=typeof requestAnimationFrame=="function";function XY(s){var e,t=function(){clearTimeout(n),cV&&cancelAnimationFrame(e),setTimeout(s)},n=setTimeout(t,100);cV&&(e=requestAnimationFrame(t))}function jw(s){var e=cr,t=s.__c;typeof t=="function"&&(s.__c=void 0,t()),cr=e}function q1(s){var e=cr;s.__c=s.__(),cr=e}function JY(s,e){for(var t in e)s[t]=e[t];return s}function dV(s,e){for(var t in s)if(t!=="__source"&&!(t in e))return!0;for(var n in e)if(n!=="__source"&&s[n]!==e[n])return!0;return!1}function hV(s){this.props=s}(hV.prototype=new Rn).isPureReactComponent=!0,hV.prototype.shouldComponentUpdate=function(s,e){return dV(this.props,s)||dV(this.state,e)};var fV=Te.__b;Te.__b=function(s){s.type&&s.type.__f&&s.ref&&(s.props.ref=s.ref,s.ref=null),fV&&fV(s)};var xne=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;var ZY=Te.__e;Te.__e=function(s,e,t,n){if(s.then){for(var i,r=e;r=r.__;)if((i=r.__c)&&i.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),i.__c(s,e)}ZY(s,e,t,n)};var pV=Te.unmount;function _V(s,e,t){return s&&(s.__c&&s.__c.__H&&(s.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),s.__c.__H=null),(s=JY({},s)).__c!=null&&(s.__c.__P===t&&(s.__c.__P=e),s.__c=null),s.__k=s.__k&&s.__k.map(function(n){return _V(n,e,t)})),s}function wV(s,e,t){return s&&(s.__v=null,s.__k=s.__k&&s.__k.map(function(n){return wV(n,e,t)}),s.__c&&s.__c.__P===e&&(s.__e&&t.insertBefore(s.__e,s.__d),s.__c.__e=!0,s.__c.__P=t)),s}function Y1(){this.__u=0,this.t=null,this.__b=null}function xV(s){var e=s.__.__c;return e&&e.__a&&e.__a(s)}function Ww(){this.u=null,this.o=null}Te.unmount=function(s){var e=s.__c;e&&e.__R&&e.__R(),e&&s.__h===!0&&(s.type=null),pV&&pV(s)},(Y1.prototype=new Rn).__c=function(s,e){var t=e.__c,n=this;n.t==null&&(n.t=[]),n.t.push(t);var i=xV(n.__v),r=!1,o=function(){r||(r=!0,t.__R=null,i?i(l):l())};t.__R=o;var l=function(){if(!--n.__u){if(n.state.__a){var h=n.state.__a;n.__v.__k[0]=wV(h,h.__c.__P,h.__c.__O)}var d;for(n.setState({__a:n.__b=null});d=n.t.pop();)d.forceUpdate()}},u=e.__h===!0;n.__u++||u||n.setState({__a:n.__b=n.__v.__k[0]}),s.then(o,o)},Y1.prototype.componentWillUnmount=function(){this.t=[]},Y1.prototype.render=function(s,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=_V(this.__b,t,n.__O=n.__P)}this.__b=null}var i=e.__a&&G(st,null,s.fallback);return i&&(i.__h=null),[G(st,null,e.__a?null:s.children),i]};var gV=function(s,e,t){if(++t[1]===t[0]&&s.o.delete(e),s.props.revealOrder&&(s.props.revealOrder[0]!=="t"||!s.o.size))for(t=s.u;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;s.u=t=t[2]}};function QY(s){return this.getChildContext=function(){return s.context},s.children}function eK(s){var e=this,t=s.i;e.componentWillUnmount=function(){Ea(null,e.l),e.l=null,e.i=null},e.i&&e.i!==t&&e.componentWillUnmount(),s.__v?(e.l||(e.i=t,e.l={nodeType:1,parentNode:t,childNodes:[],appendChild:function(n){this.childNodes.push(n),e.i.appendChild(n)},insertBefore:function(n,i){this.childNodes.push(n),e.i.appendChild(n)},removeChild:function(n){this.childNodes.splice(this.childNodes.indexOf(n)>>>1,1),e.i.removeChild(n)}}),Ea(G(QY,{context:e.context},s.__v),e.l)):e.l&&e.componentWillUnmount()}function EV(s,e){var t=G(eK,{__v:s,i:e});return t.containerInfo=e,t}(Ww.prototype=new Rn).__a=function(s){var e=this,t=xV(e.__v),n=e.o.get(s);return n[0]++,function(i){var r=function(){e.props.revealOrder?(n.push(i),gV(e,s,n)):i()};t?t(r):r()}},Ww.prototype.render=function(s){this.u=null,this.o=new Map;var e=Nm(s.children);s.revealOrder&&s.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.o.set(e[t],this.u=[1,0,this.u]);return s.children},Ww.prototype.componentDidUpdate=Ww.prototype.componentDidMount=function(){var s=this;this.o.forEach(function(e,t){gV(s,t,e)})};var tK=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,nK=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,sK=typeof document<"u",iK=function(s){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(s)};Rn.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(s){Object.defineProperty(Rn.prototype,s,{configurable:!0,get:function(){return this["UNSAFE_"+s]},set:function(e){Object.defineProperty(this,s,{configurable:!0,writable:!0,value:e})}})});var mV=Te.event;function rK(){}function oK(){return this.cancelBubble}function aK(){return this.defaultPrevented}Te.event=function(s){return mV&&(s=mV(s)),s.persist=rK,s.isPropagationStopped=oK,s.isDefaultPrevented=aK,s.nativeEvent=s};var lK,yV={configurable:!0,get:function(){return this.class}},bV=Te.vnode;Te.vnode=function(s){var e=s.type,t=s.props,n=t;if(typeof e=="string"){var i=e.indexOf("-")===-1;for(var r in n={},t){var o=t[r];sK&&r==="children"&&e==="noscript"||r==="value"&&"defaultValue"in t&&o==null||(r==="defaultValue"&&"value"in t&&t.value==null?r="value":r==="download"&&o===!0?o="":/ondoubleclick/i.test(r)?r="ondblclick":/^onchange(textarea|input)/i.test(r+e)&&!iK(t.type)?r="oninput":/^onfocus$/i.test(r)?r="onfocusin":/^onblur$/i.test(r)?r="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(r)?r=r.toLowerCase():i&&nK.test(r)?r=r.replace(/[A-Z0-9]/g,"-$&").toLowerCase():o===null&&(o=void 0),/^oninput$/i.test(r)&&(r=r.toLowerCase(),n[r]&&(r="oninputCapture")),n[r]=o)}e=="select"&&n.multiple&&Array.isArray(n.value)&&(n.value=Nm(t.children).forEach(function(l){l.props.selected=n.value.indexOf(l.props.value)!=-1})),e=="select"&&n.defaultValue!=null&&(n.value=Nm(t.children).forEach(function(l){l.props.selected=n.multiple?n.defaultValue.indexOf(l.props.value)!=-1:n.defaultValue==l.props.value})),s.props=n,t.class!=t.className&&(yV.enumerable="className"in t,t.className!=null&&(n.class=t.className),Object.defineProperty(n,"className",yV))}s.$$typeof=tK,bV&&bV(s)};var vV=Te.__r;Te.__r=function(s){vV&&vV(s),lK=s.__c};var LV=[],rI=new Map;function Ra(s){LV.push(s),rI.forEach(e=>{BV(e,s)})}function $V(s){s.isConnected&&s.getRootNode&&UV(s.getRootNode())}function UV(s){let e=rI.get(s);if(!e||!e.isConnected){if(e=s.querySelector("style[data-fullcalendar]"),!e){e=document.createElement("style"),e.setAttribute("data-fullcalendar","");let t=uK();t&&(e.nonce=t);let n=s===document?document.head:s,i=s===document?n.querySelector("script,link[rel=stylesheet],link[as=style],style"):n.firstChild;n.insertBefore(e,i)}rI.set(s,e),cK(e)}}function cK(s){for(let e of LV)BV(s,e)}function BV(s,e){let{sheet:t}=s,n=t.cssRules.length;e.split("}").forEach((i,r)=>{i=i.trim(),i&&t.insertRule(i+"}",n+r)})}var K1;function uK(){return K1===void 0&&(K1=dK()),K1}function dK(){let s=document.querySelector('meta[name="csp-nonce"]');if(s&&s.hasAttribute("content"))return s.getAttribute("content");let e=document.querySelector("script[nonce]");return e&&e.nonce||""}typeof document<"u"&&UV(document);var hK=':root{--fc-small-font-size:.85em;--fc-page-bg-color:#fff;--fc-neutral-bg-color:hsla(0,0%,82%,.3);--fc-neutral-text-color:grey;--fc-border-color:#ddd;--fc-button-text-color:#fff;--fc-button-bg-color:#2c3e50;--fc-button-border-color:#2c3e50;--fc-button-hover-bg-color:#1e2b37;--fc-button-hover-border-color:#1a252f;--fc-button-active-bg-color:#1a252f;--fc-button-active-border-color:#151e27;--fc-event-bg-color:#3788d8;--fc-event-border-color:#3788d8;--fc-event-text-color:#fff;--fc-event-selected-overlay-color:rgba(0,0,0,.25);--fc-more-link-bg-color:#d0d0d0;--fc-more-link-text-color:inherit;--fc-event-resizer-thickness:8px;--fc-event-resizer-dot-total-width:8px;--fc-event-resizer-dot-border-width:1px;--fc-non-business-color:hsla(0,0%,84%,.3);--fc-bg-event-color:#8fdf82;--fc-bg-event-opacity:0.3;--fc-highlight-color:rgba(188,232,241,.3);--fc-today-bg-color:rgba(255,220,40,.15);--fc-now-indicator-color:red}.fc-not-allowed,.fc-not-allowed .fc-event{cursor:not-allowed}.fc{display:flex;flex-direction:column;font-size:1em}.fc,.fc *,.fc :after,.fc :before{box-sizing:border-box}.fc table{border-collapse:collapse;border-spacing:0;font-size:1em}.fc th{text-align:center}.fc td,.fc th{padding:0;vertical-align:top}.fc a[data-navlink]{cursor:pointer}.fc a[data-navlink]:hover{text-decoration:underline}.fc-direction-ltr{direction:ltr;text-align:left}.fc-direction-rtl{direction:rtl;text-align:right}.fc-theme-standard td,.fc-theme-standard th{border:1px solid var(--fc-border-color)}.fc-liquid-hack td,.fc-liquid-hack th{position:relative}@font-face{font-family:fcicons;font-style:normal;font-weight:400;src:url("data:application/x-font-ttf;charset=utf-8;base64,AAEAAAALAIAAAwAwT1MvMg8SBfAAAAC8AAAAYGNtYXAXVtKNAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZgYydxIAAAF4AAAFNGhlYWQUJ7cIAAAGrAAAADZoaGVhB20DzAAABuQAAAAkaG10eCIABhQAAAcIAAAALGxvY2ED4AU6AAAHNAAAABhtYXhwAA8AjAAAB0wAAAAgbmFtZXsr690AAAdsAAABhnBvc3QAAwAAAAAI9AAAACAAAwPAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBgPA/8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qb//f//AAAAAAAg6QD//f//AAH/4xcEAAMAAQAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAWIAjQKeAskAEwAAJSc3NjQnJiIHAQYUFwEWMjc2NCcCnuLiDQ0MJAz/AA0NAQAMJAwNDcni4gwjDQwM/wANIwz/AA0NDCMNAAAAAQFiAI0CngLJABMAACUBNjQnASYiBwYUHwEHBhQXFjI3AZ4BAA0N/wAMJAwNDeLiDQ0MJAyNAQAMIw0BAAwMDSMM4uINIwwNDQAAAAIA4gC3Ax4CngATACcAACUnNzY0JyYiDwEGFB8BFjI3NjQnISc3NjQnJiIPAQYUHwEWMjc2NCcB87e3DQ0MIw3VDQ3VDSMMDQ0BK7e3DQ0MJAzVDQ3VDCQMDQ3zuLcMJAwNDdUNIwzWDAwNIwy4twwkDA0N1Q0jDNYMDA0jDAAAAgDiALcDHgKeABMAJwAAJTc2NC8BJiIHBhQfAQcGFBcWMjchNzY0LwEmIgcGFB8BBwYUFxYyNwJJ1Q0N1Q0jDA0Nt7cNDQwjDf7V1Q0N1QwkDA0Nt7cNDQwkDLfWDCMN1Q0NDCQMt7gMIw0MDNYMIw3VDQ0MJAy3uAwjDQwMAAADAFUAAAOrA1UAMwBoAHcAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMhMjY1NCYjISIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAAVYRGRkR/qoRGRkRA1UFBAUOCQkVDAsZDf2rDRkLDBUJCA4FBQUFBQUOCQgVDAsZDQJVDRkLDBUJCQ4FBAVVAgECBQMCBwQECAX9qwQJAwQHAwMFAQICAgIBBQMDBwQDCQQCVQUIBAQHAgMFAgEC/oAZEhEZGRESGQAAAAADAFUAAAOrA1UAMwBoAIkAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMzFRQWMzI2PQEzMjY1NCYrATU0JiMiBh0BIyIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAgBkSEhmAERkZEYAZEhIZgBEZGREDVQUEBQ4JCRUMCxkN/asNGQsMFQkIDgUFBQUFBQ4JCBUMCxkNAlUNGQsMFQkJDgUEBVUCAQIFAwIHBAQIBf2rBAkDBAcDAwUBAgICAgEFAwMHBAMJBAJVBQgEBAcCAwUCAQL+gIASGRkSgBkSERmAEhkZEoAZERIZAAABAOIAjQMeAskAIAAAExcHBhQXFjI/ARcWMjc2NC8BNzY0JyYiDwEnJiIHBhQX4uLiDQ0MJAzi4gwkDA0N4uINDQwkDOLiDCQMDQ0CjeLiDSMMDQ3h4Q0NDCMN4uIMIw0MDOLiDAwNIwwAAAABAAAAAQAAa5n0y18PPPUACwQAAAAAANivOVsAAAAA2K85WwAAAAADqwNVAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAOrAAEAAAAAAAAAAAAAAAAAAAALBAAAAAAAAAAAAAAAAgAAAAQAAWIEAAFiBAAA4gQAAOIEAABVBAAAVQQAAOIAAAAAAAoAFAAeAEQAagCqAOoBngJkApoAAQAAAAsAigADAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGZjaWNvbnMAZgBjAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGZjaWNvbnMAZgBjAGkAYwBvAG4Ac2ZjaWNvbnMAZgBjAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmZjaWNvbnMAZgBjAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("truetype")}.fc-icon{speak:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font-family:fcicons!important;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1;text-align:center;text-transform:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1em}.fc-icon-chevron-left:before{content:"\\e900"}.fc-icon-chevron-right:before{content:"\\e901"}.fc-icon-chevrons-left:before{content:"\\e902"}.fc-icon-chevrons-right:before{content:"\\e903"}.fc-icon-minus-square:before{content:"\\e904"}.fc-icon-plus-square:before{content:"\\e905"}.fc-icon-x:before{content:"\\e906"}.fc .fc-button{border-radius:0;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible;text-transform:none}.fc .fc-button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}.fc .fc-button{-webkit-appearance:button}.fc .fc-button:not(:disabled){cursor:pointer}.fc .fc-button{background-color:transparent;border:1px solid transparent;border-radius:.25em;display:inline-block;font-size:1em;font-weight:400;line-height:1.5;padding:.4em .65em;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}.fc .fc-button:hover{text-decoration:none}.fc .fc-button:focus{box-shadow:0 0 0 .2rem rgba(44,62,80,.25);outline:0}.fc .fc-button:disabled{opacity:.65}.fc .fc-button-primary{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:hover{background-color:var(--fc-button-hover-bg-color);border-color:var(--fc-button-hover-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:disabled{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button-primary:not(:disabled).fc-button-active,.fc .fc-button-primary:not(:disabled):active{background-color:var(--fc-button-active-bg-color);border-color:var(--fc-button-active-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:not(:disabled).fc-button-active:focus,.fc .fc-button-primary:not(:disabled):active:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button .fc-icon{font-size:1.5em;vertical-align:middle}.fc .fc-button-group{display:inline-flex;position:relative;vertical-align:middle}.fc .fc-button-group>.fc-button{flex:1 1 auto;position:relative}.fc .fc-button-group>.fc-button.fc-button-active,.fc .fc-button-group>.fc-button:active,.fc .fc-button-group>.fc-button:focus,.fc .fc-button-group>.fc-button:hover{z-index:1}.fc-direction-ltr .fc-button-group>.fc-button:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0;margin-left:-1px}.fc-direction-ltr .fc-button-group>.fc-button:not(:last-child){border-bottom-right-radius:0;border-top-right-radius:0}.fc-direction-rtl .fc-button-group>.fc-button:not(:first-child){border-bottom-right-radius:0;border-top-right-radius:0;margin-right:-1px}.fc-direction-rtl .fc-button-group>.fc-button:not(:last-child){border-bottom-left-radius:0;border-top-left-radius:0}.fc .fc-toolbar{align-items:center;display:flex;justify-content:space-between}.fc .fc-toolbar.fc-header-toolbar{margin-bottom:1.5em}.fc .fc-toolbar.fc-footer-toolbar{margin-top:1.5em}.fc .fc-toolbar-title{font-size:1.75em;margin:0}.fc-direction-ltr .fc-toolbar>*>:not(:first-child){margin-left:.75em}.fc-direction-rtl .fc-toolbar>*>:not(:first-child){margin-right:.75em}.fc-direction-rtl .fc-toolbar-ltr{flex-direction:row-reverse}.fc .fc-scroller{-webkit-overflow-scrolling:touch;position:relative}.fc .fc-scroller-liquid{height:100%}.fc .fc-scroller-liquid-absolute{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-scroller-harness{direction:ltr;overflow:hidden;position:relative}.fc .fc-scroller-harness-liquid{height:100%}.fc-direction-rtl .fc-scroller-harness>.fc-scroller{direction:rtl}.fc-theme-standard .fc-scrollgrid{border:1px solid var(--fc-border-color)}.fc .fc-scrollgrid,.fc .fc-scrollgrid table{table-layout:fixed;width:100%}.fc .fc-scrollgrid table{border-left-style:hidden;border-right-style:hidden;border-top-style:hidden}.fc .fc-scrollgrid{border-bottom-width:0;border-collapse:separate;border-right-width:0}.fc .fc-scrollgrid-liquid{height:100%}.fc .fc-scrollgrid-section,.fc .fc-scrollgrid-section table,.fc .fc-scrollgrid-section>td{height:1px}.fc .fc-scrollgrid-section-liquid>td{height:100%}.fc .fc-scrollgrid-section>*{border-left-width:0;border-top-width:0}.fc .fc-scrollgrid-section-footer>*,.fc .fc-scrollgrid-section-header>*{border-bottom-width:0}.fc .fc-scrollgrid-section-body table,.fc .fc-scrollgrid-section-footer table{border-bottom-style:hidden}.fc .fc-scrollgrid-section-sticky>*{background:var(--fc-page-bg-color);position:sticky;z-index:3}.fc .fc-scrollgrid-section-header.fc-scrollgrid-section-sticky>*{top:0}.fc .fc-scrollgrid-section-footer.fc-scrollgrid-section-sticky>*{bottom:0}.fc .fc-scrollgrid-sticky-shim{height:1px;margin-bottom:-1px}.fc-sticky{position:sticky}.fc .fc-view-harness{flex-grow:1;position:relative}.fc .fc-view-harness-active>.fc-view{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-col-header-cell-cushion{display:inline-block;padding:2px 4px}.fc .fc-bg-event,.fc .fc-highlight,.fc .fc-non-business{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-non-business{background:var(--fc-non-business-color)}.fc .fc-bg-event{background:var(--fc-bg-event-color);opacity:var(--fc-bg-event-opacity)}.fc .fc-bg-event .fc-event-title{font-size:var(--fc-small-font-size);font-style:italic;margin:.5em}.fc .fc-highlight{background:var(--fc-highlight-color)}.fc .fc-cell-shaded,.fc .fc-day-disabled{background:var(--fc-neutral-bg-color)}a.fc-event,a.fc-event:hover{text-decoration:none}.fc-event.fc-event-draggable,.fc-event[href]{cursor:pointer}.fc-event .fc-event-main{position:relative;z-index:2}.fc-event-dragging:not(.fc-event-selected){opacity:.75}.fc-event-dragging.fc-event-selected{box-shadow:0 2px 7px rgba(0,0,0,.3)}.fc-event .fc-event-resizer{display:none;position:absolute;z-index:4}.fc-event-selected .fc-event-resizer,.fc-event:hover .fc-event-resizer{display:block}.fc-event-selected .fc-event-resizer{background:var(--fc-page-bg-color);border-color:inherit;border-radius:calc(var(--fc-event-resizer-dot-total-width)/2);border-style:solid;border-width:var(--fc-event-resizer-dot-border-width);height:var(--fc-event-resizer-dot-total-width);width:var(--fc-event-resizer-dot-total-width)}.fc-event-selected .fc-event-resizer:before{bottom:-20px;content:"";left:-20px;position:absolute;right:-20px;top:-20px}.fc-event-selected,.fc-event:focus{box-shadow:0 2px 5px rgba(0,0,0,.2)}.fc-event-selected:before,.fc-event:focus:before{bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3}.fc-event-selected:after,.fc-event:focus:after{background:var(--fc-event-selected-overlay-color);bottom:-1px;content:"";left:-1px;position:absolute;right:-1px;top:-1px;z-index:1}.fc-h-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-h-event .fc-event-main{color:var(--fc-event-text-color)}.fc-h-event .fc-event-main-frame{display:flex}.fc-h-event .fc-event-time{max-width:100%;overflow:hidden}.fc-h-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-width:0}.fc-h-event .fc-event-title{display:inline-block;left:0;max-width:100%;overflow:hidden;right:0;vertical-align:top}.fc-h-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-start),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-end){border-bottom-left-radius:0;border-left-width:0;border-top-left-radius:0}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-end),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-start){border-bottom-right-radius:0;border-right-width:0;border-top-right-radius:0}.fc-h-event:not(.fc-event-selected) .fc-event-resizer{bottom:0;top:0;width:var(--fc-event-resizer-thickness)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end{cursor:w-resize;left:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start{cursor:e-resize;right:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-h-event.fc-event-selected .fc-event-resizer{margin-top:calc(var(--fc-event-resizer-dot-total-width)*-.5);top:50%}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-start,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-end{left:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-end,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-start{right:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc .fc-popover{box-shadow:0 2px 6px rgba(0,0,0,.15);position:absolute;z-index:9999}.fc .fc-popover-header{align-items:center;display:flex;flex-direction:row;justify-content:space-between;padding:3px 4px}.fc .fc-popover-title{margin:0 2px}.fc .fc-popover-close{cursor:pointer;font-size:1.1em;opacity:.65}.fc-theme-standard .fc-popover{background:var(--fc-page-bg-color);border:1px solid var(--fc-border-color)}.fc-theme-standard .fc-popover-header{background:var(--fc-neutral-bg-color)}';Ra(hK);var Fc=class{constructor(e){this.drainedOption=e,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}request(e){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),e==null?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),e))}pause(e=""){let{pauseDepths:t}=this;t[e]=(t[e]||0)+1,this.clearTimeout()}resume(e="",t){let{pauseDepths:n}=this;e in n&&(t?delete n[e]:(n[e]-=1,n[e]<=0&&delete n[e]),this.tryDrain())}isPaused(){return Object.keys(this.pauseDepths).length}tryDrain(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}}clear(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)}drained(){this.drainedOption&&this.drainedOption()}};function Jm(s){s.parentNode&&s.parentNode.removeChild(s)}function an(s,e){if(s.closest)return s.closest(e);if(!document.documentElement.contains(s))return null;do{if(gI(s,e))return s;s=s.parentElement||s.parentNode}while(s!==null&&s.nodeType===1);return null}function gI(s,e){return(s.matches||s.matchesSelector||s.msMatchesSelector).call(s,e)}function VV(s,e){let t=s instanceof HTMLElement?[s]:s,n=[];for(let i=0;i<t.length;i+=1){let r=t[i].querySelectorAll(e);for(let o=0;o<r.length;o+=1)n.push(r[o])}return n}var fK=/(top|left|right|bottom|width|height)$/i;function qc(s,e){for(let t in e)mI(s,t,e[t])}function mI(s,e,t){t==null?s.style[e]="":typeof t=="number"&&fK.test(e)?s.style[e]=`${t}px`:s.style[e]=t}function ux(s){var e,t;return(t=(e=s.composedPath)===null||e===void 0?void 0:e.call(s)[0])!==null&&t!==void 0?t:s.target}var SV=0;function si(){return SV+=1,"fc-dom-"+SV}function Zm(s){s.preventDefault()}function pK(s,e){return t=>{let n=an(t.target,s);n&&e.call(n,t,n)}}function yI(s,e,t,n){let i=pK(t,n);return s.addEventListener(e,i),()=>{s.removeEventListener(e,i)}}function zV(s,e,t,n){let i;return yI(s,"mouseover",e,(r,o)=>{if(o!==i){i=o,t(r,o);let l=u=>{i=null,n(u,o),o.removeEventListener("mouseleave",l)};o.addEventListener("mouseleave",l)}})}var TV=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"];function bI(s,e){let t=n=>{e(n),TV.forEach(i=>{s.removeEventListener(i,t)})};TV.forEach(n=>{s.addEventListener(n,t)})}function HV(s){return Object.assign({onClick:s},GV(s))}function GV(s){return{tabIndex:0,onKeyDown(e){(e.key==="Enter"||e.key===" ")&&(s(e),e.preventDefault())}}}var AV=0;function bo(){return AV+=1,String(AV)}function Qm(){document.body.classList.add("fc-not-allowed")}function ey(){document.body.classList.remove("fc-not-allowed")}function vI(s){s.style.userSelect="none",s.style.webkitUserSelect="none",s.addEventListener("selectstart",Zm)}function _I(s){s.style.userSelect="",s.style.webkitUserSelect="",s.removeEventListener("selectstart",Zm)}function wI(s){s.addEventListener("contextmenu",Zm)}function xI(s){s.removeEventListener("contextmenu",Zm)}function jV(s){let e=[],t=[],n,i;for(typeof s=="string"?t=s.split(/\s*,\s*/):typeof s=="function"?t=[s]:Array.isArray(s)&&(t=s),n=0;n<t.length;n+=1)i=t[n],typeof i=="string"?e.push(i.charAt(0)==="-"?{field:i.substring(1),order:-1}:{field:i,order:1}):typeof i=="function"&&e.push({func:i});return e}function WV(s,e,t){let n,i;for(n=0;n<t.length;n+=1)if(i=gK(s,e,t[n]),i)return i;return 0}function gK(s,e,t){return t.func?t.func(s,e):qV(s[t.field],e[t.field])*(t.order||1)}function qV(s,e){return!s&&!e?0:e==null?-1:s==null?1:typeof s=="string"||typeof e=="string"?String(s).localeCompare(String(e)):s-e}function Oc(s,e){let t=String(s);return"000".substr(0,e-t.length)+t}function Nh(s,e,t){return typeof s=="function"?s(...e):typeof s=="string"?e.reduce((n,i,r)=>n.replace("$"+r,i||""),s):t}function EI(s,e){return s-e}function Om(s){return s%1===0}function mK(s){let e=s.querySelector(".fc-scrollgrid-shrink-frame"),t=s.querySelector(".fc-scrollgrid-shrink-cushion");if(!e)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!t)throw new Error("needs fc-scrollgrid-shrink-cushion className");return s.getBoundingClientRect().width-e.getBoundingClientRect().width+t.getBoundingClientRect().width}var CV=["years","months","days","milliseconds"],yK=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function He(s,e){return typeof s=="string"?bK(s):typeof s=="object"&&s?IV(s):typeof s=="number"?IV({[e||"milliseconds"]:s}):null}function bK(s){let e=yK.exec(s);if(e){let t=e[1]?-1:1;return{years:0,months:0,days:t*(e[2]?parseInt(e[2],10):0),milliseconds:t*((e[3]?parseInt(e[3],10):0)*60*60*1e3+(e[4]?parseInt(e[4],10):0)*60*1e3+(e[5]?parseInt(e[5],10):0)*1e3+(e[6]?parseInt(e[6],10):0))}}return null}function IV(s){let e={years:s.years||s.year||0,months:s.months||s.month||0,days:s.days||s.day||0,milliseconds:(s.hours||s.hour||0)*60*60*1e3+(s.minutes||s.minute||0)*60*1e3+(s.seconds||s.second||0)*1e3+(s.milliseconds||s.millisecond||s.ms||0)},t=s.weeks||s.week;return t&&(e.days+=t*7,e.specifiedWeeks=!0),e}function vK(s,e){return s.years===e.years&&s.months===e.months&&s.days===e.days&&s.milliseconds===e.milliseconds}function ty(s,e){return{years:s.years+e.years,months:s.months+e.months,days:s.days+e.days,milliseconds:s.milliseconds+e.milliseconds}}function YV(s,e){return{years:s.years-e.years,months:s.months-e.months,days:s.days-e.days,milliseconds:s.milliseconds-e.milliseconds}}function SI(s,e){return{years:s.years*e,months:s.months*e,days:s.days*e,milliseconds:s.milliseconds*e}}function _K(s){return kh(s)/365}function wK(s){return kh(s)/30}function kh(s){return Ls(s)/864e5}function Ls(s){return s.years*(365*864e5)+s.months*(30*864e5)+s.days*864e5+s.milliseconds}function ny(s,e){let t=null;for(let n=0;n<CV.length;n+=1){let i=CV[n];if(e[i]){let r=s[i]/e[i];if(!Om(r)||t!==null&&t!==r)return null;t=r}else if(s[i])return null}return t}function Fm(s){let e=s.milliseconds;if(e){if(e%1e3!==0)return{unit:"millisecond",value:e};if(e%(1e3*60)!==0)return{unit:"second",value:e/1e3};if(e%(1e3*60*60)!==0)return{unit:"minute",value:e/(1e3*60)};if(e)return{unit:"hour",value:e/(1e3*60*60)}}return s.days?s.specifiedWeeks&&s.days%7===0?{unit:"week",value:s.days/7}:{unit:"day",value:s.days}:s.months?{unit:"month",value:s.months}:s.years?{unit:"year",value:s.years}:{unit:"millisecond",value:0}}function fr(s,e,t){if(s===e)return!0;let n=s.length,i;if(n!==e.length)return!1;for(i=0;i<n;i+=1)if(!(t?t(s[i],e[i]):s[i]===e[i]))return!1;return!0}var xK=["sun","mon","tue","wed","thu","fri","sat"];function dx(s,e){let t=Ta(s);return t[2]+=e*7,ms(t)}function Dt(s,e){let t=Ta(s);return t[2]+=e,ms(t)}function ur(s,e){let t=Ta(s);return t[6]+=e,ms(t)}function TI(s,e){return pr(s,e)/7}function pr(s,e){return(e.valueOf()-s.valueOf())/(1e3*60*60*24)}function EK(s,e){return(e.valueOf()-s.valueOf())/(1e3*60*60)}function SK(s,e){return(e.valueOf()-s.valueOf())/(1e3*60)}function TK(s,e){return(e.valueOf()-s.valueOf())/1e3}function KV(s,e){let t=ct(s),n=ct(e);return{years:0,months:0,days:Math.round(pr(t,n)),milliseconds:e.valueOf()-n.valueOf()-(s.valueOf()-t.valueOf())}}function XV(s,e){let t=Rh(s,e);return t!==null&&t%7===0?t/7:null}function Rh(s,e){return Aa(s)===Aa(e)?Math.round(pr(s,e)):null}function ct(s){return ms([s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()])}function AK(s){return ms([s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),s.getUTCHours()])}function CK(s){return ms([s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes()])}function IK(s){return ms([s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds()])}function DK(s,e,t){let n=s.getUTCFullYear(),i=X1(s,n,e,t);if(i<1)return X1(s,n-1,e,t);let r=X1(s,n+1,e,t);return r>=1?Math.min(i,r):i}function X1(s,e,t,n){let i=ms([e,0,1+kK(e,t,n)]),r=ct(s),o=Math.round(pr(i,r));return Math.floor(o/7)+1}function kK(s,e,t){let n=7+e-t;return-((7+ms([s,0,n]).getUTCDay()-e)%7)+n-1}function DV(s){return[s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()]}function kV(s){return new Date(s[0],s[1]||0,s[2]==null?1:s[2],s[3]||0,s[4]||0,s[5]||0)}function Ta(s){return[s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()]}function ms(s){return s.length===1&&(s=s.concat([0])),new Date(Date.UTC(...s))}function AI(s){return!isNaN(s.valueOf())}function Aa(s){return s.getUTCHours()*1e3*60*60+s.getUTCMinutes()*1e3*60+s.getUTCSeconds()*1e3+s.getUTCMilliseconds()}function hx(s,e,t=!1){let n=s.toISOString();return n=n.replace(".000",""),t&&(n=n.replace("T00:00:00Z","")),n.length>10&&(e==null?n=n.replace("Z",""):e!==0&&(n=n.replace("Z",DI(e,!0)))),n}function Pa(s){return s.toISOString().replace(/T.*$/,"")}function CI(s){return s.toISOString().match(/^\d{4}-\d{2}/)[0]}function II(s){return Oc(s.getUTCHours(),2)+":"+Oc(s.getUTCMinutes(),2)+":"+Oc(s.getUTCSeconds(),2)}function DI(s,e=!1){let t=s<0?"-":"+",n=Math.abs(s),i=Math.floor(n/60),r=Math.round(n%60);return e?`${t+Oc(i,2)}:${Oc(r,2)}`:`GMT${t}${i}${r?`:${Oc(r,2)}`:""}`}function xe(s,e,t){let n,i;return function(...r){if(!n)i=s.apply(this,r);else if(!fr(n,r)){t&&t(i);let o=s.apply(this,r);(!e||!e(o,i))&&(i=o)}return n=r,i}}function Oh(s,e,t){let n,i;return r=>{if(!n)i=s.call(this,r);else if(!ys(n,r)){t&&t(i);let o=s.call(this,r);(!e||!e(o,i))&&(i=o)}return n=r,i}}var J1={week:3,separator:9,omitZeroMinute:9,meridiem:9,omitCommas:9},ex={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},qw=/\s*([ap])\.?m\.?/i,RK=/,/g,PK=/\s+/g,MK=/\u200e/g,NK=/UTC|GMT/,oI=class{constructor(e){let t={},n={},i=9;for(let r in e)r in J1?(n[r]=e[r],J1[r]<9&&(i=Math.min(J1[r],i))):(t[r]=e[r],r in ex&&(i=Math.min(ex[r],i)));this.standardDateProps=t,this.extendedSettings=n,this.smallestUnitNum=i,this.buildFormattingFunc=xe(RV)}format(e,t){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,t)(e)}formatRange(e,t,n,i){let{standardDateProps:r,extendedSettings:o}=this,l=BK(e.marker,t.marker,n.calendarSystem);if(!l)return this.format(e,n);let u=l;u>1&&(r.year==="numeric"||r.year==="2-digit")&&(r.month==="numeric"||r.month==="2-digit")&&(r.day==="numeric"||r.day==="2-digit")&&(u=1);let h=this.format(e,n),d=this.format(t,n);if(h===d)return h;let c=VK(r,u),a=RV(c,o,n),f=a(e),p=a(t),g=zK(h,f,d,p),m=o.separator||i||n.defaultSeparator||"";return g?g.before+f+m+p+g.after:h+m+d}getSmallestUnit(){switch(this.smallestUnitNum){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}}};function RV(s,e,t){let n=Object.keys(s).length;return n===1&&s.timeZoneName==="short"?i=>DI(i.timeZoneOffset):n===0&&e.week?i=>UK(t.computeWeekNumber(i.marker),t.weekText,t.weekTextLong,t.locale,e.week):OK(s,e,t)}function OK(s,e,t){s=Object.assign({},s),e=Object.assign({},e),FK(s,e),s.timeZone="UTC";let n=new Intl.DateTimeFormat(t.locale.codes,s),i;if(e.omitZeroMinute){let r=Object.assign({},s);delete r.minute,i=new Intl.DateTimeFormat(t.locale.codes,r)}return r=>{let{marker:o}=r,l;i&&!o.getUTCMinutes()?l=i:l=n;let u=l.format(o);return LK(u,r,s,e,t)}}function FK(s,e){s.timeZoneName&&(s.hour||(s.hour="2-digit"),s.minute||(s.minute="2-digit")),s.timeZoneName==="long"&&(s.timeZoneName="short"),e.omitZeroMinute&&(s.second||s.millisecond)&&delete e.omitZeroMinute}function LK(s,e,t,n,i){return s=s.replace(MK,""),t.timeZoneName==="short"&&(s=$K(s,i.timeZone==="UTC"||e.timeZoneOffset==null?"UTC":DI(e.timeZoneOffset))),n.omitCommas&&(s=s.replace(RK,"").trim()),n.omitZeroMinute&&(s=s.replace(":00","")),n.meridiem===!1?s=s.replace(qw,"").trim():n.meridiem==="narrow"?s=s.replace(qw,(r,o)=>o.toLocaleLowerCase()):n.meridiem==="short"?s=s.replace(qw,(r,o)=>`${o.toLocaleLowerCase()}m`):n.meridiem==="lowercase"&&(s=s.replace(qw,r=>r.toLocaleLowerCase())),s=s.replace(PK," "),s=s.trim(),s}function $K(s,e){let t=!1;return s=s.replace(NK,()=>(t=!0,e)),t||(s+=` ${e}`),s}function UK(s,e,t,n,i){let r=[];return i==="long"?r.push(t):(i==="short"||i==="narrow")&&r.push(e),(i==="long"||i==="short")&&r.push(" "),r.push(n.simpleNumberFormat.format(s)),n.options.direction==="rtl"&&r.reverse(),r.join("")}function BK(s,e,t){return t.getMarkerYear(s)!==t.getMarkerYear(e)?5:t.getMarkerMonth(s)!==t.getMarkerMonth(e)?4:t.getMarkerDay(s)!==t.getMarkerDay(e)?2:Aa(s)!==Aa(e)?1:0}function VK(s,e){let t={};for(let n in s)(!(n in ex)||ex[n]<=e)&&(t[n]=s[n]);return t}function zK(s,e,t,n){let i=0;for(;i<s.length;){let r=s.indexOf(e,i);if(r===-1)break;let o=s.substr(0,r);i=r+e.length;let l=s.substr(i),u=0;for(;u<t.length;){let h=t.indexOf(n,u);if(h===-1)break;let d=t.substr(0,h);u=h+n.length;let c=t.substr(u);if(o===d&&l===c)return{before:o,after:l}}}return null}function PV(s,e){let t=e.markerToArray(s.marker);return{marker:s.marker,timeZoneOffset:s.timeZoneOffset,array:t,year:t[0],month:t[1],day:t[2],hour:t[3],minute:t[4],second:t[5],millisecond:t[6]}}function tx(s,e,t,n){let i=PV(s,t.calendarSystem),r=e?PV(e,t.calendarSystem):null;return{date:i,start:i,end:r,timeZone:t.timeZone,localeCodes:t.locale.codes,defaultSeparator:n||t.defaultSeparator}}var aI=class{constructor(e){this.cmdStr=e}format(e,t,n){return t.cmdFormatter(this.cmdStr,tx(e,null,t,n))}formatRange(e,t,n,i){return n.cmdFormatter(this.cmdStr,tx(e,t,n,i))}},lI=class{constructor(e){this.func=e}format(e,t,n){return this.func(tx(e,null,t,n))}formatRange(e,t,n,i){return this.func(tx(e,t,n,i))}};function dt(s){return typeof s=="object"&&s?new oI(s):typeof s=="string"?new aI(s):typeof s=="function"?new lI(s):null}var kI={navLinkDayClick:Q,navLinkWeekClick:Q,duration:He,bootstrapFontAwesome:Q,buttonIcons:Q,customButtons:Q,defaultAllDayEventDuration:He,defaultTimedEventDuration:He,nextDayThreshold:He,scrollTime:He,scrollTimeReset:Boolean,slotMinTime:He,slotMaxTime:He,dayPopoverFormat:dt,slotDuration:He,snapDuration:He,headerToolbar:Q,footerToolbar:Q,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:dt,dayHeaderClassNames:Q,dayHeaderContent:Q,dayHeaderDidMount:Q,dayHeaderWillUnmount:Q,dayCellClassNames:Q,dayCellContent:Q,dayCellDidMount:Q,dayCellWillUnmount:Q,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:Q,weekNumbers:Boolean,weekNumberClassNames:Q,weekNumberContent:Q,weekNumberDidMount:Q,weekNumberWillUnmount:Q,editable:Boolean,viewClassNames:Q,viewDidMount:Q,viewWillUnmount:Q,nowIndicator:Boolean,nowIndicatorSnap:Q,nowIndicatorClassNames:Q,nowIndicatorContent:Q,nowIndicatorDidMount:Q,nowIndicatorWillUnmount:Q,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:Q,locale:Q,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:Q,eventOrder:jV,eventOrderStrict:Boolean,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:Q,contentHeight:Q,direction:String,weekNumberFormat:dt,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,weekTextLong:String,progressiveEventRendering:Boolean,businessHours:Q,initialDate:Q,now:Q,eventDataTransform:Q,stickyHeaderDates:Q,stickyFooterScrollbar:Q,viewHeight:Q,defaultAllDay:Boolean,eventSourceFailure:Q,eventSourceSuccess:Q,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:Q,eventConstraint:Q,eventAllow:Q,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:Q,eventContent:Q,eventDidMount:Q,eventWillUnmount:Q,selectConstraint:Q,selectOverlap:Q,selectAllow:Q,droppable:Boolean,unselectCancel:String,slotLabelFormat:Q,slotLaneClassNames:Q,slotLaneContent:Q,slotLaneDidMount:Q,slotLaneWillUnmount:Q,slotLabelClassNames:Q,slotLabelContent:Q,slotLabelDidMount:Q,slotLabelWillUnmount:Q,dayMaxEvents:Q,dayMaxEventRows:Q,dayMinWidth:Number,slotLabelInterval:He,allDayText:String,allDayClassNames:Q,allDayContent:Q,allDayDidMount:Q,allDayWillUnmount:Q,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:dt,rerenderDelay:Number,moreLinkText:Q,moreLinkHint:Q,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMaxStack:Number,eventMinHeight:Number,eventMinWidth:Number,eventShortHeight:Number,slotEventOverlap:Boolean,plugins:Q,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:He,hiddenDays:Q,fixedWeekCount:Boolean,validRange:Q,visibleRange:Q,titleFormat:Q,eventInteractive:Boolean,noEventsText:String,viewHint:Q,navLinkHint:Q,closeHint:String,timeHint:String,eventHint:String,moreLinkClick:Q,moreLinkClassNames:Q,moreLinkContent:Q,moreLinkDidMount:Q,moreLinkWillUnmount:Q,monthStartFormat:dt,handleCustomRendering:Q,customRenderingMetaMap:Q,customRenderingReplaces:Boolean},Ma={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:" \u2013 ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",scrollTimeReset:!0,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1,eventMinHeight:15,eventMinWidth:30,eventShortHeight:30,monthStartFormat:{month:"long",day:"numeric"},nowIndicatorSnap:"auto"},RI={datesSet:Q,eventsSet:Q,eventAdd:Q,eventChange:Q,eventRemove:Q,windowResize:Q,eventClick:Q,eventMouseEnter:Q,eventMouseLeave:Q,select:Q,unselect:Q,loading:Q,_unmount:Q,_beforeprint:Q,_afterprint:Q,_noEventDrop:Q,_noEventResize:Q,_resize:Q,_scrollRequest:Q},PI={buttonText:Q,buttonHints:Q,views:Q,plugins:Q,initialEvents:Q,events:Q,eventSources:Q},Na={headerToolbar:Nc,footerToolbar:Nc,buttonText:Nc,buttonHints:Nc,buttonIcons:Nc,dateIncrement:Nc,plugins:Yw,events:Yw,eventSources:Yw,resources:Yw};function Nc(s,e){return typeof s=="object"&&typeof e=="object"&&s&&e?ys(s,e):s===e}function Yw(s,e){return Array.isArray(s)&&Array.isArray(e)?fr(s,e):s===e}var JV={type:String,component:Q,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:Q,usesMinMaxTime:Boolean,classNames:Q,content:Q,didMount:Q,willUnmount:Q};function fx(s){return gx(s,Na)}function px(s,e){let t={},n={};for(let i in e)i in s&&(t[i]=e[i](s[i]));for(let i in s)i in e||(n[i]=s[i]);return{refined:t,extra:n}}function Q(s){return s}var{hasOwnProperty:nx}=Object.prototype;function gx(s,e){let t={};if(e){for(let n in e)if(e[n]===Nc){let i=[];for(let r=s.length-1;r>=0;r-=1){let o=s[r][n];if(typeof o=="object"&&o)i.unshift(o);else if(o!==void 0){t[n]=o;break}}i.length&&(t[n]=gx(i))}}for(let n=s.length-1;n>=0;n-=1){let i=s[n];for(let r in i)r in t||(t[r]=i[r])}return t}function po(s,e){let t={};for(let n in s)e(s[n],n)&&(t[n]=s[n]);return t}function ni(s,e){let t={};for(let n in s)t[n]=e(s[n],n);return t}function MI(s){let e={};for(let t of s)e[t]=!0;return e}function mx(s){let e=[];for(let t in s)e.push(s[t]);return e}function ys(s,e){if(s===e)return!0;for(let t in s)if(nx.call(s,t)&&!(t in e))return!1;for(let t in e)if(nx.call(e,t)&&s[t]!==e[t])return!1;return!0}var HK=/^on[A-Z]/;function GK(s,e){let t=jK(s,e);for(let n of t)if(!HK.test(n))return!1;return!0}function jK(s,e){let t=[];for(let n in s)nx.call(s,n)&&(n in e||t.push(n));for(let n in e)nx.call(e,n)&&s[n]!==e[n]&&t.push(n);return t}function Zw(s,e,t={}){if(s===e)return!0;for(let n in e)if(!(n in s&&WK(s[n],e[n],t[n])))return!1;for(let n in s)if(!(n in e))return!1;return!0}function WK(s,e,t){return s===e||t===!0?!0:t?t(s,e):!1}function ZV(s,e=0,t,n=1){let i=[];t==null&&(t=Object.keys(s).length);for(let r=e;r<t;r+=n){let o=s[r];o!==void 0&&i.push(o)}return i}var QV={};function qK(s,e){QV[s]=e}function YK(s){return new QV[s]}var cI=class{getMarkerYear(e){return e.getUTCFullYear()}getMarkerMonth(e){return e.getUTCMonth()}getMarkerDay(e){return e.getUTCDate()}arrayToMarker(e){return ms(e)}markerToArray(e){return Ta(e)}};qK("gregory",cI);var KK=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;function ez(s){let e=KK.exec(s);if(e){let t=new Date(Date.UTC(Number(e[1]),e[3]?Number(e[3])-1:0,Number(e[5]||1),Number(e[7]||0),Number(e[8]||0),Number(e[10]||0),e[12]?+`0.${e[12]}`*1e3:0));if(AI(t)){let n=null;return e[13]&&(n=(e[15]==="-"?-1:1)*(Number(e[16]||0)*60+Number(e[18]||0))),{marker:t,isTimeUnspecified:!e[6],timeZoneOffset:n}}}return null}var Lm=class{constructor(e){let t=this.timeZone=e.timeZone,n=t!=="local"&&t!=="UTC";e.namedTimeZoneImpl&&n&&(this.namedTimeZoneImpl=new e.namedTimeZoneImpl(t)),this.canComputeOffset=!!(!n||this.namedTimeZoneImpl),this.calendarSystem=YK(e.calendarSystem),this.locale=e.locale,this.weekDow=e.locale.week.dow,this.weekDoy=e.locale.week.doy,e.weekNumberCalculation==="ISO"&&(this.weekDow=1,this.weekDoy=4),typeof e.firstDay=="number"&&(this.weekDow=e.firstDay),typeof e.weekNumberCalculation=="function"&&(this.weekNumberFunc=e.weekNumberCalculation),this.weekText=e.weekText!=null?e.weekText:e.locale.options.weekText,this.weekTextLong=(e.weekTextLong!=null?e.weekTextLong:e.locale.options.weekTextLong)||this.weekText,this.cmdFormatter=e.cmdFormatter,this.defaultSeparator=e.defaultSeparator}createMarker(e){let t=this.createMarkerMeta(e);return t===null?null:t.marker}createNowMarker(){return this.canComputeOffset?this.timestampToMarker(new Date().valueOf()):ms(DV(new Date))}createMarkerMeta(e){if(typeof e=="string")return this.parse(e);let t=null;return typeof e=="number"?t=this.timestampToMarker(e):e instanceof Date?(e=e.valueOf(),isNaN(e)||(t=this.timestampToMarker(e))):Array.isArray(e)&&(t=ms(e)),t===null||!AI(t)?null:{marker:t,isTimeUnspecified:!1,forcedTzo:null}}parse(e){let t=ez(e);if(t===null)return null;let{marker:n}=t,i=null;return t.timeZoneOffset!==null&&(this.canComputeOffset?n=this.timestampToMarker(n.valueOf()-t.timeZoneOffset*60*1e3):i=t.timeZoneOffset),{marker:n,isTimeUnspecified:t.isTimeUnspecified,forcedTzo:i}}getYear(e){return this.calendarSystem.getMarkerYear(e)}getMonth(e){return this.calendarSystem.getMarkerMonth(e)}getDay(e){return this.calendarSystem.getMarkerDay(e)}add(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]+=t.years,n[1]+=t.months,n[2]+=t.days,n[6]+=t.milliseconds,this.calendarSystem.arrayToMarker(n)}subtract(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]-=t.years,n[1]-=t.months,n[2]-=t.days,n[6]-=t.milliseconds,this.calendarSystem.arrayToMarker(n)}addYears(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]+=t,this.calendarSystem.arrayToMarker(n)}addMonths(e,t){let n=this.calendarSystem.markerToArray(e);return n[1]+=t,this.calendarSystem.arrayToMarker(n)}diffWholeYears(e,t){let{calendarSystem:n}=this;return Aa(e)===Aa(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)&&n.getMarkerMonth(e)===n.getMarkerMonth(t)?n.getMarkerYear(t)-n.getMarkerYear(e):null}diffWholeMonths(e,t){let{calendarSystem:n}=this;return Aa(e)===Aa(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)?n.getMarkerMonth(t)-n.getMarkerMonth(e)+(n.getMarkerYear(t)-n.getMarkerYear(e))*12:null}greatestWholeUnit(e,t){let n=this.diffWholeYears(e,t);return n!==null?{unit:"year",value:n}:(n=this.diffWholeMonths(e,t),n!==null?{unit:"month",value:n}:(n=XV(e,t),n!==null?{unit:"week",value:n}:(n=Rh(e,t),n!==null?{unit:"day",value:n}:(n=EK(e,t),Om(n)?{unit:"hour",value:n}:(n=SK(e,t),Om(n)?{unit:"minute",value:n}:(n=TK(e,t),Om(n)?{unit:"second",value:n}:{unit:"millisecond",value:t.valueOf()-e.valueOf()}))))))}countDurationsBetween(e,t,n){let i;return n.years&&(i=this.diffWholeYears(e,t),i!==null)?i/_K(n):n.months&&(i=this.diffWholeMonths(e,t),i!==null)?i/wK(n):n.days&&(i=Rh(e,t),i!==null)?i/kh(n):(t.valueOf()-e.valueOf())/Ls(n)}startOf(e,t){return t==="year"?this.startOfYear(e):t==="month"?this.startOfMonth(e):t==="week"?this.startOfWeek(e):t==="day"?ct(e):t==="hour"?AK(e):t==="minute"?CK(e):t==="second"?IK(e):null}startOfYear(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e)])}startOfMonth(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e)])}startOfWeek(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e),e.getUTCDate()-(e.getUTCDay()-this.weekDow+7)%7])}computeWeekNumber(e){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(e)):DK(e,this.weekDow,this.weekDoy)}format(e,t,n={}){return t.format({marker:e,timeZoneOffset:n.forcedTzo!=null?n.forcedTzo:this.offsetForMarker(e)},this)}formatRange(e,t,n,i={}){return i.isEndExclusive&&(t=ur(t,-1)),n.formatRange({marker:e,timeZoneOffset:i.forcedStartTzo!=null?i.forcedStartTzo:this.offsetForMarker(e)},{marker:t,timeZoneOffset:i.forcedEndTzo!=null?i.forcedEndTzo:this.offsetForMarker(t)},this,i.defaultSeparator)}formatIso(e,t={}){let n=null;return t.omitTimeZoneOffset||(t.forcedTzo!=null?n=t.forcedTzo:n=this.offsetForMarker(e)),hx(e,n,t.omitTime)}timestampToMarker(e){return this.timeZone==="local"?ms(DV(new Date(e))):this.timeZone==="UTC"||!this.namedTimeZoneImpl?new Date(e):ms(this.namedTimeZoneImpl.timestampToArray(e))}offsetForMarker(e){return this.timeZone==="local"?-kV(Ta(e)).getTimezoneOffset():this.timeZone==="UTC"?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(Ta(e)):null}toDate(e,t){return this.timeZone==="local"?kV(Ta(e)):this.timeZone==="UTC"?new Date(e.valueOf()):this.namedTimeZoneImpl?new Date(e.valueOf()-this.namedTimeZoneImpl.offsetForArray(Ta(e))*1e3*60):new Date(e.valueOf()-(t||0))}},go=class{constructor(e){this.iconOverrideOption&&this.setIconOverride(e[this.iconOverrideOption])}setIconOverride(e){let t,n;if(typeof e=="object"&&e){t=Object.assign({},this.iconClasses);for(n in e)t[n]=this.applyIconOverridePrefix(e[n]);this.iconClasses=t}else e===!1&&(this.iconClasses={})}applyIconOverridePrefix(e){let t=this.iconOverridePrefix;return t&&e.indexOf(t)!==0&&(e=t+e),e}getClass(e){return this.classes[e]||""}getIconClass(e,t){let n;return t&&this.rtlIconClasses?n=this.rtlIconClasses[e]||this.iconClasses[e]:n=this.iconClasses[e],n?`${this.baseIconClass} ${n}`:""}getCustomButtonIconClass(e){let t;return this.iconOverrideCustomButtonOption&&(t=e[this.iconOverrideCustomButtonOption],t)?`${this.baseIconClass} ${this.applyIconOverridePrefix(t)}`:""}};go.prototype.classes={};go.prototype.iconClasses={};go.prototype.baseIconClass="";go.prototype.iconOverridePrefix="";function $m(s){s();let e=Te.debounceRendering,t=[];function n(i){t.push(i)}for(Te.debounceRendering=n,Ea(G(uI,{}),document.createElement("div"));t.length;)t.shift()();Te.debounceRendering=e}var uI=class extends Rn{render(){return G("div",{})}componentDidMount(){this.setState({})}};function tz(s){let e=Gw(s),t=e.Provider;return e.Provider=function(){let n=!this.getChildContext,i=t.apply(this,arguments);if(n){let r=[];this.shouldComponentUpdate=o=>{this.props.value!==o.value&&r.forEach(l=>{l.context=o.value,l.forceUpdate()})},this.sub=o=>{r.push(o);let l=o.componentWillUnmount;o.componentWillUnmount=()=>{r.splice(r.indexOf(o),1),l&&l.call(o)}}}return i},e}var sx=class{constructor(e,t,n,i){this.execFunc=e,this.emitter=t,this.scrollTime=n,this.scrollTimeReset=i,this.handleScrollRequest=r=>{this.queuedRequest=Object.assign({},this.queuedRequest||{},r),this.drain()},t.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}detach(){this.emitter.off("_scrollRequest",this.handleScrollRequest)}update(e){e&&this.scrollTimeReset?this.fireInitialScroll():this.drain()}fireInitialScroll(){this.handleScrollRequest({time:this.scrollTime})}drain(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)}},ii=tz({});function nz(s,e,t,n,i,r,o,l,u,h,d,c,a,f){return{dateEnv:i,nowManager:r,options:t,pluginHooks:l,emitter:d,dispatch:u,getCurrentData:h,calendarApi:c,viewSpec:s,viewApi:e,dateProfileGenerator:n,theme:o,isRtl:t.direction==="rtl",addResizeHandler(p){d.on("_resize",p)},removeResizeHandler(p){d.off("_resize",p)},createScrollResponder(p){return new sx(p,d,He(t.scrollTime),t.scrollTimeReset)},registerInteractiveComponent:a,unregisterInteractiveComponent:f}}var dr=class extends Rn{shouldComponentUpdate(e,t){return!Zw(this.props,e,this.propEquality)||!Zw(this.state,t,this.stateEquality)}safeSetState(e){Zw(this.state,Object.assign(Object.assign({},this.state),e),this.stateEquality)||this.setState(e)}};dr.addPropsEquality=XK;dr.addStateEquality=JK;dr.contextType=ii;dr.prototype.propEquality={};dr.prototype.stateEquality={};var Ge=class extends dr{};Ge.contextType=ii;function XK(s){let e=Object.create(this.prototype.propEquality);Object.assign(e,s),this.prototype.propEquality=e}function JK(s){let e=Object.create(this.prototype.stateEquality);Object.assign(e,s),this.prototype.stateEquality=e}function Us(s,e){typeof s=="function"?s(e):s&&(s.current=e)}var Um=class extends Ge{constructor(){super(...arguments),this.id=bo(),this.queuedDomNodes=[],this.currentDomNodes=[],this.handleEl=e=>{let{options:t}=this.context,{generatorName:n}=this.props;(!t.customRenderingReplaces||!dI(n,t))&&this.updateElRef(e)},this.updateElRef=e=>{this.props.elRef&&Us(this.props.elRef,e)}}render(){let{props:e,context:t}=this,{options:n}=t,{customGenerator:i,defaultGenerator:r,renderProps:o}=e,l=NI(e,[],this.handleEl),u=!1,h,d=[],c;if(i!=null){let a=typeof i=="function"?i(o,G):i;if(a===!0)u=!0;else{let f=a&&typeof a=="object";f&&"html"in a?l.dangerouslySetInnerHTML={__html:a.html}:f&&"domNodes"in a?d=Array.prototype.slice.call(a.domNodes):(f?H1(a):typeof a!="function")?h=a:c=a}}else u=!dI(e.generatorName,n);return u&&r&&(h=r(o)),this.queuedDomNodes=d,this.currentGeneratorMeta=c,G(e.elTag,l,h)}componentDidMount(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentDidUpdate(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentWillUnmount(){this.triggerCustomRendering(!1)}triggerCustomRendering(e){var t;let{props:n,context:i}=this,{handleCustomRendering:r,customRenderingMetaMap:o}=i.options;if(r){let l=(t=this.currentGeneratorMeta)!==null&&t!==void 0?t:o?.[n.generatorName];l&&r(Object.assign(Object.assign({id:this.id,isActive:e,containerEl:this.base,reportNewContainerEl:this.updateElRef,generatorMeta:l},n),{elClasses:(n.elClasses||[]).filter(ZK)}))}}applyQueueudDomNodes(){let{queuedDomNodes:e,currentDomNodes:t}=this,n=this.base;if(!fr(e,t)){t.forEach(Jm);for(let i of e)n.appendChild(i);this.currentDomNodes=e}}};Um.addPropsEquality({elClasses:fr,elStyle:ys,elAttrs:GK,renderProps:ys});function dI(s,e){var t;return!!(e.handleCustomRendering&&s&&(!((t=e.customRenderingMetaMap)===null||t===void 0)&&t[s]))}function NI(s,e,t){let n=Object.assign(Object.assign({},s.elAttrs),{ref:t});return(s.elClasses||e)&&(n.className=(s.elClasses||[]).concat(e||[]).concat(n.className||[]).filter(Boolean).join(" ")),s.elStyle&&(n.style=s.elStyle),n}function ZK(s){return!!s}var OI=tz(0),Ut=class extends Rn{constructor(){super(...arguments),this.InnerContent=QK.bind(void 0,this),this.handleEl=e=>{this.el=e,this.props.elRef&&(Us(this.props.elRef,e),e&&this.didMountMisfire&&this.componentDidMount())}}render(){let{props:e}=this,t=e7(e.classNameGenerator,e.renderProps);if(e.children){let n=NI(e,t,this.handleEl),i=e.children(this.InnerContent,e.renderProps,n);return e.elTag?G(e.elTag,n,i):i}else return G(Um,Object.assign(Object.assign({},e),{elRef:this.handleEl,elTag:e.elTag||"div",elClasses:(e.elClasses||[]).concat(t),renderId:this.context}))}componentDidMount(){var e,t;this.el?(t=(e=this.props).didMount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el})):this.didMountMisfire=!0}componentWillUnmount(){var e,t;(t=(e=this.props).willUnmount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el}))}};Ut.contextType=OI;function QK(s,e){let t=s.props;return G(Um,Object.assign({renderProps:t.renderProps,generatorName:t.generatorName,customGenerator:t.customGenerator,defaultGenerator:t.defaultGenerator,renderId:s.context},e))}function e7(s,e){let t=typeof s=="function"?s(e):s||[];return typeof t=="string"?[t]:t}var Di=class extends Ge{render(){let{props:e,context:t}=this,{options:n}=t,i={view:t.viewApi};return G(Ut,{elRef:e.elRef,elTag:e.elTag||"div",elAttrs:e.elAttrs,elClasses:[...FI(e.viewSpec),...e.elClasses||[]],elStyle:e.elStyle,renderProps:i,classNameGenerator:n.viewClassNames,generatorName:void 0,didMount:n.viewDidMount,willUnmount:n.viewWillUnmount},()=>e.children)}};function FI(s){return[`fc-${s.type}-view`,"fc-view"]}function t7(s,e){let t=null,n=null;return s.start&&(t=e.createMarker(s.start)),s.end&&(n=e.createMarker(s.end)),!t&&!n||t&&n&&n<t?null:{start:t,end:n}}function MV(s,e){let t=[],{start:n}=e,i,r;for(s.sort(n7),i=0;i<s.length;i+=1)r=s[i],r.start>n&&t.push({start:n,end:r.start}),r.end>n&&(n=r.end);return n<e.end&&t.push({start:n,end:e.end}),t}function n7(s,e){return s.start.valueOf()-e.start.valueOf()}function $s(s,e){let{start:t,end:n}=s,i=null;return e.start!==null&&(t===null?t=e.start:t=new Date(Math.max(t.valueOf(),e.start.valueOf()))),e.end!=null&&(n===null?n=e.end:n=new Date(Math.min(n.valueOf(),e.end.valueOf()))),(t===null||n===null||t<n)&&(i={start:t,end:n}),i}function sz(s,e){return(s.start===null?null:s.start.valueOf())===(e.start===null?null:e.start.valueOf())&&(s.end===null?null:s.end.valueOf())===(e.end===null?null:e.end.valueOf())}function yx(s,e){return(s.end===null||e.start===null||s.end>e.start)&&(s.start===null||e.end===null||s.start<e.end)}function Fh(s,e){return(s.start===null||e.start!==null&&e.start>=s.start)&&(s.end===null||e.end!==null&&e.end<=s.end)}function ti(s,e){return(s.start===null||e>=s.start)&&(s.end===null||e<s.end)}function s7(s,e){return e.start!=null&&s<e.start?e.start:e.end!=null&&s>=e.end?new Date(e.end.valueOf()-1):s}function iz(s){let e=Math.floor(pr(s.start,s.end))||1,t=ct(s.start),n=Dt(t,e);return{start:t,end:n}}function bx(s,e=He(0)){let t=null,n=null;if(s.end){n=ct(s.end);let i=s.end.valueOf()-n.valueOf();i&&i>=Ls(e)&&(n=Dt(n,1))}return s.start&&(t=ct(s.start),n&&n<=t&&(n=Dt(t,1))),{start:t,end:n}}function LI(s){let e=bx(s);return pr(e.start,e.end)>1}function Ca(s,e,t,n){return n==="year"?He(t.diffWholeYears(s,e),"year"):n==="month"?He(t.diffWholeMonths(s,e),"month"):KV(s,e)}var Lc=class{constructor(e){this.props=e,this.initHiddenDays()}buildPrev(e,t,n){let{dateEnv:i}=this.props,r=i.subtract(i.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(r,-1,n)}buildNext(e,t,n){let{dateEnv:i}=this.props,r=i.add(i.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(r,1,n)}build(e,t,n=!0){let{props:i}=this,r,o,l,u,h,d;return r=this.buildValidRange(),r=this.trimHiddenDays(r),n&&(e=s7(e,r)),o=this.buildCurrentRangeInfo(e,t),l=/^(year|month|week|day)$/.test(o.unit),u=this.buildRenderRange(this.trimHiddenDays(o.range),o.unit,l),u=this.trimHiddenDays(u),h=u,i.showNonCurrentDates||(h=$s(h,o.range)),h=this.adjustActiveRange(h),h=$s(h,r),d=yx(o.range,r),ti(u,e)||(e=u.start),{currentDate:e,validRange:r,currentRange:o.range,currentRangeUnit:o.unit,isRangeAllDay:l,activeRange:h,renderRange:u,slotMinTime:i.slotMinTime,slotMaxTime:i.slotMaxTime,isValid:d,dateIncrement:this.buildDateIncrement(o.duration)}}buildValidRange(){let e=this.props.validRangeInput,t=typeof e=="function"?e.call(this.props.calendarApi,this.props.dateEnv.toDate(this.props.nowManager.getDateMarker())):e;return this.refineRange(t)||{start:null,end:null}}buildCurrentRangeInfo(e,t){let{props:n}=this,i=null,r=null,o=null,l;return n.duration?(i=n.duration,r=n.durationUnit,o=this.buildRangeFromDuration(e,t,i,r)):(l=this.props.dayCount)?(r="day",o=this.buildRangeFromDayCount(e,t,l)):(o=this.buildCustomVisibleRange(e))?r=n.dateEnv.greatestWholeUnit(o.start,o.end).unit:(i=this.getFallbackDuration(),r=Fm(i).unit,o=this.buildRangeFromDuration(e,t,i,r)),{duration:i,unit:r,range:o}}getFallbackDuration(){return He({day:1})}adjustActiveRange(e){let{dateEnv:t,usesMinMaxTime:n,slotMinTime:i,slotMaxTime:r}=this.props,{start:o,end:l}=e;return n&&(kh(i)<0&&(o=ct(o),o=t.add(o,i)),kh(r)>1&&(l=ct(l),l=Dt(l,-1),l=t.add(l,r))),{start:o,end:l}}buildRangeFromDuration(e,t,n,i){let{dateEnv:r,dateAlignment:o}=this.props,l,u,h;if(!o){let{dateIncrement:c}=this.props;c&&Ls(c)<Ls(n)?o=Fm(c).unit:o=i}kh(n)<=1&&this.isHiddenDay(l)&&(l=this.skipHiddenDays(l,t),l=ct(l));function d(){l=r.startOf(e,o),u=r.add(l,n),h={start:l,end:u}}return d(),this.trimHiddenDays(h)||(e=this.skipHiddenDays(e,t),d()),h}buildRangeFromDayCount(e,t,n){let{dateEnv:i,dateAlignment:r}=this.props,o=0,l=e,u;r&&(l=i.startOf(l,r)),l=ct(l),l=this.skipHiddenDays(l,t),u=l;do u=Dt(u,1),this.isHiddenDay(u)||(o+=1);while(o<n);return{start:l,end:u}}buildCustomVisibleRange(e){let{props:t}=this,n=t.visibleRangeInput,i=typeof n=="function"?n.call(t.calendarApi,t.dateEnv.toDate(e)):n,r=this.refineRange(i);return r&&(r.start==null||r.end==null)?null:r}buildRenderRange(e,t,n){return e}buildDateIncrement(e){let{dateIncrement:t}=this.props,n;return t||((n=this.props.dateAlignment)?He(1,n):e||He({days:1}))}refineRange(e){if(e){let t=t7(e,this.props.dateEnv);return t&&(t=bx(t)),t}return null}initHiddenDays(){let e=this.props.hiddenDays||[],t=[],n=0,i;for(this.props.weekends===!1&&e.push(0,6),i=0;i<7;i+=1)(t[i]=e.indexOf(i)!==-1)||(n+=1);if(!n)throw new Error("invalid hiddenDays");this.isHiddenDayHash=t}trimHiddenDays(e){let{start:t,end:n}=e;return t&&(t=this.skipHiddenDays(t)),n&&(n=this.skipHiddenDays(n,-1,!0)),t==null||n==null||t<n?{start:t,end:n}:null}isHiddenDay(e){return e instanceof Date&&(e=e.getUTCDay()),this.isHiddenDayHash[e]}skipHiddenDays(e,t=1,n=!1){for(;this.isHiddenDayHash[(e.getUTCDay()+(n?t:0)+7)%7];)e=Dt(e,t);return e}};function sy(s,e,t,n){return{instanceId:bo(),defId:s,range:e,forcedStartTzo:t??null,forcedEndTzo:n??null}}function i7(s,e,t,n){for(let i=0;i<n.length;i+=1){let r=n[i].parse(s,t);if(r){let{allDay:o}=s;return o==null&&(o=e,o==null&&(o=r.allDayGuess,o==null&&(o=!1))),{allDay:o,duration:r.duration,typeData:r.typeData,typeId:i}}}return null}function $c(s,e,t){let{dateEnv:n,pluginHooks:i,options:r}=t,{defs:o,instances:l}=s;l=po(l,u=>!o[u.defId].recurringDef);for(let u in o){let h=o[u];if(h.recurringDef){let{duration:d}=h.recurringDef;d||(d=h.allDay?r.defaultAllDayEventDuration:r.defaultTimedEventDuration);let c=r7(h,d,e,n,i.recurringTypes);for(let a of c){let f=sy(u,{start:a,end:n.add(a,d)});l[f.instanceId]=f}}}return{defs:o,instances:l}}function r7(s,e,t,n,i){let o=i[s.recurringDef.typeId].expand(s.recurringDef.typeData,{start:n.subtract(t.start,e),end:t.end},n);return s.allDay&&(o=o.map(ct)),o}var Qw={id:String,groupId:String,title:String,url:String,interactive:Boolean},rz={start:Q,end:Q,date:Q,allDay:Boolean},o7=Object.assign(Object.assign(Object.assign({},Qw),rz),{extendedProps:Q});function oz(s,e,t,n,i=$I(t),r,o){let{refined:l,extra:u}=vx(s,t,i),h=l7(e,t),d=i7(l,h,t.dateEnv,t.pluginHooks.recurringTypes);if(d){let a=Bm(l,u,e?e.sourceId:"",d.allDay,!!d.duration,t,r);return a.recurringDef={typeId:d.typeId,typeData:d.typeData,duration:d.duration},{def:a,instance:null}}let c=a7(l,h,t,n);if(c){let a=Bm(l,u,e?e.sourceId:"",c.allDay,c.hasEnd,t,r),f=sy(a.defId,c.range,c.forcedStartTzo,c.forcedEndTzo);return o&&a.publicId&&o[a.publicId]&&(f.instanceId=o[a.publicId]),{def:a,instance:f}}return null}function vx(s,e,t=$I(e)){return px(s,t)}function $I(s){return Object.assign(Object.assign(Object.assign({},ix),o7),s.pluginHooks.eventRefiners)}function Bm(s,e,t,n,i,r,o){let l={title:s.title||"",groupId:s.groupId||"",publicId:s.id||"",url:s.url||"",recurringDef:null,defId:(o&&s.id?o[s.id]:"")||bo(),sourceId:t,allDay:n,hasEnd:i,interactive:s.interactive,ui:Lh(s,r),extendedProps:Object.assign(Object.assign({},s.extendedProps||{}),e)};for(let u of r.pluginHooks.eventDefMemberAdders)Object.assign(l,u(s));return Object.freeze(l.ui.classNames),Object.freeze(l.extendedProps),l}function a7(s,e,t,n){let{allDay:i}=s,r,o=null,l=!1,u,h=null,d=s.start!=null?s.start:s.date;if(r=t.dateEnv.createMarkerMeta(d),r)o=r.marker;else if(!n)return null;return s.end!=null&&(u=t.dateEnv.createMarkerMeta(s.end)),i==null&&(e!=null?i=e:i=(!r||r.isTimeUnspecified)&&(!u||u.isTimeUnspecified)),i&&o&&(o=ct(o)),u&&(h=u.marker,i&&(h=ct(h)),o&&h<=o&&(h=null)),h?l=!0:n||(l=t.options.forceEventDuration||!1,h=t.dateEnv.add(o,i?t.options.defaultAllDayEventDuration:t.options.defaultTimedEventDuration)),{allDay:i,hasEnd:l,range:{start:o,end:h},forcedStartTzo:r?r.forcedTzo:null,forcedEndTzo:u?u.forcedTzo:null}}function l7(s,e){let t=null;return s&&(t=s.defaultAllDay),t==null&&(t=e.options.defaultAllDay),t}function Vm(s,e,t,n,i,r){let o=Wn(),l=$I(t);for(let u of s){let h=oz(u,e,t,n,l,i,r);h&&zm(h,o)}return o}function zm(s,e=Wn()){return e.defs[s.def.defId]=s.def,s.instance&&(e.instances[s.instance.instanceId]=s.instance),e}function iy(s,e){let t=s.instances[e];if(t){let n=s.defs[t.defId],i=wx(s,r=>c7(n,r));return i.defs[n.defId]=n,i.instances[t.instanceId]=t,i}return Wn()}function c7(s,e){return!!(s.groupId&&s.groupId===e.groupId)}function Wn(){return{defs:{},instances:{}}}function _x(s,e){return{defs:Object.assign(Object.assign({},s.defs),e.defs),instances:Object.assign(Object.assign({},s.instances),e.instances)}}function wx(s,e){let t=po(s.defs,e),n=po(s.instances,i=>t[i.defId]);return{defs:t,instances:n}}function u7(s,e){let{defs:t,instances:n}=s,i={},r={};for(let o in t)e.defs[o]||(i[o]=t[o]);for(let o in n)!e.instances[o]&&i[n[o].defId]&&(r[o]=n[o]);return{defs:i,instances:r}}function d7(s,e){return Array.isArray(s)?Vm(s,null,e,!0):typeof s=="object"&&s?Vm([s],null,e,!0):s!=null?String(s):null}function hI(s){return Array.isArray(s)?s:typeof s=="string"?s.split(/\s+/):[]}var ix={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:Q,overlap:Q,allow:Q,className:hI,classNames:hI,color:String,backgroundColor:String,borderColor:String,textColor:String},h7={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]};function Lh(s,e){let t=d7(s.constraint,e);return{display:s.display||null,startEditable:s.startEditable!=null?s.startEditable:s.editable,durationEditable:s.durationEditable!=null?s.durationEditable:s.editable,constraints:t!=null?[t]:[],overlap:s.overlap!=null?s.overlap:null,allows:s.allow!=null?[s.allow]:[],backgroundColor:s.backgroundColor||s.color||"",borderColor:s.borderColor||s.color||"",textColor:s.textColor||"",classNames:(s.className||[]).concat(s.classNames||[])}}function UI(s){return s.reduce(f7,h7)}function f7(s,e){return{display:e.display!=null?e.display:s.display,startEditable:e.startEditable!=null?e.startEditable:s.startEditable,durationEditable:e.durationEditable!=null?e.durationEditable:s.durationEditable,constraints:s.constraints.concat(e.constraints),overlap:typeof e.overlap=="boolean"?e.overlap:s.overlap,allows:s.allows.concat(e.allows),backgroundColor:e.backgroundColor||s.backgroundColor,borderColor:e.borderColor||s.borderColor,textColor:e.textColor||s.textColor,classNames:s.classNames.concat(e.classNames)}}var p7={id:String,defaultAllDay:Boolean,url:String,format:String,events:Q,eventDataTransform:Q,success:Q,failure:Q};function BI(s,e,t=VI(e)){let n;if(typeof s=="string"?n={url:s}:typeof s=="function"||Array.isArray(s)?n={events:s}:typeof s=="object"&&s&&(n=s),n){let{refined:i,extra:r}=px(n,t),o=g7(i,e);if(o)return{_raw:s,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:i.defaultAllDay,eventDataTransform:i.eventDataTransform,success:i.success,failure:i.failure,publicId:i.id||"",sourceId:bo(),sourceDefId:o.sourceDefId,meta:o.meta,ui:Lh(i,e),extendedProps:r}}return null}function VI(s){return Object.assign(Object.assign(Object.assign({},ix),p7),s.pluginHooks.eventSourceRefiners)}function g7(s,e){let t=e.pluginHooks.eventSourceDefs;for(let n=t.length-1;n>=0;n-=1){let r=t[n].parseMeta(s);if(r)return{sourceDefId:n,meta:r}}return null}function az(s,e,t,n,i){switch(e.type){case"RECEIVE_EVENTS":return m7(s,t[e.sourceId],e.fetchId,e.fetchRange,e.rawEvents,i);case"RESET_RAW_EVENTS":return y7(s,t[e.sourceId],e.rawEvents,n.activeRange,i);case"ADD_EVENTS":return b7(s,e.eventStore,n?n.activeRange:null,i);case"RESET_EVENTS":return e.eventStore;case"MERGE_EVENTS":return _x(s,e.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return n?$c(s,n.activeRange,i):s;case"REMOVE_EVENTS":return u7(s,e.eventStore);case"REMOVE_EVENT_SOURCE":return cz(s,e.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return wx(s,r=>!r.sourceId);case"REMOVE_ALL_EVENTS":return Wn();default:return s}}function m7(s,e,t,n,i,r){if(e&&t===e.latestFetchId){let o=Vm(lz(i,e,r),e,r);return n&&(o=$c(o,n,r)),_x(cz(s,e.sourceId),o)}return s}function y7(s,e,t,n,i){let{defIdMap:r,instanceIdMap:o}=_7(s),l=Vm(lz(t,e,i),e,i,!1,r,o);return $c(l,n,i)}function lz(s,e,t){let n=t.options.eventDataTransform,i=e?e.eventDataTransform:null;return i&&(s=NV(s,i)),n&&(s=NV(s,n)),s}function NV(s,e){let t;if(!e)t=s;else{t=[];for(let n of s){let i=e(n);i?t.push(i):i==null&&t.push(n)}}return t}function b7(s,e,t,n){return t&&(e=$c(e,t,n)),_x(s,e)}function zI(s,e,t){let{defs:n}=s,i=ni(s.instances,r=>n[r.defId].allDay?r:Object.assign(Object.assign({},r),{range:{start:t.createMarker(e.toDate(r.range.start,r.forcedStartTzo)),end:t.createMarker(e.toDate(r.range.end,r.forcedEndTzo))},forcedStartTzo:t.canComputeOffset?null:r.forcedStartTzo,forcedEndTzo:t.canComputeOffset?null:r.forcedEndTzo}));return{defs:n,instances:i}}function cz(s,e){return wx(s,t=>t.sourceId!==e)}function v7(s,e){return{defs:s.defs,instances:po(s.instances,t=>!e[t.instanceId])}}function _7(s){let{defs:e,instances:t}=s,n={},i={};for(let r in e){let o=e[r],{publicId:l}=o;l&&(n[l]=r)}for(let r in t){let o=t[r],l=e[o.defId],{publicId:u}=l;u&&(i[u]=r)}return{defIdMap:n,instanceIdMap:i}}var mo=class{constructor(){this.handlers={},this.thisContext=null}setThisContext(e){this.thisContext=e}setOptions(e){this.options=e}on(e,t){w7(this.handlers,e,t)}off(e,t){x7(this.handlers,e,t)}trigger(e,...t){let n=this.handlers[e]||[],i=this.options&&this.options[e],r=[].concat(i||[],n);for(let o of r)o.apply(this.thisContext,t)}hasHandlers(e){return!!(this.handlers[e]&&this.handlers[e].length||this.options&&this.options[e])}};function w7(s,e,t){(s[e]||(s[e]=[])).push(t)}function x7(s,e,t){t?s[e]&&(s[e]=s[e].filter(n=>n!==t)):delete s[e]}var E7={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"};function HI(s,e){return Vm(S7(s),null,e)}function S7(s){let e;return s===!0?e=[{}]:Array.isArray(s)?e=s.filter(t=>t.daysOfWeek):typeof s=="object"&&s?e=[s]:e=[],e=e.map(t=>Object.assign(Object.assign({},E7),t)),e}function xx(s,e,t){t.emitter.trigger("select",Object.assign(Object.assign({},GI(s,t)),{jsEvent:e?e.origEvent:null,view:t.viewApi||t.calendarApi.view}))}function T7(s,e){e.emitter.trigger("unselect",{jsEvent:s?s.origEvent:null,view:e.viewApi||e.calendarApi.view})}function GI(s,e){let t={};for(let n of e.pluginHooks.dateSpanTransforms)Object.assign(t,n(s,e));return Object.assign(t,L7(s,e.dateEnv)),t}function rx(s,e,t){let{dateEnv:n,options:i}=t,r=e;return s?(r=ct(r),r=n.add(r,i.defaultAllDayEventDuration)):r=n.add(r,i.defaultTimedEventDuration),r}function ry(s,e,t,n){let i=ox(s.defs,e),r=Wn();for(let o in s.defs){let l=s.defs[o];r.defs[o]=A7(l,i[o],t,n)}for(let o in s.instances){let l=s.instances[o],u=r.defs[l.defId];r.instances[o]=C7(l,u,i[l.defId],t,n)}return r}function A7(s,e,t,n){let i=t.standardProps||{};i.hasEnd==null&&e.durationEditable&&(t.startDelta||t.endDelta)&&(i.hasEnd=!0);let r=Object.assign(Object.assign(Object.assign({},s),i),{ui:Object.assign(Object.assign({},s.ui),i.ui)});t.extendedProps&&(r.extendedProps=Object.assign(Object.assign({},r.extendedProps),t.extendedProps));for(let o of n.pluginHooks.eventDefMutationAppliers)o(r,t,n);return!r.hasEnd&&n.options.forceEventDuration&&(r.hasEnd=!0),r}function C7(s,e,t,n,i){let{dateEnv:r}=i,o=n.standardProps&&n.standardProps.allDay===!0,l=n.standardProps&&n.standardProps.hasEnd===!1,u=Object.assign({},s);return o&&(u.range=iz(u.range)),n.datesDelta&&t.startEditable&&(u.range={start:r.add(u.range.start,n.datesDelta),end:r.add(u.range.end,n.datesDelta)}),n.startDelta&&t.durationEditable&&(u.range={start:r.add(u.range.start,n.startDelta),end:u.range.end}),n.endDelta&&t.durationEditable&&(u.range={start:u.range.start,end:r.add(u.range.end,n.endDelta)}),l&&(u.range={start:u.range.start,end:rx(e.allDay,u.range.start,i)}),e.allDay&&(u.range={start:ct(u.range.start),end:ct(u.range.end)}),u.range.end<u.range.start&&(u.range.end=rx(e.allDay,u.range.start,i)),u}var Sa=class{constructor(e,t){this.context=e,this.internalEventSource=t}remove(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})}refetch(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId],isRefetch:!0})}get id(){return this.internalEventSource.publicId}get url(){return this.internalEventSource.meta.url}get format(){return this.internalEventSource.meta.format}},_t=class s{constructor(e,t,n){this._context=e,this._def=t,this._instance=n||null}setProp(e,t){if(e in rz)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if(e==="id")t=Qw[e](t),this.mutate({standardProps:{publicId:t}});else if(e in Qw)t=Qw[e](t),this.mutate({standardProps:{[e]:t}});else if(e in ix){let n=ix[e](t);e==="color"?n={backgroundColor:t,borderColor:t}:e==="editable"?n={startEditable:t,durationEditable:t}:n={[e]:t},this.mutate({standardProps:{ui:n}})}else console.warn(`Could not set prop '${e}'. Use setExtendedProp instead.`)}setExtendedProp(e,t){this.mutate({extendedProps:{[e]:t}})}setStart(e,t={}){let{dateEnv:n}=this._context,i=n.createMarker(e);if(i&&this._instance){let r=this._instance.range,o=Ca(r.start,i,n,t.granularity);t.maintainDuration?this.mutate({datesDelta:o}):this.mutate({startDelta:o})}}setEnd(e,t={}){let{dateEnv:n}=this._context,i;if(!(e!=null&&(i=n.createMarker(e),!i))&&this._instance)if(i){let r=Ca(this._instance.range.end,i,n,t.granularity);this.mutate({endDelta:r})}else this.mutate({standardProps:{hasEnd:!1}})}setDates(e,t,n={}){let{dateEnv:i}=this._context,r={allDay:n.allDay},o=i.createMarker(e),l;if(o&&!(t!=null&&(l=i.createMarker(t),!l))&&this._instance){let u=this._instance.range;n.allDay===!0&&(u=iz(u));let h=Ca(u.start,o,i,n.granularity);if(l){let d=Ca(u.end,l,i,n.granularity);vK(h,d)?this.mutate({datesDelta:h,standardProps:r}):this.mutate({startDelta:h,endDelta:d,standardProps:r})}else r.hasEnd=!1,this.mutate({datesDelta:h,standardProps:r})}}moveStart(e){let t=He(e);t&&this.mutate({startDelta:t})}moveEnd(e){let t=He(e);t&&this.mutate({endDelta:t})}moveDates(e){let t=He(e);t&&this.mutate({datesDelta:t})}setAllDay(e,t={}){let n={allDay:e},{maintainDuration:i}=t;i==null&&(i=this._context.options.allDayMaintainDuration),this._def.allDay!==e&&(n.hasEnd=i),this.mutate({standardProps:n})}formatRange(e){let{dateEnv:t}=this._context,n=this._instance,i=dt(e);return this._def.hasEnd?t.formatRange(n.range.start,n.range.end,i,{forcedStartTzo:n.forcedStartTzo,forcedEndTzo:n.forcedEndTzo}):t.format(n.range.start,i,{forcedTzo:n.forcedStartTzo})}mutate(e){let t=this._instance;if(t){let n=this._def,i=this._context,{eventStore:r}=i.getCurrentData(),o=iy(r,t.instanceId);o=ry(o,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}},e,i);let u=new s(i,n,t);this._def=o.defs[n.defId],this._instance=o.instances[t.instanceId],i.dispatch({type:"MERGE_EVENTS",eventStore:o}),i.emitter.trigger("eventChange",{oldEvent:u,event:this,relatedEvents:gr(o,i,t),revert(){i.dispatch({type:"RESET_EVENTS",eventStore:r})}})}}remove(){let e=this._context,t=uz(this);e.dispatch({type:"REMOVE_EVENTS",eventStore:t}),e.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert(){e.dispatch({type:"MERGE_EVENTS",eventStore:t})}})}get source(){let{sourceId:e}=this._def;return e?new Sa(this._context,this._context.getCurrentData().eventSources[e]):null}get start(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null}get end(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null}get startStr(){let e=this._instance;return e?this._context.dateEnv.formatIso(e.range.start,{omitTime:this._def.allDay,forcedTzo:e.forcedStartTzo}):""}get endStr(){let e=this._instance;return e&&this._def.hasEnd?this._context.dateEnv.formatIso(e.range.end,{omitTime:this._def.allDay,forcedTzo:e.forcedEndTzo}):""}get id(){return this._def.publicId}get groupId(){return this._def.groupId}get allDay(){return this._def.allDay}get title(){return this._def.title}get url(){return this._def.url}get display(){return this._def.ui.display||"auto"}get startEditable(){return this._def.ui.startEditable}get durationEditable(){return this._def.ui.durationEditable}get constraint(){return this._def.ui.constraints[0]||null}get overlap(){return this._def.ui.overlap}get allow(){return this._def.ui.allows[0]||null}get backgroundColor(){return this._def.ui.backgroundColor}get borderColor(){return this._def.ui.borderColor}get textColor(){return this._def.ui.textColor}get classNames(){return this._def.ui.classNames}get extendedProps(){return this._def.extendedProps}toPlainObject(e={}){let t=this._def,{ui:n}=t,{startStr:i,endStr:r}=this,o={allDay:t.allDay};return t.title&&(o.title=t.title),i&&(o.start=i),r&&(o.end=r),t.publicId&&(o.id=t.publicId),t.groupId&&(o.groupId=t.groupId),t.url&&(o.url=t.url),n.display&&n.display!=="auto"&&(o.display=n.display),e.collapseColor&&n.backgroundColor&&n.backgroundColor===n.borderColor?o.color=n.backgroundColor:(n.backgroundColor&&(o.backgroundColor=n.backgroundColor),n.borderColor&&(o.borderColor=n.borderColor)),n.textColor&&(o.textColor=n.textColor),n.classNames.length&&(o.classNames=n.classNames),Object.keys(t.extendedProps).length&&(e.collapseExtendedProps?Object.assign(o,t.extendedProps):o.extendedProps=t.extendedProps),o}toJSON(){return this.toPlainObject()}};function uz(s){let e=s._def,t=s._instance;return{defs:{[e.defId]:e},instances:t?{[t.instanceId]:t}:{}}}function gr(s,e,t){let{defs:n,instances:i}=s,r=[],o=t?t.instanceId:"";for(let l in i){let u=i[l],h=n[u.defId];u.instanceId!==o&&r.push(new _t(e,h,u))}return r}function Ph(s,e,t,n){let i={},r={},o={},l=[],u=[],h=ox(s.defs,e);for(let d in s.defs){let c=s.defs[d];h[c.defId].display==="inverse-background"&&(c.groupId?(i[c.groupId]=[],o[c.groupId]||(o[c.groupId]=c)):r[d]=[])}for(let d in s.instances){let c=s.instances[d],a=s.defs[c.defId],f=h[a.defId],p=c.range,g=!a.allDay&&n?bx(p,n):p,m=$s(g,t);m&&(f.display==="inverse-background"?a.groupId?i[a.groupId].push(m):r[c.defId].push(m):f.display!=="none"&&(f.display==="background"?l:u).push({def:a,ui:f,instance:c,range:m,isStart:g.start&&g.start.valueOf()===m.start.valueOf(),isEnd:g.end&&g.end.valueOf()===m.end.valueOf()}))}for(let d in i){let c=i[d],a=MV(c,t);for(let f of a){let p=o[d],g=h[p.defId];l.push({def:p,ui:g,instance:null,range:f,isStart:!1,isEnd:!1})}}for(let d in r){let c=r[d],a=MV(c,t);for(let f of a)l.push({def:s.defs[d],ui:h[d],instance:null,range:f,isStart:!1,isEnd:!1})}return{bg:l,fg:u}}function jI(s){return s.ui.display==="background"||s.ui.display==="inverse-background"}function OV(s,e){s.fcSeg=e}function vo(s){return s.fcSeg||s.parentNode.fcSeg||null}function ox(s,e){return ni(s,t=>dz(t,e))}function dz(s,e){let t=[];return e[""]&&t.push(e[""]),e[s.defId]&&t.push(e[s.defId]),t.push(s.ui),UI(t)}function Yc(s,e){let t=s.map(I7);return t.sort((n,i)=>WV(n,i,e)),t.map(n=>n._seg)}function I7(s){let{eventRange:e}=s,t=e.def,n=e.instance?e.instance.range:e.range,i=n.start?n.start.valueOf():0,r=n.end?n.end.valueOf():0;return Object.assign(Object.assign(Object.assign({},t.extendedProps),t),{id:t.publicId,start:i,end:r,duration:r-i,allDay:Number(t.allDay),_seg:s})}function D7(s,e){let{pluginHooks:t}=e,n=t.isDraggableTransformers,{def:i,ui:r}=s.eventRange,o=r.startEditable;for(let l of n)o=l(o,i,r,e);return o}function k7(s,e){return s.isStart&&s.eventRange.ui.durationEditable&&e.options.eventResizableFromStart}function R7(s,e){return s.isEnd&&s.eventRange.ui.durationEditable}function Oa(s,e,t,n,i,r,o){let{dateEnv:l,options:u}=t,{displayEventTime:h,displayEventEnd:d}=u,c=s.eventRange.def,a=s.eventRange.instance;h==null&&(h=n!==!1),d==null&&(d=i!==!1);let f=a.range.start,p=a.range.end,g=r||s.start||s.eventRange.range.start,m=o||s.end||s.eventRange.range.end,y=ct(f).valueOf()===ct(g).valueOf(),_=ct(ur(p,-1)).valueOf()===ct(ur(m,-1)).valueOf();return h&&!c.allDay&&(y||_)?(g=y?f:g,m=_?p:m,d&&c.hasEnd?l.formatRange(g,m,e,{forcedStartTzo:r?null:a.forcedStartTzo,forcedEndTzo:o?null:a.forcedEndTzo}):l.format(g,e,{forcedTzo:r?null:a.forcedStartTzo})):""}function Bs(s,e,t){let n=s.eventRange.range;return{isPast:n.end<=(t||e.start),isFuture:n.start>=(t||e.end),isToday:e&&ti(e,n.start)}}function P7(s){let e=["fc-event"];return s.isMirror&&e.push("fc-event-mirror"),s.isDraggable&&e.push("fc-event-draggable"),(s.isStartResizable||s.isEndResizable)&&e.push("fc-event-resizable"),s.isDragging&&e.push("fc-event-dragging"),s.isResizing&&e.push("fc-event-resizing"),s.isSelected&&e.push("fc-event-selected"),s.isStart&&e.push("fc-event-start"),s.isEnd&&e.push("fc-event-end"),s.isPast&&e.push("fc-event-past"),s.isToday&&e.push("fc-event-today"),s.isFuture&&e.push("fc-event-future"),e}function oy(s){return s.instance?s.instance.instanceId:`${s.def.defId}:${s.range.start.toISOString()}`}function $h(s,e){let{def:t,instance:n}=s.eventRange,{url:i}=t;if(i)return{href:i};let{emitter:r,options:o}=e,{eventInteractive:l}=o;return l==null&&(l=t.interactive,l==null&&(l=!!r.hasHandlers("eventClick"))),l?GV(u=>{r.trigger("eventClick",{el:u.target,event:new _t(e,t,n),jsEvent:u,view:e.viewApi})}):{}}var M7={start:Q,end:Q,allDay:Boolean};function N7(s,e,t){let n=O7(s,e),{range:i}=n;if(!i.start)return null;if(!i.end){if(t==null)return null;i.end=e.add(i.start,t)}return n}function O7(s,e){let{refined:t,extra:n}=px(s,M7),i=t.start?e.createMarkerMeta(t.start):null,r=t.end?e.createMarkerMeta(t.end):null,{allDay:o}=t;return o==null&&(o=i&&i.isTimeUnspecified&&(!r||r.isTimeUnspecified)),Object.assign({range:{start:i?i.marker:null,end:r?r.marker:null},allDay:o},n)}function WI(s,e){return sz(s.range,e.range)&&s.allDay===e.allDay&&F7(s,e)}function F7(s,e){for(let t in e)if(t!=="range"&&t!=="allDay"&&s[t]!==e[t])return!1;for(let t in s)if(!(t in e))return!1;return!0}function L7(s,e){return Object.assign(Object.assign({},hz(s.range,e,s.allDay)),{allDay:s.allDay})}function qI(s,e,t){return Object.assign(Object.assign({},hz(s,e,t)),{timeZone:e.timeZone})}function hz(s,e,t){return{start:e.toDate(s.start),end:e.toDate(s.end),startStr:e.formatIso(s.start,{omitTime:t}),endStr:e.formatIso(s.end,{omitTime:t})}}function $7(s,e,t){let n=vx({editable:!1},t),i=Bm(n.refined,n.extra,"",s.allDay,!0,t);return{def:i,ui:dz(i,e),instance:sy(i.defId,s.range),range:s.range,isStart:!0,isEnd:!0}}function YI(s,e,t){let n=!1,i=function(l){n||(n=!0,e(l))},r=function(l){n||(n=!0,t(l))},o=s(i,r);o&&typeof o.then=="function"&&o.then(i,r)}var ax=class extends Error{constructor(e,t){super(e),this.response=t}};function KI(s,e,t){s=s.toUpperCase();let n={method:s};return s==="GET"?e+=(e.indexOf("?")===-1?"?":"&")+new URLSearchParams(t):(n.body=new URLSearchParams(t),n.headers={"Content-Type":"application/x-www-form-urlencoded"}),fetch(e,n).then(i=>{if(i.ok)return i.json().then(r=>[r,i],()=>{throw new ax("Failure parsing JSON",i)});throw new ax("Request failed",i)})}var Z1;function XI(){return Z1==null&&(Z1=U7()),Z1}function U7(){if(typeof document>"u")return!0;let s=document.createElement("div");s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.innerHTML="<table><tr><td><div></div></td></tr></table>",s.querySelector("table").style.height="100px",s.querySelector("div").style.height="100%",document.body.appendChild(s);let t=s.querySelector("div").offsetHeight>0;return document.body.removeChild(s),t}var Hm=class extends Ge{constructor(){super(...arguments),this.state={forPrint:!1},this.handleBeforePrint=()=>{$m(()=>{this.setState({forPrint:!0})})},this.handleAfterPrint=()=>{$m(()=>{this.setState({forPrint:!1})})}}render(){let{props:e}=this,{options:t}=e,{forPrint:n}=this.state,i=n||t.height==="auto"||t.contentHeight==="auto",r=!i&&t.height!=null?t.height:"",o=["fc",n?"fc-media-print":"fc-media-screen",`fc-direction-${t.direction}`,e.theme.getClass("root")];return XI()||o.push("fc-liquid-hack"),e.children(o,r,i,n)}componentDidMount(){let{emitter:e}=this.props;e.on("_beforeprint",this.handleBeforePrint),e.on("_afterprint",this.handleAfterPrint)}componentWillUnmount(){let{emitter:e}=this.props;e.off("_beforeprint",this.handleBeforePrint),e.off("_afterprint",this.handleAfterPrint)}},ki=class{constructor(e){this.component=e.component,this.isHitComboAllowed=e.isHitComboAllowed||null}destroy(){}};function fz(s,e){return{component:s,el:e.el,useEventCenter:e.useEventCenter!=null?e.useEventCenter:!0,isHitComboAllowed:e.isHitComboAllowed||null}}function ay(s){return{[s.component.uid]:s}}var Uh={},bs=class extends Rn{constructor(e,t){super(e,t),this.handleRefresh=()=>{let n=this.computeTiming();n.state.nowDate.valueOf()!==this.state.nowDate.valueOf()&&this.setState(n.state),this.clearTimeout(),this.setTimeout(n.waitMs)},this.handleVisibilityChange=()=>{document.hidden||this.handleRefresh()},this.state=this.computeTiming().state}render(){let{props:e,state:t}=this;return e.children(t.nowDate,t.todayRange)}componentDidMount(){this.setTimeout(),this.context.nowManager.addResetListener(this.handleRefresh),document.addEventListener("visibilitychange",this.handleVisibilityChange)}componentDidUpdate(e){e.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())}componentWillUnmount(){this.clearTimeout(),this.context.nowManager.removeResetListener(this.handleRefresh),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}computeTiming(){let{props:e,context:t}=this,n=t.nowManager.getDateMarker(),{nowIndicatorSnap:i}=t.options;i==="auto"&&(i=/year|month|week|day/.test(e.unit)||(e.unitValue||1)===1);let r,o;return i?(r=t.dateEnv.startOf(n,e.unit),o=t.dateEnv.add(r,He(1,e.unit)).valueOf()-n.valueOf()):(r=n,o=1e3*60),o=Math.min(1e3*60*60*24,o),{state:{nowDate:r,todayRange:B7(r)},waitMs:o}}setTimeout(e=this.computeTiming().waitMs){this.timeoutId=setTimeout(()=>{let t=this.computeTiming();this.setState(t.state,()=>{this.setTimeout(t.waitMs)})},e)}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}};bs.contextType=ii;function B7(s){let e=ct(s),t=Dt(e,1);return{start:e,end:t}}var Gm=class{getCurrentData(){return this.currentDataManager.getCurrentData()}dispatch(e){this.currentDataManager.dispatch(e)}get view(){return this.getCurrentData().viewApi}batchRendering(e){e()}updateSize(){this.trigger("_resize",!0)}setOption(e,t){this.dispatch({type:"SET_OPTION",optionName:e,rawOptionValue:t})}getOption(e){return this.currentDataManager.currentCalendarOptionsInput[e]}getAvailableLocaleCodes(){return Object.keys(this.getCurrentData().availableRawLocales)}on(e,t){let{currentDataManager:n}=this;n.currentCalendarOptionsRefiners[e]?n.emitter.on(e,t):console.warn(`Unknown listener name '${e}'`)}off(e,t){this.currentDataManager.emitter.off(e,t)}trigger(e,...t){this.currentDataManager.emitter.trigger(e,...t)}changeView(e,t){this.batchRendering(()=>{if(this.unselect(),t)if(t.start&&t.end)this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e}),this.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:t});else{let{dateEnv:n}=this.getCurrentData();this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e,dateMarker:n.createMarker(t)})}else this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e})})}zoomTo(e,t){let n=this.getCurrentData(),i;t=t||"day",i=n.viewSpecs[t]||this.getUnitViewSpec(t),this.unselect(),i?this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:i.type,dateMarker:e}):this.dispatch({type:"CHANGE_DATE",dateMarker:e})}getUnitViewSpec(e){let{viewSpecs:t,toolbarConfig:n}=this.getCurrentData(),i=[].concat(n.header?n.header.viewsWithButtons:[],n.footer?n.footer.viewsWithButtons:[]),r,o;for(let l in t)i.push(l);for(r=0;r<i.length;r+=1)if(o=t[i[r]],o&&o.singleUnit===e)return o;return null}prev(){this.unselect(),this.dispatch({type:"PREV"})}next(){this.unselect(),this.dispatch({type:"NEXT"})}prevYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,-1)})}nextYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,1)})}today(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.nowManager.getDateMarker()})}gotoDate(e){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.createMarker(e)})}incrementDate(e){let t=this.getCurrentData(),n=He(e);n&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.add(t.currentDate,n)}))}getDate(){let e=this.getCurrentData();return e.dateEnv.toDate(e.currentDate)}formatDate(e,t){let{dateEnv:n}=this.getCurrentData();return n.format(n.createMarker(e),dt(t))}formatRange(e,t,n){let{dateEnv:i}=this.getCurrentData();return i.formatRange(i.createMarker(e),i.createMarker(t),dt(n),n)}formatIso(e,t){let{dateEnv:n}=this.getCurrentData();return n.formatIso(n.createMarker(e),{omitTime:t})}select(e,t){let n;t==null?e.start!=null?n=e:n={start:e,end:null}:n={start:e,end:t};let i=this.getCurrentData(),r=N7(n,i.dateEnv,He({days:1}));r&&(this.dispatch({type:"SELECT_DATES",selection:r}),xx(r,null,i))}unselect(e){let t=this.getCurrentData();t.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),T7(e,t))}addEvent(e,t){if(e instanceof _t){let o=e._def,l=e._instance;return this.getCurrentData().eventStore.defs[o.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:zm({def:o,instance:l})}),this.triggerEventAdd(e)),e}let n=this.getCurrentData(),i;if(t instanceof Sa)i=t.internalEventSource;else if(typeof t=="boolean")t&&([i]=mx(n.eventSources));else if(t!=null){let o=this.getEventSourceById(t);if(!o)return console.warn(`Could not find an event source with ID "${t}"`),null;i=o.internalEventSource}let r=oz(e,i,n,!1);if(r){let o=new _t(n,r.def,r.def.recurringDef?null:r.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:zm(r)}),this.triggerEventAdd(o),o}return null}triggerEventAdd(e){let{emitter:t}=this.getCurrentData();t.trigger("eventAdd",{event:e,relatedEvents:[],revert:()=>{this.dispatch({type:"REMOVE_EVENTS",eventStore:uz(e)})}})}getEventById(e){let t=this.getCurrentData(),{defs:n,instances:i}=t.eventStore;e=String(e);for(let r in n){let o=n[r];if(o.publicId===e){if(o.recurringDef)return new _t(t,o,null);for(let l in i){let u=i[l];if(u.defId===o.defId)return new _t(t,o,u)}}}return null}getEvents(){let e=this.getCurrentData();return gr(e.eventStore,e)}removeAllEvents(){this.dispatch({type:"REMOVE_ALL_EVENTS"})}getEventSources(){let e=this.getCurrentData(),t=e.eventSources,n=[];for(let i in t)n.push(new Sa(e,t[i]));return n}getEventSourceById(e){let t=this.getCurrentData(),n=t.eventSources;e=String(e);for(let i in n)if(n[i].publicId===e)return new Sa(t,n[i]);return null}addEventSource(e){let t=this.getCurrentData();if(e instanceof Sa)return t.eventSources[e.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[e.internalEventSource]}),e;let n=BI(e,t);return n?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[n]}),new Sa(t,n)):null}removeAllEventSources(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})}refetchEvents(){this.dispatch({type:"FETCH_EVENT_SOURCES",isRefetch:!0})}scrollToTime(e){let t=He(e);t&&this.trigger("_scrollRequest",{time:t})}};function JI(s,e){return s.left>=e.left&&s.left<e.right&&s.top>=e.top&&s.top<e.bottom}function Ex(s,e){let t={left:Math.max(s.left,e.left),right:Math.min(s.right,e.right),top:Math.max(s.top,e.top),bottom:Math.min(s.bottom,e.bottom)};return t.left<t.right&&t.top<t.bottom?t:!1}function ZI(s,e){return{left:Math.min(Math.max(s.left,e.left),e.right),top:Math.min(Math.max(s.top,e.top),e.bottom)}}function QI(s){return{left:(s.left+s.right)/2,top:(s.top+s.bottom)/2}}function eD(s,e){return{left:s.left-e.left,top:s.top-e.top}}var Q1=Wn(),jm=class{constructor(){this.getKeysForEventDefs=xe(this._getKeysForEventDefs),this.splitDateSelection=xe(this._splitDateSpan),this.splitEventStore=xe(this._splitEventStore),this.splitIndividualUi=xe(this._splitIndividualUi),this.splitEventDrag=xe(this._splitInteraction),this.splitEventResize=xe(this._splitInteraction),this.eventUiBuilders={}}splitProps(e){let t=this.getKeyInfo(e),n=this.getKeysForEventDefs(e.eventStore),i=this.splitDateSelection(e.dateSelection),r=this.splitIndividualUi(e.eventUiBases,n),o=this.splitEventStore(e.eventStore,n),l=this.splitEventDrag(e.eventDrag),u=this.splitEventResize(e.eventResize),h={};this.eventUiBuilders=ni(t,(d,c)=>this.eventUiBuilders[c]||xe(V7));for(let d in t){let c=t[d],a=o[d]||Q1,f=this.eventUiBuilders[d];h[d]={businessHours:c.businessHours||e.businessHours,dateSelection:i[d]||null,eventStore:a,eventUiBases:f(e.eventUiBases[""],c.ui,r[d]),eventSelection:a.instances[e.eventSelection]?e.eventSelection:"",eventDrag:l[d]||null,eventResize:u[d]||null}}return h}_splitDateSpan(e){let t={};if(e){let n=this.getKeysForDateSpan(e);for(let i of n)t[i]=e}return t}_getKeysForEventDefs(e){return ni(e.defs,t=>this.getKeysForEventDef(t))}_splitEventStore(e,t){let{defs:n,instances:i}=e,r={};for(let o in n)for(let l of t[o])r[l]||(r[l]=Wn()),r[l].defs[o]=n[o];for(let o in i){let l=i[o];for(let u of t[l.defId])r[u]&&(r[u].instances[o]=l)}return r}_splitIndividualUi(e,t){let n={};for(let i in e)if(i)for(let r of t[i])n[r]||(n[r]={}),n[r][i]=e[i];return n}_splitInteraction(e){let t={};if(e){let n=this._splitEventStore(e.affectedEvents,this._getKeysForEventDefs(e.affectedEvents)),i=this._getKeysForEventDefs(e.mutatedEvents),r=this._splitEventStore(e.mutatedEvents,i),o=l=>{t[l]||(t[l]={affectedEvents:n[l]||Q1,mutatedEvents:r[l]||Q1,isEvent:e.isEvent})};for(let l in n)o(l);for(let l in r)o(l)}return t}};function V7(s,e,t){let n=[];s&&n.push(s),e&&n.push(e);let i={"":UI(n)};return t&&Object.assign(i,t),i}function ly(s,e,t,n){return{dow:s.getUTCDay(),isDisabled:!!(n&&(!n.activeRange||!ti(n.activeRange,s))),isOther:!!(n&&!ti(n.currentRange,s)),isToday:!!(e&&ti(e,s)),isPast:!!(t?s<t:e&&s<e.start),isFuture:!!(t?s>t:e&&s>=e.end)}}function Bh(s,e){let t=["fc-day",`fc-day-${xK[s.dow]}`];return s.isDisabled?t.push("fc-day-disabled"):(s.isToday&&(t.push("fc-day-today"),t.push(e.getClass("today"))),s.isPast&&t.push("fc-day-past"),s.isFuture&&t.push("fc-day-future"),s.isOther&&t.push("fc-day-other")),t}var z7=dt({year:"numeric",month:"long",day:"numeric"}),H7=dt({week:"long"});function mr(s,e,t="day",n=!0){let{dateEnv:i,options:r,calendarApi:o}=s,l=i.format(e,t==="week"?H7:z7);if(r.navLinks){let u=i.toDate(e),h=d=>{let c=t==="day"?r.navLinkDayClick:t==="week"?r.navLinkWeekClick:null;typeof c=="function"?c.call(o,i.toDate(e),d):(typeof c=="string"&&(t=c),o.zoomTo(e,t))};return Object.assign({title:Nh(r.navLinkHint,[l,u],l),"data-navlink":""},n?HV(h):{onClick:h})}return{"aria-label":l}}var eI=null;function pz(){return eI===null&&(eI=G7()),eI}function G7(){let s=document.createElement("div");qc(s,{position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}),s.innerHTML="<div></div>",document.body.appendChild(s);let t=s.firstChild.getBoundingClientRect().left>s.getBoundingClientRect().left;return Jm(s),t}var tI;function gz(){return tI||(tI=j7()),tI}function j7(){let s=document.createElement("div");s.style.overflow="scroll",s.style.position="absolute",s.style.top="-9999px",s.style.left="-9999px",document.body.appendChild(s);let e=mz(s);return document.body.removeChild(s),e}function mz(s){return{x:s.offsetHeight-s.clientHeight,y:s.offsetWidth-s.clientWidth}}function yz(s,e=!1){let t=window.getComputedStyle(s),n=parseInt(t.borderLeftWidth,10)||0,i=parseInt(t.borderRightWidth,10)||0,r=parseInt(t.borderTopWidth,10)||0,o=parseInt(t.borderBottomWidth,10)||0,l=mz(s),u=l.y-n-i,h=l.x-r-o,d={borderLeft:n,borderRight:i,borderTop:r,borderBottom:o,scrollbarBottom:h,scrollbarLeft:0,scrollbarRight:0};return pz()&&t.direction==="rtl"?d.scrollbarLeft=u:d.scrollbarRight=u,e&&(d.paddingLeft=parseInt(t.paddingLeft,10)||0,d.paddingRight=parseInt(t.paddingRight,10)||0,d.paddingTop=parseInt(t.paddingTop,10)||0,d.paddingBottom=parseInt(t.paddingBottom,10)||0),d}function tD(s,e=!1,t){let n=t?s.getBoundingClientRect():cy(s),i=yz(s,e),r={left:n.left+i.borderLeft+i.scrollbarLeft,right:n.right-i.borderRight-i.scrollbarRight,top:n.top+i.borderTop,bottom:n.bottom-i.borderBottom-i.scrollbarBottom};return e&&(r.left+=i.paddingLeft,r.right-=i.paddingRight,r.top+=i.paddingTop,r.bottom-=i.paddingBottom),r}function cy(s){let e=s.getBoundingClientRect();return{left:e.left+window.scrollX,top:e.top+window.scrollY,right:e.right+window.scrollX,bottom:e.bottom+window.scrollY}}function W7(s){let e=Sx(s),t=s.getBoundingClientRect();for(let n of e){let i=Ex(t,n.getBoundingClientRect());if(i)t=i;else return null}return t}function Sx(s){let e=[];for(;s instanceof HTMLElement;){let t=window.getComputedStyle(s);if(t.position==="fixed")break;/(auto|scroll)/.test(t.overflow+t.overflowY+t.overflowX)&&e.push(s),s=s.parentNode}return e}var Ri=class{constructor(e,t,n,i){this.els=t;let r=this.originClientRect=e.getBoundingClientRect();n&&this.buildElHorizontals(r.left),i&&this.buildElVerticals(r.top)}buildElHorizontals(e){let t=[],n=[];for(let i of this.els){let r=i.getBoundingClientRect();t.push(r.left-e),n.push(r.right-e)}this.lefts=t,this.rights=n}buildElVerticals(e){let t=[],n=[];for(let i of this.els){let r=i.getBoundingClientRect();t.push(r.top-e),n.push(r.bottom-e)}this.tops=t,this.bottoms=n}leftToIndex(e){let{lefts:t,rights:n}=this,i=t.length,r;for(r=0;r<i;r+=1)if(e>=t[r]&&e<n[r])return r}topToIndex(e){let{tops:t,bottoms:n}=this,i=t.length,r;for(r=0;r<i;r+=1)if(e>=t[r]&&e<n[r])return r}getWidth(e){return this.rights[e]-this.lefts[e]}getHeight(e){return this.bottoms[e]-this.tops[e]}similarTo(e){return Kw(this.tops||[],e.tops||[])&&Kw(this.bottoms||[],e.bottoms||[])&&Kw(this.lefts||[],e.lefts||[])&&Kw(this.rights||[],e.rights||[])}};function Kw(s,e){let t=s.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(Math.round(s[n])!==Math.round(e[n]))return!1;return!0}var Uc=class{getMaxScrollTop(){return this.getScrollHeight()-this.getClientHeight()}getMaxScrollLeft(){return this.getScrollWidth()-this.getClientWidth()}canScrollVertically(){return this.getMaxScrollTop()>0}canScrollHorizontally(){return this.getMaxScrollLeft()>0}canScrollUp(){return this.getScrollTop()>0}canScrollDown(){return this.getScrollTop()<this.getMaxScrollTop()}canScrollLeft(){return this.getScrollLeft()>0}canScrollRight(){return this.getScrollLeft()<this.getMaxScrollLeft()}},Wm=class extends Uc{constructor(e){super(),this.el=e}getScrollTop(){return this.el.scrollTop}getScrollLeft(){return this.el.scrollLeft}setScrollTop(e){this.el.scrollTop=e}setScrollLeft(e){this.el.scrollLeft=e}getScrollWidth(){return this.el.scrollWidth}getScrollHeight(){return this.el.scrollHeight}getClientHeight(){return this.el.clientHeight}getClientWidth(){return this.el.clientWidth}},qm=class extends Uc{getScrollTop(){return window.scrollY}getScrollLeft(){return window.scrollX}setScrollTop(e){window.scroll(window.scrollX,e)}setScrollLeft(e){window.scroll(e,window.scrollY)}getScrollWidth(){return document.documentElement.scrollWidth}getScrollHeight(){return document.documentElement.scrollHeight}getClientHeight(){return document.documentElement.clientHeight}getClientWidth(){return document.documentElement.clientWidth}},Pn=class extends Ge{constructor(){super(...arguments),this.uid=bo()}prepareHits(){}queryHit(e,t,n,i){return null}isValidSegDownEl(e){return!this.props.eventDrag&&!this.props.eventResize&&!an(e,".fc-event-mirror")}isValidDateDownEl(e){return!an(e,".fc-event:not(.fc-bg-event)")&&!an(e,".fc-more-link")&&!an(e,"a[data-navlink]")&&!an(e,".fc-popover")}};var Bc=class{constructor(e=t=>t.thickness||1){this.getEntryThickness=e,this.strictOrder=!1,this.allowReslicing=!1,this.maxCoord=-1,this.maxStackCnt=-1,this.levelCoords=[],this.entriesByLevel=[],this.stackCnts={}}addSegs(e){let t=[];for(let n of e)this.insertEntry(n,t);return t}insertEntry(e,t){let n=this.findInsertion(e);this.isInsertionValid(n,e)?this.insertEntryAt(e,n):this.handleInvalidInsertion(n,e,t)}isInsertionValid(e,t){return(this.maxCoord===-1||e.levelCoord+this.getEntryThickness(t)<=this.maxCoord)&&(this.maxStackCnt===-1||e.stackCnt<this.maxStackCnt)}handleInvalidInsertion(e,t,n){if(this.allowReslicing&&e.touchingEntry){let i=Object.assign(Object.assign({},t),{span:uy(t.span,e.touchingEntry.span)});n.push(i),this.splitEntry(t,e.touchingEntry,n)}else n.push(t)}splitEntry(e,t,n){let i=e.span,r=t.span;i.start<r.start&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:i.start,end:r.start}},n),i.end>r.end&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:r.end,end:i.end}},n)}insertEntryAt(e,t){let{entriesByLevel:n,levelCoords:i}=this;t.lateral===-1?(nI(i,t.level,t.levelCoord),nI(n,t.level,[e])):nI(n[t.level],t.lateral,e),this.stackCnts[hr(e)]=t.stackCnt}findInsertion(e){let{levelCoords:t,entriesByLevel:n,strictOrder:i,stackCnts:r}=this,o=t.length,l=0,u=-1,h=-1,d=null,c=0;for(let p=0;p<o;p+=1){let g=t[p];if(!i&&g>=l+this.getEntryThickness(e))break;let m=n[p],y,_=Km(m,e.span.start,Ym),x=_[0]+_[1];for(;(y=m[x])&&y.span.start<e.span.end;){let E=g+this.getEntryThickness(y);E>l&&(l=E,d=y,u=p,h=x),E===l&&(c=Math.max(c,r[hr(y)]+1)),x+=1}}let a=0;if(d)for(a=u+1;a<o&&t[a]<l;)a+=1;let f=-1;return a<o&&t[a]===l&&(f=Km(n[a],e.span.end,Ym)[0]),{touchingLevel:u,touchingLateral:h,touchingEntry:d,stackCnt:c,levelCoord:l,level:a,lateral:f}}toRects(){let{entriesByLevel:e,levelCoords:t}=this,n=e.length,i=[];for(let r=0;r<n;r+=1){let o=e[r],l=t[r];for(let u of o)i.push(Object.assign(Object.assign({},u),{thickness:this.getEntryThickness(u),levelCoord:l}))}return i}};function Ym(s){return s.span.end}function hr(s){return s.index+":"+s.span.start}function nD(s){let e=[];for(let t of s){let n=[],i={span:t.span,entries:[t]};for(let r of e)uy(r.span,i.span)?i={entries:r.entries.concat(i.entries),span:q7(r.span,i.span)}:n.push(r);n.push(i),e=n}return e}function q7(s,e){return{start:Math.min(s.start,e.start),end:Math.max(s.end,e.end)}}function uy(s,e){let t=Math.max(s.start,e.start),n=Math.min(s.end,e.end);return t<n?{start:t,end:n}:null}function nI(s,e,t){s.splice(e,0,t)}function Km(s,e,t){let n=0,i=s.length;if(!i||e<t(s[n]))return[0,0];if(e>t(s[i-1]))return[i,0];for(;n<i;){let r=Math.floor(n+(i-n)/2),o=t(s[r]);if(e<o)i=r;else if(e>o)n=r+1;else return[r,1]}return[n,0]}var Xm=class{constructor(e,t){this.emitter=new mo}destroy(){}setMirrorIsVisible(e){}setMirrorNeedsRevert(e){}setAutoScrollEnabled(e){}},dy={};function bz(s,e){return!s||e>10?dt({weekday:"short"}):e>1?dt({weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}):dt({weekday:"long"})}var vz="fc-col-header-cell";function _z(s){return s.text}var lx=class extends Ge{render(){let{dateEnv:e,options:t,theme:n,viewApi:i}=this.context,{props:r}=this,{date:o,dateProfile:l}=r,u=ly(o,r.todayRange,null,l),h=[vz].concat(Bh(u,n)),d=e.format(o,r.dayHeaderFormat),c=!u.isDisabled&&r.colCnt>1?mr(this.context,o):{},a=e.toDate(o);e.namedTimeZoneImpl&&(a=ur(a,36e5));let f=Object.assign(Object.assign(Object.assign({date:a,view:i},r.extraRenderProps),{text:d}),u);return G(Ut,{elTag:"th",elClasses:h,elAttrs:Object.assign({role:"columnheader",colSpan:r.colSpan,"data-date":u.isDisabled?void 0:Pa(o)},r.extraDataAttrs),renderProps:f,generatorName:"dayHeaderContent",customGenerator:t.dayHeaderContent,defaultGenerator:_z,classNameGenerator:t.dayHeaderClassNames,didMount:t.dayHeaderDidMount,willUnmount:t.dayHeaderWillUnmount},p=>G("div",{className:"fc-scrollgrid-sync-inner"},!u.isDisabled&&G(p,{elTag:"a",elAttrs:c,elClasses:["fc-col-header-cell-cushion",r.isSticky&&"fc-sticky"]})))}},Y7=dt({weekday:"long"}),cx=class extends Ge{render(){let{props:e}=this,{dateEnv:t,theme:n,viewApi:i,options:r}=this.context,o=Dt(new Date(2592e5),e.dow),l={dow:e.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},u=t.format(o,e.dayHeaderFormat),h=Object.assign(Object.assign(Object.assign(Object.assign({date:o},l),{view:i}),e.extraRenderProps),{text:u});return G(Ut,{elTag:"th",elClasses:[vz,...Bh(l,n),...e.extraClassNames||[]],elAttrs:Object.assign({role:"columnheader",colSpan:e.colSpan},e.extraDataAttrs),renderProps:h,generatorName:"dayHeaderContent",customGenerator:r.dayHeaderContent,defaultGenerator:_z,classNameGenerator:r.dayHeaderClassNames,didMount:r.dayHeaderDidMount,willUnmount:r.dayHeaderWillUnmount},d=>G("div",{className:"fc-scrollgrid-sync-inner"},G(d,{elTag:"a",elClasses:["fc-col-header-cell-cushion",e.isSticky&&"fc-sticky"],elAttrs:{"aria-label":t.format(o,Y7)}})))}},Vc=class extends Ge{constructor(){super(...arguments),this.createDayHeaderFormatter=xe(K7)}render(){let{context:e}=this,{dates:t,dateProfile:n,datesRepDistinctDays:i,renderIntro:r}=this.props,o=this.createDayHeaderFormatter(e.options.dayHeaderFormat,i,t.length);return G(bs,{unit:"day"},(l,u)=>G("tr",{role:"row"},r&&r("day"),t.map(h=>i?G(lx,{key:h.toISOString(),date:h,dateProfile:n,todayRange:u,colCnt:t.length,dayHeaderFormat:o}):G(cx,{key:h.getUTCDay(),dow:h.getUTCDay(),dayHeaderFormat:o}))))}};function K7(s,e,t){return s||bz(e,t)}var zc=class{constructor(e,t){let n=e.start,{end:i}=e,r=[],o=[],l=-1;for(;n<i;)t.isHiddenDay(n)?r.push(l+.5):(l+=1,r.push(l),o.push(n)),n=Dt(n,1);this.dates=o,this.indices=r,this.cnt=o.length}sliceRange(e){let t=this.getDateDayIndex(e.start),n=this.getDateDayIndex(Dt(e.end,-1)),i=Math.max(0,t),r=Math.min(this.cnt-1,n);return i=Math.ceil(i),r=Math.floor(r),i<=r?{firstIndex:i,lastIndex:r,isStart:t===i,isEnd:n===r}:null}getDateDayIndex(e){let{indices:t}=this,n=Math.floor(pr(this.dates[0],e));return n<0?t[0]-1:n>=t.length?t[t.length-1]+1:t[n]}},Hc=class{constructor(e,t){let{dates:n}=e,i,r,o;if(t){for(r=n[0].getUTCDay(),i=1;i<n.length&&n[i].getUTCDay()!==r;i+=1);o=Math.ceil(n.length/i)}else o=1,i=n.length;this.rowCnt=o,this.colCnt=i,this.daySeries=e,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}buildCells(){let e=[];for(let t=0;t<this.rowCnt;t+=1){let n=[];for(let i=0;i<this.colCnt;i+=1)n.push(this.buildCell(t,i));e.push(n)}return e}buildCell(e,t){let n=this.daySeries.dates[e*this.colCnt+t];return{key:n.toISOString(),date:n}}buildHeaderDates(){let e=[];for(let t=0;t<this.colCnt;t+=1)e.push(this.cells[0][t].date);return e}sliceRange(e){let{colCnt:t}=this,n=this.daySeries.sliceRange(e),i=[];if(n){let{firstIndex:r,lastIndex:o}=n,l=r;for(;l<=o;){let u=Math.floor(l/t),h=Math.min((u+1)*t,o+1);i.push({row:u,firstCol:l%t,lastCol:(h-1)%t,isStart:n.isStart&&l===r,isEnd:n.isEnd&&h-1===o}),l=h}}return i}},Gc=class{constructor(){this.sliceBusinessHours=xe(this._sliceBusinessHours),this.sliceDateSelection=xe(this._sliceDateSpan),this.sliceEventStore=xe(this._sliceEventStore),this.sliceEventDrag=xe(this._sliceInteraction),this.sliceEventResize=xe(this._sliceInteraction),this.forceDayIfListItem=!1}sliceProps(e,t,n,i,...r){let{eventUiBases:o}=e,l=this.sliceEventStore(e.eventStore,o,t,n,...r);return{dateSelectionSegs:this.sliceDateSelection(e.dateSelection,t,n,o,i,...r),businessHourSegs:this.sliceBusinessHours(e.businessHours,t,n,i,...r),fgEventSegs:l.fg,bgEventSegs:l.bg,eventDrag:this.sliceEventDrag(e.eventDrag,o,t,n,...r),eventResize:this.sliceEventResize(e.eventResize,o,t,n,...r),eventSelection:e.eventSelection}}sliceNowDate(e,t,n,i,...r){return this._sliceDateSpan({range:{start:e,end:ur(e,1)},allDay:!1},t,n,{},i,...r)}_sliceBusinessHours(e,t,n,i,...r){return e?this._sliceEventStore($c(e,Xw(t,!!n),i),{},t,n,...r).bg:[]}_sliceEventStore(e,t,n,i,...r){if(e){let o=Ph(e,t,Xw(n,!!i),i);return{bg:this.sliceEventRanges(o.bg,r),fg:this.sliceEventRanges(o.fg,r)}}return{bg:[],fg:[]}}_sliceInteraction(e,t,n,i,...r){if(!e)return null;let o=Ph(e.mutatedEvents,t,Xw(n,!!i),i);return{segs:this.sliceEventRanges(o.fg,r),affectedInstances:e.affectedEvents.instances,isEvent:e.isEvent}}_sliceDateSpan(e,t,n,i,r,...o){if(!e)return[];let l=Xw(t,!!n),u=$s(e.range,l);if(u){e=Object.assign(Object.assign({},e),{range:u});let h=$7(e,i,r),d=this.sliceRange(e.range,...o);for(let c of d)c.eventRange=h;return d}return[]}sliceEventRanges(e,t){let n=[];for(let i of e)n.push(...this.sliceEventRange(i,t));return n}sliceEventRange(e,t){let n=e.range;this.forceDayIfListItem&&e.ui.display==="list-item"&&(n={start:n.start,end:Dt(n.start,1)});let i=this.sliceRange(n,...t);for(let r of i)r.eventRange=e,r.isStart=e.isStart&&r.isStart,r.isEnd=e.isEnd&&r.isEnd;return i}};function Xw(s,e){let t=s.activeRange;return e?t:{start:ur(t.start,s.slotMinTime.milliseconds),end:ur(t.end,s.slotMaxTime.milliseconds-864e5)}}function Tx(s,e,t){let{instances:n}=s.mutatedEvents;for(let i in n)if(!Fh(e.validRange,n[i].range))return!1;return wz({eventDrag:s},t)}function sD(s,e,t){return Fh(e.validRange,s.range)?wz({dateSelection:s},t):!1}function wz(s,e){let t=e.getCurrentData(),n=Object.assign({businessHours:t.businessHours,dateSelection:"",eventStore:t.eventStore,eventUiBases:t.eventUiBases,eventSelection:"",eventDrag:null,eventResize:null},s);return(e.pluginHooks.isPropsValid||xz)(n,e)}function xz(s,e,t={},n){return!(s.eventDrag&&!X7(s,e,t,n)||s.dateSelection&&!J7(s,e,t,n))}function X7(s,e,t,n){let i=e.getCurrentData(),r=s.eventDrag,o=r.mutatedEvents,l=o.defs,u=o.instances,h=ox(l,r.isEvent?s.eventUiBases:{"":i.selectionConfig});n&&(h=ni(h,n));let d=v7(s.eventStore,r.affectedEvents.instances),c=d.defs,a=d.instances,f=ox(c,s.eventUiBases);for(let p in u){let g=u[p],m=g.range,y=h[g.defId],_=l[g.defId];if(!Ez(y.constraints,m,d,s.businessHours,e))return!1;let{eventOverlap:x}=e.options,E=typeof x=="function"?x:null;for(let T in a){let C=a[T];if(yx(m,C.range)&&(f[C.defId].overlap===!1&&r.isEvent||y.overlap===!1||E&&!E(new _t(e,c[C.defId],C),new _t(e,_,g))))return!1}let S=i.eventStore;for(let T of y.allows){let C=Object.assign(Object.assign({},t),{range:g.range,allDay:_.allDay}),I=S.defs[_.defId],A=S.instances[p],P;if(I?P=new _t(e,I,A):P=new _t(e,_),!T(GI(C,e),P))return!1}}return!0}function J7(s,e,t,n){let i=s.eventStore,r=i.defs,o=i.instances,l=s.dateSelection,u=l.range,{selectionConfig:h}=e.getCurrentData();if(n&&(h=n(h)),!Ez(h.constraints,u,i,s.businessHours,e))return!1;let{selectOverlap:d}=e.options,c=typeof d=="function"?d:null;for(let a in o){let f=o[a];if(yx(u,f.range)&&(h.overlap===!1||c&&!c(new _t(e,r[f.defId],f),null)))return!1}for(let a of h.allows){let f=Object.assign(Object.assign({},t),l);if(!a(GI(f,e),null))return!1}return!0}function Ez(s,e,t,n,i){for(let r of s)if(!Q7(Z7(r,e,t,n,i),e))return!1;return!0}function Z7(s,e,t,n,i){return s==="businessHours"?sI($c(n,e,i)):typeof s=="string"?sI(wx(t,r=>r.groupId===s)):typeof s=="object"&&s?sI($c(s,e,i)):[]}function sI(s){let{instances:e}=s,t=[];for(let n in e)t.push(e[n].range);return t}function Q7(s,e){for(let t of s)if(Fh(t,e))return!0;return!1}var Jw=/^(visible|hidden)$/,Mh=class extends Ge{constructor(){super(...arguments),this.handleEl=e=>{this.el=e,Us(this.props.elRef,e)}}render(){let{props:e}=this,{liquid:t,liquidIsAbsolute:n}=e,i=t&&n,r=["fc-scroller"];return t&&(n?r.push("fc-scroller-liquid-absolute"):r.push("fc-scroller-liquid")),G("div",{ref:this.handleEl,className:r.join(" "),style:{overflowX:e.overflowX,overflowY:e.overflowY,left:i&&-(e.overcomeLeft||0)||"",right:i&&-(e.overcomeRight||0)||"",bottom:i&&-(e.overcomeBottom||0)||"",marginLeft:!i&&-(e.overcomeLeft||0)||"",marginRight:!i&&-(e.overcomeRight||0)||"",marginBottom:!i&&-(e.overcomeBottom||0)||"",maxHeight:e.maxHeight||""}},e.children)}needsXScrolling(){if(Jw.test(this.props.overflowX))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),{children:n}=e;for(let i=0;i<n.length;i+=1)if(n[i].getBoundingClientRect().width>t)return!0;return!1}needsYScrolling(){if(Jw.test(this.props.overflowY))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),{children:n}=e;for(let i=0;i<n.length;i+=1)if(n[i].getBoundingClientRect().height>t)return!0;return!1}getXScrollbarWidth(){return Jw.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight}getYScrollbarWidth(){return Jw.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth}},vs=class{constructor(e){this.masterCallback=e,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=(t,n)=>{let{depths:i,currentMap:r}=this,o=!1,l=!1;t!==null?(o=n in r,r[n]=t,i[n]=(i[n]||0)+1,l=!0):(i[n]-=1,i[n]||(delete r[n],delete this.callbackMap[n],o=!0)),this.masterCallback&&(o&&this.masterCallback(null,String(n)),l&&this.masterCallback(t,String(n)))}}createRef(e){let t=this.callbackMap[e];return t||(t=this.callbackMap[e]=n=>{this.handleValue(n,String(e))}),t}collect(e,t,n){return ZV(this.currentMap,e,t,n)}getAll(){return mx(this.currentMap)}};function Sz(s){let e=VV(s,".fc-scrollgrid-shrink"),t=0;for(let n of e)t=Math.max(t,mK(n));return Math.ceil(t)}function iD(s,e){return s.liquid&&e.liquid}function Tz(s,e){return e.maxHeight!=null||iD(s,e)}function Az(s,e,t,n){let{expandRows:i}=t;return typeof e.content=="function"?e.content(t):G("table",{role:"presentation",className:[e.tableClassName,s.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:t.tableMinWidth,width:t.clientWidth,height:i?t.clientHeight:""}},t.tableColGroupNode,G(n?"thead":"tbody",{role:"presentation"},typeof e.rowContent=="function"?e.rowContent(t):e.rowContent))}function Cz(s,e){return fr(s,e,ys)}function Iz(s,e){let t=[];for(let n of s){let i=n.span||1;for(let r=0;r<i;r+=1)t.push(G("col",{style:{width:n.width==="shrink"?Dz(e):n.width||"",minWidth:n.minWidth||""}}))}return G("colgroup",{},...t)}function Dz(s){return s??4}function kz(s){for(let e of s)if(e.width==="shrink")return!0;return!1}function Rz(s,e){let t=["fc-scrollgrid",e.theme.getClass("table")];return s&&t.push("fc-scrollgrid-liquid"),t}function Pz(s,e){let t=["fc-scrollgrid-section",`fc-scrollgrid-section-${s.type}`,s.className];return e&&s.liquid&&s.maxHeight==null&&t.push("fc-scrollgrid-section-liquid"),s.isSticky&&t.push("fc-scrollgrid-section-sticky"),t}function Vh(s){return G("div",{className:"fc-scrollgrid-sticky-shim",style:{width:s.clientWidth,minWidth:s.tableMinWidth}})}function Kc(s){let{stickyHeaderDates:e}=s;return(e==null||e==="auto")&&(e=s.height==="auto"||s.viewHeight==="auto"),e}function hy(s){let{stickyFooterScrollbar:e}=s;return(e==null||e==="auto")&&(e=s.height==="auto"||s.viewHeight==="auto"),e}var Ia=class extends Ge{constructor(){super(...arguments),this.processCols=xe(e=>e,Cz),this.renderMicroColGroup=xe(Iz),this.scrollerRefs=new vs,this.scrollerElRefs=new vs(this._handleScrollerEl.bind(this)),this.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},this.handleSizing=()=>{this.safeSetState(Object.assign({shrinkWidth:this.computeShrinkWidth()},this.computeScrollerDims()))}}render(){let{props:e,state:t,context:n}=this,i=e.sections||[],r=this.processCols(e.cols),o=this.renderMicroColGroup(r,t.shrinkWidth),l=Rz(e.liquid,n);e.collapsibleWidth&&l.push("fc-scrollgrid-collapsible");let u=i.length,h=0,d,c=[],a=[],f=[];for(;h<u&&(d=i[h]).type==="header";)c.push(this.renderSection(d,o,!0)),h+=1;for(;h<u&&(d=i[h]).type==="body";)a.push(this.renderSection(d,o,!1)),h+=1;for(;h<u&&(d=i[h]).type==="footer";)f.push(this.renderSection(d,o,!0)),h+=1;let p=!XI(),g={role:"rowgroup"};return G("table",{role:"grid",className:l.join(" "),style:{height:e.height}},!!(!p&&c.length)&&G("thead",g,...c),!!(!p&&a.length)&&G("tbody",g,...a),!!(!p&&f.length)&&G("tfoot",g,...f),p&&G("tbody",g,...c,...a,...f))}renderSection(e,t,n){return"outerContent"in e?G(st,{key:e.key},e.outerContent):G("tr",{key:e.key,role:"presentation",className:Pz(e,this.props.liquid).join(" ")},this.renderChunkTd(e,t,e.chunk,n))}renderChunkTd(e,t,n,i){if("outerContent"in n)return n.outerContent;let{props:r}=this,{forceYScrollbars:o,scrollerClientWidths:l,scrollerClientHeights:u}=this.state,h=Tz(r,e),d=iD(r,e),c=r.liquid?o?"scroll":h?"auto":"hidden":"visible",a=e.key,f=Az(e,n,{tableColGroupNode:t,tableMinWidth:"",clientWidth:!r.collapsibleWidth&&l[a]!==void 0?l[a]:null,clientHeight:u[a]!==void 0?u[a]:null,expandRows:e.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:()=>{}},i);return G(i?"th":"td",{ref:n.elRef,role:"presentation"},G("div",{className:`fc-scroller-harness${d?" fc-scroller-harness-liquid":""}`},G(Mh,{ref:this.scrollerRefs.createRef(a),elRef:this.scrollerElRefs.createRef(a),overflowY:c,overflowX:r.liquid?"hidden":"visible",maxHeight:e.maxHeight,liquid:d,liquidIsAbsolute:!0},f)))}_handleScrollerEl(e,t){let n=eX(this.props.sections,t);n&&Us(n.chunk.scrollerElRef,e)}componentDidMount(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)}componentDidUpdate(){this.handleSizing()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}computeShrinkWidth(){return kz(this.props.cols)?Sz(this.scrollerElRefs.getAll()):0}computeScrollerDims(){let e=gz(),{scrollerRefs:t,scrollerElRefs:n}=this,i=!1,r={},o={};for(let l in t.currentMap){let u=t.currentMap[l];if(u&&u.needsYScrolling()){i=!0;break}}for(let l of this.props.sections){let u=l.key,h=n.currentMap[u];if(h){let d=h.parentNode;r[u]=Math.floor(d.getBoundingClientRect().width-(i?e.y:0)),o[u]=Math.floor(d.getBoundingClientRect().height)}}return{forceYScrollbars:i,scrollerClientWidths:r,scrollerClientHeights:o}}};Ia.addStateEquality({scrollerClientWidths:ys,scrollerClientHeights:ys});function eX(s,e){for(let t of s)if(t.key===e)return t;return null}var yo=class extends Ge{constructor(){super(...arguments),this.buildPublicEvent=xe((e,t,n)=>new _t(e,t,n)),this.handleEl=e=>{this.el=e,Us(this.props.elRef,e),e&&OV(e,this.props.seg)}}render(){let{props:e,context:t}=this,{options:n}=t,{seg:i}=e,{eventRange:r}=i,{ui:o}=r,l={event:this.buildPublicEvent(t,r.def,r.instance),view:t.viewApi,timeText:e.timeText,textColor:o.textColor,backgroundColor:o.backgroundColor,borderColor:o.borderColor,isDraggable:!e.disableDragging&&D7(i,t),isStartResizable:!e.disableResizing&&k7(i,t),isEndResizable:!e.disableResizing&&R7(i),isMirror:!!(e.isDragging||e.isResizing||e.isDateSelecting),isStart:!!i.isStart,isEnd:!!i.isEnd,isPast:!!e.isPast,isFuture:!!e.isFuture,isToday:!!e.isToday,isSelected:!!e.isSelected,isDragging:!!e.isDragging,isResizing:!!e.isResizing};return G(Ut,{elRef:this.handleEl,elTag:e.elTag,elAttrs:e.elAttrs,elClasses:[...P7(l),...i.eventRange.ui.classNames,...e.elClasses||[]],elStyle:e.elStyle,renderProps:l,generatorName:"eventContent",customGenerator:n.eventContent,defaultGenerator:e.defaultGenerator,classNameGenerator:n.eventClassNames,didMount:n.eventDidMount,willUnmount:n.eventWillUnmount},e.children)}componentDidUpdate(e){this.el&&this.props.seg!==e.seg&&OV(this.el,this.props.seg)}},Da=class extends Ge{render(){let{props:e,context:t}=this,{options:n}=t,{seg:i}=e,{ui:r}=i.eventRange,o=n.eventTimeFormat||e.defaultTimeFormat,l=Oa(i,o,t,e.defaultDisplayEventTime,e.defaultDisplayEventEnd);return G(yo,Object.assign({},e,{elTag:"a",elStyle:{borderColor:r.borderColor,backgroundColor:r.backgroundColor},elAttrs:$h(i,t),defaultGenerator:tX,timeText:l}),(u,h)=>G(st,null,G(u,{elTag:"div",elClasses:["fc-event-main"],elStyle:{color:h.textColor}}),!!h.isStartResizable&&G("div",{className:"fc-event-resizer fc-event-resizer-start"}),!!h.isEndResizable&&G("div",{className:"fc-event-resizer fc-event-resizer-end"})))}};Da.addPropsEquality({seg:ys});function tX(s){return G("div",{className:"fc-event-main-frame"},s.timeText&&G("div",{className:"fc-event-time"},s.timeText),G("div",{className:"fc-event-title-container"},G("div",{className:"fc-event-title fc-sticky"},s.event.title||G(st,null,"\xA0"))))}var fy=s=>G(ii.Consumer,null,e=>{let{options:t}=e,n={isAxis:s.isAxis,date:e.dateEnv.toDate(s.date),view:e.viewApi};return G(Ut,{elRef:s.elRef,elTag:s.elTag||"div",elAttrs:s.elAttrs,elClasses:s.elClasses,elStyle:s.elStyle,renderProps:n,generatorName:"nowIndicatorContent",customGenerator:t.nowIndicatorContent,classNameGenerator:t.nowIndicatorClassNames,didMount:t.nowIndicatorDidMount,willUnmount:t.nowIndicatorWillUnmount},s.children)}),nX=dt({day:"numeric"}),ka=class extends Ge{constructor(){super(...arguments),this.refineRenderProps=Oh(sX)}render(){let{props:e,context:t}=this,{options:n}=t,i=this.refineRenderProps({date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,isMonthStart:e.isMonthStart||!1,showDayNumber:e.showDayNumber,extraRenderProps:e.extraRenderProps,viewApi:t.viewApi,dateEnv:t.dateEnv,monthStartFormat:n.monthStartFormat});return G(Ut,{elRef:e.elRef,elTag:e.elTag,elAttrs:Object.assign(Object.assign({},e.elAttrs),i.isDisabled?{}:{"data-date":Pa(e.date)}),elClasses:[...Bh(i,t.theme),...e.elClasses||[]],elStyle:e.elStyle,renderProps:i,generatorName:"dayCellContent",customGenerator:n.dayCellContent,defaultGenerator:e.defaultGenerator,classNameGenerator:i.isDisabled?void 0:n.dayCellClassNames,didMount:n.dayCellDidMount,willUnmount:n.dayCellWillUnmount},e.children)}};function zh(s){return!!(s.dayCellContent||dI("dayCellContent",s))}function sX(s){let{date:e,dateEnv:t,dateProfile:n,isMonthStart:i}=s,r=ly(e,s.todayRange,null,n),o=s.showDayNumber?t.format(e,i?s.monthStartFormat:nX):"";return Object.assign(Object.assign(Object.assign({date:t.toDate(e),view:s.viewApi},r),{isMonthStart:i,dayNumberText:o}),s.extraRenderProps)}var jc=class extends Ge{render(){let{props:e}=this,{seg:t}=e;return G(yo,{elTag:"div",elClasses:["fc-bg-event"],elStyle:{backgroundColor:t.eventRange.ui.backgroundColor},defaultGenerator:iX,seg:t,timeText:"",isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:e.isPast,isFuture:e.isFuture,isToday:e.isToday,disableDragging:!0,disableResizing:!0})}};function iX(s){let{title:e}=s.event;return e&&G("div",{className:"fc-event-title"},s.event.title)}function py(s){return G("div",{className:`fc-${s}`})}var gy=s=>G(ii.Consumer,null,e=>{let{dateEnv:t,options:n}=e,{date:i}=s,r=n.weekNumberFormat||s.defaultFormat,o=t.computeWeekNumber(i),l=t.format(i,r),u={num:o,text:l,date:i};return G(Ut,{elRef:s.elRef,elTag:s.elTag,elAttrs:s.elAttrs,elClasses:s.elClasses,elStyle:s.elStyle,renderProps:u,generatorName:"weekNumberContent",customGenerator:n.weekNumberContent,defaultGenerator:rX,classNameGenerator:n.weekNumberClassNames,didMount:n.weekNumberDidMount,willUnmount:n.weekNumberWillUnmount},s.children)});function rX(s){return s.text}var iI=10,fI=class extends Ge{constructor(){super(...arguments),this.state={titleId:si()},this.handleRootEl=e=>{this.rootEl=e,this.props.elRef&&Us(this.props.elRef,e)},this.handleDocumentMouseDown=e=>{let t=ux(e);this.rootEl.contains(t)||this.handleCloseClick()},this.handleDocumentKeyDown=e=>{e.key==="Escape"&&this.handleCloseClick()},this.handleCloseClick=()=>{let{onClose:e}=this.props;e&&e()}}render(){let{theme:e,options:t}=this.context,{props:n,state:i}=this,r=["fc-popover",e.getClass("popover")].concat(n.extraClassNames||[]);return EV(G("div",Object.assign({},n.extraAttrs,{id:n.id,className:r.join(" "),"aria-labelledby":i.titleId,ref:this.handleRootEl}),G("div",{className:"fc-popover-header "+e.getClass("popoverHeader")},G("span",{className:"fc-popover-title",id:i.titleId},n.title),G("span",{className:"fc-popover-close "+e.getIconClass("close"),title:t.closeHint,onClick:this.handleCloseClick})),G("div",{className:"fc-popover-body "+e.getClass("popoverContent")},n.children)),n.parentEl)}componentDidMount(){document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("keydown",this.handleDocumentKeyDown),this.updateSize()}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("keydown",this.handleDocumentKeyDown)}updateSize(){let{isRtl:e}=this.context,{alignmentEl:t,alignGridTop:n}=this.props,{rootEl:i}=this,r=W7(t);if(r){let o=i.getBoundingClientRect(),l=n?an(t,".fc-scrollgrid").getBoundingClientRect().top:r.top,u=e?r.right-o.width:r.left;l=Math.max(l,iI),u=Math.min(u,document.documentElement.clientWidth-iI-o.width),u=Math.max(u,iI);let h=i.offsetParent.getBoundingClientRect();qc(i,{top:l-h.top,left:u-h.left})}}},pI=class extends Pn{constructor(){super(...arguments),this.handleRootEl=e=>{this.rootEl=e,e?this.context.registerInteractiveComponent(this,{el:e,useEventCenter:!1}):this.context.unregisterInteractiveComponent(this)}}render(){let{options:e,dateEnv:t}=this.context,{props:n}=this,{startDate:i,todayRange:r,dateProfile:o}=n,l=t.format(i,e.dayPopoverFormat);return G(ka,{elRef:this.handleRootEl,date:i,dateProfile:o,todayRange:r},(u,h,d)=>G(fI,{elRef:d.ref,id:n.id,title:l,extraClassNames:["fc-more-popover"].concat(d.className||[]),extraAttrs:d,parentEl:n.parentEl,alignmentEl:n.alignmentEl,alignGridTop:n.alignGridTop,onClose:n.onClose},zh(e)&&G(u,{elTag:"div",elClasses:["fc-more-popover-misc"]}),n.children))}queryHit(e,t,n,i){let{rootEl:r,props:o}=this;return e>=0&&e<n&&t>=0&&t<i?{dateProfile:o.dateProfile,dateSpan:Object.assign({allDay:!o.forceTimed,range:{start:o.startDate,end:o.endDate}},o.extraDateSpan),dayEl:r,rect:{left:0,top:0,right:n,bottom:i},layer:1}:null}},Wc=class extends Ge{constructor(){super(...arguments),this.state={isPopoverOpen:!1,popoverId:si()},this.handleLinkEl=e=>{this.linkEl=e,this.props.elRef&&Us(this.props.elRef,e)},this.handleClick=e=>{let{props:t,context:n}=this,{moreLinkClick:i}=n.options,r=FV(t).start;function o(l){let{def:u,instance:h,range:d}=l.eventRange;return{event:new _t(n,u,h),start:n.dateEnv.toDate(d.start),end:n.dateEnv.toDate(d.end),isStart:l.isStart,isEnd:l.isEnd}}typeof i=="function"&&(i=i({date:r,allDay:!!t.allDayDate,allSegs:t.allSegs.map(o),hiddenSegs:t.hiddenSegs.map(o),jsEvent:e,view:n.viewApi})),!i||i==="popover"?this.setState({isPopoverOpen:!0}):typeof i=="string"&&n.calendarApi.zoomTo(r,i)},this.handlePopoverClose=()=>{this.setState({isPopoverOpen:!1})}}render(){let{props:e,state:t}=this;return G(ii.Consumer,null,n=>{let{viewApi:i,options:r,calendarApi:o}=n,{moreLinkText:l}=r,{moreCnt:u}=e,h=FV(e),d=typeof l=="function"?l.call(o,u):`+${u} ${l}`,c=Nh(r.moreLinkHint,[u],d),a={num:u,shortText:`+${u}`,text:d,view:i};return G(st,null,!!e.moreCnt&&G(Ut,{elTag:e.elTag||"a",elRef:this.handleLinkEl,elClasses:[...e.elClasses||[],"fc-more-link"],elStyle:e.elStyle,elAttrs:Object.assign(Object.assign(Object.assign({},e.elAttrs),HV(this.handleClick)),{title:c,"aria-expanded":t.isPopoverOpen,"aria-controls":t.isPopoverOpen?t.popoverId:""}),renderProps:a,generatorName:"moreLinkContent",customGenerator:r.moreLinkContent,defaultGenerator:e.defaultGenerator||oX,classNameGenerator:r.moreLinkClassNames,didMount:r.moreLinkDidMount,willUnmount:r.moreLinkWillUnmount},e.children),t.isPopoverOpen&&G(pI,{id:t.popoverId,startDate:h.start,endDate:h.end,dateProfile:e.dateProfile,todayRange:e.todayRange,extraDateSpan:e.extraDateSpan,parentEl:this.parentEl,alignmentEl:e.alignmentElRef?e.alignmentElRef.current:this.linkEl,alignGridTop:e.alignGridTop,forceTimed:e.forceTimed,onClose:this.handlePopoverClose},e.popoverContent()))})}componentDidMount(){this.updateParentEl()}componentDidUpdate(){this.updateParentEl()}updateParentEl(){this.linkEl&&(this.parentEl=an(this.linkEl,".fc-view-harness"))}};function oX(s){return s.text}function FV(s){if(s.allDayDate)return{start:s.allDayDate,end:Dt(s.allDayDate,1)};let{hiddenSegs:e}=s;return{start:Ax(e),end:lX(e)}}function Ax(s){return s.reduce(aX).eventRange.range.start}function aX(s,e){return s.eventRange.range.start<e.eventRange.range.start?s:e}function lX(s){return s.reduce(cX).eventRange.range.end}function cX(s,e){return s.eventRange.range.end>e.eventRange.range.end?s:e}var uX=[],Uz={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},Bz=Object.assign(Object.assign({},Uz),{buttonHints:{prev:"Previous $0",next:"Next $0",today(s,e){return e==="day"?"Today":`This ${s}`}},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint(s){return`Show ${s} more event${s===1?"":"s"}`}});function dX(s){let e=s.length>0?s[0].code:"en",t=uX.concat(s),n={en:Bz};for(let i of t)n[i.code]=i;return{map:n,defaultCode:e}}function Vz(s,e){return typeof s=="object"&&!Array.isArray(s)?zz(s.code,[s.code],s):hX(s,e)}function hX(s,e){let t=[].concat(s||[]),n=fX(t,e)||Bz;return zz(s,t,n)}function fX(s,e){for(let t=0;t<s.length;t+=1){let n=s[t].toLocaleLowerCase().split("-");for(let i=n.length;i>0;i-=1){let r=n.slice(0,i).join("-");if(e[r])return e[r]}}return null}function zz(s,e,t){let n=gx([Uz,t],["buttonText"]);delete n.code;let{week:i}=n;return delete n.week,{codeArg:s,codes:e,week:i,simpleNumberFormat:new Intl.NumberFormat(s),options:n}}function _s(s){return{id:bo(),name:s.name,premiumReleaseDate:s.premiumReleaseDate?new Date(s.premiumReleaseDate):void 0,deps:s.deps||[],reducers:s.reducers||[],isLoadingFuncs:s.isLoadingFuncs||[],contextInit:[].concat(s.contextInit||[]),eventRefiners:s.eventRefiners||{},eventDefMemberAdders:s.eventDefMemberAdders||[],eventSourceRefiners:s.eventSourceRefiners||{},isDraggableTransformers:s.isDraggableTransformers||[],eventDragMutationMassagers:s.eventDragMutationMassagers||[],eventDefMutationAppliers:s.eventDefMutationAppliers||[],dateSelectionTransformers:s.dateSelectionTransformers||[],datePointTransforms:s.datePointTransforms||[],dateSpanTransforms:s.dateSpanTransforms||[],views:s.views||{},viewPropsTransformers:s.viewPropsTransformers||[],isPropsValid:s.isPropsValid||null,externalDefTransforms:s.externalDefTransforms||[],viewContainerAppends:s.viewContainerAppends||[],eventDropTransformers:s.eventDropTransformers||[],componentInteractions:s.componentInteractions||[],calendarInteractions:s.calendarInteractions||[],themeClasses:s.themeClasses||{},eventSourceDefs:s.eventSourceDefs||[],cmdFormatter:s.cmdFormatter,recurringTypes:s.recurringTypes||[],namedTimeZonedImpl:s.namedTimeZonedImpl,initialView:s.initialView||"",elementDraggingImpl:s.elementDraggingImpl,optionChangeHandlers:s.optionChangeHandlers||{},scrollGridImpl:s.scrollGridImpl||null,listenerRefiners:s.listenerRefiners||{},optionRefiners:s.optionRefiners||{},propSetHandlers:s.propSetHandlers||{}}}function pX(s,e){let t={},n={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function i(r){for(let o of r){let l=o.name,u=t[l];u===void 0?(t[l]=o.id,i(o.deps),n=mX(n,o)):u!==o.id&&console.warn(`Duplicate plugin '${l}'`)}}return s&&i(s),i(e),n}function gX(){let s=[],e=[],t;return(n,i)=>((!t||!fr(n,s)||!fr(i,e))&&(t=pX(n,i)),s=n,e=i,t)}function mX(s,e){return{premiumReleaseDate:yX(s.premiumReleaseDate,e.premiumReleaseDate),reducers:s.reducers.concat(e.reducers),isLoadingFuncs:s.isLoadingFuncs.concat(e.isLoadingFuncs),contextInit:s.contextInit.concat(e.contextInit),eventRefiners:Object.assign(Object.assign({},s.eventRefiners),e.eventRefiners),eventDefMemberAdders:s.eventDefMemberAdders.concat(e.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},s.eventSourceRefiners),e.eventSourceRefiners),isDraggableTransformers:s.isDraggableTransformers.concat(e.isDraggableTransformers),eventDragMutationMassagers:s.eventDragMutationMassagers.concat(e.eventDragMutationMassagers),eventDefMutationAppliers:s.eventDefMutationAppliers.concat(e.eventDefMutationAppliers),dateSelectionTransformers:s.dateSelectionTransformers.concat(e.dateSelectionTransformers),datePointTransforms:s.datePointTransforms.concat(e.datePointTransforms),dateSpanTransforms:s.dateSpanTransforms.concat(e.dateSpanTransforms),views:Object.assign(Object.assign({},s.views),e.views),viewPropsTransformers:s.viewPropsTransformers.concat(e.viewPropsTransformers),isPropsValid:e.isPropsValid||s.isPropsValid,externalDefTransforms:s.externalDefTransforms.concat(e.externalDefTransforms),viewContainerAppends:s.viewContainerAppends.concat(e.viewContainerAppends),eventDropTransformers:s.eventDropTransformers.concat(e.eventDropTransformers),calendarInteractions:s.calendarInteractions.concat(e.calendarInteractions),componentInteractions:s.componentInteractions.concat(e.componentInteractions),themeClasses:Object.assign(Object.assign({},s.themeClasses),e.themeClasses),eventSourceDefs:s.eventSourceDefs.concat(e.eventSourceDefs),cmdFormatter:e.cmdFormatter||s.cmdFormatter,recurringTypes:s.recurringTypes.concat(e.recurringTypes),namedTimeZonedImpl:e.namedTimeZonedImpl||s.namedTimeZonedImpl,initialView:s.initialView||e.initialView,elementDraggingImpl:s.elementDraggingImpl||e.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},s.optionChangeHandlers),e.optionChangeHandlers),scrollGridImpl:e.scrollGridImpl||s.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},s.listenerRefiners),e.listenerRefiners),optionRefiners:Object.assign(Object.assign({},s.optionRefiners),e.optionRefiners),propSetHandlers:Object.assign(Object.assign({},s.propSetHandlers),e.propSetHandlers)}}function yX(s,e){return s===void 0?e:e===void 0?s:new Date(Math.max(s.valueOf(),e.valueOf()))}var yr=class extends go{};yr.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"};yr.prototype.baseIconClass="fc-icon";yr.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"};yr.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"};yr.prototype.iconOverrideOption="buttonIcons";yr.prototype.iconOverrideCustomButtonOption="icon";yr.prototype.iconOverridePrefix="fc-icon-";function bX(s,e){let t={},n;for(n in s)oD(n,t,s,e);for(n in e)oD(n,t,s,e);return t}function oD(s,e,t,n){if(e[s])return e[s];let i=vX(s,e,t,n);return i&&(e[s]=i),i}function vX(s,e,t,n){let i=t[s],r=n[s],o=d=>i&&i[d]!==null?i[d]:r&&r[d]!==null?r[d]:null,l=o("component"),u=o("superType"),h=null;if(u){if(u===s)throw new Error("Can't have a custom view type that references itself");h=oD(u,e,t,n)}return!l&&h&&(l=h.component),l?{type:s,component:l,defaults:Object.assign(Object.assign({},h?h.defaults:{}),i?i.rawOptions:{}),overrides:Object.assign(Object.assign({},h?h.overrides:{}),r?r.rawOptions:{})}:null}function Mz(s){return ni(s,_X)}function _X(s){let e=typeof s=="function"?{component:s}:s,{component:t}=e;return e.content?t=Nz(e):t&&!(t.prototype instanceof Ge)&&(t=Nz(Object.assign(Object.assign({},e),{content:t}))),{superType:e.type,component:t,rawOptions:e}}function Nz(s){return e=>G(ii.Consumer,null,t=>G(Ut,{elTag:"div",elClasses:FI(t.viewSpec),renderProps:Object.assign(Object.assign({},e),{nextDayThreshold:t.options.nextDayThreshold}),generatorName:void 0,customGenerator:s.content,classNameGenerator:s.classNames,didMount:s.didMount,willUnmount:s.willUnmount}))}function wX(s,e,t,n){let i=Mz(s),r=Mz(e.views),o=bX(i,r);return ni(o,l=>xX(l,r,e,t,n))}function xX(s,e,t,n,i){let r=s.overrides.duration||s.defaults.duration||n.duration||t.duration,o=null,l="",u="",h={};if(r&&(o=EX(r),o)){let a=Fm(o);l=a.unit,a.value===1&&(u=l,h=e[l]?e[l].rawOptions:{})}let d=a=>{let f=a.buttonText||{},p=s.defaults.buttonTextKey;return p!=null&&f[p]!=null?f[p]:f[s.type]!=null?f[s.type]:f[u]!=null?f[u]:null},c=a=>{let f=a.buttonHints||{},p=s.defaults.buttonTextKey;return p!=null&&f[p]!=null?f[p]:f[s.type]!=null?f[s.type]:f[u]!=null?f[u]:null};return{type:s.type,component:s.component,duration:o,durationUnit:l,singleUnit:u,optionDefaults:s.defaults,optionOverrides:Object.assign(Object.assign({},h),s.overrides),buttonTextOverride:d(n)||d(t)||s.overrides.buttonText,buttonTextDefault:d(i)||s.defaults.buttonText||d(Ma)||s.type,buttonTitleOverride:c(n)||c(t)||s.overrides.buttonHint,buttonTitleDefault:c(i)||s.defaults.buttonHint||c(Ma)}}var Oz={};function EX(s){let e=JSON.stringify(s),t=Oz[e];return t===void 0&&(t=He(s),Oz[e]=t),t}function SX(s,e){switch(e.type){case"CHANGE_VIEW_TYPE":s=e.viewType}return s}function TX(s,e){switch(e.type){case"CHANGE_DATE":return e.dateMarker;default:return s}}function AX(s,e,t){let n=s.initialDate;return n!=null?e.createMarker(n):t.getDateMarker()}function CX(s,e){switch(e.type){case"SET_OPTION":return Object.assign(Object.assign({},s),{[e.optionName]:e.rawOptionValue});default:return s}}function IX(s,e,t,n){let i;switch(e.type){case"CHANGE_VIEW_TYPE":return n.build(e.dateMarker||t);case"CHANGE_DATE":return n.build(e.dateMarker);case"PREV":if(i=n.buildPrev(s,t),i.isValid)return i;break;case"NEXT":if(i=n.buildNext(s,t),i.isValid)return i;break}return s}function DX(s,e,t){let n=e?e.activeRange:null;return Gz({},FX(s,t),n,t)}function kX(s,e,t,n){let i=t?t.activeRange:null;switch(e.type){case"ADD_EVENT_SOURCES":return Gz(s,e.sources,i,n);case"REMOVE_EVENT_SOURCE":return PX(s,e.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return t?jz(s,i,n):s;case"FETCH_EVENT_SOURCES":return gD(s,e.sourceIds?MI(e.sourceIds):Wz(s,n),i,e.isRefetch||!1,n);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return OX(s,e.sourceId,e.fetchId,e.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return s}}function RX(s,e,t){let n=e?e.activeRange:null;return gD(s,Wz(s,t),n,!0,t)}function Hz(s){for(let e in s)if(s[e].isFetching)return!0;return!1}function Gz(s,e,t,n){let i={};for(let r of e)i[r.sourceId]=r;return t&&(i=jz(i,t,n)),Object.assign(Object.assign({},s),i)}function PX(s,e){return po(s,t=>t.sourceId!==e)}function jz(s,e,t){return gD(s,po(s,n=>MX(n,e,t)),e,!1,t)}function MX(s,e,t){return qz(s,t)?!t.options.lazyFetching||!s.fetchRange||s.isFetching||e.start<s.fetchRange.start||e.end>s.fetchRange.end:!s.latestFetchId}function gD(s,e,t,n,i){let r={};for(let o in s){let l=s[o];e[o]?r[o]=NX(l,t,n,i):r[o]=l}return r}function NX(s,e,t,n){let{options:i,calendarApi:r}=n,o=n.pluginHooks.eventSourceDefs[s.sourceDefId],l=bo();return o.fetch({eventSource:s,range:e,isRefetch:t,context:n},u=>{let{rawEvents:h}=u;i.eventSourceSuccess&&(h=i.eventSourceSuccess.call(r,h,u.response)||h),s.success&&(h=s.success.call(r,h,u.response)||h),n.dispatch({type:"RECEIVE_EVENTS",sourceId:s.sourceId,fetchId:l,fetchRange:e,rawEvents:h})},u=>{let h=!1;i.eventSourceFailure&&(i.eventSourceFailure.call(r,u),h=!0),s.failure&&(s.failure(u),h=!0),h||console.warn(u.message,u),n.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:s.sourceId,fetchId:l,fetchRange:e,error:u})}),Object.assign(Object.assign({},s),{isFetching:!0,latestFetchId:l})}function OX(s,e,t,n){let i=s[e];return i&&t===i.latestFetchId?Object.assign(Object.assign({},s),{[e]:Object.assign(Object.assign({},i),{isFetching:!1,fetchRange:n})}):s}function Wz(s,e){return po(s,t=>qz(t,e))}function FX(s,e){let t=VI(e),n=[].concat(s.eventSources||[]),i=[];s.initialEvents&&n.unshift(s.initialEvents),s.events&&n.unshift(s.events);for(let r of n){let o=BI(r,e,t);o&&i.push(o)}return i}function qz(s,e){return!e.pluginHooks.eventSourceDefs[s.sourceDefId].ignoreRange}function LX(s,e){switch(e.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return e.selection;default:return s}}function $X(s,e){switch(e.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return e.eventInstanceId;default:return s}}function UX(s,e){let t;switch(e.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return s}}function BX(s,e){let t;switch(e.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return s}}function VX(s,e,t,n,i){let r=s.headerToolbar?Fz(s.headerToolbar,s,e,t,n,i):null,o=s.footerToolbar?Fz(s.footerToolbar,s,e,t,n,i):null;return{header:r,footer:o}}function Fz(s,e,t,n,i,r){let o={},l=[],u=!1;for(let h in s){let d=s[h],c=zX(d,e,t,n,i,r);o[h]=c.widgets,l.push(...c.viewsWithButtons),u=u||c.hasTitle}return{sectionWidgets:o,viewsWithButtons:l,hasTitle:u}}function zX(s,e,t,n,i,r){let o=e.direction==="rtl",l=e.customButtons||{},u=t.buttonText||{},h=e.buttonText||{},d=t.buttonHints||{},c=e.buttonHints||{},a=s?s.split(" "):[],f=[],p=!1;return{widgets:a.map(m=>m.split(",").map(y=>{if(y==="title")return p=!0,{buttonName:y};let _,x,E,S,T,C;if(_=l[y])E=I=>{_.click&&_.click.call(I.target,I,I.target)},(S=n.getCustomButtonIconClass(_))||(S=n.getIconClass(y,o))||(T=_.text),C=_.hint||_.text;else if(x=i[y]){f.push(y),E=()=>{r.changeView(y)},(T=x.buttonTextOverride)||(S=n.getIconClass(y,o))||(T=x.buttonTextDefault);let I=x.buttonTextOverride||x.buttonTextDefault;C=Nh(x.buttonTitleOverride||x.buttonTitleDefault||e.viewHint,[I,y],I)}else if(r[y])if(E=()=>{r[y]()},(T=u[y])||(S=n.getIconClass(y,o))||(T=h[y]),y==="prevYear"||y==="nextYear"){let I=y==="prevYear"?"prev":"next";C=Nh(d[I]||c[I],[h.year||"year","year"],h[y])}else C=I=>Nh(d[y]||c[y],[h[I]||I,I],h[y]);return{buttonName:y,buttonClick:E,buttonIcon:S,buttonText:T,buttonHint:C}})),viewsWithButtons:f,hasTitle:p}}var aD=class{constructor(e,t,n){this.type=e,this.getCurrentData=t,this.dateEnv=n}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(e){return this.getCurrentData().options[e]}},HX={ignoreRange:!0,parseMeta(s){return Array.isArray(s.events)?s.events:null},fetch(s,e){e({rawEvents:s.eventSource.meta})}},GX=_s({name:"array-event-source",eventSourceDefs:[HX]}),jX={parseMeta(s){return typeof s.events=="function"?s.events:null},fetch(s,e,t){let{dateEnv:n}=s.context,i=s.eventSource.meta;YI(i.bind(null,qI(s.range,n)),r=>e({rawEvents:r}),t)}},WX=_s({name:"func-event-source",eventSourceDefs:[jX]}),qX={method:String,extraParams:Q,startParam:String,endParam:String,timeZoneParam:String},YX={parseMeta(s){return s.url&&(s.format==="json"||!s.format)?{url:s.url,format:"json",method:(s.method||"GET").toUpperCase(),extraParams:s.extraParams,startParam:s.startParam,endParam:s.endParam,timeZoneParam:s.timeZoneParam}:null},fetch(s,e,t){let{meta:n}=s.eventSource,i=XX(n,s.range,s.context);KI(n.method,n.url,i).then(([r,o])=>{e({rawEvents:r,response:o})},t)}},KX=_s({name:"json-event-source",eventSourceRefiners:qX,eventSourceDefs:[YX]});function XX(s,e,t){let{dateEnv:n,options:i}=t,r,o,l,u,h={};return r=s.startParam,r==null&&(r=i.startParam),o=s.endParam,o==null&&(o=i.endParam),l=s.timeZoneParam,l==null&&(l=i.timeZoneParam),typeof s.extraParams=="function"?u=s.extraParams():u=s.extraParams||{},Object.assign(h,u),h[r]=n.formatIso(e.start),h[o]=n.formatIso(e.end),n.timeZone!=="local"&&(h[l]=n.timeZone),h}var JX={daysOfWeek:Q,startTime:He,endTime:He,duration:He,startRecur:Q,endRecur:Q},ZX={parse(s,e){if(s.daysOfWeek||s.startTime||s.endTime||s.startRecur||s.endRecur){let t={daysOfWeek:s.daysOfWeek||null,startTime:s.startTime||null,endTime:s.endTime||null,startRecur:s.startRecur?e.createMarker(s.startRecur):null,endRecur:s.endRecur?e.createMarker(s.endRecur):null,dateEnv:e},n;return s.duration&&(n=s.duration),!n&&s.startTime&&s.endTime&&(n=YV(s.endTime,s.startTime)),{allDayGuess:!s.startTime&&!s.endTime,duration:n,typeData:t}}return null},expand(s,e,t){let n=$s(e,{start:s.startRecur,end:s.endRecur});return n?e9(s.daysOfWeek,s.startTime,s.dateEnv,t,n):[]}},QX=_s({name:"simple-recurring-event",recurringTypes:[ZX],eventRefiners:JX});function e9(s,e,t,n,i){let r=s?MI(s):null,o=ct(i.start),l=i.end,u=[];for(e&&(e.milliseconds<0?l=Dt(l,1):e.milliseconds>=1e3*60*60*24&&(o=Dt(o,-1)));o<l;){let h;(!r||r[o.getUTCDay()])&&(e?h=n.add(o,e):h=o,u.push(n.createMarker(t.toDate(h)))),o=Dt(o,1)}return u}var t9=_s({name:"change-handler",optionChangeHandlers:{events(s,e){Lz([s],e)},eventSources:Lz}});function Lz(s,e){let t=mx(e.getCurrentData().eventSources);if(t.length===1&&s.length===1&&Array.isArray(t[0]._raw)&&Array.isArray(s[0])){e.dispatch({type:"RESET_RAW_EVENTS",sourceId:t[0].sourceId,rawEvents:s[0]});return}let n=[];for(let i of s){let r=!1;for(let o=0;o<t.length;o+=1)if(t[o]._raw===i){t.splice(o,1),r=!0;break}r||n.push(i)}for(let i of t)e.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:i.sourceId});for(let i of n)e.calendarApi.addEventSource(i)}function n9(s,e){e.emitter.trigger("datesSet",Object.assign(Object.assign({},qI(s.activeRange,e.dateEnv)),{view:e.viewApi}))}function s9(s,e){let{emitter:t}=e;t.hasHandlers("eventsSet")&&t.trigger("eventsSet",gr(s,e))}var i9=[GX,WX,KX,QX,t9,_s({name:"misc",isLoadingFuncs:[s=>Hz(s.eventSources)],propSetHandlers:{dateProfile:n9,eventStore:s9}})],lD=class{constructor(e,t){this.runTaskOption=e,this.drainedOption=t,this.queue=[],this.delayedRunner=new Fc(this.drain.bind(this))}request(e,t){this.queue.push(e),this.delayedRunner.request(t)}pause(e){this.delayedRunner.pause(e)}resume(e,t){this.delayedRunner.resume(e,t)}drain(){let{queue:e}=this;for(;e.length;){let t=[],n;for(;n=e.shift();)this.runTask(n),t.push(n);this.drained(t)}}runTask(e){this.runTaskOption&&this.runTaskOption(e)}drained(e){this.drainedOption&&this.drainedOption(e)}};function r9(s,e,t){let n;return/^(year|month)$/.test(s.currentRangeUnit)?n=s.currentRange:n=s.activeRange,t.formatRange(n.start,n.end,dt(e.titleFormat||o9(s)),{isEndExclusive:s.isRangeAllDay,defaultSeparator:e.titleRangeSeparator})}function o9(s){let{currentRangeUnit:e}=s;if(e==="year")return{year:"numeric"};if(e==="month")return{year:"numeric",month:"long"};let t=Rh(s.currentRange.start,s.currentRange.end);return t!==null&&t>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}var Cx=class{constructor(){this.resetListeners=new Set}handleInput(e,t){let n=this.dateEnv;if(e!==n&&(typeof t=="function"?this.nowFn=t:n||(this.nowAnchorDate=e.toDate(t?e.createMarker(t):e.createNowMarker()),this.nowAnchorQueried=Date.now()),this.dateEnv=e,n))for(let i of this.resetListeners.values())i()}getDateMarker(){return this.nowAnchorDate?this.dateEnv.timestampToMarker(this.nowAnchorDate.valueOf()+(Date.now()-this.nowAnchorQueried)):this.dateEnv.createMarker(this.nowFn())}addResetListener(e){this.resetListeners.add(e)}removeResetListener(e){this.resetListeners.delete(e)}},cD=class{constructor(e){this.computeCurrentViewData=xe(this._computeCurrentViewData),this.organizeRawLocales=xe(dX),this.buildLocale=xe(Vz),this.buildPluginHooks=gX(),this.buildDateEnv=xe(a9),this.buildTheme=xe(l9),this.parseToolbars=xe(VX),this.buildViewSpecs=xe(wX),this.buildDateProfileGenerator=Oh(c9),this.buildViewApi=xe(u9),this.buildViewUiProps=Oh(f9),this.buildEventUiBySource=xe(d9,ys),this.buildEventUiBases=xe(h9),this.parseContextBusinessHours=Oh(p9),this.buildTitle=xe(r9),this.nowManager=new Cx,this.emitter=new mo,this.actionRunner=new lD(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=a=>{this.actionRunner.request(a)},this.props=e,this.actionRunner.pause(),this.nowManager=new Cx;let t={},n=this.computeOptionsData(e.optionOverrides,t,e.calendarApi),i=n.calendarOptions.initialView||n.pluginHooks.initialView,r=this.computeCurrentViewData(i,n,e.optionOverrides,t);e.calendarApi.currentDataManager=this,this.emitter.setThisContext(e.calendarApi),this.emitter.setOptions(r.options);let o={nowManager:this.nowManager,dateEnv:n.dateEnv,options:n.calendarOptions,pluginHooks:n.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},l=AX(n.calendarOptions,n.dateEnv,this.nowManager),u=r.dateProfileGenerator.build(l);ti(u.activeRange,l)||(l=u.currentRange.start);for(let a of n.pluginHooks.contextInit)a(o);let h=DX(n.calendarOptions,u,o),d={dynamicOptionOverrides:t,currentViewType:i,currentDate:l,dateProfile:u,businessHours:this.parseContextBusinessHours(o),eventSources:h,eventUiBases:{},eventStore:Wn(),renderableEventStore:Wn(),dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(o).selectionConfig},c=Object.assign(Object.assign({},o),d);for(let a of n.pluginHooks.reducers)Object.assign(d,a(null,null,c));rD(d,o)&&this.emitter.trigger("loading",!0),this.state=d,this.updateData(),this.actionRunner.resume()}resetOptions(e,t){let{props:n}=this;t===void 0?n.optionOverrides=e:(n.optionOverrides=Object.assign(Object.assign({},n.optionOverrides||{}),e),this.optionsForRefining.push(...t)),(t===void 0||t.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(e){let{props:t,state:n,emitter:i}=this,r=CX(n.dynamicOptionOverrides,e),o=this.computeOptionsData(t.optionOverrides,r,t.calendarApi),l=SX(n.currentViewType,e),u=this.computeCurrentViewData(l,o,t.optionOverrides,r);t.calendarApi.currentDataManager=this,i.setThisContext(t.calendarApi),i.setOptions(u.options);let h={nowManager:this.nowManager,dateEnv:o.dateEnv,options:o.calendarOptions,pluginHooks:o.pluginHooks,calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:i,getCurrentData:this.getCurrentData},{currentDate:d,dateProfile:c}=n;this.data&&this.data.dateProfileGenerator!==u.dateProfileGenerator&&(c=u.dateProfileGenerator.build(d)),d=TX(d,e),c=IX(c,e,d,u.dateProfileGenerator),(e.type==="PREV"||e.type==="NEXT"||!ti(c.currentRange,d))&&(d=c.currentRange.start);let a=kX(n.eventSources,e,c,h),f=az(n.eventStore,e,a,c,h),g=Hz(a)&&!u.options.progressiveEventRendering&&n.renderableEventStore||f,{eventUiSingleBase:m,selectionConfig:y}=this.buildViewUiProps(h),_=this.buildEventUiBySource(a),x=this.buildEventUiBases(g.defs,m,_),E={dynamicOptionOverrides:r,currentViewType:l,currentDate:d,dateProfile:c,eventSources:a,eventStore:f,renderableEventStore:g,selectionConfig:y,eventUiBases:x,businessHours:this.parseContextBusinessHours(h),dateSelection:LX(n.dateSelection,e),eventSelection:$X(n.eventSelection,e),eventDrag:UX(n.eventDrag,e),eventResize:BX(n.eventResize,e)},S=Object.assign(Object.assign({},h),E);for(let I of o.pluginHooks.reducers)Object.assign(E,I(n,e,S));let T=rD(n,h),C=rD(E,h);!T&&C?i.trigger("loading",!0):T&&!C&&i.trigger("loading",!1),this.state=E,t.onAction&&t.onAction(e)}updateData(){let{props:e,state:t}=this,n=this.data,i=this.computeOptionsData(e.optionOverrides,t.dynamicOptionOverrides,e.calendarApi),r=this.computeCurrentViewData(t.currentViewType,i,e.optionOverrides,t.dynamicOptionOverrides),o=this.data=Object.assign(Object.assign(Object.assign({nowManager:this.nowManager,viewTitle:this.buildTitle(t.dateProfile,r.options,i.dateEnv),calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},i),r),t),l=i.pluginHooks.optionChangeHandlers,u=n&&n.calendarOptions,h=i.calendarOptions;if(u&&u!==h){u.timeZone!==h.timeZone&&(t.eventSources=o.eventSources=RX(o.eventSources,t.dateProfile,o),t.eventStore=o.eventStore=zI(o.eventStore,n.dateEnv,o.dateEnv),t.renderableEventStore=o.renderableEventStore=zI(o.renderableEventStore,n.dateEnv,o.dateEnv));for(let d in l)(this.optionsForHandling.indexOf(d)!==-1||u[d]!==h[d])&&l[d](h[d],o)}this.optionsForHandling=[],e.onData&&e.onData(o)}computeOptionsData(e,t,n){if(!this.optionsForRefining.length&&e===this.stableOptionOverrides&&t===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:i,pluginHooks:r,localeDefaults:o,availableLocaleData:l,extra:u}=this.processRawCalendarOptions(e,t);$z(u);let h=this.buildDateEnv(i.timeZone,i.locale,i.weekNumberCalculation,i.firstDay,i.weekText,r,l,i.defaultRangeSeparator),d=this.buildViewSpecs(r.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,o),c=this.buildTheme(i,r),a=this.parseToolbars(i,this.stableOptionOverrides,c,d,n);return this.stableCalendarOptionsData={calendarOptions:i,pluginHooks:r,dateEnv:h,viewSpecs:d,theme:c,toolbarConfig:a,localeDefaults:o,availableRawLocales:l.map}}processRawCalendarOptions(e,t){let{locales:n,locale:i}=fx([Ma,e,t]),r=this.organizeRawLocales(n),o=r.map,l=this.buildLocale(i||r.defaultCode,o).options,u=this.buildPluginHooks(e.plugins||[],i9),h=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},kI),RI),PI),u.listenerRefiners),u.optionRefiners),d={},c=fx([Ma,l,e,t]),a={},f=this.currentCalendarOptionsInput,p=this.currentCalendarOptionsRefined,g=!1;for(let m in c)this.optionsForRefining.indexOf(m)===-1&&(c[m]===f[m]||Na[m]&&m in f&&Na[m](f[m],c[m]))?a[m]=p[m]:h[m]?(a[m]=h[m](c[m]),g=!0):d[m]=f[m];return g&&(this.currentCalendarOptionsInput=c,this.currentCalendarOptionsRefined=a,this.stableOptionOverrides=e,this.stableDynamicOptionOverrides=t),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:u,availableLocaleData:r,localeDefaults:l,extra:d}}_computeCurrentViewData(e,t,n,i){let r=t.viewSpecs[e];if(!r)throw new Error(`viewType "${e}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:o,extra:l}=this.processRawViewOptions(r,t.pluginHooks,t.localeDefaults,n,i);$z(l),this.nowManager.handleInput(t.dateEnv,o.now);let u=this.buildDateProfileGenerator({dateProfileGeneratorClass:r.optionDefaults.dateProfileGeneratorClass,nowManager:this.nowManager,duration:r.duration,durationUnit:r.durationUnit,usesMinMaxTime:r.optionDefaults.usesMinMaxTime,dateEnv:t.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:o.slotMinTime,slotMaxTime:o.slotMaxTime,showNonCurrentDates:o.showNonCurrentDates,dayCount:o.dayCount,dateAlignment:o.dateAlignment,dateIncrement:o.dateIncrement,hiddenDays:o.hiddenDays,weekends:o.weekends,validRangeInput:o.validRange,visibleRangeInput:o.visibleRange,fixedWeekCount:o.fixedWeekCount}),h=this.buildViewApi(e,this.getCurrentData,t.dateEnv);return{viewSpec:r,options:o,dateProfileGenerator:u,viewApi:h}}processRawViewOptions(e,t,n,i,r){let o=fx([Ma,e.optionDefaults,n,i,e.optionOverrides,r]),l=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},kI),RI),PI),JV),t.listenerRefiners),t.optionRefiners),u={},h=this.currentViewOptionsInput,d=this.currentViewOptionsRefined,c=!1,a={};for(let f in o)o[f]===h[f]||Na[f]&&Na[f](o[f],h[f])?u[f]=d[f]:(o[f]===this.currentCalendarOptionsInput[f]||Na[f]&&Na[f](o[f],this.currentCalendarOptionsInput[f])?f in this.currentCalendarOptionsRefined&&(u[f]=this.currentCalendarOptionsRefined[f]):l[f]?u[f]=l[f](o[f]):a[f]=o[f],c=!0);return c&&(this.currentViewOptionsInput=o,this.currentViewOptionsRefined=u),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:a}}};function a9(s,e,t,n,i,r,o,l){let u=Vz(e||o.defaultCode,o.map);return new Lm({calendarSystem:"gregory",timeZone:s,namedTimeZoneImpl:r.namedTimeZonedImpl,locale:u,weekNumberCalculation:t,firstDay:n,weekText:i,cmdFormatter:r.cmdFormatter,defaultSeparator:l})}function l9(s,e){let t=e.themeClasses[s.themeSystem]||yr;return new t(s)}function c9(s){let e=s.dateProfileGeneratorClass||Lc;return new e(s)}function u9(s,e,t){return new aD(s,e,t)}function d9(s){return ni(s,e=>e.ui)}function h9(s,e,t){let n={"":e};for(let i in s){let r=s[i];r.sourceId&&t[r.sourceId]&&(n[i]=t[r.sourceId])}return n}function f9(s){let{options:e}=s;return{eventUiSingleBase:Lh({display:e.eventDisplay,editable:e.editable,startEditable:e.eventStartEditable,durationEditable:e.eventDurationEditable,constraint:e.eventConstraint,overlap:typeof e.eventOverlap=="boolean"?e.eventOverlap:void 0,allow:e.eventAllow,backgroundColor:e.eventBackgroundColor,borderColor:e.eventBorderColor,textColor:e.eventTextColor,color:e.eventColor},s),selectionConfig:Lh({constraint:e.selectConstraint,overlap:typeof e.selectOverlap=="boolean"?e.selectOverlap:void 0,allow:e.selectAllow},s)}}function rD(s,e){for(let t of e.pluginHooks.isLoadingFuncs)if(t(s))return!0;return!1}function p9(s){return HI(s.options.businessHours,s)}function $z(s,e){for(let t in s)console.warn(`Unknown option '${t}'`+(e?` for view '${e}'`:""))}var uD=class extends Ge{render(){let e=this.props.widgetGroups.map(t=>this.renderWidgetGroup(t));return G("div",{className:"fc-toolbar-chunk"},...e)}renderWidgetGroup(e){let{props:t}=this,{theme:n}=this.context,i=[],r=!0;for(let o of e){let{buttonName:l,buttonClick:u,buttonText:h,buttonIcon:d,buttonHint:c}=o;if(l==="title")r=!1,i.push(G("h2",{className:"fc-toolbar-title",id:t.titleId},t.title));else{let a=l===t.activeButton,f=!t.isTodayEnabled&&l==="today"||!t.isPrevEnabled&&l==="prev"||!t.isNextEnabled&&l==="next",p=[`fc-${l}-button`,n.getClass("button")];a&&p.push(n.getClass("buttonActive")),i.push(G("button",{type:"button",title:typeof c=="function"?c(t.navUnit):c,disabled:f,"aria-pressed":a,className:p.join(" "),onClick:u},h||(d?G("span",{className:d,role:"img"}):"")))}}if(i.length>1){let o=r&&n.getClass("buttonGroup")||"";return G("div",{className:o},...i)}return i[0]}},Ix=class extends Ge{render(){let{model:e,extraClassName:t}=this.props,n=!1,i,r,o=e.sectionWidgets,l=o.center;return o.left?(n=!0,i=o.left):i=o.start,o.right?(n=!0,r=o.right):r=o.end,G("div",{className:[t||"","fc-toolbar",n?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",i||[]),this.renderSection("center",l||[]),this.renderSection("end",r||[]))}renderSection(e,t){let{props:n}=this;return G(uD,{key:e,widgetGroups:t,title:n.title,navUnit:n.navUnit,activeButton:n.activeButton,isTodayEnabled:n.isTodayEnabled,isPrevEnabled:n.isPrevEnabled,isNextEnabled:n.isNextEnabled,titleId:n.titleId})}},dD=class extends Ge{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=e=>{this.el=e,Us(this.props.elRef,e),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:e,state:t}=this,{aspectRatio:n}=e,i=["fc-view-harness",n||e.liquid||e.height?"fc-view-harness-active":"fc-view-harness-passive"],r="",o="";return n?t.availableWidth!==null?r=t.availableWidth/n:o=`${1/n*100}%`:r=e.height||"",G("div",{"aria-labelledby":e.labeledById,ref:this.handleEl,className:i.join(" "),style:{height:r,paddingBottom:o}},e.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}},hD=class extends ki{constructor(e){super(e),this.handleSegClick=(t,n)=>{let{component:i}=this,{context:r}=i,o=vo(n);if(o&&i.isValidSegDownEl(t.target)){let l=an(t.target,".fc-event-forced-url"),u=l?l.querySelector("a[href]").href:"";r.emitter.trigger("eventClick",{el:n,event:new _t(i.context,o.eventRange.def,o.eventRange.instance),jsEvent:t,view:r.viewApi}),u&&!t.defaultPrevented&&(window.location.href=u)}},this.destroy=yI(e.el,"click",".fc-event",this.handleSegClick)}},fD=class extends ki{constructor(e){super(e),this.handleEventElRemove=t=>{t===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(t,n)=>{vo(n)&&(this.currentSegEl=n,this.triggerEvent("eventMouseEnter",t,n))},this.handleSegLeave=(t,n)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",t,n))},this.removeHoverListeners=zV(e.el,".fc-event",this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(e,t,n){let{component:i}=this,{context:r}=i,o=vo(n);(!t||i.isValidSegDownEl(t.target))&&r.emitter.trigger(e,{el:n,event:new _t(r,o.eventRange.def,o.eventRange.instance),jsEvent:t,view:r.viewApi})}},pD=class extends dr{constructor(){super(...arguments),this.buildViewContext=xe(nz),this.buildViewPropTransformers=xe(m9),this.buildToolbarProps=xe(g9),this.headerRef=Qt(),this.footerRef=Qt(),this.interactionsStore={},this.state={viewLabelId:si()},this.registerInteractiveComponent=(e,t)=>{let n=fz(e,t),o=[hD,fD].concat(this.props.pluginHooks.componentInteractions).map(l=>new l(n));this.interactionsStore[e.uid]=o,Uh[e.uid]=n},this.unregisterInteractiveComponent=e=>{let t=this.interactionsStore[e.uid];if(t){for(let n of t)n.destroy();delete this.interactionsStore[e.uid]}delete Uh[e.uid]},this.resizeRunner=new Fc(()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})}),this.handleWindowResize=e=>{let{options:t}=this.props;t.handleWindowResize&&e.target===window&&this.resizeRunner.request(t.windowResizeDelay)}}render(){let{props:e}=this,{toolbarConfig:t,options:n}=e,i=!1,r="",o;e.isHeightAuto||e.forPrint?r="":n.height!=null?i=!0:n.contentHeight!=null?r=n.contentHeight:o=Math.max(n.aspectRatio,.5);let l=this.buildViewContext(e.viewSpec,e.viewApi,e.options,e.dateProfileGenerator,e.dateEnv,e.nowManager,e.theme,e.pluginHooks,e.dispatch,e.getCurrentData,e.emitter,e.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),u=t.header&&t.header.hasTitle?this.state.viewLabelId:void 0;return G(ii.Provider,{value:l},G(bs,{unit:"day"},h=>{let d=this.buildToolbarProps(e.viewSpec,e.dateProfile,e.dateProfileGenerator,e.currentDate,h,e.viewTitle);return G(st,null,t.header&&G(Ix,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:t.header,titleId:u},d)),G(dD,{liquid:i,height:r,aspectRatio:o,labeledById:u},this.renderView(e),this.buildAppendContent()),t.footer&&G(Ix,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:t.footer,titleId:""},d)))}))}componentDidMount(){let{props:e}=this;this.calendarInteractions=e.pluginHooks.calendarInteractions.map(n=>new n(e)),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:t}=e.pluginHooks;for(let n in t)t[n](e[n],e)}componentDidUpdate(e){let{props:t}=this,{propSetHandlers:n}=t.pluginHooks;for(let i in n)t[i]!==e[i]&&n[i](t[i],t)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let e of this.calendarInteractions)e.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:e}=this,t=e.pluginHooks.viewContainerAppends.map(n=>n(e));return G(st,{},...t)}renderView(e){let{pluginHooks:t}=e,{viewSpec:n}=e,i={dateProfile:e.dateProfile,businessHours:e.businessHours,eventStore:e.renderableEventStore,eventUiBases:e.eventUiBases,dateSelection:e.dateSelection,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,isHeightAuto:e.isHeightAuto,forPrint:e.forPrint},r=this.buildViewPropTransformers(t.viewPropsTransformers);for(let l of r)Object.assign(i,l.transform(i,e));let o=n.component;return G(o,Object.assign({},i))}};function g9(s,e,t,n,i,r){let o=t.build(i,void 0,!1),l=t.buildPrev(e,n,!1),u=t.buildNext(e,n,!1);return{title:r,activeButton:s.type,navUnit:s.singleUnit,isTodayEnabled:o.isValid&&!ti(e.currentRange,i),isPrevEnabled:l.isValid,isNextEnabled:u.isValid}}function m9(s){return s.map(e=>new e)}var my=class extends Gm{constructor(e,t={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=n=>{switch(n.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=n=>{this.currentData=n,this.renderRunner.request(n.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:n}=this;$m(()=>{Ea(G(Hm,{options:n.calendarOptions,theme:n.theme,emitter:n.emitter},(i,r,o,l)=>(this.setClassNames(i),this.setHeight(r),G(OI.Provider,{value:this.customContentRenderId},G(pD,Object.assign({isHeightAuto:o,forPrint:l},n))))),this.el)})}else this.isRendered&&(this.isRendered=!1,Ea(null,this.el),this.setClassNames([]),this.setHeight(""))},$V(e),this.el=e,this.renderRunner=new Fc(this.handleRenderRequest),new cD({optionOverrides:t,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let e=this.isRendering;e?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),e&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){$m(()=>{super.updateSize()})}batchRendering(e){this.renderRunner.pause("batchRendering"),e(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(e,t){this.currentDataManager.resetOptions(e,t)}setClassNames(e){if(!fr(e,this.currentClassNames)){let{classList:t}=this.el;for(let n of this.currentClassNames)t.remove(n);for(let n of e)t.add(n);this.currentClassNames=e}}setHeight(e){mI(this.el,"height",e)}};var mD=class extends Pn{constructor(){super(...arguments),this.headerElRef=Qt()}renderSimpleLayout(e,t){let{props:n,context:i}=this,r=[],o=Kc(i.options);return e&&r.push({type:"header",key:"header",isSticky:o,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),r.push({type:"body",key:"body",liquid:!0,chunk:{content:t}}),G(Di,{elClasses:["fc-daygrid"],viewSpec:i.viewSpec},G(Ia,{liquid:!n.isHeightAuto&&!n.forPrint,collapsibleWidth:n.forPrint,cols:[],sections:r}))}renderHScrollLayout(e,t,n,i){let r=this.context.pluginHooks.scrollGridImpl;if(!r)throw new Error("No ScrollGrid implementation");let{props:o,context:l}=this,u=!o.forPrint&&Kc(l.options),h=!o.forPrint&&hy(l.options),d=[];return e&&d.push({type:"header",key:"header",isSticky:u,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),d.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:t}]}),h&&d.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:Vh}]}),G(Di,{elClasses:["fc-daygrid"],viewSpec:l.viewSpec},G(r,{liquid:!o.isHeightAuto&&!o.forPrint,forPrint:o.forPrint,collapsibleWidth:o.forPrint,colGroups:[{cols:[{span:n,minWidth:i}]}],sections:d}))}};function kx(s,e){let t=[];for(let n=0;n<e;n+=1)t[n]=[];for(let n of s)t[n.row].push(n);return t}function Dx(s,e){let t=[];for(let n=0;n<e;n+=1)t[n]=[];for(let n of s)t[n.firstCol].push(n);return t}function Yz(s,e){let t=[];if(s){for(let n=0;n<e;n+=1)t[n]={affectedInstances:s.affectedInstances,isEvent:s.isEvent,segs:[]};for(let n of s.segs)t[n.row].segs.push(n)}else for(let n=0;n<e;n+=1)t[n]=null;return t}var Kz=dt({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function Xz(s){let{display:e}=s.eventRange.ui;return e==="list-item"||e==="auto"&&!s.eventRange.def.allDay&&s.firstCol===s.lastCol&&s.isStart&&s.isEnd}var Rx=class extends Ge{render(){let{props:e}=this;return G(Da,Object.assign({},e,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:Kz,defaultDisplayEventEnd:e.defaultDisplayEventEnd,disableResizing:!e.seg.eventRange.def.allDay}))}},Px=class extends Ge{render(){let{props:e,context:t}=this,{options:n}=t,{seg:i}=e,r=n.eventTimeFormat||Kz,o=Oa(i,r,t,!0,e.defaultDisplayEventEnd);return G(yo,Object.assign({},e,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:$h(e.seg,t),defaultGenerator:b9,timeText:o,isResizing:!1,isDateSelecting:!1}))}};function b9(s){return G(st,null,G("div",{className:"fc-daygrid-event-dot",style:{borderColor:s.borderColor||s.backgroundColor}}),s.timeText&&G("div",{className:"fc-event-time"},s.timeText),G("div",{className:"fc-event-title"},s.event.title||G(st,null,"\xA0")))}var yD=class extends Ge{constructor(){super(...arguments),this.compileSegs=xe(v9)}render(){let{props:e}=this,{allSegs:t,invisibleSegs:n}=this.compileSegs(e.singlePlacements);return G(Wc,{elClasses:["fc-daygrid-more-link"],dateProfile:e.dateProfile,todayRange:e.todayRange,allDayDate:e.allDayDate,moreCnt:e.moreCnt,allSegs:t,hiddenSegs:n,alignmentElRef:e.alignmentElRef,alignGridTop:e.alignGridTop,extraDateSpan:e.extraDateSpan,popoverContent:()=>{let i=(e.eventDrag?e.eventDrag.affectedInstances:null)||(e.eventResize?e.eventResize.affectedInstances:null)||{};return G(st,null,t.map(r=>{let o=r.eventRange.instance.instanceId;return G("div",{className:"fc-daygrid-event-harness",key:o,style:{visibility:i[o]?"hidden":""}},Xz(r)?G(Px,Object.assign({seg:r,isDragging:!1,isSelected:o===e.eventSelection,defaultDisplayEventEnd:!1},Bs(r,e.todayRange))):G(Rx,Object.assign({seg:r,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:o===e.eventSelection,defaultDisplayEventEnd:!1},Bs(r,e.todayRange))))}))}})}};function v9(s){let e=[],t=[];for(let n of s)e.push(n.seg),n.isVisible||t.push(n.seg);return{allSegs:e,invisibleSegs:t}}var _9=dt({week:"narrow"}),bD=class extends Pn{constructor(){super(...arguments),this.rootElRef=Qt(),this.state={dayNumberId:si()},this.handleRootEl=e=>{Us(this.rootElRef,e),Us(this.props.elRef,e)}}render(){let{context:e,props:t,state:n,rootElRef:i}=this,{options:r,dateEnv:o}=e,{date:l,dateProfile:u}=t,h=t.showDayNumber&&x9(l,u.currentRange,o);return G(ka,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...t.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},t.extraDataAttrs),t.showDayNumber?{"aria-labelledby":n.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:w9,date:l,dateProfile:u,todayRange:t.todayRange,showDayNumber:t.showDayNumber,isMonthStart:h,extraRenderProps:t.extraRenderProps},(d,c)=>G("div",{ref:t.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:t.minHeight}},t.showWeekNumber&&G(gy,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:mr(e,l,"week"),date:l,defaultFormat:_9}),!c.isDisabled&&(t.showDayNumber||zh(r)||t.forceDayTop)?G("div",{className:"fc-daygrid-day-top"},G(d,{elTag:"a",elClasses:["fc-daygrid-day-number",h&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},mr(e,l)),{id:n.dayNumberId})})):t.showDayNumber?G("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},G("a",{className:"fc-daygrid-day-number"},"\xA0")):void 0,G("div",{className:"fc-daygrid-day-events",ref:t.fgContentElRef},t.fgContent,G("div",{className:"fc-daygrid-day-bottom",style:{marginTop:t.moreMarginTop}},G(yD,{allDayDate:l,singlePlacements:t.singlePlacements,moreCnt:t.moreCnt,alignmentElRef:i,alignGridTop:!t.showDayNumber,extraDateSpan:t.extraDateSpan,dateProfile:t.dateProfile,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,todayRange:t.todayRange}))),G("div",{className:"fc-daygrid-day-bg"},t.bgContent)))}};function w9(s){return s.dayNumberText||G(st,null,"\xA0")}function x9(s,e,t){let{start:n,end:i}=e,r=ur(i,-1),o=t.getYear(n),l=t.getMonth(n),u=t.getYear(r),h=t.getMonth(r);return!(o===u&&l===h)&&(s.valueOf()===n.valueOf()||t.getDay(s)===1&&s.valueOf()<i.valueOf())}function Jz(s){return s.eventRange.instance.instanceId+":"+s.firstCol}function Zz(s){return Jz(s)+":"+s.lastCol}function E9(s,e,t,n,i,r,o){let l=new vD(y=>{let _=s[y.index].eventRange.instance.instanceId+":"+y.span.start+":"+(y.span.end-1);return i[_]||1});l.allowReslicing=!0,l.strictOrder=n,e===!0||t===!0?(l.maxCoord=r,l.hiddenConsumes=!0):typeof e=="number"?l.maxStackCnt=e:typeof t=="number"&&(l.maxStackCnt=t,l.hiddenConsumes=!0);let u=[],h=[];for(let y=0;y<s.length;y+=1){let _=s[y],x=Zz(_);i[x]!=null?u.push({index:y,span:{start:_.firstCol,end:_.lastCol+1}}):h.push(_)}let d=l.addSegs(u),c=l.toRects(),{singleColPlacements:a,multiColPlacements:f,leftoverMargins:p}=S9(c,s,o),g=[],m=[];for(let y of h){f[y.firstCol].push({seg:y,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let _=y.firstCol;_<=y.lastCol;_+=1)a[_].push({seg:Hh(y,_,_+1,o),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let y=0;y<o.length;y+=1)g.push(0);for(let y of d){let _=s[y.index],x=y.span;f[x.start].push({seg:Hh(_,x.start,x.end,o),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let E=x.start;E<x.end;E+=1)g[E]+=1,a[E].push({seg:Hh(_,E,E+1,o),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let y=0;y<o.length;y+=1)m.push(p[y]);return{singleColPlacements:a,multiColPlacements:f,moreCnts:g,moreMarginTops:m}}function S9(s,e,t){let n=T9(s,t.length),i=[],r=[],o=[];for(let l=0;l<t.length;l+=1){let u=n[l],h=[],d=0,c=0;for(let f of u){let p=e[f.index];h.push({seg:Hh(p,l,l+1,t),isVisible:!0,isAbsolute:!1,absoluteTop:f.levelCoord,marginTop:f.levelCoord-d}),d=f.levelCoord+f.thickness}let a=[];d=0,c=0;for(let f of u){let p=e[f.index],g=f.span.end-f.span.start>1,m=f.span.start===l;c+=f.levelCoord-d,d=f.levelCoord+f.thickness,g?(c+=f.thickness,m&&a.push({seg:Hh(p,f.span.start,f.span.end,t),isVisible:!0,isAbsolute:!0,absoluteTop:f.levelCoord,marginTop:0})):m&&(a.push({seg:Hh(p,f.span.start,f.span.end,t),isVisible:!0,isAbsolute:!1,absoluteTop:f.levelCoord,marginTop:c}),c=0)}i.push(h),r.push(a),o.push(c)}return{singleColPlacements:i,multiColPlacements:r,leftoverMargins:o}}function T9(s,e){let t=[];for(let n=0;n<e;n+=1)t.push([]);for(let n of s)for(let i=n.span.start;i<n.span.end;i+=1)t[i].push(n);return t}function Hh(s,e,t,n){if(s.firstCol===e&&s.lastCol===t-1)return s;let i=s.eventRange,r=i.range,o=$s(r,{start:n[e].date,end:Dt(n[t-1].date,1)});return Object.assign(Object.assign({},s),{firstCol:e,lastCol:t-1,eventRange:{def:i.def,ui:Object.assign(Object.assign({},i.ui),{durationEditable:!1}),instance:i.instance,range:o},isStart:s.isStart&&o.start.valueOf()===r.start.valueOf(),isEnd:s.isEnd&&o.end.valueOf()===r.end.valueOf()})}var vD=class extends Bc{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(e){let t=super.addSegs(e),{entriesByLevel:n}=this,i=r=>!this.forceHidden[hr(r)];for(let r=0;r<n.length;r+=1)n[r]=n[r].filter(i);return t}handleInvalidInsertion(e,t,n){let{entriesByLevel:i,forceHidden:r}=this,{touchingEntry:o,touchingLevel:l,touchingLateral:u}=e;if(this.hiddenConsumes&&o){let h=hr(o);if(!r[h])if(this.allowReslicing){let d=Object.assign(Object.assign({},o),{span:uy(o.span,t.span)}),c=hr(d);r[c]=!0,i[l][u]=d,n.push(d),this.splitEntry(o,t,n)}else r[h]=!0,n.push(o)}super.handleInvalidInsertion(e,t,n)}},Mx=class extends Pn{constructor(){super(...arguments),this.cellElRefs=new vs,this.frameElRefs=new vs,this.fgElRefs=new vs,this.segHarnessRefs=new vs,this.rootElRef=Qt(),this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=e=>{e&&this.updateSizing(!0)}}render(){let{props:e,state:t,context:n}=this,{options:i}=n,r=e.cells.length,o=Dx(e.businessHourSegs,r),l=Dx(e.bgEventSegs,r),u=Dx(this.getHighlightSegs(),r),h=Dx(this.getMirrorSegs(),r),{singleColPlacements:d,multiColPlacements:c,moreCnts:a,moreMarginTops:f}=E9(Yc(e.fgEventSegs,i.eventOrder),e.dayMaxEvents,e.dayMaxEventRows,i.eventOrderStrict,t.segHeights,t.maxContentHeight,e.cells),p=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{};return G("tr",{ref:this.rootElRef,role:"row"},e.renderIntro&&e.renderIntro(),e.cells.map((g,m)=>{let y=this.renderFgSegs(m,e.forPrint?d[m]:c[m],e.todayRange,p),_=this.renderFgSegs(m,A9(h[m],c),e.todayRange,{},!!e.eventDrag,!!e.eventResize,!1);return G(bD,{key:g.key,elRef:this.cellElRefs.createRef(g.key),innerElRef:this.frameElRefs.createRef(g.key),dateProfile:e.dateProfile,date:g.date,showDayNumber:e.showDayNumbers,showWeekNumber:e.showWeekNumbers&&m===0,forceDayTop:e.showWeekNumbers,todayRange:e.todayRange,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,extraRenderProps:g.extraRenderProps,extraDataAttrs:g.extraDataAttrs,extraClassNames:g.extraClassNames,extraDateSpan:g.extraDateSpan,moreCnt:a[m],moreMarginTop:f[m],singlePlacements:d[m],fgContentElRef:this.fgElRefs.createRef(g.key),fgContent:G(st,null,G(st,null,y),G(st,null,_)),bgContent:G(st,null,this.renderFillSegs(u[m],"highlight"),this.renderFillSegs(o[m],"non-business"),this.renderFillSegs(l[m],"bg-event")),minHeight:e.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(e,t){let n=this.props;this.updateSizing(!ys(e,n))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:e}=this;return e.eventDrag&&e.eventDrag.segs.length?e.eventDrag.segs:e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:e.dateSelectionSegs}getMirrorSegs(){let{props:e}=this;return e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:[]}renderFgSegs(e,t,n,i,r,o,l){let{context:u}=this,{eventSelection:h}=this.props,{framePositions:d}=this.state,c=this.props.cells.length===1,a=r||o||l,f=[];if(d)for(let p of t){let{seg:g}=p,{instanceId:m}=g.eventRange.instance,y=p.isVisible&&!i[m],_=p.isAbsolute,x="",E="";_&&(u.isRtl?(E=0,x=d.lefts[g.lastCol]-d.lefts[g.firstCol]):(x=0,E=d.rights[g.firstCol]-d.rights[g.lastCol])),f.push(G("div",{className:"fc-daygrid-event-harness"+(_?" fc-daygrid-event-harness-abs":""),key:Jz(g),ref:a?null:this.segHarnessRefs.createRef(Zz(g)),style:{visibility:y?"":"hidden",marginTop:_?"":p.marginTop,top:_?p.absoluteTop:"",left:x,right:E}},Xz(g)?G(Px,Object.assign({seg:g,isDragging:r,isSelected:m===h,defaultDisplayEventEnd:c},Bs(g,n))):G(Rx,Object.assign({seg:g,isDragging:r,isResizing:o,isDateSelecting:l,isSelected:m===h,defaultDisplayEventEnd:c},Bs(g,n)))))}return f}renderFillSegs(e,t){let{isRtl:n}=this.context,{todayRange:i}=this.props,{framePositions:r}=this.state,o=[];if(r)for(let l of e){let u=n?{right:0,left:r.lefts[l.lastCol]-r.lefts[l.firstCol]}:{left:0,right:r.rights[l.firstCol]-r.rights[l.lastCol]};o.push(G("div",{key:oy(l.eventRange),className:"fc-daygrid-bg-harness",style:u},t==="bg-event"?G(jc,Object.assign({seg:l},Bs(l,i))):py(t)))}return G(st,{},...o)}updateSizing(e){let{props:t,state:n,frameElRefs:i}=this;if(!t.forPrint&&t.clientWidth!==null){if(e){let u=t.cells.map(h=>i.currentMap[h.key]);if(u.length){let h=this.rootElRef.current,d=new Ri(h,u,!0,!1);(!n.framePositions||!n.framePositions.similarTo(d))&&this.setState({framePositions:new Ri(h,u,!0,!1)})}}let r=this.state.segHeights,o=this.querySegHeights(),l=t.dayMaxEvents===!0||t.dayMaxEventRows===!0;this.safeSetState({segHeights:Object.assign(Object.assign({},r),o),maxContentHeight:l?this.computeMaxContentHeight():null})}}querySegHeights(){let e=this.segHarnessRefs.currentMap,t={};for(let n in e){let i=Math.round(e[n].getBoundingClientRect().height);t[n]=Math.max(t[n]||0,i)}return t}computeMaxContentHeight(){let e=this.props.cells[0].key,t=this.cellElRefs.currentMap[e],n=this.fgElRefs.currentMap[e];return t.getBoundingClientRect().bottom-n.getBoundingClientRect().top}getCellEls(){let e=this.cellElRefs.currentMap;return this.props.cells.map(t=>e[t.key])}};Mx.addStateEquality({segHeights:ys});function A9(s,e){if(!s.length)return[];let t=C9(e);return s.map(n=>({seg:n,isVisible:!0,isAbsolute:!0,absoluteTop:t[n.eventRange.instance.instanceId],marginTop:0}))}function C9(s){let e={};for(let t of s)for(let n of t)e[n.seg.eventRange.instance.instanceId]=n.absoluteTop;return e}var _D=class extends Pn{constructor(){super(...arguments),this.splitBusinessHourSegs=xe(kx),this.splitBgEventSegs=xe(I9),this.splitFgEventSegs=xe(kx),this.splitDateSelectionSegs=xe(kx),this.splitEventDrag=xe(Yz),this.splitEventResize=xe(Yz),this.rowRefs=new vs}render(){let{props:e,context:t}=this,n=e.cells.length,i=this.splitBusinessHourSegs(e.businessHourSegs,n),r=this.splitBgEventSegs(e.bgEventSegs,n),o=this.splitFgEventSegs(e.fgEventSegs,n),l=this.splitDateSelectionSegs(e.dateSelectionSegs,n),u=this.splitEventDrag(e.eventDrag,n),h=this.splitEventResize(e.eventResize,n),d=n>=7&&e.clientWidth?e.clientWidth/t.options.aspectRatio/6:null;return G(bs,{unit:"day"},(c,a)=>G(st,null,e.cells.map((f,p)=>G(Mx,{ref:this.rowRefs.createRef(p),key:f.length?f[0].date.toISOString():p,showDayNumbers:n>1,showWeekNumbers:e.showWeekNumbers,todayRange:a,dateProfile:e.dateProfile,cells:f,renderIntro:e.renderRowIntro,businessHourSegs:i[p],eventSelection:e.eventSelection,bgEventSegs:r[p],fgEventSegs:o[p],dateSelectionSegs:l[p],eventDrag:u[p],eventResize:h[p],dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,clientWidth:e.clientWidth,clientHeight:e.clientHeight,cellMinHeight:d,forPrint:e.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){let e=this.rowRefs.currentMap[0].getCellEls()[0],t=e?e.closest(".fc-daygrid-body"):null;t&&(this.rootEl=t,this.context.registerInteractiveComponent(this,{el:t,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new Ri(this.rootEl,this.rowRefs.collect().map(e=>e.getCellEls()[0]),!1,!0),this.colPositions=new Ri(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(e,t){let{colPositions:n,rowPositions:i}=this,r=n.leftToIndex(e),o=i.topToIndex(t);if(o!=null&&r!=null){let l=this.props.cells[o][r];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(o,r),allDay:!0},l.extraDateSpan),dayEl:this.getCellEl(o,r),rect:{left:n.lefts[r],right:n.rights[r],top:i.tops[o],bottom:i.bottoms[o]},layer:0}}return null}getCellEl(e,t){return this.rowRefs.currentMap[e].getCellEls()[t]}getCellRange(e,t){let n=this.props.cells[e][t].date,i=Dt(n,1);return{start:n,end:i}}};function I9(s,e){return kx(s.filter(D9),e)}function D9(s){return s.eventRange.def.allDay}var wD=class extends Pn{constructor(){super(...arguments),this.elRef=Qt(),this.needsScrollReset=!1}render(){let{props:e}=this,{dayMaxEventRows:t,dayMaxEvents:n,expandRows:i}=e,r=n===!0||t===!0;r&&!i&&(r=!1,t=null,n=null);let o=["fc-daygrid-body",r?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",i?"":"fc-daygrid-body-natural"];return G("div",{ref:this.elRef,className:o.join(" "),style:{width:e.clientWidth,minWidth:e.tableMinWidth}},G("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:e.clientWidth,minWidth:e.tableMinWidth,height:i?e.clientHeight:""}},e.colGroupNode,G("tbody",{role:"presentation"},G(_D,{dateProfile:e.dateProfile,cells:e.cells,renderRowIntro:e.renderRowIntro,showWeekNumbers:e.showWeekNumbers,clientWidth:e.clientWidth,clientHeight:e.clientHeight,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,dayMaxEvents:n,dayMaxEventRows:t,forPrint:e.forPrint,isHitComboAllowed:e.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(e){e.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){let e=k9(this.elRef.current,this.props.dateProfile);if(e){let t=e.closest(".fc-daygrid-body"),n=t.closest(".fc-scroller"),i=e.getBoundingClientRect().top-t.getBoundingClientRect().top;n.scrollTop=i?i+1:0}this.needsScrollReset=!1}}};function k9(s,e){let t;return e.currentRangeUnit.match(/year|month/)&&(t=s.querySelector(`[data-date="${CI(e.currentDate)}-01"]`)),t||(t=s.querySelector(`[data-date="${Pa(e.currentDate)}"]`)),t}var xD=class extends Gc{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(e,t){return t.sliceRange(e)}},yy=class extends Pn{constructor(){super(...arguments),this.slicer=new xD,this.tableRef=Qt()}render(){let{props:e,context:t}=this;return G(wD,Object.assign({ref:this.tableRef},this.slicer.sliceProps(e,e.dateProfile,e.nextDayThreshold,t,e.dayTableModel),{dateProfile:e.dateProfile,cells:e.dayTableModel.cells,colGroupNode:e.colGroupNode,tableMinWidth:e.tableMinWidth,renderRowIntro:e.renderRowIntro,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.showWeekNumbers,expandRows:e.expandRows,headerAlignElRef:e.headerAlignElRef,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:e.forPrint}))}},Nx=class extends mD{constructor(){super(...arguments),this.buildDayTableModel=xe(R9),this.headerRef=Qt(),this.tableRef=Qt()}render(){let{options:e,dateProfileGenerator:t}=this.context,{props:n}=this,i=this.buildDayTableModel(n.dateProfile,t),r=e.dayHeaders&&G(Vc,{ref:this.headerRef,dateProfile:n.dateProfile,dates:i.headerDates,datesRepDistinctDays:i.rowCnt===1}),o=l=>G(yy,{ref:this.tableRef,dateProfile:n.dateProfile,dayTableModel:i,businessHours:n.businessHours,dateSelection:n.dateSelection,eventStore:n.eventStore,eventUiBases:n.eventUiBases,eventSelection:n.eventSelection,eventDrag:n.eventDrag,eventResize:n.eventResize,nextDayThreshold:e.nextDayThreshold,colGroupNode:l.tableColGroupNode,tableMinWidth:l.tableMinWidth,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.weekNumbers,expandRows:!n.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:l.clientWidth,clientHeight:l.clientHeight,forPrint:n.forPrint});return e.dayMinWidth?this.renderHScrollLayout(r,o,i.colCnt,e.dayMinWidth):this.renderSimpleLayout(r,o)}};function R9(s,e){let t=new zc(s.renderRange,e);return new Hc(t,/year|month|week/.test(s.currentRangeUnit))}var Ox=class extends Lc{buildRenderRange(e,t,n){let i=super.buildRenderRange(e,t,n),{props:r}=this;return P9({currentRange:i,snapToWeek:/^(year|month)$/.test(t),fixedWeekCount:r.fixedWeekCount,dateEnv:r.dateEnv})}};function P9(s){let{dateEnv:e,currentRange:t}=s,{start:n,end:i}=t,r;if(s.snapToWeek&&(n=e.startOfWeek(n),r=e.startOfWeek(i),r.valueOf()!==i.valueOf()&&(i=dx(r,1))),s.fixedWeekCount){let o=e.startOfWeek(e.startOfMonth(Dt(t.end,-1))),l=Math.ceil(TI(o,i));i=dx(i,6-l)}return{start:n,end:i}}var M9=':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}';Ra(M9);var Qz=_s({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:Nx,dateProfileGeneratorClass:Ox},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});var SD=class extends jm{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(e){return e.allDay?["allDay"]:["timed"]}getKeysForEventDef(e){return e.allDay?jI(e)?["timed","allDay"]:["allDay"]:["timed"]}},N9=dt({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function i4(s){let e=["fc-timegrid-slot","fc-timegrid-slot-label",s.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return G(ii.Consumer,null,t=>{if(!s.isLabeled)return G("td",{className:e.join(" "),"data-time":s.isoTimeStr});let{dateEnv:n,options:i,viewApi:r}=t,o=i.slotLabelFormat==null?N9:Array.isArray(i.slotLabelFormat)?dt(i.slotLabelFormat[0]):dt(i.slotLabelFormat),l={level:0,time:s.time,date:n.toDate(s.date),view:r,text:n.format(s.date,o)};return G(Ut,{elTag:"td",elClasses:e,elAttrs:{"data-time":s.isoTimeStr},renderProps:l,generatorName:"slotLabelContent",customGenerator:i.slotLabelContent,defaultGenerator:O9,classNameGenerator:i.slotLabelClassNames,didMount:i.slotLabelDidMount,willUnmount:i.slotLabelWillUnmount},u=>G("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},G(u,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function O9(s){return s.text}var TD=class extends Ge{render(){return this.props.slatMetas.map(e=>G("tr",{key:e.key},G(i4,Object.assign({},e))))}},F9=dt({week:"short"}),L9=5,AD=class extends Pn{constructor(){super(...arguments),this.allDaySplitter=new SD,this.headerElRef=Qt(),this.rootElRef=Qt(),this.scrollerElRef=Qt(),this.state={slatCoords:null},this.handleScrollTopRequest=e=>{let t=this.scrollerElRef.current;t&&(t.scrollTop=e)},this.renderHeadAxis=(e,t="")=>{let{options:n}=this.context,{dateProfile:i}=this.props,r=i.renderRange,l=pr(r.start,r.end)===1?mr(this.context,r.start,"week"):{};return n.weekNumbers&&e==="day"?G(gy,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:r.start,defaultFormat:F9},u=>G("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:t}},G(u,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:l}))):G("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},G("div",{className:"fc-timegrid-axis-frame",style:{height:t}}))},this.renderTableRowAxis=e=>{let{options:t,viewApi:n}=this.context,i={text:t.allDayText,view:n};return G(Ut,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:i,generatorName:"allDayContent",customGenerator:t.allDayContent,defaultGenerator:$9,classNameGenerator:t.allDayClassNames,didMount:t.allDayDidMount,willUnmount:t.allDayWillUnmount},r=>G("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",e==null?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:e}},G(r,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=e=>{this.setState({slatCoords:e})}}renderSimpleLayout(e,t,n){let{context:i,props:r}=this,o=[],l=Kc(i.options);return e&&o.push({type:"header",key:"header",isSticky:l,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),t&&(o.push({type:"body",key:"all-day",chunk:{content:t}}),o.push({type:"body",key:"all-day-divider",outerContent:G("tr",{role:"presentation",className:"fc-scrollgrid-section"},G("td",{className:"fc-timegrid-divider "+i.theme.getClass("tableCellShaded")}))})),o.push({type:"body",key:"body",liquid:!0,expandRows:!!i.options.expandRows,chunk:{scrollerElRef:this.scrollerElRef,content:n}}),G(Di,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:i.viewSpec},G(Ia,{liquid:!r.isHeightAuto&&!r.forPrint,collapsibleWidth:r.forPrint,cols:[{width:"shrink"}],sections:o}))}renderHScrollLayout(e,t,n,i,r,o,l){let u=this.context.pluginHooks.scrollGridImpl;if(!u)throw new Error("No ScrollGrid implementation");let{context:h,props:d}=this,c=!d.forPrint&&Kc(h.options),a=!d.forPrint&&hy(h.options),f=[];e&&f.push({type:"header",key:"header",isSticky:c,syncRowHeights:!0,chunks:[{key:"axis",rowContent:g=>G("tr",{role:"presentation"},this.renderHeadAxis("day",g.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),t&&(f.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:g=>G("tr",{role:"presentation"},this.renderTableRowAxis(g.rowSyncHeights[0]))},{key:"cols",content:t}]}),f.push({key:"all-day-divider",type:"body",outerContent:G("tr",{role:"presentation",className:"fc-scrollgrid-section"},G("td",{colSpan:2,className:"fc-timegrid-divider "+h.theme.getClass("tableCellShaded")}))}));let p=h.options.nowIndicator;return f.push({type:"body",key:"body",liquid:!0,expandRows:!!h.options.expandRows,chunks:[{key:"axis",content:g=>G("div",{className:"fc-timegrid-axis-chunk"},G("table",{"aria-hidden":!0,style:{height:g.expandRows?g.clientHeight:""}},g.tableColGroupNode,G("tbody",null,G(TD,{slatMetas:o}))),G("div",{className:"fc-timegrid-now-indicator-container"},G(bs,{unit:p?"minute":"day"},m=>{let y=p&&l&&l.safeComputeTop(m);return typeof y=="number"?G(fy,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:y},isAxis:!0,date:m}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:n}]}),a&&f.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:Vh},{key:"cols",content:Vh}]}),G(Di,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:h.viewSpec},G(u,{liquid:!d.isHeightAuto&&!d.forPrint,forPrint:d.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:i,minWidth:r}]}],sections:f}))}getAllDayMaxEventProps(){let{dayMaxEvents:e,dayMaxEventRows:t}=this.context.options;return(e===!0||t===!0)&&(e=void 0,t=L9),{dayMaxEvents:e,dayMaxEventRows:t}}};function $9(s){return s.text}var CD=class{constructor(e,t,n){this.positions=e,this.dateProfile=t,this.slotDuration=n}safeComputeTop(e){let{dateProfile:t}=this;if(ti(t.currentRange,e)){let n=ct(e),i=e.valueOf()-n.valueOf();if(i>=Ls(t.slotMinTime)&&i<Ls(t.slotMaxTime))return this.computeTimeTop(He(i))}return null}computeDateTop(e,t){return t||(t=ct(e)),this.computeTimeTop(He(e.valueOf()-t.valueOf()))}computeTimeTop(e){let{positions:t,dateProfile:n}=this,i=t.els.length,r=(e.milliseconds-Ls(n.slotMinTime))/Ls(this.slotDuration),o,l;return r=Math.max(0,r),r=Math.min(i,r),o=Math.floor(r),o=Math.min(o,i-1),l=r-o,t.tops[o]+t.getHeight(o)*l}},ID=class extends Ge{render(){let{props:e,context:t}=this,{options:n}=t,{slatElRefs:i}=e;return G("tbody",null,e.slatMetas.map((r,o)=>{let l={time:r.time,date:t.dateEnv.toDate(r.date),view:t.viewApi};return G("tr",{key:r.key,ref:i.createRef(r.key)},e.axis&&G(i4,Object.assign({},r)),G(Ut,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!r.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":r.isoTimeStr},renderProps:l,generatorName:"slotLaneContent",customGenerator:n.slotLaneContent,classNameGenerator:n.slotLaneClassNames,didMount:n.slotLaneDidMount,willUnmount:n.slotLaneWillUnmount}))}))}},DD=class extends Ge{constructor(){super(...arguments),this.rootElRef=Qt(),this.slatElRefs=new vs}render(){let{props:e,context:t}=this;return G("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},G("table",{"aria-hidden":!0,className:t.theme.getClass("table"),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:e.minHeight}},e.tableColGroupNode,G(ID,{slatElRefs:this.slatElRefs,axis:e.axis,slatMetas:e.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:e,props:t}=this;t.onCoords&&t.clientWidth!==null&&this.rootElRef.current.offsetHeight&&t.onCoords(new CD(new Ri(this.rootElRef.current,U9(this.slatElRefs.currentMap,t.slatMetas),!1,!0),this.props.dateProfile,e.options.slotDuration))}};function U9(s,e){return e.map(t=>s[t.key])}function by(s,e){let t=[],n;for(n=0;n<e;n+=1)t.push([]);if(s)for(n=0;n<s.length;n+=1)t[s[n].col].push(s[n]);return t}function e4(s,e){let t=[];if(s){for(let n=0;n<e;n+=1)t[n]={affectedInstances:s.affectedInstances,isEvent:s.isEvent,segs:[]};for(let n of s.segs)t[n.col].segs.push(n)}else for(let n=0;n<e;n+=1)t[n]=null;return t}var kD=class extends Ge{render(){let{props:e}=this;return G(Wc,{elClasses:["fc-timegrid-more-link"],elStyle:{top:e.top,bottom:e.bottom},allDayDate:null,moreCnt:e.hiddenSegs.length,allSegs:e.hiddenSegs,hiddenSegs:e.hiddenSegs,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,todayRange:e.todayRange,popoverContent:()=>r4(e.hiddenSegs,e),defaultGenerator:B9,forceTimed:!0},t=>G(t,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}};function B9(s){return s.shortText}function V9(s,e,t){let n=new Bc;e!=null&&(n.strictOrder=e),t!=null&&(n.maxStackCnt=t);let i=n.addSegs(s),r=nD(i),o=z9(n);return o=W9(o,1),{segRects:q9(o),hiddenGroups:r}}function z9(s){let{entriesByLevel:e}=s,t=FD((n,i)=>n+":"+i,(n,i)=>{let r=j9(s,n,i),o=t4(r,t),l=e[n][i];return[Object.assign(Object.assign({},l),{nextLevelNodes:o[0]}),l.thickness+o[1]]});return t4(e.length?{level:0,lateralStart:0,lateralEnd:e[0].length}:null,t)[0]}function t4(s,e){if(!s)return[[],0];let{level:t,lateralStart:n,lateralEnd:i}=s,r=n,o=[];for(;r<i;)o.push(e(t,r)),r+=1;return o.sort(H9),[o.map(G9),o[0][1]]}function H9(s,e){return e[1]-s[1]}function G9(s){return s[0]}function j9(s,e,t){let{levelCoords:n,entriesByLevel:i}=s,r=i[e][t],o=n[e]+r.thickness,l=n.length,u=e;for(;u<l&&n[u]<o;u+=1);for(;u<l;u+=1){let h=i[u],d,c=Km(h,r.span.start,Ym),a=c[0]+c[1],f=a;for(;(d=h[f])&&d.span.start<r.span.end;)f+=1;if(a<f)return{level:u,lateralStart:a,lateralEnd:f}}return null}function W9(s,e){let t=FD((n,i,r)=>hr(n),(n,i,r)=>{let{nextLevelNodes:o,thickness:l}=n,u=l+r,h=l/u,d,c=[];if(!o.length)d=e;else for(let f of o)if(d===void 0){let p=t(f,i,u);d=p[0],c.push(p[1])}else{let p=t(f,d,0);c.push(p[1])}let a=(d-i)*h;return[d-a,Object.assign(Object.assign({},n),{thickness:a,nextLevelNodes:c})]});return s.map(n=>t(n,0,0)[1])}function q9(s){let e=[],t=FD((i,r,o)=>hr(i),(i,r,o)=>{let l=Object.assign(Object.assign({},i),{levelCoord:r,stackDepth:o,stackForward:0});return e.push(l),l.stackForward=n(i.nextLevelNodes,r+i.thickness,o+1)+1});function n(i,r,o){let l=0;for(let u of i)l=Math.max(t(u,r,o),l);return l}return n(s,0,0),e}function FD(s,e){let t={};return(...n)=>{let i=s(...n);return i in t?t[i]:t[i]=e(...n)}}function n4(s,e,t=null,n=0){let i=[];if(t)for(let r=0;r<s.length;r+=1){let o=s[r],l=t.computeDateTop(o.start,e),u=Math.max(l+(n||0),t.computeDateTop(o.end,e));i.push({start:Math.round(l),end:Math.round(u)})}return i}function Y9(s,e,t,n){let i=[],r=[];for(let h=0;h<s.length;h+=1){let d=e[h];d?i.push({index:h,thickness:1,span:d}):r.push(s[h])}let{segRects:o,hiddenGroups:l}=V9(i,t,n),u=[];for(let h of o)u.push({seg:s[h.index],rect:h});for(let h of r)u.push({seg:h,rect:null});return{segPlacements:u,hiddenGroups:l}}var K9=dt({hour:"numeric",minute:"2-digit",meridiem:!1}),Fx=class extends Ge{render(){return G(Da,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:K9}))}},RD=class extends Ge{constructor(){super(...arguments),this.sortEventSegs=xe(Yc)}render(){let{props:e,context:t}=this,{options:n}=t,i=n.selectMirror,r=e.eventDrag&&e.eventDrag.segs||e.eventResize&&e.eventResize.segs||i&&e.dateSelectionSegs||[],o=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{},l=this.sortEventSegs(e.fgEventSegs,n.eventOrder);return G(ka,{elTag:"td",elRef:e.elRef,elClasses:["fc-timegrid-col",...e.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},e.extraDataAttrs),date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,extraRenderProps:e.extraRenderProps},u=>G("div",{className:"fc-timegrid-col-frame"},G("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(e.businessHourSegs,"non-business"),this.renderFillSegs(e.bgEventSegs,"bg-event"),this.renderFillSegs(e.dateSelectionSegs,"highlight")),G("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(l,o,!1,!1,!1)),G("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(r,{},!!e.eventDrag,!!e.eventResize,!!i,"mirror")),G("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(e.nowIndicatorSegs)),zh(n)&&G(u,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(e,t,n,i,r,o){let{props:l}=this;return l.forPrint?r4(e,l):this.renderPositionedFgSegs(e,t,n,i,r,o)}renderPositionedFgSegs(e,t,n,i,r,o){let{eventMaxStack:l,eventShortHeight:u,eventOrderStrict:h,eventMinHeight:d}=this.context.options,{date:c,slatCoords:a,eventSelection:f,todayRange:p,nowDate:g}=this.props,m=n||i||r,y=n4(e,c,a,d),{segPlacements:_,hiddenGroups:x}=Y9(e,y,h,l);return G(st,null,this.renderHiddenGroups(x,e),_.map(E=>{let{seg:S,rect:T}=E,C=S.eventRange.instance.instanceId,I=m||!!(!t[C]&&T),A=ED(T&&T.span),P=!m&&T?this.computeSegHStyle(T):{left:0,right:0},F=!!T&&T.stackForward>0,H=!!T&&T.span.end-T.span.start<u;return G("div",{className:"fc-timegrid-event-harness"+(F?" fc-timegrid-event-harness-inset":""),key:o||C,style:Object.assign(Object.assign({visibility:I?"":"hidden"},A),P)},G(Fx,Object.assign({seg:S,isDragging:n,isResizing:i,isDateSelecting:r,isSelected:C===f,isShort:H},Bs(S,p,g))))}))}renderHiddenGroups(e,t){let{extraDateSpan:n,dateProfile:i,todayRange:r,nowDate:o,eventSelection:l,eventDrag:u,eventResize:h}=this.props;return G(st,null,e.map(d=>{let c=ED(d.span),a=X9(d.entries,t);return G(kD,{key:hx(Ax(a)),hiddenSegs:a,top:c.top,bottom:c.bottom,extraDateSpan:n,dateProfile:i,todayRange:r,nowDate:o,eventSelection:l,eventDrag:u,eventResize:h})}))}renderFillSegs(e,t){let{props:n,context:i}=this,o=n4(e,n.date,n.slatCoords,i.options.eventMinHeight).map((l,u)=>{let h=e[u];return G("div",{key:oy(h.eventRange),className:"fc-timegrid-bg-harness",style:ED(l)},t==="bg-event"?G(jc,Object.assign({seg:h},Bs(h,n.todayRange,n.nowDate))):py(t))});return G(st,null,o)}renderNowIndicator(e){let{slatCoords:t,date:n}=this.props;return t?e.map((i,r)=>G(fy,{key:r,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:t.computeDateTop(i.start,n)},isAxis:!1,date:n})):null}computeSegHStyle(e){let{isRtl:t,options:n}=this.context,i=n.slotEventOverlap,r=e.levelCoord,o=e.levelCoord+e.thickness,l,u;i&&(o=Math.min(1,r+(o-r)*2)),t?(l=1-o,u=r):(l=r,u=1-o);let h={zIndex:e.stackDepth+1,left:l*100+"%",right:u*100+"%"};return i&&!e.stackForward&&(h[t?"marginLeft":"marginRight"]=10*2),h}};function r4(s,{todayRange:e,nowDate:t,eventSelection:n,eventDrag:i,eventResize:r}){let o=(i?i.affectedInstances:null)||(r?r.affectedInstances:null)||{};return G(st,null,s.map(l=>{let u=l.eventRange.instance.instanceId;return G("div",{key:u,style:{visibility:o[u]?"hidden":""}},G(Fx,Object.assign({seg:l,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:u===n,isShort:!1},Bs(l,e,t))))}))}function ED(s){return s?{top:s.start,bottom:-s.end}:{top:"",bottom:""}}function X9(s,e){return s.map(t=>e[t.index])}var PD=class extends Ge{constructor(){super(...arguments),this.splitFgEventSegs=xe(by),this.splitBgEventSegs=xe(by),this.splitBusinessHourSegs=xe(by),this.splitNowIndicatorSegs=xe(by),this.splitDateSelectionSegs=xe(by),this.splitEventDrag=xe(e4),this.splitEventResize=xe(e4),this.rootElRef=Qt(),this.cellElRefs=new vs}render(){let{props:e,context:t}=this,n=t.options.nowIndicator&&e.slatCoords&&e.slatCoords.safeComputeTop(e.nowDate),i=e.cells.length,r=this.splitFgEventSegs(e.fgEventSegs,i),o=this.splitBgEventSegs(e.bgEventSegs,i),l=this.splitBusinessHourSegs(e.businessHourSegs,i),u=this.splitNowIndicatorSegs(e.nowIndicatorSegs,i),h=this.splitDateSelectionSegs(e.dateSelectionSegs,i),d=this.splitEventDrag(e.eventDrag,i),c=this.splitEventResize(e.eventResize,i);return G("div",{className:"fc-timegrid-cols",ref:this.rootElRef},G("table",{role:"presentation",style:{minWidth:e.tableMinWidth,width:e.clientWidth}},e.tableColGroupNode,G("tbody",{role:"presentation"},G("tr",{role:"row"},e.axis&&G("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},G("div",{className:"fc-timegrid-col-frame"},G("div",{className:"fc-timegrid-now-indicator-container"},typeof n=="number"&&G(fy,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:n},isAxis:!0,date:e.nowDate})))),e.cells.map((a,f)=>G(RD,{key:a.key,elRef:this.cellElRefs.createRef(a.key),dateProfile:e.dateProfile,date:a.date,nowDate:e.nowDate,todayRange:e.todayRange,extraRenderProps:a.extraRenderProps,extraDataAttrs:a.extraDataAttrs,extraClassNames:a.extraClassNames,extraDateSpan:a.extraDateSpan,fgEventSegs:r[f],bgEventSegs:o[f],businessHourSegs:l[f],nowIndicatorSegs:u[f],dateSelectionSegs:h[f],eventDrag:d[f],eventResize:c[f],slatCoords:e.slatCoords,eventSelection:e.eventSelection,forPrint:e.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:e}=this;e.onColCoords&&e.clientWidth!==null&&e.onColCoords(new Ri(this.rootElRef.current,J9(this.cellElRefs.currentMap,e.cells),!0,!1))}};function J9(s,e){return e.map(t=>s[t.key])}var MD=class extends Pn{constructor(){super(...arguments),this.processSlotOptions=xe(Z9),this.state={slatCoords:null},this.handleRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=e=>{let{onScrollTopRequest:t}=this.props,{slatCoords:n}=this.state;if(t&&n){if(e.time){let i=n.computeTimeTop(e.time);i=Math.ceil(i),i&&(i+=1),t(i)}return!0}return!1},this.handleColCoords=e=>{this.colCoords=e},this.handleSlatCoords=e=>{this.setState({slatCoords:e}),this.props.onSlatCoords&&this.props.onSlatCoords(e)}}render(){let{props:e,state:t}=this;return G("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:e.clientWidth,minWidth:e.tableMinWidth}},G(DD,{axis:e.axis,dateProfile:e.dateProfile,slatMetas:e.slatMetas,clientWidth:e.clientWidth,minHeight:e.expandRows?e.clientHeight:"",tableMinWidth:e.tableMinWidth,tableColGroupNode:e.axis?e.tableColGroupNode:null,onCoords:this.handleSlatCoords}),G(PD,{cells:e.cells,axis:e.axis,dateProfile:e.dateProfile,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange,nowDate:e.nowDate,nowIndicatorSegs:e.nowIndicatorSegs,clientWidth:e.clientWidth,tableMinWidth:e.tableMinWidth,tableColGroupNode:e.tableColGroupNode,slatCoords:t.slatCoords,onColCoords:this.handleColCoords,forPrint:e.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(e){this.scrollResponder.update(e.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(e,t){let{dateEnv:n,options:i}=this.context,{colCoords:r}=this,{dateProfile:o}=this.props,{slatCoords:l}=this.state,{snapDuration:u,snapsPerSlot:h}=this.processSlotOptions(this.props.slotDuration,i.snapDuration),d=r.leftToIndex(e),c=l.positions.topToIndex(t);if(d!=null&&c!=null){let a=this.props.cells[d],f=l.positions.tops[c],p=l.positions.getHeight(c),g=(t-f)/p,m=Math.floor(g*h),y=c*h+m,_=this.props.cells[d].date,x=ty(o.slotMinTime,SI(u,y)),E=n.add(_,x),S=n.add(E,u);return{dateProfile:o,dateSpan:Object.assign({range:{start:E,end:S},allDay:!1},a.extraDateSpan),dayEl:r.els[d],rect:{left:r.lefts[d],right:r.rights[d],top:f,bottom:f+p},layer:0}}return null}};function Z9(s,e){let t=e||s,n=ny(s,t);return n===null&&(t=s,n=1),{snapDuration:t,snapsPerSlot:n}}var ND=class extends Gc{sliceRange(e,t){let n=[];for(let i=0;i<t.length;i+=1){let r=$s(e,t[i]);r&&n.push({start:r.start,end:r.end,isStart:r.start.valueOf()===e.start.valueOf(),isEnd:r.end.valueOf()===e.end.valueOf(),col:i})}return n}},OD=class extends Pn{constructor(){super(...arguments),this.buildDayRanges=xe(Q9),this.slicer=new ND,this.timeColsRef=Qt()}render(){let{props:e,context:t}=this,{dateProfile:n,dayTableModel:i}=e,{nowIndicator:r,nextDayThreshold:o}=t.options,l=this.buildDayRanges(i,n,t.dateEnv);return G(bs,{unit:r?"minute":"day"},(u,h)=>G(MD,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(e,n,null,t,l),{forPrint:e.forPrint,axis:e.axis,dateProfile:n,slatMetas:e.slatMetas,slotDuration:e.slotDuration,cells:i.cells[0],tableColGroupNode:e.tableColGroupNode,tableMinWidth:e.tableMinWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight,expandRows:e.expandRows,nowDate:u,nowIndicatorSegs:r&&this.slicer.sliceNowDate(u,n,o,t,l),todayRange:h,onScrollTopRequest:e.onScrollTopRequest,onSlatCoords:e.onSlatCoords})))}};function Q9(s,e,t){let n=[];for(let i of s.headerDates)n.push({start:t.add(i,e.slotMinTime),end:t.add(i,e.slotMaxTime)});return n}var s4=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function eJ(s,e,t,n,i){let r=new Date(0),o=s,l=He(0),u=t||tJ(n),h=[];for(;Ls(o)<Ls(e);){let d=i.add(r,o),c=ny(l,u)!==null;h.push({date:d,time:o,key:d.toISOString(),isoTimeStr:II(d),isLabeled:c}),o=ty(o,n),l=ty(l,n)}return h}function tJ(s){let e,t,n;for(e=s4.length-1;e>=0;e-=1)if(t=He(s4[e]),n=ny(t,s),n!==null&&n>1)return t;return s}var Lx=class extends AD{constructor(){super(...arguments),this.buildTimeColsModel=xe(nJ),this.buildSlatMetas=xe(eJ)}render(){let{options:e,dateEnv:t,dateProfileGenerator:n}=this.context,{props:i}=this,{dateProfile:r}=i,o=this.buildTimeColsModel(r,n),l=this.allDaySplitter.splitProps(i),u=this.buildSlatMetas(r.slotMinTime,r.slotMaxTime,e.slotLabelInterval,e.slotDuration,t),{dayMinWidth:h}=e,d=!h,c=h,a=e.dayHeaders&&G(Vc,{dates:o.headerDates,dateProfile:r,datesRepDistinctDays:!0,renderIntro:d?this.renderHeadAxis:null}),f=e.allDaySlot!==!1&&(g=>G(yy,Object.assign({},l.allDay,{dateProfile:r,dayTableModel:o,nextDayThreshold:e.nextDayThreshold,tableMinWidth:g.tableMinWidth,colGroupNode:g.tableColGroupNode,renderRowIntro:d?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:g.clientWidth,clientHeight:g.clientHeight,forPrint:i.forPrint},this.getAllDayMaxEventProps()))),p=g=>G(OD,Object.assign({},l.timed,{dayTableModel:o,dateProfile:r,axis:d,slotDuration:e.slotDuration,slatMetas:u,forPrint:i.forPrint,tableColGroupNode:g.tableColGroupNode,tableMinWidth:g.tableMinWidth,clientWidth:g.clientWidth,clientHeight:g.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:g.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return c?this.renderHScrollLayout(a,f,p,o.colCnt,h,u,this.state.slatCoords):this.renderSimpleLayout(a,f,p)}};function nJ(s,e){let t=new zc(s.renderRange,e);return new Hc(t,!1)}var sJ='.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}';Ra(sJ);var iJ={allDaySlot:Boolean},o4=_s({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:iJ,views:{timeGrid:{component:Lx,usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});var LD=class extends Ge{constructor(){super(...arguments),this.state={textId:si()}}render(){let{theme:e,dateEnv:t,options:n,viewApi:i}=this.context,{cellId:r,dayDate:o,todayRange:l}=this.props,{textId:u}=this.state,h=ly(o,l),d=n.listDayFormat?t.format(o,n.listDayFormat):"",c=n.listDaySideFormat?t.format(o,n.listDaySideFormat):"",a=Object.assign({date:t.toDate(o),view:i,textId:u,text:d,sideText:c,navLinkAttrs:mr(this.context,o),sideNavLinkAttrs:mr(this.context,o,"day",!1)},h);return G(Ut,{elTag:"tr",elClasses:["fc-list-day",...Bh(h,e)],elAttrs:{"data-date":Pa(o)},renderProps:a,generatorName:"dayHeaderContent",customGenerator:n.dayHeaderContent,defaultGenerator:rJ,classNameGenerator:n.dayHeaderClassNames,didMount:n.dayHeaderDidMount,willUnmount:n.dayHeaderWillUnmount},f=>G("th",{scope:"colgroup",colSpan:3,id:r,"aria-labelledby":u},G(f,{elTag:"div",elClasses:["fc-list-day-cushion",e.getClass("tableCellShaded")]})))}};function rJ(s){return G(st,null,s.text&&G("a",Object.assign({id:s.textId,className:"fc-list-day-text"},s.navLinkAttrs),s.text),s.sideText&&G("a",Object.assign({"aria-hidden":!0,className:"fc-list-day-side-text"},s.sideNavLinkAttrs),s.sideText))}var oJ=dt({hour:"numeric",minute:"2-digit",meridiem:"short"}),$D=class extends Ge{render(){let{props:e,context:t}=this,{options:n}=t,{seg:i,timeHeaderId:r,eventHeaderId:o,dateHeaderId:l}=e,u=n.eventTimeFormat||oJ;return G(yo,Object.assign({},e,{elTag:"tr",elClasses:["fc-list-event",i.eventRange.def.url&&"fc-event-forced-url"],defaultGenerator:()=>aJ(i,t),seg:i,timeText:"",disableDragging:!0,disableResizing:!0}),(h,d)=>G(st,null,lJ(i,u,t,r,l),G("td",{"aria-hidden":!0,className:"fc-list-event-graphic"},G("span",{className:"fc-list-event-dot",style:{borderColor:d.borderColor||d.backgroundColor}})),G(h,{elTag:"td",elClasses:["fc-list-event-title"],elAttrs:{headers:`${o} ${l}`}})))}};function aJ(s,e){let t=$h(s,e);return G("a",Object.assign({},t),s.eventRange.def.title)}function lJ(s,e,t,n,i){let{options:r}=t;if(r.displayEventTime!==!1){let o=s.eventRange.def,l=s.eventRange.instance,u=!1,h;if(o.allDay?u=!0:LI(s.eventRange.range)?s.isStart?h=Oa(s,e,t,null,null,l.range.start,s.end):s.isEnd?h=Oa(s,e,t,null,null,s.start,l.range.end):u=!0:h=Oa(s,e,t),u){let d={text:t.options.allDayText,view:t.viewApi};return G(Ut,{elTag:"td",elClasses:["fc-list-event-time"],elAttrs:{headers:`${n} ${i}`},renderProps:d,generatorName:"allDayContent",customGenerator:r.allDayContent,defaultGenerator:cJ,classNameGenerator:r.allDayClassNames,didMount:r.allDayDidMount,willUnmount:r.allDayWillUnmount})}return G("td",{className:"fc-list-event-time"},h)}return null}function cJ(s){return s.text}var $x=class extends Pn{constructor(){super(...arguments),this.computeDateVars=xe(dJ),this.eventStoreToSegs=xe(this._eventStoreToSegs),this.state={timeHeaderId:si(),eventHeaderId:si(),dateHeaderIdRoot:si()},this.setRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e}):this.context.unregisterInteractiveComponent(this)}}render(){let{props:e,context:t}=this,{dayDates:n,dayRanges:i}=this.computeDateVars(e.dateProfile),r=this.eventStoreToSegs(e.eventStore,e.eventUiBases,i);return G(Di,{elRef:this.setRootEl,elClasses:["fc-list",t.theme.getClass("table"),t.options.stickyHeaderDates!==!1?"fc-list-sticky":""],viewSpec:t.viewSpec},G(Mh,{liquid:!e.isHeightAuto,overflowX:e.isHeightAuto?"visible":"hidden",overflowY:e.isHeightAuto?"visible":"auto"},r.length>0?this.renderSegList(r,n):this.renderEmptyMessage()))}renderEmptyMessage(){let{options:e,viewApi:t}=this.context,n={text:e.noEventsText,view:t};return G(Ut,{elTag:"div",elClasses:["fc-list-empty"],renderProps:n,generatorName:"noEventsContent",customGenerator:e.noEventsContent,defaultGenerator:uJ,classNameGenerator:e.noEventsClassNames,didMount:e.noEventsDidMount,willUnmount:e.noEventsWillUnmount},i=>G(i,{elTag:"div",elClasses:["fc-list-empty-cushion"]}))}renderSegList(e,t){let{theme:n,options:i}=this.context,{timeHeaderId:r,eventHeaderId:o,dateHeaderIdRoot:l}=this.state,u=hJ(e);return G(bs,{unit:"day"},(h,d)=>{let c=[];for(let a=0;a<u.length;a+=1){let f=u[a];if(f){let p=Pa(t[a]),g=l+"-"+p;c.push(G(LD,{key:p,cellId:g,dayDate:t[a],todayRange:d})),f=Yc(f,i.eventOrder);for(let m of f)c.push(G($D,Object.assign({key:p+":"+m.eventRange.instance.instanceId,seg:m,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,timeHeaderId:r,eventHeaderId:o,dateHeaderId:g},Bs(m,d,h))))}}return G("table",{className:"fc-list-table "+n.getClass("table")},G("thead",null,G("tr",null,G("th",{scope:"col",id:r},i.timeHint),G("th",{scope:"col","aria-hidden":!0}),G("th",{scope:"col",id:o},i.eventHint))),G("tbody",null,c))})}_eventStoreToSegs(e,t,n){return this.eventRangesToSegs(Ph(e,t,this.props.dateProfile.activeRange,this.context.options.nextDayThreshold).fg,n)}eventRangesToSegs(e,t){let n=[];for(let i of e)n.push(...this.eventRangeToSegs(i,t));return n}eventRangeToSegs(e,t){let{dateEnv:n}=this.context,{nextDayThreshold:i}=this.context.options,r=e.range,o=e.def.allDay,l,u,h,d=[];for(l=0;l<t.length;l+=1)if(u=$s(r,t[l]),u&&(h={component:this,eventRange:e,start:u.start,end:u.end,isStart:e.isStart&&u.start.valueOf()===r.start.valueOf(),isEnd:e.isEnd&&u.end.valueOf()===r.end.valueOf(),dayIndex:l},d.push(h),!h.isEnd&&!o&&l+1<t.length&&r.end<n.add(t[l+1].start,i))){h.end=r.end,h.isEnd=!0;break}return d}};function uJ(s){return s.text}function dJ(s){let e=ct(s.renderRange.start),t=s.renderRange.end,n=[],i=[];for(;e<t;)n.push(e),i.push({start:e,end:Dt(e,1)}),e=Dt(e,1);return{dayDates:n,dayRanges:i}}function hJ(s){let e=[],t,n;for(t=0;t<s.length;t+=1)n=s[t],(e[n.dayIndex]||(e[n.dayIndex]=[])).push(n);return e}var fJ=':root{--fc-list-event-dot-width:10px;--fc-list-event-hover-bg-color:#f5f5f5}.fc-theme-standard .fc-list{border:1px solid var(--fc-border-color)}.fc .fc-list-empty{align-items:center;background-color:var(--fc-neutral-bg-color);display:flex;height:100%;justify-content:center}.fc .fc-list-empty-cushion{margin:5em 0}.fc .fc-list-table{border-style:hidden;width:100%}.fc .fc-list-table tr>*{border-left:0;border-right:0}.fc .fc-list-sticky .fc-list-day>*{background:var(--fc-page-bg-color);position:sticky;top:0}.fc .fc-list-table thead{left:-10000px;position:absolute}.fc .fc-list-table tbody>tr:first-child th{border-top:0}.fc .fc-list-table th{padding:0}.fc .fc-list-day-cushion,.fc .fc-list-table td{padding:8px 14px}.fc .fc-list-day-cushion:after{clear:both;content:"";display:table}.fc-theme-standard .fc-list-day-cushion{background-color:var(--fc-neutral-bg-color)}.fc-direction-ltr .fc-list-day-text,.fc-direction-rtl .fc-list-day-side-text{float:left}.fc-direction-ltr .fc-list-day-side-text,.fc-direction-rtl .fc-list-day-text{float:right}.fc-direction-ltr .fc-list-table .fc-list-event-graphic{padding-right:0}.fc-direction-rtl .fc-list-table .fc-list-event-graphic{padding-left:0}.fc .fc-list-event.fc-event-forced-url{cursor:pointer}.fc .fc-list-event:hover td{background-color:var(--fc-list-event-hover-bg-color)}.fc .fc-list-event-graphic,.fc .fc-list-event-time{white-space:nowrap;width:1px}.fc .fc-list-event-dot{border:calc(var(--fc-list-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-list-event-dot-width)/2);box-sizing:content-box;display:inline-block;height:0;width:0}.fc .fc-list-event-title a{color:inherit;text-decoration:none}.fc .fc-list-event.fc-event-forced-url:hover a{text-decoration:underline}';Ra(fJ);var pJ={listDayFormat:a4,listDaySideFormat:a4,noEventsClassNames:Q,noEventsContent:Q,noEventsDidMount:Q,noEventsWillUnmount:Q};function a4(s){return s===!1?null:dt(s)}var l4=_s({name:"@fullcalendar/list",optionRefiners:pJ,views:{list:{component:$x,buttonTextKey:"list",listDayFormat:{month:"long",day:"numeric",year:"numeric"}},listDay:{type:"list",duration:{days:1},listDayFormat:{weekday:"long"}},listWeek:{type:"list",duration:{weeks:1},listDayFormat:{weekday:"long"},listDaySideFormat:{month:"long",day:"numeric",year:"numeric"}},listMonth:{type:"list",duration:{month:1},listDaySideFormat:{weekday:"long"}},listYear:{type:"list",duration:{year:1},listDaySideFormat:{weekday:"long"}}}});dy.touchMouseIgnoreWait=500;var UD=0,Ux=0,BD=!1,Bx=class{constructor(e){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=t=>{if(!this.shouldIgnoreMouse()&&gJ(t)&&this.tryStart(t)){let n=this.createEventFromMouse(t,!0);this.emitter.trigger("pointerdown",n),this.initScrollWatch(n),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=t=>{let n=this.createEventFromMouse(t);this.recordCoords(n),this.emitter.trigger("pointermove",n)},this.handleMouseUp=t=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(t)),this.cleanup()},this.handleTouchStart=t=>{if(this.tryStart(t)){this.isTouchDragging=!0;let n=this.createEventFromTouch(t,!0);this.emitter.trigger("pointerdown",n),this.initScrollWatch(n);let i=t.target;this.shouldIgnoreMove||i.addEventListener("touchmove",this.handleTouchMove),i.addEventListener("touchend",this.handleTouchEnd),i.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=t=>{let n=this.createEventFromTouch(t);this.recordCoords(n),this.emitter.trigger("pointermove",n)},this.handleTouchEnd=t=>{if(this.isDragging){let n=t.target;n.removeEventListener("touchmove",this.handleTouchMove),n.removeEventListener("touchend",this.handleTouchEnd),n.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(t)),this.cleanup(),this.isTouchDragging=!1,mJ()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=t=>{if(!this.shouldIgnoreMove){let n=window.scrollX-this.prevScrollX+this.prevPageX,i=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:t,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:n,pageY:i,deltaX:n-this.origPageX,deltaY:i-this.origPageY})}},this.containerEl=e,this.emitter=new mo,e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),yJ()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),bJ()}tryStart(e){let t=this.querySubjectEl(e),n=e.target;return t&&(!this.handleSelector||an(n,this.handleSelector))?(this.subjectEl=t,this.isDragging=!0,this.wasTouchScroll=!1,!0):!1}cleanup(){BD=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(e){return this.selector?an(e.target,this.selector):this.containerEl}shouldIgnoreMouse(){return UD||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(BD=!0)}initScrollWatch(e){this.shouldWatchScroll&&(this.recordCoords(e),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(e){this.shouldWatchScroll&&(this.prevPageX=e.pageX,this.prevPageY=e.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(e,t){let n=0,i=0;return t?(this.origPageX=e.pageX,this.origPageY=e.pageY):(n=e.pageX-this.origPageX,i=e.pageY-this.origPageY),{origEvent:e,isTouch:!1,subjectEl:this.subjectEl,pageX:e.pageX,pageY:e.pageY,deltaX:n,deltaY:i}}createEventFromTouch(e,t){let n=e.touches,i,r,o=0,l=0;return n&&n.length?(i=n[0].pageX,r=n[0].pageY):(i=e.pageX,r=e.pageY),t?(this.origPageX=i,this.origPageY=r):(o=i-this.origPageX,l=r-this.origPageY),{origEvent:e,isTouch:!0,subjectEl:this.subjectEl,pageX:i,pageY:r,deltaX:o,deltaY:l}}};function gJ(s){return s.button===0&&!s.ctrlKey}function mJ(){UD+=1,setTimeout(()=>{UD-=1},dy.touchMouseIgnoreWait)}function yJ(){Ux+=1,Ux===1&&window.addEventListener("touchmove",u4,{passive:!1})}function bJ(){Ux-=1,Ux||window.removeEventListener("touchmove",u4,{passive:!1})}function u4(s){BD&&s.preventDefault()}var VD=class{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(e,t,n){this.sourceEl=e,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=t-window.scrollX,this.origScreenY=n-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(e,t){this.deltaX=e-window.scrollX-this.origScreenX,this.deltaY=t-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(e){e?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=e,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=e)}stop(e,t){let n=()=>{this.cleanup(),t()};e&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(n,this.revertDuration):setTimeout(n,0)}doRevertAnimation(e,t){let n=this.mirrorEl,i=this.sourceEl.getBoundingClientRect();n.style.transition="top "+t+"ms,left "+t+"ms",qc(n,{left:i.left,top:i.top}),bI(n,()=>{n.style.transition="",e()})}cleanup(){this.mirrorEl&&(Jm(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&qc(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let e=this.sourceElRect,t=this.mirrorEl;return t||(t=this.mirrorEl=this.sourceEl.cloneNode(!0),t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.pointerEvents="none",t.classList.add("fc-event-dragging"),qc(t,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:e.right-e.left,height:e.bottom-e.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(t)),t}},Vx=class extends Uc{constructor(e,t){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=e,this.doesListening=t,this.scrollTop=this.origScrollTop=e.getScrollTop(),this.scrollLeft=this.origScrollLeft=e.getScrollLeft(),this.scrollWidth=e.getScrollWidth(),this.scrollHeight=e.getScrollHeight(),this.clientWidth=e.getClientWidth(),this.clientHeight=e.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(e){this.scrollController.setScrollTop(e),this.doesListening||(this.scrollTop=Math.max(Math.min(e,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(e){this.scrollController.setScrollLeft(e),this.doesListening||(this.scrollLeft=Math.max(Math.min(e,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}},zx=class extends Vx{constructor(e,t){super(new Wm(e),t)}getEventTarget(){return this.scrollController.el}computeClientRect(){return tD(this.scrollController.el)}},zD=class extends Vx{constructor(e){super(new qm,e)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}},c4=typeof performance=="function"?performance.now:Date.now,HD=class{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let e=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(e){let t=c4();this.handleSide(e,(t-this.msSinceRequest)/1e3),this.requestAnimation(t)}else this.isAnimating=!1}}}start(e,t,n){this.isEnabled&&(this.scrollCaches=this.buildCaches(n),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(e,t))}handleMove(e,t){if(this.isEnabled){let n=e-window.scrollX,i=t-window.scrollY,r=this.pointerScreenY===null?0:i-this.pointerScreenY,o=this.pointerScreenX===null?0:n-this.pointerScreenX;r<0?this.everMovedUp=!0:r>0&&(this.everMovedDown=!0),o<0?this.everMovedLeft=!0:o>0&&(this.everMovedRight=!0),this.pointerScreenX=n,this.pointerScreenY=i,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(c4()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let e of this.scrollCaches)e.destroy();this.scrollCaches=null}}requestAnimation(e){this.msSinceRequest=e,requestAnimationFrame(this.animate)}handleSide(e,t){let{scrollCache:n}=e,{edgeThreshold:i}=this,r=i-e.distance,o=r*r/(i*i)*this.maxVelocity*t,l=1;switch(e.name){case"left":l=-1;case"right":n.setScrollLeft(n.getScrollLeft()+o*l);break;case"top":l=-1;case"bottom":n.setScrollTop(n.getScrollTop()+o*l);break}}computeBestEdge(e,t){let{edgeThreshold:n}=this,i=null,r=this.scrollCaches||[];for(let o of r){let l=o.clientRect,u=e-l.left,h=l.right-e,d=t-l.top,c=l.bottom-t;u>=0&&h>=0&&d>=0&&c>=0&&(d<=n&&this.everMovedUp&&o.canScrollUp()&&(!i||i.distance>d)&&(i={scrollCache:o,name:"top",distance:d}),c<=n&&this.everMovedDown&&o.canScrollDown()&&(!i||i.distance>c)&&(i={scrollCache:o,name:"bottom",distance:c}),u<=n&&this.everMovedLeft&&o.canScrollLeft()&&(!i||i.distance>u)&&(i={scrollCache:o,name:"left",distance:u}),h<=n&&this.everMovedRight&&o.canScrollRight()&&(!i||i.distance>h)&&(i={scrollCache:o,name:"right",distance:h}))}return i}buildCaches(e){return this.queryScrollEls(e).map(t=>t===window?new zD(!1):new zx(t,!1))}queryScrollEls(e){let t=[];for(let n of this.scrollQuery)typeof n=="object"?t.push(n):t.push(...Array.prototype.slice.call(e.getRootNode().querySelectorAll(n)));return t}},Xc=class extends Xm{constructor(e,t){super(e),this.containerEl=e,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=i=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,vI(document.body),wI(document.body),i.isTouch||i.origEvent.preventDefault(),this.emitter.trigger("pointerdown",i),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(i.subjectEl,i.pageX,i.pageY),this.startDelay(i),this.minDistance||this.handleDistanceSurpassed(i)))},this.onPointerMove=i=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",i),!this.isDistanceSurpassed){let r=this.minDistance,o,{deltaX:l,deltaY:u}=i;o=l*l+u*u,o>=r*r&&this.handleDistanceSurpassed(i)}this.isDragging&&(i.origEvent.type!=="scroll"&&(this.mirror.handleMove(i.pageX,i.pageY),this.autoScroller.handleMove(i.pageX,i.pageY)),this.emitter.trigger("dragmove",i))}},this.onPointerUp=i=>{this.isInteracting&&(this.isInteracting=!1,_I(document.body),xI(document.body),this.emitter.trigger("pointerup",i),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(i)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let n=this.pointer=new Bx(e);n.emitter.on("pointerdown",this.onPointerDown),n.emitter.on("pointermove",this.onPointerMove),n.emitter.on("pointerup",this.onPointerUp),t&&(n.selector=t),this.mirror=new VD,this.autoScroller=new HD}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(e){typeof this.delay=="number"?this.delayTimeoutId=setTimeout(()=>{this.delayTimeoutId=null,this.handleDelayEnd(e)},this.delay):this.handleDelayEnd(e)}handleDelayEnd(e){this.isDelayEnded=!0,this.tryStartDrag(e)}handleDistanceSurpassed(e){this.isDistanceSurpassed=!0,this.tryStartDrag(e)}tryStartDrag(e){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(e.pageX,e.pageY,this.containerEl),this.emitter.trigger("dragstart",e),this.touchScrollAllowed===!1&&this.pointer.cancelTouchScroll())}tryStopDrag(e){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,e))}stopDrag(e){this.isDragging=!1,this.emitter.trigger("dragend",e)}setIgnoreMove(e){this.pointer.shouldIgnoreMove=e}setMirrorIsVisible(e){this.mirror.setIsVisible(e)}setMirrorNeedsRevert(e){this.mirrorNeedsRevert=e}setAutoScrollEnabled(e){this.autoScroller.isEnabled=e}},GD=class{constructor(e){this.el=e,this.origRect=cy(e),this.scrollCaches=Sx(e).map(t=>new zx(t,!0))}destroy(){for(let e of this.scrollCaches)e.destroy()}computeLeft(){let e=this.origRect.left;for(let t of this.scrollCaches)e+=t.origScrollLeft-t.getScrollLeft();return e}computeTop(){let e=this.origRect.top;for(let t of this.scrollCaches)e+=t.origScrollTop-t.getScrollTop();return e}isWithinClipping(e,t){let n={left:e,top:t};for(let i of this.scrollCaches)if(!vJ(i.getEventTarget())&&!JI(n,i.clientRect))return!1;return!0}};function vJ(s){let e=s.tagName;return e==="HTML"||e==="BODY"}var Gh=class{constructor(e,t){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=n=>{let{dragging:i}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(n),this.initialHit||!this.requireInitial?(i.setIgnoreMove(!1),this.emitter.trigger("pointerdown",n)):i.setIgnoreMove(!0)},this.handleDragStart=n=>{this.emitter.trigger("dragstart",n),this.handleMove(n,!0)},this.handleDragMove=n=>{this.emitter.trigger("dragmove",n),this.handleMove(n)},this.handlePointerUp=n=>{this.releaseHits(),this.emitter.trigger("pointerup",n)},this.handleDragEnd=n=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,n),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",n)},this.droppableStore=t,e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragstart",this.handleDragStart),e.emitter.on("dragmove",this.handleDragMove),e.emitter.on("pointerup",this.handlePointerUp),e.emitter.on("dragend",this.handleDragEnd),this.dragging=e,this.emitter=new mo}processFirstCoord(e){let t={left:e.pageX,top:e.pageY},n=t,i=e.subjectEl,r;i instanceof HTMLElement&&(r=cy(i),n=ZI(n,r));let o=this.initialHit=this.queryHitForOffset(n.left,n.top);if(o){if(this.useSubjectCenter&&r){let l=Ex(r,o.rect);l&&(n=QI(l))}this.coordAdjust=eD(n,t)}else this.coordAdjust={left:0,top:0}}handleMove(e,t){let n=this.queryHitForOffset(e.pageX+this.coordAdjust.left,e.pageY+this.coordAdjust.top);(t||!Hx(this.movingHit,n))&&(this.movingHit=n,this.emitter.trigger("hitupdate",n,!1,e))}prepareHits(){this.offsetTrackers=ni(this.droppableStore,e=>(e.component.prepareHits(),new GD(e.el)))}releaseHits(){let{offsetTrackers:e}=this;for(let t in e)e[t].destroy();this.offsetTrackers={}}queryHitForOffset(e,t){let{droppableStore:n,offsetTrackers:i}=this,r=null;for(let o in n){let l=n[o].component,u=i[o];if(u&&u.isWithinClipping(e,t)){let h=u.computeLeft(),d=u.computeTop(),c=e-h,a=t-d,{origRect:f}=u,p=f.right-f.left,g=f.bottom-f.top;if(c>=0&&c<p&&a>=0&&a<g){let m=l.queryHit(c,a,p,g);m&&Fh(m.dateProfile.activeRange,m.dateSpan.range)&&(this.disablePointCheck||u.el.contains(u.el.getRootNode().elementFromPoint(c+h-window.scrollX,a+d-window.scrollY)))&&(!r||m.layer>r.layer)&&(m.componentId=o,m.context=l.context,m.rect.left+=h,m.rect.right+=h,m.rect.top+=d,m.rect.bottom+=d,r=m)}}}return r}};function Hx(s,e){return!s&&!e?!0:!!s!=!!e?!1:WI(s.dateSpan,e.dateSpan)}function d4(s,e){let t={};for(let n of e.pluginHooks.datePointTransforms)Object.assign(t,n(s,e));return Object.assign(t,_J(s,e.dateEnv)),t}function _J(s,e){return{date:e.toDate(s.range.start),dateStr:e.formatIso(s.range.start,{omitTime:s.allDay}),allDay:s.allDay}}var jD=class extends ki{constructor(e){super(e),this.handlePointerDown=n=>{let{dragging:i}=this,r=n.origEvent.target;i.setIgnoreMove(!this.component.isValidDateDownEl(r))},this.handleDragEnd=n=>{let{component:i}=this,{pointer:r}=this.dragging;if(!r.wasTouchScroll){let{initialHit:o,finalHit:l}=this.hitDragging;if(o&&l&&Hx(o,l)){let{context:u}=i,h=Object.assign(Object.assign({},d4(o.dateSpan,u)),{dayEl:o.dayEl,jsEvent:n.origEvent,view:u.viewApi||u.calendarApi.view});u.emitter.trigger("dateClick",h)}}},this.dragging=new Xc(e.el),this.dragging.autoScroller.isEnabled=!1;let t=this.hitDragging=new Gh(this.dragging,ay(e));t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}},WD=class extends ki{constructor(e){super(e),this.dragSelection=null,this.handlePointerDown=o=>{let{component:l,dragging:u}=this,{options:h}=l.context,d=h.selectable&&l.isValidDateDownEl(o.origEvent.target);u.setIgnoreMove(!d),u.delay=o.isTouch?wJ(l):null},this.handleDragStart=o=>{this.component.context.calendarApi.unselect(o)},this.handleHitUpdate=(o,l)=>{let{context:u}=this.component,h=null,d=!1;if(o){let c=this.hitDragging.initialHit;o.componentId===c.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(c,o)||(h=xJ(c,o,u.pluginHooks.dateSelectionTransformers)),(!h||!sD(h,o.dateProfile,u))&&(d=!0,h=null)}h?u.dispatch({type:"SELECT_DATES",selection:h}):l||u.dispatch({type:"UNSELECT_DATES"}),d?Qm():ey(),l||(this.dragSelection=h)},this.handlePointerUp=o=>{this.dragSelection&&(xx(this.dragSelection,o,this.component.context),this.dragSelection=null)};let{component:t}=e,{options:n}=t.context,i=this.dragging=new Xc(e.el);i.touchScrollAllowed=!1,i.minDistance=n.selectMinDistance||0,i.autoScroller.isEnabled=n.dragScroll;let r=this.hitDragging=new Gh(this.dragging,ay(e));r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}};function wJ(s){let{options:e}=s.context,t=e.selectLongPressDelay;return t==null&&(t=e.longPressDelay),t}function xJ(s,e,t){let n=s.dateSpan,i=e.dateSpan,r=[n.range.start,n.range.end,i.range.start,i.range.end];r.sort(EI);let o={};for(let l of t){let u=l(s,e);if(u===!1)return null;u&&Object.assign(o,u)}return o.range={start:r[0],end:r[3]},o.allDay=n.allDay,o}var vy=class s extends ki{constructor(e){super(e),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=o=>{let l=o.origEvent.target,{component:u,dragging:h}=this,{mirror:d}=h,{options:c}=u.context,a=u.context;this.subjectEl=o.subjectEl;let f=this.subjectSeg=vo(o.subjectEl),g=(this.eventRange=f.eventRange).instance.instanceId;this.relevantEvents=iy(a.getCurrentData().eventStore,g),h.minDistance=o.isTouch?0:c.eventDragMinDistance,h.delay=o.isTouch&&g!==u.props.eventSelection?SJ(u):null,c.fixedMirrorParent?d.parentNode=c.fixedMirrorParent:d.parentNode=an(l,".fc"),d.revertDuration=c.dragRevertDuration;let m=u.isValidSegDownEl(l)&&!an(l,".fc-event-resizer");h.setIgnoreMove(!m),this.isDragging=m&&o.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=o=>{let l=this.component.context,u=this.eventRange,h=u.instance.instanceId;o.isTouch?h!==this.component.props.eventSelection&&l.dispatch({type:"SELECT_EVENT",eventInstanceId:h}):l.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(l.calendarApi.unselect(o),l.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new _t(l,u.def,u.instance),jsEvent:o.origEvent,view:l.viewApi}))},this.handleHitUpdate=(o,l)=>{if(!this.isDragging)return;let u=this.relevantEvents,h=this.hitDragging.initialHit,d=this.component.context,c=null,a=null,f=null,p=!1,g={affectedEvents:u,mutatedEvents:Wn(),isEvent:!0};if(o){c=o.context;let m=c.options;d===c||m.editable&&m.droppable?(a=EJ(h,o,this.eventRange.instance.range.start,c.getCurrentData().pluginHooks.eventDragMutationMassagers),a&&(f=ry(u,c.getCurrentData().eventUiBases,a,c),g.mutatedEvents=f,Tx(g,o.dateProfile,c)||(p=!0,a=null,f=null,g.mutatedEvents=Wn()))):c=null}this.displayDrag(c,g),p?Qm():ey(),l||(d===c&&Hx(h,o)&&(a=null),this.dragging.setMirrorNeedsRevert(!a),this.dragging.setMirrorIsVisible(!o||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=c,this.validMutation=a,this.mutatedRelevantEvents=f)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=o=>{if(this.isDragging){let l=this.component.context,u=l.viewApi,{receivingContext:h,validMutation:d}=this,c=this.eventRange.def,a=this.eventRange.instance,f=new _t(l,c,a),p=this.relevantEvents,g=this.mutatedRelevantEvents,{finalHit:m}=this.hitDragging;if(this.clearDrag(),l.emitter.trigger("eventDragStop",{el:this.subjectEl,event:f,jsEvent:o.origEvent,view:u}),d){if(h===l){let y=new _t(l,g.defs[c.defId],a?g.instances[a.instanceId]:null);l.dispatch({type:"MERGE_EVENTS",eventStore:g});let _={oldEvent:f,event:y,relatedEvents:gr(g,l,a),revert(){l.dispatch({type:"MERGE_EVENTS",eventStore:p})}},x={};for(let E of l.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(x,E(d,l));l.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},_),x),{el:o.subjectEl,delta:d.datesDelta,jsEvent:o.origEvent,view:u})),l.emitter.trigger("eventChange",_)}else if(h){let y={event:f,relatedEvents:gr(p,l,a),revert(){l.dispatch({type:"MERGE_EVENTS",eventStore:p})}};l.emitter.trigger("eventLeave",Object.assign(Object.assign({},y),{draggedEl:o.subjectEl,view:u})),l.dispatch({type:"REMOVE_EVENTS",eventStore:p}),l.emitter.trigger("eventRemove",y);let _=g.defs[c.defId],x=g.instances[a.instanceId],E=new _t(h,_,x);h.dispatch({type:"MERGE_EVENTS",eventStore:g});let S={event:E,relatedEvents:gr(g,h,x),revert(){h.dispatch({type:"REMOVE_EVENTS",eventStore:g})}};h.emitter.trigger("eventAdd",S),o.isTouch&&h.dispatch({type:"SELECT_EVENT",eventInstanceId:a.instanceId}),h.emitter.trigger("drop",Object.assign(Object.assign({},d4(m.dateSpan,h)),{draggedEl:o.subjectEl,jsEvent:o.origEvent,view:m.context.viewApi})),h.emitter.trigger("eventReceive",Object.assign(Object.assign({},S),{draggedEl:o.subjectEl,view:m.context.viewApi}))}}else l.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:t}=this,{options:n}=t.context,i=this.dragging=new Xc(e.el);i.pointer.selector=s.SELECTOR,i.touchScrollAllowed=!1,i.autoScroller.isEnabled=n.dragScroll;let r=this.hitDragging=new Gh(this.dragging,Uh);r.useSubjectCenter=e.useEventCenter,r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("pointerup",this.handlePointerUp),r.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(e,t){let n=this.component.context,i=this.receivingContext;i&&i!==e&&(i===n?i.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:t.affectedEvents,mutatedEvents:Wn(),isEvent:!0}}):i.dispatch({type:"UNSET_EVENT_DRAG"})),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){let e=this.component.context,{receivingContext:t}=this;t&&t.dispatch({type:"UNSET_EVENT_DRAG"}),e!==t&&e.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}};vy.SELECTOR=".fc-event-draggable, .fc-event-resizable";function EJ(s,e,t,n){let i=s.dateSpan,r=e.dateSpan,o=i.range.start,l=r.range.start,u={};i.allDay!==r.allDay&&(u.allDay=r.allDay,u.hasEnd=e.context.options.allDayMaintainDuration,r.allDay?o=ct(t):o=t);let h=Ca(o,l,s.context.dateEnv,s.componentId===e.componentId?s.largeUnit:null);h.milliseconds&&(u.allDay=!1);let d={datesDelta:h,standardProps:u};for(let c of n)c(d,s,e);return d}function SJ(s){let{options:e}=s.context,t=e.eventLongPressDelay;return t==null&&(t=e.longPressDelay),t}var qD=class extends ki{constructor(e){super(e),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=r=>{let{component:o}=this,l=this.querySegEl(r),u=vo(l),h=this.eventRange=u.eventRange;this.dragging.minDistance=o.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(r.origEvent.target)||r.isTouch&&this.component.props.eventSelection!==h.instance.instanceId)},this.handleDragStart=r=>{let{context:o}=this.component,l=this.eventRange;this.relevantEvents=iy(o.getCurrentData().eventStore,this.eventRange.instance.instanceId);let u=this.querySegEl(r);this.draggingSegEl=u,this.draggingSeg=vo(u),o.calendarApi.unselect(),o.emitter.trigger("eventResizeStart",{el:u,event:new _t(o,l.def,l.instance),jsEvent:r.origEvent,view:o.viewApi})},this.handleHitUpdate=(r,o,l)=>{let{context:u}=this.component,h=this.relevantEvents,d=this.hitDragging.initialHit,c=this.eventRange.instance,a=null,f=null,p=!1,g={affectedEvents:h,mutatedEvents:Wn(),isEvent:!0};r&&(r.componentId===d.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(d,r)||(a=TJ(d,r,l.subjectEl.classList.contains("fc-event-resizer-start"),c.range))),a&&(f=ry(h,u.getCurrentData().eventUiBases,a,u),g.mutatedEvents=f,Tx(g,r.dateProfile,u)||(p=!0,a=null,f=null,g.mutatedEvents=null)),f?u.dispatch({type:"SET_EVENT_RESIZE",state:g}):u.dispatch({type:"UNSET_EVENT_RESIZE"}),p?Qm():ey(),o||(a&&Hx(d,r)&&(a=null),this.validMutation=a,this.mutatedRelevantEvents=f)},this.handleDragEnd=r=>{let{context:o}=this.component,l=this.eventRange.def,u=this.eventRange.instance,h=new _t(o,l,u),d=this.relevantEvents,c=this.mutatedRelevantEvents;if(o.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:h,jsEvent:r.origEvent,view:o.viewApi}),this.validMutation){let a=new _t(o,c.defs[l.defId],u?c.instances[u.instanceId]:null);o.dispatch({type:"MERGE_EVENTS",eventStore:c});let f={oldEvent:h,event:a,relatedEvents:gr(c,o,u),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:d})}};o.emitter.trigger("eventResize",Object.assign(Object.assign({},f),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||He(0),endDelta:this.validMutation.endDelta||He(0),jsEvent:r.origEvent,view:o.viewApi})),o.emitter.trigger("eventChange",f)}else o.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:t}=e,n=this.dragging=new Xc(e.el);n.pointer.selector=".fc-event-resizer",n.touchScrollAllowed=!1,n.autoScroller.isEnabled=t.context.options.dragScroll;let i=this.hitDragging=new Gh(this.dragging,ay(e));i.emitter.on("pointerdown",this.handlePointerDown),i.emitter.on("dragstart",this.handleDragStart),i.emitter.on("hitupdate",this.handleHitUpdate),i.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(e){return an(e.subjectEl,".fc-event")}};function TJ(s,e,t,n){let i=s.context.dateEnv,r=s.dateSpan.range.start,o=e.dateSpan.range.start,l=Ca(r,o,i,s.largeUnit);if(t){if(i.add(n.start,l)<n.end)return{startDelta:l}}else if(i.add(n.end,l)>n.start)return{endDelta:l};return null}var YD=class{constructor(e){this.context=e,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=n=>{n.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=n=>{let i=this.context.options.unselectCancel,r=ux(n.origEvent);this.matchesCancel=!!an(r,i),this.matchesEvent=!!an(r,vy.SELECTOR)},this.onDocumentPointerUp=n=>{let{context:i}=this,{documentPointer:r}=this,o=i.getCurrentData();if(!r.wasTouchScroll){if(o.dateSelection&&!this.isRecentPointerDateSelect){let l=i.options.unselectAuto;l&&(!l||!this.matchesCancel)&&i.calendarApi.unselect(n)}o.eventSelection&&!this.matchesEvent&&i.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let t=this.documentPointer=new Bx(document);t.shouldIgnoreMove=!0,t.shouldWatchScroll=!1,t.emitter.on("pointerdown",this.onDocumentPointerDown),t.emitter.on("pointerup",this.onDocumentPointerUp),e.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}},AJ={fixedMirrorParent:Q},CJ={dateClick:Q,eventDragStart:Q,eventDragStop:Q,eventDrop:Q,eventResizeStart:Q,eventResizeStop:Q,eventResize:Q,drop:Q,eventReceive:Q,eventLeave:Q};dy.dataAttrPrefix="";var h4=_s({name:"@fullcalendar/interaction",componentInteractions:[jD,WD,vy,qD],calendarInteractions:[YD],elementDraggingImpl:Xc,optionRefiners:AJ,listenerRefiners:CJ});var _y=require("obsidian");var Jc=class extends _y.Modal{constructor(t,n,i,r){super(t);this.saveCallback=null;this.event=n,this.dataProvider=i,this.settings=r}onSave(t){this.saveCallback=t}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-event-modal");let n={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"},i={note:"\uB178\uD2B8",schedule:"\uC77C\uC815",meeting:"\uD68C\uC758\uB85D"},r=t.createDiv({cls:"event-modal-header"});r.style.display="flex",r.style.alignItems="center",r.style.gap="12px",r.style.marginBottom="16px";let o=r.createEl("span",{text:`${n[this.event.type]} ${i[this.event.type]}`});o.style.padding="4px 8px",o.style.backgroundColor=this.event.color||"var(--interactive-accent)",o.style.color="var(--text-on-accent)",o.style.borderRadius="4px",o.style.fontSize="12px",r.createEl("h2",{text:this.event.title}).style.margin="0";let l=t.createDiv({cls:"event-details"});l.style.padding="16px",l.style.backgroundColor="var(--background-secondary)",l.style.borderRadius="8px",l.style.marginBottom="16px";let u=l.createDiv({cls:"detail-row"});u.style.display="flex",u.style.alignItems="center",u.style.gap="8px",u.style.marginBottom="8px",u.createEl("span",{text:"\u{1F4C5}"});let h=nn(this.event.start,this.settings.timezone),d="";if(this.event.allDay)d=" (\uC885\uC77C)";else{let y=this.event.start.getHours().toString().padStart(2,"0"),_=this.event.start.getMinutes().toString().padStart(2,"0");d=` ${y}:${_}`}if(u.createEl("span",{text:h+d}),this.event.metadata?.project){let y=l.createDiv({cls:"detail-row"});y.style.display="flex",y.style.alignItems="center",y.style.gap="8px",y.style.marginBottom="8px",y.createEl("span",{text:"\u{1F4C1}"}),y.createEl("span",{text:this.event.metadata.project})}if(this.event.metadata?.tags&&this.event.metadata.tags.length>0){let y=l.createDiv({cls:"detail-row"});y.style.display="flex",y.style.alignItems="center",y.style.gap="8px",y.style.marginBottom="8px",y.createEl("span",{text:"\u{1F3F7}"});let _=y.createDiv({cls:"tags"});_.style.display="flex",_.style.gap="4px",_.style.flexWrap="wrap";for(let x of this.event.metadata.tags){let E=_.createEl("span",{text:`#${x}`});E.style.padding="2px 6px",E.style.backgroundColor="var(--background-modifier-border)",E.style.borderRadius="4px",E.style.fontSize="12px"}}if(this.event.metadata?.summary){let y=l.createDiv({cls:"detail-row"});y.style.marginTop="12px",y.style.paddingTop="12px",y.style.borderTop="1px solid var(--background-modifier-border)",y.createEl("div",{text:"\uC694\uC57D"}).style.fontWeight="500",y.createEl("p",{text:this.event.metadata.summary}).style.margin="4px 0 0 0"}let c=l.createDiv({cls:"detail-row"});c.style.marginTop="12px",c.style.fontSize="12px",c.style.color="var(--text-muted)",c.setText(`\uD30C\uC77C: ${this.event.source.path}`),this.event.source.lineNumber&&c.appendText(` (\uB77C\uC778 ${this.event.source.lineNumber})`);let a=t.createDiv({cls:"modal-button-container"});a.style.display="flex",a.style.justifyContent="space-between",a.style.marginTop="16px";let f=a.createDiv();if(this.event.type==="schedule"&&this.event.source.lineNumber){let y=f.createEl("button",{text:"\uC0AD\uC81C"});y.style.color="var(--text-error)",y.addEventListener("click",async()=>{confirm("\uC774 \uC77C\uC815\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")&&(await this.dataProvider.deleteEvent(this.event.id)?(new _y.Notice("\uC77C\uC815\uC774 \uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),this.saveCallback&&this.saveCallback(),this.close()):new _y.Notice("\uC77C\uC815 \uC0AD\uC81C\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4."))})}let p=a.createDiv();p.style.display="flex",p.style.gap="8px",p.createEl("button",{text:"\uD30C\uC77C \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",async()=>{await this.dataProvider.openEvent(this.event.id),this.close()}),p.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}};var Fa="zfb-calendar",wy=class extends f4.ItemView{constructor(t,n,i){super(t);this.calendar=null;this.refreshTimeout=null;this.isRefreshing=!1;this.resizeObserver=null;this.settings=n,this.dataProvider=i,this.refreshCallback=()=>this.debouncedRefresh()}debouncedRefresh(){this.isRefreshing||(this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(async()=>{await this.refreshEvents()},1e3))}getViewType(){return Fa}getDisplayText(){return"Zero Friction \uCE98\uB9B0\uB354"}getIcon(){return"calendar"}async onOpen(){this.dataProvider.addChangeListener(this.refreshCallback);let t=this.contentEl;t.empty(),t.addClass("zfb-full-calendar");let n=t.createDiv({cls:"calendar-container"});n.style.height="100%",n.style.padding="16px",this.calendar=new my(n,this.getCalendarOptions()),this.calendar.render(),this.resizeObserver=new ResizeObserver(()=>{this.calendar&&this.calendar.updateSize()}),this.resizeObserver.observe(t)}getCalendarOptions(){return{plugins:[Qz,o4,l4,h4],initialView:this.getInitialView(),locale:"ko",firstDay:this.settings.calendarFirstDayOfWeek,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},buttonText:{today:"\uC624\uB298",month:"\uC6D4",week:"\uC8FC",day:"\uC77C",list:"\uBAA9\uB85D"},events:async(t,n)=>{let i=await this.loadEvents();n(i)},editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,moreLinkClick:t=>{let n=t.date.toISOString().split("T")[0];return new lr(this.app,n,this.dataProvider,this.settings).open(),"none"},eventOrder:(t,n)=>{let i={schedule:0,note:1,meeting:2},r=t.extendedProps?.type||"note",o=n.extendedProps?.type||"note";return(i[r]??2)-(i[o]??2)},eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},eventClick:t=>{this.handleEventClick(t)},eventDrop:async t=>{await this.handleEventDrop(t)},select:t=>{this.handleDateSelect(t)},eventDidMount:t=>{let n=t.event,i=n.extendedProps;if(i?.project&&(t.el.title=`${n.title}
\uD504\uB85C\uC81D\uD2B8: ${i.project}`),t.el.classList.contains("fc-daygrid-dot-event")){let r=n.backgroundColor||"var(--text-success)";t.el.style.backgroundColor=r}}}}async onClose(){this.refreshTimeout&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.dataProvider.removeChangeListener(this.refreshCallback),this.calendar&&(this.calendar.destroy(),this.calendar=null),this.contentEl.empty()}updateSettings(t){this.settings=t,this.calendar&&this.calendar.setOption("firstDay",t.calendarFirstDayOfWeek)}async refreshEvents(){if(!(!this.calendar||this.isRefreshing)){this.isRefreshing=!0;try{let t=this.calendar.view.type,n=this.calendar.getDate(),i=this.contentEl.querySelector(".calendar-container");if(!i)return;this.calendar.destroy(),this.calendar=new my(i,this.getCalendarOptions()),this.calendar.render(),this.calendar.changeView(t,n)}finally{this.isRefreshing=!1}}}getInitialView(){switch(this.settings.calendarDefaultView){case"month":return"dayGridMonth";case"week":return"timeGridWeek";case"day":return"timeGridDay";case"list":return"listWeek";default:return"dayGridMonth"}}async loadEvents(){let t=new Date,n=new Date(t.getFullYear(),t.getMonth()-3,1),i=new Date(t.getFullYear(),t.getMonth()+3,0);return(await this.dataProvider.getEventsForRange(n,i)).map(o=>this.convertToFullCalendarEvent(o))}convertToFullCalendarEvent(t){return{id:t.id,title:t.title,start:t.start,end:t.end,allDay:t.allDay,backgroundColor:t.color,borderColor:t.color,extendedProps:{type:t.type,source:t.source,...t.metadata}}}handleEventClick(t){let n=t.event.id,i=t.event.extendedProps,r={id:n,title:t.event.title,start:t.event.start,end:t.event.end||void 0,allDay:t.event.allDay,type:i.type,color:t.event.backgroundColor||void 0,source:i.source,metadata:{project:i.project,tags:i.tags,summary:i.summary}},o=new Jc(this.app,r,this.dataProvider,this.settings);o.onSave(async()=>{await this.refreshEvents()}),o.open()}async handleEventDrop(t){let n=t.event.id,i=t.event.start;await this.dataProvider.moveEvent(n,i)||t.revert()}handleDateSelect(t){this.calendar?.unselect();let n=t.startStr.split("T")[0];new lr(this.app,n,this.dataProvider,this.settings).open()}};var Gx=require("obsidian");var IJ="zfb-calendar",xy=class extends Gx.ItemView{constructor(t,n,i){super(t);this.currentView="month";this.currentDate=new Date;this.refreshTimeout=null;this.isRefreshing=!1;this.dragState={isDragging:!1,event:null,ghostEl:null,startX:0,startY:0,targetDate:null};this.DRAG_THRESHOLD=5;this.LONG_PRESS_DELAY=500;this.settings=n,this.dataProvider=i,this.currentView=n.calendarDefaultView,this.refreshCallback=()=>this.debouncedRefresh()}getViewType(){return IJ}getDisplayText(){return"Zero Friction \uCE98\uB9B0\uB354"}getIcon(){return"calendar"}async onOpen(){this.dataProvider.addChangeListener(this.refreshCallback),await this.render()}async onClose(){this.refreshTimeout&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=null),this.dataProvider.removeChangeListener(this.refreshCallback),this.contentEl.empty()}updateSettings(t){this.settings=t}debouncedRefresh(){this.isRefreshing||(this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(async()=>{await this.render()},1e3))}async render(){if(!this.isRefreshing){this.isRefreshing=!0;try{let t=this.contentEl;t.empty(),t.addClass("zfb-native-calendar"),this.renderToolbar(t);let n=t.createDiv({cls:"zfb-native-calendar-content"});switch(this.currentView){case"month":await this.renderMonthView(n);break;case"list":await this.renderListView(n);break;case"week":await this.renderWeekView(n);break;case"day":await this.renderDayView(n);break}}finally{this.isRefreshing=!1}}}renderToolbar(t){let n=t.createDiv({cls:"zfb-native-calendar-toolbar"}),i=n.createDiv({cls:"toolbar-nav"}),r=i.createEl("button",{cls:"nav-btn"});r.innerHTML="&#9664;",r.addEventListener("click",()=>this.navigate(-1)),i.createEl("span",{cls:"toolbar-title"}).setText(this.formatTitle());let l=i.createEl("button",{cls:"nav-btn"});l.innerHTML="&#9654;",l.addEventListener("click",()=>this.navigate(1));let u=n.createDiv({cls:"toolbar-actions"});u.createEl("button",{text:"\uC624\uB298",cls:"today-btn"}).addEventListener("click",()=>this.goToToday());let d=u.createEl("select",{cls:"view-select"}),c=[{value:"month",label:"\uC6D4"},{value:"week",label:"\uC8FC"},{value:"day",label:"\uC77C"},{value:"list",label:"\uBAA9\uB85D"}];for(let a of c){let f=d.createEl("option",{value:a.value,text:a.label});a.value===this.currentView&&(f.selected=!0)}d.addEventListener("change",()=>{this.changeView(d.value)})}formatTitle(){let t=this.currentDate.getFullYear(),n=this.currentDate.getMonth()+1;switch(this.currentView){case"month":return`${t}\uB144 ${n}\uC6D4`;case"week":case"list":let{weekStart:i,weekEnd:r}=this.getWeekRange(),o=i.getMonth()+1,l=i.getDate(),u=r.getMonth()+1,h=r.getDate();return o===u?`${o}/${l} - ${h}`:`${o}/${l} - ${u}/${h}`;case"day":let d=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"],c=this.currentDate.getDate(),a=d[this.currentDate.getDay()];return`${t}\uB144 ${n}\uC6D4 ${c}\uC77C (${a})`;default:return`${t}\uB144 ${n}\uC6D4`}}navigate(t){switch(this.currentView){case"month":this.currentDate.setMonth(this.currentDate.getMonth()+t);break;case"week":case"list":this.currentDate.setDate(this.currentDate.getDate()+t*7);break;case"day":this.currentDate.setDate(this.currentDate.getDate()+t);break}this.render()}goToToday(){this.currentDate=new Date,this.render()}changeView(t){this.currentView=t,this.render()}getWeekRange(){let t=new Date(this.currentDate),n=this.settings.calendarFirstDayOfWeek,r=(t.getDay()-n+7)%7,o=new Date(t);o.setDate(t.getDate()-r),o.setHours(0,0,0,0);let l=new Date(o);return l.setDate(o.getDate()+6),l.setHours(23,59,59,999),{weekStart:o,weekEnd:l}}async renderMonthView(t){let n=t.createDiv({cls:"zfb-native-calendar-month-grid"}),i=n.createDiv({cls:"weekday-header"}),r=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"],o=this.settings.calendarFirstDayOfWeek;for(let h=0;h<7;h++){let d=(o+h)%7,c=i.createDiv({cls:"day-name"});c.setText(r[d]),d===0&&c.addClass("sunday"),d===6&&c.addClass("saturday")}let l=await this.getMonthCells(),u=n.createDiv({cls:"date-grid"});for(let h of l){let d=u.createDiv({cls:"date-cell"});d.dataset.date=h.date,h.isCurrentMonth||d.addClass("other-month"),h.isToday&&d.addClass("today"),h.isWeekend&&d.addClass("weekend");let c=d.createDiv({cls:"day-number"});c.setText(String(h.day)),c.addEventListener("click",m=>{m.stopPropagation(),this.openDayModal(h.date)});let a=d.createDiv({cls:"events-container"}),f=3,g=this.sortEventsByType(h.events).slice(0,f);for(let m of g){let y=a.createDiv({cls:"event-item"});y.style.backgroundColor=m.color||"var(--interactive-accent)";let _={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"};y.createSpan({cls:"event-icon"}).setText(_[m.type]||"\u{1F4C4}"),y.createSpan({cls:"event-title"}).setText(m.title),y.title=m.title,y.addEventListener("click",S=>{S.stopPropagation(),this.openEventModal(m)}),this.setupDragAndDrop(y,m)}if(h.events.length>f){let m=h.events.length-f,y=a.createDiv({cls:"more-events"});y.setText(`+${m} more`),y.addEventListener("click",_=>{_.stopPropagation(),this.openDayModal(h.date)})}}}async getMonthCells(){let t=this.currentDate.getFullYear(),n=this.currentDate.getMonth(),i=this.settings.calendarFirstDayOfWeek,l=(new Date(t,n,1).getDay()-i+7)%7,u=new Date(t,n,1-l),h=[],d=new Date,c=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`,a=new Date(u.getTime()+42*24*60*60*1e3),f=await this.dataProvider.getEventsForRange(u,a),p=new Map;for(let g of f){let m=this.formatDateStr(g.start);p.has(m)||p.set(m,[]),p.get(m).push(g)}for(let g=0;g<42;g++){let m=new Date(u.getTime()+g*24*60*60*1e3),y=this.formatDateStr(m),_=m.getDay();h.push({date:y,day:m.getDate(),isCurrentMonth:m.getMonth()===n,isToday:y===c,isWeekend:_===0||_===6,events:p.get(y)||[]})}return h}async renderListView(t){let n=t.createDiv({cls:"zfb-native-calendar-list"}),{weekStart:i,weekEnd:r}=this.getWeekRange(),o=await this.dataProvider.getEventsForRange(i,r),l=this.groupEventsByDate(o),u=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"],h=new Date(i);for(let d=0;d<7;d++){let c=this.formatDateStr(h),a=l.get(c)||[],f=h.getDay(),p=u[f],g=n.createDiv({cls:"list-date-group"}),m=g.createDiv({cls:"list-date-header"}),y=m.createSpan({cls:"toggle-icon"});y.setText(a.length>0?"\u25BC":"\u25B6"),m.createSpan({cls:"date-text"}).setText(`${c} (${p}\uC694\uC77C)`),a.length===0&&(m.addClass("empty"),m.createSpan({cls:"empty-label",text:"\uD56D\uBAA9 \uC5C6\uC74C"}));let x=g.createDiv({cls:"list-events"});a.length===0&&(x.style.display="none");let E=this.sortEventsByType(a);for(let S of E){let T=x.createDiv({cls:"list-event-item"}),C={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"};if(T.createSpan({cls:"event-icon",text:C[S.type]||"\u{1F4C4}"}),S.type==="schedule"&&!S.allDay){let A=S.start.getHours().toString().padStart(2,"0"),P=S.start.getMinutes().toString().padStart(2,"0");T.createSpan({cls:"event-time",text:`${A}:${P}`})}T.createSpan({cls:"event-title",text:S.title}),S.metadata?.project&&T.createSpan({cls:"event-project",text:`[${S.metadata.project}]`});let I=T.createDiv({cls:"event-indicator"});I.style.backgroundColor=S.color||"var(--interactive-accent)",T.addEventListener("click",async()=>{await this.dataProvider.openEvent(S.id)})}m.addEventListener("click",()=>{let S=x.style.display==="none";x.style.display=S?"block":"none",y.setText(S?"\u25BC":"\u25B6")}),h.setDate(h.getDate()+1)}}async renderWeekView(t){let n=t.createDiv({cls:"zfb-native-calendar-week-grid"}),{weekStart:i,weekEnd:r}=this.getWeekRange(),o=await this.dataProvider.getEventsForRange(i,r),l=o.filter(g=>g.allDay),u=o.filter(g=>!g.allDay),h=this.groupEventsByDate(u),d=n.createDiv({cls:"week-header-row"});d.createDiv({cls:"time-column-header"});let c=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"],a=this.formatDateStr(new Date),f=new Date(i);for(let g=0;g<7;g++){let m=this.formatDateStr(f),y=d.createDiv({cls:"day-header"});m===a&&y.addClass("today"),y.createDiv({cls:"day-name",text:c[f.getDay()]}),y.createDiv({cls:"day-number",text:String(f.getDate())}),f.setDate(f.getDate()+1)}if(l.length>0){let g=n.createDiv({cls:"zfb-native-calendar-all-day-row"});g.createDiv({cls:"all-day-label",text:"\uC885\uC77C"}),f.setTime(i.getTime());for(let m=0;m<7;m++){let y=this.formatDateStr(f),_=l.filter(E=>this.formatDateStr(E.start)===y),x=g.createDiv({cls:"all-day-cell"});for(let E of _){let S=x.createDiv({cls:"all-day-event"});S.style.backgroundColor=E.color||"var(--interactive-accent)",S.setText(E.title),S.title=E.title,S.addEventListener("click",()=>this.openEventModal(E))}f.setDate(f.getDate()+1)}}let p=n.createDiv({cls:"time-grid"});for(let g=0;g<24;g++){let m=p.createDiv({cls:"hour-row"});m.createDiv({cls:"time-label",text:`${g.toString().padStart(2,"0")}:00`}),f.setTime(i.getTime());for(let y=0;y<7;y++){let _=this.formatDateStr(f),x=m.createDiv({cls:"zfb-native-calendar-time-slot"});x.dataset.date=_,x.dataset.hour=String(g);let S=(h.get(_)||[]).filter(T=>T.start.getHours()===g);for(let T of S)this.renderTimedEvent(x,T);f.setDate(f.getDate()+1)}}}async renderDayView(t){let n=t.createDiv({cls:"zfb-native-calendar-day-grid"}),i=this.formatDateStr(this.currentDate),r=new Date(this.currentDate);r.setHours(0,0,0,0);let o=new Date(this.currentDate);o.setHours(23,59,59,999);let l=await this.dataProvider.getEventsForRange(r,o),u=l.filter(c=>c.allDay),h=l.filter(c=>!c.allDay);if(u.length>0){let c=n.createDiv({cls:"zfb-native-calendar-all-day-row"});c.createDiv({cls:"all-day-label",text:"\uC885\uC77C"});let a=c.createDiv({cls:"all-day-content"});for(let f of u){let p=a.createDiv({cls:"all-day-event"});p.style.backgroundColor=f.color||"var(--interactive-accent)",p.setText(f.title),p.addEventListener("click",()=>this.openEventModal(f))}}let d=n.createDiv({cls:"time-grid day-view"});for(let c=0;c<24;c++){let a=d.createDiv({cls:"hour-row"});a.createDiv({cls:"time-label",text:`${c.toString().padStart(2,"0")}:00`});let f=a.createDiv({cls:"zfb-native-calendar-time-slot"});f.dataset.date=i,f.dataset.hour=String(c);let p=h.filter(g=>g.start.getHours()===c);for(let g of p)this.renderTimedEvent(f,g)}}renderTimedEvent(t,n){let i=t.createDiv({cls:"timed-event"}),o=n.start.getMinutes()/60*48;i.style.top=`${o}px`;let d=((n.end||new Date(n.start.getTime()+60*60*1e3)).getTime()-n.start.getTime())/(60*60*1e3)*48;i.style.height=`${Math.max(d,24)}px`,i.style.backgroundColor=n.color||"var(--interactive-accent)";let c={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"};i.createSpan({cls:"event-icon",text:c[n.type]||"\u{1F4C4}"}),i.createSpan({cls:"event-title",text:n.title}),i.title=n.title;let a=n.start.getHours().toString().padStart(2,"0"),f=n.start.getMinutes().toString().padStart(2,"0");return i.createDiv({cls:"event-time",text:`${a}:${f}`}),i.addEventListener("click",p=>{p.stopPropagation(),this.openEventModal(n)}),this.setupDragAndDrop(i,n),i}setupDragAndDrop(t,n){let i=null,r=!1,o=(h,d)=>{this.dragState.startX=h,this.dragState.startY=d,this.dragState.event=n,r=!1},l=(h,d)=>{if(!this.dragState.event)return;let c=Math.abs(h-this.dragState.startX),a=Math.abs(d-this.dragState.startY);!r&&(c>this.DRAG_THRESHOLD||a>this.DRAG_THRESHOLD)&&(r=!0,this.dragState.isDragging=!0,this.createGhostElement(n,h,d),t.addClass("zfb-native-calendar-event--dragging")),this.dragState.isDragging&&this.dragState.ghostEl&&(this.dragState.ghostEl.style.left=`${h+10}px`,this.dragState.ghostEl.style.top=`${d+10}px`,this.updateDropTarget(h,d))},u=async()=>{i&&(clearTimeout(i),i=null),this.dragState.isDragging&&this.dragState.targetDate&&await this.dataProvider.moveEvent(this.dragState.event.id,new Date(this.dragState.targetDate))&&(new Gx.Notice("\uC774\uBCA4\uD2B8\uAC00 \uC774\uB3D9\uB418\uC5C8\uC2B5\uB2C8\uB2E4"),await this.render()),this.cleanupDrag(t)};t.addEventListener("mousedown",h=>{if(h.button!==0)return;h.preventDefault(),o(h.clientX,h.clientY);let d=a=>l(a.clientX,a.clientY),c=async()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",c),await u()};document.addEventListener("mousemove",d),document.addEventListener("mouseup",c)}),t.addEventListener("touchstart",h=>{let d=h.touches[0];o(d.clientX,d.clientY),i=setTimeout(()=>{r=!0,this.dragState.isDragging=!0,this.createGhostElement(n,d.clientX,d.clientY),t.addClass("zfb-native-calendar-event--dragging")},this.LONG_PRESS_DELAY)},{passive:!0}),t.addEventListener("touchmove",h=>{let d=h.touches[0];l(d.clientX,d.clientY),this.dragState.isDragging&&h.preventDefault()},{passive:!1}),t.addEventListener("touchend",async()=>{await u()}),t.addEventListener("touchcancel",()=>{this.cleanupDrag(t)})}createGhostElement(t,n,i){let r=document.createElement("div");r.addClass("zfb-native-calendar-ghost"),r.style.position="fixed",r.style.left=`${n+10}px`,r.style.top=`${i+10}px`,r.style.zIndex="1000",r.style.pointerEvents="none",r.style.backgroundColor=t.color||"var(--interactive-accent)";let o={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"};r.innerHTML=`<span class="event-icon">${o[t.type]||"\u{1F4C4}"}</span><span class="event-title">${t.title}</span>`,document.body.appendChild(r),this.dragState.ghostEl=r}updateDropTarget(t,n){document.querySelectorAll(".zfb-native-calendar-cell--drop-target").forEach(o=>{o.removeClass("zfb-native-calendar-cell--drop-target")});let r=document.elementFromPoint(t,n)?.closest(".zfb-native-calendar-cell");r?.dataset.date?(r.addClass("zfb-native-calendar-cell--drop-target"),this.dragState.targetDate=r.dataset.date):this.dragState.targetDate=null}cleanupDrag(t){this.dragState.ghostEl&&this.dragState.ghostEl.remove(),document.querySelectorAll(".zfb-native-calendar-cell--drop-target").forEach(n=>{n.removeClass("zfb-native-calendar-cell--drop-target")}),t.removeClass("zfb-native-calendar-event--dragging"),this.dragState={isDragging:!1,event:null,ghostEl:null,startX:0,startY:0,targetDate:null}}formatDateStr(t){let n=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${n}-${i}-${r}`}groupEventsByDate(t){let n=new Map;for(let i of t){let r=this.formatDateStr(i.start);n.has(r)||n.set(r,[]),n.get(r).push(i)}return n}sortEventsByType(t){let n={schedule:0,note:1,meeting:2};return[...t].sort((i,r)=>{let o=n[i.type]??2,l=n[r.type]??2;return o!==l?o-l:i.start.getTime()-r.start.getTime()})}openDayModal(t){new lr(this.app,t,this.dataProvider,this.settings).open()}openEventModal(t){let n=new Jc(this.app,t,this.dataProvider,this.settings);n.onSave(async()=>await this.render()),n.open()}};function oi(s,e=100){return s.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,e)}var $S=class extends Y.Plugin{constructor(){super(...arguments);this.gemini=null;this.ocrProcessor=null;this.relatedNoteFinder=null;this.mocManager=null;this.zkIndexManager=null;this.youtubeExtractor=null;this.webPageExtractor=null;this.reviewManager=null;this.meetingProcessor=null;this.scheduleManager=null;this.googleCalendar=null;this.calendarDataProvider=null;this.feedbackManager=null;this.embeddingManager=null;this.ragEngine=null;this.chatStorage=null;this.usageTracker=null;this.usageStatusBarEl=null;this.watcherRegistered=!1;this.pendingFiles=new Map;this.zkDailyCounter=new Map;this.zkLuhmannCounter=0;this.pendingEmbeddings=new Map;this.chatbotViewRegistered=!1}async onload(){await this.loadSettings(),this.addSettingTab(new Eb(this.app,this)),this.processDebounced=(0,Y.debounce)(()=>this.processPendingFiles(),3e3,!0),this.feedbackManager=new Lw(this.app,this.settings),await this.feedbackManager.load(),this.settings.usageTrackingEnabled&&await this.initUsageTracker(),this.calendarDataProvider=new Rm(this.app,this.settings),this.registerCalendarViews(),this.registerCommands(),this.settings.autoWatch&&this.startWatcher(),this.app.workspace.onLayoutReady(async()=>{this.settings.onboardingCompleted?await this.initGemini():new $w(this.app,this.settings,async t=>{this.settings=t,await this.saveSettings(),await this.initGemini(),new Y.Notice("\u{1F389} Zero Friction Brain \uC124\uC815 \uC644\uB8CC!")}).open()}),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uB85C\uB4DC\uB428")}async onunload(){this.stopWatcher(),this.usageTracker&&await this.usageTracker.saveUsage(),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uC5B8\uB85C\uB4DC\uB428")}async loadSettings(){this.settings=Object.assign({},Qa,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.initGemini()}async initGemini(){this.settings.geminiApiKey?(this.gemini=new dv(this.settings.geminiApiKey),this.usageTracker&&this.gemini.setUsageTracker(this.usageTracker),this.ocrProcessor=new bw(this.gemini,this.settings,this.app.vault),this.relatedNoteFinder=new vw(this.app,this.gemini,this.settings),this.embeddingManager=new _w(this.app,this.gemini,this.settings),await this.embeddingManager.loadIndex(),this.relatedNoteFinder.setEmbeddingManager(this.embeddingManager),this.chatStorage=new xw(this.app,this.settings),await this.chatStorage.loadSessions(),this.ragEngine=new ww(this.app,this.gemini,this.embeddingManager,this.settings),this.chatbotViewRegistered||(this.registerView(Sh,t=>new Cm(t,this.settings,this.ragEngine,this.chatStorage)),this.chatbotViewRegistered=!0),this.mocManager=new Ew(this.app,this.gemini,this.settings.projectsFolder,this.settings),this.zkIndexManager=new Sw(this.app,this.relatedNoteFinder,this.settings.zettelFolder,this.settings,this.gemini),this.youtubeExtractor=new kw(this.gemini,this.settings),this.webPageExtractor=new Rw(this.gemini,this.settings),this.reviewManager=new Tw(this.app,this.gemini,this.settings),this.meetingProcessor=new Aw(this.app,this.gemini,this.settings),this.scheduleManager=new Cw(this.app,this.settings),this.googleCalendar=new Dm(this.app,this.settings,()=>this.saveSettings()),Promise.all([this.relatedNoteFinder.buildIndex(),this.mocManager.scanProjectMOCs()]).then(()=>{console.log(`\uB178\uD2B8 \uC778\uB371\uC2A4: ${this.relatedNoteFinder?.getIndexSize()}\uAC1C, MOC: ${this.mocManager?.getMOCCount()}\uAC1C, ZK: ${this.relatedNoteFinder?.getZettelCount()}\uAC1C`),this.initializeZKCounters()})):(this.gemini=null,this.ocrProcessor=null,this.relatedNoteFinder=null,this.embeddingManager=null,this.ragEngine=null,this.chatStorage=null,this.mocManager=null,this.youtubeExtractor=null,this.webPageExtractor=null,this.reviewManager=null,this.scheduleManager=null,this.googleCalendar=null)}checkApiKey(){return this.gemini?!0:(new Y.Notice("Gemini API \uD0A4\uB97C \uC124\uC815\uD574\uC8FC\uC138\uC694"),!1)}truncateContent(t,n=5e5){let i=t.replace(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g,"[\uC774\uBBF8\uC9C0]");return i=i.replace(/!\[[^\]]*\]\(data:[^)]+\)/g,"[\uC774\uBBF8\uC9C0]"),i.length<=n?i:i.slice(0,n)+`

[... \uB0B4\uC6A9\uC774 \uB108\uBB34 \uAE38\uC5B4 \uC77C\uBD80\uB9CC \uBD84\uC11D\uB428 ...]`}extractEmbeddedImages(t){let n=["png","jpg","jpeg","webp","gif"],i=[],r=new Set,o=/!\[\[([^\]]+)\]\]/g,l;for(;(l=o.exec(t))!==null;){let h=l[1].split("|")[0].trim(),d=h.split(".").pop()?.toLowerCase();if(d&&n.includes(d)){let c=this.app.metadataCache.getFirstLinkpathDest(h,"");c&&c instanceof Y.TFile&&!r.has(c.path)&&(i.push(c),r.add(c.path))}}let u=/!\[[^\]]*\]\(([^)]+)\)/g;for(;(l=u.exec(t))!==null;){let h=l[1].trim();if(h.startsWith("http")||h.startsWith("data:"))continue;let d=h.split(".").pop()?.toLowerCase();if(d&&n.includes(d)){let c=this.app.vault.getAbstractFileByPath(h);c&&c instanceof Y.TFile&&!r.has(c.path)&&(i.push(c),r.add(c.path))}}return i}registerCommands(){this.addCommand({id:"project-classify",name:`${zt}\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"g"}],callback:()=>this.classifyCurrentFile()}),this.addCommand({id:"zk-extract",name:`${zt}ZK \uCD94\uCD9C`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"z"}],callback:()=>this.extractZKFromCurrentFile()}),this.addCommand({id:"focus-top3",name:`${zt}Focus Top 3`,hotkeys:[{modifiers:["Ctrl","Shift"],key:";"}],callback:()=>this.showFocusTop3()}),this.addCommand({id:"process-inbox",name:`${zt}Inbox \uC804\uCCB4 \uCC98\uB9AC`,callback:()=>this.processInbox()}),this.addCommand({id:"toggle-watch",name:`${zt}Watch \uD1A0\uAE00`,callback:()=>this.toggleWatch()}),this.addCommand({id:"ocr-extract",name:`${zt}OCR \uCD94\uCD9C`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"o"}],callback:()=>this.ocrCurrentFile()}),this.addCommand({id:"ocr-inbox",name:`${zt}Inbox OCR \uCC98\uB9AC`,callback:()=>this.processInboxOCR()}),this.addCommand({id:"smart-process",name:`${zt}\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"s"}],callback:()=>this.smartProcessCurrentFile()}),this.addCommand({id:"create-moc",name:`${zt}\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131`,callback:()=>this.showCreateMOCModal()}),this.addCommand({id:"url-import",name:`${zt}URL \uAC00\uC838\uC624\uAE30`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"u"}],callback:()=>this.showURLImportModal()}),this.addCommand({id:"rebuild-zk-index",name:`${zt}ZK Index \uC7AC\uAD6C\uCD95`,callback:()=>this.rebuildZKIndex()}),this.addCommand({id:"smart-split",name:`${zt}\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"d"}],callback:()=>this.smartSplitCurrentFile()}),this.addCommand({id:"link-related-notes",name:`${zt}\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"l"}],callback:()=>this.linkRelatedNotesForCurrentFile()}),this.addCommand({id:"review-mode",name:`${zt}\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"r"}],callback:()=>this.showReviewModal()}),this.addCommand({id:"show-command-list",name:`${zt}\uBA85\uB839 \uB9AC\uC2A4\uD2B8`,callback:()=>this.showCommandListModal()}),this.addCommand({id:"open-calendar",name:`${zt}\uCE98\uB9B0\uB354 \uBDF0`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"c"}],callback:()=>this.openCalendarView()}),this.addCommand({id:"toggle-chatbot",name:`${zt}AI \uCC57\uBD07`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"'"}],callback:()=>this.toggleChatbot()}),this.addCommand({id:"image-batch-ocr",name:`${zt}\uC774\uBBF8\uC9C0 \uD1B5\uD569 \uCC98\uB9AC`,callback:()=>this.showImageBatchModal()}),this.addCommand({id:"smart-search",name:`${zt}\uC2A4\uB9C8\uD2B8 \uAC80\uC0C9`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"f"}],callback:()=>this.showSmartSearchModal()}),this.addCommand({id:"test-local-embedding",name:`${zt}[PoC] \uB85C\uCEEC \uC784\uBCA0\uB529 \uD14C\uC2A4\uD2B8`,callback:()=>this.runLocalEmbeddingPoC()}),this.addRibbonIcon("brain","Zero Friction Brain",()=>{this.showCommandListModal()}),this.settings.calendarEnabled&&this.addRibbonIcon("calendar","\uCE98\uB9B0\uB354 \uBDF0",()=>{this.openCalendarView()}),this.settings.ragEnabled&&this.settings.embeddingEnabled&&this.addRibbonIcon("bot","AI \uCC57\uBD07",()=>{this.toggleChatbot()})}registerCalendarViews(){this.settings.calendarEngine==="native"?this.registerView(Fa,t=>new xy(t,this.settings,this.calendarDataProvider)):this.registerView(Fa,t=>new wy(t,this.settings,this.calendarDataProvider)),this.registerView(Ih,t=>new Pm(t,this.settings,this.calendarDataProvider))}async restartCalendarView(){this.app.workspace.detachLeavesOfType(Fa),await this.openCalendarView()}async toggleChatbot(){let t=this.app.workspace.getLeavesOfType(Sh);if(t.length>0)t[0].detach();else{let n=this.app.workspace.getRightLeaf(!1);n&&await n.setViewState({type:Sh,active:!0})}}async openCalendarView(){let t=this.app.workspace.getLeavesOfType(Fa);t.length>0?this.app.workspace.revealLeaf(t[0]):await this.app.workspace.getLeaf("tab").setViewState({type:Fa,active:!0})}async toggleMiniCalendar(){let t=this.app.workspace.getLeavesOfType(Ih);if(t.length>0)t[0].detach();else{let n=this.app.workspace.getRightLeaf(!1);n&&await n.setViewState({type:Ih,active:!0})}}showReviewModal(){if(this.checkApiKey()){if(!this.reviewManager){new Y.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new RF(this.app,this.reviewManager,this.settings).open()}}async connectGoogleCalendar(){this.googleCalendar||(this.googleCalendar=new Dm(this.app,this.settings,()=>this.saveSettings())),await this.googleCalendar.startOAuth()}async disconnectGoogleCalendar(){this.googleCalendar&&await this.googleCalendar.disconnect()}async detectAndSaveSchedules(t,n){if(this.settings.scheduleDetectionEnabled&&!(!this.gemini||!this.scheduleManager))try{let i=$i(this.settings.timezone),r=await this.gemini.detectSchedules(t,i);if(r.length===0)return;n&&r.forEach(c=>c.sourceNote=n.basename);let l=await new Pw(this.app,r,this.settings,c=>{this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"schedule_detection",noteTitle:n?.basename||"Unknown",aiSuggestion:{schedules:c.allSchedules},userChoice:{accepted:c.accepted,rejectedItems:c.rejectedSchedules?.map(a=>a.title),dismissed:c.dismissed}})}).openAndWait();if(!l||l.selectedSchedules.length===0)return;let u=0,h=0;if(l.saveToDaily&&(u=await this.scheduleManager.saveToDaily(l.selectedSchedules)),l.saveToGoogle&&this.googleCalendar&&this.googleCalendar.isConnected()&&(h=await this.googleCalendar.saveSchedules(l.selectedSchedules)),l.moveToArchives&&n){let c=`${this.settings.archivesFolder}/${n.name}`;await this.app.fileManager.renameFile(n,c),new Y.Notice("\uC6D0\uBCF8 \uB178\uD2B8\uAC00 Archives\uB85C \uC774\uB3D9\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}let d=[];u>0&&d.push(`Daily Notes: ${u}\uAC1C`),h>0&&d.push(`Google Calendar: ${h}\uAC1C`),d.length>0&&new Y.Notice(`\uC77C\uC815 \uC800\uC7A5\uB428
${d.join(", ")}`)}catch(i){console.error("\uC77C\uC815 \uAC10\uC9C0 \uC2E4\uD328:",i)}}async rebuildZKIndex(){if(!this.zkIndexManager){new Y.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new Y.Notice("ZK Index \uC7AC\uAD6C\uCD95 \uC911...");try{await this.zkIndexManager.rebuildIndex();let t=this.relatedNoteFinder?.getZettelCount()||0;new Y.Notice(`ZK Index \uC7AC\uAD6C\uCD95 \uC644\uB8CC: ${t}\uAC1C \uB178\uD2B8`)}catch(t){console.error("ZK Index \uC7AC\uAD6C\uCD95 \uC2E4\uD328:",t),new Y.Notice(`\uC7AC\uAD6C\uCD95 \uC2E4\uD328: ${t}`)}}async smartSplitCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new Y.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(t.extension!=="md"){new Y.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uBD84\uB9AC\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4");return}new Y.Notice("\uBA54\uBAA8 \uBD84\uC11D \uC911...");try{let n=await this.app.vault.read(t),i=this.mocManager?.getProjectList()||[],r=await this.gemini.splitContent(n,i);if(r.length===0){new Y.Notice("\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(r.length===1){new Y.Notice("\uB2E8\uC77C \uC8FC\uC81C\uB85C \uD310\uB2E8\uB428. \uC77C\uBC18 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958\uB97C \uC0AC\uC6A9\uD558\uC138\uC694.");return}new IF(this.app,r,t,this).open()}catch(n){console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC2E4\uD328:",n),new Y.Notice(`\uBD84\uB9AC \uC2E4\uD328: ${n}`)}}async createSplitNotes(t,n){let i=[];for(let o of t){let l=this.getTargetFolder(o.targetType,o.project);if(o.project&&!o.project.startsWith("NEW:")){let a=`${this.settings.projectsFolder}/${o.project}`;this.app.vault.getAbstractFileByPath(a)instanceof Y.TFolder&&(l=a)}let u=oi(o.title),h=`${l}/${u}.md`,d=`---
targetType: ${o.targetType}
keywords: [${o.keywords.join(", ")}]
source: "[[${n.basename}]]"
created: ${Kt(this.settings.timezone,this.settings.dateFormat)}
${o.project?`project: "${o.project}"`:""}
---

# ${o.title}

${o.content}
`;this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l);try{let a=await this.app.vault.create(h,d);if(i.push(o.title),this.relatedNoteFinder&&await this.relatedNoteFinder.updateIndex(a),o.project&&this.mocManager)if(o.project.startsWith("NEW:")){let f=o.project.slice(4).trim();await this.mocManager.createProjectMOC(f,this.settings.projectsFolder)&&await this.mocManager.addNoteToMOC(f,o.title,a.path)}else await this.mocManager.addNoteToMOC(o.project,o.title,a.path)}catch(a){console.error(`\uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328: ${o.title}`,a)}}let r=`${this.settings.archivesFolder}/${n.name}`;try{this.app.vault.getAbstractFileByPath(this.settings.archivesFolder)||await this.app.vault.createFolder(this.settings.archivesFolder),await this.app.fileManager.renameFile(n,r)}catch(o){console.error("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uC2E4\uD328:",o)}new Y.Notice(`${i.length}\uAC1C \uB178\uD2B8 \uC0DD\uC131\uB428, \uC6D0\uBCF8\uC740 Archives\uB85C \uC774\uB3D9`)}showCreateMOCModal(){new AF(this.app,this.mocManager,this.settings.projectsFolder).open()}showURLImportModal(){this.checkApiKey()&&new CF(this.app,"URL \uAC00\uC838\uC624\uAE30","\uC720\uD29C\uBE0C \uB610\uB294 \uC6F9\uD398\uC774\uC9C0 URL\uC744 \uC785\uB825\uD558\uC138\uC694 (\uC790\uB3D9 \uAC10\uC9C0)","https://...",async t=>{await this.processURL(t)}).open()}async processURL(t){/(?:youtube\.com|youtu\.be)/.test(t)?await this.processYouTube(t):await this.processWebPage(t)}async processYouTube(t){if(!(!this.youtubeExtractor||!this.gemini)){new Y.Notice("\uC720\uD29C\uBE0C \uC601\uC0C1 \uBD84\uC11D \uC911...");try{let n=await this.youtubeExtractor.processVideo(t),i=this.youtubeExtractor.generateMarkdownNote(n),r=oi(n.title),o=`${r}.md`,l=`${this.settings.inboxFolder}/${o}`,u=await this.app.vault.create(l,i);new Y.Notice(`\uC720\uD29C\uBE0C \uB178\uD2B8 \uC0DD\uC131: ${r}`);let h=this.mocManager?.getProjectList()||[],d=this.feedbackManager?.generatePromptContext(),c=await this.gemini.classifyProject(i,h,d);u=await this.applyClassifyResultWithConfirmation(u,c),this.showFileCreatedNotice(u,"\u{1F3AC}"),this.app.workspace.getLeaf().openFile(u),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(u,i,c.title)}catch(n){console.error("\uC720\uD29C\uBE0C \uCC98\uB9AC \uC624\uB958:",n),new Y.Notice(`\uC720\uD29C\uBE0C \uCC98\uB9AC \uC2E4\uD328: ${n}`)}}}async processWebPage(t){if(!(!this.webPageExtractor||!this.gemini)){new Y.Notice("\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38 \uCD94\uCD9C \uC911...");try{let n=await this.webPageExtractor.processUrl(t),i=this.webPageExtractor.generateMarkdownNote(n),r=oi(n.title),o=`${r}.md`,l=`${this.settings.inboxFolder}/${o}`,u=await this.app.vault.create(l,i);new Y.Notice(`\uC6F9\uD398\uC774\uC9C0 \uB178\uD2B8 \uC0DD\uC131: ${r}`);let h=this.mocManager?.getProjectList()||[],d=this.feedbackManager?.generatePromptContext(),c=await this.gemini.classifyProject(i,h,d);u=await this.applyClassifyResultWithConfirmation(u,c),this.showFileCreatedNotice(u,"\u{1F310}"),this.app.workspace.getLeaf().openFile(u),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(u,i,c.title)}catch(n){console.error("\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC624\uB958:",n),new Y.Notice(`\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC2E4\uD328: ${n}`)}}}async classifyCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new Y.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase(),i=["pdf","png","jpg","jpeg","webp","gif"];if(V1.includes(n)){if(!this.meetingProcessor){new Y.Notice("\uD68C\uC758\uB85D \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}new Y.Notice("\uD68C\uC758\uB85D \uBD84\uC11D \uC911...");try{let r=await this.meetingProcessor.processAudio(t),o=this.meetingProcessor.generateMarkdownNote(r),l=`\uD68C\uC758\uB85D_${oi(r.title)}.md`,u=`${this.settings.inboxFolder}/${l}`,h=await this.app.vault.create(u,o);if(this.settings.ocrMoveOriginal){let p=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(p)||await this.app.vault.createFolder(p);let m=`${p}/${t.name}`;await this.app.fileManager.renameFile(t,m)}let d=this.mocManager?.getProjectList()||[],c=this.feedbackManager?.generatePromptContext(),a=await this.gemini.classifyProject(o,d,c),f=await this.applyClassifyResultWithConfirmation(h,a);this.showFileCreatedNotice(f,"\u{1F399}\uFE0F"),await this.findAndShowRelatedNotes(f,o,r.title),await this.detectAndSaveSchedules(o,f)}catch(r){console.error("\uD68C\uC758\uB85D \uBD84\uC11D \uC624\uB958:",r),new Y.Notice(`\uD68C\uC758\uB85D \uBD84\uC11D \uC2E4\uD328: ${r}`)}return}if(i.includes(n)){if(!this.settings.ocrEnabled){new Y.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new Y.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let r=await this.ocrProcessor.checkLimits(t);if(!r.allowed){new ob(this.app,r.reason,t,this).open();return}new Y.Notice("\uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let o=await this.ocrProcessor.processFile(t);new Y.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let l=await this.gemini.summarizePDF(o.text,this.settings.detailedSummary),u=this.ocrProcessor.generateSummarizedNote(o,l),h=t.basename+"_OCR.md",d=`${this.settings.inboxFolder}/${h}`,c=await this.app.vault.create(d,u);if(this.settings.ocrMoveOriginal){let m=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(m)||await this.app.vault.createFolder(m);let _=`${m}/${t.name}`;await this.app.fileManager.renameFile(t,_)}let a=this.mocManager?.getProjectList()||[],f=this.feedbackManager?.generatePromptContext(),p=await this.gemini.classifyProject(u,a,f),g=await this.applyClassifyResultWithConfirmation(c,p);if(p.title&&g){let m=oi(p.title),y=g.parent?.path||"",_=y?`${y}/${m}.md`:`${m}.md`;_!==g.path&&await this.app.fileManager.renameFile(g,_)}new Y.Notice(`\uC644\uB8CC: OCR(${o.pages}p) \u2192 ${p.targetType}${p.projectName?` (${p.projectName})`:""}`),await this.findAndShowRelatedNotes(g,u,p.title),await this.detectAndSaveSchedules(u,g)}catch(o){console.error("\uCC98\uB9AC \uC624\uB958:",o),new Y.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${o}`)}return}if(n==="md"){try{let r=await this.app.vault.read(t),o=this.extractEmbeddedImages(r);if(o.length>0&&this.settings.ocrEnabled&&this.ocrProcessor){new Y.Notice(`\uC784\uBCA0\uB4DC\uB41C \uC774\uBBF8\uC9C0 ${o.length}\uC7A5 \uAC10\uC9C0\uB428. OCR \uCC98\uB9AC \uC911...`);let l=this.ocrProcessor.checkLimitsForMultipleImages(o);if(!l.allowed){new Y.Notice(`OCR \uC81C\uD55C: ${l.reason}`),await this.classifyMarkdownContent(t,r);return}let u=await this.ocrProcessor.processMultipleImages(o,t.basename);new Y.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let h=await this.gemini.summarizePDF(u.text,this.settings.detailedSummary),d=`---
type: ocr
source_note: "${t.basename}"
pages: ${u.pages}
---

# ${h.title}

## \uC694\uC57D
${h.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${h.keyPoints.map(g=>`- ${g}`).join(`
`)}

---
## \uC6D0\uBCF8 \uC774\uBBF8\uC9C0
${o.map(g=>`![[${g.name}]]`).join(`
`)}
`;await this.app.vault.modify(t,d);let c=this.mocManager?.getProjectList()||[],a=this.feedbackManager?.generatePromptContext(),f=await this.gemini.classifyProject(d,c,a),p=await this.applyClassifyResultWithConfirmation(t,f);if(h.title&&p){let g=oi(h.title),m=p.parent?.path||"",y=m?`${m}/${g}.md`:`${g}.md`;y!==p.path&&(await this.app.fileManager.renameFile(p,y),p=this.app.vault.getAbstractFileByPath(y))}new Y.Notice(`\uC644\uB8CC: OCR(${u.pages}\uC7A5) \u2192 ${f.targetType}${f.projectName?` (${f.projectName})`:""}`),await this.findAndShowRelatedNotes(p,d,h.title),await this.detectAndSaveSchedules(d,p);return}await this.classifyMarkdownContent(t,r)}catch(r){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",r),new Y.Notice(`\uBD84\uB958 \uC2E4\uD328: ${r}`)}return}new Y.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}async classifyMarkdownContent(t,n){new Y.Notice("\uBD84\uB958 \uC911...");let i=this.truncateContent(n),r=this.mocManager?.getProjectList()||[],o=this.feedbackManager?.generatePromptContext(),l=await this.gemini.classifyProject(i,r,o),u=await this.applyClassifyResultWithConfirmation(t,l);if(["\uBB34\uC81C","untitled","\uC0C8 \uB178\uD2B8","new note"].some(c=>u.basename.toLowerCase().startsWith(c.toLowerCase()))&&l.title&&u){let c=oi(l.title),a=u.parent?.path||"",f=a?`${a}/${c}.md`:`${c}.md`;f!==u.path&&(await this.app.fileManager.renameFile(u,f),u=this.app.vault.getAbstractFileByPath(f))}new Y.Notice(`${l.targetType}${l.projectName?` (${l.projectName})`:""}\uB85C \uBD84\uB958\uB428`),await this.findAndShowRelatedNotes(u,n,l.title),await this.detectAndSaveSchedules(n,u)}async linkRelatedNotesForCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new Y.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(t.extension!=="md"){new Y.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uC9C0\uC6D0\uD569\uB2C8\uB2E4");return}new Y.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");try{let n=await this.app.vault.read(t),i=this.truncateContent(n),o=n.match(/^#\s+(.+)$/m)?.[1]||t.basename;await this.findAndShowRelatedNotes(t,i,o)}catch(n){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",n),new Y.Notice(`\uAC80\uC0C9 \uC2E4\uD328: ${n}`)}}showCommandListModal(){new kF(this.app,this).open()}showFileCreatedNotice(t,n="\u2705"){let i=new Y.Notice("",3e3);i.noticeEl.empty(),i.noticeEl.style.cursor="pointer";let r=i.noticeEl.createDiv();r.style.display="flex",r.style.flexDirection="column",r.style.gap="2px";let o=r.createEl("span",{text:`${n} ${t.basename}`});o.style.fontWeight="500";let l=r.createEl("span",{text:`\u{1F4C1} ${t.parent?.path||"/"}`});l.style.fontSize="11px",l.style.opacity="0.7",i.noticeEl.addEventListener("click",()=>{this.app.workspace.openLinkText(t.path,""),i.hide()})}showSmartSearchModal(){if(!this.embeddingManager){new Y.Notice("\uC784\uBCA0\uB529 \uB9E4\uB2C8\uC800\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4");return}if(!this.settings.embeddingEnabled){new Y.Notice("Embedding \uAE30\uBC18 \uAC80\uC0C9\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C \uD65C\uC131\uD654\uD558\uC138\uC694.");return}if(this.embeddingManager.getStats().totalNotes===0){new Y.Notice("\uC778\uB371\uC2A4\uAC00 \uBE44\uC5B4 \uC788\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C \uC778\uB371\uC2A4\uB97C \uAD6C\uCD95\uD558\uC138\uC694.");return}new Ow(this.app,this.embeddingManager).open()}async runLocalEmbeddingPoC(){new Y.Notice(`\u{1F9EA} PoC: \uB85C\uCEEC \uC784\uBCA0\uB529 \uD14C\uC2A4\uD2B8 \uC2DC\uC791
\uCF58\uC194(Ctrl+Shift+I)\uC5D0\uC11C \uACB0\uACFC \uD655\uC778`),console.log("=".repeat(60)),console.log("[PoC] \uB85C\uCEEC \uC784\uBCA0\uB529 \uD14C\uC2A4\uD2B8 \uC2DC\uC791"),console.log("=".repeat(60));try{let{runFullPoC:t}=await Promise.resolve().then(()=>(zH(),VH));await t(),new Y.Notice("\u2705 PoC \uC644\uB8CC! \uCF58\uC194\uC5D0\uC11C \uACB0\uACFC\uB97C \uD655\uC778\uD558\uC138\uC694")}catch(t){console.error("[PoC] \uC2E4\uD328:",t),new Y.Notice(`\u274C PoC \uC2E4\uD328: ${t instanceof Error?t.message:String(t)}`)}}async showImageBatchModal(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new Y.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new Y.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof Y.TFolder)){new Y.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=["png","jpg","jpeg","webp","gif"],i=[];for(let l of t.children){if(!(l instanceof Y.TFile))continue;let u=l.extension.toLowerCase();n.includes(u)&&i.push(l)}if(i.length===0){new Y.Notice("_Inbox\uC5D0 \uC774\uBBF8\uC9C0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}i.sort((l,u)=>l.name.localeCompare(u.name));let o=await new Nw(this.app,i,this.settings).openAndWait();!o||o.selectedFiles.length===0||await this.processImageBatch(o.selectedFiles)}async processImageBatch(t){if(!this.ocrProcessor||!this.gemini){new Y.Notice("OCR/Gemini \uCD08\uAE30\uD654 \uC2E4\uD328");return}let n=this.ocrProcessor.checkLimitsForMultipleImages(t);if(!n.allowed){new Y.Notice(`\uCC98\uB9AC \uBD88\uAC00: ${n.reason}`);return}try{new Y.Notice(`${t.length}\uAC1C \uC774\uBBF8\uC9C0 OCR \uCC98\uB9AC \uC911...`);let i=await this.ocrProcessor.processMultipleImages(t,`\uD1B5\uD569\uCC98\uB9AC_${t.length}\uC7A5`);new Y.Notice("AI \uC694\uC57D \uBC0F \uBD84\uB958 \uC911...");let r=await this.gemini.summarizePDF(i.text,this.settings.detailedSummary),o=Kt(this.settings.timezone,this.settings.dateFormat),l=`---
type: ocr
source_type: image_batch
images: ${t.length}
ocr_at: ${o}
---

# ${r.title}

## \uC694\uC57D
${r.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${r.keyPoints.map(m=>`- ${m}`).join(`
`)}

---
## \uC6D0\uBCF8 \uC774\uBBF8\uC9C0
${t.map(m=>`![[${m.name}]]`).join(`
`)}
`,u=oi(r.title),h=`${this.settings.inboxFolder}/${u}.md`,d=await this.app.vault.create(h,l);new Y.Notice("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC911...");let c=this.mocManager?.getProjectList()||[],a=this.feedbackManager?.generatePromptContext(),f=await this.gemini.classifyProject(`# ${r.title}

${r.summary}

${r.keyPoints.join(`
`)}`,c,a),p=await this.applyClassifyResultWithConfirmation(d,f);if(f.title&&p){let m=oi(f.title),y=p.parent?.path||"",_=y?`${y}/${m}.md`:`${m}.md`;_!==p.path&&(await this.app.fileManager.renameFile(p,_),p=this.app.vault.getAbstractFileByPath(_))}if(this.settings.ocrMoveOriginal){let m=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(m)||await this.app.vault.createFolder(m);for(let _ of t){let x=`${m}/${_.name}`;try{await this.app.fileManager.renameFile(_,x)}catch(E){console.error(`\uC774\uBBF8\uC9C0 \uC774\uB3D9 \uC2E4\uD328: ${_.name}`,E)}}new Y.Notice(`\uC6D0\uBCF8 \uC774\uBBF8\uC9C0 ${t.length}\uC7A5\uC774 Archives\uB85C \uC774\uB3D9\uB428`)}this.showFileCreatedNotice(p,"\u{1F5BC}\uFE0F"),await this.app.workspace.openLinkText(p.path,"");let g=await this.app.vault.read(p);await this.findAndShowRelatedNotes(p,g,f.title),await this.detectAndSaveSchedules(g,p)}catch(i){console.error("\uC774\uBBF8\uC9C0 \uBC30\uCE58 \uCC98\uB9AC \uC2E4\uD328:",i),new Y.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${i}`)}}async applyClassifyResult(t,n){let i=await this.app.vault.read(t),r=this.updateFrontmatter(i,{targetType:n.targetType,project:n.projectName||void 0,title:n.title,summary:n.summary,next_action:n.nextAction||void 0,processed_at:Kt(this.settings.timezone,this.settings.dateFormat)});await this.app.vault.modify(t,r);let o=this.getTargetFolder(n.targetType,n.projectName);if(o){this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o);let u=`${o}/${t.name}`;await this.app.fileManager.renameFile(t,u);let h=this.app.vault.getAbstractFileByPath(u);if(h instanceof Y.TFile)return h}return t}async applyClassifyResultWithConfirmation(t,n){if(n.shouldRestructure&&n.restructuredContent){let r=this.feedbackManager?.getPreferences();if(r){let o=r.restructure,l=o.accepted+o.rejected;if(o.preference==="restructure"&&o.accepted>=km)new Y.Notice(`\u2728 \uCF58\uD150\uCE20 \uC790\uB3D9 \uC7AC\uAD6C\uC131 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${o.accepted}/${l}\uD68C)`),await this.applyRestructuredContent(t,n.restructuredContent);else if(o.preference==="original"&&o.rejected>=km)new Y.Notice(`\u{1F4C4} \uC6D0\uBCF8 \uC720\uC9C0 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${o.rejected}/${l}\uD68C)`);else{let u=await this.app.vault.read(t);await this.showRestructureModal(t,n,u)&&await this.applyRestructuredContent(t,n.restructuredContent)}}else{let o=await this.app.vault.read(t);await this.showRestructureModal(t,n,o)&&await this.applyRestructuredContent(t,n.restructuredContent)}}if(n.contentType!=="reference"||!n.projectName)return this.applyClassifyResult(t,n);let i=this.feedbackManager?.getPreferences();if(i){let r=i.feedback.referenceLocation,o=r.toLibrary+r.toProject;if(r.preference==="library"&&r.toLibrary>=km){new Y.Notice(`\u{1F4DA} Library\uC5D0 \uC790\uB3D9 \uC800\uC7A5 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${r.toLibrary}/${o}\uD68C)`);let l={...n,targetType:"library"};return this.applyClassifyResult(t,l)}if(r.preference==="project"&&r.toProject>=km){new Y.Notice(`\u{1F4C1} \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC790\uB3D9 \uC800\uC7A5 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${r.toProject}/${o}\uD68C)`);let l={...n,targetType:"project"};return this.applyClassifyResult(t,l)}}return new Promise(r=>{new DF(this.app,n,async o=>{let l={...n};o==="library"?(l={...n,targetType:"library"},new Y.Notice(`Library\uC5D0 \uC800\uC7A5 + ${n.projectName} \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C`)):l={...n,targetType:"project"};let u=await this.applyClassifyResult(t,l);r(u)},this.feedbackManager).open()})}showRestructureModal(t,n,i){return new Promise(r=>{new Mw(this.app,n,i,o=>{r(o)},this.feedbackManager).open()})}async applyRestructuredContent(t,n){let r=(await this.app.vault.read(t)).match(/^---\n([\s\S]*?)\n---\n?/),l=(r?r[0]:"")+n;await this.app.vault.modify(t,l)}async findAndShowRelatedNotes(t,n,i){if(!this.relatedNoteFinder||!this.gemini)return;let r=this.truncateContent(n);try{let o=await this.gemini.extractKeywords(r);o.length>0&&this.relatedNoteFinder&&await this.relatedNoteFinder.saveKeywordsToNote(t,o),this.mocManager&&this.mocManager.getMOCCount()>0&&await this.handleProjectMOC(t,i,o),new Y.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");let l=await this.relatedNoteFinder.findRelated(r,i,t.path);l.length>0?new SF(this.app,l,t,this.relatedNoteFinder,this.feedbackManager).open():o.length>0&&new Y.Notice(`\uD0A4\uC6CC\uB4DC ${o.length}\uAC1C \uC800\uC7A5\uB428`)}catch(o){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",o)}}async handleProjectMOC(t,n,i){if(!(!this.mocManager||!this.gemini))try{let r=await this.mocManager.detectProject(n,i);if(!r)return;if(r.startsWith("NEW:")){let l=r.slice(4).trim();new TF(this.app,l,t,n,this.mocManager,this.settings.projectsFolder).open();return}await this.mocManager.addNoteToMOC(r,n,t.path)&&new Y.Notice(`\u{1F4C1} ${r} MOC\uC5D0 \uC5F0\uACB0\uB428`)}catch(r){console.error("MOC \uC5F0\uACB0 \uC624\uB958:",r)}}getTargetFolder(t,n){switch(t){case"project":return n?`${this.settings.projectsFolder}/${n}`:this.settings.projectsFolder;case"library":return this.settings.libraryFolder;case"archive":return this.settings.archivesFolder;default:return this.settings.libraryFolder}}updateFrontmatter(t,n){let i=/^---\n([\s\S]*?)\n---\n?/,r=t.match(i),o="",l=t;r&&(o=r[1],l=t.slice(r[0].length));let u=o.split(`
`).filter(c=>c.trim()),h=new Map;for(let c of u){let a=c.indexOf(":");if(a!==-1){let f=c.slice(0,a).trim(),p=c.slice(a+1).trim();h.set(f,p)}}for(let[c,a]of Object.entries(n))if(a!==void 0){let p=/[:\[\]{}#&*!|>'"%@`]/.test(a)&&!a.startsWith('"')?`"${a.replace(/"/g,'\\"')}"`:a;h.set(c,p)}return`---
${Array.from(h.entries()).map(([c,a])=>`${c}: ${a}`).join(`
`)}
---
${l}`}async extractZKFromCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new Y.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new Y.Notice("ZK \uC544\uC774\uB514\uC5B4 \uCD94\uCD9C \uC911...");try{let n=await this.app.vault.read(t),i=await this.gemini.extractZK(n);if(i.length===0){new Y.Notice("\uCD94\uCD9C\uD560 \uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new wF(this.app,i,t,this).open()}catch(n){console.error("ZK \uCD94\uCD9C \uC624\uB958:",n),new Y.Notice(`\uCD94\uCD9C \uC2E4\uD328: ${n}`)}}initializeZKCounters(){if(!this.relatedNoteFinder)return;let t=this.relatedNoteFinder.getZettelIndex();for(let[n]of t){let r=(n.split("/").pop()||"").match(/^(\d{8})-(\d{3})/);if(r){let o=r[1],l=parseInt(r[2],10),u=this.zkDailyCounter.get(o)||0;l>u&&this.zkDailyCounter.set(o,l)}this.zkLuhmannCounter=Math.max(this.zkLuhmannCounter,t.size)}console.log(`ZK \uCE74\uC6B4\uD130 \uCD08\uAE30\uD654: \uB8E8\uB9CC=${this.zkLuhmannCounter}, \uC77C\uBCC4=${this.zkDailyCounter.size}\uAC1C \uB0A0\uC9DC`)}generateZKId(){switch(this.settings.zkIdType){case"timestamp":return Date.now().toString();case"date-sequence":{let n=$i(this.settings.timezone).replace(/-/g,""),i=(this.zkDailyCounter.get(n)||0)+1;return this.zkDailyCounter.set(n,i),`${n}-${i.toString().padStart(3,"0")}`}case"luhmann":return this.zkLuhmannCounter++,this.toLuhmannId(this.zkLuhmannCounter);default:return Date.now().toString()}}toLuhmannId(t){if(t<=0)return"1";let n=[],i=t,r=0;for(;i>0;){if(r%2===0){let o=(i-1)%9+1;n.push(o.toString()),i=Math.floor((i-1)/9)}else{let o=(i-1)%26;n.push(String.fromCharCode(97+o)),i=Math.floor((i-1)/26)}r++}return n.reverse().join("")}async createZKNotes(t,n){let i=this.settings.zettelFolder;this.app.vault.getAbstractFileByPath(i)||await this.app.vault.createFolder(i);let o=[],l=[],u=0;for(let d of t){let a=(await this.relatedNoteFinder.findRelatedZettels(d.keywords)).find(_=>_.relevance>=this.settings.zkMergeThreshold);if(a&&await this.showMergeConfirmModal(d,a)){await this.mergeToExistingZK(a.note.path,d,n),l.push(d.title);continue}let f=this.generateZKId(),p=oi(d.title),g=`${i}/${f} ${p}.md`,m=`---
type: zettel
source: "[[${n.basename}]]"
keywords: [${d.keywords.join(", ")}]
created: ${Kt(this.settings.timezone,this.settings.dateFormat)}
---

# ${d.title}

## \uD575\uC2EC \uC544\uC774\uB514\uC5B4
${d.body}

## \uC65C \uC911\uC694\uD55C\uAC00?
${d.importance||""}

## \uB9E5\uB77D
- **\uC6D0\uBCF8**: [[${n.basename}]]
- **\uAD00\uB828 \uAC1C\uB150**: ${d.relatedConcepts?.join(", ")||""}

---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
- [[${n.basename}]] (\uC6D0\uBCF8)
`;await this.app.vault.create(g,m),o.push(d.title);let y=this.app.vault.getAbstractFileByPath(g);if(y instanceof Y.TFile){await this.relatedNoteFinder.updateIndex(y);let _=await this.relatedNoteFinder.findRelatedZettels(d.keywords,g);_.length>0&&(await this.addZKRelatedLinks(y,_),await this.addBacklinksToZettels(y,_),u+=_.length),this.zkIndexManager&&await this.zkIndexManager.updateIndex(y,d.keywords)}await new Promise(_=>setTimeout(_,10))}let h=[];o.length>0&&h.push(`${o.length}\uAC1C \uC0DD\uC131`),l.length>0&&h.push(`${l.length}\uAC1C \uBCD1\uD569`),u>0&&h.push(`${u}\uAC1C \uC5F0\uACB0`),new Y.Notice(`ZK \uB178\uD2B8: ${h.join(", ")}`)}showMergeConfirmModal(t,n){return new Promise(i=>{new xF(this.app,t,n,o=>i(o)).open()})}async mergeToExistingZK(t,n,i){let r=this.app.vault.getAbstractFileByPath(t);if(!(r instanceof Y.TFile))return;let o=await this.app.vault.read(r),l=`

---
## \uCD94\uAC00\uB41C \uB0B4\uC6A9 (${new Date().toLocaleDateString()})
*\uC6D0\uBCF8: [[${i.basename}]]*

${n.body}
`,u=/(\n---\n##  )/,h;u.test(o)?h=o.replace(u,`${l}$1`):h=o+l;let d=this.extractKeywordsFromFrontmatter(o),c=[...new Set([...d,...n.keywords])];h=this.updateFrontmatterKeywordsInContent(h,c),await this.app.vault.modify(r,h),await this.relatedNoteFinder.updateIndex(r)}extractKeywordsFromFrontmatter(t){let n=t.match(/^---\n[\s\S]*?keywords:\s*\[(.*?)\][\s\S]*?---/);return n?n[1].split(",").map(i=>i.trim().replace(/^["']|["']$/g,"")).filter(i=>i.length>0):[]}updateFrontmatterKeywordsInContent(t,n){let i=`keywords: [${n.join(", ")}]`;return t.replace(/^(---\n[\s\S]*?)(keywords:\s*\[.*?\])([\s\S]*?---)/,`$1${i}$3`)}async addZKRelatedLinks(t,n){if(n.length===0)return;let i=await this.app.vault.read(t),r=n.map(h=>{let d=h.note.path.split("/"),a=d[d.length-1].replace(/\.md$/,""),f=h.reason?`
  \u2192 ${h.reason}`:"";return`- [[${a}]] (${Math.round(h.relevance*100)}%)${f}`}).join(`
`),o=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,l=i.match(o),u;l?u=i.replace(o,`$1
${r}$2`):u=i+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${r}
`,await this.app.vault.modify(t,u)}async addBacklinksToZettels(t,n){for(let i of n){let r=this.app.vault.getAbstractFileByPath(i.note.path);if(!(r instanceof Y.TFile))continue;let o=await this.app.vault.read(r);if(o.includes(`[[${t.basename}]]`))continue;let l=i.reason?`
  \u2192 ${i.reason}`:"",u=`- [[${t.basename}]] (${Math.round(i.relevance*100)}%)${l}`,h=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,d=o.match(h),c;d?c=o.replace(h,`$1
${u}$2`):c=o+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${u}
`,await this.app.vault.modify(r,c)}}async showFocusTop3(){if(this.checkApiKey()){new Y.Notice("\uD504\uB85C\uC81D\uD2B8 \uBD84\uC11D \uC911...");try{let t=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(!t||!(t instanceof Y.TFolder)){new Y.Notice("Projects \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=await this.collectProjectsSummary(t);if(!n){new Y.Notice("\uC9C4\uD589 \uC911\uC778 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let i=await this.gemini.getFocus(n);if(i.length===0){new Y.Notice("\uCD94\uCC9C\uD560 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new EF(this.app,i).open()}catch(t){console.error("Focus \uBD84\uC11D \uC624\uB958:",t),new Y.Notice(`\uBD84\uC11D \uC2E4\uD328: ${t}`)}}}async collectProjectsSummary(t){let n=[];for(let i of t.children)if(i instanceof Y.TFolder){let r=i.name,o=await this.getProjectInfo(i);n.push(`- ${r}: ${o}`)}return n.join(`
`)}async getProjectInfo(t){let n=[`${t.name} (MOC).md`,`${t.name} MOC.md`,"MOC.md","README.md"];for(let l of n){let u=`${t.path}/${l}`,h=this.app.vault.getAbstractFileByPath(u);if(h instanceof Y.TFile){let d=await this.app.vault.read(h),c=this.extractFrontmatter(d),a=c.summary||c.description||"",f=c.next_action||c.nextAction||"";if(a||f)return`${a} (\uB2E4\uC74C: ${f})`}}let i=[];for(let l of t.children)l instanceof Y.TFile&&l.extension==="md"&&i.push({file:l,mtime:l.stat.mtime});i.sort((l,u)=>u.mtime-l.mtime);let r=i.slice(0,3);return r.length===0?"(\uB178\uD2B8 \uC5C6\uC74C)":`\uCD5C\uADFC \uC791\uC5C5: ${r.map(l=>l.file.basename).join(", ")}`}extractFrontmatter(t){let n=/^---\n([\s\S]*?)\n---/,i=t.match(n);if(!i)return{};let r={},o=i[1].split(`
`);for(let l of o){let u=l.indexOf(":");if(u!==-1){let h=l.slice(0,u).trim(),d=l.slice(u+1).trim();r[h]=d}}return r}async processInbox(){if(!this.checkApiKey())return;let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof Y.TFolder)){new Y.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=0,i=0,r=this.settings.triggerTag,o=[];for(let h of t.children)h instanceof Y.TFile&&h.extension==="md"&&(await this.app.vault.read(h)).includes(r)&&o.push(h);if(o.length===0){new Y.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new Y.Notice(`${o.length}\uAC1C \uD30C\uC77C \uCC98\uB9AC \uC2DC\uC791...`);let l=this.mocManager?.getProjectList()||[],u=this.feedbackManager?.generatePromptContext();for(let h=0;h<o.length;h++){let d=o[h];try{new Y.Notice(`\uCC98\uB9AC \uC911: ${h+1}/${o.length} - ${d.name}`,2e3);let c=await this.app.vault.read(d),a=await this.gemini.classifyProject(c,l,u);await this.applyClassifyResult(d,a),n++}catch(c){console.error(`\uCC98\uB9AC \uC2E4\uD328: ${d.name}`,c),i++}}new Y.Notice(`\uC644\uB8CC: ${n}\uAC1C \uCC98\uB9AC, ${i}\uAC1C \uC2E4\uD328`)}toggleWatch(){this.watcherRegistered?(this.stopWatcher(),new Y.Notice("Watch \uC911\uC9C0\uB428")):(this.startWatcher(),new Y.Notice("Watch \uC2DC\uC791\uB428"))}startWatcher(){this.watcherRegistered||(this.registerEvent(this.app.vault.on("create",t=>{t instanceof Y.TFile&&(this.onFileChange(t),this.scheduleEmbeddingUpdate(t))})),this.registerEvent(this.app.vault.on("modify",t=>{t instanceof Y.TFile&&(this.onFileChange(t),this.scheduleEmbeddingUpdate(t))})),this.registerEvent(this.app.vault.on("delete",t=>{t instanceof Y.TFile&&(this.relatedNoteFinder?.removeFromIndex(t.path),this.mocManager?.removeFromIndex(t.path),this.embeddingManager?.removeNote(t.path),this.embeddingManager?.saveIndex(),console.log(`\uC778\uB371\uC2A4\uC5D0\uC11C \uC81C\uAC70: ${t.path}`))})),this.registerEvent(this.app.vault.on("rename",(t,n)=>{t instanceof Y.TFile&&(this.embeddingManager?.renameNote(n,t.path),this.embeddingManager?.saveIndex())})),this.watcherRegistered=!0,console.log("Inbox \uAC10\uC2DC \uC2DC\uC791"))}stopWatcher(){this.watcherRegistered=!1,this.pendingFiles.clear(),console.log("Inbox \uAC10\uC2DC \uC911\uC9C0")}scheduleEmbeddingUpdate(t){if(!this.settings.embeddingEnabled||!this.settings.autoEmbeddingEnabled||!this.embeddingManager||t.extension!=="md")return;let n=this.pendingEmbeddings.get(t.path);n&&clearTimeout(n);let i=setTimeout(async()=>{this.pendingEmbeddings.delete(t.path),await this.embeddingManager?.updateNoteEmbedding(t,!1)&&(await this.embeddingManager?.saveIndex(),console.log("Embedding \uC790\uB3D9 \uC5C5\uB370\uC774\uD2B8:",t.path))},5e3);this.pendingEmbeddings.set(t.path,i)}onFileChange(t){this.watcherRegistered&&this.gemini&&t.path.startsWith(this.settings.inboxFolder)&&t.extension==="md"&&(this.pendingFiles.set(t.path,Date.now()),this.processDebounced())}async processPendingFiles(){if(!this.gemini)return;let t=Date.now(),n=this.settings.triggerTag,i=this.mocManager?.getProjectList()||[],r=this.feedbackManager?.generatePromptContext();for(let[o,l]of this.pendingFiles.entries()){if(t-l<3e3)continue;this.pendingFiles.delete(o);let u=this.app.vault.getAbstractFileByPath(o);if(u instanceof Y.TFile)try{let h=await this.app.vault.read(u);if(!h.includes(n))continue;let d=await this.gemini.classifyProject(h,i,r);await this.applyClassifyResult(u,d),new Y.Notice(`\uC790\uB3D9 \uBD84\uB958: ${u.name} \u2192 ${d.targetType}${d.projectName?` (${d.projectName})`:""}`)}catch(h){console.error(`\uC790\uB3D9 \uBD84\uB958 \uC2E4\uD328: ${o}`,h)}}}async ocrCurrentFile(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new Y.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new Y.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.workspace.getActiveFile();if(!t){new Y.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase();if(n==="md"){try{let o=await this.app.vault.read(t),l=this.extractEmbeddedImages(o);if(l.length===0){new Y.Notice("\uC784\uBCA0\uB4DC\uB41C \uC774\uBBF8\uC9C0\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new Y.Notice(`\uC784\uBCA0\uB4DC\uB41C \uC774\uBBF8\uC9C0 ${l.length}\uC7A5 OCR \uCC98\uB9AC \uC911...`);let u=this.ocrProcessor.checkLimitsForMultipleImages(l);if(!u.allowed){new Y.Notice(`OCR \uC81C\uD55C: ${u.reason}`);return}let h=await this.ocrProcessor.processMultipleImages(l,t.basename),c=this.ocrProcessor.generateMarkdownNote(h)+`
---
## \uC6D0\uBCF8 \uC774\uBBF8\uC9C0
${l.map(a=>`![[${a.name}]]`).join(`
`)}`;await this.app.vault.modify(t,c),new Y.Notice(`OCR \uC644\uB8CC: ${l.length}\uC7A5 \uCC98\uB9AC\uB428`)}catch(o){console.error("OCR \uC624\uB958:",o),new Y.Notice(`OCR \uC2E4\uD328: ${o}`)}return}if(!["png","jpg","jpeg","webp","gif","pdf"].includes(n)){new Y.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`);return}let r=await this.ocrProcessor.checkLimits(t);if(!r.allowed){new ob(this.app,r.reason,t,this).open();return}new Y.Notice("OCR \uCC98\uB9AC \uC911...");try{let o=await this.ocrProcessor.processFile(t),l=this.ocrProcessor.generateMarkdownNote(o),u=t.basename+"_OCR.md",h=`${this.settings.inboxFolder}/${u}`;if(await this.app.vault.create(h,l),this.settings.ocrMoveOriginal){let d=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(d)||await this.app.vault.createFolder(d);let a=`${d}/${t.name}`;await this.app.fileManager.renameFile(t,a)}new Y.Notice(`OCR \uC644\uB8CC: ${u} \uC0DD\uC131\uB428 (${o.pages}\uD398\uC774\uC9C0)`)}catch(o){console.error("OCR \uC624\uB958:",o),new Y.Notice(`OCR \uC2E4\uD328: ${o}`)}}async processInboxOCR(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new Y.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new Y.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof Y.TFolder)){new Y.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=["png","jpg","jpeg","webp","gif","pdf"],i=[];for(let l of t.children){if(!(l instanceof Y.TFile))continue;let u=l.extension.toLowerCase();if(!n.includes(u))continue;(await this.ocrProcessor.checkLimits(l)).allowed&&i.push(l)}if(i.length===0){new Y.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new Y.Notice(`${i.length}\uAC1C \uD30C\uC77C OCR \uCC98\uB9AC \uC2DC\uC791...`);let r=0,o=0;for(let l=0;l<i.length;l++){let u=i[l];try{new Y.Notice(`OCR \uC911: ${l+1}/${i.length} - ${u.name}`,3e3);let h=await this.ocrProcessor.processFile(u),d=this.ocrProcessor.generateMarkdownNote(h),c=u.basename+"_OCR.md",a=`${this.settings.inboxFolder}/${c}`;if(await this.app.vault.create(a,d),this.settings.ocrMoveOriginal){let f=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(f)||await this.app.vault.createFolder(f);let g=`${f}/${u.name}`;await this.app.fileManager.renameFile(u,g)}r++,l<i.length-1&&await new Promise(f=>setTimeout(f,1e3))}catch(h){console.error(`OCR \uCC98\uB9AC \uC2E4\uD328: ${u.name}`,h),o++}}new Y.Notice(`OCR \uC644\uB8CC: ${r}\uAC1C \uCC98\uB9AC, ${o}\uAC1C \uC2E4\uD328`)}async smartProcessCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new Y.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase();if(["pdf","png","jpg","jpeg","webp","gif"].includes(n)){if(!this.settings.ocrEnabled){new Y.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new Y.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let r=await this.ocrProcessor.checkLimits(t);if(!r.allowed){new ob(this.app,r.reason,t,this).open();return}new Y.Notice("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let o=await this.ocrProcessor.processFile(t);new Y.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let l=await this.gemini.summarizePDF(o.text,this.settings.detailedSummary),u=this.ocrProcessor.generateSummarizedNote(o,l),h=t.basename+"_OCR.md",d=`${this.settings.inboxFolder}/${h}`,c=await this.app.vault.create(d,u);if(this.settings.ocrMoveOriginal){let m=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(m)||await this.app.vault.createFolder(m);let _=`${m}/${t.name}`;await this.app.fileManager.renameFile(t,_)}let a=this.mocManager?.getProjectList()||[],f=this.feedbackManager?.generatePromptContext(),p=await this.gemini.classifyProject(u,a,f),g=await this.applyClassifyResultWithConfirmation(c,p);if(p.title&&g){let m=oi(p.title),y=g.parent?.path||"",_=y?`${y}/${m}.md`:`${m}.md`;_!==g.path&&await this.app.fileManager.renameFile(g,_)}new Y.Notice(`\uC644\uB8CC: OCR(${o.pages}p) \u2192 ${p.targetType}${p.projectName?` (${p.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(o){console.error("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC624\uB958:",o),new Y.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${o}`)}}else if(n==="md")try{let r=await this.app.vault.read(t),o=this.extractEmbeddedImages(r);if(o.length>0&&this.settings.ocrEnabled&&this.ocrProcessor){new Y.Notice(`\uC784\uBCA0\uB4DC\uB41C \uC774\uBBF8\uC9C0 ${o.length}\uC7A5 \uAC10\uC9C0\uB428. \uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC911...`);let l=this.ocrProcessor.checkLimitsForMultipleImages(o);if(!l.allowed){new Y.Notice(`OCR \uC81C\uD55C: ${l.reason}`),await this.classifyMarkdownContent(t,r);return}let u=await this.ocrProcessor.processMultipleImages(o,t.basename);new Y.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let h=await this.gemini.summarizePDF(u.text,this.settings.detailedSummary),d=`---
type: ocr
source_note: "${t.basename}"
pages: ${u.pages}
---

# ${h.title}

## \uC694\uC57D
${h.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${h.keyPoints.map(g=>`- ${g}`).join(`
`)}

---
## \uC6D0\uBCF8 \uC774\uBBF8\uC9C0
${o.map(g=>`![[${g.name}]]`).join(`
`)}
`;await this.app.vault.modify(t,d);let c=this.mocManager?.getProjectList()||[],a=this.feedbackManager?.generatePromptContext(),f=await this.gemini.classifyProject(d,c,a),p=await this.applyClassifyResultWithConfirmation(t,f);if(h.title&&p){let g=oi(h.title),m=p.parent?.path||"",y=m?`${m}/${g}.md`:`${g}.md`;y!==p.path&&(await this.app.fileManager.renameFile(p,y),p=this.app.vault.getAbstractFileByPath(y))}new Y.Notice(`\uC644\uB8CC: OCR(${u.pages}\uC7A5) \u2192 ${f.targetType}${f.projectName?` (${f.projectName})`:""}`),await this.findAndShowRelatedNotes(p,d,h.title),await this.detectAndSaveSchedules(d,p);return}await this.classifyMarkdownContent(t,r)}catch(r){console.error("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC624\uB958:",r),new Y.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${r}`)}else new Y.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}getOCRDailyUsage(){return this.ocrProcessor?this.ocrProcessor.getDailyUsage():{date:$i(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}async initUsageTracker(){this.usageTracker=new vb(this.app,this.settings,()=>this.getDataPath()),await this.usageTracker.loadUsage(),this.settings.usageShowStatusBar&&(this.usageStatusBarEl=this.addStatusBarItem(),this.usageStatusBarEl.addClass("zfb-usage-statusbar"),this.usageStatusBarEl.addEventListener("click",()=>{this.app.setting.open(),this.app.setting.openTabById("zero-friction-brain")}),this.usageTracker.setStatusBarEl(this.usageStatusBarEl)),this.gemini&&this.gemini.setUsageTracker(this.usageTracker)}async toggleUsageTracker(t){t&&!this.usageTracker?await this.initUsageTracker():!t&&this.usageTracker&&(await this.usageTracker.saveUsage(),this.usageTracker=null,this.gemini&&this.gemini.setUsageTracker(null),this.usageStatusBarEl&&(this.usageStatusBarEl.remove(),this.usageStatusBarEl=null))}getDataPath(){return this.settings.dataStorageLocation==="vault"?this.settings.dataFolderPath:".obsidian/plugins/zero-friction-brain"}},wF=class extends Y.Modal{constructor(e,t,n,i){super(e),this.candidates=t,this.selected=new Set(t.map((r,o)=>o)),this.sourceFile=n,this.plugin=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"ZK \uC544\uC774\uB514\uC5B4 \uC120\uD0DD"}),e.createEl("p",{text:"\uC0DD\uC131\uD560 Zettelkasten \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let t=e.createDiv({cls:"zk-candidate-list"});this.candidates.forEach((o,l)=>{let u=t.createDiv({cls:"zk-candidate-item"}),h=u.createEl("input",{type:"checkbox",attr:{checked:!0}});h.addEventListener("change",()=>{h.checked?this.selected.add(l):this.selected.delete(l)});let d=u.createDiv({cls:"zk-candidate-label"});d.createEl("strong",{text:o.title}),d.createEl("p",{text:o.body,cls:"zk-candidate-body"}),d.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${o.keywords.join(", ")}`,cls:"zk-candidate-keywords"})});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{let o=this.candidates.filter((l,u)=>this.selected.has(u));o.length>0&&await this.plugin.createZKNotes(o,this.sourceFile),this.close()})}onClose(){this.contentEl.empty()}},xF=class extends Y.Modal{constructor(e,t,n,i){super(e),this.candidate=t,this.similarNote=n,this.onResult=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC720\uC0AC\uD55C \uB178\uD2B8 \uBC1C\uACAC"}),e.createEl("p",{text:`\uC0C8 \uC544\uC774\uB514\uC5B4\uC640 ${Math.round(this.similarNote.relevance*100)}% \uC720\uC0AC\uD55C \uB178\uD2B8\uAC00 \uC788\uC2B5\uB2C8\uB2E4.`,cls:"setting-item-description"});let t=e.createDiv({cls:"merge-section"});t.createEl("h4",{text:"\uC0C8 \uC544\uC774\uB514\uC5B4"}),t.createEl("p",{text:this.candidate.title,cls:"merge-title"}),t.createEl("p",{text:this.candidate.body,cls:"merge-body"});let n=e.createDiv({cls:"merge-section"});n.createEl("h4",{text:"\uAE30\uC874 \uB178\uD2B8"});let i=this.similarNote.note.path.split("/").pop()?.replace(/\.md$/,"")||this.similarNote.note.title;n.createEl("p",{text:i,cls:"merge-title"}),n.createEl("p",{text:`\uD0A4\uC6CC\uB4DC: ${this.similarNote.note.keywords.join(", ")}`,cls:"merge-keywords"});let r=e.createDiv({cls:"merge-buttons"});r.createEl("button",{text:"\uAE30\uC874 \uB178\uD2B8\uC5D0 \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",()=>{this.onResult(!0),this.close()}),r.createEl("button",{text:"\uC0C8 \uB178\uD2B8 \uC0DD\uC131"}).addEventListener("click",()=>{this.onResult(!1),this.close()})}onClose(){this.contentEl.empty()}},EF=class extends Y.Modal{constructor(e,t){super(e),this.items=t}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC624\uB298 \uC9D1\uC911\uD560 \uD504\uB85C\uC81D\uD2B8 Top 3"});let t=e.createDiv({cls:"focus-list"});this.items.forEach((r,o)=>{let l=t.createDiv({cls:"focus-item"});l.createEl("h3",{text:`${o+1}. ${r.title}`}),l.createEl("p",{text:r.why,cls:"focus-why"}),l.createEl("p",{text:`\u2192 ${r.nextAction}`,cls:"focus-action"})}),e.createDiv({cls:"modal-button-container"}).createEl("button",{text:"\uB2EB\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}},ob=class extends Y.Modal{constructor(e,t,n,i){super(e),this.reason=t,this.file=n,this.plugin=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uD30C\uC77C\uC774 \uB108\uBB34 \uD07D\uB2C8\uB2E4"}),e.createEl("p",{text:this.reason}),e.createEl("p",{text:"\uC124\uC815\uC5D0\uC11C \uC81C\uD55C\uC744 \uC870\uC815\uD558\uAC70\uB098, \uD30C\uC77C\uC744 \uBD84\uD560\uD574\uC11C \uCC98\uB9AC\uD558\uC138\uC694.",cls:"setting-item-description"});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"\uC124\uC815 \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.app.setting.open()})}onClose(){this.contentEl.empty()}},SF=class extends Y.Modal{constructor(t,n,i,r,o=null){super(t);this.choiceMade=!1;this.relatedNotes=n,this.selected=new Set(n.map((l,u)=>u)),this.currentFile=i,this.finder=r,this.feedbackManager=o}recordFeedback(t,n,i){this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"related_notes",noteTitle:this.currentFile.basename,aiSuggestion:{suggestedNotePaths:this.relatedNotes.map(r=>r.note.path)},userChoice:{accepted:t.length>0,rejectedItems:n.map(r=>r.note.path),dismissed:i}})}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uAD00\uB828 \uB178\uD2B8 \uBC1C\uACAC"}),t.createEl("p",{text:"\uC5F0\uACB0\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let n=t.createDiv({cls:"related-notes-list"});this.relatedNotes.forEach((l,u)=>{let h=n.createDiv({cls:"related-note-item"}),d=h.createEl("input",{type:"checkbox",attr:{checked:!0}});d.addEventListener("change",()=>{d.checked?this.selected.add(u):this.selected.delete(u)});let c=h.createDiv({cls:"related-note-label"}),a=l.note.path.split("/").pop()?.replace(/\.md$/,"")||l.note.title;c.createEl("strong",{text:a});let f=Math.round(l.relevance*100);c.createEl("span",{text:` (${f}%)`,cls:"related-note-relevance"}),l.matchedKeywords.length>0&&c.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${l.matchedKeywords.join(", ")}`,cls:"related-note-keywords"})});let i=t.createDiv({cls:"modal-button-container"});i.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback([],this.relatedNotes,!1),this.close()}),i.createEl("button",{text:"\uB9C1\uD06C \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",async()=>{this.choiceMade=!0;let l=this.relatedNotes.filter((h,d)=>this.selected.has(d)),u=this.relatedNotes.filter((h,d)=>!this.selected.has(d));this.recordFeedback(l,u,!1),l.length>0&&(await this.finder.addRelatedLinks(this.currentFile,l),new Y.Notice(`${l.length}\uAC1C \uAD00\uB828 \uB178\uD2B8 \uB9C1\uD06C \uCD94\uAC00\uB428`)),this.close()})}onClose(){this.choiceMade||this.recordFeedback([],this.relatedNotes,!0),this.contentEl.empty()}},TF=class extends Y.Modal{constructor(e,t,n,i,r,o){super(e),this.projectName=t,this.noteFile=n,this.noteTitle=i,this.mocManager=r,this.projectsFolder=o}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 \uAC10\uC9C0"}),e.createEl("p",{text:`"${this.projectName}" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC0C8\uB85C \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`}),e.createEl("p",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8\uC758 MOC(Map of Content)\uB97C \uC0DD\uC131\uD560\uAE4C\uC694?",cls:"setting-item-description"});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"MOC \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{await this.mocManager.createProjectMOC(this.projectName,this.projectsFolder)?(await this.mocManager.addNoteToMOC(this.projectName,this.noteTitle,this.noteFile.path),new Y.Notice(`\u{1F4C1} ${this.projectName} MOC \uC0DD\uC131 \uBC0F \uC5F0\uACB0 \uC644\uB8CC`)):new Y.Notice("MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4"),this.close()})}onClose(){this.contentEl.empty()}},AF=class extends Y.Modal{constructor(e,t,n){super(e),this.mocManager=t,this.projectsFolder=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131"}),e.createEl("p",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 MOC\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4. \uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694.",cls:"setting-item-description"});let t=e.createDiv({cls:"moc-input-container"});if(t.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uC774\uB984:"}),this.inputEl=t.createEl("input",{type:"text",placeholder:"\uC608: \uC2A4\uB9C8\uD2B8\uD31C"}),this.inputEl.style.width="100%",this.inputEl.style.marginTop="8px",this.inputEl.style.padding="8px",this.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.createMOC()}),this.mocManager&&this.mocManager.getMOCCount()>0){let o=e.createDiv({cls:"existing-mocs"});o.createEl("h4",{text:"\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 MOC:"});let l=o.createEl("ul");for(let u of this.mocManager.getProjectList())l.createEl("li",{text:u})}let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createMOC()),setTimeout(()=>this.inputEl.focus(),10)}async createMOC(){let e=this.inputEl.value.trim();if(!e){new Y.Notice("\uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694");return}if(!this.mocManager){new Y.Notice("MOC \uAD00\uB9AC\uC790\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4"),this.close();return}if(this.mocManager.getProjectList().includes(e)){new Y.Notice(`"${e}" MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4`);return}let n=await this.mocManager.createProjectMOC(e,this.projectsFolder);n?(new Y.Notice(`\u{1F4C1} ${e} MOC \uC0DD\uC131 \uC644\uB8CC`),this.app.workspace.getLeaf().openFile(n)):new Y.Notice("MOC \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4"),this.close()}onClose(){this.contentEl.empty()}},CF=class extends Y.Modal{constructor(e,t,n,i,r){super(e),this.title=t,this.description=n,this.placeholder=i,this.onSubmit=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.title}),e.createEl("p",{text:this.description,cls:"setting-item-description"});let t=e.createDiv({cls:"url-input-container"});this.inputEl=t.createEl("input",{type:"text",placeholder:this.placeholder}),this.inputEl.style.width="100%",this.inputEl.style.padding="8px",navigator.clipboard.readText().then(o=>{o&&(o.startsWith("http://")||o.startsWith("https://"))&&(this.inputEl.value=o)}).catch(()=>{}),this.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.submit()});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uAC00\uC838\uC624\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.submit()),setTimeout(()=>this.inputEl.focus(),10)}async submit(){let e=this.inputEl.value.trim();if(!e){new Y.Notice("URL\uC744 \uC785\uB825\uD558\uC138\uC694");return}this.close(),await this.onSubmit(e)}onClose(){this.contentEl.empty()}},IF=class extends Y.Modal{constructor(e,t,n,i){super(e),this.sections=t,this.selected=new Set(t.map((r,o)=>o)),this.sourceFile=n,this.plugin=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uACB0\uACFC"}),e.createEl("p",{text:`${this.sections.length}\uAC1C\uC758 \uC139\uC158\uC73C\uB85C \uBD84\uB9AC\uB428. \uC0DD\uC131\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let t=e.createDiv({cls:"split-section-list"});this.sections.forEach((o,l)=>{let u=t.createDiv({cls:"split-section-item"});u.style.marginBottom="16px",u.style.padding="12px",u.style.border="1px solid var(--background-modifier-border)",u.style.borderRadius="8px";let h=u.createDiv({cls:"split-section-header"});h.style.display="flex",h.style.alignItems="center",h.style.gap="8px";let d=h.createEl("input",{type:"checkbox",attr:{checked:!0}});d.addEventListener("change",()=>{d.checked?this.selected.add(l):this.selected.delete(l)}),h.createEl("strong",{text:o.title});let c=h.createDiv({cls:"split-section-badges"});c.style.marginLeft="auto",c.style.display="flex",c.style.gap="4px";let a=c.createEl("span",{text:o.targetType,cls:"split-category-badge"});if(a.style.padding="2px 8px",a.style.borderRadius="4px",a.style.fontSize="12px",a.style.backgroundColor=this.getTargetTypeColor(o.targetType),a.style.color="white",o.project){let g=c.createEl("span",{text:o.project.startsWith("NEW:")?`\u2728 ${o.project.slice(4)}`:`\u{1F4C1} ${o.project}`,cls:"split-project-badge"});g.style.padding="2px 8px",g.style.borderRadius="4px",g.style.fontSize="12px",g.style.backgroundColor="var(--interactive-accent)",g.style.color="white"}let f=u.createDiv({cls:"split-section-preview"});f.style.marginTop="8px",f.style.fontSize="13px",f.style.color="var(--text-muted)",f.style.maxHeight="60px",f.style.overflow="hidden",f.style.textOverflow="ellipsis";let p=o.content.length>150?o.content.slice(0,150)+"...":o.content;if(f.setText(p),o.keywords.length>0){let g=u.createDiv({cls:"split-section-keywords"});g.style.marginTop="8px",g.style.fontSize="12px",g.setText(`\uD0A4\uC6CC\uB4DC: ${o.keywords.join(", ")}`)}});let n=e.createDiv({cls:"modal-button-container"});n.style.marginTop="16px",n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:`${this.selected.size}\uAC1C \uB178\uD2B8 \uC0DD\uC131`,cls:"mod-cta"}).addEventListener("click",async()=>{let o=this.sections.filter((l,u)=>this.selected.has(u));o.length>0&&(this.close(),await this.plugin.createSplitNotes(o,this.sourceFile))})}getTargetTypeColor(e){switch(e){case"project":return"#e67e22";case"library":return"#27ae60";case"archive":return"#95a5a6";default:return"#7f8c8d"}}onClose(){this.contentEl.empty()}},DF=class extends Y.Modal{constructor(t,n,i,r=null){super(t);this.choiceMade=!1;this.result=n,this.onChoice=i,this.feedbackManager=r}recordFeedback(t){this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"reference_location",noteTitle:this.result.title,aiSuggestion:{targetType:this.result.targetType,projectName:this.result.projectName},userChoice:{accepted:t!==null&&this.result.targetType==="project"&&t==="project",modified:t||void 0,dismissed:t===null}})}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC800\uC7A5 \uC704\uCE58 \uC120\uD0DD"});let n=t.createDiv({cls:"reference-confirm-info"});n.style.marginBottom="16px",n.style.padding="12px",n.style.backgroundColor="var(--background-secondary)",n.style.borderRadius="8px",n.createEl("p",{text:`"${this.result.title}"`,cls:"reference-title"}).style.fontWeight="bold",n.createEl("p",{text:`\uAD00\uB828 \uD504\uB85C\uC81D\uD2B8: ${this.result.projectName}`,cls:"reference-project"}).style.color="var(--text-muted)",n.createEl("p",{text:"\uC774 \uC790\uB8CC\uB294 \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB85C \uBCF4\uC785\uB2C8\uB2E4. \uC5B4\uB514\uC5D0 \uC800\uC7A5\uD560\uAE4C\uC694?",cls:"reference-question"}).style.marginTop="8px";let i=t.createDiv({cls:"reference-options"});i.style.display="flex",i.style.flexDirection="column",i.style.gap="12px";let r=i.createDiv({cls:"reference-option"});r.style.padding="12px",r.style.border="1px solid var(--background-modifier-border)",r.style.borderRadius="8px",r.style.cursor="pointer",r.addEventListener("mouseenter",()=>{r.style.backgroundColor="var(--background-secondary)"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor=""}),r.createEl("strong",{text:"\u{1F4C1} \uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC800\uC7A5"}),r.createEl("p",{text:`Projects/${this.result.projectName}/ \uC5D0 \uC800\uC7A5`,cls:"option-desc"}).style.color="var(--text-muted)",r.createEl("small",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8 \uC804\uC6A9 \uC790\uB8CC\uB85C \uAD00\uB9AC"}).style.color="var(--text-faint)",r.addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback("project"),this.close(),this.onChoice("project")});let o=i.createDiv({cls:"reference-option"});o.style.padding="12px",o.style.border="2px solid var(--interactive-accent)",o.style.borderRadius="8px",o.style.cursor="pointer",o.style.backgroundColor="var(--background-secondary)",o.createEl("strong",{text:"\u{1F4DA} Library\uC5D0 \uC800\uC7A5 + \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C (\uAD8C\uC7A5)"}),o.createEl("p",{text:"Library/ \uC5D0 \uC800\uC7A5\uD558\uACE0 \uD504\uB85C\uC81D\uD2B8\uC640 \uC5F0\uACB0",cls:"option-desc"}).style.color="var(--text-muted)",o.createEl("small",{text:"\uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5"}).style.color="var(--text-faint)",o.addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback("library"),this.close(),this.onChoice("library")});let l=t.createDiv({cls:"modal-button-container"});l.style.marginTop="16px",l.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close())}onClose(){this.choiceMade||this.recordFeedback(null),this.contentEl.empty()}},kF=class extends Y.Modal{constructor(e,t){super(e),this.plugin=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("zfb-command-list-modal");let t=e.createEl("h2",{text:"\u{1F9E0} Zero Friction Brain"});t.style.marginBottom="16px",t.style.textAlign="center";let n=[{name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkey:"Ctrl+Shift+G",icon:"folder",action:()=>this.plugin.classifyCurrentFile()},{name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkey:"Ctrl+Shift+L",icon:"link",action:()=>this.plugin.linkRelatedNotesForCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkey:"Ctrl+Shift+S",icon:"sparkles",action:()=>this.plugin.smartProcessCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkey:"Ctrl+Shift+D",icon:"split",action:()=>this.plugin.smartSplitCurrentFile()},{name:"ZK \uCD94\uCD9C",hotkey:"Ctrl+Shift+Z",icon:"file-plus",action:()=>this.plugin.extractZKFromCurrentFile()},{name:"URL \uAC00\uC838\uC624\uAE30",hotkey:"Ctrl+Shift+U",icon:"globe",action:()=>this.plugin.showURLImportModal()},{name:"Focus Top 3",hotkey:"Ctrl+Shift+;",icon:"target",action:()=>this.plugin.showFocusTop3()},{name:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC",hotkey:"Ctrl+Shift+R",icon:"calendar-check",action:()=>this.plugin.showReviewModal()},{name:"OCR \uCD94\uCD9C",hotkey:"Ctrl+Shift+O",icon:"scan",action:()=>this.plugin.ocrCurrentFile()},{divider:!0},{name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",hotkey:"",icon:"inbox",action:()=>this.plugin.processInbox()},{name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",hotkey:"",icon:"map",action:()=>this.plugin.showCreateMOCModal()},{name:"ZK Index \uC7AC\uAD6C\uCD95",hotkey:"",icon:"refresh-cw",action:()=>this.plugin.rebuildZKIndex()},{name:"Watch \uD1A0\uAE00",hotkey:"",icon:"eye",action:()=>this.plugin.toggleWatch()}],i=e.createDiv({cls:"zfb-command-list"});i.style.display="flex",i.style.flexDirection="column",i.style.gap="4px";for(let l of n){if("divider"in l&&l.divider){let c=i.createEl("hr");c.style.margin="8px 0",c.style.border="none",c.style.borderTop="1px solid var(--background-modifier-border)";continue}let u=i.createDiv({cls:"zfb-command-item"});u.style.display="flex",u.style.alignItems="center",u.style.justifyContent="space-between",u.style.padding="10px 12px",u.style.borderRadius="6px",u.style.cursor="pointer",u.style.transition="background-color 0.1s",u.addEventListener("mouseenter",()=>{u.style.backgroundColor="var(--background-secondary)"}),u.addEventListener("mouseleave",()=>{u.style.backgroundColor=""});let h=u.createDiv();h.style.display="flex",h.style.alignItems="center",h.style.gap="10px";let d=h.createSpan({cls:"zfb-command-icon"});if((0,Y.setIcon)(d,l.icon||"command"),d.style.opacity="0.7",h.createSpan({text:l.name}),l.hotkey){let c=u.createSpan({text:l.hotkey,cls:"zfb-command-hotkey"});c.style.fontSize="0.85em",c.style.color="var(--text-muted)",c.style.backgroundColor="var(--background-secondary)",c.style.padding="2px 8px",c.style.borderRadius="4px",c.style.fontFamily="monospace"}u.addEventListener("click",()=>{this.close(),l.action()})}let r=e.createDiv({cls:"zfb-command-footer"});r.style.marginTop="16px",r.style.paddingTop="12px",r.style.borderTop="1px solid var(--background-modifier-border)",r.style.textAlign="center",r.style.color="var(--text-muted)",r.style.fontSize="0.85em",r.createSpan({text:`v${this.plugin.manifest.version} \u2022 `});let o=r.createEl("a",{text:"\uC124\uC815"});o.style.cursor="pointer",o.addEventListener("click",()=>{this.close(),this.app.setting.open(),this.app.setting.openTabById("zero-friction-brain")})}onClose(){this.contentEl.empty()}},RF=class extends Y.Modal{constructor(t,n,i){super(t);this.selectedPeriod="week";this.resultContainer=null;this.isLoading=!1;this.reviewManager=n,this.settings=i}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-review-modal"),t.createEl("h2",{text:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC"});let n=t.createDiv({cls:"zfb-review-period-section"});n.createEl("label",{text:"\uAE30\uAC04 \uC120\uD0DD:",cls:"setting-item-name"});let i=n.createDiv({cls:"zfb-period-buttons"});i.style.display="flex",i.style.gap="8px",i.style.marginTop="8px",i.style.marginBottom="16px",[{value:"today",label:"\uC624\uB298"},{value:"week",label:"\uC774\uBC88 \uC8FC"},{value:"month",label:"\uC774\uBC88 \uB2EC"}].forEach(({value:f,label:p})=>{let g=i.createEl("button",{text:p});g.style.padding="8px 16px",g.style.borderRadius="6px",g.style.cursor="pointer",f===this.selectedPeriod&&g.addClass("mod-cta"),g.addEventListener("click",()=>{this.selectedPeriod=f,i.querySelectorAll("button").forEach(m=>m.removeClass("mod-cta")),g.addClass("mod-cta"),this.loadNotes()})});let o=t.createDiv({cls:"zfb-review-filter-section"});o.style.marginBottom="16px",o.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uD544\uD130 (\uC120\uD0DD):",cls:"setting-item-name"});let l=o.createEl("select");l.style.marginLeft="8px",l.style.padding="4px 8px";let u=l.createEl("option",{text:"\uC804\uCCB4",value:""});u.value="",this.reviewManager.getProjectList().forEach(f=>{let p=l.createEl("option",{text:f,value:f});p.value=f}),l.addEventListener("change",()=>{this.projectFilter=l.value||void 0,this.loadNotes()}),this.resultContainer=t.createDiv({cls:"zfb-review-results"}),this.resultContainer.style.marginTop="16px",this.resultContainer.style.maxHeight="400px",this.resultContainer.style.overflowY="auto";let d=t.createDiv({cls:"modal-button-container"});d.style.marginTop="16px",d.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close()),d.createEl("button",{text:"AI \uBD84\uC11D \uBC0F \uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createReviewNote()),this.loadNotes()}async loadNotes(){if(!(!this.resultContainer||this.isLoading)){this.isLoading=!0,this.resultContainer.empty(),this.resultContainer.createEl("p",{text:"\uB178\uD2B8 \uC218\uC9D1 \uC911...",cls:"zfb-loading"});try{let t={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.collectNotes(t),i=this.reviewManager.groupByProject(n);this.renderResults(n,i)}catch(t){console.error("\uB178\uD2B8 \uC218\uC9D1 \uC2E4\uD328:",t),this.resultContainer.empty(),this.resultContainer.createEl("p",{text:`\uC624\uB958: ${t}`,cls:"zfb-error"})}finally{this.isLoading=!1}}}renderResults(t,n){if(!this.resultContainer)return;if(this.resultContainer.empty(),t.length===0){this.resultContainer.createEl("p",{text:"\uD574\uB2F9 \uAE30\uAC04\uC5D0 \uC791\uC5C5\uD55C \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.",cls:"zfb-empty-message"});return}let i=this.resultContainer.createDiv({cls:"zfb-review-summary"});i.style.padding="12px",i.style.backgroundColor="var(--background-secondary)",i.style.borderRadius="8px",i.style.marginBottom="16px";let r=Cf(this.selectedPeriod,this.settings.timezone);i.createEl("p",{text:`${r.label} \uC791\uC5C5: ${t.length}\uAC1C \uB178\uD2B8, ${n.length}\uAC1C \uD504\uB85C\uC81D\uD2B8/\uC601\uC5ED`});for(let o of n){let l=this.resultContainer.createDiv({cls:"zfb-review-group"});l.style.marginBottom="16px";let u=l.createEl("h4",{text:`\u{1F4C1} ${o.projectName} (${o.noteCount}\uAC1C)`});u.style.marginBottom="8px",u.style.borderBottom="1px solid var(--background-modifier-border)",u.style.paddingBottom="4px";let h=l.createEl("ul");h.style.listStyle="none",h.style.paddingLeft="16px",h.style.margin="0";for(let d of o.notes){let c=h.createEl("li");c.style.display="flex",c.style.justifyContent="space-between",c.style.alignItems="center",c.style.padding="4px 0";let a=c.createEl("a",{text:d.title});a.style.cursor="pointer",a.style.color="var(--text-accent)",a.addEventListener("click",async()=>{this.app.vault.getAbstractFileByPath(d.path)instanceof Y.TFile&&await this.app.workspace.openLinkText(d.path,"")});let f=c.createEl("span",{text:uL(d.modified),cls:"zfb-note-time"});f.style.fontSize="0.85em",f.style.color="var(--text-muted)"}}}async createReviewNote(){if(!this.isLoading){this.isLoading=!0,new Y.Notice("AI \uBD84\uC11D \uC911...");try{let t={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.analyze(t),i=await this.reviewManager.createReviewNote(n);new Y.Notice(`\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131\uB428: ${i.basename}`),await this.app.workspace.openLinkText(i.path,""),this.close()}catch(t){console.error("\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328:",t),new Y.Notice(`\uC0DD\uC131 \uC2E4\uD328: ${t}`)}finally{this.isLoading=!1}}}onClose(){this.contentEl.empty()}};
/*! Bundled license information:

onnxruntime-common/dist/ort-common.node.js:
  (*!
   * ONNX Runtime Common v1.14.0
   * Copyright (c) Microsoft Corporation. All rights reserved.
   * Licensed under the MIT License.
   *)

onnxruntime-web/dist/ort-web.min.js:
  (*!
  * ONNX Runtime Web v1.14.0
  * Copyright (c) Microsoft Corporation. All rights reserved.
  * Licensed under the MIT License.
  *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
