/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var sp=Object.defineProperty;var hP=Object.getOwnPropertyDescriptor;var fP=Object.getOwnPropertyNames;var pP=Object.prototype.hasOwnProperty;var gP=(i,e,t)=>e in i?sp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var mP=(i,e)=>()=>(i&&(e=i(i=0)),e);var jT=(i,e)=>{for(var t in e)sp(i,t,{get:e[t],enumerable:!0})},yP=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of fP(e))!pP.call(i,s)&&s!==t&&sp(i,s,{get:()=>e[s],enumerable:!(n=hP(e,s))||n.enumerable});return i};var vP=i=>yP(sp({},"__esModule",{value:!0}),i);var Y=(i,e,t)=>(gP(i,typeof e!="symbol"?e+"":e,t),t),Fb=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var h=(i,e,t)=>(Fb(i,e,"read from private field"),t?t.call(i):e.get(i)),E=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},w=(i,e,t,n)=>(Fb(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t);var bt=(i,e,t,n)=>({set _(s){w(i,e,s,t)},get _(){return h(i,e,n)}}),A=(i,e,t)=>(Fb(i,e,"access private method"),t);var $b={};jT($b,{DEFAULT_CHUNK_OVERLAP:()=>Ts,DEFAULT_CHUNK_SIZE:()=>Cs,DEFAULT_FEEDBACK_STORE:()=>td,DEFAULT_SETTINGS:()=>Nr,DEFAULT_USAGE_STORAGE:()=>Na,DEFAULT_USER_PREFERENCES:()=>rp,GEMINI_PRICING:()=>op,MIN_CHUNK_SIZE:()=>nd,PARAGRAPH_SPLIT_REGEX:()=>Ob,SECTION_SPLIT_REGEX:()=>Lb,USAGE_FEATURE_LABELS:()=>Ub,USAGE_FILE_DESKTOP:()=>id,USAGE_FILE_MOBILE:()=>ap,USAGE_FILE_NAME:()=>Hb,USAGE_STORAGE_MODE_OPTIONS:()=>Bb,createEmptyDailySummary:()=>sd});function sd(i){return{date:i,totalInputTokens:0,totalOutputTokens:0,totalCalls:0,callsByFeature:{classify:0,ocr:0,youtube:0,webpage:0,zk:0,related:0,chat:0,embedding:0,review:0,meeting:0,schedule:0,split:0,focus:0,other:0},estimatedCostUSD:0}}var Nr,rp,td,Cs,Ts,nd,Lb,Ob,op,Ub,Bb,Hb,id,ap,Na,jn=mP(()=>{Nr={geminiApiKey:"",inboxFolder:"00 _Inbox",projectsFolder:"01 Projects",libraryFolder:"02 Library",archivesFolder:"03 Archives",zettelFolder:"10 Zettelkasten",autoWatch:!0,triggerTag:"#\uC644\uB8CC",language:"ko",ocrEnabled:!0,ocrAutoProcess:!1,ocrMoveOriginal:!0,ocrOriginalFolder:"03 Archives/OCR_\uC6D0\uBCF8",ocrMinTextThreshold:50,ocrMaxPages:20,ocrMaxFileSizeMB:10,ocrDailyLimit:50,detailedSummary:!1,zkIdType:"date-sequence",zkMergeThreshold:.8,timezone:"auto",dateFormat:"local",scheduleDetectionEnabled:!0,dailyNotesFolder:"00 _Inbox",googleCalendarEnabled:!1,useOwnApiKey:!1,googleClientId:"",googleClientSecret:"",googleAccessToken:"",googleRefreshToken:"",googleTokenExpiry:0,calendarEnabled:!0,calendarDefaultView:"month",calendarFirstDayOfWeek:0,showMiniCalendar:!0,calendarEngine:"fullcalendar",embeddingEnabled:!1,embeddingSimilarityThreshold:.7,autoEmbeddingEnabled:!0,embeddingChunkSize:500,embeddingChunkOverlap:50,ragEnabled:!0,ragTopK:5,ragMaxContextLength:8e3,onboardingCompleted:!1,preset:"custom",lastNotifiedVersion:void 0,dataStorageLocation:"plugin",dataFolderPath:".zfb-data",youtubeTemplate:`---
type: youtube
source: "{{url}}"
title: "{{escapedTitle}}"
created: {{date}}
---

# {{title}}

{{iframe}}

## \uC694\uC57D
{{summary}}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
{{keyPoints}}
`,webpageTemplate:`---
type: webpage
source: "{{url}}"
title: "{{escapedTitle}}"
created: {{date}}
---

# {{title}}

{{bookmark}}

{{iframe}}

## \uC694\uC57D
{{summary}}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
{{keyPoints}}
`,usageTrackingEnabled:!1,usageStorageMode:"daily30",usageShowStatusBar:!0},rp={version:1,feedback:{referenceLocation:{toLibrary:0,toProject:0,preference:"neutral"},scheduleDetection:{accepted:0,rejected:0,falsePositivePatterns:[]},projectClassification:{corrections:[]}},restructure:{accepted:0,rejected:0,preferredFormats:[],preference:"neutral"},embedding:{acceptedPairs:[],rejectedPairs:[],similarityThresholdAdjustment:0},rag:{frequentQuestions:[],preferredNotes:[],feedbackOnAnswers:{helpful:0,notHelpful:0}}},td={version:1,entries:[],preferences:rp,lastUpdated:new Date().toISOString()},Cs=500,Ts=50,nd=100,Lb=/(?=^## )/m,Ob=/\n\n+/,op={"gemini-3-flash-preview":{inputPer1M:.5,outputPer1M:3},"gemini-2.0-flash":{inputPer1M:.1,outputPer1M:.4},"gemini-2.0-flash-lite":{inputPer1M:.075,outputPer1M:.3},"gemini-1.5-flash":{inputPer1M:.075,outputPer1M:.3},"gemini-1.5-pro":{inputPer1M:1.25,outputPer1M:5},"text-embedding-004":{inputPer1M:0,outputPer1M:0},"gemini-embedding-001":{inputPer1M:.15,outputPer1M:0}},Ub={classify:"\uBD84\uB958",ocr:"OCR",youtube:"YouTube",webpage:"\uC6F9\uD398\uC774\uC9C0",zk:"ZK \uCD94\uCD9C",related:"\uAD00\uB828 \uB178\uD2B8",chat:"\uCC57\uBD07",embedding:"\uC784\uBCA0\uB529",review:"\uD68C\uACE0",meeting:"\uD68C\uC758\uB85D",schedule:"\uC77C\uC815",split:"\uBD84\uB9AC",focus:"Focus",other:"\uAE30\uD0C0"},Bb=[{value:"today",label:"\uC624\uB298\uB9CC",desc:"\uC571 \uC7AC\uC2DC\uC791 \uC2DC \uCD08\uAE30\uD654"},{value:"daily30",label:"\uC77C\uBCC4 30\uC77C",desc:"\uCD5C\uADFC 30\uC77C \uB370\uC774\uD130 \uBCF4\uAD00"},{value:"daily90",label:"\uC77C\uBCC4 90\uC77C",desc:"\uCD5C\uADFC 90\uC77C \uB370\uC774\uD130 \uBCF4\uAD00"},{value:"monthly12",label:"\uC6D4\uBCC4 12\uAC1C\uC6D4",desc:"\uC6D4\uBCC4 \uC9D1\uACC4 12\uAC1C\uC6D4 \uBCF4\uAD00"}],Hb="usage.json",id="usage-desktop.json",ap="usage-mobile.json",Na={version:1,storageMode:"daily30",dailySummaries:[],monthlySummaries:[],lastUpdated:new Date().toISOString()}});var YG={};jT(YG,{default:()=>Nb});module.exports=vP(YG);var D=require("obsidian");jn();var QT=require("obsidian");jn();var lp=class{constructor(e,t,n){this.statusBarEl=null;this.saveDebounceTimer=null;this.app=e,this.settings=t,this.getDataPath=n,this.storage={...Na},this.mergedStorage={...Na}}getCurrentPlatformFileName(){return QT.Platform.isMobile?ap:id}setStatusBarEl(e){this.statusBarEl=e,this.updateStatusBar()}updateSettings(e){this.settings=e}recordUsage(e,t,n,s){if(!this.settings.usageTrackingEnabled)return;let r=this.getTodayDate(),o=this.calculateCost(t,n,s);this.updateDailySummary(this.storage,r,e,t,n,o),this.updateDailySummary(this.mergedStorage,r,e,t,n,o),this.updateStatusBar(),this.debouncedSave()}updateDailySummary(e,t,n,s,r,o){let a=e.dailySummaries.find(l=>l.date===t);a||(a=sd(t),e.dailySummaries.push(a)),a.totalInputTokens+=s,a.totalOutputTokens+=r,a.totalCalls+=1,a.callsByFeature[n]=(a.callsByFeature[n]||0)+1,a.estimatedCostUSD+=o}getTodayUsage(){let e=this.getTodayDate();return this.mergedStorage.dailySummaries.find(t=>t.date===e)||null}getThisMonthUsage(){let e=this.getTodayDate().substring(0,7),t=this.mergedStorage.dailySummaries.filter(n=>n.date.startsWith(e));return{inputTokens:t.reduce((n,s)=>n+s.totalInputTokens,0),outputTokens:t.reduce((n,s)=>n+s.totalOutputTokens,0),calls:t.reduce((n,s)=>n+s.totalCalls,0),cost:t.reduce((n,s)=>n+s.estimatedCostUSD,0)}}getUsageHistory(e){let t=new Date;t.setDate(t.getDate()-e);let n=t.toISOString().split("T")[0];return this.mergedStorage.dailySummaries.filter(s=>s.date>=n).sort((s,r)=>r.date.localeCompare(s.date))}calculateCost(e,t,n){let s=op[n]||op["gemini-3-flash-preview"],r=e/1e6*s.inputPer1M,o=t/1e6*s.outputPer1M;return r+o}updateStatusBar(){if(!this.statusBarEl||!this.settings.usageShowStatusBar){this.statusBarEl&&this.statusBarEl.empty();return}let e=this.getTodayUsage();if(!e){this.statusBarEl.setText("\u{1F9E0} 0/0");return}let t=r=>r>=1e3?(r/1e3).toFixed(1)+"K":r.toString(),n=t(e.totalInputTokens),s=t(e.totalOutputTokens);this.statusBarEl.setText(`\u{1F9E0} ${n}/${s}`)}pruneOldData(){let e=this.settings.usageStorageMode,t=new Date;switch(e){case"today":let n=this.getTodayDate();this.storage.dailySummaries=this.storage.dailySummaries.filter(c=>c.date===n);break;case"daily30":let s=new Date(t);s.setDate(s.getDate()-30),this.storage.dailySummaries=this.storage.dailySummaries.filter(c=>c.date>=s.toISOString().split("T")[0]);break;case"daily90":let r=new Date(t);r.setDate(r.getDate()-90),this.storage.dailySummaries=this.storage.dailySummaries.filter(c=>c.date>=r.toISOString().split("T")[0]);break;case"monthly12":this.aggregateToMonthly();let o=new Date(t);o.setMonth(o.getMonth()-12);let a=o.toISOString().substring(0,7);this.storage.monthlySummaries=(this.storage.monthlySummaries||[]).filter(c=>c.month>=a);let l=t.toISOString().substring(0,7);this.storage.dailySummaries=this.storage.dailySummaries.filter(c=>c.date.startsWith(l));break}this.storage.storageMode=e}async saveUsage(){let e=this.getDataPath(),t=this.getCurrentPlatformFileName(),n=`${e}/${t}`;this.storage.lastUpdated=new Date().toISOString();try{await this.app.vault.adapter.write(n,JSON.stringify(this.storage,null,2))}catch(s){console.error("[UsageTracker] \uC800\uC7A5 \uC2E4\uD328:",s)}}async loadUsage(){let e=this.getDataPath(),t=this.app.vault.adapter;await this.migrateLegacyFile(e);let n=await this.loadPlatformFile(e,id),s=await this.loadPlatformFile(e,ap),r=this.getCurrentPlatformFileName();this.storage=r===id?n:s,this.mergedStorage=this.mergeDailyData(n,s),this.storage.storageMode!==this.settings.usageStorageMode&&this.pruneOldData(),this.updateStatusBar()}async migrateLegacyFile(e){let t=this.app.vault.adapter,n=`${e}/${Hb}`,s=`${e}/${this.getCurrentPlatformFileName()}`;try{if(await t.exists(n)&&!await t.exists(s)){let r=await t.read(n);await t.write(s,r),await t.remove(n),console.log("[UsageTracker] \uB808\uAC70\uC2DC \uD30C\uC77C \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC644\uB8CC")}}catch(r){console.error("[UsageTracker] \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC2E4\uD328:",r)}}async loadPlatformFile(e,t){let n=this.app.vault.adapter,s=`${e}/${t}`;try{if(await n.exists(s)){let r=await n.read(s);return JSON.parse(r)}}catch(r){console.error(`[UsageTracker] ${t} \uB85C\uB4DC \uC2E4\uD328:`,r)}return{...Na}}mergeDailyData(e,t){let n={version:1,storageMode:this.settings.usageStorageMode,dailySummaries:[],monthlySummaries:[],lastUpdated:new Date().toISOString()},s=new Set;e.dailySummaries.forEach(r=>s.add(r.date)),t.dailySummaries.forEach(r=>s.add(r.date));for(let r of s){let o=e.dailySummaries.find(c=>c.date===r),a=t.dailySummaries.find(c=>c.date===r),l=sd(r);if(o){l.totalInputTokens+=o.totalInputTokens,l.totalOutputTokens+=o.totalOutputTokens,l.totalCalls+=o.totalCalls,l.estimatedCostUSD+=o.estimatedCostUSD;for(let[c,d]of Object.entries(o.callsByFeature))l.callsByFeature[c]=(l.callsByFeature[c]||0)+d}if(a){l.totalInputTokens+=a.totalInputTokens,l.totalOutputTokens+=a.totalOutputTokens,l.totalCalls+=a.totalCalls,l.estimatedCostUSD+=a.estimatedCostUSD;for(let[c,d]of Object.entries(a.callsByFeature))l.callsByFeature[c]=(l.callsByFeature[c]||0)+d}n.dailySummaries.push(l)}return n.dailySummaries.sort((r,o)=>o.date.localeCompare(r.date)),n}async resetUsage(){this.storage={...Na},this.storage.storageMode=this.settings.usageStorageMode,await this.saveUsage(),await this.loadUsage()}exportToCSV(){let e=["Date","Input Tokens","Output Tokens","Total Calls","Estimated Cost (USD)","classify","ocr","youtube","webpage","zk","related","chat","embedding","review","meeting","schedule","split","focus","other"],t=this.mergedStorage.dailySummaries.map(n=>[n.date,n.totalInputTokens,n.totalOutputTokens,n.totalCalls,n.estimatedCostUSD.toFixed(6),n.callsByFeature.classify||0,n.callsByFeature.ocr||0,n.callsByFeature.youtube||0,n.callsByFeature.webpage||0,n.callsByFeature.zk||0,n.callsByFeature.related||0,n.callsByFeature.chat||0,n.callsByFeature.embedding||0,n.callsByFeature.review||0,n.callsByFeature.meeting||0,n.callsByFeature.schedule||0,n.callsByFeature.split||0,n.callsByFeature.focus||0,n.callsByFeature.other||0]);return[e.join(","),...t.map(n=>n.join(","))].join(`
`)}getTodayDate(){return new Date().toISOString().split("T")[0]}debouncedSave(){this.saveDebounceTimer&&clearTimeout(this.saveDebounceTimer),this.saveDebounceTimer=setTimeout(()=>{this.saveUsage(),this.saveDebounceTimer=null},5e3)}aggregateToMonthly(){let e=new Map;for(let n of this.storage.dailySummaries){let s=n.date.substring(0,7),r=e.get(s);r||(r={month:s,totalInputTokens:0,totalOutputTokens:0,totalCalls:0,callsByFeature:{...sd("").callsByFeature},estimatedCostUSD:0,dailyAverage:{inputTokens:0,outputTokens:0,calls:0}},e.set(s,r)),r.totalInputTokens+=n.totalInputTokens,r.totalOutputTokens+=n.totalOutputTokens,r.totalCalls+=n.totalCalls,r.estimatedCostUSD+=n.estimatedCostUSD;for(let[o,a]of Object.entries(n.callsByFeature))r.callsByFeature[o]=(r.callsByFeature[o]||0)+a}for(let n of e.values()){let s=this.storage.dailySummaries.filter(r=>r.date.startsWith(n.month)).length;s>0&&(n.dailyAverage={inputTokens:Math.round(n.totalInputTokens/s),outputTokens:Math.round(n.totalOutputTokens/s),calls:Math.round(n.totalCalls/s)})}let t=new Map((this.storage.monthlySummaries||[]).map(n=>[n.month,n]));for(let[n,s]of e)t.set(n,s);this.storage.monthlySummaries=Array.from(t.values()).sort((n,s)=>s.month.localeCompare(n.month))}};var O=require("obsidian");var n_=[{value:"auto",label:"\uC790\uB3D9 \uAC10\uC9C0"},{value:"Asia/Seoul",label:"\uD55C\uAD6D (KST, UTC+9)"},{value:"Asia/Tokyo",label:"\uC77C\uBCF8 (JST, UTC+9)"},{value:"Asia/Shanghai",label:"\uC911\uAD6D (CST, UTC+8)"},{value:"America/New_York",label:"\uBBF8\uAD6D \uB3D9\uBD80 (EST/EDT)"},{value:"America/Los_Angeles",label:"\uBBF8\uAD6D \uC11C\uBD80 (PST/PDT)"},{value:"Europe/London",label:"\uC601\uAD6D (GMT/BST)"},{value:"UTC",label:"UTC"}],i_=[{value:"iso",label:"ISO \uD615\uC2DD (2026-01-05T16:24:45+09:00)"},{value:"local",label:"\uB85C\uCEEC \uD615\uC2DD (2026-01-05 16:24:45)"},{value:"friendly",label:"\uCE5C\uADFC\uD55C \uD615\uC2DD (2026\uB144 1\uC6D4 5\uC77C 16:24)"}];function cp(i){return i==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:i}function Vb(i,e,t){let n=cp(e);switch(t){case"iso":return bP(i,n);case"local":return e_(i,n);case"friendly":return EP(i,n);default:return e_(i,n)}}function bP(i,e){let t={timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",t).formatToParts(i),s=p=>n.find(m=>m.type===p)?.value||"",r=s("year"),o=s("month"),a=s("day"),l=s("hour"),c=s("minute"),d=s("second"),u=SP(i,e);return`${r}-${o}-${a}T${l}:${c}:${d}${u}`}function e_(i,e){let t={timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("en-CA",t).formatToParts(i),s=u=>n.find(p=>p.type===u)?.value||"",r=s("year"),o=s("month"),a=s("day"),l=s("hour"),c=s("minute"),d=s("second");return`${r}-${o}-${a} ${l}:${c}:${d}`}function EP(i,e){let t={timeZone:e,year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};return new Intl.DateTimeFormat("ko-KR",t).format(i)}function SP(i,e){let t=new Date(i.toLocaleString("en-US",{timeZone:"UTC"})),s=(new Date(i.toLocaleString("en-US",{timeZone:e})).getTime()-t.getTime())/(1e3*60);if(s===0)return"Z";let r=s>=0?"+":"-",o=Math.abs(s),a=Math.floor(o/60),l=o%60;return`${r}${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}`}function Be(i,e){let n={timeZone:cp(e),year:"numeric",month:"2-digit",day:"2-digit"},s=new Intl.DateTimeFormat("en-CA",n).formatToParts(i),r=o=>s.find(a=>a.type===o)?.value||"";return`${r("year")}-${r("month")}-${r("day")}`}function Pe(i,e){return Vb(new Date,i,e)}function Qn(i){return Be(new Date,i)}function rd(i,e){let t=cp(e),n=new Date;switch(i){case"today":return t_(n,t);case"week":return wP(n,t);case"month":return AP(n,t);default:return t_(n,t)}}function t_(i,e){let t=Gb(i,e),n=zb(i,e);return{start:t,end:n,label:"\uC624\uB298"}}function wP(i,e){let t=i.getDay(),n=t===0?6:t-1,s=new Date(i);s.setDate(s.getDate()-n);let r=new Date(s);return r.setDate(r.getDate()+6),{start:Gb(s,e),end:zb(r,e),label:"\uC774\uBC88 \uC8FC"}}function AP(i,e){let t=new Date(i.getFullYear(),i.getMonth(),1),n=new Date(i.getFullYear(),i.getMonth()+1,0);return{start:Gb(t,e),end:zb(n,e),label:"\uC774\uBC88 \uB2EC"}}function Gb(i,e){let t=new Date(i);return t.setHours(0,0,0,0),t}function zb(i,e){let t=new Date(i);return t.setHours(23,59,59,999),t}function s_(i,e){return i>=e.start&&i<=e.end}function Wb(i){let e=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);let n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e.getTime()-n.getTime())/864e5+1)/7)}function r_(i,e,t){let n=cp(t);switch(i){case"today":return`${Be(e,n)} \uC77C\uC77C \uD68C\uACE0.md`;case"week":let s=Wb(e);return`${e.getFullYear()}-W${String(s).padStart(2,"0")} \uC8FC\uAC04 \uD68C\uACE0.md`;case"month":return`${Be(e,n).substring(0,7)} \uC6D4\uAC04 \uD68C\uACE0.md`;default:return`${Be(e,n)} \uD68C\uACE0.md`}}function o_(i){let t=new Date().getTime()-i.getTime(),n=Math.floor(t/(1e3*60)),s=Math.floor(t/(1e3*60*60)),r=Math.floor(t/(1e3*60*60*24));return n<1?"\uBC29\uAE08 \uC804":n<60?`${n}\uBD84 \uC804`:s<24?`${s}\uC2DC\uAC04 \uC804`:r===1?"\uC5B4\uC81C":r<7?`${r}\uC77C \uC804`:r<30?`${Math.floor(r/7)}\uC8FC \uC804`:`${Math.floor(r/30)}\uAC1C\uC6D4 \uC804`}var qb=4,a_="https://aistudio.google.com/app/apikey",dp={basic:{autoWatch:!1,ocrEnabled:!0,embeddingEnabled:!1,ragEnabled:!1,calendarEnabled:!1,scheduleDetectionEnabled:!1,googleCalendarEnabled:!1,showMiniCalendar:!1},power:{autoWatch:!0,ocrEnabled:!0,embeddingEnabled:!0,ragEnabled:!0,calendarEnabled:!0,scheduleDetectionEnabled:!0,googleCalendarEnabled:!1,showMiniCalendar:!0},experimental:{autoWatch:!0,ocrEnabled:!0,embeddingEnabled:!0,ragEnabled:!0,calendarEnabled:!0,scheduleDetectionEnabled:!0,googleCalendarEnabled:!1,showMiniCalendar:!0},custom:{}},xt={basic:{icon:"\u{1F680}",label:"\uAE30\uBCF8 \uBAA8\uB4DC",shortDesc:"\uBD84\uB958 + URL \uC694\uC57D",longDesc:`\uB178\uD2B8 \uBD84\uB958 + URL \uC694\uC57D
\uAC00\uBCCD\uAC8C \uC2DC\uC791\uD558\uAE30 \uC88B\uC544\uC694`},power:{icon:"\u{1F4AA}",label:"\uD30C\uC6CC \uBAA8\uB4DC (\uAD8C\uC7A5)",shortDesc:"\uC804\uCCB4 \uAE30\uB2A5",longDesc:`\uC804\uCCB4 \uAE30\uB2A5 \uD65C\uC131\uD654
Embedding, RAG \uCC57\uBD07, \uCE98\uB9B0\uB354`},experimental:{icon:"\u{1F9EA}",label:"\uC2E4\uD5D8 \uBAA8\uB4DC",shortDesc:"Beta \uD3EC\uD568",longDesc:`Beta \uAE30\uB2A5 \uD3EC\uD568
\uC0C8\uB85C\uC6B4 \uAE30\uB2A5\uC744 \uBA3C\uC800 \uCCB4\uD5D8`},custom:{icon:"\u2699\uFE0F",label:"\uC0AC\uC6A9\uC790 \uC815\uC758",shortDesc:"\uC9C1\uC811 \uC124\uC815",longDesc:"\uAC1C\uBCC4 \uC124\uC815\uC744 \uC9C1\uC811 \uC870\uC815\uD569\uB2C8\uB2E4"}},up=["geminiApiKey","googleAccessToken","googleRefreshToken","googleClientId","googleClientSecret","googleTokenExpiry","inboxFolder","projectsFolder","libraryFolder","archivesFolder","zettelFolder","dailyNotesFolder","ocrOriginalFolder","timezone","dateFormat","zkIdType","onboardingCompleted","lastNotifiedVersion","language","dataStorageLocation","dataFolderPath","autoEmbeddingEnabled"],ke="ZFB: ",dn={EMBEDDINGS:"embeddings.json",EMBEDDINGS_DESKTOP:"embeddings-desktop.json",EMBEDDINGS_MOBILE:"embeddings-mobile.json",CHATS:"chats.json",FEEDBACK:"feedback.json"},Fa=".obsidian/plugins/zero-friction-brain";jn();var hp=class extends O.PluginSettingTab{constructor(t,n){super(t,n);this.showAdvancedSettings=!1;this.plugin=n}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Zero Friction Brain \uC124\uC815"}),t.createEl("h3",{text:"\uBE60\uB978 \uC2DC\uC791"});let n=this.plugin.settings.preset||"custom";new O.Setting(t).setName("\uC124\uC815 \uD504\uB9AC\uC14B").setDesc("\uC0AC\uC6A9 \uD328\uD134\uC5D0 \uB9DE\uB294 \uD504\uB9AC\uC14B\uC744 \uC120\uD0DD\uD558\uC138\uC694").addDropdown(a=>a.addOption("basic",`${xt.basic.icon} ${xt.basic.label}`).addOption("power",`${xt.power.icon} ${xt.power.label}`).addOption("experimental",`${xt.experimental.icon} ${xt.experimental.label}`).addOption("custom",`${xt.custom.icon} ${xt.custom.label}`).setValue(n).onChange(async l=>{let c=l;c!=="custom"?(this.applyPreset(c),new O.Notice(`${xt[c].icon} ${xt[c].label} \uC801\uC6A9\uB428`)):(this.plugin.settings.preset="custom",await this.plugin.saveSettings()),this.display()}));let s=t.createDiv({cls:"zfb-preset-description"});if(this.renderPresetDescription(s,n),n!=="custom"&&(new O.Setting(t).setName("\uACE0\uAE09 \uC124\uC815 \uD45C\uC2DC").setDesc("\uC138\uBD80 \uC124\uC815\uC744 \uC9C1\uC811 \uC870\uC815\uD569\uB2C8\uB2E4").addToggle(a=>a.setValue(this.showAdvancedSettings).onChange(l=>{this.showAdvancedSettings=l,this.display()})),!this.showAdvancedSettings))return;if(t.createEl("hr"),t.createEl("h3",{text:"API \uC124\uC815"}),new O.Setting(t).setName("Gemini API \uD0A4").setDesc(createFragment(a=>{a.appendText("Gemini API \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694. "),a.createEl("a",{text:"API \uD0A4 \uBC1C\uAE09\uBC1B\uAE30",href:"https://aistudio.google.com/apikey"})})).addText(a=>a.setPlaceholder("AIzaSy...").setValue(this.plugin.settings.geminiApiKey).onChange(async l=>{this.plugin.settings.geminiApiKey=l,await this.plugin.saveSettings()})),t.createEl("h3",{text:"\uD3F4\uB354 \uC124\uC815"}),new O.Setting(t).setName("Inbox \uD3F4\uB354").setDesc("\uC0C8 \uB178\uD2B8\uAC00 \uC800\uC7A5\uB418\uB294 \uD3F4\uB354").addText(a=>a.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.inboxFolder).onChange(async l=>{this.plugin.settings.inboxFolder=l,await this.plugin.saveSettings()})),new O.Setting(t).setName("Projects \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uBCC4 \uD558\uC704 \uD3F4\uB354\uAC00 \uC0DD\uC131\uB429\uB2C8\uB2E4").addText(a=>a.setPlaceholder("01 Projects").setValue(this.plugin.settings.projectsFolder).onChange(async l=>{this.plugin.settings.projectsFolder=l,await this.plugin.saveSettings()})),new O.Setting(t).setName("Library \uD3F4\uB354").setDesc("\uD504\uB85C\uC81D\uD2B8\uC5D0 \uC18D\uD558\uC9C0 \uC54A\uB294 \uCC38\uACE0 \uC790\uB8CC").addText(a=>a.setPlaceholder("02 Library").setValue(this.plugin.settings.libraryFolder).onChange(async l=>{this.plugin.settings.libraryFolder=l,await this.plugin.saveSettings()})),new O.Setting(t).setName("Archives \uD3F4\uB354").setDesc("\uC644\uB8CC\uB41C \uD504\uB85C\uC81D\uD2B8 (\uD1B5\uC9F8\uB85C \uC774\uB3D9)").addText(a=>a.setPlaceholder("03 Archives").setValue(this.plugin.settings.archivesFolder).onChange(async l=>{this.plugin.settings.archivesFolder=l,await this.plugin.saveSettings()})),new O.Setting(t).setName("Zettelkasten \uD3F4\uB354").setDesc("ZK \uC601\uAD6C \uB178\uD2B8 \uC800\uC7A5 \uC704\uCE58").addText(a=>a.setPlaceholder("10 Zettelkasten").setValue(this.plugin.settings.zettelFolder).onChange(async l=>{this.plugin.settings.zettelFolder=l,await this.plugin.saveSettings()})),new O.Setting(t).setName("\uD3F4\uB354 \uAD6C\uC870 \uC0DD\uC131").setDesc("\uC704\uC5D0 \uC124\uC815\uB41C \uD3F4\uB354\uB4E4\uC744 \uC790\uB3D9\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4").addButton(a=>a.setButtonText("\uD3F4\uB354 \uC0DD\uC131").setCta().onClick(async()=>{await this.createFolderStructure()})),t.createEl("h3",{text:"\uC635\uC158"}),new O.Setting(t).setName("Inbox \uC790\uB3D9 \uAC10\uC2DC").setDesc("Inbox \uD3F4\uB354\uC758 \uD30C\uC77C\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC2DC\uD558\uC5EC \uBD84\uB958").addToggle(a=>a.setValue(this.plugin.settings.autoWatch).onChange(async l=>{this.plugin.settings.autoWatch=l,await this.plugin.saveSettings(),l?this.plugin.startWatcher():this.plugin.stopWatcher()})),new O.Setting(t).setName("\uD2B8\uB9AC\uAC70 \uD0DC\uADF8").setDesc("\uC774 \uD0DC\uADF8\uAC00 \uC788\uB294 \uB178\uD2B8\uB9CC \uC790\uB3D9 \uBD84\uB958 (\uC608: #\uC644\uB8CC)").addText(a=>a.setPlaceholder("#\uC644\uB8CC").setValue(this.plugin.settings.triggerTag).onChange(async l=>{this.plugin.settings.triggerTag=l,await this.plugin.saveSettings()})),t.createEl("h3",{text:"OCR \uC124\uC815"}),new O.Setting(t).setName("OCR \uAE30\uB2A5 \uD65C\uC131\uD654").setDesc("\uC774\uBBF8\uC9C0 \uBC0F PDF\uC5D0\uC11C \uD14D\uC2A4\uD2B8 \uCD94\uCD9C").addToggle(a=>a.setValue(this.plugin.settings.ocrEnabled).onChange(async l=>{this.plugin.settings.ocrEnabled=l,await this.plugin.saveSettings()})),new O.Setting(t).setName("OCR \uD6C4 \uC6D0\uBCF8 \uC774\uB3D9").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC744 \uC9C0\uC815 \uD3F4\uB354\uB85C \uC774\uB3D9").addToggle(a=>a.setValue(this.plugin.settings.ocrMoveOriginal).onChange(async l=>{this.plugin.settings.ocrMoveOriginal=l,await this.plugin.saveSettings()})),new O.Setting(t).setName("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uD3F4\uB354").setDesc("OCR \uCC98\uB9AC \uD6C4 \uC6D0\uBCF8 \uD30C\uC77C\uC774 \uC774\uB3D9\uB420 \uD3F4\uB354").addText(a=>a.setPlaceholder("03 Archives/OCR_\uC6D0\uBCF8").setValue(this.plugin.settings.ocrOriginalFolder).onChange(async l=>{this.plugin.settings.ocrOriginalFolder=l,await this.plugin.saveSettings()})),t.createEl("h3",{text:"OCR \uC81C\uD55C (API \uC694\uAE08 \uBCF4\uD638)"}),new O.Setting(t).setName("\uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").setDesc("\uD55C \uBC88\uC5D0 \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 PDF \uD398\uC774\uC9C0 \uC218").addSlider(a=>a.setLimits(1,100,1).setValue(this.plugin.settings.ocrMaxPages).setDynamicTooltip().onChange(async l=>{this.plugin.settings.ocrMaxPages=l,await this.plugin.saveSettings()})).addExtraButton(a=>a.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (20)").onClick(async()=>{this.plugin.settings.ocrMaxPages=20,await this.plugin.saveSettings(),this.display()})),new O.Setting(t).setName("\uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30 (MB)").setDesc("\uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD30C\uC77C \uD06C\uAE30").addSlider(a=>a.setLimits(1,50,1).setValue(this.plugin.settings.ocrMaxFileSizeMB).setDynamicTooltip().onChange(async l=>{this.plugin.settings.ocrMaxFileSizeMB=l,await this.plugin.saveSettings()})).addExtraButton(a=>a.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (10)").onClick(async()=>{this.plugin.settings.ocrMaxFileSizeMB=10,await this.plugin.saveSettings(),this.display()})),new O.Setting(t).setName("\uC77C\uC77C \uCC98\uB9AC \uD55C\uB3C4 (\uD398\uC774\uC9C0)").setDesc("\uD558\uB8E8\uC5D0 OCR \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uCD5C\uB300 \uD398\uC774\uC9C0 \uC218").addSlider(a=>a.setLimits(10,500,10).setValue(this.plugin.settings.ocrDailyLimit).setDynamicTooltip().onChange(async l=>{this.plugin.settings.ocrDailyLimit=l,await this.plugin.saveSettings()})).addExtraButton(a=>a.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (50)").onClick(async()=>{this.plugin.settings.ocrDailyLimit=50,await this.plugin.saveSettings(),this.display()})),t.createDiv({cls:"ocr-usage-info"}).createEl("p",{text:`\uC624\uB298 \uC0AC\uC6A9\uB7C9: ${this.plugin.getOCRDailyUsage().pagesProcessed}/${this.plugin.settings.ocrDailyLimit} \uD398\uC774\uC9C0`,cls:"setting-item-description"}),t.createEl("h3",{text:"AI \uC694\uC57D \uC124\uC815"}),new O.Setting(t).setName("\uC0C1\uC138 \uC694\uC57D").setDesc("\uD65C\uC131\uD654 \uC2DC \uB354 \uAE34 \uC694\uC57D(8-15\uBB38\uC7A5)\uACFC \uB354 \uB9CE\uC740 \uD575\uC2EC \uD3EC\uC778\uD2B8(10-20\uAC1C)\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4. OCR, YouTube, \uC6F9\uD398\uC774\uC9C0 \uC694\uC57D\uC5D0 \uC801\uC6A9\uB429\uB2C8\uB2E4.").addToggle(a=>a.setValue(this.plugin.settings.detailedSummary).onChange(async l=>{this.plugin.settings.detailedSummary=l,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Zettelkasten \uC124\uC815"}),new O.Setting(t).setName("ZK \uB178\uD2B8 ID \uD615\uC2DD").setDesc("ZK \uB178\uD2B8 \uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uD560 ID \uD615\uC2DD").addDropdown(a=>a.addOption("timestamp","\uD0C0\uC784\uC2A4\uD0EC\uD504 (1735789200000)").addOption("date-sequence","\uB0A0\uC9DC+\uC21C\uBC88 (20260102-001)").addOption("luhmann","\uB8E8\uB9CC \uC2A4\uD0C0\uC77C (1a1b)").setValue(this.plugin.settings.zkIdType).onChange(async l=>{this.plugin.settings.zkIdType=l,await this.plugin.saveSettings()})),new O.Setting(t).setName("\uC720\uC0AC \uB178\uD2B8 \uBCD1\uD569 \uC784\uACC4\uAC12").setDesc("\uC774 \uAC12 \uC774\uC0C1\uC758 \uC720\uC0AC\uB3C4\uB97C \uAC00\uC9C4 \uB178\uD2B8\uAC00 \uC788\uC73C\uBA74 \uBCD1\uD569 \uC81C\uC548 (0.5~1.0)").addSlider(a=>a.setLimits(.5,1,.05).setValue(this.plugin.settings.zkMergeThreshold).setDynamicTooltip().onChange(async l=>{this.plugin.settings.zkMergeThreshold=l,await this.plugin.saveSettings()})).addExtraButton(a=>a.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (0.8)").onClick(async()=>{this.plugin.settings.zkMergeThreshold=.8,await this.plugin.saveSettings(),this.display()})),t.createEl("h3",{text:"\uC2DC\uAC04\uB300 \uBC0F \uB0A0\uC9DC \uD615\uC2DD"}),new O.Setting(t).setName("\uC2DC\uAC04\uB300").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504\uC5D0 \uC0AC\uC6A9\uD560 \uC2DC\uAC04\uB300").addDropdown(a=>{n_.forEach(l=>{a.addOption(l.value,l.label)}),a.setValue(this.plugin.settings.timezone).onChange(async l=>{this.plugin.settings.timezone=l,await this.plugin.saveSettings()})}),new O.Setting(t).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD0C0\uC784\uC2A4\uD0EC\uD504 \uD45C\uC2DC \uD615\uC2DD").addDropdown(a=>{i_.forEach(l=>{a.addOption(l.value,l.label)}),a.setValue(this.plugin.settings.dateFormat).onChange(async l=>{this.plugin.settings.dateFormat=l,await this.plugin.saveSettings()})}),t.createEl("h3",{text:"\uC77C\uC815 \uAC10\uC9C0"}),new O.Setting(t).setName("\uC77C\uC815 \uC790\uB3D9 \uAC10\uC9C0").setDesc("\uB178\uD2B8 \uBD84\uB958 \uC2DC \uC77C\uC815/\uD560\uC77C/\uC57D\uC18D\uC744 \uC790\uB3D9\uC73C\uB85C \uAC10\uC9C0").addToggle(a=>a.setValue(this.plugin.settings.scheduleDetectionEnabled).onChange(async l=>{this.plugin.settings.scheduleDetectionEnabled=l,await this.plugin.saveSettings()})),new O.Setting(t).setName("Daily Notes \uD3F4\uB354").setDesc("\uC77C\uC815\uC774 \uC800\uC7A5\uB420 Daily Notes \uD3F4\uB354").addText(a=>a.setPlaceholder("00 _Inbox").setValue(this.plugin.settings.dailyNotesFolder).onChange(async l=>{this.plugin.settings.dailyNotesFolder=l,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Google Calendar \uC5F0\uB3D9"}),new O.Setting(t).setName("Google Calendar \uD65C\uC131\uD654").setDesc("\uC77C\uC815\uC744 Google Calendar\uC5D0\uB3C4 \uC800\uC7A5\uD569\uB2C8\uB2E4").addToggle(a=>a.setValue(this.plugin.settings.googleCalendarEnabled).onChange(async l=>{this.plugin.settings.googleCalendarEnabled=l,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.googleCalendarEnabled){let a=!!this.plugin.settings.googleRefreshToken,l=a?"\uC5F0\uACB0\uB428 \u2713":"\uC5F0\uACB0 \uC548\uB428";if(new O.Setting(t).setName("Google \uACC4\uC815").setDesc(l).addButton(c=>c.setButtonText(a?"\uC7AC\uC5F0\uACB0":"\uC5F0\uACB0\uD558\uAE30").setCta().onClick(async()=>{await this.plugin.connectGoogleCalendar()})).addButton(c=>(a&&c.setButtonText("\uC5F0\uACB0 \uD574\uC81C").onClick(async()=>{await this.plugin.disconnectGoogleCalendar(),this.display()}),c)),new O.Setting(t).setName("\uC790\uCCB4 API \uD0A4 \uC0AC\uC6A9 (Advanced)").setDesc("\uC9C1\uC811 Google Cloud Console\uC5D0\uC11C \uC0DD\uC131\uD55C Client ID\uB97C \uC0AC\uC6A9\uD569\uB2C8\uB2E4").addToggle(c=>c.setValue(this.plugin.settings.useOwnApiKey).onChange(async d=>{this.plugin.settings.useOwnApiKey=d,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.useOwnApiKey){new O.Setting(t).setName("Google Client ID").setDesc("Google Cloud Console\uC5D0\uC11C \uC0DD\uC131\uD55C OAuth 2.0 Client ID").addText(d=>d.setPlaceholder("xxxxx.apps.googleusercontent.com").setValue(this.plugin.settings.googleClientId).onChange(async u=>{this.plugin.settings.googleClientId=u,await this.plugin.saveSettings()})),new O.Setting(t).setName("Google Client Secret").setDesc("OAuth 2.0 Client Secret").addText(d=>d.setPlaceholder("GOCSPX-...").setValue(this.plugin.settings.googleClientSecret).onChange(async u=>{this.plugin.settings.googleClientSecret=u,await this.plugin.saveSettings()}));let c=t.createDiv({cls:"setting-item-description"});c.createEl("p",{text:"Google Cloud Console\uC5D0\uC11C OAuth 2.0 \uD074\uB77C\uC774\uC5B8\uD2B8 ID\uB97C \uC0DD\uC131\uD558\uC138\uC694:"}),c.createEl("a",{text:"Google Cloud Console \uC5F4\uAE30",href:"https://console.cloud.google.com/apis/credentials"}),c.createEl("p",{text:"\uB9AC\uB514\uB809\uC158 URI: http://127.0.0.1:42813/callback",cls:"setting-item-description"}).style.fontFamily="monospace"}}if(t.createEl("h3",{text:"\uCE98\uB9B0\uB354 \uBDF0"}),new O.Setting(t).setName("\uCE98\uB9B0\uB354 \uBDF0 \uD65C\uC131\uD654").setDesc("\uB178\uD2B8, \uC77C\uC815, \uD68C\uC758\uB85D\uC744 \uCE98\uB9B0\uB354\uB85C \uD655\uC778\uD569\uB2C8\uB2E4").addToggle(a=>a.setValue(this.plugin.settings.calendarEnabled).onChange(async l=>{this.plugin.settings.calendarEnabled=l,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.calendarEnabled&&(new O.Setting(t).setName("\uAE30\uBCF8 \uBDF0").setDesc("\uCE98\uB9B0\uB354\uB97C \uC5F4 \uB54C \uAE30\uBCF8\uC73C\uB85C \uD45C\uC2DC\uD560 \uBDF0").addDropdown(a=>a.addOption("month","\uC6D4\uAC04").addOption("week","\uC8FC\uAC04").addOption("day","\uC77C\uAC04").addOption("list","\uBAA9\uB85D").setValue(this.plugin.settings.calendarDefaultView).onChange(async l=>{this.plugin.settings.calendarDefaultView=l,await this.plugin.saveSettings()})),new O.Setting(t).setName("\uC8FC \uC2DC\uC791\uC77C").setDesc("\uCE98\uB9B0\uB354\uC758 \uCCAB \uBC88\uC9F8 \uC694\uC77C").addDropdown(a=>a.addOption("0","\uC77C\uC694\uC77C").addOption("1","\uC6D4\uC694\uC77C").setValue(String(this.plugin.settings.calendarFirstDayOfWeek)).onChange(async l=>{this.plugin.settings.calendarFirstDayOfWeek=parseInt(l),await this.plugin.saveSettings()})),new O.Setting(t).setName("\uC0AC\uC774\uB4DC\uBC14 \uBBF8\uB2C8 \uCE98\uB9B0\uB354").setDesc("\uC624\uB978\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uBBF8\uB2C8 \uCE98\uB9B0\uB354\uB97C \uD45C\uC2DC\uD569\uB2C8\uB2E4").addToggle(a=>a.setValue(this.plugin.settings.showMiniCalendar).onChange(async l=>{this.plugin.settings.showMiniCalendar=l,await this.plugin.saveSettings(),l&&await this.plugin.toggleMiniCalendar()})),new O.Setting(t).setName("\uCE98\uB9B0\uB354 \uC5D4\uC9C4").setDesc(createFragment(a=>{a.appendText("FullCalendar.js (\uD480\uAE30\uB2A5) \uB610\uB294 \uC790\uCCB4 \uAD6C\uD604 (\uACBD\uB7C9) \uC120\uD0DD"),a.createEl("br"),a.createEl("span",{text:"\u{1F4A1} \uC5D4\uC9C4 \uBCC0\uACBD \uD6C4 \uC544\uB798 '\uCE98\uB9B0\uB354 \uBDF0 \uC7AC\uC2DC\uC791' \uBC84\uD2BC\uC744 \uD074\uB9AD\uD558\uC138\uC694",cls:"setting-item-description"}).style.color="var(--text-accent)"})).addDropdown(a=>a.addOption("fullcalendar","FullCalendar.js (\uD480\uAE30\uB2A5)").addOption("native","\uC790\uCCB4 \uAD6C\uD604 (\uACBD\uB7C9)").setValue(this.plugin.settings.calendarEngine).onChange(async l=>{this.plugin.settings.calendarEngine=l,await this.plugin.saveSettings()})),new O.Setting(t).setName("\uCE98\uB9B0\uB354 \uBDF0 \uC7AC\uC2DC\uC791").setDesc("\uC5D4\uC9C4 \uBCC0\uACBD \uD6C4 \uCE98\uB9B0\uB354 \uBDF0\uB97C \uB2E4\uC2DC \uC5F4\uC5B4 \uC801\uC6A9\uD569\uB2C8\uB2E4").addButton(a=>a.setButtonText("\uCE98\uB9B0\uB354 \uBDF0 \uC7AC\uC2DC\uC791").onClick(async()=>{await this.plugin.restartCalendarView(),new O.Notice("\uCE98\uB9B0\uB354 \uBDF0\uAC00 \uC7AC\uC2DC\uC791\uB418\uC5C8\uC2B5\uB2C8\uB2E4")})),new O.Setting(t).setName("\uCE98\uB9B0\uB354 \uC5F4\uAE30").setDesc("Ctrl+Shift+C \uB610\uB294 \uB9AC\uBCF8 \uC544\uC774\uCF58\uC73C\uB85C\uB3C4 \uC5F4 \uC218 \uC788\uC2B5\uB2C8\uB2E4").addButton(a=>a.setButtonText("\uCE98\uB9B0\uB354 \uC5F4\uAE30").setCta().onClick(async()=>{await this.plugin.openCalendarView()}))),t.createEl("h3",{text:"Embedding \uAE30\uBC18 \uAC80\uC0C9 (Beta)"}),new O.Setting(t).setName("Embedding \uD65C\uC131\uD654").setDesc(createFragment(a=>{a.appendText("\uD0A4\uC6CC\uB4DC \uB300\uC2E0 \uC758\uBBF8 \uAE30\uBC18 \uC720\uC0AC\uB3C4\uB85C \uAD00\uB828 \uB178\uD2B8\uB97C \uCC3E\uC2B5\uB2C8\uB2E4. "),a.createEl("br"),a.appendText("\uD65C\uC131\uD654 \uC2DC \uBAA8\uB4E0 \uB178\uD2B8\uC758 \uC784\uBCA0\uB529\uC744 \uC0DD\uC131\uD569\uB2C8\uB2E4 (\uC2DC\uAC04\uC774 \uAC78\uB9B4 \uC218 \uC788\uC74C).")})).addToggle(a=>a.setValue(this.plugin.settings.embeddingEnabled).onChange(async l=>{this.plugin.settings.embeddingEnabled=l,await this.plugin.saveSettings(),this.display(),l&&(new O.Notice("Embedding \uC778\uB371\uC2A4 \uAD6C\uCD95\uC744 \uC2DC\uC791\uD569\uB2C8\uB2E4..."),this.plugin.embeddingManager&&(await this.plugin.embeddingManager.buildFullIndex((c,d,u)=>{(c%10===0||c===d)&&new O.Notice(`Embedding: ${c}/${d}`)}),new O.Notice("Embedding \uC778\uB371\uC2A4 \uAD6C\uCD95 \uC644\uB8CC!")))})),this.plugin.settings.embeddingEnabled){new O.Setting(t).setName("\uC720\uC0AC\uB3C4 \uC784\uACC4\uAC12").setDesc("\uC774 \uAC12 \uC774\uC0C1\uC758 \uC720\uC0AC\uB3C4\uB97C \uAC00\uC9C4 \uB178\uD2B8\uB9CC \uCD94\uCC9C\uD569\uB2C8\uB2E4 (0.5~0.95)").addSlider(l=>l.setLimits(.5,.95,.05).setValue(this.plugin.settings.embeddingSimilarityThreshold).setDynamicTooltip().onChange(async c=>{this.plugin.settings.embeddingSimilarityThreshold=c,await this.plugin.saveSettings()})).addExtraButton(l=>l.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (0.7)").onClick(async()=>{this.plugin.settings.embeddingSimilarityThreshold=.7,await this.plugin.saveSettings(),this.display()})),new O.Setting(t).setName("\uC790\uB3D9 \uC784\uBCA0\uB529").setDesc(createFragment(l=>{l.appendText("\uB178\uD2B8 \uC0DD\uC131/\uC218\uC815 \uC2DC \uC790\uB3D9\uC73C\uB85C \uC784\uBCA0\uB529\uC744 \uC5C5\uB370\uC774\uD2B8\uD569\uB2C8\uB2E4. "),l.createEl("br"),l.createEl("strong",{text:"\u{1F4A1} \uB3D9\uAE30\uD654 \uD301: "}),l.appendText("PC\uC5D0\uC11C\uB9CC \uCF1C\uACE0, \uBAA8\uBC14\uC77C\uC5D0\uC11C\uB294 \uB044\uC138\uC694.")})).addToggle(l=>l.setValue(this.plugin.settings.autoEmbeddingEnabled).onChange(async c=>{this.plugin.settings.autoEmbeddingEnabled=c,await this.plugin.saveSettings()}));let a=t.createEl("details",{cls:"zfb-chunk-settings"});if(a.createEl("summary",{text:"\u{1F4E6} \uCCAD\uD06C \uBD84\uD560 \uC124\uC815 (\uACE0\uAE09)"}),new O.Setting(a).setName("\uCCAD\uD06C \uD06C\uAE30").setDesc("\uB178\uD2B8\uB97C \uBD84\uD560\uD558\uB294 \uB2E8\uC704 \uD06C\uAE30 (200~1000\uC790)").addText(l=>l.setPlaceholder("500").setValue(String(this.plugin.settings.embeddingChunkSize||500)).onChange(async c=>{let d=parseInt(c);d>=200&&d<=1e3&&(this.plugin.settings.embeddingChunkSize=d,await this.plugin.saveSettings())})),new O.Setting(a).setName("\uCCAD\uD06C \uC624\uBC84\uB7A9").setDesc("\uCCAD\uD06C \uAC04 \uC911\uBCF5 \uC601\uC5ED (0~100\uC790)").addText(l=>l.setPlaceholder("50").setValue(String(this.plugin.settings.embeddingChunkOverlap||50)).onChange(async c=>{let d=parseInt(c);d>=0&&d<=100&&(this.plugin.settings.embeddingChunkOverlap=d,await this.plugin.saveSettings())})),a.createEl("p",{text:"\u26A0\uFE0F \uC124\uC815 \uBCC0\uACBD \uC2DC \uC778\uB371\uC2A4 \uC7AC\uAD6C\uCD95 \uD544\uC694",cls:"setting-item-description"}),this.plugin.embeddingManager){let l=this.plugin.embeddingManager.getStats(),c=t.createDiv({cls:"embedding-stats-info"});c.createEl("p",{text:`\uC778\uB371\uC2F1\uB41C \uB178\uD2B8: ${l.totalNotes}\uAC1C`,cls:"setting-item-description"}),l.totalChunks!==void 0&&c.createEl("p",{text:`\uCD1D \uCCAD\uD06C: ${l.totalChunks}\uAC1C`,cls:"setting-item-description"}),l.lastFullScan&&c.createEl("p",{text:`\uB9C8\uC9C0\uB9C9 \uC804\uCCB4 \uC2A4\uCE94: ${new Date(l.lastFullScan).toLocaleString()}`,cls:"setting-item-description"})}new O.Setting(t).setName("\uC778\uB371\uC2A4 \uC7AC\uAD6C\uCD95").setDesc("\uBAA8\uB4E0 \uB178\uD2B8\uC758 \uC784\uBCA0\uB529\uC744 \uB2E4\uC2DC \uC0DD\uC131\uD569\uB2C8\uB2E4 (\uC2DC\uAC04\uC774 \uAC78\uB9B4 \uC218 \uC788\uC74C)").addButton(l=>l.setButtonText("\uC7AC\uAD6C\uCD95").onClick(async()=>{if(this.plugin.embeddingManager){new O.Notice("Embedding \uC778\uB371\uC2A4 \uC7AC\uAD6C\uCD95 \uC2DC\uC791..."),await this.plugin.embeddingManager.clearIndex();let c=await this.plugin.embeddingManager.buildFullIndex((d,u)=>{(d%10===0||d===u)&&new O.Notice(`Embedding: ${d}/${u}`)});new O.Notice(`\uC7AC\uAD6C\uCD95 \uC644\uB8CC! \uC131\uACF5: ${c.success}, \uC2A4\uD0B5: ${c.skipped}, \uC2E4\uD328: ${c.failed}`),this.display()}})),new O.Setting(t).setName("\uC0AD\uC81C\uB41C \uD30C\uC77C \uC784\uBCA0\uB529 \uC815\uB9AC").setDesc("\uC0AD\uC81C\uB41C \uB178\uD2B8\uC758 \uC784\uBCA0\uB529\uC744 \uC815\uB9AC\uD569\uB2C8\uB2E4").addButton(l=>l.setButtonText("\uC815\uB9AC").onClick(async()=>{if(this.plugin.embeddingManager){let c=await this.plugin.embeddingManager.cleanupOrphanedEmbeddings();new O.Notice(`${c}\uAC1C\uC758 \uBBF8\uC0AC\uC6A9 \uC784\uBCA0\uB529\uC774 \uC815\uB9AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4`),this.display()}}))}if(t.createEl("h3",{text:"RAG \uCC57\uBD07"}),new O.Setting(t).setName("RAG \uCC57\uBD07 \uD65C\uC131\uD654").setDesc(createFragment(a=>{a.appendText("\uB178\uD2B8 \uAE30\uBC18 Q&A \uCC57\uBD07\uC744 \uD65C\uC131\uD654\uD569\uB2C8\uB2E4. "),a.createEl("br"),a.appendText("Embedding\uC774 \uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC5B4\uC57C \uD569\uB2C8\uB2E4.")})).addToggle(a=>a.setValue(this.plugin.settings.ragEnabled).setDisabled(!this.plugin.settings.embeddingEnabled).onChange(async l=>{this.plugin.settings.ragEnabled=l,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.embeddingEnabled||t.createDiv({cls:"setting-item-description"}).createEl("p",{text:"\u26A0\uFE0F RAG \uCC57\uBD07\uC744 \uC0AC\uC6A9\uD558\uB824\uBA74 \uBA3C\uC800 Embedding\uC744 \uD65C\uC131\uD654\uD558\uC138\uC694.",cls:"mod-warning"}),this.plugin.settings.ragEnabled&&this.plugin.settings.embeddingEnabled&&(new O.Setting(t).setName("\uAC80\uC0C9\uD560 \uB178\uD2B8 \uC218 (Top-K)").setDesc("\uC9C8\uBB38\uACFC \uAD00\uB828\uB41C \uB178\uD2B8\uB97C \uBA87 \uAC1C\uAE4C\uC9C0 \uAC80\uC0C9\uD560\uC9C0 \uC124\uC815\uD569\uB2C8\uB2E4").addSlider(a=>a.setLimits(1,10,1).setValue(this.plugin.settings.ragTopK).setDynamicTooltip().onChange(async l=>{this.plugin.settings.ragTopK=l,await this.plugin.saveSettings()})).addExtraButton(a=>a.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (5)").onClick(async()=>{this.plugin.settings.ragTopK=5,await this.plugin.saveSettings(),this.display()})),new O.Setting(t).setName("\uCEE8\uD14D\uC2A4\uD2B8 \uCD5C\uB300 \uAE38\uC774").setDesc("AI\uC5D0\uAC8C \uC804\uB2EC\uD560 \uB178\uD2B8 \uB0B4\uC6A9\uC758 \uCD5C\uB300 \uAE00\uC790 \uC218 (1000~10000)").addSlider(a=>a.setLimits(1e3,1e4,500).setValue(this.plugin.settings.ragMaxContextLength).setDynamicTooltip().onChange(async l=>{this.plugin.settings.ragMaxContextLength=l,await this.plugin.saveSettings()})).addExtraButton(a=>a.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12 (4000)").onClick(async()=>{this.plugin.settings.ragMaxContextLength=4e3,await this.plugin.saveSettings(),this.display()})),new O.Setting(t).setName("\uCC57\uBD07 \uC5F4\uAE30").setDesc("Ctrl+Shift+' \uB610\uB294 \uB9AC\uBCF8 \uC544\uC774\uCF58\uC73C\uB85C\uB3C4 \uC5F4 \uC218 \uC788\uC2B5\uB2C8\uB2E4").addButton(a=>a.setButtonText("\uCC57\uBD07 \uC5F4\uAE30").setCta().onClick(async()=>{await this.plugin.toggleChatbot()}))),t.createEl("h3",{text:"\uB370\uC774\uD130 \uB3D9\uAE30\uD654"}),new O.Setting(t).setName("\uB370\uC774\uD130 \uC800\uC7A5 \uC704\uCE58").setDesc(createFragment(a=>{a.appendText("\uBCFC\uD2B8 \uB0B4\uBD80\uC5D0 \uC800\uC7A5\uD558\uBA74 Obsidian Sync\uB85C \uB3D9\uAE30\uD654\uB429\uB2C8\uB2E4."),a.createEl("br"),a.appendText("\uBCC0\uACBD \uD6C4 \uD50C\uB7EC\uADF8\uC778 \uC7AC\uC2DC\uC791\uC774 \uD544\uC694\uD569\uB2C8\uB2E4.")})).addDropdown(a=>a.addOption("plugin","\uD50C\uB7EC\uADF8\uC778 \uD3F4\uB354 (\uAE30\uBCF8)").addOption("vault","\uBCFC\uD2B8 \uB0B4\uBD80 (.zfb-data)").setValue(this.plugin.settings.dataStorageLocation).onChange(async l=>{this.plugin.settings.dataStorageLocation=l,await this.plugin.saveSettings(),new O.Notice(`\uB370\uC774\uD130 \uC800\uC7A5 \uC704\uCE58\uAC00 \uBCC0\uACBD\uB418\uC5C8\uC2B5\uB2C8\uB2E4.
\uD50C\uB7EC\uADF8\uC778\uC744 \uC7AC\uC2DC\uC791\uD558\uBA74 \uC801\uC6A9\uB429\uB2C8\uB2E4.`)})),this.plugin.settings.dataStorageLocation==="vault"){new O.Setting(t).setName("\uB370\uC774\uD130 \uD3F4\uB354 \uACBD\uB85C").setDesc("\uBCFC\uD2B8 \uB0B4 \uB370\uC774\uD130 \uC800\uC7A5 \uD3F4\uB354 (embeddings, chats, feedback)").addText(l=>l.setPlaceholder(".zfb-data").setValue(this.plugin.settings.dataFolderPath).onChange(async c=>{this.plugin.settings.dataFolderPath=c||".zfb-data",await this.plugin.saveSettings()}));let a=t.createDiv({cls:"setting-item-description"});a.createEl("p",{text:`\uC800\uC7A5 \uACBD\uB85C: ${this.plugin.settings.dataFolderPath}/`}),a.createEl("p",{text:"\u2022 embeddings.json (Embedding \uC778\uB371\uC2A4)",cls:"setting-item-description"}),a.createEl("p",{text:"\u2022 chats.json (\uCC57\uBD07 \uB300\uD654)",cls:"setting-item-description"}),a.createEl("p",{text:"\u2022 feedback.json (\uD53C\uB4DC\uBC31 \uB370\uC774\uD130)",cls:"setting-item-description"})}t.createEl("h3",{text:"\uD15C\uD50C\uB9BF"});let o=t.createDiv({cls:"setting-item-description"});o.createEl("p",{text:"\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uBCC0\uC218:"}),o.innerHTML+=`
			<code>{{title}}</code> \uC81C\uBAA9 &nbsp;
			<code>{{url}}</code> URL &nbsp;
			<code>{{summary}}</code> \uC694\uC57D &nbsp;
			<code>{{keyPoints}}</code> \uD575\uC2EC \uD3EC\uC778\uD2B8 &nbsp;
			<code>{{date}}</code> \uB0A0\uC9DC &nbsp;
			<code>{{iframe}}</code> \uC784\uBCA0\uB4DC
		`,new O.Setting(t).setName("YouTube \uD15C\uD50C\uB9BF").setDesc("YouTube \uC601\uC0C1 \uB178\uD2B8 \uC0DD\uC131 \uC2DC \uC0AC\uC6A9\uD560 \uD15C\uD50C\uB9BF").addTextArea(a=>{a.inputEl.rows=12,a.inputEl.cols=50,a.inputEl.addClass("zfb-template-textarea"),a.setValue(this.plugin.settings.youtubeTemplate).onChange(async l=>{this.plugin.settings.youtubeTemplate=l,await this.plugin.saveSettings()})}).addExtraButton(a=>a.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12\uC73C\uB85C \uCD08\uAE30\uD654").onClick(async()=>{let{DEFAULT_SETTINGS:l}=await Promise.resolve().then(()=>(jn(),$b));this.plugin.settings.youtubeTemplate=l.youtubeTemplate,await this.plugin.saveSettings(),this.display()})),new O.Setting(t).setName("\uC6F9\uD398\uC774\uC9C0 \uD15C\uD50C\uB9BF").setDesc("\uC6F9\uD398\uC774\uC9C0 \uB178\uD2B8 \uC0DD\uC131 \uC2DC \uC0AC\uC6A9\uD560 \uD15C\uD50C\uB9BF").addTextArea(a=>{a.inputEl.rows=12,a.inputEl.cols=50,a.inputEl.addClass("zfb-template-textarea"),a.setValue(this.plugin.settings.webpageTemplate).onChange(async l=>{this.plugin.settings.webpageTemplate=l,await this.plugin.saveSettings()})}).addExtraButton(a=>a.setIcon("reset").setTooltip("\uAE30\uBCF8\uAC12\uC73C\uB85C \uCD08\uAE30\uD654").onClick(async()=>{let{DEFAULT_SETTINGS:l}=await Promise.resolve().then(()=>(jn(),$b));this.plugin.settings.webpageTemplate=l.webpageTemplate,await this.plugin.saveSettings(),this.display()})),t.createEl("h3",{text:"API \uC0AC\uC6A9\uB7C9 \uCD94\uC801"}),new O.Setting(t).setName("\uC0AC\uC6A9\uB7C9 \uCD94\uC801").setDesc("Gemini API \uD1A0\uD070 \uC0AC\uC6A9\uB7C9\uC744 \uCD94\uC801\uD569\uB2C8\uB2E4").addToggle(a=>a.setValue(this.plugin.settings.usageTrackingEnabled).onChange(async l=>{this.plugin.settings.usageTrackingEnabled=l,await this.plugin.saveSettings(),await this.plugin.toggleUsageTracker(l),this.display()})),this.plugin.settings.usageTrackingEnabled&&this.renderUsageSettings(t)}async renderUsageSettings(t){await this.plugin.usageTracker?.loadUsage(),new O.Setting(t).setName("\uC800\uC7A5 \uAE30\uAC04").setDesc("\uC0AC\uC6A9\uB7C9 \uB370\uC774\uD130 \uBCF4\uAD00 \uAE30\uAC04").addDropdown(n=>{Bb.forEach(s=>{n.addOption(s.value,`${s.label} - ${s.desc}`)}),n.setValue(this.plugin.settings.usageStorageMode).onChange(async s=>{this.plugin.settings.usageStorageMode=s,await this.plugin.saveSettings(),this.plugin.usageTracker&&(this.plugin.usageTracker.pruneOldData(),await this.plugin.usageTracker.saveUsage())})}),new O.Setting(t).setName("\uC0C1\uD0DC\uBC14 \uD45C\uC2DC").setDesc("\uD558\uB2E8 \uC0C1\uD0DC\uBC14\uC5D0 \uC624\uB298 \uC0AC\uC6A9\uB7C9\uC744 \uD45C\uC2DC\uD569\uB2C8\uB2E4").addToggle(n=>n.setValue(this.plugin.settings.usageShowStatusBar).onChange(async s=>{this.plugin.settings.usageShowStatusBar=s,await this.plugin.saveSettings(),this.plugin.usageTracker&&this.plugin.usageTracker.updateStatusBar()})),this.renderTodayUsage(t),this.renderMonthUsage(t),this.renderUsageButtons(t)}renderTodayUsage(t){let n=this.plugin.usageTracker?.getTodayUsage(),s=t.createDiv({cls:"zfb-usage-section"});if(s.createEl("h4",{text:"\uC624\uB298 \uC0AC\uC6A9\uB7C9"}),!n){s.createEl("p",{text:"\uC624\uB298 \uC0AC\uC6A9 \uAE30\uB85D\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.",cls:"zfb-usage-empty"});return}let r=this.plugin.usageTracker?.calculateCost(n.totalInputTokens,n.totalOutputTokens,"gemini-3-flash-preview")??0,o=s.createDiv({cls:"zfb-usage-stats-grid"});this.createStatItem(o,"\uC785\uB825 \uD1A0\uD070",n.totalInputTokens.toLocaleString()),this.createStatItem(o,"\uCD9C\uB825 \uD1A0\uD070",n.totalOutputTokens.toLocaleString()),this.createStatItem(o,"\uCD1D \uD638\uCD9C",n.totalCalls.toString()),this.createStatItem(o,"\uC608\uC0C1 \uBE44\uC6A9",`$${r.toFixed(4)}`);let a=s.createDiv({cls:"zfb-usage-features"});a.createEl("strong",{text:"\uAE30\uB2A5\uBCC4 \uD638\uCD9C:"});let l=a.createDiv({cls:"zfb-usage-feature-list"});Object.entries(n.callsByFeature).filter(([c,d])=>d>0).sort((c,d)=>d[1]-c[1]).forEach(([c,d])=>{let u=Ub[c]||c;l.createSpan({text:`${u}: ${d}`,cls:"zfb-usage-feature-item"})})}renderMonthUsage(t){let n=this.plugin.usageTracker?.getThisMonthUsage();if(!n||n.inputTokens===0&&n.outputTokens===0)return;let s=this.plugin.usageTracker?.calculateCost(n.inputTokens,n.outputTokens,"gemini-3-flash-preview")??0,r=t.createDiv({cls:"zfb-usage-section"});r.createEl("h4",{text:"\uC774\uBC88 \uB2EC \uB204\uC801"});let o=r.createDiv({cls:"zfb-usage-stats-grid"});this.createStatItem(o,"\uC785\uB825 \uD1A0\uD070",n.inputTokens.toLocaleString()),this.createStatItem(o,"\uCD9C\uB825 \uD1A0\uD070",n.outputTokens.toLocaleString()),this.createStatItem(o,"\uCD1D \uD638\uCD9C",n.calls.toString()),this.createStatItem(o,"\uC608\uC0C1 \uBE44\uC6A9",`$${s.toFixed(4)}`)}renderUsageButtons(t){let n=t.createDiv({cls:"zfb-usage-buttons"});new O.Setting(n).addButton(s=>s.setButtonText("\uB370\uC774\uD130 \uCD08\uAE30\uD654").setWarning().onClick(async()=>{confirm("\uBAA8\uB4E0 \uC0AC\uC6A9\uB7C9 \uB370\uC774\uD130\uB97C \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")&&(await this.plugin.usageTracker?.resetUsage(),new O.Notice("\uC0AC\uC6A9\uB7C9 \uB370\uC774\uD130\uAC00 \uCD08\uAE30\uD654\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),this.display())})),new O.Setting(n).addButton(s=>s.setButtonText("CSV \uB0B4\uBCF4\uB0B4\uAE30").onClick(async()=>{let r=this.plugin.usageTracker?.exportToCSV();if(r){let o=`zfb-usage-${new Date().toISOString().split("T")[0]}.csv`,a=new Blob([r],{type:"text/csv"}),l=URL.createObjectURL(a),c=document.createElement("a");c.href=l,c.download=o,c.click(),URL.revokeObjectURL(l),new O.Notice("CSV \uD30C\uC77C\uC774 \uB2E4\uC6B4\uB85C\uB4DC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}}))}createStatItem(t,n,s){let r=t.createDiv({cls:"zfb-usage-stat-item"});r.createSpan({text:n,cls:"stat-label"}),r.createSpan({text:s,cls:"stat-value"})}async createFolderStructure(){let t=[this.plugin.settings.inboxFolder,this.plugin.settings.projectsFolder,this.plugin.settings.libraryFolder,this.plugin.settings.archivesFolder,this.plugin.settings.zettelFolder],n=0,s=0;for(let r of t){if(!r)continue;if(this.app.vault.getAbstractFileByPath(r))s++;else try{await this.app.vault.createFolder(r),n++}catch(a){console.error(`\uD3F4\uB354 \uC0DD\uC131 \uC2E4\uD328: ${r}`,a)}}n>0?new O.Notice(`${n}\uAC1C \uD3F4\uB354 \uC0DD\uC131\uB428, ${s}\uAC1C \uC774\uBBF8 \uC874\uC7AC`):new O.Notice(`\uBAA8\uB4E0 \uD3F4\uB354\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4 (${s}\uAC1C)`)}renderPresetDescription(t,n){t.empty();let s=xt[n],r=t.createDiv({cls:"preset-desc-content"});r.createEl("strong",{text:`${s.icon} ${s.label}`});let o=r.createDiv({cls:"preset-details"});switch(n){case"basic":o.innerHTML=`
					<p>\uD575\uC2EC \uAE30\uB2A5\uB9CC \uD65C\uC131\uD654\uD558\uC5EC \uAC00\uBCCD\uAC8C \uC2DC\uC791\uD569\uB2C8\uB2E4.</p>
					<ul>
						<li>\u2705 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 (Ctrl+Shift+G)</li>
						<li>\u2705 URL \uC694\uC57D (Ctrl+Shift+U)</li>
						<li>\u2705 OCR \uCD94\uCD9C (Ctrl+Shift+O)</li>
						<li>\u274C Embedding/RAG \uCC57\uBD07</li>
						<li>\u274C \uCE98\uB9B0\uB354/\uC77C\uC815 \uAC10\uC9C0</li>
					</ul>
				`;break;case"power":o.innerHTML=`
					<p>\uC804\uCCB4 \uAE30\uB2A5\uC744 \uD65C\uC131\uD654\uD569\uB2C8\uB2E4. (\uAD8C\uC7A5)</p>
					<ul>
						<li>\u2705 \uBAA8\uB4E0 \uAE30\uBCF8 \uAE30\uB2A5</li>
						<li>\u2705 Embedding \uAE30\uBC18 \uAC80\uC0C9</li>
						<li>\u2705 RAG \uCC57\uBD07</li>
						<li>\u2705 \uCE98\uB9B0\uB354 \uBDF0</li>
						<li>\u2705 \uC77C\uC815 \uC790\uB3D9 \uAC10\uC9C0</li>
					</ul>
				`;break;case"experimental":o.innerHTML=`
					<p>Beta \uAE30\uB2A5\uC744 \uD3EC\uD568\uD55C \uC804\uCCB4 \uAE30\uB2A5\uC744 \uD65C\uC131\uD654\uD569\uB2C8\uB2E4.</p>
					<ul>
						<li>\u2705 \uBAA8\uB4E0 \uD30C\uC6CC \uBAA8\uB4DC \uAE30\uB2A5</li>
						<li>\u{1F9EA} \uC0C8\uB85C\uC6B4 \uC2E4\uD5D8 \uAE30\uB2A5</li>
					</ul>
				`;break;default:o.innerHTML="<p>\uAC1C\uBCC4 \uC124\uC815\uC744 \uC9C1\uC811 \uC870\uC815\uD569\uB2C8\uB2E4.</p>"}}async applyPreset(t){this.plugin.settings.preset=t;let n=dp[t];for(let[s,r]of Object.entries(n))up.includes(s)||(this.plugin.settings[s]=r);await this.plugin.saveSettings()}};var CP,TP;function _P(){return{geminiUrl:CP,vertexUrl:TP}}function xP(i,e,t,n){var s,r;if(!i?.baseUrl){let o=_P();return e?(s=o.vertexUrl)!==null&&s!==void 0?s:t:(r=o.geminiUrl)!==null&&r!==void 0?r:n}return i.baseUrl}var Rn=class{};function U(i,e){let t=/\{([^}]+)\}/g;return i.replace(t,(n,s)=>{if(Object.prototype.hasOwnProperty.call(e,s)){let r=e[s];return r!=null?String(r):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function g(i,e,t){for(let r=0;r<e.length-1;r++){let o=e[r];if(o.endsWith("[]")){let a=o.slice(0,-2);if(!(a in i))if(Array.isArray(t))i[a]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(i[a])){let l=i[a];if(Array.isArray(t))for(let c=0;c<l.length;c++){let d=l[c];g(d,e.slice(r+1),t[c])}else for(let c of l)g(c,e.slice(r+1),t)}return}else if(o.endsWith("[0]")){let a=o.slice(0,-3);a in i||(i[a]=[{}]);let l=i[a];g(l[0],e.slice(r+1),t);return}(!i[o]||typeof i[o]!="object")&&(i[o]={}),i=i[o]}let n=e[e.length-1],s=i[n];if(s!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===s)return;if(typeof s=="object"&&typeof t=="object"&&s!==null&&t!==null)Object.assign(s,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(i,t):i[n]=t}function f(i,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return i;for(let n=0;n<e.length;n++){if(typeof i!="object"||i===null)return t;let s=e[n];if(s.endsWith("[]")){let r=s.slice(0,-2);if(r in i){let o=i[r];return Array.isArray(o)?o.map(a=>f(a,e.slice(n+1),t)):t}else return t}else i=i[s]}return i}catch(n){if(n instanceof TypeError)return t;throw n}}function RP(i,e){for(let[t,n]of Object.entries(e)){let s=t.split("."),r=n.split("."),o=new Set,a=-1;for(let l=0;l<s.length;l++)if(s[l]==="*"){a=l;break}if(a!==-1&&r.length>a)for(let l=a;l<r.length;l++){let c=r[l];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&o.add(c)}Xb(i,s,r,0,o)}}function Xb(i,e,t,n,s){if(n>=e.length||typeof i!="object"||i===null)return;let r=e[n];if(r.endsWith("[]")){let o=r.slice(0,-2),a=i;if(o in a&&Array.isArray(a[o]))for(let l of a[o])Xb(l,e,t,n+1,s)}else if(r==="*"){if(typeof i=="object"&&i!==null&&!Array.isArray(i)){let o=i,a=Object.keys(o).filter(c=>!c.startsWith("_")&&!s.has(c)),l={};for(let c of a)l[c]=o[c];for(let[c,d]of Object.entries(l)){let u=[];for(let p of t.slice(n))p==="*"?u.push(c):u.push(p);g(o,u,d)}for(let c of a)delete o[c]}}else{let o=i;r in o&&Xb(o[r],e,t,n+1,s)}}function YE(i){if(typeof i!="string")throw new Error("fromImageBytes must be a string");return i}function DP(i){let e={},t=f(i,["operationName"]);t!=null&&g(e,["operationName"],t);let n=f(i,["resourceName"]);return n!=null&&g(e,["_url","resourceName"],n),e}function IP(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response","generateVideoResponse"]);return o!=null&&g(e,["response"],PP(o)),e}function MP(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],kP(o)),e}function PP(i){let e={},t=f(i,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>NP(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function kP(i){let e={},t=f(i,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>FP(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function NP(i){let e={},t=f(i,["video"]);return t!=null&&g(e,["video"],$P(t)),e}function FP(i){let e={},t=f(i,["_self"]);return t!=null&&g(e,["video"],VP(t)),e}function LP(i){let e={},t=f(i,["operationName"]);return t!=null&&g(e,["_url","operationName"],t),e}function OP(i){let e={},t=f(i,["operationName"]);return t!=null&&g(e,["_url","operationName"],t),e}function UP(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],BP(o)),e}function BP(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["parent"]);n!=null&&g(e,["parent"],n);let s=f(i,["documentName"]);return s!=null&&g(e,["documentName"],s),e}function M0(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],HP(o)),e}function HP(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["parent"]);n!=null&&g(e,["parent"],n);let s=f(i,["documentName"]);return s!=null&&g(e,["documentName"],s),e}function $P(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["uri"],t);let n=f(i,["encodedVideo"]);n!=null&&g(e,["videoBytes"],YE(n));let s=f(i,["encoding"]);return s!=null&&g(e,["mimeType"],s),e}function VP(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["uri"],t);let n=f(i,["bytesBase64Encoded"]);n!=null&&g(e,["videoBytes"],YE(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}var l_;(function(i){i.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",i.OUTCOME_OK="OUTCOME_OK",i.OUTCOME_FAILED="OUTCOME_FAILED",i.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(l_||(l_={}));var c_;(function(i){i.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",i.PYTHON="PYTHON"})(c_||(c_={}));var d_;(function(i){i.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",i.SILENT="SILENT",i.WHEN_IDLE="WHEN_IDLE",i.INTERRUPT="INTERRUPT"})(d_||(d_={}));var _s;(function(i){i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.STRING="STRING",i.NUMBER="NUMBER",i.INTEGER="INTEGER",i.BOOLEAN="BOOLEAN",i.ARRAY="ARRAY",i.OBJECT="OBJECT",i.NULL="NULL"})(_s||(_s={}));var u_;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(u_||(u_={}));var h_;(function(i){i.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",i.SIMPLE_SEARCH="SIMPLE_SEARCH",i.ELASTIC_SEARCH="ELASTIC_SEARCH"})(h_||(h_={}));var f_;(function(i){i.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",i.NO_AUTH="NO_AUTH",i.API_KEY_AUTH="API_KEY_AUTH",i.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",i.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",i.OAUTH="OAUTH",i.OIDC_AUTH="OIDC_AUTH"})(f_||(f_={}));var p_;(function(i){i.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",i.HTTP_IN_QUERY="HTTP_IN_QUERY",i.HTTP_IN_HEADER="HTTP_IN_HEADER",i.HTTP_IN_PATH="HTTP_IN_PATH",i.HTTP_IN_BODY="HTTP_IN_BODY",i.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(p_||(p_={}));var g_;(function(i){i.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",i.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",i.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",i.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(g_||(g_={}));var m_;(function(i){i.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH",i.MINIMAL="MINIMAL"})(m_||(m_={}));var y_;(function(i){i.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",i.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",i.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",i.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",i.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",i.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",i.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",i.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",i.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(y_||(y_={}));var v_;(function(i){i.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",i.SEVERITY="SEVERITY",i.PROBABILITY="PROBABILITY"})(v_||(v_={}));var b_;(function(i){i.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",i.OFF="OFF"})(b_||(b_={}));var E_;(function(i){i.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",i.STOP="STOP",i.MAX_TOKENS="MAX_TOKENS",i.SAFETY="SAFETY",i.RECITATION="RECITATION",i.LANGUAGE="LANGUAGE",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.SPII="SPII",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.IMAGE_SAFETY="IMAGE_SAFETY",i.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",i.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",i.NO_IMAGE="NO_IMAGE",i.IMAGE_RECITATION="IMAGE_RECITATION",i.IMAGE_OTHER="IMAGE_OTHER"})(E_||(E_={}));var S_;(function(i){i.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH"})(S_||(S_={}));var w_;(function(i){i.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",i.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",i.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",i.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",i.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(w_||(w_={}));var A_;(function(i){i.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",i.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",i.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",i.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",i.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(A_||(A_={}));var C_;(function(i){i.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",i.SAFETY="SAFETY",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.IMAGE_SAFETY="IMAGE_SAFETY",i.MODEL_ARMOR="MODEL_ARMOR",i.JAILBREAK="JAILBREAK"})(C_||(C_={}));var T_;(function(i){i.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",i.ON_DEMAND="ON_DEMAND",i.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(T_||(T_={}));var Ep;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.AUDIO="AUDIO"})(Ep||(Ep={}));var __;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(__||(__={}));var x_;(function(i){i.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",i.TUNING_MODE_FULL="TUNING_MODE_FULL",i.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(x_||(x_={}));var R_;(function(i){i.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",i.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",i.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",i.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",i.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",i.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",i.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(R_||(R_={}));var Jb;(function(i){i.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",i.JOB_STATE_QUEUED="JOB_STATE_QUEUED",i.JOB_STATE_PENDING="JOB_STATE_PENDING",i.JOB_STATE_RUNNING="JOB_STATE_RUNNING",i.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",i.JOB_STATE_FAILED="JOB_STATE_FAILED",i.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",i.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",i.JOB_STATE_PAUSED="JOB_STATE_PAUSED",i.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",i.JOB_STATE_UPDATING="JOB_STATE_UPDATING",i.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Jb||(Jb={}));var D_;(function(i){i.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",i.TUNING_TASK_I2V="TUNING_TASK_I2V",i.TUNING_TASK_T2V="TUNING_TASK_T2V",i.TUNING_TASK_R2V="TUNING_TASK_R2V"})(D_||(D_={}));var I_;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",i.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(I_||(I_={}));var M_;(function(i){i.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",i.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",i.BALANCED="BALANCED",i.PRIORITIZE_COST="PRIORITIZE_COST"})(M_||(M_={}));var P_;(function(i){i.UNSPECIFIED="UNSPECIFIED",i.BLOCKING="BLOCKING",i.NON_BLOCKING="NON_BLOCKING"})(P_||(P_={}));var k_;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(k_||(k_={}));var N_;(function(i){i.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",i.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(N_||(N_={}));var F_;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.AUTO="AUTO",i.ANY="ANY",i.NONE="NONE",i.VALIDATED="VALIDATED"})(F_||(F_={}));var L_;(function(i){i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE"})(L_||(L_={}));var O_;(function(i){i.DONT_ALLOW="DONT_ALLOW",i.ALLOW_ADULT="ALLOW_ADULT",i.ALLOW_ALL="ALLOW_ALL"})(O_||(O_={}));var U_;(function(i){i.auto="auto",i.en="en",i.ja="ja",i.ko="ko",i.hi="hi",i.zh="zh",i.pt="pt",i.es="es"})(U_||(U_={}));var B_;(function(i){i.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",i.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",i.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",i.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",i.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(B_||(B_={}));var H_;(function(i){i.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",i.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",i.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",i.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(H_||(H_={}));var $_;(function(i){i.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",i.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",i.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",i.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})($_||($_={}));var V_;(function(i){i.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",i.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",i.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",i.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",i.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",i.EDIT_MODE_STYLE="EDIT_MODE_STYLE",i.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",i.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(V_||(V_={}));var G_;(function(i){i.FOREGROUND="FOREGROUND",i.BACKGROUND="BACKGROUND",i.PROMPT="PROMPT",i.SEMANTIC="SEMANTIC",i.INTERACTIVE="INTERACTIVE"})(G_||(G_={}));var z_;(function(i){i.ASSET="ASSET",i.STYLE="STYLE"})(z_||(z_={}));var W_;(function(i){i.INSERT="INSERT",i.REMOVE="REMOVE",i.REMOVE_STATIC="REMOVE_STATIC",i.OUTPAINT="OUTPAINT"})(W_||(W_={}));var q_;(function(i){i.OPTIMIZED="OPTIMIZED",i.LOSSLESS="LOSSLESS"})(q_||(q_={}));var Y_;(function(i){i.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",i.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Y_||(Y_={}));var K_;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.STATE_PENDING="STATE_PENDING",i.STATE_ACTIVE="STATE_ACTIVE",i.STATE_FAILED="STATE_FAILED"})(K_||(K_={}));var X_;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.PROCESSING="PROCESSING",i.ACTIVE="ACTIVE",i.FAILED="FAILED"})(X_||(X_={}));var J_;(function(i){i.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",i.UPLOADED="UPLOADED",i.GENERATED="GENERATED"})(J_||(J_={}));var Z_;(function(i){i.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.RESPONSE_REJECTED="RESPONSE_REJECTED",i.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Z_||(Z_={}));var j_;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.VIDEO="VIDEO",i.AUDIO="AUDIO",i.DOCUMENT="DOCUMENT"})(j_||(j_={}));var Q_;(function(i){i.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",i.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",i.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(Q_||(Q_={}));var e0;(function(i){i.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",i.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",i.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(e0||(e0={}));var t0;(function(i){i.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",i.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",i.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(t0||(t0={}));var n0;(function(i){i.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",i.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",i.NO_INTERRUPTION="NO_INTERRUPTION"})(n0||(n0={}));var i0;(function(i){i.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",i.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",i.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(i0||(i0={}));var s0;(function(i){i.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",i.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",i.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",i.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",i.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",i.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",i.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",i.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",i.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",i.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",i.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",i.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",i.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(s0||(s0={}));var r0;(function(i){i.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",i.QUALITY="QUALITY",i.DIVERSITY="DIVERSITY",i.VOCALIZATION="VOCALIZATION"})(r0||(r0={}));var Oa;(function(i){i.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",i.PLAY="PLAY",i.PAUSE="PAUSE",i.STOP="STOP",i.RESET_CONTEXT="RESET_CONTEXT"})(Oa||(Oa={}));var ld=class{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var Lr=class{get text(){var e,t,n,s,r,o,a,l;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",d=!1,u=[];for(let p of(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[m,y]of Object.entries(p))m!=="text"&&m!=="thought"&&m!=="thoughtSignature"&&(y!==null||y!==void 0)&&u.push(m);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;d=!0,c+=p.text}}return u.length>0&&console.warn(`there are non-text parts ${u} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?c:void 0}get data(){var e,t,n,s,r,o,a,l;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="",d=[];for(let u of(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[p,m]of Object.entries(u))p!=="inlineData"&&(m!==null||m!==void 0)&&d.push(p);u.inlineData&&typeof u.inlineData.data=="string"&&(c+=atob(u.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,t,n,s,r,o,a,l;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let c=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if(c?.length!==0)return c}get executableCode(){var e,t,n,s,r,o,a,l,c;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let d=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(u=>u.executableCode).map(u=>u.executableCode).filter(u=>u!==void 0);if(d?.length!==0)return(c=d?.[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,t,n,s,r,o,a,l,c;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let d=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(u=>u.codeExecutionResult).map(u=>u.codeExecutionResult).filter(u=>u!==void 0);if(d?.length!==0)return(c=d?.[0])===null||c===void 0?void 0:c.output}},Sp=class{},wp=class{},Zb=class{},jb=class{},Qb=class{},eE=class{},Ap=class{},Cp=class{},Tp=class{},tE=class{};var _p=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,s,r=e;return t?s=MP(r):s=IP(r),Object.assign(n,s),n}},xp=class{},Rp=class{},Dp=class{},Ip=class{},nE=class{},iE=class{},sE=class{};var rE=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,r=UP(e);return Object.assign(n,r),n}},oE=class{},aE=class{},lE=class{};var Mp=class{};var cE=class{get text(){var e,t,n;let s="",r=!1,o=[];for(let a of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[l,c]of Object.entries(a))l!=="text"&&l!=="thought"&&c!==null&&o.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;r=!0,s+=a.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?s:void 0}get data(){var e,t,n;let s="",r=[];for(let o of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(let[a,l]of Object.entries(o))a!=="inlineData"&&l!==null&&r.push(a);o.inlineData&&typeof o.inlineData.data=="string"&&(s+=atob(o.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}};var dE=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var uE=class i{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new i,r=M0(e);return Object.assign(n,r),n}};function de(i,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(i.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function P0(i,e){let t=de(i,e);return t?t.startsWith("publishers/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}`:t.startsWith("models/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/publishers/google/${t}`:t:""}function k0(i){return Array.isArray(i)?i.map(e=>Pp(e)):[Pp(i)]}function Pp(i){if(typeof i=="object"&&i!==null)return i;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof i}`)}function N0(i){let e=Pp(i);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function F0(i){let e=Pp(i);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function o0(i){if(i==null)throw new Error("PartUnion is required");if(typeof i=="object")return i;if(typeof i=="string")return{text:i};throw new Error(`Unsupported part type: ${typeof i}`)}function L0(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("PartListUnion is required");return Array.isArray(i)?i.map(e=>o0(e)):[o0(i)]}function hE(i){return i!=null&&typeof i=="object"&&"parts"in i&&Array.isArray(i.parts)}function a0(i){return i!=null&&typeof i=="object"&&"functionCall"in i}function l0(i){return i!=null&&typeof i=="object"&&"functionResponse"in i}function lt(i){if(i==null)throw new Error("ContentUnion is required");return hE(i)?i:{role:"user",parts:L0(i)}}function KE(i,e){if(!e)return[];if(i.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let n=lt(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(i.isVertexAI()){let t=lt(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>lt(t)):[lt(e)]}function un(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("contents are required");if(!Array.isArray(i)){if(a0(i)||l0(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[lt(i)]}let e=[],t=[],n=hE(i[0]);for(let s of i){let r=hE(s);if(r!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(s);else{if(a0(s)||l0(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(s)}}return n||e.push({role:"user",parts:L0(t)}),e}function GP(i,e){i.includes("null")&&(e.nullable=!0);let t=i.filter(n=>n!=="null");if(t.length===1)e.type=Object.values(_s).includes(t[0].toUpperCase())?t[0].toUpperCase():_s.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let n of t)e.anyOf.push({type:Object.values(_s).includes(n.toUpperCase())?n.toUpperCase():_s.TYPE_UNSPECIFIED})}}function Ua(i){let e={},t=["items"],n=["anyOf"],s=["properties"];if(i.type&&i.anyOf)throw new Error("type and anyOf cannot be both populated.");let r=i.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,i=r[1]):r[1].type==="null"&&(e.nullable=!0,i=r[0])),i.type instanceof Array&&GP(i.type,e);for(let[o,a]of Object.entries(i))if(a!=null)if(o=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(_s).includes(a.toUpperCase())?a.toUpperCase():_s.TYPE_UNSPECIFIED}else if(t.includes(o))e[o]=Ua(a);else if(n.includes(o)){let l=[];for(let c of a){if(c.type=="null"){e.nullable=!0;continue}l.push(Ua(c))}e[o]=l}else if(s.includes(o)){let l={};for(let[c,d]of Object.entries(a))l[c]=Ua(d);e[o]=l}else{if(o==="additionalProperties")continue;e[o]=a}return e}function XE(i){return Ua(i)}function JE(i){if(typeof i=="object")return i;if(typeof i=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:i}}};throw new Error(`Unsupported speechConfig type: ${typeof i}`)}function ZE(i){if("multiSpeakerVoiceConfig"in i)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return i}function Va(i){if(i.functionDeclarations)for(let e of i.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Ua(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Ua(e.response));return i}function Ga(i){if(i==null)throw new Error("tools is required");if(!Array.isArray(i))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of i)e.push(t);return e}function zP(i,e,t,n=1){let s=!e.startsWith(`${t}/`)&&e.split("/").length===n;return i.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${i.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}`:s?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}/${e}`:e:s?`${t}/${e}`:e}function Li(i,e){if(typeof e!="string")throw new Error("name must be a string");return zP(i,e,"cachedContents")}function O0(i){switch(i){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return i}}function xs(i){return YE(i)}function WP(i){return i!=null&&typeof i=="object"&&"name"in i}function qP(i){return i!=null&&typeof i=="object"&&"video"in i}function YP(i){return i!=null&&typeof i=="object"&&"uri"in i}function U0(i){var e;let t;if(WP(i)&&(t=i.name),!(YP(i)&&(t=i.uri,t===void 0))&&!(qP(i)&&(t=(e=i.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof i=="string"&&(t=i),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let s=t.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${t}`);t=s[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function B0(i,e){let t;return i.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function H0(i){for(let e of["models","tunedModels","publisherModels"])if(KP(i,e))return i[e];return[]}function KP(i,e){return i!==null&&typeof i=="object"&&e in i}function XP(i,e={}){let t=i,n={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(n.responseJsonSchema=t.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function JP(i,e={}){let t=[],n=new Set;for(let s of i){let r=s.name;if(n.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);n.add(r);let o=XP(s,e);o.functionDeclarations&&t.push(...o.functionDeclarations)}return{functionDeclarations:t}}function $0(i,e){let t;if(typeof e=="string")if(i.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(i.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let n=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,s=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(i.isVertexAI()){if(s>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||s!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function ZP(i){if(typeof i!="string")return i;let e=i;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function V0(i){if(typeof i!="object"||i===null)return{};let e=i,t=e.inlinedResponses;if(typeof t!="object"||t===null)return i;let s=t.inlinedResponses;if(!Array.isArray(s)||s.length===0)return i;let r=!1;for(let o of s){if(typeof o!="object"||o===null)continue;let l=o.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),i}function za(i,e){let t=e;if(!i.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function G0(i){let e=i;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function jP(i){let e={},t=f(i,["responsesFile"]);t!=null&&g(e,["fileName"],t);let n=f(i,["inlinedResponses","inlinedResponses"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Pk(o))),g(e,["inlinedResponses"],r)}let s=f(i,["inlinedEmbedContentResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["inlinedEmbedContentResponses"],r)}return e}function QP(i){let e={},t=f(i,["predictionsFormat"]);t!=null&&g(e,["format"],t);let n=f(i,["gcsDestination","outputUriPrefix"]);n!=null&&g(e,["gcsUri"],n);let s=f(i,["bigqueryDestination","outputUri"]);return s!=null&&g(e,["bigqueryUri"],s),e}function ek(i){let e={},t=f(i,["format"]);t!=null&&g(e,["predictionsFormat"],t);let n=f(i,["gcsUri"]);n!=null&&g(e,["gcsDestination","outputUriPrefix"],n);let s=f(i,["bigqueryUri"]);if(s!=null&&g(e,["bigqueryDestination","outputUri"],s),f(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(i,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(f(i,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function vp(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata","displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["metadata","state"]);s!=null&&g(e,["state"],G0(s));let r=f(i,["metadata","createTime"]);r!=null&&g(e,["createTime"],r);let o=f(i,["metadata","endTime"]);o!=null&&g(e,["endTime"],o);let a=f(i,["metadata","updateTime"]);a!=null&&g(e,["updateTime"],a);let l=f(i,["metadata","model"]);l!=null&&g(e,["model"],l);let c=f(i,["metadata","output"]);return c!=null&&g(e,["dest"],jP(V0(c))),e}function fE(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["state"]);s!=null&&g(e,["state"],G0(s));let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["createTime"]);o!=null&&g(e,["createTime"],o);let a=f(i,["startTime"]);a!=null&&g(e,["startTime"],a);let l=f(i,["endTime"]);l!=null&&g(e,["endTime"],l);let c=f(i,["updateTime"]);c!=null&&g(e,["updateTime"],c);let d=f(i,["model"]);d!=null&&g(e,["model"],d);let u=f(i,["inputConfig"]);u!=null&&g(e,["src"],tk(u));let p=f(i,["outputConfig"]);p!=null&&g(e,["dest"],QP(V0(p)));let m=f(i,["completionStats"]);return m!=null&&g(e,["completionStats"],m),e}function tk(i){let e={},t=f(i,["instancesFormat"]);t!=null&&g(e,["format"],t);let n=f(i,["gcsSource","uris"]);n!=null&&g(e,["gcsUri"],n);let s=f(i,["bigquerySource","inputUri"]);return s!=null&&g(e,["bigqueryUri"],s),e}function nk(i,e){let t={};if(f(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(f(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let n=f(e,["fileName"]);n!=null&&g(t,["fileName"],n);let s=f(e,["inlinedRequests"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>Mk(i,o))),g(t,["requests","requests"],r)}return t}function ik(i){let e={},t=f(i,["format"]);t!=null&&g(e,["instancesFormat"],t);let n=f(i,["gcsUri"]);n!=null&&g(e,["gcsSource","uris"],n);let s=f(i,["bigqueryUri"]);if(s!=null&&g(e,["bigquerySource","inputUri"],s),f(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(i,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function sk(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function rk(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],za(i,n)),t}function ok(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],za(i,n)),t}function ak(i){let e={},t=f(i,["content"]);t!=null&&g(e,["content"],t);let n=f(i,["citationMetadata"]);n!=null&&g(e,["citationMetadata"],lk(n));let s=f(i,["tokenCount"]);s!=null&&g(e,["tokenCount"],s);let r=f(i,["finishReason"]);r!=null&&g(e,["finishReason"],r);let o=f(i,["avgLogprobs"]);o!=null&&g(e,["avgLogprobs"],o);let a=f(i,["groundingMetadata"]);a!=null&&g(e,["groundingMetadata"],a);let l=f(i,["index"]);l!=null&&g(e,["index"],l);let c=f(i,["logprobsResult"]);c!=null&&g(e,["logprobsResult"],c);let d=f(i,["safetyRatings"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>m)),g(e,["safetyRatings"],p)}let u=f(i,["urlContextMetadata"]);return u!=null&&g(e,["urlContextMetadata"],u),e}function lk(i){let e={},t=f(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),g(e,["citations"],n)}return e}function z0(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>Bk(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function ck(i,e){let t={},n=f(i,["displayName"]);if(e!==void 0&&n!=null&&g(e,["batch","displayName"],n),f(i,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function dk(i,e){let t={},n=f(i,["displayName"]);e!==void 0&&n!=null&&g(e,["displayName"],n);let s=f(i,["dest"]);return e!==void 0&&s!=null&&g(e,["outputConfig"],ek(ZP(s))),t}function c0(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["src"]);s!=null&&g(t,["batch","inputConfig"],nk(i,$0(i,s)));let r=f(e,["config"]);return r!=null&&ck(r,t),t}function uk(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["model"],de(i,n));let s=f(e,["src"]);s!=null&&g(t,["inputConfig"],ik($0(i,s)));let r=f(e,["config"]);return r!=null&&dk(r,t),t}function hk(i,e){let t={},n=f(i,["displayName"]);return e!==void 0&&n!=null&&g(e,["batch","displayName"],n),t}function fk(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["src"]);s!=null&&g(t,["batch","inputConfig"],Ek(i,s));let r=f(e,["config"]);return r!=null&&hk(r,t),t}function pk(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],za(i,n)),t}function gk(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],za(i,n)),t}function mk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);return r!=null&&g(e,["error"],r),e}function yk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);return r!=null&&g(e,["error"],r),e}function vk(i,e){let t={},n=f(e,["contents"]);if(n!=null){let r=KE(i,n);Array.isArray(r)&&(r=r.map(o=>o)),g(t,["requests[]","request","content"],r)}let s=f(e,["config"]);return s!=null&&(g(t,["_self"],bk(s,t)),RP(t,{"requests[].*":"requests[].request.*"})),t}function bk(i,e){let t={},n=f(i,["taskType"]);e!==void 0&&n!=null&&g(e,["requests[]","taskType"],n);let s=f(i,["title"]);e!==void 0&&s!=null&&g(e,["requests[]","title"],s);let r=f(i,["outputDimensionality"]);if(e!==void 0&&r!=null&&g(e,["requests[]","outputDimensionality"],r),f(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function Ek(i,e){let t={},n=f(e,["fileName"]);n!=null&&g(t,["file_name"],n);let s=f(e,["inlinedRequests"]);return s!=null&&g(t,["requests"],vk(i,s)),t}function Sk(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function wk(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Ak(i){let e={},t=f(i,["mode"]);t!=null&&g(e,["mode"],t);let n=f(i,["allowedFunctionNames"]);if(n!=null&&g(e,["allowedFunctionNames"],n),f(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Ck(i,e,t){let n={},s=f(e,["systemInstruction"]);t!==void 0&&s!=null&&g(t,["systemInstruction"],z0(lt(s)));let r=f(e,["temperature"]);r!=null&&g(n,["temperature"],r);let o=f(e,["topP"]);o!=null&&g(n,["topP"],o);let a=f(e,["topK"]);a!=null&&g(n,["topK"],a);let l=f(e,["candidateCount"]);l!=null&&g(n,["candidateCount"],l);let c=f(e,["maxOutputTokens"]);c!=null&&g(n,["maxOutputTokens"],c);let d=f(e,["stopSequences"]);d!=null&&g(n,["stopSequences"],d);let u=f(e,["responseLogprobs"]);u!=null&&g(n,["responseLogprobs"],u);let p=f(e,["logprobs"]);p!=null&&g(n,["logprobs"],p);let m=f(e,["presencePenalty"]);m!=null&&g(n,["presencePenalty"],m);let y=f(e,["frequencyPenalty"]);y!=null&&g(n,["frequencyPenalty"],y);let v=f(e,["seed"]);v!=null&&g(n,["seed"],v);let b=f(e,["responseMimeType"]);b!=null&&g(n,["responseMimeType"],b);let S=f(e,["responseSchema"]);S!=null&&g(n,["responseSchema"],XE(S));let C=f(e,["responseJsonSchema"]);if(C!=null&&g(n,["responseJsonSchema"],C),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let T=f(e,["safetySettings"]);if(t!==void 0&&T!=null){let K=T;Array.isArray(K)&&(K=K.map(se=>Hk(se))),g(t,["safetySettings"],K)}let _=f(e,["tools"]);if(t!==void 0&&_!=null){let K=Ga(_);Array.isArray(K)&&(K=K.map(se=>Vk(Va(se)))),g(t,["tools"],K)}let R=f(e,["toolConfig"]);if(t!==void 0&&R!=null&&g(t,["toolConfig"],$k(R)),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let I=f(e,["cachedContent"]);t!==void 0&&I!=null&&g(t,["cachedContent"],Li(i,I));let M=f(e,["responseModalities"]);M!=null&&g(n,["responseModalities"],M);let k=f(e,["mediaResolution"]);k!=null&&g(n,["mediaResolution"],k);let N=f(e,["speechConfig"]);if(N!=null&&g(n,["speechConfig"],JE(N)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=f(e,["thinkingConfig"]);F!=null&&g(n,["thinkingConfig"],F);let $=f(e,["imageConfig"]);$!=null&&g(n,["imageConfig"],Ik($));let ae=f(e,["enableEnhancedCivicAnswers"]);return ae!=null&&g(n,["enableEnhancedCivicAnswers"],ae),n}function Tk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>ak(c))),g(e,["candidates"],l)}let s=f(i,["modelVersion"]);s!=null&&g(e,["modelVersion"],s);let r=f(i,["promptFeedback"]);r!=null&&g(e,["promptFeedback"],r);let o=f(i,["responseId"]);o!=null&&g(e,["responseId"],o);let a=f(i,["usageMetadata"]);return a!=null&&g(e,["usageMetadata"],a),e}function _k(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],za(i,n)),t}function xk(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],za(i,n)),t}function Rk(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function Dk(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function Ik(i){let e={},t=f(i,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);let n=f(i,["imageSize"]);if(n!=null&&g(e,["imageSize"],n),f(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Mk(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["request","model"],de(i,n));let s=f(e,["contents"]);if(s!=null){let a=un(s);Array.isArray(a)&&(a=a.map(l=>z0(l))),g(t,["request","contents"],a)}let r=f(e,["metadata"]);r!=null&&g(t,["metadata"],r);let o=f(e,["config"]);return o!=null&&g(t,["request","generationConfig"],Ck(i,o,f(t,["request"],{}))),t}function Pk(i){let e={},t=f(i,["response"]);t!=null&&g(e,["response"],Tk(t));let n=f(i,["error"]);return n!=null&&g(e,["error"],n),e}function kk(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);if(e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),f(i,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function Nk(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);e!==void 0&&s!=null&&g(e,["_query","pageToken"],s);let r=f(i,["filter"]);return e!==void 0&&r!=null&&g(e,["_query","filter"],r),t}function Fk(i){let e={},t=f(i,["config"]);return t!=null&&kk(t,e),e}function Lk(i){let e={},t=f(i,["config"]);return t!=null&&Nk(t,e),e}function Ok(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["operations"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>vp(o))),g(e,["batchJobs"],r)}return e}function Uk(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["batchPredictionJobs"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>fE(o))),g(e,["batchJobs"],r)}return e}function Bk(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],Sk(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],wk(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],sk(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let u=f(i,["thoughtSignature"]);u!=null&&g(e,["thoughtSignature"],u);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function Hk(i){let e={},t=f(i,["category"]);if(t!=null&&g(e,["category"],t),f(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=f(i,["threshold"]);return n!=null&&g(e,["threshold"],n),e}function $k(i){let e={},t=f(i,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],Ak(t));let n=f(i,["retrievalConfig"]);return n!=null&&g(e,["retrievalConfig"],n),e}function Vk(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(u=>u)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],Rk(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],Dk(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}var Ni;(function(i){i.PAGED_ITEM_BATCH_JOBS="batchJobs",i.PAGED_ITEM_MODELS="models",i.PAGED_ITEM_TUNING_JOBS="tuningJobs",i.PAGED_ITEM_FILES="files",i.PAGED_ITEM_CACHED_CONTENTS="cachedContents",i.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",i.PAGED_ITEM_DOCUMENTS="documents"})(Ni||(Ni={}));var Fi=class{constructor(e,t,n,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,s)}init(e,t,n){var s,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let o={config:{}};!n||Object.keys(n).length===0?o={config:{}}:typeof n=="object"?o=Object.assign({},n):o=n,o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(r=(s=o.config)===null||s===void 0?void 0:s.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var pE=class extends Rn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Fi(Ni.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){let t=c0(this.apiClient,e),n=t._url,s=U("{model}:batchGenerateContent",n),a=t.batch.inputConfig.requests,l=a.requests,c=[];for(let d of l){let u=Object.assign({},d);if(u.systemInstruction){let p=u.systemInstruction;delete u.systemInstruction;let m=u.request;m.systemInstruction=p,u.request=m}c.push(u)}return a.requests=c,delete t.config,delete t._url,delete t._query,{path:s,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},s=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${s}`),n.dest===void 0){let r=this.getGcsUri(e),o=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?n.dest=`${r.slice(0,-6)}/dest`:n.dest=`${r}_dest_${s}`;else if(o)n.dest=`${o}_dest_${s}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=uk(this.apiClient,e);return a=U("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>fE(d))}else{let c=c0(this.apiClient,e);return a=U("{model}:batchGenerateContent",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>vp(d))}}async createEmbeddingsInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=fk(this.apiClient,e);return r=U("{model}:asyncBatchEmbedContent",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>vp(l))}}async get(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=xk(this.apiClient,e);return a=U("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>fE(d))}else{let c=_k(this.apiClient,e);return a=U("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>vp(d))}}async cancel(e){var t,n,s,r;let o="",a={};if(this.apiClient.isVertexAI()){let l=ok(this.apiClient,e);o=U("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{let l=rk(this.apiClient,e);o=U("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=Lk(e);return a=U("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=Uk(d),p=new Mp;return Object.assign(p,u),p})}else{let c=Fk(e);return a=U("batches",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=Ok(d),p=new Mp;return Object.assign(p,u),p})}}async delete(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=gk(this.apiClient,e);return a=U("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>yk(d))}else{let c=pk(this.apiClient,e);return a=U("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>mk(d))}}};function Gk(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function d0(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>hN(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function zk(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);e!==void 0&&s!=null&&g(e,["expireTime"],s);let r=f(i,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);let o=f(i,["contents"]);if(e!==void 0&&o!=null){let d=un(o);Array.isArray(d)&&(d=d.map(u=>d0(u))),g(e,["contents"],d)}let a=f(i,["systemInstruction"]);e!==void 0&&a!=null&&g(e,["systemInstruction"],d0(lt(a)));let l=f(i,["tools"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(u=>pN(u))),g(e,["tools"],d)}let c=f(i,["toolConfig"]);if(e!==void 0&&c!=null&&g(e,["toolConfig"],fN(c)),f(i,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function Wk(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);e!==void 0&&s!=null&&g(e,["expireTime"],s);let r=f(i,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);let o=f(i,["contents"]);if(e!==void 0&&o!=null){let u=un(o);Array.isArray(u)&&(u=u.map(p=>p)),g(e,["contents"],u)}let a=f(i,["systemInstruction"]);e!==void 0&&a!=null&&g(e,["systemInstruction"],lt(a));let l=f(i,["tools"]);if(e!==void 0&&l!=null){let u=l;Array.isArray(u)&&(u=u.map(p=>gN(p))),g(e,["tools"],u)}let c=f(i,["toolConfig"]);e!==void 0&&c!=null&&g(e,["toolConfig"],c);let d=f(i,["kmsKeyName"]);return e!==void 0&&d!=null&&g(e,["encryption_spec","kmsKeyName"],d),t}function qk(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["model"],P0(i,n));let s=f(e,["config"]);return s!=null&&zk(s,t),t}function Yk(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["model"],P0(i,n));let s=f(e,["config"]);return s!=null&&Wk(s,t),t}function Kk(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Li(i,n)),t}function Xk(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Li(i,n)),t}function Jk(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function Zk(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function jk(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function Qk(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function eN(i){let e={},t=f(i,["mode"]);t!=null&&g(e,["mode"],t);let n=f(i,["allowedFunctionNames"]);if(n!=null&&g(e,["allowedFunctionNames"],n),f(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function tN(i){let e={};if(f(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=f(i,["description"]);t!=null&&g(e,["description"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["parameters"]);s!=null&&g(e,["parameters"],s);let r=f(i,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);let o=f(i,["response"]);o!=null&&g(e,["response"],o);let a=f(i,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function nN(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Li(i,n)),t}function iN(i,e){let t={},n=f(e,["name"]);return n!=null&&g(t,["_url","name"],Li(i,n)),t}function sN(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function rN(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function oN(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function aN(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function lN(i){let e={},t=f(i,["config"]);return t!=null&&oN(t,e),e}function cN(i){let e={},t=f(i,["config"]);return t!=null&&aN(t,e),e}function dN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["cachedContents"],r)}return e}function uN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["cachedContents"],r)}return e}function hN(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],jk(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],Qk(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],Gk(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let u=f(i,["thoughtSignature"]);u!=null&&g(e,["thoughtSignature"],u);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function fN(i){let e={},t=f(i,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],eN(t));let n=f(i,["retrievalConfig"]);return n!=null&&g(e,["retrievalConfig"],n),e}function pN(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(u=>u)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],sN(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],rN(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function gN(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(p=>tN(p))),g(e,["functionDeclarations"],u)}let n=f(i,["retrieval"]);n!=null&&g(e,["retrieval"],n);let s=f(i,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);let r=f(i,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=f(i,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);let a=f(i,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);let l=f(i,["googleMaps"]);l!=null&&g(e,["googleMaps"],l);let c=f(i,["googleSearch"]);c!=null&&g(e,["googleSearch"],c);let d=f(i,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function mN(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);return e!==void 0&&s!=null&&g(e,["expireTime"],s),t}function yN(i,e){let t={},n=f(i,["ttl"]);e!==void 0&&n!=null&&g(e,["ttl"],n);let s=f(i,["expireTime"]);return e!==void 0&&s!=null&&g(e,["expireTime"],s),t}function vN(i,e){let t={},n=f(e,["name"]);n!=null&&g(t,["_url","name"],Li(i,n));let s=f(e,["config"]);return s!=null&&mN(s,t),t}function bN(i,e){let t={},n=f(e,["name"]);n!=null&&g(t,["_url","name"],Li(i,n));let s=f(e,["config"]);return s!=null&&yN(s,t),t}var gE=class extends Rn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Fi(Ni.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=Yk(this.apiClient,e);return a=U("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let c=qk(this.apiClient,e);return a=U("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async get(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=iN(this.apiClient,e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let c=nN(this.apiClient,e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async delete(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=Xk(this.apiClient,e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=Zk(d),p=new Dp;return Object.assign(p,u),p})}else{let c=Kk(this.apiClient,e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=Jk(d),p=new Dp;return Object.assign(p,u),p})}}async update(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=bN(this.apiClient,e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{let c=vN(this.apiClient,e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=cN(e);return a=U("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=uN(d),p=new Ip;return Object.assign(p,u),p})}else{let c=lN(e);return a=U("cachedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=dN(d),p=new Ip;return Object.assign(p,u),p})}}};function kp(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t}function u0(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function J(i){return this instanceof J?(this.v=i,this):new J(i)}function _n(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),s,r=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(m){return function(y){return Promise.resolve(y).then(m,u)}}function a(m,y){n[m]&&(s[m]=function(v){return new Promise(function(b,S){r.push([m,v,b,S])>1||l(m,v)})},y&&(s[m]=y(s[m])))}function l(m,y){try{c(n[m](y))}catch(v){p(r[0][3],v)}}function c(m){m.value instanceof J?Promise.resolve(m.value.v).then(d,u):p(r[0][2],m)}function d(m){l("next",m)}function u(m){l("throw",m)}function p(m,y){m(y),r.shift(),r.length&&l(r[0][0],r[0][1])}}function xn(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof u0=="function"?u0(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=i[r]&&function(o){return new Promise(function(a,l){o=i[r](o),s(a,l,o.done,o.value)})}}function s(r,o,a,l){Promise.resolve(l).then(function(c){r({value:c,done:a})},o)}}function EN(i){var e;if(i.candidates==null||i.candidates.length===0)return!1;let t=(e=i.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:W0(t)}function W0(i){if(i.parts===void 0||i.parts.length===0)return!1;for(let e of i.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function SN(i){if(i.length!==0){for(let e of i)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function h0(i){if(i===void 0||i.length===0)return[];let e=[],t=i.length,n=0;for(;n<t;)if(i[n].role==="user")e.push(i[n]),n++;else{let s=[],r=!0;for(;n<t&&i[n].role==="model";)s.push(i[n]),r&&!W0(i[n])&&(r=!1),n++;r?e.push(...s):e.pop()}return e}var mE=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new yE(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},yE=class{constructor(e,t,n,s={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=s,this.history=r,this.sendPromise=Promise.resolve(),SN(r)}async sendMessage(e){var t;await this.sendPromise;let n=lt(e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,o,a;let l=await s,c=(o=(r=l.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content,d=l.automaticFunctionCallingHistory,u=this.getHistory(!0).length,p=[];d!=null&&(p=(a=d.slice(u))!==null&&a!==void 0?a:[]);let m=c?[c]:[];this.recordHistory(n,m,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(e){var t;await this.sendPromise;let n=lt(e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});let r=await s;return this.processStreamResponse(r,n)}getHistory(e=!1){let t=e?h0(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return _n(this,arguments,function*(){var s,r,o,a,l,c;let d=[];try{for(var u=!0,p=xn(e),m;m=yield J(p.next()),s=m.done,!s;u=!0){a=m.value,u=!1;let y=a;if(EN(y)){let v=(c=(l=y.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content;v!==void 0&&d.push(v)}yield yield J(y)}}catch(y){r={error:y}}finally{try{!u&&!s&&(o=p.return)&&(yield J(o.call(p)))}finally{if(r)throw r.error}}this.recordHistory(t,d)})}recordHistory(e,t,n){let s=[];t.length>0&&t.every(r=>r.role!==void 0)?s=t:s.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...h0(n)):this.history.push(e),this.history.push(...s)}};var Np=class i extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,i.prototype)}};function wN(i){let e={},t=f(i,["file"]);return t!=null&&g(e,["file"],t),e}function AN(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function CN(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","file"],U0(t)),e}function TN(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function _N(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","file"],U0(t)),e}function xN(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function RN(i){let e={},t=f(i,["config"]);return t!=null&&xN(t,e),e}function DN(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["files"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["files"],r)}return e}var vE=class extends Rn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Fi(Ni.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=RN(e);return r=U("files",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=DN(l),d=new oE;return Object.assign(d,c),d})}}async createInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=wN(e);return r=U("upload/v1beta/files",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=AN(l),d=new aE;return Object.assign(d,c),d})}}async get(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=_N(e);return r=U("files/{file}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=CN(e);return r=U("files/{file}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=TN(l),d=new lE;return Object.assign(d,c),d})}}};function bp(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function IN(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>qN(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function MN(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function PN(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function kN(i){let e={};if(f(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=f(i,["description"]);t!=null&&g(e,["description"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["parameters"]);s!=null&&g(e,["parameters"],s);let r=f(i,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);let o=f(i,["response"]);o!=null&&g(e,["response"],o);let a=f(i,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function NN(i){let e={},t=f(i,["modelSelectionConfig"]);t!=null&&g(e,["modelConfig"],t);let n=f(i,["responseJsonSchema"]);n!=null&&g(e,["responseJsonSchema"],n);let s=f(i,["audioTimestamp"]);s!=null&&g(e,["audioTimestamp"],s);let r=f(i,["candidateCount"]);r!=null&&g(e,["candidateCount"],r);let o=f(i,["enableAffectiveDialog"]);o!=null&&g(e,["enableAffectiveDialog"],o);let a=f(i,["frequencyPenalty"]);a!=null&&g(e,["frequencyPenalty"],a);let l=f(i,["logprobs"]);l!=null&&g(e,["logprobs"],l);let c=f(i,["maxOutputTokens"]);c!=null&&g(e,["maxOutputTokens"],c);let d=f(i,["mediaResolution"]);d!=null&&g(e,["mediaResolution"],d);let u=f(i,["presencePenalty"]);u!=null&&g(e,["presencePenalty"],u);let p=f(i,["responseLogprobs"]);p!=null&&g(e,["responseLogprobs"],p);let m=f(i,["responseMimeType"]);m!=null&&g(e,["responseMimeType"],m);let y=f(i,["responseModalities"]);y!=null&&g(e,["responseModalities"],y);let v=f(i,["responseSchema"]);v!=null&&g(e,["responseSchema"],v);let b=f(i,["routingConfig"]);b!=null&&g(e,["routingConfig"],b);let S=f(i,["seed"]);S!=null&&g(e,["seed"],S);let C=f(i,["speechConfig"]);C!=null&&g(e,["speechConfig"],C);let T=f(i,["stopSequences"]);T!=null&&g(e,["stopSequences"],T);let _=f(i,["temperature"]);_!=null&&g(e,["temperature"],_);let R=f(i,["thinkingConfig"]);R!=null&&g(e,["thinkingConfig"],R);let I=f(i,["topK"]);I!=null&&g(e,["topK"],I);let M=f(i,["topP"]);if(M!=null&&g(e,["topP"],M),f(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function FN(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function LN(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function ON(i,e){let t={},n=f(i,["generationConfig"]);e!==void 0&&n!=null&&g(e,["setup","generationConfig"],n);let s=f(i,["responseModalities"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig","responseModalities"],s);let r=f(i,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);let o=f(i,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);let a=f(i,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);let l=f(i,["maxOutputTokens"]);e!==void 0&&l!=null&&g(e,["setup","generationConfig","maxOutputTokens"],l);let c=f(i,["mediaResolution"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","mediaResolution"],c);let d=f(i,["seed"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","seed"],d);let u=f(i,["speechConfig"]);e!==void 0&&u!=null&&g(e,["setup","generationConfig","speechConfig"],ZE(u));let p=f(i,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);let m=f(i,["enableAffectiveDialog"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=f(i,["systemInstruction"]);e!==void 0&&y!=null&&g(e,["setup","systemInstruction"],IN(lt(y)));let v=f(i,["tools"]);if(e!==void 0&&v!=null){let I=Ga(v);Array.isArray(I)&&(I=I.map(M=>KN(Va(M)))),g(e,["setup","tools"],I)}let b=f(i,["sessionResumption"]);e!==void 0&&b!=null&&g(e,["setup","sessionResumption"],YN(b));let S=f(i,["inputAudioTranscription"]);e!==void 0&&S!=null&&g(e,["setup","inputAudioTranscription"],S);let C=f(i,["outputAudioTranscription"]);e!==void 0&&C!=null&&g(e,["setup","outputAudioTranscription"],C);let T=f(i,["realtimeInputConfig"]);e!==void 0&&T!=null&&g(e,["setup","realtimeInputConfig"],T);let _=f(i,["contextWindowCompression"]);e!==void 0&&_!=null&&g(e,["setup","contextWindowCompression"],_);let R=f(i,["proactivity"]);if(e!==void 0&&R!=null&&g(e,["setup","proactivity"],R),f(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function UN(i,e){let t={},n=f(i,["generationConfig"]);e!==void 0&&n!=null&&g(e,["setup","generationConfig"],NN(n));let s=f(i,["responseModalities"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig","responseModalities"],s);let r=f(i,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);let o=f(i,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);let a=f(i,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);let l=f(i,["maxOutputTokens"]);e!==void 0&&l!=null&&g(e,["setup","generationConfig","maxOutputTokens"],l);let c=f(i,["mediaResolution"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","mediaResolution"],c);let d=f(i,["seed"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","seed"],d);let u=f(i,["speechConfig"]);e!==void 0&&u!=null&&g(e,["setup","generationConfig","speechConfig"],ZE(u));let p=f(i,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);let m=f(i,["enableAffectiveDialog"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=f(i,["systemInstruction"]);e!==void 0&&y!=null&&g(e,["setup","systemInstruction"],lt(y));let v=f(i,["tools"]);if(e!==void 0&&v!=null){let M=Ga(v);Array.isArray(M)&&(M=M.map(k=>XN(Va(k)))),g(e,["setup","tools"],M)}let b=f(i,["sessionResumption"]);e!==void 0&&b!=null&&g(e,["setup","sessionResumption"],b);let S=f(i,["inputAudioTranscription"]);e!==void 0&&S!=null&&g(e,["setup","inputAudioTranscription"],S);let C=f(i,["outputAudioTranscription"]);e!==void 0&&C!=null&&g(e,["setup","outputAudioTranscription"],C);let T=f(i,["realtimeInputConfig"]);e!==void 0&&T!=null&&g(e,["setup","realtimeInputConfig"],T);let _=f(i,["contextWindowCompression"]);e!==void 0&&_!=null&&g(e,["setup","contextWindowCompression"],_);let R=f(i,["proactivity"]);e!==void 0&&R!=null&&g(e,["setup","proactivity"],R);let I=f(i,["explicitVadSignal"]);return e!==void 0&&I!=null&&g(e,["setup","explicitVadSignal"],I),t}function BN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["setup","model"],de(i,n));let s=f(e,["config"]);return s!=null&&g(t,["config"],ON(s,t)),t}function HN(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["setup","model"],de(i,n));let s=f(e,["config"]);return s!=null&&g(t,["config"],UN(s,t)),t}function $N(i){let e={},t=f(i,["musicGenerationConfig"]);return t!=null&&g(e,["musicGenerationConfig"],t),e}function VN(i){let e={},t=f(i,["weightedPrompts"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),g(e,["weightedPrompts"],n)}return e}function GN(i){let e={},t=f(i,["media"]);if(t!=null){let c=k0(t);Array.isArray(c)&&(c=c.map(d=>bp(d))),g(e,["mediaChunks"],c)}let n=f(i,["audio"]);n!=null&&g(e,["audio"],bp(F0(n)));let s=f(i,["audioStreamEnd"]);s!=null&&g(e,["audioStreamEnd"],s);let r=f(i,["video"]);r!=null&&g(e,["video"],bp(N0(r)));let o=f(i,["text"]);o!=null&&g(e,["text"],o);let a=f(i,["activityStart"]);a!=null&&g(e,["activityStart"],a);let l=f(i,["activityEnd"]);return l!=null&&g(e,["activityEnd"],l),e}function zN(i){let e={},t=f(i,["media"]);if(t!=null){let c=k0(t);Array.isArray(c)&&(c=c.map(d=>d)),g(e,["mediaChunks"],c)}let n=f(i,["audio"]);n!=null&&g(e,["audio"],F0(n));let s=f(i,["audioStreamEnd"]);s!=null&&g(e,["audioStreamEnd"],s);let r=f(i,["video"]);r!=null&&g(e,["video"],N0(r));let o=f(i,["text"]);o!=null&&g(e,["text"],o);let a=f(i,["activityStart"]);a!=null&&g(e,["activityStart"],a);let l=f(i,["activityEnd"]);return l!=null&&g(e,["activityEnd"],l),e}function WN(i){let e={},t=f(i,["setupComplete"]);t!=null&&g(e,["setupComplete"],t);let n=f(i,["serverContent"]);n!=null&&g(e,["serverContent"],n);let s=f(i,["toolCall"]);s!=null&&g(e,["toolCall"],s);let r=f(i,["toolCallCancellation"]);r!=null&&g(e,["toolCallCancellation"],r);let o=f(i,["usageMetadata"]);o!=null&&g(e,["usageMetadata"],JN(o));let a=f(i,["goAway"]);a!=null&&g(e,["goAway"],a);let l=f(i,["sessionResumptionUpdate"]);l!=null&&g(e,["sessionResumptionUpdate"],l);let c=f(i,["voiceActivityDetectionSignal"]);return c!=null&&g(e,["voiceActivityDetectionSignal"],c),e}function qN(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],MN(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],PN(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],bp(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let u=f(i,["thoughtSignature"]);u!=null&&g(e,["thoughtSignature"],u);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function YN(i){let e={},t=f(i,["handle"]);if(t!=null&&g(e,["handle"],t),f(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function KN(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(u=>u)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],FN(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],LN(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function XN(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(p=>kN(p))),g(e,["functionDeclarations"],u)}let n=f(i,["retrieval"]);n!=null&&g(e,["retrieval"],n);let s=f(i,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);let r=f(i,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=f(i,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);let a=f(i,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);let l=f(i,["googleMaps"]);l!=null&&g(e,["googleMaps"],l);let c=f(i,["googleSearch"]);c!=null&&g(e,["googleSearch"],c);let d=f(i,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function JN(i){let e={},t=f(i,["promptTokenCount"]);t!=null&&g(e,["promptTokenCount"],t);let n=f(i,["cachedContentTokenCount"]);n!=null&&g(e,["cachedContentTokenCount"],n);let s=f(i,["candidatesTokenCount"]);s!=null&&g(e,["responseTokenCount"],s);let r=f(i,["toolUsePromptTokenCount"]);r!=null&&g(e,["toolUsePromptTokenCount"],r);let o=f(i,["thoughtsTokenCount"]);o!=null&&g(e,["thoughtsTokenCount"],o);let a=f(i,["totalTokenCount"]);a!=null&&g(e,["totalTokenCount"],a);let l=f(i,["promptTokensDetails"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["promptTokensDetails"],m)}let c=f(i,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["cacheTokensDetails"],m)}let d=f(i,["candidatesTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["responseTokensDetails"],m)}let u=f(i,["toolUsePromptTokensDetails"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(y=>y)),g(e,["toolUsePromptTokensDetails"],m)}let p=f(i,["trafficType"]);return p!=null&&g(e,["trafficType"],p),e}function ZN(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function jN(i){let e={},t=f(i,["content"]);t!=null&&g(e,["content"],t);let n=f(i,["citationMetadata"]);n!=null&&g(e,["citationMetadata"],QN(n));let s=f(i,["tokenCount"]);s!=null&&g(e,["tokenCount"],s);let r=f(i,["finishReason"]);r!=null&&g(e,["finishReason"],r);let o=f(i,["avgLogprobs"]);o!=null&&g(e,["avgLogprobs"],o);let a=f(i,["groundingMetadata"]);a!=null&&g(e,["groundingMetadata"],a);let l=f(i,["index"]);l!=null&&g(e,["index"],l);let c=f(i,["logprobsResult"]);c!=null&&g(e,["logprobsResult"],c);let d=f(i,["safetyRatings"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>m)),g(e,["safetyRatings"],p)}let u=f(i,["urlContextMetadata"]);return u!=null&&g(e,["urlContextMetadata"],u),e}function QN(i){let e={},t=f(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),g(e,["citations"],n)}return e}function eF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["contents"]);if(s!=null){let r=un(s);Array.isArray(r)&&(r=r.map(o=>o)),g(t,["contents"],r)}return t}function tF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["tokensInfo"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),g(e,["tokensInfo"],s)}return e}function nF(i){let e={},t=f(i,["values"]);t!=null&&g(e,["values"],t);let n=f(i,["statistics"]);return n!=null&&g(e,["statistics"],iF(n)),e}function iF(i){let e={},t=f(i,["truncated"]);t!=null&&g(e,["truncated"],t);let n=f(i,["token_count"]);return n!=null&&g(e,["tokenCount"],n),e}function Zp(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>hL(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function sF(i){let e={},t=f(i,["controlType"]);t!=null&&g(e,["controlType"],t);let n=f(i,["enableControlImageComputation"]);return n!=null&&g(e,["computeControl"],n),e}function rF(i){let e={};if(f(i,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(f(i,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(f(i,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function oF(i,e){let t={},n=f(i,["systemInstruction"]);e!==void 0&&n!=null&&g(e,["systemInstruction"],lt(n));let s=f(i,["tools"]);if(e!==void 0&&s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>X0(a))),g(e,["tools"],o)}let r=f(i,["generationConfig"]);return e!==void 0&&r!=null&&g(e,["generationConfig"],ZF(r)),t}function aF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["contents"]);if(s!=null){let o=un(s);Array.isArray(o)&&(o=o.map(a=>Zp(a))),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&rF(r),t}function lF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["contents"]);if(s!=null){let o=un(s);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&oF(r,t),t}function cF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["totalTokens"]);n!=null&&g(e,["totalTokens"],n);let s=f(i,["cachedContentTokenCount"]);return s!=null&&g(e,["cachedContentTokenCount"],s),e}function dF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["totalTokens"]);return n!=null&&g(e,["totalTokens"],n),e}function uF(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],de(i,n)),t}function hF(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],de(i,n)),t}function fF(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function pF(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function gF(i,e){let t={},n=f(i,["outputGcsUri"]);e!==void 0&&n!=null&&g(e,["parameters","storageUri"],n);let s=f(i,["negativePrompt"]);e!==void 0&&s!=null&&g(e,["parameters","negativePrompt"],s);let r=f(i,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);let o=f(i,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);let a=f(i,["guidanceScale"]);e!==void 0&&a!=null&&g(e,["parameters","guidanceScale"],a);let l=f(i,["seed"]);e!==void 0&&l!=null&&g(e,["parameters","seed"],l);let c=f(i,["safetyFilterLevel"]);e!==void 0&&c!=null&&g(e,["parameters","safetySetting"],c);let d=f(i,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);let u=f(i,["includeSafetyAttributes"]);e!==void 0&&u!=null&&g(e,["parameters","includeSafetyAttributes"],u);let p=f(i,["includeRaiReason"]);e!==void 0&&p!=null&&g(e,["parameters","includeRaiReason"],p);let m=f(i,["language"]);e!==void 0&&m!=null&&g(e,["parameters","language"],m);let y=f(i,["outputMimeType"]);e!==void 0&&y!=null&&g(e,["parameters","outputOptions","mimeType"],y);let v=f(i,["outputCompressionQuality"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","compressionQuality"],v);let b=f(i,["addWatermark"]);e!==void 0&&b!=null&&g(e,["parameters","addWatermark"],b);let S=f(i,["labels"]);e!==void 0&&S!=null&&g(e,["labels"],S);let C=f(i,["editMode"]);e!==void 0&&C!=null&&g(e,["parameters","editMode"],C);let T=f(i,["baseSteps"]);return e!==void 0&&T!=null&&g(e,["parameters","editConfig","baseSteps"],T),t}function mF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["referenceImages"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>vL(l))),g(t,["instances[0]","referenceImages"],a)}let o=f(e,["config"]);return o!=null&&gF(o,t),t}function yF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>jp(r))),g(e,["generatedImages"],s)}return e}function vF(i,e){let t={},n=f(i,["taskType"]);e!==void 0&&n!=null&&g(e,["requests[]","taskType"],n);let s=f(i,["title"]);e!==void 0&&s!=null&&g(e,["requests[]","title"],s);let r=f(i,["outputDimensionality"]);if(e!==void 0&&r!=null&&g(e,["requests[]","outputDimensionality"],r),f(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function bF(i,e){let t={},n=f(i,["taskType"]);e!==void 0&&n!=null&&g(e,["instances[]","task_type"],n);let s=f(i,["title"]);e!==void 0&&s!=null&&g(e,["instances[]","title"],s);let r=f(i,["outputDimensionality"]);e!==void 0&&r!=null&&g(e,["parameters","outputDimensionality"],r);let o=f(i,["mimeType"]);e!==void 0&&o!=null&&g(e,["instances[]","mimeType"],o);let a=f(i,["autoTruncate"]);return e!==void 0&&a!=null&&g(e,["parameters","autoTruncate"],a),t}function EF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["contents"]);if(s!=null){let a=KE(i,s);Array.isArray(a)&&(a=a.map(l=>l)),g(t,["requests[]","content"],a)}let r=f(e,["config"]);r!=null&&vF(r,t);let o=f(e,["model"]);return o!==void 0&&g(t,["requests[]","model"],de(i,o)),t}function SF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["contents"]);if(s!=null){let o=KE(i,s);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["instances[]","content"],o)}let r=f(e,["config"]);return r!=null&&bF(r,t),t}function wF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["embeddings"],r)}let s=f(i,["metadata"]);return s!=null&&g(e,["metadata"],s),e}function AF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions[]","embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>nF(o))),g(e,["embeddings"],r)}let s=f(i,["metadata"]);return s!=null&&g(e,["metadata"],s),e}function CF(i){let e={},t=f(i,["endpoint"]);t!=null&&g(e,["name"],t);let n=f(i,["deployedModelId"]);return n!=null&&g(e,["deployedModelId"],n),e}function TF(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function _F(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function xF(i){let e={},t=f(i,["mode"]);t!=null&&g(e,["mode"],t);let n=f(i,["allowedFunctionNames"]);if(n!=null&&g(e,["allowedFunctionNames"],n),f(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function RF(i){let e={};if(f(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=f(i,["description"]);t!=null&&g(e,["description"],t);let n=f(i,["name"]);n!=null&&g(e,["name"],n);let s=f(i,["parameters"]);s!=null&&g(e,["parameters"],s);let r=f(i,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);let o=f(i,["response"]);o!=null&&g(e,["response"],o);let a=f(i,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function DF(i,e,t){let n={},s=f(e,["systemInstruction"]);t!==void 0&&s!=null&&g(t,["systemInstruction"],Zp(lt(s)));let r=f(e,["temperature"]);r!=null&&g(n,["temperature"],r);let o=f(e,["topP"]);o!=null&&g(n,["topP"],o);let a=f(e,["topK"]);a!=null&&g(n,["topK"],a);let l=f(e,["candidateCount"]);l!=null&&g(n,["candidateCount"],l);let c=f(e,["maxOutputTokens"]);c!=null&&g(n,["maxOutputTokens"],c);let d=f(e,["stopSequences"]);d!=null&&g(n,["stopSequences"],d);let u=f(e,["responseLogprobs"]);u!=null&&g(n,["responseLogprobs"],u);let p=f(e,["logprobs"]);p!=null&&g(n,["logprobs"],p);let m=f(e,["presencePenalty"]);m!=null&&g(n,["presencePenalty"],m);let y=f(e,["frequencyPenalty"]);y!=null&&g(n,["frequencyPenalty"],y);let v=f(e,["seed"]);v!=null&&g(n,["seed"],v);let b=f(e,["responseMimeType"]);b!=null&&g(n,["responseMimeType"],b);let S=f(e,["responseSchema"]);S!=null&&g(n,["responseSchema"],XE(S));let C=f(e,["responseJsonSchema"]);if(C!=null&&g(n,["responseJsonSchema"],C),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let T=f(e,["safetySettings"]);if(t!==void 0&&T!=null){let K=T;Array.isArray(K)&&(K=K.map(se=>bL(se))),g(t,["safetySettings"],K)}let _=f(e,["tools"]);if(t!==void 0&&_!=null){let K=Ga(_);Array.isArray(K)&&(K=K.map(se=>_L(Va(se)))),g(t,["tools"],K)}let R=f(e,["toolConfig"]);if(t!==void 0&&R!=null&&g(t,["toolConfig"],TL(R)),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let I=f(e,["cachedContent"]);t!==void 0&&I!=null&&g(t,["cachedContent"],Li(i,I));let M=f(e,["responseModalities"]);M!=null&&g(n,["responseModalities"],M);let k=f(e,["mediaResolution"]);k!=null&&g(n,["mediaResolution"],k);let N=f(e,["speechConfig"]);if(N!=null&&g(n,["speechConfig"],JE(N)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let F=f(e,["thinkingConfig"]);F!=null&&g(n,["thinkingConfig"],F);let $=f(e,["imageConfig"]);$!=null&&g(n,["imageConfig"],nL($));let ae=f(e,["enableEnhancedCivicAnswers"]);return ae!=null&&g(n,["enableEnhancedCivicAnswers"],ae),n}function IF(i,e,t){let n={},s=f(e,["systemInstruction"]);t!==void 0&&s!=null&&g(t,["systemInstruction"],lt(s));let r=f(e,["temperature"]);r!=null&&g(n,["temperature"],r);let o=f(e,["topP"]);o!=null&&g(n,["topP"],o);let a=f(e,["topK"]);a!=null&&g(n,["topK"],a);let l=f(e,["candidateCount"]);l!=null&&g(n,["candidateCount"],l);let c=f(e,["maxOutputTokens"]);c!=null&&g(n,["maxOutputTokens"],c);let d=f(e,["stopSequences"]);d!=null&&g(n,["stopSequences"],d);let u=f(e,["responseLogprobs"]);u!=null&&g(n,["responseLogprobs"],u);let p=f(e,["logprobs"]);p!=null&&g(n,["logprobs"],p);let m=f(e,["presencePenalty"]);m!=null&&g(n,["presencePenalty"],m);let y=f(e,["frequencyPenalty"]);y!=null&&g(n,["frequencyPenalty"],y);let v=f(e,["seed"]);v!=null&&g(n,["seed"],v);let b=f(e,["responseMimeType"]);b!=null&&g(n,["responseMimeType"],b);let S=f(e,["responseSchema"]);S!=null&&g(n,["responseSchema"],XE(S));let C=f(e,["responseJsonSchema"]);C!=null&&g(n,["responseJsonSchema"],C);let T=f(e,["routingConfig"]);T!=null&&g(n,["routingConfig"],T);let _=f(e,["modelSelectionConfig"]);_!=null&&g(n,["modelConfig"],_);let R=f(e,["safetySettings"]);if(t!==void 0&&R!=null){let L=R;Array.isArray(L)&&(L=L.map(q=>q)),g(t,["safetySettings"],L)}let I=f(e,["tools"]);if(t!==void 0&&I!=null){let L=Ga(I);Array.isArray(L)&&(L=L.map(q=>X0(Va(q)))),g(t,["tools"],L)}let M=f(e,["toolConfig"]);t!==void 0&&M!=null&&g(t,["toolConfig"],M);let k=f(e,["labels"]);t!==void 0&&k!=null&&g(t,["labels"],k);let N=f(e,["cachedContent"]);t!==void 0&&N!=null&&g(t,["cachedContent"],Li(i,N));let F=f(e,["responseModalities"]);F!=null&&g(n,["responseModalities"],F);let $=f(e,["mediaResolution"]);$!=null&&g(n,["mediaResolution"],$);let ae=f(e,["speechConfig"]);ae!=null&&g(n,["speechConfig"],JE(ae));let K=f(e,["audioTimestamp"]);K!=null&&g(n,["audioTimestamp"],K);let se=f(e,["thinkingConfig"]);se!=null&&g(n,["thinkingConfig"],se);let ze=f(e,["imageConfig"]);if(ze!=null&&g(n,["imageConfig"],iL(ze)),f(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function f0(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["contents"]);if(s!=null){let o=un(s);Array.isArray(o)&&(o=o.map(a=>Zp(a))),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&g(t,["generationConfig"],DF(i,r,t)),t}function p0(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["contents"]);if(s!=null){let o=un(s);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["contents"],o)}let r=f(e,["config"]);return r!=null&&g(t,["generationConfig"],IF(i,r,t)),t}function g0(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>jN(c))),g(e,["candidates"],l)}let s=f(i,["modelVersion"]);s!=null&&g(e,["modelVersion"],s);let r=f(i,["promptFeedback"]);r!=null&&g(e,["promptFeedback"],r);let o=f(i,["responseId"]);o!=null&&g(e,["responseId"],o);let a=f(i,["usageMetadata"]);return a!=null&&g(e,["usageMetadata"],a),e}function m0(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>d)),g(e,["candidates"],c)}let s=f(i,["createTime"]);s!=null&&g(e,["createTime"],s);let r=f(i,["modelVersion"]);r!=null&&g(e,["modelVersion"],r);let o=f(i,["promptFeedback"]);o!=null&&g(e,["promptFeedback"],o);let a=f(i,["responseId"]);a!=null&&g(e,["responseId"],a);let l=f(i,["usageMetadata"]);return l!=null&&g(e,["usageMetadata"],l),e}function MF(i,e){let t={};if(f(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(i,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let n=f(i,["numberOfImages"]);e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n);let s=f(i,["aspectRatio"]);e!==void 0&&s!=null&&g(e,["parameters","aspectRatio"],s);let r=f(i,["guidanceScale"]);if(e!==void 0&&r!=null&&g(e,["parameters","guidanceScale"],r),f(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=f(i,["safetyFilterLevel"]);e!==void 0&&o!=null&&g(e,["parameters","safetySetting"],o);let a=f(i,["personGeneration"]);e!==void 0&&a!=null&&g(e,["parameters","personGeneration"],a);let l=f(i,["includeSafetyAttributes"]);e!==void 0&&l!=null&&g(e,["parameters","includeSafetyAttributes"],l);let c=f(i,["includeRaiReason"]);e!==void 0&&c!=null&&g(e,["parameters","includeRaiReason"],c);let d=f(i,["language"]);e!==void 0&&d!=null&&g(e,["parameters","language"],d);let u=f(i,["outputMimeType"]);e!==void 0&&u!=null&&g(e,["parameters","outputOptions","mimeType"],u);let p=f(i,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&g(e,["parameters","outputOptions","compressionQuality"],p),f(i,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(f(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let m=f(i,["imageSize"]);if(e!==void 0&&m!=null&&g(e,["parameters","sampleImageSize"],m),f(i,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function PF(i,e){let t={},n=f(i,["outputGcsUri"]);e!==void 0&&n!=null&&g(e,["parameters","storageUri"],n);let s=f(i,["negativePrompt"]);e!==void 0&&s!=null&&g(e,["parameters","negativePrompt"],s);let r=f(i,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);let o=f(i,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);let a=f(i,["guidanceScale"]);e!==void 0&&a!=null&&g(e,["parameters","guidanceScale"],a);let l=f(i,["seed"]);e!==void 0&&l!=null&&g(e,["parameters","seed"],l);let c=f(i,["safetyFilterLevel"]);e!==void 0&&c!=null&&g(e,["parameters","safetySetting"],c);let d=f(i,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);let u=f(i,["includeSafetyAttributes"]);e!==void 0&&u!=null&&g(e,["parameters","includeSafetyAttributes"],u);let p=f(i,["includeRaiReason"]);e!==void 0&&p!=null&&g(e,["parameters","includeRaiReason"],p);let m=f(i,["language"]);e!==void 0&&m!=null&&g(e,["parameters","language"],m);let y=f(i,["outputMimeType"]);e!==void 0&&y!=null&&g(e,["parameters","outputOptions","mimeType"],y);let v=f(i,["outputCompressionQuality"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","compressionQuality"],v);let b=f(i,["addWatermark"]);e!==void 0&&b!=null&&g(e,["parameters","addWatermark"],b);let S=f(i,["labels"]);e!==void 0&&S!=null&&g(e,["labels"],S);let C=f(i,["imageSize"]);e!==void 0&&C!=null&&g(e,["parameters","sampleImageSize"],C);let T=f(i,["enhancePrompt"]);return e!==void 0&&T!=null&&g(e,["parameters","enhancePrompt"],T),t}function kF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["config"]);return r!=null&&MF(r,t),t}function NF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["config"]);return r!=null&&PF(r,t),t}function FF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>YF(o))),g(e,["generatedImages"],r)}let s=f(i,["positivePromptSafetyAttributes"]);return s!=null&&g(e,["positivePromptSafetyAttributes"],Y0(s)),e}function LF(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>jp(o))),g(e,["generatedImages"],r)}let s=f(i,["positivePromptSafetyAttributes"]);return s!=null&&g(e,["positivePromptSafetyAttributes"],K0(s)),e}function OF(i,e){let t={},n=f(i,["numberOfVideos"]);if(e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n),f(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(i,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let s=f(i,["durationSeconds"]);if(e!==void 0&&s!=null&&g(e,["parameters","durationSeconds"],s),f(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let r=f(i,["aspectRatio"]);e!==void 0&&r!=null&&g(e,["parameters","aspectRatio"],r);let o=f(i,["resolution"]);e!==void 0&&o!=null&&g(e,["parameters","resolution"],o);let a=f(i,["personGeneration"]);if(e!==void 0&&a!=null&&g(e,["parameters","personGeneration"],a),f(i,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let l=f(i,["negativePrompt"]);e!==void 0&&l!=null&&g(e,["parameters","negativePrompt"],l);let c=f(i,["enhancePrompt"]);if(e!==void 0&&c!=null&&g(e,["parameters","enhancePrompt"],c),f(i,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let d=f(i,["lastFrame"]);e!==void 0&&d!=null&&g(e,["instances[0]","lastFrame"],Qp(d));let u=f(i,["referenceImages"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(m=>BL(m))),g(e,["instances[0]","referenceImages"],p)}if(f(i,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(f(i,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function UF(i,e){let t={},n=f(i,["numberOfVideos"]);e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n);let s=f(i,["outputGcsUri"]);e!==void 0&&s!=null&&g(e,["parameters","storageUri"],s);let r=f(i,["fps"]);e!==void 0&&r!=null&&g(e,["parameters","fps"],r);let o=f(i,["durationSeconds"]);e!==void 0&&o!=null&&g(e,["parameters","durationSeconds"],o);let a=f(i,["seed"]);e!==void 0&&a!=null&&g(e,["parameters","seed"],a);let l=f(i,["aspectRatio"]);e!==void 0&&l!=null&&g(e,["parameters","aspectRatio"],l);let c=f(i,["resolution"]);e!==void 0&&c!=null&&g(e,["parameters","resolution"],c);let d=f(i,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);let u=f(i,["pubsubTopic"]);e!==void 0&&u!=null&&g(e,["parameters","pubsubTopic"],u);let p=f(i,["negativePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","negativePrompt"],p);let m=f(i,["enhancePrompt"]);e!==void 0&&m!=null&&g(e,["parameters","enhancePrompt"],m);let y=f(i,["generateAudio"]);e!==void 0&&y!=null&&g(e,["parameters","generateAudio"],y);let v=f(i,["lastFrame"]);e!==void 0&&v!=null&&g(e,["instances[0]","lastFrame"],Dn(v));let b=f(i,["referenceImages"]);if(e!==void 0&&b!=null){let T=b;Array.isArray(T)&&(T=T.map(_=>HL(_))),g(e,["instances[0]","referenceImages"],T)}let S=f(i,["mask"]);e!==void 0&&S!=null&&g(e,["instances[0]","mask"],UL(S));let C=f(i,["compressionQuality"]);return e!==void 0&&C!=null&&g(e,["parameters","compressionQuality"],C),t}function BF(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response","generateVideoResponse"]);return o!=null&&g(e,["response"],GF(o)),e}function HF(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],zF(o)),e}function $F(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["image"]);r!=null&&g(t,["instances[0]","image"],Qp(r));let o=f(e,["video"]);o!=null&&g(t,["instances[0]","video"],J0(o));let a=f(e,["source"]);a!=null&&WF(a,t);let l=f(e,["config"]);return l!=null&&OF(l,t),t}function VF(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["prompt"]);s!=null&&g(t,["instances[0]","prompt"],s);let r=f(e,["image"]);r!=null&&g(t,["instances[0]","image"],Dn(r));let o=f(e,["video"]);o!=null&&g(t,["instances[0]","video"],Z0(o));let a=f(e,["source"]);a!=null&&qF(a,t);let l=f(e,["config"]);return l!=null&&UF(l,t),t}function GF(i){let e={},t=f(i,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>XF(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function zF(i){let e={},t=f(i,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>JF(o))),g(e,["generatedVideos"],r)}let n=f(i,["raiMediaFilteredCount"]);n!=null&&g(e,["raiMediaFilteredCount"],n);let s=f(i,["raiMediaFilteredReasons"]);return s!=null&&g(e,["raiMediaFilteredReasons"],s),e}function WF(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["image"]);e!==void 0&&s!=null&&g(e,["instances[0]","image"],Qp(s));let r=f(i,["video"]);return e!==void 0&&r!=null&&g(e,["instances[0]","video"],J0(r)),t}function qF(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["image"]);e!==void 0&&s!=null&&g(e,["instances[0]","image"],Dn(s));let r=f(i,["video"]);return e!==void 0&&r!=null&&g(e,["instances[0]","video"],Z0(r)),t}function YF(i){let e={},t=f(i,["_self"]);t!=null&&g(e,["image"],sL(t));let n=f(i,["raiFilteredReason"]);n!=null&&g(e,["raiFilteredReason"],n);let s=f(i,["_self"]);return s!=null&&g(e,["safetyAttributes"],Y0(s)),e}function jp(i){let e={},t=f(i,["_self"]);t!=null&&g(e,["image"],q0(t));let n=f(i,["raiFilteredReason"]);n!=null&&g(e,["raiFilteredReason"],n);let s=f(i,["_self"]);s!=null&&g(e,["safetyAttributes"],K0(s));let r=f(i,["prompt"]);return r!=null&&g(e,["enhancedPrompt"],r),e}function KF(i){let e={},t=f(i,["_self"]);t!=null&&g(e,["mask"],q0(t));let n=f(i,["labels"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),g(e,["labels"],s)}return e}function XF(i){let e={},t=f(i,["video"]);return t!=null&&g(e,["video"],LL(t)),e}function JF(i){let e={},t=f(i,["_self"]);return t!=null&&g(e,["video"],OL(t)),e}function ZF(i){let e={},t=f(i,["modelSelectionConfig"]);t!=null&&g(e,["modelConfig"],t);let n=f(i,["responseJsonSchema"]);n!=null&&g(e,["responseJsonSchema"],n);let s=f(i,["audioTimestamp"]);s!=null&&g(e,["audioTimestamp"],s);let r=f(i,["candidateCount"]);r!=null&&g(e,["candidateCount"],r);let o=f(i,["enableAffectiveDialog"]);o!=null&&g(e,["enableAffectiveDialog"],o);let a=f(i,["frequencyPenalty"]);a!=null&&g(e,["frequencyPenalty"],a);let l=f(i,["logprobs"]);l!=null&&g(e,["logprobs"],l);let c=f(i,["maxOutputTokens"]);c!=null&&g(e,["maxOutputTokens"],c);let d=f(i,["mediaResolution"]);d!=null&&g(e,["mediaResolution"],d);let u=f(i,["presencePenalty"]);u!=null&&g(e,["presencePenalty"],u);let p=f(i,["responseLogprobs"]);p!=null&&g(e,["responseLogprobs"],p);let m=f(i,["responseMimeType"]);m!=null&&g(e,["responseMimeType"],m);let y=f(i,["responseModalities"]);y!=null&&g(e,["responseModalities"],y);let v=f(i,["responseSchema"]);v!=null&&g(e,["responseSchema"],v);let b=f(i,["routingConfig"]);b!=null&&g(e,["routingConfig"],b);let S=f(i,["seed"]);S!=null&&g(e,["seed"],S);let C=f(i,["speechConfig"]);C!=null&&g(e,["speechConfig"],C);let T=f(i,["stopSequences"]);T!=null&&g(e,["stopSequences"],T);let _=f(i,["temperature"]);_!=null&&g(e,["temperature"],_);let R=f(i,["thinkingConfig"]);R!=null&&g(e,["thinkingConfig"],R);let I=f(i,["topK"]);I!=null&&g(e,["topK"],I);let M=f(i,["topP"]);if(M!=null&&g(e,["topP"],M),f(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function jF(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],de(i,n)),t}function QF(i,e){let t={},n=f(e,["model"]);return n!=null&&g(t,["_url","name"],de(i,n)),t}function eL(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function tL(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function nL(i){let e={},t=f(i,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);let n=f(i,["imageSize"]);if(n!=null&&g(e,["imageSize"],n),f(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function iL(i){let e={},t=f(i,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);let n=f(i,["imageSize"]);n!=null&&g(e,["imageSize"],n);let s=f(i,["outputMimeType"]);s!=null&&g(e,["imageOutputOptions","mimeType"],s);let r=f(i,["outputCompressionQuality"]);return r!=null&&g(e,["imageOutputOptions","compressionQuality"],r),e}function sL(i){let e={},t=f(i,["bytesBase64Encoded"]);t!=null&&g(e,["imageBytes"],xs(t));let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function q0(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["gcsUri"],t);let n=f(i,["bytesBase64Encoded"]);n!=null&&g(e,["imageBytes"],xs(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function Qp(i){let e={};if(f(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=f(i,["imageBytes"]);t!=null&&g(e,["bytesBase64Encoded"],xs(t));let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function Dn(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["gcsUri"],t);let n=f(i,["imageBytes"]);n!=null&&g(e,["bytesBase64Encoded"],xs(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function rL(i,e,t){let n={},s=f(e,["pageSize"]);t!==void 0&&s!=null&&g(t,["_query","pageSize"],s);let r=f(e,["pageToken"]);t!==void 0&&r!=null&&g(t,["_query","pageToken"],r);let o=f(e,["filter"]);t!==void 0&&o!=null&&g(t,["_query","filter"],o);let a=f(e,["queryBase"]);return t!==void 0&&a!=null&&g(t,["_url","models_url"],B0(i,a)),n}function oL(i,e,t){let n={},s=f(e,["pageSize"]);t!==void 0&&s!=null&&g(t,["_query","pageSize"],s);let r=f(e,["pageToken"]);t!==void 0&&r!=null&&g(t,["_query","pageToken"],r);let o=f(e,["filter"]);t!==void 0&&o!=null&&g(t,["_query","filter"],o);let a=f(e,["queryBase"]);return t!==void 0&&a!=null&&g(t,["_url","models_url"],B0(i,a)),n}function aL(i,e){let t={},n=f(e,["config"]);return n!=null&&rL(i,n,t),t}function lL(i,e){let t={},n=f(e,["config"]);return n!=null&&oL(i,n,t),t}function cL(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["_self"]);if(s!=null){let r=H0(s);Array.isArray(r)&&(r=r.map(o=>bE(o))),g(e,["models"],r)}return e}function dL(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["_self"]);if(s!=null){let r=H0(s);Array.isArray(r)&&(r=r.map(o=>EE(o))),g(e,["models"],r)}return e}function uL(i){let e={},t=f(i,["maskMode"]);t!=null&&g(e,["maskMode"],t);let n=f(i,["segmentationClasses"]);n!=null&&g(e,["maskClasses"],n);let s=f(i,["maskDilation"]);return s!=null&&g(e,["dilation"],s),e}function bE(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);s!=null&&g(e,["description"],s);let r=f(i,["version"]);r!=null&&g(e,["version"],r);let o=f(i,["_self"]);o!=null&&g(e,["tunedModelInfo"],xL(o));let a=f(i,["inputTokenLimit"]);a!=null&&g(e,["inputTokenLimit"],a);let l=f(i,["outputTokenLimit"]);l!=null&&g(e,["outputTokenLimit"],l);let c=f(i,["supportedGenerationMethods"]);c!=null&&g(e,["supportedActions"],c);let d=f(i,["temperature"]);d!=null&&g(e,["temperature"],d);let u=f(i,["maxTemperature"]);u!=null&&g(e,["maxTemperature"],u);let p=f(i,["topP"]);p!=null&&g(e,["topP"],p);let m=f(i,["topK"]);m!=null&&g(e,["topK"],m);let y=f(i,["thinking"]);return y!=null&&g(e,["thinking"],y),e}function EE(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["displayName"]);n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);s!=null&&g(e,["description"],s);let r=f(i,["versionId"]);r!=null&&g(e,["version"],r);let o=f(i,["deployedModels"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(p=>CF(p))),g(e,["endpoints"],u)}let a=f(i,["labels"]);a!=null&&g(e,["labels"],a);let l=f(i,["_self"]);l!=null&&g(e,["tunedModelInfo"],RL(l));let c=f(i,["defaultCheckpointId"]);c!=null&&g(e,["defaultCheckpointId"],c);let d=f(i,["checkpoints"]);if(d!=null){let u=d;Array.isArray(u)&&(u=u.map(p=>p)),g(e,["checkpoints"],u)}return e}function hL(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],TF(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],_F(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],ZN(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let u=f(i,["thoughtSignature"]);u!=null&&g(e,["thoughtSignature"],u);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function fL(i){let e={},t=f(i,["productImage"]);return t!=null&&g(e,["image"],Dn(t)),e}function pL(i,e){let t={},n=f(i,["numberOfImages"]);e!==void 0&&n!=null&&g(e,["parameters","sampleCount"],n);let s=f(i,["baseSteps"]);e!==void 0&&s!=null&&g(e,["parameters","baseSteps"],s);let r=f(i,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);let o=f(i,["seed"]);e!==void 0&&o!=null&&g(e,["parameters","seed"],o);let a=f(i,["safetyFilterLevel"]);e!==void 0&&a!=null&&g(e,["parameters","safetySetting"],a);let l=f(i,["personGeneration"]);e!==void 0&&l!=null&&g(e,["parameters","personGeneration"],l);let c=f(i,["addWatermark"]);e!==void 0&&c!=null&&g(e,["parameters","addWatermark"],c);let d=f(i,["outputMimeType"]);e!==void 0&&d!=null&&g(e,["parameters","outputOptions","mimeType"],d);let u=f(i,["outputCompressionQuality"]);e!==void 0&&u!=null&&g(e,["parameters","outputOptions","compressionQuality"],u);let p=f(i,["enhancePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","enhancePrompt"],p);let m=f(i,["labels"]);return e!==void 0&&m!=null&&g(e,["labels"],m),t}function gL(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["source"]);s!=null&&yL(s,t);let r=f(e,["config"]);return r!=null&&pL(r,t),t}function mL(i){let e={},t=f(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>jp(s))),g(e,["generatedImages"],n)}return e}function yL(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["personImage"]);e!==void 0&&s!=null&&g(e,["instances[0]","personImage","image"],Dn(s));let r=f(i,["productImages"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>fL(a))),g(e,["instances[0]","productImages"],o)}return t}function vL(i){let e={},t=f(i,["referenceImage"]);t!=null&&g(e,["referenceImage"],Dn(t));let n=f(i,["referenceId"]);n!=null&&g(e,["referenceId"],n);let s=f(i,["referenceType"]);s!=null&&g(e,["referenceType"],s);let r=f(i,["maskImageConfig"]);r!=null&&g(e,["maskImageConfig"],uL(r));let o=f(i,["controlImageConfig"]);o!=null&&g(e,["controlImageConfig"],sF(o));let a=f(i,["styleImageConfig"]);a!=null&&g(e,["styleImageConfig"],a);let l=f(i,["subjectImageConfig"]);return l!=null&&g(e,["subjectImageConfig"],l),e}function Y0(i){let e={},t=f(i,["safetyAttributes","categories"]);t!=null&&g(e,["categories"],t);let n=f(i,["safetyAttributes","scores"]);n!=null&&g(e,["scores"],n);let s=f(i,["contentType"]);return s!=null&&g(e,["contentType"],s),e}function K0(i){let e={},t=f(i,["safetyAttributes","categories"]);t!=null&&g(e,["categories"],t);let n=f(i,["safetyAttributes","scores"]);n!=null&&g(e,["scores"],n);let s=f(i,["contentType"]);return s!=null&&g(e,["contentType"],s),e}function bL(i){let e={},t=f(i,["category"]);if(t!=null&&g(e,["category"],t),f(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=f(i,["threshold"]);return n!=null&&g(e,["threshold"],n),e}function EL(i){let e={},t=f(i,["image"]);return t!=null&&g(e,["image"],Dn(t)),e}function SL(i,e){let t={},n=f(i,["mode"]);e!==void 0&&n!=null&&g(e,["parameters","mode"],n);let s=f(i,["maxPredictions"]);e!==void 0&&s!=null&&g(e,["parameters","maxPredictions"],s);let r=f(i,["confidenceThreshold"]);e!==void 0&&r!=null&&g(e,["parameters","confidenceThreshold"],r);let o=f(i,["maskDilation"]);e!==void 0&&o!=null&&g(e,["parameters","maskDilation"],o);let a=f(i,["binaryColorThreshold"]);e!==void 0&&a!=null&&g(e,["parameters","binaryColorThreshold"],a);let l=f(i,["labels"]);return e!==void 0&&l!=null&&g(e,["labels"],l),t}function wL(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["source"]);s!=null&&CL(s,t);let r=f(e,["config"]);return r!=null&&SL(r,t),t}function AL(i){let e={},t=f(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>KF(s))),g(e,["generatedMasks"],n)}return e}function CL(i,e){let t={},n=f(i,["prompt"]);e!==void 0&&n!=null&&g(e,["instances[0]","prompt"],n);let s=f(i,["image"]);e!==void 0&&s!=null&&g(e,["instances[0]","image"],Dn(s));let r=f(i,["scribbleImage"]);return e!==void 0&&r!=null&&g(e,["instances[0]","scribble"],EL(r)),t}function TL(i){let e={},t=f(i,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],xF(t));let n=f(i,["retrievalConfig"]);return n!=null&&g(e,["retrievalConfig"],n),e}function _L(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(u=>u)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],eL(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],tL(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function X0(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(p=>RF(p))),g(e,["functionDeclarations"],u)}let n=f(i,["retrieval"]);n!=null&&g(e,["retrieval"],n);let s=f(i,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);let r=f(i,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=f(i,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);let a=f(i,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);let l=f(i,["googleMaps"]);l!=null&&g(e,["googleMaps"],l);let c=f(i,["googleSearch"]);c!=null&&g(e,["googleSearch"],c);let d=f(i,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function xL(i){let e={},t=f(i,["baseModel"]);t!=null&&g(e,["baseModel"],t);let n=f(i,["createTime"]);n!=null&&g(e,["createTime"],n);let s=f(i,["updateTime"]);return s!=null&&g(e,["updateTime"],s),e}function RL(i){let e={},t=f(i,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&g(e,["baseModel"],t);let n=f(i,["createTime"]);n!=null&&g(e,["createTime"],n);let s=f(i,["updateTime"]);return s!=null&&g(e,["updateTime"],s),e}function DL(i,e){let t={},n=f(i,["displayName"]);e!==void 0&&n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);e!==void 0&&s!=null&&g(e,["description"],s);let r=f(i,["defaultCheckpointId"]);return e!==void 0&&r!=null&&g(e,["defaultCheckpointId"],r),t}function IL(i,e){let t={},n=f(i,["displayName"]);e!==void 0&&n!=null&&g(e,["displayName"],n);let s=f(i,["description"]);e!==void 0&&s!=null&&g(e,["description"],s);let r=f(i,["defaultCheckpointId"]);return e!==void 0&&r!=null&&g(e,["defaultCheckpointId"],r),t}function ML(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","name"],de(i,n));let s=f(e,["config"]);return s!=null&&DL(s,t),t}function PL(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["config"]);return s!=null&&IL(s,t),t}function kL(i,e){let t={},n=f(i,["outputGcsUri"]);e!==void 0&&n!=null&&g(e,["parameters","storageUri"],n);let s=f(i,["safetyFilterLevel"]);e!==void 0&&s!=null&&g(e,["parameters","safetySetting"],s);let r=f(i,["personGeneration"]);e!==void 0&&r!=null&&g(e,["parameters","personGeneration"],r);let o=f(i,["includeRaiReason"]);e!==void 0&&o!=null&&g(e,["parameters","includeRaiReason"],o);let a=f(i,["outputMimeType"]);e!==void 0&&a!=null&&g(e,["parameters","outputOptions","mimeType"],a);let l=f(i,["outputCompressionQuality"]);e!==void 0&&l!=null&&g(e,["parameters","outputOptions","compressionQuality"],l);let c=f(i,["enhanceInputImage"]);e!==void 0&&c!=null&&g(e,["parameters","upscaleConfig","enhanceInputImage"],c);let d=f(i,["imagePreservationFactor"]);e!==void 0&&d!=null&&g(e,["parameters","upscaleConfig","imagePreservationFactor"],d);let u=f(i,["labels"]);e!==void 0&&u!=null&&g(e,["labels"],u);let p=f(i,["numberOfImages"]);e!==void 0&&p!=null&&g(e,["parameters","sampleCount"],p);let m=f(i,["mode"]);return e!==void 0&&m!=null&&g(e,["parameters","mode"],m),t}function NL(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["_url","model"],de(i,n));let s=f(e,["image"]);s!=null&&g(t,["instances[0]","image"],Dn(s));let r=f(e,["upscaleFactor"]);r!=null&&g(t,["parameters","upscaleConfig","upscaleFactor"],r);let o=f(e,["config"]);return o!=null&&kL(o,t),t}function FL(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>jp(r))),g(e,["generatedImages"],s)}return e}function LL(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["uri"],t);let n=f(i,["encodedVideo"]);n!=null&&g(e,["videoBytes"],xs(n));let s=f(i,["encoding"]);return s!=null&&g(e,["mimeType"],s),e}function OL(i){let e={},t=f(i,["gcsUri"]);t!=null&&g(e,["uri"],t);let n=f(i,["bytesBase64Encoded"]);n!=null&&g(e,["videoBytes"],xs(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function UL(i){let e={},t=f(i,["image"]);t!=null&&g(e,["_self"],Dn(t));let n=f(i,["maskMode"]);return n!=null&&g(e,["maskMode"],n),e}function BL(i){let e={},t=f(i,["image"]);t!=null&&g(e,["image"],Qp(t));let n=f(i,["referenceType"]);return n!=null&&g(e,["referenceType"],n),e}function HL(i){let e={},t=f(i,["image"]);t!=null&&g(e,["image"],Dn(t));let n=f(i,["referenceType"]);return n!=null&&g(e,["referenceType"],n),e}function J0(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["uri"],t);let n=f(i,["videoBytes"]);n!=null&&g(e,["encodedVideo"],xs(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["encoding"],s),e}function Z0(i){let e={},t=f(i,["uri"]);t!=null&&g(e,["gcsUri"],t);let n=f(i,["videoBytes"]);n!=null&&g(e,["bytesBase64Encoded"],xs(n));let s=f(i,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function $L(i,e){let t={},n=f(i,["displayName"]);return e!==void 0&&n!=null&&g(e,["displayName"],n),t}function VL(i){let e={},t=f(i,["config"]);return t!=null&&$L(t,e),e}function GL(i,e){let t={},n=f(i,["force"]);return e!==void 0&&n!=null&&g(e,["_query","force"],n),t}function zL(i){let e={},t=f(i,["name"]);t!=null&&g(e,["_url","name"],t);let n=f(i,["config"]);return n!=null&&GL(n,e),e}function WL(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","name"],t),e}function qL(i,e){let t={},n=f(i,["customMetadata"]);if(e!==void 0&&n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["customMetadata"],r)}let s=f(i,["chunkingConfig"]);return e!==void 0&&s!=null&&g(e,["chunkingConfig"],s),t}function YL(i){let e={},t=f(i,["name"]);t!=null&&g(e,["name"],t);let n=f(i,["metadata"]);n!=null&&g(e,["metadata"],n);let s=f(i,["done"]);s!=null&&g(e,["done"],s);let r=f(i,["error"]);r!=null&&g(e,["error"],r);let o=f(i,["response"]);return o!=null&&g(e,["response"],XL(o)),e}function KL(i){let e={},t=f(i,["fileSearchStoreName"]);t!=null&&g(e,["_url","file_search_store_name"],t);let n=f(i,["fileName"]);n!=null&&g(e,["fileName"],n);let s=f(i,["config"]);return s!=null&&qL(s,e),e}function XL(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["parent"]);n!=null&&g(e,["parent"],n);let s=f(i,["documentName"]);return s!=null&&g(e,["documentName"],s),e}function JL(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function ZL(i){let e={},t=f(i,["config"]);return t!=null&&JL(t,e),e}function jL(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["fileSearchStores"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["fileSearchStores"],r)}return e}function j0(i,e){let t={},n=f(i,["mimeType"]);e!==void 0&&n!=null&&g(e,["mimeType"],n);let s=f(i,["displayName"]);e!==void 0&&s!=null&&g(e,["displayName"],s);let r=f(i,["customMetadata"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>l)),g(e,["customMetadata"],a)}let o=f(i,["chunkingConfig"]);return e!==void 0&&o!=null&&g(e,["chunkingConfig"],o),t}function QL(i){let e={},t=f(i,["fileSearchStoreName"]);t!=null&&g(e,["_url","file_search_store_name"],t);let n=f(i,["config"]);return n!=null&&j0(n,e),e}function e1(i){let e={},t=f(i,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}var t1="Content-Type",n1="X-Server-Timeout",i1="User-Agent",SE="x-goog-api-client",s1="1.34.0",r1=`google-genai-sdk/${s1}`,o1="v1beta1",a1="v1beta",wE=class{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let s={};this.clientOptions.vertexai?(s.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:o1,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:a1,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let s=[this.getRequestUrlInternal(t)];return n&&s.push(this.getBaseResourcePath()),e!==""&&s.push(e),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[o,a]of Object.entries(e.queryParams))s.searchParams.append(o,String(a));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.unaryApiCall(s,r,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[s,r]of Object.entries(t))typeof r=="object"?n[s]=Object.assign(Object.assign({},n[s]),r):r!==void 0&&(n[s]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.streamApiCall(s,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,s){if(t&&t.timeout||s){let r=new AbortController,o=r.signal;if(t.timeout&&t?.timeout>0){let a=setTimeout(()=>r.abort(),t.timeout);a&&typeof a.unref=="function"&&a.unref()}s&&s.addEventListener("abort",()=>{r.abort()}),e.signal=o}return t&&t.extraBody!==null&&l1(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await y0(s),new ld(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await y0(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(e){return _n(this,arguments,function*(){var n;let s=(n=e?.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let o="",a="data:",l=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:c,value:d}=yield J(s.read());if(c){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let u=r.decode(d,{stream:!0});try{let y=JSON.parse(u);if("error"in y){let v=JSON.parse(JSON.stringify(y.error)),b=v.status,S=v.code,C=`got status: ${b}. ${JSON.stringify(y)}`;if(S>=400&&S<600)throw new Np({message:C,status:S})}}catch(y){if(y.name==="ApiError")throw y}o+=u;let p=-1,m=0;for(;;){p=-1,m=0;for(let b of l){let S=o.indexOf(b);S!==-1&&(p===-1||S<p)&&(p=S,m=b.length)}if(p===-1)break;let y=o.substring(0,p);o=o.substring(p+m);let v=y.trim();if(v.startsWith(a)){let b=v.substring(a.length).trim();try{let S=new Response(b,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield J(new ld(S))}catch(S){throw new Error(`exception parsing stream chunk ${b}. ${S}`)}}}}}finally{s.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){let e={},t=r1+" "+this.clientOptions.userAgentExtra;return e[i1]=t,e[SE]=t,e[t1]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[s,r]of Object.entries(e.headers))n.append(s,r);e.timeout&&e.timeout>0&&n.append(n1,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(t=n.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),n}async uploadFile(e,t){var n;let s={};t!=null&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);let r=this.clientOptions.uploader,o=await r.stat(e);s.sizeBytes=String(o.size);let a=(n=t?.mimeType)!==null&&n!==void 0?n:o.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=a;let l={file:s},c=this.getFileName(e),d=U("upload/v1beta/files",l._url),u=await this.fetchUploadUrl(d,s.sizeBytes,s.mimeType,c,l,t?.httpOptions);return r.upload(e,u,this)}async uploadFileToFileSearchStore(e,t,n){var s;let r=this.clientOptions.uploader,o=await r.stat(t),a=String(o.size),l=(s=n?.mimeType)!==null&&s!==void 0?s:o.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let c=`upload/v1beta/${e}:uploadToFileSearchStore`,d=this.getFileName(t),u={};n!=null&&j0(n,u);let p=await this.fetchUploadUrl(c,a,l,d,u,n?.httpOptions);return r.uploadToFileSearchStore(t,p,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,s,r,o){var a;let l={};o?l=o:l={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},s?{"X-Goog-Upload-File-Name":s}:{})};let c=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:l});if(!c||!c?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let d=(a=c?.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(d===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return d}};async function y0(i){var e;if(i===void 0)throw new Error("response is undefined");if(!i.ok){let t=i.status,n;!((e=i.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await i.json():n={error:{message:await i.text(),code:i.status,status:i.statusText}};let s=JSON.stringify(n);throw t>=400&&t<600?new Np({message:s,status:t}):new Error(s)}}function l1(i,e){if(!e||Object.keys(e).length===0)return;if(i.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof i.body=="string"&&i.body.length>0)try{let r=JSON.parse(i.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))t=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(r,o){let a=Object.assign({},r);for(let l in o)if(Object.prototype.hasOwnProperty.call(o,l)){let c=o[l],d=a[l];c&&typeof c=="object"&&!Array.isArray(c)&&d&&typeof d=="object"&&!Array.isArray(d)?a[l]=n(d,c):(d&&c&&typeof d!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof d}, New type: ${typeof c}. Overwriting.`),a[l]=c)}return a}let s=n(t,e);i.body=JSON.stringify(s)}var c1="mcp_used/unknown",d1=!1;function Q0(i){for(let e of i)if(u1(e)||typeof e=="object"&&"inputSchema"in e)return!0;return d1}function ex(i){var e;let t=(e=i[SE])!==null&&e!==void 0?e:"";i[SE]=(t+` ${c1}`).trimStart()}function u1(i){return i!==null&&typeof i=="object"&&i instanceof AE}function h1(i){return _n(this,arguments,function*(t,n=100){let s,r=0;for(;r<n;){let o=yield J(t.listTools({cursor:s}));for(let a of o.tools)yield yield J(a),r++;if(!o.nextCursor)break;s=o.nextCursor}})}var AE=class i{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new i(e,t)}async initialize(){var e,t,n,s;if(this.mcpTools.length>0)return;let r={},o=[];for(let d of this.mcpClients)try{for(var a=!0,l=(t=void 0,xn(h1(d))),c;c=await l.next(),e=c.done,!e;a=!0){s=c.value,a=!1;let u=s;o.push(u);let p=u.name;if(r[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);r[p]=d}}catch(u){t={error:u}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),JP(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let s=this.functionNameToMcpClient[n.name],r;this.config.timeout&&(r={timeout:this.config.timeout});let o=await s.callTool({name:n.name,arguments:n.args},void 0,r);t.push({functionResponse:{name:n.name,response:o.isError?{error:o}:o}})}return t}};async function f1(i,e,t){let n=new dE,s;t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data),Object.assign(n,s),e(n)}var CE=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let s=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),o=g1(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${s}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${a}`,c=()=>{},d=new Promise(T=>{c=T}),u=e.callbacks,p=function(){c({})},m=this.apiClient,y={onopen:p,onmessage:T=>{f1(m,u.onmessage,T)},onerror:(t=u?.onerror)!==null&&t!==void 0?t:function(T){},onclose:(n=u?.onclose)!==null&&n!==void 0?n:function(T){}},v=this.webSocketFactory.create(l,p1(o),y);v.connect(),await d;let C={setup:{model:de(this.apiClient,e.model)}};return v.send(JSON.stringify(C)),new TE(v,this.apiClient)}},TE=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=VN(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=$N(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Oa.PLAY)}pause(){this.sendPlaybackControl(Oa.PAUSE)}stop(){this.sendPlaybackControl(Oa.STOP)}resetContext(){this.sendPlaybackControl(Oa.RESET_CONTEXT)}close(){this.conn.close()}};function p1(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function g1(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var m1="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function y1(i,e,t){let n=new cE,s;t.data instanceof Blob?s=await t.data.text():t.data instanceof ArrayBuffer?s=new TextDecoder().decode(t.data):s=t.data;let r=JSON.parse(s);if(i.isVertexAI()){let o=WN(r);Object.assign(n,o)}else Object.assign(n,r);e(n)}var _E=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new CE(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,s,r,o,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),d,u=this.apiClient.getHeaders();e.config&&e.config.tools&&Q0(e.config.tools)&&ex(u);let p=E1(u);if(this.apiClient.isVertexAI())d=`${l}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p,d);else{let N=this.apiClient.getApiKey(),F="BidiGenerateContent",$="key";N?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),F="BidiGenerateContentConstrained",$="access_token"),d=`${l}/ws/google.ai.generativelanguage.${c}.GenerativeService.${F}?${$}=${N}`}let m=()=>{},y=new Promise(N=>{m=N}),v=e.callbacks,b=function(){var N;(N=v?.onopen)===null||N===void 0||N.call(v),m({})},S=this.apiClient,C={onopen:b,onmessage:N=>{y1(S,v.onmessage,N)},onerror:(t=v?.onerror)!==null&&t!==void 0?t:function(N){},onclose:(n=v?.onclose)!==null&&n!==void 0?n:function(N){}},T=this.webSocketFactory.create(d,b1(p),C);T.connect(),await y;let _=de(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&_.startsWith("publishers/")){let N=this.apiClient.getProject(),F=this.apiClient.getLocation();_=`projects/${N}/locations/${F}/`+_}let R={};this.apiClient.isVertexAI()&&((s=e.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Ep.AUDIO]}:e.config.responseModalities=[Ep.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let I=(a=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[],M=[];for(let N of I)if(this.isCallableTool(N)){let F=N;M.push(await F.tool())}else M.push(N);M.length>0&&(e.config.tools=M);let k={model:_,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?R=HN(this.apiClient,k):R=BN(this.apiClient,k),delete R.config,T.send(JSON.stringify(R)),new xE(T,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},v1={turnComplete:!0},xE=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=un(t.turns),e.isVertexAI()||(n=n.map(s=>Zp(s)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(let r of n){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(m1)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},v1),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:zN(e)}:t={realtimeInput:GN(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function b1(i){let e={};return i.forEach((t,n)=>{e[n]=t}),e}function E1(i){let e=new Headers;for(let[t,n]of Object.entries(i))e.append(t,n);return e}var v0=10;function b0(i){var e,t,n;if(!((e=i?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let s=!1;for(let o of(t=i?.tools)!==null&&t!==void 0?t:[])if(Ba(o)){s=!0;break}if(!s)return!0;let r=(n=i?.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function Ba(i){return"callTool"in i&&typeof i.callTool=="function"}function S1(i){var e,t,n;return(n=(t=(e=i.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>Ba(s)))!==null&&n!==void 0?n:!1}function E0(i){var e;let t=[];return!((e=i?.config)===null||e===void 0)&&e.tools&&i.config.tools.forEach((n,s)=>{if(Ba(n))return;let r=n;r.functionDeclarations&&r.functionDeclarations.length>0&&t.push(s)}),t}function S0(i){var e;return!(!((e=i?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var RE=class extends Rn{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,s,r,o,a;let l=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!S1(t)||b0(t.config))return await this.generateContentInternal(l);let c=E0(t);if(c.length>0){let v=c.map(b=>`tools[${b}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${v}.`)}let d,u,p=un(l.contents),m=(r=(s=(n=l.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&r!==void 0?r:v0,y=0;for(;y<m&&(d=await this.generateContentInternal(l),!(!d.functionCalls||d.functionCalls.length===0));){let v=d.candidates[0].content,b=[];for(let S of(a=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[])if(Ba(S)){let T=await S.callTool(d.functionCalls);b.push(...T)}y++,u={role:"user",parts:b},l.contents=un(l.contents),l.contents.push(v),l.contents.push(u),S0(l.config)&&(p.push(v),p.push(u))}return S0(l.config)&&(d.automaticFunctionCallingHistory=p),d},this.generateContentStream=async t=>{var n,s,r,o,a;if(this.maybeMoveToResponseJsonSchem(t),b0(t.config)){let u=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(u)}let l=E0(t);if(l.length>0){let u=l.map(p=>`tools[${p}]`).join(", ");throw new Error(`Incompatible tools found at ${u}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let c=(r=(s=(n=t?.config)===null||n===void 0?void 0:n.toolConfig)===null||s===void 0?void 0:s.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,d=(a=(o=t?.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(c&&!d)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var s;let r,o=[];if(n?.generatedImages)for(let l of n.generatedImages)l&&l?.safetyAttributes&&((s=l?.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?r=l?.safetyAttributes:o.push(l);let a;return r?a={generatedImages:o,positivePromptSafetyAttributes:r,sdkHttpResponse:n.sdkHttpResponse}:a={generatedImages:o,sdkHttpResponse:n.sdkHttpResponse},a}),this.list=async t=>{var n;let o={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((n=o.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new Fi(Ni.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(o),o)},this.editImage=async t=>{let n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));let s={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(s)},this.generateVideos=async t=>{var n,s,r,o,a,l;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=t.video)===null||n===void 0)&&n.uri&&(!((s=t.video)===null||s===void 0)&&s.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((o=(r=t.source)===null||r===void 0?void 0:r.video)===null||o===void 0)&&o.uri&&(!((l=(a=t.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,s;let r=(t=e.config)===null||t===void 0?void 0:t.tools;if(!r)return e;let o=await Promise.all(r.map(async l=>Ba(l)?await l.tool():l)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(a.config.tools=o,e.config&&e.config.tools&&Q0(e.config.tools)){let l=(s=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&s!==void 0?s:{},c=Object.assign({},l);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),ex(c),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return a}async initAfcToolsMap(e){var t,n,s;let r=new Map;for(let o of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(Ba(o)){let a=o,l=await a.tool();for(let c of(s=l.functionDeclarations)!==null&&s!==void 0?s:[]){if(!c.name)throw new Error("Function declaration name is required.");if(r.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);r.set(c.name,a)}}return r}async processAfcStream(e){var t,n,s;let r=(s=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&s!==void 0?s:v0,o=!1,a=0,l=await this.initAfcToolsMap(e);return function(c,d,u){return _n(this,arguments,function*(){for(var p,m,y,v,b,S;a<r;){o&&(a++,o=!1);let R=yield J(c.processParamsMaybeAddMcpUsage(u)),I=yield J(c.generateContentStreamInternal(R)),M=[],k=[];try{for(var C=!0,T=(m=void 0,xn(I)),_;_=yield J(T.next()),p=_.done,!p;C=!0){v=_.value,C=!1;let N=v;if(yield yield J(N),N.candidates&&(!((b=N.candidates[0])===null||b===void 0)&&b.content)){k.push(N.candidates[0].content);for(let F of(S=N.candidates[0].content.parts)!==null&&S!==void 0?S:[])if(a<r&&F.functionCall){if(!F.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(F.functionCall.name)){let $=yield J(d.get(F.functionCall.name).callTool([F.functionCall]));M.push(...$)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${F.functionCall.name}`)}}}}catch(N){m={error:N}}finally{try{!C&&!p&&(y=T.return)&&(yield J(y.call(T)))}finally{if(m)throw m.error}}if(M.length>0){o=!0;let N=new Lr;N.candidates=[{content:{role:"user",parts:M}}],yield yield J(N);let F=[];F.push(...k),F.push({role:"user",parts:M});let $=un(u.contents).concat(F);u.contents=$}else break}})}(this,l,e)}async generateContentInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=p0(this.apiClient,e);return a=U("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=m0(d),p=new Lr;return Object.assign(p,u),p})}else{let c=f0(this.apiClient,e);return a=U("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=g0(d),p=new Lr;return Object.assign(p,u),p})}}async generateContentStreamInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=p0(this.apiClient,e);return a=U("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),o.then(function(u){return _n(this,arguments,function*(){var p,m,y,v;try{for(var b=!0,S=xn(u),C;C=yield J(S.next()),p=C.done,!p;b=!0){v=C.value,b=!1;let T=v,_=m0(yield J(T.json()));_.sdkHttpResponse={headers:T.headers};let R=new Lr;Object.assign(R,_),yield yield J(R)}}catch(T){m={error:T}}finally{try{!b&&!p&&(y=S.return)&&(yield J(y.call(S)))}finally{if(m)throw m.error}}})})}else{let c=f0(this.apiClient,e);return a=U("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),o.then(function(u){return _n(this,arguments,function*(){var p,m,y,v;try{for(var b=!0,S=xn(u),C;C=yield J(S.next()),p=C.done,!p;b=!0){v=C.value,b=!1;let T=v,_=g0(yield J(T.json()));_.sdkHttpResponse={headers:T.headers};let R=new Lr;Object.assign(R,_),yield yield J(R)}}catch(T){m={error:T}}finally{try{!b&&!p&&(y=S.return)&&(yield J(y.call(S)))}finally{if(m)throw m.error}}})})}}async embedContent(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=SF(this.apiClient,e);return a=U("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=AF(d),p=new Sp;return Object.assign(p,u),p})}else{let c=EF(this.apiClient,e);return a=U("{model}:batchEmbedContents",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=wF(d),p=new Sp;return Object.assign(p,u),p})}}async generateImagesInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=NF(this.apiClient,e);return a=U("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=LF(d),p=new wp;return Object.assign(p,u),p})}else{let c=kF(this.apiClient,e);return a=U("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=FF(d),p=new wp;return Object.assign(p,u),p})}}async editImageInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=mF(this.apiClient,e);return r=U("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=yF(l),d=new Zb;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=NL(this.apiClient,e);return r=U("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=FL(l),d=new jb;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=gL(this.apiClient,e);return r=U("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=mL(l),d=new Qb;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=wL(this.apiClient,e);return r=U("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=AL(l),d=new eE;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=QF(this.apiClient,e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>EE(d))}else{let c=jF(this.apiClient,e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>bE(d))}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=lL(this.apiClient,e);return a=U("{models_url}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=dL(d),p=new Ap;return Object.assign(p,u),p})}else{let c=aL(this.apiClient,e);return a=U("{models_url}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=cL(d),p=new Ap;return Object.assign(p,u),p})}}async update(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=PL(this.apiClient,e);return a=U("{model}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>EE(d))}else{let c=ML(this.apiClient,e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>bE(d))}}async delete(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=hF(this.apiClient,e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=pF(d),p=new Cp;return Object.assign(p,u),p})}else{let c=uF(this.apiClient,e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=fF(d),p=new Cp;return Object.assign(p,u),p})}}async countTokens(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=lF(this.apiClient,e);return a=U("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=dF(d),p=new Tp;return Object.assign(p,u),p})}else{let c=aF(this.apiClient,e);return a=U("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=cF(d),p=new Tp;return Object.assign(p,u),p})}}async computeTokens(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=eF(this.apiClient,e);return r=U("{model}:computeTokens",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{let c=tF(l),d=new tE;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=VF(this.apiClient,e);return a=U("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o.then(d=>{let u=HF(d),p=new _p;return Object.assign(p,u),p})}else{let c=$F(this.apiClient,e);return a=U("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>{let u=BF(d),p=new _p;return Object.assign(p,u),p})}}};var DE=class extends Rn{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let s=t.name.split("/operations/")[0],r;n&&"httpOptions"in n&&(r=n.httpOptions);let o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{let s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let s=t.name.split("/operations/")[0],r;n&&"httpOptions"in n&&(r=n.httpOptions);let o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{let s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=OP(e);return a=U("{operationName}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),o}else{let c=LP(e);return a=U("{operationName}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o}}async fetchPredictVideosOperationInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=DP(e);return r=U("{resourceName}:fetchPredictOperation",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s}else throw new Error("This method is only supported by the Vertex AI.")}};function w1(i){let e={},t=f(i,["data"]);if(t!=null&&g(e,["data"],t),f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function A1(i){let e={},t=f(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>P1(r))),g(e,["parts"],s)}let n=f(i,["role"]);return n!=null&&g(e,["role"],n),e}function C1(i,e,t){let n={},s=f(e,["expireTime"]);t!==void 0&&s!=null&&g(t,["expireTime"],s);let r=f(e,["newSessionExpireTime"]);t!==void 0&&r!=null&&g(t,["newSessionExpireTime"],r);let o=f(e,["uses"]);t!==void 0&&o!=null&&g(t,["uses"],o);let a=f(e,["liveConnectConstraints"]);t!==void 0&&a!=null&&g(t,["bidiGenerateContentSetup"],M1(i,a));let l=f(e,["lockAdditionalFields"]);return t!==void 0&&l!=null&&g(t,["fieldMask"],l),n}function T1(i,e){let t={},n=f(e,["config"]);return n!=null&&g(t,["config"],C1(i,n,t)),t}function _1(i){let e={};if(f(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(i,["fileUri"]);t!=null&&g(e,["fileUri"],t);let n=f(i,["mimeType"]);return n!=null&&g(e,["mimeType"],n),e}function x1(i){let e={},t=f(i,["id"]);t!=null&&g(e,["id"],t);let n=f(i,["args"]);n!=null&&g(e,["args"],n);let s=f(i,["name"]);if(s!=null&&g(e,["name"],s),f(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function R1(i){let e={};if(f(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(i,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function D1(i){let e={};if(f(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(i,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function I1(i,e){let t={},n=f(i,["generationConfig"]);e!==void 0&&n!=null&&g(e,["setup","generationConfig"],n);let s=f(i,["responseModalities"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig","responseModalities"],s);let r=f(i,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);let o=f(i,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);let a=f(i,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);let l=f(i,["maxOutputTokens"]);e!==void 0&&l!=null&&g(e,["setup","generationConfig","maxOutputTokens"],l);let c=f(i,["mediaResolution"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","mediaResolution"],c);let d=f(i,["seed"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","seed"],d);let u=f(i,["speechConfig"]);e!==void 0&&u!=null&&g(e,["setup","generationConfig","speechConfig"],ZE(u));let p=f(i,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);let m=f(i,["enableAffectiveDialog"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=f(i,["systemInstruction"]);e!==void 0&&y!=null&&g(e,["setup","systemInstruction"],A1(lt(y)));let v=f(i,["tools"]);if(e!==void 0&&v!=null){let I=Ga(v);Array.isArray(I)&&(I=I.map(M=>N1(Va(M)))),g(e,["setup","tools"],I)}let b=f(i,["sessionResumption"]);e!==void 0&&b!=null&&g(e,["setup","sessionResumption"],k1(b));let S=f(i,["inputAudioTranscription"]);e!==void 0&&S!=null&&g(e,["setup","inputAudioTranscription"],S);let C=f(i,["outputAudioTranscription"]);e!==void 0&&C!=null&&g(e,["setup","outputAudioTranscription"],C);let T=f(i,["realtimeInputConfig"]);e!==void 0&&T!=null&&g(e,["setup","realtimeInputConfig"],T);let _=f(i,["contextWindowCompression"]);e!==void 0&&_!=null&&g(e,["setup","contextWindowCompression"],_);let R=f(i,["proactivity"]);if(e!==void 0&&R!=null&&g(e,["setup","proactivity"],R),f(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function M1(i,e){let t={},n=f(e,["model"]);n!=null&&g(t,["setup","model"],de(i,n));let s=f(e,["config"]);return s!=null&&g(t,["config"],I1(s,t)),t}function P1(i){let e={},t=f(i,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);let n=f(i,["codeExecutionResult"]);n!=null&&g(e,["codeExecutionResult"],n);let s=f(i,["executableCode"]);s!=null&&g(e,["executableCode"],s);let r=f(i,["fileData"]);r!=null&&g(e,["fileData"],_1(r));let o=f(i,["functionCall"]);o!=null&&g(e,["functionCall"],x1(o));let a=f(i,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);let l=f(i,["inlineData"]);l!=null&&g(e,["inlineData"],w1(l));let c=f(i,["text"]);c!=null&&g(e,["text"],c);let d=f(i,["thought"]);d!=null&&g(e,["thought"],d);let u=f(i,["thoughtSignature"]);u!=null&&g(e,["thoughtSignature"],u);let p=f(i,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function k1(i){let e={},t=f(i,["handle"]);if(t!=null&&g(e,["handle"],t),f(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function N1(i){let e={},t=f(i,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(u=>u)),g(e,["functionDeclarations"],d)}if(f(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=f(i,["googleSearchRetrieval"]);n!=null&&g(e,["googleSearchRetrieval"],n);let s=f(i,["computerUse"]);s!=null&&g(e,["computerUse"],s);let r=f(i,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);let o=f(i,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=f(i,["googleMaps"]);a!=null&&g(e,["googleMaps"],R1(a));let l=f(i,["googleSearch"]);l!=null&&g(e,["googleSearch"],D1(l));let c=f(i,["urlContext"]);return c!=null&&g(e,["urlContext"],c),e}function F1(i){let e=[];for(let t in i)if(Object.prototype.hasOwnProperty.call(i,t)){let n=i[t];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){let s=Object.keys(n).map(r=>`${t}.${r}`);e.push(...s)}else e.push(t)}return e.join(",")}function L1(i,e){let t=null,n=i.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){let r=n.setup;typeof r=="object"&&r!==null?(i.bidiGenerateContentSetup=r,t=r):delete i.bidiGenerateContentSetup}else n!==void 0&&delete i.bidiGenerateContentSetup;let s=i.fieldMask;if(t){let r=F1(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)r?i.fieldMask=r:delete i.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&s!==null&&Array.isArray(s)&&s.length>0){let o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],a=[];s.length>0&&(a=s.map(c=>o.includes(c)?`generationConfig.${c}`:c));let l=[];r&&l.push(r),a.length>0&&l.push(...a),l.length>0?i.fieldMask=l.join(","):delete i.fieldMask}else delete i.fieldMask}else s!==null&&Array.isArray(s)&&s.length>0?i.fieldMask=s.join(","):delete i.fieldMask;return i}var IE=class extends Rn{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let a=T1(this.apiClient,e);r=U("auth_tokens",a._url),o=a._query,delete a.config,delete a._url,delete a._query;let l=L1(a,e.config);return s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),s.then(c=>c)}}};function O1(i,e){let t={},n=f(i,["force"]);return e!==void 0&&n!=null&&g(e,["_query","force"],n),t}function U1(i){let e={},t=f(i,["name"]);t!=null&&g(e,["_url","name"],t);let n=f(i,["config"]);return n!=null&&O1(n,e),e}function B1(i){let e={},t=f(i,["name"]);return t!=null&&g(e,["_url","name"],t),e}function H1(i,e){let t={},n=f(i,["pageSize"]);e!==void 0&&n!=null&&g(e,["_query","pageSize"],n);let s=f(i,["pageToken"]);return e!==void 0&&s!=null&&g(e,["_query","pageToken"],s),t}function $1(i){let e={},t=f(i,["parent"]);t!=null&&g(e,["_url","parent"],t);let n=f(i,["config"]);return n!=null&&H1(n,e),e}function V1(i){let e={},t=f(i,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);let n=f(i,["nextPageToken"]);n!=null&&g(e,["nextPageToken"],n);let s=f(i,["documents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["documents"],r)}return e}var ME=class extends Rn{constructor(e){super(),this.apiClient=e,this.list=async t=>new Fi(Ni.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:t.parent,config:n.config}),await this.listInternal(t),t)}async get(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=B1(e);return r=U("{name}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let o=U1(e);s=U("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=$1(e);return r=U("{parent}/documents",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=V1(l),d=new nE;return Object.assign(d,c),d})}}};var PE=class extends Rn{constructor(e,t=new ME(e)){super(),this.apiClient=e,this.documents=t,this.list=async(n={})=>new Fi(Ni.PAGED_ITEM_FILE_SEARCH_STORES,s=>this.listInternal(s),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=VL(e);return r=U("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async get(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=WL(e);return r=U("{name}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let o=zL(e);s=U("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=ZL(e);return r=U("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=jL(l),d=new iE;return Object.assign(d,c),d})}}async uploadToFileSearchStoreInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=QL(e);return r=U("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=e1(l),d=new sE;return Object.assign(d,c),d})}}async importFile(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=KL(e);return r=U("{file_search_store_name}:importFile",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json()),s.then(l=>{let c=YL(l),d=new rE;return Object.assign(d,c),d})}}};var tx=function(){let{crypto:i}=globalThis;if(i?.randomUUID)return tx=i.randomUUID.bind(i),i.randomUUID();let e=new Uint8Array(1),t=i?()=>i.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))},G1=()=>tx();function kE(i){return typeof i=="object"&&i!==null&&("name"in i&&i.name==="AbortError"||"message"in i&&String(i.message).includes("FetchRequestCanceledException"))}var NE=i=>{if(i instanceof Error)return i;if(typeof i=="object"&&i!==null){try{if(Object.prototype.toString.call(i)==="[object Error]"){let e=new Error(i.message,i.cause?{cause:i.cause}:{});return i.stack&&(e.stack=i.stack),i.cause&&!e.cause&&(e.cause=i.cause),i.name&&(e.name=i.name),e}}catch{}try{return new Error(JSON.stringify(i))}catch{}}return new Error(i)};var Rt=class extends Error{},Dt=class i extends Rt{constructor(e,t,n,s){super(`${i.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,n){let s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new Ha({message:n,cause:NE(t)});let r=t;return e===400?new Lp(e,r,n,s):e===401?new Op(e,r,n,s):e===403?new Up(e,r,n,s):e===404?new Bp(e,r,n,s):e===409?new Hp(e,r,n,s):e===422?new $p(e,r,n,s):e===429?new Vp(e,r,n,s):e>=500?new Gp(e,r,n,s):new i(e,r,n,s)}},cd=class extends Dt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Ha=class extends Dt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Fp=class extends Ha{constructor({message:e}={}){super({message:e??"Request timed out."})}},Lp=class extends Dt{},Op=class extends Dt{},Up=class extends Dt{},Bp=class extends Dt{},Hp=class extends Dt{},$p=class extends Dt{},Vp=class extends Dt{},Gp=class extends Dt{};var z1=/^[a-z][a-z0-9+.-]*:/i,W1=i=>z1.test(i),FE=i=>(FE=Array.isArray,FE(i)),q1=FE,Y1=q1,w0=Y1;function K1(i){if(!i)return!0;for(let e in i)return!1;return!0}function X1(i,e){return Object.prototype.hasOwnProperty.call(i,e)}var J1=(i,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Rt(`${i} must be an integer`);if(e<0)throw new Rt(`${i} must be a positive integer`);return e},Z1=i=>{try{return JSON.parse(i)}catch{return}};var j1=i=>new Promise(e=>setTimeout(e,i));var La="0.0.1";function Q1(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var eO=()=>{var i,e,t,n,s;let r=Q1();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":La,"X-Stainless-OS":C0(Deno.build.os),"X-Stainless-Arch":A0(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(i=Deno.version)===null||i===void 0?void 0:i.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":La,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":La,"X-Stainless-OS":C0((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":A0((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(s=globalThis.process.version)!==null&&s!==void 0?s:"unknown"};let o=tO();return o?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":La,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${o.browser}`,"X-Stainless-Runtime-Version":o.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":La,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function tO(){if(typeof navigator>"u"||!navigator)return null;let i=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of i){let n=t.exec(navigator.userAgent);if(n){let s=n[1]||0,r=n[2]||0,o=n[3]||0;return{browser:e,version:`${s}.${r}.${o}`}}}return null}var A0=i=>i==="x32"?"x32":i==="x86_64"||i==="x64"?"x64":i==="arm"?"arm":i==="aarch64"||i==="arm64"?"arm64":i?`other:${i}`:"unknown",C0=i=>(i=i.toLowerCase(),i.includes("ios")?"iOS":i==="android"?"Android":i==="darwin"?"MacOS":i==="win32"?"Windows":i==="freebsd"?"FreeBSD":i==="openbsd"?"OpenBSD":i==="linux"?"Linux":i?`Other:${i}`:"Unknown"),fp,nO=()=>fp??(fp=eO());function iO(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function nx(...i){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...i)}function sO(i){let e=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i[Symbol.iterator]();return nx({start(){},async pull(t){let{done:n,value:s}=await e.next();n?t.close():t.enqueue(s)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function ix(i){if(i[Symbol.asyncIterator])return i;let e=i.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function rO(i){var e,t;if(i===null||typeof i!="object")return;if(i[Symbol.asyncIterator]){await((t=(e=i[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}let n=i.getReader(),s=n.cancel();n.releaseLock(),await s}var oO=({headers:i,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var sx=()=>{var i;if(typeof File>"u"){let{process:e}=globalThis,t=typeof((i=e?.versions)===null||i===void 0?void 0:i.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Yb(i,e,t){return sx(),new File(i,e??"unknown_file",t)}function aO(i){return(typeof i=="object"&&i!==null&&("name"in i&&i.name&&String(i.name)||"url"in i&&i.url&&String(i.url)||"filename"in i&&i.filename&&String(i.filename)||"path"in i&&i.path&&String(i.path))||"").split(/[\\/]/).pop()||void 0}var lO=i=>i!=null&&typeof i=="object"&&typeof i[Symbol.asyncIterator]=="function";var rx=i=>i!=null&&typeof i=="object"&&typeof i.size=="number"&&typeof i.type=="string"&&typeof i.text=="function"&&typeof i.slice=="function"&&typeof i.arrayBuffer=="function",cO=i=>i!=null&&typeof i=="object"&&typeof i.name=="string"&&typeof i.lastModified=="number"&&rx(i),dO=i=>i!=null&&typeof i=="object"&&typeof i.url=="string"&&typeof i.blob=="function";async function uO(i,e,t){if(sx(),i=await i,cO(i))return i instanceof File?i:Yb([await i.arrayBuffer()],i.name);if(dO(i)){let s=await i.blob();return e||(e=new URL(i.url).pathname.split(/[\\/]/).pop()),Yb(await LE(s),e,t)}let n=await LE(i);if(e||(e=aO(i)),!t?.type){let s=n.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof s=="string"&&(t=Object.assign(Object.assign({},t),{type:s}))}return Yb(n,e,t)}async function LE(i){var e,t,n,s,r;let o=[];if(typeof i=="string"||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)o.push(i);else if(rx(i))o.push(i instanceof Blob?i:await i.arrayBuffer());else if(lO(i))try{for(var a=!0,l=xn(i),c;c=await l.next(),e=c.done,!e;a=!0){s=c.value,a=!1;let d=s;o.push(...await LE(d))}}catch(d){t={error:d}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}else{let d=(r=i?.constructor)===null||r===void 0?void 0:r.name;throw new Error(`Unexpected data type: ${typeof i}${d?`; constructor: ${d}`:""}${hO(i)}`)}return o}function hO(i){return typeof i!="object"||i===null?"":`; props: [${Object.getOwnPropertyNames(i).map(t=>`"${t}"`).join(", ")}]`}var zp=class{constructor(e){this._client=e}};zp._key=[];function ox(i){return i.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var T0=Object.freeze(Object.create(null)),fO=(i=ox)=>function(t,...n){if(t.length===1)return t[0];let s=!1,r=[],o=t.reduce((d,u,p)=>{var m,y,v;/[?#]/.test(u)&&(s=!0);let b=n[p],S=(s?encodeURIComponent:i)(""+b);return p!==n.length&&(b==null||typeof b=="object"&&b.toString===((v=Object.getPrototypeOf((y=Object.getPrototypeOf((m=b.hasOwnProperty)!==null&&m!==void 0?m:T0))!==null&&y!==void 0?y:T0))===null||v===void 0?void 0:v.toString))&&(S=b+"",r.push({start:d.length+u.length,length:S.length,error:`Value of type ${Object.prototype.toString.call(b).slice(8,-1)} is not a valid path parameter`})),d+u+(p===n.length?"":S)},""),a=o.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,c;for(;(c=l.exec(a))!==null;)r.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(r.sort((d,u)=>d.start-u.start),r.length>0){let d=0,u=r.reduce((p,m)=>{let y=" ".repeat(m.start-d),v="^".repeat(m.length);return d=m.start+m.length,p+y+v},"");throw new Rt(`Path parameters result in path with invalid segments:
${r.map(p=>p.error).join(`
`)}
${o}
${u}`)}return o},pp=fO(ox);var Wp=class extends zp{create(e,t){var n;let{api_version:s=this._client.apiVersion}=e,r=kp(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new Rt("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new Rt("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(pp`/${s}/interactions`,Object.assign(Object.assign({body:r},t),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,t={},n){let{api_version:s=this._client.apiVersion}=t??{};return this._client.delete(pp`/${s}/interactions/${e}`,n)}cancel(e,t={},n){let{api_version:s=this._client.apiVersion}=t??{};return this._client.post(pp`/${s}/interactions/${e}/cancel`,n)}get(e,t={},n){var s;let r=t??{},{api_version:o=this._client.apiVersion}=r,a=kp(r,["api_version"]);return this._client.get(pp`/${o}/interactions/${e}`,Object.assign(Object.assign({query:a},n),{stream:(s=t?.stream)!==null&&s!==void 0?s:!1}))}};Wp._key=Object.freeze(["interactions"]);var qp=class extends Wp{};function pO(i){let e=0;for(let s of i)e+=s.length;let t=new Uint8Array(e),n=0;for(let s of i)t.set(s,n),n+=s.length;return t}var gp;function jE(i){let e;return(gp??(e=new globalThis.TextEncoder,gp=e.encode.bind(e)))(i)}var mp;function _0(i){let e;return(mp??(e=new globalThis.TextDecoder,mp=e.decode.bind(e)))(i)}var $a=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?jE(e):e;this.buffer=pO([this.buffer,t]);let n=[],s;for(;(s=gO(this.buffer,this.carriageReturnIndex))!=null;){if(s.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=s.index;continue}if(this.carriageReturnIndex!=null&&(s.index!==this.carriageReturnIndex+1||s.carriage)){n.push(_0(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let r=this.carriageReturnIndex!==null?s.preceding-1:s.preceding,o=_0(this.buffer.subarray(0,r));n.push(o),this.buffer=this.buffer.subarray(s.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}};$a.NEWLINE_CHARS=new Set([`
`,"\r"]);$a.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function gO(i,e){for(let s=e??0;s<i.length;s++){if(i[s]===10)return{preceding:s,index:s+1,carriage:!1};if(i[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function mO(i){for(let n=0;n<i.length-1;n++){if(i[n]===10&&i[n+1]===10||i[n]===13&&i[n+1]===13)return n+2;if(i[n]===13&&i[n+1]===10&&n+3<i.length&&i[n+2]===13&&i[n+3]===10)return n+4}return-1}var Yp={off:0,error:200,warn:300,info:400,debug:500},x0=(i,e,t)=>{if(i){if(X1(Yp,i))return i;Et(t).warn(`${e} was set to ${JSON.stringify(i)}, expected one of ${JSON.stringify(Object.keys(Yp))}`)}};function ad(){}function yp(i,e,t){return!e||Yp[i]>Yp[t]?ad:e[i].bind(e)}var yO={error:ad,warn:ad,info:ad,debug:ad},R0=new WeakMap;function Et(i){var e;let t=i.logger,n=(e=i.logLevel)!==null&&e!==void 0?e:"off";if(!t)return yO;let s=R0.get(t);if(s&&s[0]===n)return s[1];let r={error:yp("error",t,n),warn:yp("warn",t,n),info:yp("info",t,n),debug:yp("debug",t,n)};return R0.set(t,[n,r]),r}var Fr=i=>(i.options&&(i.options=Object.assign({},i.options),delete i.options.headers),i.headers&&(i.headers=Object.fromEntries((i.headers instanceof Headers?[...i.headers]:Object.entries(i.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in i&&(i.retryOfRequestLogID&&(i.retryOf=i.retryOfRequestLogID),delete i.retryOfRequestLogID),i);var OE=class i{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let s=!1,r=n?Et(n):console;function o(){return _n(this,arguments,function*(){var l,c,d,u;if(s)throw new Rt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let p=!1;try{try{for(var m=!0,y=xn(vO(e,t)),v;v=yield J(y.next()),l=v.done,!l;m=!0){u=v.value,m=!1;let b=u;if(!p)if(b.data.startsWith("[DONE]")){p=!0;continue}else try{yield yield J(JSON.parse(b.data))}catch(S){throw r.error("Could not parse message into JSON:",b.data),r.error("From chunk:",b.raw),S}}}catch(b){c={error:b}}finally{try{!m&&!l&&(d=y.return)&&(yield J(d.call(y)))}finally{if(c)throw c.error}}p=!0}catch(b){if(kE(b))return yield J(void 0);throw b}finally{p||t.abort()}})}return new i(o,t,n)}static fromReadableStream(e,t,n){let s=!1;function r(){return _n(this,arguments,function*(){var l,c,d,u;let p=new $a,m=ix(e);try{for(var y=!0,v=xn(m),b;b=yield J(v.next()),l=b.done,!l;y=!0){u=b.value,y=!1;let S=u;for(let C of p.decode(S))yield yield J(C)}}catch(S){c={error:S}}finally{try{!y&&!l&&(d=v.return)&&(yield J(d.call(v)))}finally{if(c)throw c.error}}for(let S of p.flush())yield yield J(S)})}function o(){return _n(this,arguments,function*(){var l,c,d,u;if(s)throw new Rt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let p=!1;try{try{for(var m=!0,y=xn(r()),v;v=yield J(y.next()),l=v.done,!l;m=!0){u=v.value,m=!1;let b=u;p||b&&(yield yield J(JSON.parse(b)))}}catch(b){c={error:b}}finally{try{!m&&!l&&(d=y.return)&&(yield J(d.call(y)))}finally{if(c)throw c.error}}p=!0}catch(b){if(kE(b))return yield J(void 0);throw b}finally{p||t.abort()}})}return new i(o,t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),s=r=>({next:()=>{if(r.length===0){let o=n.next();e.push(o),t.push(o)}return r.shift()}});return[new i(()=>s(e),this.controller,this.client),new i(()=>s(t),this.controller,this.client)]}toReadableStream(){let e=this,t;return nx({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:s,done:r}=await t.next();if(r)return n.close();let o=jE(JSON.stringify(s)+`
`);n.enqueue(o)}catch(s){n.error(s)}},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}};function vO(i,e){return _n(this,arguments,function*(){var n,s,r,o;if(!i.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Rt("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Rt("Attempted to iterate over a response with no body");let a=new UE,l=new $a,c=ix(i.body);try{for(var d=!0,u=xn(bO(c)),p;p=yield J(u.next()),n=p.done,!n;d=!0){o=p.value,d=!1;let m=o;for(let y of l.decode(m)){let v=a.decode(y);v&&(yield yield J(v))}}}catch(m){s={error:m}}finally{try{!d&&!n&&(r=u.return)&&(yield J(r.call(u)))}finally{if(s)throw s.error}}for(let m of l.flush()){let y=a.decode(m);y&&(yield yield J(y))}})}function bO(i){return _n(this,arguments,function*(){var t,n,s,r;let o=new Uint8Array;try{for(var a=!0,l=xn(i),c;c=yield J(l.next()),t=c.done,!t;a=!0){r=c.value,a=!1;let d=r;if(d==null)continue;let u=d instanceof ArrayBuffer?new Uint8Array(d):typeof d=="string"?jE(d):d,p=new Uint8Array(o.length+u.length);p.set(o),p.set(u,o.length),o=p;let m;for(;(m=mO(o))!==-1;)yield yield J(o.slice(0,m)),o=o.slice(m)}}catch(d){n={error:d}}finally{try{!a&&!t&&(s=l.return)&&(yield J(s.call(l)))}finally{if(n)throw n.error}}o.length>0&&(yield yield J(o))})}var UE=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=EO(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function EO(i,e){let t=i.indexOf(e);return t!==-1?[i.substring(0,t),e,i.substring(t+e.length)]:[i,"",""]}async function SO(i,e){let{response:t,requestLogID:n,retryOfRequestLogID:s,startTime:r}=e,o=await(async()=>{var a;if(e.options.stream)return Et(i).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,i):OE.fromSSEResponse(t,e.controller,i);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let l=t.headers.get("content-type"),c=(a=l?.split(";")[0])===null||a===void 0?void 0:a.trim();return c?.includes("application/json")||c?.endsWith("+json")?await t.json():await t.text()})();return Et(i).debug(`[${n}] response parsed`,Fr({retryOfRequestLogID:s,url:t.url,status:t.status,body:o,durationMs:Date.now()-r})),o}var BE=class i extends Promise{constructor(e,t,n=SO){super(s=>{s(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new i(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var ax=Symbol("brand.privateNullableHeaders");function*wO(i){if(!i)return;if(ax in i){let{values:n,nulls:s}=i;yield*n.entries();for(let r of s)yield[r,null];return}let e=!1,t;i instanceof Headers?t=i.entries():w0(i)?t=i:(e=!0,t=Object.entries(i??{}));for(let n of t){let s=n[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");let r=w0(n[1])?n[1]:[n[1]],o=!1;for(let a of r)a!==void 0&&(e&&!o&&(o=!0,yield[s,null]),yield[s,a])}}var od=i=>{let e=new Headers,t=new Set;for(let n of i){let s=new Set;for(let[r,o]of wO(n)){let a=r.toLowerCase();s.has(a)||(e.delete(r),s.add(a)),o===null?(e.delete(r),t.add(a)):(e.append(r,o),t.delete(a))}}return{[ax]:!0,values:e,nulls:t}};var Kb=i=>{var e,t,n,s,r,o;if(typeof globalThis.process<"u")return(n=(t=(e=globalThis.process.env)===null||e===void 0?void 0:e[i])===null||t===void 0?void 0:t.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno<"u")return(o=(r=(s=globalThis.Deno.env)===null||s===void 0?void 0:s.get)===null||r===void 0?void 0:r.call(s,i))===null||o===void 0?void 0:o.trim()};var lx,Kp=class i{constructor(e){var t,n,s,r,o,a,l,{baseURL:c=Kb("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:d=(t=Kb("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:u="v1beta"}=e,p=kp(e,["baseURL","apiKey","apiVersion"]);let m=Object.assign(Object.assign({apiKey:d,apiVersion:u},p),{baseURL:c||"https://generativelanguage.googleapis.com"});this.baseURL=m.baseURL,this.timeout=(n=m.timeout)!==null&&n!==void 0?n:i.DEFAULT_TIMEOUT,this.logger=(s=m.logger)!==null&&s!==void 0?s:console;let y="warn";this.logLevel=y,this.logLevel=(o=(r=x0(m.logLevel,"ClientOptions.logLevel",this))!==null&&r!==void 0?r:x0(Kb("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&o!==void 0?o:y,this.fetchOptions=m.fetchOptions,this.maxRetries=(a=m.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(l=m.fetch)!==null&&l!==void 0?l:iO(),this.encoder=oO,this._options=m,this.apiKey=d,this.apiVersion=u,this.clientAdapter=m.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){let t=od([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return od([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return od([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new Rt(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${La}`}defaultIdempotencyKey(){return`stainless-node-retry-${G1()}`}makeStatusError(e,t,n,s){return Dt.generate(e,t,n,s)}buildURL(e,t,n){let s=!this.baseURLOverridden()&&n||this.baseURL,r=W1(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return K1(o)||(t=Object.assign(Object.assign({},o),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(s=>Object.assign({method:e,path:t},s)))}request(e,t=null){return new BE(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var s,r,o;let a=await e,l=(s=a.maxRetries)!==null&&s!==void 0?s:this.maxRetries;t==null&&(t=l),await this.prepareOptions(a);let{req:c,url:d,timeout:u}=await this.buildRequest(a,{retryCount:l-t});await this.prepareRequest(c,{url:d,options:a});let p="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),m=n===void 0?"":`, retryOf: ${n}`,y=Date.now();if(Et(this).debug(`[${p}] sending request`,Fr({retryOfRequestLogID:n,method:a.method,url:d,options:a,headers:c.headers})),!((r=a.signal)===null||r===void 0)&&r.aborted)throw new cd;let v=new AbortController,b=await this.fetchWithTimeout(d,c,u,v).catch(NE),S=Date.now();if(b instanceof globalThis.Error){let T=`retrying, ${t} attempts remaining`;if(!((o=a.signal)===null||o===void 0)&&o.aborted)throw new cd;let _=kE(b)||/timed? ?out/i.test(String(b)+("cause"in b?String(b.cause):""));if(t)return Et(this).info(`[${p}] connection ${_?"timed out":"failed"} - ${T}`),Et(this).debug(`[${p}] connection ${_?"timed out":"failed"} (${T})`,Fr({retryOfRequestLogID:n,url:d,durationMs:S-y,message:b.message})),this.retryRequest(a,t,n??p);throw Et(this).info(`[${p}] connection ${_?"timed out":"failed"} - error; no more retries left`),Et(this).debug(`[${p}] connection ${_?"timed out":"failed"} (error; no more retries left)`,Fr({retryOfRequestLogID:n,url:d,durationMs:S-y,message:b.message})),_?new Fp:new Ha({cause:b})}let C=`[${p}${m}] ${c.method} ${d} ${b.ok?"succeeded":"failed"} with status ${b.status} in ${S-y}ms`;if(!b.ok){let T=await this.shouldRetry(b);if(t&&T){let N=`retrying, ${t} attempts remaining`;return await rO(b.body),Et(this).info(`${C} - ${N}`),Et(this).debug(`[${p}] response error (${N})`,Fr({retryOfRequestLogID:n,url:b.url,status:b.status,headers:b.headers,durationMs:S-y})),this.retryRequest(a,t,n??p,b.headers)}let _=T?"error; no more retries left":"error; not retryable";Et(this).info(`${C} - ${_}`);let R=await b.text().catch(N=>NE(N).message),I=Z1(R),M=I?void 0:R;throw Et(this).debug(`[${p}] response error (${_})`,Fr({retryOfRequestLogID:n,url:b.url,status:b.status,headers:b.headers,message:M,durationMs:Date.now()-y})),this.makeStatusError(b.status,I,M,b.headers)}return Et(this).info(C),Et(this).debug(`[${p}] response start`,Fr({retryOfRequestLogID:n,url:b.url,status:b.status,headers:b.headers,durationMs:S-y})),{response:b,options:a,controller:v,requestLogID:p,retryOfRequestLogID:n,startTime:y}}async fetchWithTimeout(e,t,n,s){let r=t||{},{signal:o,method:a}=r,l=kp(r,["signal","method"]);o&&o.addEventListener("abort",()=>s.abort());let c=setTimeout(()=>s.abort(),n),d=globalThis.ReadableStream&&l.body instanceof globalThis.ReadableStream||typeof l.body=="object"&&l.body!==null&&Symbol.asyncIterator in l.body,u=Object.assign(Object.assign(Object.assign({signal:s.signal},d?{duplex:"half"}:{}),{method:"GET"}),l);a&&(u.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,u)}finally{clearTimeout(c)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,s){var r;let o,a=s?.get("retry-after-ms");if(a){let c=parseFloat(a);Number.isNaN(c)||(o=c)}let l=s?.get("retry-after");if(l&&!o){let c=parseFloat(l);Number.isNaN(c)?o=Date.parse(l)-Date.now():o=c*1e3}if(!(o&&0<=o&&o<60*1e3)){let c=(r=e.maxRetries)!==null&&r!==void 0?r:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,c)}return await j1(o),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let r=t-e,o=Math.min(.5*Math.pow(2,r),8),a=1-Math.random()*.25;return o*a*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,s,r;let o=Object.assign({},e),{method:a,path:l,query:c,defaultBaseURL:d}=o,u=this.buildURL(l,c,d);"timeout"in o&&J1("timeout",o.timeout),o.timeout=(n=o.timeout)!==null&&n!==void 0?n:this.timeout;let{bodyHeaders:p,body:m}=this.buildBody({options:o}),y=await this.buildHeaders({options:e,method:a,bodyHeaders:p,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:y},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&m instanceof globalThis.ReadableStream&&{duplex:"half"}),m&&{body:m}),(s=this.fetchOptions)!==null&&s!==void 0?s:{}),(r=o.fetchOptions)!==null&&r!==void 0?r:{}),url:u,timeout:o.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:s}){let r={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let o=await this.authHeaders(e),a=od([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),nO()),this._options.defaultHeaders,n,e.headers,o]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=od([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:sO(e)}:this.encoder({body:e,headers:n})}};Kp.DEFAULT_TIMEOUT=6e4;var Ne=class extends Kp{constructor(){super(...arguments),this.interactions=new qp(this)}};lx=Ne;Ne.GeminiNextGenAPIClient=lx;Ne.GeminiNextGenAPIClientError=Rt;Ne.APIError=Dt;Ne.APIConnectionError=Ha;Ne.APIConnectionTimeoutError=Fp;Ne.APIUserAbortError=cd;Ne.NotFoundError=Bp;Ne.ConflictError=Hp;Ne.RateLimitError=Vp;Ne.BadRequestError=Lp;Ne.AuthenticationError=Op;Ne.InternalServerError=Gp;Ne.PermissionDeniedError=Up;Ne.UnprocessableEntityError=$p;Ne.toFile=uO;Ne.Interactions=qp;function AO(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function CO(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function TO(i,e){let t={},n=f(i,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function _O(i,e){let t={},n=f(i,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function xO(i,e,t){let n={};if(f(i,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let s=f(i,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&g(e,["displayName"],s),f(i,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let r=f(i,["epochCount"]);e!==void 0&&r!=null&&g(e,["tuningTask","hyperparameters","epochCount"],r);let o=f(i,["learningRateMultiplier"]);if(o!=null&&g(n,["tuningTask","hyperparameters","learningRateMultiplier"],o),f(i,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(f(i,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(f(i,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let a=f(i,["batchSize"]);e!==void 0&&a!=null&&g(e,["tuningTask","hyperparameters","batchSize"],a);let l=f(i,["learningRate"]);if(e!==void 0&&l!=null&&g(e,["tuningTask","hyperparameters","learningRate"],l),f(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(f(i,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function RO(i,e,t){let n={},s=f(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){let m=f(i,["validationDataset"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec"],D0(m))}else if(s==="PREFERENCE_TUNING"){let m=f(i,["validationDataset"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec"],D0(m))}let r=f(i,["tunedModelDisplayName"]);e!==void 0&&r!=null&&g(e,["tunedModelDisplayName"],r);let o=f(i,["description"]);e!==void 0&&o!=null&&g(e,["description"],o);let a=f(t,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){let m=f(i,["epochCount"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","hyperParameters","epochCount"],m)}else if(a==="PREFERENCE_TUNING"){let m=f(i,["epochCount"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],m)}let l=f(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){let m=f(i,["learningRateMultiplier"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],m)}else if(l==="PREFERENCE_TUNING"){let m=f(i,["learningRateMultiplier"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],m)}let c=f(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){let m=f(i,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","exportLastCheckpointOnly"],m)}else if(c==="PREFERENCE_TUNING"){let m=f(i,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],m)}let d=f(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){let m=f(i,["adapterSize"]);e!==void 0&&m!=null&&g(e,["supervisedTuningSpec","hyperParameters","adapterSize"],m)}else if(d==="PREFERENCE_TUNING"){let m=f(i,["adapterSize"]);e!==void 0&&m!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],m)}if(f(i,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(f(i,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let u=f(i,["labels"]);e!==void 0&&u!=null&&g(e,["labels"],u);let p=f(i,["beta"]);return e!==void 0&&p!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","beta"],p),n}function DO(i,e){let t={},n=f(i,["baseModel"]);n!=null&&g(t,["baseModel"],n);let s=f(i,["preTunedModel"]);s!=null&&g(t,["preTunedModel"],s);let r=f(i,["trainingDataset"]);r!=null&&HO(r);let o=f(i,["config"]);return o!=null&&xO(o,t),t}function IO(i,e){let t={},n=f(i,["baseModel"]);n!=null&&g(t,["baseModel"],n);let s=f(i,["preTunedModel"]);s!=null&&g(t,["preTunedModel"],s);let r=f(i,["trainingDataset"]);r!=null&&$O(r,t,e);let o=f(i,["config"]);return o!=null&&RO(o,t,e),t}function MO(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function PO(i,e){let t={},n=f(i,["name"]);return n!=null&&g(t,["_url","name"],n),t}function kO(i,e,t){let n={},s=f(i,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);let r=f(i,["pageToken"]);e!==void 0&&r!=null&&g(e,["_query","pageToken"],r);let o=f(i,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),n}function NO(i,e,t){let n={},s=f(i,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);let r=f(i,["pageToken"]);e!==void 0&&r!=null&&g(e,["_query","pageToken"],r);let o=f(i,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),n}function FO(i,e){let t={},n=f(i,["config"]);return n!=null&&kO(n,t),t}function LO(i,e){let t={},n=f(i,["config"]);return n!=null&&NO(n,t),t}function OO(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["nextPageToken"]);s!=null&&g(t,["nextPageToken"],s);let r=f(i,["tunedModels"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>cx(a))),g(t,["tuningJobs"],o)}return t}function UO(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["nextPageToken"]);s!=null&&g(t,["nextPageToken"],s);let r=f(i,["tuningJobs"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>HE(a))),g(t,["tuningJobs"],o)}return t}function BO(i,e){let t={},n=f(i,["name"]);n!=null&&g(t,["model"],n);let s=f(i,["name"]);return s!=null&&g(t,["endpoint"],s),t}function HO(i,e){let t={};if(f(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(i,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=f(i,["examples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),g(t,["examples","examples"],s)}return t}function $O(i,e,t){let n={},s=f(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){let o=f(i,["gcsUri"]);e!==void 0&&o!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(s==="PREFERENCE_TUNING"){let o=f(i,["gcsUri"]);e!==void 0&&o!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}let r=f(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){let o=f(i,["vertexDatasetResource"]);e!==void 0&&o!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(r==="PREFERENCE_TUNING"){let o=f(i,["vertexDatasetResource"]);e!==void 0&&o!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}if(f(i,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function cx(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["name"]);s!=null&&g(t,["name"],s);let r=f(i,["state"]);r!=null&&g(t,["state"],O0(r));let o=f(i,["createTime"]);o!=null&&g(t,["createTime"],o);let a=f(i,["tuningTask","startTime"]);a!=null&&g(t,["startTime"],a);let l=f(i,["tuningTask","completeTime"]);l!=null&&g(t,["endTime"],l);let c=f(i,["updateTime"]);c!=null&&g(t,["updateTime"],c);let d=f(i,["description"]);d!=null&&g(t,["description"],d);let u=f(i,["baseModel"]);u!=null&&g(t,["baseModel"],u);let p=f(i,["_self"]);return p!=null&&g(t,["tunedModel"],BO(p)),t}function HE(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["name"]);s!=null&&g(t,["name"],s);let r=f(i,["state"]);r!=null&&g(t,["state"],O0(r));let o=f(i,["createTime"]);o!=null&&g(t,["createTime"],o);let a=f(i,["startTime"]);a!=null&&g(t,["startTime"],a);let l=f(i,["endTime"]);l!=null&&g(t,["endTime"],l);let c=f(i,["updateTime"]);c!=null&&g(t,["updateTime"],c);let d=f(i,["error"]);d!=null&&g(t,["error"],d);let u=f(i,["description"]);u!=null&&g(t,["description"],u);let p=f(i,["baseModel"]);p!=null&&g(t,["baseModel"],p);let m=f(i,["tunedModel"]);m!=null&&g(t,["tunedModel"],m);let y=f(i,["preTunedModel"]);y!=null&&g(t,["preTunedModel"],y);let v=f(i,["supervisedTuningSpec"]);v!=null&&g(t,["supervisedTuningSpec"],v);let b=f(i,["preferenceOptimizationSpec"]);b!=null&&g(t,["preferenceOptimizationSpec"],b);let S=f(i,["tuningDataStats"]);S!=null&&g(t,["tuningDataStats"],S);let C=f(i,["encryptionSpec"]);C!=null&&g(t,["encryptionSpec"],C);let T=f(i,["partnerModelTuningSpec"]);T!=null&&g(t,["partnerModelTuningSpec"],T);let _=f(i,["customBaseModel"]);_!=null&&g(t,["customBaseModel"],_);let R=f(i,["experiment"]);R!=null&&g(t,["experiment"],R);let I=f(i,["labels"]);I!=null&&g(t,["labels"],I);let M=f(i,["outputUri"]);M!=null&&g(t,["outputUri"],M);let k=f(i,["pipelineJob"]);k!=null&&g(t,["pipelineJob"],k);let N=f(i,["serviceAccount"]);N!=null&&g(t,["serviceAccount"],N);let F=f(i,["tunedModelDisplayName"]);F!=null&&g(t,["tunedModelDisplayName"],F);let $=f(i,["veoTuningSpec"]);return $!=null&&g(t,["veoTuningSpec"],$),t}function VO(i,e){let t={},n=f(i,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);let s=f(i,["name"]);s!=null&&g(t,["name"],s);let r=f(i,["metadata"]);r!=null&&g(t,["metadata"],r);let o=f(i,["done"]);o!=null&&g(t,["done"],o);let a=f(i,["error"]);return a!=null&&g(t,["error"],a),t}function D0(i,e){let t={},n=f(i,["gcsUri"]);n!=null&&g(t,["validationDatasetUri"],n);let s=f(i,["vertexDatasetResource"]);return s!=null&&g(t,["validationDatasetUri"],s),t}var $E=class extends Rn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Fi(Ni.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var n;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let s={tunedModelName:t.baseModel};!((n=t.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(s.checkpointId=t.config.preTunedModelCheckpointId);let r=Object.assign(Object.assign({},t),{preTunedModel:s});return r.baseModel=void 0,await this.tuneInternal(r)}else{let s=Object.assign({},t);return await this.tuneInternal(s)}else{let s=Object.assign({},t),r=await this.tuneMldevInternal(s),o="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?o=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(o=r.name.split("/operations/")[0]),{name:o,state:Jb.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=PO(e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>HE(d))}else{let c=MO(e);return a=U("{name}",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>cx(d))}}async listInternal(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=LO(e);return a=U("tuningJobs",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=UO(d),p=new xp;return Object.assign(p,u),p})}else{let c=FO(e);return a=U("tunedModels",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=OO(d),p=new xp;return Object.assign(p,u),p})}}async cancel(e){var t,n,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){let c=CO(e);return a=U("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=_O(d),p=new Rp;return Object.assign(p,u),p})}else{let c=AO(e);return a=U("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(u=>{let p=u;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{let u=TO(d),p=new Rp;return Object.assign(p,u),p})}}async tuneInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI()){let a=IO(e,e);return r=U("tuningJobs",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>HE(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=DO(e);return r=U("tunedModels",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(l=>l.json().then(c=>{let d=c;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>VO(l))}}};var VE=class{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},GO=1024*1024*8,zO=3,WO=1e3,qO=2,Xp="x-goog-upload-status";async function YO(i,e,t){var n;let s=await dx(i,e,t),r=await s?.json();if(((n=s?.headers)===null||n===void 0?void 0:n[Xp])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function KO(i,e,t){var n;let s=await dx(i,e,t),r=await s?.json();if(((n=s?.headers)===null||n===void 0?void 0:n[Xp])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let o=M0(r),a=new uE;return Object.assign(a,o),a}async function dx(i,e,t){var n,s;let r=0,o=0,a=new ld(new Response),l="upload";for(r=i.size;o<r;){let c=Math.min(GO,r-o),d=i.slice(o,o+c);o+c>=r&&(l+=", finalize");let u=0,p=WO;for(;u<zO&&(a=await t.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(o),"Content-Length":String(c)}}}),!(!((n=a?.headers)===null||n===void 0)&&n[Xp]));)u++,await JO(p),p=p*qO;if(o+=c,((s=a?.headers)===null||s===void 0?void 0:s[Xp])!=="active")break;if(r<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function XO(i){return{size:i.size,type:i.type}}function JO(i){return new Promise(e=>setTimeout(e,i))}var GE=class{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await YO(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await KO(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await XO(e)}};var zE=class{create(e,t,n){return new WE(e,t,n)}},WE=class{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var I0="x-goog-api-key",qE=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(I0)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(I0,this.apiKey)}}};var ZO="gl-node/",Jp=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e?.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new Ne({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e?.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;let n=xP(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let s=new qE(this.apiKey);this.apiClient=new wE({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:ZO+"web",uploader:new GE,downloader:new VE}),this.models=new RE(this.apiClient),this.live=new _E(this.apiClient,s,new zE),this.batches=new pE(this.apiClient),this.chats=new mE(this.models,this.apiClient),this.caches=new gE(this.apiClient),this.files=new vE(this.apiClient),this.operations=new DE(this.apiClient),this.authTokens=new IE(this.apiClient),this.tunings=new $E(this.apiClient),this.fileSearchStores=new PE(this.apiClient)}};var ux=`You are my assistant for classifying notes by project and restructuring content when needed.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uBD84\uB958 \uADDC\uCE59 (\uC911\uC694\uB3C4 \uC21C)

### 1. \uD504\uB85C\uC81D\uD2B8 \uC0B0\uCD9C\uBB3C (contentType: "artifact")
\uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC9C1\uC811 \uC800\uC7A5\uD574\uC57C \uD560 \uAC83:
- \uC9C1\uC811 \uC791\uC131\uD55C \uBB38\uC11C, \uACC4\uD68D\uC11C, \uD68C\uC758\uB85D
- \uD504\uB85C\uC81D\uD2B8\uB97C \uC704\uD574 \uB9CC\uB4E0 \uCF54\uB4DC, \uC124\uACC4\uC11C
- \uD504\uB85C\uC81D\uD2B8 \uC9C4\uD589 \uAD00\uB828 \uBA54\uBAA8

### 2. \uD504\uB85C\uC81D\uD2B8 \uCC38\uACE0\uC790\uB8CC (contentType: "reference")
Library\uC5D0 \uC800\uC7A5\uD558\uB418 \uD504\uB85C\uC81D\uD2B8\uC640 \uB9C1\uD06C\uD574\uC57C \uD560 \uAC83:
- \uC678\uBD80 \uD29C\uD1A0\uB9AC\uC5BC, \uC608\uC81C \uCF54\uB4DC, \uBB38\uC11C
- \uC6F9\uD398\uC774\uC9C0 \uC2A4\uD06C\uB7A9, \uC544\uD2F0\uD074
- \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uC790\uB8CC
- \uC608: "ESP32 \uC608\uC81C" \u2192 \uD30C\uCE20\uD31C\uC5D0 \uC720\uC6A9\uD558\uC9C0\uB9CC Library\uC5D0 \uC800\uC7A5

### 3. \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC (targetType: "library", contentType: "general")
- \uD2B9\uC815 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828 \uC5C6\uB294 \uC77C\uBC18 \uC815\uBCF4
- \uB274\uC2A4, \uACF5\uACE0, \uC77C\uBC18 \uC544\uD2F0\uD074

### 4. archive
- \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83

## \uD310\uB2E8 \uAE30\uC900
- "\uC774\uAC74 \uB0B4\uAC00 \uC9C1\uC811 \uB9CC\uB4E0 \uC0B0\uCD9C\uBB3C\uC778\uAC00?" \u2192 artifact
- "\uC774\uAC74 \uC678\uBD80 \uC790\uB8CC\uC778\uB370 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC720\uC6A9\uD55C\uAC00?" \u2192 reference
- "\uC774\uAC74 \uADF8\uB0E5 \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC\uC778\uAC00?" \u2192 general
- "\uD504\uB85C\uC81D\uD2B8 \uB05D\uB098\uB3C4 \uACC4\uC18D \uCC38\uACE0\uD560 \uC790\uB8CC\uC778\uAC00?" \u2192 reference (Library)

## \uCF58\uD150\uCE20 \uC7AC\uAD6C\uC131 (Phase 2)

\uB178\uD2B8\uAC00 \uC815\uB9AC\uB418\uC9C0 \uC54A\uC740 \uC6D0\uC2DC \uD615\uD0DC\uB77C\uBA74 \uC7AC\uAD6C\uC131\uC744 \uC81C\uC548\uD574\uB77C:

### \uC7AC\uAD6C\uC131 \uD544\uC694 \uC5EC\uBD80 \uD310\uB2E8
- \uAD6C\uC870\uD654\uB418\uC9C0 \uC54A\uC740 \uBA54\uBAA8 (\uC904\uAE00, \uB098\uC5F4, \uD0A4\uC6CC\uB4DC\uB9CC)
- \uD68C\uC758/\uBBF8\uD305 \uB0B4\uC6A9\uC778\uB370 \uC815\uB9AC \uC548 \uB428
- \uD559\uC2B5 \uB0B4\uC6A9\uC778\uB370 \uCCB4\uACC4 \uC5C6\uC74C
- \uC544\uC774\uB514\uC5B4\uC778\uB370 \uC124\uBA85 \uBD80\uC871

### \uC7AC\uAD6C\uC131 \uC720\uD615\uBCC4 \uD15C\uD50C\uB9BF

**meeting (\uD68C\uC758/\uBBF8\uD305)**:
\`\`\`
## \uD68C\uC758 \uC694\uC57D
- \uC77C\uC2DC: [\uB0A0\uC9DC]
- \uCC38\uC11D\uC790: [\uCD94\uB860 \uAC00\uB2A5\uD558\uBA74]
- \uC8FC\uC81C: [\uD575\uC2EC \uC8FC\uC81C]

## \uB17C\uC758 \uB0B4\uC6A9
- [\uD575\uC2EC \uB17C\uC758 1]
- [\uD575\uC2EC \uB17C\uC758 2]

## \uACB0\uC815\uC0AC\uD56D
- [\uACB0\uC815 1]

## \uC561\uC158 \uC544\uC774\uD15C
- [ ] [\uD560 \uC77C]
\`\`\`

**idea (\uC544\uC774\uB514\uC5B4/\uBE0C\uB808\uC778\uC2A4\uD1A0\uBC0D)**:
\`\`\`
## \uD575\uC2EC \uC544\uC774\uB514\uC5B4
[\uC544\uC774\uB514\uC5B4 1\uC904 \uC694\uC57D]

## \uC0C1\uC138 \uC124\uBA85
[\uC544\uC774\uB514\uC5B4 \uC124\uBA85]

## \uC65C \uC911\uC694\uD55C\uAC00?
[\uC774\uC720]

## \uB2E4\uC74C \uB2E8\uACC4
- [ ] [\uAC80\uC99D/\uC2E4\uD589 \uBC29\uBC95]
\`\`\`

**learning (\uD559\uC2B5/\uC5F0\uAD6C)**:
\`\`\`
## \uC8FC\uC81C
[\uD559\uC2B5 \uC8FC\uC81C]

## \uD575\uC2EC \uAC1C\uB150
- [\uAC1C\uB150 1]
- [\uAC1C\uB150 2]

## \uBC30\uC6B4 \uC810
[\uC778\uC0AC\uC774\uD2B8]

## \uC801\uC6A9 \uBC29\uBC95
- [\uC2E4\uC81C \uC801\uC6A9 \uC608\uC2DC]
\`\`\`

**general (\uC77C\uBC18 \uC815\uB9AC)**:
\`\`\`
## \uC694\uC57D
[\uD575\uC2EC \uB0B4\uC6A9 2-3\uBB38\uC7A5]

## \uC8FC\uC694 \uB0B4\uC6A9
- [\uD3EC\uC778\uD2B8 1]
- [\uD3EC\uC778\uD2B8 2]

## \uAD00\uB828 \uC815\uBCF4
- [\uCC38\uACE0 \uC0AC\uD56D]
\`\`\`

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "targetType": "project \uB610\uB294 library \uB610\uB294 archive",
  "contentType": "artifact \uB610\uB294 reference \uB610\uB294 general",
  "projectName": "\uD504\uB85C\uC81D\uD2B8\uBA85 (project \uB610\uB294 reference\uC77C \uB54C)",
  "isNewProject": true/false,
  "confidence": "high \uB610\uB294 medium \uB610\uB294 low",
  "reason": "\uC774 \uBD84\uB958\uB97C \uC120\uD0DD\uD55C \uC774\uC720 (1\uC904)",
  "title": "\uB178\uD2B8 \uC81C\uBAA9",
  "summary": "2-3\uBB38\uC7A5 \uC694\uC57D",
  "nextAction": "\uB2E4\uC74C \uD589\uB3D9 \uB610\uB294 null",
  "shouldRestructure": true/false,
  "restructureType": "meeting \uB610\uB294 idea \uB610\uB294 learning \uB610\uB294 general (\uC7AC\uAD6C\uC131 \uD544\uC694\uC2DC)",
  "restructuredContent": "\uC7AC\uAD6C\uC131\uB41C \uB9C8\uD06C\uB2E4\uC6B4 \uB0B4\uC6A9 (shouldRestructure\uAC00 true\uC77C \uB54C)"
}

**\uC911\uC694**: shouldRestructure\uAC00 false\uBA74 restructureType\uACFC restructuredContent\uB294 \uC0DD\uB7B5
`,hx=`\uB108\uB294 \uC81C\uD154\uCE74\uC2A4\uD150(Zettelkasten) \uBC29\uC2DD\uC758 \uC601\uAD6C \uB178\uD2B8\uB97C \uB9CC\uB4DC\uB294 \uBE44\uC11C\uB2E4.
\uC544\uB798 \uB178\uD2B8\uC5D0\uC11C \uC81C\uD154\uCE74\uC2A4\uD150\uC6A9 \uC601\uAD6C \uB178\uD2B8 \uD6C4\uBCF4 \uC544\uC774\uB514\uC5B4\uB4E4\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uD55C \uB178\uD2B8\uC5D0\uB294 \uD558\uB098\uC758 \uC544\uC774\uB514\uC5B4\uB9CC \uB2F4\uB294\uB2E4 (atomic note)
- \uAC01 \uC544\uC774\uB514\uC5B4\uB294 3-5\uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD55C\uB2E4
- \uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C
- \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC5F0\uACB0\uB420 \uC218 \uC788\uB294 \uAC1C\uB150 2-3\uAC1C\uB97C \uC81C\uC548\uD574\uB77C
- \uC544\uC774\uB514\uC5B4\uB9C8\uB2E4 \uC5F0\uAD00 \uD0A4\uC6CC\uB4DC\uB97C \uD568\uAED8 \uC801\uC5B4\uB77C

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uC544\uC774\uB514\uC5B4\uB97C \uD55C \uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD558\uB294 \uC81C\uBAA9",
    "body": "3-5\uBB38\uC7A5\uC758 \uC124\uBA85",
    "importance": "\uC65C \uC774 \uC544\uC774\uB514\uC5B4\uAC00 \uC911\uC694\uD55C\uAC00? (1\uC904)",
    "relatedConcepts": ["\uAC1C\uB1501", "\uAC1C\uB1502", "\uAC1C\uB1503"],
    "keywords": ["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3"]
  }
]

\uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uC744 \uBC18\uD658\uD574\uB77C.
`,fx=`\uB108\uB294 \uB098\uC758 \uC791\uC5C5 \uC6B0\uC120\uC21C\uC704 \uCF54\uCE58\uB2E4.
\uC544\uB798 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D\uC744 \uBCF4\uACE0, \uC9C0\uAE08 \uB0B4\uAC00 \uC9D1\uC911\uD574\uC57C \uD560 \uC0C1\uC704 3\uAC1C\uB9CC \uACE8\uB77C\uB77C.

## \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uAC01 \uD504\uB85C\uC81D\uD2B8\uC5D0 \uB300\uD574 \uB2E4\uC74C\uC744 \uC81C\uACF5\uD574\uB77C
- title: \uD504\uB85C\uC81D\uD2B8 \uC774\uB984
- why: \uC65C \uC9C0\uAE08 \uC911\uC694\uD55C\uC9C0 \uD55C \uC904 \uC124\uBA85
- next_action: \uC624\uB298 \uB2F9\uC7A5 \uD560 \uC218 \uC788\uB294 \uAC00\uC7A5 \uC791\uC740 \uB2E4\uC74C \uD589\uB3D9

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uD504\uB85C\uC81D\uD2B8 \uC774\uB984",
    "why": "\uC911\uC694\uD55C \uC774\uC720",
    "next_action": "\uB2E4\uC74C \uD589\uB3D9"
  }
]
`,px=`\uC774 \uC774\uBBF8\uC9C0\uC5D0\uC11C \uD14D\uC2A4\uD2B8\uB97C \uCD94\uCD9C\uD574\uB77C.
\uC190\uAE00\uC528, \uC778\uC1C4\uBB3C, \uC2A4\uCE94 \uBB38\uC11C \uB4F1 \uBAA8\uB4E0 \uD615\uD0DC\uC758 \uD14D\uC2A4\uD2B8\uB97C \uC77D\uC5B4\uB77C.

## \uADDC\uCE59
- \uC774\uBBF8\uC9C0\uC5D0 \uBCF4\uC774\uB294 \uBAA8\uB4E0 \uD14D\uC2A4\uD2B8\uB97C \uADF8\uB300\uB85C \uCD94\uCD9C
- \uC6D0\uBCF8\uC758 \uC904\uBC14\uAFC8\uACFC \uAD6C\uC870\uB97C \uCD5C\uB300\uD55C \uC720\uC9C0
- \uD45C\uAC00 \uC788\uC73C\uBA74 \uB9C8\uD06C\uB2E4\uC6B4 \uD45C\uB85C \uBCC0\uD658
- \uC77D\uC744 \uC218 \uC5C6\uB294 \uBD80\uBD84\uC740 [\uBD88\uBA85\uD655] \uC73C\uB85C \uD45C\uC2DC
- \uD14D\uC2A4\uD2B8\uB9CC \uCD9C\uB825\uD558\uACE0 \uB2E4\uB978 \uC124\uBA85\uC740 \uD558\uC9C0 \uB9C8\uB77C
`,gx=`\uB178\uD2B8 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD575\uC2EC \uD0A4\uC6CC\uB4DC 5-10\uAC1C\uB97C \uCD94\uCD9C\uD574\uB77C.

## \uADDC\uCE59
- \uAE30\uC220 \uC6A9\uC5B4, \uD504\uB85C\uC81D\uD2B8\uBA85, \uC8FC\uC694 \uAC1C\uB150 \uC704\uC8FC\uB85C \uCD94\uCD9C
- \uB108\uBB34 \uC77C\uBC18\uC801\uC778 \uB2E8\uC5B4 (\uC608: \uBC29\uBC95, \uB0B4\uC6A9, \uC815\uBCF4)\uB294 \uC81C\uC678
- \uD55C\uAE00/\uC601\uC5B4 \uBAA8\uB450 \uAC00\uB2A5
- \uBCF5\uD569 \uBA85\uC0AC\uB294 \uBD84\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C (\uC608: "\uC2A4\uB9C8\uD2B8\uD31C", "API\uD0A4")

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
["\uD0A4\uC6CC\uB4DC1", "\uD0A4\uC6CC\uB4DC2", "\uD0A4\uC6CC\uB4DC3", ...]
`,mx=`\uC0C8 \uB178\uD2B8\uC640 \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4\uC758 \uAD00\uB828\uC131\uC744 \uBD84\uC11D\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {newTitle}
\uD0A4\uC6CC\uB4DC: {newKeywords}

## \uAE30\uC874 \uB178\uD2B8 \uD6C4\uBCF4\uB4E4
{candidates}

## \uADDC\uCE59
- \uAC01 \uD6C4\uBCF4 \uB178\uD2B8\uC5D0 \uB300\uD574 \uAD00\uB828\uB3C4 \uC810\uC218(0.0~1.0)\uB97C \uB9E4\uACA8\uB77C
- 0.5 \uC774\uC0C1\uC778 \uB178\uD2B8\uB9CC \uBC18\uD658
- \uCD5C\uB300 5\uAC1C\uAE4C\uC9C0\uB9CC \uBC18\uD658
- \uAD00\uB828\uB3C4 \uB192\uC740 \uC21C\uC73C\uB85C \uC815\uB82C
- \uAC01 \uC5F0\uACB0\uC758 "\uC774\uC720"\uB97C \uD55C \uC904\uB85C \uC124\uBA85\uD574\uB77C (\uC65C \uAD00\uB828\uC788\uB294\uAC00?)
- \uC5F0\uACB0 \uC720\uD615 \uBD84\uB958: \uD655\uC7A5|\uBC18\uBC15|\uC608\uC2DC|\uC804\uC81C|\uC751\uC6A9 \uC911 \uD558\uB098

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C\uB9CC \uC751\uB2F5)
[
  {
    "index": 0,
    "relevance": 0.8,
    "reason": "\uC774 \uB178\uD2B8\uC640 \uAD00\uB828\uC788\uB294 \uAD6C\uCCB4\uC801 \uC774\uC720",
    "type": "\uD655\uC7A5"
  }
]
`,yx=`\uC0C8 \uB178\uD2B8\uAC00 \uC5B4\uB5A4 \uD504\uB85C\uC81D\uD2B8\uC640 \uAD00\uB828\uC788\uB294\uC9C0 **\uC2E0\uC911\uD558\uAC8C** \uD310\uB2E8\uD574\uB77C.

## \uC0C8 \uB178\uD2B8
\uC81C\uBAA9: {noteTitle}
\uD0A4\uC6CC\uB4DC: {noteKeywords}

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D
{projects}

## \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- \uB178\uD2B8\uC758 **\uD575\uC2EC \uC8FC\uC81C**\uAC00 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB420 \uB54C\uB9CC \uD504\uB85C\uC81D\uD2B8 \uC120\uD0DD
- \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
- **\uD655\uC2E4\uD558\uC9C0 \uC54A\uC73C\uBA74 "None" \uBC18\uD658** (\uC798\uBABB\uB41C \uBD84\uB958\uBCF4\uB2E4 \uB098\uC74C)
- \uC77C\uBC18\uC801\uC778 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 \u2192 "None"
- \uC0C8\uB85C\uC6B4 \uD504\uB85C\uC81D\uD2B8\uB85C \uBCF4\uC774\uBA74 "NEW: \uD504\uB85C\uC81D\uD2B8\uBA85" \uD615\uC2DD\uC73C\uB85C \uBC18\uD658

## \uCD9C\uB825 \uD615\uC2DD (\uD504\uB85C\uC81D\uD2B8\uBA85\uB9CC \uC751\uB2F5)
\uD504\uB85C\uC81D\uD2B8\uBA85 \uB610\uB294 None \uB610\uB294 NEW: \uC0C8\uD504\uB85C\uC81D\uD2B8\uBA85
`,vx=`\uC720\uD29C\uBE0C \uC601\uC0C1\uC758 \uC790\uB9C9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uC790\uB9C9 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,bx=`\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBCF8\uBB38 \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uAE00\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uAD11\uACE0\uB098 \uAD00\uB828 \uC5C6\uB294 \uB0B4\uC6A9\uC740 \uBB34\uC2DC\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,Ex=`\uB108\uB294 \uBA54\uBAA8\uB97C \uBD84\uC11D\uD558\uC5EC \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uBCC4\uB85C \uBD84\uB9AC\uD558\uB294 \uBE44\uC11C\uB2E4.
\uD558\uB098\uC758 \uBA54\uBAA8\uC5D0 \uC5EC\uB7EC \uC8FC\uC81C\uB098 \uD504\uB85C\uC81D\uD2B8 \uAD00\uB828 \uB0B4\uC6A9\uC774 \uC11E\uC5EC \uC788\uC744 \uC218 \uC788\uB2E4.
\uAC01\uAC01\uC744 \uB3C5\uB9BD\uC801\uC778 \uB178\uD2B8\uB85C \uBD84\uB9AC\uD574\uB77C.

## \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uBAA9\uB85D (\uCC38\uACE0\uC6A9)
{projects}

## \uBA54\uBAA8 \uB0B4\uC6A9
{content}

## \uBD84\uB9AC \uADDC\uCE59
- \uC11C\uB85C \uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8/\uC8FC\uC81C\uB294 \uBC18\uB4DC\uC2DC \uBD84\uB9AC\uD574\uB77C
- \uD55C \uC904\uC9DC\uB9AC \uBA54\uBAA8\uB3C4 \uC758\uBBF8\uAC00 \uC788\uC73C\uBA74 \uBD84\uB9AC \uB300\uC0C1\uC774\uB2E4
- \uAD00\uB828 \uB0B4\uC6A9\uC740 \uD558\uB098\uB85C \uBB36\uC5B4\uB77C (\uACFC\uB3C4\uD55C \uBD84\uB9AC \uAE08\uC9C0)
- \uAC01 \uC139\uC158\uC5D0 \uC801\uC808\uD55C \uC81C\uBAA9\uC744 \uBD99\uC5EC\uB77C

## \uBD84\uB958 \uADDC\uCE59 (\uC5C4\uACA9\uD558\uAC8C \uC801\uC6A9)
- **project**: \uAE30\uC874 \uD504\uB85C\uC81D\uD2B8\uC758 **\uD575\uC2EC \uBAA9\uD45C/\uD65C\uB3D9**\uACFC **\uC9C1\uC811** \uAD00\uB828\uB41C \uB0B4\uC6A9\uB9CC
  - \uB2E8\uC21C\uD788 \uD0A4\uC6CC\uB4DC\uAC00 \uACB9\uCE58\uB294 \uAC83\uC740 \uBD88\uCDA9\uBD84
  - \uC608: "\uC2A4\uB9C8\uD2B8\uD31C" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC788\uC5B4\uB3C4 "\uB18D\uC5C5 \uB274\uC2A4"\uB294 library
- **library**: \uC77C\uBC18 \uCC38\uACE0\uC790\uB8CC, \uB274\uC2A4, \uC815\uBCF4\uC131 \uCF58\uD150\uCE20 (**\uC560\uB9E4\uD558\uBA74 library**)
- **archive**: \uC644\uB8CC\uB41C \uB0B4\uC6A9, \uB354 \uC774\uC0C1 \uD544\uC694\uC5C6\uB294 \uAC83
- \uC0C8 \uD504\uB85C\uC81D\uD2B8: \uBA85\uD655\uD55C \uBAA9\uD45C\uAC00 \uC788\uB294 \uC0C8\uB85C\uC6B4 \uC791\uC5C5\uC77C \uB54C\uB9CC isNewProject: true

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4\uB85C \uC751\uB2F5)
[
  {
    "title": "\uBD84\uB9AC\uB41C \uC139\uC158\uC758 \uC81C\uBAA9",
    "content": "\uD574\uB2F9 \uC139\uC158\uC758 \uC6D0\uBCF8 \uB0B4\uC6A9 (\uC815\uB9AC\uD558\uC9C0 \uB9D0\uACE0 \uADF8\uB300\uB85C)",
    "targetType": "project",
    "projectName": "\uC2A4\uB9C8\uD2B8\uD31C",
    "isNewProject": false,
    "keywords": ["\uC13C\uC11C", "\uB370\uC774\uD130", "IoT"],
    "isAtomic": false
  }
]

\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC73C\uBA74 \uC804\uCCB4\uB97C \uD558\uB098\uC758 \uC139\uC158\uC73C\uB85C \uBC18\uD658\uD574\uB77C.
`,Sx=`\uC8FC\uC81C\uC5D0 \uC18D\uD55C ZK \uB178\uD2B8\uB4E4\uC744 \uBD84\uC11D\uD558\uC5EC \uAD6C\uC870\uD654\uB41C \uC124\uBA85\uC744 \uC0DD\uC131\uD574\uB77C.

## \uC8FC\uC81C
{topic}

## \uB178\uD2B8 \uBAA9\uB85D
{notes}

## \uADDC\uCE59
- \uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85 \uC791\uC131
- \uAC01 \uB178\uD2B8\uC758 \uC5ED\uD560/\uC704\uCE58 \uC124\uBA85 (\uAE30\uCD08, \uC2EC\uD654, \uC751\uC6A9, \uC608\uC2DC \uC911 \uD558\uB098)
- \uB178\uD2B8 \uAC04 \uAD00\uACC4 \uD45C\uC2DC (\uBC1C\uC804, \uAE30\uBC18, \uAD00\uB828 \uC911 \uD558\uB098)
- \uAD00\uB828 \uC8FC\uC81C 2-3\uAC1C \uC81C\uC548

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "description": "\uC8FC\uC81C\uC5D0 \uB300\uD55C 1-2\uC904 \uC124\uBA85",
  "notes": [
    {
      "title": "\uB178\uD2B8 \uC81C\uBAA9",
      "role": "\uAE30\uCD08",
      "relations": [{"target": "\uB2E4\uB978\uB178\uD2B8\uC81C\uBAA9", "type": "\uBC1C\uC804"}]
    }
  ],
  "relatedTopics": ["\uAD00\uB828\uC8FC\uC81C1", "\uAD00\uB828\uC8FC\uC81C2"]
}
`,wx=`PDF/\uC774\uBBF8\uC9C0 \uBB38\uC11C \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uC694\uC57D\uD574\uB77C.

## \uBB38\uC11C \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uBB38\uC11C\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD398\uC774\uC9C0 \uAD6C\uBD84\uC740 \uBB34\uC2DC\uD558\uACE0 \uC804\uCCB4 \uB0B4\uC6A9\uC744 \uD1B5\uD569\uD574\uC11C \uBD84\uC11D\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uBB38\uC11C \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}
`,Ax=`PDF/\uC774\uBBF8\uC9C0 \uBB38\uC11C \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uC0C1\uC138\uD558\uAC8C \uC694\uC57D\uD574\uB77C.

## \uBB38\uC11C \uB0B4\uC6A9
{content}

## \uADDC\uCE59
- \uBB38\uC11C\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 8-15\uBB38\uC7A5\uC73C\uB85C **\uC0C1\uC138\uD558\uAC8C** \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 10-20\uAC1C\uC758 bullet point\uB85C **\uBE60\uC9D0\uC5C6\uC774** \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uC138\uBD80 \uC0AC\uD56D, \uC608\uC2DC, \uC218\uCE58 \uB370\uC774\uD130\uAC00 \uC788\uC73C\uBA74 \uD3EC\uD568\uD574\uB77C
- \uD398\uC774\uC9C0 \uAD6C\uBD84\uC740 \uBB34\uC2DC\uD558\uACE0 \uC804\uCCB4 \uB0B4\uC6A9\uC744 \uD1B5\uD569\uD574\uC11C \uBD84\uC11D\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uBB38\uC11C \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "8-15\uBB38\uC7A5 \uC0C1\uC138 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ... (10-20\uAC1C)]
}
`,Cx=`\uD68C\uC758 \uB179\uC74C\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uC758\uB85D\uC744 \uC791\uC131\uD574\uB77C.

## \uADDC\uCE59
1. **\uC804\uC0AC(Transcription)**: \uC74C\uC131\uC744 \uD14D\uC2A4\uD2B8\uB85C \uBCC0\uD658. \uD654\uC790 \uAD6C\uBD84\uC774 \uAC00\uB2A5\uD558\uBA74 "\uD654\uC7901:", "\uD654\uC7902:" \uD615\uC2DD\uC73C\uB85C \uD45C\uC2DC
2. **\uC694\uC57D**: \uD68C\uC758 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
3. **\uC561\uC158 \uC544\uC774\uD15C**: \uB204\uAC00 \uBB34\uC5C7\uC744 \uC5B8\uC81C\uAE4C\uC9C0 \uD560\uC9C0 \uCD94\uCD9C. \uBA85\uC2DC\uB418\uC9C0 \uC54A\uC740 \uD56D\uBAA9\uC740 null
4. **\uACB0\uC815\uC0AC\uD56D**: \uD68C\uC758\uC5D0\uC11C \uACB0\uC815\uB41C \uC0AC\uD56D\uB4E4
5. **\uB2E4\uC74C \uD68C\uC758 \uC548\uAC74**: \uD6C4\uC18D \uB17C\uC758\uAC00 \uD544\uC694\uD55C \uC8FC\uC81C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD68C\uC758 \uC81C\uBAA9 (\uC8FC\uC81C \uAE30\uBC18\uC73C\uB85C \uC0DD\uC131)",
  "transcription": "\uC804\uCCB4 \uB300\uD654 \uB0B4\uC6A9 (\uD654\uC790 \uAD6C\uBD84 \uD3EC\uD568)",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "actionItems": [
    {"task": "\uD560 \uC77C", "assignee": "\uB2F4\uB2F9\uC790 \uB610\uB294 null", "deadline": "\uAE30\uD55C \uB610\uB294 null"}
  ],
  "decisions": ["\uACB0\uC815\uC0AC\uD56D1", "\uACB0\uC815\uC0AC\uD56D2"],
  "nextAgenda": ["\uB2E4\uC74C \uC548\uAC741", "\uB2E4\uC74C \uC548\uAC742"]
}

\uC561\uC158 \uC544\uC774\uD15C, \uACB0\uC815\uC0AC\uD56D, \uB2E4\uC74C \uC548\uAC74\uC774 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 []\uB85C \uBC18\uD658\uD574\uB77C.
`,Tx=`\uB108\uB294 \uB098\uC758 \uC0DD\uC0B0\uC131 \uCF54\uCE58\uB2E4.
\uC8FC\uC5B4\uC9C4 \uAE30\uAC04 \uB3D9\uC548\uC758 \uC791\uC5C5 \uB0B4\uC6A9\uC744 \uBD84\uC11D\uD558\uC5EC \uD68C\uACE0 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uB77C.

## \uAE30\uAC04
{period} ({dateRange})

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5 \uB0B4\uC6A9
{projectData}

## \uBD84\uC11D \uADDC\uCE59
1. \uC804\uCCB4 \uC694\uC57D: \uC774 \uAE30\uAC04\uC758 \uC791\uC5C5\uC744 2-3\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D
2. \uC8FC\uC694 \uC8FC\uC81C: \uB2E4\uB8EC \uD575\uC2EC \uC8FC\uC81C 3-5\uAC1C \uCD94\uCD9C
3. \uC778\uC0AC\uC774\uD2B8: \uBC1C\uACAC\uD55C \uC810, \uBC30\uC6B4 \uC810, \uD328\uD134 3-5\uAC1C
4. \uB2E4\uC74C \uC561\uC158: \uD6C4\uC18D\uC73C\uB85C \uD574\uC57C \uD560 \uAD6C\uCCB4\uC801\uC778 \uD589\uB3D9 3-5\uAC1C
5. \uC791\uC5C5 \uD328\uD134: \uC791\uC5C5 \uBC29\uC2DD\uC5D0\uC11C \uBC1C\uACAC\uB41C \uD328\uD134 (\uC120\uD0DD)

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "summary": "\uC804\uCCB4 \uC694\uC57D (2-3\uBB38\uC7A5)",
  "mainTopics": ["\uC8FC\uC81C1", "\uC8FC\uC81C2", "\uC8FC\uC81C3"],
  "insights": ["\uC778\uC0AC\uC774\uD2B81", "\uC778\uC0AC\uC774\uD2B82", "\uC778\uC0AC\uC774\uD2B83"],
  "nextActions": ["\uC561\uC1581", "\uC561\uC1582", "\uC561\uC1583"],
  "patterns": "\uC791\uC5C5 \uD328\uD134 \uBD84\uC11D (\uC120\uD0DD, \uC5C6\uC73C\uBA74 null)"
}
`,_x=`\uB178\uD2B8 \uB0B4\uC6A9\uC5D0\uC11C \uC77C\uC815/\uD560\uC77C/\uC57D\uC18D\uC744 \uCD94\uCD9C\uD574\uB77C.

## \uB178\uD2B8 \uB0B4\uC6A9
{content}

## \uC624\uB298 \uB0A0\uC9DC
{today}

## \uCD94\uCD9C \uADDC\uCE59
- \uB0A0\uC9DC/\uC2DC\uAC04\uC774 \uC5B8\uAE09\uB41C \uBAA8\uB4E0 \uC77C\uC815 \uCD94\uCD9C
- \uC0C1\uB300\uC801 \uB0A0\uC9DC\uB97C \uC808\uB300 \uB0A0\uC9DC\uB85C \uBCC0\uD658:
  - "\uB0B4\uC77C" \u2192 \uC624\uB298 + 1\uC77C
  - "\uBAA8\uB808" \u2192 \uC624\uB298 + 2\uC77C
  - "\uB2E4\uC74C \uC8FC \uC6D4\uC694\uC77C" \u2192 \uB2E4\uC74C \uC8FC \uC6D4\uC694\uC77C \uB0A0\uC9DC
  - "\uC774\uBC88 \uC8FC \uAE08\uC694\uC77C" \u2192 \uC774\uBC88 \uC8FC \uAE08\uC694\uC77C \uB0A0\uC9DC
  - "\uB2E4\uC74C \uB2EC" \u2192 \uB2E4\uC74C \uB2EC 1\uC77C
- \uC2DC\uAC04\uC774 \uC5C6\uC73C\uBA74 time\uC744 null\uB85C
- type \uAD6C\uBD84:
  - "event": \uC57D\uC18D, \uBBF8\uD305, \uD68C\uC758, \uBC1C\uD45C, \uBC29\uBB38 \uB4F1 \uD2B9\uC815 \uC2DC\uC810\uC758 \uD65C\uB3D9
  - "task": \uB9C8\uAC10\uC77C, \uC81C\uCD9C, \uC644\uB8CC\uD574\uC57C \uD560 \uC77C

## \uCD9C\uB825 \uD615\uC2DD (JSON \uBC30\uC5F4)
[
  {
    "title": "\uC77C\uC815 \uC81C\uBAA9",
    "date": "2026-01-15",
    "time": "14:00",
    "type": "event"
  },
  {
    "title": "\uBCF4\uACE0\uC11C \uC81C\uCD9C",
    "date": "2026-01-17",
    "time": null,
    "type": "task"
  }
]

\uC77C\uC815\uC774 \uC5C6\uC73C\uBA74 \uBE48 \uBC30\uC5F4 [] \uBC18\uD658.
`;var jO=1e3,dd=3,QE=2e3,le="gemini-3-flash-preview",eg=class{constructor(e){this.lastRequestTime=0;this.minDelayMs=jO;this.usageTracker=null;this.ai=new Jp({apiKey:e}),this.apiKey=e}setUsageTracker(e){this.usageTracker=e}recordUsage(e,t,n){if(!this.usageTracker)return;let s=t.usageMetadata;s&&this.usageTracker.recordUsage(e,s.promptTokenCount??0,s.candidatesTokenCount??0,n)}async waitForRateLimit(){let t=Date.now()-this.lastRequestTime;if(t<this.minDelayMs){let n=this.minDelayMs-t;await this.delay(n)}this.lastRequestTime=Date.now()}delay(e){return new Promise(t=>setTimeout(t,e))}async callWithRetry(e,t=dd){await this.waitForRateLimit();for(let n=0;n<=t;n++)try{return await e()}catch(s){if(s instanceof Error&&(s.message.includes("429")||s.message.includes("RESOURCE_EXHAUSTED")||s.message.includes("quota"))&&n<t){let o=QE*Math.pow(2,n);console.log(`Rate limit hit, retrying in ${o/1e3}s... (attempt ${n+1}/${t})`),await this.delay(o),this.minDelayMs=Math.min(this.minDelayMs*1.5,5e3)}else throw s}throw new Error("Max retries exceeded")}async classifyProject(e,t,n){let s=t.length>0?t.map((l,c)=>`${c+1}. ${l}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",r=ux.replace("{projects}",s).replace("{content}",e);n&&(r=r.replace("## \uCD9C\uB825 \uD615\uC2DD",`${n}

## \uCD9C\uB825 \uD615\uC2DD`));let o=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:r}));this.recordUsage("classify",o,le);let a=o.text??"";return this.parseProjectResponse(a)}async extractZK(e){let t=hx.replace("{content}",e),n=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:t}));this.recordUsage("zk",n,le);let s=n.text??"";return this.parseZKResponse(s)}async getFocus(e){let t=fx.replace("{projects}",e),n=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:t}));this.recordUsage("focus",n,le);let s=n.text??"";return this.parseFocusResponse(s)}parseProjectResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: JSON \uC5C6\uC74C");try{let n=JSON.parse(t[0]);return{targetType:this.validateTargetType(n.targetType),projectName:n.projectName||void 0,isNewProject:n.isNewProject??!1,title:n.title||"Untitled",summary:n.summary||"",nextAction:n.nextAction||null}}catch{throw new Error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328: "+e)}}parseZKResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{return JSON.parse(t[0]).map(s=>({title:s.title,body:s.body,keywords:s.keywords||[],importance:s.importance||"",relatedConcepts:s.relatedConcepts||[]}))}catch{return console.error("ZK \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}parseFocusResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{return JSON.parse(t[0]).map(s=>({title:s.title,why:s.why,nextAction:s.next_action}))}catch{return console.error("Focus \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async extractTextFromImage(e,t){let n=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:[{role:"user",parts:[{text:px},{inlineData:{mimeType:t,data:e}}]}]}));return this.recordUsage("ocr",n,le),n.text??""}async extractTextFromImages(e,t){let n=[];for(let s=0;s<e.length;s++){let r=e[s];t&&t(s+1,e.length);let o=await this.extractTextFromImage(r.base64,r.mimeType);n.push(o),s<e.length-1&&await this.delay(500)}return n}async extractKeywords(e){let t=gx.replace("{content}",e),n=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:t}));this.recordUsage("other",n,le);let s=n.text??"";return this.parseKeywordsResponse(s)}async findRelatedNotes(e,t,n){let s=mx.replace("{newTitle}",e).replace("{newKeywords}",t.join(", ")).replace("{candidates}",n),r=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:s}));this.recordUsage("related",r,le);let o=r.text??"";return this.parseRelatedNotesResponse(o)}async detectProject(e,t,n){if(n.length===0)return null;let s=yx.replace("{noteTitle}",e).replace("{noteKeywords}",t.join(", ")).replace("{projects}",n.map((l,c)=>`${c+1}. ${l}`).join(`
`)),r=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:s}));this.recordUsage("classify",r,le);let o=(r.text??"").trim();return o.toLowerCase()==="none"||o===""?null:o.startsWith("NEW:")?o:n.find(l=>o.toLowerCase().includes(l.toLowerCase()))||null}async summarizeContent(e,t){let s=(t==="youtube"?vx:bx).replace("{content}",e),r=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:s}));this.recordUsage(t,r,le);let o=r.text??"";return this.parseSummaryResponse(o)}async summarizePDF(e,t=!1){let s=(t?Ax:wx).replace("{content}",e),r=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:s}));this.recordUsage("ocr",r,le);let o=r.text??"";return this.parseSummaryResponse(o)}async analyzeYouTube(e){let t=`\uC774 YouTube \uC601\uC0C1\uC744 \uBD84\uC11D\uD574\uC8FC\uC138\uC694.

## \uADDC\uCE59
- \uC601\uC0C1\uC758 \uD575\uC2EC \uC8FC\uC81C\uB97C \uD30C\uC545\uD574\uB77C
- \uC8FC\uC694 \uB0B4\uC6A9\uC744 3-5\uBB38\uC7A5\uC73C\uB85C \uC694\uC57D\uD574\uB77C
- \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C 3-7\uAC1C\uC758 bullet point\uB85C \uC815\uB9AC\uD574\uB77C
- \uC804\uBB38 \uC6A9\uC5B4\uB098 \uC911\uC694\uD55C \uAC1C\uB150\uC740 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C
- \uD654\uBA74\uC5D0 \uBCF4\uC774\uB294 \uD14D\uC2A4\uD2B8, \uC2AC\uB77C\uC774\uB4DC, \uCF54\uB4DC \uB4F1\uB3C4 \uCC38\uACE0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uC601\uC0C1 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,n=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:[{role:"user",parts:[{fileData:{mimeType:"video/mp4",fileUri:e}},{text:t}]}]}));this.recordUsage("youtube",n,le);let s=n.text??"";return this.parseSummaryResponse(s)}async analyzeWebpage(e){let t=`\uB2E4\uC74C \uC6F9\uD398\uC774\uC9C0\uB97C \uBD84\uC11D\uD574\uC8FC\uC138\uC694: ${e}

## \uADDC\uCE59
- \uD398\uC774\uC9C0\uC758 \uD575\uC2EC \uB0B4\uC6A9\uC744 \uC815\uD655\uD788 \uD30C\uC545\uD574\uB77C
- \uACF5\uACE0/\uBAA8\uC9D1\uC774\uBA74: \uB300\uC0C1, \uC870\uAC74, \uAE30\uAC04, \uD61C\uD0DD\uC744 \uAD6C\uCCB4\uC801\uC73C\uB85C
- \uB274\uC2A4/\uAE30\uC0AC\uBA74: \uD575\uC2EC \uC0AC\uC2E4, \uBC30\uACBD, \uC758\uBBF8\uB97C
- \uC81C\uD488/\uC11C\uBE44\uC2A4\uBA74: \uC8FC\uC694 \uAE30\uB2A5, \uAC00\uACA9, \uD2B9\uC9D5\uC744
- \uC77C\uBC18 \uC815\uBCF4\uBA74: \uD575\uC2EC \uBA54\uC2DC\uC9C0\uC640 \uC911\uC694 \uC138\uBD80\uC0AC\uD56D\uC744
- \uC804\uBB38 \uC6A9\uC5B4, \uACE0\uC720\uBA85\uC0AC, \uC22B\uC790\uB294 \uADF8\uB300\uB85C \uC720\uC9C0\uD574\uB77C

## \uCD9C\uB825 \uD615\uC2DD (JSON\uC73C\uB85C \uC751\uB2F5)
{
  "title": "\uD398\uC774\uC9C0 \uB0B4\uC6A9\uC744 \uB300\uD45C\uD558\uB294 \uC81C\uBAA9",
  "summary": "3-5\uBB38\uC7A5 \uC694\uC57D (\uAD6C\uCCB4\uC801\uC778 \uC815\uBCF4 \uD3EC\uD568)",
  "keyPoints": ["\uD575\uC2EC \uD3EC\uC778\uD2B81", "\uD575\uC2EC \uD3EC\uC778\uD2B82", ...]
}`,n=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:t,config:{tools:[{urlContext:{}}]}}));this.recordUsage("webpage",n,le);let s=n.text??"";return this.parseSummaryResponse(s)}parseSummaryResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{title:"Untitled",summary:e.trim(),keyPoints:[]};try{let n=JSON.parse(t[0]);return{title:n.title||"Untitled",summary:n.summary||"",keyPoints:Array.isArray(n.keyPoints)?n.keyPoints:[]}}catch{return console.error("\uC694\uC57D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{title:"Untitled",summary:e.trim(),keyPoints:[]}}}parseKeywordsResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(s=>typeof s=="string"):[]}catch{return console.error("\uD0A4\uC6CC\uB4DC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}parseRelatedNotesResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(s=>typeof s=="object"&&typeof s.index=="number"&&typeof s.relevance=="number").filter(s=>s.relevance>=.5).sort((s,r)=>r.relevance-s.relevance).slice(0,5).map(s=>({index:s.index,relevance:s.relevance,reason:s.reason||"",type:s.type||""})):[]}catch{return console.error("\uAD00\uB828 \uB178\uD2B8 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async generateTopicStructure(e,t){let n=Sx.replace("{topic}",e).replace("{notes}",t),s=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:n}));this.recordUsage("zk",s,le);let r=s.text??"";return this.parseTopicStructureResponse(r)}parseTopicStructureResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{description:"",notes:[],relatedTopics:[]};try{let n=JSON.parse(t[0]);return{description:n.description||"",notes:Array.isArray(n.notes)?n.notes:[],relatedTopics:Array.isArray(n.relatedTopics)?n.relatedTopics:[]}}catch{return console.error("\uC8FC\uC81C \uAD6C\uC870 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{description:"",notes:[],relatedTopics:[]}}}async splitContent(e,t){let n=t.length>0?t.map((a,l)=>`${l+1}. ${a}`).join(`
`):"(\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 \uC5C6\uC74C)",s=Ex.replace("{projects}",n).replace("{content}",e),r=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:s}));this.recordUsage("split",r,le);let o=r.text??"";return this.parseSplitResponse(o)}parseSplitResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.map(s=>({title:s.title||"Untitled",content:s.content||"",targetType:this.validateTargetType(s.targetType),project:s.projectName||void 0,isNewProject:s.isNewProject??!1,keywords:Array.isArray(s.keywords)?s.keywords:[],isAtomic:s.isAtomic??!1})):[]}catch{return console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}validateTargetType(e){return["project","library","archive"].includes(e)?e:"library"}async analyzeReview(e,t,n){let r={today:"\uC624\uB298",week:"\uC774\uBC88 \uC8FC",month:"\uC774\uBC88 \uB2EC",custom:"\uC0AC\uC6A9\uC790 \uC9C0\uC815 \uAE30\uAC04"}[e]||"\uAE30\uAC04",o=`${Be(t.start,"auto")} ~ ${Be(t.end,"auto")}`,a=n.map(u=>{let p=u.notes.map(m=>`  - ${m.title}${m.summary?`: ${m.summary}`:""}`).join(`
`);return`### ${u.projectName} (${u.noteCount}\uAC1C)
${p}`}).join(`

`),l=Tx.replace("{period}",r).replace("{dateRange}",o).replace("{projectData}",a),c=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:l}));this.recordUsage("review",c,le);let d=c.text??"";return this.parseReviewAnalysisResponse(d)}parseReviewAnalysisResponse(e){let t=e.match(/\{[\s\S]*\}/);if(!t)return{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]};try{let n=JSON.parse(t[0]);return{summary:n.summary||"",mainTopics:Array.isArray(n.mainTopics)?n.mainTopics:[],insights:Array.isArray(n.insights)?n.insights:[],nextActions:Array.isArray(n.nextActions)?n.nextActions:[],patterns:n.patterns||void 0}}catch{return console.error("\uD68C\uACE0 \uBD84\uC11D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{summary:"\uBD84\uC11D \uACB0\uACFC\uB97C \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",mainTopics:[],insights:[],nextActions:[]}}}async analyzeMeeting(e,t,n){console.log("\uD68C\uC758 \uB179\uC74C \uC5C5\uB85C\uB4DC \uC911...",n);let s=await this.ai.files.upload({file:e,config:{mimeType:t}});console.log("\uC5C5\uB85C\uB4DC \uC644\uB8CC:",s.uri);let r=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:[{role:"user",parts:[{fileData:{fileUri:s.uri,mimeType:s.mimeType}},{text:Cx}]}]}));this.recordUsage("meeting",r,le);let o=r.text??"";return this.parseMeetingResponse(o,n)}parseMeetingResponse(e,t){let n=e.match(/\{[\s\S]*\}/);if(!n)return{title:"\uD68C\uC758\uB85D",transcription:e.trim(),summary:"",actionItems:[],decisions:[],nextAgenda:[],sourceFile:t};try{let s=JSON.parse(n[0]);return{title:s.title||"\uD68C\uC758\uB85D",transcription:s.transcription||"",summary:s.summary||"",actionItems:Array.isArray(s.actionItems)?s.actionItems.map(r=>({task:r.task||"",assignee:r.assignee||null,deadline:r.deadline||null})):[],decisions:Array.isArray(s.decisions)?s.decisions:[],nextAgenda:Array.isArray(s.nextAgenda)?s.nextAgenda:[],sourceFile:t}}catch{return console.error("\uD68C\uC758\uB85D \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),{title:"\uD68C\uC758\uB85D",transcription:e.trim(),summary:"",actionItems:[],decisions:[],nextAgenda:[],sourceFile:t}}}async detectSchedules(e,t){let n=_x.replace("{content}",e).replace("{today}",t),s=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:n}));this.recordUsage("schedule",s,le);let r=s.text??"";return this.parseSchedulesResponse(r)}parseSchedulesResponse(e){let t=e.match(/\[[\s\S]*\]/);if(!t)return[];try{let n=JSON.parse(t[0]);return Array.isArray(n)?n.filter(s=>typeof s=="object"&&typeof s.title=="string"&&typeof s.date=="string"&&(s.type==="event"||s.type==="task")).map(s=>({title:s.title,date:s.date,time:s.time||null,type:s.type})):[]}catch{return console.error("\uC77C\uC815 \uAC10\uC9C0 \uC751\uB2F5 \uD30C\uC2F1 \uC2E4\uD328:",e),[]}}async generateContent(e){let t=await this.callWithRetry(async()=>await this.ai.models.generateContent({model:le,contents:e}));this.recordUsage("chat",t,le);let n=t.text??"";if(!n)throw new Error("\uC751\uB2F5 \uC0DD\uC131 \uC2E4\uD328");return n.trim()}async generateEmbedding(e,t="document"){if(console.log(`[ZFB] generateEmbedding \uD638\uCD9C\uB428 (\uAC1C\uBCC4): taskType=${t}`),!e||e.trim().length===0)return[];let n=e.length>8e3?e.substring(0,8e3):e,s=t==="query"?"RETRIEVAL_QUERY":"RETRIEVAL_DOCUMENT",r=await this.callWithRetry(async()=>await this.ai.models.embedContent({model:"gemini-embedding-001",contents:[{parts:[{text:n}]}],config:{taskType:s,outputDimensionality:768}}));if(this.usageTracker){let o=Math.ceil(n.length/4);this.usageTracker.recordUsage("embedding",o,0,"gemini-embedding-001")}return r.embeddings&&r.embeddings.length>0?r.embeddings[0].values||[]:[]}async batchGenerateEmbeddings(e,t){if(e.length===0)return[];let n=100,s=[],r=0;for(let o=0;o<e.length;o+=n){let a=e.slice(o,Math.min(o+n,e.length)),l=await this.executeBatchEmbedding(a);s.push(...l),r+=a.length,t&&t(r,e.length),o+n<e.length&&await this.delay(100)}return s}async executeBatchEmbedding(e){console.log(`[ZFB] executeBatchEmbedding \uD638\uCD9C\uB428: ${e.length}\uAC1C \uD14D\uC2A4\uD2B8`);let t=e.map(s=>!s||s.trim().length===0?" ":s.length>8e3?s.substring(0,8e3):s),n={requests:t.map(s=>({model:"models/gemini-embedding-001",content:{parts:[{text:s}]},taskType:"RETRIEVAL_DOCUMENT",outputDimensionality:768}))};for(let s=0;s<=dd;s++)try{await this.waitForRateLimit();let r=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-embedding-001:batchEmbedContents",{method:"POST",headers:{"x-goog-api-key":this.apiKey,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){let a=await r.text();if(r.status===429&&s<dd){let l=QE*Math.pow(2,s);console.log(`Rate limit hit, retrying in ${l/1e3}s... (attempt ${s+1}/${dd})`),await this.delay(l);continue}throw new Error(`HTTP ${r.status}: ${a}`)}let o=await r.json();if(this.usageTracker){let a=t.reduce((l,c)=>l+Math.ceil(c.length/4),0);this.usageTracker.recordUsage("embedding",a,0,"gemini-embedding-001")}return o.embeddings&&o.embeddings.length>0?o.embeddings.map(a=>a.values||[]):e.map(()=>[])}catch(r){if(s===dd)return console.error("\uBC30\uCE58 \uC784\uBCA0\uB529 \uC2E4\uD328:",r),e.map(()=>[]);let o=QE*Math.pow(2,s);console.log(`Embedding error, retrying in ${o/1e3}s...`),await this.delay(o)}return e.map(()=>[])}async parallelBatchEmbeddings(e,t=3,n){if(e.length===0)return[];let s=100,r=[];for(let c=0;c<e.length;c+=s)r.push(e.slice(c,Math.min(c+s,e.length)));let o=new Array(e.length),a=0,l=async c=>{let d=r[c],u=c*s,p=await this.executeBatchEmbedding(d);for(let m=0;m<p.length;m++)o[u+m]=p[m];if(a++,n){let m=Math.min(a*s,e.length);n(m,e.length)}};for(let c=0;c<r.length;c+=t){let d=[];for(let u=c;u<Math.min(c+t,r.length);u++)d.push(l(u));await Promise.all(d),c+t<r.length&&await this.delay(200)}return o}};var ov=require("obsidian");var KU={};var Id={};Id.d=(i,e)=>{for(var t in e)Id.o(e,t)&&!Id.o(i,t)&&Object.defineProperty(i,t,{enumerable:!0,get:e[t]})};Id.o=(i,e)=>Object.prototype.hasOwnProperty.call(i,e);var X=globalThis.pdfjsLib={};Id.d(X,{AbortException:()=>Si,AnnotationEditorLayer:()=>pA,AnnotationEditorParamsType:()=>re,AnnotationEditorType:()=>Z,AnnotationEditorUIManager:()=>da,AnnotationLayer:()=>Ww,AnnotationMode:()=>Ds,ColorPicker:()=>cm,DOMSVGFactory:()=>Vd,DrawLayer:()=>yA,FeatureTest:()=>st,GlobalWorkerOptions:()=>qn,ImageKind:()=>og,InvalidPDFException:()=>Nd,MissingPDFException:()=>aa,OPS:()=>Mn,OutputScale:()=>Od,PDFDataRangeTransport:()=>Zg,PDFDateString:()=>Pd,PDFWorker:()=>tl,PasswordResponses:()=>iU,PermissionFlag:()=>nU,PixelsPerInch:()=>fr,RenderingCancelledException:()=>Ld,TextLayer:()=>Hd,TouchManager:()=>Hg,UnexpectedResponseException:()=>Pc,Util:()=>V,VerbosityLevel:()=>Jy,XfaLayer:()=>em,build:()=>WU,createValidAbsoluteUrl:()=>aU,fetchData:()=>ev,getDocument:()=>$U,getFilenameFromUrl:()=>gU,getPdfFilenameFromUrl:()=>mU,getXfaPageViewport:()=>yU,isDataScheme:()=>tv,isPdfFile:()=>wA,noContextMenu:()=>Yn,normalizeUnicode:()=>hU,setLayerDimensions:()=>la,shadow:()=>ie,stopEvent:()=>nn,version:()=>zU});var yt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),$x=[1,0,0,1,0,0],rS=[.001,0,0,.001,0,0],QO=1e7,rg=1.35,eU=.35,S2=eU/rg,tn={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ds={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},tU="pdfjs_internal_editor_",Z={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},re={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},nU={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ct={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},og={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},He={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var ud={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var Jy={ERRORS:0,WARNINGS:1,INFOS:5},Mn={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},iU={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},Zy=Jy.WARNINGS;function sU(i){Number.isInteger(i)&&(Zy=i)}function rU(){return Zy}function jy(i){Zy>=Jy.INFOS&&console.log(`Info: ${i}`)}function j(i){Zy>=Jy.WARNINGS&&console.log(`Warning: ${i}`)}function me(i){throw new Error(i)}function Le(i,e){i||me(e)}function oU(i){switch(i?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function aU(i,e=null,t=null){if(!i)return null;try{if(t&&typeof i=="string"&&(t.addDefaultProtocol&&i.startsWith("www.")&&i.match(/\./g)?.length>=2&&(i=`http://${i}`),t.tryConvertEncoding))try{i=uU(i)}catch{}let n=e?new URL(i,e):new URL(i);if(oU(n))return n}catch{}return null}function ie(i,e,t,n=!1){return Object.defineProperty(i,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}var pr=function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}(),Lg=class extends pr{constructor(e,t){super(e,"PasswordException"),this.code=t}},Md=class extends pr{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},Nd=class extends pr{constructor(e){super(e,"InvalidPDFException")}},aa=class extends pr{constructor(e){super(e,"MissingPDFException")}},Pc=class extends pr{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},oS=class extends pr{constructor(e){super(e,"FormatError")}},Si=class extends pr{constructor(e){super(e,"AbortException")}};function Vx(i){(typeof i!="object"||i?.length===void 0)&&me("Invalid argument for bytesToString");let e=i.length,t=8192;if(e<t)return String.fromCharCode.apply(null,i);let n=[];for(let s=0;s<e;s+=t){let r=Math.min(s+t,e),o=i.subarray(s,r);n.push(String.fromCharCode.apply(null,o))}return n.join("")}function Qy(i){typeof i!="string"&&me("Invalid argument for stringToBytes");let e=i.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=i.charCodeAt(n)&255;return t}function lU(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255)}function EA(i){let e=Object.create(null);for(let[t,n]of i)e[t]=n;return e}function cU(){let i=new Uint8Array(4);return i[0]=1,new Uint32Array(i.buffer,0,1)[0]===1}function dU(){try{return new Function(""),!0}catch{return!1}}var st=class{static get isLittleEndian(){return ie(this,"isLittleEndian",cU())}static get isEvalSupported(){return ie(this,"isEvalSupported",dU())}static get isOffscreenCanvasSupported(){return ie(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return ie(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?ie(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent=="string"&&navigator.userAgent.includes("Firefox")}):ie(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return ie(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}},eS=Array.from(Array(256).keys(),i=>i.toString(16).padStart(2,"0")),nl,ag,Yd,aS,V=class{static makeHexColor(e,t,n){return`#${eS[e]}${eS[t]}${eS[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){let n=e[0]*t[0]+e[1]*t[2]+t[4],s=e[0]*t[1]+e[1]*t[3]+t[5];return[n,s]}static applyInverseTransform(e,t){let n=t[0]*t[3]-t[1]*t[2],s=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[s,r]}static getAxialAlignedBoundingBox(e,t){let n=this.applyTransform(e,t),s=this.applyTransform(e.slice(2,4),t),r=this.applyTransform([e[0],e[3]],t),o=this.applyTransform([e[2],e[1]],t);return[Math.min(n[0],s[0],r[0],o[0]),Math.min(n[1],s[1],r[1],o[1]),Math.max(n[0],s[0],r[0],o[0]),Math.max(n[1],s[1],r[1],o[1])]}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){let t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],s=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],a=(n+o)/2,l=Math.sqrt((n+o)**2-4*(n*o-r*s))/2,c=a+l||1,d=a-l||1;return[Math.sqrt(c),Math.sqrt(d)]}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>s)return null;let r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[n,r,s,o]}static bezierBoundingBox(e,t,n,s,r,o,a,l,c){return c?(c[0]=Math.min(c[0],e,a),c[1]=Math.min(c[1],t,l),c[2]=Math.max(c[2],e,a),c[3]=Math.max(c[3],t,l)):c=[Math.min(e,a),Math.min(t,l),Math.max(e,a),Math.max(t,l)],A(this,Yd,aS).call(this,e,n,r,a,t,s,o,l,3*(-e+3*(n-r)+a),6*(e-2*n+r),3*(n-e),c),A(this,Yd,aS).call(this,e,n,r,a,t,s,o,l,3*(-t+3*(s-o)+l),6*(t-2*s+o),3*(s-t),c),c}};nl=new WeakSet,ag=function(e,t,n,s,r,o,a,l,c,d){if(c<=0||c>=1)return;let u=1-c,p=c*c,m=p*c,y=u*(u*(u*e+3*c*t)+3*p*n)+m*s,v=u*(u*(u*r+3*c*o)+3*p*a)+m*l;d[0]=Math.min(d[0],y),d[1]=Math.min(d[1],v),d[2]=Math.max(d[2],y),d[3]=Math.max(d[3],v)},Yd=new WeakSet,aS=function(e,t,n,s,r,o,a,l,c,d,u,p){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&A(this,nl,ag).call(this,e,t,n,s,r,o,a,l,-u/d,p);return}let m=d**2-4*u*c;if(m<0)return;let y=Math.sqrt(m),v=2*c;A(this,nl,ag).call(this,e,t,n,s,r,o,a,l,(-d+y)/v,p),A(this,nl,ag).call(this,e,t,n,s,r,o,a,l,(-d-y)/v,p)},E(V,nl),E(V,Yd);function uU(i){return decodeURIComponent(escape(i))}var tS=null,xx=null;function hU(i){return tS||(tS=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,xx=new Map([["\uFB05","\u017Ft"]])),i.replaceAll(tS,(e,t,n)=>t?t.normalize("NFKC"):xx.get(n))}function fU(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let i=new Uint8Array(32);return crypto.getRandomValues(i),Vx(i)}var SA="pdfjs_internal_id_";function pU(i){return Uint8Array.prototype.toBase64?i.toBase64():btoa(Vx(i))}typeof Promise.try!="function"&&(Promise.try=function(i,...e){return new Promise(t=>{t(i(...e))})});var Oi="http://www.w3.org/2000/svg",Hr=class Hr{};Y(Hr,"CSS",96),Y(Hr,"PDF",72),Y(Hr,"PDF_TO_CSS_UNITS",Hr.CSS/Hr.PDF);var fr=Hr;async function ev(i,e="text"){if(gd(i,document.baseURI)){let t=await fetch(i);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{let s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}n(new Error(s.statusText))}},s.send(null)})}var Fd=class i{constructor({viewBox:e,userUnit:t,scale:n,rotation:s,offsetX:r=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=s,this.offsetX=r,this.offsetY=o,n*=t;let l=(e[2]+e[0])/2,c=(e[3]+e[1])/2,d,u,p,m;switch(s%=360,s<0&&(s+=360),s){case 180:d=-1,u=0,p=0,m=1;break;case 90:d=0,u=1,p=1,m=0;break;case 270:d=0,u=-1,p=-1,m=0;break;case 0:d=1,u=0,p=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(p=-p,m=-m);let y,v,b,S;d===0?(y=Math.abs(c-e[1])*n+r,v=Math.abs(l-e[0])*n+o,b=(e[3]-e[1])*n,S=(e[2]-e[0])*n):(y=Math.abs(l-e[0])*n+r,v=Math.abs(c-e[1])*n+o,b=(e[2]-e[0])*n,S=(e[3]-e[1])*n),this.transform=[d*n,u*n,p*n,m*n,y-d*n*l-p*n*c,v-u*n*l-m*n*c],this.width=b,this.height=S}get rawDims(){let{userUnit:e,viewBox:t}=this,n=t.map(s=>s*e);return ie(this,"rawDims",{pageWidth:n[2]-n[0],pageHeight:n[3]-n[1],pageX:n[0],pageY:n[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:r=!1}={}){return new i({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}convertToViewportPoint(e,t){return V.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){let t=V.applyTransform([e[0],e[1]],this.transform),n=V.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return V.applyInverseTransform([e,t],this.transform)}},Ld=class extends pr{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}};function tv(i){let e=i.length,t=0;for(;t<e&&i[t].trim()==="";)t++;return i.substring(t,t+5).toLowerCase()==="data:"}function wA(i){return typeof i=="string"&&/\.pdf$/i.test(i)}function gU(i){return[i]=i.split(/[#?]/,1),i.substring(i.lastIndexOf("/")+1)}function mU(i,e="document.pdf"){if(typeof i!="string")return e;if(tv(i))return j('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;let t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=t.exec(i),r=n.exec(s[1])||n.exec(s[2])||n.exec(s[3]);if(r&&(r=r[0],r.includes("%")))try{r=n.exec(decodeURIComponent(r))[0]}catch{}return r||e}var Og=class{constructor(){Y(this,"started",Object.create(null));Y(this,"times",[])}time(e){e in this.started&&j(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||j(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:n}of this.times)t=Math.max(n.length,t);for(let{name:n,start:s,end:r}of this.times)e.push(`${n.padEnd(t)} ${r-s}ms
`);return e.join("")}};function gd(i,e){try{let{protocol:t}=e?new URL(i,e):new URL(i);return t==="http:"||t==="https:"}catch{return!1}}function Yn(i){i.preventDefault()}function nn(i){i.preventDefault(),i.stopPropagation()}var Kd,Pd=class{static toDateObject(e){if(!e||typeof e!="string")return null;h(this,Kd)||w(this,Kd,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let t=h(this,Kd).exec(e);if(!t)return null;let n=parseInt(t[1],10),s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;let c=t[7]||"Z",d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let u=parseInt(t[9],10)||0;return u=u>=0&&u<=59?u:0,c==="-"?(o+=d,a+=u):c==="+"&&(o-=d,a-=u),new Date(Date.UTC(n,s,r,o,a,l))}};Kd=new WeakMap,E(Pd,Kd,void 0);function yU(i,{scale:e=1,rotation:t=0}){let{width:n,height:s}=i.attributes.style,r=[0,0,parseInt(n),parseInt(s)];return new Fd({viewBox:r,userUnit:1,scale:e,rotation:t})}function AA(i){if(i.startsWith("#")){let e=parseInt(i.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return i.startsWith("rgb(")?i.slice(4,-1).split(",").map(e=>parseInt(e)):i.startsWith("rgba(")?i.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(j(`Not a valid color format: "${i}"`),[0,0,0])}function vU(i){let e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(let t of i.keys()){e.style.color=t;let n=window.getComputedStyle(e).color;i.set(t,AA(n))}e.remove()}function Se(i){let{a:e,b:t,c:n,d:s,e:r,f:o}=i.getTransform();return[e,t,n,s,r,o]}function ei(i){let{a:e,b:t,c:n,d:s,e:r,f:o}=i.getTransform().invertSelf();return[e,t,n,s,r,o]}function la(i,e,t=!1,n=!0){if(e instanceof Fd){let{pageWidth:s,pageHeight:r}=e.rawDims,{style:o}=i,a=st.isCSSRoundSupported,l=`var(--scale-factor) * ${s}px`,c=`var(--scale-factor) * ${r}px`,d=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,u=a?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!t||e.rotation%180===0?(o.width=d,o.height=u):(o.width=u,o.height=d)}n&&i.setAttribute("data-main-rotation",e.rotation)}var Od=class{constructor(){let e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},Is,Gr,Pn,zr,Xd,Jd,hm,Gx,fm,zx,pm,Wx,il,lg,gm,qx,Zd,cS,Hi=class Hi{constructor(e){E(this,fm);E(this,pm);E(this,il);E(this,gm);E(this,Zd);E(this,Is,null);E(this,Gr,null);E(this,Pn,void 0);E(this,zr,null);E(this,Xd,null);w(this,Pn,e),h(Hi,Jd)||w(Hi,Jd,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){let e=w(this,Is,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");let t=h(this,Pn)._uiManager._signal;e.addEventListener("contextmenu",Yn,{signal:t}),e.addEventListener("pointerdown",A(Hi,hm,Gx),{signal:t});let n=w(this,zr,document.createElement("div"));n.className="buttons",e.append(n);let s=h(this,Pn).toolbarPosition;if(s){let{style:r}=e,o=h(this,Pn)._uiManager.direction==="ltr"?1-s[0]:s[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return A(this,gm,qx).call(this),e}get div(){return h(this,Is)}hide(){h(this,Is).classList.add("hidden"),h(this,Gr)?.hideDropdown()}show(){h(this,Is).classList.remove("hidden"),h(this,Xd)?.shown()}async addAltText(e){let t=await e.render();A(this,il,lg).call(this,t),h(this,zr).prepend(t,h(this,Zd,cS)),w(this,Xd,e)}addColorPicker(e){w(this,Gr,e);let t=e.renderButton();A(this,il,lg).call(this,t),h(this,zr).prepend(t,h(this,Zd,cS))}remove(){h(this,Is).remove(),h(this,Gr)?.destroy(),w(this,Gr,null)}};Is=new WeakMap,Gr=new WeakMap,Pn=new WeakMap,zr=new WeakMap,Xd=new WeakMap,Jd=new WeakMap,hm=new WeakSet,Gx=function(e){e.stopPropagation()},fm=new WeakSet,zx=function(e){h(this,Pn)._focusEventsAllowed=!1,nn(e)},pm=new WeakSet,Wx=function(e){h(this,Pn)._focusEventsAllowed=!0,nn(e)},il=new WeakSet,lg=function(e){let t=h(this,Pn)._uiManager._signal;e.addEventListener("focusin",A(this,fm,zx).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",A(this,pm,Wx).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Yn,{signal:t})},gm=new WeakSet,qx=function(){let{editorType:e,_uiManager:t}=h(this,Pn),n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",h(Hi,Jd)[e]),A(this,il,lg).call(this,n),n.addEventListener("click",s=>{t.delete()},{signal:t._signal}),h(this,zr).append(n)},Zd=new WeakSet,cS=function(){let e=document.createElement("div");return e.className="divider",e},E(Hi,hm),E(Hi,Jd,null);var lS=Hi,jd,Wr,qr,mm,Yx,ym,Kx,vm,Xx,dS=class{constructor(e){E(this,mm);E(this,ym);E(this,vm);E(this,jd,null);E(this,Wr,null);E(this,qr,void 0);w(this,qr,e)}show(e,t,n){let[s,r]=A(this,ym,Kx).call(this,t,n),{style:o}=h(this,Wr)||w(this,Wr,A(this,mm,Yx).call(this));e.append(h(this,Wr)),o.insetInlineEnd=`${100*s}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){h(this,Wr).remove()}};jd=new WeakMap,Wr=new WeakMap,qr=new WeakMap,mm=new WeakSet,Yx=function(){let e=w(this,Wr,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Yn,{signal:h(this,qr)._signal});let t=w(this,jd,document.createElement("div"));return t.className="buttons",e.append(t),A(this,vm,Xx).call(this),e},ym=new WeakSet,Kx=function(e,t){let n=0,s=0;for(let r of e){let o=r.y+r.height;if(o<n)continue;let a=r.x+(t?r.width:0);if(o>n){s=a,n=o;continue}t?a>s&&(s=a):a<s&&(s=a)}return[t?1-s:s,n]},vm=new WeakSet,Xx=function(){let e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let n=h(this,qr)._signal;e.addEventListener("contextmenu",Yn,{signal:n}),e.addEventListener("click",()=>{h(this,qr).highlightSelection("floating_button")},{signal:n}),h(this,jd).append(e)};function Ug(i,e,t){for(let n of t)e.addEventListener(n,i[n].bind(i))}var bm,uS=class{constructor(){E(this,bm,0)}get id(){return`${tU}${bt(this,bm)._++}`}};bm=new WeakMap;var sl,Qd,ht,rl,cg,CA=class CA{constructor(){E(this,rl);E(this,sl,fU());E(this,Qd,0);E(this,ht,null)}static get _isSVGFittingCanvas(){let e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;let r=s.decode().then(()=>(n.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return ie(this,"_isSVGFittingCanvas",r)}async getFromFile(e){let{lastModified:t,name:n,size:s,type:r}=e;return A(this,rl,cg).call(this,`${t}_${n}_${s}_${r}`,e)}async getFromUrl(e){return A(this,rl,cg).call(this,e,e)}async getFromBlob(e,t){let n=await t;return A(this,rl,cg).call(this,e,n)}async getFromId(e){h(this,ht)||w(this,ht,new Map);let t=h(this,ht).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){let{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){h(this,ht)||w(this,ht,new Map);let n=h(this,ht).get(e);if(n?.bitmap)return n.refCounter+=1,n;let s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),n={bitmap:s.transferToImageBitmap(),id:`image_${h(this,sl)}_${bt(this,Qd)._++}`,refCounter:1,isSvg:!1},h(this,ht).set(e,n),h(this,ht).set(n.id,n),n}getSvgUrl(e){let t=h(this,ht).get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){h(this,ht)||w(this,ht,new Map);let t=h(this,ht).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;let{bitmap:n}=t;if(!t.url&&!t.file){let s=new OffscreenCanvas(n.width,n.height);s.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=s.convertToBlob()}n.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${h(this,sl)}_`)}};sl=new WeakMap,Qd=new WeakMap,ht=new WeakMap,rl=new WeakSet,cg=async function(e,t){h(this,ht)||w(this,ht,new Map);let n=h(this,ht).get(e);if(n===null)return null;if(n?.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${h(this,sl)}_${bt(this,Qd)._++}`,refCounter:0,isSvg:!1});let s;if(typeof t=="string"?(n.url=t,s=await ev(t,"blob")):t instanceof File?s=n.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){let r=CA._isSVGFittingCanvas,o=new FileReader,a=new Image,l=new Promise((c,d)=>{a.onload=()=>{n.bitmap=a,n.isSvg=!0,c()},o.onload=async()=>{let u=n.svgUrl=o.result;a.src=await r?`${u}#svgView(preserveAspectRatio(none))`:u},a.onerror=o.onerror=d});o.readAsDataURL(s),await l}else n.bitmap=await createImageBitmap(s);n.refCounter=1}catch(s){j(s),n=null}return h(this,ht).set(e,n),n&&h(this,ht).set(n.id,n),n};var hS=CA,De,Ms,eu,Ae,fS=class{constructor(e=128){E(this,De,[]);E(this,Ms,!1);E(this,eu,void 0);E(this,Ae,-1);w(this,eu,e)}add({cmd:e,undo:t,post:n,mustExec:s,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(s&&e(),h(this,Ms))return;let l={cmd:e,undo:t,post:n,type:r};if(h(this,Ae)===-1){h(this,De).length>0&&(h(this,De).length=0),w(this,Ae,0),h(this,De).push(l);return}if(o&&h(this,De)[h(this,Ae)].type===r){a&&(l.undo=h(this,De)[h(this,Ae)].undo),h(this,De)[h(this,Ae)]=l;return}let c=h(this,Ae)+1;c===h(this,eu)?h(this,De).splice(0,1):(w(this,Ae,c),c<h(this,De).length&&h(this,De).splice(c)),h(this,De).push(l)}undo(){if(h(this,Ae)===-1)return;w(this,Ms,!0);let{undo:e,post:t}=h(this,De)[h(this,Ae)];e(),t?.(),w(this,Ms,!1),w(this,Ae,h(this,Ae)-1)}redo(){if(h(this,Ae)<h(this,De).length-1){w(this,Ae,h(this,Ae)+1),w(this,Ms,!0);let{cmd:e,post:t}=h(this,De)[h(this,Ae)];e(),t?.(),w(this,Ms,!1)}}hasSomethingToUndo(){return h(this,Ae)!==-1}hasSomethingToRedo(){return h(this,Ae)<h(this,De).length-1}cleanType(e){if(h(this,Ae)!==-1){for(let t=h(this,Ae);t>=0;t--)if(h(this,De)[t].type!==e){h(this,De).splice(t+1,h(this,Ae)-t),w(this,Ae,t);return}h(this,De).length=0,w(this,Ae,-1)}}destroy(){w(this,De,null)}};De=new WeakMap,Ms=new WeakMap,eu=new WeakMap,Ae=new WeakMap;var Em,Jx,ca=class{constructor(e){E(this,Em);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=st.platform;for(let[n,s,r={}]of e)for(let o of n){let a=o.startsWith("mac+");t&&a?(this.callbacks.set(o.slice(4),{callback:s,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!a&&(this.callbacks.set(o,{callback:s,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;let n=this.callbacks.get(A(this,Em,Jx).call(this,t));if(!n)return;let{callback:s,options:{bubbles:r=!1,args:o=[],checker:a=null}}=n;a&&!a(e,t)||(s.bind(e,...o,t)(),r||nn(t))}};Em=new WeakSet,Jx=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let t=this.buffer.join("+");return this.buffer.length=0,t};var Sm=class Sm{get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return vU(e),ie(this,"_colors",e)}convert(e){let t=AA(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(let[n,s]of this._colors)if(s.every((r,o)=>r===t[o]))return Sm._colorsMapping.get(n);return t}getHexCode(e){let t=this._colors.get(e);return t?V.makeHexColor(...t):e}};Y(Sm,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var pS=Sm,ol,Gt,$e,je,al,Vi,ll,fn,Ps,Yr,cl,Kr,ii,kn,Xr,tu,nu,dl,iu,si,ks,ul,Ns,ri,wm,Fs,su,Ls,Jr,ru,ou,We,fe,Gi,Zr,au,lu,Os,oi,zi,cu,pn,hl,dg,du,gS,Am,Zx,Cm,jx,fl,ug,Tm,Qx,_m,eR,xm,tR,uu,mS,Rm,nR,hu,yS,fu,vS,Dm,iR,Qe,St,Nn,Ui,Im,sR,Mm,rR,pu,bS,Pm,oR,jr,md,gu,ES,ja=class ja{constructor(e,t,n,s,r,o,a,l,c,d,u,p,m){E(this,hl);E(this,du);E(this,Am);E(this,Cm);E(this,fl);E(this,Tm);E(this,_m);E(this,xm);E(this,uu);E(this,Rm);E(this,hu);E(this,fu);E(this,Dm);E(this,Qe);E(this,Nn);E(this,Im);E(this,Mm);E(this,pu);E(this,Pm);E(this,jr);E(this,gu);E(this,ol,new AbortController);E(this,Gt,null);E(this,$e,new Map);E(this,je,new Map);E(this,al,null);E(this,Vi,null);E(this,ll,null);E(this,fn,new fS);E(this,Ps,null);E(this,Yr,null);E(this,cl,0);E(this,Kr,new Set);E(this,ii,null);E(this,kn,null);E(this,Xr,new Set);Y(this,"_editorUndoBar",null);E(this,tu,!1);E(this,nu,!1);E(this,dl,!1);E(this,iu,null);E(this,si,null);E(this,ks,null);E(this,ul,null);E(this,Ns,!1);E(this,ri,null);E(this,wm,new uS);E(this,Fs,!1);E(this,su,!1);E(this,Ls,null);E(this,Jr,null);E(this,ru,null);E(this,ou,null);E(this,We,Z.NONE);E(this,fe,new Set);E(this,Gi,null);E(this,Zr,null);E(this,au,null);E(this,lu,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});E(this,Os,[0,0]);E(this,oi,null);E(this,zi,null);E(this,cu,null);E(this,pn,null);let y=this._signal=h(this,ol).signal;w(this,zi,e),w(this,cu,t),w(this,al,n),this._eventBus=s,s._on("editingaction",this.onEditingAction.bind(this),{signal:y}),s._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),s._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),s._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),s._on("setpreference",this.onSetPreference.bind(this),{signal:y}),s._on("switchannotationeditorparams",v=>this.updateParams(v.type,v.value),{signal:y}),A(this,Tm,Qx).call(this),A(this,Dm,iR).call(this),A(this,uu,mS).call(this),w(this,Vi,r.annotationStorage),w(this,iu,r.filterFactory),w(this,Zr,o),w(this,ul,a||null),w(this,tu,l),w(this,nu,c),w(this,dl,d),w(this,ou,u||null),this.viewParameters={realScale:fr.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=p||null,this._supportsPinchToZoom=m!==!1}static get _keyboardManager(){let e=ja.prototype,t=o=>h(o,zi).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),n=(o,{target:a})=>{if(a instanceof HTMLInputElement){let{type:l}=a;return l!=="text"&&l!=="number"}return!0},s=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return ie(this,"_keyboardManager",new ca([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&h(o,zi).contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&h(o,zi).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){h(this,pn)?.resolve(),w(this,pn,null),h(this,ol)?.abort(),w(this,ol,null),this._signal=null;for(let e of h(this,je).values())e.destroy();h(this,je).clear(),h(this,$e).clear(),h(this,Xr).clear(),w(this,Gt,null),h(this,fe).clear(),h(this,fn).destroy(),h(this,al)?.destroy(),h(this,ri)?.hide(),w(this,ri,null),h(this,si)&&(clearTimeout(h(this,si)),w(this,si,null)),h(this,oi)&&(clearTimeout(h(this,oi)),w(this,oi,null)),this._editorUndoBar?.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return h(this,ou)}get useNewAltTextFlow(){return h(this,nu)}get useNewAltTextWhenAddingImage(){return h(this,dl)}get hcmFilter(){return ie(this,"hcmFilter",h(this,Zr)?h(this,iu).addHCMFilter(h(this,Zr).foreground,h(this,Zr).background):"none")}get direction(){return ie(this,"direction",getComputedStyle(h(this,zi)).direction)}get highlightColors(){return ie(this,"highlightColors",h(this,ul)?new Map(h(this,ul).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return ie(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),w(this,Yr,e)}setMainHighlightColorPicker(e){w(this,ru,e)}editAltText(e,t=!1){h(this,al)?.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":w(this,dl,t);break}}onPageChanging({pageNumber:e}){w(this,cl,e-1)}focusMainContainer(){h(this,zi).focus()}findParent(e,t){for(let n of h(this,je).values()){let{x:s,y:r,width:o,height:a}=n.div.getBoundingClientRect();if(e>=s&&e<=s+o&&t>=r&&t<=r+a)return n}return null}disableUserSelect(e=!1){h(this,cu).classList.toggle("noUserSelect",e)}addShouldRescale(e){h(this,Xr).add(e)}removeShouldRescale(e){h(this,Xr).delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*fr.PDF_TO_CSS_UNITS;for(let t of h(this,Xr))t.onScaleChanging();h(this,Yr)?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){let t=document.getSelection();if(!t||t.isCollapsed)return;let{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}=t,a=t.toString(),c=A(this,hl,dg).call(this,t).closest(".textLayer"),d=this.getSelectionBoxes(c);if(!d)return;t.empty();let u=A(this,du,gS).call(this,c),p=h(this,We)===Z.NONE,m=()=>{u?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o,text:a}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode(Z.HIGHLIGHT,m);return}m()}addToAnnotationStorage(e){!e.isEmpty()&&h(this,Vi)&&!h(this,Vi).has(e.id)&&h(this,Vi).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,h(this,Ns)&&(w(this,Ns,!1),A(this,fl,ug).call(this,"main_toolbar")),!this.hasSelection)return;let{activeElement:e}=document;for(let t of h(this,fe))if(t.div.contains(e)){w(this,Jr,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!h(this,Jr))return;let[e,t]=h(this,Jr);w(this,Jr,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){A(this,uu,mS).call(this),A(this,hu,yS).call(this)}removeEditListeners(){A(this,Rm,nR).call(this),A(this,fu,vS).call(this)}dragOver(e){for(let{type:t}of e.dataTransfer.items)for(let n of h(this,kn))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(let t of e.dataTransfer.items)for(let n of h(this,kn))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),h(this,Gt)?.commitOrRemove(),!this.hasSelection)return;let t=[];for(let n of h(this,fe)){let s=n.serialize(!0);s&&t.push(s)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();let{clipboardData:t}=e;for(let r of t.items)for(let o of h(this,kn))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(r){j(`paste: "${r.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();let s=this.currentLayer;try{let r=[];for(let l of n){let c=await s.deserialize(l);if(!c)return;r.push(c)}let o=()=>{for(let l of r)A(this,pu,bS).call(this,l);A(this,gu,ES).call(this,r)},a=()=>{for(let l of r)l.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(r){j(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),h(this,We)!==Z.NONE&&!this.isEditorHandlingKeyboard&&ja._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,h(this,Ns)&&(w(this,Ns,!1),A(this,fl,ug).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(A(this,_m,eR).call(this),A(this,hu,yS).call(this),A(this,Qe,St).call(this,{isEditing:h(this,We)!==Z.NONE,isEmpty:A(this,jr,md).call(this),hasSomethingToUndo:h(this,fn).hasSomethingToUndo(),hasSomethingToRedo:h(this,fn).hasSomethingToRedo(),hasSelectedEditor:!1})):(A(this,xm,tR).call(this),A(this,fu,vS).call(this),A(this,Qe,St).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!h(this,kn)){w(this,kn,e);for(let t of h(this,kn))A(this,Nn,Ui).call(this,t.defaultPropertiesToUpdate)}}getId(){return h(this,wm).id}get currentLayer(){return h(this,je).get(h(this,cl))}getLayer(e){return h(this,je).get(e)}get currentPageIndex(){return h(this,cl)}addLayer(e){h(this,je).set(e.pageIndex,e),h(this,Fs)?e.enable():e.disable()}removeLayer(e){h(this,je).delete(e.pageIndex)}async updateMode(e,t=null,n=!1){if(h(this,We)!==e&&!(h(this,pn)&&(await h(this,pn).promise,!h(this,pn)))){if(w(this,pn,Promise.withResolvers()),w(this,We,e),e===Z.NONE){this.setEditingState(!1),A(this,Mm,rR).call(this),this._editorUndoBar?.hide(),h(this,pn).resolve();return}this.setEditingState(!0),await A(this,Im,sR).call(this),this.unselectAll();for(let s of h(this,je).values())s.updateMode(e);if(!t){n&&this.addNewEditorFromKeyboard(),h(this,pn).resolve();return}for(let s of h(this,$e).values())s.annotationElementId===t?(this.setSelected(s),s.enterInEditMode()):s.unselect();h(this,pn).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==h(this,We)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){if(h(this,kn)){switch(e){case re.CREATE:this.currentLayer.addNewEditor();return;case re.HIGHLIGHT_DEFAULT_COLOR:h(this,ru)?.updateColor(t);break;case re.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(h(this,au)||w(this,au,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(let n of h(this,fe))n.updateParams(e,t);for(let n of h(this,kn))n.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){for(let r of h(this,$e).values())r.editorType===e&&r.show(t);(h(this,au)?.get(re.HIGHLIGHT_SHOW_ALL)??!0)!==t&&A(this,Nn,Ui).call(this,[[re.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(h(this,su)!==e){w(this,su,e);for(let t of h(this,je).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){let t=[];for(let n of h(this,$e).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return h(this,$e).get(e)}addEditor(e){h(this,$e).set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(h(this,si)&&clearTimeout(h(this,si)),w(this,si,setTimeout(()=>{this.focusMainContainer(),w(this,si,null)},0))),h(this,$e).delete(e.id),this.unselect(e),(!e.annotationElementId||!h(this,Kr).has(e.annotationElementId))&&h(this,Vi)?.remove(e.id)}addDeletedAnnotationElement(e){h(this,Kr).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return h(this,Kr).has(e)}removeDeletedAnnotationElement(e){h(this,Kr).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){h(this,Gt)!==e&&(w(this,Gt,e),e&&A(this,Nn,Ui).call(this,e.propertiesToUpdate))}updateUI(e){h(this,Pm,oR)===e&&A(this,Nn,Ui).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){A(this,Nn,Ui).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(h(this,fe).has(e)){h(this,fe).delete(e),e.unselect(),A(this,Qe,St).call(this,{hasSelectedEditor:this.hasSelection});return}h(this,fe).add(e),e.select(),A(this,Nn,Ui).call(this,e.propertiesToUpdate),A(this,Qe,St).call(this,{hasSelectedEditor:!0})}setSelected(e){h(this,Yr)?.commitOrRemove();for(let t of h(this,fe))t!==e&&t.unselect();h(this,fe).clear(),h(this,fe).add(e),e.select(),A(this,Nn,Ui).call(this,e.propertiesToUpdate),A(this,Qe,St).call(this,{hasSelectedEditor:!0})}isSelected(e){return h(this,fe).has(e)}get firstSelectedEditor(){return h(this,fe).values().next().value}unselect(e){e.unselect(),h(this,fe).delete(e),A(this,Qe,St).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return h(this,fe).size!==0}get isEnterHandled(){return h(this,fe).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){h(this,fn).undo(),A(this,Qe,St).call(this,{hasSomethingToUndo:h(this,fn).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:A(this,jr,md).call(this)}),this._editorUndoBar?.hide()}redo(){h(this,fn).redo(),A(this,Qe,St).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:h(this,fn).hasSomethingToRedo(),isEmpty:A(this,jr,md).call(this)})}addCommands(e){h(this,fn).add(e),A(this,Qe,St).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:A(this,jr,md).call(this)})}cleanUndoStack(e){h(this,fn).cleanType(e)}delete(){this.commitOrRemove();let e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;let t=e?[e]:[...h(this,fe)],n=()=>{this._editorUndoBar?.show(s,t.length===1?t[0].editorType:t.length);for(let r of t)r.remove()},s=()=>{for(let r of t)A(this,pu,bS).call(this,r)};this.addCommands({cmd:n,undo:s,mustExec:!0})}commitOrRemove(){h(this,Gt)?.commitOrRemove()}hasSomethingToControl(){return h(this,Gt)||this.hasSelection}selectAll(){for(let e of h(this,fe))e.commit();A(this,gu,ES).call(this,h(this,$e).values())}unselectAll(){if(!(h(this,Gt)&&(h(this,Gt).commitOrRemove(),h(this,We)!==Z.NONE))&&!h(this,Yr)?.commitOrRemove()&&this.hasSelection){for(let e of h(this,fe))e.unselect();h(this,fe).clear(),A(this,Qe,St).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;h(this,Os)[0]+=e,h(this,Os)[1]+=t;let[s,r]=h(this,Os),o=[...h(this,fe)],a=1e3;h(this,oi)&&clearTimeout(h(this,oi)),w(this,oi,setTimeout(()=>{w(this,oi,null),h(this,Os)[0]=h(this,Os)[1]=0,this.addCommands({cmd:()=>{for(let l of o)h(this,$e).has(l.id)&&l.translateInPage(s,r)},undo:()=>{for(let l of o)h(this,$e).has(l.id)&&l.translateInPage(-s,-r)},mustExec:!1})},a));for(let l of o)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),w(this,ii,new Map);for(let e of h(this,fe))h(this,ii).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!h(this,ii))return!1;this.disableUserSelect(!1);let e=h(this,ii);w(this,ii,null);let t=!1;for(let[{x:s,y:r,pageIndex:o},a]of e)a.newX=s,a.newY=r,a.newPageIndex=o,t||(t=s!==a.savedX||r!==a.savedY||o!==a.savedPageIndex);if(!t)return!1;let n=(s,r,o,a)=>{if(h(this,$e).has(s.id)){let l=h(this,je).get(a);l?s._setParentAndPosition(l,r,o):(s.pageIndex=a,s.x=r,s.y=o)}};return this.addCommands({cmd:()=>{for(let[s,{newX:r,newY:o,newPageIndex:a}]of e)n(s,r,o,a)},undo:()=>{for(let[s,{savedX:r,savedY:o,savedPageIndex:a}]of e)n(s,r,o,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(h(this,ii))for(let n of h(this,ii).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){let t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||h(this,fe).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return h(this,Gt)===e}getActive(){return h(this,Gt)}getMode(){return h(this,We)}get imageManager(){return ie(this,"imageManager",new hS)}getSelectionBoxes(e){if(!e)return null;let t=document.getSelection();for(let c=0,d=t.rangeCount;c<d;c++)if(!e.contains(t.getRangeAt(c).commonAncestorContainer))return null;let{x:n,y:s,width:r,height:o}=e.getBoundingClientRect(),a;switch(e.getAttribute("data-main-rotation")){case"90":a=(c,d,u,p)=>({x:(d-s)/o,y:1-(c+u-n)/r,width:p/o,height:u/r});break;case"180":a=(c,d,u,p)=>({x:1-(c+u-n)/r,y:1-(d+p-s)/o,width:u/r,height:p/o});break;case"270":a=(c,d,u,p)=>({x:1-(d+p-s)/o,y:(c-n)/r,width:p/o,height:u/r});break;default:a=(c,d,u,p)=>({x:(c-n)/r,y:(d-s)/o,width:u/r,height:p/o});break}let l=[];for(let c=0,d=t.rangeCount;c<d;c++){let u=t.getRangeAt(c);if(!u.collapsed)for(let{x:p,y:m,width:y,height:v}of u.getClientRects())y===0||v===0||l.push(a(p,m,y,v))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(h(this,ll)||w(this,ll,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){h(this,ll)?.delete(e)}renderAnnotationElement(e){let t=h(this,ll)?.get(e.data.id);if(!t)return;let n=h(this,Vi).getRawValue(t);n&&(h(this,We)===Z.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}};ol=new WeakMap,Gt=new WeakMap,$e=new WeakMap,je=new WeakMap,al=new WeakMap,Vi=new WeakMap,ll=new WeakMap,fn=new WeakMap,Ps=new WeakMap,Yr=new WeakMap,cl=new WeakMap,Kr=new WeakMap,ii=new WeakMap,kn=new WeakMap,Xr=new WeakMap,tu=new WeakMap,nu=new WeakMap,dl=new WeakMap,iu=new WeakMap,si=new WeakMap,ks=new WeakMap,ul=new WeakMap,Ns=new WeakMap,ri=new WeakMap,wm=new WeakMap,Fs=new WeakMap,su=new WeakMap,Ls=new WeakMap,Jr=new WeakMap,ru=new WeakMap,ou=new WeakMap,We=new WeakMap,fe=new WeakMap,Gi=new WeakMap,Zr=new WeakMap,au=new WeakMap,lu=new WeakMap,Os=new WeakMap,oi=new WeakMap,zi=new WeakMap,cu=new WeakMap,pn=new WeakMap,hl=new WeakSet,dg=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},du=new WeakSet,gS=function(e){let{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(let n of h(this,je).values())if(n.hasTextLayer(e))return n;return null},Am=new WeakSet,Zx=function(){let e=document.getSelection();if(!e||e.isCollapsed)return;let n=A(this,hl,dg).call(this,e).closest(".textLayer"),s=this.getSelectionBoxes(n);s&&(h(this,ri)||w(this,ri,new dS(this)),h(this,ri).show(n,s,this.direction==="ltr"))},Cm=new WeakSet,jx=function(){let e=document.getSelection();if(!e||e.isCollapsed){h(this,Gi)&&(h(this,ri)?.hide(),w(this,Gi,null),A(this,Qe,St).call(this,{hasSelectedText:!1}));return}let{anchorNode:t}=e;if(t===h(this,Gi))return;let s=A(this,hl,dg).call(this,e).closest(".textLayer");if(!s){h(this,Gi)&&(h(this,ri)?.hide(),w(this,Gi,null),A(this,Qe,St).call(this,{hasSelectedText:!1}));return}if(h(this,ri)?.hide(),w(this,Gi,t),A(this,Qe,St).call(this,{hasSelectedText:!0}),!(h(this,We)!==Z.HIGHLIGHT&&h(this,We)!==Z.NONE)&&(h(this,We)===Z.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),w(this,Ns,this.isShiftKeyDown),!this.isShiftKeyDown)){let r=h(this,We)===Z.HIGHLIGHT?A(this,du,gS).call(this,s):null;r?.toggleDrawing();let o=new AbortController,a=this.combinedSignal(o),l=c=>{c.type==="pointerup"&&c.button!==0||(o.abort(),r?.toggleDrawing(!0),c.type==="pointerup"&&A(this,fl,ug).call(this,"main_toolbar"))};window.addEventListener("pointerup",l,{signal:a}),window.addEventListener("blur",l,{signal:a})}},fl=new WeakSet,ug=function(e=""){h(this,We)===Z.HIGHLIGHT?this.highlightSelection(e):h(this,tu)&&A(this,Am,Zx).call(this)},Tm=new WeakSet,Qx=function(){document.addEventListener("selectionchange",A(this,Cm,jx).bind(this),{signal:this._signal})},_m=new WeakSet,eR=function(){if(h(this,ks))return;w(this,ks,new AbortController);let e=this.combinedSignal(h(this,ks));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},xm=new WeakSet,tR=function(){h(this,ks)?.abort(),w(this,ks,null)},uu=new WeakSet,mS=function(){if(h(this,Ls))return;w(this,Ls,new AbortController);let e=this.combinedSignal(h(this,Ls));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},Rm=new WeakSet,nR=function(){h(this,Ls)?.abort(),w(this,Ls,null)},hu=new WeakSet,yS=function(){if(h(this,Ps))return;w(this,Ps,new AbortController);let e=this.combinedSignal(h(this,Ps));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},fu=new WeakSet,vS=function(){h(this,Ps)?.abort(),w(this,Ps,null)},Dm=new WeakSet,iR=function(){let e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Qe=new WeakSet,St=function(e){Object.entries(e).some(([n,s])=>h(this,lu)[n]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(h(this,lu),e)}),h(this,We)===Z.HIGHLIGHT&&e.hasSelectedEditor===!1&&A(this,Nn,Ui).call(this,[[re.HIGHLIGHT_FREE,!0]]))},Nn=new WeakSet,Ui=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},Im=new WeakSet,sR=async function(){if(!h(this,Fs)){w(this,Fs,!0);let e=[];for(let t of h(this,je).values())e.push(t.enable());await Promise.all(e);for(let t of h(this,$e).values())t.enable()}},Mm=new WeakSet,rR=function(){if(this.unselectAll(),h(this,Fs)){w(this,Fs,!1);for(let e of h(this,je).values())e.disable();for(let e of h(this,$e).values())e.disable()}},pu=new WeakSet,bS=function(e){let t=h(this,je).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},Pm=new WeakSet,oR=function(){let e=null;for(e of h(this,fe));return e},jr=new WeakSet,md=function(){if(h(this,$e).size===0)return!0;if(h(this,$e).size===1)for(let e of h(this,$e).values())return e.isEmpty();return!1},gu=new WeakSet,ES=function(e){for(let t of h(this,fe))t.unselect();h(this,fe).clear();for(let t of e)t.isEmpty()||(h(this,fe).add(t),t.select());A(this,Qe,St).call(this,{hasSelectedEditor:this.hasSelection})},Y(ja,"TRANSLATE_SMALL",1),Y(ja,"TRANSLATE_BIG",10);var da=ja,qe,ai,Fn,pl,li,zt,gl,ci,kt,Wi,Qr,di,Us,eo,yd,ml,hg,wt=class wt{constructor(e){E(this,eo);E(this,ml);E(this,qe,null);E(this,ai,!1);E(this,Fn,null);E(this,pl,null);E(this,li,null);E(this,zt,null);E(this,gl,!1);E(this,ci,null);E(this,kt,null);E(this,Wi,null);E(this,Qr,null);E(this,di,!1);w(this,kt,e),w(this,di,e._uiManager.useNewAltTextFlow),h(wt,Us)||w(wt,Us,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){wt._l10n??(wt._l10n=e)}async render(){let e=w(this,Fn,document.createElement("button"));e.className="altText",e.tabIndex="0";let t=w(this,pl,document.createElement("span"));e.append(t),h(this,di)?(e.classList.add("new"),e.setAttribute("data-l10n-id",h(wt,Us).missing),t.setAttribute("data-l10n-id",h(wt,Us)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let n=h(this,kt)._uiManager._signal;e.addEventListener("contextmenu",Yn,{signal:n}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});let s=r=>{r.preventDefault(),h(this,kt)._uiManager.editAltText(h(this,kt)),h(this,di)&&h(this,kt)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:h(this,eo,yd)}})};return e.addEventListener("click",s,{capture:!0,signal:n}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(w(this,gl,!0),s(r))},{signal:n}),await A(this,ml,hg).call(this),e}finish(){h(this,Fn)&&(h(this,Fn).focus({focusVisible:h(this,gl)}),w(this,gl,!1))}isEmpty(){return h(this,di)?h(this,qe)===null:!h(this,qe)&&!h(this,ai)}hasData(){return h(this,di)?h(this,qe)!==null||!!h(this,Wi):this.isEmpty()}get guessedText(){return h(this,Wi)}async setGuessedText(e){h(this,qe)===null&&(w(this,Wi,e),w(this,Qr,await wt._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),A(this,ml,hg).call(this))}toggleAltTextBadge(e=!1){if(!h(this,di)||h(this,qe)){h(this,ci)?.remove(),w(this,ci,null);return}if(!h(this,ci)){let t=w(this,ci,document.createElement("div"));t.className="noAltTextBadge",h(this,kt).div.append(t)}h(this,ci).classList.toggle("hidden",!e)}serialize(e){let t=h(this,qe);return!e&&h(this,Wi)===t&&(t=h(this,Qr)),{altText:t,decorative:h(this,ai),guessedText:h(this,Wi),textWithDisclaimer:h(this,Qr)}}get data(){return{altText:h(this,qe),decorative:h(this,ai)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:s,cancel:r=!1}){n&&(w(this,Wi,n),w(this,Qr,s)),!(h(this,qe)===e&&h(this,ai)===t)&&(r||(w(this,qe,e),w(this,ai,t)),A(this,ml,hg).call(this))}toggle(e=!1){h(this,Fn)&&(!e&&h(this,zt)&&(clearTimeout(h(this,zt)),w(this,zt,null)),h(this,Fn).disabled=!e)}shown(){h(this,kt)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:h(this,eo,yd)}})}destroy(){h(this,Fn)?.remove(),w(this,Fn,null),w(this,pl,null),w(this,li,null),h(this,ci)?.remove(),w(this,ci,null)}};qe=new WeakMap,ai=new WeakMap,Fn=new WeakMap,pl=new WeakMap,li=new WeakMap,zt=new WeakMap,gl=new WeakMap,ci=new WeakMap,kt=new WeakMap,Wi=new WeakMap,Qr=new WeakMap,di=new WeakMap,Us=new WeakMap,eo=new WeakSet,yd=function(){return h(this,qe)&&"added"||h(this,qe)===null&&this.guessedText&&"review"||"missing"},ml=new WeakSet,hg=async function(){let e=h(this,Fn);if(!e)return;if(h(this,di)){if(e.classList.toggle("done",!!h(this,qe)),e.setAttribute("data-l10n-id",h(wt,Us)[h(this,eo,yd)]),h(this,pl)?.setAttribute("data-l10n-id",h(wt,Us)[`${h(this,eo,yd)}-label`]),!h(this,qe)){h(this,li)?.remove();return}}else{if(!h(this,qe)&&!h(this,ai)){e.classList.remove("done"),h(this,li)?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=h(this,li);if(!t){w(this,li,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${h(this,kt).id}`;let s=100,r=h(this,kt)._uiManager._signal;r.addEventListener("abort",()=>{clearTimeout(h(this,zt)),w(this,zt,null)},{once:!0}),e.addEventListener("mouseenter",()=>{w(this,zt,setTimeout(()=>{w(this,zt,null),h(this,li).classList.add("show"),h(this,kt)._reportTelemetry({action:"alt_text_tooltip"})},s))},{signal:r}),e.addEventListener("mouseleave",()=>{h(this,zt)&&(clearTimeout(h(this,zt)),w(this,zt,null)),h(this,li)?.classList.remove("show")},{signal:r})}h(this,ai)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=h(this,qe)),t.parentNode||e.append(t),h(this,kt).getImageForAltText()?.setAttribute("aria-describedby",t.id)},E(wt,Us,null),Y(wt,"_l10n",null);var Bg=wt,mu,to,yu,vu,bu,Eu,Su,yl,qi,no,Bs,km,aR,Nm,lR,wu,SS,TA=class TA{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:s=null,onPinching:r=null,onPinchEnd:o=null,signal:a}){E(this,km);E(this,Nm);E(this,wu);E(this,mu,void 0);E(this,to,!1);E(this,yu,null);E(this,vu,void 0);E(this,bu,void 0);E(this,Eu,void 0);E(this,Su,void 0);E(this,yl,void 0);E(this,qi,null);E(this,no,void 0);E(this,Bs,null);w(this,mu,e),w(this,yu,n),w(this,vu,t),w(this,bu,s),w(this,Eu,r),w(this,Su,o),w(this,no,new AbortController),w(this,yl,AbortSignal.any([a,h(this,no).signal])),e.addEventListener("touchstart",A(this,km,aR).bind(this),{passive:!1,signal:h(this,yl)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return ie(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){h(this,no)?.abort(),w(this,no,null)}};mu=new WeakMap,to=new WeakMap,yu=new WeakMap,vu=new WeakMap,bu=new WeakMap,Eu=new WeakMap,Su=new WeakMap,yl=new WeakMap,qi=new WeakMap,no=new WeakMap,Bs=new WeakMap,km=new WeakSet,aR=function(e){var s,r,o;if((s=h(this,vu))!=null&&s.call(this)||e.touches.length<2)return;if(!h(this,Bs)){w(this,Bs,new AbortController);let a=AbortSignal.any([h(this,yl),h(this,Bs).signal]),l=h(this,mu),c={signal:a,passive:!1};l.addEventListener("touchmove",A(this,Nm,lR).bind(this),c),l.addEventListener("touchend",A(this,wu,SS).bind(this),c),l.addEventListener("touchcancel",A(this,wu,SS).bind(this),c),(r=h(this,bu))==null||r.call(this)}if(nn(e),e.touches.length!==2||(o=h(this,yu))!=null&&o.call(this)){w(this,qi,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),w(this,qi,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},Nm=new WeakSet,lR=function(e){var _;if(!h(this,qi)||e.touches.length!==2)return;let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);let{screenX:s,screenY:r}=t,{screenX:o,screenY:a}=n,l=h(this,qi),{touch0X:c,touch0Y:d,touch1X:u,touch1Y:p}=l,m=u-c,y=p-d,v=o-s,b=a-r,S=Math.hypot(v,b)||1,C=Math.hypot(m,y)||1;if(!h(this,to)&&Math.abs(C-S)<=TA.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=s,l.touch0Y=r,l.touch1X=o,l.touch1Y=a,e.preventDefault(),!h(this,to)){w(this,to,!0);return}let T=[(s+o)/2,(r+a)/2];(_=h(this,Eu))==null||_.call(this,T,C,S)},wu=new WeakSet,SS=function(e){var t;h(this,Bs).abort(),w(this,Bs,null),(t=h(this,Su))==null||t.call(this),h(this,qi)&&(e.preventDefault(),w(this,qi,null),w(this,to,!1))};var Hg=TA,io,Ln,ve,vl,Hs,Au,so,et,ro,Yi,$s,Cu,oo,Wt,Tu,ao,Ki,ui,bl,El,gn,lo,_u,Fm,xu,wS,Ru,AS,Sl,fg,Lm,cR,Om,dR,Du,CS,wl,pg,Iu,TS,Um,uR,Bm,hR,Hm,fR,Mu,_S,$m,pR,Pu,xS,Vm,gR,Gm,mR,zm,yR,ku,RS,co,vd,Q=class Q{constructor(e){E(this,xu);E(this,Sl);E(this,Lm);E(this,Om);E(this,Du);E(this,wl);E(this,Iu);E(this,Um);E(this,Bm);E(this,Hm);E(this,Mu);E(this,$m);E(this,Pu);E(this,Vm);E(this,Gm);E(this,zm);E(this,ku);E(this,co);E(this,io,null);E(this,Ln,null);E(this,ve,null);E(this,vl,!1);E(this,Hs,null);E(this,Au,"");E(this,so,!1);E(this,et,null);E(this,ro,null);E(this,Yi,null);E(this,$s,null);E(this,Cu,"");E(this,oo,!1);E(this,Wt,null);E(this,Tu,!1);E(this,ao,!1);E(this,Ki,!1);E(this,ui,null);E(this,bl,0);E(this,El,0);E(this,gn,null);E(this,lo,null);Y(this,"_editToolbar",null);Y(this,"_initialOptions",Object.create(null));Y(this,"_initialData",null);Y(this,"_isVisible",!0);Y(this,"_uiManager",null);Y(this,"_focusEventsAllowed",!0);E(this,_u,!1);E(this,Fm,Q._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;let{rotation:t,rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,s],this.pageTranslation=[r,o];let[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){let e=Q.prototype._resizeWithKeyboard,t=da.TRANSLATE_SMALL,n=da.TRANSLATE_BIG;return ie(this,"_resizerKeyboardManager",new ca([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],Q.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return ie(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let t=new DS({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Q._l10n??(Q._l10n=e),Q._l10nResizer||(Q._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Q._borderLineWidth!==-1)return;let n=getComputedStyle(document.documentElement);Q._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){me("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return h(this,_u)}set _isDraggable(e){w(this,_u,e),this.div?.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){let[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=h(this,Fm)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):A(this,co,vd).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(h(this,oo)?w(this,oo,!1):this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,s){let[r,o]=this.parentDimensions;[n,s]=this.screenToPageTranslation(n,s),this.x=(e+n)/r,this.y=(t+s)/o,this.fixAndSetPosition()}translate(e,t){A(this,xu,wS).call(this,this.parentDimensions,e,t)}translateInPage(e,t){h(this,Wt)||w(this,Wt,[this.x,this.y,this.width,this.height]),A(this,xu,wS).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){h(this,Wt)||w(this,Wt,[this.x,this.y,this.width,this.height]);let{div:n,parentDimensions:[s,r]}=this;if(this.x+=e/s,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:u,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this,[l,c]=this.getBaseTranslation();o+=l,a+=c;let{style:d}=n;d.left=`${(100*o).toFixed(2)}%`,d.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!h(this,Wt)&&(h(this,Wt)[0]!==this.x||h(this,Wt)[1]!==this.y)}get _hasBeenResized(){return!!h(this,Wt)&&(h(this,Wt)[2]!==this.width||h(this,Wt)[3]!==this.height)}getBaseTranslation(){let[e,t]=this.parentDimensions,{_borderLineWidth:n}=Q,s=n/e,r=n/t;switch(this.rotation){case 90:return[-s,r];case 180:return[s,r];case 270:return[s,-r];default:return[-s,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){let{div:{style:t},pageDimensions:[n,s]}=this,{x:r,y:o,width:a,height:l}=this;if(a*=n,l*=s,r*=n,o*=s,this._mustFixPosition)switch(e){case 0:r=Math.max(0,Math.min(n-a,r)),o=Math.max(0,Math.min(s-l,o));break;case 90:r=Math.max(0,Math.min(n-l,r)),o=Math.min(s,Math.max(a,o));break;case 180:r=Math.min(n,Math.max(a,r)),o=Math.min(s,Math.max(l,o));break;case 270:r=Math.min(n,Math.max(l,r)),o=Math.max(0,Math.min(s-a,o));break}this.x=r/=n,this.y=o/=s;let[c,d]=this.getBaseTranslation();r+=c,o+=d,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return A(n=Q,Ru,AS).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return A(n=Q,Ru,AS).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(e,t){let[n,s]=this.parentDimensions,{style:r}=this.div;r.width=`${(100*e/n).toFixed(2)}%`,h(this,so)||(r.height=`${(100*t/s).toFixed(2)}%`)}fixDims(){let{style:e}=this.div,{height:t,width:n}=e,s=n.endsWith("%"),r=!h(this,so)&&t.endsWith("%");if(s&&r)return;let[o,a]=this.parentDimensions;s||(e.width=`${(100*parseFloat(n)/o).toFixed(2)}%`),!h(this,so)&&!r&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){h(this,ve)?.finish()}async addEditToolbar(){return this._editToolbar||h(this,ao)?this._editToolbar:(this._editToolbar=new lS(this),this.div.append(this._editToolbar.render()),h(this,ve)&&await this._editToolbar.addAltText(h(this,ve)),this._editToolbar)}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,h(this,ve)?.destroy())}addContainer(e){let t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){h(this,ve)||(Bg.initialize(Q._l10n),w(this,ve,new Bg(this)),h(this,io)&&(h(this,ve).data=h(this,io),w(this,io,null)),await this.addEditToolbar())}get altTextData(){return h(this,ve)?.data}set altTextData(e){h(this,ve)&&(h(this,ve).data=e)}get guessedAltText(){return h(this,ve)?.guessedText}async setGuessedAltText(e){await h(this,ve)?.setGuessedText(e)}serializeAltText(e){return h(this,ve)?.serialize(e)}hasAltText(){return!!h(this,ve)&&!h(this,ve).isEmpty()}hasAltTextData(){return h(this,ve)?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=h(this,vl)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),A(this,Pu,xS).call(this);let[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);let[n,s]=this.getInitialTranslation();return this.translate(n,s),Ug(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(h(this,lo)||w(this,lo,new Hg({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:A(this,Um,uR).bind(this),onPinching:A(this,Bm,hR).bind(this),onPinchEnd:A(this,Hm,fR).bind(this),signal:this._uiManager._signal}))),this._uiManager._editorUndoBar?.hide(),this.div}pointerdown(e){let{isMac:t}=st.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(w(this,oo,!0),this._isDraggable){A(this,$m,pR).call(this,e);return}A(this,Mu,_S).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){h(this,ui)&&clearTimeout(h(this,ui)),w(this,ui,setTimeout(()=>{w(this,ui,null),this.parent?.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){let s=this.parentScale,[r,o]=this.pageDimensions,[a,l]=this.pageTranslation,c=e/s,d=t/s,u=this.x*r,p=this.y*o,m=this.width*r,y=this.height*o;switch(n){case 0:return[u+c+a,o-p-d-y+l,u+c+m+a,o-p-d+l];case 90:return[u+d+a,o-p+c+l,u+d+y+a,o-p+c+m+l];case 180:return[u-c-m+a,o-p+d+l,u-c+a,o-p+d+y+l];case 270:return[u-d-y+a,o-p-c-m+l,u-d+a,o-p-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){let[n,s,r,o]=e,a=r-n,l=o-s;switch(this.rotation){case 0:return[n,t-o,a,l];case 90:return[n,t-s,l,a];case 180:return[r,t-s,a,l];case 270:return[r,t-o,l,a];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){w(this,ao,!0)}disableEditMode(){w(this,ao,!1)}isInEditMode(){return h(this,ao)}shouldGetKeyboardEvents(){return h(this,Ki)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:e,left:t,bottom:n,right:s}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&s>0&&e<r&&n>0}rebuild(){A(this,Pu,xS).call(this)}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){me("An editor must be serializable")}static async deserialize(e,t,n){let s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n});s.rotation=e.rotation,w(s,io,e.accessibilityData);let[r,o]=s.pageDimensions,[a,l,c,d]=s.getRectInCurrentCoords(e.rect,o);return s.x=a/r,s.y=l/o,s.width=c/r,s.height=d/o,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(h(this,$s)?.abort(),w(this,$s,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),h(this,ui)&&(clearTimeout(h(this,ui)),w(this,ui,null)),A(this,co,vd).call(this),this.removeEditToolbar(),h(this,gn)){for(let e of h(this,gn).values())clearTimeout(e);w(this,gn,null)}this.parent=null,h(this,lo)?.destroy(),w(this,lo,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(A(this,Lm,cR).call(this),h(this,et).classList.remove("hidden"),Ug(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),w(this,Yi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let t=h(this,et).children;if(!h(this,Ln)){w(this,Ln,Array.from(t));let o=A(this,Vm,gR).bind(this),a=A(this,Gm,mR).bind(this),l=this._uiManager._signal;for(let c of h(this,Ln)){let d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",o,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",A(this,zm,yR).bind(this,d),{signal:l}),c.setAttribute("data-l10n-id",Q._l10nResizer[d])}}let n=h(this,Ln)[0],s=0;for(let o of t){if(o===n)break;s++}let r=(360-this.rotation+this.parentRotation)%360/90*(h(this,Ln).length/4);if(r!==s){if(r<s)for(let a=0;a<s-r;a++)h(this,et).append(h(this,et).firstChild);else if(r>s)for(let a=0;a<r-s;a++)h(this,et).firstChild.before(h(this,et).lastChild);let o=0;for(let a of t){let c=h(this,Ln)[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",Q._l10nResizer[c])}}A(this,ku,RS).call(this,0),w(this,Ki,!0),h(this,et).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){h(this,Ki)&&A(this,Iu,TS).call(this,h(this,Cu),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){A(this,co,vd).call(this),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),h(this,ve)?.toggleAltTextBadge(!1)}unselect(){h(this,et)?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),h(this,ve)?.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return h(this,Tu)}set isEditing(e){w(this,Tu,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){w(this,so,!0);let n=e/t,{style:s}=this.div;s.aspectRatio=n,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){h(this,gn)||w(this,gn,new Map);let{action:n}=e,s=h(this,gn).get(n);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),h(this,gn).delete(n),h(this,gn).size===0&&w(this,gn,null)},Q._telemetryTimeout),h(this,gn).set(n,s);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),w(this,vl,!1)}disable(){this.div&&(this.div.tabIndex=-1),w(this,vl,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){let n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){let{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};io=new WeakMap,Ln=new WeakMap,ve=new WeakMap,vl=new WeakMap,Hs=new WeakMap,Au=new WeakMap,so=new WeakMap,et=new WeakMap,ro=new WeakMap,Yi=new WeakMap,$s=new WeakMap,Cu=new WeakMap,oo=new WeakMap,Wt=new WeakMap,Tu=new WeakMap,ao=new WeakMap,Ki=new WeakMap,ui=new WeakMap,bl=new WeakMap,El=new WeakMap,gn=new WeakMap,lo=new WeakMap,_u=new WeakMap,Fm=new WeakMap,xu=new WeakSet,wS=function([e,t],n,s){[n,s]=this.screenToPageTranslation(n,s),this.x+=n/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Ru=new WeakSet,AS=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Sl=new WeakSet,fg=function(e){switch(e){case 90:{let[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{let[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},Lm=new WeakSet,cR=function(){if(h(this,et))return;w(this,et,document.createElement("div")),h(this,et).classList.add("resizers");let e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(let n of e){let s=document.createElement("div");h(this,et).append(s),s.classList.add("resizer",n),s.setAttribute("data-resizer-name",n),s.addEventListener("pointerdown",A(this,Om,dR).bind(this,n),{signal:t}),s.addEventListener("contextmenu",Yn,{signal:t}),s.tabIndex=-1}this.div.prepend(h(this,et))},Om=new WeakSet,dR=function(e,t){t.preventDefault();let{isMac:n}=st.platform;if(t.button!==0||t.ctrlKey&&n)return;h(this,ve)?.toggle(!1);let s=this._isDraggable;this._isDraggable=!1,w(this,ro,[t.screenX,t.screenY]);let r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",A(this,Iu,TS).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",nn,{passive:!1,signal:o}),window.addEventListener("contextmenu",Yn,{signal:o}),w(this,Yi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});let a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;let c=()=>{r.abort(),this.parent.togglePointerEvents(!0),h(this,ve)?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=a,this.div.style.cursor=l,A(this,wl,pg).call(this)};window.addEventListener("pointerup",c,{signal:o}),window.addEventListener("blur",c,{signal:o})},Du=new WeakSet,CS=function(e,t,n,s){this.width=n,this.height=s,this.x=e,this.y=t;let[r,o]=this.parentDimensions;this.setDims(r*n,o*s),this.fixAndSetPosition(),this._onResized()},wl=new WeakSet,pg=function(){if(!h(this,Yi))return;let{savedX:e,savedY:t,savedWidth:n,savedHeight:s}=h(this,Yi);w(this,Yi,null);let r=this.x,o=this.y,a=this.width,l=this.height;r===e&&o===t&&a===n&&l===s||this.addCommands({cmd:A(this,Du,CS).bind(this,r,o,a,l),undo:A(this,Du,CS).bind(this,e,t,n,s),mustExec:!0})},Iu=new WeakSet,TS=function(e,t){let[n,s]=this.parentDimensions,r=this.x,o=this.y,a=this.width,l=this.height,c=Q.MIN_SIZE/n,d=Q.MIN_SIZE/s,u=A(this,Sl,fg).call(this,this.rotation),p=(L,q)=>[u[0]*L+u[2]*q,u[1]*L+u[3]*q],m=A(this,Sl,fg).call(this,360-this.rotation),y=(L,q)=>[m[0]*L+m[2]*q,m[1]*L+m[3]*q],v,b,S=!1,C=!1;switch(e){case"topLeft":S=!0,v=(L,q)=>[0,0],b=(L,q)=>[L,q];break;case"topMiddle":v=(L,q)=>[L/2,0],b=(L,q)=>[L/2,q];break;case"topRight":S=!0,v=(L,q)=>[L,0],b=(L,q)=>[0,q];break;case"middleRight":C=!0,v=(L,q)=>[L,q/2],b=(L,q)=>[0,q/2];break;case"bottomRight":S=!0,v=(L,q)=>[L,q],b=(L,q)=>[0,0];break;case"bottomMiddle":v=(L,q)=>[L/2,q],b=(L,q)=>[L/2,0];break;case"bottomLeft":S=!0,v=(L,q)=>[0,q],b=(L,q)=>[L,0];break;case"middleLeft":C=!0,v=(L,q)=>[0,q/2],b=(L,q)=>[L,q/2];break}let T=v(a,l),_=b(a,l),R=p(..._),I=Q._round(r+R[0]),M=Q._round(o+R[1]),k=1,N=1,F,$;if(t.fromKeyboard)({deltaX:F,deltaY:$}=t);else{let{screenX:L,screenY:q}=t,[Vt,Zn]=h(this,ro);[F,$]=this.screenToPageTranslation(L-Vt,q-Zn),h(this,ro)[0]=L,h(this,ro)[1]=q}if([F,$]=y(F/n,$/s),S){let L=Math.hypot(a,l);k=N=Math.max(Math.min(Math.hypot(_[0]-T[0]-F,_[1]-T[1]-$)/L,1/a,1/l),c/a,d/l)}else C?k=Math.max(c,Math.min(1,Math.abs(_[0]-T[0]-F)))/a:N=Math.max(d,Math.min(1,Math.abs(_[1]-T[1]-$)))/l;let ae=Q._round(a*k),K=Q._round(l*N);R=p(...b(ae,K));let se=I-R[0],ze=M-R[1];h(this,Wt)||w(this,Wt,[this.x,this.y,this.width,this.height]),this.width=ae,this.height=K,this.x=se,this.y=ze,this.setDims(n*ae,s*K),this.fixAndSetPosition(),this._onResizing()},Um=new WeakSet,uR=function(){w(this,Yi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),h(this,ve)?.toggle(!1),this.parent.togglePointerEvents(!1)},Bm=new WeakSet,hR=function(e,t,n){let r=.7*(n/t)+1-.7;if(r===1)return;let o=A(this,Sl,fg).call(this,this.rotation),a=(I,M)=>[o[0]*I+o[2]*M,o[1]*I+o[3]*M],[l,c]=this.parentDimensions,d=this.x,u=this.y,p=this.width,m=this.height,y=Q.MIN_SIZE/l,v=Q.MIN_SIZE/c;r=Math.max(Math.min(r,1/p,1/m),y/p,v/m);let b=Q._round(p*r),S=Q._round(m*r);if(b===p&&S===m)return;h(this,Wt)||w(this,Wt,[d,u,p,m]);let C=a(p/2,m/2),T=Q._round(d+C[0]),_=Q._round(u+C[1]),R=a(b/2,S/2);this.x=T-R[0],this.y=_-R[1],this.width=b,this.height=S,this.setDims(l*b,c*S),this.fixAndSetPosition(),this._onResizing()},Hm=new WeakSet,fR=function(){h(this,ve)?.toggle(!0),this.parent.togglePointerEvents(!0),A(this,wl,pg).call(this)},Mu=new WeakSet,_S=function(e){let{isMac:t}=st.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},$m=new WeakSet,pR=function(e){let{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1,s=new AbortController,r=this._uiManager.combinedSignal(s),o={capture:!0,passive:!1,signal:r},a=c=>{s.abort(),w(this,Hs,null),w(this,oo,!1),this._uiManager.endDragSession()||A(this,Mu,_S).call(this,c),n&&this._onStopDragging()};t&&(w(this,bl,e.clientX),w(this,El,e.clientY),w(this,Hs,e.pointerId),w(this,Au,e.pointerType),window.addEventListener("pointermove",c=>{n||(n=!0,this._onStartDragging());let{clientX:d,clientY:u,pointerId:p}=c;if(p!==h(this,Hs)){nn(c);return}let[m,y]=this.screenToPageTranslation(d-h(this,bl),u-h(this,El));w(this,bl,d),w(this,El,u),this._uiManager.dragSelectedEditors(m,y)},o),window.addEventListener("touchmove",nn,o),window.addEventListener("pointerdown",c=>{c.pointerType===h(this,Au)&&(h(this,lo)||c.isPrimary)&&a(c),nn(c)},o));let l=c=>{if(!h(this,Hs)||h(this,Hs)===c.pointerId){a(c);return}nn(c)};window.addEventListener("pointerup",l,{signal:r}),window.addEventListener("blur",l,{signal:r})},Pu=new WeakSet,xS=function(){if(h(this,$s)||!this.div)return;w(this,$s,new AbortController);let e=this._uiManager.combinedSignal(h(this,$s));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},Vm=new WeakSet,gR=function(e){Q._resizerKeyboardManager.exec(this,e)},Gm=new WeakSet,mR=function(e){h(this,Ki)&&e.relatedTarget?.parentNode!==h(this,et)&&A(this,co,vd).call(this)},zm=new WeakSet,yR=function(e){w(this,Cu,h(this,Ki)?e:"")},ku=new WeakSet,RS=function(e){if(h(this,Ln))for(let t of h(this,Ln))t.tabIndex=e},co=new WeakSet,vd=function(){w(this,Ki,!1),A(this,ku,RS).call(this,-1),A(this,wl,pg).call(this)},E(Q,Ru),Y(Q,"_l10n",null),Y(Q,"_l10nResizer",null),Y(Q,"_borderLineWidth",-1),Y(Q,"_colorManager",new pS),Y(Q,"_zIndex",1),Y(Q,"_telemetryTimeout",1e3);var Te=Q,DS=class extends Te{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},Rx=3285377520,hn=4294901760,ti=65535,$g=class{constructor(e){this.h1=e?e&4294967295:Rx,this.h2=e?e&4294967295:Rx}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let v=0,b=e.length;v<b;v++){let S=e.charCodeAt(v);S<=255?t[n++]=S:(t[n++]=S>>>8,t[n++]=S&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let s=n>>2,r=n-s*4,o=new Uint32Array(t.buffer,0,s),a=0,l=0,c=this.h1,d=this.h2,u=3432918353,p=461845907,m=u&ti,y=p&ti;for(let v=0;v<s;v++)v&1?(a=o[v],a=a*u&hn|a*m&ti,a=a<<15|a>>>17,a=a*p&hn|a*y&ti,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=o[v],l=l*u&hn|l*m&ti,l=l<<15|l>>>17,l=l*p&hn|l*y&ti,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(a=0,r){case 3:a^=t[s*4+2]<<16;case 2:a^=t[s*4+1]<<8;case 1:a^=t[s*4],a=a*u&hn|a*m&ti,a=a<<15|a>>>17,a=a*p&hn|a*y&ti,s&1?c^=a:d^=a}this.h1=c,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&hn|e*36045&ti,t=t*4283543511&hn|((t<<16|e>>>16)*2950163797&hn)>>>16,e^=t>>>1,e=e*444984403&hn|e*60499&ti,t=t*3301882366&hn|((t<<16|e>>>16)*3120437893&hn)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}},IS=Object.freeze({map:null,hash:"",transfer:void 0}),uo,ho,Ye,Wm,vR,Ud=class{constructor(){E(this,Wm);E(this,uo,!1);E(this,ho,null);E(this,Ye,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let n=h(this,Ye).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return h(this,Ye).get(e)}remove(e){if(h(this,Ye).delete(e),h(this,Ye).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let t of h(this,Ye).values())if(t instanceof Te)return;this.onAnnotationEditor(null)}}setValue(e,t){let n=h(this,Ye).get(e),s=!1;if(n!==void 0)for(let[r,o]of Object.entries(t))n[r]!==o&&(s=!0,n[r]=o);else s=!0,h(this,Ye).set(e,t);s&&A(this,Wm,vR).call(this),t instanceof Te&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return h(this,Ye).has(e)}getAll(){return h(this,Ye).size>0?EA(h(this,Ye)):null}setAll(e){for(let[t,n]of Object.entries(e))this.setValue(t,n)}get size(){return h(this,Ye).size}resetModified(){h(this,uo)&&(w(this,uo,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Vg(this)}get serializable(){if(h(this,Ye).size===0)return IS;let e=new Map,t=new $g,n=[],s=Object.create(null),r=!1;for(let[o,a]of h(this,Ye)){let l=a instanceof Te?a.serialize(!1,s):a;l&&(e.set(o,l),t.update(`${o}:${JSON.stringify(l)}`),r||(r=!!l.bitmap))}if(r)for(let o of e.values())o.bitmap&&n.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:IS}get editorStats(){let e=null,t=new Map;for(let n of h(this,Ye).values()){if(!(n instanceof Te))continue;let s=n.telemetryFinalData;if(!s)continue;let{type:r}=s;t.has(r)||t.set(r,Object.getPrototypeOf(n).constructor),e||(e=Object.create(null));let o=e[r]||(e[r]=new Map);for(let[a,l]of Object.entries(s)){if(a==="type")continue;let c=o.get(a);c||(c=new Map,o.set(a,c));let d=c.get(l)??0;c.set(l,d+1)}}for(let[n,s]of t)e[n]=s.computeTelemetryFinalData(e[n]);return e}resetModifiedIds(){w(this,ho,null)}get modifiedIds(){if(h(this,ho))return h(this,ho);let e=[];for(let t of h(this,Ye).values())!(t instanceof Te)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return w(this,ho,{ids:new Set(e),hash:e.join(",")})}};uo=new WeakMap,ho=new WeakMap,Ye=new WeakMap,Wm=new WeakSet,vR=function(){h(this,uo)||(w(this,uo,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Nu,Vg=class extends Ud{constructor(t){super();E(this,Nu,void 0);let{map:n,hash:s,transfer:r}=t.serializable,o=structuredClone(n,r?{transfer:r}:null);w(this,Nu,{map:o,hash:s,transfer:r})}get print(){me("Should not call PrintAnnotationStorage.print")}get serializable(){return h(this,Nu)}get modifiedIds(){return ie(this,"modifiedIds",{ids:new Set,hash:""})}};Nu=new WeakMap;var Al,MS=class{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){E(this,Al,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),h(this,Al).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||h(this,Al).has(e.loadedName))){if(Le(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:n,src:s,style:r}=e,o=new FontFace(n,s,r);this.addNativeFontFace(o);try{await o.load(),h(this,Al).add(n),t?.(e)}catch{j(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}me("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){let n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(s){throw j(`Failed to load font '${n.family}': '${s}'.`),e.disableFontFace=!0,s}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{let s=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,s)})}}get isFontLoadingAPISupported(){let e=!!this._document?.fonts;return ie(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(yt||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),ie(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(Le(!s.done,"completeRequest() cannot be called twice."),s.done=!0;n.length>0&&n[0].done;){let r=n.shift();setTimeout(r.callback,0)}}let{loadingRequests:n}=this,s={done:!1,complete:t,callback:e};return n.push(s),s}get _loadTestFont(){let e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return ie(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(_,R){return _.charCodeAt(R)<<24|_.charCodeAt(R+1)<<16|_.charCodeAt(R+2)<<8|_.charCodeAt(R+3)&255}function s(_,R,I,M){let k=_.substring(0,R),N=_.substring(R+I);return k+M+N}let r,o,a=this._document.createElement("canvas");a.width=1,a.height=1;let l=a.getContext("2d"),c=0;function d(_,R){if(++c>30){j("Load test font never loaded."),R();return}if(l.font="30px "+_,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){R();return}setTimeout(d.bind(null,_,R))}let u=`lt${Date.now()}${this.loadTestFontId++}`,p=this._loadTestFont;p=s(p,976,u.length,u);let y=16,v=1482184792,b=n(p,y);for(r=0,o=u.length-3;r<o;r+=4)b=b-v+n(u,r)|0;r<u.length&&(b=b-v+n(u+"XXX",r)|0),p=s(p,y,4,lU(b));let S=`url(data:font/opentype;base64,${btoa(p)});`,C=`@font-face {font-family:"${u}";src:${S}}`;this.insertRule(C);let T=this._document.createElement("div");T.style.visibility="hidden",T.style.width=T.style.height="10px",T.style.position="absolute",T.style.top=T.style.left="0px";for(let _ of[e.loadedName,u]){let R=this._document.createElement("span");R.textContent="Hi",R.style.fontFamily=_,T.append(R)}this._document.body.append(T),d(u,()=>{T.remove(),t.complete()})}};Al=new WeakMap;var PS=class{constructor(e,{disableFontFace:t=!1,fontExtraProperties:n=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(let r in e)this[r]=e[r];this.disableFontFace=t===!0,this.fontExtraProperties=n===!0,this._inspectFont=s}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{let t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let e=`url(data:${this.mimetype};base64,${pU(this.data)});`,t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let n=this.loadedName+"_path_"+t,s;try{s=e.get(n)}catch(o){j(`getPathGenerator - ignoring character: "${o}".`)}let r=new Path2D(s||"");return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=r}},tg={DATA:1,ERROR:2},Fe={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Dx(){}function Mt(i){if(i instanceof Si||i instanceof Nd||i instanceof aa||i instanceof Lg||i instanceof Pc||i instanceof Md)return i;switch(i instanceof Error||typeof i=="object"&&i!==null||me('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),i.name){case"AbortException":return new Si(i.message);case"InvalidPDFException":return new Nd(i.message);case"MissingPDFException":return new aa(i.message);case"PasswordException":return new Lg(i.message,i.code);case"UnexpectedResponseException":return new Pc(i.message,i.status);case"UnknownErrorException":return new Md(i.message,i.details)}return new Md(i.message,i.toString())}var Cl,qm,bR,Ym,ER,Km,SR,Tl,gg,Vr=class{constructor(e,t,n){E(this,qm);E(this,Ym);E(this,Km);E(this,Tl);E(this,Cl,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",A(this,qm,bR).bind(this),{signal:h(this,Cl).signal})}on(e,t){let n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){let s=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[s]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},n)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,n,s){let r=this.streamId++,o=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{let d=Promise.withResolvers();return this.streamControllers[r]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:o,targetName:a,action:e,streamId:r,data:t,desiredSize:c.desiredSize},s),d.promise},pull:c=>{let d=Promise.withResolvers();return this.streamControllers[r].pullCall=d,l.postMessage({sourceName:o,targetName:a,stream:Fe.PULL,streamId:r,desiredSize:c.desiredSize}),d.promise},cancel:c=>{Le(c instanceof Error,"cancel must have a valid reason");let d=Promise.withResolvers();return this.streamControllers[r].cancelCall=d,this.streamControllers[r].isClosed=!0,l.postMessage({sourceName:o,targetName:a,stream:Fe.CANCEL,streamId:r,reason:Mt(c)}),d.promise}},n)}destroy(){h(this,Cl)?.abort(),w(this,Cl,null)}};Cl=new WeakMap,qm=new WeakSet,bR=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){A(this,Km,SR).call(this,e);return}if(e.callback){let n=e.callbackId,s=this.callbackCapabilities[n];if(!s)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===tg.DATA)s.resolve(e.data);else if(e.callback===tg.ERROR)s.reject(Mt(e.reason));else throw new Error("Unexpected callback case");return}let t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){let n=this.sourceName,s=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:n,targetName:s,callback:tg.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:n,targetName:s,callback:tg.ERROR,callbackId:e.callbackId,reason:Mt(o)})});return}if(e.streamId){A(this,Ym,ER).call(this,e);return}t(e.data)},Ym=new WeakSet,ER=function(e){let t=e.streamId,n=this.sourceName,s=e.sourceName,r=this.comObj,o=this,a=this.actionHandler[e.action],l={enqueue(c,d=1,u){if(this.isCancelled)return;let p=this.desiredSize;this.desiredSize-=d,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:n,targetName:s,stream:Fe.ENQUEUE,streamId:t,chunk:c},u)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:Fe.CLOSE,streamId:t}),delete o.streamSinks[t])},error(c){Le(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:Fe.ERROR,streamId:t,reason:Mt(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){r.postMessage({sourceName:n,targetName:s,stream:Fe.START_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:n,targetName:s,stream:Fe.START_COMPLETE,streamId:t,reason:Mt(c)})})},Km=new WeakSet,SR=function(e){let t=e.streamId,n=this.sourceName,s=e.sourceName,r=this.comObj,o=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case Fe.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(Mt(e.reason));break;case Fe.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(Mt(e.reason));break;case Fe.PULL:if(!a){r.postMessage({sourceName:n,targetName:s,stream:Fe.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||Dx).then(function(){r.postMessage({sourceName:n,targetName:s,stream:Fe.PULL_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:n,targetName:s,stream:Fe.PULL_COMPLETE,streamId:t,reason:Mt(c)})});break;case Fe.ENQUEUE:if(Le(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case Fe.CLOSE:if(Le(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),A(this,Tl,gg).call(this,o,t);break;case Fe.ERROR:Le(o,"error should have stream controller"),o.controller.error(Mt(e.reason)),A(this,Tl,gg).call(this,o,t);break;case Fe.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(Mt(e.reason)),A(this,Tl,gg).call(this,o,t);break;case Fe.CANCEL:if(!a)break;let l=Mt(e.reason);Promise.try(a.onCancel||Dx,l).then(function(){r.postMessage({sourceName:n,targetName:s,stream:Fe.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){r.postMessage({sourceName:n,targetName:s,stream:Fe.CANCEL_COMPLETE,streamId:t,reason:Mt(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Tl=new WeakSet,gg=async function(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]};var Fu,Gg=class{constructor({enableHWA:e=!1}){E(this,Fu,!1);w(this,Fu,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");let n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!h(this,Fu)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){me("Abstract method `_createCanvas` called.")}};Fu=new WeakMap;var kS=class extends Gg{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){let n=this._document.createElement("canvas");return n.width=e,n.height=t,n}},zg=class{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");let t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){me("Abstract method `_fetch` called.")}},Wg=class extends zg{async _fetch(e){let t=await ev(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Qy(t)}},qg=class{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,s,r){return"none"}destroy(e=!1){}},fo,_l,Xi,Ji,ft,po,go,Ke,dt,mo,bd,Vs,Wa,xl,mg,Gs,qa,Xm,wR,Lu,FS,zs,Ya,yo,Ed,vo,Sd,Ou,LS,bo,wd,NS=class extends qg{constructor({docId:t,ownerDocument:n=globalThis.document}){super();E(this,Ke);E(this,mo);E(this,Vs);E(this,xl);E(this,Gs);E(this,Xm);E(this,Lu);E(this,zs);E(this,yo);E(this,vo);E(this,Ou);E(this,bo);E(this,fo,void 0);E(this,_l,void 0);E(this,Xi,void 0);E(this,Ji,void 0);E(this,ft,void 0);E(this,po,void 0);E(this,go,0);w(this,Ji,t),w(this,ft,n)}addFilter(t){if(!t)return"none";let n=h(this,Ke,dt).get(t);if(n)return n;let[s,r,o]=A(this,xl,mg).call(this,t),a=t.length===1?s:`${s}${r}${o}`;if(n=h(this,Ke,dt).get(a),n)return h(this,Ke,dt).set(t,n),n;let l=`g_${h(this,Ji)}_transfer_map_${bt(this,go)._++}`,c=A(this,Gs,qa).call(this,l);h(this,Ke,dt).set(t,c),h(this,Ke,dt).set(a,c);let d=A(this,zs,Ya).call(this,l);return A(this,vo,Sd).call(this,s,r,o,d),c}addHCMFilter(t,n){let s=`${t}-${n}`,r="base",o=h(this,mo,bd).get(r);if(o?.key===s||(o?(o.filter?.remove(),o.key=s,o.url="none",o.filter=null):(o={key:s,url:"none",filter:null},h(this,mo,bd).set(r,o)),!t||!n))return o.url;let a=A(this,bo,wd).call(this,t);t=V.makeHexColor(...a);let l=A(this,bo,wd).call(this,n);if(n=V.makeHexColor(...l),h(this,Vs,Wa).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return o.url;let c=new Array(256);for(let y=0;y<=255;y++){let v=y/255;c[y]=v<=.03928?v/12.92:((v+.055)/1.055)**2.4}let d=c.join(","),u=`g_${h(this,Ji)}_hcm_filter`,p=o.filter=A(this,zs,Ya).call(this,u);A(this,vo,Sd).call(this,d,d,d,p),A(this,Lu,FS).call(this,p);let m=(y,v)=>{let b=a[y]/255,S=l[y]/255,C=new Array(v+1);for(let T=0;T<=v;T++)C[T]=b+T/v*(S-b);return C.join(",")};return A(this,vo,Sd).call(this,m(0,5),m(1,5),m(2,5),p),o.url=A(this,Gs,qa).call(this,u),o.url}addAlphaFilter(t){let n=h(this,Ke,dt).get(t);if(n)return n;let[s]=A(this,xl,mg).call(this,[t]),r=`alpha_${s}`;if(n=h(this,Ke,dt).get(r),n)return h(this,Ke,dt).set(t,n),n;let o=`g_${h(this,Ji)}_alpha_map_${bt(this,go)._++}`,a=A(this,Gs,qa).call(this,o);h(this,Ke,dt).set(t,a),h(this,Ke,dt).set(r,a);let l=A(this,zs,Ya).call(this,o);return A(this,Ou,LS).call(this,s,l),a}addLuminosityFilter(t){let n=h(this,Ke,dt).get(t||"luminosity");if(n)return n;let s,r;if(t?([s]=A(this,xl,mg).call(this,[t]),r=`luminosity_${s}`):r="luminosity",n=h(this,Ke,dt).get(r),n)return h(this,Ke,dt).set(t,n),n;let o=`g_${h(this,Ji)}_luminosity_map_${bt(this,go)._++}`,a=A(this,Gs,qa).call(this,o);h(this,Ke,dt).set(t,a),h(this,Ke,dt).set(r,a);let l=A(this,zs,Ya).call(this,o);return A(this,Xm,wR).call(this,l),t&&A(this,Ou,LS).call(this,s,l),a}addHighlightHCMFilter(t,n,s,r,o){let a=`${n}-${s}-${r}-${o}`,l=h(this,mo,bd).get(t);if(l?.key===a||(l?(l.filter?.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},h(this,mo,bd).set(t,l)),!n||!s))return l.url;let[c,d]=[n,s].map(A(this,bo,wd).bind(this)),u=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),p=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[m,y]=[r,o].map(A(this,bo,wd).bind(this));p<u&&([u,p,m,y]=[p,u,y,m]),h(this,Vs,Wa).style.color="";let v=(C,T,_)=>{let R=new Array(256),I=(p-u)/_,M=C/255,k=(T-C)/(255*_),N=0;for(let F=0;F<=_;F++){let $=Math.round(u+F*I),ae=M+F*k;for(let K=N;K<=$;K++)R[K]=ae;N=$+1}for(let F=N;F<256;F++)R[F]=R[N-1];return R.join(",")},b=`g_${h(this,Ji)}_hcm_${t}_filter`,S=l.filter=A(this,zs,Ya).call(this,b);return A(this,Lu,FS).call(this,S),A(this,vo,Sd).call(this,v(m[0],y[0],5),v(m[1],y[1],5),v(m[2],y[2],5),S),l.url=A(this,Gs,qa).call(this,b),l.url}destroy(t=!1){t&&h(this,po)?.size||(h(this,Xi)?.parentNode.parentNode.remove(),w(this,Xi,null),h(this,_l)?.clear(),w(this,_l,null),h(this,po)?.clear(),w(this,po,null),w(this,go,0))}};fo=new WeakMap,_l=new WeakMap,Xi=new WeakMap,Ji=new WeakMap,ft=new WeakMap,po=new WeakMap,go=new WeakMap,Ke=new WeakSet,dt=function(){return h(this,_l)||w(this,_l,new Map)},mo=new WeakSet,bd=function(){return h(this,po)||w(this,po,new Map)},Vs=new WeakSet,Wa=function(){if(!h(this,Xi)){let t=h(this,ft).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;let s=h(this,ft).createElementNS(Oi,"svg");s.setAttribute("width",0),s.setAttribute("height",0),w(this,Xi,h(this,ft).createElementNS(Oi,"defs")),t.append(s),s.append(h(this,Xi)),h(this,ft).body.append(t)}return h(this,Xi)},xl=new WeakSet,mg=function(t){if(t.length===1){let c=t[0],d=new Array(256);for(let p=0;p<256;p++)d[p]=c[p]/255;let u=d.join(",");return[u,u,u]}let[n,s,r]=t,o=new Array(256),a=new Array(256),l=new Array(256);for(let c=0;c<256;c++)o[c]=n[c]/255,a[c]=s[c]/255,l[c]=r[c]/255;return[o.join(","),a.join(","),l.join(",")]},Gs=new WeakSet,qa=function(t){if(h(this,fo)===void 0){w(this,fo,"");let n=h(this,ft).URL;n!==h(this,ft).baseURI&&(tv(n)?j('#createUrl: ignore "data:"-URL for performance reasons.'):w(this,fo,n.split("#",1)[0]))}return`url(${h(this,fo)}#${t})`},Xm=new WeakSet,wR=function(t){let n=h(this,ft).createElementNS(Oi,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},Lu=new WeakSet,FS=function(t){let n=h(this,ft).createElementNS(Oi,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},zs=new WeakSet,Ya=function(t){let n=h(this,ft).createElementNS(Oi,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),h(this,Vs,Wa).append(n),n},yo=new WeakSet,Ed=function(t,n,s){let r=h(this,ft).createElementNS(Oi,n);r.setAttribute("type","discrete"),r.setAttribute("tableValues",s),t.append(r)},vo=new WeakSet,Sd=function(t,n,s,r){let o=h(this,ft).createElementNS(Oi,"feComponentTransfer");r.append(o),A(this,yo,Ed).call(this,o,"feFuncR",t),A(this,yo,Ed).call(this,o,"feFuncG",n),A(this,yo,Ed).call(this,o,"feFuncB",s)},Ou=new WeakSet,LS=function(t,n){let s=h(this,ft).createElementNS(Oi,"feComponentTransfer");n.append(s),A(this,yo,Ed).call(this,s,"feFuncA",t)},bo=new WeakSet,wd=function(t){return h(this,Vs,Wa).style.color=t,AA(getComputedStyle(h(this,Vs,Wa)).getPropertyValue("color"))};var Yg=class{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");let t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){me("Abstract method `_fetch` called.")}},Kg=class extends Yg{async _fetch(e){let t=await ev(e,"arraybuffer");return new Uint8Array(t)}};yt&&j("Please use the `legacy` build in Node.js environments.");async function AR(i){let t=await process.getBuiltinModule("fs").promises.readFile(i);return new Uint8Array(t)}var OS=class extends qg{},US=class extends Gg{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(KU.url)("@napi-rs/canvas").createCanvas(e,t)}},BS=class extends zg{async _fetch(e){return AR(e)}},HS=class extends Yg{async _fetch(e){return AR(e)}},mt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function $S(i,e){if(!e)return;let t=e[2]-e[0],n=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,n),i.clip(s)}var Bd=class{getPattern(){me("Abstract method `getPattern` called.")}},VS=class extends Bd{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,s){let r;if(s===mt.STROKE||s===mt.FILL){let o=t.current.getClippedPathBoundingBox(s,Se(e))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,l=Math.ceil(o[3]-o[1])||1,c=t.cachedCanvases.getCanvas("pattern",a,l),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-o[0],-o[1]),n=V.transform(n,[1,0,0,1,o[0],o[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),$S(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),r=e.createPattern(c.canvas,"no-repeat");let u=new DOMMatrix(n);r.setTransform(u)}else $S(e,this._bbox),r=this._createGradient(e);return r}};function nS(i,e,t,n,s,r,o,a){let l=e.coords,c=e.colors,d=i.data,u=i.width*4,p;l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=r,r=o,o=p),l[n+1]>l[s+1]&&(p=n,n=s,s=p,p=o,o=a,a=p),l[t+1]>l[n+1]&&(p=t,t=n,n=p,p=r,r=o,o=p);let m=(l[t]+e.offsetX)*e.scaleX,y=(l[t+1]+e.offsetY)*e.scaleY,v=(l[n]+e.offsetX)*e.scaleX,b=(l[n+1]+e.offsetY)*e.scaleY,S=(l[s]+e.offsetX)*e.scaleX,C=(l[s+1]+e.offsetY)*e.scaleY;if(y>=C)return;let T=c[r],_=c[r+1],R=c[r+2],I=c[o],M=c[o+1],k=c[o+2],N=c[a],F=c[a+1],$=c[a+2],ae=Math.round(y),K=Math.round(C),se,ze,L,q,Vt,Zn,ki,cn;for(let at=ae;at<=K;at++){if(at<b){let be=at<y?0:(y-at)/(y-b);se=m-(m-v)*be,ze=T-(T-I)*be,L=_-(_-M)*be,q=R-(R-k)*be}else{let be;at>C?be=1:b===C?be=0:be=(b-at)/(b-C),se=v-(v-S)*be,ze=I-(I-N)*be,L=M-(M-F)*be,q=k-(k-$)*be}let Ue;at<y?Ue=0:at>C?Ue=1:Ue=(y-at)/(y-C),Vt=m-(m-S)*Ue,Zn=T-(T-N)*Ue,ki=_-(_-F)*Ue,cn=R-(R-$)*Ue;let Pa=Math.round(Math.min(se,Vt)),ed=Math.round(Math.max(se,Vt)),_t=u*at+Pa*4;for(let be=Pa;be<=ed;be++)Ue=(se-be)/(se-Vt),Ue<0?Ue=0:Ue>1&&(Ue=1),d[_t++]=ze-(ze-Zn)*Ue|0,d[_t++]=L-(L-ki)*Ue|0,d[_t++]=q-(q-cn)*Ue|0,d[_t++]=255}}function bU(i,e,t){let n=e.coords,s=e.colors,r,o;switch(e.type){case"lattice":let a=e.verticesPerRow,l=Math.floor(n.length/a)-1,c=a-1;for(r=0;r<l;r++){let d=r*a;for(let u=0;u<c;u++,d++)nS(i,t,n[d],n[d+1],n[d+a],s[d],s[d+1],s[d+a]),nS(i,t,n[d+a+1],n[d+1],n[d+a],s[d+a+1],s[d+1],s[d+a])}break;case"triangles":for(r=0,o=n.length;r<o;r+=3)nS(i,t,n[r],n[r+1],n[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}var GS=class extends Bd{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){let a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,d=Math.ceil(this._bounds[3])-l,u=Math.min(Math.ceil(Math.abs(c*e[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),m=c/u,y=d/p,v={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/m,scaleY:1/y},b=u+2*2,S=p+2*2,C=n.getCanvas("mesh",b,S),T=C.context,_=T.createImageData(u,p);if(t){let I=_.data;for(let M=0,k=I.length;M<k;M+=4)I[M]=t[0],I[M+1]=t[1],I[M+2]=t[2],I[M+3]=255}for(let I of this._figures)bU(_,I,v);return T.putImageData(_,2,2),{canvas:C.canvas,offsetX:a-2*m,offsetY:l-2*y,scaleX:m,scaleY:y}}getPattern(e,t,n,s){$S(e,this._bbox);let r;if(s===mt.SHADING)r=V.singularValueDecompose2dScale(Se(e));else if(r=V.singularValueDecompose2dScale(t.baseTransform),this.matrix){let a=V.singularValueDecompose2dScale(this.matrix);r=[r[0]*a[0],r[1]*a[1]]}let o=this._createMeshCanvas(r,s===mt.SHADING?null:this._background,t.cachedCanvases);return s!==mt.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}},zS=class extends Bd{getPattern(){return"hotpink"}};function EU(i){switch(i[0]){case"RadialAxial":return new VS(i);case"Mesh":return new GS(i);case"Dummy":return new zS}throw new Error(`Unknown IR type: ${i[0]}`)}var Ix={COLORED:1,UNCOLORED:2},Jm=class Jm{constructor(e,t,n,s,r){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=s,this.baseTransform=r}createPatternCanvas(e){let{bbox:t,operatorList:n,paintType:s,tilingType:r,color:o,canvasGraphicsFactory:a}=this,{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),jy("TilingType: "+r);let d=t[0],u=t[1],p=t[2],m=t[3],y=p-d,v=m-u,b=V.singularValueDecompose2dScale(this.matrix),S=V.singularValueDecompose2dScale(this.baseTransform),C=b[0]*S[0],T=b[1]*S[1],_=y,R=v,I=!1,M=!1,k=Math.ceil(l*C),N=Math.ceil(c*T),F=Math.ceil(y*C),$=Math.ceil(v*T);k>=F?_=l:I=!0,N>=$?R=c:M=!0;let ae=this.getSizeAndScale(_,this.ctx.canvas.width,C),K=this.getSizeAndScale(R,this.ctx.canvas.height,T),se=e.cachedCanvases.getCanvas("pattern",ae.size,K.size),ze=se.context,L=a.createCanvasGraphics(ze);if(L.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(L,s,o),ze.translate(-ae.scale*d,-K.scale*u),L.transform(ae.scale,0,0,K.scale,0,0),ze.save(),this.clipBbox(L,d,u,p,m),L.baseTransform=Se(L.ctx),L.executeOperatorList(n),L.endDrawing(),ze.restore(),I||M){let q=se.canvas;I&&(_=l),M&&(R=c);let Vt=this.getSizeAndScale(_,this.ctx.canvas.width,C),Zn=this.getSizeAndScale(R,this.ctx.canvas.height,T),ki=Vt.size,cn=Zn.size,at=e.cachedCanvases.getCanvas("pattern-workaround",ki,cn),Ue=at.context,Pa=I?Math.floor(y/l):0,ed=M?Math.floor(v/c):0;for(let _t=0;_t<=Pa;_t++)for(let be=0;be<=ed;be++)Ue.drawImage(q,ki*_t,cn*be,ki,cn,0,0,ki,cn);return{canvas:at.canvas,scaleX:Vt.scale,scaleY:Zn.scale,offsetX:d,offsetY:u}}return{canvas:se.canvas,scaleX:ae.scale,scaleY:K.scale,offsetX:d,offsetY:u}}getSizeAndScale(e,t,n){let s=Math.max(Jm.MAX_PATTERN_SIZE,t),r=Math.ceil(e*n);return r>=s?r=s:n=r/e,{scale:n,size:r}}clipBbox(e,t,n,s,r){let o=s-t,a=r-n;e.ctx.rect(t,n,o,a),e.current.updateRectMinMax(Se(e.ctx),[t,n,s,r]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){let s=e.ctx,r=e.current;switch(t){case Ix.COLORED:let o=this.ctx;s.fillStyle=o.fillStyle,s.strokeStyle=o.strokeStyle,r.fillColor=o.fillStyle,r.strokeColor=o.strokeStyle;break;case Ix.UNCOLORED:let a=V.makeHexColor(n[0],n[1],n[2]);s.fillStyle=a,s.strokeStyle=a,r.fillColor=a,r.strokeColor=a;break;default:throw new oS(`Unsupported paint type: ${t}`)}}getPattern(e,t,n,s){let r=n;s!==mt.SHADING&&(r=V.transform(r,t.baseTransform),this.matrix&&(r=V.transform(r,this.matrix)));let o=this.createPatternCanvas(t),a=new DOMMatrix(r);a=a.translate(o.offsetX,o.offsetY),a=a.scale(1/o.scaleX,1/o.scaleY);let l=e.createPattern(o.canvas,"repeat");return l.setTransform(a),l}};Y(Jm,"MAX_PATTERN_SIZE",3e3);var WS=Jm;function SU({src:i,srcPos:e=0,dest:t,width:n,height:s,nonBlackColor:r=4294967295,inverseDecode:o=!1}){let a=st.isLittleEndian?4278190080:255,[l,c]=o?[r,a]:[a,r],d=n>>3,u=n&7,p=i.length;t=new Uint32Array(t.buffer);let m=0;for(let y=0;y<s;y++){for(let b=e+d;e<b;e++){let S=e<p?i[e]:255;t[m++]=S&128?c:l,t[m++]=S&64?c:l,t[m++]=S&32?c:l,t[m++]=S&16?c:l,t[m++]=S&8?c:l,t[m++]=S&4?c:l,t[m++]=S&2?c:l,t[m++]=S&1?c:l}if(u===0)continue;let v=e<p?i[e++]:255;for(let b=0;b<u;b++)t[m++]=v&1<<7-b?c:l}return{srcPos:e,destPos:m}}var Mx=16,Px=100,wU=15,kx=10,Nx=1e3,Lt=16;function AU(i,e){if(i._removeMirroring)throw new Error("Context is already forwarding operations.");i.__originalSave=i.save,i.__originalRestore=i.restore,i.__originalRotate=i.rotate,i.__originalScale=i.scale,i.__originalTranslate=i.translate,i.__originalTransform=i.transform,i.__originalSetTransform=i.setTransform,i.__originalResetTransform=i.resetTransform,i.__originalClip=i.clip,i.__originalMoveTo=i.moveTo,i.__originalLineTo=i.lineTo,i.__originalBezierCurveTo=i.bezierCurveTo,i.__originalRect=i.rect,i.__originalClosePath=i.closePath,i.__originalBeginPath=i.beginPath,i._removeMirroring=()=>{i.save=i.__originalSave,i.restore=i.__originalRestore,i.rotate=i.__originalRotate,i.scale=i.__originalScale,i.translate=i.__originalTranslate,i.transform=i.__originalTransform,i.setTransform=i.__originalSetTransform,i.resetTransform=i.__originalResetTransform,i.clip=i.__originalClip,i.moveTo=i.__originalMoveTo,i.lineTo=i.__originalLineTo,i.bezierCurveTo=i.__originalBezierCurveTo,i.rect=i.__originalRect,i.closePath=i.__originalClosePath,i.beginPath=i.__originalBeginPath,delete i._removeMirroring},i.save=function(){e.save(),this.__originalSave()},i.restore=function(){e.restore(),this.__originalRestore()},i.translate=function(n,s){e.translate(n,s),this.__originalTranslate(n,s)},i.scale=function(n,s){e.scale(n,s),this.__originalScale(n,s)},i.transform=function(n,s,r,o,a,l){e.transform(n,s,r,o,a,l),this.__originalTransform(n,s,r,o,a,l)},i.setTransform=function(n,s,r,o,a,l){e.setTransform(n,s,r,o,a,l),this.__originalSetTransform(n,s,r,o,a,l)},i.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},i.rotate=function(n){e.rotate(n),this.__originalRotate(n)},i.clip=function(n){e.clip(n),this.__originalClip(n)},i.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},i.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},i.bezierCurveTo=function(t,n,s,r,o,a){e.bezierCurveTo(t,n,s,r,o,a),this.__originalBezierCurveTo(t,n,s,r,o,a)},i.rect=function(t,n,s,r){e.rect(t,n,s,r),this.__originalRect(t,n,s,r)},i.closePath=function(){e.closePath(),this.__originalClosePath()},i.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}var qS=class{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,n)):(s=this.canvasFactory.create(t,n),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}};function ng(i,e,t,n,s,r,o,a,l,c){let[d,u,p,m,y,v]=Se(i);if(u===0&&p===0){let C=o*d+y,T=Math.round(C),_=a*m+v,R=Math.round(_),I=(o+l)*d+y,M=Math.abs(Math.round(I)-T)||1,k=(a+c)*m+v,N=Math.abs(Math.round(k)-R)||1;return i.setTransform(Math.sign(d),0,0,Math.sign(m),T,R),i.drawImage(e,t,n,s,r,0,0,M,N),i.setTransform(d,u,p,m,y,v),[M,N]}if(d===0&&m===0){let C=a*p+y,T=Math.round(C),_=o*u+v,R=Math.round(_),I=(a+c)*p+y,M=Math.abs(Math.round(I)-T)||1,k=(o+l)*u+v,N=Math.abs(Math.round(k)-R)||1;return i.setTransform(0,Math.sign(u),Math.sign(p),0,T,R),i.drawImage(e,t,n,s,r,0,0,N,M),i.setTransform(d,u,p,m,y,v),[N,M]}i.drawImage(e,t,n,s,r,o,a,l,c);let b=Math.hypot(d,u),S=Math.hypot(p,m);return[b*l,S*c]}function CU(i){let{width:e,height:t}=i;if(e>Nx||t>Nx)return null;let n=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=e+1,o=new Uint8Array(r*(t+1)),a,l,c,d=e+7&-8,u=new Uint8Array(d*t),p=0;for(let S of i.data){let C=128;for(;C>0;)u[p++]=S&C?0:255,C>>=1}let m=0;for(p=0,u[p]!==0&&(o[0]=1,++m),l=1;l<e;l++)u[p]!==u[p+1]&&(o[l]=u[p]?2:1,++m),p++;for(u[p]!==0&&(o[l]=2,++m),a=1;a<t;a++){p=a*d,c=a*r,u[p-d]!==u[p]&&(o[c]=u[p]?1:8,++m);let S=(u[p]?4:0)+(u[p-d]?8:0);for(l=1;l<e;l++)S=(S>>2)+(u[p+1]?4:0)+(u[p-d+1]?8:0),s[S]&&(o[c+l]=s[S],++m),p++;if(u[p-d]!==u[p]&&(o[c+l]=u[p]?2:4,++m),m>n)return null}for(p=d*(t-1),c=a*r,u[p]!==0&&(o[c]=8,++m),l=1;l<e;l++)u[p]!==u[p+1]&&(o[c+l]=u[p]?4:8,++m),p++;if(u[p]!==0&&(o[c+l]=4,++m),m>n)return null;let y=new Int32Array([0,r,-1,0,-r,0,0,0,1]),v=new Path2D;for(a=0;m&&a<=t;a++){let S=a*r,C=S+e;for(;S<C&&!o[S];)S++;if(S===C)continue;v.moveTo(S%r,a);let T=S,_=o[S];do{let R=y[_];do S+=R;while(!o[S]);let I=o[S];I!==5&&I!==10?(_=I,o[S]=0):(_=I&51*_>>4,o[S]&=_>>2|_<<2),v.lineTo(S%r,S/r|0),o[S]||--m}while(T!==S);--a}return u=null,o=null,function(S){S.save(),S.scale(1/e,-1/t),S.translate(0,-t),S.fill(v),S.beginPath(),S.restore()}}var Xg=class{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=$x,this.textMatrixScale=1,this.fontMatrix=rS,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=ct.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=V.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(e,t){let n=V.applyTransform(t,e),s=V.applyTransform(t.slice(2),e),r=V.applyTransform([t[0],t[3]],e),o=V.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,n[0],s[0],r[0],o[0]),this.minY=Math.min(this.minY,n[1],s[1],r[1],o[1]),this.maxX=Math.max(this.maxX,n[0],s[0],r[0],o[0]),this.maxY=Math.max(this.maxY,n[1],s[1],r[1],o[1])}updateScalingPathMinMax(e,t){V.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,s,r,o,a,l,c,d){let u=V.bezierBoundingBox(t,n,s,r,o,a,l,c,d);d||this.updateRectMinMax(e,u)}getPathBoundingBox(e=mt.FILL,t=null){let n=[this.minX,this.minY,this.maxX,this.maxY];if(e===mt.STROKE){t||me("Stroke bounding box must include transform.");let s=V.singularValueDecompose2dScale(t),r=s[0]*this.lineWidth/2,o=s[1]*this.lineWidth/2;n[0]-=r,n[1]-=o,n[2]+=r,n[3]+=o}return n}updateClipFromPath(){let e=V.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=mt.FILL,t=null){return V.intersect(this.clipBox,this.getPathBoundingBox(e,t))}};function Fx(i,e){if(e instanceof ImageData){i.putImageData(e,0,0);return}let t=e.height,n=e.width,s=t%Lt,r=(t-s)/Lt,o=s===0?r:r+1,a=i.createImageData(n,Lt),l=0,c,d=e.data,u=a.data,p,m,y,v;if(e.kind===og.GRAYSCALE_1BPP){let b=d.byteLength,S=new Uint32Array(u.buffer,0,u.byteLength>>2),C=S.length,T=n+7>>3,_=4294967295,R=st.isLittleEndian?4278190080:255;for(p=0;p<o;p++){for(y=p<r?Lt:s,c=0,m=0;m<y;m++){let I=b-l,M=0,k=I>T?n:I*8-7,N=k&-8,F=0,$=0;for(;M<N;M+=8)$=d[l++],S[c++]=$&128?_:R,S[c++]=$&64?_:R,S[c++]=$&32?_:R,S[c++]=$&16?_:R,S[c++]=$&8?_:R,S[c++]=$&4?_:R,S[c++]=$&2?_:R,S[c++]=$&1?_:R;for(;M<k;M++)F===0&&($=d[l++],F=128),S[c++]=$&F?_:R,F>>=1}for(;c<C;)S[c++]=0;i.putImageData(a,0,p*Lt)}}else if(e.kind===og.RGBA_32BPP){for(m=0,v=n*Lt*4,p=0;p<r;p++)u.set(d.subarray(l,l+v)),l+=v,i.putImageData(a,0,m),m+=Lt;p<o&&(v=n*s*4,u.set(d.subarray(l,l+v)),i.putImageData(a,0,m))}else if(e.kind===og.RGB_24BPP)for(y=Lt,v=n*y,p=0;p<o;p++){for(p>=r&&(y=s,v=n*y),c=0,m=v;m--;)u[c++]=d[l++],u[c++]=d[l++],u[c++]=d[l++],u[c++]=255;i.putImageData(a,0,p*Lt)}else throw new Error(`bad image kind: ${e.kind}`)}function Lx(i,e){if(e.bitmap){i.drawImage(e.bitmap,0,0);return}let t=e.height,n=e.width,s=t%Lt,r=(t-s)/Lt,o=s===0?r:r+1,a=i.createImageData(n,Lt),l=0,c=e.data,d=a.data;for(let u=0;u<o;u++){let p=u<r?Lt:s;({srcPos:l}=SU({src:c,srcPos:l,dest:d,width:n,height:p,nonBlackColor:0})),i.putImageData(a,0,u*Lt)}}function hd(i,e){let t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let n of t)i[n]!==void 0&&(e[n]=i[n]);i.setLineDash!==void 0&&(e.setLineDash(i.getLineDash()),e.lineDashOffset=i.lineDashOffset)}function ig(i){if(i.strokeStyle=i.fillStyle="#000000",i.fillRule="nonzero",i.globalAlpha=1,i.lineWidth=1,i.lineCap="butt",i.lineJoin="miter",i.miterLimit=10,i.globalCompositeOperation="source-over",i.font="10px sans-serif",i.setLineDash!==void 0&&(i.setLineDash([]),i.lineDashOffset=0),!yt){let{filter:e}=i;e!=="none"&&e!==""&&(i.filter="none")}}function Ox(i,e){if(e)return!0;let t=V.singularValueDecompose2dScale(i);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);let n=Math.fround((globalThis.devicePixelRatio||1)*fr.PDF_TO_CSS_UNITS);return t[0]<=n&&t[1]<=n}var TU=["butt","round","square"],_U=["miter","round","bevel"],xU={},Ux={},Uu,YS,Bu,KS,Hu,XS,_A=class _A{constructor(e,t,n,s,r,{optionalContentConfig:o,markedContentStack:a=null},l,c){E(this,Uu);E(this,Bu);E(this,Hu);this.ctx=e,this.current=new Xg(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=s,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new qS(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:s=null}){let r=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=a,n){let l=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Se(this.compositeCtx))}this.ctx.save(),ig(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Se(this.ctx)}executeOperatorList(e,t,n,s){let r=e.argsArray,o=e.fnArray,a=t||0,l=r.length;if(l===a)return a;let c=l-a>kx&&typeof n=="function",d=c?Date.now()+wU:0,u=0,p=this.commonObjs,m=this.objs,y;for(;;){if(s!==void 0&&a===s.nextBreakPoint)return s.breakIt(a,n),a;if(y=o[a],y!==Mn.dependency)this[y].apply(this,r[a]);else for(let v of r[a]){let b=v.startsWith("g_")?p:m;if(!b.has(v))return b.get(v,n),a}if(a++,a===l)return a;if(c&&++u>kx){if(Date.now()>d)return n(),a;u=0}}}endDrawing(){A(this,Uu,YS).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),A(this,Bu,KS).call(this)}_scaleImage(e,t){let n=e.width??e.displayWidth,s=e.height??e.displayHeight,r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),a=n,l=s,c="prescale1",d,u;for(;r>2&&a>1||o>2&&l>1;){let p=a,m=l;r>2&&a>1&&(p=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),r/=a/p),o>2&&l>1&&(m=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,o/=l/m),d=this.cachedCanvases.getCanvas(c,p,m),u=d.context,u.clearRect(0,0,p,m),u.drawImage(e,0,0,a,l,0,0,p,m),e=d.canvas,a=p,l=m,c=c==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e){let t=this.ctx,{width:n,height:s}=e,r=this.current.fillColor,o=this.current.patternFill,a=Se(t),l,c,d,u;if((e.bitmap||e.data)&&e.count>1){let k=e.bitmap||e.data.buffer;c=JSON.stringify(o?a:[a.slice(0,4),r]),l=this._cachedBitmapsMap.get(k),l||(l=new Map,this._cachedBitmapsMap.set(k,l));let N=l.get(c);if(N&&!o){let F=Math.round(Math.min(a[0],a[2])+a[4]),$=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:N,offsetX:F,offsetY:$}}d=N}d||(u=this.cachedCanvases.getCanvas("maskCanvas",n,s),Lx(u.context,e));let p=V.transform(a,[1/n,0,0,-1/s,0,0]);p=V.transform(p,[1,0,0,1,0,-s]);let[m,y,v,b]=V.getAxialAlignedBoundingBox([0,0,n,s],p),S=Math.round(v-m)||1,C=Math.round(b-y)||1,T=this.cachedCanvases.getCanvas("fillCanvas",S,C),_=T.context,R=m,I=y;_.translate(-R,-I),_.transform(...p),d||(d=this._scaleImage(u.canvas,ei(_)),d=d.img,l&&o&&l.set(c,d)),_.imageSmoothingEnabled=Ox(Se(_),e.interpolate),ng(_,d,0,0,d.width,d.height,0,0,n,s),_.globalCompositeOperation="source-in";let M=V.transform(ei(_),[1,0,0,1,-R,-I]);return _.fillStyle=o?r.getPattern(t,this,M,mt.FILL):r,_.fillRect(0,0,n,s),l&&!o&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,T.canvas)),{canvas:T.canvas,offsetX:Math.round(R),offsetY:Math.round(I)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=TU[e]}setLineJoin(e){this.ctx.lineJoin=_U[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){let n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx,this.ctx=s.context;let r=this.ctx;r.setTransform(...Se(this.suspendedCtx)),hd(this.suspendedCtx,r),AU(r,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),hd(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,s){let r=s[0],o=s[1],a=s[2]-r,l=s[3]-o;a===0||l===0||(this.genericComposeSMask(t.context,n,a,l,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,s,r,o,a,l,c,d,u){let p=e.canvas,m=l-d,y=c-u;if(o){let b=V.makeHexColor(...o);if(m<0||y<0||m+n>p.width||y+s>p.height){let S=this.cachedCanvases.getCanvas("maskExtension",n,s),C=S.context;C.drawImage(p,-m,-y),C.globalCompositeOperation="destination-atop",C.fillStyle=b,C.fillRect(0,0,n,s),C.globalCompositeOperation="source-over",p=S.canvas,m=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);let S=new Path2D;S.rect(m,y,n,s),e.clip(S),e.globalCompositeOperation="destination-atop",e.fillStyle=b,e.fillRect(m,y,n,s),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));let v=new Path2D;v.rect(l,c,n,s),t.clip(v),t.globalCompositeOperation="destination-in",t.drawImage(p,m,y,n,s,l,c,n,s),t.restore()}save(){this.inSMaskMode?(hd(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),hd(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,s,r,o){this.ctx.transform(e,t,n,s,r,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){let s=this.ctx,r=this.current,o=r.x,a=r.y,l,c,d=Se(s),u=d[0]===0&&d[3]===0||d[1]===0&&d[2]===0,p=u?n.slice(0):null;for(let m=0,y=0,v=e.length;m<v;m++)switch(e[m]|0){case Mn.rectangle:o=t[y++],a=t[y++];let b=t[y++],S=t[y++],C=o+b,T=a+S;s.moveTo(o,a),b===0||S===0?s.lineTo(C,T):(s.lineTo(C,a),s.lineTo(C,T),s.lineTo(o,T)),u||r.updateRectMinMax(d,[o,a,C,T]),s.closePath();break;case Mn.moveTo:o=t[y++],a=t[y++],s.moveTo(o,a),u||r.updatePathMinMax(d,o,a);break;case Mn.lineTo:o=t[y++],a=t[y++],s.lineTo(o,a),u||r.updatePathMinMax(d,o,a);break;case Mn.curveTo:l=o,c=a,o=t[y+4],a=t[y+5],s.bezierCurveTo(t[y],t[y+1],t[y+2],t[y+3],o,a),r.updateCurvePathMinMax(d,l,c,t[y],t[y+1],t[y+2],t[y+3],o,a,p),y+=6;break;case Mn.curveTo2:l=o,c=a,s.bezierCurveTo(o,a,t[y],t[y+1],t[y+2],t[y+3]),r.updateCurvePathMinMax(d,l,c,o,a,t[y],t[y+1],t[y+2],t[y+3],p),o=t[y+2],a=t[y+3],y+=4;break;case Mn.curveTo3:l=o,c=a,o=t[y+2],a=t[y+3],s.bezierCurveTo(t[y],t[y+1],o,a,o,a),r.updateCurvePathMinMax(d,l,c,t[y],t[y+1],o,a,o,a,p),y+=4;break;case Mn.closePath:s.closePath();break}u&&r.updateScalingPathMinMax(d,p),r.setCurrentPoint(o,a)}closePath(){this.ctx.closePath()}stroke(e=!0){let t=this.ctx,n=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof n=="object"&&n?.getPattern?(t.save(),t.strokeStyle=n.getPattern(t,this,ei(t),mt.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){let t=this.ctx,n=this.current.fillColor,s=this.current.patternFill,r=!1;s&&(t.save(),t.fillStyle=n.getPattern(t,this,ei(t),mt.FILL),r=!0);let o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),r&&t.restore(),e&&this.consumePath(o)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=xU}eoClip(){this.pendingClip=Ux}beginText(){this.current.textMatrix=$x,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}let n=new Path2D,s=t.getTransform().invertSelf();for(let{transform:r,x:o,y:a,fontSize:l,path:c}of e)n.addPath(c,new DOMMatrix(r).preMultiplySelf(s).translate(o,a).scale(l,-l));t.clip(n),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){let n=this.commonObjs.get(e),s=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=n.fontMatrix||rS,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&j("Invalid font matrix for font "+e),t<0?(t=-t,s.fontDirection=-1):s.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;let r=n.loadedName||"sans-serif",o=n.systemFontInfo?.css||`"${r}", ${n.fallbackName}`,a="normal";n.black?a="900":n.bold&&(a="bold");let l=n.italic?"italic":"normal",c=t;t<Mx?c=Mx:t>Px&&(c=Px),this.current.fontSizeScale=t/c,this.ctx.font=`${l} ${a} ${c}px ${o}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,s,r,o){this.current.textMatrix=[e,t,n,s,r,o],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,s,r){let o=this.ctx,a=this.current,l=a.font,c=a.textRenderingMode,d=a.fontSize/a.fontSizeScale,u=c&ct.FILL_STROKE_MASK,p=!!(c&ct.ADD_TO_PATH_FLAG),m=a.patternFill&&!l.missingFile,y=a.patternStroke&&!l.missingFile,v;if((l.disableFontFace||p||m||y)&&(v=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||m||y){if(o.save(),o.translate(t,n),o.scale(d,-d),u===ct.FILL||u===ct.FILL_STROKE)if(s){let b=o.getTransform();o.setTransform(...s),o.fill(A(this,Hu,XS).call(this,v,b,s))}else o.fill(v);if(u===ct.STROKE||u===ct.FILL_STROKE)if(r){let b=o.getTransform();o.setTransform(...r),o.stroke(A(this,Hu,XS).call(this,v,b,r))}else o.lineWidth/=d,o.stroke(v);o.restore()}else(u===ct.FILL||u===ct.FILL_STROKE)&&o.fillText(e,t,n),(u===ct.STROKE||u===ct.FILL_STROKE)&&o.strokeText(e,t,n);p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Se(o),x:t,y:n,fontSize:d,path:v})}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let t=e.getImageData(0,0,10,10).data,n=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){n=!0;break}return ie(this,"isFontSubpixelAAEnabled",n)}showText(e){let t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);let s=t.fontSize;if(s===0)return;let r=this.ctx,o=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,c=t.fontDirection,d=t.textHScale*c,u=e.length,p=n.vertical,m=p?1:-1,y=n.defaultVMetrics,v=s*t.fontMatrix[0],b=t.textRenderingMode===ct.FILL&&!n.disableFontFace&&!t.patternFill;r.save(),r.transform(...t.textMatrix),r.translate(t.x,t.y+t.textRise),c>0?r.scale(d,-1):r.scale(d,1);let S,C;if(t.patternFill){r.save();let M=t.fillColor.getPattern(r,this,ei(r),mt.FILL);S=Se(r),r.restore(),r.fillStyle=M}if(t.patternStroke){r.save();let M=t.strokeColor.getPattern(r,this,ei(r),mt.STROKE);C=Se(r),r.restore(),r.strokeStyle=M}let T=t.lineWidth,_=t.textMatrixScale;if(_===0||T===0){let M=t.textRenderingMode&ct.FILL_STROKE_MASK;(M===ct.STROKE||M===ct.FILL_STROKE)&&(T=this.getSinglePixelWidth())}else T/=_;if(o!==1&&(r.scale(o,o),T/=o),r.lineWidth=T,n.isInvalidPDFjsFont){let M=[],k=0;for(let N of e)M.push(N.unicode),k+=N.width;r.fillText(M.join(""),0,0),t.x+=k*v*d,r.restore(),this.compose();return}let R=0,I;for(I=0;I<u;++I){let M=e[I];if(typeof M=="number"){R+=m*M*s/1e3;continue}let k=!1,N=(M.isSpace?l:0)+a,F=M.fontChar,$=M.accent,ae,K,se=M.width;if(p){let L=M.vmetric||y,q=-(M.vmetric?L[1]:se*.5)*v,Vt=L[2]*v;se=L?-L[0]:se,ae=q/o,K=(R+Vt)/o}else ae=R/o,K=0;if(n.remeasure&&se>0){let L=r.measureText(F).width*1e3/s*o;if(se<L&&this.isFontSubpixelAAEnabled){let q=se/L;k=!0,r.save(),r.scale(q,1),ae/=q}else se!==L&&(ae+=(se-L)/2e3*s/o)}if(this.contentVisible&&(M.isInFont||n.missingFile)){if(b&&!$)r.fillText(F,ae,K);else if(this.paintChar(F,ae,K,S,C),$){let L=ae+s*$.offset.x/o,q=K-s*$.offset.y/o;this.paintChar($.fontChar,L,q,S,C)}}let ze=p?se*v-N*c:se*v+N*c;R+=ze,k&&r.restore()}p?t.y-=R:t.x+=R*d,r.restore(),this.compose()}showType3Text(e){let t=this.ctx,n=this.current,s=n.font,r=n.fontSize,o=n.fontDirection,a=s.vertical?1:-1,l=n.charSpacing,c=n.wordSpacing,d=n.textHScale*o,u=n.fontMatrix||rS,p=e.length,m=n.textRenderingMode===ct.INVISIBLE,y,v,b,S;if(!(m||r===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...n.textMatrix),t.translate(n.x,n.y),t.scale(d,o),y=0;y<p;++y){if(v=e[y],typeof v=="number"){S=a*v*r/1e3,this.ctx.translate(S,0),n.x+=S*d;continue}let C=(v.isSpace?c:0)+l,T=s.charProcOperatorList[v.operatorListId];if(!T){j(`Type3 character "${v.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=v,this.save(),t.scale(r,r),t.transform(...u),this.executeOperatorList(T),this.restore()),b=V.applyTransform([v.width,0],u)[0]*r+C,t.translate(b,0),n.x+=b*d}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,s,r,o){this.ctx.rect(n,s,r-n,o-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){let n=e[1],s=this.baseTransform||Se(this.ctx),r={createCanvasGraphics:o=>new _A(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new WS(e,n,this.ctx,r,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){this.ctx.strokeStyle=this.current.strokeColor=V.makeHexColor(e,t,n),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,n){this.ctx.fillStyle=this.current.fillColor=V.makeHexColor(e,t,n),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=EU(this.getObject(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;let t=this.ctx;this.save();let n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,ei(t),mt.SHADING);let s=ei(t);if(s){let{width:r,height:o}=t.canvas,[a,l,c,d]=V.getAxialAlignedBoundingBox([0,0,r,o],s);this.ctx.fillRect(a,l,c-a,d-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){me("Should not call beginInlineImage")}beginImageData(){me("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=Se(this.ctx),t)){let n=t[2]-t[0],s=t[3]-t[1];this.ctx.rect(t[0],t[1],n,s),this.current.updateRectMinMax(Se(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let t=this.ctx;e.isolated||jy("TODO: Support non-isolated groups."),e.knockout&&j("Knockout groups not supported.");let n=Se(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=V.getAxialAlignedBoundingBox(e.bbox,Se(t)),r=[0,0,t.canvas.width,t.canvas.height];s=V.intersect(s,r)||[0,0,0,0];let o=Math.floor(s[0]),a=Math.floor(s[1]),l=Math.max(Math.ceil(s[2])-o,1),c=Math.max(Math.ceil(s[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,c]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);let u=this.cachedCanvases.getCanvas(d,l,c),p=u.context;p.translate(-o,-a),p.transform(...n),e.smask?this.smaskStack.push({canvas:u.canvas,context:p,offsetX:o,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,a),t.save()),hd(t,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;let t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let s=Se(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);let r=V.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],s);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(e,t,n,s,r){if(A(this,Uu,YS).call(this),ig(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){let o=t[2]-t[0],a=t[3]-t[1];if(r&&this.annotationCanvasMap){n=n.slice(),n[4]-=t[0],n[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=o,t[3]=a;let[l,c]=V.singularValueDecompose2dScale(Se(this.ctx)),{viewportScale:d}=this,u=Math.ceil(o*this.outputScaleX*d),p=Math.ceil(a*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(u,p);let{canvas:m,context:y}=this.annotationCanvas;this.annotationCanvasMap.set(e,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=y,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,a*c),ig(this.ctx)}else ig(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],o,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new Xg(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),A(this,Bu,KS).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;let t=e.count;e=this.getObject(e.data,e),e.count=t;let n=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=CU(e)),s.compiled)){s.compiled(n);return}let r=this._createMaskCanvas(e),o=r.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(o,r.offsetX,r.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,s=0,r,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);let a=this.ctx;a.save();let l=Se(a);a.transform(t,n,s,r,0,0);let c=this._createMaskCanvas(e);a.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let d=0,u=o.length;d<u;d+=2){let p=V.transform(l,[t,n,s,r,o[d],o[d+1]]),[m,y]=V.applyTransform([0,0],p);a.drawImage(c.canvas,m,y)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;let t=this.ctx,n=this.current.fillColor,s=this.current.patternFill;for(let r of e){let{data:o,width:a,height:l,transform:c}=r,d=this.cachedCanvases.getCanvas("maskCanvas",a,l),u=d.context;u.save();let p=this.getObject(o,r);Lx(u,p),u.globalCompositeOperation="source-in",u.fillStyle=s?n.getPattern(u,this,ei(t),mt.FILL):n,u.fillRect(0,0,a,l),u.restore(),t.save(),t.transform(...c),t.scale(1,-1),ng(t,d.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);if(!t){j("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,n,s){if(!this.contentVisible)return;let r=this.getObject(e);if(!r){j("Dependent image isn't ready yet");return}let o=r.width,a=r.height,l=[];for(let c=0,d=s.length;c<d;c+=2)l.push({transform:[t,0,0,n,s[c],s[c+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(r,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;let{bitmap:t,width:n,height:s}=e,r=this.cachedCanvases.getCanvas("inlineImage",n,s),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;let t=e.width,n=e.height,s=this.ctx;if(this.save(),!yt){let{filter:a}=s;a!=="none"&&a!==""&&(s.filter="none")}s.scale(1/t,-1/n);let r;if(e.bitmap)r=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)r=e;else{let l=this.cachedCanvases.getCanvas("inlineImage",t,n).context;Fx(l,e),r=this.applyTransferMapsToCanvas(l)}let o=this._scaleImage(r,ei(s));s.imageSmoothingEnabled=Ox(Se(s),e.interpolate),ng(s,o.img,0,0,o.paintWidth,o.paintHeight,0,-n,t,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;let n=this.ctx,s;if(e.bitmap)s=e.bitmap;else{let r=e.width,o=e.height,l=this.cachedCanvases.getCanvas("inlineImage",r,o).context;Fx(l,e),s=this.applyTransferMapsToCanvas(l)}for(let r of t)n.save(),n.transform(...r.transform),n.scale(1,-1),ng(n,s,r.x,r.y,r.w,r.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);let n=this.ctx;this.pendingClip&&(t||(this.pendingClip===Ux?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=Se(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:e}=this.current,{a:t,b:n,c:s,d:r}=this.ctx.getTransform(),o,a;if(n===0&&s===0){let l=Math.abs(t),c=Math.abs(r);if(l===c)if(e===0)o=a=1/l;else{let d=l*e;o=a=d<1?1/d:1}else if(e===0)o=1/l,a=1/c;else{let d=l*e,u=c*e;o=d<1?1/d:1,a=u<1?1/u:1}}else{let l=Math.abs(t*r-n*s),c=Math.hypot(t,n),d=Math.hypot(s,r);if(e===0)o=d/l,a=c/l;else{let u=e*l;o=d>u?d/u:1,a=c>u?c/u:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){let{ctx:t}=this,{lineWidth:n}=this.current,[s,r]=this.getScaleForStroking();if(t.lineWidth=n||1,s===1&&r===1){t.stroke();return}let o=t.getLineDash();if(e&&t.save(),t.scale(s,r),o.length>0){let a=Math.max(s,r);t.setLineDash(o.map(l=>l/a)),t.lineDashOffset/=a}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Uu=new WeakSet,YS=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Bu=new WeakSet,KS=function(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Hu=new WeakSet,XS=function(e,t,n){let s=new Path2D;return s.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),s};var el=_A;for(let i in Mn)el.prototype[i]!==void 0&&(el.prototype[Mn[i]]=el.prototype[i]);var $u,Vu,qn=class{static get workerPort(){return h(this,$u)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");w(this,$u,e)}static get workerSrc(){return h(this,Vu)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");w(this,Vu,e)}};$u=new WeakMap,Vu=new WeakMap,E(qn,$u,null),E(qn,Vu,"");var Eo,Gu,JS=class{constructor({parsedData:e,rawData:t}){E(this,Eo,void 0);E(this,Gu,void 0);w(this,Eo,e),w(this,Gu,t)}getRaw(){return h(this,Gu)}get(e){return h(this,Eo).get(e)??null}getAll(){return EA(h(this,Eo))}has(e){return h(this,Eo).has(e)}};Eo=new WeakMap,Gu=new WeakMap;var Ka=Symbol("INTERNAL"),zu,Wu,qu,Rl,ZS=class{constructor(e,{name:t,intent:n,usage:s,rbGroups:r}){E(this,zu,!1);E(this,Wu,!1);E(this,qu,!1);E(this,Rl,!0);w(this,zu,!!(e&tn.DISPLAY)),w(this,Wu,!!(e&tn.PRINT)),this.name=t,this.intent=n,this.usage=s,this.rbGroups=r}get visible(){if(h(this,qu))return h(this,Rl);if(!h(this,Rl))return!1;let{print:e,view:t}=this.usage;return h(this,zu)?t?.viewState!=="OFF":h(this,Wu)?e?.printState!=="OFF":!0}_setVisible(e,t,n=!1){e!==Ka&&me("Internal method `_setVisible` called."),w(this,qu,n),w(this,Rl,t)}};zu=new WeakMap,Wu=new WeakMap,qu=new WeakMap,Rl=new WeakMap;var Ws,pe,Dl,Il,Yu,QS,jS=class{constructor(e,t=tn.DISPLAY){E(this,Yu);E(this,Ws,null);E(this,pe,new Map);E(this,Dl,null);E(this,Il,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,w(this,Il,e.order);for(let n of e.groups)h(this,pe).set(n.id,new ZS(t,n));if(e.baseState==="OFF")for(let n of h(this,pe).values())n._setVisible(Ka,!1);for(let n of e.on)h(this,pe).get(n)._setVisible(Ka,!0);for(let n of e.off)h(this,pe).get(n)._setVisible(Ka,!1);w(this,Dl,this.getHash())}}isVisible(e){if(h(this,pe).size===0)return!0;if(!e)return jy("Optional content group not defined."),!0;if(e.type==="OCG")return h(this,pe).has(e.id)?h(this,pe).get(e.id).visible:(j(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return A(this,Yu,QS).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(let t of e.ids){if(!h(this,pe).has(t))return j(`Optional content group not found: ${t}`),!0;if(h(this,pe).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(let t of e.ids){if(!h(this,pe).has(t))return j(`Optional content group not found: ${t}`),!0;if(!h(this,pe).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(let t of e.ids){if(!h(this,pe).has(t))return j(`Optional content group not found: ${t}`),!0;if(!h(this,pe).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(let t of e.ids){if(!h(this,pe).has(t))return j(`Optional content group not found: ${t}`),!0;if(h(this,pe).get(t).visible)return!1}return!0}return j(`Unknown optional content policy ${e.policy}.`),!0}return j(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){let s=h(this,pe).get(e);if(!s){j(`Optional content group not found: ${e}`);return}if(n&&t&&s.rbGroups.length)for(let r of s.rbGroups)for(let o of r)o!==e&&h(this,pe).get(o)?._setVisible(Ka,!1,!0);s._setVisible(Ka,!!t,!0),w(this,Ws,null)}setOCGState({state:e,preserveRB:t}){let n;for(let s of e){switch(s){case"ON":case"OFF":case"Toggle":n=s;continue}let r=h(this,pe).get(s);if(r)switch(n){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!r.visible,t);break}}w(this,Ws,null)}get hasInitialVisibility(){return h(this,Dl)===null||this.getHash()===h(this,Dl)}getOrder(){return h(this,pe).size?h(this,Il)?h(this,Il).slice():[...h(this,pe).keys()]:null}getGroups(){return h(this,pe).size>0?EA(h(this,pe)):null}getGroup(e){return h(this,pe).get(e)||null}getHash(){if(h(this,Ws)!==null)return h(this,Ws);let e=new $g;for(let[t,n]of h(this,pe))e.update(`${t}:${n.visible}`);return w(this,Ws,e.hexdigest())}};Ws=new WeakMap,pe=new WeakMap,Dl=new WeakMap,Il=new WeakMap,Yu=new WeakSet,QS=function(e){let t=e.length;if(t<2)return!0;let n=e[0];for(let s=1;s<t;s++){let r=e[s],o;if(Array.isArray(r))o=A(this,Yu,QS).call(this,r);else if(h(this,pe).has(r))o=h(this,pe).get(r).visible;else return j(`Optional content group not found: ${r}`),!0;switch(n){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return n==="And"};var ew=class{constructor(e,{disableRange:t=!1,disableStream:n=!1}){Le(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:s,initialData:r,progressiveDone:o,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,r?.length>0){let l=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),e.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){let n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{let s=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(n),!0)});Le(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Le(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new tw(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new nw(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}},tw=class{constructor(e,t,n=!1,s=null){this._stream=e,this._done=n||!1,this._filename=wA(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(let r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},nw=class{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function RU(i){let e=!0,t=n("filename\\*","i").exec(i);if(t){t=t[1];let d=a(t);return d=unescape(d),d=l(d),d=c(d),r(d)}if(t=o(i),t){let d=c(t);return r(d)}if(t=n("filename","i").exec(i),t){t=t[1];let d=a(t);return d=c(d),r(d)}function n(d,u){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function s(d,u){if(d){if(!/^[\x00-\xFF]+$/.test(u))return u;try{let p=new TextDecoder(d,{fatal:!0}),m=Qy(u);u=p.decode(m),e=!1}catch{}}return u}function r(d){return e&&/[\x80-\xff]/.test(d)&&(d=s("utf-8",d),e&&(d=s("iso-8859-1",d))),d}function o(d){let u=[],p,m=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=m.exec(d))!==null;){let[,v,b,S]=p;if(v=parseInt(v,10),v in u){if(v===0)break;continue}u[v]=[b,S]}let y=[];for(let v=0;v<u.length&&v in u;++v){let[b,S]=u[v];S=a(S),b&&(S=unescape(S),v===0&&(S=l(S))),y.push(S)}return y.join("")}function a(d){if(d.startsWith('"')){let u=d.slice(1).split('\\"');for(let p=0;p<u.length;++p){let m=u[p].indexOf('"');m!==-1&&(u[p]=u[p].slice(0,m),u.length=p+1),u[p]=u[p].replaceAll(/\\(.)/g,"$1")}d=u.join('"')}return d}function l(d){let u=d.indexOf("'");if(u===-1)return d;let p=d.slice(0,u),y=d.slice(u+1).replace(/^[^']*'/,"");return s(p,y)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,p,m,y){if(m==="q"||m==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(v,b){return String.fromCharCode(parseInt(b,16))}),s(p,y);try{y=atob(y)}catch{}return s(p,y)})}return""}function CR(i,e){let t=new Headers;if(!i||!e||typeof e!="object")return t;for(let n in e){let s=e[n];s!==void 0&&t.append(n,s)}return t}function nv(i){try{return new URL(i).origin}catch{}return null}function TR({responseHeaders:i,isHttp:e,rangeChunkSize:t,disableRange:n}){let s={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(i.get("Content-Length"),10);return!Number.isInteger(r)||(s.suggestedLength=r,r<=2*t)||n||!e||i.get("Accept-Ranges")!=="bytes"||(i.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function _R(i){let e=i.get("Content-Disposition");if(e){let t=RU(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(wA(t))return t}return null}function iv(i,e){return i===404||i===0&&e.startsWith("file:")?new aa('Missing PDF "'+e+'".'):new Pc(`Unexpected server response (${i}) while retrieving PDF "${e}".`,i)}function xR(i){return i===200||i===206}function RR(i,e,t){return{method:"GET",headers:i,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function DR(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:(j(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}var Jg=class{constructor(e){Y(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=CR(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Le(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new iw(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new sw(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},iw=class{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;let n=new Headers(e.headers),s=t.url;fetch(s,RR(n,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=nv(r.url),!xR(r.status))throw iv(r.status,s);this._reader=r.body.getReader(),this._headersCapability.resolve();let o=r.headers,{allowRangeRequests:a,suggestedLength:l}=TR({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=_R(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Si("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:DR(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},sw=class{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;let s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;let r=new Headers(e.headers);r.append("Range",`bytes=${t}-${n-1}`);let o=s.url;fetch(o,RR(r,this._withCredentials,this._abortController)).then(a=>{let l=nv(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!xR(a.status))throw iv(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:DR(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},iS=200,sS=206;function DU(i){let e=i.response;return typeof e!="string"?e:Qy(e).buffer}var rw=class{constructor({url:e,httpHeaders:t,withCredentials:n}){Y(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=CR(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){let t=new XMLHttpRequest,n=this.currXhrId++,s=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(let[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=sS):s.expectedStatus=iS,t.responseType="arraybuffer",Le(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){let n=this.pendingRequests[e];n&&n.onProgress?.(t)}onStateChange(e,t){let n=this.pendingRequests[e];if(!n)return;let s=n.xhr;if(s.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){n.onError(s.status);return}let r=s.status||iS;if(!(r===iS&&n.expectedStatus===sS)&&r!==n.expectedStatus){n.onError(s.status);return}let a=DU(s);if(r===sS){let l=s.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?n.onDone({begin:parseInt(c[1],10),chunk:a}):(j('Missing or invalid "Content-Range" header.'),n.onError(0))}else a?n.onDone({begin:0,chunk:a}):n.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}},ow=class{constructor(e){this._source=e,this._manager=new rw(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Le(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new aw(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let n=new lw(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},aw=class{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=nv(t.responseURL);let n=t.getAllResponseHeaders(),s=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{let[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=TR({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=_R(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=iv(e,this._url),this._headersCapability.reject(this._storedError);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},lw=class{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){let e=nv(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=iv(e,this._url));for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},IU=/^[a-z][a-z0-9\-+.]+:/i;function MU(i){if(IU.test(i))return new URL(i);let e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(i))}var cw=class{constructor(e){this.source=e,this.url=MU(e.url),Le(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Le(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new dw(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new uw(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},dw=class{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new aa(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Si("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},uw=class{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let s=e.source;this._isStreamingSupported=!s.disableStream;let r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}},PU=1e5,It=30,kU=.8,qs,Nt,Ku,Xu,So,Zi,Ju,Zu,wo,Ml,Pl,Ys,kl,ju,Nl,Ao,Qu,eh,Co,To,th,Ks,Fl,Zm,IR,jm,MR,nh,hw,Ll,yg,ih,fw,Qm,PR,ey,kR,_e=class _e{constructor({textContentSource:e,container:t,viewport:n}){E(this,Zm);E(this,jm);E(this,nh);E(this,qs,Promise.withResolvers());E(this,Nt,null);E(this,Ku,!1);E(this,Xu,!!globalThis.FontInspector?.enabled);E(this,So,null);E(this,Zi,null);E(this,Ju,0);E(this,Zu,0);E(this,wo,null);E(this,Ml,null);E(this,Pl,0);E(this,Ys,0);E(this,kl,Object.create(null));E(this,ju,[]);E(this,Nl,null);E(this,Ao,[]);E(this,Qu,new WeakMap);E(this,eh,null);var l;if(e instanceof ReadableStream)w(this,Nl,e);else if(typeof e=="object")w(this,Nl,new ReadableStream({start(c){c.enqueue(e),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');w(this,Nt,w(this,Ml,t)),w(this,Ys,n.scale*(globalThis.devicePixelRatio||1)),w(this,Pl,n.rotation),w(this,Zi,{div:null,properties:null,ctx:null});let{pageWidth:s,pageHeight:r,pageX:o,pageY:a}=n.rawDims;w(this,eh,[1,0,0,-1,-o,a+r]),w(this,Zu,s),w(this,Ju,r),A(l=_e,Qm,PR).call(l),la(t,n),h(this,qs).promise.finally(()=>{h(_e,Fl).delete(this),w(this,Zi,null),w(this,kl,null)}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:e,isFirefox:t}=st.platform;return ie(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){let e=()=>{h(this,wo).read().then(({value:t,done:n})=>{if(n){h(this,qs).resolve();return}h(this,So)??w(this,So,t.lang),Object.assign(h(this,kl),t.styles),A(this,Zm,IR).call(this,t.items),e()},h(this,qs).reject)};return w(this,wo,h(this,Nl).getReader()),h(_e,Fl).add(this),e(),h(this,qs).promise}update({viewport:e,onBefore:t=null}){var r;let n=e.scale*(globalThis.devicePixelRatio||1),s=e.rotation;if(s!==h(this,Pl)&&(t?.(),w(this,Pl,s),la(h(this,Ml),{rotation:s})),n!==h(this,Ys)){t?.(),w(this,Ys,n);let o={div:null,properties:null,ctx:A(r=_e,Ll,yg).call(r,h(this,So))};for(let a of h(this,Ao))o.properties=h(this,Qu).get(a),o.div=a,A(this,nh,hw).call(this,o)}}cancel(){let e=new Si("TextLayer task cancelled.");h(this,wo)?.cancel(e).catch(()=>{}),w(this,wo,null),h(this,qs).reject(e)}get textDivs(){return h(this,Ao)}get textContentItemsStr(){return h(this,ju)}static cleanup(){if(!(h(this,Fl).size>0)){h(this,Co).clear();for(let{canvas:e}of h(this,To).values())e.remove();h(this,To).clear()}}};qs=new WeakMap,Nt=new WeakMap,Ku=new WeakMap,Xu=new WeakMap,So=new WeakMap,Zi=new WeakMap,Ju=new WeakMap,Zu=new WeakMap,wo=new WeakMap,Ml=new WeakMap,Pl=new WeakMap,Ys=new WeakMap,kl=new WeakMap,ju=new WeakMap,Nl=new WeakMap,Ao=new WeakMap,Qu=new WeakMap,eh=new WeakMap,Co=new WeakMap,To=new WeakMap,th=new WeakMap,Ks=new WeakMap,Fl=new WeakMap,Zm=new WeakSet,IR=function(e){var s,r;if(h(this,Ku))return;(r=h(this,Zi)).ctx??(r.ctx=A(s=_e,Ll,yg).call(s,h(this,So)));let t=h(this,Ao),n=h(this,ju);for(let o of e){if(t.length>PU){j("Ignoring additional textDivs for performance reasons."),w(this,Ku,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){let a=h(this,Nt);w(this,Nt,document.createElement("span")),h(this,Nt).classList.add("markedContent"),o.id!==null&&h(this,Nt).setAttribute("id",`${o.id}`),a.append(h(this,Nt))}else o.type==="endMarkedContent"&&w(this,Nt,h(this,Nt).parentNode);continue}n.push(o.str),A(this,jm,MR).call(this,o)}},jm=new WeakSet,MR=function(e){var v;let t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};h(this,Ao).push(t);let s=V.transform(h(this,eh),e.transform),r=Math.atan2(s[1],s[0]),o=h(this,kl)[e.fontName];o.vertical&&(r+=Math.PI/2);let a=h(this,Xu)&&o.fontSubstitution||o.fontFamily;a=_e.fontFamilyMap.get(a)||a;let l=Math.hypot(s[2],s[3]),c=l*A(v=_e,ey,kR).call(v,a,h(this,So)),d,u;r===0?(d=s[4],u=s[5]-c):(d=s[4]+c*Math.sin(r),u=s[5]-c*Math.cos(r));let p="calc(var(--scale-factor)*",m=t.style;h(this,Nt)===h(this,Ml)?(m.left=`${(100*d/h(this,Zu)).toFixed(2)}%`,m.top=`${(100*u/h(this,Ju)).toFixed(2)}%`):(m.left=`${p}${d.toFixed(2)}px)`,m.top=`${p}${u.toFixed(2)}px)`),m.fontSize=`${p}${(h(_e,Ks)*l).toFixed(2)}px)`,m.fontFamily=a,n.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,h(this,Xu)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(n.angle=r*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){let b=Math.abs(e.transform[0]),S=Math.abs(e.transform[3]);b!==S&&Math.max(b,S)/Math.min(b,S)>1.5&&(y=!0)}if(y&&(n.canvasWidth=o.vertical?e.height:e.width),h(this,Qu).set(t,n),h(this,Zi).div=t,h(this,Zi).properties=n,A(this,nh,hw).call(this,h(this,Zi)),n.hasText&&h(this,Nt).append(t),n.hasEOL){let b=document.createElement("br");b.setAttribute("role","presentation"),h(this,Nt).append(b)}},nh=new WeakSet,hw=function(e){var a;let{div:t,properties:n,ctx:s}=e,{style:r}=t,o="";if(h(_e,Ks)>1&&(o=`scale(${1/h(_e,Ks)})`),n.canvasWidth!==0&&n.hasText){let{fontFamily:l}=r,{canvasWidth:c,fontSize:d}=n;A(a=_e,ih,fw).call(a,s,d*h(this,Ys),l);let{width:u}=s.measureText(t.textContent);u>0&&(o=`scaleX(${c*h(this,Ys)/u}) ${o}`)}n.angle!==0&&(o=`rotate(${n.angle}deg) ${o}`),o.length>0&&(r.transform=o)},Ll=new WeakSet,yg=function(e=null){let t=h(this,To).get(e||(e=""));if(!t){let n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),h(this,To).set(e,t),h(this,th).set(t,{size:0,family:""})}return t},ih=new WeakSet,fw=function(e,t,n){let s=h(this,th).get(e);t===s.size&&n===s.family||(e.font=`${t}px ${n}`,s.size=t,s.family=n)},Qm=new WeakSet,PR=function(){if(h(this,Ks)!==null)return;let e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),w(this,Ks,e.getBoundingClientRect().height),e.remove()},ey=new WeakSet,kR=function(e,t){let n=h(this,Co).get(e);if(n)return n;let s=A(this,Ll,yg).call(this,t);s.canvas.width=s.canvas.height=It,A(this,ih,fw).call(this,s,It,e);let r=s.measureText(""),o=r.fontBoundingBoxAscent,a=Math.abs(r.fontBoundingBoxDescent);if(o){let d=o/(o+a);return h(this,Co).set(e,d),s.canvas.width=s.canvas.height=0,d}s.strokeStyle="red",s.clearRect(0,0,It,It),s.strokeText("g",0,0);let l=s.getImageData(0,0,It,It).data;a=0;for(let d=l.length-1-3;d>=0;d-=4)if(l[d]>0){a=Math.ceil(d/4/It);break}s.clearRect(0,0,It,It),s.strokeText("A",0,It),l=s.getImageData(0,0,It,It).data,o=0;for(let d=0,u=l.length;d<u;d+=4)if(l[d]>0){o=It-Math.floor(d/4/It);break}s.canvas.width=s.canvas.height=0;let c=o?o/(o+a):kU;return h(this,Co).set(e,c),c},E(_e,Ll),E(_e,ih),E(_e,Qm),E(_e,ey),E(_e,Co,new Map),E(_e,To,new Map),E(_e,th,new WeakMap),E(_e,Ks,null),E(_e,Fl,new Set);var Hd=_e,$d=class i{static textContent(e){let t=[],n={items:t,styles:Object.create(null)};function s(r){if(!r)return;let o=null,a=r.name;if(a==="#text")o=r.value;else if(i.shouldBuildText(a))r?.attributes?.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(let l of r.children)s(l)}return s(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}},NU=65536,FU=100,LU=5e3,OU=yt?US:kS,UU=yt?BS:Wg,BU=yt?OS:NS,HU=yt?HS:Kg;function $U(i={}){typeof i=="string"||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});let e=new pw,{docId:t}=e,n=i.url?VU(i.url):null,s=i.data?GU(i.data):null,r=i.httpHeaders||null,o=i.withCredentials===!0,a=i.password??null,l=i.range instanceof Zg?i.range:null,c=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:NU,d=i.worker instanceof tl?i.worker:null,u=i.verbosity,p=typeof i.docBaseUrl=="string"&&!tv(i.docBaseUrl)?i.docBaseUrl:null,m=typeof i.cMapUrl=="string"?i.cMapUrl:null,y=i.cMapPacked!==!1,v=i.CMapReaderFactory||UU,b=typeof i.standardFontDataUrl=="string"?i.standardFontDataUrl:null,S=i.StandardFontDataFactory||HU,C=i.stopAtErrors!==!0,T=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,_=i.isEvalSupported!==!1,R=typeof i.isOffscreenCanvasSupported=="boolean"?i.isOffscreenCanvasSupported:!yt,I=typeof i.isImageDecoderSupported=="boolean"?i.isImageDecoderSupported:!yt&&(st.platform.isFirefox||!globalThis.chrome),M=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,k=typeof i.disableFontFace=="boolean"?i.disableFontFace:yt,N=i.fontExtraProperties===!0,F=i.enableXfa===!0,$=i.ownerDocument||globalThis.document,ae=i.disableRange===!0,K=i.disableStream===!0,se=i.disableAutoFetch===!0,ze=i.pdfBug===!0,L=i.CanvasFactory||OU,q=i.FilterFactory||BU,Vt=i.enableHWA===!0,Zn=l?l.length:i.length??NaN,ki=typeof i.useSystemFonts=="boolean"?i.useSystemFonts:!yt&&!k,cn=typeof i.useWorkerFetch=="boolean"?i.useWorkerFetch:v===Wg&&S===Kg&&m&&b&&gd(m,document.baseURI)&&gd(b,document.baseURI),at=null;sU(u);let Ue={canvasFactory:new L({ownerDocument:$,enableHWA:Vt}),filterFactory:new q({docId:t,ownerDocument:$}),cMapReaderFactory:cn?null:new v({baseUrl:m,isCompressed:y}),standardFontDataFactory:cn?null:new S({baseUrl:b})};if(!d){let _t={verbosity:u,port:qn.workerPort};d=_t.port?tl.fromPort(_t):new tl(_t),e._worker=d}let Pa={docId:t,apiVersion:"4.10.38",data:s,password:a,disableAutoFetch:se,rangeChunkSize:c,length:Zn,docBaseUrl:p,enableXfa:F,evaluatorOptions:{maxImageSize:T,disableFontFace:k,ignoreErrors:C,isEvalSupported:_,isOffscreenCanvasSupported:R,isImageDecoderSupported:I,canvasMaxAreaInBytes:M,fontExtraProperties:N,useSystemFonts:ki,cMapUrl:cn?m:null,standardFontDataUrl:cn?b:null}},ed={disableFontFace:k,fontExtraProperties:N,ownerDocument:$,pdfBug:ze,styleElement:at,loadingParams:{disableAutoFetch:se,enableXfa:F}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let _t=d.messageHandler.sendWithPromise("GetDocRequest",Pa,s?[s.buffer]:null),be;if(l)be=new ew(l,{disableRange:ae,disableStream:K});else if(!s){if(!n)throw new Error("getDocument - no `url` parameter provided.");let ka;if(yt)if(gd(n)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");ka=Jg}else ka=cw;else ka=gd(n)?Jg:ow;be=new ka({url:n,length:Zn,httpHeaders:r,withCredentials:o,rangeChunkSize:c,disableRange:ae,disableStream:K})}return _t.then(ka=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let ZT=new Vr(t,ka,d.port),uP=new vw(ZT,e,be,ed,Ue);e._transport=uP,ZT.send("Ready",null)})}).catch(e._capability.reject),e}function VU(i){if(i instanceof URL)return i.href;try{return new URL(i,window.location).href}catch{if(yt&&typeof i=="string")return i}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function GU(i){if(yt&&typeof Buffer<"u"&&i instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength)return i;if(typeof i=="string")return Qy(i);if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)||typeof i=="object"&&!isNaN(i?.length))return new Uint8Array(i);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Bx(i){return typeof i=="object"&&Number.isInteger(i?.num)&&i.num>=0&&Number.isInteger(i?.gen)&&i.gen>=0}var ty,ny=class ny{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${bt(ny,ty)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}};ty=new WeakMap,E(ny,ty,0);var pw=ny,Zg=class{constructor(e,t,n=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let n of this._progressListeners)n(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){me("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},gw=class{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return ie(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},Xs,ji,Js,Xa,Ol,vg,mw=class{constructor(e,t,n,s=!1){E(this,Js);E(this,Ol);E(this,Xs,null);E(this,ji,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=s?new Og:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new jg,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:s=0,dontFlip:r=!1}={}){return new Fd({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}getAnnotations({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return ie(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:s=Ds.ENABLE,transform:r=null,background:o=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:u=!1}){this._stats?.time("Overall");let p=this._transport.getRenderingIntent(n,s,d,u),{renderingIntent:m,cacheKey:y}=p;w(this,ji,!1),A(this,Ol,vg).call(this),a||(a=this._transport.getOptionalContentConfig(m));let v=this._intentStates.get(y);v||(v=Object.create(null),this._intentStates.set(y,v)),v.streamReaderCancelTimeout&&(clearTimeout(v.streamReaderCancelTimeout),v.streamReaderCancelTimeout=null);let b=!!(m&tn.PRINT);v.displayReadyCapability||(v.displayReadyCapability=Promise.withResolvers(),v.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(p));let S=_=>{v.renderTasks.delete(C),(this._maybeCleanupAfterRender||b)&&w(this,ji,!0),A(this,Js,Xa).call(this,!b),_?(C.capability.reject(_),this._abortOperatorList({intentState:v,reason:_ instanceof Error?_:new Error(_)})):C.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},C=new Sw({callback:S,params:{canvasContext:e,viewport:t,transform:r,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:v.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!b,pdfBug:this._pdfBug,pageColors:c});(v.renderTasks||(v.renderTasks=new Set)).add(C);let T=C.task;return Promise.all([v.displayReadyCapability.promise,a]).then(([_,R])=>{if(this.destroyed){S();return}if(this._stats?.time("Rendering"),!(R.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");C.initializeGraphics({transparency:_,optionalContentConfig:R}),C.operatorListChanged()}).catch(S),T}getOperatorList({intent:e="display",annotationMode:t=Ds.ENABLE,printAnnotationStorage:n=null,isEditing:s=!1}={}){function r(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}let o=this._transport.getRenderingIntent(e,t,n,s,!0),a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=r,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>$d.textContent(n));let t=this.streamTextContent(e);return new Promise(function(n,s){function r(){o.read().then(function({value:l,done:c}){if(c){n(a);return}a.lang??(a.lang=l.lang),Object.assign(a.styles,l.styles),a.items.push(...l.items),r()},s)}let o=t.getReader(),a={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),w(this,ji,!1),A(this,Ol,vg).call(this),Promise.all(e)}cleanup(e=!1){w(this,ji,!0);let t=A(this,Js,Xa).call(this,!1);return e&&t&&this._stats&&(this._stats=new Og),t}_startRenderPage(e,t){let n=this._intentStates.get(t);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let n=0,s=e.length;n<s;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let n of t.renderTasks)n.operatorListChanged();e.lastChunk&&A(this,Js,Xa).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:s}){let{map:r,transfer:o}=n,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:s},o).getReader(),c=this._intentStates.get(t);c.streamReader=l;let d=()=>{l.read().then(({value:u,done:p})=>{if(p){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,c),d())},u=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(let p of c.renderTasks)p.operatorListChanged();A(this,Js,Xa).call(this,!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(u);else if(c.opListReadCapability)c.opListReadCapability.reject(u);else throw u}})};d()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof Ld){let s=FU;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new Si(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[s,r]of this._intentStates)if(r===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}};Xs=new WeakMap,ji=new WeakMap,Js=new WeakSet,Xa=function(e=!1){if(A(this,Ol,vg).call(this),!h(this,ji)||this.destroyed)return!1;if(e)return w(this,Xs,setTimeout(()=>{w(this,Xs,null),A(this,Js,Xa).call(this,!1)},LU)),!1;for(let{renderTasks:t,operatorList:n}of this._intentStates.values())if(t.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),w(this,ji,!1),!0},Ol=new WeakSet,vg=function(){h(this,Xs)&&(clearTimeout(h(this,Xs)),w(this,Xs,null))};var Qi,iy,yw=class{constructor(){E(this,Qi,new Map);E(this,iy,Promise.resolve())}postMessage(e,t){let n={data:structuredClone(e,t?{transfer:t}:null)};h(this,iy).then(()=>{for(let[s]of h(this,Qi))s.call(this,n)})}addEventListener(e,t,n=null){let s=null;if(n?.signal instanceof AbortSignal){let{signal:r}=n;if(r.aborted){j("LoopbackPort - cannot use an `aborted` signal.");return}let o=()=>this.removeEventListener(e,t);s=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}h(this,Qi).set(t,s)}removeEventListener(e,t){h(this,Qi).get(t)?.(),h(this,Qi).delete(t)}terminate(){for(let[,e]of h(this,Qi))e?.();h(this,Qi).clear()}};Qi=new WeakMap,iy=new WeakMap;var sy,_o,xo,Ul,bg,Bl,Eg,Ee=class Ee{constructor({name:e=null,port:t=null,verbosity:n=rU()}={}){E(this,Ul);if(this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if(h(Ee,xo)?.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(h(Ee,xo)||w(Ee,xo,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new Vr("main","worker",e),this._messageHandler.on("ready",function(){}),A(this,Ul,bg).call(this)}_initialize(){if(h(Ee,_o)||h(Ee,Bl,Eg)){this._setupFakeWorker();return}let{workerSrc:e}=Ee;try{Ee._isSameOrigin(window.location.href,e)||(e=Ee._createCDNWrapper(new URL(e,window.location).href));let t=new Worker(e,{type:"module"}),n=new Vr("main","worker",t),s=()=>{r.abort(),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=new AbortController;t.addEventListener("error",()=>{this._webWorker||s()},{signal:r.signal}),n.on("test",a=>{if(r.abort(),this.destroyed||!a){s();return}this._messageHandler=n,this._port=t,this._webWorker=t,A(this,Ul,bg).call(this)}),n.on("ready",a=>{if(r.abort(),this.destroyed){s();return}try{o()}catch{this._setupFakeWorker()}});let o=()=>{let a=new Uint8Array;n.send("test",a,[a.buffer])};o();return}catch{jy("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){h(Ee,_o)||(j("Setting up fake worker."),w(Ee,_o,!0)),Ee._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let t=new yw;this._port=t;let n=`fake${bt(Ee,sy)._++}`,s=new Vr(n+"_worker",n,t);e.setup(s,t),this._messageHandler=new Vr(n,n+"_worker",t),A(this,Ul,bg).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this._webWorker?.terminate(),this._webWorker=null,h(Ee,xo)?.delete(this._port),this._port=null,this._messageHandler?.destroy(),this._messageHandler=null}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");let t=h(this,xo)?.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Ee(e)}static get workerSrc(){if(qn.workerSrc)return qn.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return ie(this,"_setupFakeWorkerGlobal",(async()=>h(this,Bl,Eg)?h(this,Bl,Eg):(await import(this.workerSrc)).WorkerMessageHandler)())}};sy=new WeakMap,_o=new WeakMap,xo=new WeakMap,Ul=new WeakSet,bg=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Bl=new WeakSet,Eg=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},E(Ee,Bl),E(Ee,sy,0),E(Ee,_o,!1),E(Ee,xo,void 0),yt&&(w(Ee,_o,!0),qn.workerSrc||(qn.workerSrc="./pdf.worker.mjs")),Ee._isSameOrigin=(e,t)=>{let n;try{if(n=new URL(e),!n.origin||n.origin==="null")return!1}catch{return!1}let s=new URL(t,n);return n.origin===s.origin},Ee._createCDNWrapper=e=>{let t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};var tl=Ee,es,hi,Hl,$l,ts,Ro,Ad,vw=class{constructor(e,t,n,s,r){E(this,Ro);E(this,es,new Map);E(this,hi,new Map);E(this,Hl,new Map);E(this,$l,new Map);E(this,ts,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new jg,this.fontLoader=new MS({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return ie(this,"annotationStorage",new Ud)}getRenderingIntent(e,t=Ds.ENABLE,n=null,s=!1,r=!1){let o=tn.DISPLAY,a=IS;switch(e){case"any":o=tn.ANY;break;case"display":break;case"print":o=tn.PRINT;break;default:j(`getRenderingIntent - invalid intent: ${e}`)}let l=o&tn.PRINT&&n instanceof Vg?n:this.annotationStorage;switch(t){case Ds.DISABLE:o+=tn.ANNOTATIONS_DISABLE;break;case Ds.ENABLE:break;case Ds.ENABLE_FORMS:o+=tn.ANNOTATIONS_FORMS;break;case Ds.ENABLE_STORAGE:o+=tn.ANNOTATIONS_STORAGE,a=l.serializable;break;default:j(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(o+=tn.IS_EDITING),r&&(o+=tn.OPLIST);let{ids:c,hash:d}=l.modifiedIds,u=[o,a.hash,d];return{renderingIntent:o,cacheKey:u.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),h(this,ts)?.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let n of h(this,hi).values())e.push(n._destroy());h(this,hi).clear(),h(this,Hl).clear(),h(this,$l).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),h(this,es).clear(),this.filterFactory.destroy(),Hd.cleanup(),this._networkStream?.cancelAllRequests(new Si("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,s)=>{Le(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},s.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){s.close();return}Le(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{this._fullReader.cancel(r),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async n=>{await this._fullReader.headersReady;let{isStreamingSupported:s,isRangeSupported:r,contentLength:o}=this._fullReader;return(!s||!r)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{t.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:s,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(n,s)=>{Le(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let r=this._networkStream.getRangeReader(n.begin,n.end);if(!r){s.close();return}s.onPull=()=>{r.read().then(function({value:o,done:a}){if(a){s.close();return}Le(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{s.error(o)})},s.onCancel=o=>{r.cancel(o),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new gw(n,this))}),e.on("DocException",n=>{t._capability.reject(Mt(n))}),e.on("PasswordRequest",n=>{w(this,ts,Promise.withResolvers());try{if(!t.onPassword)throw Mt(n);let s=r=>{r instanceof Error?h(this,ts).reject(r):h(this,ts).resolve({password:r})};t.onPassword(s,n.code)}catch(s){h(this,ts).reject(s)}return h(this,ts).promise}),e.on("DataLoaded",n=>{t.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;h(this,hi).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,s,r])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(s){case"Font":let{disableFontFace:o,fontExtraProperties:a,pdfBug:l}=this._params;if("error"in r){let p=r.error;j(`Error during font loading: ${p}`),this.commonObjs.resolve(n,p);break}let c=l&&globalThis.FontInspector?.enabled?(p,m)=>globalThis.FontInspector.fontAdded(p,m):null,d=new PS(r,{disableFontFace:o,fontExtraProperties:a,inspectFont:c});this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!a&&d.data&&(d.data=null),this.commonObjs.resolve(n,d)});break;case"CopyLocalImage":let{imageRef:u}=r;Le(u,"The imageRef must be defined.");for(let p of h(this,hi).values())for(let[,m]of p.objs)if(m?.ref===u)return m.dataLen?(this.commonObjs.resolve(n,structuredClone(m)),m.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,r);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([n,s,r,o])=>{if(this.destroyed)return;let a=h(this,hi).get(s);if(!a.objs.has(n)){if(a._intentStates.size===0){o?.bitmap?.close();return}switch(r){case"Image":a.objs.resolve(n,o),o?.dataLen>QO&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(n,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",n=>{this.destroyed||t.onProgress?.({loaded:n.loaded,total:n.total})}),e.on("FetchBuiltInCMap",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(n)}),e.on("FetchStandardFontData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&j("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,n=h(this,Hl).get(t);if(n)return n;let s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&h(this,$l).set(r.refStr,e);let o=new mw(t,r,this,this._params.pdfBug);return h(this,hi).set(t,o),o});return h(this,Hl).set(t,s),s}getPageIndex(e){return Bx(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return A(this,Ro,Ad).call(this,"GetFieldObjects")}hasJSActions(){return A(this,Ro,Ad).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return A(this,Ro,Ad).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return A(this,Ro,Ad).call(this,"GetOptionalContentConfig").then(t=>new jS(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",t=h(this,es).get(e);if(t)return t;let n=this.messageHandler.sendWithPromise(e,null).then(s=>({info:s[0],metadata:s[1]?new JS(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return h(this,es).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(let t of h(this,hi).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),h(this,es).clear(),this.filterFactory.destroy(!0),Hd.cleanup()}}cachedPageNumber(e){if(!Bx(e))return null;let t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return h(this,$l).get(t)??null}};es=new WeakMap,hi=new WeakMap,Hl=new WeakMap,$l=new WeakMap,ts=new WeakMap,Ro=new WeakSet,Ad=function(e,t=null){let n=h(this,es).get(e);if(n)return n;let s=this.messageHandler.sendWithPromise(e,t);return h(this,es).set(e,s),s};var fd=Symbol("INITIAL_DATA"),qt,sh,bw,jg=class{constructor(){E(this,sh);E(this,qt,Object.create(null))}get(e,t=null){if(t){let s=A(this,sh,bw).call(this,e);return s.promise.then(()=>t(s.data)),null}let n=h(this,qt)[e];if(!n||n.data===fd)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){let t=h(this,qt)[e];return!!t&&t.data!==fd}delete(e){let t=h(this,qt)[e];return!t||t.data===fd?!1:(delete h(this,qt)[e],!0)}resolve(e,t=null){let n=A(this,sh,bw).call(this,e);n.data=t,n.resolve()}clear(){for(let e in h(this,qt)){let{data:t}=h(this,qt)[e];t?.bitmap?.close()}w(this,qt,Object.create(null))}*[Symbol.iterator](){for(let e in h(this,qt)){let{data:t}=h(this,qt)[e];t!==fd&&(yield[e,t])}}};qt=new WeakMap,sh=new WeakSet,bw=function(e){var t;return(t=h(this,qt))[e]||(t[e]={...Promise.withResolvers(),data:fd})};var Zs,Ew=class{constructor(e){E(this,Zs,null);w(this,Zs,e),this.onContinue=null}get promise(){return h(this,Zs).capability.promise}cancel(e=0){h(this,Zs).cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=h(this,Zs).operatorList;if(!e)return!1;let{annotationCanvasMap:t}=h(this,Zs);return e.form||e.canvas&&t?.size>0}};Zs=new WeakMap;var js,Do,$r=class $r{constructor({callback:e,params:t,objs:n,commonObjs:s,annotationCanvasMap:r,operatorList:o,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:u=!1,pageColors:p=null}){E(this,js,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=s,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=u,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Ew(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(h($r,Do).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");h($r,Do).add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:n,viewport:s,transform:r,background:o}=this.params;this.gfx=new el(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:s,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),h(this,js)&&(window.cancelAnimationFrame(h(this,js)),w(this,js,null)),h($r,Do).delete(this._canvas),this.callback(e||new Ld(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?w(this,js,window.requestAnimationFrame(()=>{w(this,js,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),h($r,Do).delete(this._canvas),this.callback())))}};js=new WeakMap,Do=new WeakMap,E($r,Do,new WeakSet);var Sw=$r,zU="4.10.38",WU="f9bea397f";function Hx(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function pd(i){return Math.max(0,Math.min(255,255*i))}var Qg=class{static CMYK_G([e,t,n,s]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=pd(e),[e,e,e]}static G_HTML([e]){let t=Hx(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(pd)}static RGB_HTML(e){return`#${e.map(Hx).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,n+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,n,s]){return[pd(1-Math.min(1,e+s)),pd(1-Math.min(1,n+s)),pd(1-Math.min(1,t+s))]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){let s=1-e,r=1-t,o=1-n,a=Math.min(s,r,o);return["CMYK",s,r,o,a]}},ww=class{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");let s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),n||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){me("Abstract method `_createSVG` called.")}},Vd=class extends ww{_createSVG(e){return document.createElementNS(Oi,e)}},em=class{static setupStorage(e,t,n,s,r){let o=s.getValue(t,{value:null});switch(n.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(o.value===n.attributes.xfaOn?e.setAttribute("checked",!0):o.value===n.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",a=>{s.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(let a of n.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{let l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;s.setValue(t,{value:c})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:s,linkService:r}){let{attributes:o}=t,a=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${s}`);for(let[l,c]of Object.entries(o))if(c!=null)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,c)}a&&r.addLinkAttributes(e,o.href,o.newWindow),n&&o.dataId&&this.setupStorage(e,o.dataId,t,n)}static render(e){let t=e.annotationStorage,n=e.linkService,s=e.xfaHtml,r=e.intent||"display",o=document.createElement(s.name);s.attributes&&this.setAttributes({html:o,element:s,intent:r,linkService:n});let a=r!=="richText",l=e.div;if(l.append(o),e.viewport){let u=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=u}a&&l.setAttribute("class","xfaLayer xfaFont");let c=[];if(s.children.length===0){if(s.value){let u=document.createTextNode(s.value);o.append(u),a&&$d.shouldBuildText(s.name)&&c.push(u)}return{textDivs:c}}let d=[[s,-1,o]];for(;d.length>0;){let[u,p,m]=d.at(-1);if(p+1===u.children.length){d.pop();continue}let y=u.children[++d.at(-1)[1]];if(y===null)continue;let{name:v}=y;if(v==="#text"){let S=document.createTextNode(y.value);c.push(S),m.append(S);continue}let b=y?.attributes?.xmlns?document.createElementNS(y.attributes.xmlns,v):document.createElement(v);if(m.append(b),y.attributes&&this.setAttributes({html:b,element:y,storage:t,intent:r,linkService:n}),y.children?.length>0)d.push([y,-1,b]);else if(y.value){let S=document.createTextNode(y.value);a&&$d.shouldBuildText(v)&&c.push(S),b.append(S)}}for(let u of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))u.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){let t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}},of=1e3,qU=9,ua=new WeakSet;function hr(i){return{width:i[2]-i[0],height:i[3]-i[1]}}var Aw=class{static create(e){switch(e.data.annotationType){case He.LINK:return new tm(e);case He.TEXT:return new Tw(e);case He.WIDGET:switch(e.data.fieldType){case"Tx":return new _w(e);case"Btn":return e.data.radioButton?new nm(e):e.data.checkBox?new Rw(e):new Dw(e);case"Ch":return new Iw(e);case"Sig":return new xw(e)}return new ms(e);case He.POPUP:return new Gd(e);case He.FREETEXT:return new im(e);case He.LINE:return new Nw(e);case He.SQUARE:return new Fw(e);case He.CIRCLE:return new Lw(e);case He.POLYLINE:return new sm(e);case He.CARET:return new Uw(e);case He.INK:return new zd(e);case He.POLYGON:return new Ow(e);case He.HIGHLIGHT:return new rm(e);case He.UNDERLINE:return new Hw(e);case He.SQUIGGLY:return new $w(e);case He.STRIKEOUT:return new Vw(e);case He.STAMP:return new om(e);case He.FILEATTACHMENT:return new Gw(e);default:return new Me(e)}}},Io,Vl,Gl,rh,Cw,xA=class xA{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:s=!1}={}){E(this,rh);E(this,Io,null);E(this,Vl,!1);E(this,Gl,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:n}){return!!(e?.str||t?.str||n?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return xA._hasPopupData(this.data)}updateEdited(e){if(!this.container)return;h(this,Io)||w(this,Io,{rect:this.data.rect.slice(0)});let{rect:t}=e;t&&A(this,rh,Cw).call(this,t),h(this,Gl)?.popup.updateEdited(e)}resetEdited(){h(this,Io)&&(A(this,rh,Cw).call(this,h(this,Io).rect),h(this,Gl)?.popup.resetEdited(),w(this,Io,null))}_createContainer(e){let{data:t,parent:{page:n,viewport:s}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),this instanceof ms||(r.tabIndex=of);let{style:o}=r;if(o.zIndex=this.parent.zIndex++,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof Gd){let{rotation:v}=t;return!t.hasOwnCanvas&&v!==0&&this.setRotation(v,r),r}let{width:a,height:l}=hr(t.rect);if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;let v=t.borderStyle.horizontalCornerRadius,b=t.borderStyle.verticalCornerRadius;if(v>0||b>0){let C=`calc(${v}px * var(--scale-factor)) / calc(${b}px * var(--scale-factor))`;o.borderRadius=C}else if(this instanceof nm){let C=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;o.borderRadius=C}switch(t.borderStyle.style){case ud.SOLID:o.borderStyle="solid";break;case ud.DASHED:o.borderStyle="dashed";break;case ud.BEVELED:j("Unimplemented border style: beveled");break;case ud.INSET:j("Unimplemented border style: inset");break;case ud.UNDERLINE:o.borderBottomStyle="solid";break;default:break}let S=t.borderColor||null;S?(w(this,Vl,!0),o.borderColor=V.makeHexColor(S[0]|0,S[1]|0,S[2]|0)):o.borderWidth=0}let c=V.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:d,pageHeight:u,pageX:p,pageY:m}=s.rawDims;o.left=`${100*(c[0]-p)/d}%`,o.top=`${100*(c[1]-m)/u}%`;let{rotation:y}=t;return t.hasOwnCanvas||y===0?(o.width=`${100*a/d}%`,o.height=`${100*l/u}%`):this.setRotation(y,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;let{pageWidth:n,pageHeight:s}=this.parent.viewport.rawDims,{width:r,height:o}=hr(this.data.rect),a,l;e%180===0?(a=100*r/n,l=100*o/s):(a=100*o/n,l=100*r/s),t.style.width=`${a}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(t,n,s)=>{let r=s.detail[t],o=r[0],a=r.slice(1);s.target.style[n]=Qg[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[n]:Qg[`${o}_rgb`](a)})};return ie(this,"_commonActions",{display:t=>{let{display:n}=t.detail,s=n%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{let{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{let n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){let n=this._commonActions;for(let s of Object.keys(t.detail))(e[s]||n[s])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let n=this._commonActions;for(let[s,r]of Object.entries(t)){let o=n[s];if(o){let a={detail:{[s]:r},target:e};o(a),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:e}=this.data;if(!e)return;let[t,n,s,r]=this.data.rect.map(v=>Math.fround(v));if(e.length===8){let[v,b,S,C]=e.subarray(2,6);if(s===v&&r===b&&t===S&&n===C)return}let{style:o}=this.container,a;if(h(this,Vl)){let{borderColor:v,borderWidth:b}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${v}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}let l=s-t,c=r-n,{svgFactory:d}=this,u=d.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0);let p=d.createElement("defs");u.append(p);let m=d.createElement("clipPath"),y=`clippath_${this.data.id}`;m.setAttribute("id",y),m.setAttribute("clipPathUnits","objectBoundingBox"),p.append(m);for(let v=2,b=e.length;v<b;v+=8){let S=e[v],C=e[v+1],T=e[v+2],_=e[v+3],R=d.createElement("rect"),I=(T-t)/l,M=(r-C)/c,k=(S-T)/l,N=(C-_)/c;R.setAttribute("x",I),R.setAttribute("y",M),R.setAttribute("width",k),R.setAttribute("height",N),m.append(R),a?.push(`<rect vector-effect="non-scaling-stroke" x="${I}" y="${M}" width="${k}" height="${N}"/>`)}h(this,Vl)&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(u),this.container.style.clipPath=`url(#${y})`}_createPopup(){let{data:e}=this,t=w(this,Gl,new Gd({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){me("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let n=[];if(this._fieldObjects){let s=this._fieldObjects[e];if(s)for(let{page:r,id:o,exportValues:a}of s){if(r===-1||o===t)continue;let l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${o}"]`);if(c&&!ua.has(c)){j(`_getElementsByName - element not allowed: ${o}`);continue}n.push({id:o,exportValue:l,domElement:c})}return n}for(let s of document.getElementsByName(e)){let{exportValue:r}=s,o=s.getAttribute("data-element-id");o!==t&&ua.has(s)&&n.push({id:o,exportValue:r,domElement:s})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};Io=new WeakMap,Vl=new WeakMap,Gl=new WeakMap,rh=new WeakSet,Cw=function(e){let{container:{style:t},data:{rect:n,rotation:s},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:l}}}}=this;n?.splice(0,4,...e);let{width:c,height:d}=hr(e);t.left=`${100*(e[0]-a)/r}%`,t.top=`${100*(o-e[3]+l)/o}%`,s===0?(t.width=`${100*c/r}%`,t.height=`${100*d/o}%`):this.setRotation(s)};var Me=xA,ns,Or,ry,NR,oy,FR,tm=class extends Me{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!n?.ignoreBorder,createQuadrilaterals:!0});E(this,ns);E(this,ry);E(this,oy);this.isTooltipOnly=t.data.isTooltipOnly}render(){let{data:t,linkService:n}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let r=!1;return t.url?(n.addLinkAttributes(s,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(s,t.action),r=!0):t.attachment?(A(this,ry,NR).call(this,s,t.attachment,t.attachmentDest),r=!0):t.setOCGState?(A(this,oy,FR).call(this,s,t.setOCGState),r=!0):t.dest?(this._bindLink(s,t.dest),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),r=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(s,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(s),this.container}_bindLink(t,n){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&A(this,ns,Or).call(this)}_bindNamedAction(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),A(this,ns,Or).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");let s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let r of Object.keys(n.actions)){let o=s.get(r);o&&(t[o]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:r}}),!1))}t.onclick||(t.onclick=()=>!1),A(this,ns,Or).call(this)}_bindResetFormAction(t,n){let s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),A(this,ns,Or).call(this),!this._fieldObjects){j('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{s?.();let{fields:r,refs:o,include:a}=n,l=[];if(r.length!==0||o.length!==0){let u=new Set(o);for(let p of r){let m=this._fieldObjects[p]||[];for(let{id:y}of m)u.add(y)}for(let p of Object.values(this._fieldObjects))for(let m of p)u.has(m.id)===a&&l.push(m)}else for(let u of Object.values(this._fieldObjects))l.push(...u);let c=this.annotationStorage,d=[];for(let u of l){let{id:p}=u;switch(d.push(p),u.type){case"text":{let y=u.defaultValue||"";c.setValue(p,{value:y});break}case"checkbox":case"radiobutton":{let y=u.defaultValue===u.exportValues;c.setValue(p,{value:y});break}case"combobox":case"listbox":{let y=u.defaultValue||"";c.setValue(p,{value:y});break}default:continue}let m=document.querySelector(`[data-element-id="${p}"]`);if(m){if(!ua.has(m)){j(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;m.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}}),!1}}};ns=new WeakSet,Or=function(){this.container.setAttribute("data-internal-link","")},ry=new WeakSet,NR=function(t,n,s=null){t.href=this.linkService.getAnchorUrl(""),n.description&&(t.title=n.description),t.onclick=()=>(this.downloadManager?.openOrDownloadData(n.content,n.filename,s),!1),A(this,ns,Or).call(this)},oy=new WeakSet,FR=function(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),A(this,ns,Or).call(this)};var Tw=class extends Me{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}},ms=class extends Me{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return st.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,s,r){n.includes("mouse")?e.addEventListener(n,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(n,o=>{if(n==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}r&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(o)}})})}_setEventListeners(e,t,n,s){for(let[r,o]of n)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,r,o,s),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":V.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||qU,r=e.style,o,a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),d=Math.round(c/(rg*s))||1,u=c/d;o=Math.min(s,l(u/rg))}else{let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(s,l(c/rg))}r.fontSize=`calc(${o}px * var(--scale-factor))`,r.color=V.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}},_w=class extends ms{constructor(e){let t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,s){let r=this.annotationStorage;for(let o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=n),r.setValue(o.id,{[s]:n})}render(){let e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){let s=e.getValue(t,{value:this.data.fieldValue}),r=s.value||"",o=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;o&&r.length>o&&(r=r.slice(0,o));let a=s.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));let l={userValue:r,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=a??r,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",a??r),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),ua.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=of,this._setRequired(n,this.data.required),o&&(n.maxLength=o),n.addEventListener("input",d=>{e.setValue(t,{value:d.target.value}),this.setPropertyOnSiblings(n,"value",d.target.value,"value"),l.formattedValue=null}),n.addEventListener("resetform",d=>{let u=this.data.defaultFieldValue??"";n.value=l.userValue=u,l.formattedValue=null});let c=d=>{let{formattedValue:u}=l;u!=null&&(d.target.value=u),d.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",u=>{if(l.focused)return;let{target:p}=u;l.userValue&&(p.value=l.userValue),l.lastCommittedValue=p.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),n.addEventListener("updatefromsandbox",u=>{this.showElementAndHideCanvas(u.target);let p={value(m){l.userValue=m.detail.value??"",e.setValue(t,{value:l.userValue.toString()}),m.target.value=l.userValue},formattedValue(m){let{formattedValue:y}=m.detail;l.formattedValue=y,y!=null&&m.target!==document.activeElement&&(m.target.value=y),e.setValue(t,{formattedValue:y})},selRange(m){m.target.setSelectionRange(...m.detail.selRange)},charLimit:m=>{let{charLimit:y}=m.detail,{target:v}=m;if(y===0){v.removeAttribute("maxLength");return}v.setAttribute("maxLength",y);let b=l.userValue;!b||b.length<=y||(b=b.slice(0,y),v.value=l.userValue=b,e.setValue(t,{value:b}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:b,willCommit:!0,commitKey:1,selStart:v.selectionStart,selEnd:v.selectionEnd}}))}};this._dispatchEventFromSandbox(p,u)}),n.addEventListener("keydown",u=>{l.commitKey=1;let p=-1;if(u.key==="Escape"?p=0:u.key==="Enter"&&!this.data.multiLine?p=2:u.key==="Tab"&&(l.commitKey=3),p===-1)return;let{value:m}=u.target;l.lastCommittedValue!==m&&(l.lastCommittedValue=m,l.userValue=m,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:m,willCommit:!0,commitKey:p,selStart:u.target.selectionStart,selEnd:u.target.selectionEnd}}))});let d=c;c=null,n.addEventListener("blur",u=>{if(!l.focused||!u.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);let{value:p}=u.target;l.userValue=p,l.lastCommittedValue!==p&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:p,willCommit:!0,commitKey:l.commitKey,selStart:u.target.selectionStart,selEnd:u.target.selectionEnd}}),d(u)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",u=>{l.lastCommittedValue=null;let{data:p,target:m}=u,{value:y,selectionStart:v,selectionEnd:b}=m,S=v,C=b;switch(u.inputType){case"deleteWordBackward":{let T=y.substring(0,v).match(/\w*[^\w]*$/);T&&(S-=T[0].length);break}case"deleteWordForward":{let T=y.substring(v).match(/^[^\w]*\w*/);T&&(C+=T[0].length);break}case"deleteContentBackward":v===b&&(S-=1);break;case"deleteContentForward":v===b&&(C+=1);break}u.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,change:p||"",willCommit:!1,selStart:S,selEnd:C}})}),this._setEventListeners(n,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],u=>u.target.value)}if(c&&n.addEventListener("blur",c),this.data.comb){let u=(this.data.rect[2]-this.data.rect[0])/o;n.classList.add("comb"),n.style.letterSpacing=`calc(${u}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},xw=class extends ms{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}},Rw=class extends ms{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,n=t.id,s=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(n,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let r=document.createElement("input");return ua.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=of,r.addEventListener("change",o=>{let{name:a,checked:l}=o.target;for(let c of this._getElementsByName(a,n)){let d=l&&c.exportValue===t.exportValue;c.domElement&&(c.domElement.checked=d),e.setValue(c.id,{value:d})}e.setValue(n,{value:l})}),r.addEventListener("resetform",o=>{let a=t.defaultFieldValue||"Off";o.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{let a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(n,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},nm=class extends ms{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,t=this.data,n=t.id,s=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(n,{value:s})),s)for(let o of this._getElementsByName(t.fieldName,n))e.setValue(o.id,{value:!1});let r=document.createElement("input");if(ua.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.tabIndex=of,r.addEventListener("change",o=>{let{name:a,checked:l}=o.target;for(let c of this._getElementsByName(a,n))e.setValue(c.id,{value:!1});e.setValue(n,{value:l})}),r.addEventListener("resetform",o=>{let a=t.defaultFieldValue;o.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){let o=t.buttonValue;r.addEventListener("updatefromsandbox",a=>{let l={value:c=>{let d=o===c.detail.value;for(let u of this._getElementsByName(c.target.name)){let p=d&&u.id===n;u.domElement&&(u.domElement.checked=p),e.setValue(u.id,{value:p})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},Dw=class extends tm{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}},Iw=class extends ms{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");ua.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=of;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",d=>{let u=this.data.defaultFieldValue;for(let p of s.options)p.selected=p.value===u});for(let d of this.data.options){let u=document.createElement("option");u.textContent=d.displayValue,u.value=d.exportValue,n.value.includes(d.exportValue)&&(u.setAttribute("selected",!0),r=!1),s.append(u)}let o=null;if(r){let d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),s.prepend(d),o=()=>{d.remove(),s.removeEventListener("input",o),o=null},s.addEventListener("input",o)}let a=d=>{let u=d?"value":"textContent",{options:p,multiple:m}=s;return m?Array.prototype.filter.call(p,y=>y.selected).map(y=>y[u]):p.selectedIndex===-1?null:p[p.selectedIndex][u]},l=a(!1),c=d=>{let u=d.target.options;return Array.prototype.map.call(u,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",d=>{let u={value(p){o?.();let m=p.detail.value,y=new Set(Array.isArray(m)?m:[m]);for(let v of s.options)v.selected=y.has(v.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(p){s.multiple=!0},remove(p){let m=s.options,y=p.detail.remove;m[y].selected=!1,s.remove(y),m.length>0&&Array.prototype.findIndex.call(m,b=>b.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:a(!0),items:c(p)}),l=a(!1)},clear(p){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(p){let{index:m,displayValue:y,exportValue:v}=p.detail.insert,b=s.children[m],S=document.createElement("option");S.textContent=y,S.value=v,b?b.before(S):s.append(S),e.setValue(t,{value:a(!0),items:c(p)}),l=a(!1)},items(p){let{items:m}=p.detail;for(;s.length!==0;)s.remove(0);for(let y of m){let{displayValue:v,exportValue:b}=y,S=document.createElement("option");S.textContent=v,S.value=b,s.append(S)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:a(!0),items:c(p)}),l=a(!1)},indices(p){let m=new Set(p.detail.indices);for(let y of p.target.options)y.selected=m.has(y.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(u,d)}),s.addEventListener("input",d=>{let u=a(!0),p=a(!1);e.setValue(t,{value:u}),d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:p,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):s.addEventListener("input",function(d){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}},Gd=class extends Me{constructor(e){let{data:t,elements:n}=e;super(e,{isRenderable:Me._hasPopupData(t)}),this.elements=n,this.popup=null}render(){this.container.classList.add("popupAnnotation");let e=this.popup=new Mw({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let n of this.elements)n.popup=e,n.container.ariaHasPopup="dialog",t.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(n=>`${SA}${n}`).join(",")),this.container}},zl,ay,ly,Wl,Mo,xe,is,ql,oh,ah,Yl,ss,On,rs,lh,os,ch,Po,ko,Kl,Sg,dh,Pw,cy,LR,dy,OR,uy,UR,hy,BR,Xl,wg,Jl,Ag,uh,kw,Mw=class{constructor({container:e,color:t,elements:n,titleObj:s,modificationDate:r,contentsObj:o,richText:a,parent:l,rect:c,parentRect:d,open:u}){E(this,Kl);E(this,dh);E(this,cy);E(this,dy);E(this,uy);E(this,hy);E(this,Xl);E(this,Jl);E(this,uh);E(this,zl,A(this,uy,UR).bind(this));E(this,ay,A(this,uh,kw).bind(this));E(this,ly,A(this,Jl,Ag).bind(this));E(this,Wl,A(this,Xl,wg).bind(this));E(this,Mo,null);E(this,xe,null);E(this,is,null);E(this,ql,null);E(this,oh,null);E(this,ah,null);E(this,Yl,null);E(this,ss,!1);E(this,On,null);E(this,rs,null);E(this,lh,null);E(this,os,null);E(this,ch,null);E(this,Po,null);E(this,ko,!1);w(this,xe,e),w(this,ch,s),w(this,is,o),w(this,os,a),w(this,ah,l),w(this,Mo,t),w(this,lh,c),w(this,Yl,d),w(this,oh,n),w(this,ql,Pd.toDateObject(r)),this.trigger=n.flatMap(p=>p.getElementsToTriggerPopup());for(let p of this.trigger)p.addEventListener("click",h(this,Wl)),p.addEventListener("mouseenter",h(this,ly)),p.addEventListener("mouseleave",h(this,ay)),p.classList.add("popupTriggerArea");for(let p of n)p.container?.addEventListener("keydown",h(this,zl));h(this,xe).hidden=!0,u&&A(this,Xl,wg).call(this)}render(){if(h(this,On))return;let e=w(this,On,document.createElement("div"));if(e.className="popup",h(this,Mo)){let r=e.style.outlineColor=V.makeHexColor(...h(this,Mo));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`:e.style.backgroundColor=V.makeHexColor(...h(this,Mo).map(a=>Math.floor(.7*(255-a)+a)))}let t=document.createElement("span");t.className="header";let n=document.createElement("h1");if(t.append(n),{dir:n.dir,str:n.textContent}=h(this,ch),e.append(t),h(this,ql)){let r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:h(this,ql).valueOf()})),t.append(r)}let s=h(this,Kl,Sg);if(s)em.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{let r=this._formatContents(h(this,is));e.append(r)}h(this,xe).append(e)}_formatContents({str:e,dir:t}){let n=document.createElement("p");n.classList.add("popupContent"),n.dir=t;let s=e.split(/(?:\r\n?|\n)/);for(let r=0,o=s.length;r<o;++r){let a=s[r];n.append(document.createTextNode(a)),r<o-1&&n.append(document.createElement("br"))}return n}updateEdited({rect:e,popupContent:t}){h(this,Po)||w(this,Po,{contentsObj:h(this,is),richText:h(this,os)}),e&&w(this,rs,null),t&&(w(this,os,A(this,dy,OR).call(this,t)),w(this,is,null)),h(this,On)?.remove(),w(this,On,null)}resetEdited(){h(this,Po)&&({contentsObj:bt(this,is)._,richText:bt(this,os)._}=h(this,Po),w(this,Po,null),h(this,On)?.remove(),w(this,On,null),w(this,rs,null))}forceHide(){w(this,ko,this.isVisible),h(this,ko)&&(h(this,xe).hidden=!0)}maybeShow(){h(this,ko)&&(h(this,On)||A(this,Jl,Ag).call(this),w(this,ko,!1),h(this,xe).hidden=!1)}get isVisible(){return h(this,xe).hidden===!1}};zl=new WeakMap,ay=new WeakMap,ly=new WeakMap,Wl=new WeakMap,Mo=new WeakMap,xe=new WeakMap,is=new WeakMap,ql=new WeakMap,oh=new WeakMap,ah=new WeakMap,Yl=new WeakMap,ss=new WeakMap,On=new WeakMap,rs=new WeakMap,lh=new WeakMap,os=new WeakMap,ch=new WeakMap,Po=new WeakMap,ko=new WeakMap,Kl=new WeakSet,Sg=function(){let e=h(this,os),t=h(this,is);return e?.str&&(!t?.str||t.str===e.str)&&h(this,os).html||null},dh=new WeakSet,Pw=function(){return h(this,Kl,Sg)?.attributes?.style?.fontSize||0},cy=new WeakSet,LR=function(){return h(this,Kl,Sg)?.attributes?.style?.color||null},dy=new WeakSet,OR=function(e){let t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:h(this,cy,LR),fontSize:h(this,dh,Pw)?`calc(${h(this,dh,Pw)}px * var(--scale-factor))`:""}};for(let r of e.split(`
`))t.push({name:"span",value:r,attributes:s});return n},uy=new WeakSet,UR=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&h(this,ss))&&A(this,Xl,wg).call(this)},hy=new WeakSet,BR=function(){if(h(this,rs)!==null)return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:s,pageY:r}}}=h(this,ah),o=!!h(this,Yl),a=o?h(this,Yl):h(this,lh);for(let y of h(this,oh))if(!a||V.intersect(y.data.rect,a)!==null){a=y.data.rect,o=!0;break}let l=V.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),d=o?a[2]-a[0]+5:0,u=l[0]+d,p=l[1];w(this,rs,[100*(u-s)/t,100*(p-r)/n]);let{style:m}=h(this,xe);m.left=`${h(this,rs)[0]}%`,m.top=`${h(this,rs)[1]}%`},Xl=new WeakSet,wg=function(){w(this,ss,!h(this,ss)),h(this,ss)?(A(this,Jl,Ag).call(this),h(this,xe).addEventListener("click",h(this,Wl)),h(this,xe).addEventListener("keydown",h(this,zl))):(A(this,uh,kw).call(this),h(this,xe).removeEventListener("click",h(this,Wl)),h(this,xe).removeEventListener("keydown",h(this,zl)))},Jl=new WeakSet,Ag=function(){h(this,On)||this.render(),this.isVisible?h(this,ss)&&h(this,xe).classList.add("focused"):(A(this,hy,BR).call(this),h(this,xe).hidden=!1,h(this,xe).style.zIndex=parseInt(h(this,xe).style.zIndex)+1e3)},uh=new WeakSet,kw=function(){h(this,xe).classList.remove("focused"),!(h(this,ss)||!this.isVisible)&&(h(this,xe).hidden=!0,h(this,xe).style.zIndex=parseInt(h(this,xe).style.zIndex)-1e3)};var im=class extends Me{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Z.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(let t of this.textContent){let n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},hh,Nw=class extends Me{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,hh,null)}render(){this.container.classList.add("lineAnnotation");let t=this.data,{width:n,height:s}=hr(t.rect),r=this.svgFactory.create(n,s,!0),o=w(this,hh,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return h(this,hh)}addHighlightArea(){this.container.classList.add("highlightArea")}};hh=new WeakMap;var fh,Fw=class extends Me{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,fh,null)}render(){this.container.classList.add("squareAnnotation");let t=this.data,{width:n,height:s}=hr(t.rect),r=this.svgFactory.create(n,s,!0),o=t.borderStyle.width,a=w(this,fh,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",o/2),a.setAttribute("y",o/2),a.setAttribute("width",n-o),a.setAttribute("height",s-o),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return h(this,fh)}addHighlightArea(){this.container.classList.add("highlightArea")}};fh=new WeakMap;var ph,Lw=class extends Me{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,ph,null)}render(){this.container.classList.add("circleAnnotation");let t=this.data,{width:n,height:s}=hr(t.rect),r=this.svgFactory.create(n,s,!0),o=t.borderStyle.width,a=w(this,ph,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",n/2),a.setAttribute("cy",s/2),a.setAttribute("rx",n/2-o/2),a.setAttribute("ry",s/2-o/2),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return h(this,ph)}addHighlightArea(){this.container.classList.add("highlightArea")}};ph=new WeakMap;var gh,sm=class extends Me{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,gh,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,vertices:n,borderStyle:s,popupRef:r}}=this;if(!n)return this.container;let{width:o,height:a}=hr(t),l=this.svgFactory.create(o,a,!0),c=[];for(let u=0,p=n.length;u<p;u+=2){let m=n[u]-t[0],y=t[3]-n[u+1];c.push(`${m},${y}`)}c=c.join(" ");let d=w(this,gh,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",c),d.setAttribute("stroke-width",s.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),l.append(d),this.container.append(l),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return h(this,gh)}addHighlightArea(){this.container.classList.add("highlightArea")}};gh=new WeakMap;var Ow=class extends sm{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},Uw=class extends Me{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},mh,No,yh,Bw,zd=class extends Me{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,yh);E(this,mh,null);E(this,No,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Z.HIGHLIGHT:Z.INK}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,rotation:n,inkLists:s,borderStyle:r,popupRef:o}}=this,{transform:a,width:l,height:c}=A(this,yh,Bw).call(this,n,t),d=this.svgFactory.create(l,c,!0),u=w(this,mh,this.svgFactory.createElement("svg:g"));d.append(u),u.setAttribute("stroke-width",r.width||1),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("stroke-miterlimit",10),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),u.setAttribute("transform",a);for(let p=0,m=s.length;p<m;p++){let y=this.svgFactory.createElement(this.svgElementName);h(this,No).push(y),y.setAttribute("points",s[p].join(",")),u.append(y)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);let{thickness:n,points:s,rect:r}=t,o=h(this,mh);if(n>=0&&o.setAttribute("stroke-width",n||1),s)for(let a=0,l=h(this,No).length;a<l;a++)h(this,No)[a].setAttribute("points",s[a].join(","));if(r){let{transform:a,width:l,height:c}=A(this,yh,Bw).call(this,this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${l} ${c}`),o.setAttribute("transform",a)}}getElementsToTriggerPopup(){return h(this,No)}addHighlightArea(){this.container.classList.add("highlightArea")}};mh=new WeakMap,No=new WeakMap,yh=new WeakSet,Bw=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};var rm=class extends Me{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Z.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},Hw=class extends Me{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},$w=class extends Me{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},Vw=class extends Me{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},om=class extends Me{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Z.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},vh,bh,zw,Gw=class extends Me{constructor(t){super(t,{isRenderable:!0});E(this,bh);E(this,vh,null);let{file:n}=this.data;this.filename=n.filename,this.content=n.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:t,data:n}=this,s;n.hasAppearance||n.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),s.addEventListener("dblclick",A(this,bh,zw).bind(this)),w(this,vh,s);let{isMac:r}=st.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&A(this,bh,zw).call(this)}),!n.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return h(this,vh)}addHighlightArea(){this.container.classList.add("highlightArea")}};vh=new WeakMap,bh=new WeakSet,zw=function(){this.downloadManager?.openOrDownloadData(this.content,this.filename)};var Eh,Fo,Lo,Sh,fy,HR,wh,qw,Ww=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:s,page:r,viewport:o,structTreeLayer:a}){E(this,fy);E(this,wh);E(this,Eh,null);E(this,Fo,null);E(this,Lo,new Map);E(this,Sh,null);this.div=e,w(this,Eh,t),w(this,Fo,n),w(this,Sh,a||null),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return h(this,Lo).size>0}async render(e){let{annotations:t}=e,n=this.div;la(n,this.viewport);let s=new Map,r={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Vd,annotationStorage:e.annotationStorage||new Ud,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let o of t){if(o.noHTML)continue;let a=o.annotationType===He.POPUP;if(a){let d=s.get(o.id);if(!d)continue;r.elements=d}else{let{width:d,height:u}=hr(o.rect);if(d<=0||u<=0)continue}r.data=o;let l=Aw.create(r);if(!l.isRenderable)continue;if(!a&&o.popupRef){let d=s.get(o.popupRef);d?d.push(l):s.set(o.popupRef,[l])}let c=l.render();o.hidden&&(c.style.visibility="hidden"),await A(this,fy,HR).call(this,c,o.id),l._isEditable&&(h(this,Lo).set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}A(this,wh,qw).call(this)}update({viewport:e}){let t=this.div;this.viewport=e,la(t,{rotation:e.rotation}),A(this,wh,qw).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(h(this,Lo).values())}getEditableAnnotation(e){return h(this,Lo).get(e)}};Eh=new WeakMap,Fo=new WeakMap,Lo=new WeakMap,Sh=new WeakMap,fy=new WeakSet,HR=async function(e,t){let n=e.firstChild||e,s=n.id=`${SA}${t}`,r=await h(this,Sh)?.getAriaAttributes(s);if(r)for(let[o,a]of r)n.setAttribute(o,a);this.div.append(e),h(this,Eh)?.moveElementInDOM(this.div,e,n,!1)},wh=new WeakSet,qw=function(){if(!h(this,Fo))return;let e=this.div;for(let[t,n]of h(this,Fo)){let s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;n.className="annotationContent";let{firstChild:r}=s;r?r.nodeName==="CANVAS"?r.replaceWith(n):r.classList.contains("annotationContent")?r.after(n):r.before(n):s.append(n)}h(this,Fo).clear()};var sg=/\r\n?|\n/g,Un,Yt,Ah,Oo,Kt,py,$R,gy,VR,my,GR,Zl,Cg,jl,Tg,Ql,_g,yy,zR,Ch,Kw,vy,WR,ge=class ge extends Te{constructor(t){super({...t,name:"freeTextEditor"});E(this,py);E(this,gy);E(this,my);E(this,Zl);E(this,Ql);E(this,yy);E(this,vy);E(this,Un,void 0);E(this,Yt,"");E(this,Ah,`${this.id}-editor`);E(this,Oo,null);E(this,Kt,void 0);w(this,Un,t.color||ge._defaultColor||Te._defaultLineColor),w(this,Kt,t.fontSize||ge._defaultFontSize)}static get _keyboardManager(){let t=ge.prototype,n=o=>o.isEmpty(),s=da.TRANSLATE_SMALL,r=da.TRANSLATE_BIG;return ie(this,"_keyboardManager",new ca([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:n}]]))}static initialize(t,n){Te.initialize(t,n);let s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case re.FREETEXT_SIZE:ge._defaultFontSize=n;break;case re.FREETEXT_COLOR:ge._defaultColor=n;break}}updateParams(t,n){switch(t){case re.FREETEXT_SIZE:A(this,py,$R).call(this,n);break;case re.FREETEXT_COLOR:A(this,gy,VR).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[re.FREETEXT_SIZE,ge._defaultFontSize],[re.FREETEXT_COLOR,ge._defaultColor||Te._defaultLineColor]]}get propertiesToUpdate(){return[[re.FREETEXT_SIZE,h(this,Kt)],[re.FREETEXT_COLOR,h(this,Un)]]}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){let t=this.parentScale;return[-ge._internalPadding*t,-(ge._internalPadding+h(this,Kt))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Z.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),w(this,Oo,new AbortController);let t=this._uiManager.combinedSignal(h(this,Oo));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",h(this,Ah)),this._isDraggable=!0,h(this,Oo)?.abort(),w(this,Oo,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let t=h(this,Yt),n=w(this,Yt,A(this,my,GR).call(this).trimEnd());if(t===n)return;let s=r=>{if(w(this,Yt,r),!r){this.remove();return}A(this,Ql,_g).call(this),this._uiManager.rebuild(this),A(this,Zl,Cg).call(this)};this.addCommands({cmd:()=>{s(n)},undo:()=>{s(t)},mustExec:!1}),A(this,Zl,Cg).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){ge._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,n;this.width&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",h(this,Ah)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:s}=this.editorDiv;if(s.fontSize=`calc(${h(this,Kt)}px * var(--scale-factor))`,s.color=h(this,Un),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Ug(this,this.div,["dblclick","keydown"]),this.width){let[r,o]=this.parentDimensions;if(this.annotationElementId){let{position:a}=this._initialData,[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);let[d,u]=this.pageDimensions,[p,m]=this.pageTranslation,y,v;switch(this.rotation){case 0:y=t+(a[0]-p)/d,v=n+this.height-(a[1]-m)/u;break;case 90:y=t+(a[0]-p)/d,v=n-(a[1]-m)/u,[l,c]=[c,-l];break;case 180:y=t-this.width+(a[0]-p)/d,v=n-(a[1]-m)/u,[l,c]=[-l,-c];break;case 270:y=t+(a[0]-p-this.height*u)/d,v=n+(a[1]-m-this.width*d)/u,[l,c]=[-c,l];break}this.setAt(y*r,v*o,l,c)}else this.setAt(t*r,n*o,this.width*r,this.height*o);A(this,Ql,_g).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var y,v,b;let n=t.clipboardData||window.clipboardData,{types:s}=n;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();let r=A(y=ge,Ch,Kw).call(y,n.getData("text")||"").replaceAll(sg,`
`);if(!r)return;let o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();let a=o.getRangeAt(0);if(!r.includes(`
`)){a.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}let{startContainer:l,startOffset:c}=a,d=[],u=[];if(l.nodeType===Node.TEXT_NODE){let S=l.parentElement;if(u.push(l.nodeValue.slice(c).replaceAll(sg,"")),S!==this.editorDiv){let C=d;for(let T of this.editorDiv.childNodes){if(T===S){C=u;continue}C.push(A(v=ge,jl,Tg).call(v,T))}}d.push(l.nodeValue.slice(0,c).replaceAll(sg,""))}else if(l===this.editorDiv){let S=d,C=0;for(let T of this.editorDiv.childNodes)C++===c&&(S=u),S.push(A(b=ge,jl,Tg).call(b,T))}w(this,Yt,`${d.join(`
`)}${r}${u.join(`
`)}`),A(this,Ql,_g).call(this);let p=new Range,m=d.reduce((S,C)=>S+C.length,0);for(let{firstChild:S}of this.editorDiv.childNodes)if(S.nodeType===Node.TEXT_NODE){let C=S.nodeValue.length;if(m<=C){p.setStart(S,m),p.setEnd(S,m);break}m-=C}o.removeAllRanges(),o.addRange(p)}get contentDiv(){return this.editorDiv}static async deserialize(t,n,s){var a;let r=null;if(t instanceof im){let{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:d,rotation:u,id:p,popupRef:m},textContent:y,textPosition:v,parent:{page:{pageNumber:b}}}=t;if(!y||y.length===0)return null;r=t={annotationType:Z.FREETEXT,color:Array.from(c),fontSize:l,value:y.join(`
`),position:v,pageIndex:b-1,rect:d.slice(0),rotation:u,id:p,deleted:!1,popupRef:m}}let o=await super.deserialize(t,n,s);return w(o,Kt,t.fontSize),w(o,Un,V.makeHexColor(...t.color)),w(o,Yt,A(a=ge,Ch,Kw).call(a,t.value)),o.annotationElementId=t.id||null,o._initialData=r,o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let n=ge._internalPadding*this.parentScale,s=this.getRect(n,n),r=Te._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:h(this,Un)),o={annotationType:Z.FREETEXT,color:r,fontSize:h(this,Kt),value:A(this,yy,zR).call(this),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?o:this.annotationElementId&&!A(this,vy,WR).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(t){let n=super.renderAnnotationElement(t);if(this.deleted)return n;let{style:s}=n;s.fontSize=`calc(${h(this,Kt)}px * var(--scale-factor))`,s.color=h(this,Un),n.replaceChildren();for(let o of h(this,Yt).split(`
`)){let a=document.createElement("div");a.append(o?document.createTextNode(o):document.createElement("br")),n.append(a)}let r=ge._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(r,r),popupContent:h(this,Yt)}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Un=new WeakMap,Yt=new WeakMap,Ah=new WeakMap,Oo=new WeakMap,Kt=new WeakMap,py=new WeakSet,$R=function(t){let n=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--scale-factor))`,this.translate(0,-(r-h(this,Kt))*this.parentScale),w(this,Kt,r),A(this,Zl,Cg).call(this)},s=h(this,Kt);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:re.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},gy=new WeakSet,VR=function(t){let n=r=>{w(this,Un,this.editorDiv.style.color=r)},s=h(this,Un);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:re.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},my=new WeakSet,GR=function(){var s;let t=[];this.editorDiv.normalize();let n=null;for(let r of this.editorDiv.childNodes)n?.nodeType===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(A(s=ge,jl,Tg).call(s,r)),n=r);return t.join(`
`)},Zl=new WeakSet,Cg=function(){let[t,n]=this.parentDimensions,s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{let{currentLayer:r,div:o}=this,a=o.style.display,l=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),s=o.getBoundingClientRect(),o.remove(),o.style.display=a,o.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/n):(this.width=s.height/t,this.height=s.width/n),this.fixAndSetPosition()},jl=new WeakSet,Tg=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(sg,"")},Ql=new WeakSet,_g=function(){if(this.editorDiv.replaceChildren(),!!h(this,Yt))for(let t of h(this,Yt).split(`
`)){let n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},yy=new WeakSet,zR=function(){return h(this,Yt).replaceAll("\xA0"," ")},Ch=new WeakSet,Kw=function(t){return t.replaceAll(" ","\xA0")},vy=new WeakSet,WR=function(t){let{value:n,fontSize:s,color:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||t.value!==n||t.fontSize!==s||t.color.some((a,l)=>a!==r[l])||t.pageIndex!==o},E(ge,jl),E(ge,Ch),Y(ge,"_freeTextDefaultContent",""),Y(ge,"_internalPadding",0),Y(ge,"_defaultColor",null),Y(ge,"_defaultFontSize",10),Y(ge,"_type","freetext"),Y(ge,"_editorType",Z.FREETEXT);var Yw=ge,B=class{toSVGPath(){me("Abstract method `toSVGPath` must be implemented.")}get box(){me("Abstract getter `box` must be implemented.")}serialize(e,t){me("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,s,r,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a]*s,o[a+1]=n+e[a+1]*r;return o}static _rescaleAndSwap(e,t,n,s,r,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a+1]*s,o[a+1]=n+e[a]*r;return o}static _translate(e,t,n,s){s||(s=new Float32Array(e.length));for(let r=0,o=e.length;r<o;r+=2)s[r]=t+e[r],s[r+1]=n+e[r+1];return s}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,s,r){switch(r){case 90:return[1-t/n,e/s];case 180:return[1-e/n,1-t/s];case 270:return[t/n,1-e/s];default:return[e/n,t/s]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,s,r,o){return[(e+5*n)/6,(t+5*s)/6,(5*n+r)/6,(5*s+o)/6,(n+r)/2,(s+o)/2]}};Y(B,"PRECISION",1e-4);var Xt,Bn,ec,tc,fi,ne,Uo,Bo,Th,_h,nc,ic,Qs,xh,by,Ey,Ho,Cd,Sy,qR,wy,YR,Ay,KR,Cy,XR,Ty,JR,_y,ZR,$i=class $i{constructor({x:e,y:t},n,s,r,o,a=0){E(this,Ho);E(this,Sy);E(this,wy);E(this,Ay);E(this,Cy);E(this,Ty);E(this,_y);E(this,Xt,void 0);E(this,Bn,[]);E(this,ec,void 0);E(this,tc,void 0);E(this,fi,[]);E(this,ne,new Float32Array(18));E(this,Uo,void 0);E(this,Bo,void 0);E(this,Th,void 0);E(this,_h,void 0);E(this,nc,void 0);E(this,ic,void 0);E(this,Qs,[]);w(this,Xt,n),w(this,ic,r*s),w(this,tc,o),h(this,ne).set([NaN,NaN,NaN,NaN,e,t],6),w(this,ec,a),w(this,_h,h($i,xh)*s),w(this,Th,h($i,Ey)*s),w(this,nc,s),h(this,Qs).push(e,t)}isEmpty(){return isNaN(h(this,ne)[8])}add({x:e,y:t}){w(this,Uo,e),w(this,Bo,t);let[n,s,r,o]=h(this,Xt),[a,l,c,d]=h(this,ne).subarray(8,12),u=e-c,p=t-d,m=Math.hypot(u,p);if(m<h(this,Th))return!1;let y=m-h(this,_h),v=y/m,b=v*u,S=v*p,C=a,T=l;a=c,l=d,c+=b,d+=S,h(this,Qs)?.push(e,t);let _=-S/y,R=b/y,I=_*h(this,ic),M=R*h(this,ic);return h(this,ne).set(h(this,ne).subarray(2,8),0),h(this,ne).set([c+I,d+M],4),h(this,ne).set(h(this,ne).subarray(14,18),12),h(this,ne).set([c-I,d-M],16),isNaN(h(this,ne)[6])?(h(this,fi).length===0&&(h(this,ne).set([a+I,l+M],2),h(this,fi).push(NaN,NaN,NaN,NaN,(a+I-n)/r,(l+M-s)/o),h(this,ne).set([a-I,l-M],14),h(this,Bn).push(NaN,NaN,NaN,NaN,(a-I-n)/r,(l-M-s)/o)),h(this,ne).set([C,T,a,l,c,d],6),!this.isEmpty()):(h(this,ne).set([C,T,a,l,c,d],6),Math.abs(Math.atan2(T-l,C-a)-Math.atan2(S,b))<Math.PI/2?([a,l,c,d]=h(this,ne).subarray(2,6),h(this,fi).push(NaN,NaN,NaN,NaN,((a+c)/2-n)/r,((l+d)/2-s)/o),[a,l,C,T]=h(this,ne).subarray(14,18),h(this,Bn).push(NaN,NaN,NaN,NaN,((C+a)/2-n)/r,((T+l)/2-s)/o),!0):([C,T,a,l,c,d]=h(this,ne).subarray(0,6),h(this,fi).push(((C+5*a)/6-n)/r,((T+5*l)/6-s)/o,((5*a+c)/6-n)/r,((5*l+d)/6-s)/o,((a+c)/2-n)/r,((l+d)/2-s)/o),[c,d,a,l,C,T]=h(this,ne).subarray(12,18),h(this,Bn).push(((C+5*a)/6-n)/r,((T+5*l)/6-s)/o,((5*a+c)/6-n)/r,((5*l+d)/6-s)/o,((a+c)/2-n)/r,((l+d)/2-s)/o),!0))}toSVGPath(){if(this.isEmpty())return"";let e=h(this,fi),t=h(this,Bn);if(isNaN(h(this,ne)[6])&&!this.isEmpty())return A(this,Sy,qR).call(this);let n=[];n.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?n.push(`L${e[s+4]} ${e[s+5]}`):n.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);A(this,Ay,KR).call(this,n);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?n.push(`L${t[s+4]} ${t[s+5]}`):n.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return A(this,wy,YR).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,s,r,o){return new lm(e,t,n,s,r,o)}getOutlines(){let e=h(this,fi),t=h(this,Bn),n=h(this,ne),[s,r,o,a]=h(this,Xt),l=new Float32Array((h(this,Qs)?.length??0)+2);for(let u=0,p=l.length-2;u<p;u+=2)l[u]=(h(this,Qs)[u]-s)/o,l[u+1]=(h(this,Qs)[u+1]-r)/a;if(l[l.length-2]=(h(this,Uo)-s)/o,l[l.length-1]=(h(this,Bo)-r)/a,isNaN(n[6])&&!this.isEmpty())return A(this,Cy,XR).call(this,l);let c=new Float32Array(h(this,fi).length+24+h(this,Bn).length),d=e.length;for(let u=0;u<d;u+=2){if(isNaN(e[u])){c[u]=c[u+1]=NaN;continue}c[u]=e[u],c[u+1]=e[u+1]}d=A(this,_y,ZR).call(this,c,d);for(let u=t.length-6;u>=6;u-=6)for(let p=0;p<6;p+=2){if(isNaN(t[u+p])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=t[u+p],c[d+1]=t[u+p+1],d+=2}return A(this,Ty,JR).call(this,c,d),this.newFreeDrawOutline(c,l,h(this,Xt),h(this,nc),h(this,ec),h(this,tc))}};Xt=new WeakMap,Bn=new WeakMap,ec=new WeakMap,tc=new WeakMap,fi=new WeakMap,ne=new WeakMap,Uo=new WeakMap,Bo=new WeakMap,Th=new WeakMap,_h=new WeakMap,nc=new WeakMap,ic=new WeakMap,Qs=new WeakMap,xh=new WeakMap,by=new WeakMap,Ey=new WeakMap,Ho=new WeakSet,Cd=function(){let e=h(this,ne).subarray(4,6),t=h(this,ne).subarray(16,18),[n,s,r,o]=h(this,Xt);return[(h(this,Uo)+(e[0]-t[0])/2-n)/r,(h(this,Bo)+(e[1]-t[1])/2-s)/o,(h(this,Uo)+(t[0]-e[0])/2-n)/r,(h(this,Bo)+(t[1]-e[1])/2-s)/o]},Sy=new WeakSet,qR=function(){let[e,t,n,s]=h(this,Xt),[r,o,a,l]=A(this,Ho,Cd).call(this);return`M${(h(this,ne)[2]-e)/n} ${(h(this,ne)[3]-t)/s} L${(h(this,ne)[4]-e)/n} ${(h(this,ne)[5]-t)/s} L${r} ${o} L${a} ${l} L${(h(this,ne)[16]-e)/n} ${(h(this,ne)[17]-t)/s} L${(h(this,ne)[14]-e)/n} ${(h(this,ne)[15]-t)/s} Z`},wy=new WeakSet,YR=function(e){let t=h(this,Bn);e.push(`L${t[4]} ${t[5]} Z`)},Ay=new WeakSet,KR=function(e){let[t,n,s,r]=h(this,Xt),o=h(this,ne).subarray(4,6),a=h(this,ne).subarray(16,18),[l,c,d,u]=A(this,Ho,Cd).call(this);e.push(`L${(o[0]-t)/s} ${(o[1]-n)/r} L${l} ${c} L${d} ${u} L${(a[0]-t)/s} ${(a[1]-n)/r}`)},Cy=new WeakSet,XR=function(e){let t=h(this,ne),[n,s,r,o]=h(this,Xt),[a,l,c,d]=A(this,Ho,Cd).call(this),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(t[2]-n)/r,(t[3]-s)/o,NaN,NaN,NaN,NaN,(t[4]-n)/r,(t[5]-s)/o,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(t[16]-n)/r,(t[17]-s)/o,NaN,NaN,NaN,NaN,(t[14]-n)/r,(t[15]-s)/o],0),this.newFreeDrawOutline(u,e,h(this,Xt),h(this,nc),h(this,ec),h(this,tc))},Ty=new WeakSet,JR=function(e,t){let n=h(this,Bn);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},_y=new WeakSet,ZR=function(e,t){let n=h(this,ne).subarray(4,6),s=h(this,ne).subarray(16,18),[r,o,a,l]=h(this,Xt),[c,d,u,p]=A(this,Ho,Cd).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-r)/a,(n[1]-o)/l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,u,p,NaN,NaN,NaN,NaN,(s[0]-r)/a,(s[1]-o)/l],t),t+=24},E($i,xh,8),E($i,by,2),E($i,Ey,h($i,xh)+h($i,by));var am=$i,sc,$o,as,Rh,Jt,Dh,Ie,xy,jR,lm=class extends B{constructor(t,n,s,r,o,a){super();E(this,xy);E(this,sc,void 0);E(this,$o,new Float32Array(4));E(this,as,void 0);E(this,Rh,void 0);E(this,Jt,void 0);E(this,Dh,void 0);E(this,Ie,void 0);w(this,Ie,t),w(this,Jt,n),w(this,sc,s),w(this,Dh,r),w(this,as,o),w(this,Rh,a),this.lastPoint=[NaN,NaN],A(this,xy,jR).call(this,a);let[l,c,d,u]=h(this,$o);for(let p=0,m=t.length;p<m;p+=2)t[p]=(t[p]-l)/d,t[p+1]=(t[p+1]-c)/u;for(let p=0,m=n.length;p<m;p+=2)n[p]=(n[p]-l)/d,n[p+1]=(n[p+1]-c)/u}toSVGPath(){let t=[`M${h(this,Ie)[4]} ${h(this,Ie)[5]}`];for(let n=6,s=h(this,Ie).length;n<s;n+=6){if(isNaN(h(this,Ie)[n])){t.push(`L${h(this,Ie)[n+4]} ${h(this,Ie)[n+5]}`);continue}t.push(`C${h(this,Ie)[n]} ${h(this,Ie)[n+1]} ${h(this,Ie)[n+2]} ${h(this,Ie)[n+3]} ${h(this,Ie)[n+4]} ${h(this,Ie)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,s,r],o){let a=s-t,l=r-n,c,d;switch(o){case 0:c=B._rescale(h(this,Ie),t,r,a,-l),d=B._rescale(h(this,Jt),t,r,a,-l);break;case 90:c=B._rescaleAndSwap(h(this,Ie),t,n,a,l),d=B._rescaleAndSwap(h(this,Jt),t,n,a,l);break;case 180:c=B._rescale(h(this,Ie),s,n,-a,l),d=B._rescale(h(this,Jt),s,n,-a,l);break;case 270:c=B._rescaleAndSwap(h(this,Ie),s,r,-a,-l),d=B._rescaleAndSwap(h(this,Jt),s,r,-a,-l);break}return{outline:Array.from(c),points:[Array.from(d)]}}get box(){return h(this,$o)}newOutliner(t,n,s,r,o,a=0){return new am(t,n,s,r,o,a)}getNewOutline(t,n){let[s,r,o,a]=h(this,$o),[l,c,d,u]=h(this,sc),p=o*d,m=a*u,y=s*d+l,v=r*u+c,b=this.newOutliner({x:h(this,Jt)[0]*p+y,y:h(this,Jt)[1]*m+v},h(this,sc),h(this,Dh),t,h(this,Rh),n??h(this,as));for(let S=2;S<h(this,Jt).length;S+=2)b.add({x:h(this,Jt)[S]*p+y,y:h(this,Jt)[S+1]*m+v});return b.getOutlines()}};sc=new WeakMap,$o=new WeakMap,as=new WeakMap,Rh=new WeakMap,Jt=new WeakMap,Dh=new WeakMap,Ie=new WeakMap,xy=new WeakSet,jR=function(t){let n=h(this,Ie),s=n[4],r=n[5],o=s,a=r,l=s,c=r,d=s,u=r,p=t?Math.max:Math.min;for(let y=6,v=n.length;y<v;y+=6){if(isNaN(n[y]))o=Math.min(o,n[y+4]),a=Math.min(a,n[y+5]),l=Math.max(l,n[y+4]),c=Math.max(c,n[y+5]),u<n[y+5]?(d=n[y+4],u=n[y+5]):u===n[y+5]&&(d=p(d,n[y+4]));else{let b=V.bezierBoundingBox(s,r,...n.slice(y,y+6));o=Math.min(o,b[0]),a=Math.min(a,b[1]),l=Math.max(l,b[2]),c=Math.max(c,b[3]),u<b[3]?(d=b[2],u=b[3]):u===b[3]&&(d=p(d,b[2]))}s=n[y+4],r=n[y+5]}let m=h(this,$o);m[0]=o-h(this,as),m[1]=a-h(this,as),m[2]=l-o+2*h(this,as),m[3]=c-a+2*h(this,as),this.lastPoint=[d,u]};var Ih,Mh,er,Hn,Ry,QR,rc,xg,Dy,eD,Iy,tD,Ph,Xw,Wd=class{constructor(e,t=0,n=0,s=!0){E(this,Ry);E(this,rc);E(this,Dy);E(this,Iy);E(this,Ph);E(this,Ih,void 0);E(this,Mh,void 0);E(this,er,[]);E(this,Hn,[]);let r=1/0,o=-1/0,a=1/0,l=-1/0,d=10**-4;for(let{x:S,y:C,width:T,height:_}of e){let R=Math.floor((S-t)/d)*d,I=Math.ceil((S+T+t)/d)*d,M=Math.floor((C-t)/d)*d,k=Math.ceil((C+_+t)/d)*d,N=[R,M,k,!0],F=[I,M,k,!1];h(this,er).push(N,F),r=Math.min(r,R),o=Math.max(o,I),a=Math.min(a,M),l=Math.max(l,k)}let u=o-r+2*n,p=l-a+2*n,m=r-n,y=a-n,v=h(this,er).at(s?-1:-2),b=[v[0],v[2]];for(let S of h(this,er)){let[C,T,_]=S;S[0]=(C-m)/u,S[1]=(T-y)/p,S[2]=(_-y)/p}w(this,Ih,new Float32Array([m,y,u,p])),w(this,Mh,b)}getOutlines(){h(this,er).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);let e=[];for(let t of h(this,er))t[3]?(e.push(...A(this,Ph,Xw).call(this,t)),A(this,Dy,eD).call(this,t)):(A(this,Iy,tD).call(this,t),e.push(...A(this,Ph,Xw).call(this,t)));return A(this,Ry,QR).call(this,e)}};Ih=new WeakMap,Mh=new WeakMap,er=new WeakMap,Hn=new WeakMap,Ry=new WeakSet,QR=function(e){let t=[],n=new Set;for(let o of e){let[a,l,c]=o;t.push([a,l,o],[a,c,o])}t.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=t.length;o<a;o+=2){let l=t[o][2],c=t[o+1][2];l.push(c),c.push(l),n.add(l),n.add(c)}let s=[],r;for(;n.size>0;){let o=n.values().next().value,[a,l,c,d,u]=o;n.delete(o);let p=a,m=l;for(r=[a,c],s.push(r);;){let y;if(n.has(d))y=d;else if(n.has(u))y=u;else break;n.delete(y),[a,l,c,d,u]=y,p!==a&&(r.push(p,m,a,m===l?l:c),p=a),m=m===l?c:l}r.push(p,m)}return new Jw(s,h(this,Ih),h(this,Mh))},rc=new WeakSet,xg=function(e){let t=h(this,Hn),n=0,s=t.length-1;for(;n<=s;){let r=n+s>>1,o=t[r][0];if(o===e)return r;o<e?n=r+1:s=r-1}return s+1},Dy=new WeakSet,eD=function([,e,t]){let n=A(this,rc,xg).call(this,e);h(this,Hn).splice(n,0,[e,t])},Iy=new WeakSet,tD=function([,e,t]){let n=A(this,rc,xg).call(this,e);for(let s=n;s<h(this,Hn).length;s++){let[r,o]=h(this,Hn)[s];if(r!==e)break;if(r===e&&o===t){h(this,Hn).splice(s,1);return}}for(let s=n-1;s>=0;s--){let[r,o]=h(this,Hn)[s];if(r!==e)break;if(r===e&&o===t){h(this,Hn).splice(s,1);return}}},Ph=new WeakSet,Xw=function(e){let[t,n,s]=e,r=[[t,n,s]],o=A(this,rc,xg).call(this,s);for(let a=0;a<o;a++){let[l,c]=h(this,Hn)[a];for(let d=0,u=r.length;d<u;d++){let[,p,m]=r[d];if(!(c<=p||m<=l)){if(p>=l){if(m>c)r[d][1]=c;else{if(u===1)return[];r.splice(d,1),d--,u--}continue}r[d][2]=l,m>c&&r.push([t,c,m])}}}return r};var kh,oc,Jw=class extends B{constructor(t,n,s){super();E(this,kh,void 0);E(this,oc,void 0);w(this,oc,t),w(this,kh,n),this.lastPoint=s}toSVGPath(){let t=[];for(let n of h(this,oc)){let[s,r]=n;t.push(`M${s} ${r}`);for(let o=2;o<n.length;o+=2){let a=n[o],l=n[o+1];a===s?(t.push(`V${l}`),r=l):l===r&&(t.push(`H${a}`),s=a)}t.push("Z")}return t.join(" ")}serialize([t,n,s,r],o){let a=[],l=s-t,c=r-n;for(let d of h(this,oc)){let u=new Array(d.length);for(let p=0;p<d.length;p+=2)u[p]=t+d[p]*l,u[p+1]=r-d[p+1]*c;a.push(u)}return a}get box(){return h(this,kh)}get classNamesForOutlining(){return["highlightOutline"]}};kh=new WeakMap,oc=new WeakMap;var qd=class extends am{newFreeDrawOutline(e,t,n,s,r,o){return new Zw(e,t,n,s,r,o)}},Zw=class extends lm{newOutliner(e,t,n,s,r,o=0){return new qd(e,t,n,s,r,o)}},$n,Vo,ac,Ve,Nh,lc,Fh,Lh,tr,Vn,cc,Oh,Uh,jw,Bh,Qw,Hh,eA,ls,Ur,My,nD,pi,Rs,Pt=class Pt{constructor({editor:e=null,uiManager:t=null}){E(this,Uh);E(this,Bh);E(this,Hh);E(this,ls);E(this,My);E(this,pi);E(this,$n,null);E(this,Vo,null);E(this,ac,void 0);E(this,Ve,null);E(this,Nh,!1);E(this,lc,!1);E(this,Fh,null);E(this,Lh,void 0);E(this,tr,null);E(this,Vn,null);E(this,cc,void 0);e?(w(this,lc,!1),w(this,cc,re.HIGHLIGHT_COLOR),w(this,Fh,e)):(w(this,lc,!0),w(this,cc,re.HIGHLIGHT_DEFAULT_COLOR)),w(this,Vn,e?._uiManager||t),w(this,Lh,h(this,Vn)._eventBus),w(this,ac,e?.color||h(this,Vn)?.highlightColors.values().next().value||"#FFFF98"),h(Pt,Oh)||w(Pt,Oh,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return ie(this,"_keyboardManager",new ca([[["Escape","mac+Escape"],Pt.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Pt.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Pt.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Pt.prototype._moveToPrevious],[["Home","mac+Home"],Pt.prototype._moveToBeginning],[["End","mac+End"],Pt.prototype._moveToEnd]]))}renderButton(){let e=w(this,$n,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);let t=h(this,Vn)._signal;e.addEventListener("click",A(this,ls,Ur).bind(this),{signal:t}),e.addEventListener("keydown",A(this,Hh,eA).bind(this),{signal:t});let n=w(this,Vo,document.createElement("span"));return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=h(this,ac),e.append(n),e}renderMainDropdown(){let e=w(this,Ve,A(this,Uh,jw).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===h(this,$n)){A(this,ls,Ur).call(this,e);return}let t=e.target.getAttribute("data-color");t&&A(this,Bh,Qw).call(this,t,e)}_moveToNext(e){if(!h(this,pi,Rs)){A(this,ls,Ur).call(this,e);return}if(e.target===h(this,$n)){h(this,Ve).firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===h(this,Ve)?.firstChild||e.target===h(this,$n)){h(this,pi,Rs)&&this._hideDropdownFromKeyboard();return}h(this,pi,Rs)||A(this,ls,Ur).call(this,e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!h(this,pi,Rs)){A(this,ls,Ur).call(this,e);return}h(this,Ve).firstChild?.focus()}_moveToEnd(e){if(!h(this,pi,Rs)){A(this,ls,Ur).call(this,e);return}h(this,Ve).lastChild?.focus()}hideDropdown(){h(this,Ve)?.classList.add("hidden"),h(this,tr)?.abort(),w(this,tr,null)}_hideDropdownFromKeyboard(){if(!h(this,lc)){if(!h(this,pi,Rs)){h(this,Fh)?.unselect();return}this.hideDropdown(),h(this,$n).focus({preventScroll:!0,focusVisible:h(this,Nh)})}}updateColor(e){if(h(this,Vo)&&(h(this,Vo).style.backgroundColor=e),!h(this,Ve))return;let t=h(this,Vn).highlightColors.values();for(let n of h(this,Ve).children)n.setAttribute("aria-selected",t.next().value===e)}destroy(){h(this,$n)?.remove(),w(this,$n,null),w(this,Vo,null),h(this,Ve)?.remove(),w(this,Ve,null)}};$n=new WeakMap,Vo=new WeakMap,ac=new WeakMap,Ve=new WeakMap,Nh=new WeakMap,lc=new WeakMap,Fh=new WeakMap,Lh=new WeakMap,tr=new WeakMap,Vn=new WeakMap,cc=new WeakMap,Oh=new WeakMap,Uh=new WeakSet,jw=function(){let e=document.createElement("div"),t=h(this,Vn)._signal;e.addEventListener("contextmenu",Yn,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[n,s]of h(this,Vn).highlightColors){let r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",s),r.title=n,r.setAttribute("data-l10n-id",h(Pt,Oh)[n]);let o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=s,r.setAttribute("aria-selected",s===h(this,ac)),r.addEventListener("click",A(this,Bh,Qw).bind(this,s),{signal:t}),e.append(r)}return e.addEventListener("keydown",A(this,Hh,eA).bind(this),{signal:t}),e},Bh=new WeakSet,Qw=function(e,t){t.stopPropagation(),h(this,Lh).dispatch("switchannotationeditorparams",{source:this,type:h(this,cc),value:e})},Hh=new WeakSet,eA=function(e){Pt._keyboardManager.exec(this,e)},ls=new WeakSet,Ur=function(e){if(h(this,pi,Rs)){this.hideDropdown();return}if(w(this,Nh,e.detail===0),h(this,tr)||(w(this,tr,new AbortController),window.addEventListener("pointerdown",A(this,My,nD).bind(this),{signal:h(this,Vn).combinedSignal(h(this,tr))})),h(this,Ve)){h(this,Ve).classList.remove("hidden");return}let t=w(this,Ve,A(this,Uh,jw).call(this));h(this,$n).append(t)},My=new WeakSet,nD=function(e){h(this,Ve)?.contains(e.target)||this.hideDropdown()},pi=new WeakSet,Rs=function(){return h(this,Ve)&&!h(this,Ve).classList.contains("hidden")},E(Pt,Oh,null);var cm=Pt,dc,$h,cs,Go,uc,Ft,Vh,Gh,zo,mn,Zt,tt,hc,ds,pt,fc,yn,zh,Wh,tA,pc,Rg,Py,iD,ky,sD,Ny,rD,qh,nA,us,Br,nr,Ja,Fy,oD,gc,Dg,Wo,Td,Ly,aD,Oy,lD,Uy,cD,By,dD,Hy,uD,ce=class ce extends Te{constructor(t){super({...t,name:"highlightEditor"});E(this,Wh);E(this,pc);E(this,Py);E(this,ky);E(this,Ny);E(this,qh);E(this,us);E(this,Fy);E(this,gc);E(this,Wo);E(this,Ly);E(this,Oy);E(this,Hy);E(this,dc,null);E(this,$h,0);E(this,cs,void 0);E(this,Go,null);E(this,uc,null);E(this,Ft,null);E(this,Vh,null);E(this,Gh,0);E(this,zo,null);E(this,mn,null);E(this,Zt,null);E(this,tt,!1);E(this,hc,null);E(this,ds,void 0);E(this,pt,null);E(this,fc,"");E(this,yn,void 0);E(this,zh,"");this.color=t.color||ce._defaultColor,w(this,yn,t.thickness||ce._defaultThickness),w(this,ds,t.opacity||ce._defaultOpacity),w(this,cs,t.boxes||null),w(this,zh,t.methodOfCreation||""),w(this,fc,t.text||""),this._isDraggable=!1,t.highlightId>-1?(w(this,tt,!0),A(this,pc,Rg).call(this,t),A(this,us,Br).call(this)):h(this,cs)&&(w(this,dc,t.anchorNode),w(this,$h,t.anchorOffset),w(this,Vh,t.focusNode),w(this,Gh,t.focusOffset),A(this,Wh,tA).call(this),A(this,us,Br).call(this),this.rotate(this.rotation))}static get _keyboardManager(){let t=ce.prototype;return ie(this,"_keyboardManager",new ca([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:h(this,tt)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:h(this,yn),methodOfCreation:h(this,zh)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){Te.initialize(t,n),ce._defaultColor||(ce._defaultColor=n.highlightColors?.values().next().value||"#fff066")}static updateDefaultParams(t,n){switch(t){case re.HIGHLIGHT_DEFAULT_COLOR:ce._defaultColor=n;break;case re.HIGHLIGHT_THICKNESS:ce._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return h(this,hc)}updateParams(t,n){switch(t){case re.HIGHLIGHT_COLOR:A(this,Py,iD).call(this,n);break;case re.HIGHLIGHT_THICKNESS:A(this,ky,sD).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[re.HIGHLIGHT_DEFAULT_COLOR,ce._defaultColor],[re.HIGHLIGHT_THICKNESS,ce._defaultThickness]]}get propertiesToUpdate(){return[[re.HIGHLIGHT_COLOR,this.color||ce._defaultColor],[re.HIGHLIGHT_THICKNESS,h(this,yn)||ce._defaultThickness],[re.HIGHLIGHT_FREE,h(this,tt)]]}async addEditToolbar(){let t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(w(this,uc,new cm({editor:this})),t.addColorPicker(h(this,uc))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(A(this,Wo,Td).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,A(this,Wo,Td).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){A(this,qh,nA).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(A(this,us,Br).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let n=!1;this.parent&&!t?A(this,qh,nA).call(this):t&&(A(this,us,Br).call(this,t),n=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var r,o,a;let{drawLayer:n}=this.parent,s;h(this,tt)?(t=(t-this.rotation+360)%360,s=A(r=ce,nr,Ja).call(r,h(this,mn).box,t)):s=A(o=ce,nr,Ja).call(o,[this.x,this.y,this.width,this.height],t),n.updateProperties(h(this,Zt),{bbox:s,root:{"data-main-rotation":t}}),n.updateProperties(h(this,pt),{bbox:A(a=ce,nr,Ja).call(a,h(this,Ft).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;let t=super.render();h(this,fc)&&(t.setAttribute("aria-label",h(this,fc)),t.setAttribute("role","mark")),h(this,tt)?t.classList.add("free"):this.div.addEventListener("keydown",A(this,Fy,oD).bind(this),{signal:this._uiManager._signal});let n=w(this,zo,document.createElement("div"));t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=h(this,Go);let[s,r]=this.parentDimensions;return this.setDims(this.width*s,this.height*r),Ug(this,h(this,zo),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(h(this,pt),{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(h(this,pt),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:A(this,gc,Dg).call(this,!0);break;case 1:case 3:A(this,gc,Dg).call(this,!1);break}}select(){super.select(),h(this,pt)&&this.parent?.drawLayer.updateProperties(h(this,pt),{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),h(this,pt)&&(this.parent?.drawLayer.updateProperties(h(this,pt),{rootClass:{selected:!1}}),h(this,tt)||A(this,gc,Dg).call(this,!1))}get _mustFixPosition(){return!h(this,tt)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(h(this,Zt),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(h(this,pt),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:s,x:r,y:o}){let{x:a,y:l,width:c,height:d}=s.getBoundingClientRect(),u=new AbortController,p=t.combinedSignal(u),m=y=>{u.abort(),A(this,By,dD).call(this,t,y)};window.addEventListener("blur",m,{signal:p}),window.addEventListener("pointerup",m,{signal:p}),window.addEventListener("pointerdown",nn,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Yn,{signal:p}),s.addEventListener("pointermove",A(this,Uy,cD).bind(this,t),{signal:p}),this._freeHighlight=new qd({x:r,y:o},[a,l,c,d],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,s){var v,b,S,C;let r=null;if(t instanceof rm){let{data:{quadPoints:T,rect:_,rotation:R,id:I,color:M,opacity:k,popupRef:N},parent:{page:{pageNumber:F}}}=t;r=t={annotationType:Z.HIGHLIGHT,color:Array.from(M),opacity:k,quadPoints:T,boxes:null,pageIndex:F-1,rect:_.slice(0),rotation:R,id:I,deleted:!1,popupRef:N}}else if(t instanceof zd){let{data:{inkLists:T,rect:_,rotation:R,id:I,color:M,borderStyle:{rawWidth:k},popupRef:N},parent:{page:{pageNumber:F}}}=t;r=t={annotationType:Z.HIGHLIGHT,color:Array.from(M),thickness:k,inkLists:T,boxes:null,pageIndex:F-1,rect:_.slice(0),rotation:R,id:I,deleted:!1,popupRef:N}}let{color:o,quadPoints:a,inkLists:l,opacity:c}=t,d=await super.deserialize(t,n,s);d.color=V.makeHexColor(...o),w(d,ds,c||1),l&&w(d,yn,t.thickness),d.annotationElementId=t.id||null,d._initialData=r;let[u,p]=d.pageDimensions,[m,y]=d.pageTranslation;if(a){let T=w(d,cs,[]);for(let _=0;_<a.length;_+=8)T.push({x:(a[_]-m)/u,y:1-(a[_+1]-y)/p,width:(a[_+2]-a[_])/u,height:(a[_+1]-a[_+5])/p});A(v=d,Wh,tA).call(v),A(b=d,us,Br).call(b),d.rotate(d.rotation)}else if(l){w(d,tt,!0);let T=l[0],_={x:T[0]-m,y:p-(T[1]-y)},R=new qd(_,[0,0,u,p],1,h(d,yn)/2,!0,.001);for(let k=0,N=T.length;k<N;k+=2)_.x=T[k]-m,_.y=p-(T[k+1]-y),R.add(_);let{id:I,clipPathId:M}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:R.toSVGPath()}},!0,!0);A(S=d,pc,Rg).call(S,{highlightOutlines:R.getOutlines(),highlightId:I,clipPathId:M}),A(C=d,us,Br).call(C)}return d}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();let n=this.getRect(0,0),s=Te._colorManager.convert(this.color),r={annotationType:Z.HIGHLIGHT,color:s,opacity:h(this,ds),thickness:h(this,yn),quadPoints:A(this,Ly,aD).call(this),outlines:A(this,Oy,lD).call(this,n),pageIndex:this.pageIndex,rect:n,rotation:A(this,Wo,Td).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!A(this,Hy,uD).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};dc=new WeakMap,$h=new WeakMap,cs=new WeakMap,Go=new WeakMap,uc=new WeakMap,Ft=new WeakMap,Vh=new WeakMap,Gh=new WeakMap,zo=new WeakMap,mn=new WeakMap,Zt=new WeakMap,tt=new WeakMap,hc=new WeakMap,ds=new WeakMap,pt=new WeakMap,fc=new WeakMap,yn=new WeakMap,zh=new WeakMap,Wh=new WeakSet,tA=function(){let t=new Wd(h(this,cs),.001);w(this,mn,t.getOutlines()),[this.x,this.y,this.width,this.height]=h(this,mn).box;let n=new Wd(h(this,cs),.0025,.001,this._uiManager.direction==="ltr");w(this,Ft,n.getOutlines());let{lastPoint:s}=h(this,Ft);w(this,hc,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height])},pc=new WeakSet,Rg=function({highlightOutlines:t,highlightId:n,clipPathId:s}){var u,p;if(w(this,mn,t),w(this,Ft,t.getNewOutline(h(this,yn)/2+1.5,.0025)),n>=0)w(this,Zt,n),w(this,Go,s),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),w(this,pt,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:h(this,Ft).box,path:{d:h(this,Ft).toSVGPath()}},!0));else if(this.parent){let m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(h(this,Zt),{bbox:A(u=ce,nr,Ja).call(u,h(this,mn).box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(h(this,pt),{bbox:A(p=ce,nr,Ja).call(p,h(this,Ft).box,m),path:{d:h(this,Ft).toSVGPath()}})}let[o,a,l,c]=t.box;switch(this.rotation){case 0:this.x=o,this.y=a,this.width=l,this.height=c;break;case 90:{let[m,y]=this.parentDimensions;this.x=a,this.y=1-o,this.width=l*y/m,this.height=c*m/y;break}case 180:this.x=1-o,this.y=1-a,this.width=l,this.height=c;break;case 270:{let[m,y]=this.parentDimensions;this.x=1-a,this.y=o,this.width=l*y/m,this.height=c*m/y;break}}let{lastPoint:d}=h(this,Ft);w(this,hc,[(d[0]-o)/l,(d[1]-a)/c])},Py=new WeakSet,iD=function(t){let n=(o,a)=>{this.color=o,w(this,ds,a),this.parent?.drawLayer.updateProperties(h(this,Zt),{root:{fill:o,"fill-opacity":a}}),h(this,uc)?.updateColor(o)},s=this.color,r=h(this,ds);this.addCommands({cmd:n.bind(this,t,ce._defaultOpacity),undo:n.bind(this,s,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:re.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},ky=new WeakSet,sD=function(t){let n=h(this,yn),s=r=>{w(this,yn,r),A(this,Ny,rD).call(this,r)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:re.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},Ny=new WeakSet,rD=function(t){if(!h(this,tt))return;A(this,pc,Rg).call(this,{highlightOutlines:h(this,mn).getNewOutline(t/2)}),this.fixAndSetPosition();let[n,s]=this.parentDimensions;this.setDims(this.width*n,this.height*s)},qh=new WeakSet,nA=function(){h(this,Zt)===null||!this.parent||(this.parent.drawLayer.remove(h(this,Zt)),w(this,Zt,null),this.parent.drawLayer.remove(h(this,pt)),w(this,pt,null))},us=new WeakSet,Br=function(t=this.parent){h(this,Zt)===null&&({id:bt(this,Zt)._,clipPathId:bt(this,Go)._}=t.drawLayer.draw({bbox:h(this,mn).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":h(this,ds)},rootClass:{highlight:!0,free:h(this,tt)},path:{d:h(this,mn).toSVGPath()}},!1,!0),w(this,pt,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:h(this,tt)},bbox:h(this,Ft).box,path:{d:h(this,Ft).toSVGPath()}},h(this,tt))),h(this,zo)&&(h(this,zo).style.clipPath=h(this,Go)))},nr=new WeakSet,Ja=function([t,n,s,r],o){switch(o){case 90:return[1-n-r,t,r,s];case 180:return[1-t-s,1-n-r,s,r];case 270:return[n,1-t-s,r,s]}return[t,n,s,r]},Fy=new WeakSet,oD=function(t){ce._keyboardManager.exec(this,t)},gc=new WeakSet,Dg=function(t){if(!h(this,dc))return;let n=window.getSelection();t?n.setPosition(h(this,dc),h(this,$h)):n.setPosition(h(this,Vh),h(this,Gh))},Wo=new WeakSet,Td=function(){return h(this,tt)?this.rotation:0},Ly=new WeakSet,aD=function(){if(h(this,tt))return null;let[t,n]=this.pageDimensions,[s,r]=this.pageTranslation,o=h(this,cs),a=new Float32Array(o.length*8),l=0;for(let{x:c,y:d,width:u,height:p}of o){let m=c*t+s,y=(1-d)*n+r;a[l]=a[l+4]=m,a[l+1]=a[l+3]=y,a[l+2]=a[l+6]=m+u*t,a[l+5]=a[l+7]=y-p*n,l+=8}return a},Oy=new WeakSet,lD=function(t){return h(this,mn).serialize(t,A(this,Wo,Td).call(this))},Uy=new WeakSet,cD=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},By=new WeakSet,dD=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Hy=new WeakSet,uD=function(t){let{color:n}=this._initialData;return t.color.some((s,r)=>s!==n[r])},E(ce,nr),E(ce,Uy),E(ce,By),Y(ce,"_defaultColor",null),Y(ce,"_defaultOpacity",1),Y(ce,"_defaultThickness",12),Y(ce,"_type","highlight"),Y(ce,"_editorType",Z.HIGHLIGHT),Y(ce,"_freeHighlightId",-1),Y(ce,"_freeHighlight",null),Y(ce,"_freeHighlightClipId","");var dm=ce,qo,iA=class{constructor(){E(this,qo,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(let[t,n]of Object.entries(e))this.updateProperty(t,n)}updateSVGProperty(e,t){h(this,qo)[e]=t}toSVGProperties(){let e=h(this,qo);return w(this,qo,Object.create(null)),{root:e}}reset(){w(this,qo,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){me("Not implemented")}};qo=new WeakMap;var jt,mc,Xe,Yo,Ko,ir,sr,rr,Xo,Yh,rA,Kh,oA,Xh,aA,Jo,_d,$y,hD,yc,Ig,Zo,xd,or,Za,H=class H extends Te{constructor(t){super(t);E(this,Yh);E(this,Kh);E(this,Xh);E(this,Jo);E(this,$y);E(this,yc);E(this,Zo);E(this,or);E(this,jt,null);E(this,mc,void 0);Y(this,"_drawId",null);w(this,mc,t.mustBeCommitted||!1),t.drawOutlines&&(A(this,Yh,rA).call(this,t),A(this,Jo,_d).call(this))}static _mergeSVGProperties(t,n){let s=new Set(Object.keys(t));for(let[r,o]of Object.entries(n))s.has(r)?Object.assign(t[r],o):t[r]=o;return t}static getDefaultDrawingOptions(t){me("Not implemented")}static get typesMap(){me("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){let s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,n),this._currentParent&&(h(H,Xe).updateProperty(s,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){let s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,n)}static get defaultPropertiesToUpdate(){let t=[],n=this._defaultDrawingOptions;for(let[s,r]of this.typesMap)t.push([s,n[r]]);return t}get propertiesToUpdate(){let t=[],{_drawingOptions:n}=this;for(let[s,r]of this.constructor.typesMap)t.push([s,n[r]]);return t}_updateProperty(t,n,s){let r=this._drawingOptions,o=r[n],a=l=>{r.updateProperty(n,l);let c=h(this,jt).updateProperty(n,l);c&&A(this,Zo,xd).call(this,c),this.parent?.drawLayer.updateProperties(this._drawId,r.toSVGProperties())};this.addCommands({cmd:a.bind(this,s),undo:a.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,H._mergeSVGProperties(h(this,jt).getPathResizingSVGProperties(A(this,yc,Ig).call(this)),{bbox:A(this,or,Za).call(this)}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,H._mergeSVGProperties(h(this,jt).getPathResizedSVGProperties(A(this,yc,Ig).call(this)),{bbox:A(this,or,Za).call(this)}))}_onTranslating(t,n){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:A(this,or,Za).call(this,t,n)})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,H._mergeSVGProperties(h(this,jt).getPathTranslatedSVGProperties(A(this,yc,Ig).call(this),this.parentDimensions),{bbox:A(this,or,Za).call(this)}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,h(this,mc)&&(w(this,mc,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){A(this,Xh,aA).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(A(this,Jo,_d).call(this),A(this,Zo,xd).call(this,h(this,jt).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),A(this,Xh,aA).call(this)):t&&(this._uiManager.addShouldRescale(this),A(this,Jo,_d).call(this,t),n=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,H._mergeSVGProperties({bbox:A(this,or,Za).call(this)},h(this,jt).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&A(this,Zo,xd).call(this,h(this,jt).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t=super.render();t.classList.add("draw");let n=document.createElement("div");t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";let[s,r]=this.parentDimensions;return this.setDims(this.width*s,this.height*r),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,n,s,r,o){me("Not implemented")}static startDrawing(t,n,s,r){let{target:o,offsetX:a,offsetY:l,pointerId:c,pointerType:d}=r;if(h(H,sr)&&h(H,sr)!==d)return;let{viewport:{rotation:u}}=t,{width:p,height:m}=o.getBoundingClientRect(),y=w(H,Yo,new AbortController),v=t.combinedSignal(y);if(h(H,ir)||w(H,ir,c),h(H,sr)??w(H,sr,d),window.addEventListener("pointerup",b=>{h(H,ir)===b.pointerId?this._endDraw(b):h(H,rr)?.delete(b.pointerId)},{signal:v}),window.addEventListener("pointercancel",b=>{h(H,ir)===b.pointerId?this._currentParent.endDrawingSession():h(H,rr)?.delete(b.pointerId)},{signal:v}),window.addEventListener("pointerdown",b=>{h(H,sr)===b.pointerType&&((h(H,rr)||w(H,rr,new Set)).add(b.pointerId),h(H,Xe).isCancellable()&&(h(H,Xe).removeLastElement(),h(H,Xe).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:v}),window.addEventListener("contextmenu",Yn,{signal:v}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:v}),o.addEventListener("touchmove",b=>{b.timeStamp===h(H,Xo)&&nn(b)},{signal:v}),t.toggleDrawing(),n._editorUndoBar?.hide(),h(H,Xe)){t.drawLayer.updateProperties(this._currentDrawId,h(H,Xe).startNew(a,l,p,m,u));return}n.updateUIForDefaultProperties(this),w(H,Xe,this.createDrawerInstance(a,l,p,m,u)),w(H,Ko,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(h(H,Ko).toSVGProperties(),h(H,Xe).defaultSVGProperties),!0,!1)}static _drawMove(t){if(w(H,Xo,-1),!h(H,Xe))return;let{offsetX:n,offsetY:s,pointerId:r}=t;if(h(H,ir)===r){if(h(H,rr)?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,h(H,Xe).add(n,s)),w(H,Xo,t.timeStamp),nn(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,w(H,Xe,null),w(H,Ko,null),w(H,sr,null),w(H,Xo,NaN)),h(H,Yo)&&(h(H,Yo).abort(),w(H,Yo,null),w(H,ir,NaN),w(H,rr,null))}static _endDraw(t){let n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),t&&n.drawLayer.updateProperties(this._currentDrawId,h(H,Xe).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){let s=h(H,Xe),r=this._currentDrawId,o=s.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(r,s.setLastElement(o))},undo:()=>{n.drawLayer.updateProperties(r,s.removeLastElement())},mustExec:!1,type:re.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){let n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(re.DRAW_STEP),!h(H,Xe).isEmpty()){let{pageDimensions:[s,r],scale:o}=n,a=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:h(H,Xe).getOutlines(s*o,r*o,o,this._INNER_MARGIN),drawingOptions:h(H,Ko),mustBeCommitted:!t});return this._cleanup(!0),a}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,s,r,o,a){me("Not implemented")}static async deserialize(t,n,s){var u,p;let{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:l}}=n.viewport,c=this.deserializeDraw(a,l,r,o,this._INNER_MARGIN,t),d=await super.deserialize(t,n,s);return d.createDrawingOptions(t),A(u=d,Yh,rA).call(u,{drawOutlines:c}),A(p=d,Jo,_d).call(p),d.onScaleChanging(),d.rotate(),d}serializeDraw(t){let[n,s]=this.pageTranslation,[r,o]=this.pageDimensions;return h(this,jt).serialize([n,s,r,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};jt=new WeakMap,mc=new WeakMap,Xe=new WeakMap,Yo=new WeakMap,Ko=new WeakMap,ir=new WeakMap,sr=new WeakMap,rr=new WeakMap,Xo=new WeakMap,Yh=new WeakSet,rA=function({drawOutlines:t,drawId:n,drawingOptions:s}){w(this,jt,t),this._drawingOptions||(this._drawingOptions=s),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=A(this,Kh,oA).call(this,t,this.parent),A(this,Zo,xd).call(this,t.box)},Kh=new WeakSet,oA=function(t,n){let{id:s}=n.drawLayer.draw(H._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s},Xh=new WeakSet,aA=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Jo=new WeakSet,_d=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=A(this,Kh,oA).call(this,h(this,jt),t)}},$y=new WeakSet,hD=function([t,n,s,r]){let{parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[n,1-t,s*(a/o),r*(o/a)];case 180:return[1-t,1-n,s,r];case 270:return[1-n,t,s*(a/o),r*(o/a)];default:return[t,n,s,r]}},yc=new WeakSet,Ig=function(){let{x:t,y:n,width:s,height:r,parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[1-n,t,s*(o/a),r*(a/o)];case 180:return[1-t,1-n,s,r];case 270:return[n,1-t,s*(o/a),r*(a/o)];default:return[t,n,s,r]}},Zo=new WeakSet,xd=function(t){if([this.x,this.y,this.width,this.height]=A(this,$y,hD).call(this,t),this.div){this.fixAndSetPosition();let[n,s]=this.parentDimensions;this.setDims(this.width*n,this.height*s)}this._onResized()},or=new WeakSet,Za=function(){let{x:t,y:n,width:s,height:r,rotation:o,parentRotation:a,parentDimensions:[l,c]}=this;switch((o*4+a)/90){case 1:return[1-n-r,t,r,s];case 2:return[1-t-s,1-n-r,s,r];case 3:return[n,1-t-s,r,s];case 4:return[t,n-s*(l/c),r*(c/l),s*(l/c)];case 5:return[1-n,t,s*(l/c),r*(c/l)];case 6:return[1-t-r*(c/l),1-n,r*(c/l),s*(l/c)];case 7:return[n-s*(l/c),1-t-r*(c/l),s*(l/c),r*(c/l)];case 8:return[t-s,n-r,s,r];case 9:return[1-n,t-s,r,s];case 10:return[1-t,1-n,s,r];case 11:return[n-r,1-t,r,s];case 12:return[t-r*(c/l),n,r*(c/l),s*(l/c)];case 13:return[1-n-s*(l/c),t-r*(c/l),s*(l/c),r*(c/l)];case 14:return[1-t,1-n-s*(l/c),r*(c/l),s*(l/c)];case 15:return[n,1-t,s*(l/c),r*(c/l)];default:return[t,n,s,r]}},Y(H,"_currentDrawId",-1),Y(H,"_currentParent",null),E(H,Xe,null),E(H,Yo,null),E(H,Ko,null),E(H,ir,NaN),E(H,sr,null),E(H,rr,null),E(H,Xo,NaN),Y(H,"_INNER_MARGIN",3);var sA=H,gi,Je,Ze,jo,vc,At,nt,vn,Qo,ea,ta,bc,Mg,lA=class{constructor(e,t,n,s,r,o){E(this,bc);E(this,gi,new Float64Array(6));E(this,Je,void 0);E(this,Ze,void 0);E(this,jo,void 0);E(this,vc,void 0);E(this,At,void 0);E(this,nt,"");E(this,vn,0);E(this,Qo,new um);E(this,ea,void 0);E(this,ta,void 0);w(this,ea,n),w(this,ta,s),w(this,jo,r),w(this,vc,o),[e,t]=A(this,bc,Mg).call(this,e,t);let a=w(this,Je,[NaN,NaN,NaN,NaN,e,t]);w(this,At,[e,t]),w(this,Ze,[{line:a,points:h(this,At)}]),h(this,gi).set(a,0)}updateProperty(e,t){e==="stroke-width"&&w(this,vc,t)}isEmpty(){return!h(this,Ze)||h(this,Ze).length===0}isCancellable(){return h(this,At).length<=10}add(e,t){[e,t]=A(this,bc,Mg).call(this,e,t);let[n,s,r,o]=h(this,gi).subarray(2,6),a=e-r,l=t-o;return Math.hypot(h(this,ea)*a,h(this,ta)*l)<=2?null:(h(this,At).push(e,t),isNaN(n)?(h(this,gi).set([r,o,e,t],2),h(this,Je).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(h(this,gi)[0])&&h(this,Je).splice(6,6),h(this,gi).set([n,s,r,o,e,t],0),h(this,Je).push(...B.createBezierPoints(n,s,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){let n=this.add(e,t);return n||(h(this,At).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,s,r){w(this,ea,n),w(this,ta,s),w(this,jo,r),[e,t]=A(this,bc,Mg).call(this,e,t);let o=w(this,Je,[NaN,NaN,NaN,NaN,e,t]);w(this,At,[e,t]);let a=h(this,Ze).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),h(this,Ze).push({line:o,points:h(this,At)}),h(this,gi).set(o,0),w(this,vn,0),this.toSVGPath(),null}getLastElement(){return h(this,Ze).at(-1)}setLastElement(e){return h(this,Ze)?(h(this,Ze).push(e),w(this,Je,e.line),w(this,At,e.points),w(this,vn,0),{path:{d:this.toSVGPath()}}):h(this,Qo).setLastElement(e)}removeLastElement(){if(!h(this,Ze))return h(this,Qo).removeLastElement();h(this,Ze).pop(),w(this,nt,"");for(let e=0,t=h(this,Ze).length;e<t;e++){let{line:n,points:s}=h(this,Ze)[e];w(this,Je,n),w(this,At,s),w(this,vn,0),this.toSVGPath()}return{path:{d:h(this,nt)}}}toSVGPath(){let e=B.svgRound(h(this,Je)[4]),t=B.svgRound(h(this,Je)[5]);if(h(this,At).length===2)return w(this,nt,`${h(this,nt)} M ${e} ${t} Z`),h(this,nt);if(h(this,At).length<=6){let s=h(this,nt).lastIndexOf("M");w(this,nt,`${h(this,nt).slice(0,s)} M ${e} ${t}`),w(this,vn,6)}if(h(this,At).length===4){let s=B.svgRound(h(this,Je)[10]),r=B.svgRound(h(this,Je)[11]);return w(this,nt,`${h(this,nt)} L ${s} ${r}`),w(this,vn,12),h(this,nt)}let n=[];h(this,vn)===0&&(n.push(`M ${e} ${t}`),w(this,vn,6));for(let s=h(this,vn),r=h(this,Je).length;s<r;s+=6){let[o,a,l,c,d,u]=h(this,Je).slice(s,s+6).map(B.svgRound);n.push(`C${o} ${a} ${l} ${c} ${d} ${u}`)}return w(this,nt,h(this,nt)+n.join(" ")),w(this,vn,h(this,Je).length),h(this,nt)}getOutlines(e,t,n,s){let r=h(this,Ze).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),h(this,Qo).build(h(this,Ze),e,t,n,h(this,jo),h(this,vc),s),w(this,gi,null),w(this,Je,null),w(this,Ze,null),w(this,nt,null),h(this,Qo)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}};gi=new WeakMap,Je=new WeakMap,Ze=new WeakMap,jo=new WeakMap,vc=new WeakMap,At=new WeakMap,nt=new WeakMap,vn=new WeakMap,Qo=new WeakMap,ea=new WeakMap,ta=new WeakMap,bc=new WeakSet,Mg=function(e,t){return B._normalizePoint(e,t,h(this,ea),h(this,ta),h(this,jo))};var Ct,Jh,Zh,Qt,mi,yi,Ec,Sc,wc,Gn,Bi,Vy,fD,Gy,pD,zy,gD,RA=class RA extends B{constructor(){super(...arguments);E(this,Gn);E(this,Vy);E(this,Gy);E(this,zy);E(this,Ct,void 0);E(this,Jh,0);E(this,Zh,void 0);E(this,Qt,void 0);E(this,mi,void 0);E(this,yi,void 0);E(this,Ec,void 0);E(this,Sc,void 0);E(this,wc,void 0)}build(t,n,s,r,o,a,l){w(this,mi,n),w(this,yi,s),w(this,Ec,r),w(this,Sc,o),w(this,wc,a),w(this,Zh,l??0),w(this,Qt,t),A(this,Gy,pD).call(this)}setLastElement(t){return h(this,Qt).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return h(this,Qt).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let t=[];for(let{line:n}of h(this,Qt)){if(t.push(`M${B.svgRound(n[4])} ${B.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12){t.push(`L${B.svgRound(n[10])} ${B.svgRound(n[11])}`);continue}for(let s=6,r=n.length;s<r;s+=6){let[o,a,l,c,d,u]=n.subarray(s,s+6).map(B.svgRound);t.push(`C${o} ${a} ${l} ${c} ${d} ${u}`)}}return t.join("")}serialize([t,n,s,r],o){let a=[],l=[],[c,d,u,p]=A(this,Vy,fD).call(this),m,y,v,b,S,C,T,_,R;switch(h(this,Sc)){case 0:R=B._rescale,m=t,y=n+r,v=s,b=-r,S=t+c*s,C=n+(1-d-p)*r,T=t+(c+u)*s,_=n+(1-d)*r;break;case 90:R=B._rescaleAndSwap,m=t,y=n,v=s,b=r,S=t+d*s,C=n+c*r,T=t+(d+p)*s,_=n+(c+u)*r;break;case 180:R=B._rescale,m=t+s,y=n,v=-s,b=r,S=t+(1-c-u)*s,C=n+d*r,T=t+(1-c)*s,_=n+(d+p)*r;break;case 270:R=B._rescaleAndSwap,m=t+s,y=n+r,v=-s,b=-r,S=t+(1-d-p)*s,C=n+(1-c-u)*r,T=t+(1-d)*s,_=n+(1-c)*r;break}for(let{line:I,points:M}of h(this,Qt))a.push(R(I,m,y,v,b,o?new Array(I.length):null)),l.push(R(M,m,y,v,b,o?new Array(M.length):null));return{lines:a,points:l,rect:[S,C,T,_]}}static deserialize(t,n,s,r,o,{paths:{lines:a,points:l},rotation:c,thickness:d}){let u=[],p,m,y,v,b;switch(c){case 0:b=B._rescale,p=-t/s,m=n/r+1,y=1/s,v=-1/r;break;case 90:b=B._rescaleAndSwap,p=-n/r,m=-t/s,y=1/r,v=1/s;break;case 180:b=B._rescale,p=t/s+1,m=-n/r,y=-1/s,v=1/r;break;case 270:b=B._rescaleAndSwap,p=n/r+1,m=t/s+1,y=-1/r,v=-1/s;break}if(!a){a=[];for(let C of l){let T=C.length;if(T===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1]]));continue}if(T===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1],NaN,NaN,NaN,NaN,C[2],C[3]]));continue}let _=new Float32Array(3*(T-2));a.push(_);let[R,I,M,k]=C.subarray(0,4);_.set([NaN,NaN,NaN,NaN,R,I],0);for(let N=4;N<T;N+=2){let F=C[N],$=C[N+1];_.set(B.createBezierPoints(R,I,M,k,F,$),(N-2)*3),[R,I,M,k]=[M,k,F,$]}}}for(let C=0,T=a.length;C<T;C++)u.push({line:b(a[C].map(_=>_??NaN),p,m,y,v),points:b(l[C].map(_=>_??NaN),p,m,y,v)});let S=new RA;return S.build(u,s,r,1,c,d,o),S}get box(){return h(this,Ct)}updateProperty(t,n){return t==="stroke-width"?A(this,zy,gD).call(this,n):null}updateParentDimensions([t,n],s){let[r,o]=A(this,Gn,Bi).call(this);w(this,mi,t),w(this,yi,n),w(this,Ec,s);let[a,l]=A(this,Gn,Bi).call(this),c=a-r,d=l-o,u=h(this,Ct);return u[0]-=c,u[1]-=d,u[2]+=2*c,u[3]+=2*d,u}updateRotation(t){return w(this,Jh,t),{path:{transform:this.rotationTransform}}}get viewBox(){return h(this,Ct).map(B.svgRound).join(" ")}get defaultProperties(){let[t,n]=h(this,Ct);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${B.svgRound(t)} ${B.svgRound(n)}`}}}get rotationTransform(){let[,,t,n]=h(this,Ct),s=0,r=0,o=0,a=0,l=0,c=0;switch(h(this,Jh)){case 90:r=n/t,o=-t/n,l=t;break;case 180:s=-1,a=-1,l=t,c=n;break;case 270:r=-n/t,o=t/n,c=n;break;default:return""}return`matrix(${s} ${r} ${o} ${a} ${B.svgRound(l)} ${B.svgRound(c)})`}getPathResizingSVGProperties([t,n,s,r]){let[o,a]=A(this,Gn,Bi).call(this),[l,c,d,u]=h(this,Ct);if(Math.abs(d-o)<=B.PRECISION||Math.abs(u-a)<=B.PRECISION){let b=t+s/2-(l+d/2),S=n+r/2-(c+u/2);return{path:{"transform-origin":`${B.svgRound(t)} ${B.svgRound(n)}`,transform:`${this.rotationTransform} translate(${b} ${S})`}}}let p=(s-2*o)/(d-2*o),m=(r-2*a)/(u-2*a),y=d/s,v=u/r;return{path:{"transform-origin":`${B.svgRound(l)} ${B.svgRound(c)}`,transform:`${this.rotationTransform} scale(${y} ${v}) translate(${B.svgRound(o)} ${B.svgRound(a)}) scale(${p} ${m}) translate(${B.svgRound(-o)} ${B.svgRound(-a)})`}}}getPathResizedSVGProperties([t,n,s,r]){let[o,a]=A(this,Gn,Bi).call(this),l=h(this,Ct),[c,d,u,p]=l;if(l[0]=t,l[1]=n,l[2]=s,l[3]=r,Math.abs(u-o)<=B.PRECISION||Math.abs(p-a)<=B.PRECISION){let S=t+s/2-(c+u/2),C=n+r/2-(d+p/2);for(let{line:T,points:_}of h(this,Qt))B._translate(T,S,C,T),B._translate(_,S,C,_);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${B.svgRound(t)} ${B.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let m=(s-2*o)/(u-2*o),y=(r-2*a)/(p-2*a),v=-m*(c+o)+t+o,b=-y*(d+a)+n+a;if(m!==1||y!==1||v!==0||b!==0)for(let{line:S,points:C}of h(this,Qt))B._rescale(S,v,b,m,y,S),B._rescale(C,v,b,m,y,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${B.svgRound(t)} ${B.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],s){let[r,o]=s,a=h(this,Ct),l=t-a[0],c=n-a[1];if(h(this,mi)===r&&h(this,yi)===o)for(let{line:d,points:u}of h(this,Qt))B._translate(d,l,c,d),B._translate(u,l,c,u);else{let d=h(this,mi)/r,u=h(this,yi)/o;w(this,mi,r),w(this,yi,o);for(let{line:p,points:m}of h(this,Qt))B._rescale(p,l,c,d,u,p),B._rescale(m,l,c,d,u,m);a[2]*=d,a[3]*=u}return a[0]=t,a[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${B.svgRound(t)} ${B.svgRound(n)}`}}}get defaultSVGProperties(){let t=h(this,Ct);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${B.svgRound(t[0])} ${B.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};Ct=new WeakMap,Jh=new WeakMap,Zh=new WeakMap,Qt=new WeakMap,mi=new WeakMap,yi=new WeakMap,Ec=new WeakMap,Sc=new WeakMap,wc=new WeakMap,Gn=new WeakSet,Bi=function(t=h(this,wc)){let n=h(this,Zh)+t/2*h(this,Ec);return h(this,Sc)%180===0?[n/h(this,mi),n/h(this,yi)]:[n/h(this,yi),n/h(this,mi)]},Vy=new WeakSet,fD=function(){let[t,n,s,r]=h(this,Ct),[o,a]=A(this,Gn,Bi).call(this,0);return[t+o,n+a,s-2*o,r-2*a]},Gy=new WeakSet,pD=function(){let t=w(this,Ct,new Float32Array([1/0,1/0,-1/0,-1/0]));for(let{line:r}of h(this,Qt)){if(r.length<=12){for(let l=4,c=r.length;l<c;l+=6){let[d,u]=r.subarray(l,l+2);t[0]=Math.min(t[0],d),t[1]=Math.min(t[1],u),t[2]=Math.max(t[2],d),t[3]=Math.max(t[3],u)}continue}let o=r[4],a=r[5];for(let l=6,c=r.length;l<c;l+=6){let[d,u,p,m,y,v]=r.subarray(l,l+6);V.bezierBoundingBox(o,a,d,u,p,m,y,v,t),o=y,a=v}}let[n,s]=A(this,Gn,Bi).call(this);t[0]=Math.min(1,Math.max(0,t[0]-n)),t[1]=Math.min(1,Math.max(0,t[1]-s)),t[2]=Math.min(1,Math.max(0,t[2]+n)),t[3]=Math.min(1,Math.max(0,t[3]+s)),t[2]-=t[0],t[3]-=t[1]},zy=new WeakSet,gD=function(t){let[n,s]=A(this,Gn,Bi).call(this);w(this,wc,t);let[r,o]=A(this,Gn,Bi).call(this),[a,l]=[r-n,o-s],c=h(this,Ct);return c[0]-=a,c[1]-=l,c[2]+=2*a,c[3]+=2*l,c};var um=RA,Ac,DA=class DA extends iA{constructor(t){super();E(this,Ac,void 0);w(this,Ac,t),super.updateProperties({fill:"none",stroke:Te._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,n){t==="stroke-width"&&(n??(n=this["stroke-width"]),n*=h(this,Ac).realScale),super.updateSVGProperty(t,n)}clone(){let t=new DA(h(this,Ac));return t.updateAll(this),t}};Ac=new WeakMap;var cA=DA,Wy,mD,Qa=class Qa extends sA{constructor(t){super({...t,name:"inkEditor"});E(this,Wy);this._willKeepAspectRatio=!0}static initialize(t,n){Te.initialize(t,n),this._defaultDrawingOptions=new cA(n.viewParameters)}static getDefaultDrawingOptions(t){let n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return ie(this,"typesMap",new Map([[re.INK_THICKNESS,"stroke-width"],[re.INK_COLOR,"stroke"],[re.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,s,r,o){return new lA(t,n,s,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,s,r,o,a){return um.deserialize(t,n,s,r,o,a)}static async deserialize(t,n,s){let r=null;if(t instanceof zd){let{data:{inkLists:a,rect:l,rotation:c,id:d,color:u,opacity:p,borderStyle:{rawWidth:m},popupRef:y},parent:{page:{pageNumber:v}}}=t;r=t={annotationType:Z.INK,color:Array.from(u),thickness:m,opacity:p,paths:{points:a},boxes:null,pageIndex:v-1,rect:l.slice(0),rotation:c,id:d,deleted:!1,popupRef:y}}let o=await super.deserialize(t,n,s);return o.annotationElementId=t.id||null,o._initialData=r,o}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:t,_drawingOptions:n,parent:s}=this;n.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){let t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:s}){this._drawingOptions=Qa.getDefaultDrawingOptions({stroke:V.makeHexColor(...t),"stroke-width":n,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:n,points:s,rect:r}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":a,"stroke-width":l}}=this,c={annotationType:Z.INK,color:Te._colorManager.convert(o),opacity:a,thickness:l,paths:{lines:n,points:s},pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?c:this.annotationElementId&&!A(this,Wy,mD).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(t){let{points:n,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:n}),null}};Wy=new WeakSet,mD=function(t){let{color:n,thickness:s,opacity:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((a,l)=>a!==n[l])||t.thickness!==s||t.opacity!==r||t.pageIndex!==o},Y(Qa,"_type","ink"),Y(Qa,"_editorType",Z.INK),Y(Qa,"_defaultDrawingOptions",null);var dA=Qa,Ce,it,ar,hs,lr,Cc,vi,bi,en,Tc,na,Rd,ia,Dd,_c,Pg,jh,hA,xc,kg,Qh,fA,Rc,Ng,qy,yD,kd=class kd extends Te{constructor(t){super({...t,name:"stampEditor"});E(this,na);E(this,ia);E(this,_c);E(this,jh);E(this,xc);E(this,Qh);E(this,Rc);E(this,qy);E(this,Ce,null);E(this,it,null);E(this,ar,null);E(this,hs,null);E(this,lr,null);E(this,Cc,"");E(this,vi,null);E(this,bi,null);E(this,en,!1);E(this,Tc,!1);w(this,hs,t.bitmapUrl),w(this,lr,t.bitmapFile)}static initialize(t,n){Te.initialize(t,n)}static get supportedTypes(){return ie(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(n=>`image/${n}`))}static get supportedTypesStr(){return ie(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,n){n.pasteEditor(Z.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){let n=t.get("hasAltText");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;let{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");let{data:r,width:o,height:a}=t||this.copyCanvas(null,null,!0).imageData,l=await s.guess({name:"altText",request:{data:r,width:o,height:a,channels:r.length/(o*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");let c=l.output;return await this.setGuessedAltText(c),n&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){h(this,it)&&(w(this,Ce,null),this._uiManager.imageManager.deleteId(h(this,it)),h(this,vi)?.remove(),w(this,vi,null),h(this,bi)&&(clearTimeout(h(this,bi)),w(this,bi,null))),super.remove()}rebuild(){if(!this.parent){h(this,it)&&A(this,_c,Pg).call(this);return}super.rebuild(),this.div!==null&&(h(this,it)&&h(this,vi)===null&&A(this,_c,Pg).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(h(this,ar)||h(this,Ce)||h(this,hs)||h(this,lr)||h(this,it))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;if(this.width&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),h(this,Ce)?A(this,jh,hA).call(this):A(this,_c,Pg).call(this),this.width&&!this.annotationElementId){let[s,r]=this.parentDimensions;this.setAt(t*s,n*r,this.width*s,this.height*r)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;h(this,bi)!==null&&clearTimeout(h(this,bi)),w(this,bi,setTimeout(()=>{w(this,bi,null),A(this,Qh,fA).call(this)},200))}copyCanvas(t,n,s=!1){t||(t=224);let{width:r,height:o}=h(this,Ce),a=new Od,l=h(this,Ce),c=r,d=o,u=null;if(n){if(r>n||o>n){let M=Math.min(n/r,n/o);c=Math.floor(r*M),d=Math.floor(o*M)}u=document.createElement("canvas");let m=u.width=Math.ceil(c*a.sx),y=u.height=Math.ceil(d*a.sy);h(this,en)||(l=A(this,xc,kg).call(this,m,y));let v=u.getContext("2d");v.filter=this._uiManager.hcmFilter;let b="white",S="#cfcfd8";this._uiManager.hcmFilter!=="none"?S="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(b="#8f8f9d",S="#42414d");let C=15,T=C*a.sx,_=C*a.sy,R=new OffscreenCanvas(T*2,_*2),I=R.getContext("2d");I.fillStyle=b,I.fillRect(0,0,T*2,_*2),I.fillStyle=S,I.fillRect(0,0,T,_),I.fillRect(T,_,T,_),v.fillStyle=v.createPattern(R,"repeat"),v.fillRect(0,0,m,y),v.drawImage(l,0,0,l.width,l.height,0,0,m,y)}let p=null;if(s){let m,y;if(a.symmetric&&l.width<t&&l.height<t)m=l.width,y=l.height;else if(l=h(this,Ce),r>t||o>t){let S=Math.min(t/r,t/o);m=Math.floor(r*S),y=Math.floor(o*S),h(this,en)||(l=A(this,xc,kg).call(this,m,y))}let b=new OffscreenCanvas(m,y).getContext("2d",{willReadFrequently:!0});b.drawImage(l,0,0,l.width,l.height,0,0,m,y),p={width:m,height:y,data:b.getImageData(0,0,m,y).data}}return{canvas:u,width:c,height:d,imageData:p}}getImageForAltText(){return h(this,vi)}static async deserialize(t,n,s){let r=null;if(t instanceof om){let{data:{rect:v,rotation:b,id:S,structParent:C,popupRef:T},container:_,parent:{page:{pageNumber:R}}}=t,I=_.querySelector("canvas"),M=s.imageManager.getFromCanvas(_.id,I);I.remove();let k=(await n._structTree.getAriaAttributes(`${SA}${S}`))?.get("aria-label")||"";r=t={annotationType:Z.STAMP,bitmapId:M.id,bitmap:M.bitmap,pageIndex:R-1,rect:v.slice(0),rotation:b,id:S,deleted:!1,accessibilityData:{decorative:!1,altText:k},isSvg:!1,structParent:C,popupRef:T}}let o=await super.deserialize(t,n,s),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:d,isSvg:u,accessibilityData:p}=t;d&&s.imageManager.isValidId(d)?(w(o,it,d),l&&w(o,Ce,l)):w(o,hs,c),w(o,en,u);let[m,y]=o.pageDimensions;return o.width=(a[2]-a[0])/m,o.height=(a[3]-a[1])/y,o.annotationElementId=t.id||null,p&&(o.altTextData=p),o._initialData=r,w(o,Tc,!!r),o}serialize(t=!1,n=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let s={annotationType:Z.STAMP,bitmapId:h(this,it),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:h(this,en),structTreeParentId:this._structTreeParentId};if(t)return s.bitmapUrl=A(this,Rc,Ng).call(this,!0),s.accessibilityData=this.serializeAltText(!0),s;let{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(s.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){let l=A(this,qy,yD).call(this,s);if(l.isSame)return null;l.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1}if(s.id=this.annotationElementId,n===null)return s;n.stamps||(n.stamps=new Map);let a=h(this,en)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!n.stamps.has(h(this,it)))n.stamps.set(h(this,it),{area:a,serialized:s}),s.bitmap=A(this,Rc,Ng).call(this,!1);else if(h(this,en)){let l=n.stamps.get(h(this,it));a>l.area&&(l.area=a,l.serialized.bitmap.close(),l.serialized.bitmap=A(this,Rc,Ng).call(this,!1))}return s}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};Ce=new WeakMap,it=new WeakMap,ar=new WeakMap,hs=new WeakMap,lr=new WeakMap,Cc=new WeakMap,vi=new WeakMap,bi=new WeakMap,en=new WeakMap,Tc=new WeakMap,na=new WeakSet,Rd=function(t,n=!1){if(!t){this.remove();return}w(this,Ce,t.bitmap),n||(w(this,it,t.id),w(this,en,t.isSvg)),t.file&&w(this,Cc,t.file.name),A(this,jh,hA).call(this)},ia=new WeakSet,Dd=function(){if(w(this,ar,null),this._uiManager.enableWaiting(!1),!!h(this,vi)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&h(this,Ce)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&h(this,Ce)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},_c=new WeakSet,Pg=function(){if(h(this,it)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(h(this,it)).then(s=>A(this,na,Rd).call(this,s,!0)).finally(()=>A(this,ia,Dd).call(this));return}if(h(this,hs)){let s=h(this,hs);w(this,hs,null),this._uiManager.enableWaiting(!0),w(this,ar,this._uiManager.imageManager.getFromUrl(s).then(r=>A(this,na,Rd).call(this,r)).finally(()=>A(this,ia,Dd).call(this)));return}if(h(this,lr)){let s=h(this,lr);w(this,lr,null),this._uiManager.enableWaiting(!0),w(this,ar,this._uiManager.imageManager.getFromFile(s).then(r=>A(this,na,Rd).call(this,r)).finally(()=>A(this,ia,Dd).call(this)));return}let t=document.createElement("input");t.type="file",t.accept=kd.supportedTypesStr;let n=this._uiManager._signal;w(this,ar,new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),A(this,na,Rd).call(this,r)}s()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:n})}).finally(()=>A(this,ia,Dd).call(this))),t.click()},jh=new WeakSet,hA=function(){let{div:t}=this,{width:n,height:s}=h(this,Ce),[r,o]=this.pageDimensions,a=.75;if(this.width)n=this.width*r,s=this.height*o;else if(n>a*r||s>a*o){let u=Math.min(a*r/n,a*o/s);n*=u,s*=u}let[l,c]=this.parentDimensions;this.setDims(n*l/r,s*c/o),this._uiManager.enableWaiting(!1);let d=w(this,vi,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=n/r,this.height=s/o,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),A(this,Qh,fA).call(this),h(this,Tc)||(this.parent.addUndoableEditor(this),w(this,Tc,!0)),this._reportTelemetry({action:"inserted_image"}),h(this,Cc)&&d.setAttribute("aria-label",h(this,Cc))},xc=new WeakSet,kg=function(t,n){let{width:s,height:r}=h(this,Ce),o=s,a=r,l=h(this,Ce);for(;o>2*t||a>2*n;){let c=o,d=a;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),a>2*n&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));let u=new OffscreenCanvas(o,a);u.getContext("2d").drawImage(l,0,0,c,d,0,0,o,a),l=u.transferToImageBitmap()}return l},Qh=new WeakSet,fA=function(){let[t,n]=this.parentDimensions,{width:s,height:r}=this,o=new Od,a=Math.ceil(s*t*o.sx),l=Math.ceil(r*n*o.sy),c=h(this,vi);if(!c||c.width===a&&c.height===l)return;c.width=a,c.height=l;let d=h(this,en)?h(this,Ce):A(this,xc,kg).call(this,a,l),u=c.getContext("2d");u.filter=this._uiManager.hcmFilter,u.drawImage(d,0,0,d.width,d.height,0,0,a,l)},Rc=new WeakSet,Ng=function(t){if(t){if(h(this,en)){let r=this._uiManager.imageManager.getSvgUrl(h(this,it));if(r)return r}let n=document.createElement("canvas");return{width:n.width,height:n.height}=h(this,Ce),n.getContext("2d").drawImage(h(this,Ce),0,0),n.toDataURL()}if(h(this,en)){let[n,s]=this.pageDimensions,r=Math.round(this.width*n*fr.PDF_TO_CSS_UNITS),o=Math.round(this.height*s*fr.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(r,o);return a.getContext("2d").drawImage(h(this,Ce),0,0,h(this,Ce).width,h(this,Ce).height,0,0,r,o),a.transferToImageBitmap()}return structuredClone(h(this,Ce))},qy=new WeakSet,yD=function(t){let{pageIndex:n,accessibilityData:{altText:s}}=this._initialData,r=t.pageIndex===n,o=(t.accessibilityData?.alt||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}},Y(kd,"_type","stamp"),Y(kd,"_editorType",Z.STAMP);var uA=kd,sa,Dc,Ei,cr,fs,bn,dr,Ic,ra,zn,ps,gt,gs,G,ur,Yy,vD,En,ni,ef,gA,tf,mA,Mc,Fg,In=class In{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:s,accessibilityManager:r,annotationLayer:o,drawLayer:a,textLayer:l,viewport:c,l10n:d}){E(this,Yy);E(this,En);E(this,ef);E(this,tf);E(this,Mc);E(this,sa,void 0);E(this,Dc,!1);E(this,Ei,null);E(this,cr,null);E(this,fs,null);E(this,bn,new Map);E(this,dr,!1);E(this,Ic,!1);E(this,ra,!1);E(this,zn,null);E(this,ps,null);E(this,gt,null);E(this,gs,null);E(this,G,void 0);let u=[...h(In,ur).values()];if(!In._initialized){In._initialized=!0;for(let p of u)p.initialize(d,e)}e.registerEditorTypes(u),w(this,G,e),this.pageIndex=t,this.div=n,w(this,sa,r),w(this,Ei,o),this.viewport=c,w(this,gt,l),this.drawLayer=a,this._structTree=s,h(this,G).addLayer(this)}get isEmpty(){return h(this,bn).size===0}get isInvisible(){return this.isEmpty&&h(this,G).getMode()===Z.NONE}updateToolbar(e){h(this,G).updateToolbar(e)}updateMode(e=h(this,G).getMode()){switch(A(this,Mc,Fg).call(this),e){case Z.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Z.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Z.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:t}=this.div;for(let n of h(In,ur).values())t.toggle(`${n._type}Editing`,e===n._editorType);this.div.hidden=!1}hasTextLayer(e){return e===h(this,gt)?.div}setEditingState(e){h(this,G).setEditingState(e)}addCommands(e){h(this,G).addCommands(e)}cleanUndoStack(e){h(this,G).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){h(this,Ei)?.div.classList.toggle("disabled",!e)}async enable(){w(this,ra,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);let e=new Set;for(let n of h(this,bn).values())n.enableEditing(),n.show(!0),n.annotationElementId&&(h(this,G).removeChangedExistingAnnotation(n),e.add(n.annotationElementId));if(!h(this,Ei)){w(this,ra,!1);return}let t=h(this,Ei).getEditableAnnotations();for(let n of t){if(n.hide(),h(this,G).isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;let s=await this.deserialize(n);s&&(this.addOrRebuild(s),s.enableEditing())}w(this,ra,!1)}disable(){w(this,Ic,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);let e=new Map,t=new Map;for(let s of h(this,bn).values())if(s.disableEditing(),!!s.annotationElementId){if(s.serialize()!==null){e.set(s.annotationElementId,s);continue}else t.set(s.annotationElementId,s);this.getEditableAnnotation(s.annotationElementId)?.show(),s.remove()}if(h(this,Ei)){let s=h(this,Ei).getEditableAnnotations();for(let r of s){let{id:o}=r.data;if(h(this,G).isDeletedAnnotationElement(o))continue;let a=t.get(o);if(a){a.resetAnnotationElement(r),a.show(!1),r.show();continue}a=e.get(o),a&&(h(this,G).addChangedExistingAnnotation(a),a.renderAnnotationElement(r)&&a.show(!1)),r.show()}}A(this,Mc,Fg).call(this),this.isEmpty&&(this.div.hidden=!0);let{classList:n}=this.div;for(let s of h(In,ur).values())n.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),w(this,Ic,!1)}getEditableAnnotation(e){return h(this,Ei)?.getEditableAnnotation(e)||null}setActiveEditor(e){h(this,G).getActive()!==e&&h(this,G).setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,h(this,gt)?.div&&!h(this,gs)){w(this,gs,new AbortController);let e=h(this,G).combinedSignal(h(this,gs));h(this,gt).div.addEventListener("pointerdown",A(this,Yy,vD).bind(this),{signal:e}),h(this,gt).div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,h(this,gt)?.div&&h(this,gs)&&(h(this,gs).abort(),w(this,gs,null),h(this,gt).div.classList.remove("highlighting"))}enableClick(){if(h(this,cr))return;w(this,cr,new AbortController);let e=h(this,G).combinedSignal(h(this,cr));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});let t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){h(this,cr)?.abort(),w(this,cr,null)}attach(e){h(this,bn).set(e.id,e);let{annotationElementId:t}=e;t&&h(this,G).isDeletedAnnotationElement(t)&&h(this,G).removeDeletedAnnotationElement(e)}detach(e){h(this,bn).delete(e.id),h(this,sa)?.removePointerInTextLayer(e.contentDiv),!h(this,Ic)&&e.annotationElementId&&h(this,G).addDeletedAnnotationElement(e)}remove(e){this.detach(e),h(this,G).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(h(this,G).addDeletedAnnotationElement(e.annotationElementId),Te.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),h(this,G).addEditor(e),this.attach(e),!e.isAttachedToDOM){let t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!h(this,ra)),h(this,G).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;let{activeElement:t}=document;e.div.contains(t)&&!h(this,fs)&&(e._focusEventsAllowed=!1,w(this,fs,setTimeout(()=>{w(this,fs,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:h(this,G)._signal}),t.focus())},0))),e._structTreeParentId=h(this,sa)?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){let t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getNextId(){return h(this,G).getId()}combinedSignal(e){return h(this,G).combinedSignal(e)}canCreateNewEmptyEditor(){return h(this,En,ni)?.canCreateNewEmptyEditor()}pasteEditor(e,t){h(this,G).updateToolbar(e),h(this,G).updateMode(e);let{offsetX:n,offsetY:s}=A(this,tf,mA).call(this),r=this.getNextId(),o=A(this,ef,gA).call(this,{parent:this,id:r,x:n,y:s,uiManager:h(this,G),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){return await h(In,ur).get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,h(this,G))||null}createAndAddNewEditor(e,t,n={}){let s=this.getNextId(),r=A(this,ef,gA).call(this,{parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:h(this,G),isCentered:t,...n});return r&&this.add(r),r}addNewEditor(){this.createAndAddNewEditor(A(this,tf,mA).call(this),!0)}setSelected(e){h(this,G).setSelected(e)}toggleSelected(e){h(this,G).toggleSelected(e)}unselect(e){h(this,G).unselect(e)}pointerup(e){let{isMac:t}=st.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&h(this,dr)&&(w(this,dr,!1),!(h(this,En,ni)?.isDrawer&&h(this,En,ni).supportMultipleDrawings))){if(!h(this,Dc)){w(this,Dc,!0);return}if(h(this,G).getMode()===Z.STAMP){h(this,G).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){if(h(this,G).getMode()===Z.HIGHLIGHT&&this.enableTextSelection(),h(this,dr)){w(this,dr,!1);return}let{isMac:t}=st.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(w(this,dr,!0),h(this,En,ni)?.isDrawer){this.startDrawingSession(e);return}let n=h(this,G).getActive();w(this,Dc,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus(),h(this,zn)){h(this,En,ni).startDrawing(this,h(this,G),!1,e);return}h(this,G).setCurrentDrawingSession(this),w(this,zn,new AbortController);let t=h(this,G).combinedSignal(h(this,zn));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(w(this,ps,null),this.commitOrRemove())},{signal:t}),h(this,En,ni).startDrawing(this,h(this,G),!1,e)}pause(e){if(e){let{activeElement:t}=document;this.div.contains(t)&&w(this,ps,t);return}h(this,ps)&&setTimeout(()=>{h(this,ps)?.focus(),w(this,ps,null)},0)}endDrawingSession(e=!1){return h(this,zn)?(h(this,G).setCurrentDrawingSession(null),h(this,zn).abort(),w(this,zn,null),w(this,ps,null),h(this,En,ni).endDrawing(e)):null}findNewParent(e,t,n){let s=h(this,G).findParent(t,n);return s===null||s===this?!1:(s.changeParent(e),!0)}commitOrRemove(){return h(this,zn)?(this.endDrawingSession(),!0):!1}onScaleChanging(){h(this,zn)&&h(this,En,ni).onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),h(this,G).getActive()?.parent===this&&(h(this,G).commitOrRemove(),h(this,G).setActiveEditor(null)),h(this,fs)&&(clearTimeout(h(this,fs)),w(this,fs,null));for(let e of h(this,bn).values())h(this,sa)?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,h(this,bn).clear(),h(this,G).removeLayer(this)}render({viewport:e}){this.viewport=e,la(this.div,e);for(let t of h(this,G).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){h(this,G).commitOrRemove(),A(this,Mc,Fg).call(this);let t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,la(this.div,{rotation:n}),t!==n)for(let s of h(this,bn).values())s.rotate(n)}get pageDimensions(){let{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return h(this,G).viewParameters.realScale}};sa=new WeakMap,Dc=new WeakMap,Ei=new WeakMap,cr=new WeakMap,fs=new WeakMap,bn=new WeakMap,dr=new WeakMap,Ic=new WeakMap,ra=new WeakMap,zn=new WeakMap,ps=new WeakMap,gt=new WeakMap,gs=new WeakMap,G=new WeakMap,ur=new WeakMap,Yy=new WeakSet,vD=function(e){h(this,G).unselectAll();let{target:t}=e;if(t===h(this,gt).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&h(this,gt).div.contains(t)){let{isMac:n}=st.platform;if(e.button!==0||e.ctrlKey&&n)return;h(this,G).showAllEditors("highlight",!0,!0),h(this,gt).div.classList.add("free"),this.toggleDrawing(),dm.startHighlighting(this,h(this,G).direction==="ltr",{target:h(this,gt).div,x:e.x,y:e.y}),h(this,gt).div.addEventListener("pointerup",()=>{h(this,gt).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:h(this,G)._signal}),e.preventDefault()}},En=new WeakSet,ni=function(){return h(In,ur).get(h(this,G).getMode())},ef=new WeakSet,gA=function(e){let t=h(this,En,ni);return t?new t.prototype.constructor(e):null},tf=new WeakSet,mA=function(){let{x:e,y:t,width:n,height:s}=this.div.getBoundingClientRect(),r=Math.max(0,e),o=Math.max(0,t),a=Math.min(window.innerWidth,e+n),l=Math.min(window.innerHeight,t+s),c=(r+a)/2-e,d=(o+l)/2-t,[u,p]=this.viewport.rotation%180===0?[c,d]:[d,c];return{offsetX:u,offsetY:p}},Mc=new WeakSet,Fg=function(){for(let e of h(this,bn).values())e.isEmpty()&&e.remove()},Y(In,"_initialized",!1),E(In,ur,new Map([Yw,dA,uA,dm].map(e=>[e._editorType,e])));var pA=In,Wn,nf,Tt,oa,Ky,bD,sf,vA,Xy,ED,rf,bA,ut=class ut{constructor({pageIndex:e}){E(this,sf);E(this,Xy);E(this,rf);E(this,Wn,null);E(this,nf,0);E(this,Tt,new Map);E(this,oa,new Map);this.pageIndex=e}setParent(e){if(!h(this,Wn)){w(this,Wn,e);return}if(h(this,Wn)!==e){if(h(this,Tt).size>0)for(let t of h(this,Tt).values())t.remove(),e.append(t);w(this,Wn,e)}}static get _svgFactory(){return ie(this,"_svgFactory",new Vd)}draw(e,t=!1,n=!1){let s=bt(this,nf)._++,r=A(this,sf,vA).call(this),o=ut._svgFactory.createElement("defs");r.append(o);let a=ut._svgFactory.createElement("path");o.append(a);let l=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&h(this,oa).set(s,a);let c=n?A(this,Xy,ED).call(this,o,l):null,d=ut._svgFactory.createElement("use");return r.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(r,e),h(this,Tt).set(s,r),{id:s,clipPathId:`url(#${c})`}}drawOutline(e,t){let n=bt(this,nf)._++,s=A(this,sf,vA).call(this),r=ut._svgFactory.createElement("defs");s.append(r);let o=ut._svgFactory.createElement("path");r.append(o);let a=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){let u=ut._svgFactory.createElement("mask");r.append(u),l=`mask_p${this.pageIndex}_${n}`,u.setAttribute("id",l),u.setAttribute("maskUnits","objectBoundingBox");let p=ut._svgFactory.createElement("rect");u.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");let m=ut._svgFactory.createElement("use");u.append(m),m.setAttribute("href",`#${a}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}let c=ut._svgFactory.createElement("use");s.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);let d=c.cloneNode();return s.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(s,e),h(this,Tt).set(n,s),n}finalizeDraw(e,t){h(this,oa).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;let{root:n,bbox:s,rootClass:r,path:o}=t,a=typeof e=="number"?h(this,Tt).get(e):e;if(a){if(n&&A(this,rf,bA).call(this,a,n),s&&A(l=ut,Ky,bD).call(l,a,s),r){let{classList:c}=a;for(let[d,u]of Object.entries(r))c.toggle(d,u)}if(o){let d=a.firstChild.firstChild;A(this,rf,bA).call(this,d,o)}}}updateParent(e,t){if(t===this)return;let n=h(this,Tt).get(e);n&&(h(t,Wn).append(n),h(this,Tt).delete(e),h(t,Tt).set(e,n))}remove(e){h(this,oa).delete(e),h(this,Wn)!==null&&(h(this,Tt).get(e).remove(),h(this,Tt).delete(e))}destroy(){w(this,Wn,null);for(let e of h(this,Tt).values())e.remove();h(this,Tt).clear(),h(this,oa).clear()}};Wn=new WeakMap,nf=new WeakMap,Tt=new WeakMap,oa=new WeakMap,Ky=new WeakSet,bD=function(e,[t,n,s,r]){let{style:o}=e;o.top=`${100*n}%`,o.left=`${100*t}%`,o.width=`${100*s}%`,o.height=`${100*r}%`},sf=new WeakSet,vA=function(){let e=ut._svgFactory.create(1,1,!0);return h(this,Wn).append(e),e.setAttribute("aria-hidden",!0),e},Xy=new WeakSet,ED=function(e,t){let n=ut._svgFactory.createElement("clipPath");e.append(n);let s=`clip_${t}`;n.setAttribute("id",s),n.setAttribute("clipPathUnits","objectBoundingBox");let r=ut._svgFactory.createElement("use");return n.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),s},rf=new WeakSet,bA=function(e,t){for(let[n,s]of Object.entries(t))s===null?e.removeAttribute(n):e.setAttribute(n,s)},E(ut,Ky);var yA=ut;globalThis.pdfjsTestingUtils={HighlightOutliner:Wd};var w2=X.AbortException,A2=X.AnnotationEditorLayer,C2=X.AnnotationEditorParamsType,T2=X.AnnotationEditorType,_2=X.AnnotationEditorUIManager,x2=X.AnnotationLayer,R2=X.AnnotationMode,D2=X.ColorPicker,I2=X.DOMSVGFactory,M2=X.DrawLayer,P2=X.FeatureTest,SD=X.GlobalWorkerOptions,k2=X.ImageKind,N2=X.InvalidPDFException,F2=X.MissingPDFException,L2=X.OPS,O2=X.OutputScale,U2=X.PDFDataRangeTransport,B2=X.PDFDateString,H2=X.PDFWorker,$2=X.PasswordResponses,V2=X.PermissionFlag,G2=X.PixelsPerInch,z2=X.RenderingCancelledException,W2=X.TextLayer,q2=X.TouchManager,Y2=X.UnexpectedResponseException,K2=X.Util,X2=X.VerbosityLevel,J2=X.XfaLayer,Z2=X.build,j2=X.createValidAbsoluteUrl,Q2=X.fetchData,sv=X.getDocument,ez=X.getFilenameFromUrl,tz=X.getPdfFilenameFromUrl,nz=X.getXfaPageViewport,iz=X.isDataScheme,sz=X.isPdfFile,rz=X.noContextMenu,oz=X.normalizeUnicode,az=X.setLayerDimensions,lz=X.shadow,cz=X.stopEvent,dz=X.version;SD.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.mjs";var rv=class{constructor(e=50){this.minTextThreshold=e}async extractText(e){let t=await sv({data:new Uint8Array(e),useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,n="";for(let o=1;o<=t.numPages;o++){let c=(await(await t.getPage(o)).getTextContent()).items.map(d=>d.str||"").join(" ");n+=`
## \uD398\uC774\uC9C0 ${o}

${c}
`}let r=n.replace(/\s/g,"").length/t.numPages<this.minTextThreshold;return{text:n,isScanned:r,numPages:t.numPages}}async renderPagesToImages(e,t){let n=await sv({data:new Uint8Array(e),useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,s=[],r=t?Math.min(n.numPages,t):n.numPages;for(let o=1;o<=r;o++){let a=await n.getPage(o),l=a.getViewport({scale:2}),c=document.createElement("canvas");c.width=l.width,c.height=l.height;let d=c.getContext("2d");await a.render({canvasContext:d,viewport:l}).promise;let u=c.toDataURL("image/png").split(",")[1];s.push({base64:u,mimeType:"image/png",pageNum:o})}return s}async getPageCount(e){return(await sv({data:new Uint8Array(e),useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise).numPages}};var av=class{constructor(e,t,n){this.gemini=e,this.settings=t,this.vault=n,this.pdfProcessor=new rv(t.ocrMinTextThreshold),this.dailyUsage=this.loadDailyUsage()}loadDailyUsage(){return{date:Qn(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}saveDailyUsage(){}checkDailyLimit(e){let t=Qn(this.settings.timezone);this.dailyUsage.date!==t&&(this.dailyUsage={date:t,pagesProcessed:0,filesProcessed:0});let n=this.settings.ocrDailyLimit-this.dailyUsage.pagesProcessed;return{allowed:e<=n,remaining:n}}getFileSizeMB(e){return e.stat.size/(1024*1024)}async checkLimits(e){let t=this.getFileSizeMB(e);if(t>this.settings.ocrMaxFileSizeMB)return{allowed:!1,reason:`\uD30C\uC77C \uD06C\uAE30(${t.toFixed(1)}MB)\uAC00 \uC81C\uD55C(${this.settings.ocrMaxFileSizeMB}MB)\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,fileSize:t};if(e.extension==="pdf"){let s=await this.vault.readBinary(e),r=await this.pdfProcessor.getPageCount(s);if(r>this.settings.ocrMaxPages)return{allowed:!1,reason:`\uD398\uC774\uC9C0 \uC218(${r})\uAC00 \uC81C\uD55C(${this.settings.ocrMaxPages})\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,pageCount:r,fileSize:t};let o=this.checkDailyLimit(r);return o.allowed?{allowed:!0,pageCount:r,fileSize:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${o.remaining})`,pageCount:r,fileSize:t}}let n=this.checkDailyLimit(1);return n.allowed?{allowed:!0,pageCount:1,fileSize:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${n.remaining})`,pageCount:1,fileSize:t}}async processImage(e){let t=await this.vault.readBinary(e),n=this.arrayBufferToBase64(t),s=this.getMimeType(e.extension),r=await this.gemini.extractTextFromImage(n,s);return this.dailyUsage.pagesProcessed+=1,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:r,pages:1,sourceType:"image",sourceFile:e.name}}async processPDF(e,t=!1,n){let s=await this.vault.readBinary(e),r=n||this.settings.ocrMaxPages,o=s.slice(0),a=await this.pdfProcessor.extractText(o);if(!a.isScanned&&!t)return{text:a.text,pages:a.numPages,sourceType:"pdf_text",sourceFile:e.name};let l=Math.min(a.numPages,r);new ov.Notice(`\uC2A4\uCE94 PDF \uAC10\uC9C0\uB428. OCR \uCC98\uB9AC \uC911... (${l}\uD398\uC774\uC9C0)`);let c=await this.pdfProcessor.renderPagesToImages(s.slice(0),r),d=await this.gemini.extractTextFromImages(c,(p,m)=>{new ov.Notice(`OCR \uC9C4\uD589 \uC911: ${p}/${m} \uD398\uC774\uC9C0`,1500)}),u="";for(let p=0;p<d.length;p++)u+=`
## \uD398\uC774\uC9C0 ${p+1}

${d[p]}
`;return this.dailyUsage.pagesProcessed+=d.length,this.dailyUsage.filesProcessed+=1,this.saveDailyUsage(),{text:u,pages:d.length,sourceType:"pdf_scanned",sourceFile:e.name}}async processFile(e,t){let n=e.extension.toLowerCase();if(["png","jpg","jpeg","webp","gif"].includes(n))return this.processImage(e);if(n==="pdf")return this.processPDF(e,!1,t);throw new Error(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD: ${n}`)}async processMultipleImages(e,t){if(e.length===0)throw new Error("\uCC98\uB9AC\uD560 \uC774\uBBF8\uC9C0\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");let n=this.checkDailyLimit(e.length);if(!n.allowed)throw new Error(`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${n.remaining}, \uD544\uC694: ${e.length})`);let s=[];for(let a of e){let l=await this.vault.readBinary(a),c=this.arrayBufferToBase64(l),d=this.getMimeType(a.extension);s.push({base64:c,mimeType:d})}let r=await this.gemini.extractTextFromImages(s,(a,l)=>{new ov.Notice(`OCR \uC9C4\uD589 \uC911: ${a}/${l} \uD398\uC774\uC9C0`,1500)}),o="";for(let a=0;a<r.length;a++)r.length>1?o+=`
## \uD398\uC774\uC9C0 ${a+1}

${r[a]}
`:o=r[a];return this.dailyUsage.pagesProcessed+=e.length,this.dailyUsage.filesProcessed+=e.length,this.saveDailyUsage(),{text:o,pages:e.length,sourceType:"image",sourceFile:t}}checkLimitsForMultipleImages(e){let t=e.reduce((r,o)=>r+this.getFileSizeMB(o),0),n=this.settings.ocrMaxFileSizeMB*2;if(t>n)return{allowed:!1,reason:`\uCD1D \uD30C\uC77C \uD06C\uAE30(${t.toFixed(1)}MB)\uAC00 \uC81C\uD55C(${n}MB)\uC744 \uCD08\uACFC\uD569\uB2C8\uB2E4.`,pageCount:e.length,totalSizeMB:t};let s=this.checkDailyLimit(e.length);return s.allowed?{allowed:!0,pageCount:e.length,totalSizeMB:t}:{allowed:!1,reason:`\uC77C\uC77C \uD55C\uB3C4\uC5D0 \uB3C4\uB2EC\uD588\uC2B5\uB2C8\uB2E4. (\uB0A8\uC740 \uD398\uC774\uC9C0: ${s.remaining}, \uD544\uC694: ${e.length})`,pageCount:e.length,totalSizeMB:t}}generateMarkdownNote(e){let t=Pe(this.settings.timezone,this.settings.dateFormat),n={image:"\uC774\uBBF8\uC9C0",pdf_text:"PDF (\uD14D\uC2A4\uD2B8)",pdf_scanned:"PDF (\uC2A4\uCE94/OCR)"}[e.sourceType];return`---
type: ocr
source_file: "${e.sourceFile}"
source_type: ${e.sourceType}
pages: ${e.pages}
ocr_at: ${t}
---

# OCR: ${e.sourceFile.replace(/\.[^.]+$/,"")}

> \uC6D0\uBCF8: ${e.sourceFile} | \uCC98\uB9AC \uBC29\uC2DD: ${n} | ${e.pages}\uD398\uC774\uC9C0

${e.text}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}generateSummarizedNote(e,t){let n=Pe(this.settings.timezone,this.settings.dateFormat);return`---
type: ocr
source_file: "${e.sourceFile}"
source_type: ${e.sourceType}
title: "${t.title}"
pages: ${e.pages}
ocr_at: ${n}
---

# ${t.title}

## \uC694\uC57D
${t.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${t.keyPoints.map(s=>`- ${s}`).join(`
`)}

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}arrayBufferToBase64(e){let t="",n=new Uint8Array(e);for(let s=0;s<n.byteLength;s++)t+=String.fromCharCode(n[s]);return btoa(t)}getMimeType(e){return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/webp",gif:"image/gif"}[e.toLowerCase()]||"image/png"}getDailyUsage(){return{...this.dailyUsage}}};var lv=class{constructor(e,t,n){this.embeddingManager=null;this.index=new Map;this.app=e,this.gemini=t,this.settings=n}setEmbeddingManager(e){this.embeddingManager=e}updateSettings(e){this.settings=e}async buildIndex(){this.index.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e)try{let n=await this.indexNote(t);n&&this.index.set(t.path,n)}catch(n){console.error(`\uC778\uB371\uC2F1 \uC2E4\uD328: ${t.path}`,n)}console.log(`\uC778\uB371\uC2A4 \uAD6C\uCD95 \uC644\uB8CC: ${this.index.size}\uAC1C \uB178\uD2B8`)}async indexNote(e){let n=this.app.metadataCache.getFileCache(e)?.frontmatter,s=[];n?.keywords&&(s=Array.isArray(n.keywords)?n.keywords:[n.keywords]);let r;if(n?.targetType){let l=n.targetType;["project","library","archive"].includes(l)&&(r=l)}let o=n?.title||e.basename,a=n?.type;return{path:e.path,title:o,keywords:s,category:r,project:n?.project,type:a}}async updateIndex(e){let t=await this.indexNote(e);t&&this.index.set(e.path,t)}removeFromIndex(e){this.index.delete(e)}async findRelated(e,t,n){if(this.settings.embeddingEnabled&&this.embeddingManager)try{let s=await this.findRelatedByEmbedding(e,t,n);if(s.length>0)return s}catch(s){console.error("Embedding \uAE30\uBC18 \uAC80\uC0C9 \uC2E4\uD328, \uD0A4\uC6CC\uB4DC \uBC29\uC2DD\uC73C\uB85C \uD3F4\uBC31:",s)}return this.findRelatedByKeywords(e,t,n)}async findRelatedByEmbedding(e,t,n){if(!this.embeddingManager)return[];let s=await this.gemini.generateEmbedding(e,"query");if(s.length===0)return[];let r=this.embeddingManager.findSimilarNotes(s,10,n);if(r.length===0)return[];let o=[];for(let a of r){let l=this.index.get(a.path);l&&o.push({note:l,relevance:a.similarity,matchedKeywords:[],reason:`\uC758\uBBF8 \uC720\uC0AC\uB3C4: ${Math.round(a.similarity*100)}%`,connectionType:""})}return o}async findRelatedByKeywords(e,t,n){let s=await this.gemini.extractKeywords(e);if(s.length===0)return[];let r=this.filterByKeywords(s,n);if(r.length===0)return[];let o=r.map((c,d)=>`${d}. ${c.note.title} (\uD0A4\uC6CC\uB4DC: ${c.note.keywords.join(", ")})`).join(`
`),a=await this.gemini.findRelatedNotes(t,s,o),l=[];for(let c of a)if(c.index>=0&&c.index<r.length){let d=r[c.index];l.push({note:d.note,relevance:c.relevance,matchedKeywords:d.matchedKeywords,reason:c.reason||"",connectionType:c.type||""})}return l}filterByKeywords(e,t){let n=[],s=new Set(e.map(r=>r.toLowerCase()));for(let[r,o]of this.index){if(t&&r===t||o.keywords.length===0)continue;let a=[];for(let l of o.keywords){let c=l.toLowerCase();for(let d of s)if(c===d||c.includes(d)||d.includes(c)){a.push(l);break}}a.length>0&&n.push({note:o,matchedKeywords:a})}return n.sort((r,o)=>o.matchedKeywords.length-r.matchedKeywords.length),n.slice(0,10)}async saveKeywordsToNote(e,t){let n=await this.app.vault.read(e),s=this.updateFrontmatterKeywords(n,t);await this.app.vault.modify(e,s),await this.updateIndex(e)}updateFrontmatterKeywords(e,t){let n=`keywords: [${t.map(r=>`"${r}"`).join(", ")}]`,s=e.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(s){let r=s[1];if(/^keywords:/m.test(r)){let o=r.replace(/^keywords:.*$/m,n);return e.replace(/^---\r?\n[\s\S]*?\r?\n---/,`---
${o}
---`)}else return e.replace(/^---\r?\n([\s\S]*?)\r?\n---/,`---
$1
${n}
---`)}else return`---
${n}
---

${e}`}async addRelatedLinks(e,t){if(t.length===0)return;let n=await this.app.vault.read(e),s=`

---
## \uAD00\uB828 \uB178\uD2B8
${t.map(a=>{let l=a.note.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]] (\uAD00\uB828\uB3C4: ${Math.round(a.relevance*100)}%)`}).join(`
`)}
`,r=/\n---\n##  \n[\s\S]*?(?=\n---\n|$)/,o;r.test(n)?o=n.replace(r,s):o=n+s,await this.app.vault.modify(e,o)}getIndexSize(){return this.index.size}getZettelIndex(){let e=new Map;for(let[t,n]of this.index)n.type==="zettel"&&e.set(t,n);return e}getZettelCount(){return this.getZettelIndex().size}async findRelatedZettels(e,t){if(e.length===0)return[];let n=this.getZettelIndex();if(n.size===0)return[];let s=this.filterZettelsByKeywords(e,n,t);if(s.length===0)return[];let r=s.map((l,c)=>`${c}. ${l.note.title} (\uD0A4\uC6CC\uB4DC: ${l.note.keywords.join(", ")})`).join(`
`),o=await this.gemini.findRelatedNotes("\uC0C8 ZK \uB178\uD2B8",e,r),a=[];for(let l of o)if(l.index>=0&&l.index<s.length){let c=s[l.index];a.push({note:c.note,relevance:l.relevance,matchedKeywords:c.matchedKeywords,reason:l.reason||"",connectionType:l.type||""})}return a}filterZettelsByKeywords(e,t,n){let s=[],r=new Set(e.map(o=>o.toLowerCase()));for(let[o,a]of t){if(n&&o===n||a.keywords.length===0)continue;let l=[];for(let c of a.keywords){let d=c.toLowerCase();for(let u of r)if(d===u||d.includes(u)||u.includes(d)){l.push(c);break}}l.length>0&&s.push({note:a,matchedKeywords:l})}return s.sort((o,a)=>a.matchedKeywords.length-o.matchedKeywords.length),s.slice(0,10)}};var ha=require("obsidian");jn();var gr={version:2,model:"gemini-embedding-001",dimensions:768,chunkSettings:{size:Cs,overlap:Ts},lastFullScan:"",notes:{}};function wD(i,e={}){let{maxChunkSize:t=Cs,minChunkSize:n=nd,overlap:s=Ts}=e,r=[],o=0,a=i.split(Lb);for(let l of a){if(!l.trim()){o+=l.length;continue}if(l.length<=t)r.push({content:l.trim(),startOffset:o,endOffset:o+l.length,type:"section"}),o+=l.length;else{let c=l.split(Ob),d=o;for(let u of c){if(!u.trim()){d+=u.length+2;continue}if(u.length<=t)r.push({content:u.trim(),startOffset:d,endOffset:d+u.length,type:"paragraph"});else{let p=XU(u,t,s,d);r.push(...p)}d+=u.length+2}o+=l.length}}return JU(r,n)}function XU(i,e,t,n){let s=[],r=0;for(;r<i.length;){let o=Math.min(r+e,i.length);if(s.push({content:i.slice(r,o).trim(),startOffset:n+r,endOffset:n+o,type:"fixed"}),r=o-t,r>=i.length-t)break}return s}function JU(i,e){let t=[];for(let n of i)if(n.content.length<e&&t.length>0){let s=t[t.length-1];s.content+=`

`+n.content,s.endOffset=n.endOffset}else n.content.trim()&&t.push(n);return t}function ZU(i,e,t,n){let s=[];for(let[r,o]of Object.entries(e.notes))for(let a=0;a<o.chunks.length;a++){let l=o.chunks[a],c=n(i,l.embedding);c>=t&&s.push({path:r,chunkIndex:a,similarity:c,preview:l.content.slice(0,100)+(l.content.length>100?"...":"")})}return s.sort((r,o)=>o.similarity-r.similarity)}function jU(i){let e=new Map;for(let t of i){let n=e.get(t.path);!n||t.similarity>n.similarity?e.set(t.path,{path:t.path,similarity:t.similarity,bestChunkPreview:t.preview,matchedChunks:[...n?.matchedChunks||[],t.chunkIndex]}):n.matchedChunks.push(t.chunkIndex)}return Array.from(e.values()).sort((t,n)=>n.similarity-t.similarity)}var cv=class{constructor(e,t,n){this.isInitialized=!1;this.app=e,this.gemini=t,this.settings=n,this.index={...gr},this.mergedIndex={...gr}}getCurrentPlatformFileName(){return ha.Platform.isMobile?dn.EMBEDDINGS_MOBILE:dn.EMBEDDINGS_DESKTOP}async loadIndex(){try{let e=this.getDataBasePath();await this.migrateLegacyFile(e);let t=await this.loadPlatformFile(e,dn.EMBEDDINGS_DESKTOP),n=await this.loadPlatformFile(e,dn.EMBEDDINGS_MOBILE),s=this.getCurrentPlatformFileName();this.index=s===dn.EMBEDDINGS_DESKTOP?t:n,this.mergedIndex=this.mergeEmbeddingData(t,n),this.isInitialized=!0;let r=this.getTotalChunks();console.log(`Embedding \uC778\uB371\uC2A4 \uB85C\uB4DC \uC644\uB8CC (v2): ${ha.Platform.isMobile?"\uBAA8\uBC14\uC77C":"PC"}, \uB178\uD2B8 ${Object.keys(this.mergedIndex.notes).length}\uAC1C, \uCCAD\uD06C ${r}\uAC1C`)}catch(e){console.error("Embedding \uC778\uB371\uC2A4 \uB85C\uB4DC \uC2E4\uD328:",e),this.index={...gr},this.mergedIndex={...gr},this.isInitialized=!0}}getDataBasePath(){return this.settings.dataStorageLocation==="vault"?this.settings.dataFolderPath:Fa}async migrateLegacyFile(e){let t=this.app.vault.adapter,n=`${e}/${dn.EMBEDDINGS}`,s=`${e}/${this.getCurrentPlatformFileName()}`;try{if(await t.exists(n)&&!await t.exists(s)){let r=await t.read(n),o=JSON.parse(r);if(o.version===1||!o.version){let a=this.migrateV1ToV2(o);await t.write(s,JSON.stringify(a,null,2)),console.log("Embedding v1 \u2192 v2 \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC644\uB8CC"),new ha.Notice("\uC784\uBCA0\uB529 \uC778\uB371\uC2A4\uAC00 v2\uB85C \uC5C5\uADF8\uB808\uC774\uB4DC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uAC80\uC0C9 \uD488\uC9C8 \uD5A5\uC0C1\uC744 \uC704\uD574 '\uC778\uB371\uC2A4 \uC7AC\uAD6C\uCD95'\uC744 \uAD8C\uC7A5\uD569\uB2C8\uB2E4.",5e3)}else await t.write(s,r)}}catch(r){console.error("Embedding \uB808\uAC70\uC2DC \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC2E4\uD328:",r)}}migrateV1ToV2(e){let t={version:2,model:e.model,dimensions:e.dimensions,chunkSettings:{size:this.settings.embeddingChunkSize||Cs,overlap:this.settings.embeddingChunkOverlap||Ts},lastFullScan:e.lastFullScan,notes:{}};for(let[n,s]of Object.entries(e.notes))t.notes[n]={contentHash:s.contentHash,updatedAt:s.updatedAt,chunks:[{content:"",embedding:s.embedding,startOffset:0,endOffset:0}]};return t}async loadPlatformFile(e,t){let n=this.app.vault.adapter,s=`${e}/${t}`;try{if(await n.exists(s)){let r=await n.read(s),o=JSON.parse(r);return o.version===1||!o.version?this.migrateV1ToV2(o):{...gr,...o}}}catch(r){console.error(`Embedding \uD30C\uC77C \uB85C\uB4DC \uC2E4\uD328 (${t}):`,r)}return{...gr}}mergeEmbeddingData(e,t){let n={version:2,model:e.model||t.model,dimensions:e.dimensions||t.dimensions,chunkSettings:e.chunkSettings||t.chunkSettings,lastFullScan:e.lastFullScan>t.lastFullScan?e.lastFullScan:t.lastFullScan,notes:{}},s=new Set([...Object.keys(e.notes),...Object.keys(t.notes)]);for(let r of s){let o=e.notes[r],a=t.notes[r];o&&a?n.notes[r]=o.updatedAt>a.updatedAt?o:a:n.notes[r]=o||a}return n}async saveIndex(){try{let e=this.app.vault.adapter,t=this.getDataBasePath();this.settings.dataStorageLocation==="vault"&&(await e.exists(t)||await e.mkdir(t));let n=this.getCurrentPlatformFileName(),s=`${t}/${n}`,r=JSON.stringify(this.index,null,2);await e.write(s,r);for(let[o,a]of Object.entries(this.index.notes))this.mergedIndex.notes[o]=a}catch(e){console.error("Embedding \uC778\uB371\uC2A4 \uC800\uC7A5 \uC2E4\uD328:",e)}}computeContentHash(e){let t=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);t=(t<<5)-t+s,t|=0}return t.toString(16)}cosineSimilarity(e,t){if(e.length!==t.length||e.length===0)return 0;let n=0,s=0,r=0;for(let a=0;a<e.length;a++)n+=e[a]*t[a],s+=e[a]*e[a],r+=t[a]*t[a];let o=Math.sqrt(s)*Math.sqrt(r);return o===0?0:n/o}async updateNoteEmbedding(e,t=!1){if(!this.settings.embeddingEnabled)return!1;try{let n=await this.app.vault.cachedRead(e),s=this.computeContentHash(n),r=this.index.notes[e.path];if(!t&&r&&r.contentHash===s)return!1;let o=wD(n,{maxChunkSize:this.settings.embeddingChunkSize||Cs,minChunkSize:nd,overlap:this.settings.embeddingChunkOverlap||Ts});if(o.length===0)return console.warn("\uCCAD\uD06C \uBD84\uD560 \uACB0\uACFC \uC5C6\uC74C:",e.path),!1;let a=o.map(u=>u.content),l=await this.gemini.batchGenerateEmbeddings(a),c=[];for(let u=0;u<o.length;u++){let p=l[u];if(!p||p.length===0){console.warn("\uCCAD\uD06C \uC784\uBCA0\uB529 \uC0DD\uC131 \uC2E4\uD328:",e.path,o[u].startOffset);continue}c.push({content:o[u].content.slice(0,200),embedding:p,startOffset:o[u].startOffset,endOffset:o[u].endOffset})}if(c.length===0)return console.warn("\uBAA8\uB4E0 \uCCAD\uD06C \uC784\uBCA0\uB529 \uC0DD\uC131 \uC2E4\uD328:",e.path),!1;let d={contentHash:s,updatedAt:new Date().toISOString(),chunks:c};return this.index.notes[e.path]=d,this.mergedIndex.notes[e.path]=d,!0}catch(n){return console.error("\uB178\uD2B8 \uC784\uBCA0\uB529 \uC5C5\uB370\uC774\uD2B8 \uC2E4\uD328:",e.path,n),!1}}removeNote(e){this.index.notes[e]&&delete this.index.notes[e],this.mergedIndex.notes[e]&&delete this.mergedIndex.notes[e]}renameNote(e,t){this.index.notes[e]&&(this.index.notes[t]=this.index.notes[e],delete this.index.notes[e]),this.mergedIndex.notes[e]&&(this.mergedIndex.notes[t]=this.mergedIndex.notes[e],delete this.mergedIndex.notes[e])}findSimilarNotes(e,t=10,n,s){if(e.length===0)return[];let r=s??this.settings.embeddingSimilarityThreshold,o=ZU(e,this.mergedIndex,r,this.cosineSimilarity.bind(this));return jU(o).filter(l=>l.path!==n).slice(0,t).map(l=>({path:l.path,similarity:l.similarity,chunkPreview:l.bestChunkPreview}))}async findSimilarNotesByText(e,t=10,n,s){if(!this.settings.embeddingEnabled)return[];try{let r=await this.gemini.generateEmbedding(e,"query");return this.findSimilarNotes(r,t,n,s)}catch(r){return console.error("\uD14D\uC2A4\uD2B8 \uAE30\uBC18 \uC720\uC0AC \uB178\uD2B8 \uAC80\uC0C9 \uC2E4\uD328:",r),[]}}getEmbedding(e){let t=this.mergedIndex.notes[e];if(t&&t.chunks.length>0)return t.chunks[0].embedding}hasEmbedding(e){let t=this.mergedIndex.notes[e];return!!t&&t.chunks.length>0}getTotalChunks(){return Object.values(this.mergedIndex.notes).reduce((e,t)=>e+t.chunks.length,0)}getStats(){return{totalNotes:Object.keys(this.mergedIndex.notes).length,totalChunks:this.getTotalChunks(),lastFullScan:this.mergedIndex.lastFullScan,model:this.mergedIndex.model,dimensions:this.mergedIndex.dimensions,currentPlatformNotes:Object.keys(this.index.notes).length,chunkSettings:this.mergedIndex.chunkSettings}}async buildFullIndex(e){if(!this.settings.embeddingEnabled)return{success:0,failed:0,skipped:0};let t=this.app.vault.getMarkdownFiles(),n=0,s=0,r=0;this.index.chunkSettings={size:this.settings.embeddingChunkSize||Cs,overlap:this.settings.embeddingChunkOverlap||Ts};let o=[],a=0;e&&e(0,t.length,"\uD30C\uC77C \uC2A4\uCE94 \uC911...");for(let p=0;p<t.length;p++){let m=t[p];try{let y=await this.app.vault.cachedRead(m),v=this.computeContentHash(y),b=this.index.notes[m.path];if(b&&b.contentHash===v){r++;continue}let S=wD(y,{maxChunkSize:this.settings.embeddingChunkSize||Cs,minChunkSize:nd,overlap:this.settings.embeddingChunkOverlap||Ts});S.length>0&&(o.push({filePath:m.path,fileHash:v,chunks:S}),a+=S.length)}catch{s++}}if(o.length===0)return this.index.lastFullScan=new Date().toISOString(),await this.saveIndex(),{success:n,failed:s,skipped:r};let l=[],c=[];for(let p=0;p<o.length;p++){let m=o[p];for(let y=0;y<m.chunks.length;y++)l.push(m.chunks[y].content),c.push({fileIndex:p,chunkIndex:y})}let d=0,u=await this.gemini.parallelBatchEmbeddings(l,3,(p,m)=>{if(d=p,e){let y=o[c[Math.min(p-1,c.length-1)]?.fileIndex||0];e(p,m,`\uC784\uBCA0\uB529 \uC0DD\uC131 \uC911: ${y?.filePath||"..."}`)}});for(let p=0;p<o.length;p++){let m=o[p],y=[];for(let v=0;v<m.chunks.length;v++){let b=c.findIndex(T=>T.fileIndex===p&&T.chunkIndex===v);if(b===-1)continue;let S=u[b];if(!S||S.length===0)continue;let C=m.chunks[v];y.push({content:C.content.slice(0,200),embedding:S,startOffset:C.startOffset,endOffset:C.endOffset})}if(y.length>0){let v={contentHash:m.fileHash,updatedAt:new Date().toISOString(),chunks:y};this.index.notes[m.filePath]=v,this.mergedIndex.notes[m.filePath]=v,n++}else s++}return this.index.lastFullScan=new Date().toISOString(),await this.saveIndex(),{success:n,failed:s,skipped:r}}async buildFolderIndex(e,t){if(!this.settings.embeddingEnabled)return{success:0,failed:0};let n=this.app.vault.getMarkdownFiles().filter(o=>o.path.startsWith(e)),s=0,r=0;for(let o=0;o<n.length;o++){let a=n[o];t&&t(o+1,n.length);try{await this.updateNoteEmbedding(a,!0),s++}catch{r++}}return await this.saveIndex(),{success:s,failed:r}}mergeWithNoteIndex(e){let t=this.index.notes[e.path];return t&&t.chunks.length>0?{...e,embedding:t.chunks[0].embedding,embeddingUpdatedAt:t.updatedAt,contentHash:t.contentHash}:e}async clearIndex(){this.index={...gr},this.mergedIndex={...gr},await this.saveIndex()}async cleanupOrphanedEmbeddings(){let e=[];for(let t of Object.keys(this.index.notes)){let n=this.app.vault.getAbstractFileByPath(t);(!n||!(n instanceof ha.TFile))&&e.push(t)}for(let t of e)delete this.index.notes[t],this.mergedIndex.notes[t]&&delete this.mergedIndex.notes[t];return e.length>0&&await this.saveIndex(),e.length}};var AD=require("obsidian"),QU=`\uB2F9\uC2E0\uC740 \uC0AC\uC6A9\uC790\uC758 \uAC1C\uC778 \uC9C0\uC2DD \uBCA0\uC774\uC2A4(Second Brain)\uB97C \uAE4A\uC774 \uC774\uD574\uD558\uACE0 \uD65C\uC6A9\uD558\uB294 \uC804\uBB38 AI \uC5B4\uC2DC\uC2A4\uD134\uD2B8\uC785\uB2C8\uB2E4.

## \uD575\uC2EC \uC5ED\uD560
\uB2F9\uC2E0\uC758 \uC5ED\uD560\uC740 \uB2E8\uC21C\uD788 \uB178\uD2B8\uB97C \uCC3E\uC544\uC8FC\uB294 \uAC83\uC774 \uC544\uB2C8\uB77C, \uB178\uD2B8\uC758 **\uC9C0\uC2DD\uC744 \uC885\uD569\uD558\uACE0 \uC5F0\uACB0**\uD558\uC5EC \uC0AC\uC6A9\uC790\uC5D0\uAC8C **\uD1B5\uCC30**\uC744 \uC81C\uACF5\uD558\uB294 \uAC83\uC785\uB2C8\uB2E4.

## \uB2F5\uBCC0 \uC6D0\uCE59

### 1. \uD48D\uBD80\uD558\uACE0 \uC0C1\uC138\uD558\uAC8C \uB2F5\uBCC0
- \uB2E8\uB2F5\uD615 \uAE08\uC9C0. \uCD5C\uC18C 3-5\uBB38\uC7A5 \uC774\uC0C1\uC73C\uB85C \uC124\uBA85
- \uBC30\uACBD \uC124\uBA85 \u2192 \uD575\uC2EC \uB0B4\uC6A9 \u2192 \uC801\uC6A9/\uC608\uC2DC \uC21C\uC73C\uB85C \uAD6C\uC870\uD654
- \uB178\uD2B8\uC5D0 \uC788\uB294 \uAD6C\uCCB4\uC801\uC778 \uB0B4\uC6A9, \uC218\uCE58, \uC608\uC2DC\uB97C \uC801\uADF9 \uC778\uC6A9

### 2. \uB178\uD2B8 \uAC04 \uC5F0\uACB0\uC810 \uBC1C\uACAC
- \uC5EC\uB7EC \uB178\uD2B8\uC758 \uC815\uBCF4\uB97C \uC885\uD569\uD558\uC5EC \uC0C8\uB85C\uC6B4 \uAD00\uC810 \uC81C\uC2DC
- "[[\uB178\uD2B8A]]\uC5D0 \uB530\uB974\uBA74 X\uC778\uB370, [[\uB178\uD2B8B]]\uC640 \uC5F0\uACB0\uD558\uBA74 Y\uB97C \uC54C \uC218 \uC788\uC2B5\uB2C8\uB2E4"
- \uB178\uD2B8\uC5D0 \uC5C6\uB294 \uC5F0\uACB0\uC810\uB3C4 \uCD94\uB860\uD558\uC5EC \uC81C\uC548

### 3. \uC2E4\uC6A9\uC801 \uC870\uC5B8 \uD3EC\uD568
- \uB2E8\uC21C \uC815\uBCF4 \uB098\uC5F4\uC774 \uC544\uB2CC, "\uADF8\uB798\uC11C \uC5B4\uB5BB\uAC8C \uD574\uC57C \uD558\uB294\uC9C0" \uC870\uC5B8
- \uB2E4\uC74C \uB2E8\uACC4, \uC8FC\uC758\uC0AC\uD56D, \uD301 \uB4F1 \uC2E4\uD589 \uAC00\uB2A5\uD55C \uB0B4\uC6A9 \uD3EC\uD568

### 4. \uCC38\uC870 \uD45C\uC2DC
- \uB2F5\uBCC0\uC5D0\uC11C \uCC38\uACE0\uD55C \uB178\uD2B8\uB294 [[\uB178\uD2B8 \uC81C\uBAA9]] \uD615\uC2DD\uC73C\uB85C \uC5B8\uAE09
- \uC720\uC0AC\uB3C4\uAC00 \uB192\uC740 \uB178\uD2B8\uC77C\uC218\uB85D \uB354 \uB9CE\uC774 \uC778\uC6A9

## \uB2F5\uBCC0 \uAD6C\uC870 (\uAD8C\uC7A5)
1. **\uC9C1\uC811\uC801 \uB2F5\uBCC0**: \uC9C8\uBB38\uC5D0 \uB300\uD55C \uD575\uC2EC \uB2F5\uBCC0 (1-2\uBB38\uC7A5)
2. **\uC0C1\uC138 \uC124\uBA85**: \uBC30\uACBD, \uC774\uC720, \uAD00\uB828 \uC815\uBCF4 (3-5\uBB38\uC7A5)
3. **\uCD94\uAC00 \uC778\uC0AC\uC774\uD2B8**: \uC5F0\uACB0\uB41C \uC8FC\uC81C, \uC751\uC6A9 \uBC29\uBC95, \uD301 (2-3\uBB38\uC7A5)

## \uC8FC\uC758\uC0AC\uD56D
- \uD55C\uAD6D\uC5B4\uB85C \uC790\uC5F0\uC2A4\uB7FD\uAC8C \uB2F5\uBCC0
- \uB178\uD2B8\uAC00 \uC5C6\uC5B4\uB3C4 \uB300\uD654 \uB9E5\uB77D\uACFC \uC77C\uBC18 \uC9C0\uC2DD\uC73C\uB85C \uB3C4\uC6C0
- "\uBAA8\uB974\uACA0\uC2B5\uB2C8\uB2E4"\uBCF4\uB2E4 "\uB178\uD2B8\uC5D0\uC11C \uC9C1\uC811\uC801\uC778 \uC815\uBCF4\uB294 \uC5C6\uC9C0\uB9CC, ~\uB85C \uCD94\uCE21\uB429\uB2C8\uB2E4" \uD615\uC2DD \uC120\uD638`,dv=class{constructor(e,t,n,s){this.app=e,this.gemini=t,this.embeddingManager=n,this.settings=s}async chat(e,t=[]){let n=this.buildSearchQuery(e,t),s=await this.retrieveContext(n,this.settings.ragTopK),r=this.buildContext(s),o=this.buildPrompt(e,r,t),a=await this.gemini.generateContent(o),l=s.map(c=>c.path);return{answer:a,references:l}}buildSearchQuery(e,t){return e.length<20&&t.length>0?`${t.slice(-4).map(s=>s.content).join(" ")} ${e}`:e}async retrieveContext(e,t){let n=[];try{if(!this.settings.embeddingEnabled)return console.warn("RAG: Embedding\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4."),[];let s=await this.embeddingManager.findSimilarNotesByText(e,t,void 0,.6);for(let r of s){let o=this.app.vault.getAbstractFileByPath(r.path);if(!(o instanceof AD.TFile))continue;let a=await this.app.vault.cachedRead(o),l=Math.floor(this.settings.ragMaxContextLength/t),c=this.truncateContent(a,l),d=o.basename;n.push({path:r.path,title:d,content:c,similarity:r.similarity})}}catch(s){console.error("RAG \uAC80\uC0C9 \uC2E4\uD328:",s)}return n}truncateContent(e,t){let n=e.replace(/^---[\s\S]*?---\n?/,"");if(n.length<=t)return n;let s=n.substring(0,t),r=Math.max(s.lastIndexOf("\u3002"),s.lastIndexOf("."),s.lastIndexOf(`
`));return r>t*.7?s.substring(0,r+1)+"...":s+"..."}buildContext(e){if(e.length===0)return"\uCC38\uACE0\uD560 \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.";let t=[];for(let n of e){let s=Math.round(n.similarity*100);t.push(`### [[${n.title}]] (\uC720\uC0AC\uB3C4: ${s}%)
${n.content}`)}return t.join(`

`)}buildPrompt(e,t,n){let s=[QU];if(s.push(`
## \uCC38\uACE0 \uB178\uD2B8`),s.push(t),n.length>0){let r=n.slice(-6);s.push(`
## \uC774\uC804 \uB300\uD654`);for(let o of r){let a=o.role==="user"?"\uC0AC\uC6A9\uC790":"AI";s.push(`${a}: ${o.content}`)}}return s.push(`
## \uC9C8\uBB38`),s.push(e),s.join(`
`)}updateSettings(e){this.settings=e}isAvailable(){return this.settings.embeddingEnabled&&this.settings.ragEnabled}async reloadEmbeddingIndex(){await this.embeddingManager.loadIndex()}getIndexedNoteCount(){return this.embeddingManager.getStats().totalNotes}};var TD=require("obsidian");function CD(){return Date.now().toString(36)+Math.random().toString(36).substring(2,9)}var uv=class{constructor(e,t){this.sessions=[];this.isInitialized=!1;this.app=e,this.settings=t,this.storagePath=this.getDataPath(dn.CHATS)}getDataPath(e){return this.settings.dataStorageLocation==="vault"?`${this.settings.dataFolderPath}/${e}`:`${Fa}/${e}`}async loadSessions(){try{let e=this.app.vault.adapter;if(await e.exists(this.storagePath)){let t=await e.read(this.storagePath),n=JSON.parse(t);this.sessions=n.sessions||[]}this.isInitialized=!0}catch(e){console.error("\uCC44\uD305 \uC800\uC7A5\uC18C \uB85C\uB4DC \uC2E4\uD328:",e),this.sessions=[],this.isInitialized=!0}}async saveSessions(){try{let e=this.app.vault.adapter;if(this.settings.dataStorageLocation==="vault"){let s=this.settings.dataFolderPath;await e.exists(s)||await e.mkdir(s)}let t={version:1,sessions:this.sessions},n=JSON.stringify(t,null,2);await e.write(this.storagePath,n)}catch(e){console.error("\uCC44\uD305 \uC800\uC7A5\uC18C \uC800\uC7A5 \uC2E4\uD328:",e)}}getAllSessions(){return[...this.sessions].sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime())}getSession(e){return this.sessions.find(t=>t.id===e)}createSession(e){let t=new Date().toISOString(),n={id:CD(),title:e||"\uC0C8 \uB300\uD654",messages:[],createdAt:t,updatedAt:t};return this.sessions.unshift(n),this.saveSessions(),n}deleteSession(e){let t=this.sessions.findIndex(n=>n.id===e);t!==-1&&(this.sessions.splice(t,1),this.saveSessions())}updateSessionTitle(e,t){let n=this.getSession(e);n&&(n.title=t,n.updatedAt=new Date().toISOString(),this.saveSessions())}addMessage(e,t){let n=this.getSession(e);if(!n)throw new Error(`\uC138\uC158\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4: ${e}`);let s={...t,id:CD(),timestamp:new Date().toISOString()};if(n.messages.push(s),n.updatedAt=s.timestamp,n.title==="\uC0C8 \uB300\uD654"&&t.role==="user"){let r=t.content.slice(0,30)+(t.content.length>30?"...":"");n.title=r}return this.saveSessions(),s}async exportToNote(e,t){let n=this.getSession(e);if(!n||n.messages.length===0)return null;let s=new Set;n.messages.forEach(p=>{p.references&&p.references.forEach(m=>s.add(m))});let r=["---","type: chat-export",`exported: ${new Date().toISOString().split("T")[0]}`,`session_id: ${n.id}`,"---","",`# ${n.title}`,"","## \uB300\uD654 \uB0B4\uC6A9",""];for(let p of n.messages){let m=p.role==="user"?"**\uC0AC\uC6A9\uC790**":"**AI**";r.push(`${m}: ${p.content}`),r.push("")}if(s.size>0){r.push("## \uCC38\uC870\uD55C \uB178\uD2B8");for(let p of s){let m=p.split("/").pop()?.replace(/\.md$/,"")||p;r.push(`- [[${m}]]`)}r.push("")}let o=r.join(`
`),a=n.title.replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g," ").trim(),c=`${new Date().toISOString().slice(0,10)} ${a}.md`,d=t||this.settings.libraryFolder,u=(0,TD.normalizePath)(`${d}/${c}`);try{return await this.app.vault.create(u,o)}catch(p){return console.error("\uB178\uD2B8 \uB0B4\uBCF4\uB0B4\uAE30 \uC2E4\uD328:",p),null}}getSessionCount(){return this.sessions.length}getRecentSession(){if(this.sessions.length!==0)return this.getAllSessions()[0]}};var sn=require("obsidian"),kc="zfb-rag-chatbot",af=class extends sn.ItemView{constructor(t,n,s,r){super(t);this.currentSession=null;this.messagesContainer=null;this.inputEl=null;this.isProcessing=!1;this.settings=n,this.ragEngine=s,this.chatStorage=r}getViewType(){return kc}getDisplayText(){return"AI \uCC57\uBD07"}getIcon(){return"bot"}async onOpen(){await this.chatStorage.loadSessions(),await this.ragEngine.reloadEmbeddingIndex(),await this.render()}async onClose(){this.contentEl.empty()}async render(){let t=this.contentEl;if(t.empty(),t.addClass("zfb-chatbot"),this.renderHeader(t),this.messagesContainer=t.createDiv({cls:"chat-messages"}),this.renderMessages(),this.renderInputArea(t),!this.currentSession){let n=this.chatStorage.getRecentSession();n&&(this.currentSession=n,this.renderMessages())}}renderHeader(t){let n=t.createDiv({cls:"chat-header"}),r=n.createDiv({cls:"session-selector"}).createEl("select",{cls:"session-select"}),o=r.createEl("option",{text:"+ \uC0C8 \uB300\uD654",value:"__new__"}),a=this.chatStorage.getAllSessions();for(let u of a){let p=r.createEl("option",{text:u.title,value:u.id});this.currentSession?.id===u.id&&(p.selected=!0)}r.addEventListener("change",()=>{let u=r.value;if(u==="__new__")this.handleNewSession();else{let p=this.chatStorage.getSession(u);p&&(this.currentSession=p,this.renderMessages())}});let l=n.createDiv({cls:"header-buttons"}),c=l.createEl("button",{cls:"header-btn",attr:{title:"\uB178\uD2B8\uB85C \uB0B4\uBCF4\uB0B4\uAE30"}});c.innerHTML="\u{1F4E4}",c.addEventListener("click",()=>this.handleExport());let d=l.createEl("button",{cls:"header-btn",attr:{title:"\uB300\uD654 \uC0AD\uC81C"}});d.innerHTML="\u{1F5D1}\uFE0F",d.addEventListener("click",()=>this.handleDelete())}renderMessages(){if(this.messagesContainer){if(this.messagesContainer.empty(),!this.currentSession||this.currentSession.messages.length===0){let t=this.messagesContainer.createDiv({cls:"chat-empty"});t.createEl("p",{text:"\u{1F9E0} Second Brain\uC5D0 \uC9C8\uBB38\uD558\uC138\uC694"}),t.createEl("small",{text:"\uB178\uD2B8\uB97C \uAE30\uBC18\uC73C\uB85C \uB2F5\uBCC0\uD569\uB2C8\uB2E4",cls:"text-muted"});let n=this.ragEngine.getIndexedNoteCount();n===0?t.createEl("p",{text:"\u26A0\uFE0F Embedding \uC778\uB371\uC2A4\uAC00 \uBE44\uC5B4 \uC788\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C \uC778\uB371\uC2A4\uB97C \uAD6C\uCD95\uD558\uC138\uC694.",cls:"warning-text"}):t.createEl("small",{text:`\u{1F4DA} ${n}\uAC1C \uB178\uD2B8 \uC778\uB371\uC2F1\uB428`,cls:"text-muted"});return}for(let t of this.currentSession.messages)this.renderMessage(t);this.scrollToBottom()}}renderMessage(t){if(!this.messagesContainer)return;let n=this.messagesContainer.createDiv({cls:`chat-message ${t.role}`}),r=n.createDiv({cls:"message-header"}).createEl("button",{cls:"message-copy-btn",attr:{title:"\uBCF5\uC0AC"}});r.innerHTML="\u{1F4CB}",r.addEventListener("click",async()=>{await navigator.clipboard.writeText(t.content),new sn.Notice("\uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4")});let o=n.createDiv({cls:"message-content"}),a=this.processLinks(t.content);if(sn.MarkdownRenderer.renderMarkdown(a,o,"",this),o.querySelectorAll("a.internal-link").forEach(l=>{l.addEventListener("click",c=>{c.preventDefault();let d=l.getAttribute("href")||l.getAttribute("data-href");d&&this.app.workspace.openLinkText(d,"")})}),t.role==="assistant"&&t.references&&t.references.length>0){let l=n.createDiv({cls:"message-refs"});l.createEl("small",{text:"\u{1F4DA} \uCC38\uC870: "});for(let c=0;c<t.references.length;c++){let d=t.references[c],u=d.split("/").pop()?.replace(/\.md$/,"")||d;l.createEl("a",{text:u,cls:"internal-link",attr:{href:d}}).addEventListener("click",m=>{m.preventDefault(),this.app.workspace.openLinkText(d,"")}),c<t.references.length-1&&l.createSpan({text:", "})}}}processLinks(t){return t}renderInputArea(t){let n=t.createDiv({cls:"chat-input-area"});this.inputEl=n.createEl("textarea",{cls:"chat-input",attr:{placeholder:"\uC9C8\uBB38\uC744 \uC785\uB825\uD558\uC138\uC694...",rows:"1"}}),this.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),this.handleSend())}),this.inputEl.addEventListener("input",()=>{this.inputEl&&(this.inputEl.style.height="auto",this.inputEl.style.height=Math.min(this.inputEl.scrollHeight,120)+"px")}),n.createEl("button",{cls:"chat-send-btn",text:"\uC804\uC1A1"}).addEventListener("click",()=>this.handleSend())}async handleSend(){if(!this.inputEl||this.isProcessing)return;let t=this.inputEl.value.trim();if(t){this.currentSession||(this.currentSession=this.chatStorage.createSession()),this.inputEl.value="",this.inputEl.style.height="auto",this.chatStorage.addMessage(this.currentSession.id,{role:"user",content:t}),this.renderMessages(),this.isProcessing=!0,this.showLoading();try{let n=this.currentSession.messages.slice(0,-1),{answer:s,references:r}=await this.ragEngine.chat(t,n);this.chatStorage.addMessage(this.currentSession.id,{role:"assistant",content:s,references:r}),this.currentSession=this.chatStorage.getSession(this.currentSession.id)||null}catch(n){console.error("RAG \uC624\uB958:",n),new sn.Notice("\uB2F5\uBCC0 \uC0DD\uC131 \uC2E4\uD328: "+n.message)}finally{this.isProcessing=!1,this.hideLoading(),this.renderMessages()}}}handleNewSession(){this.currentSession=this.chatStorage.createSession(),this.render()}async handleExport(){if(!this.currentSession){new sn.Notice("\uB0B4\uBCF4\uB0BC \uB300\uD654\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=await this.chatStorage.exportToNote(this.currentSession.id);t?(new sn.Notice(`\uB178\uD2B8\uB85C \uB0B4\uBCF4\uB0B4\uAE30 \uC644\uB8CC: ${t.path}`),this.app.workspace.openLinkText(t.path,"")):new sn.Notice("\uB0B4\uBCF4\uB0B4\uAE30 \uC2E4\uD328")}handleDelete(){if(!this.currentSession)return;let t=this.currentSession.id,n=this.currentSession.title;new IA(this.app,n,()=>{this.chatStorage.deleteSession(t),this.currentSession=null,this.render(),new sn.Notice("\uB300\uD654\uAC00 \uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4")}).open()}showLoading(){if(!this.messagesContainer)return;let t=this.messagesContainer.createDiv({cls:"chat-message assistant loading"});t.createDiv({cls:"loading-dots"}).innerHTML="\u23F3 \uC0DD\uAC01 \uC911..."}hideLoading(){if(!this.messagesContainer)return;let t=this.messagesContainer.querySelector(".loading");t&&t.remove()}scrollToBottom(){this.messagesContainer&&(this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight)}updateSettings(t){this.settings=t}},IA=class extends sn.Modal{constructor(e,t,n){super(e),this.title=t,this.onConfirm=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("zfb-confirm-modal"),e.createEl("h3",{text:"\uB300\uD654 \uC0AD\uC81C"}),e.createEl("p",{text:`"${this.title}" \uB300\uD654\uB97C \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?`});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"\uC0AD\uC81C",cls:"mod-warning"}).addEventListener("click",()=>{this.onConfirm(),this.close()})}onClose(){this.contentEl.empty()}};var Nc=require("obsidian");function _D(i,e=100){return i.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,e)}var hv=class{constructor(e,t,n,s){this.projectMOCs=new Map;this.app=e,this.gemini=t,this.projectsFolder=n,this.settings=s}async scanProjectMOCs(){this.projectMOCs.clear();let e=this.app.vault.getMarkdownFiles();for(let t of e){let n=await this.parseProjectMOC(t);n&&this.projectMOCs.set(n.project,n)}console.log(`\uD504\uB85C\uC81D\uD2B8 MOC \uC2A4\uCE94 \uC644\uB8CC: ${this.projectMOCs.size}\uAC1C`)}async parseProjectMOC(e){let n=this.app.metadataCache.getFileCache(e)?.frontmatter;if(!n||n.type!=="project-moc")return null;let s=n.project||e.basename,r=n.title||e.basename;return{path:e.path,title:r,project:s}}getProjectList(){let e=this.app.vault.getAbstractFileByPath(this.projectsFolder);return e instanceof Nc.TFolder?e.children.filter(t=>t instanceof Nc.TFolder).map(t=>t.name):[]}getMOCCount(){return this.projectMOCs.size}async detectProject(e,t){let n=this.getProjectList();return n.length===0?null:await this.gemini.detectProject(e,t,n)}async addNoteToMOC(e,t,n){let s=this.projectMOCs.get(e);if(!s)return!1;let r=this.app.vault.getAbstractFileByPath(s.path);if(!(r instanceof Nc.TFile))return!1;let o=await this.app.vault.read(r),a=this.app.vault.getAbstractFileByPath(n),c=`[[${a instanceof Nc.TFile?a.basename:_D(t)}]]`;if(o.includes(c))return!0;let d=/^##  \s*$/m,u;return d.test(o)?u=o.replace(/^(##  \s*\n)/m,`$1- ${c}
`):u=o.trimEnd()+`

## \uAD00\uB828 \uB178\uD2B8
- ${c}
`,await this.app.vault.modify(r,u),!0}async createProjectMOC(e,t){this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);let s=_D(e),r=`${t}/${s} MOC.md`;if(this.app.vault.getAbstractFileByPath(r))return null;let a=`---
type: project-moc
project: "${e}"
title: "${e} \uD504\uB85C\uC81D\uD2B8"
created: ${Pe(this.settings.timezone,this.settings.dateFormat)}
---

# ${e} \uD504\uB85C\uC81D\uD2B8

## \uAC1C\uC694


## \uC9C4\uD589 \uC911


## \uAD00\uB828 \uB178\uD2B8

`,l=await this.app.vault.create(r,a);return this.projectMOCs.set(e,{path:l.path,title:`${e} \uD504\uB85C\uC81D\uD2B8`,project:e}),l}hasProject(e){return this.projectMOCs.has(e)}getProjectMOCPath(e){return this.projectMOCs.get(e)?.path||null}removeFromIndex(e){for(let[t,n]of this.projectMOCs)if(n.path===e){this.projectMOCs.delete(t);break}}};var MA=require("obsidian");var fv=class{constructor(e,t,n,s,r){this.app=e,this.relatedNoteFinder=t,this.zettelFolder=n,this.settings=s,this.gemini=r||null}get indexPath(){return`${this.zettelFolder}/ZK Index.md`}async updateIndex(e,t){let n=this.app.vault.getAbstractFileByPath(this.indexPath);n instanceof MA.TFile?await this.addNoteToIndex(n,e,t):await this.createIndex(e,t)}async createIndex(e,t){let n=Pe(this.settings.timezone,this.settings.dateFormat),s=t[0]||"\uAE30\uD0C0",r=`---
type: zk-index
updated: ${n}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
- [[${e.basename}]]

## \uC8FC\uC81C\uBCC4
### ${s}
- [[${e.basename}]]
`;await this.app.vault.create(this.indexPath,r)}async addNoteToIndex(e,t,n){let s=await this.app.vault.read(e);s=this.updateRecentSection(s,t);let r=n[0]||"\uAE30\uD0C0";s=this.updateTopicSection(s,t,r),s=this.updateTimestamp(s),await this.app.vault.modify(e,s)}updateRecentSection(e,t){let n=/(##  \n)([\s\S]*?)(\n## |\n*$)/,s=e.match(n);if(s){let r=s[2].trim().split(`
`).filter(a=>a.startsWith("- ")),o=`- [[${t.basename}]]`;return r=r.filter(a=>!a.includes(t.basename)),r.unshift(o),r=r.slice(0,10),e.replace(n,`$1${r.join(`
`)}

$3`)}return e}updateTopicSection(e,t,n){let s=`### ${n}`,r=`- [[${t.basename}]]`;if(e.includes(s)){let o=new RegExp(`(### ${this.escapeRegex(n)}
)((?:- \\[\\[.*?\\]\\]
?)*)`),a=e.match(o);if(a)return a[2].includes(t.basename)?e:e.replace(o,`$1$2${r}
`)}else{let o=/(## \n)/;if(o.test(e))return e.replace(o,`$1${s}
${r}

`)}return e}updateTimestamp(e){let t=Pe(this.settings.timezone,this.settings.dateFormat);return e.replace(/^(---\n[\s\S]*?updated: ).*?(\n[\s\S]*?---)/,`$1${t}$2`)}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}async rebuildIndex(){let e=this.relatedNoteFinder.getZettelIndex();if(e.size===0)return;let t=new Map,n=[];for(let[,a]of e){let l=a.keywords[0]||"\uAE30\uD0C0";t.has(l)||t.set(l,[]),t.get(l).push(a);let c=a.path.match(/(\d{13})/),d=a.path.match(/(\d{8})-\d{3}/),u;if(c)u=new Date(parseInt(c[1]));else if(d){let p=d[1];u=new Date(parseInt(p.slice(0,4)),parseInt(p.slice(4,6))-1,parseInt(p.slice(6,8)))}else u=new Date;n.push({note:a,created:u})}n.sort((a,l)=>l.created.getTime()-a.created.getTime());let r=`---
type: zk-index
updated: ${Pe(this.settings.timezone,this.settings.dateFormat)}
---

# Zettelkasten Index

## \uCD5C\uADFC \uCD94\uAC00
${n.slice(0,10).map(({note:a})=>{let l=a.path.split("/");return`- [[${l[l.length-1].replace(/\.md$/,"")}]]`}).join(`
`)}

## \uC8FC\uC81C\uBCC4
`;for(let[a,l]of t){let c=null;if(this.gemini&&l.length>=2)try{let d=l.map(u=>`- ${u.title} (\uD0A4\uC6CC\uB4DC: ${u.keywords.join(", ")})`).join(`
`);c=await this.gemini.generateTopicStructure(a,d)}catch(d){console.error(`\uC8FC\uC81C \uAD6C\uC870 \uC0DD\uC131 \uC2E4\uD328: ${a}`,d)}r+=`### ${a}
`,c?.description&&(r+=`${c.description}

`),r+=`**\uD575\uC2EC \uB178\uD2B8:**
`;for(let d of l){let u=d.path.split("/"),p=u[u.length-1].replace(/\.md$/,""),m=c?.notes.find(v=>v.title===d.title),y=m?.role?` - ${m.role}`:"";if(r+=`- [[${p}]]${y}
`,m?.relations&&m.relations.length>0)for(let v of m.relations){let b=v.type==="\uBC1C\uC804"?"\u2192":v.type==="\uAE30\uBC18"?"\u2190":"\u2194";r+=`  ${b} ${v.target}
`}}c?.relatedTopics&&c.relatedTopics.length>0&&(r+=`
**\uAD00\uB828 \uC8FC\uC81C:** ${c.relatedTopics.join(", ")}
`),r+=`
`}let o=this.app.vault.getAbstractFileByPath(this.indexPath);o instanceof MA.TFile&&await this.app.vault.delete(o),await this.app.vault.create(this.indexPath,r)}};var Fc=require("obsidian");var pv=class{constructor(e,t,n){this.app=e,this.gemini=t,this.settings=n}async collectNotes(e){let t=e.customRange||rd(e.period,this.settings.timezone),n=this.app.vault.getMarkdownFiles(),s=[];for(let r of n){if(this.shouldExclude(r,e))continue;let o=this.getProjectFromPath(r.path);if(e.projectFilter&&o!==e.projectFilter)continue;let a=await this.getNoteDate(r);if(!s_(a,t))continue;let l=await this.extractNoteInfo(r,o,a);s.push(l)}return s.sort((r,o)=>o.modified.getTime()-r.modified.getTime()),s}getBasename(e){let t=e.lastIndexOf("/");return(t>=0?e.substring(t+1):e).replace(/\.md$/,"")}shouldExclude(e,t){let n=[this.settings.archivesFolder,this.settings.zettelFolder],s=t.excludeFolders||n;for(let r of s)if(e.path.startsWith(r))return!0;return!!e.basename.includes("\uD68C\uACE0")}getProjectFromPath(e){let t=this.settings.projectsFolder+"/";if(e.startsWith(t)){let n=e.substring(t.length),s=n.indexOf("/");return s>0?n.substring(0,s):void 0}if(e.startsWith(this.settings.libraryFolder))return"Library";if(e.startsWith(this.settings.inboxFolder))return"Inbox"}async getNoteDate(e){let n=this.app.metadataCache.getFileCache(e)?.frontmatter;if(n?.created){let s=new Date(n.created);if(!isNaN(s.getTime()))return s}return new Date(e.stat.mtime)}async extractNoteInfo(e,t,n){let r=this.app.metadataCache.getFileCache(e)?.frontmatter,o=[];return r?.tags&&(Array.isArray(r.tags)?o.push(...r.tags):o.push(r.tags)),{path:e.path,title:r?.title||e.basename,project:t,created:n,modified:new Date(e.stat.mtime),summary:r?.summary,tags:o,type:r?.type}}groupByProject(e){let t=new Map;for(let s of e){let r=s.project||"\uAE30\uD0C0";t.has(r)||t.set(r,[]),t.get(r).push(s)}let n=[];for(let[s,r]of t)n.push({projectName:s,notes:r,noteCount:r.length});return n.sort((s,r)=>r.noteCount-s.noteCount),n}async analyze(e){let t=e.customRange||rd(e.period,this.settings.timezone),n=await this.collectNotes(e),s=this.groupByProject(n),r=n.filter(a=>a.type==="zettel").length,o=await this.gemini.analyzeReview(e.period,t,s);return{period:e.period,dateRange:t,totalNotes:n.length,newZKNotes:r,projectGroups:s,analysis:o}}async createReviewNote(e){let t=r_(e.period,new Date,this.settings.timezone),n=`${this.settings.archivesFolder}/Reviews`;await this.ensureFolder(n);let s=`${n}/${t}`,r=this.generateReviewContent(e),o=this.app.vault.getAbstractFileByPath(s);return o instanceof Fc.TFile?(await this.app.vault.modify(o,r),o):await this.app.vault.create(s,r)}async ensureFolder(e){this.app.vault.getAbstractFileByPath(e)instanceof Fc.TFolder||await this.app.vault.createFolder(e)}generateReviewContent(e){let t=new Date,n=Vb(t,this.settings.timezone,this.settings.dateFormat),s=`${Be(e.dateRange.start,this.settings.timezone)} ~ ${Be(e.dateRange.end,this.settings.timezone)}`,r;switch(e.period){case"today":r=`${Be(t,this.settings.timezone)} \uC77C\uC77C \uD68C\uACE0`;break;case"week":let l=Wb(t);r=`${t.getFullYear()}\uB144 ${l}\uC8FC\uCC28 \uC8FC\uAC04 \uD68C\uACE0`;break;case"month":r=`${t.getFullYear()}\uB144 ${t.getMonth()+1}\uC6D4 \uC6D4\uAC04 \uD68C\uACE0`;break;default:r=`${s} \uD68C\uACE0`}let o=e.projectGroups.map(l=>{let c=l.notes.map(d=>`- [[${this.getBasename(d.path)}]]${d.summary?` - ${d.summary}`:""}`).join(`
`);return`### ${l.projectName} (${l.noteCount}\uAC1C)
${c}`}).join(`

`),a="";if(e.analysis){let{summary:l,mainTopics:c,insights:d,nextActions:u,patterns:p}=e.analysis;a=`
## \uBD84\uC11D \uACB0\uACFC

### \uC694\uC57D
${l}

### \uC8FC\uC694 \uC8FC\uC81C
${c.map(m=>`- ${m}`).join(`
`)}

### \uC778\uC0AC\uC774\uD2B8
${d.map(m=>`- ${m}`).join(`
`)}

### \uB2E4\uC74C \uC561\uC158
${u.map(m=>`- [ ] ${m}`).join(`
`)}
${p?`
### \uC791\uC5C5 \uD328\uD134
${p}`:""}`}return`---
type: review
period: ${e.period}
date_range: ${s}
created: ${n}
tags: [review, ${e.period==="today"?"daily":e.period==="week"?"weekly":"monthly"}]
---

# ${r}

## \uD1B5\uACC4
- \uC791\uC5C5\uD55C \uB178\uD2B8: ${e.totalNotes}\uAC1C
- \uC0C8 ZK \uB178\uD2B8: ${e.newZKNotes}\uAC1C
- \uD65C\uC131 \uD504\uB85C\uC81D\uD2B8: ${e.projectGroups.filter(l=>l.projectName!=="\uAE30\uD0C0"&&l.projectName!=="Library"&&l.projectName!=="Inbox").length}\uAC1C

## \uD504\uB85C\uC81D\uD2B8\uBCC4 \uC791\uC5C5

${o}
${a}
`}getProjectList(){let e=new Set,t=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(t instanceof Fc.TFolder)for(let n of t.children)n instanceof Fc.TFolder&&e.add(n.name);return Array.from(e).sort()}};var PA=["mp3","wav","m4a","aac","ogg","flac","webm"],eB=2*1024*1024*1024,gv=class{constructor(e,t,n){this.app=e,this.gemini=t,this.settings=n}isAudioFile(e){return PA.includes(e.extension.toLowerCase())}getMimeType(e){return{mp3:"audio/mp3",wav:"audio/wav",m4a:"audio/m4a",aac:"audio/aac",ogg:"audio/ogg",flac:"audio/flac",webm:"audio/webm"}[e.toLowerCase()]||"audio/mp3"}async fileToBlob(e,t){let n=await this.app.vault.readBinary(e);return new Blob([n],{type:t})}async processAudio(e){if(e.stat.size>eB)throw new Error("\uD30C\uC77C \uD06C\uAE30\uAC00 2GB\uB97C \uCD08\uACFC\uD569\uB2C8\uB2E4");let t=e.extension.toLowerCase(),n=this.getMimeType(t),s=await this.fileToBlob(e,n);return await this.gemini.analyzeMeeting(s,n,e.name)}generateMarkdownNote(e){let t=Pe(this.settings.timezone,this.settings.dateFormat),n=e.actionItems.length>0?e.actionItems.map(o=>{let a=`- [ ] ${o.task}`;return o.assignee&&(a+=` - @${o.assignee}`),o.deadline&&(a+=` (\uAE30\uD55C: ${o.deadline})`),a}).join(`
`):"- (\uC5C6\uC74C)",s=e.decisions.length>0?e.decisions.map(o=>`- ${o}`).join(`
`):"- (\uC5C6\uC74C)",r=e.nextAgenda.length>0?e.nextAgenda.map(o=>`- ${o}`).join(`
`):"- (\uC5C6\uC74C)";return`---
type: meeting
source_file: "${e.sourceFile}"
title: "${e.title.replace(/"/g,'\\"')}"
created: ${t}
---

# ${e.title}

## \uC694\uC57D
${e.summary}

## \uC561\uC158 \uC544\uC774\uD15C
${n}

## \uACB0\uC815\uC0AC\uD56D
${s}

## \uB2E4\uC74C \uD68C\uC758 \uC548\uAC74
${r}

---

<details>
<summary>\uC804\uCCB4 \uB179\uCDE8\uB85D</summary>

${e.transcription}

</details>

---
## \uC6D0\uBCF8 \uD30C\uC77C
![[${e.sourceFile}]]
`}};var yv=require("obsidian");var mv=class{constructor(e,t){this.app=e,this.settings=t}async saveToDaily(e){let t=new Map;for(let s of e)t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s);let n=0;for(let[s,r]of t)await this.appendToDaily(s,r),n+=r.length;return n}async appendToDaily(e,t){let n=this.settings.dailyNotesFolder,s=`${n}/${e}.md`;await this.ensureFolder(n);let r=t.map(a=>this.formatTask(a)).join(`
`),o=this.app.vault.getAbstractFileByPath(s);if(o instanceof yv.TFile){let a=await this.app.vault.read(o),l=this.appendSchedulesToContent(a,r);await this.app.vault.modify(o,l)}else{let a=this.createDailyNoteContent(e,r);await this.app.vault.create(s,a)}}formatTask(e){let t=e.time?`${e.time} `:"",n=e.type==="event"?"\u{1F4C5}":"\u{1F4CB}",s=e.sourceNote?` (from [[${e.sourceNote}]])`:"";return`- [ ] ${t}${e.title} ${n} ${e.date}${s}`}appendSchedulesToContent(e,t){let n="## \uC77C\uC815";if(e.includes(n)){let r=e.indexOf(n),o=e.indexOf(`
## `,r+1);return o>0?e.substring(0,o)+t+`

`+e.substring(o):e+`
`+t}let s=e.indexOf("---",3);if(s>0){let r=e.indexOf(`
`,s)+1;return e.substring(0,r)+`
## \uC77C\uC815
`+t+`
`+e.substring(r)}return`## \uC77C\uC815
`+t+`

`+e}createDailyNoteContent(e,t){return`---
type: daily
date: ${e}
created: ${Qn(this.settings.timezone)}
---

# ${e}

## \uC77C\uC815
${t}

## \uBA54\uBAA8

`}async ensureFolder(e){if(!(this.app.vault.getAbstractFileByPath(e)instanceof yv.TFolder))try{await this.app.vault.createFolder(e)}catch{}}getToday(){return Qn(this.settings.timezone)}};jn();function mr(i){return i.replace(/\$/g,"$$$$")}function vv(i,e,t){let n=i?.trim()?i:t;if(!n)return console.warn("\uD15C\uD50C\uB9BF\uC774 \uBE44\uC5B4\uC788\uC2B5\uB2C8\uB2E4. \uAE30\uBCF8 \uD615\uC2DD\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4."),`# ${e.title}

${e.summary}

${e.keyPoints.map(a=>`- ${a}`).join(`
`)}`;let s=e.keyPoints.map(a=>`- ${a}`).join(`
`),r=e.title.replace(/"/g,'\\"'),o=n;return o=o.replace(/\{\{title\}\}/g,mr(e.title)),o=o.replace(/\{\{escapedTitle\}\}/g,mr(r)),o=o.replace(/\{\{url\}\}/g,mr(e.url)),o=o.replace(/\{\{summary\}\}/g,mr(e.summary)),o=o.replace(/\{\{keyPoints\}\}/g,mr(s)),o=o.replace(/\{\{date\}\}/g,mr(e.date)),o=o.replace(/\{\{iframe\}\}/g,mr(e.iframe||"")),o=o.replace(/\{\{bookmark\}\}/g,mr(e.bookmark||"")),o}function xD(i){return`<div style="resize: both; overflow: hidden; width: 100%; height: 400px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${`https://www.youtube.com/embed/${i}`}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none;" allowfullscreen></iframe>
</div>`}function RD(i){let e=i;return i.includes("blog.naver.com")&&!i.includes("m.blog.naver.com")&&(e=i.replace("blog.naver.com","m.blog.naver.com")),`<div style="resize: both; overflow: hidden; width: 100%; height: 600px; border: 1px solid var(--background-modifier-border); border-radius: 4px;">
<iframe src="${e}" style="width: 133%; height: 133%; transform: scale(0.75); transform-origin: 0 0; border: none; color-scheme: light;"></iframe>
</div>`}function DD(i,e,t){if(t){let n=t.image?`
> ![](${t.image})
>`:"",s=t.description?`
> ${t.description}
>`:"";return`> [!bookmark] ${t.siteName||new URL(e).hostname}
> **${i}**
>${s}${n}
> \u{1F517} ${e}`}return`> [!bookmark] \uC6F9\uD398\uC774\uC9C0
> **${i}**
>
> \u{1F517} ${e}`}var bv=class{constructor(e,t){this.gemini=e,this.settings=t}extractVideoId(e){let t=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/|youtube\.com\/shorts\/)([a-zA-Z0-9_-]{11})/,/^([a-zA-Z0-9_-]{11})$/];for(let n of t){let s=e.match(n);if(s)return s[1]}return null}isValidYouTubeUrl(e){return this.extractVideoId(e)!==null}async processVideo(e){let t=this.extractVideoId(e);if(!t)throw new Error("\uC720\uD6A8\uD55C YouTube URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let n=`https://www.youtube.com/watch?v=${t}`;console.log("Gemini \uB124\uC774\uD2F0\uBE0C YouTube \uBD84\uC11D \uC2DC\uC791:",n);let s=await this.gemini.analyzeYouTube(n);return{videoId:t,url:n,title:s.title,summary:s.summary,keyPoints:s.keyPoints}}generateMarkdownNote(e){let t=Pe(this.settings.timezone,this.settings.dateFormat),n={title:e.title,url:e.url,summary:e.summary,keyPoints:e.keyPoints,date:t,iframe:xD(e.videoId)};return vv(this.settings.youtubeTemplate,n,Nr.youtubeTemplate)}};var lf=require("obsidian");jn();var Ev=class{constructor(e,t){this.gemini=e,this.settings=t}isValidUrl(e){try{let t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}}extractMetadata(e,t){let n=l=>{let c=[new RegExp(`<meta[^>]*property=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*property=["']${l}["']`,"i"),new RegExp(`<meta[^>]*name=["']${l}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*name=["']${l}["']`,"i")];for(let d of c){let u=e.match(d);if(u)return u[1]}return""},s=e.match(/<title[^>]*>([^<]+)<\/title>/i),r=e.match(/<link[^>]*rel=["'](?:shortcut )?icon["'][^>]*href=["']([^"']+)["']/i),o=new URL(t),a=l=>l?l.startsWith("http")?l:l.startsWith("//")?o.protocol+l:l.startsWith("/")?o.origin+l:o.origin+"/"+l:"";return{title:n("og:title")||n("twitter:title")||s?.[1]||"",description:n("og:description")||n("twitter:description")||n("description")||"",image:a(n("og:image")||n("twitter:image")||""),siteName:n("og:site_name")||o.hostname,favicon:a(r?.[1]||"/favicon.ico")}}extractContent(e){let t=e.match(/<title[^>]*>([^<]+)<\/title>/i),s=e.match(/<meta[^>]*property=["']og:title["'][^>]*content=["']([^"']+)["']/i)?.[1]||t?.[1]||"Untitled",r=e.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<nav[^>]*>[\s\S]*?<\/nav>/gi,"").replace(/<header[^>]*>[\s\S]*?<\/header>/gi,"").replace(/<footer[^>]*>[\s\S]*?<\/footer>/gi,"").replace(/<aside[^>]*>[\s\S]*?<\/aside>/gi,""),o="",a=r.match(/<article[^>]*>([\s\S]*?)<\/article>/i),l=r.match(/<main[^>]*>([\s\S]*?)<\/main>/i),c=r.match(/<div[^>]*(?:class|id)=["'][^"']*content[^"']*["'][^>]*>([\s\S]*?)<\/div>/i);return a?o=a[1]:l?o=l[1]:c?o=c[1]:o=r.match(/<body[^>]*>([\s\S]*?)<\/body>/i)?.[1]||r,o=o.replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&[a-z]+;/gi," ").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim(),{title:s.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim(),content:o}}async fetchWithJinaReader(e){let t=`https://r.jina.ai/${e}`,s=(await(0,lf.requestUrl)({url:t,method:"GET",headers:{Accept:"text/plain","X-Timeout":"30","X-Wait-For-Selector":"article, .post-content, .se-main-container, #postViewArea"}})).text;s.includes("Warning: This page maybe not yet fully loaded")&&console.log("Jina Reader: \uD398\uC774\uC9C0 \uB85C\uB529 \uACBD\uACE0 \uAC10\uC9C0");let r=s.split(`
`),o="Untitled",a=0;for(r[0]?.startsWith("# ")?(o=r[0].substring(2).trim(),a=1):r[0]?.startsWith("Title: ")&&(o=r[0].substring(7).trim(),a=1);a<r.length;){let c=r[a];if(c?.startsWith("URL Source:")||c?.startsWith("http")||c?.startsWith("Warning:")||c?.startsWith("Markdown Content:")||c?.trim()==="")a++;else break}let l=r.slice(a).join(`
`).trim();if(l.length<100&&!l.includes(`
`))throw new Error("\uD398\uC774\uC9C0 \uCF58\uD150\uCE20\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4 (JavaScript \uB85C\uB529 \uB300\uAE30 \uC2E4\uD328)");return{title:o,content:l}}async fetchNaverBlog(e){let t=e;if(e.includes("blog.naver.com")){let u=e.match(/blog\.naver\.com\/([^\/]+)\/(\d+)/);u&&(t=`https://m.blog.naver.com/${u[1]}/${u[2]}`)}let s=(await(0,lf.requestUrl)({url:t,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15",Accept:"text/html,application/xhtml+xml","Accept-Language":"ko-KR,ko;q=0.9"}})).text,o=s.match(/<title[^>]*>([^<]+)<\/title>/i)?.[1]?.replace(/ :  $/,"").trim()||"Untitled",a="",l=s.match(/<div[^>]*class="[^"]*se-main-container[^"]*"[^>]*>([\s\S]*?)<\/div>\s*<\/div>\s*<\/div>/i),c=s.match(/<div[^>]*id="postViewArea"[^>]*>([\s\S]*?)<\/div>/i),d=l?.[1]||c?.[1]||"";return d&&(a=d.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<\/?(p|div|br|h[1-6]|li|tr)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/\n{3,}/g,`

`).replace(/[ \t]+/g," ").trim()),{title:o,content:a}}async processUrl(e){if(!this.isValidUrl(e))throw new Error("\uC720\uD6A8\uD55C URL\uC774 \uC544\uB2D9\uB2C8\uB2E4");let t;try{let r=(await(0,lf.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text;t=this.extractMetadata(r,e)}catch(s){console.log("\uBA54\uD0C0\uB370\uC774\uD130 \uCD94\uCD9C \uC2E4\uD328:",s)}if(e.includes("blog.naver.com"))return console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, Jina Reader \uC0AC\uC6A9"),await this.processUrlFallback(e,t);try{console.log("URL Context Tool\uB85C \uC6F9\uD398\uC774\uC9C0 \uBD84\uC11D \uC2DC\uB3C4");let s=await this.gemini.analyzeWebpage(e),r=["unable to access","cannot access","could not access","\uC811\uADFC\uD560 \uC218 \uC5C6","\uAC00\uC838\uC62C \uC218 \uC5C6"],o=s.summary.toLowerCase();return r.some(l=>o.includes(l.toLowerCase()))?(console.log("URL Context Tool \uC811\uADFC \uC2E4\uD328 \uAC10\uC9C0, \uD3F4\uBC31 \uC2DC\uB3C4"),await this.processUrlFallback(e,t)):(t&&(t.title=t.title||s.title),{url:e,title:s.title,content:"",summary:s.summary,keyPoints:s.keyPoints,metadata:t})}catch(s){console.log("URL Context Tool \uC2E4\uD328, \uD3F4\uBC31 \uC2DC\uB3C4:",s)}return await this.processUrlFallback(e,t)}async processUrlFallback(e,t){let n,s,r=null;if(!t)try{r=(await(0,lf.requestUrl)({url:e,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7"}})).text,t=this.extractMetadata(r,e)}catch(d){console.log("HTML \uAC00\uC838\uC624\uAE30 \uC2E4\uD328:",d)}if(e.includes("blog.naver.com")){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uAC10\uC9C0, \uC804\uC6A9 \uCD94\uCD9C \uC2DC\uB3C4");try{let d=await this.fetchNaverBlog(e);if(n=d.title,s=d.content,s.length<100)throw new Error("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uCD94\uCD9C \uC2E4\uD328")}catch(d){console.log("\uB124\uC774\uBC84 \uBE14\uB85C\uADF8 \uC804\uC6A9 \uCD94\uCD9C \uC2E4\uD328, Jina Reader \uC2DC\uB3C4:",d);let u=await this.fetchWithJinaReader(e);n=u.title,s=u.content}}else try{console.log("Jina Reader\uB85C \uCF58\uD150\uCE20 \uCD94\uCD9C \uC2DC\uB3C4");let d=await this.fetchWithJinaReader(e);n=d.title,s=d.content}catch(d){if(console.log("Jina Reader \uC2E4\uD328, \uC9C1\uC811 \uCD94\uCD9C\uB85C \uD3F4\uBC31:",d),r){let u=this.extractContent(r);n=u.title,s=u.content}else throw new Error("\uC6F9\uD398\uC774\uC9C0\uB97C \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4")}if(s.length<50)throw new Error("\uBCF8\uBB38\uC744 \uCD94\uCD9C\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC811\uADFC\uC774 \uC81C\uD55C\uB41C \uD398\uC774\uC9C0\uC77C \uC218 \uC788\uC2B5\uB2C8\uB2E4.");let a=5e4,l=s.length>a?s.slice(0,a)+"...":s,c=await this.gemini.summarizeContent(l,"webpage");return t&&(t.title=t.title||n),{url:e,title:c.title||n,content:l,summary:c.summary,keyPoints:c.keyPoints,metadata:t}}generateMarkdownNote(e){let t=Pe(this.settings.timezone,this.settings.dateFormat),n=e.metadata,s=DD(e.title,e.url,{siteName:n?.siteName,description:n?.description,image:n?.image}),r={title:e.title,url:e.url,summary:e.summary,keyPoints:e.keyPoints,date:t,iframe:RD(e.url),bookmark:s};return vv(this.settings.webpageTemplate,r,Nr.webpageTemplate)}};var ys=require("obsidian"),tB="YOUR_CLIENT_ID.apps.googleusercontent.com",nB="YOUR_CLIENT_SECRET",ID="http://127.0.0.1:42813/callback",iB="https://accounts.google.com/o/oauth2/v2/auth",MD="https://oauth2.googleapis.com/token",sB="https://www.googleapis.com/calendar/v3",rB="https://www.googleapis.com/auth/calendar.events",cf=class{constructor(e,t,n){this.authServer=null;this.app=e,this.settings=t,this.saveSettings=n}isConnected(){return!!this.settings.googleRefreshToken}getClientId(){return this.settings.useOwnApiKey?this.settings.googleClientId:tB}getClientSecret(){return this.settings.useOwnApiKey?this.settings.googleClientSecret:nB}async startOAuth(){let e=this.getClientId();if(!e||e==="YOUR_CLIENT_ID.apps.googleusercontent.com"){new ys.Notice(`Google Calendar Client ID\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.
\uC124\uC815\uC5D0\uC11C Advanced \uBAA8\uB4DC\uB85C \uC9C1\uC811 Client ID\uB97C \uC785\uB825\uD558\uAC70\uB098,
\uD50C\uB7EC\uADF8\uC778 \uC5C5\uB370\uC774\uD2B8\uB97C \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.`,1e4);return}let t=new URLSearchParams({client_id:e,redirect_uri:ID,response_type:"code",scope:rB,access_type:"offline",prompt:"consent"}),n=`${iB}?${t.toString()}`;try{let s=await this.startAuthServer();await this.exchangeCodeForTokens(s),new ys.Notice("Google Calendar \uC5F0\uACB0 \uC644\uB8CC!")}catch(s){console.error("OAuth \uC5D0\uB7EC:",s),new ys.Notice("Google Calendar \uC5F0\uACB0 \uC2E4\uD328: "+s.message)}window.open(n,"_blank")}startAuthServer(){return new Promise((e,t)=>{let n=require("http"),s=setTimeout(()=>{this.stopAuthServer(),t(new Error("\uC778\uC99D \uC2DC\uAC04 \uCD08\uACFC (5\uBD84)"))},5*60*1e3);this.authServer=n.createServer((r,o)=>{let a=new URL(r.url||"","http://127.0.0.1:42813");if(a.pathname==="/callback"){let l=a.searchParams.get("code"),c=a.searchParams.get("error");if(c){o.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),o.end(`
							<html><body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
								<h1>\uC5F0\uACB0 \uC2E4\uD328</h1>
								<p>Google Calendar \uC5F0\uACB0\uC774 \uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p>
								<p>\uC774 \uCC3D\uC744 \uB2EB\uC544\uB3C4 \uB429\uB2C8\uB2E4.</p>
							</body></html>
						`),clearTimeout(s),this.stopAuthServer(),t(new Error(c));return}if(l){o.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),o.end(`
							<html><body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
								<h1>\uC5F0\uACB0 \uC644\uB8CC!</h1>
								<p>Google Calendar\uAC00 \uC5F0\uACB0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p>
								<p>\uC774 \uCC3D\uC744 \uB2EB\uACE0 Obsidian\uC73C\uB85C \uB3CC\uC544\uAC00\uC138\uC694.</p>
							</body></html>
						`),clearTimeout(s),this.stopAuthServer(),e(l);return}}o.writeHead(404),o.end("Not Found")}),this.authServer.listen(42813,"127.0.0.1",()=>{console.log("OAuth \uCF5C\uBC31 \uC11C\uBC84 \uC2DC\uC791: http://127.0.0.1:42813")}),this.authServer.on("error",r=>{clearTimeout(s),t(new Error(`\uC11C\uBC84 \uC2DC\uC791 \uC2E4\uD328: ${r.message}`))})})}stopAuthServer(){this.authServer&&(this.authServer.close(),this.authServer=null)}async exchangeCodeForTokens(e){let n=(await(0,ys.requestUrl)({url:MD,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:this.getClientId(),client_secret:this.getClientSecret(),code:e,grant_type:"authorization_code",redirect_uri:ID}).toString()})).json;if(n.error)throw new Error(n.error_description||n.error);this.settings.googleAccessToken=n.access_token,n.refresh_token&&(this.settings.googleRefreshToken=n.refresh_token),this.settings.googleTokenExpiry=Date.now()+n.expires_in*1e3,await this.saveSettings()}async refreshAccessToken(){if(!this.settings.googleRefreshToken)throw new Error("Refresh token\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC5F0\uACB0\uD574\uC8FC\uC138\uC694.");let t=(await(0,ys.requestUrl)({url:MD,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:this.getClientId(),client_secret:this.getClientSecret(),refresh_token:this.settings.googleRefreshToken,grant_type:"refresh_token"}).toString()})).json;if(t.error)throw t.error==="invalid_grant"?(this.settings.googleRefreshToken="",await this.saveSettings(),new Error("Google \uC5F0\uACB0\uC774 \uB9CC\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC5F0\uACB0\uD574\uC8FC\uC138\uC694.")):new Error(t.error_description||t.error);this.settings.googleAccessToken=t.access_token,this.settings.googleTokenExpiry=Date.now()+t.expires_in*1e3,await this.saveSettings()}async ensureValidToken(){Date.now()>this.settings.googleTokenExpiry-5*60*1e3&&await this.refreshAccessToken()}async createEvent(e){if(!this.isConnected())throw new Error("Google Calendar\uAC00 \uC5F0\uACB0\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");await this.ensureValidToken();let t,n;if(e.time){let o=`${e.date}T${e.time}:00`,a=this.addHour(e.time),l=`${e.date}T${a}:00`;t={dateTime:o,timeZone:this.resolveTimezone()},n={dateTime:l,timeZone:this.resolveTimezone()}}else t={date:e.date},n={date:this.getNextDay(e.date)};let s={summary:e.title,start:t,end:n},r=await(0,ys.requestUrl)({url:`${sB}/calendars/primary/events`,method:"POST",headers:{Authorization:`Bearer ${this.settings.googleAccessToken}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(r.status>=400){let o=r.json;throw new Error(o.error?.message||"\uC774\uBCA4\uD2B8 \uC0DD\uC131 \uC2E4\uD328")}}async saveSchedules(e){let t=0;for(let n of e)try{await this.createEvent(n),t++}catch(s){console.error("\uC77C\uC815 \uC800\uC7A5 \uC2E4\uD328:",n.title,s)}return t}addHour(e){let[t,n]=e.split(":").map(Number),s=(t+1)%24;return`${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}`}getNextDay(e){let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}resolveTimezone(){return this.settings.timezone==="auto"?Intl.DateTimeFormat().resolvedOptions().timeZone:this.settings.timezone}async disconnect(){this.settings.googleAccessToken="",this.settings.googleRefreshToken="",this.settings.googleTokenExpiry=0,await this.saveSettings(),new ys.Notice("Google Calendar \uC5F0\uACB0\uC774 \uD574\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}};var PD=require("obsidian"),Sv=class extends PD.Modal{constructor(t,n,s,r){super(t);this.resolvePromise=null;this.choiceMade=!1;this.schedules=n,this.settings=s,this.selected=new Set(n.map((o,a)=>a)),this.saveToDaily=!0,this.saveToGoogle=s.googleCalendarEnabled&&!!s.googleRefreshToken,this.moveToArchives=!1,this.onFeedback=r}async openAndWait(){return new Promise(t=>{this.resolvePromise=t,this.open()})}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-schedule-modal"),t.createEl("h2",{text:"\uAC10\uC9C0\uB41C \uC77C\uC815"}),t.createEl("p",{text:`${this.schedules.length}\uAC1C\uC758 \uC77C\uC815\uC774 \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uC800\uC7A5\uD560 \uC77C\uC815\uC744 \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let n=t.createDiv({cls:"schedule-list"});n.style.maxHeight="300px",n.style.overflowY="auto",n.style.marginBottom="16px",this.schedules.forEach((S,C)=>{let T=n.createDiv({cls:"schedule-item"});T.style.display="flex",T.style.alignItems="center",T.style.padding="10px 12px",T.style.marginBottom="8px",T.style.border="1px solid var(--background-modifier-border)",T.style.borderRadius="8px",T.style.gap="12px";let _=T.createEl("input",{type:"checkbox",attr:{checked:!0}});_.style.flexShrink="0",_.addEventListener("change",()=>{_.checked?this.selected.add(C):this.selected.delete(C),this.updateSaveButton()});let R=T.createDiv({cls:"schedule-info"});R.style.flex="1",R.style.minWidth="0";let I=R.createEl("div",{text:S.title});I.style.fontWeight="500",I.style.overflow="hidden",I.style.textOverflow="ellipsis",I.style.whiteSpace="nowrap";let M=R.createEl("div");M.style.fontSize="12px",M.style.color="var(--text-muted)";let k=S.type==="event"?"\uC57D\uC18D":"\uD560\uC77C",N=S.type==="event"?"\u{1F4C5}":"\u{1F4CB}",F=S.time||"\uC885\uC77C";M.setText(`${N} ${k} | ${S.date} ${F}`)});let s=t.createDiv({cls:"schedule-destinations"});s.style.padding="12px",s.style.backgroundColor="var(--background-secondary)",s.style.borderRadius="8px",s.style.marginBottom="16px",s.createEl("div",{text:"\uC800\uC7A5 \uC704\uCE58"}).style.fontWeight="500";let r=s.createDiv({cls:"destination-option"});r.style.display="flex",r.style.alignItems="center",r.style.gap="8px",r.style.marginTop="8px";let o=r.createEl("input",{type:"checkbox",attr:{checked:!0}});o.id="save-to-daily",o.addEventListener("change",()=>{this.saveToDaily=o.checked});let a=r.createEl("label",{text:`Daily Notes (${this.settings.dailyNotesFolder}/)`,attr:{for:"save-to-daily"}});a.style.cursor="pointer";let l=s.createDiv({cls:"destination-option"});l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginTop="8px";let c=l.createEl("input",{type:"checkbox",attr:{checked:this.saveToGoogle,disabled:!this.settings.googleCalendarEnabled||!this.settings.googleRefreshToken}});c.id="save-to-google",c.addEventListener("change",()=>{this.saveToGoogle=c.checked});let d=l.createEl("label",{attr:{for:"save-to-google"}});d.style.cursor="pointer",this.settings.googleCalendarEnabled&&this.settings.googleRefreshToken?d.setText("Google Calendar (\uC5F0\uACB0\uB428)"):this.settings.googleCalendarEnabled?(d.setText("Google Calendar (\uC5F0\uACB0 \uD544\uC694)"),d.style.color="var(--text-muted)"):(d.setText("Google Calendar (\uBE44\uD65C\uC131\uD654)"),d.style.color="var(--text-muted)");let u=s.createDiv({cls:"destination-option"});u.style.display="flex",u.style.alignItems="center",u.style.gap="8px",u.style.marginTop="8px";let p=u.createEl("input",{type:"checkbox",attr:{checked:!1}});p.id="move-to-archives",p.addEventListener("change",()=>{this.moveToArchives=p.checked});let m=u.createEl("label",{text:"\u{1F4E6} \uC800\uC7A5 \uD6C4 \uC6D0\uBCF8 \uB178\uD2B8 Archives\uB85C \uC774\uB3D9",attr:{for:"move-to-archives"}});m.style.cursor="pointer";let y=t.createDiv({cls:"modal-button-container"});y.style.display="flex",y.style.justifyContent="flex-end",y.style.gap="8px",y.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>{this.choiceMade=!0,this.onFeedback&&this.onFeedback({type:"schedule_detection",accepted:!1,allSchedules:this.schedules,selectedSchedules:[],rejectedSchedules:this.schedules}),this.close(),this.resolvePromise&&this.resolvePromise(null)});let b=y.createEl("button",{text:`${this.selected.size}\uAC1C \uC800\uC7A5`,cls:"mod-cta"});b.id="save-schedule-btn",b.addEventListener("click",()=>{this.choiceMade=!0;let S=this.schedules.filter((T,_)=>this.selected.has(_)),C=this.schedules.filter((T,_)=>!this.selected.has(_));this.onFeedback&&this.onFeedback({type:"schedule_detection",accepted:S.length>0,allSchedules:this.schedules,selectedSchedules:S,rejectedSchedules:C}),this.close(),this.resolvePromise&&this.resolvePromise({selectedSchedules:S,saveToDaily:this.saveToDaily,saveToGoogle:this.saveToGoogle,moveToArchives:this.moveToArchives})})}updateSaveButton(){let t=this.contentEl.querySelector("#save-schedule-btn");t&&t.setText(`${this.selected.size}\uAC1C \uC800\uC7A5`)}onClose(){this.choiceMade||(this.onFeedback&&this.onFeedback({type:"schedule_detection",accepted:!1,allSchedules:this.schedules,selectedSchedules:[],dismissed:!0}),this.resolvePromise&&this.resolvePromise(null)),this.contentEl.empty()}};var Lc=require("obsidian"),wv=class extends Lc.Modal{constructor(t,n,s,r,o=null){super(t);this.choiceMade=!1;this.activeTab="restructured";this.result=n,this.originalContent=s,this.onChoice=r,this.feedbackManager=o,this.component=new Lc.Component}getRestructureTypeLabel(t){switch(t){case"meeting":return"\u{1F4CB} \uD68C\uC758/\uBBF8\uD305";case"idea":return"\u{1F4A1} \uC544\uC774\uB514\uC5B4";case"learning":return"\u{1F4DA} \uD559\uC2B5/\uC5F0\uAD6C";case"general":return"\u{1F4DD} \uC77C\uBC18";default:return"\u{1F4DD} \uC77C\uBC18"}}recordFeedback(t){this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"content_restructure",noteTitle:this.result.title,aiSuggestion:{restructuredContent:this.result.restructuredContent,restructureType:this.result.restructureType},userChoice:{accepted:t===!0,dismissed:t===null}})}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-restructure-modal"),t.createEl("h2",{text:"\u2728 \uCF58\uD150\uCE20 \uC7AC\uAD6C\uC131 \uC81C\uC548"});let n=t.createDiv({cls:"restructure-info"});n.style.marginBottom="16px",n.style.padding="12px",n.style.backgroundColor="var(--background-secondary)",n.style.borderRadius="8px",n.createEl("p",{text:"\uC774 \uB178\uD2B8\uAC00 \uC815\uB9AC\uB418\uC9C0 \uC54A\uC740 \uAC83 \uAC19\uC544 \uC7AC\uAD6C\uC131\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4."});let s=this.getRestructureTypeLabel(this.result.restructureType);n.createEl("p",{text:`\uC720\uD615: ${s}`,cls:"restructure-type"}).style.fontWeight="bold";let r=t.createDiv({cls:"restructure-tabs"});r.style.display="flex",r.style.borderBottom="1px solid var(--background-modifier-border)",r.style.marginBottom="12px";let o=r.createEl("button",{text:"\u{1F4C4} \uC6D0\uBCF8"});o.style.flex="1",o.style.padding="8px 16px",o.style.border="none",o.style.cursor="pointer",o.style.backgroundColor="transparent";let a=r.createEl("button",{text:"\u2728 \uC7AC\uAD6C\uC131"});a.style.flex="1",a.style.padding="8px 16px",a.style.border="none",a.style.cursor="pointer",a.style.backgroundColor="transparent";let l=t.createDiv({cls:"restructure-content-area"});l.style.minHeight="200px",l.style.maxHeight="400px",l.style.overflow="auto",l.style.padding="12px",l.style.border="1px solid var(--background-modifier-border)",l.style.borderRadius="8px",l.style.backgroundColor="var(--background-primary)";let c=()=>{this.activeTab==="original"?(o.style.borderBottom="2px solid var(--interactive-accent)",o.style.color="var(--text-normal)",a.style.borderBottom="none",a.style.color="var(--text-muted)",l.empty(),l.createEl("pre",{text:this.originalContent,cls:"original-content"}).style.whiteSpace="pre-wrap"):(a.style.borderBottom="2px solid var(--interactive-accent)",a.style.color="var(--text-normal)",o.style.borderBottom="none",o.style.color="var(--text-muted)",l.empty(),this.result.restructuredContent&&Lc.MarkdownRenderer.render(this.app,this.result.restructuredContent,l,"",this.component))};o.addEventListener("click",()=>{this.activeTab="original",c()}),a.addEventListener("click",()=>{this.activeTab="restructured",c()}),c();let d=t.createDiv({cls:"modal-button-container"});d.style.marginTop="16px",d.style.display="flex",d.style.gap="8px",d.style.justifyContent="flex-end",d.createEl("button",{text:"\u{1F4C4} \uC6D0\uBCF8 \uC720\uC9C0"}).addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback(!1),this.close(),this.onChoice(!1)}),d.createEl("button",{text:"\u2728 \uC7AC\uAD6C\uC131 \uC801\uC6A9",cls:"mod-cta"}).addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback(!0),this.close(),this.onChoice(!0)})}onClose(){this.choiceMade||this.recordFeedback(null),this.component.unload(),this.contentEl.empty()}};var kD=require("obsidian"),Av=class extends kD.Modal{constructor(t,n,s){super(t);this.resolvePromise=null;this.processButton=null;this.settings=s,this.imageFiles=n,this.selected=new Set}async openAndWait(){return new Promise(t=>{this.resolvePromise=t,this.open()})}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-image-batch-modal"),t.createEl("h2",{text:"\uC774\uBBF8\uC9C0 \uD1B5\uD569 \uCC98\uB9AC"}),t.createEl("p",{text:`_Inbox\uC5D0\uC11C ${this.imageFiles.length}\uAC1C\uC758 \uC774\uBBF8\uC9C0\uB97C \uBC1C\uACAC\uD588\uC2B5\uB2C8\uB2E4. \uCC98\uB9AC\uD560 \uC774\uBBF8\uC9C0\uB97C \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let n=t.createDiv({cls:"image-batch-controls"});n.style.marginBottom="12px",n.style.display="flex",n.style.gap="8px";let s=n.createEl("button",{text:"\uC804\uCCB4 \uC120\uD0DD"});s.style.fontSize="12px",s.addEventListener("click",()=>{this.imageFiles.forEach(d=>this.selected.add(d.path)),this.renderList(o),this.updateProcessButton()});let r=n.createEl("button",{text:"\uC804\uCCB4 \uD574\uC81C"});r.style.fontSize="12px",r.addEventListener("click",()=>{this.selected.clear(),this.renderList(o),this.updateProcessButton()});let o=t.createDiv({cls:"image-list"});o.style.maxHeight="400px",o.style.overflowY="auto",o.style.marginBottom="16px",o.style.border="1px solid var(--background-modifier-border)",o.style.borderRadius="8px",o.style.padding="8px",this.renderList(o);let a=t.createEl("p",{cls:"setting-item-description"});a.style.fontSize="12px",a.style.marginBottom="16px",a.innerHTML=`
			<strong>\uB3D9\uC791:</strong> \uC120\uD0DD\uD55C \uC774\uBBF8\uC9C0\uB4E4\uC744 \uD558\uB098\uC758 \uBB38\uC11C\uB85C OCR \uCC98\uB9AC \uD6C4 AI \uC694\uC57D \uBC0F \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958\uB97C \uC218\uD589\uD569\uB2C8\uB2E4.<br>
			<em>\uC5F0\uC18D\uB41C \uD544\uAE30 \uB178\uD2B8\uB098 \uAD00\uB828 \uC774\uBBF8\uC9C0\uB4E4\uC744 \uD558\uB098\uC758 \uBB38\uC11C\uB85C \uD1B5\uD569\uD560 \uB54C \uC720\uC6A9\uD569\uB2C8\uB2E4.</em>
		`;let l=t.createDiv({cls:"modal-button-container"});l.style.display="flex",l.style.justifyContent="flex-end",l.style.gap="8px",l.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>{this.resolvePromise?.(null),this.close()}),this.processButton=l.createEl("button",{text:"OCR + \uBD84\uB958 (0\uAC1C \uC120\uD0DD)",cls:"mod-cta"}),this.processButton.disabled=!0,this.processButton.addEventListener("click",()=>{let d=this.imageFiles.filter(u=>this.selected.has(u.path));this.resolvePromise?.({selectedFiles:d}),this.close()})}renderList(t){if(t.empty(),this.imageFiles.length===0){t.createEl("p",{text:"_Inbox\uC5D0 \uC774\uBBF8\uC9C0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.",cls:"setting-item-description"});return}this.imageFiles.forEach(n=>{let s=t.createDiv({cls:"image-item"});s.style.display="flex",s.style.alignItems="center",s.style.padding="8px",s.style.marginBottom="4px",s.style.borderRadius="4px",s.style.gap="10px",s.style.cursor="pointer",this.selected.has(n.path)&&(s.style.backgroundColor="var(--background-modifier-success)");let r=s.createEl("input",{type:"checkbox"});r.checked=this.selected.has(n.path),r.style.flexShrink="0",r.addEventListener("change",d=>{d.stopPropagation(),r.checked?this.selected.add(n.path):this.selected.delete(n.path),this.renderList(t),this.updateProcessButton()});let o=s.createSpan({cls:"image-icon"});o.style.fontSize="16px",o.textContent=this.getFileIcon(n.extension);let a=s.createDiv({cls:"image-info"});a.style.flex="1",a.style.minWidth="0";let l=a.createDiv({cls:"image-name"});l.textContent=n.name,l.style.fontWeight="500",l.style.overflow="hidden",l.style.textOverflow="ellipsis",l.style.whiteSpace="nowrap";let c=a.createDiv({cls:"image-meta"});c.style.fontSize="11px",c.style.color="var(--text-muted)",c.textContent=this.formatFileSize(n.stat.size),s.addEventListener("click",d=>{d.target!==r&&(r.checked=!r.checked,r.checked?this.selected.add(n.path):this.selected.delete(n.path),this.renderList(t),this.updateProcessButton())})})}updateProcessButton(){if(this.processButton){let t=this.selected.size;this.processButton.textContent=`OCR + \uBD84\uB958 (${t}\uAC1C \uC120\uD0DD)`,this.processButton.disabled=t===0}}getFileIcon(t){return{png:"\u{1F5BC}\uFE0F",jpg:"\u{1F5BC}\uFE0F",jpeg:"\u{1F5BC}\uFE0F",webp:"\u{1F5BC}\uFE0F",gif:"\u{1F5BC}\uFE0F",pdf:"\u{1F4C4}"}[t.toLowerCase()]||"\u{1F4C4}"}formatFileSize(t){return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`}onClose(){let{contentEl:t}=this;t.empty(),this.resolvePromise&&(this.resolvePromise(null),this.resolvePromise=null)}};var Tv=require("obsidian"),Cv=class extends Tv.Modal{constructor(t,n){super(t);this.inputEl=null;this.resultsEl=null;this.results=[];this.selectedIndex=0;this.searchTimeout=null;this.isSearching=!1;this.embeddingManager=n}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-smart-search-modal"),t.createEl("div",{text:"\uBB34\uC5C7\uC744 \uCC3E\uACE0 \uC788\uB098\uC694?",cls:"smart-search-header"});let n=t.createDiv({cls:"smart-search-input-container"});this.inputEl=n.createEl("input",{type:"text",placeholder:"\uD30C\uC77C\uBA85 \uB610\uB294 \uB0B4\uC6A9\uC73C\uB85C \uAC80\uC0C9...",cls:"smart-search-input"}),this.inputEl.addEventListener("input",()=>this.onInputChange()),this.inputEl.addEventListener("keydown",s=>this.onKeyDown(s)),this.resultsEl=t.createDiv({cls:"smart-search-results"}),this.showEmptyState(),this.inputEl.focus()}onClose(){this.searchTimeout&&clearTimeout(this.searchTimeout),this.contentEl.empty()}onInputChange(){this.searchTimeout&&clearTimeout(this.searchTimeout);let t=this.inputEl?.value.trim()||"";if(t.length<2){this.showEmptyState();return}this.showSearching(),this.searchTimeout=setTimeout(()=>{this.performSearch(t)},300)}onKeyDown(t){switch(t.key){case"ArrowDown":t.preventDefault(),this.selectNext();break;case"ArrowUp":t.preventDefault(),this.selectPrevious();break;case"Enter":t.preventDefault(),this.openSelected();break;case"Escape":t.preventDefault(),this.close();break}}async performSearch(t){if(!this.isSearching){this.isSearching=!0;try{let n=t.toLowerCase(),s=new Set;this.results=[];let r=this.app.vault.getMarkdownFiles(),o=[];for(let l of r){let c=l.basename.toLowerCase();if(c.includes(n)){let d=l.parent?.path||"/",u=.9;c===n?u=1:c.startsWith(n)&&(u=.95),o.push({path:l.path,similarity:u,file:l,folder:d==="/"?"\uB8E8\uD2B8":d,matchType:"filename"}),s.add(l.path)}}o.sort((l,c)=>c.similarity-l.similarity),this.results.push(...o.slice(0,5));let a=await this.embeddingManager.findSimilarNotesByText(t,15,void 0,.2);for(let l of a){if(s.has(l.path))continue;let c=this.app.vault.getAbstractFileByPath(l.path);if(c instanceof Tv.TFile){let d=c.parent?.path||"/";if(this.results.push({...l,file:c,folder:d==="/"?"\uB8E8\uD2B8":d,matchType:"content"}),s.add(l.path),this.results.length>=10)break}}this.selectedIndex=0,this.renderResults()}catch(n){console.error("\uC2A4\uB9C8\uD2B8 \uAC80\uC0C9 \uC624\uB958:",n),this.showError()}finally{this.isSearching=!1}}}renderResults(){if(this.resultsEl){if(this.resultsEl.empty(),this.results.length===0){this.showNoResults();return}for(let t=0;t<this.results.length;t++){let n=this.results[t],s=this.resultsEl.createDiv({cls:`smart-search-item ${t===this.selectedIndex?"is-selected":""}`}),r=s.createDiv({cls:"search-item-title-row"}),o=n.matchType==="filename"?"\u{1F4DD}":"\u{1F50D}";if(r.createSpan({text:`${o} `,cls:"search-item-icon"}),r.createSpan({text:n.file.basename,cls:"search-item-title"}),n.matchType==="filename")r.createSpan({text:"\uC774\uB984",cls:"search-item-match-type"});else{let a=Math.round(n.similarity*100);r.createSpan({text:`${a}%`,cls:"search-item-similarity"})}n.chunkPreview&&n.matchType==="content"&&s.createDiv({text:n.chunkPreview,cls:"search-item-chunk-preview"}),s.createDiv({text:`\u2192 ${n.folder}`,cls:"search-item-folder"}),s.addEventListener("click",()=>{this.selectedIndex=t,this.openSelected()}),s.addEventListener("mouseenter",()=>{this.selectedIndex=t,this.updateSelection()})}}}updateSelection(){if(!this.resultsEl)return;this.resultsEl.querySelectorAll(".smart-search-item").forEach((n,s)=>{s===this.selectedIndex?n.addClass("is-selected"):n.removeClass("is-selected")})}selectNext(){this.results.length!==0&&(this.selectedIndex=(this.selectedIndex+1)%this.results.length,this.updateSelection(),this.scrollToSelected())}selectPrevious(){this.results.length!==0&&(this.selectedIndex=(this.selectedIndex-1+this.results.length)%this.results.length,this.updateSelection(),this.scrollToSelected())}scrollToSelected(){if(!this.resultsEl)return;let t=this.resultsEl.querySelector(".is-selected");t&&t.scrollIntoView({block:"nearest"})}openSelected(){if(this.results.length===0||this.selectedIndex>=this.results.length)return;let t=this.results[this.selectedIndex];this.app.workspace.openLinkText(t.file.path,""),this.close()}showEmptyState(){if(!this.resultsEl)return;this.resultsEl.empty(),this.results=[];let t=this.resultsEl.createDiv({cls:"smart-search-empty"});t.createEl("p",{text:"\uAC80\uC0C9\uC5B4\uB97C 2\uAE00\uC790 \uC774\uC0C1 \uC785\uB825\uD558\uC138\uC694"}),t.createEl("small",{text:"\uB0B4\uC6A9 \uAE30\uBC18\uC73C\uB85C \uAD00\uB828 \uBB38\uC11C\uB97C \uCC3E\uC544\uB4DC\uB9BD\uB2C8\uB2E4"})}showSearching(){if(!this.resultsEl)return;this.resultsEl.empty(),this.resultsEl.createDiv({cls:"smart-search-searching"}).createEl("p",{text:"\u{1F50D} \uAC80\uC0C9 \uC911..."})}showNoResults(){if(!this.resultsEl)return;this.resultsEl.empty();let t=this.resultsEl.createDiv({cls:"smart-search-no-results"});t.createEl("p",{text:"\uAD00\uB828 \uBB38\uC11C\uB97C \uCC3E\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4"}),t.createEl("small",{text:"\uB2E4\uB978 \uAC80\uC0C9\uC5B4\uB97C \uC2DC\uB3C4\uD574\uBCF4\uC138\uC694"})}showError(){if(!this.resultsEl)return;this.resultsEl.empty();let t=this.resultsEl.createDiv({cls:"smart-search-error"});t.createEl("p",{text:"\uAC80\uC0C9 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4"}),t.createEl("small",{text:"\uC784\uBCA0\uB529 \uC778\uB371\uC2A4\uAC00 \uAD6C\uCD95\uB418\uC5B4 \uC788\uB294\uC9C0 \uD655\uC778\uD558\uC138\uC694"})}};jn();var df=10,ND=100,FD=20,_v=class{constructor(e,t){this.app=e,this.settings=t,this.store={...td}}async load(){try{let e=this.getFilePath(),t=this.app.vault.adapter;if(await t.exists(e)){let n=await t.read(e),s=JSON.parse(n);this.store=this.migrate(s)}else this.store={...td}}catch(e){console.error("Failed to load feedback store:",e),this.store={...td}}}async save(){try{let e=this.getFilePath(),t=this.app.vault.adapter;if(this.settings.dataStorageLocation==="vault"){let n=this.settings.dataFolderPath;await t.exists(n)||await t.mkdir(n)}this.store.lastUpdated=new Date().toISOString(),await t.write(e,JSON.stringify(this.store,null,2))}catch(e){console.error("Failed to save feedback store:",e)}}getFilePath(){return this.settings.dataStorageLocation==="vault"?`${this.settings.dataFolderPath}/${dn.FEEDBACK}`:`${Fa}/${dn.FEEDBACK}`}migrate(e){return!e.version||e.version<1?{version:1,entries:e.entries||[],preferences:this.migratePreferences(e.preferences),lastUpdated:e.lastUpdated||new Date().toISOString()}:(e.preferences=this.migratePreferences(e.preferences),e)}migratePreferences(e){let t={...rp};return e?{version:e.version||t.version,feedback:{referenceLocation:{...t.feedback.referenceLocation,...e.feedback?.referenceLocation},scheduleDetection:{...t.feedback.scheduleDetection,...e.feedback?.scheduleDetection},projectClassification:{...t.feedback.projectClassification,...e.feedback?.projectClassification}},restructure:{...t.restructure,...e.restructure},embedding:{...t.embedding,...e.embedding},rag:{...t.rag,...e.rag,feedbackOnAnswers:{...t.rag.feedbackOnAnswers,...e.rag?.feedbackOnAnswers}}}:t}addFeedback(e){this.store.entries.push(e),this.store.entries.length>ND&&(this.store.entries=this.store.entries.slice(-ND)),this.updatePreferences(e),this.save()}updatePreferences(e){if(!e.userChoice.dismissed)switch(e.type){case"reference_location":this.updateReferencePreference(e);break;case"schedule_detection":this.updateSchedulePreference(e);break;case"related_notes":this.updateRelatedNotesPreference(e);break;case"project_classification":this.updateProjectClassificationPreference(e);break;case"content_restructure":this.updateRestructurePreference(e);break;case"rag_chat":this.updateRAGPreference(e);break}}updateReferencePreference(e){let t=this.store.preferences.feedback.referenceLocation;e.userChoice.modified==="library"?t.toLibrary++:e.userChoice.modified==="project"&&t.toProject++;let n=t.toLibrary+t.toProject;if(n>=5){let s=t.toLibrary/n;s>.7?t.preference="library":s<.3?t.preference="project":t.preference="neutral"}}updateSchedulePreference(e){let t=this.store.preferences.feedback.scheduleDetection;e.userChoice.accepted?t.accepted++:t.rejected++,e.userChoice.rejectedItems&&e.userChoice.rejectedItems.length>0}updateRelatedNotesPreference(e){}updateProjectClassificationPreference(e){let t=this.store.preferences.feedback.projectClassification;e.userChoice.modified&&e.aiSuggestion.projectName&&(t.corrections.push({original:e.aiSuggestion.projectName,corrected:e.userChoice.modified,keywords:[]}),t.corrections.length>FD&&(t.corrections=t.corrections.slice(-FD)))}updateRestructurePreference(e){let t=this.store.preferences.restructure;e.userChoice.accepted?t.accepted++:t.rejected++;let n=t.accepted+t.rejected;if(n>=5){let s=t.accepted/n;s>.7?t.preference="restructure":s<.3?t.preference="original":t.preference="neutral"}}updateRAGPreference(e){let t=this.store.preferences.rag;if(e.userChoice.accepted){if(t.feedbackOnAnswers.helpful++,e.aiSuggestion.sources)for(let n of e.aiSuggestion.sources)t.preferredNotes.includes(n)||(t.preferredNotes.push(n),t.preferredNotes.length>10&&t.preferredNotes.shift())}else t.feedbackOnAnswers.notHelpful++}generatePromptContext(){let e=this.store.preferences,t=[],n=e.feedback.referenceLocation;if(n.preference!=="neutral"){let a=n.toLibrary+n.toProject;a>=5&&(n.preference==="library"?t.push(`- \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB294 Library \uC120\uD638 (${a}\uD68C \uC911 ${n.toLibrary}\uD68C)`):t.push(`- \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB294 \uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354 \uC120\uD638 (${a}\uD68C \uC911 ${n.toProject}\uD68C)`))}let s=e.feedback.scheduleDetection;s.falsePositivePatterns.length>0&&t.push(`- \uB2E4\uC74C \uD45C\uD604\uC740 \uC77C\uC815\uC73C\uB85C \uAC10\uC9C0\uD558\uC9C0 \uC54A\uC74C: ${s.falsePositivePatterns.join(", ")}`);let r=e.feedback.projectClassification;r.corrections.length>0&&r.corrections.slice(-3).forEach(l=>{l.keywords.length>0&&t.push(`- "${l.keywords.join(", ")}" \uAD00\uB828 \uB0B4\uC6A9\uC740 ${l.corrected} \uD504\uB85C\uC81D\uD2B8\uB85C \uBD84\uB958`)});let o=e.restructure;if(o.preference!=="neutral"){let a=o.accepted+o.rejected;a>=5&&(o.preference==="restructure"?t.push(`- \uCF58\uD150\uCE20 \uC7AC\uAD6C\uC131 \uC120\uD638 (${a}\uD68C \uC911 ${o.accepted}\uD68C \uC218\uB77D)`):t.push(`- \uC6D0\uBCF8 \uC720\uC9C0 \uC120\uD638 (${a}\uD68C \uC911 ${o.rejected}\uD68C \uAC70\uBD80)`))}return t.length>0?`

## \uC0AC\uC6A9\uC790 \uC120\uD638\uB3C4 (\uC774\uC804 \uD53C\uB4DC\uBC31 \uAE30\uBC18)
${t.join(`
`)}`:""}getPreferences(){return this.store.preferences}getEntries(){return this.store.entries}getStats(){let e=this.store.preferences.feedback.referenceLocation,t=this.store.preferences.feedback.scheduleDetection;return{totalEntries:this.store.entries.length,referenceDecisions:e.toLibrary+e.toProject,scheduleDecisions:t.accepted+t.rejected,lastUpdated:this.store.lastUpdated}}};var yr=require("obsidian");var xv=class extends yr.Modal{constructor(t,n,s){super(t);this.currentStep=1;this.settings={...n},this.onComplete=s}onOpen(){this.contentEl.addClass("zfb-onboarding"),this.renderStep(1)}onClose(){this.contentEl.empty()}renderStep(t){this.currentStep=t;let{contentEl:n}=this;switch(n.empty(),this.renderProgress(n,t),t){case 1:this.renderStep1(n);break;case 2:this.renderStep2(n);break;case 3:this.renderStep3(n);break;case 4:this.renderStep4(n);break}}renderProgress(t,n){let s=t.createDiv({cls:"onboarding-progress"});for(let r=1;r<=qb;r++)s.createSpan({cls:`progress-dot ${r===n?"active":""} ${r<n?"completed":""}`}).setText(r.toString())}renderStep1(t){t.createEl("h2",{text:"1\uB2E8\uACC4: Gemini API \uD0A4 \uC124\uC815"}),t.createEl("p",{text:"\uC774 \uD50C\uB7EC\uADF8\uC778\uC740 Google Gemini AI\uB97C \uC0AC\uC6A9\uD569\uB2C8\uB2E4. \uBB34\uB8CC\uB85C API \uD0A4\uB97C \uBC1C\uAE09\uBC1B\uC744 \uC218 \uC788\uC2B5\uB2C8\uB2E4."}),t.createEl("a",{text:"\u{1F4D6} API \uD0A4 \uBC1C\uAE09 \uAC00\uC774\uB4DC (Google AI Studio)",href:a_}).setAttr("target","_blank"),new yr.Setting(t).setName("Gemini API \uD0A4").setDesc("Google AI Studio\uC5D0\uC11C \uBC1C\uAE09\uBC1B\uC740 \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694").addText(s=>s.setPlaceholder("AIza...").setValue(this.settings.geminiApiKey).onChange(r=>{this.settings.geminiApiKey=r})),this.renderNavButtons(t,1)}renderStep2(t){t.createEl("h2",{text:"2\uB2E8\uACC4: \uD3F4\uB354 \uAD6C\uC870 \uC124\uC815"}),t.createEl("p",{text:"\uB178\uD2B8\uB97C \uC815\uB9AC\uD560 \uD3F4\uB354 \uAD6C\uC870\uB97C \uC790\uB3D9\uC73C\uB85C \uC0DD\uC131\uD569\uB2C8\uB2E4."});let n=t.createDiv({cls:"folder-preview"});n.innerHTML=`
			<pre>\u{1F4C1} 00 _Inbox/        \u2190 \uC5EC\uAE30\uC5D0 \uC4F0\uAE30\uB9CC \uD558\uC138\uC694
\u{1F4C1} 01 Projects/      \u2190 AI\uAC00 \uD504\uB85C\uC81D\uD2B8\uBCC4\uB85C \uC815\uB9AC
\u{1F4C1} 02 Library/       \u2190 \uCC38\uACE0\uC790\uB8CC \uBAA8\uC74C
\u{1F4C1} 03 Archives/      \u2190 \uC644\uB8CC\uB41C \uD56D\uBAA9
\u{1F4C1} 10 Zettelkasten/  \u2190 \uC601\uAD6C \uB178\uD2B8</pre>
		`,new yr.Setting(t).setName("\uD3F4\uB354 \uAD6C\uC870 \uC0DD\uC131").setDesc("\uC704 \uAD6C\uC870\uB85C \uD3F4\uB354\uB97C \uC790\uB3D9 \uC0DD\uC131\uD569\uB2C8\uB2E4").addButton(s=>s.setButtonText("\uD3F4\uB354 \uC0DD\uC131").setCta().onClick(async()=>{await this.createFolderStructure(),new yr.Notice("\uD3F4\uB354 \uAD6C\uC870\uAC00 \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4!"),s.setButtonText("\u2713 \uC644\uB8CC"),s.setDisabled(!0)})),this.renderNavButtons(t,2)}renderStep3(t){t.createEl("h2",{text:"3\uB2E8\uACC4: \uC0AC\uC6A9 \uBAA8\uB4DC \uC120\uD0DD"}),t.createEl("p",{text:"\uC0AC\uC6A9 \uD328\uD134\uC5D0 \uB9DE\uB294 \uBAA8\uB4DC\uB97C \uC120\uD0DD\uD558\uC138\uC694. \uB098\uC911\uC5D0 \uC124\uC815\uC5D0\uC11C \uBCC0\uACBD\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4."});let n=t.createDiv({cls:"preset-cards"}),s=["basic","power","experimental"];for(let r of s){let o=xt[r],a=this.settings.preset===r,l=n.createDiv({cls:`preset-card ${a?"selected":""}`});l.createDiv({text:o.icon,cls:"preset-icon"}),l.createDiv({text:o.label,cls:"preset-label"}),l.createDiv({text:o.longDesc,cls:"preset-desc"}),l.addEventListener("click",()=>{n.querySelectorAll(".preset-card").forEach(c=>c.removeClass("selected")),l.addClass("selected"),this.applyPreset(r)})}this.renderNavButtons(t,3)}renderStep4(t){t.createEl("h2",{text:"4\uB2E8\uACC4: \uC2DC\uC791\uD558\uAE30"}),t.createEl("p",{text:"\uC124\uC815\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4! \uC774\uC81C \uC0AC\uC6A9\uD574\uBCF4\uC138\uC694."});let n=t.createDiv({cls:"tips-container"});n.innerHTML=`
			<div class="tip">
				<strong>\u{1F4DD} \uB178\uD2B8 \uBD84\uB958</strong>
				<p>_Inbox\uC5D0 \uB178\uD2B8 \uC791\uC131 \u2192 <kbd>Ctrl+Shift+G</kbd></p>
			</div>
			<div class="tip">
				<strong>\u{1F517} URL \uC694\uC57D</strong>
				<p>\uB178\uD2B8\uC5D0 URL \uBD99\uC5EC\uB123\uAE30 \u2192 <kbd>Ctrl+Shift+U</kbd></p>
			</div>
			<div class="tip">
				<strong>\u{1F916} AI \uCC57\uBD07</strong>
				<p><kbd>Ctrl+Shift+'</kbd>\uB85C \uCC57\uBD07 \uC5F4\uAE30</p>
			</div>
		`;let s=t.createDiv({cls:"modal-button-container"});s.createEl("button",{text:"\uC774\uC804"}).addEventListener("click",()=>this.renderStep(3)),s.createEl("button",{text:"\uC2DC\uC791\uD558\uAE30",cls:"mod-cta"}).addEventListener("click",()=>{this.settings.onboardingCompleted=!0,this.onComplete(this.settings),this.close()})}renderNavButtons(t,n){let s=t.createDiv({cls:"modal-button-container"});n>1&&s.createEl("button",{text:"\uC774\uC804"}).addEventListener("click",()=>this.renderStep(n-1)),n<qb&&s.createEl("button",{text:"\uB2E4\uC74C",cls:"mod-cta"}).addEventListener("click",()=>{if(n===1&&!this.settings.geminiApiKey){new yr.Notice("API \uD0A4\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694");return}this.renderStep(n+1)})}async createFolderStructure(){let t=[this.settings.inboxFolder,this.settings.projectsFolder,this.settings.libraryFolder,this.settings.archivesFolder,this.settings.zettelFolder];for(let n of t)await this.app.vault.adapter.exists(n)||await this.app.vault.createFolder(n)}applyPreset(t){this.settings.preset=t;let n=dp[t];for(let[s,r]of Object.entries(n))up.includes(s)||(this.settings[s]=r)}};var wi=require("obsidian");var uf=class{constructor(e,t){this.dayCache=new Map;this.allEventsCache=[];this.fileEventMap=new Map;this.initialized=!1;this.changeListeners=new Set;this.vaultEventRefs=[];this.app=e,this.settings=t}async initialize(){if(this.initialized)return;let e=this.app.vault.getMarkdownFiles();for(let t of e){let n=await this.extractEventsFromFile(t);n.length>0&&(this.fileEventMap.set(t.path,n),this.allEventsCache.push(...n))}this.initialized=!0,this.registerVaultEvents()}registerVaultEvents(){let e=this.app.vault.on("create",async r=>{r instanceof wi.TFile&&r.extension==="md"&&await this.reloadFile(r)});this.vaultEventRefs.push(e);let t=this.app.vault.on("modify",async r=>{r instanceof wi.TFile&&r.extension==="md"&&await this.reloadFile(r)});this.vaultEventRefs.push(t);let n=this.app.vault.on("delete",r=>{r instanceof wi.TFile&&(this.invalidateFile(r.path),this.notifyListeners())});this.vaultEventRefs.push(n);let s=this.app.vault.on("rename",async(r,o)=>{r instanceof wi.TFile&&r.extension==="md"&&(this.invalidateFile(o),await this.reloadFile(r))});this.vaultEventRefs.push(s)}unregisterVaultEvents(){for(let e of this.vaultEventRefs)this.app.vault.offref(e);this.vaultEventRefs=[]}async reloadFile(e){this.invalidateFile(e.path);let t=await this.extractEventsFromFile(e);t.length>0&&(this.fileEventMap.set(e.path,t),this.allEventsCache.push(...t)),this.dayCache.clear(),this.notifyListeners()}invalidateFile(e){this.fileEventMap.get(e)&&(this.allEventsCache=this.allEventsCache.filter(n=>!n.source.path.startsWith(e)),this.fileEventMap.delete(e)),this.dayCache.clear()}addChangeListener(e){this.changeListeners.add(e)}removeChangeListener(e){this.changeListeners.delete(e)}notifyListeners(){for(let e of this.changeListeners)e()}updateSettings(e){this.settings=e}invalidateCache(){this.dayCache.clear(),this.allEventsCache=[],this.fileEventMap.clear(),this.initialized=!1}async getEventsForRange(e,t){return this.initialized||await this.initialize(),this.allEventsCache.filter(n=>n.start>=e&&n.start<=t)}async getEventsForDay(e){if(this.dayCache.has(e))return this.dayCache.get(e);let t=await this.getEventsForRange(new Date(e+"T00:00:00"),new Date(e+"T23:59:59")),n={date:e,notes:t.filter(s=>s.type==="note"),schedules:t.filter(s=>s.type==="schedule"),meetings:t.filter(s=>s.type==="meeting"),total:t.length};return this.dayCache.set(e,n),n}async getEventCountsForMonth(e,t){let n=new Map,s=new Date(e,t,1),r=new Date(e,t+1,0,23,59,59),o=await this.getEventsForRange(s,r);for(let a of o){let l=Be(a.start,this.settings.timezone);n.set(l,(n.get(l)||0)+1)}return n}async extractEventsFromFile(e){let t=[],n=await this.app.vault.cachedRead(e),s=this.parseFrontmatter(n),r=this.determineFileType(e,s),o=this.getEventDate(e,s);if(!o)return t;if(r==="meeting")t.push(this.createEvent(e,s,o,"meeting"));else if(this.isDailyNote(e)){let a=this.extractSchedulesFromDailyNote(e,n,o);t.push(...a)}else t.push(this.createEvent(e,s,o,"note"));return t}parseFrontmatter(e){let t=e.match(/^---\n([\s\S]*?)\n---/);if(!t)return{};try{return(0,wi.parseYaml)(t[1])||{}}catch{return{}}}determineFileType(e,t){return t.type==="meeting"||e.path.includes("\uD68C\uC758\uB85D")||e.path.includes("Meeting")?"meeting":this.isDailyNote(e)?"schedule":"note"}isDailyNote(e){let t=this.settings.dailyNotesFolder;return e.path.startsWith(t)}getEventDate(e,t){let n=["date","created","meetingDate"];for(let r of n){let o=t[r];if(o){let a=this.parseDate(o);if(a)return a}}let s=e.basename.match(/^(\d{4}-\d{2}-\d{2})$/);return s?new Date(s[1]+"T00:00:00"):new Date(e.stat.ctime)}parseDate(e){let t=e.match(/^(\d{4}-\d{2}-\d{2})/);if(t)return new Date(t[1]+"T00:00:00");let n=new Date(e);return isNaN(n.getTime())?null:n}createEvent(e,t,n,s){let r=t.title||e.basename,o=this.getProjectFromPath(e.path),a={note:"var(--interactive-accent)",schedule:"var(--text-success)",meeting:"var(--text-warning)"};return{id:e.path,title:r,start:n,allDay:s==="note"||s==="meeting",type:s,color:a[s],source:{path:e.path},metadata:{project:o,tags:t.tags||[],summary:t.summary||void 0}}}extractSchedulesFromDailyNote(e,t,n){let s=[],r=t.split(`
`);for(let o=0;o<r.length;o++){let a=r[o];if(a.match(/^- \[[ x]\]/)){let l=a.match(/^- \[[ x]\] (\d{1,2}:\d{2})?\s*(.+?)(?:\s+[]\s*(\d{4}-\d{2}-\d{2}))?$/);if(l){let c=l[1],u=l[2].trim().replace(/\s*\(from \[\[.+?\]\]\)\s*$/,"").trim(),p=l[3],m;if(p?m=new Date(p+"T00:00:00"):m=new Date(n),c){let[y,v]=c.split(":").map(Number);m.setHours(y,v,0,0)}s.push({id:`${e.path}:${o}`,title:u,start:m,allDay:!c,type:"schedule",color:"var(--text-success)",source:{path:e.path,lineNumber:o+1},metadata:{project:this.getProjectFromPath(e.path)}})}}}return s}getProjectFromPath(e){let t=this.settings.projectsFolder;if(e.startsWith(t+"/")){let n=e.substring(t.length+1),s=n.indexOf("/");if(s>0)return n.substring(0,s)}}hasTimeComponent(e){return e.getHours()!==0||e.getMinutes()!==0}async moveEvent(e,t){let[n,s]=e.split(":"),r=this.app.vault.getAbstractFileByPath(n);if(!(r instanceof wi.TFile))return!1;let o=await this.app.vault.read(r);if(s){let a=parseInt(s)-1,l=o.split(`
`);if(a>=0&&a<l.length){let c=l[a],d=Be(t,this.settings.timezone),u=c.replace(/[]\s*\d{4}-\d{2}-\d{2}/,`\u{1F4C5} ${d}`);if(u!==c)return l[a]=u,await this.app.vault.modify(r,l.join(`
`)),this.invalidateCache(),!0}}else{let a=Be(t,this.settings.timezone),l=this.updateFrontmatterDate(o,a);if(l!==o)return await this.app.vault.modify(r,l),this.invalidateCache(),!0}return!1}updateFrontmatterDate(e,t){let n=e.match(/^---\n([\s\S]*?)\n---/);if(!n)return e;let s=n[1],r;return s.includes("date:")?r=s.replace(/date:\s*.*/,`date: ${t}`):r=`date: ${t}
${s}`,e.replace(/^---\n[\s\S]*?\n---/,`---
${r}
---`)}async deleteEvent(e){let[t,n]=e.split(":"),s=this.app.vault.getAbstractFileByPath(t);if(!(s instanceof wi.TFile))return!1;if(n){let r=parseInt(n)-1,a=(await this.app.vault.read(s)).split(`
`);if(r>=0&&r<a.length)return a.splice(r,1),await this.app.vault.modify(s,a.join(`
`)),this.invalidateCache(),!0}else return!1;return!1}async openEvent(e){let[t,n]=e.split(":"),s=this.app.vault.getAbstractFileByPath(t);if(s instanceof wi.TFile){let r=this.app.workspace.getLeaf();if(await r.openFile(s),n){let o=parseInt(n)-1,a=r.view;"editor"in a&&a.editor&&a.editor.setCursor({line:o,ch:0})}}}};var LD=require("obsidian");var vr=require("obsidian"),Ai=class extends vr.Modal{constructor(t,n,s,r){super(t);this.onEventClick=null;this.isMobileView=!1;this.modalWidth=400;this.date=n,this.dataProvider=s,this.settings=r}setOnEventClick(t){this.onEventClick=t}async onOpen(){let{contentEl:t,modalEl:n}=this;t.empty(),t.addClass("zfb-calendar-day-modal"),n.addClass("zfb-calendar-day-modal-container");let s=document.querySelector(".workspace"),r=s?.offsetWidth||window.innerWidth,o=Math.min(window.innerWidth,r);if(this.isMobileView=vr.Platform.isMobile||o<500,this.modalWidth=Math.min(o-32,400),this.isMobileView){document.documentElement.style.overflowX="hidden",document.body.style.overflowX="hidden",s&&(s.style.overflowX="hidden");let b=n.parentElement;b&&(b.style.setProperty("overflow-x","hidden","important"),b.style.setProperty("width",`${r}px`,"important"),b.style.setProperty("max-width",`${r}px`,"important"),b.style.setProperty("left","auto","important"),b.style.setProperty("right","0","important")),n.style.setProperty("width",`${this.modalWidth}px`,"important"),n.style.setProperty("max-width",`${this.modalWidth}px`,"important"),n.style.setProperty("min-width","0","important"),n.style.setProperty("overflow","hidden","important"),n.style.setProperty("position","relative","important"),n.style.setProperty("left","auto","important"),n.style.setProperty("right","auto","important"),n.style.setProperty("margin","auto","important"),t.style.setProperty("width","100%","important"),t.style.setProperty("max-width","100%","important"),t.style.setProperty("min-width","0","important"),t.style.setProperty("padding","16px","important"),t.style.setProperty("overflow","hidden","important"),t.style.setProperty("box-sizing","border-box","important"),t.style.setProperty("word-break","break-word","important")}t.createEl("p",{text:"\uB85C\uB529 \uC911..."});let a=await this.dataProvider.getEventsForDay(this.date);t.empty();let l=new Date(this.date+"T00:00:00"),d=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"][l.getDay()],u=t.createDiv({cls:"day-modal-header"});u.style.marginBottom="16px",u.style.overflow="hidden",u.style.maxWidth="100%",this.isMobileView&&u.style.setProperty("width",`${this.modalWidth-32}px`,"important");let p=u.createEl("h2",{text:`${this.date} (${d}\uC694\uC77C)`});if(p.style.margin="0",p.style.overflow="hidden",p.style.textOverflow="ellipsis",p.style.whiteSpace="nowrap",this.isMobileView&&p.style.setProperty("max-width",`${this.modalWidth-48}px`,"important"),u.createEl("p",{text:`\uCD1D ${a.total}\uAC1C \uD56D\uBAA9`,cls:"setting-item-description"}).style.margin="4px 0 0 0",a.total===0){let b=t.createDiv({cls:"day-modal-empty"});b.style.padding="32px",b.style.textAlign="center",b.style.color="var(--text-muted)",b.setText("\uC774 \uB0A0\uC9DC\uC5D0 \uB4F1\uB85D\uB41C \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let m=t.createDiv({cls:"day-modal-sections"});m.style.maxHeight=this.isMobileView?"50vh":"400px",m.style.overflowY="auto",m.style.overflowX="hidden",this.isMobileView&&(m.style.setProperty("width",`${this.modalWidth-32}px`,"important"),m.style.setProperty("max-width",`${this.modalWidth-32}px`,"important")),a.schedules.length>0&&this.renderSection(m,"\uC77C\uC815",a.schedules,"schedule"),a.notes.length>0&&this.renderSection(m,"\uB178\uD2B8",a.notes,"note"),a.meetings.length>0&&this.renderSection(m,"\uD68C\uC758\uB85D",a.meetings,"meeting");let y=t.createDiv({cls:"modal-button-container"});y.style.display="flex",y.style.justifyContent="flex-end",y.style.marginTop="16px",y.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close())}renderSection(t,n,s,r){let o={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"},a=this.isMobileView?this.modalWidth-56:void 0,l=t.createDiv({cls:"day-section"});l.style.marginBottom="16px",l.style.overflow="hidden",l.style.maxWidth="100%",this.isMobileView&&l.style.setProperty("width",`${this.modalWidth-32}px`,"important");let c=l.createDiv({cls:"section-header"});c.style.display="flex",c.style.alignItems="center",c.style.gap="8px",c.style.marginBottom="8px",c.createEl("span",{text:o[r]}),c.createEl("span",{text:`${n} (${s.length})`}).style.fontWeight="500";let d=l.createDiv({cls:"section-list"});d.style.overflow="hidden",d.style.maxWidth="100%",this.isMobileView&&d.style.setProperty("width",`${this.modalWidth-32}px`,"important");for(let u of s){let p=d.createDiv({cls:"event-item"});p.style.display="flex",p.style.alignItems="center",p.style.padding="8px 12px",p.style.marginBottom="4px",p.style.border="1px solid var(--background-modifier-border)",p.style.borderRadius="6px",p.style.cursor="pointer",p.style.transition="background-color 0.15s",p.style.overflow="hidden",p.style.maxWidth="100%",p.style.boxSizing="border-box",this.isMobileView&&a&&(p.style.setProperty("width",`${a}px`,"important"),p.style.setProperty("max-width",`${a}px`,"important"));let m=p.createDiv({cls:"event-indicator"});m.style.width="4px",m.style.height="24px",m.style.borderRadius="2px",m.style.marginRight="12px",m.style.flexShrink="0",m.style.backgroundColor=u.color||"var(--interactive-accent)";let y=p.createDiv({cls:"event-info"});y.createEl("div",{text:u.title,cls:"event-title"});let v=y.createEl("div",{cls:"event-detail"}),b=[];if(u.allDay)b.push("\uC885\uC77C");else{let S=u.start.getHours().toString().padStart(2,"0"),C=u.start.getMinutes().toString().padStart(2,"0");b.push(`${S}:${C}`)}if(u.metadata?.project&&b.push(u.metadata.project),v.setText(b.join(" | ")),p.addEventListener("mouseenter",()=>{p.style.backgroundColor="var(--background-modifier-hover)"}),p.addEventListener("mouseleave",()=>{p.style.backgroundColor=""}),p.setAttribute("title",u.title),vr.Platform.isMobile||p.addEventListener("mouseover",S=>{(S.ctrlKey||S.metaKey)&&this.app.workspace.trigger("hover-link",{event:S,source:"calendar-day-modal",hoverParent:p,targetEl:p,linktext:u.id})}),vr.Platform.isMobile){let S=null,C=!1;p.addEventListener("touchstart",T=>{C=!1,S=setTimeout(()=>{C=!0,new vr.Notice(u.title,3e3)},500)}),p.addEventListener("touchend",()=>{S&&(clearTimeout(S),S=null)}),p.addEventListener("touchmove",()=>{S&&(clearTimeout(S),S=null)})}p.addEventListener("click",async()=>{this.onEventClick?this.onEventClick(u):(await this.dataProvider.openEvent(u.id),this.close())})}}onClose(){if(this.isMobileView){document.documentElement.style.overflowX="",document.body.style.overflowX="";let t=document.querySelector(".workspace");t&&(t.style.overflowX="")}this.contentEl.empty()}};var Oc="zfb-mini-calendar",hf=class extends LD.ItemView{constructor(t,n,s){super(t);this.eventCounts=new Map;this.settings=n,this.dataProvider=s;let r=new Date;this.currentYear=r.getFullYear(),this.currentMonth=r.getMonth(),this.refreshCallback=()=>this.renderCalendar()}getViewType(){return Oc}getDisplayText(){return"\uCE98\uB9B0\uB354"}getIcon(){return"calendar"}async onOpen(){this.dataProvider.addChangeListener(this.refreshCallback),await this.renderCalendar()}async onClose(){this.dataProvider.removeChangeListener(this.refreshCallback),this.contentEl.empty()}updateSettings(t){this.settings=t,this.renderCalendar()}async renderCalendar(){let t=this.contentEl;t.empty(),t.addClass("zfb-mini-calendar"),this.eventCounts=await this.dataProvider.getEventCountsForMonth(this.currentYear,this.currentMonth),this.renderHeader(t),this.renderWeekdayHeader(t),this.renderDateGrid(t),this.renderTodayButton(t)}renderHeader(t){let n=t.createDiv({cls:"mini-calendar-header"});n.createEl("button",{cls:"nav-btn",text:"<"}).addEventListener("click",()=>this.navigateMonth(-1));let r=["1\uC6D4","2\uC6D4","3\uC6D4","4\uC6D4","5\uC6D4","6\uC6D4","7\uC6D4","8\uC6D4","9\uC6D4","10\uC6D4","11\uC6D4","12\uC6D4"];n.createEl("span",{cls:"month-title",text:`${this.currentYear}\uB144 ${r[this.currentMonth]}`}),n.createEl("button",{cls:"nav-btn",text:">"}).addEventListener("click",()=>this.navigateMonth(1))}renderWeekdayHeader(t){let n=t.createDiv({cls:"weekday-header"}),s=this.settings.calendarFirstDayOfWeek===1?["\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0","\uC77C"]:["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"];for(let r of s)n.createEl("span",{text:r})}renderDateGrid(t){let n=t.createDiv({cls:"date-grid"}),s=new Date(this.currentYear,this.currentMonth,1),r=new Date(this.currentYear,this.currentMonth+1,0),o=s.getDay();this.settings.calendarFirstDayOfWeek===1&&(o=o===0?6:o-1);let a=Be(new Date,this.settings.timezone);for(let l=0;l<o;l++)n.createDiv({cls:"date-cell empty"});for(let l=1;l<=r.getDate();l++){let c=`${this.currentYear}-${String(this.currentMonth+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`,d=this.eventCounts.get(c)||0,u=c===a,p=n.createDiv({cls:"date-cell"});if(u&&p.addClass("today"),p.createEl("span",{cls:"day-number",text:String(l)}),d>0){let m=p.createDiv({cls:"event-dots"}),y=Math.min(d,3);for(let v=0;v<y;v++)m.createDiv({cls:"event-dot"})}p.addEventListener("click",()=>{this.openDayModal(c)})}}renderTodayButton(t){t.createDiv({cls:"today-btn-container"}).createEl("button",{cls:"today-btn",text:"\uC624\uB298"}).addEventListener("click",()=>{let r=new Date;this.currentYear=r.getFullYear(),this.currentMonth=r.getMonth(),this.renderCalendar()})}navigateMonth(t){this.currentMonth+=t,this.currentMonth<0?(this.currentMonth=11,this.currentYear--):this.currentMonth>11&&(this.currentMonth=0,this.currentYear++),this.renderCalendar()}openDayModal(t){new Ai(this.app,t,this.dataProvider,this.settings).open()}};var dP=require("obsidian");var Pv,W,$D,NA,Uc,fa,OD,VD,GD,Dv={},zD=[],oB=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function br(i,e){for(var t in e)i[t]=e[t];return i}function WD(i){var e=i.parentNode;e&&e.removeChild(i)}function x(i,e,t){var n,s,r,o={};for(r in e)r=="key"?n=e[r]:r=="ref"?s=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?Pv.call(arguments,2):t),typeof i=="function"&&i.defaultProps!=null)for(r in i.defaultProps)o[r]===void 0&&(o[r]=i.defaultProps[r]);return Rv(i,o,n,s,null)}function Rv(i,e,t,n,s){var r={type:i,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:s??++$D};return s==null&&W.vnode!=null&&W.vnode(r),r}function Oe(){return{current:null}}function oe(i){return i.children}function aB(i,e,t,n,s){var r;for(r in t)r==="children"||r==="key"||r in e||Iv(i,r,null,t[r],n);for(r in e)s&&typeof e[r]!="function"||r==="children"||r==="key"||r==="value"||r==="checked"||t[r]===e[r]||Iv(i,r,e[r],t[r],n)}function UD(i,e,t){e[0]==="-"?i.setProperty(e,t??""):i[e]=t==null?"":typeof t!="number"||oB.test(e)?t:t+"px"}function Iv(i,e,t,n,s){var r;e:if(e==="style")if(typeof t=="string")i.style.cssText=t;else{if(typeof n=="string"&&(i.style.cssText=n=""),n)for(e in n)t&&e in t||UD(i.style,e,"");if(t)for(e in t)n&&t[e]===n[e]||UD(i.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")r=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in i?e.toLowerCase().slice(2):e.slice(2),i.l||(i.l={}),i.l[e+r]=t,t?n||i.addEventListener(e,r?HD:BD,r):i.removeEventListener(e,r?HD:BD,r);else if(e!=="dangerouslySetInnerHTML"){if(s)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in i)try{i[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e.indexOf("-")==-1?i.removeAttribute(e):i.setAttribute(e,t))}}function BD(i){Uc=!0;try{return this.l[i.type+!1](W.event?W.event(i):i)}finally{Uc=!1}}function HD(i){Uc=!0;try{return this.l[i.type+!0](W.event?W.event(i):i)}finally{Uc=!1}}function rt(i,e){this.props=i,this.context=e}function ff(i,e){if(e==null)return i.__?ff(i.__,i.__.__k.indexOf(i)+1):null;for(var t;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null)return t.__e;return typeof i.type=="function"?ff(i):null}function qD(i){var e,t;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,e=0;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null){i.__e=i.__c.base=t.__e;break}return qD(i)}}function lB(i){Uc?setTimeout(i):VD(i)}function kA(i){(!i.__d&&(i.__d=!0)&&fa.push(i)&&!Mv.__r++||OD!==W.debounceRendering)&&((OD=W.debounceRendering)||lB)(Mv)}function Mv(){var i,e,t,n,s,r,o,a;for(fa.sort(function(l,c){return l.__v.__b-c.__v.__b});i=fa.shift();)i.__d&&(e=fa.length,n=void 0,s=void 0,o=(r=(t=i).__v).__e,(a=t.__P)&&(n=[],(s=br({},r)).__v=r.__v+1,FA(a,r,s,t.__n,a.ownerSVGElement!==void 0,r.__h!=null?[o]:null,n,o??ff(r),r.__h),ZD(n,r),r.__e!=o&&qD(r)),fa.length>e&&fa.sort(function(l,c){return l.__v.__b-c.__v.__b}));Mv.__r=0}function YD(i,e,t,n,s,r,o,a,l,c){var d,u,p,m,y,v,b,S=n&&n.__k||zD,C=S.length;for(t.__k=[],d=0;d<e.length;d++)if((m=t.__k[d]=(m=e[d])==null||typeof m=="boolean"?null:typeof m=="string"||typeof m=="number"||typeof m=="bigint"?Rv(null,m,null,null,m):Array.isArray(m)?Rv(oe,{children:m},null,null,null):m.__b>0?Rv(m.type,m.props,m.key,m.ref?m.ref:null,m.__v):m)!=null){if(m.__=t,m.__b=t.__b+1,(p=S[d])===null||p&&m.key==p.key&&m.type===p.type)S[d]=void 0;else for(u=0;u<C;u++){if((p=S[u])&&m.key==p.key&&m.type===p.type){S[u]=void 0;break}p=null}FA(i,m,p=p||Dv,s,r,o,a,l,c),y=m.__e,(u=m.ref)&&p.ref!=u&&(b||(b=[]),p.ref&&b.push(p.ref,null,m),b.push(u,m.__c||y,m)),y!=null?(v==null&&(v=y),typeof m.type=="function"&&m.__k===p.__k?m.__d=l=KD(m,l,i):l=XD(i,m,p,S,y,l),typeof t.type=="function"&&(t.__d=l)):l&&p.__e==l&&l.parentNode!=i&&(l=ff(p))}for(t.__e=v,d=C;d--;)S[d]!=null&&(typeof t.type=="function"&&S[d].__e!=null&&S[d].__e==t.__d&&(t.__d=JD(n).nextSibling),QD(S[d],S[d]));if(b)for(d=0;d<b.length;d++)jD(b[d],b[++d],b[++d])}function KD(i,e,t){for(var n,s=i.__k,r=0;s&&r<s.length;r++)(n=s[r])&&(n.__=i,e=typeof n.type=="function"?KD(n,e,t):XD(t,n,n,s,n.__e,e));return e}function pf(i,e){return e=e||[],i==null||typeof i=="boolean"||(Array.isArray(i)?i.some(function(t){pf(t,e)}):e.push(i)),e}function XD(i,e,t,n,s,r){var o,a,l;if(e.__d!==void 0)o=e.__d,e.__d=void 0;else if(t==null||s!=r||s.parentNode==null)e:if(r==null||r.parentNode!==i)i.appendChild(s),o=null;else{for(a=r,l=0;(a=a.nextSibling)&&l<n.length;l+=1)if(a==s)break e;i.insertBefore(s,r),o=r}return o!==void 0?o:s.nextSibling}function JD(i){var e,t,n;if(i.type==null||typeof i.type=="string")return i.__e;if(i.__k){for(e=i.__k.length-1;e>=0;e--)if((t=i.__k[e])&&(n=JD(t)))return n}return null}function FA(i,e,t,n,s,r,o,a,l){var c,d,u,p,m,y,v,b,S,C,T,_,R,I,M,k=e.type;if(e.constructor!==void 0)return null;t.__h!=null&&(l=t.__h,a=e.__e=t.__e,e.__h=null,r=[a]),(c=W.__b)&&c(e);try{e:if(typeof k=="function"){if(b=e.props,S=(c=k.contextType)&&n[c.__c],C=c?S?S.props.value:c.__:n,t.__c?v=(d=e.__c=t.__c).__=d.__E:("prototype"in k&&k.prototype.render?e.__c=d=new k(b,C):(e.__c=d=new rt(b,C),d.constructor=k,d.render=dB),S&&S.sub(d),d.props=b,d.state||(d.state={}),d.context=C,d.__n=n,u=d.__d=!0,d.__h=[],d._sb=[]),d.__s==null&&(d.__s=d.state),k.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=br({},d.__s)),br(d.__s,k.getDerivedStateFromProps(b,d.__s))),p=d.props,m=d.state,d.__v=e,u)k.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(k.getDerivedStateFromProps==null&&b!==p&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(b,C),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(b,d.__s,C)===!1||e.__v===t.__v){for(e.__v!==t.__v&&(d.props=b,d.state=d.__s,d.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.forEach(function(N){N&&(N.__=e)}),T=0;T<d._sb.length;T++)d.__h.push(d._sb[T]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(b,d.__s,C),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(p,m,y)})}if(d.context=C,d.props=b,d.__P=i,_=W.__r,R=0,"prototype"in k&&k.prototype.render){for(d.state=d.__s,d.__d=!1,_&&_(e),c=d.render(d.props,d.state,d.context),I=0;I<d._sb.length;I++)d.__h.push(d._sb[I]);d._sb=[]}else do d.__d=!1,_&&_(e),c=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++R<25);d.state=d.__s,d.getChildContext!=null&&(n=br(br({},n),d.getChildContext())),u||d.getSnapshotBeforeUpdate==null||(y=d.getSnapshotBeforeUpdate(p,m)),M=c!=null&&c.type===oe&&c.key==null?c.props.children:c,YD(i,Array.isArray(M)?M:[M],e,t,n,s,r,o,a,l),d.base=e.__e,e.__h=null,d.__h.length&&o.push(d),v&&(d.__E=d.__=null),d.__e=!1}else r==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=cB(t.__e,e,t,n,s,r,o,l);(c=W.diffed)&&c(e)}catch(N){e.__v=null,(l||r!=null)&&(e.__e=a,e.__h=!!l,r[r.indexOf(a)]=null),W.__e(N,e,t)}}function ZD(i,e){W.__c&&W.__c(e,i),i.some(function(t){try{i=t.__h,t.__h=[],i.some(function(n){n.call(t)})}catch(n){W.__e(n,t.__v)}})}function cB(i,e,t,n,s,r,o,a){var l,c,d,u=t.props,p=e.props,m=e.type,y=0;if(m==="svg"&&(s=!0),r!=null){for(;y<r.length;y++)if((l=r[y])&&"setAttribute"in l==!!m&&(m?l.localName===m:l.nodeType===3)){i=l,r[y]=null;break}}if(i==null){if(m===null)return document.createTextNode(p);i=s?document.createElementNS("http://www.w3.org/2000/svg",m):document.createElement(m,p.is&&p),r=null,a=!1}if(m===null)u===p||a&&i.data===p||(i.data=p);else{if(r=r&&Pv.call(i.childNodes),c=(u=t.props||Dv).dangerouslySetInnerHTML,d=p.dangerouslySetInnerHTML,!a){if(r!=null)for(u={},y=0;y<i.attributes.length;y++)u[i.attributes[y].name]=i.attributes[y].value;(d||c)&&(d&&(c&&d.__html==c.__html||d.__html===i.innerHTML)||(i.innerHTML=d&&d.__html||""))}if(aB(i,p,u,s,a),d)e.__k=[];else if(y=e.props.children,YD(i,Array.isArray(y)?y:[y],e,t,n,s&&m!=="foreignObject",r,o,r?r[0]:t.__k&&ff(t,0),a),r!=null)for(y=r.length;y--;)r[y]!=null&&WD(r[y]);a||("value"in p&&(y=p.value)!==void 0&&(y!==i.value||m==="progress"&&!y||m==="option"&&y!==u.value)&&Iv(i,"value",y,u.value,!1),"checked"in p&&(y=p.checked)!==void 0&&y!==i.checked&&Iv(i,"checked",y,u.checked,!1))}return i}function jD(i,e,t){try{typeof i=="function"?i(e):i.current=e}catch(n){W.__e(n,t)}}function QD(i,e,t){var n,s;if(W.unmount&&W.unmount(i),(n=i.ref)&&(n.current&&n.current!==i.__e||jD(n,null,e)),(n=i.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(r){W.__e(r,e)}n.base=n.__P=null,i.__c=void 0}if(n=i.__k)for(s=0;s<n.length;s++)n[s]&&QD(n[s],e,t||typeof i.type!="function");t||i.__e==null||WD(i.__e),i.__=i.__e=i.__d=void 0}function dB(i,e,t){return this.constructor(i,t)}function Er(i,e,t){var n,s,r;W.__&&W.__(i,e),s=(n=typeof t=="function")?null:t&&t.__k||e.__k,r=[],FA(e,i=(!n&&t||e).__k=x(oe,null,[i]),s||Dv,Dv,e.ownerSVGElement!==void 0,!n&&t?[t]:s?null:e.firstChild?Pv.call(e.childNodes):null,r,!n&&t?t:s?s.__e:e.firstChild,n),ZD(r,i)}function kv(i,e){var t={__c:e="__cC"+GD++,__:i,Consumer:function(n,s){return n.children(s)},Provider:function(n){var s,r;return this.getChildContext||(s=[],(r={})[e]=this,this.getChildContext=function(){return r},this.shouldComponentUpdate=function(o){this.props.value!==o.value&&s.some(function(a){a.__e=!0,kA(a)})},this.sub=function(o){s.push(o);var a=o.componentWillUnmount;o.componentWillUnmount=function(){s.splice(s.indexOf(o),1),a&&a.call(o)}}),n.children}};return t.Provider.__=t.Consumer.contextType=t}Pv=zD.slice,W={__e:function(i,e,t,n){for(var s,r,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((r=s.constructor)&&r.getDerivedStateFromError!=null&&(s.setState(r.getDerivedStateFromError(i)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(i,n||{}),o=s.__d),o)return s.__E=s}catch(a){i=a}throw i}},$D=0,NA=function(i){return i!=null&&i.constructor===void 0},Uc=!1,rt.prototype.setState=function(i,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=br({},this.state),typeof i=="function"&&(i=i(br({},t),this.props)),i&&br(t,i),i!=null&&this.__v&&(e&&this._sb.push(e),kA(this))},rt.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),kA(this))},rt.prototype.render=oe,fa=[],VD=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Mv.__r=0,GD=0;var hB,Ci,LA,eI;var aI=[],OA=[],tI=W.__b,nI=W.__r,iI=W.diffed,sI=W.__c,rI=W.unmount;function fB(){for(var i;i=aI.shift();)if(i.__P&&i.__H)try{i.__H.__h.forEach(Nv),i.__H.__h.forEach(UA),i.__H.__h=[]}catch(e){i.__H.__h=[],W.__e(e,i.__v)}}W.__b=function(i){Ci=null,tI&&tI(i)},W.__r=function(i){nI&&nI(i),hB=0;var e=(Ci=i.__c).__H;e&&(LA===Ci?(e.__h=[],Ci.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.__V=OA,t.__N=t.i=void 0})):(e.__h.forEach(Nv),e.__h.forEach(UA),e.__h=[])),LA=Ci},W.diffed=function(i){iI&&iI(i);var e=i.__c;e&&e.__H&&(e.__H.__h.length&&(aI.push(e)!==1&&eI===W.requestAnimationFrame||((eI=W.requestAnimationFrame)||pB)(fB)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.__V!==OA&&(t.__=t.__V),t.i=void 0,t.__V=OA})),LA=Ci=null},W.__c=function(i,e){e.some(function(t){try{t.__h.forEach(Nv),t.__h=t.__h.filter(function(n){return!n.__||UA(n)})}catch(n){e.some(function(s){s.__h&&(s.__h=[])}),e=[],W.__e(n,t.__v)}}),sI&&sI(i,e)},W.unmount=function(i){rI&&rI(i);var e,t=i.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{Nv(n)}catch(s){e=s}}),t.__H=void 0,e&&W.__e(e,t.__v))};var oI=typeof requestAnimationFrame=="function";function pB(i){var e,t=function(){clearTimeout(n),oI&&cancelAnimationFrame(e),setTimeout(i)},n=setTimeout(t,100);oI&&(e=requestAnimationFrame(t))}function Nv(i){var e=Ci,t=i.__c;typeof t=="function"&&(i.__c=void 0,t()),Ci=e}function UA(i){var e=Ci;i.__c=i.__(),Ci=e}function gB(i,e){for(var t in e)i[t]=e[t];return i}function lI(i,e){for(var t in i)if(t!=="__source"&&!(t in e))return!0;for(var n in e)if(n!=="__source"&&i[n]!==e[n])return!0;return!1}function cI(i){this.props=i}(cI.prototype=new rt).isPureReactComponent=!0,cI.prototype.shouldComponentUpdate=function(i,e){return lI(this.props,i)||lI(this.state,e)};var dI=W.__b;W.__b=function(i){i.type&&i.type.__f&&i.ref&&(i.props.ref=i.ref,i.ref=null),dI&&dI(i)};var pq=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;var mB=W.__e;W.__e=function(i,e,t,n){if(i.then){for(var s,r=e;r=r.__;)if((s=r.__c)&&s.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),s.__c(i,e)}mB(i,e,t,n)};var uI=W.unmount;function yI(i,e,t){return i&&(i.__c&&i.__c.__H&&(i.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),i.__c.__H=null),(i=gB({},i)).__c!=null&&(i.__c.__P===t&&(i.__c.__P=e),i.__c=null),i.__k=i.__k&&i.__k.map(function(n){return yI(n,e,t)})),i}function vI(i,e,t){return i&&(i.__v=null,i.__k=i.__k&&i.__k.map(function(n){return vI(n,e,t)}),i.__c&&i.__c.__P===e&&(i.__e&&t.insertBefore(i.__e,i.__d),i.__c.__e=!0,i.__c.__P=t)),i}function BA(){this.__u=0,this.t=null,this.__b=null}function bI(i){var e=i.__.__c;return e&&e.__a&&e.__a(i)}function Fv(){this.u=null,this.o=null}W.unmount=function(i){var e=i.__c;e&&e.__R&&e.__R(),e&&i.__h===!0&&(i.type=null),uI&&uI(i)},(BA.prototype=new rt).__c=function(i,e){var t=e.__c,n=this;n.t==null&&(n.t=[]),n.t.push(t);var s=bI(n.__v),r=!1,o=function(){r||(r=!0,t.__R=null,s?s(a):a())};t.__R=o;var a=function(){if(!--n.__u){if(n.state.__a){var c=n.state.__a;n.__v.__k[0]=vI(c,c.__c.__P,c.__c.__O)}var d;for(n.setState({__a:n.__b=null});d=n.t.pop();)d.forceUpdate()}},l=e.__h===!0;n.__u++||l||n.setState({__a:n.__b=n.__v.__k[0]}),i.then(o,o)},BA.prototype.componentWillUnmount=function(){this.t=[]},BA.prototype.render=function(i,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=yI(this.__b,t,n.__O=n.__P)}this.__b=null}var s=e.__a&&x(oe,null,i.fallback);return s&&(s.__h=null),[x(oe,null,e.__a?null:i.children),s]};var hI=function(i,e,t){if(++t[1]===t[0]&&i.o.delete(e),i.props.revealOrder&&(i.props.revealOrder[0]!=="t"||!i.o.size))for(t=i.u;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;i.u=t=t[2]}};function yB(i){return this.getChildContext=function(){return i.context},i.children}function vB(i){var e=this,t=i.i;e.componentWillUnmount=function(){Er(null,e.l),e.l=null,e.i=null},e.i&&e.i!==t&&e.componentWillUnmount(),i.__v?(e.l||(e.i=t,e.l={nodeType:1,parentNode:t,childNodes:[],appendChild:function(n){this.childNodes.push(n),e.i.appendChild(n)},insertBefore:function(n,s){this.childNodes.push(n),e.i.appendChild(n)},removeChild:function(n){this.childNodes.splice(this.childNodes.indexOf(n)>>>1,1),e.i.removeChild(n)}}),Er(x(yB,{context:e.context},i.__v),e.l)):e.l&&e.componentWillUnmount()}function EI(i,e){var t=x(vB,{__v:i,i:e});return t.containerInfo=e,t}(Fv.prototype=new rt).__a=function(i){var e=this,t=bI(e.__v),n=e.o.get(i);return n[0]++,function(s){var r=function(){e.props.revealOrder?(n.push(s),hI(e,i,n)):s()};t?t(r):r()}},Fv.prototype.render=function(i){this.u=null,this.o=new Map;var e=pf(i.children);i.revealOrder&&i.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.o.set(e[t],this.u=[1,0,this.u]);return i.children},Fv.prototype.componentDidUpdate=Fv.prototype.componentDidMount=function(){var i=this;this.o.forEach(function(e,t){hI(i,t,e)})};var bB=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,EB=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,SB=typeof document<"u",wB=function(i){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(i)};rt.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(i){Object.defineProperty(rt.prototype,i,{configurable:!0,get:function(){return this["UNSAFE_"+i]},set:function(e){Object.defineProperty(this,i,{configurable:!0,writable:!0,value:e})}})});var fI=W.event;function AB(){}function CB(){return this.cancelBubble}function TB(){return this.defaultPrevented}W.event=function(i){return fI&&(i=fI(i)),i.persist=AB,i.isPropagationStopped=CB,i.isDefaultPrevented=TB,i.nativeEvent=i};var _B,pI={configurable:!0,get:function(){return this.class}},gI=W.vnode;W.vnode=function(i){var e=i.type,t=i.props,n=t;if(typeof e=="string"){var s=e.indexOf("-")===-1;for(var r in n={},t){var o=t[r];SB&&r==="children"&&e==="noscript"||r==="value"&&"defaultValue"in t&&o==null||(r==="defaultValue"&&"value"in t&&t.value==null?r="value":r==="download"&&o===!0?o="":/ondoubleclick/i.test(r)?r="ondblclick":/^onchange(textarea|input)/i.test(r+e)&&!wB(t.type)?r="oninput":/^onfocus$/i.test(r)?r="onfocusin":/^onblur$/i.test(r)?r="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(r)?r=r.toLowerCase():s&&EB.test(r)?r=r.replace(/[A-Z0-9]/g,"-$&").toLowerCase():o===null&&(o=void 0),/^oninput$/i.test(r)&&(r=r.toLowerCase(),n[r]&&(r="oninputCapture")),n[r]=o)}e=="select"&&n.multiple&&Array.isArray(n.value)&&(n.value=pf(t.children).forEach(function(a){a.props.selected=n.value.indexOf(a.props.value)!=-1})),e=="select"&&n.defaultValue!=null&&(n.value=pf(t.children).forEach(function(a){a.props.selected=n.multiple?n.defaultValue.indexOf(a.props.value)!=-1:n.defaultValue==a.props.value})),i.props=n,t.class!=t.className&&(pI.enumerable="className"in t,t.className!=null&&(n.class=t.className),Object.defineProperty(n,"className",pI))}i.$$typeof=bB,gI&&gI(i)};var mI=W.__r;W.__r=function(i){mI&&mI(i),_B=i.__c};var NI=[],JA=new Map;function Rr(i){NI.push(i),JA.forEach(e=>{OI(e,i)})}function FI(i){i.isConnected&&i.getRootNode&&LI(i.getRootNode())}function LI(i){let e=JA.get(i);if(!e||!e.isConnected){if(e=i.querySelector("style[data-fullcalendar]"),!e){e=document.createElement("style"),e.setAttribute("data-fullcalendar","");let t=RB();t&&(e.nonce=t);let n=i===document?document.head:i,s=i===document?n.querySelector("script,link[rel=stylesheet],link[as=style],style"):n.firstChild;n.insertBefore(e,s)}JA.set(i,e),xB(e)}}function xB(i){for(let e of NI)OI(i,e)}function OI(i,e){let{sheet:t}=i,n=t.cssRules.length;e.split("}").forEach((s,r)=>{s=s.trim(),s&&t.insertRule(s+"}",n+r)})}var HA;function RB(){return HA===void 0&&(HA=DB()),HA}function DB(){let i=document.querySelector('meta[name="csp-nonce"]');if(i&&i.hasAttribute("content"))return i.getAttribute("content");let e=document.querySelector("script[nonce]");return e&&e.nonce||""}typeof document<"u"&&LI(document);var IB=':root{--fc-small-font-size:.85em;--fc-page-bg-color:#fff;--fc-neutral-bg-color:hsla(0,0%,82%,.3);--fc-neutral-text-color:grey;--fc-border-color:#ddd;--fc-button-text-color:#fff;--fc-button-bg-color:#2c3e50;--fc-button-border-color:#2c3e50;--fc-button-hover-bg-color:#1e2b37;--fc-button-hover-border-color:#1a252f;--fc-button-active-bg-color:#1a252f;--fc-button-active-border-color:#151e27;--fc-event-bg-color:#3788d8;--fc-event-border-color:#3788d8;--fc-event-text-color:#fff;--fc-event-selected-overlay-color:rgba(0,0,0,.25);--fc-more-link-bg-color:#d0d0d0;--fc-more-link-text-color:inherit;--fc-event-resizer-thickness:8px;--fc-event-resizer-dot-total-width:8px;--fc-event-resizer-dot-border-width:1px;--fc-non-business-color:hsla(0,0%,84%,.3);--fc-bg-event-color:#8fdf82;--fc-bg-event-opacity:0.3;--fc-highlight-color:rgba(188,232,241,.3);--fc-today-bg-color:rgba(255,220,40,.15);--fc-now-indicator-color:red}.fc-not-allowed,.fc-not-allowed .fc-event{cursor:not-allowed}.fc{display:flex;flex-direction:column;font-size:1em}.fc,.fc *,.fc :after,.fc :before{box-sizing:border-box}.fc table{border-collapse:collapse;border-spacing:0;font-size:1em}.fc th{text-align:center}.fc td,.fc th{padding:0;vertical-align:top}.fc a[data-navlink]{cursor:pointer}.fc a[data-navlink]:hover{text-decoration:underline}.fc-direction-ltr{direction:ltr;text-align:left}.fc-direction-rtl{direction:rtl;text-align:right}.fc-theme-standard td,.fc-theme-standard th{border:1px solid var(--fc-border-color)}.fc-liquid-hack td,.fc-liquid-hack th{position:relative}@font-face{font-family:fcicons;font-style:normal;font-weight:400;src:url("data:application/x-font-ttf;charset=utf-8;base64,AAEAAAALAIAAAwAwT1MvMg8SBfAAAAC8AAAAYGNtYXAXVtKNAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZgYydxIAAAF4AAAFNGhlYWQUJ7cIAAAGrAAAADZoaGVhB20DzAAABuQAAAAkaG10eCIABhQAAAcIAAAALGxvY2ED4AU6AAAHNAAAABhtYXhwAA8AjAAAB0wAAAAgbmFtZXsr690AAAdsAAABhnBvc3QAAwAAAAAI9AAAACAAAwPAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBgPA/8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qb//f//AAAAAAAg6QD//f//AAH/4xcEAAMAAQAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAWIAjQKeAskAEwAAJSc3NjQnJiIHAQYUFwEWMjc2NCcCnuLiDQ0MJAz/AA0NAQAMJAwNDcni4gwjDQwM/wANIwz/AA0NDCMNAAAAAQFiAI0CngLJABMAACUBNjQnASYiBwYUHwEHBhQXFjI3AZ4BAA0N/wAMJAwNDeLiDQ0MJAyNAQAMIw0BAAwMDSMM4uINIwwNDQAAAAIA4gC3Ax4CngATACcAACUnNzY0JyYiDwEGFB8BFjI3NjQnISc3NjQnJiIPAQYUHwEWMjc2NCcB87e3DQ0MIw3VDQ3VDSMMDQ0BK7e3DQ0MJAzVDQ3VDCQMDQ3zuLcMJAwNDdUNIwzWDAwNIwy4twwkDA0N1Q0jDNYMDA0jDAAAAgDiALcDHgKeABMAJwAAJTc2NC8BJiIHBhQfAQcGFBcWMjchNzY0LwEmIgcGFB8BBwYUFxYyNwJJ1Q0N1Q0jDA0Nt7cNDQwjDf7V1Q0N1QwkDA0Nt7cNDQwkDLfWDCMN1Q0NDCQMt7gMIw0MDNYMIw3VDQ0MJAy3uAwjDQwMAAADAFUAAAOrA1UAMwBoAHcAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMhMjY1NCYjISIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAAVYRGRkR/qoRGRkRA1UFBAUOCQkVDAsZDf2rDRkLDBUJCA4FBQUFBQUOCQgVDAsZDQJVDRkLDBUJCQ4FBAVVAgECBQMCBwQECAX9qwQJAwQHAwMFAQICAgIBBQMDBwQDCQQCVQUIBAQHAgMFAgEC/oAZEhEZGRESGQAAAAADAFUAAAOrA1UAMwBoAIkAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMzFRQWMzI2PQEzMjY1NCYrATU0JiMiBh0BIyIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAgBkSEhmAERkZEYAZEhIZgBEZGREDVQUEBQ4JCRUMCxkN/asNGQsMFQkIDgUFBQUFBQ4JCBUMCxkNAlUNGQsMFQkJDgUEBVUCAQIFAwIHBAQIBf2rBAkDBAcDAwUBAgICAgEFAwMHBAMJBAJVBQgEBAcCAwUCAQL+gIASGRkSgBkSERmAEhkZEoAZERIZAAABAOIAjQMeAskAIAAAExcHBhQXFjI/ARcWMjc2NC8BNzY0JyYiDwEnJiIHBhQX4uLiDQ0MJAzi4gwkDA0N4uINDQwkDOLiDCQMDQ0CjeLiDSMMDQ3h4Q0NDCMN4uIMIw0MDOLiDAwNIwwAAAABAAAAAQAAa5n0y18PPPUACwQAAAAAANivOVsAAAAA2K85WwAAAAADqwNVAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAOrAAEAAAAAAAAAAAAAAAAAAAALBAAAAAAAAAAAAAAAAgAAAAQAAWIEAAFiBAAA4gQAAOIEAABVBAAAVQQAAOIAAAAAAAoAFAAeAEQAagCqAOoBngJkApoAAQAAAAsAigADAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGZjaWNvbnMAZgBjAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGZjaWNvbnMAZgBjAGkAYwBvAG4Ac2ZjaWNvbnMAZgBjAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmZjaWNvbnMAZgBjAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("truetype")}.fc-icon{speak:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font-family:fcicons!important;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1;text-align:center;text-transform:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1em}.fc-icon-chevron-left:before{content:"\\e900"}.fc-icon-chevron-right:before{content:"\\e901"}.fc-icon-chevrons-left:before{content:"\\e902"}.fc-icon-chevrons-right:before{content:"\\e903"}.fc-icon-minus-square:before{content:"\\e904"}.fc-icon-plus-square:before{content:"\\e905"}.fc-icon-x:before{content:"\\e906"}.fc .fc-button{border-radius:0;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible;text-transform:none}.fc .fc-button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}.fc .fc-button{-webkit-appearance:button}.fc .fc-button:not(:disabled){cursor:pointer}.fc .fc-button{background-color:transparent;border:1px solid transparent;border-radius:.25em;display:inline-block;font-size:1em;font-weight:400;line-height:1.5;padding:.4em .65em;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}.fc .fc-button:hover{text-decoration:none}.fc .fc-button:focus{box-shadow:0 0 0 .2rem rgba(44,62,80,.25);outline:0}.fc .fc-button:disabled{opacity:.65}.fc .fc-button-primary{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:hover{background-color:var(--fc-button-hover-bg-color);border-color:var(--fc-button-hover-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:disabled{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button-primary:not(:disabled).fc-button-active,.fc .fc-button-primary:not(:disabled):active{background-color:var(--fc-button-active-bg-color);border-color:var(--fc-button-active-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:not(:disabled).fc-button-active:focus,.fc .fc-button-primary:not(:disabled):active:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button .fc-icon{font-size:1.5em;vertical-align:middle}.fc .fc-button-group{display:inline-flex;position:relative;vertical-align:middle}.fc .fc-button-group>.fc-button{flex:1 1 auto;position:relative}.fc .fc-button-group>.fc-button.fc-button-active,.fc .fc-button-group>.fc-button:active,.fc .fc-button-group>.fc-button:focus,.fc .fc-button-group>.fc-button:hover{z-index:1}.fc-direction-ltr .fc-button-group>.fc-button:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0;margin-left:-1px}.fc-direction-ltr .fc-button-group>.fc-button:not(:last-child){border-bottom-right-radius:0;border-top-right-radius:0}.fc-direction-rtl .fc-button-group>.fc-button:not(:first-child){border-bottom-right-radius:0;border-top-right-radius:0;margin-right:-1px}.fc-direction-rtl .fc-button-group>.fc-button:not(:last-child){border-bottom-left-radius:0;border-top-left-radius:0}.fc .fc-toolbar{align-items:center;display:flex;justify-content:space-between}.fc .fc-toolbar.fc-header-toolbar{margin-bottom:1.5em}.fc .fc-toolbar.fc-footer-toolbar{margin-top:1.5em}.fc .fc-toolbar-title{font-size:1.75em;margin:0}.fc-direction-ltr .fc-toolbar>*>:not(:first-child){margin-left:.75em}.fc-direction-rtl .fc-toolbar>*>:not(:first-child){margin-right:.75em}.fc-direction-rtl .fc-toolbar-ltr{flex-direction:row-reverse}.fc .fc-scroller{-webkit-overflow-scrolling:touch;position:relative}.fc .fc-scroller-liquid{height:100%}.fc .fc-scroller-liquid-absolute{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-scroller-harness{direction:ltr;overflow:hidden;position:relative}.fc .fc-scroller-harness-liquid{height:100%}.fc-direction-rtl .fc-scroller-harness>.fc-scroller{direction:rtl}.fc-theme-standard .fc-scrollgrid{border:1px solid var(--fc-border-color)}.fc .fc-scrollgrid,.fc .fc-scrollgrid table{table-layout:fixed;width:100%}.fc .fc-scrollgrid table{border-left-style:hidden;border-right-style:hidden;border-top-style:hidden}.fc .fc-scrollgrid{border-bottom-width:0;border-collapse:separate;border-right-width:0}.fc .fc-scrollgrid-liquid{height:100%}.fc .fc-scrollgrid-section,.fc .fc-scrollgrid-section table,.fc .fc-scrollgrid-section>td{height:1px}.fc .fc-scrollgrid-section-liquid>td{height:100%}.fc .fc-scrollgrid-section>*{border-left-width:0;border-top-width:0}.fc .fc-scrollgrid-section-footer>*,.fc .fc-scrollgrid-section-header>*{border-bottom-width:0}.fc .fc-scrollgrid-section-body table,.fc .fc-scrollgrid-section-footer table{border-bottom-style:hidden}.fc .fc-scrollgrid-section-sticky>*{background:var(--fc-page-bg-color);position:sticky;z-index:3}.fc .fc-scrollgrid-section-header.fc-scrollgrid-section-sticky>*{top:0}.fc .fc-scrollgrid-section-footer.fc-scrollgrid-section-sticky>*{bottom:0}.fc .fc-scrollgrid-sticky-shim{height:1px;margin-bottom:-1px}.fc-sticky{position:sticky}.fc .fc-view-harness{flex-grow:1;position:relative}.fc .fc-view-harness-active>.fc-view{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-col-header-cell-cushion{display:inline-block;padding:2px 4px}.fc .fc-bg-event,.fc .fc-highlight,.fc .fc-non-business{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-non-business{background:var(--fc-non-business-color)}.fc .fc-bg-event{background:var(--fc-bg-event-color);opacity:var(--fc-bg-event-opacity)}.fc .fc-bg-event .fc-event-title{font-size:var(--fc-small-font-size);font-style:italic;margin:.5em}.fc .fc-highlight{background:var(--fc-highlight-color)}.fc .fc-cell-shaded,.fc .fc-day-disabled{background:var(--fc-neutral-bg-color)}a.fc-event,a.fc-event:hover{text-decoration:none}.fc-event.fc-event-draggable,.fc-event[href]{cursor:pointer}.fc-event .fc-event-main{position:relative;z-index:2}.fc-event-dragging:not(.fc-event-selected){opacity:.75}.fc-event-dragging.fc-event-selected{box-shadow:0 2px 7px rgba(0,0,0,.3)}.fc-event .fc-event-resizer{display:none;position:absolute;z-index:4}.fc-event-selected .fc-event-resizer,.fc-event:hover .fc-event-resizer{display:block}.fc-event-selected .fc-event-resizer{background:var(--fc-page-bg-color);border-color:inherit;border-radius:calc(var(--fc-event-resizer-dot-total-width)/2);border-style:solid;border-width:var(--fc-event-resizer-dot-border-width);height:var(--fc-event-resizer-dot-total-width);width:var(--fc-event-resizer-dot-total-width)}.fc-event-selected .fc-event-resizer:before{bottom:-20px;content:"";left:-20px;position:absolute;right:-20px;top:-20px}.fc-event-selected,.fc-event:focus{box-shadow:0 2px 5px rgba(0,0,0,.2)}.fc-event-selected:before,.fc-event:focus:before{bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3}.fc-event-selected:after,.fc-event:focus:after{background:var(--fc-event-selected-overlay-color);bottom:-1px;content:"";left:-1px;position:absolute;right:-1px;top:-1px;z-index:1}.fc-h-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-h-event .fc-event-main{color:var(--fc-event-text-color)}.fc-h-event .fc-event-main-frame{display:flex}.fc-h-event .fc-event-time{max-width:100%;overflow:hidden}.fc-h-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-width:0}.fc-h-event .fc-event-title{display:inline-block;left:0;max-width:100%;overflow:hidden;right:0;vertical-align:top}.fc-h-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-start),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-end){border-bottom-left-radius:0;border-left-width:0;border-top-left-radius:0}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-end),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-start){border-bottom-right-radius:0;border-right-width:0;border-top-right-radius:0}.fc-h-event:not(.fc-event-selected) .fc-event-resizer{bottom:0;top:0;width:var(--fc-event-resizer-thickness)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end{cursor:w-resize;left:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start{cursor:e-resize;right:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-h-event.fc-event-selected .fc-event-resizer{margin-top:calc(var(--fc-event-resizer-dot-total-width)*-.5);top:50%}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-start,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-end{left:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-end,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-start{right:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc .fc-popover{box-shadow:0 2px 6px rgba(0,0,0,.15);position:absolute;z-index:9999}.fc .fc-popover-header{align-items:center;display:flex;flex-direction:row;justify-content:space-between;padding:3px 4px}.fc .fc-popover-title{margin:0 2px}.fc .fc-popover-close{cursor:pointer;font-size:1.1em;opacity:.65}.fc-theme-standard .fc-popover{background:var(--fc-page-bg-color);border:1px solid var(--fc-border-color)}.fc-theme-standard .fc-popover-header{background:var(--fc-neutral-bg-color)}';Rr(IB);var ma=class{constructor(e){this.drainedOption=e,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}request(e){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),e==null?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),e))}pause(e=""){let{pauseDepths:t}=this;t[e]=(t[e]||0)+1,this.clearTimeout()}resume(e="",t){let{pauseDepths:n}=this;e in n&&(t?delete n[e]:(n[e]-=1,n[e]<=0&&delete n[e]),this.tryDrain())}isPaused(){return Object.keys(this.pauseDepths).length}tryDrain(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}}clear(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)}drained(){this.drainedOption&&this.drainedOption()}};function Mf(i){i.parentNode&&i.parentNode.removeChild(i)}function Ge(i,e){if(i.closest)return i.closest(e);if(!document.documentElement.contains(i))return null;do{if(oC(i,e))return i;i=i.parentElement||i.parentNode}while(i!==null&&i.nodeType===1);return null}function oC(i,e){return(i.matches||i.matchesSelector||i.msMatchesSelector).call(i,e)}function UI(i,e){let t=i instanceof HTMLElement?[i]:i,n=[];for(let s=0;s<t.length;s+=1){let r=t[s].querySelectorAll(e);for(let o=0;o<r.length;o+=1)n.push(r[o])}return n}var MB=/(top|left|right|bottom|width|height)$/i;function xa(i,e){for(let t in e)aC(i,t,e[t])}function aC(i,e,t){t==null?i.style[e]="":typeof t=="number"&&MB.test(e)?i.style[e]=`${t}px`:i.style[e]=t}function Qv(i){var e,t;return(t=(e=i.composedPath)===null||e===void 0?void 0:e.call(i)[0])!==null&&t!==void 0?t:i.target}var SI=0;function An(){return SI+=1,"fc-dom-"+SI}function Pf(i){i.preventDefault()}function PB(i,e){return t=>{let n=Ge(t.target,i);n&&e.call(n,t,n)}}function lC(i,e,t,n){let s=PB(t,n);return i.addEventListener(e,s),()=>{i.removeEventListener(e,s)}}function BI(i,e,t,n){let s;return lC(i,"mouseover",e,(r,o)=>{if(o!==s){s=o,t(r,o);let a=l=>{s=null,n(l,o),o.removeEventListener("mouseleave",a)};o.addEventListener("mouseleave",a)}})}var wI=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"];function cC(i,e){let t=n=>{e(n),wI.forEach(s=>{i.removeEventListener(s,t)})};wI.forEach(n=>{i.addEventListener(n,t)})}function HI(i){return Object.assign({onClick:i},$I(i))}function $I(i){return{tabIndex:0,onKeyDown(e){(e.key==="Enter"||e.key===" ")&&(i(e),e.preventDefault())}}}var AI=0;function ws(){return AI+=1,String(AI)}function kf(){document.body.classList.add("fc-not-allowed")}function Nf(){document.body.classList.remove("fc-not-allowed")}function dC(i){i.style.userSelect="none",i.style.webkitUserSelect="none",i.addEventListener("selectstart",Pf)}function uC(i){i.style.userSelect="",i.style.webkitUserSelect="",i.removeEventListener("selectstart",Pf)}function hC(i){i.addEventListener("contextmenu",Pf)}function fC(i){i.removeEventListener("contextmenu",Pf)}function VI(i){let e=[],t=[],n,s;for(typeof i=="string"?t=i.split(/\s*,\s*/):typeof i=="function"?t=[i]:Array.isArray(i)&&(t=i),n=0;n<t.length;n+=1)s=t[n],typeof s=="string"?e.push(s.charAt(0)==="-"?{field:s.substring(1),order:-1}:{field:s,order:1}):typeof s=="function"&&e.push({func:s});return e}function GI(i,e,t){let n,s;for(n=0;n<t.length;n+=1)if(s=kB(i,e,t[n]),s)return s;return 0}function kB(i,e,t){return t.func?t.func(i,e):zI(i[t.field],e[t.field])*(t.order||1)}function zI(i,e){return!i&&!e?0:e==null?-1:i==null?1:typeof i=="string"||typeof e=="string"?String(i).localeCompare(String(e)):i-e}function ga(i,e){let t=String(i);return"000".substr(0,e-t.length)+t}function Gc(i,e,t){return typeof i=="function"?i(...e):typeof i=="string"?e.reduce((n,s,r)=>n.replace("$"+r,s||""),i):t}function pC(i,e){return i-e}function gf(i){return i%1===0}function NB(i){let e=i.querySelector(".fc-scrollgrid-shrink-frame"),t=i.querySelector(".fc-scrollgrid-shrink-cushion");if(!e)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!t)throw new Error("needs fc-scrollgrid-shrink-cushion className");return i.getBoundingClientRect().width-e.getBoundingClientRect().width+t.getBoundingClientRect().width}var CI=["years","months","days","milliseconds"],FB=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function ee(i,e){return typeof i=="string"?LB(i):typeof i=="object"&&i?TI(i):typeof i=="number"?TI({[e||"milliseconds"]:i}):null}function LB(i){let e=FB.exec(i);if(e){let t=e[1]?-1:1;return{years:0,months:0,days:t*(e[2]?parseInt(e[2],10):0),milliseconds:t*((e[3]?parseInt(e[3],10):0)*60*60*1e3+(e[4]?parseInt(e[4],10):0)*60*1e3+(e[5]?parseInt(e[5],10):0)*1e3+(e[6]?parseInt(e[6],10):0))}}return null}function TI(i){let e={years:i.years||i.year||0,months:i.months||i.month||0,days:i.days||i.day||0,milliseconds:(i.hours||i.hour||0)*60*60*1e3+(i.minutes||i.minute||0)*60*1e3+(i.seconds||i.second||0)*1e3+(i.milliseconds||i.millisecond||i.ms||0)},t=i.weeks||i.week;return t&&(e.days+=t*7,e.specifiedWeeks=!0),e}function OB(i,e){return i.years===e.years&&i.months===e.months&&i.days===e.days&&i.milliseconds===e.milliseconds}function Ff(i,e){return{years:i.years+e.years,months:i.months+e.months,days:i.days+e.days,milliseconds:i.milliseconds+e.milliseconds}}function WI(i,e){return{years:i.years-e.years,months:i.months-e.months,days:i.days-e.days,milliseconds:i.milliseconds-e.milliseconds}}function gC(i,e){return{years:i.years*e,months:i.months*e,days:i.days*e,milliseconds:i.milliseconds*e}}function UB(i){return Bc(i)/365}function BB(i){return Bc(i)/30}function Bc(i){return rn(i)/864e5}function rn(i){return i.years*(365*864e5)+i.months*(30*864e5)+i.days*864e5+i.milliseconds}function Lf(i,e){let t=null;for(let n=0;n<CI.length;n+=1){let s=CI[n];if(e[s]){let r=i[s]/e[s];if(!gf(r)||t!==null&&t!==r)return null;t=r}else if(i[s])return null}return t}function mf(i){let e=i.milliseconds;if(e){if(e%1e3!==0)return{unit:"millisecond",value:e};if(e%(1e3*60)!==0)return{unit:"second",value:e/1e3};if(e%(1e3*60*60)!==0)return{unit:"minute",value:e/(1e3*60)};if(e)return{unit:"hour",value:e/(1e3*60*60)}}return i.days?i.specifiedWeeks&&i.days%7===0?{unit:"week",value:i.days/7}:{unit:"day",value:i.days}:i.months?{unit:"month",value:i.months}:i.years?{unit:"year",value:i.years}:{unit:"millisecond",value:0}}function Ri(i,e,t){if(i===e)return!0;let n=i.length,s;if(n!==e.length)return!1;for(s=0;s<n;s+=1)if(!(t?t(i[s],e[s]):i[s]===e[s]))return!1;return!0}var HB=["sun","mon","tue","wed","thu","fri","sat"];function eb(i,e){let t=wr(i);return t[2]+=e*7,Ot(t)}function we(i,e){let t=wr(i);return t[2]+=e,Ot(t)}function Ti(i,e){let t=wr(i);return t[6]+=e,Ot(t)}function mC(i,e){return Di(i,e)/7}function Di(i,e){return(e.valueOf()-i.valueOf())/(1e3*60*60*24)}function $B(i,e){return(e.valueOf()-i.valueOf())/(1e3*60*60)}function VB(i,e){return(e.valueOf()-i.valueOf())/(1e3*60)}function GB(i,e){return(e.valueOf()-i.valueOf())/1e3}function qI(i,e){let t=ue(i),n=ue(e);return{years:0,months:0,days:Math.round(Di(t,n)),milliseconds:e.valueOf()-n.valueOf()-(i.valueOf()-t.valueOf())}}function YI(i,e){let t=Hc(i,e);return t!==null&&t%7===0?t/7:null}function Hc(i,e){return Ar(i)===Ar(e)?Math.round(Di(i,e)):null}function ue(i){return Ot([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()])}function zB(i){return Ot([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours()])}function WB(i){return Ot([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes()])}function qB(i){return Ot([i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds()])}function YB(i,e,t){let n=i.getUTCFullYear(),s=$A(i,n,e,t);if(s<1)return $A(i,n-1,e,t);let r=$A(i,n+1,e,t);return r>=1?Math.min(s,r):s}function $A(i,e,t,n){let s=Ot([e,0,1+KB(e,t,n)]),r=ue(i),o=Math.round(Di(s,r));return Math.floor(o/7)+1}function KB(i,e,t){let n=7+e-t;return-((7+Ot([i,0,n]).getUTCDay()-e)%7)+n-1}function _I(i){return[i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()]}function xI(i){return new Date(i[0],i[1]||0,i[2]==null?1:i[2],i[3]||0,i[4]||0,i[5]||0)}function wr(i){return[i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds()]}function Ot(i){return i.length===1&&(i=i.concat([0])),new Date(Date.UTC(...i))}function yC(i){return!isNaN(i.valueOf())}function Ar(i){return i.getUTCHours()*1e3*60*60+i.getUTCMinutes()*1e3*60+i.getUTCSeconds()*1e3+i.getUTCMilliseconds()}function tb(i,e,t=!1){let n=i.toISOString();return n=n.replace(".000",""),t&&(n=n.replace("T00:00:00Z","")),n.length>10&&(e==null?n=n.replace("Z",""):e!==0&&(n=n.replace("Z",EC(e,!0)))),n}function Dr(i){return i.toISOString().replace(/T.*$/,"")}function vC(i){return i.toISOString().match(/^\d{4}-\d{2}/)[0]}function bC(i){return ga(i.getUTCHours(),2)+":"+ga(i.getUTCMinutes(),2)+":"+ga(i.getUTCSeconds(),2)}function EC(i,e=!1){let t=i<0?"-":"+",n=Math.abs(i),s=Math.floor(n/60),r=Math.round(n%60);return e?`${t+ga(s,2)}:${ga(r,2)}`:`GMT${t}${s}${r?`:${ga(r,2)}`:""}`}function z(i,e,t){let n,s;return function(...r){if(!n)s=i.apply(this,r);else if(!Ri(n,r)){t&&t(s);let o=i.apply(this,r);(!e||!e(o,s))&&(s=o)}return n=r,s}}function zc(i,e,t){let n,s;return r=>{if(!n)s=i.call(this,r);else if(!Ut(n,r)){t&&t(s);let o=i.call(this,r);(!e||!e(o,s))&&(s=o)}return n=r,s}}var VA={week:3,separator:9,omitZeroMinute:9,meridiem:9,omitCommas:9},Gv={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},Lv=/\s*([ap])\.?m\.?/i,XB=/,/g,JB=/\s+/g,ZB=/\u200e/g,jB=/UTC|GMT/,ZA=class{constructor(e){let t={},n={},s=9;for(let r in e)r in VA?(n[r]=e[r],VA[r]<9&&(s=Math.min(VA[r],s))):(t[r]=e[r],r in Gv&&(s=Math.min(Gv[r],s)));this.standardDateProps=t,this.extendedSettings=n,this.smallestUnitNum=s,this.buildFormattingFunc=z(RI)}format(e,t){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,t)(e)}formatRange(e,t,n,s){let{standardDateProps:r,extendedSettings:o}=this,a=sH(e.marker,t.marker,n.calendarSystem);if(!a)return this.format(e,n);let l=a;l>1&&(r.year==="numeric"||r.year==="2-digit")&&(r.month==="numeric"||r.month==="2-digit")&&(r.day==="numeric"||r.day==="2-digit")&&(l=1);let c=this.format(e,n),d=this.format(t,n);if(c===d)return c;let u=rH(r,l),p=RI(u,o,n),m=p(e),y=p(t),v=oH(c,m,d,y),b=o.separator||s||n.defaultSeparator||"";return v?v.before+m+b+y+v.after:c+b+d}getSmallestUnit(){switch(this.smallestUnitNum){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}}};function RI(i,e,t){let n=Object.keys(i).length;return n===1&&i.timeZoneName==="short"?s=>EC(s.timeZoneOffset):n===0&&e.week?s=>iH(t.computeWeekNumber(s.marker),t.weekText,t.weekTextLong,t.locale,e.week):QB(i,e,t)}function QB(i,e,t){i=Object.assign({},i),e=Object.assign({},e),eH(i,e),i.timeZone="UTC";let n=new Intl.DateTimeFormat(t.locale.codes,i),s;if(e.omitZeroMinute){let r=Object.assign({},i);delete r.minute,s=new Intl.DateTimeFormat(t.locale.codes,r)}return r=>{let{marker:o}=r,a;s&&!o.getUTCMinutes()?a=s:a=n;let l=a.format(o);return tH(l,r,i,e,t)}}function eH(i,e){i.timeZoneName&&(i.hour||(i.hour="2-digit"),i.minute||(i.minute="2-digit")),i.timeZoneName==="long"&&(i.timeZoneName="short"),e.omitZeroMinute&&(i.second||i.millisecond)&&delete e.omitZeroMinute}function tH(i,e,t,n,s){return i=i.replace(ZB,""),t.timeZoneName==="short"&&(i=nH(i,s.timeZone==="UTC"||e.timeZoneOffset==null?"UTC":EC(e.timeZoneOffset))),n.omitCommas&&(i=i.replace(XB,"").trim()),n.omitZeroMinute&&(i=i.replace(":00","")),n.meridiem===!1?i=i.replace(Lv,"").trim():n.meridiem==="narrow"?i=i.replace(Lv,(r,o)=>o.toLocaleLowerCase()):n.meridiem==="short"?i=i.replace(Lv,(r,o)=>`${o.toLocaleLowerCase()}m`):n.meridiem==="lowercase"&&(i=i.replace(Lv,r=>r.toLocaleLowerCase())),i=i.replace(JB," "),i=i.trim(),i}function nH(i,e){let t=!1;return i=i.replace(jB,()=>(t=!0,e)),t||(i+=` ${e}`),i}function iH(i,e,t,n,s){let r=[];return s==="long"?r.push(t):(s==="short"||s==="narrow")&&r.push(e),(s==="long"||s==="short")&&r.push(" "),r.push(n.simpleNumberFormat.format(i)),n.options.direction==="rtl"&&r.reverse(),r.join("")}function sH(i,e,t){return t.getMarkerYear(i)!==t.getMarkerYear(e)?5:t.getMarkerMonth(i)!==t.getMarkerMonth(e)?4:t.getMarkerDay(i)!==t.getMarkerDay(e)?2:Ar(i)!==Ar(e)?1:0}function rH(i,e){let t={};for(let n in i)(!(n in Gv)||Gv[n]<=e)&&(t[n]=i[n]);return t}function oH(i,e,t,n){let s=0;for(;s<i.length;){let r=i.indexOf(e,s);if(r===-1)break;let o=i.substr(0,r);s=r+e.length;let a=i.substr(s),l=0;for(;l<t.length;){let c=t.indexOf(n,l);if(c===-1)break;let d=t.substr(0,c);l=c+n.length;let u=t.substr(l);if(o===d&&a===u)return{before:o,after:a}}}return null}function DI(i,e){let t=e.markerToArray(i.marker);return{marker:i.marker,timeZoneOffset:i.timeZoneOffset,array:t,year:t[0],month:t[1],day:t[2],hour:t[3],minute:t[4],second:t[5],millisecond:t[6]}}function zv(i,e,t,n){let s=DI(i,t.calendarSystem),r=e?DI(e,t.calendarSystem):null;return{date:s,start:s,end:r,timeZone:t.timeZone,localeCodes:t.locale.codes,defaultSeparator:n||t.defaultSeparator}}var jA=class{constructor(e){this.cmdStr=e}format(e,t,n){return t.cmdFormatter(this.cmdStr,zv(e,null,t,n))}formatRange(e,t,n,s){return n.cmdFormatter(this.cmdStr,zv(e,t,n,s))}},QA=class{constructor(e){this.func=e}format(e,t,n){return this.func(zv(e,null,t,n))}formatRange(e,t,n,s){return this.func(zv(e,t,n,s))}};function he(i){return typeof i=="object"&&i?new ZA(i):typeof i=="string"?new jA(i):typeof i=="function"?new QA(i):null}var SC={navLinkDayClick:P,navLinkWeekClick:P,duration:ee,bootstrapFontAwesome:P,buttonIcons:P,customButtons:P,defaultAllDayEventDuration:ee,defaultTimedEventDuration:ee,nextDayThreshold:ee,scrollTime:ee,scrollTimeReset:Boolean,slotMinTime:ee,slotMaxTime:ee,dayPopoverFormat:he,slotDuration:ee,snapDuration:ee,headerToolbar:P,footerToolbar:P,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:he,dayHeaderClassNames:P,dayHeaderContent:P,dayHeaderDidMount:P,dayHeaderWillUnmount:P,dayCellClassNames:P,dayCellContent:P,dayCellDidMount:P,dayCellWillUnmount:P,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:P,weekNumbers:Boolean,weekNumberClassNames:P,weekNumberContent:P,weekNumberDidMount:P,weekNumberWillUnmount:P,editable:Boolean,viewClassNames:P,viewDidMount:P,viewWillUnmount:P,nowIndicator:Boolean,nowIndicatorSnap:P,nowIndicatorClassNames:P,nowIndicatorContent:P,nowIndicatorDidMount:P,nowIndicatorWillUnmount:P,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:P,locale:P,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:P,eventOrder:VI,eventOrderStrict:Boolean,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:P,contentHeight:P,direction:String,weekNumberFormat:he,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,weekTextLong:String,progressiveEventRendering:Boolean,businessHours:P,initialDate:P,now:P,eventDataTransform:P,stickyHeaderDates:P,stickyFooterScrollbar:P,viewHeight:P,defaultAllDay:Boolean,eventSourceFailure:P,eventSourceSuccess:P,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:P,eventConstraint:P,eventAllow:P,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:P,eventContent:P,eventDidMount:P,eventWillUnmount:P,selectConstraint:P,selectOverlap:P,selectAllow:P,droppable:Boolean,unselectCancel:String,slotLabelFormat:P,slotLaneClassNames:P,slotLaneContent:P,slotLaneDidMount:P,slotLaneWillUnmount:P,slotLabelClassNames:P,slotLabelContent:P,slotLabelDidMount:P,slotLabelWillUnmount:P,dayMaxEvents:P,dayMaxEventRows:P,dayMinWidth:Number,slotLabelInterval:ee,allDayText:String,allDayClassNames:P,allDayContent:P,allDayDidMount:P,allDayWillUnmount:P,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:he,rerenderDelay:Number,moreLinkText:P,moreLinkHint:P,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMaxStack:Number,eventMinHeight:Number,eventMinWidth:Number,eventShortHeight:Number,slotEventOverlap:Boolean,plugins:P,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:ee,hiddenDays:P,fixedWeekCount:Boolean,validRange:P,visibleRange:P,titleFormat:P,eventInteractive:Boolean,noEventsText:String,viewHint:P,navLinkHint:P,closeHint:String,timeHint:String,eventHint:String,moreLinkClick:P,moreLinkClassNames:P,moreLinkContent:P,moreLinkDidMount:P,moreLinkWillUnmount:P,monthStartFormat:he,handleCustomRendering:P,customRenderingMetaMap:P,customRenderingReplaces:Boolean},Ir={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:" \u2013 ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",scrollTimeReset:!0,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1,eventMinHeight:15,eventMinWidth:30,eventShortHeight:30,monthStartFormat:{month:"long",day:"numeric"},nowIndicatorSnap:"auto"},wC={datesSet:P,eventsSet:P,eventAdd:P,eventChange:P,eventRemove:P,windowResize:P,eventClick:P,eventMouseEnter:P,eventMouseLeave:P,select:P,unselect:P,loading:P,_unmount:P,_beforeprint:P,_afterprint:P,_noEventDrop:P,_noEventResize:P,_resize:P,_scrollRequest:P},AC={buttonText:P,buttonHints:P,views:P,plugins:P,initialEvents:P,events:P,eventSources:P},Mr={headerToolbar:pa,footerToolbar:pa,buttonText:pa,buttonHints:pa,buttonIcons:pa,dateIncrement:pa,plugins:Ov,events:Ov,eventSources:Ov,resources:Ov};function pa(i,e){return typeof i=="object"&&typeof e=="object"&&i&&e?Ut(i,e):i===e}function Ov(i,e){return Array.isArray(i)&&Array.isArray(e)?Ri(i,e):i===e}var KI={type:String,component:P,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:P,usesMinMaxTime:Boolean,classNames:P,content:P,didMount:P,willUnmount:P};function nb(i){return sb(i,Mr)}function ib(i,e){let t={},n={};for(let s in e)s in i&&(t[s]=e[s](i[s]));for(let s in i)s in e||(n[s]=i[s]);return{refined:t,extra:n}}function P(i){return i}var{hasOwnProperty:Wv}=Object.prototype;function sb(i,e){let t={};if(e){for(let n in e)if(e[n]===pa){let s=[];for(let r=i.length-1;r>=0;r-=1){let o=i[r][n];if(typeof o=="object"&&o)s.unshift(o);else if(o!==void 0){t[n]=o;break}}s.length&&(t[n]=sb(s))}}for(let n=i.length-1;n>=0;n-=1){let s=i[n];for(let r in s)r in t||(t[r]=s[r])}return t}function vs(i,e){let t={};for(let n in i)e(i[n],n)&&(t[n]=i[n]);return t}function wn(i,e){let t={};for(let n in i)t[n]=e(i[n],n);return t}function CC(i){let e={};for(let t of i)e[t]=!0;return e}function rb(i){let e=[];for(let t in i)e.push(i[t]);return e}function Ut(i,e){if(i===e)return!0;for(let t in i)if(Wv.call(i,t)&&!(t in e))return!1;for(let t in e)if(Wv.call(e,t)&&i[t]!==e[t])return!1;return!0}var aH=/^on[A-Z]/;function lH(i,e){let t=cH(i,e);for(let n of t)if(!aH.test(n))return!1;return!0}function cH(i,e){let t=[];for(let n in i)Wv.call(i,n)&&(n in e||t.push(n));for(let n in e)Wv.call(e,n)&&i[n]!==e[n]&&t.push(n);return t}function $v(i,e,t={}){if(i===e)return!0;for(let n in e)if(!(n in i&&dH(i[n],e[n],t[n])))return!1;for(let n in i)if(!(n in e))return!1;return!0}function dH(i,e,t){return i===e||t===!0?!0:t?t(i,e):!1}function XI(i,e=0,t,n=1){let s=[];t==null&&(t=Object.keys(i).length);for(let r=e;r<t;r+=n){let o=i[r];o!==void 0&&s.push(o)}return s}var JI={};function uH(i,e){JI[i]=e}function hH(i){return new JI[i]}var eC=class{getMarkerYear(e){return e.getUTCFullYear()}getMarkerMonth(e){return e.getUTCMonth()}getMarkerDay(e){return e.getUTCDate()}arrayToMarker(e){return Ot(e)}markerToArray(e){return wr(e)}};uH("gregory",eC);var fH=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;function ZI(i){let e=fH.exec(i);if(e){let t=new Date(Date.UTC(Number(e[1]),e[3]?Number(e[3])-1:0,Number(e[5]||1),Number(e[7]||0),Number(e[8]||0),Number(e[10]||0),e[12]?+`0.${e[12]}`*1e3:0));if(yC(t)){let n=null;return e[13]&&(n=(e[15]==="-"?-1:1)*(Number(e[16]||0)*60+Number(e[18]||0))),{marker:t,isTimeUnspecified:!e[6],timeZoneOffset:n}}}return null}var yf=class{constructor(e){let t=this.timeZone=e.timeZone,n=t!=="local"&&t!=="UTC";e.namedTimeZoneImpl&&n&&(this.namedTimeZoneImpl=new e.namedTimeZoneImpl(t)),this.canComputeOffset=!!(!n||this.namedTimeZoneImpl),this.calendarSystem=hH(e.calendarSystem),this.locale=e.locale,this.weekDow=e.locale.week.dow,this.weekDoy=e.locale.week.doy,e.weekNumberCalculation==="ISO"&&(this.weekDow=1,this.weekDoy=4),typeof e.firstDay=="number"&&(this.weekDow=e.firstDay),typeof e.weekNumberCalculation=="function"&&(this.weekNumberFunc=e.weekNumberCalculation),this.weekText=e.weekText!=null?e.weekText:e.locale.options.weekText,this.weekTextLong=(e.weekTextLong!=null?e.weekTextLong:e.locale.options.weekTextLong)||this.weekText,this.cmdFormatter=e.cmdFormatter,this.defaultSeparator=e.defaultSeparator}createMarker(e){let t=this.createMarkerMeta(e);return t===null?null:t.marker}createNowMarker(){return this.canComputeOffset?this.timestampToMarker(new Date().valueOf()):Ot(_I(new Date))}createMarkerMeta(e){if(typeof e=="string")return this.parse(e);let t=null;return typeof e=="number"?t=this.timestampToMarker(e):e instanceof Date?(e=e.valueOf(),isNaN(e)||(t=this.timestampToMarker(e))):Array.isArray(e)&&(t=Ot(e)),t===null||!yC(t)?null:{marker:t,isTimeUnspecified:!1,forcedTzo:null}}parse(e){let t=ZI(e);if(t===null)return null;let{marker:n}=t,s=null;return t.timeZoneOffset!==null&&(this.canComputeOffset?n=this.timestampToMarker(n.valueOf()-t.timeZoneOffset*60*1e3):s=t.timeZoneOffset),{marker:n,isTimeUnspecified:t.isTimeUnspecified,forcedTzo:s}}getYear(e){return this.calendarSystem.getMarkerYear(e)}getMonth(e){return this.calendarSystem.getMarkerMonth(e)}getDay(e){return this.calendarSystem.getMarkerDay(e)}add(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]+=t.years,n[1]+=t.months,n[2]+=t.days,n[6]+=t.milliseconds,this.calendarSystem.arrayToMarker(n)}subtract(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]-=t.years,n[1]-=t.months,n[2]-=t.days,n[6]-=t.milliseconds,this.calendarSystem.arrayToMarker(n)}addYears(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]+=t,this.calendarSystem.arrayToMarker(n)}addMonths(e,t){let n=this.calendarSystem.markerToArray(e);return n[1]+=t,this.calendarSystem.arrayToMarker(n)}diffWholeYears(e,t){let{calendarSystem:n}=this;return Ar(e)===Ar(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)&&n.getMarkerMonth(e)===n.getMarkerMonth(t)?n.getMarkerYear(t)-n.getMarkerYear(e):null}diffWholeMonths(e,t){let{calendarSystem:n}=this;return Ar(e)===Ar(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)?n.getMarkerMonth(t)-n.getMarkerMonth(e)+(n.getMarkerYear(t)-n.getMarkerYear(e))*12:null}greatestWholeUnit(e,t){let n=this.diffWholeYears(e,t);return n!==null?{unit:"year",value:n}:(n=this.diffWholeMonths(e,t),n!==null?{unit:"month",value:n}:(n=YI(e,t),n!==null?{unit:"week",value:n}:(n=Hc(e,t),n!==null?{unit:"day",value:n}:(n=$B(e,t),gf(n)?{unit:"hour",value:n}:(n=VB(e,t),gf(n)?{unit:"minute",value:n}:(n=GB(e,t),gf(n)?{unit:"second",value:n}:{unit:"millisecond",value:t.valueOf()-e.valueOf()}))))))}countDurationsBetween(e,t,n){let s;return n.years&&(s=this.diffWholeYears(e,t),s!==null)?s/UB(n):n.months&&(s=this.diffWholeMonths(e,t),s!==null)?s/BB(n):n.days&&(s=Hc(e,t),s!==null)?s/Bc(n):(t.valueOf()-e.valueOf())/rn(n)}startOf(e,t){return t==="year"?this.startOfYear(e):t==="month"?this.startOfMonth(e):t==="week"?this.startOfWeek(e):t==="day"?ue(e):t==="hour"?zB(e):t==="minute"?WB(e):t==="second"?qB(e):null}startOfYear(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e)])}startOfMonth(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e)])}startOfWeek(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e),e.getUTCDate()-(e.getUTCDay()-this.weekDow+7)%7])}computeWeekNumber(e){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(e)):YB(e,this.weekDow,this.weekDoy)}format(e,t,n={}){return t.format({marker:e,timeZoneOffset:n.forcedTzo!=null?n.forcedTzo:this.offsetForMarker(e)},this)}formatRange(e,t,n,s={}){return s.isEndExclusive&&(t=Ti(t,-1)),n.formatRange({marker:e,timeZoneOffset:s.forcedStartTzo!=null?s.forcedStartTzo:this.offsetForMarker(e)},{marker:t,timeZoneOffset:s.forcedEndTzo!=null?s.forcedEndTzo:this.offsetForMarker(t)},this,s.defaultSeparator)}formatIso(e,t={}){let n=null;return t.omitTimeZoneOffset||(t.forcedTzo!=null?n=t.forcedTzo:n=this.offsetForMarker(e)),tb(e,n,t.omitTime)}timestampToMarker(e){return this.timeZone==="local"?Ot(_I(new Date(e))):this.timeZone==="UTC"||!this.namedTimeZoneImpl?new Date(e):Ot(this.namedTimeZoneImpl.timestampToArray(e))}offsetForMarker(e){return this.timeZone==="local"?-xI(wr(e)).getTimezoneOffset():this.timeZone==="UTC"?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(wr(e)):null}toDate(e,t){return this.timeZone==="local"?xI(wr(e)):this.timeZone==="UTC"?new Date(e.valueOf()):this.namedTimeZoneImpl?new Date(e.valueOf()-this.namedTimeZoneImpl.offsetForArray(wr(e))*1e3*60):new Date(e.valueOf()-(t||0))}},bs=class{constructor(e){this.iconOverrideOption&&this.setIconOverride(e[this.iconOverrideOption])}setIconOverride(e){let t,n;if(typeof e=="object"&&e){t=Object.assign({},this.iconClasses);for(n in e)t[n]=this.applyIconOverridePrefix(e[n]);this.iconClasses=t}else e===!1&&(this.iconClasses={})}applyIconOverridePrefix(e){let t=this.iconOverridePrefix;return t&&e.indexOf(t)!==0&&(e=t+e),e}getClass(e){return this.classes[e]||""}getIconClass(e,t){let n;return t&&this.rtlIconClasses?n=this.rtlIconClasses[e]||this.iconClasses[e]:n=this.iconClasses[e],n?`${this.baseIconClass} ${n}`:""}getCustomButtonIconClass(e){let t;return this.iconOverrideCustomButtonOption&&(t=e[this.iconOverrideCustomButtonOption],t)?`${this.baseIconClass} ${this.applyIconOverridePrefix(t)}`:""}};bs.prototype.classes={};bs.prototype.iconClasses={};bs.prototype.baseIconClass="";bs.prototype.iconOverridePrefix="";function vf(i){i();let e=W.debounceRendering,t=[];function n(s){t.push(s)}for(W.debounceRendering=n,Er(x(tC,{}),document.createElement("div"));t.length;)t.shift()();W.debounceRendering=e}var tC=class extends rt{render(){return x("div",{})}componentDidMount(){this.setState({})}};function jI(i){let e=kv(i),t=e.Provider;return e.Provider=function(){let n=!this.getChildContext,s=t.apply(this,arguments);if(n){let r=[];this.shouldComponentUpdate=o=>{this.props.value!==o.value&&r.forEach(a=>{a.context=o.value,a.forceUpdate()})},this.sub=o=>{r.push(o);let a=o.componentWillUnmount;o.componentWillUnmount=()=>{r.splice(r.indexOf(o),1),a&&a.call(o)}}}return s},e}var qv=class{constructor(e,t,n,s){this.execFunc=e,this.emitter=t,this.scrollTime=n,this.scrollTimeReset=s,this.handleScrollRequest=r=>{this.queuedRequest=Object.assign({},this.queuedRequest||{},r),this.drain()},t.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}detach(){this.emitter.off("_scrollRequest",this.handleScrollRequest)}update(e){e&&this.scrollTimeReset?this.fireInitialScroll():this.drain()}fireInitialScroll(){this.handleScrollRequest({time:this.scrollTime})}drain(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)}},Cn=jI({});function QI(i,e,t,n,s,r,o,a,l,c,d,u,p,m){return{dateEnv:s,nowManager:r,options:t,pluginHooks:a,emitter:d,dispatch:l,getCurrentData:c,calendarApi:u,viewSpec:i,viewApi:e,dateProfileGenerator:n,theme:o,isRtl:t.direction==="rtl",addResizeHandler(y){d.on("_resize",y)},removeResizeHandler(y){d.off("_resize",y)},createScrollResponder(y){return new qv(y,d,ee(t.scrollTime),t.scrollTimeReset)},registerInteractiveComponent:p,unregisterInteractiveComponent:m}}var _i=class extends rt{shouldComponentUpdate(e,t){return!$v(this.props,e,this.propEquality)||!$v(this.state,t,this.stateEquality)}safeSetState(e){$v(this.state,Object.assign(Object.assign({},this.state),e),this.stateEquality)||this.setState(e)}};_i.addPropsEquality=pH;_i.addStateEquality=gH;_i.contextType=Cn;_i.prototype.propEquality={};_i.prototype.stateEquality={};var te=class extends _i{};te.contextType=Cn;function pH(i){let e=Object.create(this.prototype.propEquality);Object.assign(e,i),this.prototype.propEquality=e}function gH(i){let e=Object.create(this.prototype.stateEquality);Object.assign(e,i),this.prototype.stateEquality=e}function an(i,e){typeof i=="function"?i(e):i&&(i.current=e)}var bf=class extends te{constructor(){super(...arguments),this.id=ws(),this.queuedDomNodes=[],this.currentDomNodes=[],this.handleEl=e=>{let{options:t}=this.context,{generatorName:n}=this.props;(!t.customRenderingReplaces||!nC(n,t))&&this.updateElRef(e)},this.updateElRef=e=>{this.props.elRef&&an(this.props.elRef,e)}}render(){let{props:e,context:t}=this,{options:n}=t,{customGenerator:s,defaultGenerator:r,renderProps:o}=e,a=TC(e,[],this.handleEl),l=!1,c,d=[],u;if(s!=null){let p=typeof s=="function"?s(o,x):s;if(p===!0)l=!0;else{let m=p&&typeof p=="object";m&&"html"in p?a.dangerouslySetInnerHTML={__html:p.html}:m&&"domNodes"in p?d=Array.prototype.slice.call(p.domNodes):(m?NA(p):typeof p!="function")?c=p:u=p}}else l=!nC(e.generatorName,n);return l&&r&&(c=r(o)),this.queuedDomNodes=d,this.currentGeneratorMeta=u,x(e.elTag,a,c)}componentDidMount(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentDidUpdate(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentWillUnmount(){this.triggerCustomRendering(!1)}triggerCustomRendering(e){var t;let{props:n,context:s}=this,{handleCustomRendering:r,customRenderingMetaMap:o}=s.options;if(r){let a=(t=this.currentGeneratorMeta)!==null&&t!==void 0?t:o?.[n.generatorName];a&&r(Object.assign(Object.assign({id:this.id,isActive:e,containerEl:this.base,reportNewContainerEl:this.updateElRef,generatorMeta:a},n),{elClasses:(n.elClasses||[]).filter(mH)}))}}applyQueueudDomNodes(){let{queuedDomNodes:e,currentDomNodes:t}=this,n=this.base;if(!Ri(e,t)){t.forEach(Mf);for(let s of e)n.appendChild(s);this.currentDomNodes=e}}};bf.addPropsEquality({elClasses:Ri,elStyle:Ut,elAttrs:lH,renderProps:Ut});function nC(i,e){var t;return!!(e.handleCustomRendering&&i&&(!((t=e.customRenderingMetaMap)===null||t===void 0)&&t[i]))}function TC(i,e,t){let n=Object.assign(Object.assign({},i.elAttrs),{ref:t});return(i.elClasses||e)&&(n.className=(i.elClasses||[]).concat(e||[]).concat(n.className||[]).filter(Boolean).join(" ")),i.elStyle&&(n.style=i.elStyle),n}function mH(i){return!!i}var _C=jI(0),Re=class extends rt{constructor(){super(...arguments),this.InnerContent=yH.bind(void 0,this),this.handleEl=e=>{this.el=e,this.props.elRef&&(an(this.props.elRef,e),e&&this.didMountMisfire&&this.componentDidMount())}}render(){let{props:e}=this,t=vH(e.classNameGenerator,e.renderProps);if(e.children){let n=TC(e,t,this.handleEl),s=e.children(this.InnerContent,e.renderProps,n);return e.elTag?x(e.elTag,n,s):s}else return x(bf,Object.assign(Object.assign({},e),{elRef:this.handleEl,elTag:e.elTag||"div",elClasses:(e.elClasses||[]).concat(t),renderId:this.context}))}componentDidMount(){var e,t;this.el?(t=(e=this.props).didMount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el})):this.didMountMisfire=!0}componentWillUnmount(){var e,t;(t=(e=this.props).willUnmount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el}))}};Re.contextType=_C;function yH(i,e){let t=i.props;return x(bf,Object.assign({renderProps:t.renderProps,generatorName:t.generatorName,customGenerator:t.customGenerator,defaultGenerator:t.defaultGenerator,renderId:i.context},e))}function vH(i,e){let t=typeof i=="function"?i(e):i||[];return typeof t=="string"?[t]:t}var Kn=class extends te{render(){let{props:e,context:t}=this,{options:n}=t,s={view:t.viewApi};return x(Re,{elRef:e.elRef,elTag:e.elTag||"div",elAttrs:e.elAttrs,elClasses:[...xC(e.viewSpec),...e.elClasses||[]],elStyle:e.elStyle,renderProps:s,classNameGenerator:n.viewClassNames,generatorName:void 0,didMount:n.viewDidMount,willUnmount:n.viewWillUnmount},()=>e.children)}};function xC(i){return[`fc-${i.type}-view`,"fc-view"]}function bH(i,e){let t=null,n=null;return i.start&&(t=e.createMarker(i.start)),i.end&&(n=e.createMarker(i.end)),!t&&!n||t&&n&&n<t?null:{start:t,end:n}}function II(i,e){let t=[],{start:n}=e,s,r;for(i.sort(EH),s=0;s<i.length;s+=1)r=i[s],r.start>n&&t.push({start:n,end:r.start}),r.end>n&&(n=r.end);return n<e.end&&t.push({start:n,end:e.end}),t}function EH(i,e){return i.start.valueOf()-e.start.valueOf()}function on(i,e){let{start:t,end:n}=i,s=null;return e.start!==null&&(t===null?t=e.start:t=new Date(Math.max(t.valueOf(),e.start.valueOf()))),e.end!=null&&(n===null?n=e.end:n=new Date(Math.min(n.valueOf(),e.end.valueOf()))),(t===null||n===null||t<n)&&(s={start:t,end:n}),s}function eM(i,e){return(i.start===null?null:i.start.valueOf())===(e.start===null?null:e.start.valueOf())&&(i.end===null?null:i.end.valueOf())===(e.end===null?null:e.end.valueOf())}function ob(i,e){return(i.end===null||e.start===null||i.end>e.start)&&(i.start===null||e.end===null||i.start<e.end)}function Wc(i,e){return(i.start===null||e.start!==null&&e.start>=i.start)&&(i.end===null||e.end!==null&&e.end<=i.end)}function Sn(i,e){return(i.start===null||e>=i.start)&&(i.end===null||e<i.end)}function SH(i,e){return e.start!=null&&i<e.start?e.start:e.end!=null&&i>=e.end?new Date(e.end.valueOf()-1):i}function tM(i){let e=Math.floor(Di(i.start,i.end))||1,t=ue(i.start),n=we(t,e);return{start:t,end:n}}function ab(i,e=ee(0)){let t=null,n=null;if(i.end){n=ue(i.end);let s=i.end.valueOf()-n.valueOf();s&&s>=rn(e)&&(n=we(n,1))}return i.start&&(t=ue(i.start),n&&n<=t&&(n=we(t,1))),{start:t,end:n}}function RC(i){let e=ab(i);return Di(e.start,e.end)>1}function Cr(i,e,t,n){return n==="year"?ee(t.diffWholeYears(i,e),"year"):n==="month"?ee(t.diffWholeMonths(i,e),"month"):qI(i,e)}var ya=class{constructor(e){this.props=e,this.initHiddenDays()}buildPrev(e,t,n){let{dateEnv:s}=this.props,r=s.subtract(s.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(r,-1,n)}buildNext(e,t,n){let{dateEnv:s}=this.props,r=s.add(s.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(r,1,n)}build(e,t,n=!0){let{props:s}=this,r,o,a,l,c,d;return r=this.buildValidRange(),r=this.trimHiddenDays(r),n&&(e=SH(e,r)),o=this.buildCurrentRangeInfo(e,t),a=/^(year|month|week|day)$/.test(o.unit),l=this.buildRenderRange(this.trimHiddenDays(o.range),o.unit,a),l=this.trimHiddenDays(l),c=l,s.showNonCurrentDates||(c=on(c,o.range)),c=this.adjustActiveRange(c),c=on(c,r),d=ob(o.range,r),Sn(l,e)||(e=l.start),{currentDate:e,validRange:r,currentRange:o.range,currentRangeUnit:o.unit,isRangeAllDay:a,activeRange:c,renderRange:l,slotMinTime:s.slotMinTime,slotMaxTime:s.slotMaxTime,isValid:d,dateIncrement:this.buildDateIncrement(o.duration)}}buildValidRange(){let e=this.props.validRangeInput,t=typeof e=="function"?e.call(this.props.calendarApi,this.props.dateEnv.toDate(this.props.nowManager.getDateMarker())):e;return this.refineRange(t)||{start:null,end:null}}buildCurrentRangeInfo(e,t){let{props:n}=this,s=null,r=null,o=null,a;return n.duration?(s=n.duration,r=n.durationUnit,o=this.buildRangeFromDuration(e,t,s,r)):(a=this.props.dayCount)?(r="day",o=this.buildRangeFromDayCount(e,t,a)):(o=this.buildCustomVisibleRange(e))?r=n.dateEnv.greatestWholeUnit(o.start,o.end).unit:(s=this.getFallbackDuration(),r=mf(s).unit,o=this.buildRangeFromDuration(e,t,s,r)),{duration:s,unit:r,range:o}}getFallbackDuration(){return ee({day:1})}adjustActiveRange(e){let{dateEnv:t,usesMinMaxTime:n,slotMinTime:s,slotMaxTime:r}=this.props,{start:o,end:a}=e;return n&&(Bc(s)<0&&(o=ue(o),o=t.add(o,s)),Bc(r)>1&&(a=ue(a),a=we(a,-1),a=t.add(a,r))),{start:o,end:a}}buildRangeFromDuration(e,t,n,s){let{dateEnv:r,dateAlignment:o}=this.props,a,l,c;if(!o){let{dateIncrement:u}=this.props;u&&rn(u)<rn(n)?o=mf(u).unit:o=s}Bc(n)<=1&&this.isHiddenDay(a)&&(a=this.skipHiddenDays(a,t),a=ue(a));function d(){a=r.startOf(e,o),l=r.add(a,n),c={start:a,end:l}}return d(),this.trimHiddenDays(c)||(e=this.skipHiddenDays(e,t),d()),c}buildRangeFromDayCount(e,t,n){let{dateEnv:s,dateAlignment:r}=this.props,o=0,a=e,l;r&&(a=s.startOf(a,r)),a=ue(a),a=this.skipHiddenDays(a,t),l=a;do l=we(l,1),this.isHiddenDay(l)||(o+=1);while(o<n);return{start:a,end:l}}buildCustomVisibleRange(e){let{props:t}=this,n=t.visibleRangeInput,s=typeof n=="function"?n.call(t.calendarApi,t.dateEnv.toDate(e)):n,r=this.refineRange(s);return r&&(r.start==null||r.end==null)?null:r}buildRenderRange(e,t,n){return e}buildDateIncrement(e){let{dateIncrement:t}=this.props,n;return t||((n=this.props.dateAlignment)?ee(1,n):e||ee({days:1}))}refineRange(e){if(e){let t=bH(e,this.props.dateEnv);return t&&(t=ab(t)),t}return null}initHiddenDays(){let e=this.props.hiddenDays||[],t=[],n=0,s;for(this.props.weekends===!1&&e.push(0,6),s=0;s<7;s+=1)(t[s]=e.indexOf(s)!==-1)||(n+=1);if(!n)throw new Error("invalid hiddenDays");this.isHiddenDayHash=t}trimHiddenDays(e){let{start:t,end:n}=e;return t&&(t=this.skipHiddenDays(t)),n&&(n=this.skipHiddenDays(n,-1,!0)),t==null||n==null||t<n?{start:t,end:n}:null}isHiddenDay(e){return e instanceof Date&&(e=e.getUTCDay()),this.isHiddenDayHash[e]}skipHiddenDays(e,t=1,n=!1){for(;this.isHiddenDayHash[(e.getUTCDay()+(n?t:0)+7)%7];)e=we(e,t);return e}};function Of(i,e,t,n){return{instanceId:ws(),defId:i,range:e,forcedStartTzo:t??null,forcedEndTzo:n??null}}function wH(i,e,t,n){for(let s=0;s<n.length;s+=1){let r=n[s].parse(i,t);if(r){let{allDay:o}=i;return o==null&&(o=e,o==null&&(o=r.allDayGuess,o==null&&(o=!1))),{allDay:o,duration:r.duration,typeData:r.typeData,typeId:s}}}return null}function va(i,e,t){let{dateEnv:n,pluginHooks:s,options:r}=t,{defs:o,instances:a}=i;a=vs(a,l=>!o[l.defId].recurringDef);for(let l in o){let c=o[l];if(c.recurringDef){let{duration:d}=c.recurringDef;d||(d=c.allDay?r.defaultAllDayEventDuration:r.defaultTimedEventDuration);let u=AH(c,d,e,n,s.recurringTypes);for(let p of u){let m=Of(l,{start:p,end:n.add(p,d)});a[m.instanceId]=m}}}return{defs:o,instances:a}}function AH(i,e,t,n,s){let o=s[i.recurringDef.typeId].expand(i.recurringDef.typeData,{start:n.subtract(t.start,e),end:t.end},n);return i.allDay&&(o=o.map(ue)),o}var Vv={id:String,groupId:String,title:String,url:String,interactive:Boolean},nM={start:P,end:P,date:P,allDay:Boolean},CH=Object.assign(Object.assign(Object.assign({},Vv),nM),{extendedProps:P});function iM(i,e,t,n,s=DC(t),r,o){let{refined:a,extra:l}=lb(i,t,s),c=_H(e,t),d=wH(a,c,t.dateEnv,t.pluginHooks.recurringTypes);if(d){let p=Ef(a,l,e?e.sourceId:"",d.allDay,!!d.duration,t,r);return p.recurringDef={typeId:d.typeId,typeData:d.typeData,duration:d.duration},{def:p,instance:null}}let u=TH(a,c,t,n);if(u){let p=Ef(a,l,e?e.sourceId:"",u.allDay,u.hasEnd,t,r),m=Of(p.defId,u.range,u.forcedStartTzo,u.forcedEndTzo);return o&&p.publicId&&o[p.publicId]&&(m.instanceId=o[p.publicId]),{def:p,instance:m}}return null}function lb(i,e,t=DC(e)){return ib(i,t)}function DC(i){return Object.assign(Object.assign(Object.assign({},Yv),CH),i.pluginHooks.eventRefiners)}function Ef(i,e,t,n,s,r,o){let a={title:i.title||"",groupId:i.groupId||"",publicId:i.id||"",url:i.url||"",recurringDef:null,defId:(o&&i.id?o[i.id]:"")||ws(),sourceId:t,allDay:n,hasEnd:s,interactive:i.interactive,ui:qc(i,r),extendedProps:Object.assign(Object.assign({},i.extendedProps||{}),e)};for(let l of r.pluginHooks.eventDefMemberAdders)Object.assign(a,l(i));return Object.freeze(a.ui.classNames),Object.freeze(a.extendedProps),a}function TH(i,e,t,n){let{allDay:s}=i,r,o=null,a=!1,l,c=null,d=i.start!=null?i.start:i.date;if(r=t.dateEnv.createMarkerMeta(d),r)o=r.marker;else if(!n)return null;return i.end!=null&&(l=t.dateEnv.createMarkerMeta(i.end)),s==null&&(e!=null?s=e:s=(!r||r.isTimeUnspecified)&&(!l||l.isTimeUnspecified)),s&&o&&(o=ue(o)),l&&(c=l.marker,s&&(c=ue(c)),o&&c<=o&&(c=null)),c?a=!0:n||(a=t.options.forceEventDuration||!1,c=t.dateEnv.add(o,s?t.options.defaultAllDayEventDuration:t.options.defaultTimedEventDuration)),{allDay:s,hasEnd:a,range:{start:o,end:c},forcedStartTzo:r?r.forcedTzo:null,forcedEndTzo:l?l.forcedTzo:null}}function _H(i,e){let t=null;return i&&(t=i.defaultAllDay),t==null&&(t=e.options.defaultAllDay),t}function Sf(i,e,t,n,s,r){let o=vt(),a=DC(t);for(let l of i){let c=iM(l,e,t,n,a,s,r);c&&wf(c,o)}return o}function wf(i,e=vt()){return e.defs[i.def.defId]=i.def,i.instance&&(e.instances[i.instance.instanceId]=i.instance),e}function Uf(i,e){let t=i.instances[e];if(t){let n=i.defs[t.defId],s=db(i,r=>xH(n,r));return s.defs[n.defId]=n,s.instances[t.instanceId]=t,s}return vt()}function xH(i,e){return!!(i.groupId&&i.groupId===e.groupId)}function vt(){return{defs:{},instances:{}}}function cb(i,e){return{defs:Object.assign(Object.assign({},i.defs),e.defs),instances:Object.assign(Object.assign({},i.instances),e.instances)}}function db(i,e){let t=vs(i.defs,e),n=vs(i.instances,s=>t[s.defId]);return{defs:t,instances:n}}function RH(i,e){let{defs:t,instances:n}=i,s={},r={};for(let o in t)e.defs[o]||(s[o]=t[o]);for(let o in n)!e.instances[o]&&s[n[o].defId]&&(r[o]=n[o]);return{defs:s,instances:r}}function DH(i,e){return Array.isArray(i)?Sf(i,null,e,!0):typeof i=="object"&&i?Sf([i],null,e,!0):i!=null?String(i):null}function iC(i){return Array.isArray(i)?i:typeof i=="string"?i.split(/\s+/):[]}var Yv={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:P,overlap:P,allow:P,className:iC,classNames:iC,color:String,backgroundColor:String,borderColor:String,textColor:String},IH={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]};function qc(i,e){let t=DH(i.constraint,e);return{display:i.display||null,startEditable:i.startEditable!=null?i.startEditable:i.editable,durationEditable:i.durationEditable!=null?i.durationEditable:i.editable,constraints:t!=null?[t]:[],overlap:i.overlap!=null?i.overlap:null,allows:i.allow!=null?[i.allow]:[],backgroundColor:i.backgroundColor||i.color||"",borderColor:i.borderColor||i.color||"",textColor:i.textColor||"",classNames:(i.className||[]).concat(i.classNames||[])}}function IC(i){return i.reduce(MH,IH)}function MH(i,e){return{display:e.display!=null?e.display:i.display,startEditable:e.startEditable!=null?e.startEditable:i.startEditable,durationEditable:e.durationEditable!=null?e.durationEditable:i.durationEditable,constraints:i.constraints.concat(e.constraints),overlap:typeof e.overlap=="boolean"?e.overlap:i.overlap,allows:i.allows.concat(e.allows),backgroundColor:e.backgroundColor||i.backgroundColor,borderColor:e.borderColor||i.borderColor,textColor:e.textColor||i.textColor,classNames:i.classNames.concat(e.classNames)}}var PH={id:String,defaultAllDay:Boolean,url:String,format:String,events:P,eventDataTransform:P,success:P,failure:P};function MC(i,e,t=PC(e)){let n;if(typeof i=="string"?n={url:i}:typeof i=="function"||Array.isArray(i)?n={events:i}:typeof i=="object"&&i&&(n=i),n){let{refined:s,extra:r}=ib(n,t),o=kH(s,e);if(o)return{_raw:i,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:s.defaultAllDay,eventDataTransform:s.eventDataTransform,success:s.success,failure:s.failure,publicId:s.id||"",sourceId:ws(),sourceDefId:o.sourceDefId,meta:o.meta,ui:qc(s,e),extendedProps:r}}return null}function PC(i){return Object.assign(Object.assign(Object.assign({},Yv),PH),i.pluginHooks.eventSourceRefiners)}function kH(i,e){let t=e.pluginHooks.eventSourceDefs;for(let n=t.length-1;n>=0;n-=1){let r=t[n].parseMeta(i);if(r)return{sourceDefId:n,meta:r}}return null}function sM(i,e,t,n,s){switch(e.type){case"RECEIVE_EVENTS":return NH(i,t[e.sourceId],e.fetchId,e.fetchRange,e.rawEvents,s);case"RESET_RAW_EVENTS":return FH(i,t[e.sourceId],e.rawEvents,n.activeRange,s);case"ADD_EVENTS":return LH(i,e.eventStore,n?n.activeRange:null,s);case"RESET_EVENTS":return e.eventStore;case"MERGE_EVENTS":return cb(i,e.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return n?va(i,n.activeRange,s):i;case"REMOVE_EVENTS":return RH(i,e.eventStore);case"REMOVE_EVENT_SOURCE":return oM(i,e.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return db(i,r=>!r.sourceId);case"REMOVE_ALL_EVENTS":return vt();default:return i}}function NH(i,e,t,n,s,r){if(e&&t===e.latestFetchId){let o=Sf(rM(s,e,r),e,r);return n&&(o=va(o,n,r)),cb(oM(i,e.sourceId),o)}return i}function FH(i,e,t,n,s){let{defIdMap:r,instanceIdMap:o}=UH(i),a=Sf(rM(t,e,s),e,s,!1,r,o);return va(a,n,s)}function rM(i,e,t){let n=t.options.eventDataTransform,s=e?e.eventDataTransform:null;return s&&(i=MI(i,s)),n&&(i=MI(i,n)),i}function MI(i,e){let t;if(!e)t=i;else{t=[];for(let n of i){let s=e(n);s?t.push(s):s==null&&t.push(n)}}return t}function LH(i,e,t,n){return t&&(e=va(e,t,n)),cb(i,e)}function kC(i,e,t){let{defs:n}=i,s=wn(i.instances,r=>n[r.defId].allDay?r:Object.assign(Object.assign({},r),{range:{start:t.createMarker(e.toDate(r.range.start,r.forcedStartTzo)),end:t.createMarker(e.toDate(r.range.end,r.forcedEndTzo))},forcedStartTzo:t.canComputeOffset?null:r.forcedStartTzo,forcedEndTzo:t.canComputeOffset?null:r.forcedEndTzo}));return{defs:n,instances:s}}function oM(i,e){return db(i,t=>t.sourceId!==e)}function OH(i,e){return{defs:i.defs,instances:vs(i.instances,t=>!e[t.instanceId])}}function UH(i){let{defs:e,instances:t}=i,n={},s={};for(let r in e){let o=e[r],{publicId:a}=o;a&&(n[a]=r)}for(let r in t){let o=t[r],a=e[o.defId],{publicId:l}=a;l&&(s[l]=r)}return{defIdMap:n,instanceIdMap:s}}var Es=class{constructor(){this.handlers={},this.thisContext=null}setThisContext(e){this.thisContext=e}setOptions(e){this.options=e}on(e,t){BH(this.handlers,e,t)}off(e,t){HH(this.handlers,e,t)}trigger(e,...t){let n=this.handlers[e]||[],s=this.options&&this.options[e],r=[].concat(s||[],n);for(let o of r)o.apply(this.thisContext,t)}hasHandlers(e){return!!(this.handlers[e]&&this.handlers[e].length||this.options&&this.options[e])}};function BH(i,e,t){(i[e]||(i[e]=[])).push(t)}function HH(i,e,t){t?i[e]&&(i[e]=i[e].filter(n=>n!==t)):delete i[e]}var $H={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"};function NC(i,e){return Sf(VH(i),null,e)}function VH(i){let e;return i===!0?e=[{}]:Array.isArray(i)?e=i.filter(t=>t.daysOfWeek):typeof i=="object"&&i?e=[i]:e=[],e=e.map(t=>Object.assign(Object.assign({},$H),t)),e}function ub(i,e,t){t.emitter.trigger("select",Object.assign(Object.assign({},FC(i,t)),{jsEvent:e?e.origEvent:null,view:t.viewApi||t.calendarApi.view}))}function GH(i,e){e.emitter.trigger("unselect",{jsEvent:i?i.origEvent:null,view:e.viewApi||e.calendarApi.view})}function FC(i,e){let t={};for(let n of e.pluginHooks.dateSpanTransforms)Object.assign(t,n(i,e));return Object.assign(t,t$(i,e.dateEnv)),t}function Kv(i,e,t){let{dateEnv:n,options:s}=t,r=e;return i?(r=ue(r),r=n.add(r,s.defaultAllDayEventDuration)):r=n.add(r,s.defaultTimedEventDuration),r}function Bf(i,e,t,n){let s=Xv(i.defs,e),r=vt();for(let o in i.defs){let a=i.defs[o];r.defs[o]=zH(a,s[o],t,n)}for(let o in i.instances){let a=i.instances[o],l=r.defs[a.defId];r.instances[o]=WH(a,l,s[a.defId],t,n)}return r}function zH(i,e,t,n){let s=t.standardProps||{};s.hasEnd==null&&e.durationEditable&&(t.startDelta||t.endDelta)&&(s.hasEnd=!0);let r=Object.assign(Object.assign(Object.assign({},i),s),{ui:Object.assign(Object.assign({},i.ui),s.ui)});t.extendedProps&&(r.extendedProps=Object.assign(Object.assign({},r.extendedProps),t.extendedProps));for(let o of n.pluginHooks.eventDefMutationAppliers)o(r,t,n);return!r.hasEnd&&n.options.forceEventDuration&&(r.hasEnd=!0),r}function WH(i,e,t,n,s){let{dateEnv:r}=s,o=n.standardProps&&n.standardProps.allDay===!0,a=n.standardProps&&n.standardProps.hasEnd===!1,l=Object.assign({},i);return o&&(l.range=tM(l.range)),n.datesDelta&&t.startEditable&&(l.range={start:r.add(l.range.start,n.datesDelta),end:r.add(l.range.end,n.datesDelta)}),n.startDelta&&t.durationEditable&&(l.range={start:r.add(l.range.start,n.startDelta),end:l.range.end}),n.endDelta&&t.durationEditable&&(l.range={start:l.range.start,end:r.add(l.range.end,n.endDelta)}),a&&(l.range={start:l.range.start,end:Kv(e.allDay,l.range.start,s)}),e.allDay&&(l.range={start:ue(l.range.start),end:ue(l.range.end)}),l.range.end<l.range.start&&(l.range.end=Kv(e.allDay,l.range.start,s)),l}var Sr=class{constructor(e,t){this.context=e,this.internalEventSource=t}remove(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})}refetch(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId],isRefetch:!0})}get id(){return this.internalEventSource.publicId}get url(){return this.internalEventSource.meta.url}get format(){return this.internalEventSource.meta.format}},ye=class i{constructor(e,t,n){this._context=e,this._def=t,this._instance=n||null}setProp(e,t){if(e in nM)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if(e==="id")t=Vv[e](t),this.mutate({standardProps:{publicId:t}});else if(e in Vv)t=Vv[e](t),this.mutate({standardProps:{[e]:t}});else if(e in Yv){let n=Yv[e](t);e==="color"?n={backgroundColor:t,borderColor:t}:e==="editable"?n={startEditable:t,durationEditable:t}:n={[e]:t},this.mutate({standardProps:{ui:n}})}else console.warn(`Could not set prop '${e}'. Use setExtendedProp instead.`)}setExtendedProp(e,t){this.mutate({extendedProps:{[e]:t}})}setStart(e,t={}){let{dateEnv:n}=this._context,s=n.createMarker(e);if(s&&this._instance){let r=this._instance.range,o=Cr(r.start,s,n,t.granularity);t.maintainDuration?this.mutate({datesDelta:o}):this.mutate({startDelta:o})}}setEnd(e,t={}){let{dateEnv:n}=this._context,s;if(!(e!=null&&(s=n.createMarker(e),!s))&&this._instance)if(s){let r=Cr(this._instance.range.end,s,n,t.granularity);this.mutate({endDelta:r})}else this.mutate({standardProps:{hasEnd:!1}})}setDates(e,t,n={}){let{dateEnv:s}=this._context,r={allDay:n.allDay},o=s.createMarker(e),a;if(o&&!(t!=null&&(a=s.createMarker(t),!a))&&this._instance){let l=this._instance.range;n.allDay===!0&&(l=tM(l));let c=Cr(l.start,o,s,n.granularity);if(a){let d=Cr(l.end,a,s,n.granularity);OB(c,d)?this.mutate({datesDelta:c,standardProps:r}):this.mutate({startDelta:c,endDelta:d,standardProps:r})}else r.hasEnd=!1,this.mutate({datesDelta:c,standardProps:r})}}moveStart(e){let t=ee(e);t&&this.mutate({startDelta:t})}moveEnd(e){let t=ee(e);t&&this.mutate({endDelta:t})}moveDates(e){let t=ee(e);t&&this.mutate({datesDelta:t})}setAllDay(e,t={}){let n={allDay:e},{maintainDuration:s}=t;s==null&&(s=this._context.options.allDayMaintainDuration),this._def.allDay!==e&&(n.hasEnd=s),this.mutate({standardProps:n})}formatRange(e){let{dateEnv:t}=this._context,n=this._instance,s=he(e);return this._def.hasEnd?t.formatRange(n.range.start,n.range.end,s,{forcedStartTzo:n.forcedStartTzo,forcedEndTzo:n.forcedEndTzo}):t.format(n.range.start,s,{forcedTzo:n.forcedStartTzo})}mutate(e){let t=this._instance;if(t){let n=this._def,s=this._context,{eventStore:r}=s.getCurrentData(),o=Uf(r,t.instanceId);o=Bf(o,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}},e,s);let l=new i(s,n,t);this._def=o.defs[n.defId],this._instance=o.instances[t.instanceId],s.dispatch({type:"MERGE_EVENTS",eventStore:o}),s.emitter.trigger("eventChange",{oldEvent:l,event:this,relatedEvents:Ii(o,s,t),revert(){s.dispatch({type:"RESET_EVENTS",eventStore:r})}})}}remove(){let e=this._context,t=aM(this);e.dispatch({type:"REMOVE_EVENTS",eventStore:t}),e.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert(){e.dispatch({type:"MERGE_EVENTS",eventStore:t})}})}get source(){let{sourceId:e}=this._def;return e?new Sr(this._context,this._context.getCurrentData().eventSources[e]):null}get start(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null}get end(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null}get startStr(){let e=this._instance;return e?this._context.dateEnv.formatIso(e.range.start,{omitTime:this._def.allDay,forcedTzo:e.forcedStartTzo}):""}get endStr(){let e=this._instance;return e&&this._def.hasEnd?this._context.dateEnv.formatIso(e.range.end,{omitTime:this._def.allDay,forcedTzo:e.forcedEndTzo}):""}get id(){return this._def.publicId}get groupId(){return this._def.groupId}get allDay(){return this._def.allDay}get title(){return this._def.title}get url(){return this._def.url}get display(){return this._def.ui.display||"auto"}get startEditable(){return this._def.ui.startEditable}get durationEditable(){return this._def.ui.durationEditable}get constraint(){return this._def.ui.constraints[0]||null}get overlap(){return this._def.ui.overlap}get allow(){return this._def.ui.allows[0]||null}get backgroundColor(){return this._def.ui.backgroundColor}get borderColor(){return this._def.ui.borderColor}get textColor(){return this._def.ui.textColor}get classNames(){return this._def.ui.classNames}get extendedProps(){return this._def.extendedProps}toPlainObject(e={}){let t=this._def,{ui:n}=t,{startStr:s,endStr:r}=this,o={allDay:t.allDay};return t.title&&(o.title=t.title),s&&(o.start=s),r&&(o.end=r),t.publicId&&(o.id=t.publicId),t.groupId&&(o.groupId=t.groupId),t.url&&(o.url=t.url),n.display&&n.display!=="auto"&&(o.display=n.display),e.collapseColor&&n.backgroundColor&&n.backgroundColor===n.borderColor?o.color=n.backgroundColor:(n.backgroundColor&&(o.backgroundColor=n.backgroundColor),n.borderColor&&(o.borderColor=n.borderColor)),n.textColor&&(o.textColor=n.textColor),n.classNames.length&&(o.classNames=n.classNames),Object.keys(t.extendedProps).length&&(e.collapseExtendedProps?Object.assign(o,t.extendedProps):o.extendedProps=t.extendedProps),o}toJSON(){return this.toPlainObject()}};function aM(i){let e=i._def,t=i._instance;return{defs:{[e.defId]:e},instances:t?{[t.instanceId]:t}:{}}}function Ii(i,e,t){let{defs:n,instances:s}=i,r=[],o=t?t.instanceId:"";for(let a in s){let l=s[a],c=n[l.defId];l.instanceId!==o&&r.push(new ye(e,c,l))}return r}function $c(i,e,t,n){let s={},r={},o={},a=[],l=[],c=Xv(i.defs,e);for(let d in i.defs){let u=i.defs[d];c[u.defId].display==="inverse-background"&&(u.groupId?(s[u.groupId]=[],o[u.groupId]||(o[u.groupId]=u)):r[d]=[])}for(let d in i.instances){let u=i.instances[d],p=i.defs[u.defId],m=c[p.defId],y=u.range,v=!p.allDay&&n?ab(y,n):y,b=on(v,t);b&&(m.display==="inverse-background"?p.groupId?s[p.groupId].push(b):r[u.defId].push(b):m.display!=="none"&&(m.display==="background"?a:l).push({def:p,ui:m,instance:u,range:b,isStart:v.start&&v.start.valueOf()===b.start.valueOf(),isEnd:v.end&&v.end.valueOf()===b.end.valueOf()}))}for(let d in s){let u=s[d],p=II(u,t);for(let m of p){let y=o[d],v=c[y.defId];a.push({def:y,ui:v,instance:null,range:m,isStart:!1,isEnd:!1})}}for(let d in r){let u=r[d],p=II(u,t);for(let m of p)a.push({def:i.defs[d],ui:c[d],instance:null,range:m,isStart:!1,isEnd:!1})}return{bg:a,fg:l}}function LC(i){return i.ui.display==="background"||i.ui.display==="inverse-background"}function PI(i,e){i.fcSeg=e}function As(i){return i.fcSeg||i.parentNode.fcSeg||null}function Xv(i,e){return wn(i,t=>lM(t,e))}function lM(i,e){let t=[];return e[""]&&t.push(e[""]),e[i.defId]&&t.push(e[i.defId]),t.push(i.ui),IC(t)}function Ra(i,e){let t=i.map(qH);return t.sort((n,s)=>GI(n,s,e)),t.map(n=>n._seg)}function qH(i){let{eventRange:e}=i,t=e.def,n=e.instance?e.instance.range:e.range,s=n.start?n.start.valueOf():0,r=n.end?n.end.valueOf():0;return Object.assign(Object.assign(Object.assign({},t.extendedProps),t),{id:t.publicId,start:s,end:r,duration:r-s,allDay:Number(t.allDay),_seg:i})}function YH(i,e){let{pluginHooks:t}=e,n=t.isDraggableTransformers,{def:s,ui:r}=i.eventRange,o=r.startEditable;for(let a of n)o=a(o,s,r,e);return o}function KH(i,e){return i.isStart&&i.eventRange.ui.durationEditable&&e.options.eventResizableFromStart}function XH(i,e){return i.isEnd&&i.eventRange.ui.durationEditable}function Pr(i,e,t,n,s,r,o){let{dateEnv:a,options:l}=t,{displayEventTime:c,displayEventEnd:d}=l,u=i.eventRange.def,p=i.eventRange.instance;c==null&&(c=n!==!1),d==null&&(d=s!==!1);let m=p.range.start,y=p.range.end,v=r||i.start||i.eventRange.range.start,b=o||i.end||i.eventRange.range.end,S=ue(m).valueOf()===ue(v).valueOf(),C=ue(Ti(y,-1)).valueOf()===ue(Ti(b,-1)).valueOf();return c&&!u.allDay&&(S||C)?(v=S?m:v,b=C?y:b,d&&u.hasEnd?a.formatRange(v,b,e,{forcedStartTzo:r?null:p.forcedStartTzo,forcedEndTzo:o?null:p.forcedEndTzo}):a.format(v,e,{forcedTzo:r?null:p.forcedStartTzo})):""}function ln(i,e,t){let n=i.eventRange.range;return{isPast:n.end<=(t||e.start),isFuture:n.start>=(t||e.end),isToday:e&&Sn(e,n.start)}}function JH(i){let e=["fc-event"];return i.isMirror&&e.push("fc-event-mirror"),i.isDraggable&&e.push("fc-event-draggable"),(i.isStartResizable||i.isEndResizable)&&e.push("fc-event-resizable"),i.isDragging&&e.push("fc-event-dragging"),i.isResizing&&e.push("fc-event-resizing"),i.isSelected&&e.push("fc-event-selected"),i.isStart&&e.push("fc-event-start"),i.isEnd&&e.push("fc-event-end"),i.isPast&&e.push("fc-event-past"),i.isToday&&e.push("fc-event-today"),i.isFuture&&e.push("fc-event-future"),e}function Hf(i){return i.instance?i.instance.instanceId:`${i.def.defId}:${i.range.start.toISOString()}`}function Yc(i,e){let{def:t,instance:n}=i.eventRange,{url:s}=t;if(s)return{href:s};let{emitter:r,options:o}=e,{eventInteractive:a}=o;return a==null&&(a=t.interactive,a==null&&(a=!!r.hasHandlers("eventClick"))),a?$I(l=>{r.trigger("eventClick",{el:l.target,event:new ye(e,t,n),jsEvent:l,view:e.viewApi})}):{}}var ZH={start:P,end:P,allDay:Boolean};function jH(i,e,t){let n=QH(i,e),{range:s}=n;if(!s.start)return null;if(!s.end){if(t==null)return null;s.end=e.add(s.start,t)}return n}function QH(i,e){let{refined:t,extra:n}=ib(i,ZH),s=t.start?e.createMarkerMeta(t.start):null,r=t.end?e.createMarkerMeta(t.end):null,{allDay:o}=t;return o==null&&(o=s&&s.isTimeUnspecified&&(!r||r.isTimeUnspecified)),Object.assign({range:{start:s?s.marker:null,end:r?r.marker:null},allDay:o},n)}function OC(i,e){return eM(i.range,e.range)&&i.allDay===e.allDay&&e$(i,e)}function e$(i,e){for(let t in e)if(t!=="range"&&t!=="allDay"&&i[t]!==e[t])return!1;for(let t in i)if(!(t in e))return!1;return!0}function t$(i,e){return Object.assign(Object.assign({},cM(i.range,e,i.allDay)),{allDay:i.allDay})}function UC(i,e,t){return Object.assign(Object.assign({},cM(i,e,t)),{timeZone:e.timeZone})}function cM(i,e,t){return{start:e.toDate(i.start),end:e.toDate(i.end),startStr:e.formatIso(i.start,{omitTime:t}),endStr:e.formatIso(i.end,{omitTime:t})}}function n$(i,e,t){let n=lb({editable:!1},t),s=Ef(n.refined,n.extra,"",i.allDay,!0,t);return{def:s,ui:lM(s,e),instance:Of(s.defId,i.range),range:i.range,isStart:!0,isEnd:!0}}function BC(i,e,t){let n=!1,s=function(a){n||(n=!0,e(a))},r=function(a){n||(n=!0,t(a))},o=i(s,r);o&&typeof o.then=="function"&&o.then(s,r)}var Jv=class extends Error{constructor(e,t){super(e),this.response=t}};function HC(i,e,t){i=i.toUpperCase();let n={method:i};return i==="GET"?e+=(e.indexOf("?")===-1?"?":"&")+new URLSearchParams(t):(n.body=new URLSearchParams(t),n.headers={"Content-Type":"application/x-www-form-urlencoded"}),fetch(e,n).then(s=>{if(s.ok)return s.json().then(r=>[r,s],()=>{throw new Jv("Failure parsing JSON",s)});throw new Jv("Request failed",s)})}var GA;function $C(){return GA==null&&(GA=i$()),GA}function i$(){if(typeof document>"u")return!0;let i=document.createElement("div");i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.innerHTML="<table><tr><td><div></div></td></tr></table>",i.querySelector("table").style.height="100px",i.querySelector("div").style.height="100%",document.body.appendChild(i);let t=i.querySelector("div").offsetHeight>0;return document.body.removeChild(i),t}var Af=class extends te{constructor(){super(...arguments),this.state={forPrint:!1},this.handleBeforePrint=()=>{vf(()=>{this.setState({forPrint:!0})})},this.handleAfterPrint=()=>{vf(()=>{this.setState({forPrint:!1})})}}render(){let{props:e}=this,{options:t}=e,{forPrint:n}=this.state,s=n||t.height==="auto"||t.contentHeight==="auto",r=!s&&t.height!=null?t.height:"",o=["fc",n?"fc-media-print":"fc-media-screen",`fc-direction-${t.direction}`,e.theme.getClass("root")];return $C()||o.push("fc-liquid-hack"),e.children(o,r,s,n)}componentDidMount(){let{emitter:e}=this.props;e.on("_beforeprint",this.handleBeforePrint),e.on("_afterprint",this.handleAfterPrint)}componentWillUnmount(){let{emitter:e}=this.props;e.off("_beforeprint",this.handleBeforePrint),e.off("_afterprint",this.handleAfterPrint)}},Xn=class{constructor(e){this.component=e.component,this.isHitComboAllowed=e.isHitComboAllowed||null}destroy(){}};function dM(i,e){return{component:i,el:e.el,useEventCenter:e.useEventCenter!=null?e.useEventCenter:!0,isHitComboAllowed:e.isHitComboAllowed||null}}function $f(i){return{[i.component.uid]:i}}var Kc={},Bt=class extends rt{constructor(e,t){super(e,t),this.handleRefresh=()=>{let n=this.computeTiming();n.state.nowDate.valueOf()!==this.state.nowDate.valueOf()&&this.setState(n.state),this.clearTimeout(),this.setTimeout(n.waitMs)},this.handleVisibilityChange=()=>{document.hidden||this.handleRefresh()},this.state=this.computeTiming().state}render(){let{props:e,state:t}=this;return e.children(t.nowDate,t.todayRange)}componentDidMount(){this.setTimeout(),this.context.nowManager.addResetListener(this.handleRefresh),document.addEventListener("visibilitychange",this.handleVisibilityChange)}componentDidUpdate(e){e.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())}componentWillUnmount(){this.clearTimeout(),this.context.nowManager.removeResetListener(this.handleRefresh),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}computeTiming(){let{props:e,context:t}=this,n=t.nowManager.getDateMarker(),{nowIndicatorSnap:s}=t.options;s==="auto"&&(s=/year|month|week|day/.test(e.unit)||(e.unitValue||1)===1);let r,o;return s?(r=t.dateEnv.startOf(n,e.unit),o=t.dateEnv.add(r,ee(1,e.unit)).valueOf()-n.valueOf()):(r=n,o=1e3*60),o=Math.min(1e3*60*60*24,o),{state:{nowDate:r,todayRange:s$(r)},waitMs:o}}setTimeout(e=this.computeTiming().waitMs){this.timeoutId=setTimeout(()=>{let t=this.computeTiming();this.setState(t.state,()=>{this.setTimeout(t.waitMs)})},e)}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}};Bt.contextType=Cn;function s$(i){let e=ue(i),t=we(e,1);return{start:e,end:t}}var Cf=class{getCurrentData(){return this.currentDataManager.getCurrentData()}dispatch(e){this.currentDataManager.dispatch(e)}get view(){return this.getCurrentData().viewApi}batchRendering(e){e()}updateSize(){this.trigger("_resize",!0)}setOption(e,t){this.dispatch({type:"SET_OPTION",optionName:e,rawOptionValue:t})}getOption(e){return this.currentDataManager.currentCalendarOptionsInput[e]}getAvailableLocaleCodes(){return Object.keys(this.getCurrentData().availableRawLocales)}on(e,t){let{currentDataManager:n}=this;n.currentCalendarOptionsRefiners[e]?n.emitter.on(e,t):console.warn(`Unknown listener name '${e}'`)}off(e,t){this.currentDataManager.emitter.off(e,t)}trigger(e,...t){this.currentDataManager.emitter.trigger(e,...t)}changeView(e,t){this.batchRendering(()=>{if(this.unselect(),t)if(t.start&&t.end)this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e}),this.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:t});else{let{dateEnv:n}=this.getCurrentData();this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e,dateMarker:n.createMarker(t)})}else this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e})})}zoomTo(e,t){let n=this.getCurrentData(),s;t=t||"day",s=n.viewSpecs[t]||this.getUnitViewSpec(t),this.unselect(),s?this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:s.type,dateMarker:e}):this.dispatch({type:"CHANGE_DATE",dateMarker:e})}getUnitViewSpec(e){let{viewSpecs:t,toolbarConfig:n}=this.getCurrentData(),s=[].concat(n.header?n.header.viewsWithButtons:[],n.footer?n.footer.viewsWithButtons:[]),r,o;for(let a in t)s.push(a);for(r=0;r<s.length;r+=1)if(o=t[s[r]],o&&o.singleUnit===e)return o;return null}prev(){this.unselect(),this.dispatch({type:"PREV"})}next(){this.unselect(),this.dispatch({type:"NEXT"})}prevYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,-1)})}nextYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,1)})}today(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.nowManager.getDateMarker()})}gotoDate(e){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.createMarker(e)})}incrementDate(e){let t=this.getCurrentData(),n=ee(e);n&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.add(t.currentDate,n)}))}getDate(){let e=this.getCurrentData();return e.dateEnv.toDate(e.currentDate)}formatDate(e,t){let{dateEnv:n}=this.getCurrentData();return n.format(n.createMarker(e),he(t))}formatRange(e,t,n){let{dateEnv:s}=this.getCurrentData();return s.formatRange(s.createMarker(e),s.createMarker(t),he(n),n)}formatIso(e,t){let{dateEnv:n}=this.getCurrentData();return n.formatIso(n.createMarker(e),{omitTime:t})}select(e,t){let n;t==null?e.start!=null?n=e:n={start:e,end:null}:n={start:e,end:t};let s=this.getCurrentData(),r=jH(n,s.dateEnv,ee({days:1}));r&&(this.dispatch({type:"SELECT_DATES",selection:r}),ub(r,null,s))}unselect(e){let t=this.getCurrentData();t.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),GH(e,t))}addEvent(e,t){if(e instanceof ye){let o=e._def,a=e._instance;return this.getCurrentData().eventStore.defs[o.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:wf({def:o,instance:a})}),this.triggerEventAdd(e)),e}let n=this.getCurrentData(),s;if(t instanceof Sr)s=t.internalEventSource;else if(typeof t=="boolean")t&&([s]=rb(n.eventSources));else if(t!=null){let o=this.getEventSourceById(t);if(!o)return console.warn(`Could not find an event source with ID "${t}"`),null;s=o.internalEventSource}let r=iM(e,s,n,!1);if(r){let o=new ye(n,r.def,r.def.recurringDef?null:r.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:wf(r)}),this.triggerEventAdd(o),o}return null}triggerEventAdd(e){let{emitter:t}=this.getCurrentData();t.trigger("eventAdd",{event:e,relatedEvents:[],revert:()=>{this.dispatch({type:"REMOVE_EVENTS",eventStore:aM(e)})}})}getEventById(e){let t=this.getCurrentData(),{defs:n,instances:s}=t.eventStore;e=String(e);for(let r in n){let o=n[r];if(o.publicId===e){if(o.recurringDef)return new ye(t,o,null);for(let a in s){let l=s[a];if(l.defId===o.defId)return new ye(t,o,l)}}}return null}getEvents(){let e=this.getCurrentData();return Ii(e.eventStore,e)}removeAllEvents(){this.dispatch({type:"REMOVE_ALL_EVENTS"})}getEventSources(){let e=this.getCurrentData(),t=e.eventSources,n=[];for(let s in t)n.push(new Sr(e,t[s]));return n}getEventSourceById(e){let t=this.getCurrentData(),n=t.eventSources;e=String(e);for(let s in n)if(n[s].publicId===e)return new Sr(t,n[s]);return null}addEventSource(e){let t=this.getCurrentData();if(e instanceof Sr)return t.eventSources[e.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[e.internalEventSource]}),e;let n=MC(e,t);return n?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[n]}),new Sr(t,n)):null}removeAllEventSources(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})}refetchEvents(){this.dispatch({type:"FETCH_EVENT_SOURCES",isRefetch:!0})}scrollToTime(e){let t=ee(e);t&&this.trigger("_scrollRequest",{time:t})}};function VC(i,e){return i.left>=e.left&&i.left<e.right&&i.top>=e.top&&i.top<e.bottom}function hb(i,e){let t={left:Math.max(i.left,e.left),right:Math.min(i.right,e.right),top:Math.max(i.top,e.top),bottom:Math.min(i.bottom,e.bottom)};return t.left<t.right&&t.top<t.bottom?t:!1}function GC(i,e){return{left:Math.min(Math.max(i.left,e.left),e.right),top:Math.min(Math.max(i.top,e.top),e.bottom)}}function zC(i){return{left:(i.left+i.right)/2,top:(i.top+i.bottom)/2}}function WC(i,e){return{left:i.left-e.left,top:i.top-e.top}}var zA=vt(),Tf=class{constructor(){this.getKeysForEventDefs=z(this._getKeysForEventDefs),this.splitDateSelection=z(this._splitDateSpan),this.splitEventStore=z(this._splitEventStore),this.splitIndividualUi=z(this._splitIndividualUi),this.splitEventDrag=z(this._splitInteraction),this.splitEventResize=z(this._splitInteraction),this.eventUiBuilders={}}splitProps(e){let t=this.getKeyInfo(e),n=this.getKeysForEventDefs(e.eventStore),s=this.splitDateSelection(e.dateSelection),r=this.splitIndividualUi(e.eventUiBases,n),o=this.splitEventStore(e.eventStore,n),a=this.splitEventDrag(e.eventDrag),l=this.splitEventResize(e.eventResize),c={};this.eventUiBuilders=wn(t,(d,u)=>this.eventUiBuilders[u]||z(r$));for(let d in t){let u=t[d],p=o[d]||zA,m=this.eventUiBuilders[d];c[d]={businessHours:u.businessHours||e.businessHours,dateSelection:s[d]||null,eventStore:p,eventUiBases:m(e.eventUiBases[""],u.ui,r[d]),eventSelection:p.instances[e.eventSelection]?e.eventSelection:"",eventDrag:a[d]||null,eventResize:l[d]||null}}return c}_splitDateSpan(e){let t={};if(e){let n=this.getKeysForDateSpan(e);for(let s of n)t[s]=e}return t}_getKeysForEventDefs(e){return wn(e.defs,t=>this.getKeysForEventDef(t))}_splitEventStore(e,t){let{defs:n,instances:s}=e,r={};for(let o in n)for(let a of t[o])r[a]||(r[a]=vt()),r[a].defs[o]=n[o];for(let o in s){let a=s[o];for(let l of t[a.defId])r[l]&&(r[l].instances[o]=a)}return r}_splitIndividualUi(e,t){let n={};for(let s in e)if(s)for(let r of t[s])n[r]||(n[r]={}),n[r][s]=e[s];return n}_splitInteraction(e){let t={};if(e){let n=this._splitEventStore(e.affectedEvents,this._getKeysForEventDefs(e.affectedEvents)),s=this._getKeysForEventDefs(e.mutatedEvents),r=this._splitEventStore(e.mutatedEvents,s),o=a=>{t[a]||(t[a]={affectedEvents:n[a]||zA,mutatedEvents:r[a]||zA,isEvent:e.isEvent})};for(let a in n)o(a);for(let a in r)o(a)}return t}};function r$(i,e,t){let n=[];i&&n.push(i),e&&n.push(e);let s={"":IC(n)};return t&&Object.assign(s,t),s}function Vf(i,e,t,n){return{dow:i.getUTCDay(),isDisabled:!!(n&&(!n.activeRange||!Sn(n.activeRange,i))),isOther:!!(n&&!Sn(n.currentRange,i)),isToday:!!(e&&Sn(e,i)),isPast:!!(t?i<t:e&&i<e.start),isFuture:!!(t?i>t:e&&i>=e.end)}}function Xc(i,e){let t=["fc-day",`fc-day-${HB[i.dow]}`];return i.isDisabled?t.push("fc-day-disabled"):(i.isToday&&(t.push("fc-day-today"),t.push(e.getClass("today"))),i.isPast&&t.push("fc-day-past"),i.isFuture&&t.push("fc-day-future"),i.isOther&&t.push("fc-day-other")),t}var o$=he({year:"numeric",month:"long",day:"numeric"}),a$=he({week:"long"});function Mi(i,e,t="day",n=!0){let{dateEnv:s,options:r,calendarApi:o}=i,a=s.format(e,t==="week"?a$:o$);if(r.navLinks){let l=s.toDate(e),c=d=>{let u=t==="day"?r.navLinkDayClick:t==="week"?r.navLinkWeekClick:null;typeof u=="function"?u.call(o,s.toDate(e),d):(typeof u=="string"&&(t=u),o.zoomTo(e,t))};return Object.assign({title:Gc(r.navLinkHint,[a,l],a),"data-navlink":""},n?HI(c):{onClick:c})}return{"aria-label":a}}var WA=null;function uM(){return WA===null&&(WA=l$()),WA}function l$(){let i=document.createElement("div");xa(i,{position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}),i.innerHTML="<div></div>",document.body.appendChild(i);let t=i.firstChild.getBoundingClientRect().left>i.getBoundingClientRect().left;return Mf(i),t}var qA;function hM(){return qA||(qA=c$()),qA}function c$(){let i=document.createElement("div");i.style.overflow="scroll",i.style.position="absolute",i.style.top="-9999px",i.style.left="-9999px",document.body.appendChild(i);let e=fM(i);return document.body.removeChild(i),e}function fM(i){return{x:i.offsetHeight-i.clientHeight,y:i.offsetWidth-i.clientWidth}}function pM(i,e=!1){let t=window.getComputedStyle(i),n=parseInt(t.borderLeftWidth,10)||0,s=parseInt(t.borderRightWidth,10)||0,r=parseInt(t.borderTopWidth,10)||0,o=parseInt(t.borderBottomWidth,10)||0,a=fM(i),l=a.y-n-s,c=a.x-r-o,d={borderLeft:n,borderRight:s,borderTop:r,borderBottom:o,scrollbarBottom:c,scrollbarLeft:0,scrollbarRight:0};return uM()&&t.direction==="rtl"?d.scrollbarLeft=l:d.scrollbarRight=l,e&&(d.paddingLeft=parseInt(t.paddingLeft,10)||0,d.paddingRight=parseInt(t.paddingRight,10)||0,d.paddingTop=parseInt(t.paddingTop,10)||0,d.paddingBottom=parseInt(t.paddingBottom,10)||0),d}function qC(i,e=!1,t){let n=t?i.getBoundingClientRect():Gf(i),s=pM(i,e),r={left:n.left+s.borderLeft+s.scrollbarLeft,right:n.right-s.borderRight-s.scrollbarRight,top:n.top+s.borderTop,bottom:n.bottom-s.borderBottom-s.scrollbarBottom};return e&&(r.left+=s.paddingLeft,r.right-=s.paddingRight,r.top+=s.paddingTop,r.bottom-=s.paddingBottom),r}function Gf(i){let e=i.getBoundingClientRect();return{left:e.left+window.scrollX,top:e.top+window.scrollY,right:e.right+window.scrollX,bottom:e.bottom+window.scrollY}}function d$(i){let e=fb(i),t=i.getBoundingClientRect();for(let n of e){let s=hb(t,n.getBoundingClientRect());if(s)t=s;else return null}return t}function fb(i){let e=[];for(;i instanceof HTMLElement;){let t=window.getComputedStyle(i);if(t.position==="fixed")break;/(auto|scroll)/.test(t.overflow+t.overflowY+t.overflowX)&&e.push(i),i=i.parentNode}return e}var Jn=class{constructor(e,t,n,s){this.els=t;let r=this.originClientRect=e.getBoundingClientRect();n&&this.buildElHorizontals(r.left),s&&this.buildElVerticals(r.top)}buildElHorizontals(e){let t=[],n=[];for(let s of this.els){let r=s.getBoundingClientRect();t.push(r.left-e),n.push(r.right-e)}this.lefts=t,this.rights=n}buildElVerticals(e){let t=[],n=[];for(let s of this.els){let r=s.getBoundingClientRect();t.push(r.top-e),n.push(r.bottom-e)}this.tops=t,this.bottoms=n}leftToIndex(e){let{lefts:t,rights:n}=this,s=t.length,r;for(r=0;r<s;r+=1)if(e>=t[r]&&e<n[r])return r}topToIndex(e){let{tops:t,bottoms:n}=this,s=t.length,r;for(r=0;r<s;r+=1)if(e>=t[r]&&e<n[r])return r}getWidth(e){return this.rights[e]-this.lefts[e]}getHeight(e){return this.bottoms[e]-this.tops[e]}similarTo(e){return Uv(this.tops||[],e.tops||[])&&Uv(this.bottoms||[],e.bottoms||[])&&Uv(this.lefts||[],e.lefts||[])&&Uv(this.rights||[],e.rights||[])}};function Uv(i,e){let t=i.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(Math.round(i[n])!==Math.round(e[n]))return!1;return!0}var ba=class{getMaxScrollTop(){return this.getScrollHeight()-this.getClientHeight()}getMaxScrollLeft(){return this.getScrollWidth()-this.getClientWidth()}canScrollVertically(){return this.getMaxScrollTop()>0}canScrollHorizontally(){return this.getMaxScrollLeft()>0}canScrollUp(){return this.getScrollTop()>0}canScrollDown(){return this.getScrollTop()<this.getMaxScrollTop()}canScrollLeft(){return this.getScrollLeft()>0}canScrollRight(){return this.getScrollLeft()<this.getMaxScrollLeft()}},_f=class extends ba{constructor(e){super(),this.el=e}getScrollTop(){return this.el.scrollTop}getScrollLeft(){return this.el.scrollLeft}setScrollTop(e){this.el.scrollTop=e}setScrollLeft(e){this.el.scrollLeft=e}getScrollWidth(){return this.el.scrollWidth}getScrollHeight(){return this.el.scrollHeight}getClientHeight(){return this.el.clientHeight}getClientWidth(){return this.el.clientWidth}},xf=class extends ba{getScrollTop(){return window.scrollY}getScrollLeft(){return window.scrollX}setScrollTop(e){window.scroll(window.scrollX,e)}setScrollLeft(e){window.scroll(e,window.scrollY)}getScrollWidth(){return document.documentElement.scrollWidth}getScrollHeight(){return document.documentElement.scrollHeight}getClientHeight(){return document.documentElement.clientHeight}getClientWidth(){return document.documentElement.clientWidth}},ot=class extends te{constructor(){super(...arguments),this.uid=ws()}prepareHits(){}queryHit(e,t,n,s){return null}isValidSegDownEl(e){return!this.props.eventDrag&&!this.props.eventResize&&!Ge(e,".fc-event-mirror")}isValidDateDownEl(e){return!Ge(e,".fc-event:not(.fc-bg-event)")&&!Ge(e,".fc-more-link")&&!Ge(e,"a[data-navlink]")&&!Ge(e,".fc-popover")}};var Ea=class{constructor(e=t=>t.thickness||1){this.getEntryThickness=e,this.strictOrder=!1,this.allowReslicing=!1,this.maxCoord=-1,this.maxStackCnt=-1,this.levelCoords=[],this.entriesByLevel=[],this.stackCnts={}}addSegs(e){let t=[];for(let n of e)this.insertEntry(n,t);return t}insertEntry(e,t){let n=this.findInsertion(e);this.isInsertionValid(n,e)?this.insertEntryAt(e,n):this.handleInvalidInsertion(n,e,t)}isInsertionValid(e,t){return(this.maxCoord===-1||e.levelCoord+this.getEntryThickness(t)<=this.maxCoord)&&(this.maxStackCnt===-1||e.stackCnt<this.maxStackCnt)}handleInvalidInsertion(e,t,n){if(this.allowReslicing&&e.touchingEntry){let s=Object.assign(Object.assign({},t),{span:zf(t.span,e.touchingEntry.span)});n.push(s),this.splitEntry(t,e.touchingEntry,n)}else n.push(t)}splitEntry(e,t,n){let s=e.span,r=t.span;s.start<r.start&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:s.start,end:r.start}},n),s.end>r.end&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:r.end,end:s.end}},n)}insertEntryAt(e,t){let{entriesByLevel:n,levelCoords:s}=this;t.lateral===-1?(YA(s,t.level,t.levelCoord),YA(n,t.level,[e])):YA(n[t.level],t.lateral,e),this.stackCnts[xi(e)]=t.stackCnt}findInsertion(e){let{levelCoords:t,entriesByLevel:n,strictOrder:s,stackCnts:r}=this,o=t.length,a=0,l=-1,c=-1,d=null,u=0;for(let y=0;y<o;y+=1){let v=t[y];if(!s&&v>=a+this.getEntryThickness(e))break;let b=n[y],S,C=Df(b,e.span.start,Rf),T=C[0]+C[1];for(;(S=b[T])&&S.span.start<e.span.end;){let _=v+this.getEntryThickness(S);_>a&&(a=_,d=S,l=y,c=T),_===a&&(u=Math.max(u,r[xi(S)]+1)),T+=1}}let p=0;if(d)for(p=l+1;p<o&&t[p]<a;)p+=1;let m=-1;return p<o&&t[p]===a&&(m=Df(n[p],e.span.end,Rf)[0]),{touchingLevel:l,touchingLateral:c,touchingEntry:d,stackCnt:u,levelCoord:a,level:p,lateral:m}}toRects(){let{entriesByLevel:e,levelCoords:t}=this,n=e.length,s=[];for(let r=0;r<n;r+=1){let o=e[r],a=t[r];for(let l of o)s.push(Object.assign(Object.assign({},l),{thickness:this.getEntryThickness(l),levelCoord:a}))}return s}};function Rf(i){return i.span.end}function xi(i){return i.index+":"+i.span.start}function YC(i){let e=[];for(let t of i){let n=[],s={span:t.span,entries:[t]};for(let r of e)zf(r.span,s.span)?s={entries:r.entries.concat(s.entries),span:u$(r.span,s.span)}:n.push(r);n.push(s),e=n}return e}function u$(i,e){return{start:Math.min(i.start,e.start),end:Math.max(i.end,e.end)}}function zf(i,e){let t=Math.max(i.start,e.start),n=Math.min(i.end,e.end);return t<n?{start:t,end:n}:null}function YA(i,e,t){i.splice(e,0,t)}function Df(i,e,t){let n=0,s=i.length;if(!s||e<t(i[n]))return[0,0];if(e>t(i[s-1]))return[s,0];for(;n<s;){let r=Math.floor(n+(s-n)/2),o=t(i[r]);if(e<o)s=r;else if(e>o)n=r+1;else return[r,1]}return[n,0]}var If=class{constructor(e,t){this.emitter=new Es}destroy(){}setMirrorIsVisible(e){}setMirrorNeedsRevert(e){}setAutoScrollEnabled(e){}},Wf={};function gM(i,e){return!i||e>10?he({weekday:"short"}):e>1?he({weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}):he({weekday:"long"})}var mM="fc-col-header-cell";function yM(i){return i.text}var Zv=class extends te{render(){let{dateEnv:e,options:t,theme:n,viewApi:s}=this.context,{props:r}=this,{date:o,dateProfile:a}=r,l=Vf(o,r.todayRange,null,a),c=[mM].concat(Xc(l,n)),d=e.format(o,r.dayHeaderFormat),u=!l.isDisabled&&r.colCnt>1?Mi(this.context,o):{},p=e.toDate(o);e.namedTimeZoneImpl&&(p=Ti(p,36e5));let m=Object.assign(Object.assign(Object.assign({date:p,view:s},r.extraRenderProps),{text:d}),l);return x(Re,{elTag:"th",elClasses:c,elAttrs:Object.assign({role:"columnheader",colSpan:r.colSpan,"data-date":l.isDisabled?void 0:Dr(o)},r.extraDataAttrs),renderProps:m,generatorName:"dayHeaderContent",customGenerator:t.dayHeaderContent,defaultGenerator:yM,classNameGenerator:t.dayHeaderClassNames,didMount:t.dayHeaderDidMount,willUnmount:t.dayHeaderWillUnmount},y=>x("div",{className:"fc-scrollgrid-sync-inner"},!l.isDisabled&&x(y,{elTag:"a",elAttrs:u,elClasses:["fc-col-header-cell-cushion",r.isSticky&&"fc-sticky"]})))}},h$=he({weekday:"long"}),jv=class extends te{render(){let{props:e}=this,{dateEnv:t,theme:n,viewApi:s,options:r}=this.context,o=we(new Date(2592e5),e.dow),a={dow:e.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},l=t.format(o,e.dayHeaderFormat),c=Object.assign(Object.assign(Object.assign(Object.assign({date:o},a),{view:s}),e.extraRenderProps),{text:l});return x(Re,{elTag:"th",elClasses:[mM,...Xc(a,n),...e.extraClassNames||[]],elAttrs:Object.assign({role:"columnheader",colSpan:e.colSpan},e.extraDataAttrs),renderProps:c,generatorName:"dayHeaderContent",customGenerator:r.dayHeaderContent,defaultGenerator:yM,classNameGenerator:r.dayHeaderClassNames,didMount:r.dayHeaderDidMount,willUnmount:r.dayHeaderWillUnmount},d=>x("div",{className:"fc-scrollgrid-sync-inner"},x(d,{elTag:"a",elClasses:["fc-col-header-cell-cushion",e.isSticky&&"fc-sticky"],elAttrs:{"aria-label":t.format(o,h$)}})))}},Sa=class extends te{constructor(){super(...arguments),this.createDayHeaderFormatter=z(f$)}render(){let{context:e}=this,{dates:t,dateProfile:n,datesRepDistinctDays:s,renderIntro:r}=this.props,o=this.createDayHeaderFormatter(e.options.dayHeaderFormat,s,t.length);return x(Bt,{unit:"day"},(a,l)=>x("tr",{role:"row"},r&&r("day"),t.map(c=>s?x(Zv,{key:c.toISOString(),date:c,dateProfile:n,todayRange:l,colCnt:t.length,dayHeaderFormat:o}):x(jv,{key:c.getUTCDay(),dow:c.getUTCDay(),dayHeaderFormat:o}))))}};function f$(i,e,t){return i||gM(e,t)}var wa=class{constructor(e,t){let n=e.start,{end:s}=e,r=[],o=[],a=-1;for(;n<s;)t.isHiddenDay(n)?r.push(a+.5):(a+=1,r.push(a),o.push(n)),n=we(n,1);this.dates=o,this.indices=r,this.cnt=o.length}sliceRange(e){let t=this.getDateDayIndex(e.start),n=this.getDateDayIndex(we(e.end,-1)),s=Math.max(0,t),r=Math.min(this.cnt-1,n);return s=Math.ceil(s),r=Math.floor(r),s<=r?{firstIndex:s,lastIndex:r,isStart:t===s,isEnd:n===r}:null}getDateDayIndex(e){let{indices:t}=this,n=Math.floor(Di(this.dates[0],e));return n<0?t[0]-1:n>=t.length?t[t.length-1]+1:t[n]}},Aa=class{constructor(e,t){let{dates:n}=e,s,r,o;if(t){for(r=n[0].getUTCDay(),s=1;s<n.length&&n[s].getUTCDay()!==r;s+=1);o=Math.ceil(n.length/s)}else o=1,s=n.length;this.rowCnt=o,this.colCnt=s,this.daySeries=e,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}buildCells(){let e=[];for(let t=0;t<this.rowCnt;t+=1){let n=[];for(let s=0;s<this.colCnt;s+=1)n.push(this.buildCell(t,s));e.push(n)}return e}buildCell(e,t){let n=this.daySeries.dates[e*this.colCnt+t];return{key:n.toISOString(),date:n}}buildHeaderDates(){let e=[];for(let t=0;t<this.colCnt;t+=1)e.push(this.cells[0][t].date);return e}sliceRange(e){let{colCnt:t}=this,n=this.daySeries.sliceRange(e),s=[];if(n){let{firstIndex:r,lastIndex:o}=n,a=r;for(;a<=o;){let l=Math.floor(a/t),c=Math.min((l+1)*t,o+1);s.push({row:l,firstCol:a%t,lastCol:(c-1)%t,isStart:n.isStart&&a===r,isEnd:n.isEnd&&c-1===o}),a=c}}return s}},Ca=class{constructor(){this.sliceBusinessHours=z(this._sliceBusinessHours),this.sliceDateSelection=z(this._sliceDateSpan),this.sliceEventStore=z(this._sliceEventStore),this.sliceEventDrag=z(this._sliceInteraction),this.sliceEventResize=z(this._sliceInteraction),this.forceDayIfListItem=!1}sliceProps(e,t,n,s,...r){let{eventUiBases:o}=e,a=this.sliceEventStore(e.eventStore,o,t,n,...r);return{dateSelectionSegs:this.sliceDateSelection(e.dateSelection,t,n,o,s,...r),businessHourSegs:this.sliceBusinessHours(e.businessHours,t,n,s,...r),fgEventSegs:a.fg,bgEventSegs:a.bg,eventDrag:this.sliceEventDrag(e.eventDrag,o,t,n,...r),eventResize:this.sliceEventResize(e.eventResize,o,t,n,...r),eventSelection:e.eventSelection}}sliceNowDate(e,t,n,s,...r){return this._sliceDateSpan({range:{start:e,end:Ti(e,1)},allDay:!1},t,n,{},s,...r)}_sliceBusinessHours(e,t,n,s,...r){return e?this._sliceEventStore(va(e,Bv(t,!!n),s),{},t,n,...r).bg:[]}_sliceEventStore(e,t,n,s,...r){if(e){let o=$c(e,t,Bv(n,!!s),s);return{bg:this.sliceEventRanges(o.bg,r),fg:this.sliceEventRanges(o.fg,r)}}return{bg:[],fg:[]}}_sliceInteraction(e,t,n,s,...r){if(!e)return null;let o=$c(e.mutatedEvents,t,Bv(n,!!s),s);return{segs:this.sliceEventRanges(o.fg,r),affectedInstances:e.affectedEvents.instances,isEvent:e.isEvent}}_sliceDateSpan(e,t,n,s,r,...o){if(!e)return[];let a=Bv(t,!!n),l=on(e.range,a);if(l){e=Object.assign(Object.assign({},e),{range:l});let c=n$(e,s,r),d=this.sliceRange(e.range,...o);for(let u of d)u.eventRange=c;return d}return[]}sliceEventRanges(e,t){let n=[];for(let s of e)n.push(...this.sliceEventRange(s,t));return n}sliceEventRange(e,t){let n=e.range;this.forceDayIfListItem&&e.ui.display==="list-item"&&(n={start:n.start,end:we(n.start,1)});let s=this.sliceRange(n,...t);for(let r of s)r.eventRange=e,r.isStart=e.isStart&&r.isStart,r.isEnd=e.isEnd&&r.isEnd;return s}};function Bv(i,e){let t=i.activeRange;return e?t:{start:Ti(t.start,i.slotMinTime.milliseconds),end:Ti(t.end,i.slotMaxTime.milliseconds-864e5)}}function pb(i,e,t){let{instances:n}=i.mutatedEvents;for(let s in n)if(!Wc(e.validRange,n[s].range))return!1;return vM({eventDrag:i},t)}function KC(i,e,t){return Wc(e.validRange,i.range)?vM({dateSelection:i},t):!1}function vM(i,e){let t=e.getCurrentData(),n=Object.assign({businessHours:t.businessHours,dateSelection:"",eventStore:t.eventStore,eventUiBases:t.eventUiBases,eventSelection:"",eventDrag:null,eventResize:null},i);return(e.pluginHooks.isPropsValid||bM)(n,e)}function bM(i,e,t={},n){return!(i.eventDrag&&!p$(i,e,t,n)||i.dateSelection&&!g$(i,e,t,n))}function p$(i,e,t,n){let s=e.getCurrentData(),r=i.eventDrag,o=r.mutatedEvents,a=o.defs,l=o.instances,c=Xv(a,r.isEvent?i.eventUiBases:{"":s.selectionConfig});n&&(c=wn(c,n));let d=OH(i.eventStore,r.affectedEvents.instances),u=d.defs,p=d.instances,m=Xv(u,i.eventUiBases);for(let y in l){let v=l[y],b=v.range,S=c[v.defId],C=a[v.defId];if(!EM(S.constraints,b,d,i.businessHours,e))return!1;let{eventOverlap:T}=e.options,_=typeof T=="function"?T:null;for(let I in p){let M=p[I];if(ob(b,M.range)&&(m[M.defId].overlap===!1&&r.isEvent||S.overlap===!1||_&&!_(new ye(e,u[M.defId],M),new ye(e,C,v))))return!1}let R=s.eventStore;for(let I of S.allows){let M=Object.assign(Object.assign({},t),{range:v.range,allDay:C.allDay}),k=R.defs[C.defId],N=R.instances[y],F;if(k?F=new ye(e,k,N):F=new ye(e,C),!I(FC(M,e),F))return!1}}return!0}function g$(i,e,t,n){let s=i.eventStore,r=s.defs,o=s.instances,a=i.dateSelection,l=a.range,{selectionConfig:c}=e.getCurrentData();if(n&&(c=n(c)),!EM(c.constraints,l,s,i.businessHours,e))return!1;let{selectOverlap:d}=e.options,u=typeof d=="function"?d:null;for(let p in o){let m=o[p];if(ob(l,m.range)&&(c.overlap===!1||u&&!u(new ye(e,r[m.defId],m),null)))return!1}for(let p of c.allows){let m=Object.assign(Object.assign({},t),a);if(!p(FC(m,e),null))return!1}return!0}function EM(i,e,t,n,s){for(let r of i)if(!y$(m$(r,e,t,n,s),e))return!1;return!0}function m$(i,e,t,n,s){return i==="businessHours"?KA(va(n,e,s)):typeof i=="string"?KA(db(t,r=>r.groupId===i)):typeof i=="object"&&i?KA(va(i,e,s)):[]}function KA(i){let{instances:e}=i,t=[];for(let n in e)t.push(e[n].range);return t}function y$(i,e){for(let t of i)if(Wc(t,e))return!0;return!1}var Hv=/^(visible|hidden)$/,Vc=class extends te{constructor(){super(...arguments),this.handleEl=e=>{this.el=e,an(this.props.elRef,e)}}render(){let{props:e}=this,{liquid:t,liquidIsAbsolute:n}=e,s=t&&n,r=["fc-scroller"];return t&&(n?r.push("fc-scroller-liquid-absolute"):r.push("fc-scroller-liquid")),x("div",{ref:this.handleEl,className:r.join(" "),style:{overflowX:e.overflowX,overflowY:e.overflowY,left:s&&-(e.overcomeLeft||0)||"",right:s&&-(e.overcomeRight||0)||"",bottom:s&&-(e.overcomeBottom||0)||"",marginLeft:!s&&-(e.overcomeLeft||0)||"",marginRight:!s&&-(e.overcomeRight||0)||"",marginBottom:!s&&-(e.overcomeBottom||0)||"",maxHeight:e.maxHeight||""}},e.children)}needsXScrolling(){if(Hv.test(this.props.overflowX))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),{children:n}=e;for(let s=0;s<n.length;s+=1)if(n[s].getBoundingClientRect().width>t)return!0;return!1}needsYScrolling(){if(Hv.test(this.props.overflowY))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),{children:n}=e;for(let s=0;s<n.length;s+=1)if(n[s].getBoundingClientRect().height>t)return!0;return!1}getXScrollbarWidth(){return Hv.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight}getYScrollbarWidth(){return Hv.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth}},Ht=class{constructor(e){this.masterCallback=e,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=(t,n)=>{let{depths:s,currentMap:r}=this,o=!1,a=!1;t!==null?(o=n in r,r[n]=t,s[n]=(s[n]||0)+1,a=!0):(s[n]-=1,s[n]||(delete r[n],delete this.callbackMap[n],o=!0)),this.masterCallback&&(o&&this.masterCallback(null,String(n)),a&&this.masterCallback(t,String(n)))}}createRef(e){let t=this.callbackMap[e];return t||(t=this.callbackMap[e]=n=>{this.handleValue(n,String(e))}),t}collect(e,t,n){return XI(this.currentMap,e,t,n)}getAll(){return rb(this.currentMap)}};function SM(i){let e=UI(i,".fc-scrollgrid-shrink"),t=0;for(let n of e)t=Math.max(t,NB(n));return Math.ceil(t)}function XC(i,e){return i.liquid&&e.liquid}function wM(i,e){return e.maxHeight!=null||XC(i,e)}function AM(i,e,t,n){let{expandRows:s}=t;return typeof e.content=="function"?e.content(t):x("table",{role:"presentation",className:[e.tableClassName,i.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:t.tableMinWidth,width:t.clientWidth,height:s?t.clientHeight:""}},t.tableColGroupNode,x(n?"thead":"tbody",{role:"presentation"},typeof e.rowContent=="function"?e.rowContent(t):e.rowContent))}function CM(i,e){return Ri(i,e,Ut)}function TM(i,e){let t=[];for(let n of i){let s=n.span||1;for(let r=0;r<s;r+=1)t.push(x("col",{style:{width:n.width==="shrink"?_M(e):n.width||"",minWidth:n.minWidth||""}}))}return x("colgroup",{},...t)}function _M(i){return i??4}function xM(i){for(let e of i)if(e.width==="shrink")return!0;return!1}function RM(i,e){let t=["fc-scrollgrid",e.theme.getClass("table")];return i&&t.push("fc-scrollgrid-liquid"),t}function DM(i,e){let t=["fc-scrollgrid-section",`fc-scrollgrid-section-${i.type}`,i.className];return e&&i.liquid&&i.maxHeight==null&&t.push("fc-scrollgrid-section-liquid"),i.isSticky&&t.push("fc-scrollgrid-section-sticky"),t}function Jc(i){return x("div",{className:"fc-scrollgrid-sticky-shim",style:{width:i.clientWidth,minWidth:i.tableMinWidth}})}function Da(i){let{stickyHeaderDates:e}=i;return(e==null||e==="auto")&&(e=i.height==="auto"||i.viewHeight==="auto"),e}function qf(i){let{stickyFooterScrollbar:e}=i;return(e==null||e==="auto")&&(e=i.height==="auto"||i.viewHeight==="auto"),e}var Tr=class extends te{constructor(){super(...arguments),this.processCols=z(e=>e,CM),this.renderMicroColGroup=z(TM),this.scrollerRefs=new Ht,this.scrollerElRefs=new Ht(this._handleScrollerEl.bind(this)),this.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},this.handleSizing=()=>{this.safeSetState(Object.assign({shrinkWidth:this.computeShrinkWidth()},this.computeScrollerDims()))}}render(){let{props:e,state:t,context:n}=this,s=e.sections||[],r=this.processCols(e.cols),o=this.renderMicroColGroup(r,t.shrinkWidth),a=RM(e.liquid,n);e.collapsibleWidth&&a.push("fc-scrollgrid-collapsible");let l=s.length,c=0,d,u=[],p=[],m=[];for(;c<l&&(d=s[c]).type==="header";)u.push(this.renderSection(d,o,!0)),c+=1;for(;c<l&&(d=s[c]).type==="body";)p.push(this.renderSection(d,o,!1)),c+=1;for(;c<l&&(d=s[c]).type==="footer";)m.push(this.renderSection(d,o,!0)),c+=1;let y=!$C(),v={role:"rowgroup"};return x("table",{role:"grid",className:a.join(" "),style:{height:e.height}},!!(!y&&u.length)&&x("thead",v,...u),!!(!y&&p.length)&&x("tbody",v,...p),!!(!y&&m.length)&&x("tfoot",v,...m),y&&x("tbody",v,...u,...p,...m))}renderSection(e,t,n){return"outerContent"in e?x(oe,{key:e.key},e.outerContent):x("tr",{key:e.key,role:"presentation",className:DM(e,this.props.liquid).join(" ")},this.renderChunkTd(e,t,e.chunk,n))}renderChunkTd(e,t,n,s){if("outerContent"in n)return n.outerContent;let{props:r}=this,{forceYScrollbars:o,scrollerClientWidths:a,scrollerClientHeights:l}=this.state,c=wM(r,e),d=XC(r,e),u=r.liquid?o?"scroll":c?"auto":"hidden":"visible",p=e.key,m=AM(e,n,{tableColGroupNode:t,tableMinWidth:"",clientWidth:!r.collapsibleWidth&&a[p]!==void 0?a[p]:null,clientHeight:l[p]!==void 0?l[p]:null,expandRows:e.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:()=>{}},s);return x(s?"th":"td",{ref:n.elRef,role:"presentation"},x("div",{className:`fc-scroller-harness${d?" fc-scroller-harness-liquid":""}`},x(Vc,{ref:this.scrollerRefs.createRef(p),elRef:this.scrollerElRefs.createRef(p),overflowY:u,overflowX:r.liquid?"hidden":"visible",maxHeight:e.maxHeight,liquid:d,liquidIsAbsolute:!0},m)))}_handleScrollerEl(e,t){let n=v$(this.props.sections,t);n&&an(n.chunk.scrollerElRef,e)}componentDidMount(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)}componentDidUpdate(){this.handleSizing()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}computeShrinkWidth(){return xM(this.props.cols)?SM(this.scrollerElRefs.getAll()):0}computeScrollerDims(){let e=hM(),{scrollerRefs:t,scrollerElRefs:n}=this,s=!1,r={},o={};for(let a in t.currentMap){let l=t.currentMap[a];if(l&&l.needsYScrolling()){s=!0;break}}for(let a of this.props.sections){let l=a.key,c=n.currentMap[l];if(c){let d=c.parentNode;r[l]=Math.floor(d.getBoundingClientRect().width-(s?e.y:0)),o[l]=Math.floor(d.getBoundingClientRect().height)}}return{forceYScrollbars:s,scrollerClientWidths:r,scrollerClientHeights:o}}};Tr.addStateEquality({scrollerClientWidths:Ut,scrollerClientHeights:Ut});function v$(i,e){for(let t of i)if(t.key===e)return t;return null}var Ss=class extends te{constructor(){super(...arguments),this.buildPublicEvent=z((e,t,n)=>new ye(e,t,n)),this.handleEl=e=>{this.el=e,an(this.props.elRef,e),e&&PI(e,this.props.seg)}}render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,{eventRange:r}=s,{ui:o}=r,a={event:this.buildPublicEvent(t,r.def,r.instance),view:t.viewApi,timeText:e.timeText,textColor:o.textColor,backgroundColor:o.backgroundColor,borderColor:o.borderColor,isDraggable:!e.disableDragging&&YH(s,t),isStartResizable:!e.disableResizing&&KH(s,t),isEndResizable:!e.disableResizing&&XH(s),isMirror:!!(e.isDragging||e.isResizing||e.isDateSelecting),isStart:!!s.isStart,isEnd:!!s.isEnd,isPast:!!e.isPast,isFuture:!!e.isFuture,isToday:!!e.isToday,isSelected:!!e.isSelected,isDragging:!!e.isDragging,isResizing:!!e.isResizing};return x(Re,{elRef:this.handleEl,elTag:e.elTag,elAttrs:e.elAttrs,elClasses:[...JH(a),...s.eventRange.ui.classNames,...e.elClasses||[]],elStyle:e.elStyle,renderProps:a,generatorName:"eventContent",customGenerator:n.eventContent,defaultGenerator:e.defaultGenerator,classNameGenerator:n.eventClassNames,didMount:n.eventDidMount,willUnmount:n.eventWillUnmount},e.children)}componentDidUpdate(e){this.el&&this.props.seg!==e.seg&&PI(this.el,this.props.seg)}},_r=class extends te{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,{ui:r}=s.eventRange,o=n.eventTimeFormat||e.defaultTimeFormat,a=Pr(s,o,t,e.defaultDisplayEventTime,e.defaultDisplayEventEnd);return x(Ss,Object.assign({},e,{elTag:"a",elStyle:{borderColor:r.borderColor,backgroundColor:r.backgroundColor},elAttrs:Yc(s,t),defaultGenerator:b$,timeText:a}),(l,c)=>x(oe,null,x(l,{elTag:"div",elClasses:["fc-event-main"],elStyle:{color:c.textColor}}),!!c.isStartResizable&&x("div",{className:"fc-event-resizer fc-event-resizer-start"}),!!c.isEndResizable&&x("div",{className:"fc-event-resizer fc-event-resizer-end"})))}};_r.addPropsEquality({seg:Ut});function b$(i){return x("div",{className:"fc-event-main-frame"},i.timeText&&x("div",{className:"fc-event-time"},i.timeText),x("div",{className:"fc-event-title-container"},x("div",{className:"fc-event-title fc-sticky"},i.event.title||x(oe,null,"\xA0"))))}var Yf=i=>x(Cn.Consumer,null,e=>{let{options:t}=e,n={isAxis:i.isAxis,date:e.dateEnv.toDate(i.date),view:e.viewApi};return x(Re,{elRef:i.elRef,elTag:i.elTag||"div",elAttrs:i.elAttrs,elClasses:i.elClasses,elStyle:i.elStyle,renderProps:n,generatorName:"nowIndicatorContent",customGenerator:t.nowIndicatorContent,classNameGenerator:t.nowIndicatorClassNames,didMount:t.nowIndicatorDidMount,willUnmount:t.nowIndicatorWillUnmount},i.children)}),E$=he({day:"numeric"}),xr=class extends te{constructor(){super(...arguments),this.refineRenderProps=zc(S$)}render(){let{props:e,context:t}=this,{options:n}=t,s=this.refineRenderProps({date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,isMonthStart:e.isMonthStart||!1,showDayNumber:e.showDayNumber,extraRenderProps:e.extraRenderProps,viewApi:t.viewApi,dateEnv:t.dateEnv,monthStartFormat:n.monthStartFormat});return x(Re,{elRef:e.elRef,elTag:e.elTag,elAttrs:Object.assign(Object.assign({},e.elAttrs),s.isDisabled?{}:{"data-date":Dr(e.date)}),elClasses:[...Xc(s,t.theme),...e.elClasses||[]],elStyle:e.elStyle,renderProps:s,generatorName:"dayCellContent",customGenerator:n.dayCellContent,defaultGenerator:e.defaultGenerator,classNameGenerator:s.isDisabled?void 0:n.dayCellClassNames,didMount:n.dayCellDidMount,willUnmount:n.dayCellWillUnmount},e.children)}};function Zc(i){return!!(i.dayCellContent||nC("dayCellContent",i))}function S$(i){let{date:e,dateEnv:t,dateProfile:n,isMonthStart:s}=i,r=Vf(e,i.todayRange,null,n),o=i.showDayNumber?t.format(e,s?i.monthStartFormat:E$):"";return Object.assign(Object.assign(Object.assign({date:t.toDate(e),view:i.viewApi},r),{isMonthStart:s,dayNumberText:o}),i.extraRenderProps)}var Ta=class extends te{render(){let{props:e}=this,{seg:t}=e;return x(Ss,{elTag:"div",elClasses:["fc-bg-event"],elStyle:{backgroundColor:t.eventRange.ui.backgroundColor},defaultGenerator:w$,seg:t,timeText:"",isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:e.isPast,isFuture:e.isFuture,isToday:e.isToday,disableDragging:!0,disableResizing:!0})}};function w$(i){let{title:e}=i.event;return e&&x("div",{className:"fc-event-title"},i.event.title)}function Kf(i){return x("div",{className:`fc-${i}`})}var Xf=i=>x(Cn.Consumer,null,e=>{let{dateEnv:t,options:n}=e,{date:s}=i,r=n.weekNumberFormat||i.defaultFormat,o=t.computeWeekNumber(s),a=t.format(s,r),l={num:o,text:a,date:s};return x(Re,{elRef:i.elRef,elTag:i.elTag,elAttrs:i.elAttrs,elClasses:i.elClasses,elStyle:i.elStyle,renderProps:l,generatorName:"weekNumberContent",customGenerator:n.weekNumberContent,defaultGenerator:A$,classNameGenerator:n.weekNumberClassNames,didMount:n.weekNumberDidMount,willUnmount:n.weekNumberWillUnmount},i.children)});function A$(i){return i.text}var XA=10,sC=class extends te{constructor(){super(...arguments),this.state={titleId:An()},this.handleRootEl=e=>{this.rootEl=e,this.props.elRef&&an(this.props.elRef,e)},this.handleDocumentMouseDown=e=>{let t=Qv(e);this.rootEl.contains(t)||this.handleCloseClick()},this.handleDocumentKeyDown=e=>{e.key==="Escape"&&this.handleCloseClick()},this.handleCloseClick=()=>{let{onClose:e}=this.props;e&&e()}}render(){let{theme:e,options:t}=this.context,{props:n,state:s}=this,r=["fc-popover",e.getClass("popover")].concat(n.extraClassNames||[]);return EI(x("div",Object.assign({},n.extraAttrs,{id:n.id,className:r.join(" "),"aria-labelledby":s.titleId,ref:this.handleRootEl}),x("div",{className:"fc-popover-header "+e.getClass("popoverHeader")},x("span",{className:"fc-popover-title",id:s.titleId},n.title),x("span",{className:"fc-popover-close "+e.getIconClass("close"),title:t.closeHint,onClick:this.handleCloseClick})),x("div",{className:"fc-popover-body "+e.getClass("popoverContent")},n.children)),n.parentEl)}componentDidMount(){document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("keydown",this.handleDocumentKeyDown),this.updateSize()}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("keydown",this.handleDocumentKeyDown)}updateSize(){let{isRtl:e}=this.context,{alignmentEl:t,alignGridTop:n}=this.props,{rootEl:s}=this,r=d$(t);if(r){let o=s.getBoundingClientRect(),a=n?Ge(t,".fc-scrollgrid").getBoundingClientRect().top:r.top,l=e?r.right-o.width:r.left;a=Math.max(a,XA),l=Math.min(l,document.documentElement.clientWidth-XA-o.width),l=Math.max(l,XA);let c=s.offsetParent.getBoundingClientRect();xa(s,{top:a-c.top,left:l-c.left})}}},rC=class extends ot{constructor(){super(...arguments),this.handleRootEl=e=>{this.rootEl=e,e?this.context.registerInteractiveComponent(this,{el:e,useEventCenter:!1}):this.context.unregisterInteractiveComponent(this)}}render(){let{options:e,dateEnv:t}=this.context,{props:n}=this,{startDate:s,todayRange:r,dateProfile:o}=n,a=t.format(s,e.dayPopoverFormat);return x(xr,{elRef:this.handleRootEl,date:s,dateProfile:o,todayRange:r},(l,c,d)=>x(sC,{elRef:d.ref,id:n.id,title:a,extraClassNames:["fc-more-popover"].concat(d.className||[]),extraAttrs:d,parentEl:n.parentEl,alignmentEl:n.alignmentEl,alignGridTop:n.alignGridTop,onClose:n.onClose},Zc(e)&&x(l,{elTag:"div",elClasses:["fc-more-popover-misc"]}),n.children))}queryHit(e,t,n,s){let{rootEl:r,props:o}=this;return e>=0&&e<n&&t>=0&&t<s?{dateProfile:o.dateProfile,dateSpan:Object.assign({allDay:!o.forceTimed,range:{start:o.startDate,end:o.endDate}},o.extraDateSpan),dayEl:r,rect:{left:0,top:0,right:n,bottom:s},layer:1}:null}},_a=class extends te{constructor(){super(...arguments),this.state={isPopoverOpen:!1,popoverId:An()},this.handleLinkEl=e=>{this.linkEl=e,this.props.elRef&&an(this.props.elRef,e)},this.handleClick=e=>{let{props:t,context:n}=this,{moreLinkClick:s}=n.options,r=kI(t).start;function o(a){let{def:l,instance:c,range:d}=a.eventRange;return{event:new ye(n,l,c),start:n.dateEnv.toDate(d.start),end:n.dateEnv.toDate(d.end),isStart:a.isStart,isEnd:a.isEnd}}typeof s=="function"&&(s=s({date:r,allDay:!!t.allDayDate,allSegs:t.allSegs.map(o),hiddenSegs:t.hiddenSegs.map(o),jsEvent:e,view:n.viewApi})),!s||s==="popover"?this.setState({isPopoverOpen:!0}):typeof s=="string"&&n.calendarApi.zoomTo(r,s)},this.handlePopoverClose=()=>{this.setState({isPopoverOpen:!1})}}render(){let{props:e,state:t}=this;return x(Cn.Consumer,null,n=>{let{viewApi:s,options:r,calendarApi:o}=n,{moreLinkText:a}=r,{moreCnt:l}=e,c=kI(e),d=typeof a=="function"?a.call(o,l):`+${l} ${a}`,u=Gc(r.moreLinkHint,[l],d),p={num:l,shortText:`+${l}`,text:d,view:s};return x(oe,null,!!e.moreCnt&&x(Re,{elTag:e.elTag||"a",elRef:this.handleLinkEl,elClasses:[...e.elClasses||[],"fc-more-link"],elStyle:e.elStyle,elAttrs:Object.assign(Object.assign(Object.assign({},e.elAttrs),HI(this.handleClick)),{title:u,"aria-expanded":t.isPopoverOpen,"aria-controls":t.isPopoverOpen?t.popoverId:""}),renderProps:p,generatorName:"moreLinkContent",customGenerator:r.moreLinkContent,defaultGenerator:e.defaultGenerator||C$,classNameGenerator:r.moreLinkClassNames,didMount:r.moreLinkDidMount,willUnmount:r.moreLinkWillUnmount},e.children),t.isPopoverOpen&&x(rC,{id:t.popoverId,startDate:c.start,endDate:c.end,dateProfile:e.dateProfile,todayRange:e.todayRange,extraDateSpan:e.extraDateSpan,parentEl:this.parentEl,alignmentEl:e.alignmentElRef?e.alignmentElRef.current:this.linkEl,alignGridTop:e.alignGridTop,forceTimed:e.forceTimed,onClose:this.handlePopoverClose},e.popoverContent()))})}componentDidMount(){this.updateParentEl()}componentDidUpdate(){this.updateParentEl()}updateParentEl(){this.linkEl&&(this.parentEl=Ge(this.linkEl,".fc-view-harness"))}};function C$(i){return i.text}function kI(i){if(i.allDayDate)return{start:i.allDayDate,end:we(i.allDayDate,1)};let{hiddenSegs:e}=i;return{start:gb(e),end:_$(e)}}function gb(i){return i.reduce(T$).eventRange.range.start}function T$(i,e){return i.eventRange.range.start<e.eventRange.range.start?i:e}function _$(i){return i.reduce(x$).eventRange.range.end}function x$(i,e){return i.eventRange.range.end>e.eventRange.range.end?i:e}var R$=[],LM={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},OM=Object.assign(Object.assign({},LM),{buttonHints:{prev:"Previous $0",next:"Next $0",today(i,e){return e==="day"?"Today":`This ${i}`}},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint(i){return`Show ${i} more event${i===1?"":"s"}`}});function D$(i){let e=i.length>0?i[0].code:"en",t=R$.concat(i),n={en:OM};for(let s of t)n[s.code]=s;return{map:n,defaultCode:e}}function UM(i,e){return typeof i=="object"&&!Array.isArray(i)?BM(i.code,[i.code],i):I$(i,e)}function I$(i,e){let t=[].concat(i||[]),n=M$(t,e)||OM;return BM(i,t,n)}function M$(i,e){for(let t=0;t<i.length;t+=1){let n=i[t].toLocaleLowerCase().split("-");for(let s=n.length;s>0;s-=1){let r=n.slice(0,s).join("-");if(e[r])return e[r]}}return null}function BM(i,e,t){let n=sb([LM,t],["buttonText"]);delete n.code;let{week:s}=n;return delete n.week,{codeArg:i,codes:e,week:s,simpleNumberFormat:new Intl.NumberFormat(i),options:n}}function $t(i){return{id:ws(),name:i.name,premiumReleaseDate:i.premiumReleaseDate?new Date(i.premiumReleaseDate):void 0,deps:i.deps||[],reducers:i.reducers||[],isLoadingFuncs:i.isLoadingFuncs||[],contextInit:[].concat(i.contextInit||[]),eventRefiners:i.eventRefiners||{},eventDefMemberAdders:i.eventDefMemberAdders||[],eventSourceRefiners:i.eventSourceRefiners||{},isDraggableTransformers:i.isDraggableTransformers||[],eventDragMutationMassagers:i.eventDragMutationMassagers||[],eventDefMutationAppliers:i.eventDefMutationAppliers||[],dateSelectionTransformers:i.dateSelectionTransformers||[],datePointTransforms:i.datePointTransforms||[],dateSpanTransforms:i.dateSpanTransforms||[],views:i.views||{},viewPropsTransformers:i.viewPropsTransformers||[],isPropsValid:i.isPropsValid||null,externalDefTransforms:i.externalDefTransforms||[],viewContainerAppends:i.viewContainerAppends||[],eventDropTransformers:i.eventDropTransformers||[],componentInteractions:i.componentInteractions||[],calendarInteractions:i.calendarInteractions||[],themeClasses:i.themeClasses||{},eventSourceDefs:i.eventSourceDefs||[],cmdFormatter:i.cmdFormatter,recurringTypes:i.recurringTypes||[],namedTimeZonedImpl:i.namedTimeZonedImpl,initialView:i.initialView||"",elementDraggingImpl:i.elementDraggingImpl,optionChangeHandlers:i.optionChangeHandlers||{},scrollGridImpl:i.scrollGridImpl||null,listenerRefiners:i.listenerRefiners||{},optionRefiners:i.optionRefiners||{},propSetHandlers:i.propSetHandlers||{}}}function P$(i,e){let t={},n={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function s(r){for(let o of r){let a=o.name,l=t[a];l===void 0?(t[a]=o.id,s(o.deps),n=N$(n,o)):l!==o.id&&console.warn(`Duplicate plugin '${a}'`)}}return i&&s(i),s(e),n}function k$(){let i=[],e=[],t;return(n,s)=>((!t||!Ri(n,i)||!Ri(s,e))&&(t=P$(n,s)),i=n,e=s,t)}function N$(i,e){return{premiumReleaseDate:F$(i.premiumReleaseDate,e.premiumReleaseDate),reducers:i.reducers.concat(e.reducers),isLoadingFuncs:i.isLoadingFuncs.concat(e.isLoadingFuncs),contextInit:i.contextInit.concat(e.contextInit),eventRefiners:Object.assign(Object.assign({},i.eventRefiners),e.eventRefiners),eventDefMemberAdders:i.eventDefMemberAdders.concat(e.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},i.eventSourceRefiners),e.eventSourceRefiners),isDraggableTransformers:i.isDraggableTransformers.concat(e.isDraggableTransformers),eventDragMutationMassagers:i.eventDragMutationMassagers.concat(e.eventDragMutationMassagers),eventDefMutationAppliers:i.eventDefMutationAppliers.concat(e.eventDefMutationAppliers),dateSelectionTransformers:i.dateSelectionTransformers.concat(e.dateSelectionTransformers),datePointTransforms:i.datePointTransforms.concat(e.datePointTransforms),dateSpanTransforms:i.dateSpanTransforms.concat(e.dateSpanTransforms),views:Object.assign(Object.assign({},i.views),e.views),viewPropsTransformers:i.viewPropsTransformers.concat(e.viewPropsTransformers),isPropsValid:e.isPropsValid||i.isPropsValid,externalDefTransforms:i.externalDefTransforms.concat(e.externalDefTransforms),viewContainerAppends:i.viewContainerAppends.concat(e.viewContainerAppends),eventDropTransformers:i.eventDropTransformers.concat(e.eventDropTransformers),calendarInteractions:i.calendarInteractions.concat(e.calendarInteractions),componentInteractions:i.componentInteractions.concat(e.componentInteractions),themeClasses:Object.assign(Object.assign({},i.themeClasses),e.themeClasses),eventSourceDefs:i.eventSourceDefs.concat(e.eventSourceDefs),cmdFormatter:e.cmdFormatter||i.cmdFormatter,recurringTypes:i.recurringTypes.concat(e.recurringTypes),namedTimeZonedImpl:e.namedTimeZonedImpl||i.namedTimeZonedImpl,initialView:i.initialView||e.initialView,elementDraggingImpl:i.elementDraggingImpl||e.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},i.optionChangeHandlers),e.optionChangeHandlers),scrollGridImpl:e.scrollGridImpl||i.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},i.listenerRefiners),e.listenerRefiners),optionRefiners:Object.assign(Object.assign({},i.optionRefiners),e.optionRefiners),propSetHandlers:Object.assign(Object.assign({},i.propSetHandlers),e.propSetHandlers)}}function F$(i,e){return i===void 0?e:e===void 0?i:new Date(Math.max(i.valueOf(),e.valueOf()))}var Pi=class extends bs{};Pi.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"};Pi.prototype.baseIconClass="fc-icon";Pi.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"};Pi.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"};Pi.prototype.iconOverrideOption="buttonIcons";Pi.prototype.iconOverrideCustomButtonOption="icon";Pi.prototype.iconOverridePrefix="fc-icon-";function L$(i,e){let t={},n;for(n in i)ZC(n,t,i,e);for(n in e)ZC(n,t,i,e);return t}function ZC(i,e,t,n){if(e[i])return e[i];let s=O$(i,e,t,n);return s&&(e[i]=s),s}function O$(i,e,t,n){let s=t[i],r=n[i],o=d=>s&&s[d]!==null?s[d]:r&&r[d]!==null?r[d]:null,a=o("component"),l=o("superType"),c=null;if(l){if(l===i)throw new Error("Can't have a custom view type that references itself");c=ZC(l,e,t,n)}return!a&&c&&(a=c.component),a?{type:i,component:a,defaults:Object.assign(Object.assign({},c?c.defaults:{}),s?s.rawOptions:{}),overrides:Object.assign(Object.assign({},c?c.overrides:{}),r?r.rawOptions:{})}:null}function IM(i){return wn(i,U$)}function U$(i){let e=typeof i=="function"?{component:i}:i,{component:t}=e;return e.content?t=MM(e):t&&!(t.prototype instanceof te)&&(t=MM(Object.assign(Object.assign({},e),{content:t}))),{superType:e.type,component:t,rawOptions:e}}function MM(i){return e=>x(Cn.Consumer,null,t=>x(Re,{elTag:"div",elClasses:xC(t.viewSpec),renderProps:Object.assign(Object.assign({},e),{nextDayThreshold:t.options.nextDayThreshold}),generatorName:void 0,customGenerator:i.content,classNameGenerator:i.classNames,didMount:i.didMount,willUnmount:i.willUnmount}))}function B$(i,e,t,n){let s=IM(i),r=IM(e.views),o=L$(s,r);return wn(o,a=>H$(a,r,e,t,n))}function H$(i,e,t,n,s){let r=i.overrides.duration||i.defaults.duration||n.duration||t.duration,o=null,a="",l="",c={};if(r&&(o=$$(r),o)){let p=mf(o);a=p.unit,p.value===1&&(l=a,c=e[a]?e[a].rawOptions:{})}let d=p=>{let m=p.buttonText||{},y=i.defaults.buttonTextKey;return y!=null&&m[y]!=null?m[y]:m[i.type]!=null?m[i.type]:m[l]!=null?m[l]:null},u=p=>{let m=p.buttonHints||{},y=i.defaults.buttonTextKey;return y!=null&&m[y]!=null?m[y]:m[i.type]!=null?m[i.type]:m[l]!=null?m[l]:null};return{type:i.type,component:i.component,duration:o,durationUnit:a,singleUnit:l,optionDefaults:i.defaults,optionOverrides:Object.assign(Object.assign({},c),i.overrides),buttonTextOverride:d(n)||d(t)||i.overrides.buttonText,buttonTextDefault:d(s)||i.defaults.buttonText||d(Ir)||i.type,buttonTitleOverride:u(n)||u(t)||i.overrides.buttonHint,buttonTitleDefault:u(s)||i.defaults.buttonHint||u(Ir)}}var PM={};function $$(i){let e=JSON.stringify(i),t=PM[e];return t===void 0&&(t=ee(i),PM[e]=t),t}function V$(i,e){switch(e.type){case"CHANGE_VIEW_TYPE":i=e.viewType}return i}function G$(i,e){switch(e.type){case"CHANGE_DATE":return e.dateMarker;default:return i}}function z$(i,e,t){let n=i.initialDate;return n!=null?e.createMarker(n):t.getDateMarker()}function W$(i,e){switch(e.type){case"SET_OPTION":return Object.assign(Object.assign({},i),{[e.optionName]:e.rawOptionValue});default:return i}}function q$(i,e,t,n){let s;switch(e.type){case"CHANGE_VIEW_TYPE":return n.build(e.dateMarker||t);case"CHANGE_DATE":return n.build(e.dateMarker);case"PREV":if(s=n.buildPrev(i,t),s.isValid)return s;break;case"NEXT":if(s=n.buildNext(i,t),s.isValid)return s;break}return i}function Y$(i,e,t){let n=e?e.activeRange:null;return $M({},eV(i,t),n,t)}function K$(i,e,t,n){let s=t?t.activeRange:null;switch(e.type){case"ADD_EVENT_SOURCES":return $M(i,e.sources,s,n);case"REMOVE_EVENT_SOURCE":return J$(i,e.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return t?VM(i,s,n):i;case"FETCH_EVENT_SOURCES":return oT(i,e.sourceIds?CC(e.sourceIds):GM(i,n),s,e.isRefetch||!1,n);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return Q$(i,e.sourceId,e.fetchId,e.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return i}}function X$(i,e,t){let n=e?e.activeRange:null;return oT(i,GM(i,t),n,!0,t)}function HM(i){for(let e in i)if(i[e].isFetching)return!0;return!1}function $M(i,e,t,n){let s={};for(let r of e)s[r.sourceId]=r;return t&&(s=VM(s,t,n)),Object.assign(Object.assign({},i),s)}function J$(i,e){return vs(i,t=>t.sourceId!==e)}function VM(i,e,t){return oT(i,vs(i,n=>Z$(n,e,t)),e,!1,t)}function Z$(i,e,t){return zM(i,t)?!t.options.lazyFetching||!i.fetchRange||i.isFetching||e.start<i.fetchRange.start||e.end>i.fetchRange.end:!i.latestFetchId}function oT(i,e,t,n,s){let r={};for(let o in i){let a=i[o];e[o]?r[o]=j$(a,t,n,s):r[o]=a}return r}function j$(i,e,t,n){let{options:s,calendarApi:r}=n,o=n.pluginHooks.eventSourceDefs[i.sourceDefId],a=ws();return o.fetch({eventSource:i,range:e,isRefetch:t,context:n},l=>{let{rawEvents:c}=l;s.eventSourceSuccess&&(c=s.eventSourceSuccess.call(r,c,l.response)||c),i.success&&(c=i.success.call(r,c,l.response)||c),n.dispatch({type:"RECEIVE_EVENTS",sourceId:i.sourceId,fetchId:a,fetchRange:e,rawEvents:c})},l=>{let c=!1;s.eventSourceFailure&&(s.eventSourceFailure.call(r,l),c=!0),i.failure&&(i.failure(l),c=!0),c||console.warn(l.message,l),n.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:i.sourceId,fetchId:a,fetchRange:e,error:l})}),Object.assign(Object.assign({},i),{isFetching:!0,latestFetchId:a})}function Q$(i,e,t,n){let s=i[e];return s&&t===s.latestFetchId?Object.assign(Object.assign({},i),{[e]:Object.assign(Object.assign({},s),{isFetching:!1,fetchRange:n})}):i}function GM(i,e){return vs(i,t=>zM(t,e))}function eV(i,e){let t=PC(e),n=[].concat(i.eventSources||[]),s=[];i.initialEvents&&n.unshift(i.initialEvents),i.events&&n.unshift(i.events);for(let r of n){let o=MC(r,e,t);o&&s.push(o)}return s}function zM(i,e){return!e.pluginHooks.eventSourceDefs[i.sourceDefId].ignoreRange}function tV(i,e){switch(e.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return e.selection;default:return i}}function nV(i,e){switch(e.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return e.eventInstanceId;default:return i}}function iV(i,e){let t;switch(e.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return i}}function sV(i,e){let t;switch(e.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return i}}function rV(i,e,t,n,s){let r=i.headerToolbar?kM(i.headerToolbar,i,e,t,n,s):null,o=i.footerToolbar?kM(i.footerToolbar,i,e,t,n,s):null;return{header:r,footer:o}}function kM(i,e,t,n,s,r){let o={},a=[],l=!1;for(let c in i){let d=i[c],u=oV(d,e,t,n,s,r);o[c]=u.widgets,a.push(...u.viewsWithButtons),l=l||u.hasTitle}return{sectionWidgets:o,viewsWithButtons:a,hasTitle:l}}function oV(i,e,t,n,s,r){let o=e.direction==="rtl",a=e.customButtons||{},l=t.buttonText||{},c=e.buttonText||{},d=t.buttonHints||{},u=e.buttonHints||{},p=i?i.split(" "):[],m=[],y=!1;return{widgets:p.map(b=>b.split(",").map(S=>{if(S==="title")return y=!0,{buttonName:S};let C,T,_,R,I,M;if(C=a[S])_=k=>{C.click&&C.click.call(k.target,k,k.target)},(R=n.getCustomButtonIconClass(C))||(R=n.getIconClass(S,o))||(I=C.text),M=C.hint||C.text;else if(T=s[S]){m.push(S),_=()=>{r.changeView(S)},(I=T.buttonTextOverride)||(R=n.getIconClass(S,o))||(I=T.buttonTextDefault);let k=T.buttonTextOverride||T.buttonTextDefault;M=Gc(T.buttonTitleOverride||T.buttonTitleDefault||e.viewHint,[k,S],k)}else if(r[S])if(_=()=>{r[S]()},(I=l[S])||(R=n.getIconClass(S,o))||(I=c[S]),S==="prevYear"||S==="nextYear"){let k=S==="prevYear"?"prev":"next";M=Gc(d[k]||u[k],[c.year||"year","year"],c[S])}else M=k=>Gc(d[S]||u[S],[c[k]||k,k],c[S]);return{buttonName:S,buttonClick:_,buttonIcon:R,buttonText:I,buttonHint:M}})),viewsWithButtons:m,hasTitle:y}}var jC=class{constructor(e,t,n){this.type=e,this.getCurrentData=t,this.dateEnv=n}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(e){return this.getCurrentData().options[e]}},aV={ignoreRange:!0,parseMeta(i){return Array.isArray(i.events)?i.events:null},fetch(i,e){e({rawEvents:i.eventSource.meta})}},lV=$t({name:"array-event-source",eventSourceDefs:[aV]}),cV={parseMeta(i){return typeof i.events=="function"?i.events:null},fetch(i,e,t){let{dateEnv:n}=i.context,s=i.eventSource.meta;BC(s.bind(null,UC(i.range,n)),r=>e({rawEvents:r}),t)}},dV=$t({name:"func-event-source",eventSourceDefs:[cV]}),uV={method:String,extraParams:P,startParam:String,endParam:String,timeZoneParam:String},hV={parseMeta(i){return i.url&&(i.format==="json"||!i.format)?{url:i.url,format:"json",method:(i.method||"GET").toUpperCase(),extraParams:i.extraParams,startParam:i.startParam,endParam:i.endParam,timeZoneParam:i.timeZoneParam}:null},fetch(i,e,t){let{meta:n}=i.eventSource,s=pV(n,i.range,i.context);HC(n.method,n.url,s).then(([r,o])=>{e({rawEvents:r,response:o})},t)}},fV=$t({name:"json-event-source",eventSourceRefiners:uV,eventSourceDefs:[hV]});function pV(i,e,t){let{dateEnv:n,options:s}=t,r,o,a,l,c={};return r=i.startParam,r==null&&(r=s.startParam),o=i.endParam,o==null&&(o=s.endParam),a=i.timeZoneParam,a==null&&(a=s.timeZoneParam),typeof i.extraParams=="function"?l=i.extraParams():l=i.extraParams||{},Object.assign(c,l),c[r]=n.formatIso(e.start),c[o]=n.formatIso(e.end),n.timeZone!=="local"&&(c[a]=n.timeZone),c}var gV={daysOfWeek:P,startTime:ee,endTime:ee,duration:ee,startRecur:P,endRecur:P},mV={parse(i,e){if(i.daysOfWeek||i.startTime||i.endTime||i.startRecur||i.endRecur){let t={daysOfWeek:i.daysOfWeek||null,startTime:i.startTime||null,endTime:i.endTime||null,startRecur:i.startRecur?e.createMarker(i.startRecur):null,endRecur:i.endRecur?e.createMarker(i.endRecur):null,dateEnv:e},n;return i.duration&&(n=i.duration),!n&&i.startTime&&i.endTime&&(n=WI(i.endTime,i.startTime)),{allDayGuess:!i.startTime&&!i.endTime,duration:n,typeData:t}}return null},expand(i,e,t){let n=on(e,{start:i.startRecur,end:i.endRecur});return n?vV(i.daysOfWeek,i.startTime,i.dateEnv,t,n):[]}},yV=$t({name:"simple-recurring-event",recurringTypes:[mV],eventRefiners:gV});function vV(i,e,t,n,s){let r=i?CC(i):null,o=ue(s.start),a=s.end,l=[];for(e&&(e.milliseconds<0?a=we(a,1):e.milliseconds>=1e3*60*60*24&&(o=we(o,-1)));o<a;){let c;(!r||r[o.getUTCDay()])&&(e?c=n.add(o,e):c=o,l.push(n.createMarker(t.toDate(c)))),o=we(o,1)}return l}var bV=$t({name:"change-handler",optionChangeHandlers:{events(i,e){NM([i],e)},eventSources:NM}});function NM(i,e){let t=rb(e.getCurrentData().eventSources);if(t.length===1&&i.length===1&&Array.isArray(t[0]._raw)&&Array.isArray(i[0])){e.dispatch({type:"RESET_RAW_EVENTS",sourceId:t[0].sourceId,rawEvents:i[0]});return}let n=[];for(let s of i){let r=!1;for(let o=0;o<t.length;o+=1)if(t[o]._raw===s){t.splice(o,1),r=!0;break}r||n.push(s)}for(let s of t)e.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:s.sourceId});for(let s of n)e.calendarApi.addEventSource(s)}function EV(i,e){e.emitter.trigger("datesSet",Object.assign(Object.assign({},UC(i.activeRange,e.dateEnv)),{view:e.viewApi}))}function SV(i,e){let{emitter:t}=e;t.hasHandlers("eventsSet")&&t.trigger("eventsSet",Ii(i,e))}var wV=[lV,dV,fV,yV,bV,$t({name:"misc",isLoadingFuncs:[i=>HM(i.eventSources)],propSetHandlers:{dateProfile:EV,eventStore:SV}})],QC=class{constructor(e,t){this.runTaskOption=e,this.drainedOption=t,this.queue=[],this.delayedRunner=new ma(this.drain.bind(this))}request(e,t){this.queue.push(e),this.delayedRunner.request(t)}pause(e){this.delayedRunner.pause(e)}resume(e,t){this.delayedRunner.resume(e,t)}drain(){let{queue:e}=this;for(;e.length;){let t=[],n;for(;n=e.shift();)this.runTask(n),t.push(n);this.drained(t)}}runTask(e){this.runTaskOption&&this.runTaskOption(e)}drained(e){this.drainedOption&&this.drainedOption(e)}};function AV(i,e,t){let n;return/^(year|month)$/.test(i.currentRangeUnit)?n=i.currentRange:n=i.activeRange,t.formatRange(n.start,n.end,he(e.titleFormat||CV(i)),{isEndExclusive:i.isRangeAllDay,defaultSeparator:e.titleRangeSeparator})}function CV(i){let{currentRangeUnit:e}=i;if(e==="year")return{year:"numeric"};if(e==="month")return{year:"numeric",month:"long"};let t=Hc(i.currentRange.start,i.currentRange.end);return t!==null&&t>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}var mb=class{constructor(){this.resetListeners=new Set}handleInput(e,t){let n=this.dateEnv;if(e!==n&&(typeof t=="function"?this.nowFn=t:n||(this.nowAnchorDate=e.toDate(t?e.createMarker(t):e.createNowMarker()),this.nowAnchorQueried=Date.now()),this.dateEnv=e,n))for(let s of this.resetListeners.values())s()}getDateMarker(){return this.nowAnchorDate?this.dateEnv.timestampToMarker(this.nowAnchorDate.valueOf()+(Date.now()-this.nowAnchorQueried)):this.dateEnv.createMarker(this.nowFn())}addResetListener(e){this.resetListeners.add(e)}removeResetListener(e){this.resetListeners.delete(e)}},eT=class{constructor(e){this.computeCurrentViewData=z(this._computeCurrentViewData),this.organizeRawLocales=z(D$),this.buildLocale=z(UM),this.buildPluginHooks=k$(),this.buildDateEnv=z(TV),this.buildTheme=z(_V),this.parseToolbars=z(rV),this.buildViewSpecs=z(B$),this.buildDateProfileGenerator=zc(xV),this.buildViewApi=z(RV),this.buildViewUiProps=zc(MV),this.buildEventUiBySource=z(DV,Ut),this.buildEventUiBases=z(IV),this.parseContextBusinessHours=zc(PV),this.buildTitle=z(AV),this.nowManager=new mb,this.emitter=new Es,this.actionRunner=new QC(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=p=>{this.actionRunner.request(p)},this.props=e,this.actionRunner.pause(),this.nowManager=new mb;let t={},n=this.computeOptionsData(e.optionOverrides,t,e.calendarApi),s=n.calendarOptions.initialView||n.pluginHooks.initialView,r=this.computeCurrentViewData(s,n,e.optionOverrides,t);e.calendarApi.currentDataManager=this,this.emitter.setThisContext(e.calendarApi),this.emitter.setOptions(r.options);let o={nowManager:this.nowManager,dateEnv:n.dateEnv,options:n.calendarOptions,pluginHooks:n.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},a=z$(n.calendarOptions,n.dateEnv,this.nowManager),l=r.dateProfileGenerator.build(a);Sn(l.activeRange,a)||(a=l.currentRange.start);for(let p of n.pluginHooks.contextInit)p(o);let c=Y$(n.calendarOptions,l,o),d={dynamicOptionOverrides:t,currentViewType:s,currentDate:a,dateProfile:l,businessHours:this.parseContextBusinessHours(o),eventSources:c,eventUiBases:{},eventStore:vt(),renderableEventStore:vt(),dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(o).selectionConfig},u=Object.assign(Object.assign({},o),d);for(let p of n.pluginHooks.reducers)Object.assign(d,p(null,null,u));JC(d,o)&&this.emitter.trigger("loading",!0),this.state=d,this.updateData(),this.actionRunner.resume()}resetOptions(e,t){let{props:n}=this;t===void 0?n.optionOverrides=e:(n.optionOverrides=Object.assign(Object.assign({},n.optionOverrides||{}),e),this.optionsForRefining.push(...t)),(t===void 0||t.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(e){let{props:t,state:n,emitter:s}=this,r=W$(n.dynamicOptionOverrides,e),o=this.computeOptionsData(t.optionOverrides,r,t.calendarApi),a=V$(n.currentViewType,e),l=this.computeCurrentViewData(a,o,t.optionOverrides,r);t.calendarApi.currentDataManager=this,s.setThisContext(t.calendarApi),s.setOptions(l.options);let c={nowManager:this.nowManager,dateEnv:o.dateEnv,options:o.calendarOptions,pluginHooks:o.pluginHooks,calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:s,getCurrentData:this.getCurrentData},{currentDate:d,dateProfile:u}=n;this.data&&this.data.dateProfileGenerator!==l.dateProfileGenerator&&(u=l.dateProfileGenerator.build(d)),d=G$(d,e),u=q$(u,e,d,l.dateProfileGenerator),(e.type==="PREV"||e.type==="NEXT"||!Sn(u.currentRange,d))&&(d=u.currentRange.start);let p=K$(n.eventSources,e,u,c),m=sM(n.eventStore,e,p,u,c),v=HM(p)&&!l.options.progressiveEventRendering&&n.renderableEventStore||m,{eventUiSingleBase:b,selectionConfig:S}=this.buildViewUiProps(c),C=this.buildEventUiBySource(p),T=this.buildEventUiBases(v.defs,b,C),_={dynamicOptionOverrides:r,currentViewType:a,currentDate:d,dateProfile:u,eventSources:p,eventStore:m,renderableEventStore:v,selectionConfig:S,eventUiBases:T,businessHours:this.parseContextBusinessHours(c),dateSelection:tV(n.dateSelection,e),eventSelection:nV(n.eventSelection,e),eventDrag:iV(n.eventDrag,e),eventResize:sV(n.eventResize,e)},R=Object.assign(Object.assign({},c),_);for(let k of o.pluginHooks.reducers)Object.assign(_,k(n,e,R));let I=JC(n,c),M=JC(_,c);!I&&M?s.trigger("loading",!0):I&&!M&&s.trigger("loading",!1),this.state=_,t.onAction&&t.onAction(e)}updateData(){let{props:e,state:t}=this,n=this.data,s=this.computeOptionsData(e.optionOverrides,t.dynamicOptionOverrides,e.calendarApi),r=this.computeCurrentViewData(t.currentViewType,s,e.optionOverrides,t.dynamicOptionOverrides),o=this.data=Object.assign(Object.assign(Object.assign({nowManager:this.nowManager,viewTitle:this.buildTitle(t.dateProfile,r.options,s.dateEnv),calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},s),r),t),a=s.pluginHooks.optionChangeHandlers,l=n&&n.calendarOptions,c=s.calendarOptions;if(l&&l!==c){l.timeZone!==c.timeZone&&(t.eventSources=o.eventSources=X$(o.eventSources,t.dateProfile,o),t.eventStore=o.eventStore=kC(o.eventStore,n.dateEnv,o.dateEnv),t.renderableEventStore=o.renderableEventStore=kC(o.renderableEventStore,n.dateEnv,o.dateEnv));for(let d in a)(this.optionsForHandling.indexOf(d)!==-1||l[d]!==c[d])&&a[d](c[d],o)}this.optionsForHandling=[],e.onData&&e.onData(o)}computeOptionsData(e,t,n){if(!this.optionsForRefining.length&&e===this.stableOptionOverrides&&t===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:s,pluginHooks:r,localeDefaults:o,availableLocaleData:a,extra:l}=this.processRawCalendarOptions(e,t);FM(l);let c=this.buildDateEnv(s.timeZone,s.locale,s.weekNumberCalculation,s.firstDay,s.weekText,r,a,s.defaultRangeSeparator),d=this.buildViewSpecs(r.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,o),u=this.buildTheme(s,r),p=this.parseToolbars(s,this.stableOptionOverrides,u,d,n);return this.stableCalendarOptionsData={calendarOptions:s,pluginHooks:r,dateEnv:c,viewSpecs:d,theme:u,toolbarConfig:p,localeDefaults:o,availableRawLocales:a.map}}processRawCalendarOptions(e,t){let{locales:n,locale:s}=nb([Ir,e,t]),r=this.organizeRawLocales(n),o=r.map,a=this.buildLocale(s||r.defaultCode,o).options,l=this.buildPluginHooks(e.plugins||[],wV),c=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},SC),wC),AC),l.listenerRefiners),l.optionRefiners),d={},u=nb([Ir,a,e,t]),p={},m=this.currentCalendarOptionsInput,y=this.currentCalendarOptionsRefined,v=!1;for(let b in u)this.optionsForRefining.indexOf(b)===-1&&(u[b]===m[b]||Mr[b]&&b in m&&Mr[b](m[b],u[b]))?p[b]=y[b]:c[b]?(p[b]=c[b](u[b]),v=!0):d[b]=m[b];return v&&(this.currentCalendarOptionsInput=u,this.currentCalendarOptionsRefined=p,this.stableOptionOverrides=e,this.stableDynamicOptionOverrides=t),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:l,availableLocaleData:r,localeDefaults:a,extra:d}}_computeCurrentViewData(e,t,n,s){let r=t.viewSpecs[e];if(!r)throw new Error(`viewType "${e}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:o,extra:a}=this.processRawViewOptions(r,t.pluginHooks,t.localeDefaults,n,s);FM(a),this.nowManager.handleInput(t.dateEnv,o.now);let l=this.buildDateProfileGenerator({dateProfileGeneratorClass:r.optionDefaults.dateProfileGeneratorClass,nowManager:this.nowManager,duration:r.duration,durationUnit:r.durationUnit,usesMinMaxTime:r.optionDefaults.usesMinMaxTime,dateEnv:t.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:o.slotMinTime,slotMaxTime:o.slotMaxTime,showNonCurrentDates:o.showNonCurrentDates,dayCount:o.dayCount,dateAlignment:o.dateAlignment,dateIncrement:o.dateIncrement,hiddenDays:o.hiddenDays,weekends:o.weekends,validRangeInput:o.validRange,visibleRangeInput:o.visibleRange,fixedWeekCount:o.fixedWeekCount}),c=this.buildViewApi(e,this.getCurrentData,t.dateEnv);return{viewSpec:r,options:o,dateProfileGenerator:l,viewApi:c}}processRawViewOptions(e,t,n,s,r){let o=nb([Ir,e.optionDefaults,n,s,e.optionOverrides,r]),a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},SC),wC),AC),KI),t.listenerRefiners),t.optionRefiners),l={},c=this.currentViewOptionsInput,d=this.currentViewOptionsRefined,u=!1,p={};for(let m in o)o[m]===c[m]||Mr[m]&&Mr[m](o[m],c[m])?l[m]=d[m]:(o[m]===this.currentCalendarOptionsInput[m]||Mr[m]&&Mr[m](o[m],this.currentCalendarOptionsInput[m])?m in this.currentCalendarOptionsRefined&&(l[m]=this.currentCalendarOptionsRefined[m]):a[m]?l[m]=a[m](o[m]):p[m]=o[m],u=!0);return u&&(this.currentViewOptionsInput=o,this.currentViewOptionsRefined=l),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:p}}};function TV(i,e,t,n,s,r,o,a){let l=UM(e||o.defaultCode,o.map);return new yf({calendarSystem:"gregory",timeZone:i,namedTimeZoneImpl:r.namedTimeZonedImpl,locale:l,weekNumberCalculation:t,firstDay:n,weekText:s,cmdFormatter:r.cmdFormatter,defaultSeparator:a})}function _V(i,e){let t=e.themeClasses[i.themeSystem]||Pi;return new t(i)}function xV(i){let e=i.dateProfileGeneratorClass||ya;return new e(i)}function RV(i,e,t){return new jC(i,e,t)}function DV(i){return wn(i,e=>e.ui)}function IV(i,e,t){let n={"":e};for(let s in i){let r=i[s];r.sourceId&&t[r.sourceId]&&(n[s]=t[r.sourceId])}return n}function MV(i){let{options:e}=i;return{eventUiSingleBase:qc({display:e.eventDisplay,editable:e.editable,startEditable:e.eventStartEditable,durationEditable:e.eventDurationEditable,constraint:e.eventConstraint,overlap:typeof e.eventOverlap=="boolean"?e.eventOverlap:void 0,allow:e.eventAllow,backgroundColor:e.eventBackgroundColor,borderColor:e.eventBorderColor,textColor:e.eventTextColor,color:e.eventColor},i),selectionConfig:qc({constraint:e.selectConstraint,overlap:typeof e.selectOverlap=="boolean"?e.selectOverlap:void 0,allow:e.selectAllow},i)}}function JC(i,e){for(let t of e.pluginHooks.isLoadingFuncs)if(t(i))return!0;return!1}function PV(i){return NC(i.options.businessHours,i)}function FM(i,e){for(let t in i)console.warn(`Unknown option '${t}'`+(e?` for view '${e}'`:""))}var tT=class extends te{render(){let e=this.props.widgetGroups.map(t=>this.renderWidgetGroup(t));return x("div",{className:"fc-toolbar-chunk"},...e)}renderWidgetGroup(e){let{props:t}=this,{theme:n}=this.context,s=[],r=!0;for(let o of e){let{buttonName:a,buttonClick:l,buttonText:c,buttonIcon:d,buttonHint:u}=o;if(a==="title")r=!1,s.push(x("h2",{className:"fc-toolbar-title",id:t.titleId},t.title));else{let p=a===t.activeButton,m=!t.isTodayEnabled&&a==="today"||!t.isPrevEnabled&&a==="prev"||!t.isNextEnabled&&a==="next",y=[`fc-${a}-button`,n.getClass("button")];p&&y.push(n.getClass("buttonActive")),s.push(x("button",{type:"button",title:typeof u=="function"?u(t.navUnit):u,disabled:m,"aria-pressed":p,className:y.join(" "),onClick:l},c||(d?x("span",{className:d,role:"img"}):"")))}}if(s.length>1){let o=r&&n.getClass("buttonGroup")||"";return x("div",{className:o},...s)}return s[0]}},yb=class extends te{render(){let{model:e,extraClassName:t}=this.props,n=!1,s,r,o=e.sectionWidgets,a=o.center;return o.left?(n=!0,s=o.left):s=o.start,o.right?(n=!0,r=o.right):r=o.end,x("div",{className:[t||"","fc-toolbar",n?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",s||[]),this.renderSection("center",a||[]),this.renderSection("end",r||[]))}renderSection(e,t){let{props:n}=this;return x(tT,{key:e,widgetGroups:t,title:n.title,navUnit:n.navUnit,activeButton:n.activeButton,isTodayEnabled:n.isTodayEnabled,isPrevEnabled:n.isPrevEnabled,isNextEnabled:n.isNextEnabled,titleId:n.titleId})}},nT=class extends te{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=e=>{this.el=e,an(this.props.elRef,e),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:e,state:t}=this,{aspectRatio:n}=e,s=["fc-view-harness",n||e.liquid||e.height?"fc-view-harness-active":"fc-view-harness-passive"],r="",o="";return n?t.availableWidth!==null?r=t.availableWidth/n:o=`${1/n*100}%`:r=e.height||"",x("div",{"aria-labelledby":e.labeledById,ref:this.handleEl,className:s.join(" "),style:{height:r,paddingBottom:o}},e.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}},iT=class extends Xn{constructor(e){super(e),this.handleSegClick=(t,n)=>{let{component:s}=this,{context:r}=s,o=As(n);if(o&&s.isValidSegDownEl(t.target)){let a=Ge(t.target,".fc-event-forced-url"),l=a?a.querySelector("a[href]").href:"";r.emitter.trigger("eventClick",{el:n,event:new ye(s.context,o.eventRange.def,o.eventRange.instance),jsEvent:t,view:r.viewApi}),l&&!t.defaultPrevented&&(window.location.href=l)}},this.destroy=lC(e.el,"click",".fc-event",this.handleSegClick)}},sT=class extends Xn{constructor(e){super(e),this.handleEventElRemove=t=>{t===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(t,n)=>{As(n)&&(this.currentSegEl=n,this.triggerEvent("eventMouseEnter",t,n))},this.handleSegLeave=(t,n)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",t,n))},this.removeHoverListeners=BI(e.el,".fc-event",this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(e,t,n){let{component:s}=this,{context:r}=s,o=As(n);(!t||s.isValidSegDownEl(t.target))&&r.emitter.trigger(e,{el:n,event:new ye(r,o.eventRange.def,o.eventRange.instance),jsEvent:t,view:r.viewApi})}},rT=class extends _i{constructor(){super(...arguments),this.buildViewContext=z(QI),this.buildViewPropTransformers=z(NV),this.buildToolbarProps=z(kV),this.headerRef=Oe(),this.footerRef=Oe(),this.interactionsStore={},this.state={viewLabelId:An()},this.registerInteractiveComponent=(e,t)=>{let n=dM(e,t),o=[iT,sT].concat(this.props.pluginHooks.componentInteractions).map(a=>new a(n));this.interactionsStore[e.uid]=o,Kc[e.uid]=n},this.unregisterInteractiveComponent=e=>{let t=this.interactionsStore[e.uid];if(t){for(let n of t)n.destroy();delete this.interactionsStore[e.uid]}delete Kc[e.uid]},this.resizeRunner=new ma(()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})}),this.handleWindowResize=e=>{let{options:t}=this.props;t.handleWindowResize&&e.target===window&&this.resizeRunner.request(t.windowResizeDelay)}}render(){let{props:e}=this,{toolbarConfig:t,options:n}=e,s=!1,r="",o;e.isHeightAuto||e.forPrint?r="":n.height!=null?s=!0:n.contentHeight!=null?r=n.contentHeight:o=Math.max(n.aspectRatio,.5);let a=this.buildViewContext(e.viewSpec,e.viewApi,e.options,e.dateProfileGenerator,e.dateEnv,e.nowManager,e.theme,e.pluginHooks,e.dispatch,e.getCurrentData,e.emitter,e.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),l=t.header&&t.header.hasTitle?this.state.viewLabelId:void 0;return x(Cn.Provider,{value:a},x(Bt,{unit:"day"},c=>{let d=this.buildToolbarProps(e.viewSpec,e.dateProfile,e.dateProfileGenerator,e.currentDate,c,e.viewTitle);return x(oe,null,t.header&&x(yb,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:t.header,titleId:l},d)),x(nT,{liquid:s,height:r,aspectRatio:o,labeledById:l},this.renderView(e),this.buildAppendContent()),t.footer&&x(yb,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:t.footer,titleId:""},d)))}))}componentDidMount(){let{props:e}=this;this.calendarInteractions=e.pluginHooks.calendarInteractions.map(n=>new n(e)),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:t}=e.pluginHooks;for(let n in t)t[n](e[n],e)}componentDidUpdate(e){let{props:t}=this,{propSetHandlers:n}=t.pluginHooks;for(let s in n)t[s]!==e[s]&&n[s](t[s],t)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let e of this.calendarInteractions)e.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:e}=this,t=e.pluginHooks.viewContainerAppends.map(n=>n(e));return x(oe,{},...t)}renderView(e){let{pluginHooks:t}=e,{viewSpec:n}=e,s={dateProfile:e.dateProfile,businessHours:e.businessHours,eventStore:e.renderableEventStore,eventUiBases:e.eventUiBases,dateSelection:e.dateSelection,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,isHeightAuto:e.isHeightAuto,forPrint:e.forPrint},r=this.buildViewPropTransformers(t.viewPropsTransformers);for(let a of r)Object.assign(s,a.transform(s,e));let o=n.component;return x(o,Object.assign({},s))}};function kV(i,e,t,n,s,r){let o=t.build(s,void 0,!1),a=t.buildPrev(e,n,!1),l=t.buildNext(e,n,!1);return{title:r,activeButton:i.type,navUnit:i.singleUnit,isTodayEnabled:o.isValid&&!Sn(e.currentRange,s),isPrevEnabled:a.isValid,isNextEnabled:l.isValid}}function NV(i){return i.map(e=>new e)}var Jf=class extends Cf{constructor(e,t={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=n=>{switch(n.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=n=>{this.currentData=n,this.renderRunner.request(n.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:n}=this;vf(()=>{Er(x(Af,{options:n.calendarOptions,theme:n.theme,emitter:n.emitter},(s,r,o,a)=>(this.setClassNames(s),this.setHeight(r),x(_C.Provider,{value:this.customContentRenderId},x(rT,Object.assign({isHeightAuto:o,forPrint:a},n))))),this.el)})}else this.isRendered&&(this.isRendered=!1,Er(null,this.el),this.setClassNames([]),this.setHeight(""))},FI(e),this.el=e,this.renderRunner=new ma(this.handleRenderRequest),new eT({optionOverrides:t,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let e=this.isRendering;e?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),e&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){vf(()=>{super.updateSize()})}batchRendering(e){this.renderRunner.pause("batchRendering"),e(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(e,t){this.currentDataManager.resetOptions(e,t)}setClassNames(e){if(!Ri(e,this.currentClassNames)){let{classList:t}=this.el;for(let n of this.currentClassNames)t.remove(n);for(let n of e)t.add(n);this.currentClassNames=e}}setHeight(e){aC(this.el,"height",e)}};var aT=class extends ot{constructor(){super(...arguments),this.headerElRef=Oe()}renderSimpleLayout(e,t){let{props:n,context:s}=this,r=[],o=Da(s.options);return e&&r.push({type:"header",key:"header",isSticky:o,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),r.push({type:"body",key:"body",liquid:!0,chunk:{content:t}}),x(Kn,{elClasses:["fc-daygrid"],viewSpec:s.viewSpec},x(Tr,{liquid:!n.isHeightAuto&&!n.forPrint,collapsibleWidth:n.forPrint,cols:[],sections:r}))}renderHScrollLayout(e,t,n,s){let r=this.context.pluginHooks.scrollGridImpl;if(!r)throw new Error("No ScrollGrid implementation");let{props:o,context:a}=this,l=!o.forPrint&&Da(a.options),c=!o.forPrint&&qf(a.options),d=[];return e&&d.push({type:"header",key:"header",isSticky:l,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),d.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:t}]}),c&&d.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:Jc}]}),x(Kn,{elClasses:["fc-daygrid"],viewSpec:a.viewSpec},x(r,{liquid:!o.isHeightAuto&&!o.forPrint,forPrint:o.forPrint,collapsibleWidth:o.forPrint,colGroups:[{cols:[{span:n,minWidth:s}]}],sections:d}))}};function bb(i,e){let t=[];for(let n=0;n<e;n+=1)t[n]=[];for(let n of i)t[n.row].push(n);return t}function vb(i,e){let t=[];for(let n=0;n<e;n+=1)t[n]=[];for(let n of i)t[n.firstCol].push(n);return t}function WM(i,e){let t=[];if(i){for(let n=0;n<e;n+=1)t[n]={affectedInstances:i.affectedInstances,isEvent:i.isEvent,segs:[]};for(let n of i.segs)t[n.row].segs.push(n)}else for(let n=0;n<e;n+=1)t[n]=null;return t}var qM=he({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function YM(i){let{display:e}=i.eventRange.ui;return e==="list-item"||e==="auto"&&!i.eventRange.def.allDay&&i.firstCol===i.lastCol&&i.isStart&&i.isEnd}var Eb=class extends te{render(){let{props:e}=this;return x(_r,Object.assign({},e,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:qM,defaultDisplayEventEnd:e.defaultDisplayEventEnd,disableResizing:!e.seg.eventRange.def.allDay}))}},Sb=class extends te{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,r=n.eventTimeFormat||qM,o=Pr(s,r,t,!0,e.defaultDisplayEventEnd);return x(Ss,Object.assign({},e,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:Yc(e.seg,t),defaultGenerator:LV,timeText:o,isResizing:!1,isDateSelecting:!1}))}};function LV(i){return x(oe,null,x("div",{className:"fc-daygrid-event-dot",style:{borderColor:i.borderColor||i.backgroundColor}}),i.timeText&&x("div",{className:"fc-event-time"},i.timeText),x("div",{className:"fc-event-title"},i.event.title||x(oe,null,"\xA0")))}var lT=class extends te{constructor(){super(...arguments),this.compileSegs=z(OV)}render(){let{props:e}=this,{allSegs:t,invisibleSegs:n}=this.compileSegs(e.singlePlacements);return x(_a,{elClasses:["fc-daygrid-more-link"],dateProfile:e.dateProfile,todayRange:e.todayRange,allDayDate:e.allDayDate,moreCnt:e.moreCnt,allSegs:t,hiddenSegs:n,alignmentElRef:e.alignmentElRef,alignGridTop:e.alignGridTop,extraDateSpan:e.extraDateSpan,popoverContent:()=>{let s=(e.eventDrag?e.eventDrag.affectedInstances:null)||(e.eventResize?e.eventResize.affectedInstances:null)||{};return x(oe,null,t.map(r=>{let o=r.eventRange.instance.instanceId;return x("div",{className:"fc-daygrid-event-harness",key:o,style:{visibility:s[o]?"hidden":""}},YM(r)?x(Sb,Object.assign({seg:r,isDragging:!1,isSelected:o===e.eventSelection,defaultDisplayEventEnd:!1},ln(r,e.todayRange))):x(Eb,Object.assign({seg:r,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:o===e.eventSelection,defaultDisplayEventEnd:!1},ln(r,e.todayRange))))}))}})}};function OV(i){let e=[],t=[];for(let n of i)e.push(n.seg),n.isVisible||t.push(n.seg);return{allSegs:e,invisibleSegs:t}}var UV=he({week:"narrow"}),cT=class extends ot{constructor(){super(...arguments),this.rootElRef=Oe(),this.state={dayNumberId:An()},this.handleRootEl=e=>{an(this.rootElRef,e),an(this.props.elRef,e)}}render(){let{context:e,props:t,state:n,rootElRef:s}=this,{options:r,dateEnv:o}=e,{date:a,dateProfile:l}=t,c=t.showDayNumber&&HV(a,l.currentRange,o);return x(xr,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...t.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},t.extraDataAttrs),t.showDayNumber?{"aria-labelledby":n.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:BV,date:a,dateProfile:l,todayRange:t.todayRange,showDayNumber:t.showDayNumber,isMonthStart:c,extraRenderProps:t.extraRenderProps},(d,u)=>x("div",{ref:t.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:t.minHeight}},t.showWeekNumber&&x(Xf,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:Mi(e,a,"week"),date:a,defaultFormat:UV}),!u.isDisabled&&(t.showDayNumber||Zc(r)||t.forceDayTop)?x("div",{className:"fc-daygrid-day-top"},x(d,{elTag:"a",elClasses:["fc-daygrid-day-number",c&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},Mi(e,a)),{id:n.dayNumberId})})):t.showDayNumber?x("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},x("a",{className:"fc-daygrid-day-number"},"\xA0")):void 0,x("div",{className:"fc-daygrid-day-events",ref:t.fgContentElRef},t.fgContent,x("div",{className:"fc-daygrid-day-bottom",style:{marginTop:t.moreMarginTop}},x(lT,{allDayDate:a,singlePlacements:t.singlePlacements,moreCnt:t.moreCnt,alignmentElRef:s,alignGridTop:!t.showDayNumber,extraDateSpan:t.extraDateSpan,dateProfile:t.dateProfile,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,todayRange:t.todayRange}))),x("div",{className:"fc-daygrid-day-bg"},t.bgContent)))}};function BV(i){return i.dayNumberText||x(oe,null,"\xA0")}function HV(i,e,t){let{start:n,end:s}=e,r=Ti(s,-1),o=t.getYear(n),a=t.getMonth(n),l=t.getYear(r),c=t.getMonth(r);return!(o===l&&a===c)&&(i.valueOf()===n.valueOf()||t.getDay(i)===1&&i.valueOf()<s.valueOf())}function KM(i){return i.eventRange.instance.instanceId+":"+i.firstCol}function XM(i){return KM(i)+":"+i.lastCol}function $V(i,e,t,n,s,r,o){let a=new dT(S=>{let C=i[S.index].eventRange.instance.instanceId+":"+S.span.start+":"+(S.span.end-1);return s[C]||1});a.allowReslicing=!0,a.strictOrder=n,e===!0||t===!0?(a.maxCoord=r,a.hiddenConsumes=!0):typeof e=="number"?a.maxStackCnt=e:typeof t=="number"&&(a.maxStackCnt=t,a.hiddenConsumes=!0);let l=[],c=[];for(let S=0;S<i.length;S+=1){let C=i[S],T=XM(C);s[T]!=null?l.push({index:S,span:{start:C.firstCol,end:C.lastCol+1}}):c.push(C)}let d=a.addSegs(l),u=a.toRects(),{singleColPlacements:p,multiColPlacements:m,leftoverMargins:y}=VV(u,i,o),v=[],b=[];for(let S of c){m[S.firstCol].push({seg:S,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let C=S.firstCol;C<=S.lastCol;C+=1)p[C].push({seg:jc(S,C,C+1,o),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let S=0;S<o.length;S+=1)v.push(0);for(let S of d){let C=i[S.index],T=S.span;m[T.start].push({seg:jc(C,T.start,T.end,o),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let _=T.start;_<T.end;_+=1)v[_]+=1,p[_].push({seg:jc(C,_,_+1,o),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let S=0;S<o.length;S+=1)b.push(y[S]);return{singleColPlacements:p,multiColPlacements:m,moreCnts:v,moreMarginTops:b}}function VV(i,e,t){let n=GV(i,t.length),s=[],r=[],o=[];for(let a=0;a<t.length;a+=1){let l=n[a],c=[],d=0,u=0;for(let m of l){let y=e[m.index];c.push({seg:jc(y,a,a+1,t),isVisible:!0,isAbsolute:!1,absoluteTop:m.levelCoord,marginTop:m.levelCoord-d}),d=m.levelCoord+m.thickness}let p=[];d=0,u=0;for(let m of l){let y=e[m.index],v=m.span.end-m.span.start>1,b=m.span.start===a;u+=m.levelCoord-d,d=m.levelCoord+m.thickness,v?(u+=m.thickness,b&&p.push({seg:jc(y,m.span.start,m.span.end,t),isVisible:!0,isAbsolute:!0,absoluteTop:m.levelCoord,marginTop:0})):b&&(p.push({seg:jc(y,m.span.start,m.span.end,t),isVisible:!0,isAbsolute:!1,absoluteTop:m.levelCoord,marginTop:u}),u=0)}s.push(c),r.push(p),o.push(u)}return{singleColPlacements:s,multiColPlacements:r,leftoverMargins:o}}function GV(i,e){let t=[];for(let n=0;n<e;n+=1)t.push([]);for(let n of i)for(let s=n.span.start;s<n.span.end;s+=1)t[s].push(n);return t}function jc(i,e,t,n){if(i.firstCol===e&&i.lastCol===t-1)return i;let s=i.eventRange,r=s.range,o=on(r,{start:n[e].date,end:we(n[t-1].date,1)});return Object.assign(Object.assign({},i),{firstCol:e,lastCol:t-1,eventRange:{def:s.def,ui:Object.assign(Object.assign({},s.ui),{durationEditable:!1}),instance:s.instance,range:o},isStart:i.isStart&&o.start.valueOf()===r.start.valueOf(),isEnd:i.isEnd&&o.end.valueOf()===r.end.valueOf()})}var dT=class extends Ea{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(e){let t=super.addSegs(e),{entriesByLevel:n}=this,s=r=>!this.forceHidden[xi(r)];for(let r=0;r<n.length;r+=1)n[r]=n[r].filter(s);return t}handleInvalidInsertion(e,t,n){let{entriesByLevel:s,forceHidden:r}=this,{touchingEntry:o,touchingLevel:a,touchingLateral:l}=e;if(this.hiddenConsumes&&o){let c=xi(o);if(!r[c])if(this.allowReslicing){let d=Object.assign(Object.assign({},o),{span:zf(o.span,t.span)}),u=xi(d);r[u]=!0,s[a][l]=d,n.push(d),this.splitEntry(o,t,n)}else r[c]=!0,n.push(o)}super.handleInvalidInsertion(e,t,n)}},wb=class extends ot{constructor(){super(...arguments),this.cellElRefs=new Ht,this.frameElRefs=new Ht,this.fgElRefs=new Ht,this.segHarnessRefs=new Ht,this.rootElRef=Oe(),this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=e=>{e&&this.updateSizing(!0)}}render(){let{props:e,state:t,context:n}=this,{options:s}=n,r=e.cells.length,o=vb(e.businessHourSegs,r),a=vb(e.bgEventSegs,r),l=vb(this.getHighlightSegs(),r),c=vb(this.getMirrorSegs(),r),{singleColPlacements:d,multiColPlacements:u,moreCnts:p,moreMarginTops:m}=$V(Ra(e.fgEventSegs,s.eventOrder),e.dayMaxEvents,e.dayMaxEventRows,s.eventOrderStrict,t.segHeights,t.maxContentHeight,e.cells),y=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{};return x("tr",{ref:this.rootElRef,role:"row"},e.renderIntro&&e.renderIntro(),e.cells.map((v,b)=>{let S=this.renderFgSegs(b,e.forPrint?d[b]:u[b],e.todayRange,y),C=this.renderFgSegs(b,zV(c[b],u),e.todayRange,{},!!e.eventDrag,!!e.eventResize,!1);return x(cT,{key:v.key,elRef:this.cellElRefs.createRef(v.key),innerElRef:this.frameElRefs.createRef(v.key),dateProfile:e.dateProfile,date:v.date,showDayNumber:e.showDayNumbers,showWeekNumber:e.showWeekNumbers&&b===0,forceDayTop:e.showWeekNumbers,todayRange:e.todayRange,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,extraRenderProps:v.extraRenderProps,extraDataAttrs:v.extraDataAttrs,extraClassNames:v.extraClassNames,extraDateSpan:v.extraDateSpan,moreCnt:p[b],moreMarginTop:m[b],singlePlacements:d[b],fgContentElRef:this.fgElRefs.createRef(v.key),fgContent:x(oe,null,x(oe,null,S),x(oe,null,C)),bgContent:x(oe,null,this.renderFillSegs(l[b],"highlight"),this.renderFillSegs(o[b],"non-business"),this.renderFillSegs(a[b],"bg-event")),minHeight:e.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(e,t){let n=this.props;this.updateSizing(!Ut(e,n))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:e}=this;return e.eventDrag&&e.eventDrag.segs.length?e.eventDrag.segs:e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:e.dateSelectionSegs}getMirrorSegs(){let{props:e}=this;return e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:[]}renderFgSegs(e,t,n,s,r,o,a){let{context:l}=this,{eventSelection:c}=this.props,{framePositions:d}=this.state,u=this.props.cells.length===1,p=r||o||a,m=[];if(d)for(let y of t){let{seg:v}=y,{instanceId:b}=v.eventRange.instance,S=y.isVisible&&!s[b],C=y.isAbsolute,T="",_="";C&&(l.isRtl?(_=0,T=d.lefts[v.lastCol]-d.lefts[v.firstCol]):(T=0,_=d.rights[v.firstCol]-d.rights[v.lastCol])),m.push(x("div",{className:"fc-daygrid-event-harness"+(C?" fc-daygrid-event-harness-abs":""),key:KM(v),ref:p?null:this.segHarnessRefs.createRef(XM(v)),style:{visibility:S?"":"hidden",marginTop:C?"":y.marginTop,top:C?y.absoluteTop:"",left:T,right:_}},YM(v)?x(Sb,Object.assign({seg:v,isDragging:r,isSelected:b===c,defaultDisplayEventEnd:u},ln(v,n))):x(Eb,Object.assign({seg:v,isDragging:r,isResizing:o,isDateSelecting:a,isSelected:b===c,defaultDisplayEventEnd:u},ln(v,n)))))}return m}renderFillSegs(e,t){let{isRtl:n}=this.context,{todayRange:s}=this.props,{framePositions:r}=this.state,o=[];if(r)for(let a of e){let l=n?{right:0,left:r.lefts[a.lastCol]-r.lefts[a.firstCol]}:{left:0,right:r.rights[a.firstCol]-r.rights[a.lastCol]};o.push(x("div",{key:Hf(a.eventRange),className:"fc-daygrid-bg-harness",style:l},t==="bg-event"?x(Ta,Object.assign({seg:a},ln(a,s))):Kf(t)))}return x(oe,{},...o)}updateSizing(e){let{props:t,state:n,frameElRefs:s}=this;if(!t.forPrint&&t.clientWidth!==null){if(e){let l=t.cells.map(c=>s.currentMap[c.key]);if(l.length){let c=this.rootElRef.current,d=new Jn(c,l,!0,!1);(!n.framePositions||!n.framePositions.similarTo(d))&&this.setState({framePositions:new Jn(c,l,!0,!1)})}}let r=this.state.segHeights,o=this.querySegHeights(),a=t.dayMaxEvents===!0||t.dayMaxEventRows===!0;this.safeSetState({segHeights:Object.assign(Object.assign({},r),o),maxContentHeight:a?this.computeMaxContentHeight():null})}}querySegHeights(){let e=this.segHarnessRefs.currentMap,t={};for(let n in e){let s=Math.round(e[n].getBoundingClientRect().height);t[n]=Math.max(t[n]||0,s)}return t}computeMaxContentHeight(){let e=this.props.cells[0].key,t=this.cellElRefs.currentMap[e],n=this.fgElRefs.currentMap[e];return t.getBoundingClientRect().bottom-n.getBoundingClientRect().top}getCellEls(){let e=this.cellElRefs.currentMap;return this.props.cells.map(t=>e[t.key])}};wb.addStateEquality({segHeights:Ut});function zV(i,e){if(!i.length)return[];let t=WV(e);return i.map(n=>({seg:n,isVisible:!0,isAbsolute:!0,absoluteTop:t[n.eventRange.instance.instanceId],marginTop:0}))}function WV(i){let e={};for(let t of i)for(let n of t)e[n.seg.eventRange.instance.instanceId]=n.absoluteTop;return e}var uT=class extends ot{constructor(){super(...arguments),this.splitBusinessHourSegs=z(bb),this.splitBgEventSegs=z(qV),this.splitFgEventSegs=z(bb),this.splitDateSelectionSegs=z(bb),this.splitEventDrag=z(WM),this.splitEventResize=z(WM),this.rowRefs=new Ht}render(){let{props:e,context:t}=this,n=e.cells.length,s=this.splitBusinessHourSegs(e.businessHourSegs,n),r=this.splitBgEventSegs(e.bgEventSegs,n),o=this.splitFgEventSegs(e.fgEventSegs,n),a=this.splitDateSelectionSegs(e.dateSelectionSegs,n),l=this.splitEventDrag(e.eventDrag,n),c=this.splitEventResize(e.eventResize,n),d=n>=7&&e.clientWidth?e.clientWidth/t.options.aspectRatio/6:null;return x(Bt,{unit:"day"},(u,p)=>x(oe,null,e.cells.map((m,y)=>x(wb,{ref:this.rowRefs.createRef(y),key:m.length?m[0].date.toISOString():y,showDayNumbers:n>1,showWeekNumbers:e.showWeekNumbers,todayRange:p,dateProfile:e.dateProfile,cells:m,renderIntro:e.renderRowIntro,businessHourSegs:s[y],eventSelection:e.eventSelection,bgEventSegs:r[y],fgEventSegs:o[y],dateSelectionSegs:a[y],eventDrag:l[y],eventResize:c[y],dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,clientWidth:e.clientWidth,clientHeight:e.clientHeight,cellMinHeight:d,forPrint:e.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){let e=this.rowRefs.currentMap[0].getCellEls()[0],t=e?e.closest(".fc-daygrid-body"):null;t&&(this.rootEl=t,this.context.registerInteractiveComponent(this,{el:t,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new Jn(this.rootEl,this.rowRefs.collect().map(e=>e.getCellEls()[0]),!1,!0),this.colPositions=new Jn(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(e,t){let{colPositions:n,rowPositions:s}=this,r=n.leftToIndex(e),o=s.topToIndex(t);if(o!=null&&r!=null){let a=this.props.cells[o][r];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(o,r),allDay:!0},a.extraDateSpan),dayEl:this.getCellEl(o,r),rect:{left:n.lefts[r],right:n.rights[r],top:s.tops[o],bottom:s.bottoms[o]},layer:0}}return null}getCellEl(e,t){return this.rowRefs.currentMap[e].getCellEls()[t]}getCellRange(e,t){let n=this.props.cells[e][t].date,s=we(n,1);return{start:n,end:s}}};function qV(i,e){return bb(i.filter(YV),e)}function YV(i){return i.eventRange.def.allDay}var hT=class extends ot{constructor(){super(...arguments),this.elRef=Oe(),this.needsScrollReset=!1}render(){let{props:e}=this,{dayMaxEventRows:t,dayMaxEvents:n,expandRows:s}=e,r=n===!0||t===!0;r&&!s&&(r=!1,t=null,n=null);let o=["fc-daygrid-body",r?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",s?"":"fc-daygrid-body-natural"];return x("div",{ref:this.elRef,className:o.join(" "),style:{width:e.clientWidth,minWidth:e.tableMinWidth}},x("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:e.clientWidth,minWidth:e.tableMinWidth,height:s?e.clientHeight:""}},e.colGroupNode,x("tbody",{role:"presentation"},x(uT,{dateProfile:e.dateProfile,cells:e.cells,renderRowIntro:e.renderRowIntro,showWeekNumbers:e.showWeekNumbers,clientWidth:e.clientWidth,clientHeight:e.clientHeight,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,dayMaxEvents:n,dayMaxEventRows:t,forPrint:e.forPrint,isHitComboAllowed:e.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(e){e.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){let e=KV(this.elRef.current,this.props.dateProfile);if(e){let t=e.closest(".fc-daygrid-body"),n=t.closest(".fc-scroller"),s=e.getBoundingClientRect().top-t.getBoundingClientRect().top;n.scrollTop=s?s+1:0}this.needsScrollReset=!1}}};function KV(i,e){let t;return e.currentRangeUnit.match(/year|month/)&&(t=i.querySelector(`[data-date="${vC(e.currentDate)}-01"]`)),t||(t=i.querySelector(`[data-date="${Dr(e.currentDate)}"]`)),t}var fT=class extends Ca{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(e,t){return t.sliceRange(e)}},Zf=class extends ot{constructor(){super(...arguments),this.slicer=new fT,this.tableRef=Oe()}render(){let{props:e,context:t}=this;return x(hT,Object.assign({ref:this.tableRef},this.slicer.sliceProps(e,e.dateProfile,e.nextDayThreshold,t,e.dayTableModel),{dateProfile:e.dateProfile,cells:e.dayTableModel.cells,colGroupNode:e.colGroupNode,tableMinWidth:e.tableMinWidth,renderRowIntro:e.renderRowIntro,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.showWeekNumbers,expandRows:e.expandRows,headerAlignElRef:e.headerAlignElRef,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:e.forPrint}))}},Ab=class extends aT{constructor(){super(...arguments),this.buildDayTableModel=z(XV),this.headerRef=Oe(),this.tableRef=Oe()}render(){let{options:e,dateProfileGenerator:t}=this.context,{props:n}=this,s=this.buildDayTableModel(n.dateProfile,t),r=e.dayHeaders&&x(Sa,{ref:this.headerRef,dateProfile:n.dateProfile,dates:s.headerDates,datesRepDistinctDays:s.rowCnt===1}),o=a=>x(Zf,{ref:this.tableRef,dateProfile:n.dateProfile,dayTableModel:s,businessHours:n.businessHours,dateSelection:n.dateSelection,eventStore:n.eventStore,eventUiBases:n.eventUiBases,eventSelection:n.eventSelection,eventDrag:n.eventDrag,eventResize:n.eventResize,nextDayThreshold:e.nextDayThreshold,colGroupNode:a.tableColGroupNode,tableMinWidth:a.tableMinWidth,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.weekNumbers,expandRows:!n.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:a.clientWidth,clientHeight:a.clientHeight,forPrint:n.forPrint});return e.dayMinWidth?this.renderHScrollLayout(r,o,s.colCnt,e.dayMinWidth):this.renderSimpleLayout(r,o)}};function XV(i,e){let t=new wa(i.renderRange,e);return new Aa(t,/year|month|week/.test(i.currentRangeUnit))}var Cb=class extends ya{buildRenderRange(e,t,n){let s=super.buildRenderRange(e,t,n),{props:r}=this;return JV({currentRange:s,snapToWeek:/^(year|month)$/.test(t),fixedWeekCount:r.fixedWeekCount,dateEnv:r.dateEnv})}};function JV(i){let{dateEnv:e,currentRange:t}=i,{start:n,end:s}=t,r;if(i.snapToWeek&&(n=e.startOfWeek(n),r=e.startOfWeek(s),r.valueOf()!==s.valueOf()&&(s=eb(r,1))),i.fixedWeekCount){let o=e.startOfWeek(e.startOfMonth(we(t.end,-1))),a=Math.ceil(mC(o,s));s=eb(s,6-a)}return{start:n,end:s}}var ZV=':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}';Rr(ZV);var JM=$t({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:Ab,dateProfileGeneratorClass:Cb},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});var gT=class extends Tf{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(e){return e.allDay?["allDay"]:["timed"]}getKeysForEventDef(e){return e.allDay?LC(e)?["timed","allDay"]:["allDay"]:["timed"]}},jV=he({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function tP(i){let e=["fc-timegrid-slot","fc-timegrid-slot-label",i.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return x(Cn.Consumer,null,t=>{if(!i.isLabeled)return x("td",{className:e.join(" "),"data-time":i.isoTimeStr});let{dateEnv:n,options:s,viewApi:r}=t,o=s.slotLabelFormat==null?jV:Array.isArray(s.slotLabelFormat)?he(s.slotLabelFormat[0]):he(s.slotLabelFormat),a={level:0,time:i.time,date:n.toDate(i.date),view:r,text:n.format(i.date,o)};return x(Re,{elTag:"td",elClasses:e,elAttrs:{"data-time":i.isoTimeStr},renderProps:a,generatorName:"slotLabelContent",customGenerator:s.slotLabelContent,defaultGenerator:QV,classNameGenerator:s.slotLabelClassNames,didMount:s.slotLabelDidMount,willUnmount:s.slotLabelWillUnmount},l=>x("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},x(l,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function QV(i){return i.text}var mT=class extends te{render(){return this.props.slatMetas.map(e=>x("tr",{key:e.key},x(tP,Object.assign({},e))))}},eG=he({week:"short"}),tG=5,yT=class extends ot{constructor(){super(...arguments),this.allDaySplitter=new gT,this.headerElRef=Oe(),this.rootElRef=Oe(),this.scrollerElRef=Oe(),this.state={slatCoords:null},this.handleScrollTopRequest=e=>{let t=this.scrollerElRef.current;t&&(t.scrollTop=e)},this.renderHeadAxis=(e,t="")=>{let{options:n}=this.context,{dateProfile:s}=this.props,r=s.renderRange,a=Di(r.start,r.end)===1?Mi(this.context,r.start,"week"):{};return n.weekNumbers&&e==="day"?x(Xf,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:r.start,defaultFormat:eG},l=>x("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:t}},x(l,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:a}))):x("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},x("div",{className:"fc-timegrid-axis-frame",style:{height:t}}))},this.renderTableRowAxis=e=>{let{options:t,viewApi:n}=this.context,s={text:t.allDayText,view:n};return x(Re,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:s,generatorName:"allDayContent",customGenerator:t.allDayContent,defaultGenerator:nG,classNameGenerator:t.allDayClassNames,didMount:t.allDayDidMount,willUnmount:t.allDayWillUnmount},r=>x("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",e==null?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:e}},x(r,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=e=>{this.setState({slatCoords:e})}}renderSimpleLayout(e,t,n){let{context:s,props:r}=this,o=[],a=Da(s.options);return e&&o.push({type:"header",key:"header",isSticky:a,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),t&&(o.push({type:"body",key:"all-day",chunk:{content:t}}),o.push({type:"body",key:"all-day-divider",outerContent:x("tr",{role:"presentation",className:"fc-scrollgrid-section"},x("td",{className:"fc-timegrid-divider "+s.theme.getClass("tableCellShaded")}))})),o.push({type:"body",key:"body",liquid:!0,expandRows:!!s.options.expandRows,chunk:{scrollerElRef:this.scrollerElRef,content:n}}),x(Kn,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:s.viewSpec},x(Tr,{liquid:!r.isHeightAuto&&!r.forPrint,collapsibleWidth:r.forPrint,cols:[{width:"shrink"}],sections:o}))}renderHScrollLayout(e,t,n,s,r,o,a){let l=this.context.pluginHooks.scrollGridImpl;if(!l)throw new Error("No ScrollGrid implementation");let{context:c,props:d}=this,u=!d.forPrint&&Da(c.options),p=!d.forPrint&&qf(c.options),m=[];e&&m.push({type:"header",key:"header",isSticky:u,syncRowHeights:!0,chunks:[{key:"axis",rowContent:v=>x("tr",{role:"presentation"},this.renderHeadAxis("day",v.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),t&&(m.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:v=>x("tr",{role:"presentation"},this.renderTableRowAxis(v.rowSyncHeights[0]))},{key:"cols",content:t}]}),m.push({key:"all-day-divider",type:"body",outerContent:x("tr",{role:"presentation",className:"fc-scrollgrid-section"},x("td",{colSpan:2,className:"fc-timegrid-divider "+c.theme.getClass("tableCellShaded")}))}));let y=c.options.nowIndicator;return m.push({type:"body",key:"body",liquid:!0,expandRows:!!c.options.expandRows,chunks:[{key:"axis",content:v=>x("div",{className:"fc-timegrid-axis-chunk"},x("table",{"aria-hidden":!0,style:{height:v.expandRows?v.clientHeight:""}},v.tableColGroupNode,x("tbody",null,x(mT,{slatMetas:o}))),x("div",{className:"fc-timegrid-now-indicator-container"},x(Bt,{unit:y?"minute":"day"},b=>{let S=y&&a&&a.safeComputeTop(b);return typeof S=="number"?x(Yf,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:S},isAxis:!0,date:b}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:n}]}),p&&m.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:Jc},{key:"cols",content:Jc}]}),x(Kn,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:c.viewSpec},x(l,{liquid:!d.isHeightAuto&&!d.forPrint,forPrint:d.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:s,minWidth:r}]}],sections:m}))}getAllDayMaxEventProps(){let{dayMaxEvents:e,dayMaxEventRows:t}=this.context.options;return(e===!0||t===!0)&&(e=void 0,t=tG),{dayMaxEvents:e,dayMaxEventRows:t}}};function nG(i){return i.text}var vT=class{constructor(e,t,n){this.positions=e,this.dateProfile=t,this.slotDuration=n}safeComputeTop(e){let{dateProfile:t}=this;if(Sn(t.currentRange,e)){let n=ue(e),s=e.valueOf()-n.valueOf();if(s>=rn(t.slotMinTime)&&s<rn(t.slotMaxTime))return this.computeTimeTop(ee(s))}return null}computeDateTop(e,t){return t||(t=ue(e)),this.computeTimeTop(ee(e.valueOf()-t.valueOf()))}computeTimeTop(e){let{positions:t,dateProfile:n}=this,s=t.els.length,r=(e.milliseconds-rn(n.slotMinTime))/rn(this.slotDuration),o,a;return r=Math.max(0,r),r=Math.min(s,r),o=Math.floor(r),o=Math.min(o,s-1),a=r-o,t.tops[o]+t.getHeight(o)*a}},bT=class extends te{render(){let{props:e,context:t}=this,{options:n}=t,{slatElRefs:s}=e;return x("tbody",null,e.slatMetas.map((r,o)=>{let a={time:r.time,date:t.dateEnv.toDate(r.date),view:t.viewApi};return x("tr",{key:r.key,ref:s.createRef(r.key)},e.axis&&x(tP,Object.assign({},r)),x(Re,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!r.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":r.isoTimeStr},renderProps:a,generatorName:"slotLaneContent",customGenerator:n.slotLaneContent,classNameGenerator:n.slotLaneClassNames,didMount:n.slotLaneDidMount,willUnmount:n.slotLaneWillUnmount}))}))}},ET=class extends te{constructor(){super(...arguments),this.rootElRef=Oe(),this.slatElRefs=new Ht}render(){let{props:e,context:t}=this;return x("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},x("table",{"aria-hidden":!0,className:t.theme.getClass("table"),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:e.minHeight}},e.tableColGroupNode,x(bT,{slatElRefs:this.slatElRefs,axis:e.axis,slatMetas:e.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:e,props:t}=this;t.onCoords&&t.clientWidth!==null&&this.rootElRef.current.offsetHeight&&t.onCoords(new vT(new Jn(this.rootElRef.current,iG(this.slatElRefs.currentMap,t.slatMetas),!1,!0),this.props.dateProfile,e.options.slotDuration))}};function iG(i,e){return e.map(t=>i[t.key])}function jf(i,e){let t=[],n;for(n=0;n<e;n+=1)t.push([]);if(i)for(n=0;n<i.length;n+=1)t[i[n].col].push(i[n]);return t}function ZM(i,e){let t=[];if(i){for(let n=0;n<e;n+=1)t[n]={affectedInstances:i.affectedInstances,isEvent:i.isEvent,segs:[]};for(let n of i.segs)t[n.col].segs.push(n)}else for(let n=0;n<e;n+=1)t[n]=null;return t}var ST=class extends te{render(){let{props:e}=this;return x(_a,{elClasses:["fc-timegrid-more-link"],elStyle:{top:e.top,bottom:e.bottom},allDayDate:null,moreCnt:e.hiddenSegs.length,allSegs:e.hiddenSegs,hiddenSegs:e.hiddenSegs,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,todayRange:e.todayRange,popoverContent:()=>nP(e.hiddenSegs,e),defaultGenerator:sG,forceTimed:!0},t=>x(t,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}};function sG(i){return i.shortText}function rG(i,e,t){let n=new Ea;e!=null&&(n.strictOrder=e),t!=null&&(n.maxStackCnt=t);let s=n.addSegs(i),r=YC(s),o=oG(n);return o=dG(o,1),{segRects:uG(o),hiddenGroups:r}}function oG(i){let{entriesByLevel:e}=i,t=xT((n,s)=>n+":"+s,(n,s)=>{let r=cG(i,n,s),o=jM(r,t),a=e[n][s];return[Object.assign(Object.assign({},a),{nextLevelNodes:o[0]}),a.thickness+o[1]]});return jM(e.length?{level:0,lateralStart:0,lateralEnd:e[0].length}:null,t)[0]}function jM(i,e){if(!i)return[[],0];let{level:t,lateralStart:n,lateralEnd:s}=i,r=n,o=[];for(;r<s;)o.push(e(t,r)),r+=1;return o.sort(aG),[o.map(lG),o[0][1]]}function aG(i,e){return e[1]-i[1]}function lG(i){return i[0]}function cG(i,e,t){let{levelCoords:n,entriesByLevel:s}=i,r=s[e][t],o=n[e]+r.thickness,a=n.length,l=e;for(;l<a&&n[l]<o;l+=1);for(;l<a;l+=1){let c=s[l],d,u=Df(c,r.span.start,Rf),p=u[0]+u[1],m=p;for(;(d=c[m])&&d.span.start<r.span.end;)m+=1;if(p<m)return{level:l,lateralStart:p,lateralEnd:m}}return null}function dG(i,e){let t=xT((n,s,r)=>xi(n),(n,s,r)=>{let{nextLevelNodes:o,thickness:a}=n,l=a+r,c=a/l,d,u=[];if(!o.length)d=e;else for(let m of o)if(d===void 0){let y=t(m,s,l);d=y[0],u.push(y[1])}else{let y=t(m,d,0);u.push(y[1])}let p=(d-s)*c;return[d-p,Object.assign(Object.assign({},n),{thickness:p,nextLevelNodes:u})]});return i.map(n=>t(n,0,0)[1])}function uG(i){let e=[],t=xT((s,r,o)=>xi(s),(s,r,o)=>{let a=Object.assign(Object.assign({},s),{levelCoord:r,stackDepth:o,stackForward:0});return e.push(a),a.stackForward=n(s.nextLevelNodes,r+s.thickness,o+1)+1});function n(s,r,o){let a=0;for(let l of s)a=Math.max(t(l,r,o),a);return a}return n(i,0,0),e}function xT(i,e){let t={};return(...n)=>{let s=i(...n);return s in t?t[s]:t[s]=e(...n)}}function QM(i,e,t=null,n=0){let s=[];if(t)for(let r=0;r<i.length;r+=1){let o=i[r],a=t.computeDateTop(o.start,e),l=Math.max(a+(n||0),t.computeDateTop(o.end,e));s.push({start:Math.round(a),end:Math.round(l)})}return s}function hG(i,e,t,n){let s=[],r=[];for(let c=0;c<i.length;c+=1){let d=e[c];d?s.push({index:c,thickness:1,span:d}):r.push(i[c])}let{segRects:o,hiddenGroups:a}=rG(s,t,n),l=[];for(let c of o)l.push({seg:i[c.index],rect:c});for(let c of r)l.push({seg:c,rect:null});return{segPlacements:l,hiddenGroups:a}}var fG=he({hour:"numeric",minute:"2-digit",meridiem:!1}),Tb=class extends te{render(){return x(_r,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:fG}))}},wT=class extends te{constructor(){super(...arguments),this.sortEventSegs=z(Ra)}render(){let{props:e,context:t}=this,{options:n}=t,s=n.selectMirror,r=e.eventDrag&&e.eventDrag.segs||e.eventResize&&e.eventResize.segs||s&&e.dateSelectionSegs||[],o=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{},a=this.sortEventSegs(e.fgEventSegs,n.eventOrder);return x(xr,{elTag:"td",elRef:e.elRef,elClasses:["fc-timegrid-col",...e.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},e.extraDataAttrs),date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,extraRenderProps:e.extraRenderProps},l=>x("div",{className:"fc-timegrid-col-frame"},x("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(e.businessHourSegs,"non-business"),this.renderFillSegs(e.bgEventSegs,"bg-event"),this.renderFillSegs(e.dateSelectionSegs,"highlight")),x("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(a,o,!1,!1,!1)),x("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(r,{},!!e.eventDrag,!!e.eventResize,!!s,"mirror")),x("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(e.nowIndicatorSegs)),Zc(n)&&x(l,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(e,t,n,s,r,o){let{props:a}=this;return a.forPrint?nP(e,a):this.renderPositionedFgSegs(e,t,n,s,r,o)}renderPositionedFgSegs(e,t,n,s,r,o){let{eventMaxStack:a,eventShortHeight:l,eventOrderStrict:c,eventMinHeight:d}=this.context.options,{date:u,slatCoords:p,eventSelection:m,todayRange:y,nowDate:v}=this.props,b=n||s||r,S=QM(e,u,p,d),{segPlacements:C,hiddenGroups:T}=hG(e,S,c,a);return x(oe,null,this.renderHiddenGroups(T,e),C.map(_=>{let{seg:R,rect:I}=_,M=R.eventRange.instance.instanceId,k=b||!!(!t[M]&&I),N=pT(I&&I.span),F=!b&&I?this.computeSegHStyle(I):{left:0,right:0},$=!!I&&I.stackForward>0,ae=!!I&&I.span.end-I.span.start<l;return x("div",{className:"fc-timegrid-event-harness"+($?" fc-timegrid-event-harness-inset":""),key:o||M,style:Object.assign(Object.assign({visibility:k?"":"hidden"},N),F)},x(Tb,Object.assign({seg:R,isDragging:n,isResizing:s,isDateSelecting:r,isSelected:M===m,isShort:ae},ln(R,y,v))))}))}renderHiddenGroups(e,t){let{extraDateSpan:n,dateProfile:s,todayRange:r,nowDate:o,eventSelection:a,eventDrag:l,eventResize:c}=this.props;return x(oe,null,e.map(d=>{let u=pT(d.span),p=pG(d.entries,t);return x(ST,{key:tb(gb(p)),hiddenSegs:p,top:u.top,bottom:u.bottom,extraDateSpan:n,dateProfile:s,todayRange:r,nowDate:o,eventSelection:a,eventDrag:l,eventResize:c})}))}renderFillSegs(e,t){let{props:n,context:s}=this,o=QM(e,n.date,n.slatCoords,s.options.eventMinHeight).map((a,l)=>{let c=e[l];return x("div",{key:Hf(c.eventRange),className:"fc-timegrid-bg-harness",style:pT(a)},t==="bg-event"?x(Ta,Object.assign({seg:c},ln(c,n.todayRange,n.nowDate))):Kf(t))});return x(oe,null,o)}renderNowIndicator(e){let{slatCoords:t,date:n}=this.props;return t?e.map((s,r)=>x(Yf,{key:r,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:t.computeDateTop(s.start,n)},isAxis:!1,date:n})):null}computeSegHStyle(e){let{isRtl:t,options:n}=this.context,s=n.slotEventOverlap,r=e.levelCoord,o=e.levelCoord+e.thickness,a,l;s&&(o=Math.min(1,r+(o-r)*2)),t?(a=1-o,l=r):(a=r,l=1-o);let c={zIndex:e.stackDepth+1,left:a*100+"%",right:l*100+"%"};return s&&!e.stackForward&&(c[t?"marginLeft":"marginRight"]=10*2),c}};function nP(i,{todayRange:e,nowDate:t,eventSelection:n,eventDrag:s,eventResize:r}){let o=(s?s.affectedInstances:null)||(r?r.affectedInstances:null)||{};return x(oe,null,i.map(a=>{let l=a.eventRange.instance.instanceId;return x("div",{key:l,style:{visibility:o[l]?"hidden":""}},x(Tb,Object.assign({seg:a,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:l===n,isShort:!1},ln(a,e,t))))}))}function pT(i){return i?{top:i.start,bottom:-i.end}:{top:"",bottom:""}}function pG(i,e){return i.map(t=>e[t.index])}var AT=class extends te{constructor(){super(...arguments),this.splitFgEventSegs=z(jf),this.splitBgEventSegs=z(jf),this.splitBusinessHourSegs=z(jf),this.splitNowIndicatorSegs=z(jf),this.splitDateSelectionSegs=z(jf),this.splitEventDrag=z(ZM),this.splitEventResize=z(ZM),this.rootElRef=Oe(),this.cellElRefs=new Ht}render(){let{props:e,context:t}=this,n=t.options.nowIndicator&&e.slatCoords&&e.slatCoords.safeComputeTop(e.nowDate),s=e.cells.length,r=this.splitFgEventSegs(e.fgEventSegs,s),o=this.splitBgEventSegs(e.bgEventSegs,s),a=this.splitBusinessHourSegs(e.businessHourSegs,s),l=this.splitNowIndicatorSegs(e.nowIndicatorSegs,s),c=this.splitDateSelectionSegs(e.dateSelectionSegs,s),d=this.splitEventDrag(e.eventDrag,s),u=this.splitEventResize(e.eventResize,s);return x("div",{className:"fc-timegrid-cols",ref:this.rootElRef},x("table",{role:"presentation",style:{minWidth:e.tableMinWidth,width:e.clientWidth}},e.tableColGroupNode,x("tbody",{role:"presentation"},x("tr",{role:"row"},e.axis&&x("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},x("div",{className:"fc-timegrid-col-frame"},x("div",{className:"fc-timegrid-now-indicator-container"},typeof n=="number"&&x(Yf,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:n},isAxis:!0,date:e.nowDate})))),e.cells.map((p,m)=>x(wT,{key:p.key,elRef:this.cellElRefs.createRef(p.key),dateProfile:e.dateProfile,date:p.date,nowDate:e.nowDate,todayRange:e.todayRange,extraRenderProps:p.extraRenderProps,extraDataAttrs:p.extraDataAttrs,extraClassNames:p.extraClassNames,extraDateSpan:p.extraDateSpan,fgEventSegs:r[m],bgEventSegs:o[m],businessHourSegs:a[m],nowIndicatorSegs:l[m],dateSelectionSegs:c[m],eventDrag:d[m],eventResize:u[m],slatCoords:e.slatCoords,eventSelection:e.eventSelection,forPrint:e.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:e}=this;e.onColCoords&&e.clientWidth!==null&&e.onColCoords(new Jn(this.rootElRef.current,gG(this.cellElRefs.currentMap,e.cells),!0,!1))}};function gG(i,e){return e.map(t=>i[t.key])}var CT=class extends ot{constructor(){super(...arguments),this.processSlotOptions=z(mG),this.state={slatCoords:null},this.handleRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=e=>{let{onScrollTopRequest:t}=this.props,{slatCoords:n}=this.state;if(t&&n){if(e.time){let s=n.computeTimeTop(e.time);s=Math.ceil(s),s&&(s+=1),t(s)}return!0}return!1},this.handleColCoords=e=>{this.colCoords=e},this.handleSlatCoords=e=>{this.setState({slatCoords:e}),this.props.onSlatCoords&&this.props.onSlatCoords(e)}}render(){let{props:e,state:t}=this;return x("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:e.clientWidth,minWidth:e.tableMinWidth}},x(ET,{axis:e.axis,dateProfile:e.dateProfile,slatMetas:e.slatMetas,clientWidth:e.clientWidth,minHeight:e.expandRows?e.clientHeight:"",tableMinWidth:e.tableMinWidth,tableColGroupNode:e.axis?e.tableColGroupNode:null,onCoords:this.handleSlatCoords}),x(AT,{cells:e.cells,axis:e.axis,dateProfile:e.dateProfile,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange,nowDate:e.nowDate,nowIndicatorSegs:e.nowIndicatorSegs,clientWidth:e.clientWidth,tableMinWidth:e.tableMinWidth,tableColGroupNode:e.tableColGroupNode,slatCoords:t.slatCoords,onColCoords:this.handleColCoords,forPrint:e.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(e){this.scrollResponder.update(e.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(e,t){let{dateEnv:n,options:s}=this.context,{colCoords:r}=this,{dateProfile:o}=this.props,{slatCoords:a}=this.state,{snapDuration:l,snapsPerSlot:c}=this.processSlotOptions(this.props.slotDuration,s.snapDuration),d=r.leftToIndex(e),u=a.positions.topToIndex(t);if(d!=null&&u!=null){let p=this.props.cells[d],m=a.positions.tops[u],y=a.positions.getHeight(u),v=(t-m)/y,b=Math.floor(v*c),S=u*c+b,C=this.props.cells[d].date,T=Ff(o.slotMinTime,gC(l,S)),_=n.add(C,T),R=n.add(_,l);return{dateProfile:o,dateSpan:Object.assign({range:{start:_,end:R},allDay:!1},p.extraDateSpan),dayEl:r.els[d],rect:{left:r.lefts[d],right:r.rights[d],top:m,bottom:m+y},layer:0}}return null}};function mG(i,e){let t=e||i,n=Lf(i,t);return n===null&&(t=i,n=1),{snapDuration:t,snapsPerSlot:n}}var TT=class extends Ca{sliceRange(e,t){let n=[];for(let s=0;s<t.length;s+=1){let r=on(e,t[s]);r&&n.push({start:r.start,end:r.end,isStart:r.start.valueOf()===e.start.valueOf(),isEnd:r.end.valueOf()===e.end.valueOf(),col:s})}return n}},_T=class extends ot{constructor(){super(...arguments),this.buildDayRanges=z(yG),this.slicer=new TT,this.timeColsRef=Oe()}render(){let{props:e,context:t}=this,{dateProfile:n,dayTableModel:s}=e,{nowIndicator:r,nextDayThreshold:o}=t.options,a=this.buildDayRanges(s,n,t.dateEnv);return x(Bt,{unit:r?"minute":"day"},(l,c)=>x(CT,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(e,n,null,t,a),{forPrint:e.forPrint,axis:e.axis,dateProfile:n,slatMetas:e.slatMetas,slotDuration:e.slotDuration,cells:s.cells[0],tableColGroupNode:e.tableColGroupNode,tableMinWidth:e.tableMinWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight,expandRows:e.expandRows,nowDate:l,nowIndicatorSegs:r&&this.slicer.sliceNowDate(l,n,o,t,a),todayRange:c,onScrollTopRequest:e.onScrollTopRequest,onSlatCoords:e.onSlatCoords})))}};function yG(i,e,t){let n=[];for(let s of i.headerDates)n.push({start:t.add(s,e.slotMinTime),end:t.add(s,e.slotMaxTime)});return n}var eP=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function vG(i,e,t,n,s){let r=new Date(0),o=i,a=ee(0),l=t||bG(n),c=[];for(;rn(o)<rn(e);){let d=s.add(r,o),u=Lf(a,l)!==null;c.push({date:d,time:o,key:d.toISOString(),isoTimeStr:bC(d),isLabeled:u}),o=Ff(o,n),a=Ff(a,n)}return c}function bG(i){let e,t,n;for(e=eP.length-1;e>=0;e-=1)if(t=ee(eP[e]),n=Lf(t,i),n!==null&&n>1)return t;return i}var _b=class extends yT{constructor(){super(...arguments),this.buildTimeColsModel=z(EG),this.buildSlatMetas=z(vG)}render(){let{options:e,dateEnv:t,dateProfileGenerator:n}=this.context,{props:s}=this,{dateProfile:r}=s,o=this.buildTimeColsModel(r,n),a=this.allDaySplitter.splitProps(s),l=this.buildSlatMetas(r.slotMinTime,r.slotMaxTime,e.slotLabelInterval,e.slotDuration,t),{dayMinWidth:c}=e,d=!c,u=c,p=e.dayHeaders&&x(Sa,{dates:o.headerDates,dateProfile:r,datesRepDistinctDays:!0,renderIntro:d?this.renderHeadAxis:null}),m=e.allDaySlot!==!1&&(v=>x(Zf,Object.assign({},a.allDay,{dateProfile:r,dayTableModel:o,nextDayThreshold:e.nextDayThreshold,tableMinWidth:v.tableMinWidth,colGroupNode:v.tableColGroupNode,renderRowIntro:d?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:v.clientWidth,clientHeight:v.clientHeight,forPrint:s.forPrint},this.getAllDayMaxEventProps()))),y=v=>x(_T,Object.assign({},a.timed,{dayTableModel:o,dateProfile:r,axis:d,slotDuration:e.slotDuration,slatMetas:l,forPrint:s.forPrint,tableColGroupNode:v.tableColGroupNode,tableMinWidth:v.tableMinWidth,clientWidth:v.clientWidth,clientHeight:v.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:v.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return u?this.renderHScrollLayout(p,m,y,o.colCnt,c,l,this.state.slatCoords):this.renderSimpleLayout(p,m,y)}};function EG(i,e){let t=new wa(i.renderRange,e);return new Aa(t,!1)}var SG='.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}';Rr(SG);var wG={allDaySlot:Boolean},iP=$t({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:wG,views:{timeGrid:{component:_b,usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});var RT=class extends te{constructor(){super(...arguments),this.state={textId:An()}}render(){let{theme:e,dateEnv:t,options:n,viewApi:s}=this.context,{cellId:r,dayDate:o,todayRange:a}=this.props,{textId:l}=this.state,c=Vf(o,a),d=n.listDayFormat?t.format(o,n.listDayFormat):"",u=n.listDaySideFormat?t.format(o,n.listDaySideFormat):"",p=Object.assign({date:t.toDate(o),view:s,textId:l,text:d,sideText:u,navLinkAttrs:Mi(this.context,o),sideNavLinkAttrs:Mi(this.context,o,"day",!1)},c);return x(Re,{elTag:"tr",elClasses:["fc-list-day",...Xc(c,e)],elAttrs:{"data-date":Dr(o)},renderProps:p,generatorName:"dayHeaderContent",customGenerator:n.dayHeaderContent,defaultGenerator:AG,classNameGenerator:n.dayHeaderClassNames,didMount:n.dayHeaderDidMount,willUnmount:n.dayHeaderWillUnmount},m=>x("th",{scope:"colgroup",colSpan:3,id:r,"aria-labelledby":l},x(m,{elTag:"div",elClasses:["fc-list-day-cushion",e.getClass("tableCellShaded")]})))}};function AG(i){return x(oe,null,i.text&&x("a",Object.assign({id:i.textId,className:"fc-list-day-text"},i.navLinkAttrs),i.text),i.sideText&&x("a",Object.assign({"aria-hidden":!0,className:"fc-list-day-side-text"},i.sideNavLinkAttrs),i.sideText))}var CG=he({hour:"numeric",minute:"2-digit",meridiem:"short"}),DT=class extends te{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s,timeHeaderId:r,eventHeaderId:o,dateHeaderId:a}=e,l=n.eventTimeFormat||CG;return x(Ss,Object.assign({},e,{elTag:"tr",elClasses:["fc-list-event",s.eventRange.def.url&&"fc-event-forced-url"],defaultGenerator:()=>TG(s,t),seg:s,timeText:"",disableDragging:!0,disableResizing:!0}),(c,d)=>x(oe,null,_G(s,l,t,r,a),x("td",{"aria-hidden":!0,className:"fc-list-event-graphic"},x("span",{className:"fc-list-event-dot",style:{borderColor:d.borderColor||d.backgroundColor}})),x(c,{elTag:"td",elClasses:["fc-list-event-title"],elAttrs:{headers:`${o} ${a}`}})))}};function TG(i,e){let t=Yc(i,e);return x("a",Object.assign({},t),i.eventRange.def.title)}function _G(i,e,t,n,s){let{options:r}=t;if(r.displayEventTime!==!1){let o=i.eventRange.def,a=i.eventRange.instance,l=!1,c;if(o.allDay?l=!0:RC(i.eventRange.range)?i.isStart?c=Pr(i,e,t,null,null,a.range.start,i.end):i.isEnd?c=Pr(i,e,t,null,null,i.start,a.range.end):l=!0:c=Pr(i,e,t),l){let d={text:t.options.allDayText,view:t.viewApi};return x(Re,{elTag:"td",elClasses:["fc-list-event-time"],elAttrs:{headers:`${n} ${s}`},renderProps:d,generatorName:"allDayContent",customGenerator:r.allDayContent,defaultGenerator:xG,classNameGenerator:r.allDayClassNames,didMount:r.allDayDidMount,willUnmount:r.allDayWillUnmount})}return x("td",{className:"fc-list-event-time"},c)}return null}function xG(i){return i.text}var xb=class extends ot{constructor(){super(...arguments),this.computeDateVars=z(DG),this.eventStoreToSegs=z(this._eventStoreToSegs),this.state={timeHeaderId:An(),eventHeaderId:An(),dateHeaderIdRoot:An()},this.setRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e}):this.context.unregisterInteractiveComponent(this)}}render(){let{props:e,context:t}=this,{dayDates:n,dayRanges:s}=this.computeDateVars(e.dateProfile),r=this.eventStoreToSegs(e.eventStore,e.eventUiBases,s);return x(Kn,{elRef:this.setRootEl,elClasses:["fc-list",t.theme.getClass("table"),t.options.stickyHeaderDates!==!1?"fc-list-sticky":""],viewSpec:t.viewSpec},x(Vc,{liquid:!e.isHeightAuto,overflowX:e.isHeightAuto?"visible":"hidden",overflowY:e.isHeightAuto?"visible":"auto"},r.length>0?this.renderSegList(r,n):this.renderEmptyMessage()))}renderEmptyMessage(){let{options:e,viewApi:t}=this.context,n={text:e.noEventsText,view:t};return x(Re,{elTag:"div",elClasses:["fc-list-empty"],renderProps:n,generatorName:"noEventsContent",customGenerator:e.noEventsContent,defaultGenerator:RG,classNameGenerator:e.noEventsClassNames,didMount:e.noEventsDidMount,willUnmount:e.noEventsWillUnmount},s=>x(s,{elTag:"div",elClasses:["fc-list-empty-cushion"]}))}renderSegList(e,t){let{theme:n,options:s}=this.context,{timeHeaderId:r,eventHeaderId:o,dateHeaderIdRoot:a}=this.state,l=IG(e);return x(Bt,{unit:"day"},(c,d)=>{let u=[];for(let p=0;p<l.length;p+=1){let m=l[p];if(m){let y=Dr(t[p]),v=a+"-"+y;u.push(x(RT,{key:y,cellId:v,dayDate:t[p],todayRange:d})),m=Ra(m,s.eventOrder);for(let b of m)u.push(x(DT,Object.assign({key:y+":"+b.eventRange.instance.instanceId,seg:b,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,timeHeaderId:r,eventHeaderId:o,dateHeaderId:v},ln(b,d,c))))}}return x("table",{className:"fc-list-table "+n.getClass("table")},x("thead",null,x("tr",null,x("th",{scope:"col",id:r},s.timeHint),x("th",{scope:"col","aria-hidden":!0}),x("th",{scope:"col",id:o},s.eventHint))),x("tbody",null,u))})}_eventStoreToSegs(e,t,n){return this.eventRangesToSegs($c(e,t,this.props.dateProfile.activeRange,this.context.options.nextDayThreshold).fg,n)}eventRangesToSegs(e,t){let n=[];for(let s of e)n.push(...this.eventRangeToSegs(s,t));return n}eventRangeToSegs(e,t){let{dateEnv:n}=this.context,{nextDayThreshold:s}=this.context.options,r=e.range,o=e.def.allDay,a,l,c,d=[];for(a=0;a<t.length;a+=1)if(l=on(r,t[a]),l&&(c={component:this,eventRange:e,start:l.start,end:l.end,isStart:e.isStart&&l.start.valueOf()===r.start.valueOf(),isEnd:e.isEnd&&l.end.valueOf()===r.end.valueOf(),dayIndex:a},d.push(c),!c.isEnd&&!o&&a+1<t.length&&r.end<n.add(t[a+1].start,s))){c.end=r.end,c.isEnd=!0;break}return d}};function RG(i){return i.text}function DG(i){let e=ue(i.renderRange.start),t=i.renderRange.end,n=[],s=[];for(;e<t;)n.push(e),s.push({start:e,end:we(e,1)}),e=we(e,1);return{dayDates:n,dayRanges:s}}function IG(i){let e=[],t,n;for(t=0;t<i.length;t+=1)n=i[t],(e[n.dayIndex]||(e[n.dayIndex]=[])).push(n);return e}var MG=':root{--fc-list-event-dot-width:10px;--fc-list-event-hover-bg-color:#f5f5f5}.fc-theme-standard .fc-list{border:1px solid var(--fc-border-color)}.fc .fc-list-empty{align-items:center;background-color:var(--fc-neutral-bg-color);display:flex;height:100%;justify-content:center}.fc .fc-list-empty-cushion{margin:5em 0}.fc .fc-list-table{border-style:hidden;width:100%}.fc .fc-list-table tr>*{border-left:0;border-right:0}.fc .fc-list-sticky .fc-list-day>*{background:var(--fc-page-bg-color);position:sticky;top:0}.fc .fc-list-table thead{left:-10000px;position:absolute}.fc .fc-list-table tbody>tr:first-child th{border-top:0}.fc .fc-list-table th{padding:0}.fc .fc-list-day-cushion,.fc .fc-list-table td{padding:8px 14px}.fc .fc-list-day-cushion:after{clear:both;content:"";display:table}.fc-theme-standard .fc-list-day-cushion{background-color:var(--fc-neutral-bg-color)}.fc-direction-ltr .fc-list-day-text,.fc-direction-rtl .fc-list-day-side-text{float:left}.fc-direction-ltr .fc-list-day-side-text,.fc-direction-rtl .fc-list-day-text{float:right}.fc-direction-ltr .fc-list-table .fc-list-event-graphic{padding-right:0}.fc-direction-rtl .fc-list-table .fc-list-event-graphic{padding-left:0}.fc .fc-list-event.fc-event-forced-url{cursor:pointer}.fc .fc-list-event:hover td{background-color:var(--fc-list-event-hover-bg-color)}.fc .fc-list-event-graphic,.fc .fc-list-event-time{white-space:nowrap;width:1px}.fc .fc-list-event-dot{border:calc(var(--fc-list-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-list-event-dot-width)/2);box-sizing:content-box;display:inline-block;height:0;width:0}.fc .fc-list-event-title a{color:inherit;text-decoration:none}.fc .fc-list-event.fc-event-forced-url:hover a{text-decoration:underline}';Rr(MG);var PG={listDayFormat:sP,listDaySideFormat:sP,noEventsClassNames:P,noEventsContent:P,noEventsDidMount:P,noEventsWillUnmount:P};function sP(i){return i===!1?null:he(i)}var rP=$t({name:"@fullcalendar/list",optionRefiners:PG,views:{list:{component:xb,buttonTextKey:"list",listDayFormat:{month:"long",day:"numeric",year:"numeric"}},listDay:{type:"list",duration:{days:1},listDayFormat:{weekday:"long"}},listWeek:{type:"list",duration:{weeks:1},listDayFormat:{weekday:"long"},listDaySideFormat:{month:"long",day:"numeric",year:"numeric"}},listMonth:{type:"list",duration:{month:1},listDaySideFormat:{weekday:"long"}},listYear:{type:"list",duration:{year:1},listDaySideFormat:{weekday:"long"}}}});Wf.touchMouseIgnoreWait=500;var IT=0,Rb=0,MT=!1,Db=class{constructor(e){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=t=>{if(!this.shouldIgnoreMouse()&&kG(t)&&this.tryStart(t)){let n=this.createEventFromMouse(t,!0);this.emitter.trigger("pointerdown",n),this.initScrollWatch(n),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=t=>{let n=this.createEventFromMouse(t);this.recordCoords(n),this.emitter.trigger("pointermove",n)},this.handleMouseUp=t=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(t)),this.cleanup()},this.handleTouchStart=t=>{if(this.tryStart(t)){this.isTouchDragging=!0;let n=this.createEventFromTouch(t,!0);this.emitter.trigger("pointerdown",n),this.initScrollWatch(n);let s=t.target;this.shouldIgnoreMove||s.addEventListener("touchmove",this.handleTouchMove),s.addEventListener("touchend",this.handleTouchEnd),s.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=t=>{let n=this.createEventFromTouch(t);this.recordCoords(n),this.emitter.trigger("pointermove",n)},this.handleTouchEnd=t=>{if(this.isDragging){let n=t.target;n.removeEventListener("touchmove",this.handleTouchMove),n.removeEventListener("touchend",this.handleTouchEnd),n.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(t)),this.cleanup(),this.isTouchDragging=!1,NG()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=t=>{if(!this.shouldIgnoreMove){let n=window.scrollX-this.prevScrollX+this.prevPageX,s=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:t,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:n,pageY:s,deltaX:n-this.origPageX,deltaY:s-this.origPageY})}},this.containerEl=e,this.emitter=new Es,e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),FG()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),LG()}tryStart(e){let t=this.querySubjectEl(e),n=e.target;return t&&(!this.handleSelector||Ge(n,this.handleSelector))?(this.subjectEl=t,this.isDragging=!0,this.wasTouchScroll=!1,!0):!1}cleanup(){MT=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(e){return this.selector?Ge(e.target,this.selector):this.containerEl}shouldIgnoreMouse(){return IT||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(MT=!0)}initScrollWatch(e){this.shouldWatchScroll&&(this.recordCoords(e),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(e){this.shouldWatchScroll&&(this.prevPageX=e.pageX,this.prevPageY=e.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(e,t){let n=0,s=0;return t?(this.origPageX=e.pageX,this.origPageY=e.pageY):(n=e.pageX-this.origPageX,s=e.pageY-this.origPageY),{origEvent:e,isTouch:!1,subjectEl:this.subjectEl,pageX:e.pageX,pageY:e.pageY,deltaX:n,deltaY:s}}createEventFromTouch(e,t){let n=e.touches,s,r,o=0,a=0;return n&&n.length?(s=n[0].pageX,r=n[0].pageY):(s=e.pageX,r=e.pageY),t?(this.origPageX=s,this.origPageY=r):(o=s-this.origPageX,a=r-this.origPageY),{origEvent:e,isTouch:!0,subjectEl:this.subjectEl,pageX:s,pageY:r,deltaX:o,deltaY:a}}};function kG(i){return i.button===0&&!i.ctrlKey}function NG(){IT+=1,setTimeout(()=>{IT-=1},Wf.touchMouseIgnoreWait)}function FG(){Rb+=1,Rb===1&&window.addEventListener("touchmove",aP,{passive:!1})}function LG(){Rb-=1,Rb||window.removeEventListener("touchmove",aP,{passive:!1})}function aP(i){MT&&i.preventDefault()}var PT=class{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(e,t,n){this.sourceEl=e,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=t-window.scrollX,this.origScreenY=n-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(e,t){this.deltaX=e-window.scrollX-this.origScreenX,this.deltaY=t-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(e){e?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=e,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=e)}stop(e,t){let n=()=>{this.cleanup(),t()};e&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(n,this.revertDuration):setTimeout(n,0)}doRevertAnimation(e,t){let n=this.mirrorEl,s=this.sourceEl.getBoundingClientRect();n.style.transition="top "+t+"ms,left "+t+"ms",xa(n,{left:s.left,top:s.top}),cC(n,()=>{n.style.transition="",e()})}cleanup(){this.mirrorEl&&(Mf(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&xa(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let e=this.sourceElRect,t=this.mirrorEl;return t||(t=this.mirrorEl=this.sourceEl.cloneNode(!0),t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.pointerEvents="none",t.classList.add("fc-event-dragging"),xa(t,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:e.right-e.left,height:e.bottom-e.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(t)),t}},Ib=class extends ba{constructor(e,t){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=e,this.doesListening=t,this.scrollTop=this.origScrollTop=e.getScrollTop(),this.scrollLeft=this.origScrollLeft=e.getScrollLeft(),this.scrollWidth=e.getScrollWidth(),this.scrollHeight=e.getScrollHeight(),this.clientWidth=e.getClientWidth(),this.clientHeight=e.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(e){this.scrollController.setScrollTop(e),this.doesListening||(this.scrollTop=Math.max(Math.min(e,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(e){this.scrollController.setScrollLeft(e),this.doesListening||(this.scrollLeft=Math.max(Math.min(e,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}},Mb=class extends Ib{constructor(e,t){super(new _f(e),t)}getEventTarget(){return this.scrollController.el}computeClientRect(){return qC(this.scrollController.el)}},kT=class extends Ib{constructor(e){super(new xf,e)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}},oP=typeof performance=="function"?performance.now:Date.now,NT=class{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let e=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(e){let t=oP();this.handleSide(e,(t-this.msSinceRequest)/1e3),this.requestAnimation(t)}else this.isAnimating=!1}}}start(e,t,n){this.isEnabled&&(this.scrollCaches=this.buildCaches(n),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(e,t))}handleMove(e,t){if(this.isEnabled){let n=e-window.scrollX,s=t-window.scrollY,r=this.pointerScreenY===null?0:s-this.pointerScreenY,o=this.pointerScreenX===null?0:n-this.pointerScreenX;r<0?this.everMovedUp=!0:r>0&&(this.everMovedDown=!0),o<0?this.everMovedLeft=!0:o>0&&(this.everMovedRight=!0),this.pointerScreenX=n,this.pointerScreenY=s,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(oP()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let e of this.scrollCaches)e.destroy();this.scrollCaches=null}}requestAnimation(e){this.msSinceRequest=e,requestAnimationFrame(this.animate)}handleSide(e,t){let{scrollCache:n}=e,{edgeThreshold:s}=this,r=s-e.distance,o=r*r/(s*s)*this.maxVelocity*t,a=1;switch(e.name){case"left":a=-1;case"right":n.setScrollLeft(n.getScrollLeft()+o*a);break;case"top":a=-1;case"bottom":n.setScrollTop(n.getScrollTop()+o*a);break}}computeBestEdge(e,t){let{edgeThreshold:n}=this,s=null,r=this.scrollCaches||[];for(let o of r){let a=o.clientRect,l=e-a.left,c=a.right-e,d=t-a.top,u=a.bottom-t;l>=0&&c>=0&&d>=0&&u>=0&&(d<=n&&this.everMovedUp&&o.canScrollUp()&&(!s||s.distance>d)&&(s={scrollCache:o,name:"top",distance:d}),u<=n&&this.everMovedDown&&o.canScrollDown()&&(!s||s.distance>u)&&(s={scrollCache:o,name:"bottom",distance:u}),l<=n&&this.everMovedLeft&&o.canScrollLeft()&&(!s||s.distance>l)&&(s={scrollCache:o,name:"left",distance:l}),c<=n&&this.everMovedRight&&o.canScrollRight()&&(!s||s.distance>c)&&(s={scrollCache:o,name:"right",distance:c}))}return s}buildCaches(e){return this.queryScrollEls(e).map(t=>t===window?new kT(!1):new Mb(t,!1))}queryScrollEls(e){let t=[];for(let n of this.scrollQuery)typeof n=="object"?t.push(n):t.push(...Array.prototype.slice.call(e.getRootNode().querySelectorAll(n)));return t}},Ia=class extends If{constructor(e,t){super(e),this.containerEl=e,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=s=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,dC(document.body),hC(document.body),s.isTouch||s.origEvent.preventDefault(),this.emitter.trigger("pointerdown",s),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(s.subjectEl,s.pageX,s.pageY),this.startDelay(s),this.minDistance||this.handleDistanceSurpassed(s)))},this.onPointerMove=s=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",s),!this.isDistanceSurpassed){let r=this.minDistance,o,{deltaX:a,deltaY:l}=s;o=a*a+l*l,o>=r*r&&this.handleDistanceSurpassed(s)}this.isDragging&&(s.origEvent.type!=="scroll"&&(this.mirror.handleMove(s.pageX,s.pageY),this.autoScroller.handleMove(s.pageX,s.pageY)),this.emitter.trigger("dragmove",s))}},this.onPointerUp=s=>{this.isInteracting&&(this.isInteracting=!1,uC(document.body),fC(document.body),this.emitter.trigger("pointerup",s),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(s)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let n=this.pointer=new Db(e);n.emitter.on("pointerdown",this.onPointerDown),n.emitter.on("pointermove",this.onPointerMove),n.emitter.on("pointerup",this.onPointerUp),t&&(n.selector=t),this.mirror=new PT,this.autoScroller=new NT}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(e){typeof this.delay=="number"?this.delayTimeoutId=setTimeout(()=>{this.delayTimeoutId=null,this.handleDelayEnd(e)},this.delay):this.handleDelayEnd(e)}handleDelayEnd(e){this.isDelayEnded=!0,this.tryStartDrag(e)}handleDistanceSurpassed(e){this.isDistanceSurpassed=!0,this.tryStartDrag(e)}tryStartDrag(e){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(e.pageX,e.pageY,this.containerEl),this.emitter.trigger("dragstart",e),this.touchScrollAllowed===!1&&this.pointer.cancelTouchScroll())}tryStopDrag(e){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,e))}stopDrag(e){this.isDragging=!1,this.emitter.trigger("dragend",e)}setIgnoreMove(e){this.pointer.shouldIgnoreMove=e}setMirrorIsVisible(e){this.mirror.setIsVisible(e)}setMirrorNeedsRevert(e){this.mirrorNeedsRevert=e}setAutoScrollEnabled(e){this.autoScroller.isEnabled=e}},FT=class{constructor(e){this.el=e,this.origRect=Gf(e),this.scrollCaches=fb(e).map(t=>new Mb(t,!0))}destroy(){for(let e of this.scrollCaches)e.destroy()}computeLeft(){let e=this.origRect.left;for(let t of this.scrollCaches)e+=t.origScrollLeft-t.getScrollLeft();return e}computeTop(){let e=this.origRect.top;for(let t of this.scrollCaches)e+=t.origScrollTop-t.getScrollTop();return e}isWithinClipping(e,t){let n={left:e,top:t};for(let s of this.scrollCaches)if(!OG(s.getEventTarget())&&!VC(n,s.clientRect))return!1;return!0}};function OG(i){let e=i.tagName;return e==="HTML"||e==="BODY"}var Qc=class{constructor(e,t){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=n=>{let{dragging:s}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(n),this.initialHit||!this.requireInitial?(s.setIgnoreMove(!1),this.emitter.trigger("pointerdown",n)):s.setIgnoreMove(!0)},this.handleDragStart=n=>{this.emitter.trigger("dragstart",n),this.handleMove(n,!0)},this.handleDragMove=n=>{this.emitter.trigger("dragmove",n),this.handleMove(n)},this.handlePointerUp=n=>{this.releaseHits(),this.emitter.trigger("pointerup",n)},this.handleDragEnd=n=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,n),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",n)},this.droppableStore=t,e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragstart",this.handleDragStart),e.emitter.on("dragmove",this.handleDragMove),e.emitter.on("pointerup",this.handlePointerUp),e.emitter.on("dragend",this.handleDragEnd),this.dragging=e,this.emitter=new Es}processFirstCoord(e){let t={left:e.pageX,top:e.pageY},n=t,s=e.subjectEl,r;s instanceof HTMLElement&&(r=Gf(s),n=GC(n,r));let o=this.initialHit=this.queryHitForOffset(n.left,n.top);if(o){if(this.useSubjectCenter&&r){let a=hb(r,o.rect);a&&(n=zC(a))}this.coordAdjust=WC(n,t)}else this.coordAdjust={left:0,top:0}}handleMove(e,t){let n=this.queryHitForOffset(e.pageX+this.coordAdjust.left,e.pageY+this.coordAdjust.top);(t||!Pb(this.movingHit,n))&&(this.movingHit=n,this.emitter.trigger("hitupdate",n,!1,e))}prepareHits(){this.offsetTrackers=wn(this.droppableStore,e=>(e.component.prepareHits(),new FT(e.el)))}releaseHits(){let{offsetTrackers:e}=this;for(let t in e)e[t].destroy();this.offsetTrackers={}}queryHitForOffset(e,t){let{droppableStore:n,offsetTrackers:s}=this,r=null;for(let o in n){let a=n[o].component,l=s[o];if(l&&l.isWithinClipping(e,t)){let c=l.computeLeft(),d=l.computeTop(),u=e-c,p=t-d,{origRect:m}=l,y=m.right-m.left,v=m.bottom-m.top;if(u>=0&&u<y&&p>=0&&p<v){let b=a.queryHit(u,p,y,v);b&&Wc(b.dateProfile.activeRange,b.dateSpan.range)&&(this.disablePointCheck||l.el.contains(l.el.getRootNode().elementFromPoint(u+c-window.scrollX,p+d-window.scrollY)))&&(!r||b.layer>r.layer)&&(b.componentId=o,b.context=a.context,b.rect.left+=c,b.rect.right+=c,b.rect.top+=d,b.rect.bottom+=d,r=b)}}}return r}};function Pb(i,e){return!i&&!e?!0:!!i!=!!e?!1:OC(i.dateSpan,e.dateSpan)}function lP(i,e){let t={};for(let n of e.pluginHooks.datePointTransforms)Object.assign(t,n(i,e));return Object.assign(t,UG(i,e.dateEnv)),t}function UG(i,e){return{date:e.toDate(i.range.start),dateStr:e.formatIso(i.range.start,{omitTime:i.allDay}),allDay:i.allDay}}var LT=class extends Xn{constructor(e){super(e),this.handlePointerDown=n=>{let{dragging:s}=this,r=n.origEvent.target;s.setIgnoreMove(!this.component.isValidDateDownEl(r))},this.handleDragEnd=n=>{let{component:s}=this,{pointer:r}=this.dragging;if(!r.wasTouchScroll){let{initialHit:o,finalHit:a}=this.hitDragging;if(o&&a&&Pb(o,a)){let{context:l}=s,c=Object.assign(Object.assign({},lP(o.dateSpan,l)),{dayEl:o.dayEl,jsEvent:n.origEvent,view:l.viewApi||l.calendarApi.view});l.emitter.trigger("dateClick",c)}}},this.dragging=new Ia(e.el),this.dragging.autoScroller.isEnabled=!1;let t=this.hitDragging=new Qc(this.dragging,$f(e));t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}},OT=class extends Xn{constructor(e){super(e),this.dragSelection=null,this.handlePointerDown=o=>{let{component:a,dragging:l}=this,{options:c}=a.context,d=c.selectable&&a.isValidDateDownEl(o.origEvent.target);l.setIgnoreMove(!d),l.delay=o.isTouch?BG(a):null},this.handleDragStart=o=>{this.component.context.calendarApi.unselect(o)},this.handleHitUpdate=(o,a)=>{let{context:l}=this.component,c=null,d=!1;if(o){let u=this.hitDragging.initialHit;o.componentId===u.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(u,o)||(c=HG(u,o,l.pluginHooks.dateSelectionTransformers)),(!c||!KC(c,o.dateProfile,l))&&(d=!0,c=null)}c?l.dispatch({type:"SELECT_DATES",selection:c}):a||l.dispatch({type:"UNSELECT_DATES"}),d?kf():Nf(),a||(this.dragSelection=c)},this.handlePointerUp=o=>{this.dragSelection&&(ub(this.dragSelection,o,this.component.context),this.dragSelection=null)};let{component:t}=e,{options:n}=t.context,s=this.dragging=new Ia(e.el);s.touchScrollAllowed=!1,s.minDistance=n.selectMinDistance||0,s.autoScroller.isEnabled=n.dragScroll;let r=this.hitDragging=new Qc(this.dragging,$f(e));r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}};function BG(i){let{options:e}=i.context,t=e.selectLongPressDelay;return t==null&&(t=e.longPressDelay),t}function HG(i,e,t){let n=i.dateSpan,s=e.dateSpan,r=[n.range.start,n.range.end,s.range.start,s.range.end];r.sort(pC);let o={};for(let a of t){let l=a(i,e);if(l===!1)return null;l&&Object.assign(o,l)}return o.range={start:r[0],end:r[3]},o.allDay=n.allDay,o}var Qf=class i extends Xn{constructor(e){super(e),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=o=>{let a=o.origEvent.target,{component:l,dragging:c}=this,{mirror:d}=c,{options:u}=l.context,p=l.context;this.subjectEl=o.subjectEl;let m=this.subjectSeg=As(o.subjectEl),v=(this.eventRange=m.eventRange).instance.instanceId;this.relevantEvents=Uf(p.getCurrentData().eventStore,v),c.minDistance=o.isTouch?0:u.eventDragMinDistance,c.delay=o.isTouch&&v!==l.props.eventSelection?VG(l):null,u.fixedMirrorParent?d.parentNode=u.fixedMirrorParent:d.parentNode=Ge(a,".fc"),d.revertDuration=u.dragRevertDuration;let b=l.isValidSegDownEl(a)&&!Ge(a,".fc-event-resizer");c.setIgnoreMove(!b),this.isDragging=b&&o.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=o=>{let a=this.component.context,l=this.eventRange,c=l.instance.instanceId;o.isTouch?c!==this.component.props.eventSelection&&a.dispatch({type:"SELECT_EVENT",eventInstanceId:c}):a.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(a.calendarApi.unselect(o),a.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new ye(a,l.def,l.instance),jsEvent:o.origEvent,view:a.viewApi}))},this.handleHitUpdate=(o,a)=>{if(!this.isDragging)return;let l=this.relevantEvents,c=this.hitDragging.initialHit,d=this.component.context,u=null,p=null,m=null,y=!1,v={affectedEvents:l,mutatedEvents:vt(),isEvent:!0};if(o){u=o.context;let b=u.options;d===u||b.editable&&b.droppable?(p=$G(c,o,this.eventRange.instance.range.start,u.getCurrentData().pluginHooks.eventDragMutationMassagers),p&&(m=Bf(l,u.getCurrentData().eventUiBases,p,u),v.mutatedEvents=m,pb(v,o.dateProfile,u)||(y=!0,p=null,m=null,v.mutatedEvents=vt()))):u=null}this.displayDrag(u,v),y?kf():Nf(),a||(d===u&&Pb(c,o)&&(p=null),this.dragging.setMirrorNeedsRevert(!p),this.dragging.setMirrorIsVisible(!o||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=u,this.validMutation=p,this.mutatedRelevantEvents=m)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=o=>{if(this.isDragging){let a=this.component.context,l=a.viewApi,{receivingContext:c,validMutation:d}=this,u=this.eventRange.def,p=this.eventRange.instance,m=new ye(a,u,p),y=this.relevantEvents,v=this.mutatedRelevantEvents,{finalHit:b}=this.hitDragging;if(this.clearDrag(),a.emitter.trigger("eventDragStop",{el:this.subjectEl,event:m,jsEvent:o.origEvent,view:l}),d){if(c===a){let S=new ye(a,v.defs[u.defId],p?v.instances[p.instanceId]:null);a.dispatch({type:"MERGE_EVENTS",eventStore:v});let C={oldEvent:m,event:S,relatedEvents:Ii(v,a,p),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:y})}},T={};for(let _ of a.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(T,_(d,a));a.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},C),T),{el:o.subjectEl,delta:d.datesDelta,jsEvent:o.origEvent,view:l})),a.emitter.trigger("eventChange",C)}else if(c){let S={event:m,relatedEvents:Ii(y,a,p),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:y})}};a.emitter.trigger("eventLeave",Object.assign(Object.assign({},S),{draggedEl:o.subjectEl,view:l})),a.dispatch({type:"REMOVE_EVENTS",eventStore:y}),a.emitter.trigger("eventRemove",S);let C=v.defs[u.defId],T=v.instances[p.instanceId],_=new ye(c,C,T);c.dispatch({type:"MERGE_EVENTS",eventStore:v});let R={event:_,relatedEvents:Ii(v,c,T),revert(){c.dispatch({type:"REMOVE_EVENTS",eventStore:v})}};c.emitter.trigger("eventAdd",R),o.isTouch&&c.dispatch({type:"SELECT_EVENT",eventInstanceId:p.instanceId}),c.emitter.trigger("drop",Object.assign(Object.assign({},lP(b.dateSpan,c)),{draggedEl:o.subjectEl,jsEvent:o.origEvent,view:b.context.viewApi})),c.emitter.trigger("eventReceive",Object.assign(Object.assign({},R),{draggedEl:o.subjectEl,view:b.context.viewApi}))}}else a.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:t}=this,{options:n}=t.context,s=this.dragging=new Ia(e.el);s.pointer.selector=i.SELECTOR,s.touchScrollAllowed=!1,s.autoScroller.isEnabled=n.dragScroll;let r=this.hitDragging=new Qc(this.dragging,Kc);r.useSubjectCenter=e.useEventCenter,r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("pointerup",this.handlePointerUp),r.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(e,t){let n=this.component.context,s=this.receivingContext;s&&s!==e&&(s===n?s.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:t.affectedEvents,mutatedEvents:vt(),isEvent:!0}}):s.dispatch({type:"UNSET_EVENT_DRAG"})),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){let e=this.component.context,{receivingContext:t}=this;t&&t.dispatch({type:"UNSET_EVENT_DRAG"}),e!==t&&e.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}};Qf.SELECTOR=".fc-event-draggable, .fc-event-resizable";function $G(i,e,t,n){let s=i.dateSpan,r=e.dateSpan,o=s.range.start,a=r.range.start,l={};s.allDay!==r.allDay&&(l.allDay=r.allDay,l.hasEnd=e.context.options.allDayMaintainDuration,r.allDay?o=ue(t):o=t);let c=Cr(o,a,i.context.dateEnv,i.componentId===e.componentId?i.largeUnit:null);c.milliseconds&&(l.allDay=!1);let d={datesDelta:c,standardProps:l};for(let u of n)u(d,i,e);return d}function VG(i){let{options:e}=i.context,t=e.eventLongPressDelay;return t==null&&(t=e.longPressDelay),t}var UT=class extends Xn{constructor(e){super(e),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=r=>{let{component:o}=this,a=this.querySegEl(r),l=As(a),c=this.eventRange=l.eventRange;this.dragging.minDistance=o.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(r.origEvent.target)||r.isTouch&&this.component.props.eventSelection!==c.instance.instanceId)},this.handleDragStart=r=>{let{context:o}=this.component,a=this.eventRange;this.relevantEvents=Uf(o.getCurrentData().eventStore,this.eventRange.instance.instanceId);let l=this.querySegEl(r);this.draggingSegEl=l,this.draggingSeg=As(l),o.calendarApi.unselect(),o.emitter.trigger("eventResizeStart",{el:l,event:new ye(o,a.def,a.instance),jsEvent:r.origEvent,view:o.viewApi})},this.handleHitUpdate=(r,o,a)=>{let{context:l}=this.component,c=this.relevantEvents,d=this.hitDragging.initialHit,u=this.eventRange.instance,p=null,m=null,y=!1,v={affectedEvents:c,mutatedEvents:vt(),isEvent:!0};r&&(r.componentId===d.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(d,r)||(p=GG(d,r,a.subjectEl.classList.contains("fc-event-resizer-start"),u.range))),p&&(m=Bf(c,l.getCurrentData().eventUiBases,p,l),v.mutatedEvents=m,pb(v,r.dateProfile,l)||(y=!0,p=null,m=null,v.mutatedEvents=null)),m?l.dispatch({type:"SET_EVENT_RESIZE",state:v}):l.dispatch({type:"UNSET_EVENT_RESIZE"}),y?kf():Nf(),o||(p&&Pb(d,r)&&(p=null),this.validMutation=p,this.mutatedRelevantEvents=m)},this.handleDragEnd=r=>{let{context:o}=this.component,a=this.eventRange.def,l=this.eventRange.instance,c=new ye(o,a,l),d=this.relevantEvents,u=this.mutatedRelevantEvents;if(o.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:c,jsEvent:r.origEvent,view:o.viewApi}),this.validMutation){let p=new ye(o,u.defs[a.defId],l?u.instances[l.instanceId]:null);o.dispatch({type:"MERGE_EVENTS",eventStore:u});let m={oldEvent:c,event:p,relatedEvents:Ii(u,o,l),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:d})}};o.emitter.trigger("eventResize",Object.assign(Object.assign({},m),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||ee(0),endDelta:this.validMutation.endDelta||ee(0),jsEvent:r.origEvent,view:o.viewApi})),o.emitter.trigger("eventChange",m)}else o.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:t}=e,n=this.dragging=new Ia(e.el);n.pointer.selector=".fc-event-resizer",n.touchScrollAllowed=!1,n.autoScroller.isEnabled=t.context.options.dragScroll;let s=this.hitDragging=new Qc(this.dragging,$f(e));s.emitter.on("pointerdown",this.handlePointerDown),s.emitter.on("dragstart",this.handleDragStart),s.emitter.on("hitupdate",this.handleHitUpdate),s.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(e){return Ge(e.subjectEl,".fc-event")}};function GG(i,e,t,n){let s=i.context.dateEnv,r=i.dateSpan.range.start,o=e.dateSpan.range.start,a=Cr(r,o,s,i.largeUnit);if(t){if(s.add(n.start,a)<n.end)return{startDelta:a}}else if(s.add(n.end,a)>n.start)return{endDelta:a};return null}var BT=class{constructor(e){this.context=e,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=n=>{n.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=n=>{let s=this.context.options.unselectCancel,r=Qv(n.origEvent);this.matchesCancel=!!Ge(r,s),this.matchesEvent=!!Ge(r,Qf.SELECTOR)},this.onDocumentPointerUp=n=>{let{context:s}=this,{documentPointer:r}=this,o=s.getCurrentData();if(!r.wasTouchScroll){if(o.dateSelection&&!this.isRecentPointerDateSelect){let a=s.options.unselectAuto;a&&(!a||!this.matchesCancel)&&s.calendarApi.unselect(n)}o.eventSelection&&!this.matchesEvent&&s.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let t=this.documentPointer=new Db(document);t.shouldIgnoreMove=!0,t.shouldWatchScroll=!1,t.emitter.on("pointerdown",this.onDocumentPointerDown),t.emitter.on("pointerup",this.onDocumentPointerUp),e.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}},zG={fixedMirrorParent:P},WG={dateClick:P,eventDragStart:P,eventDragStop:P,eventDrop:P,eventResizeStart:P,eventResizeStop:P,eventResize:P,drop:P,eventReceive:P,eventLeave:P};Wf.dataAttrPrefix="";var cP=$t({name:"@fullcalendar/interaction",componentInteractions:[LT,OT,Qf,UT],calendarInteractions:[BT],elementDraggingImpl:Ia,optionRefiners:zG,listenerRefiners:WG});var ep=require("obsidian");var Ma=class extends ep.Modal{constructor(t,n,s,r){super(t);this.saveCallback=null;this.event=n,this.dataProvider=s,this.settings=r}onSave(t){this.saveCallback=t}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-event-modal");let n={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"},s={note:"\uB178\uD2B8",schedule:"\uC77C\uC815",meeting:"\uD68C\uC758\uB85D"},r=t.createDiv({cls:"event-modal-header"});r.style.display="flex",r.style.alignItems="center",r.style.gap="12px",r.style.marginBottom="16px";let o=r.createEl("span",{text:`${n[this.event.type]} ${s[this.event.type]}`});o.style.padding="4px 8px",o.style.backgroundColor=this.event.color||"var(--interactive-accent)",o.style.color="var(--text-on-accent)",o.style.borderRadius="4px",o.style.fontSize="12px",r.createEl("h2",{text:this.event.title}).style.margin="0";let a=t.createDiv({cls:"event-details"});a.style.padding="16px",a.style.backgroundColor="var(--background-secondary)",a.style.borderRadius="8px",a.style.marginBottom="16px";let l=a.createDiv({cls:"detail-row"});l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginBottom="8px",l.createEl("span",{text:"\u{1F4C5}"});let c=Be(this.event.start,this.settings.timezone),d="";if(this.event.allDay)d=" (\uC885\uC77C)";else{let S=this.event.start.getHours().toString().padStart(2,"0"),C=this.event.start.getMinutes().toString().padStart(2,"0");d=` ${S}:${C}`}if(l.createEl("span",{text:c+d}),this.event.metadata?.project){let S=a.createDiv({cls:"detail-row"});S.style.display="flex",S.style.alignItems="center",S.style.gap="8px",S.style.marginBottom="8px",S.createEl("span",{text:"\u{1F4C1}"}),S.createEl("span",{text:this.event.metadata.project})}if(this.event.metadata?.tags&&this.event.metadata.tags.length>0){let S=a.createDiv({cls:"detail-row"});S.style.display="flex",S.style.alignItems="center",S.style.gap="8px",S.style.marginBottom="8px",S.createEl("span",{text:"\u{1F3F7}"});let C=S.createDiv({cls:"tags"});C.style.display="flex",C.style.gap="4px",C.style.flexWrap="wrap";for(let T of this.event.metadata.tags){let _=C.createEl("span",{text:`#${T}`});_.style.padding="2px 6px",_.style.backgroundColor="var(--background-modifier-border)",_.style.borderRadius="4px",_.style.fontSize="12px"}}if(this.event.metadata?.summary){let S=a.createDiv({cls:"detail-row"});S.style.marginTop="12px",S.style.paddingTop="12px",S.style.borderTop="1px solid var(--background-modifier-border)",S.createEl("div",{text:"\uC694\uC57D"}).style.fontWeight="500",S.createEl("p",{text:this.event.metadata.summary}).style.margin="4px 0 0 0"}let u=a.createDiv({cls:"detail-row"});u.style.marginTop="12px",u.style.fontSize="12px",u.style.color="var(--text-muted)",u.setText(`\uD30C\uC77C: ${this.event.source.path}`),this.event.source.lineNumber&&u.appendText(` (\uB77C\uC778 ${this.event.source.lineNumber})`);let p=t.createDiv({cls:"modal-button-container"});p.style.display="flex",p.style.justifyContent="space-between",p.style.marginTop="16px";let m=p.createDiv();if(this.event.type==="schedule"&&this.event.source.lineNumber){let S=m.createEl("button",{text:"\uC0AD\uC81C"});S.style.color="var(--text-error)",S.addEventListener("click",async()=>{confirm("\uC774 \uC77C\uC815\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")&&(await this.dataProvider.deleteEvent(this.event.id)?(new ep.Notice("\uC77C\uC815\uC774 \uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),this.saveCallback&&this.saveCallback(),this.close()):new ep.Notice("\uC77C\uC815 \uC0AD\uC81C\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4."))})}let y=p.createDiv();y.style.display="flex",y.style.gap="8px",y.createEl("button",{text:"\uD30C\uC77C \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",async()=>{await this.dataProvider.openEvent(this.event.id),this.close()}),y.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}};var kr="zfb-calendar",tp=class extends dP.ItemView{constructor(t,n,s){super(t);this.calendar=null;this.refreshTimeout=null;this.isRefreshing=!1;this.resizeObserver=null;this.settings=n,this.dataProvider=s,this.refreshCallback=()=>this.debouncedRefresh()}debouncedRefresh(){this.isRefreshing||(this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(async()=>{await this.refreshEvents()},1e3))}getViewType(){return kr}getDisplayText(){return"Zero Friction \uCE98\uB9B0\uB354"}getIcon(){return"calendar"}async onOpen(){this.dataProvider.addChangeListener(this.refreshCallback);let t=this.contentEl;t.empty(),t.addClass("zfb-full-calendar");let n=t.createDiv({cls:"calendar-container"});n.style.height="100%",n.style.padding="16px",this.calendar=new Jf(n,this.getCalendarOptions()),this.calendar.render(),this.resizeObserver=new ResizeObserver(()=>{this.calendar&&this.calendar.updateSize()}),this.resizeObserver.observe(t)}getCalendarOptions(){return{plugins:[JM,iP,rP,cP],initialView:this.getInitialView(),locale:"ko",firstDay:this.settings.calendarFirstDayOfWeek,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},buttonText:{today:"\uC624\uB298",month:"\uC6D4",week:"\uC8FC",day:"\uC77C",list:"\uBAA9\uB85D"},events:async(t,n)=>{let s=await this.loadEvents();n(s)},editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,moreLinkClick:t=>{let n=t.date.toISOString().split("T")[0];return new Ai(this.app,n,this.dataProvider,this.settings).open(),"none"},eventOrder:(t,n)=>{let s={schedule:0,note:1,meeting:2},r=t.extendedProps?.type||"note",o=n.extendedProps?.type||"note";return(s[r]??2)-(s[o]??2)},eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},eventClick:t=>{this.handleEventClick(t)},eventDrop:async t=>{await this.handleEventDrop(t)},select:t=>{this.handleDateSelect(t)},eventDidMount:t=>{let n=t.event,s=n.extendedProps;if(s?.project&&(t.el.title=`${n.title}
\uD504\uB85C\uC81D\uD2B8: ${s.project}`),t.el.classList.contains("fc-daygrid-dot-event")){let r=n.backgroundColor||"var(--text-success)";t.el.style.backgroundColor=r}}}}async onClose(){this.refreshTimeout&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.dataProvider.removeChangeListener(this.refreshCallback),this.calendar&&(this.calendar.destroy(),this.calendar=null),this.contentEl.empty()}updateSettings(t){this.settings=t,this.calendar&&this.calendar.setOption("firstDay",t.calendarFirstDayOfWeek)}async refreshEvents(){if(!(!this.calendar||this.isRefreshing)){this.isRefreshing=!0;try{let t=this.calendar.view.type,n=this.calendar.getDate(),s=this.contentEl.querySelector(".calendar-container");if(!s)return;this.calendar.destroy(),this.calendar=new Jf(s,this.getCalendarOptions()),this.calendar.render(),this.calendar.changeView(t,n)}finally{this.isRefreshing=!1}}}getInitialView(){switch(this.settings.calendarDefaultView){case"month":return"dayGridMonth";case"week":return"timeGridWeek";case"day":return"timeGridDay";case"list":return"listWeek";default:return"dayGridMonth"}}async loadEvents(){let t=new Date,n=new Date(t.getFullYear(),t.getMonth()-3,1),s=new Date(t.getFullYear(),t.getMonth()+3,0);return(await this.dataProvider.getEventsForRange(n,s)).map(o=>this.convertToFullCalendarEvent(o))}convertToFullCalendarEvent(t){return{id:t.id,title:t.title,start:t.start,end:t.end,allDay:t.allDay,backgroundColor:t.color,borderColor:t.color,extendedProps:{type:t.type,source:t.source,...t.metadata}}}handleEventClick(t){let n=t.event.id,s=t.event.extendedProps,r={id:n,title:t.event.title,start:t.event.start,end:t.event.end||void 0,allDay:t.event.allDay,type:s.type,color:t.event.backgroundColor||void 0,source:s.source,metadata:{project:s.project,tags:s.tags,summary:s.summary}},o=new Ma(this.app,r,this.dataProvider,this.settings);o.onSave(async()=>{await this.refreshEvents()}),o.open()}async handleEventDrop(t){let n=t.event.id,s=t.event.start;await this.dataProvider.moveEvent(n,s)||t.revert()}handleDateSelect(t){this.calendar?.unselect();let n=t.startStr.split("T")[0];new Ai(this.app,n,this.dataProvider,this.settings).open()}};var kb=require("obsidian");var qG="zfb-calendar",np=class extends kb.ItemView{constructor(t,n,s){super(t);this.currentView="month";this.currentDate=new Date;this.refreshTimeout=null;this.isRefreshing=!1;this.dragState={isDragging:!1,event:null,ghostEl:null,startX:0,startY:0,targetDate:null};this.DRAG_THRESHOLD=5;this.LONG_PRESS_DELAY=500;this.settings=n,this.dataProvider=s,this.currentView=n.calendarDefaultView,this.refreshCallback=()=>this.debouncedRefresh()}getViewType(){return qG}getDisplayText(){return"Zero Friction \uCE98\uB9B0\uB354"}getIcon(){return"calendar"}async onOpen(){this.dataProvider.addChangeListener(this.refreshCallback),await this.render()}async onClose(){this.refreshTimeout&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=null),this.dataProvider.removeChangeListener(this.refreshCallback),this.contentEl.empty()}updateSettings(t){this.settings=t}debouncedRefresh(){this.isRefreshing||(this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(async()=>{await this.render()},1e3))}async render(){if(!this.isRefreshing){this.isRefreshing=!0;try{let t=this.contentEl;t.empty(),t.addClass("zfb-native-calendar"),this.renderToolbar(t);let n=t.createDiv({cls:"zfb-native-calendar-content"});switch(this.currentView){case"month":await this.renderMonthView(n);break;case"list":await this.renderListView(n);break;case"week":await this.renderWeekView(n);break;case"day":await this.renderDayView(n);break}}finally{this.isRefreshing=!1}}}renderToolbar(t){let n=t.createDiv({cls:"zfb-native-calendar-toolbar"}),s=n.createDiv({cls:"toolbar-nav"}),r=s.createEl("button",{cls:"nav-btn"});r.innerHTML="&#9664;",r.addEventListener("click",()=>this.navigate(-1)),s.createEl("span",{cls:"toolbar-title"}).setText(this.formatTitle());let a=s.createEl("button",{cls:"nav-btn"});a.innerHTML="&#9654;",a.addEventListener("click",()=>this.navigate(1));let l=n.createDiv({cls:"toolbar-actions"});l.createEl("button",{text:"\uC624\uB298",cls:"today-btn"}).addEventListener("click",()=>this.goToToday());let d=l.createEl("select",{cls:"view-select"}),u=[{value:"month",label:"\uC6D4"},{value:"week",label:"\uC8FC"},{value:"day",label:"\uC77C"},{value:"list",label:"\uBAA9\uB85D"}];for(let p of u){let m=d.createEl("option",{value:p.value,text:p.label});p.value===this.currentView&&(m.selected=!0)}d.addEventListener("change",()=>{this.changeView(d.value)})}formatTitle(){let t=this.currentDate.getFullYear(),n=this.currentDate.getMonth()+1;switch(this.currentView){case"month":return`${t}\uB144 ${n}\uC6D4`;case"week":case"list":let{weekStart:s,weekEnd:r}=this.getWeekRange(),o=s.getMonth()+1,a=s.getDate(),l=r.getMonth()+1,c=r.getDate();return o===l?`${o}/${a} - ${c}`:`${o}/${a} - ${l}/${c}`;case"day":let d=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"],u=this.currentDate.getDate(),p=d[this.currentDate.getDay()];return`${t}\uB144 ${n}\uC6D4 ${u}\uC77C (${p})`;default:return`${t}\uB144 ${n}\uC6D4`}}navigate(t){switch(this.currentView){case"month":this.currentDate.setMonth(this.currentDate.getMonth()+t);break;case"week":case"list":this.currentDate.setDate(this.currentDate.getDate()+t*7);break;case"day":this.currentDate.setDate(this.currentDate.getDate()+t);break}this.render()}goToToday(){this.currentDate=new Date,this.render()}changeView(t){this.currentView=t,this.render()}getWeekRange(){let t=new Date(this.currentDate),n=this.settings.calendarFirstDayOfWeek,r=(t.getDay()-n+7)%7,o=new Date(t);o.setDate(t.getDate()-r),o.setHours(0,0,0,0);let a=new Date(o);return a.setDate(o.getDate()+6),a.setHours(23,59,59,999),{weekStart:o,weekEnd:a}}async renderMonthView(t){let n=t.createDiv({cls:"zfb-native-calendar-month-grid"}),s=n.createDiv({cls:"weekday-header"}),r=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"],o=this.settings.calendarFirstDayOfWeek;for(let c=0;c<7;c++){let d=(o+c)%7,u=s.createDiv({cls:"day-name"});u.setText(r[d]),d===0&&u.addClass("sunday"),d===6&&u.addClass("saturday")}let a=await this.getMonthCells(),l=n.createDiv({cls:"date-grid"});for(let c of a){let d=l.createDiv({cls:"date-cell"});d.dataset.date=c.date,c.isCurrentMonth||d.addClass("other-month"),c.isToday&&d.addClass("today"),c.isWeekend&&d.addClass("weekend");let u=d.createDiv({cls:"day-number"});u.setText(String(c.day)),u.addEventListener("click",b=>{b.stopPropagation(),this.openDayModal(c.date)});let p=d.createDiv({cls:"events-container"}),m=3,v=this.sortEventsByType(c.events).slice(0,m);for(let b of v){let S=p.createDiv({cls:"event-item"});S.style.backgroundColor=b.color||"var(--interactive-accent)";let C={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"};S.createSpan({cls:"event-icon"}).setText(C[b.type]||"\u{1F4C4}"),S.createSpan({cls:"event-title"}).setText(b.title),S.title=b.title,S.addEventListener("click",R=>{R.stopPropagation(),this.openEventModal(b)}),this.setupDragAndDrop(S,b)}if(c.events.length>m){let b=c.events.length-m,S=p.createDiv({cls:"more-events"});S.setText(`+${b} more`),S.addEventListener("click",C=>{C.stopPropagation(),this.openDayModal(c.date)})}}}async getMonthCells(){let t=this.currentDate.getFullYear(),n=this.currentDate.getMonth(),s=this.settings.calendarFirstDayOfWeek,a=(new Date(t,n,1).getDay()-s+7)%7,l=new Date(t,n,1-a),c=[],d=new Date,u=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`,p=new Date(l.getTime()+42*24*60*60*1e3),m=await this.dataProvider.getEventsForRange(l,p),y=new Map;for(let v of m){let b=this.formatDateStr(v.start);y.has(b)||y.set(b,[]),y.get(b).push(v)}for(let v=0;v<42;v++){let b=new Date(l.getTime()+v*24*60*60*1e3),S=this.formatDateStr(b),C=b.getDay();c.push({date:S,day:b.getDate(),isCurrentMonth:b.getMonth()===n,isToday:S===u,isWeekend:C===0||C===6,events:y.get(S)||[]})}return c}async renderListView(t){let n=t.createDiv({cls:"zfb-native-calendar-list"}),{weekStart:s,weekEnd:r}=this.getWeekRange(),o=await this.dataProvider.getEventsForRange(s,r),a=this.groupEventsByDate(o),l=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"],c=new Date(s);for(let d=0;d<7;d++){let u=this.formatDateStr(c),p=a.get(u)||[],m=c.getDay(),y=l[m],v=n.createDiv({cls:"list-date-group"}),b=v.createDiv({cls:"list-date-header"}),S=b.createSpan({cls:"toggle-icon"});S.setText(p.length>0?"\u25BC":"\u25B6"),b.createSpan({cls:"date-text"}).setText(`${u} (${y}\uC694\uC77C)`),p.length===0&&(b.addClass("empty"),b.createSpan({cls:"empty-label",text:"\uD56D\uBAA9 \uC5C6\uC74C"}));let T=v.createDiv({cls:"list-events"});p.length===0&&(T.style.display="none");let _=this.sortEventsByType(p);for(let R of _){let I=T.createDiv({cls:"list-event-item"}),M={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"};if(I.createSpan({cls:"event-icon",text:M[R.type]||"\u{1F4C4}"}),R.type==="schedule"&&!R.allDay){let N=R.start.getHours().toString().padStart(2,"0"),F=R.start.getMinutes().toString().padStart(2,"0");I.createSpan({cls:"event-time",text:`${N}:${F}`})}I.createSpan({cls:"event-title",text:R.title}),R.metadata?.project&&I.createSpan({cls:"event-project",text:`[${R.metadata.project}]`});let k=I.createDiv({cls:"event-indicator"});k.style.backgroundColor=R.color||"var(--interactive-accent)",I.addEventListener("click",async()=>{await this.dataProvider.openEvent(R.id)})}b.addEventListener("click",()=>{let R=T.style.display==="none";T.style.display=R?"block":"none",S.setText(R?"\u25BC":"\u25B6")}),c.setDate(c.getDate()+1)}}async renderWeekView(t){let n=t.createDiv({cls:"zfb-native-calendar-week-grid"}),{weekStart:s,weekEnd:r}=this.getWeekRange(),o=await this.dataProvider.getEventsForRange(s,r),a=o.filter(v=>v.allDay),l=o.filter(v=>!v.allDay),c=this.groupEventsByDate(l),d=n.createDiv({cls:"week-header-row"});d.createDiv({cls:"time-column-header"});let u=["\uC77C","\uC6D4","\uD654","\uC218","\uBAA9","\uAE08","\uD1A0"],p=this.formatDateStr(new Date),m=new Date(s);for(let v=0;v<7;v++){let b=this.formatDateStr(m),S=d.createDiv({cls:"day-header"});b===p&&S.addClass("today"),S.createDiv({cls:"day-name",text:u[m.getDay()]}),S.createDiv({cls:"day-number",text:String(m.getDate())}),m.setDate(m.getDate()+1)}if(a.length>0){let v=n.createDiv({cls:"zfb-native-calendar-all-day-row"});v.createDiv({cls:"all-day-label",text:"\uC885\uC77C"}),m.setTime(s.getTime());for(let b=0;b<7;b++){let S=this.formatDateStr(m),C=a.filter(_=>this.formatDateStr(_.start)===S),T=v.createDiv({cls:"all-day-cell"});for(let _ of C){let R=T.createDiv({cls:"all-day-event"});R.style.backgroundColor=_.color||"var(--interactive-accent)",R.setText(_.title),R.title=_.title,R.addEventListener("click",()=>this.openEventModal(_))}m.setDate(m.getDate()+1)}}let y=n.createDiv({cls:"time-grid"});for(let v=0;v<24;v++){let b=y.createDiv({cls:"hour-row"});b.createDiv({cls:"time-label",text:`${v.toString().padStart(2,"0")}:00`}),m.setTime(s.getTime());for(let S=0;S<7;S++){let C=this.formatDateStr(m),T=b.createDiv({cls:"zfb-native-calendar-time-slot"});T.dataset.date=C,T.dataset.hour=String(v);let R=(c.get(C)||[]).filter(I=>I.start.getHours()===v);for(let I of R)this.renderTimedEvent(T,I);m.setDate(m.getDate()+1)}}}async renderDayView(t){let n=t.createDiv({cls:"zfb-native-calendar-day-grid"}),s=this.formatDateStr(this.currentDate),r=new Date(this.currentDate);r.setHours(0,0,0,0);let o=new Date(this.currentDate);o.setHours(23,59,59,999);let a=await this.dataProvider.getEventsForRange(r,o),l=a.filter(u=>u.allDay),c=a.filter(u=>!u.allDay);if(l.length>0){let u=n.createDiv({cls:"zfb-native-calendar-all-day-row"});u.createDiv({cls:"all-day-label",text:"\uC885\uC77C"});let p=u.createDiv({cls:"all-day-content"});for(let m of l){let y=p.createDiv({cls:"all-day-event"});y.style.backgroundColor=m.color||"var(--interactive-accent)",y.setText(m.title),y.addEventListener("click",()=>this.openEventModal(m))}}let d=n.createDiv({cls:"time-grid day-view"});for(let u=0;u<24;u++){let p=d.createDiv({cls:"hour-row"});p.createDiv({cls:"time-label",text:`${u.toString().padStart(2,"0")}:00`});let m=p.createDiv({cls:"zfb-native-calendar-time-slot"});m.dataset.date=s,m.dataset.hour=String(u);let y=c.filter(v=>v.start.getHours()===u);for(let v of y)this.renderTimedEvent(m,v)}}renderTimedEvent(t,n){let s=t.createDiv({cls:"timed-event"}),o=n.start.getMinutes()/60*48;s.style.top=`${o}px`;let d=((n.end||new Date(n.start.getTime()+60*60*1e3)).getTime()-n.start.getTime())/(60*60*1e3)*48;s.style.height=`${Math.max(d,24)}px`,s.style.backgroundColor=n.color||"var(--interactive-accent)";let u={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"};s.createSpan({cls:"event-icon",text:u[n.type]||"\u{1F4C4}"}),s.createSpan({cls:"event-title",text:n.title}),s.title=n.title;let p=n.start.getHours().toString().padStart(2,"0"),m=n.start.getMinutes().toString().padStart(2,"0");return s.createDiv({cls:"event-time",text:`${p}:${m}`}),s.addEventListener("click",y=>{y.stopPropagation(),this.openEventModal(n)}),this.setupDragAndDrop(s,n),s}setupDragAndDrop(t,n){let s=null,r=!1,o=(c,d)=>{this.dragState.startX=c,this.dragState.startY=d,this.dragState.event=n,r=!1},a=(c,d)=>{if(!this.dragState.event)return;let u=Math.abs(c-this.dragState.startX),p=Math.abs(d-this.dragState.startY);!r&&(u>this.DRAG_THRESHOLD||p>this.DRAG_THRESHOLD)&&(r=!0,this.dragState.isDragging=!0,this.createGhostElement(n,c,d),t.addClass("zfb-native-calendar-event--dragging")),this.dragState.isDragging&&this.dragState.ghostEl&&(this.dragState.ghostEl.style.left=`${c+10}px`,this.dragState.ghostEl.style.top=`${d+10}px`,this.updateDropTarget(c,d))},l=async()=>{s&&(clearTimeout(s),s=null),this.dragState.isDragging&&this.dragState.targetDate&&await this.dataProvider.moveEvent(this.dragState.event.id,new Date(this.dragState.targetDate))&&(new kb.Notice("\uC774\uBCA4\uD2B8\uAC00 \uC774\uB3D9\uB418\uC5C8\uC2B5\uB2C8\uB2E4"),await this.render()),this.cleanupDrag(t)};t.addEventListener("mousedown",c=>{if(c.button!==0)return;c.preventDefault(),o(c.clientX,c.clientY);let d=p=>a(p.clientX,p.clientY),u=async()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",u),await l()};document.addEventListener("mousemove",d),document.addEventListener("mouseup",u)}),t.addEventListener("touchstart",c=>{let d=c.touches[0];o(d.clientX,d.clientY),s=setTimeout(()=>{r=!0,this.dragState.isDragging=!0,this.createGhostElement(n,d.clientX,d.clientY),t.addClass("zfb-native-calendar-event--dragging")},this.LONG_PRESS_DELAY)},{passive:!0}),t.addEventListener("touchmove",c=>{let d=c.touches[0];a(d.clientX,d.clientY),this.dragState.isDragging&&c.preventDefault()},{passive:!1}),t.addEventListener("touchend",async()=>{await l()}),t.addEventListener("touchcancel",()=>{this.cleanupDrag(t)})}createGhostElement(t,n,s){let r=document.createElement("div");r.addClass("zfb-native-calendar-ghost"),r.style.position="fixed",r.style.left=`${n+10}px`,r.style.top=`${s+10}px`,r.style.zIndex="1000",r.style.pointerEvents="none",r.style.backgroundColor=t.color||"var(--interactive-accent)";let o={note:"\u{1F4DD}",schedule:"\u23F0",meeting:"\u{1F399}"};r.innerHTML=`<span class="event-icon">${o[t.type]||"\u{1F4C4}"}</span><span class="event-title">${t.title}</span>`,document.body.appendChild(r),this.dragState.ghostEl=r}updateDropTarget(t,n){document.querySelectorAll(".zfb-native-calendar-cell--drop-target").forEach(o=>{o.removeClass("zfb-native-calendar-cell--drop-target")});let r=document.elementFromPoint(t,n)?.closest(".zfb-native-calendar-cell");r?.dataset.date?(r.addClass("zfb-native-calendar-cell--drop-target"),this.dragState.targetDate=r.dataset.date):this.dragState.targetDate=null}cleanupDrag(t){this.dragState.ghostEl&&this.dragState.ghostEl.remove(),document.querySelectorAll(".zfb-native-calendar-cell--drop-target").forEach(n=>{n.removeClass("zfb-native-calendar-cell--drop-target")}),t.removeClass("zfb-native-calendar-event--dragging"),this.dragState={isDragging:!1,event:null,ghostEl:null,startX:0,startY:0,targetDate:null}}formatDateStr(t){let n=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${n}-${s}-${r}`}groupEventsByDate(t){let n=new Map;for(let s of t){let r=this.formatDateStr(s.start);n.has(r)||n.set(r,[]),n.get(r).push(s)}return n}sortEventsByType(t){let n={schedule:0,note:1,meeting:2};return[...t].sort((s,r)=>{let o=n[s.type]??2,a=n[r.type]??2;return o!==a?o-a:s.start.getTime()-r.start.getTime()})}openDayModal(t){new Ai(this.app,t,this.dataProvider,this.settings).open()}openEventModal(t){let n=new Ma(this.app,t,this.dataProvider,this.settings);n.onSave(async()=>await this.render()),n.open()}};function Tn(i,e=100){return i.replace(/[\\/:*?"<>|?#\[\]]/g,"_").replace(/\s+/g," ").trim().slice(0,e)}var Nb=class extends D.Plugin{constructor(){super(...arguments);this.gemini=null;this.ocrProcessor=null;this.relatedNoteFinder=null;this.mocManager=null;this.zkIndexManager=null;this.youtubeExtractor=null;this.webPageExtractor=null;this.reviewManager=null;this.meetingProcessor=null;this.scheduleManager=null;this.googleCalendar=null;this.calendarDataProvider=null;this.feedbackManager=null;this.embeddingManager=null;this.ragEngine=null;this.chatStorage=null;this.usageTracker=null;this.usageStatusBarEl=null;this.watcherRegistered=!1;this.pendingFiles=new Map;this.zkDailyCounter=new Map;this.zkLuhmannCounter=0;this.pendingEmbeddings=new Map;this.chatbotViewRegistered=!1}async onload(){await this.loadSettings(),this.addSettingTab(new hp(this.app,this)),this.processDebounced=(0,D.debounce)(()=>this.processPendingFiles(),3e3,!0),this.feedbackManager=new _v(this.app,this.settings),await this.feedbackManager.load(),this.settings.usageTrackingEnabled&&await this.initUsageTracker(),this.calendarDataProvider=new uf(this.app,this.settings),this.registerCalendarViews(),this.registerCommands(),this.settings.autoWatch&&this.startWatcher(),this.app.workspace.onLayoutReady(async()=>{this.settings.onboardingCompleted?await this.initGemini():new xv(this.app,this.settings,async t=>{this.settings=t,await this.saveSettings(),await this.initGemini(),new D.Notice("\u{1F389} Zero Friction Brain \uC124\uC815 \uC644\uB8CC!")}).open()}),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uB85C\uB4DC\uB428")}async onunload(){this.stopWatcher(),this.usageTracker&&await this.usageTracker.saveUsage(),console.log("Zero Friction Brain \uD50C\uB7EC\uADF8\uC778 \uC5B8\uB85C\uB4DC\uB428")}async loadSettings(){this.settings=Object.assign({},Nr,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.initGemini()}async initGemini(){this.settings.geminiApiKey?(this.gemini=new eg(this.settings.geminiApiKey),this.usageTracker&&this.gemini.setUsageTracker(this.usageTracker),this.ocrProcessor=new av(this.gemini,this.settings,this.app.vault),this.relatedNoteFinder=new lv(this.app,this.gemini,this.settings),this.embeddingManager=new cv(this.app,this.gemini,this.settings),await this.embeddingManager.loadIndex(),this.relatedNoteFinder.setEmbeddingManager(this.embeddingManager),this.chatStorage=new uv(this.app,this.settings),await this.chatStorage.loadSessions(),this.ragEngine=new dv(this.app,this.gemini,this.embeddingManager,this.settings),this.chatbotViewRegistered||(this.registerView(kc,t=>new af(t,this.settings,this.ragEngine,this.chatStorage)),this.chatbotViewRegistered=!0),this.mocManager=new hv(this.app,this.gemini,this.settings.projectsFolder,this.settings),this.zkIndexManager=new fv(this.app,this.relatedNoteFinder,this.settings.zettelFolder,this.settings,this.gemini),this.youtubeExtractor=new bv(this.gemini,this.settings),this.webPageExtractor=new Ev(this.gemini,this.settings),this.reviewManager=new pv(this.app,this.gemini,this.settings),this.meetingProcessor=new gv(this.app,this.gemini,this.settings),this.scheduleManager=new mv(this.app,this.settings),this.googleCalendar=new cf(this.app,this.settings,()=>this.saveSettings()),Promise.all([this.relatedNoteFinder.buildIndex(),this.mocManager.scanProjectMOCs()]).then(()=>{console.log(`\uB178\uD2B8 \uC778\uB371\uC2A4: ${this.relatedNoteFinder?.getIndexSize()}\uAC1C, MOC: ${this.mocManager?.getMOCCount()}\uAC1C, ZK: ${this.relatedNoteFinder?.getZettelCount()}\uAC1C`),this.initializeZKCounters()})):(this.gemini=null,this.ocrProcessor=null,this.relatedNoteFinder=null,this.embeddingManager=null,this.ragEngine=null,this.chatStorage=null,this.mocManager=null,this.youtubeExtractor=null,this.webPageExtractor=null,this.reviewManager=null,this.scheduleManager=null,this.googleCalendar=null)}checkApiKey(){return this.gemini?!0:(new D.Notice("Gemini API \uD0A4\uB97C \uC124\uC815\uD574\uC8FC\uC138\uC694"),!1)}truncateContent(t,n=5e5){let s=t.replace(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g,"[\uC774\uBBF8\uC9C0]");return s=s.replace(/!\[[^\]]*\]\(data:[^)]+\)/g,"[\uC774\uBBF8\uC9C0]"),s.length<=n?s:s.slice(0,n)+`

[... \uB0B4\uC6A9\uC774 \uB108\uBB34 \uAE38\uC5B4 \uC77C\uBD80\uB9CC \uBD84\uC11D\uB428 ...]`}extractEmbeddedImages(t){let n=["png","jpg","jpeg","webp","gif"],s=[],r=new Set,o=/!\[\[([^\]]+)\]\]/g,a;for(;(a=o.exec(t))!==null;){let c=a[1].split("|")[0].trim(),d=c.split(".").pop()?.toLowerCase();if(d&&n.includes(d)){let u=this.app.metadataCache.getFirstLinkpathDest(c,"");u&&u instanceof D.TFile&&!r.has(u.path)&&(s.push(u),r.add(u.path))}}let l=/!\[[^\]]*\]\(([^)]+)\)/g;for(;(a=l.exec(t))!==null;){let c=a[1].trim();if(c.startsWith("http")||c.startsWith("data:"))continue;let d=c.split(".").pop()?.toLowerCase();if(d&&n.includes(d)){let u=this.app.vault.getAbstractFileByPath(c);u&&u instanceof D.TFile&&!r.has(u.path)&&(s.push(u),r.add(u.path))}}return s}registerCommands(){this.addCommand({id:"project-classify",name:`${ke}\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"g"}],callback:()=>this.classifyCurrentFile()}),this.addCommand({id:"zk-extract",name:`${ke}ZK \uCD94\uCD9C`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"z"}],callback:()=>this.extractZKFromCurrentFile()}),this.addCommand({id:"focus-top3",name:`${ke}Focus Top 3`,hotkeys:[{modifiers:["Ctrl","Shift"],key:";"}],callback:()=>this.showFocusTop3()}),this.addCommand({id:"process-inbox",name:`${ke}Inbox \uC804\uCCB4 \uCC98\uB9AC`,callback:()=>this.processInbox()}),this.addCommand({id:"toggle-watch",name:`${ke}Watch \uD1A0\uAE00`,callback:()=>this.toggleWatch()}),this.addCommand({id:"ocr-extract",name:`${ke}OCR \uCD94\uCD9C`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"o"}],callback:()=>this.ocrCurrentFile()}),this.addCommand({id:"ocr-inbox",name:`${ke}Inbox OCR \uCC98\uB9AC`,callback:()=>this.processInboxOCR()}),this.addCommand({id:"smart-process",name:`${ke}\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"s"}],callback:()=>this.smartProcessCurrentFile()}),this.addCommand({id:"create-moc",name:`${ke}\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131`,callback:()=>this.showCreateMOCModal()}),this.addCommand({id:"url-import",name:`${ke}URL \uAC00\uC838\uC624\uAE30`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"u"}],callback:()=>this.showURLImportModal()}),this.addCommand({id:"rebuild-zk-index",name:`${ke}ZK Index \uC7AC\uAD6C\uCD95`,callback:()=>this.rebuildZKIndex()}),this.addCommand({id:"smart-split",name:`${ke}\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"d"}],callback:()=>this.smartSplitCurrentFile()}),this.addCommand({id:"link-related-notes",name:`${ke}\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"l"}],callback:()=>this.linkRelatedNotesForCurrentFile()}),this.addCommand({id:"review-mode",name:`${ke}\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"r"}],callback:()=>this.showReviewModal()}),this.addCommand({id:"show-command-list",name:`${ke}\uBA85\uB839 \uB9AC\uC2A4\uD2B8`,callback:()=>this.showCommandListModal()}),this.addCommand({id:"open-calendar",name:`${ke}\uCE98\uB9B0\uB354 \uBDF0`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"c"}],callback:()=>this.openCalendarView()}),this.addCommand({id:"toggle-chatbot",name:`${ke}AI \uCC57\uBD07`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"'"}],callback:()=>this.toggleChatbot()}),this.addCommand({id:"image-batch-ocr",name:`${ke}\uC774\uBBF8\uC9C0 \uD1B5\uD569 \uCC98\uB9AC`,callback:()=>this.showImageBatchModal()}),this.addCommand({id:"smart-search",name:`${ke}\uC2A4\uB9C8\uD2B8 \uAC80\uC0C9`,hotkeys:[{modifiers:["Ctrl","Shift"],key:"f"}],callback:()=>this.showSmartSearchModal()}),this.addRibbonIcon("brain","Zero Friction Brain",()=>{this.showCommandListModal()}),this.settings.calendarEnabled&&this.addRibbonIcon("calendar","\uCE98\uB9B0\uB354 \uBDF0",()=>{this.openCalendarView()}),this.settings.ragEnabled&&this.settings.embeddingEnabled&&this.addRibbonIcon("bot","AI \uCC57\uBD07",()=>{this.toggleChatbot()})}registerCalendarViews(){this.settings.calendarEngine==="native"?this.registerView(kr,t=>new np(t,this.settings,this.calendarDataProvider)):this.registerView(kr,t=>new tp(t,this.settings,this.calendarDataProvider)),this.registerView(Oc,t=>new hf(t,this.settings,this.calendarDataProvider))}async restartCalendarView(){this.app.workspace.detachLeavesOfType(kr),await this.openCalendarView()}async toggleChatbot(){let t=this.app.workspace.getLeavesOfType(kc);if(t.length>0)t[0].detach();else{let n=this.app.workspace.getRightLeaf(!1);n&&await n.setViewState({type:kc,active:!0})}}async openCalendarView(){let t=this.app.workspace.getLeavesOfType(kr);t.length>0?this.app.workspace.revealLeaf(t[0]):await this.app.workspace.getLeaf("tab").setViewState({type:kr,active:!0})}async toggleMiniCalendar(){let t=this.app.workspace.getLeavesOfType(Oc);if(t.length>0)t[0].detach();else{let n=this.app.workspace.getRightLeaf(!1);n&&await n.setViewState({type:Oc,active:!0})}}showReviewModal(){if(this.checkApiKey()){if(!this.reviewManager){new D.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new JT(this.app,this.reviewManager,this.settings).open()}}async connectGoogleCalendar(){this.googleCalendar||(this.googleCalendar=new cf(this.app,this.settings,()=>this.saveSettings())),await this.googleCalendar.startOAuth()}async disconnectGoogleCalendar(){this.googleCalendar&&await this.googleCalendar.disconnect()}async detectAndSaveSchedules(t,n){if(this.settings.scheduleDetectionEnabled&&!(!this.gemini||!this.scheduleManager))try{let s=Qn(this.settings.timezone),r=await this.gemini.detectSchedules(t,s);if(r.length===0)return;n&&r.forEach(u=>u.sourceNote=n.basename);let a=await new Sv(this.app,r,this.settings,u=>{this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"schedule_detection",noteTitle:n?.basename||"Unknown",aiSuggestion:{schedules:u.allSchedules},userChoice:{accepted:u.accepted,rejectedItems:u.rejectedSchedules?.map(p=>p.title),dismissed:u.dismissed}})}).openAndWait();if(!a||a.selectedSchedules.length===0)return;let l=0,c=0;if(a.saveToDaily&&(l=await this.scheduleManager.saveToDaily(a.selectedSchedules)),a.saveToGoogle&&this.googleCalendar&&this.googleCalendar.isConnected()&&(c=await this.googleCalendar.saveSchedules(a.selectedSchedules)),a.moveToArchives&&n){let u=`${this.settings.archivesFolder}/${n.name}`;await this.app.fileManager.renameFile(n,u),new D.Notice("\uC6D0\uBCF8 \uB178\uD2B8\uAC00 Archives\uB85C \uC774\uB3D9\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}let d=[];l>0&&d.push(`Daily Notes: ${l}\uAC1C`),c>0&&d.push(`Google Calendar: ${c}\uAC1C`),d.length>0&&new D.Notice(`\uC77C\uC815 \uC800\uC7A5\uB428
${d.join(", ")}`)}catch(s){console.error("\uC77C\uC815 \uAC10\uC9C0 \uC2E4\uD328:",s)}}async rebuildZKIndex(){if(!this.zkIndexManager){new D.Notice("API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}new D.Notice("ZK Index \uC7AC\uAD6C\uCD95 \uC911...");try{await this.zkIndexManager.rebuildIndex();let t=this.relatedNoteFinder?.getZettelCount()||0;new D.Notice(`ZK Index \uC7AC\uAD6C\uCD95 \uC644\uB8CC: ${t}\uAC1C \uB178\uD2B8`)}catch(t){console.error("ZK Index \uC7AC\uAD6C\uCD95 \uC2E4\uD328:",t),new D.Notice(`\uC7AC\uAD6C\uCD95 \uC2E4\uD328: ${t}`)}}async smartSplitCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new D.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(t.extension!=="md"){new D.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uBD84\uB9AC\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4");return}new D.Notice("\uBA54\uBAA8 \uBD84\uC11D \uC911...");try{let n=await this.app.vault.read(t),s=this.mocManager?.getProjectList()||[],r=await this.gemini.splitContent(n,s);if(r.length===0){new D.Notice("\uBD84\uB9AC\uD560 \uB0B4\uC6A9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(r.length===1){new D.Notice("\uB2E8\uC77C \uC8FC\uC81C\uB85C \uD310\uB2E8\uB428. \uC77C\uBC18 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958\uB97C \uC0AC\uC6A9\uD558\uC138\uC694.");return}new YT(this.app,r,t,this).open()}catch(n){console.error("\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uC2E4\uD328:",n),new D.Notice(`\uBD84\uB9AC \uC2E4\uD328: ${n}`)}}async createSplitNotes(t,n){let s=[];for(let o of t){let a=this.getTargetFolder(o.targetType,o.project);if(o.project&&!o.project.startsWith("NEW:")){let p=`${this.settings.projectsFolder}/${o.project}`;this.app.vault.getAbstractFileByPath(p)instanceof D.TFolder&&(a=p)}let l=Tn(o.title),c=`${a}/${l}.md`,d=`---
targetType: ${o.targetType}
keywords: [${o.keywords.join(", ")}]
source: "[[${n.basename}]]"
created: ${Pe(this.settings.timezone,this.settings.dateFormat)}
${o.project?`project: "${o.project}"`:""}
---

# ${o.title}

${o.content}
`;this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a);try{let p=await this.app.vault.create(c,d);if(s.push(o.title),this.relatedNoteFinder&&await this.relatedNoteFinder.updateIndex(p),o.project&&this.mocManager)if(o.project.startsWith("NEW:")){let m=o.project.slice(4).trim();await this.mocManager.createProjectMOC(m,this.settings.projectsFolder)&&await this.mocManager.addNoteToMOC(m,o.title,p.path)}else await this.mocManager.addNoteToMOC(o.project,o.title,p.path)}catch(p){console.error(`\uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328: ${o.title}`,p)}}let r=`${this.settings.archivesFolder}/${n.name}`;try{this.app.vault.getAbstractFileByPath(this.settings.archivesFolder)||await this.app.vault.createFolder(this.settings.archivesFolder),await this.app.fileManager.renameFile(n,r)}catch(o){console.error("\uC6D0\uBCF8 \uD30C\uC77C \uC774\uB3D9 \uC2E4\uD328:",o)}new D.Notice(`${s.length}\uAC1C \uB178\uD2B8 \uC0DD\uC131\uB428, \uC6D0\uBCF8\uC740 Archives\uB85C \uC774\uB3D9`)}showCreateMOCModal(){new WT(this.app,this.mocManager,this.settings.projectsFolder).open()}showURLImportModal(){this.checkApiKey()&&new qT(this.app,"URL \uAC00\uC838\uC624\uAE30","\uC720\uD29C\uBE0C \uB610\uB294 \uC6F9\uD398\uC774\uC9C0 URL\uC744 \uC785\uB825\uD558\uC138\uC694 (\uC790\uB3D9 \uAC10\uC9C0)","https://...",async t=>{await this.processURL(t)}).open()}async processURL(t){/(?:youtube\.com|youtu\.be)/.test(t)?await this.processYouTube(t):await this.processWebPage(t)}async processYouTube(t){if(!(!this.youtubeExtractor||!this.gemini)){new D.Notice("\uC720\uD29C\uBE0C \uC601\uC0C1 \uBD84\uC11D \uC911...");try{let n=await this.youtubeExtractor.processVideo(t),s=this.youtubeExtractor.generateMarkdownNote(n),r=Tn(n.title),o=`${r}.md`,a=`${this.settings.inboxFolder}/${o}`,l=await this.app.vault.create(a,s);new D.Notice(`\uC720\uD29C\uBE0C \uB178\uD2B8 \uC0DD\uC131: ${r}`);let c=this.mocManager?.getProjectList()||[],d=this.feedbackManager?.generatePromptContext(),u=await this.gemini.classifyProject(s,c,d);l=await this.applyClassifyResultWithConfirmation(l,u),this.showFileCreatedNotice(l,"\u{1F3AC}"),this.app.workspace.getLeaf().openFile(l),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(l,s,u.title)}catch(n){console.error("\uC720\uD29C\uBE0C \uCC98\uB9AC \uC624\uB958:",n),new D.Notice(`\uC720\uD29C\uBE0C \uCC98\uB9AC \uC2E4\uD328: ${n}`)}}}async processWebPage(t){if(!(!this.webPageExtractor||!this.gemini)){new D.Notice("\uC6F9\uD398\uC774\uC9C0 \uBCF8\uBB38 \uCD94\uCD9C \uC911...");try{let n=await this.webPageExtractor.processUrl(t),s=this.webPageExtractor.generateMarkdownNote(n),r=Tn(n.title),o=`${r}.md`,a=`${this.settings.inboxFolder}/${o}`,l=await this.app.vault.create(a,s);new D.Notice(`\uC6F9\uD398\uC774\uC9C0 \uB178\uD2B8 \uC0DD\uC131: ${r}`);let c=this.mocManager?.getProjectList()||[],d=this.feedbackManager?.generatePromptContext(),u=await this.gemini.classifyProject(s,c,d);l=await this.applyClassifyResultWithConfirmation(l,u),this.showFileCreatedNotice(l,"\u{1F310}"),this.app.workspace.getLeaf().openFile(l),this.relatedNoteFinder&&await this.findAndShowRelatedNotes(l,s,u.title)}catch(n){console.error("\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC624\uB958:",n),new D.Notice(`\uC6F9\uD398\uC774\uC9C0 \uCC98\uB9AC \uC2E4\uD328: ${n}`)}}}async classifyCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new D.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase(),s=["pdf","png","jpg","jpeg","webp","gif"];if(PA.includes(n)){if(!this.meetingProcessor){new D.Notice("\uD68C\uC758\uB85D \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}new D.Notice("\uD68C\uC758\uB85D \uBD84\uC11D \uC911...");try{let r=await this.meetingProcessor.processAudio(t),o=this.meetingProcessor.generateMarkdownNote(r),a=`\uD68C\uC758\uB85D_${Tn(r.title)}.md`,l=`${this.settings.inboxFolder}/${a}`,c=await this.app.vault.create(l,o);if(this.settings.ocrMoveOriginal){let y=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(y)||await this.app.vault.createFolder(y);let b=`${y}/${t.name}`;await this.app.fileManager.renameFile(t,b)}let d=this.mocManager?.getProjectList()||[],u=this.feedbackManager?.generatePromptContext(),p=await this.gemini.classifyProject(o,d,u),m=await this.applyClassifyResultWithConfirmation(c,p);this.showFileCreatedNotice(m,"\u{1F399}\uFE0F"),await this.findAndShowRelatedNotes(m,o,r.title),await this.detectAndSaveSchedules(o,m)}catch(r){console.error("\uD68C\uC758\uB85D \uBD84\uC11D \uC624\uB958:",r),new D.Notice(`\uD68C\uC758\uB85D \uBD84\uC11D \uC2E4\uD328: ${r}`)}return}if(s.includes(n)){if(!this.settings.ocrEnabled){new D.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new D.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let r=await this.ocrProcessor.checkLimits(t);if(!r.allowed){new ip(this.app,r.reason,t,this).open();return}new D.Notice("\uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let o=await this.ocrProcessor.processFile(t);new D.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let a=await this.gemini.summarizePDF(o.text,this.settings.detailedSummary),l=this.ocrProcessor.generateSummarizedNote(o,a),c=t.basename+"_OCR.md",d=`${this.settings.inboxFolder}/${c}`,u=await this.app.vault.create(d,l);if(this.settings.ocrMoveOriginal){let b=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(b)||await this.app.vault.createFolder(b);let C=`${b}/${t.name}`;await this.app.fileManager.renameFile(t,C)}let p=this.mocManager?.getProjectList()||[],m=this.feedbackManager?.generatePromptContext(),y=await this.gemini.classifyProject(l,p,m),v=await this.applyClassifyResultWithConfirmation(u,y);if(y.title&&v){let b=Tn(y.title),S=v.parent?.path||"",C=S?`${S}/${b}.md`:`${b}.md`;C!==v.path&&await this.app.fileManager.renameFile(v,C)}new D.Notice(`\uC644\uB8CC: OCR(${o.pages}p) \u2192 ${y.targetType}${y.projectName?` (${y.projectName})`:""}`),await this.findAndShowRelatedNotes(v,l,y.title),await this.detectAndSaveSchedules(l,v)}catch(o){console.error("\uCC98\uB9AC \uC624\uB958:",o),new D.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${o}`)}return}if(n==="md"){try{let r=await this.app.vault.read(t),o=this.extractEmbeddedImages(r);if(o.length>0&&this.settings.ocrEnabled&&this.ocrProcessor){new D.Notice(`\uC784\uBCA0\uB4DC\uB41C \uC774\uBBF8\uC9C0 ${o.length}\uC7A5 \uAC10\uC9C0\uB428. OCR \uCC98\uB9AC \uC911...`);let a=this.ocrProcessor.checkLimitsForMultipleImages(o);if(!a.allowed){new D.Notice(`OCR \uC81C\uD55C: ${a.reason}`),await this.classifyMarkdownContent(t,r);return}let l=await this.ocrProcessor.processMultipleImages(o,t.basename);new D.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let c=await this.gemini.summarizePDF(l.text,this.settings.detailedSummary),d=`---
type: ocr
source_note: "${t.basename}"
pages: ${l.pages}
---

# ${c.title}

## \uC694\uC57D
${c.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${c.keyPoints.map(v=>`- ${v}`).join(`
`)}

---
## \uC6D0\uBCF8 \uC774\uBBF8\uC9C0
${o.map(v=>`![[${v.name}]]`).join(`
`)}
`;await this.app.vault.modify(t,d);let u=this.mocManager?.getProjectList()||[],p=this.feedbackManager?.generatePromptContext(),m=await this.gemini.classifyProject(d,u,p),y=await this.applyClassifyResultWithConfirmation(t,m);if(c.title&&y){let v=Tn(c.title),b=y.parent?.path||"",S=b?`${b}/${v}.md`:`${v}.md`;S!==y.path&&(await this.app.fileManager.renameFile(y,S),y=this.app.vault.getAbstractFileByPath(S))}new D.Notice(`\uC644\uB8CC: OCR(${l.pages}\uC7A5) \u2192 ${m.targetType}${m.projectName?` (${m.projectName})`:""}`),await this.findAndShowRelatedNotes(y,d,c.title),await this.detectAndSaveSchedules(d,y);return}await this.classifyMarkdownContent(t,r)}catch(r){console.error("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC624\uB958:",r),new D.Notice(`\uBD84\uB958 \uC2E4\uD328: ${r}`)}return}new D.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}async classifyMarkdownContent(t,n){new D.Notice("\uBD84\uB958 \uC911...");let s=this.truncateContent(n),r=this.mocManager?.getProjectList()||[],o=this.feedbackManager?.generatePromptContext(),a=await this.gemini.classifyProject(s,r,o),l=await this.applyClassifyResultWithConfirmation(t,a);if(["\uBB34\uC81C","untitled","\uC0C8 \uB178\uD2B8","new note"].some(u=>l.basename.toLowerCase().startsWith(u.toLowerCase()))&&a.title&&l){let u=Tn(a.title),p=l.parent?.path||"",m=p?`${p}/${u}.md`:`${u}.md`;m!==l.path&&(await this.app.fileManager.renameFile(l,m),l=this.app.vault.getAbstractFileByPath(m))}new D.Notice(`${a.targetType}${a.projectName?` (${a.projectName})`:""}\uB85C \uBD84\uB958\uB428`),await this.findAndShowRelatedNotes(l,n,a.title),await this.detectAndSaveSchedules(n,l)}async linkRelatedNotesForCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new D.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}if(t.extension!=="md"){new D.Notice("\uB9C8\uD06C\uB2E4\uC6B4 \uD30C\uC77C\uB9CC \uC9C0\uC6D0\uD569\uB2C8\uB2E4");return}new D.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");try{let n=await this.app.vault.read(t),s=this.truncateContent(n),o=n.match(/^#\s+(.+)$/m)?.[1]||t.basename;await this.findAndShowRelatedNotes(t,s,o)}catch(n){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",n),new D.Notice(`\uAC80\uC0C9 \uC2E4\uD328: ${n}`)}}showCommandListModal(){new XT(this.app,this).open()}showFileCreatedNotice(t,n="\u2705"){let s=new D.Notice("",3e3);s.noticeEl.empty(),s.noticeEl.style.cursor="pointer";let r=s.noticeEl.createDiv();r.style.display="flex",r.style.flexDirection="column",r.style.gap="2px";let o=r.createEl("span",{text:`${n} ${t.basename}`});o.style.fontWeight="500";let a=r.createEl("span",{text:`\u{1F4C1} ${t.parent?.path||"/"}`});a.style.fontSize="11px",a.style.opacity="0.7",s.noticeEl.addEventListener("click",()=>{this.app.workspace.openLinkText(t.path,""),s.hide()})}showSmartSearchModal(){if(!this.embeddingManager){new D.Notice("\uC784\uBCA0\uB529 \uB9E4\uB2C8\uC800\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4");return}if(!this.settings.embeddingEnabled){new D.Notice("Embedding \uAE30\uBC18 \uAC80\uC0C9\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C \uD65C\uC131\uD654\uD558\uC138\uC694.");return}if(this.embeddingManager.getStats().totalNotes===0){new D.Notice("\uC778\uB371\uC2A4\uAC00 \uBE44\uC5B4 \uC788\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C \uC778\uB371\uC2A4\uB97C \uAD6C\uCD95\uD558\uC138\uC694.");return}new Cv(this.app,this.embeddingManager).open()}async showImageBatchModal(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new D.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new D.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof D.TFolder)){new D.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=["png","jpg","jpeg","webp","gif"],s=[];for(let a of t.children){if(!(a instanceof D.TFile))continue;let l=a.extension.toLowerCase();n.includes(l)&&s.push(a)}if(s.length===0){new D.Notice("_Inbox\uC5D0 \uC774\uBBF8\uC9C0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}s.sort((a,l)=>a.name.localeCompare(l.name));let o=await new Av(this.app,s,this.settings).openAndWait();!o||o.selectedFiles.length===0||await this.processImageBatch(o.selectedFiles)}async processImageBatch(t){if(!this.ocrProcessor||!this.gemini){new D.Notice("OCR/Gemini \uCD08\uAE30\uD654 \uC2E4\uD328");return}let n=this.ocrProcessor.checkLimitsForMultipleImages(t);if(!n.allowed){new D.Notice(`\uCC98\uB9AC \uBD88\uAC00: ${n.reason}`);return}try{new D.Notice(`${t.length}\uAC1C \uC774\uBBF8\uC9C0 OCR \uCC98\uB9AC \uC911...`);let s=await this.ocrProcessor.processMultipleImages(t,`\uD1B5\uD569\uCC98\uB9AC_${t.length}\uC7A5`);new D.Notice("AI \uC694\uC57D \uBC0F \uBD84\uB958 \uC911...");let r=await this.gemini.summarizePDF(s.text,this.settings.detailedSummary),o=Pe(this.settings.timezone,this.settings.dateFormat),a=`---
type: ocr
source_type: image_batch
images: ${t.length}
ocr_at: ${o}
---

# ${r.title}

## \uC694\uC57D
${r.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${r.keyPoints.map(b=>`- ${b}`).join(`
`)}

---
## \uC6D0\uBCF8 \uC774\uBBF8\uC9C0
${t.map(b=>`![[${b.name}]]`).join(`
`)}
`,l=Tn(r.title),c=`${this.settings.inboxFolder}/${l}.md`,d=await this.app.vault.create(c,a);new D.Notice("\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958 \uC911...");let u=this.mocManager?.getProjectList()||[],p=this.feedbackManager?.generatePromptContext(),m=await this.gemini.classifyProject(`# ${r.title}

${r.summary}

${r.keyPoints.join(`
`)}`,u,p),y=await this.applyClassifyResultWithConfirmation(d,m);if(m.title&&y){let b=Tn(m.title),S=y.parent?.path||"",C=S?`${S}/${b}.md`:`${b}.md`;C!==y.path&&(await this.app.fileManager.renameFile(y,C),y=this.app.vault.getAbstractFileByPath(C))}if(this.settings.ocrMoveOriginal){let b=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(b)||await this.app.vault.createFolder(b);for(let C of t){let T=`${b}/${C.name}`;try{await this.app.fileManager.renameFile(C,T)}catch(_){console.error(`\uC774\uBBF8\uC9C0 \uC774\uB3D9 \uC2E4\uD328: ${C.name}`,_)}}new D.Notice(`\uC6D0\uBCF8 \uC774\uBBF8\uC9C0 ${t.length}\uC7A5\uC774 Archives\uB85C \uC774\uB3D9\uB428`)}this.showFileCreatedNotice(y,"\u{1F5BC}\uFE0F"),await this.app.workspace.openLinkText(y.path,"");let v=await this.app.vault.read(y);await this.findAndShowRelatedNotes(y,v,m.title),await this.detectAndSaveSchedules(v,y)}catch(s){console.error("\uC774\uBBF8\uC9C0 \uBC30\uCE58 \uCC98\uB9AC \uC2E4\uD328:",s),new D.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${s}`)}}async applyClassifyResult(t,n){let s=await this.app.vault.read(t),r=this.updateFrontmatter(s,{targetType:n.targetType,project:n.projectName||void 0,title:n.title,summary:n.summary,next_action:n.nextAction||void 0,processed_at:Pe(this.settings.timezone,this.settings.dateFormat)});await this.app.vault.modify(t,r);let o=this.getTargetFolder(n.targetType,n.projectName);if(o){this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o);let l=`${o}/${t.name}`;await this.app.fileManager.renameFile(t,l);let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof D.TFile)return c}return t}async applyClassifyResultWithConfirmation(t,n){if(n.shouldRestructure&&n.restructuredContent){let r=this.feedbackManager?.getPreferences();if(r){let o=r.restructure,a=o.accepted+o.rejected;if(o.preference==="restructure"&&o.accepted>=df)new D.Notice(`\u2728 \uCF58\uD150\uCE20 \uC790\uB3D9 \uC7AC\uAD6C\uC131 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${o.accepted}/${a}\uD68C)`),await this.applyRestructuredContent(t,n.restructuredContent);else if(o.preference==="original"&&o.rejected>=df)new D.Notice(`\u{1F4C4} \uC6D0\uBCF8 \uC720\uC9C0 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${o.rejected}/${a}\uD68C)`);else{let l=await this.app.vault.read(t);await this.showRestructureModal(t,n,l)&&await this.applyRestructuredContent(t,n.restructuredContent)}}else{let o=await this.app.vault.read(t);await this.showRestructureModal(t,n,o)&&await this.applyRestructuredContent(t,n.restructuredContent)}}if(n.contentType!=="reference"||!n.projectName)return this.applyClassifyResult(t,n);let s=this.feedbackManager?.getPreferences();if(s){let r=s.feedback.referenceLocation,o=r.toLibrary+r.toProject;if(r.preference==="library"&&r.toLibrary>=df){new D.Notice(`\u{1F4DA} Library\uC5D0 \uC790\uB3D9 \uC800\uC7A5 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${r.toLibrary}/${o}\uD68C)`);let a={...n,targetType:"library"};return this.applyClassifyResult(t,a)}if(r.preference==="project"&&r.toProject>=df){new D.Notice(`\u{1F4C1} \uD504\uB85C\uC81D\uD2B8\uC5D0 \uC790\uB3D9 \uC800\uC7A5 (\uD559\uC2B5\uB41C \uC120\uD638\uB3C4: ${r.toProject}/${o}\uD68C)`);let a={...n,targetType:"project"};return this.applyClassifyResult(t,a)}}return new Promise(r=>{new KT(this.app,n,async o=>{let a={...n};o==="library"?(a={...n,targetType:"library"},new D.Notice(`Library\uC5D0 \uC800\uC7A5 + ${n.projectName} \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C`)):a={...n,targetType:"project"};let l=await this.applyClassifyResult(t,a);r(l)},this.feedbackManager).open()})}showRestructureModal(t,n,s){return new Promise(r=>{new wv(this.app,n,s,o=>{r(o)},this.feedbackManager).open()})}async applyRestructuredContent(t,n){let r=(await this.app.vault.read(t)).match(/^---\n([\s\S]*?)\n---\n?/),a=(r?r[0]:"")+n;await this.app.vault.modify(t,a)}async findAndShowRelatedNotes(t,n,s){if(!this.relatedNoteFinder||!this.gemini)return;let r=this.truncateContent(n);try{let o=await this.gemini.extractKeywords(r);o.length>0&&this.relatedNoteFinder&&await this.relatedNoteFinder.saveKeywordsToNote(t,o),this.mocManager&&this.mocManager.getMOCCount()>0&&await this.handleProjectMOC(t,s,o),new D.Notice("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC911...");let a=await this.relatedNoteFinder.findRelated(r,s,t.path);a.length>0?new GT(this.app,a,t,this.relatedNoteFinder,this.feedbackManager).open():o.length>0&&new D.Notice(`\uD0A4\uC6CC\uB4DC ${o.length}\uAC1C \uC800\uC7A5\uB428`)}catch(o){console.error("\uAD00\uB828 \uB178\uD2B8 \uAC80\uC0C9 \uC624\uB958:",o)}}async handleProjectMOC(t,n,s){if(!(!this.mocManager||!this.gemini))try{let r=await this.mocManager.detectProject(n,s);if(!r)return;if(r.startsWith("NEW:")){let a=r.slice(4).trim();new zT(this.app,a,t,n,this.mocManager,this.settings.projectsFolder).open();return}await this.mocManager.addNoteToMOC(r,n,t.path)&&new D.Notice(`\u{1F4C1} ${r} MOC\uC5D0 \uC5F0\uACB0\uB428`)}catch(r){console.error("MOC \uC5F0\uACB0 \uC624\uB958:",r)}}getTargetFolder(t,n){switch(t){case"project":return n?`${this.settings.projectsFolder}/${n}`:this.settings.projectsFolder;case"library":return this.settings.libraryFolder;case"archive":return this.settings.archivesFolder;default:return this.settings.libraryFolder}}updateFrontmatter(t,n){let s=/^---\n([\s\S]*?)\n---\n?/,r=t.match(s),o="",a=t;r&&(o=r[1],a=t.slice(r[0].length));let l=o.split(`
`).filter(u=>u.trim()),c=new Map;for(let u of l){let p=u.indexOf(":");if(p!==-1){let m=u.slice(0,p).trim(),y=u.slice(p+1).trim();c.set(m,y)}}for(let[u,p]of Object.entries(n))if(p!==void 0){let y=/[:\[\]{}#&*!|>'"%@`]/.test(p)&&!p.startsWith('"')?`"${p.replace(/"/g,'\\"')}"`:p;c.set(u,y)}return`---
${Array.from(c.entries()).map(([u,p])=>`${u}: ${p}`).join(`
`)}
---
${a}`}async extractZKFromCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new D.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new D.Notice("ZK \uC544\uC774\uB514\uC5B4 \uCD94\uCD9C \uC911...");try{let n=await this.app.vault.read(t),s=await this.gemini.extractZK(n);if(s.length===0){new D.Notice("\uCD94\uCD9C\uD560 \uC544\uC774\uB514\uC5B4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new HT(this.app,s,t,this).open()}catch(n){console.error("ZK \uCD94\uCD9C \uC624\uB958:",n),new D.Notice(`\uCD94\uCD9C \uC2E4\uD328: ${n}`)}}initializeZKCounters(){if(!this.relatedNoteFinder)return;let t=this.relatedNoteFinder.getZettelIndex();for(let[n]of t){let r=(n.split("/").pop()||"").match(/^(\d{8})-(\d{3})/);if(r){let o=r[1],a=parseInt(r[2],10),l=this.zkDailyCounter.get(o)||0;a>l&&this.zkDailyCounter.set(o,a)}this.zkLuhmannCounter=Math.max(this.zkLuhmannCounter,t.size)}console.log(`ZK \uCE74\uC6B4\uD130 \uCD08\uAE30\uD654: \uB8E8\uB9CC=${this.zkLuhmannCounter}, \uC77C\uBCC4=${this.zkDailyCounter.size}\uAC1C \uB0A0\uC9DC`)}generateZKId(){switch(this.settings.zkIdType){case"timestamp":return Date.now().toString();case"date-sequence":{let n=Qn(this.settings.timezone).replace(/-/g,""),s=(this.zkDailyCounter.get(n)||0)+1;return this.zkDailyCounter.set(n,s),`${n}-${s.toString().padStart(3,"0")}`}case"luhmann":return this.zkLuhmannCounter++,this.toLuhmannId(this.zkLuhmannCounter);default:return Date.now().toString()}}toLuhmannId(t){if(t<=0)return"1";let n=[],s=t,r=0;for(;s>0;){if(r%2===0){let o=(s-1)%9+1;n.push(o.toString()),s=Math.floor((s-1)/9)}else{let o=(s-1)%26;n.push(String.fromCharCode(97+o)),s=Math.floor((s-1)/26)}r++}return n.reverse().join("")}async createZKNotes(t,n){let s=this.settings.zettelFolder;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s);let o=[],a=[],l=0;for(let d of t){let p=(await this.relatedNoteFinder.findRelatedZettels(d.keywords)).find(C=>C.relevance>=this.settings.zkMergeThreshold);if(p&&await this.showMergeConfirmModal(d,p)){await this.mergeToExistingZK(p.note.path,d,n),a.push(d.title);continue}let m=this.generateZKId(),y=Tn(d.title),v=`${s}/${m} ${y}.md`,b=`---
type: zettel
source: "[[${n.basename}]]"
keywords: [${d.keywords.join(", ")}]
created: ${Pe(this.settings.timezone,this.settings.dateFormat)}
---

# ${d.title}

## \uD575\uC2EC \uC544\uC774\uB514\uC5B4
${d.body}

## \uC65C \uC911\uC694\uD55C\uAC00?
${d.importance||""}

## \uB9E5\uB77D
- **\uC6D0\uBCF8**: [[${n.basename}]]
- **\uAD00\uB828 \uAC1C\uB150**: ${d.relatedConcepts?.join(", ")||""}

---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
- [[${n.basename}]] (\uC6D0\uBCF8)
`;await this.app.vault.create(v,b),o.push(d.title);let S=this.app.vault.getAbstractFileByPath(v);if(S instanceof D.TFile){await this.relatedNoteFinder.updateIndex(S);let C=await this.relatedNoteFinder.findRelatedZettels(d.keywords,v);C.length>0&&(await this.addZKRelatedLinks(S,C),await this.addBacklinksToZettels(S,C),l+=C.length),this.zkIndexManager&&await this.zkIndexManager.updateIndex(S,d.keywords)}await new Promise(C=>setTimeout(C,10))}let c=[];o.length>0&&c.push(`${o.length}\uAC1C \uC0DD\uC131`),a.length>0&&c.push(`${a.length}\uAC1C \uBCD1\uD569`),l>0&&c.push(`${l}\uAC1C \uC5F0\uACB0`),new D.Notice(`ZK \uB178\uD2B8: ${c.join(", ")}`)}showMergeConfirmModal(t,n){return new Promise(s=>{new $T(this.app,t,n,o=>s(o)).open()})}async mergeToExistingZK(t,n,s){let r=this.app.vault.getAbstractFileByPath(t);if(!(r instanceof D.TFile))return;let o=await this.app.vault.read(r),a=`

---
## \uCD94\uAC00\uB41C \uB0B4\uC6A9 (${new Date().toLocaleDateString()})
*\uC6D0\uBCF8: [[${s.basename}]]*

${n.body}
`,l=/(\n---\n##  )/,c;l.test(o)?c=o.replace(l,`${a}$1`):c=o+a;let d=this.extractKeywordsFromFrontmatter(o),u=[...new Set([...d,...n.keywords])];c=this.updateFrontmatterKeywordsInContent(c,u),await this.app.vault.modify(r,c),await this.relatedNoteFinder.updateIndex(r)}extractKeywordsFromFrontmatter(t){let n=t.match(/^---\n[\s\S]*?keywords:\s*\[(.*?)\][\s\S]*?---/);return n?n[1].split(",").map(s=>s.trim().replace(/^["']|["']$/g,"")).filter(s=>s.length>0):[]}updateFrontmatterKeywordsInContent(t,n){let s=`keywords: [${n.join(", ")}]`;return t.replace(/^(---\n[\s\S]*?)(keywords:\s*\[.*?\])([\s\S]*?---)/,`$1${s}$3`)}async addZKRelatedLinks(t,n){if(n.length===0)return;let s=await this.app.vault.read(t),r=n.map(c=>{let d=c.note.path.split("/"),p=d[d.length-1].replace(/\.md$/,""),m=c.reason?`
  \u2192 ${c.reason}`:"";return`- [[${p}]] (${Math.round(c.relevance*100)}%)${m}`}).join(`
`),o=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,a=s.match(o),l;a?l=s.replace(o,`$1
${r}$2`):l=s+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${r}
`,await this.app.vault.modify(t,l)}async addBacklinksToZettels(t,n){for(let s of n){let r=this.app.vault.getAbstractFileByPath(s.note.path);if(!(r instanceof D.TFile))continue;let o=await this.app.vault.read(r);if(o.includes(`[[${t.basename}]]`))continue;let a=s.reason?`
  \u2192 ${s.reason}`:"",l=`- [[${t.basename}]] (${Math.round(s.relevance*100)}%)${a}`,c=/(---\n##  \n[\s\S]*?)(\n---|\n*$)/,d=o.match(c),u;d?u=o.replace(c,`$1
${l}$2`):u=o+`
---
## \uC5F0\uACB0\uB41C \uB178\uD2B8
${l}
`,await this.app.vault.modify(r,u)}}async showFocusTop3(){if(this.checkApiKey()){new D.Notice("\uD504\uB85C\uC81D\uD2B8 \uBD84\uC11D \uC911...");try{let t=this.app.vault.getAbstractFileByPath(this.settings.projectsFolder);if(!t||!(t instanceof D.TFolder)){new D.Notice("Projects \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=await this.collectProjectsSummary(t);if(!n){new D.Notice("\uC9C4\uD589 \uC911\uC778 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let s=await this.gemini.getFocus(n);if(s.length===0){new D.Notice("\uCD94\uCC9C\uD560 \uD504\uB85C\uC81D\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new VT(this.app,s).open()}catch(t){console.error("Focus \uBD84\uC11D \uC624\uB958:",t),new D.Notice(`\uBD84\uC11D \uC2E4\uD328: ${t}`)}}}async collectProjectsSummary(t){let n=[];for(let s of t.children)if(s instanceof D.TFolder){let r=s.name,o=await this.getProjectInfo(s);n.push(`- ${r}: ${o}`)}return n.join(`
`)}async getProjectInfo(t){let n=[`${t.name} (MOC).md`,`${t.name} MOC.md`,"MOC.md","README.md"];for(let a of n){let l=`${t.path}/${a}`,c=this.app.vault.getAbstractFileByPath(l);if(c instanceof D.TFile){let d=await this.app.vault.read(c),u=this.extractFrontmatter(d),p=u.summary||u.description||"",m=u.next_action||u.nextAction||"";if(p||m)return`${p} (\uB2E4\uC74C: ${m})`}}let s=[];for(let a of t.children)a instanceof D.TFile&&a.extension==="md"&&s.push({file:a,mtime:a.stat.mtime});s.sort((a,l)=>l.mtime-a.mtime);let r=s.slice(0,3);return r.length===0?"(\uB178\uD2B8 \uC5C6\uC74C)":`\uCD5C\uADFC \uC791\uC5C5: ${r.map(a=>a.file.basename).join(", ")}`}extractFrontmatter(t){let n=/^---\n([\s\S]*?)\n---/,s=t.match(n);if(!s)return{};let r={},o=s[1].split(`
`);for(let a of o){let l=a.indexOf(":");if(l!==-1){let c=a.slice(0,l).trim(),d=a.slice(l+1).trim();r[c]=d}}return r}async processInbox(){if(!this.checkApiKey())return;let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof D.TFolder)){new D.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=0,s=0,r=this.settings.triggerTag,o=[];for(let c of t.children)c instanceof D.TFile&&c.extension==="md"&&(await this.app.vault.read(c)).includes(r)&&o.push(c);if(o.length===0){new D.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new D.Notice(`${o.length}\uAC1C \uD30C\uC77C \uCC98\uB9AC \uC2DC\uC791...`);let a=this.mocManager?.getProjectList()||[],l=this.feedbackManager?.generatePromptContext();for(let c=0;c<o.length;c++){let d=o[c];try{new D.Notice(`\uCC98\uB9AC \uC911: ${c+1}/${o.length} - ${d.name}`,2e3);let u=await this.app.vault.read(d),p=await this.gemini.classifyProject(u,a,l);await this.applyClassifyResult(d,p),n++}catch(u){console.error(`\uCC98\uB9AC \uC2E4\uD328: ${d.name}`,u),s++}}new D.Notice(`\uC644\uB8CC: ${n}\uAC1C \uCC98\uB9AC, ${s}\uAC1C \uC2E4\uD328`)}toggleWatch(){this.watcherRegistered?(this.stopWatcher(),new D.Notice("Watch \uC911\uC9C0\uB428")):(this.startWatcher(),new D.Notice("Watch \uC2DC\uC791\uB428"))}startWatcher(){this.watcherRegistered||(this.registerEvent(this.app.vault.on("create",t=>{t instanceof D.TFile&&(this.onFileChange(t),this.scheduleEmbeddingUpdate(t))})),this.registerEvent(this.app.vault.on("modify",t=>{t instanceof D.TFile&&(this.onFileChange(t),this.scheduleEmbeddingUpdate(t))})),this.registerEvent(this.app.vault.on("delete",t=>{t instanceof D.TFile&&(this.relatedNoteFinder?.removeFromIndex(t.path),this.mocManager?.removeFromIndex(t.path),this.embeddingManager?.removeNote(t.path),this.embeddingManager?.saveIndex(),console.log(`\uC778\uB371\uC2A4\uC5D0\uC11C \uC81C\uAC70: ${t.path}`))})),this.registerEvent(this.app.vault.on("rename",(t,n)=>{t instanceof D.TFile&&(this.embeddingManager?.renameNote(n,t.path),this.embeddingManager?.saveIndex())})),this.watcherRegistered=!0,console.log("Inbox \uAC10\uC2DC \uC2DC\uC791"))}stopWatcher(){this.watcherRegistered=!1,this.pendingFiles.clear(),console.log("Inbox \uAC10\uC2DC \uC911\uC9C0")}scheduleEmbeddingUpdate(t){if(!this.settings.embeddingEnabled||!this.settings.autoEmbeddingEnabled||!this.embeddingManager||t.extension!=="md")return;let n=this.pendingEmbeddings.get(t.path);n&&clearTimeout(n);let s=setTimeout(async()=>{this.pendingEmbeddings.delete(t.path),await this.embeddingManager?.updateNoteEmbedding(t,!1)&&(await this.embeddingManager?.saveIndex(),console.log("Embedding \uC790\uB3D9 \uC5C5\uB370\uC774\uD2B8:",t.path))},5e3);this.pendingEmbeddings.set(t.path,s)}onFileChange(t){this.watcherRegistered&&this.gemini&&t.path.startsWith(this.settings.inboxFolder)&&t.extension==="md"&&(this.pendingFiles.set(t.path,Date.now()),this.processDebounced())}async processPendingFiles(){if(!this.gemini)return;let t=Date.now(),n=this.settings.triggerTag,s=this.mocManager?.getProjectList()||[],r=this.feedbackManager?.generatePromptContext();for(let[o,a]of this.pendingFiles.entries()){if(t-a<3e3)continue;this.pendingFiles.delete(o);let l=this.app.vault.getAbstractFileByPath(o);if(l instanceof D.TFile)try{let c=await this.app.vault.read(l);if(!c.includes(n))continue;let d=await this.gemini.classifyProject(c,s,r);await this.applyClassifyResult(l,d),new D.Notice(`\uC790\uB3D9 \uBD84\uB958: ${l.name} \u2192 ${d.targetType}${d.projectName?` (${d.projectName})`:""}`)}catch(c){console.error(`\uC790\uB3D9 \uBD84\uB958 \uC2E4\uD328: ${o}`,c)}}}async ocrCurrentFile(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new D.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new D.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.workspace.getActiveFile();if(!t){new D.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase();if(n==="md"){try{let o=await this.app.vault.read(t),a=this.extractEmbeddedImages(o);if(a.length===0){new D.Notice("\uC784\uBCA0\uB4DC\uB41C \uC774\uBBF8\uC9C0\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}new D.Notice(`\uC784\uBCA0\uB4DC\uB41C \uC774\uBBF8\uC9C0 ${a.length}\uC7A5 OCR \uCC98\uB9AC \uC911...`);let l=this.ocrProcessor.checkLimitsForMultipleImages(a);if(!l.allowed){new D.Notice(`OCR \uC81C\uD55C: ${l.reason}`);return}let c=await this.ocrProcessor.processMultipleImages(a,t.basename),u=this.ocrProcessor.generateMarkdownNote(c)+`
---
## \uC6D0\uBCF8 \uC774\uBBF8\uC9C0
${a.map(p=>`![[${p.name}]]`).join(`
`)}`;await this.app.vault.modify(t,u),new D.Notice(`OCR \uC644\uB8CC: ${a.length}\uC7A5 \uCC98\uB9AC\uB428`)}catch(o){console.error("OCR \uC624\uB958:",o),new D.Notice(`OCR \uC2E4\uD328: ${o}`)}return}if(!["png","jpg","jpeg","webp","gif","pdf"].includes(n)){new D.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`);return}let r=await this.ocrProcessor.checkLimits(t);if(!r.allowed){new ip(this.app,r.reason,t,this).open();return}new D.Notice("OCR \uCC98\uB9AC \uC911...");try{let o=await this.ocrProcessor.processFile(t),a=this.ocrProcessor.generateMarkdownNote(o),l=t.basename+"_OCR.md",c=`${this.settings.inboxFolder}/${l}`;if(await this.app.vault.create(c,a),this.settings.ocrMoveOriginal){let d=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(d)||await this.app.vault.createFolder(d);let p=`${d}/${t.name}`;await this.app.fileManager.renameFile(t,p)}new D.Notice(`OCR \uC644\uB8CC: ${l} \uC0DD\uC131\uB428 (${o.pages}\uD398\uC774\uC9C0)`)}catch(o){console.error("OCR \uC624\uB958:",o),new D.Notice(`OCR \uC2E4\uD328: ${o}`)}}async processInboxOCR(){if(!this.checkApiKey())return;if(!this.settings.ocrEnabled){new D.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new D.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let t=this.app.vault.getAbstractFileByPath(this.settings.inboxFolder);if(!t||!(t instanceof D.TFolder)){new D.Notice("Inbox \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=["png","jpg","jpeg","webp","gif","pdf"],s=[];for(let a of t.children){if(!(a instanceof D.TFile))continue;let l=a.extension.toLowerCase();if(!n.includes(l))continue;(await this.ocrProcessor.checkLimits(a)).allowed&&s.push(a)}if(s.length===0){new D.Notice("\uCC98\uB9AC\uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}new D.Notice(`${s.length}\uAC1C \uD30C\uC77C OCR \uCC98\uB9AC \uC2DC\uC791...`);let r=0,o=0;for(let a=0;a<s.length;a++){let l=s[a];try{new D.Notice(`OCR \uC911: ${a+1}/${s.length} - ${l.name}`,3e3);let c=await this.ocrProcessor.processFile(l),d=this.ocrProcessor.generateMarkdownNote(c),u=l.basename+"_OCR.md",p=`${this.settings.inboxFolder}/${u}`;if(await this.app.vault.create(p,d),this.settings.ocrMoveOriginal){let m=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(m)||await this.app.vault.createFolder(m);let v=`${m}/${l.name}`;await this.app.fileManager.renameFile(l,v)}r++,a<s.length-1&&await new Promise(m=>setTimeout(m,1e3))}catch(c){console.error(`OCR \uCC98\uB9AC \uC2E4\uD328: ${l.name}`,c),o++}}new D.Notice(`OCR \uC644\uB8CC: ${r}\uAC1C \uCC98\uB9AC, ${o}\uAC1C \uC2E4\uD328`)}async smartProcessCurrentFile(){if(!this.checkApiKey())return;let t=this.app.workspace.getActiveFile();if(!t){new D.Notice("\uC5F4\uB9B0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");return}let n=t.extension.toLowerCase();if(["pdf","png","jpg","jpeg","webp","gif"].includes(n)){if(!this.settings.ocrEnabled){new D.Notice("OCR \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4");return}if(!this.ocrProcessor){new D.Notice("OCR \uD504\uB85C\uC138\uC11C\uB97C \uCD08\uAE30\uD654\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4");return}let r=await this.ocrProcessor.checkLimits(t);if(!r.allowed){new ip(this.app,r.reason,t,this).open();return}new D.Notice("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC911: OCR \u2192 AI \uC694\uC57D \u2192 \uD504\uB85C\uC81D\uD2B8 \uBD84\uB958...");try{let o=await this.ocrProcessor.processFile(t);new D.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let a=await this.gemini.summarizePDF(o.text,this.settings.detailedSummary),l=this.ocrProcessor.generateSummarizedNote(o,a),c=t.basename+"_OCR.md",d=`${this.settings.inboxFolder}/${c}`,u=await this.app.vault.create(d,l);if(this.settings.ocrMoveOriginal){let b=this.settings.ocrOriginalFolder;this.app.vault.getAbstractFileByPath(b)||await this.app.vault.createFolder(b);let C=`${b}/${t.name}`;await this.app.fileManager.renameFile(t,C)}let p=this.mocManager?.getProjectList()||[],m=this.feedbackManager?.generatePromptContext(),y=await this.gemini.classifyProject(l,p,m),v=await this.applyClassifyResultWithConfirmation(u,y);if(y.title&&v){let b=Tn(y.title),S=v.parent?.path||"",C=S?`${S}/${b}.md`:`${b}.md`;C!==v.path&&await this.app.fileManager.renameFile(v,C)}new D.Notice(`\uC644\uB8CC: OCR(${o.pages}p) \u2192 ${y.targetType}${y.projectName?` (${y.projectName})`:""}\uB85C \uBD84\uB958\uB428`)}catch(o){console.error("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC624\uB958:",o),new D.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${o}`)}}else if(n==="md")try{let r=await this.app.vault.read(t),o=this.extractEmbeddedImages(r);if(o.length>0&&this.settings.ocrEnabled&&this.ocrProcessor){new D.Notice(`\uC784\uBCA0\uB4DC\uB41C \uC774\uBBF8\uC9C0 ${o.length}\uC7A5 \uAC10\uC9C0\uB428. \uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC911...`);let a=this.ocrProcessor.checkLimitsForMultipleImages(o);if(!a.allowed){new D.Notice(`OCR \uC81C\uD55C: ${a.reason}`),await this.classifyMarkdownContent(t,r);return}let l=await this.ocrProcessor.processMultipleImages(o,t.basename);new D.Notice("AI \uC694\uC57D \uC0DD\uC131 \uC911...");let c=await this.gemini.summarizePDF(l.text,this.settings.detailedSummary),d=`---
type: ocr
source_note: "${t.basename}"
pages: ${l.pages}
---

# ${c.title}

## \uC694\uC57D
${c.summary}

## \uD575\uC2EC \uD3EC\uC778\uD2B8
${c.keyPoints.map(v=>`- ${v}`).join(`
`)}

---
## \uC6D0\uBCF8 \uC774\uBBF8\uC9C0
${o.map(v=>`![[${v.name}]]`).join(`
`)}
`;await this.app.vault.modify(t,d);let u=this.mocManager?.getProjectList()||[],p=this.feedbackManager?.generatePromptContext(),m=await this.gemini.classifyProject(d,u,p),y=await this.applyClassifyResultWithConfirmation(t,m);if(c.title&&y){let v=Tn(c.title),b=y.parent?.path||"",S=b?`${b}/${v}.md`:`${v}.md`;S!==y.path&&(await this.app.fileManager.renameFile(y,S),y=this.app.vault.getAbstractFileByPath(S))}new D.Notice(`\uC644\uB8CC: OCR(${l.pages}\uC7A5) \u2192 ${m.targetType}${m.projectName?` (${m.projectName})`:""}`),await this.findAndShowRelatedNotes(y,d,c.title),await this.detectAndSaveSchedules(d,y);return}await this.classifyMarkdownContent(t,r)}catch(r){console.error("\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC \uC624\uB958:",r),new D.Notice(`\uCC98\uB9AC \uC2E4\uD328: ${r}`)}else new D.Notice(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD30C\uC77C \uD615\uC2DD\uC785\uB2C8\uB2E4: ${n}`)}getOCRDailyUsage(){return this.ocrProcessor?this.ocrProcessor.getDailyUsage():{date:Qn(this.settings.timezone),pagesProcessed:0,filesProcessed:0}}async initUsageTracker(){this.usageTracker=new lp(this.app,this.settings,()=>this.getDataPath()),await this.usageTracker.loadUsage(),this.settings.usageShowStatusBar&&(this.usageStatusBarEl=this.addStatusBarItem(),this.usageStatusBarEl.addClass("zfb-usage-statusbar"),this.usageStatusBarEl.addEventListener("click",()=>{this.app.setting.open(),this.app.setting.openTabById("zero-friction-brain")}),this.usageTracker.setStatusBarEl(this.usageStatusBarEl)),this.gemini&&this.gemini.setUsageTracker(this.usageTracker)}async toggleUsageTracker(t){t&&!this.usageTracker?await this.initUsageTracker():!t&&this.usageTracker&&(await this.usageTracker.saveUsage(),this.usageTracker=null,this.gemini&&this.gemini.setUsageTracker(null),this.usageStatusBarEl&&(this.usageStatusBarEl.remove(),this.usageStatusBarEl=null))}getDataPath(){return this.settings.dataStorageLocation==="vault"?this.settings.dataFolderPath:".obsidian/plugins/zero-friction-brain"}},HT=class extends D.Modal{constructor(e,t,n,s){super(e),this.candidates=t,this.selected=new Set(t.map((r,o)=>o)),this.sourceFile=n,this.plugin=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"ZK \uC544\uC774\uB514\uC5B4 \uC120\uD0DD"}),e.createEl("p",{text:"\uC0DD\uC131\uD560 Zettelkasten \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let t=e.createDiv({cls:"zk-candidate-list"});this.candidates.forEach((o,a)=>{let l=t.createDiv({cls:"zk-candidate-item"}),c=l.createEl("input",{type:"checkbox",attr:{checked:!0}});c.addEventListener("change",()=>{c.checked?this.selected.add(a):this.selected.delete(a)});let d=l.createDiv({cls:"zk-candidate-label"});d.createEl("strong",{text:o.title}),d.createEl("p",{text:o.body,cls:"zk-candidate-body"}),d.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${o.keywords.join(", ")}`,cls:"zk-candidate-keywords"})});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{let o=this.candidates.filter((a,l)=>this.selected.has(l));o.length>0&&await this.plugin.createZKNotes(o,this.sourceFile),this.close()})}onClose(){this.contentEl.empty()}},$T=class extends D.Modal{constructor(e,t,n,s){super(e),this.candidate=t,this.similarNote=n,this.onResult=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC720\uC0AC\uD55C \uB178\uD2B8 \uBC1C\uACAC"}),e.createEl("p",{text:`\uC0C8 \uC544\uC774\uB514\uC5B4\uC640 ${Math.round(this.similarNote.relevance*100)}% \uC720\uC0AC\uD55C \uB178\uD2B8\uAC00 \uC788\uC2B5\uB2C8\uB2E4.`,cls:"setting-item-description"});let t=e.createDiv({cls:"merge-section"});t.createEl("h4",{text:"\uC0C8 \uC544\uC774\uB514\uC5B4"}),t.createEl("p",{text:this.candidate.title,cls:"merge-title"}),t.createEl("p",{text:this.candidate.body,cls:"merge-body"});let n=e.createDiv({cls:"merge-section"});n.createEl("h4",{text:"\uAE30\uC874 \uB178\uD2B8"});let s=this.similarNote.note.path.split("/").pop()?.replace(/\.md$/,"")||this.similarNote.note.title;n.createEl("p",{text:s,cls:"merge-title"}),n.createEl("p",{text:`\uD0A4\uC6CC\uB4DC: ${this.similarNote.note.keywords.join(", ")}`,cls:"merge-keywords"});let r=e.createDiv({cls:"merge-buttons"});r.createEl("button",{text:"\uAE30\uC874 \uB178\uD2B8\uC5D0 \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",()=>{this.onResult(!0),this.close()}),r.createEl("button",{text:"\uC0C8 \uB178\uD2B8 \uC0DD\uC131"}).addEventListener("click",()=>{this.onResult(!1),this.close()})}onClose(){this.contentEl.empty()}},VT=class extends D.Modal{constructor(e,t){super(e),this.items=t}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC624\uB298 \uC9D1\uC911\uD560 \uD504\uB85C\uC81D\uD2B8 Top 3"});let t=e.createDiv({cls:"focus-list"});this.items.forEach((r,o)=>{let a=t.createDiv({cls:"focus-item"});a.createEl("h3",{text:`${o+1}. ${r.title}`}),a.createEl("p",{text:r.why,cls:"focus-why"}),a.createEl("p",{text:`\u2192 ${r.nextAction}`,cls:"focus-action"})}),e.createDiv({cls:"modal-button-container"}).createEl("button",{text:"\uB2EB\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}},ip=class extends D.Modal{constructor(e,t,n,s){super(e),this.reason=t,this.file=n,this.plugin=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uD30C\uC77C\uC774 \uB108\uBB34 \uD07D\uB2C8\uB2E4"}),e.createEl("p",{text:this.reason}),e.createEl("p",{text:"\uC124\uC815\uC5D0\uC11C \uC81C\uD55C\uC744 \uC870\uC815\uD558\uAC70\uB098, \uD30C\uC77C\uC744 \uBD84\uD560\uD574\uC11C \uCC98\uB9AC\uD558\uC138\uC694.",cls:"setting-item-description"});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"\uC124\uC815 \uC5F4\uAE30",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.app.setting.open()})}onClose(){this.contentEl.empty()}},GT=class extends D.Modal{constructor(t,n,s,r,o=null){super(t);this.choiceMade=!1;this.relatedNotes=n,this.selected=new Set(n.map((a,l)=>l)),this.currentFile=s,this.finder=r,this.feedbackManager=o}recordFeedback(t,n,s){this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"related_notes",noteTitle:this.currentFile.basename,aiSuggestion:{suggestedNotePaths:this.relatedNotes.map(r=>r.note.path)},userChoice:{accepted:t.length>0,rejectedItems:n.map(r=>r.note.path),dismissed:s}})}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uAD00\uB828 \uB178\uD2B8 \uBC1C\uACAC"}),t.createEl("p",{text:"\uC5F0\uACB0\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694",cls:"setting-item-description"});let n=t.createDiv({cls:"related-notes-list"});this.relatedNotes.forEach((a,l)=>{let c=n.createDiv({cls:"related-note-item"}),d=c.createEl("input",{type:"checkbox",attr:{checked:!0}});d.addEventListener("change",()=>{d.checked?this.selected.add(l):this.selected.delete(l)});let u=c.createDiv({cls:"related-note-label"}),p=a.note.path.split("/").pop()?.replace(/\.md$/,"")||a.note.title;u.createEl("strong",{text:p});let m=Math.round(a.relevance*100);u.createEl("span",{text:` (${m}%)`,cls:"related-note-relevance"}),a.matchedKeywords.length>0&&u.createEl("small",{text:`\uD0A4\uC6CC\uB4DC: ${a.matchedKeywords.join(", ")}`,cls:"related-note-keywords"})});let s=t.createDiv({cls:"modal-button-container"});s.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback([],this.relatedNotes,!1),this.close()}),s.createEl("button",{text:"\uB9C1\uD06C \uCD94\uAC00",cls:"mod-cta"}).addEventListener("click",async()=>{this.choiceMade=!0;let a=this.relatedNotes.filter((c,d)=>this.selected.has(d)),l=this.relatedNotes.filter((c,d)=>!this.selected.has(d));this.recordFeedback(a,l,!1),a.length>0&&(await this.finder.addRelatedLinks(this.currentFile,a),new D.Notice(`${a.length}\uAC1C \uAD00\uB828 \uB178\uD2B8 \uB9C1\uD06C \uCD94\uAC00\uB428`)),this.close()})}onClose(){this.choiceMade||this.recordFeedback([],this.relatedNotes,!0),this.contentEl.empty()}},zT=class extends D.Modal{constructor(e,t,n,s,r,o){super(e),this.projectName=t,this.noteFile=n,this.noteTitle=s,this.mocManager=r,this.projectsFolder=o}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 \uAC10\uC9C0"}),e.createEl("p",{text:`"${this.projectName}" \uD504\uB85C\uC81D\uD2B8\uAC00 \uC0C8\uB85C \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`}),e.createEl("p",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8\uC758 MOC(Map of Content)\uB97C \uC0DD\uC131\uD560\uAE4C\uC694?",cls:"setting-item-description"});let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"\uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"MOC \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",async()=>{await this.mocManager.createProjectMOC(this.projectName,this.projectsFolder)?(await this.mocManager.addNoteToMOC(this.projectName,this.noteTitle,this.noteFile.path),new D.Notice(`\u{1F4C1} ${this.projectName} MOC \uC0DD\uC131 \uBC0F \uC5F0\uACB0 \uC644\uB8CC`)):new D.Notice("MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4"),this.close()})}onClose(){this.contentEl.empty()}},WT=class extends D.Modal{constructor(e,t,n){super(e),this.mocManager=t,this.projectsFolder=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131"}),e.createEl("p",{text:"\uC0C8 \uD504\uB85C\uC81D\uD2B8 MOC\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4. \uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694.",cls:"setting-item-description"});let t=e.createDiv({cls:"moc-input-container"});if(t.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uC774\uB984:"}),this.inputEl=t.createEl("input",{type:"text",placeholder:"\uC608: \uC2A4\uB9C8\uD2B8\uD31C"}),this.inputEl.style.width="100%",this.inputEl.style.marginTop="8px",this.inputEl.style.padding="8px",this.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.createMOC()}),this.mocManager&&this.mocManager.getMOCCount()>0){let o=e.createDiv({cls:"existing-mocs"});o.createEl("h4",{text:"\uAE30\uC874 \uD504\uB85C\uC81D\uD2B8 MOC:"});let a=o.createEl("ul");for(let l of this.mocManager.getProjectList())a.createEl("li",{text:l})}let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createMOC()),setTimeout(()=>this.inputEl.focus(),10)}async createMOC(){let e=this.inputEl.value.trim();if(!e){new D.Notice("\uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694");return}if(!this.mocManager){new D.Notice("MOC \uAD00\uB9AC\uC790\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4"),this.close();return}if(this.mocManager.getProjectList().includes(e)){new D.Notice(`"${e}" MOC\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4`);return}let n=await this.mocManager.createProjectMOC(e,this.projectsFolder);n?(new D.Notice(`\u{1F4C1} ${e} MOC \uC0DD\uC131 \uC644\uB8CC`),this.app.workspace.getLeaf().openFile(n)):new D.Notice("MOC \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4"),this.close()}onClose(){this.contentEl.empty()}},qT=class extends D.Modal{constructor(e,t,n,s,r){super(e),this.title=t,this.description=n,this.placeholder=s,this.onSubmit=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.title}),e.createEl("p",{text:this.description,cls:"setting-item-description"});let t=e.createDiv({cls:"url-input-container"});this.inputEl=t.createEl("input",{type:"text",placeholder:this.placeholder}),this.inputEl.style.width="100%",this.inputEl.style.padding="8px",navigator.clipboard.readText().then(o=>{o&&(o.startsWith("http://")||o.startsWith("https://"))&&(this.inputEl.value=o)}).catch(()=>{}),this.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.submit()});let n=e.createDiv({cls:"modal-button-container"});n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\uAC00\uC838\uC624\uAE30",cls:"mod-cta"}).addEventListener("click",()=>this.submit()),setTimeout(()=>this.inputEl.focus(),10)}async submit(){let e=this.inputEl.value.trim();if(!e){new D.Notice("URL\uC744 \uC785\uB825\uD558\uC138\uC694");return}this.close(),await this.onSubmit(e)}onClose(){this.contentEl.empty()}},YT=class extends D.Modal{constructor(e,t,n,s){super(e),this.sections=t,this.selected=new Set(t.map((r,o)=>o)),this.sourceFile=n,this.plugin=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC \uACB0\uACFC"}),e.createEl("p",{text:`${this.sections.length}\uAC1C\uC758 \uC139\uC158\uC73C\uB85C \uBD84\uB9AC\uB428. \uC0DD\uC131\uD560 \uB178\uD2B8\uB97C \uC120\uD0DD\uD558\uC138\uC694.`,cls:"setting-item-description"});let t=e.createDiv({cls:"split-section-list"});this.sections.forEach((o,a)=>{let l=t.createDiv({cls:"split-section-item"});l.style.marginBottom="16px",l.style.padding="12px",l.style.border="1px solid var(--background-modifier-border)",l.style.borderRadius="8px";let c=l.createDiv({cls:"split-section-header"});c.style.display="flex",c.style.alignItems="center",c.style.gap="8px";let d=c.createEl("input",{type:"checkbox",attr:{checked:!0}});d.addEventListener("change",()=>{d.checked?this.selected.add(a):this.selected.delete(a)}),c.createEl("strong",{text:o.title});let u=c.createDiv({cls:"split-section-badges"});u.style.marginLeft="auto",u.style.display="flex",u.style.gap="4px";let p=u.createEl("span",{text:o.targetType,cls:"split-category-badge"});if(p.style.padding="2px 8px",p.style.borderRadius="4px",p.style.fontSize="12px",p.style.backgroundColor=this.getTargetTypeColor(o.targetType),p.style.color="white",o.project){let v=u.createEl("span",{text:o.project.startsWith("NEW:")?`\u2728 ${o.project.slice(4)}`:`\u{1F4C1} ${o.project}`,cls:"split-project-badge"});v.style.padding="2px 8px",v.style.borderRadius="4px",v.style.fontSize="12px",v.style.backgroundColor="var(--interactive-accent)",v.style.color="white"}let m=l.createDiv({cls:"split-section-preview"});m.style.marginTop="8px",m.style.fontSize="13px",m.style.color="var(--text-muted)",m.style.maxHeight="60px",m.style.overflow="hidden",m.style.textOverflow="ellipsis";let y=o.content.length>150?o.content.slice(0,150)+"...":o.content;if(m.setText(y),o.keywords.length>0){let v=l.createDiv({cls:"split-section-keywords"});v.style.marginTop="8px",v.style.fontSize="12px",v.setText(`\uD0A4\uC6CC\uB4DC: ${o.keywords.join(", ")}`)}});let n=e.createDiv({cls:"modal-button-container"});n.style.marginTop="16px",n.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:`${this.selected.size}\uAC1C \uB178\uD2B8 \uC0DD\uC131`,cls:"mod-cta"}).addEventListener("click",async()=>{let o=this.sections.filter((a,l)=>this.selected.has(l));o.length>0&&(this.close(),await this.plugin.createSplitNotes(o,this.sourceFile))})}getTargetTypeColor(e){switch(e){case"project":return"#e67e22";case"library":return"#27ae60";case"archive":return"#95a5a6";default:return"#7f8c8d"}}onClose(){this.contentEl.empty()}},KT=class extends D.Modal{constructor(t,n,s,r=null){super(t);this.choiceMade=!1;this.result=n,this.onChoice=s,this.feedbackManager=r}recordFeedback(t){this.feedbackManager&&this.feedbackManager.addFeedback({timestamp:new Date().toISOString(),type:"reference_location",noteTitle:this.result.title,aiSuggestion:{targetType:this.result.targetType,projectName:this.result.projectName},userChoice:{accepted:t!==null&&this.result.targetType==="project"&&t==="project",modified:t||void 0,dismissed:t===null}})}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\uC800\uC7A5 \uC704\uCE58 \uC120\uD0DD"});let n=t.createDiv({cls:"reference-confirm-info"});n.style.marginBottom="16px",n.style.padding="12px",n.style.backgroundColor="var(--background-secondary)",n.style.borderRadius="8px",n.createEl("p",{text:`"${this.result.title}"`,cls:"reference-title"}).style.fontWeight="bold",n.createEl("p",{text:`\uAD00\uB828 \uD504\uB85C\uC81D\uD2B8: ${this.result.projectName}`,cls:"reference-project"}).style.color="var(--text-muted)",n.createEl("p",{text:"\uC774 \uC790\uB8CC\uB294 \uC678\uBD80 \uCC38\uACE0\uC790\uB8CC\uB85C \uBCF4\uC785\uB2C8\uB2E4. \uC5B4\uB514\uC5D0 \uC800\uC7A5\uD560\uAE4C\uC694?",cls:"reference-question"}).style.marginTop="8px";let s=t.createDiv({cls:"reference-options"});s.style.display="flex",s.style.flexDirection="column",s.style.gap="12px";let r=s.createDiv({cls:"reference-option"});r.style.padding="12px",r.style.border="1px solid var(--background-modifier-border)",r.style.borderRadius="8px",r.style.cursor="pointer",r.addEventListener("mouseenter",()=>{r.style.backgroundColor="var(--background-secondary)"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor=""}),r.createEl("strong",{text:"\u{1F4C1} \uD504\uB85C\uC81D\uD2B8 \uD3F4\uB354\uC5D0 \uC800\uC7A5"}),r.createEl("p",{text:`Projects/${this.result.projectName}/ \uC5D0 \uC800\uC7A5`,cls:"option-desc"}).style.color="var(--text-muted)",r.createEl("small",{text:"\uC774 \uD504\uB85C\uC81D\uD2B8 \uC804\uC6A9 \uC790\uB8CC\uB85C \uAD00\uB9AC"}).style.color="var(--text-faint)",r.addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback("project"),this.close(),this.onChoice("project")});let o=s.createDiv({cls:"reference-option"});o.style.padding="12px",o.style.border="2px solid var(--interactive-accent)",o.style.borderRadius="8px",o.style.cursor="pointer",o.style.backgroundColor="var(--background-secondary)",o.createEl("strong",{text:"\u{1F4DA} Library\uC5D0 \uC800\uC7A5 + \uD504\uB85C\uC81D\uD2B8 \uB9C1\uD06C (\uAD8C\uC7A5)"}),o.createEl("p",{text:"Library/ \uC5D0 \uC800\uC7A5\uD558\uACE0 \uD504\uB85C\uC81D\uD2B8\uC640 \uC5F0\uACB0",cls:"option-desc"}).style.color="var(--text-muted)",o.createEl("small",{text:"\uB2E4\uB978 \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C\uB3C4 \uC7AC\uC0AC\uC6A9 \uAC00\uB2A5"}).style.color="var(--text-faint)",o.addEventListener("click",()=>{this.choiceMade=!0,this.recordFeedback("library"),this.close(),this.onChoice("library")});let a=t.createDiv({cls:"modal-button-container"});a.style.marginTop="16px",a.createEl("button",{text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close())}onClose(){this.choiceMade||this.recordFeedback(null),this.contentEl.empty()}},XT=class extends D.Modal{constructor(e,t){super(e),this.plugin=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("zfb-command-list-modal");let t=e.createEl("h2",{text:"\u{1F9E0} Zero Friction Brain"});t.style.marginBottom="16px",t.style.textAlign="center";let n=[{name:"\uD504\uB85C\uC81D\uD2B8 \uBD84\uB958",hotkey:"Ctrl+Shift+G",icon:"folder",action:()=>this.plugin.classifyCurrentFile()},{name:"\uAD00\uB828 \uB178\uD2B8 \uC5F0\uACB0",hotkey:"Ctrl+Shift+L",icon:"link",action:()=>this.plugin.linkRelatedNotesForCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uCC98\uB9AC (OCR+\uBD84\uB958)",hotkey:"Ctrl+Shift+S",icon:"sparkles",action:()=>this.plugin.smartProcessCurrentFile()},{name:"\uC2A4\uB9C8\uD2B8 \uBD84\uB9AC",hotkey:"Ctrl+Shift+D",icon:"split",action:()=>this.plugin.smartSplitCurrentFile()},{name:"ZK \uCD94\uCD9C",hotkey:"Ctrl+Shift+Z",icon:"file-plus",action:()=>this.plugin.extractZKFromCurrentFile()},{name:"URL \uAC00\uC838\uC624\uAE30",hotkey:"Ctrl+Shift+U",icon:"globe",action:()=>this.plugin.showURLImportModal()},{name:"Focus Top 3",hotkey:"Ctrl+Shift+;",icon:"target",action:()=>this.plugin.showFocusTop3()},{name:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC",hotkey:"Ctrl+Shift+R",icon:"calendar-check",action:()=>this.plugin.showReviewModal()},{name:"OCR \uCD94\uCD9C",hotkey:"Ctrl+Shift+O",icon:"scan",action:()=>this.plugin.ocrCurrentFile()},{divider:!0},{name:"Inbox \uC804\uCCB4 \uCC98\uB9AC",hotkey:"",icon:"inbox",action:()=>this.plugin.processInbox()},{name:"\uD504\uB85C\uC81D\uD2B8 MOC \uC0DD\uC131",hotkey:"",icon:"map",action:()=>this.plugin.showCreateMOCModal()},{name:"ZK Index \uC7AC\uAD6C\uCD95",hotkey:"",icon:"refresh-cw",action:()=>this.plugin.rebuildZKIndex()},{name:"Watch \uD1A0\uAE00",hotkey:"",icon:"eye",action:()=>this.plugin.toggleWatch()}],s=e.createDiv({cls:"zfb-command-list"});s.style.display="flex",s.style.flexDirection="column",s.style.gap="4px";for(let a of n){if("divider"in a&&a.divider){let u=s.createEl("hr");u.style.margin="8px 0",u.style.border="none",u.style.borderTop="1px solid var(--background-modifier-border)";continue}let l=s.createDiv({cls:"zfb-command-item"});l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="space-between",l.style.padding="10px 12px",l.style.borderRadius="6px",l.style.cursor="pointer",l.style.transition="background-color 0.1s",l.addEventListener("mouseenter",()=>{l.style.backgroundColor="var(--background-secondary)"}),l.addEventListener("mouseleave",()=>{l.style.backgroundColor=""});let c=l.createDiv();c.style.display="flex",c.style.alignItems="center",c.style.gap="10px";let d=c.createSpan({cls:"zfb-command-icon"});if((0,D.setIcon)(d,a.icon||"command"),d.style.opacity="0.7",c.createSpan({text:a.name}),a.hotkey){let u=l.createSpan({text:a.hotkey,cls:"zfb-command-hotkey"});u.style.fontSize="0.85em",u.style.color="var(--text-muted)",u.style.backgroundColor="var(--background-secondary)",u.style.padding="2px 8px",u.style.borderRadius="4px",u.style.fontFamily="monospace"}l.addEventListener("click",()=>{this.close(),a.action()})}let r=e.createDiv({cls:"zfb-command-footer"});r.style.marginTop="16px",r.style.paddingTop="12px",r.style.borderTop="1px solid var(--background-modifier-border)",r.style.textAlign="center",r.style.color="var(--text-muted)",r.style.fontSize="0.85em",r.createSpan({text:`v${this.plugin.manifest.version} \u2022 `});let o=r.createEl("a",{text:"\uC124\uC815"});o.style.cursor="pointer",o.addEventListener("click",()=>{this.close(),this.app.setting.open(),this.app.setting.openTabById("zero-friction-brain")})}onClose(){this.contentEl.empty()}},JT=class extends D.Modal{constructor(t,n,s){super(t);this.selectedPeriod="week";this.resultContainer=null;this.isLoading=!1;this.reviewManager=n,this.settings=s}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("zfb-review-modal"),t.createEl("h2",{text:"\uB9AC\uBDF0/\uD68C\uACE0 \uBAA8\uB4DC"});let n=t.createDiv({cls:"zfb-review-period-section"});n.createEl("label",{text:"\uAE30\uAC04 \uC120\uD0DD:",cls:"setting-item-name"});let s=n.createDiv({cls:"zfb-period-buttons"});s.style.display="flex",s.style.gap="8px",s.style.marginTop="8px",s.style.marginBottom="16px",[{value:"today",label:"\uC624\uB298"},{value:"week",label:"\uC774\uBC88 \uC8FC"},{value:"month",label:"\uC774\uBC88 \uB2EC"}].forEach(({value:m,label:y})=>{let v=s.createEl("button",{text:y});v.style.padding="8px 16px",v.style.borderRadius="6px",v.style.cursor="pointer",m===this.selectedPeriod&&v.addClass("mod-cta"),v.addEventListener("click",()=>{this.selectedPeriod=m,s.querySelectorAll("button").forEach(b=>b.removeClass("mod-cta")),v.addClass("mod-cta"),this.loadNotes()})});let o=t.createDiv({cls:"zfb-review-filter-section"});o.style.marginBottom="16px",o.createEl("label",{text:"\uD504\uB85C\uC81D\uD2B8 \uD544\uD130 (\uC120\uD0DD):",cls:"setting-item-name"});let a=o.createEl("select");a.style.marginLeft="8px",a.style.padding="4px 8px";let l=a.createEl("option",{text:"\uC804\uCCB4",value:""});l.value="",this.reviewManager.getProjectList().forEach(m=>{let y=a.createEl("option",{text:m,value:m});y.value=m}),a.addEventListener("change",()=>{this.projectFilter=a.value||void 0,this.loadNotes()}),this.resultContainer=t.createDiv({cls:"zfb-review-results"}),this.resultContainer.style.marginTop="16px",this.resultContainer.style.maxHeight="400px",this.resultContainer.style.overflowY="auto";let d=t.createDiv({cls:"modal-button-container"});d.style.marginTop="16px",d.createEl("button",{text:"\uB2EB\uAE30"}).addEventListener("click",()=>this.close()),d.createEl("button",{text:"AI \uBD84\uC11D \uBC0F \uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131",cls:"mod-cta"}).addEventListener("click",()=>this.createReviewNote()),this.loadNotes()}async loadNotes(){if(!(!this.resultContainer||this.isLoading)){this.isLoading=!0,this.resultContainer.empty(),this.resultContainer.createEl("p",{text:"\uB178\uD2B8 \uC218\uC9D1 \uC911...",cls:"zfb-loading"});try{let t={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.collectNotes(t),s=this.reviewManager.groupByProject(n);this.renderResults(n,s)}catch(t){console.error("\uB178\uD2B8 \uC218\uC9D1 \uC2E4\uD328:",t),this.resultContainer.empty(),this.resultContainer.createEl("p",{text:`\uC624\uB958: ${t}`,cls:"zfb-error"})}finally{this.isLoading=!1}}}renderResults(t,n){if(!this.resultContainer)return;if(this.resultContainer.empty(),t.length===0){this.resultContainer.createEl("p",{text:"\uD574\uB2F9 \uAE30\uAC04\uC5D0 \uC791\uC5C5\uD55C \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.",cls:"zfb-empty-message"});return}let s=this.resultContainer.createDiv({cls:"zfb-review-summary"});s.style.padding="12px",s.style.backgroundColor="var(--background-secondary)",s.style.borderRadius="8px",s.style.marginBottom="16px";let r=rd(this.selectedPeriod,this.settings.timezone);s.createEl("p",{text:`${r.label} \uC791\uC5C5: ${t.length}\uAC1C \uB178\uD2B8, ${n.length}\uAC1C \uD504\uB85C\uC81D\uD2B8/\uC601\uC5ED`});for(let o of n){let a=this.resultContainer.createDiv({cls:"zfb-review-group"});a.style.marginBottom="16px";let l=a.createEl("h4",{text:`\u{1F4C1} ${o.projectName} (${o.noteCount}\uAC1C)`});l.style.marginBottom="8px",l.style.borderBottom="1px solid var(--background-modifier-border)",l.style.paddingBottom="4px";let c=a.createEl("ul");c.style.listStyle="none",c.style.paddingLeft="16px",c.style.margin="0";for(let d of o.notes){let u=c.createEl("li");u.style.display="flex",u.style.justifyContent="space-between",u.style.alignItems="center",u.style.padding="4px 0";let p=u.createEl("a",{text:d.title});p.style.cursor="pointer",p.style.color="var(--text-accent)",p.addEventListener("click",async()=>{this.app.vault.getAbstractFileByPath(d.path)instanceof D.TFile&&await this.app.workspace.openLinkText(d.path,"")});let m=u.createEl("span",{text:o_(d.modified),cls:"zfb-note-time"});m.style.fontSize="0.85em",m.style.color="var(--text-muted)"}}}async createReviewNote(){if(!this.isLoading){this.isLoading=!0,new D.Notice("AI \uBD84\uC11D \uC911...");try{let t={period:this.selectedPeriod,projectFilter:this.projectFilter},n=await this.reviewManager.analyze(t),s=await this.reviewManager.createReviewNote(n);new D.Notice(`\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131\uB428: ${s.basename}`),await this.app.workspace.openLinkText(s.path,""),this.close()}catch(t){console.error("\uD68C\uACE0 \uB178\uD2B8 \uC0DD\uC131 \uC2E4\uD328:",t),new D.Notice(`\uC0DD\uC131 \uC2E4\uD328: ${t}`)}finally{this.isLoading=!1}}}onClose(){this.contentEl.empty()}};
/*! Bundled license information:

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
